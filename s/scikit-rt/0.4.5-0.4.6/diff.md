# Comparing `tmp/scikit-rt-0.4.5.tar.gz` & `tmp/scikit-rt-0.4.6.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "scikit-rt-0.4.5.tar", last modified: Fri Apr 28 15:46:01 2023, max compression
+gzip compressed data, was "scikit-rt-0.4.6.tar", last modified: Wed May 17 12:13:46 2023, max compression
```

## Comparing `scikit-rt-0.4.5.tar` & `scikit-rt-0.4.6.tar`

### file list

```diff
@@ -1,71 +1,71 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-28 15:46:01.860000 scikit-rt-0.4.5/
--rw-r--r--   0 runner    (1001) docker     (123)    35129 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1590 2023-04-28 15:46:01.860000 scikit-rt-0.4.5/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     1505 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/README.md
--rw-r--r--   0 runner    (1001) docker     (123)      818 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/pypi.md
--rw-r--r--   0 runner    (1001) docker     (123)      108 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (123)     2839 2023-04-28 15:46:01.863999 scikit-rt-0.4.5/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)       37 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-28 15:46:01.812000 scikit-rt-0.4.5/src/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-28 15:46:01.816000 scikit-rt-0.4.5/src/scikit_rt.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     1590 2023-04-28 15:46:01.000000 scikit-rt-0.4.5/src/scikit_rt.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     1819 2023-04-28 15:46:01.000000 scikit-rt-0.4.5/src/scikit_rt.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-28 15:46:01.000000 scikit-rt-0.4.5/src/scikit_rt.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)     1936 2023-04-28 15:46:01.000000 scikit-rt-0.4.5/src/scikit_rt.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)        5 2023-04-28 15:46:01.000000 scikit-rt-0.4.5/src/scikit_rt.egg-info/top_level.txt
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-28 15:46:01.827999 scikit-rt-0.4.5/src/skrt/
--rw-r--r--   0 runner    (1001) docker     (123)      620 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    12816 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/application.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-28 15:46:01.832000 scikit-rt-0.4.5/src/skrt/better_viewer/
--rw-r--r--   0 runner    (1001) docker     (123)   132020 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/better_viewer/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     3920 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/better_viewer/options.py
--rw-r--r--   0 runner    (1001) docker     (123)    73050 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/core.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-28 15:46:01.812000 scikit-rt-0.4.5/src/skrt/data/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-28 15:46:01.836000 scikit-rt-0.4.5/src/skrt/data/elastix_parameter_files/
--rwxr-xr-x   0 runner    (1001) docker     (123)     1732 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/data/elastix_parameter_files/BE_BSpline05.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1801 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/data/elastix_parameter_files/MI_Affine.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1649 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/data/elastix_parameter_files/MI_BSpline05.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1650 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/data/elastix_parameter_files/MI_BSpline15.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1650 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/data/elastix_parameter_files/MI_BSpline30.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1798 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/data/elastix_parameter_files/MI_Rigid.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1804 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/data/elastix_parameter_files/MI_Translation.txt
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-28 15:46:01.840000 scikit-rt-0.4.5/src/skrt/data/niftyreg_parameter_files/
--rw-r--r--   0 runner    (1001) docker     (123)      141 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/data/niftyreg_parameter_files/Affine.txt
--rw-r--r--   0 runner    (1001) docker     (123)      124 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/data/niftyreg_parameter_files/BE_BSpline05.txt
--rw-r--r--   0 runner    (1001) docker     (123)      113 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/data/niftyreg_parameter_files/NMI_BSpline05.txt
--rw-r--r--   0 runner    (1001) docker     (123)      115 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/data/niftyreg_parameter_files/NMI_BSpline15.txt
--rw-r--r--   0 runner    (1001) docker     (123)      115 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/data/niftyreg_parameter_files/NMI_BSpline30.txt
--rw-r--r--   0 runner    (1001) docker     (123)      205 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/data/niftyreg_parameter_files/Rigid.txt
--rw-r--r--   0 runner    (1001) docker     (123)    23275 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/dicom_writer.py
--rw-r--r--   0 runner    (1001) docker     (123)    39459 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/dose.py
--rw-r--r--   0 runner    (1001) docker     (123)   250886 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/image.py
--rw-r--r--   0 runner    (1001) docker     (123)     1738 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/multi.py
--rw-r--r--   0 runner    (1001) docker     (123)   105267 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/patient.py
--rw-r--r--   0 runner    (1001) docker     (123)   132720 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/registration.py
--rw-r--r--   0 runner    (1001) docker     (123)    52538 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/segmentation.py
--rw-r--r--   0 runner    (1001) docker     (123)    17553 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/simulation.py
--rw-r--r--   0 runner    (1001) docker     (123)   351006 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/structures.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-28 15:46:01.843999 scikit-rt-0.4.5/src/skrt/viewer/
--rw-r--r--   0 runner    (1001) docker     (123)       43 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/viewer/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   154795 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/viewer/core.py
--rw-r--r--   0 runner    (1001) docker     (123)   113136 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/src/skrt/viewer/viewer.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-28 15:46:01.860000 scikit-rt-0.4.5/tests/
--rw-r--r--   0 runner    (1001) docker     (123)      820 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_01_setup.py
--rw-r--r--   0 runner    (1001) docker     (123)    10063 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_application.py
--rw-r--r--   0 runner    (1001) docker     (123)    15414 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_core.py
--rw-r--r--   0 runner    (1001) docker     (123)     7248 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_dose.py
--rw-r--r--   0 runner    (1001) docker     (123)    61362 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_image.py
--rw-r--r--   0 runner    (1001) docker     (123)     1369 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_multi.py
--rw-r--r--   0 runner    (1001) docker     (123)     9168 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_patient.py
--rw-r--r--   0 runner    (1001) docker     (123)     1554 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_qv_image.py
--rw-r--r--   0 runner    (1001) docker     (123)     8791 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_qv_quickviewer.py
--rw-r--r--   0 runner    (1001) docker     (123)     6165 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_qv_struct_loader.py
--rw-r--r--   0 runner    (1001) docker     (123)     3876 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_qv_struct_metrics.py
--rw-r--r--   0 runner    (1001) docker     (123)     1156 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_qv_structs.py
--rw-r--r--   0 runner    (1001) docker     (123)    34152 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_registration.py
--rw-r--r--   0 runner    (1001) docker     (123)    21138 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_roi_metrics.py
--rw-r--r--   0 runner    (1001) docker     (123)     5429 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_segmentation.py
--rw-r--r--   0 runner    (1001) docker     (123)       35 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_simulation.py
--rw-r--r--   0 runner    (1001) docker     (123)    65888 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_structs.py
--rw-r--r--   0 runner    (1001) docker     (123)     2513 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_synthetic_image.py
--rw-r--r--   0 runner    (1001) docker     (123)     7725 2023-04-28 15:40:28.000000 scikit-rt-0.4.5/tests/test_viewer.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-17 12:13:46.439063 scikit-rt-0.4.6/
+-rw-r--r--   0 runner    (1001) docker     (123)    35129 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1590 2023-05-17 12:13:46.439063 scikit-rt-0.4.6/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     1505 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)      818 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/pypi.md
+-rw-r--r--   0 runner    (1001) docker     (123)      108 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (123)     2839 2023-05-17 12:13:46.439063 scikit-rt-0.4.6/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)       37 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-17 12:13:46.403063 scikit-rt-0.4.6/src/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-17 12:13:46.407063 scikit-rt-0.4.6/src/scikit_rt.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     1590 2023-05-17 12:13:46.000000 scikit-rt-0.4.6/src/scikit_rt.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     1819 2023-05-17 12:13:46.000000 scikit-rt-0.4.6/src/scikit_rt.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-05-17 12:13:46.000000 scikit-rt-0.4.6/src/scikit_rt.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     1936 2023-05-17 12:13:46.000000 scikit-rt-0.4.6/src/scikit_rt.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        5 2023-05-17 12:13:46.000000 scikit-rt-0.4.6/src/scikit_rt.egg-info/top_level.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-17 12:13:46.419063 scikit-rt-0.4.6/src/skrt/
+-rw-r--r--   0 runner    (1001) docker     (123)      620 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12816 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/application.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-17 12:13:46.419063 scikit-rt-0.4.6/src/skrt/better_viewer/
+-rw-r--r--   0 runner    (1001) docker     (123)   132021 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/better_viewer/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3920 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/better_viewer/options.py
+-rw-r--r--   0 runner    (1001) docker     (123)    73387 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/core.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-17 12:13:46.403063 scikit-rt-0.4.6/src/skrt/data/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-17 12:13:46.423063 scikit-rt-0.4.6/src/skrt/data/elastix_parameter_files/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1732 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/data/elastix_parameter_files/BE_BSpline05.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1801 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/data/elastix_parameter_files/MI_Affine.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1649 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/data/elastix_parameter_files/MI_BSpline05.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1650 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/data/elastix_parameter_files/MI_BSpline15.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1650 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/data/elastix_parameter_files/MI_BSpline30.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1798 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/data/elastix_parameter_files/MI_Rigid.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1804 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/data/elastix_parameter_files/MI_Translation.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-17 12:13:46.423063 scikit-rt-0.4.6/src/skrt/data/niftyreg_parameter_files/
+-rw-r--r--   0 runner    (1001) docker     (123)      141 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/data/niftyreg_parameter_files/Affine.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      124 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/data/niftyreg_parameter_files/BE_BSpline05.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      113 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/data/niftyreg_parameter_files/NMI_BSpline05.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      115 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/data/niftyreg_parameter_files/NMI_BSpline15.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      115 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/data/niftyreg_parameter_files/NMI_BSpline30.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      205 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/data/niftyreg_parameter_files/Rigid.txt
+-rw-r--r--   0 runner    (1001) docker     (123)    26897 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/dicom_writer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    39911 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/dose.py
+-rw-r--r--   0 runner    (1001) docker     (123)   255896 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/image.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1738 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/multi.py
+-rw-r--r--   0 runner    (1001) docker     (123)   118731 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/patient.py
+-rw-r--r--   0 runner    (1001) docker     (123)   134874 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/registration.py
+-rw-r--r--   0 runner    (1001) docker     (123)    60958 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/segmentation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17553 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/simulation.py
+-rw-r--r--   0 runner    (1001) docker     (123)   352303 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/structures.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-17 12:13:46.427063 scikit-rt-0.4.6/src/skrt/viewer/
+-rw-r--r--   0 runner    (1001) docker     (123)       43 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/viewer/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   154795 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/viewer/core.py
+-rw-r--r--   0 runner    (1001) docker     (123)   113136 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/src/skrt/viewer/viewer.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-17 12:13:46.439063 scikit-rt-0.4.6/tests/
+-rw-r--r--   0 runner    (1001) docker     (123)      820 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_01_setup.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10063 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_application.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15414 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_core.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7248 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_dose.py
+-rw-r--r--   0 runner    (1001) docker     (123)    61362 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_image.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1369 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_multi.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9592 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_patient.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1554 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_qv_image.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8791 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_qv_quickviewer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6165 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_qv_struct_loader.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3876 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_qv_struct_metrics.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1156 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_qv_structs.py
+-rw-r--r--   0 runner    (1001) docker     (123)    34152 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_registration.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21138 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_roi_metrics.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5429 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_segmentation.py
+-rw-r--r--   0 runner    (1001) docker     (123)       35 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_simulation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65888 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_structs.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2513 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_synthetic_image.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7725 2023-05-17 12:09:40.000000 scikit-rt-0.4.6/tests/test_viewer.py
```

### Comparing `scikit-rt-0.4.5/LICENSE` & `scikit-rt-0.4.6/LICENSE`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/PKG-INFO` & `scikit-rt-0.4.6/PKG-INFO`

 * *Files 10% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: scikit-rt
-Version: 0.4.5
+Version: 0.4.6
 Summary: Toolkit for analysis of radiotherapy data
 Home-page: https://github.com/scikit-rt/scikit-rt
 Author: H. Pullen, K. Harrison
 Author-email: scikit-rt@hep.phy.cam.ac.uk
 License: UNKNOWN
 Project-URL: Bug Tracker, https://github.com/scikit-rt/scikit-rt/issues
 Description: # Scikit-rt
```

### Comparing `scikit-rt-0.4.5/README.md` & `scikit-rt-0.4.6/README.md`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/pypi.md` & `scikit-rt-0.4.6/pypi.md`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/setup.cfg` & `scikit-rt-0.4.6/setup.cfg`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 [metadata]
 name = scikit-rt
-version = 0.4.5
+version = 0.4.6
 author = H. Pullen, K. Harrison
 author_email = scikit-rt@hep.phy.cam.ac.uk
 description = Toolkit for analysis of radiotherapy data
 long_description = file: pypi.md
 long_description_content_type = text/markdown
 url = https://github.com/scikit-rt/scikit-rt
 project_urls =
```

### Comparing `scikit-rt-0.4.5/src/scikit_rt.egg-info/PKG-INFO` & `scikit-rt-0.4.6/src/scikit_rt.egg-info/PKG-INFO`

 * *Files 10% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: scikit-rt
-Version: 0.4.5
+Version: 0.4.6
 Summary: Toolkit for analysis of radiotherapy data
 Home-page: https://github.com/scikit-rt/scikit-rt
 Author: H. Pullen, K. Harrison
 Author-email: scikit-rt@hep.phy.cam.ac.uk
 License: UNKNOWN
 Project-URL: Bug Tracker, https://github.com/scikit-rt/scikit-rt/issues
 Description: # Scikit-rt
```

### Comparing `scikit-rt-0.4.5/src/scikit_rt.egg-info/SOURCES.txt` & `scikit-rt-0.4.6/src/scikit_rt.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/src/scikit_rt.egg-info/requires.txt` & `scikit-rt-0.4.6/src/scikit_rt.egg-info/requires.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/src/skrt/__init__.py` & `scikit-rt-0.4.6/src/skrt/__init__.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/src/skrt/application.py` & `scikit-rt-0.4.6/src/skrt/application.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/src/skrt/better_viewer/__init__.py` & `scikit-rt-0.4.6/src/skrt/better_viewer/__init__.py`

 * *Files 0% similar despite different names*

```diff
@@ -1695,15 +1695,15 @@
         intensity_step=None,
         figsize=_default_figsize,
         xlim=None,
         ylim=None,
         zlim=None,
         zoom=None,
         zoom_centre=None,
-        zoom_ui=None,
+        zoom_ui=False,
         cmap=None,
         colorbar=False,
         colorbar_label=None,
         clb_kwargs=None,
         clb_label_kwargs=None,
         no_xlabel=False,
         no_ylabel=False,
```

### Comparing `scikit-rt-0.4.5/src/skrt/better_viewer/options.py` & `scikit-rt-0.4.6/src/skrt/better_viewer/options.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/src/skrt/core.py` & `scikit-rt-0.4.6/src/skrt/core.py`

 * *Files 2% similar despite different names*

```diff
@@ -849,15 +849,15 @@
         Define whether <self> is greater than, or equal to, <other>.
 
         The comparison is based first on object date, then on time,
         then on path.
         '''
         return (self > other) or (self == other)
 
-    def copy_dicom(self, outdir=None, overwrite=True, sort=True):
+    def copy_dicom(self, outdir=None, overwrite=True, sort=True, index=None):
         """
         Copy (single) source dicom file.
 
         Derived classes may override this method, to provide for
         copying multiple files.  See, for example:
             skrt.image.Image.copy_dicom().
 
@@ -874,14 +874,19 @@
             file only if this doesn't mean overwriting an existing
             file.
 
         sort : bool, default=True
             If True, the copied dicom file will be given name of form
             'MODALITY_YYMMDD_hhmmss'.  If False, the file is copied
             with name unaltered.
+
+        index : int, default=None
+            Integer representing associated object position in an ordered
+            list of objects of source data type.  Used in construction
+            of output filename if not None, otherwise Ignored.
         """
         if not callable(getattr(self, "load", None)):
             raise NotImplementedError(
                     f"{type(self)}.copy_dicom() failed - "
                     "class has no load() method")
             return
         self.load()
@@ -899,15 +904,18 @@
         modality = getattr(ds, "Modality", "unknown")
 
         # Define the output directory.
         outdir = make_dir(outdir or modality, overwrite)
 
         # Define path to the output file.
         if sort:
-            name = f"{modality}_{self.timestamp}.dcm" if sort else path.name()
+            idx = "" if index is None else f"_{index+1:03}"
+            name = f"{modality}_{self.timestamp}{idx}.dcm"
+        else:
+            name = path.name()
         outpath = outdir / name
 
         # Copy file.
         if overwrite or not outpath.exists():
             shutil.copy2(path, outpath)
 
     def copy_dicom_files(self, data_type=None, index=None, indices=None,
@@ -943,21 +951,21 @@
             If True, files are sorted for copying, as defined in derived
             class's copy_dicom() method.
         """
         # Check whether object index satisfies requirements.
         if (isinstance(indices, dict)
                 and isinstance(data_type, str)
                 and isinstance(indices.get(data_type, None), list)
-                and isinstance(data_index, int)
-                and data_index not in indices[data_type]):
+                and isinstance(index, int)
+                and index not in indices[data_type]):
             return
 
         # Create output directory, and copy object files.
         outdir = make_dir(outdir, overwrite)
-        self.copy_dicom(outdir, overwrite, sort)
+        self.copy_dicom(outdir, overwrite, sort, index)
 
 class MachineData(Dated):
     """Dated object with an associated machine name."""
 
     def __init__(self, path: str = ""):
         Dated.__init__(self, path)
         self.machine = os.path.basename(os.path.dirname(path))
```

### Comparing `scikit-rt-0.4.5/src/skrt/data/elastix_parameter_files/BE_BSpline05.txt` & `scikit-rt-0.4.6/src/skrt/data/elastix_parameter_files/BE_BSpline05.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/src/skrt/data/elastix_parameter_files/MI_Affine.txt` & `scikit-rt-0.4.6/src/skrt/data/elastix_parameter_files/MI_Affine.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/src/skrt/data/elastix_parameter_files/MI_BSpline05.txt` & `scikit-rt-0.4.6/src/skrt/data/elastix_parameter_files/MI_BSpline05.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/src/skrt/data/elastix_parameter_files/MI_BSpline15.txt` & `scikit-rt-0.4.6/src/skrt/data/elastix_parameter_files/MI_BSpline15.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/src/skrt/data/elastix_parameter_files/MI_BSpline30.txt` & `scikit-rt-0.4.6/src/skrt/data/elastix_parameter_files/MI_BSpline30.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/src/skrt/data/elastix_parameter_files/MI_Rigid.txt` & `scikit-rt-0.4.6/src/skrt/data/elastix_parameter_files/MI_Rigid.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/src/skrt/data/elastix_parameter_files/MI_Translation.txt` & `scikit-rt-0.4.6/src/skrt/data/elastix_parameter_files/MI_Translation.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/src/skrt/dicom_writer.py` & `scikit-rt-0.4.6/src/skrt/dicom_writer.py`

 * *Files 13% similar despite different names*

```diff
@@ -477,43 +477,111 @@
         self.ds.SliceLocation = pos
         self.ds.ImagePositionPatient[2] = pos
         self.ds.InstanceNumber = sl
         self.ds.file_meta.MediaStorageSOPInstanceUID = (
                 f'{self.mediaStorageSOPInstanceUID}.{sl}')
         self.ds.SOPInstanceUID = self.ds.file_meta.MediaStorageSOPInstanceUID
 
+    def set_referenced_frame_of_reference_sequence(self, image):
+        """
+        Set attributes for referenced frame of reference sequence.
+
+        **Parameter:**
+
+        image : skrt.image.Image
+            Image from which attributes of referenced frame
+            of reference are to be determined.  If no associated DICOM
+            dataset can be loaded for this image, then
+            self.ds.ReferencedFrameOfReferenceSequence is set as
+            an empty sequence.
+        """
+        # Try to determine referenced frame of reference UID from image.
+        ds = image.get_dicom_dataset() if image is not None else None
+        self.referenced_frame_of_reference_uid = getattr(
+                ds, "FrameOfReferenceUID", None)
+
+        # Create new sequence if not already defined from header source,
+        # or if existing sequence is to be overwritten from input object.
+        if (self.referenced_frame_of_reference_uid is not None
+            or not hasattr(self.ds, "ReferencedFrameOfReferenceSequence")):
+            self.ds.ReferencedFrameOfReferenceSequence = Sequence()
+
+        # Exit if unable to determine referenced frame of reference UID.
+        if self.referenced_frame_of_reference_uid is None:
+            return
+
+        # Create dataset for referenced frame of reference.
+        referenced_frame_of_reference = Dataset()
+        referenced_frame_of_reference.FrameOfReferenceUID = (
+                self.referenced_frame_of_reference_uid)
+        referenced_frame_of_reference.RTReferencedStudySequence = Sequence()
+
+        # Create dataset for rt referenced study.
+        rt_referenced_study = Dataset()
+        rt_referenced_study.ReferencedSOPClassUID = "1.2.840.10008.3.1.2.3.2"
+        rt_referenced_study.ReferencedSOPInstanceUID = getattr(
+                ds, "StudyInstanceUID", None)
+        rt_referenced_study.RTReferencedSeriesSequence = Sequence()
+
+        # Create dataset for rt referenced series.
+        rt_referenced_series = Dataset()
+        rt_referenced_series.SeriesInstanceUID = getattr(
+                ds, "SeriesInstanceUID", None)
+        rt_referenced_series.ContourImageSequence = Sequence()
+
+        # Create the contour-image sequence.
+        for idx in range(image.get_n_voxels()[2]):
+            ds = image.get_dicom_dataset(idx + 1)
+            contour_image = Dataset()
+            contour_image.ReferencedSOPClassUID = getattr(
+                    ds, "SOPClassUID", None)
+            contour_image.ReferencedSOPInstanceUID = getattr(
+                    ds, "SOPInstanceUID", None)
+            rt_referenced_series.ContourImageSequence.append(contour_image)
+
+        # Append completed datasets to sequences.
+        rt_referenced_study.RTReferencedSeriesSequence.append(
+                rt_referenced_series)
+        referenced_frame_of_reference.RTReferencedStudySequence.append(
+                rt_referenced_study)
+        self.ds.ReferencedFrameOfReferenceSequence.append(
+            referenced_frame_of_reference)
+
     def set_structure_set(self):
         '''
         Add to dataset information for structure set.
 
         The contour data saved is all that's needed for Scikit-rt.
         Several DICOM sequences are left empty, or partially populated,
         which outside of Scikit-rt may sometimes cause problems.
         '''
+        # Obtain reference to any image associated with structure set.
+        image = self.data.get_image()
+
         # Initialise sequences.
-        self.ds.ReferencedFrameOfReferenceSequence = Sequence()
+        self.set_referenced_frame_of_reference_sequence(image)
         self.ds.StructureSetROISequence = Sequence()
         self.ds.RTROIObservationsSequence = Sequence()
         self.ds.ROIContourSequence = Sequence()
-
         rois = self.data.get_rois()
         numbers = [roi.number for roi in rois if roi.number is not None]
         index = max(numbers or [0])
 
         for name, roi in sorted(self.data.get_roi_dict().items()):
             if roi.number is not None:
                 number = roi.number
             else:
                 index += 1
                 number = index
 
             structure_set_roi = Dataset()
             structure_set_roi.ROINumber = number
             structure_set_roi.ROIName = name
-            structure_set_roi.ReferencedFrameOfReferenceUID = None
+            structure_set_roi.ReferencedFrameOfReferenceUID = (
+                    self.referenced_frame_of_reference_uid)
             structure_set_roi.ROIGenerationAlgorithm = None
             self.ds.StructureSetROISequence.append(structure_set_roi)
 
             rt_roi_observation = Dataset()
             rt_roi_observation.ObservationNumber = number
             rt_roi_observation.ReferencedROINumber = number
             rt_roi_observation.ROIObservationLabel = name
@@ -525,28 +593,37 @@
 #            roi_contour.ROIDisplayColor = list(map(str, roi.color))
             roi_contour.ROIDisplayColor = [f'{255 * rgb : .0f}'
                     for rgb in roi.color[0 : 3]]
             roi_contour.ReferencedROINumber = number
             roi_contour.ContourSequence = Sequence()
 
             for z_point, contours in sorted(roi.get_contours().items()):
+                image_ds = (image.get_dicom_dataset(pos=z_point)
+                            if image is not None else None)
+                referenced_sop_class_uid = getattr(
+                        image_ds, "SOPClassUID", None)
+                referenced_sop_instance_uid = getattr(
+                        image_ds, "SOPInstanceUID", None)
+
                 for xy_points in contours:
                     xyz_points = [[x_point, y_point, z_point]
                             for x_point, y_point in xy_points]
 
                     contour = Dataset()
                     contour.ContourGeometricType = 'CLOSED_PLANAR'
                     contour_data = [item for sublist in xyz_points
                             for item in sublist]
                     contour.ContourData = list(map(str, contour_data))
                     contour.NumberOfContourPoints = len(xyz_points)
                     contour.ContourImageSequence = Sequence()
                     contour_image = Dataset()
-                    contour_image.ReferencedSOPClassUID = None
-                    contour_image.ReferencedSOPInstanceUID = None
+                    contour_image.ReferencedSOPClassUID = (
+                            referenced_sop_class_uid)
+                    contour_image.ReferencedSOPInstanceUID = (
+                            referenced_sop_instance_uid)
                     contour.ContourImageSequence.append(contour_image)
                     roi_contour.ContourSequence.append(contour)
 
             self.ds.ROIContourSequence.append(roi_contour)
 
     def update_dataset(self):
         '''
```

### Comparing `scikit-rt-0.4.5/src/skrt/dose.py` & `scikit-rt-0.4.6/src/skrt/dose.py`

 * *Files 1% similar despite different names*

```diff
@@ -32,14 +32,18 @@
     def set_image(self, image):
         """Set associated image, initialising it if needed."""
 
         if image and not isinstance(image, skrt.image.Image):
             image = skrt.image.Image(image)
         self.image = image
 
+    def get_image(self):
+        """Return associated image."""
+        return self.image
+
     def plot(
         self, 
         view=None,
         sl=None,
         idx=None,
         pos=None,
         ax=None,
@@ -985,14 +989,18 @@
         # Assign image to self
         self.image = image
 
         # Assign self to the image
         if self.image is not None:
             self.image.add_plan(self)
 
+    def get_image(self):
+        """Return Image object associated with this plan."""
+        return self.image
+
     def set_structure_set(self, structure_set):
         """Set associated structure set, initialising it if needed."""
 
         # Convert to StructureSet object if needed
         if structure_set and not isinstance(
                 structure_set, skrt.structures.StructureSet):
             structure_set = skrt.structures.StructureSet(structure_set)
@@ -1000,14 +1008,18 @@
         # Assign structure set to self
         self.structure_set = structure_set
 
         # Assign self to the structure set and its rois
         if self.structure_set is not None:
             self.structure_set.add_plan(self)
 
+    def get_structure_set(self):
+        """Return StructureSet object associated with this plan."""
+        return self.structure_set
+
     def add_dose(self, dose):
         """Add a Dose object to be associated with this plan. This does not
         affect the plan associated with the Dose object.
 
         **Parameters:**
 
         dose : skrt.dose.Dose
@@ -1018,14 +1030,17 @@
         self.doses.sort()
 
     def clear_doses(self):
         """Clear all dose maps associated with this plan."""
 
         self.doses = []
 
+    def get_doses(self):
+        """Return Dose objects associated with this plan."""
+        return self.doses
 
 class Constraint(skrt.core.Data):
     '''
     Container for data relating to a dose constraint.
     '''
 
     @classmethod
```

### Comparing `scikit-rt-0.4.5/src/skrt/image.py` & `scikit-rt-0.4.6/src/skrt/image.py`

 * *Files 1% similar despite different names*

```diff
@@ -53,14 +53,15 @@
 # Matplotlib settings
 mpl.rcParams["figure.figsize"] = (7.4, 4.8)
 mpl.rcParams["font.serif"] = "Times New Roman"
 mpl.rcParams["font.family"] = "serif"
 mpl.rcParams["font.size"] = 14.0
 
 skrt.core.Defaults().foreground_name = "foreground"
+skrt.core.Defaults().foreground_threshold = -150
 
 class Image(skrt.core.Archive):
     """
     Class representing a medical image.
 
     Attributes of an Image object should usually be accessed via
     their getter methods, rather than directly, to ensure that
@@ -587,14 +588,17 @@
 
         self.load()
 
         # If no specific slice is requested, just return the last loaded dataset
         if sl is None and idx is None and pos is None:
             return self.dicom_dataset
 
+        if not getattr(self, "_z_paths", None):
+            return
+
         # Otherwise, load the dataset for that slice
         return pydicom.dcmread(
             self.get_dicom_filepath(sl=sl, idx=idx, pos=pos), force=True
         )
 
     def get_voxel_size(self, standardise=False, force_standardise=True):
 
@@ -1136,21 +1140,24 @@
         for i, v in enumerate(voxel_size):
             if v is not None:
                 voxel_size2.append(v)
             else:
                 voxel_size2.append(self.voxel_size[i])
         voxel_size = voxel_size2
 
+        # Exit if no change to voxel size.
+        if list(voxel_size) == list(self.voxel_size):
+            return
+
         # Define scale factors to obtain requested voxel size
         scale = [self.voxel_size[i] / voxel_size[i] for i in range(3)]
 
         self.data = scipy.ndimage.zoom(self.data, scale, order=order,
                 mode='nearest')
 
-
         # Reset properties
         self.origin = [
             self.origin[i] - self.voxel_size[i] / 2 + voxel_size[i] / 2
             for i in range(3)
         ]
 
         ny, nx, nz = self.data.shape
@@ -1196,35 +1203,37 @@
         try:
             z_array = np.linspace(z, z + (nz - 1) * dz, nz)
         except TypeError:
             z_array = None
 
         return (x_array, y_array, z_array)
 
-    def get_foreground_box_mask(self, dx=0, dy=0, threshold=-150):
+    def get_foreground_box_mask(self, dx=0, dy=0, threshold=None):
         '''
         Slice by slice, create rectangular mask enclosing foreground mask.
 
         dx : int, default=0
             Margin along columns to be added on each side of mask bounding box.
 
         dy : int, default=0
             Margin along rows to be added on each side of mask bounding box.
 
         threshold : int/float, default=None
             Intensity value above which pixels in a slice are assigned to
-            regions for determination of foreground.
+            regions for determination of foreground.  If None, use value
+            of Defaults().foreground_threshold.  If still None, use
+            Otsu threshold.
         '''
 
         foreground_mask = self.get_foreground_mask(threshold)
         foreground_box_mask = get_box_mask_from_mask(foreground_mask, dx, dy)
 
         return foreground_box_mask
 
-    def get_foreground_bbox(self, threshold=-150, convex_hull=False,
+    def get_foreground_bbox(self, threshold=None, convex_hull=False,
             fill_holes=True, dxy=0):
         """
         Obtain bounding box of image foreground.
 
         The bounding box is returned as
         [(xmin, xmax), (ymin, ymax), (zmin, zmax)], with values in mm.
 
@@ -1232,15 +1241,15 @@
         to obtain a mask defining the image foreground.  For parameter
         explanations, see skrt.image.Image.get_foreground_mask() documentation.
         """
         return (get_mask_bbox(
             self.get_foreground_mask(threshold, convex_hull, fill_holes, dxy)))
 
     def get_foreground_bbox_centre_and_widths(self,
-            threshold=-150, convex_hull=False, fill_holes=True, dxy=0):
+            threshold=None, convex_hull=False, fill_holes=True, dxy=0):
         """
         Get centre and widths in mm along all three axes of a
         bounding box enclosing the image foreground.  Centre
         and widths are returned as a tuple ([x, y, z], [dx, dy, dz]).
 
         Method parameters are passed to skrt.image.Image.get_foreground_mask()
         to obtain a mask defining the image foreground.  For parameter
@@ -1248,15 +1257,15 @@
         """
         extents = self.get_foreground_bbox()
         centre = [0.5 * (extent[0] + extent[1]) for extent in extents]
         widths = [(extent[1] - extent[0]) for extent in extents]
         return (centre, widths)
 
     def get_foreground_comparison(
-            self, other, name=None, threshold=-150, convex_hull=False,
+            self, other, name=None, threshold=None, convex_hull=False,
             fill_holes=True, dxy=0, voxel_size=None, **kwargs):
         """
         Return a pandas DataFrame comparing the foregrounds of
         this image and another.
 
         ROIs obtaining the image foregrounds are obtained, then
         these are compared using skrt.structures.ROI.get_comparison().
@@ -1270,62 +1279,70 @@
             Name to be assigned to the ROI representing the foreground
             of this image, and by default used as row index in DataFrame.
             If null, the name used is the image title, or if this is null
             then f"{skrt.core.Defaults().foreground_name}_1" is used.
 
         threshold : int/float, default=None
             Intensity value above which pixels in a slice are assigned to
-            regions for determination of foreground.
+            regions for determination of foreground.  If None, use value
+            of Defaults().foreground_threshold.  If still None, use
+            Otsu threshold.
     
         convex_hull : bool, default=False
             If True, create mask from the convex hulls of the
             slice foreground masks initially obtained.
 
         fill_holes : bool, default=False
             If True, fill holes in the slice foreground masks initially
             obtained.
 
         dxy : int, default=0
             Margin, in pixel units, to be added to each slice foreground mask.
 
         voxel_size : tuple, default=None
-            Voxel size (dx, dy, dz) in mm passed to
-            skrt.structures.ROI.get_comparison().  The default there
-            (1, 1, 1) is different from the default set here (None).
+            Voxel size (dx, dy, dz) in mm to be used for foreground
+            masks in comparisons.  If None, the mask voxel size of
+            <other> is used if not None; otherwise the default voxel
+            size for dummy images, namely (1, 1, 1), is used.  If an
+            element of the tuple specifying voxel size is None, the
+            value for the corresponding element of the mask voxel size
+            of <other> is used.
 
         kwargs: dict
             Keyword arguments, in addition to voxel_size, passed to
             skrt.structures.ROI.get_comparison().
         """
         name = (name or self.title
                 or f"{skrt.core.Defaults().foreground_name}_1")
         roi1 = self.get_foreground_roi(
                 threshold=threshold, convex_hull=convex_hull,
                 fill_holes=fill_holes, dxy=dxy, name=name)
         roi2 = other.get_foreground_roi(
                 threshold=threshold, convex_hull=convex_hull,
                 fill_holes=fill_holes, dxy=dxy)
 
-        return roi1.get_comparison(roi2, voxel_size=voxel_size, **kwargs)
+        return roi1.get_comparison(roi2, voxel_size=None, **kwargs)
 
-    def get_foreground_roi(self, threshold=-150, convex_hull=False,
+    def get_foreground_roi(self, threshold=None, convex_hull=False,
             fill_holes=True, dxy=0, **kwargs):
         '''
         Create ROI represening image foreground.
 
         Slice by slice, the foreground is taken to correspond to the
         largest region of contiguous pixels above a threshold value.
         A binary mask representing the foreground is created, and
         is used as source for creating an ROI.
 
         **Parameters:**
 
         threshold : int/float, default=None
             Intensity value above which pixels in a slice are assigned to
-            regions for determination of foreground.
+            regions for determination of foreground.  If None, use value
+            of Defaults().foreground_threshold.  If still None, use
+            Otsu threshold.
     
         convex_hull : bool, default=False
             If True, create mask from the convex hulls of the
             slice foreground masks initially obtained.
 
         fill_holes : bool, default=False
             If True, fill holes in the slice foreground masks initially
@@ -1339,27 +1356,29 @@
         '''
         from skrt.structures import ROI
         if not "name" in kwargs:
             kwargs["name"] = skrt.core.Defaults().foreground_name
         return ROI(self.get_foreground_mask(
             threshold, convex_hull, fill_holes, dxy), **kwargs)
 
-    def get_foreground_mask(self, threshold=-150, convex_hull=False,
+    def get_foreground_mask(self, threshold=None, convex_hull=False,
             fill_holes=True, dxy=0):
         '''
         Create foreground mask.
 
         Slice by slice, the foreground is taken to correspond to the
         largest region of contiguous pixels above a threshold value.
 
         **Parameters:**
 
         threshold : int/float, default=None
             Intensity value above which pixels in a slice are assigned to
-            regions for determination of foreground.
+            regions for determination of foreground.  If None, use value
+            of Defaults().foreground_threshold.  If still None, use
+            Otsu threshold.
     
         convex_hull : bool, default=False
             If True, create mask from the convex hulls of the
             slice foreground masks initially obtained.
 
         fill_holes : bool, default=False
             If True, fill holes in the slice foreground masks initially
@@ -1382,30 +1401,32 @@
         # Clone the current image, and replace its data with
         # the foreground mask.
         out_image = Image(self)
         out_image.data = out_array
 
         return out_image
 
-    def get_slice_foreground(self, idx=0, threshold=-150,
+    def get_slice_foreground(self, idx=0, threshold=None,
             convex_hull=False, fill_holes=False, dxy=0):
         '''
         Create foreground mask for image slice.
 
         The foreground is taken to correspond to the largest region
         of contiguous pixels above a threshold value.
 
         **Parameters:**
 
         idx : int, default=0
             Index of slice for which foreground mask is to be obtained.
 
         threshold : int/float, default=None
             Intensity value above which pixels are assigned to regions
-            for determination of foreground.
+            for determination of foreground.  If None, use value
+            of Defaults().foreground_threshold.  If still None, use
+            Otsu threshold.
     
         convex_hull : bool, default=False
             If True, return the convex hull of the foreground mask
             initially obtained.
 
         fill_holes : bool, default=False
             If False, fill holes in the foreground mask initially
@@ -1420,14 +1441,19 @@
         # Extract slice data.
         image_slice = self.get_data()[:, :, idx]
 
         # Obtain intensity values relative to the minimum.
         test_slice = np.uint32(image_slice - image_slice.min())
         # Make this a 2D array.
         test_slice = np.squeeze(test_slice)
+
+        # Fallback to default threshold.
+        if threshold is None:
+            threshold = skrt.core.Defaults().foreground_threshold
+
         # Calculate Otsu threshold, or rescale threshold value provided.
         if threshold is None:
             rescaled_threshold = mahotas.thresholding.otsu(test_slice)
         else:
             rescaled_threshold = threshold - image_slice.min()
 
         # Handle case where slice contains intensity values above threshold,
@@ -1467,29 +1493,31 @@
             if test_slice.max() > rescaled_threshold:
                 label_array2 = np.ones(image_slice.shape, dtype=bool)
             else:
                 label_array2 = np.zeros(image_slice.shape, dtype=bool)
 
         return label_array2
 
-    def select_foreground(self, threshold=-150, convex_hull=False,
+    def select_foreground(self, threshold=None, convex_hull=False,
             fill_holes=True, dxy=0, background=None):
         '''
         Modify image to show intensity information only for foreground.
 
         Slice by slice, the foreground is taken to correspond to the
         largest region of contiguous pixels above a threshold value.
         Voxels outside the foreground region are all assigned the
         same same (background) intensity value.
 
         **Parameters:**
 
         threshold : int/float, default=None
             Intensity value above which pixels in a slice are assigned to
-            regions for determination of foreground.
+            regions for determination of foreground.  If None, use value
+            of Defaults().foreground_threshold.  If still None, use
+            Otsu threshold.
     
         convex_hull : bool, default=False
             If True, create mask from the convex hulls of the
             slice foreground masks initially obtained.
 
         fill_holes : bool, default=False
             If False, fill holes in the slice foreground masks initially
@@ -1827,15 +1855,15 @@
                 to_resample = self if own_vz > other_vz else image
                 match_to = self if own_vz < other_vz else image
             else:
                 raise RuntimeError(f"Unrecognised resampling option: {method}")
 
         # Perform resampling
         voxel_size = [None, None, match_to.get_voxel_size()[2]]
-        init_vz = to_resample.voxel_size[2]
+        init_vz = to_resample.get_voxel_size()[2]
         init_nz = int(to_resample.n_voxels[2])
         to_resample.resample(voxel_size)
         print(
             f"Resampled z axis from {init_nz} x {init_vz:.3f} mm -> "
             f"{int(to_resample.n_voxels[2])} x {to_resample.voxel_size[2]:.3f}"
             "mm"
         )
@@ -2887,14 +2915,15 @@
             roi_linewidth = roi_kwargs.get("linewidth",
                     mpl.defaultParams["lines.linewidth"][0])
         roi_kwargs["linewidth"] = roi_linewidth
         if roi_opacity is None:
             roi_opacity = roi_kwargs.get("opacity",
                     0.3 if "filled" in roi_plot_type else 1)
         roi_kwargs["opacity"] = roi_opacity
+        roi_kwargs["title"] = roi_kwargs.get("title", title) or ""
 
         if dose_kwargs is None:
             dose_kwargs = {}
         if clb_kwargs is None:
             clb_kwargs = {}
         if clb_label_kwargs is None:
             clb_label_kwargs = {}
@@ -3655,15 +3684,16 @@
                 type(self).__name__,
                 filename
             )
             self.dicom_dataset = dicom_writer.write()
             if verbose:
                 print("Wrote dicom file(s) to directory:", outdir)
 
-    def copy_dicom(self, outdir="image_dicom", overwrite=True, sort=True):
+    def copy_dicom(self, outdir="image_dicom", overwrite=True, sort=True,
+                   *args, **kwargs):
         """
         Copy source dicom files.
 
         **Parameters:**
 
         outdir : pathlib.Path/str, default="image_dicom"
             Path to directory to which source files are to be copied.
@@ -3676,14 +3706,20 @@
 
         sort : bool, default=True
             If True, copied dicom files will be named by instance number
             if all files have a different instance number, or else
             will be numbered sequentially from 1, in order of increasing
             z-coordinate.  If False, files are copied to the output directory
             with their names unaltered.
+
+        args : list
+            Arguments to be ignored.
+
+        kwargs : dict
+            Keyword arguments to be ignored.
         """
         self.load()
 
         # Check that image has dicom files to be copied.
         z_paths = getattr(self, "_z_paths", {})
         if not z_paths:
             if 1 == len(self.files):
@@ -3943,14 +3979,15 @@
         """
 
         lims = [xlim, ylim, zlim]
         if all([lim is None for lim in lims]):
             return
 
         # Ensure DICOM representation for cropping.
+        self.load()
         if "nifti" in self.source_type:
             im = self.astype("dicom")
         else:
             im = self
 
         for i_ax, lim in enumerate(lims):
 
@@ -3959,16 +3996,16 @@
 
             # Find array indices at which to crop
             i1 = im.pos_to_idx(lims[i_ax][0], ax=i_ax, return_int=False)
             i2 = im.pos_to_idx(lims[i_ax][1], ax=i_ax, return_int=False)
             i_big, i_small = i2, i1
             if i1 > i2:
                 i_big, i_small = i_small, i_big
-            i_small = int(np.floor(round(i_small, 6) + 0.5))
-            i_big = int(np.floor(round(i_big, 6) + 0.5))
+            i_small = int(np.floor(round(i_small, 3) + 0.5))
+            i_big = int(np.floor(round(i_big, 3) + 0.5))
 
             # Ensure indices are within image range
             if i_small < 0:
                 i_small = 0
             if i_big > im.n_voxels[i_ax]:
                 i_big = im.n_voxels[i_ax]
 
@@ -6564,29 +6601,110 @@
         im2.crop_about_point(im2_crop_focus, *im2_crop_margins)
 
     # Crop images to same size.
     if alignment is not False:
         im1.crop_to_image(im2, alignment)
         im2.crop_to_image(im1, alignment)
         if (im1.get_voxel_size() == im2.get_voxel_size()
-            and not im1.has_same_geometry(im2)):
-            im1.match_size(im1)
+            and im1.get_n_voxels() != im2.get_n_voxels()):
+            im1.resize(im2.get_n_voxels(), method="nearest")
 
     # Perform banding of image grey levels.
     im1.apply_selective_banding(bands)
     im2.apply_selective_banding(bands)
 
     # Reset structure-set images.
     for im, ss in [(im1, ss1), (im2, ss2)]:
         if ss:
             im.clear_structure_sets()
             ss.set_image(im)
 
     return (im1, im2)
 
+def match_images_for_comparison(
+        im1, im2, ss1=None, ss2=None, ss1_index=-1, ss2_index=-1,
+        ss1_name=None, ss2_name=None, roi_names=None, alignment=None,
+        voxel_size=None):
+    """
+    Process pair of images, to allow their comparison.
+
+    Images are optionally aligned, then their geometries are matched,
+    so that they can be handled by the image-comparison methods
+    Image.get_comparison() and Image.get_quality().
+
+    This function provides a subset of the processing options offered
+    by match_images(), and in addition can change the origin of the first
+    image, to align better with the second image.
+
+    **Parameters:**
+
+    im1, im2 : skrt.image.Image
+        Images to be matched for comparison.
+
+    ss1, ss2 : skrt.structures.StructureSet, default=None
+        Structure sets to associate with images im1, im2.  If a value
+        is None, and image matching involves ROI alignment, a structure
+        set already associated with the relevant image is used
+        (im1.structure_sets[ss1_index], im2.structure_sets[ss2_index]).
+
+    ss1_index, ss2_index : int, default=-1
+        Structure set indices to use for ROI alignment based on
+        structure sets already associated with images.
+
+    ss1_name, ss2_name : str, default=None
+        Names to be assigned to structure sets associated with the
+        returned image objects.  If a value is None, the original
+        name is kept.
+
+    roi_names : dict, default=None
+        Dictionary for renaming and filtering ROIs for inclusion
+        in the structure sets associated with the output images.
+        Keys are names for ROIs to be kept, and values are lists of
+        alternative names with which these ROIs may have been
+        labelled in the input structure sets.  The alternative names
+        can contain wildcards with the '*' symbol.  If a value of
+        None is given, all ROIs in the input structure sets are kept,
+        with no renaming.
+
+    alignment : tuple/dict/str, default=None
+        Strategy to be used for aligning images prior to cropping
+        so that they have the same size.  For strategy details, see
+        documentation of skrt.image.get_alignment_translation().
+        After alignment, im1 is cropped to the size of im2, then im2
+        is cropped to the size of im1.  To omit cropping to the same
+        size, set alginment to False.
+
+    voxel_size : tuple/str/float, default=None
+         Specification of voxel size for image resampling.
+         For possible values, see documentation for function
+         skrt.image.match_image_voxel_size().
+    """
+    im1 = im1.clone_with_structure_set(ss1, roi_names, ss1_index, ss1_name)
+    ss1 = im1.structure_sets[0] if im1.structure_sets else None
+    im2 = im2.clone_with_structure_set(ss2, roi_names, ss2_index, ss2_name)
+    ss2 = im2.structure_sets[0] if im2.structure_sets else None
+
+    # Resample images to same voxel size.
+    if voxel_size is not None:
+        match_image_voxel_sizes(im1, im2, voxel_size)
+
+    # Translate first image, to try to align with second image.
+    if alignment is not None:
+        translation = im1.get_alignment_translation(im2, alignment)
+        im1.translate_origin(translation)
+
+    # Crop images to one another.
+    im2.crop_to_image(im1)
+    im1.crop_to_image(im2)
+
+    # Match geometries.
+    im1.match_size(im2, method="nearest")
+
+    return (im1, im2)
+
 def match_image_voxel_sizes(im1, im2, voxel_size=None, order=1):
     """
     Resample pair of images to same voxel size.
 
     **Parameters:**
 
     im1, im2 : skrt.image.Image
```

### Comparing `scikit-rt-0.4.5/src/skrt/multi.py` & `scikit-rt-0.4.6/src/skrt/multi.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/src/skrt/patient.py` & `scikit-rt-0.4.6/src/skrt/patient.py`

 * *Files 17% similar despite different names*

```diff
@@ -290,14 +290,141 @@
 
         The patient identifier is taken to be the name of the folder
         containing the patient data.
         """
         patient_id = os.path.basename(os.path.dirname(self.path))
         return patient_id
 
+    def get_objs(self, dtype, subtypes=None, associations=None):
+        """
+        Get list of study-associated objects of specified type and subtype(s).
+        
+        Returned objects are sorted by timestamp (earliest first).
+
+        **Parameters:**
+
+        dtype: str
+            String identifying type of objects to be returned.  This may
+            be any of: "image", "structure_set", "dose", "plan".
+
+        subtypes: str/list, default=None
+            String, or list of strings, identifying subtype(s) of objects
+            to be returned.  A subtype may correspond to an imaging modality,
+            for example "ct", "mr", "us", or may be a generic identifier,
+            for example "rtstruct", "rtdose", "rtplan".  If None,
+            all subtypes are accepted.
+
+        associations: str/list, default=None
+            String, or list of strings, identifying required associations for
+            the objects to be returned.  For example, associations=["image"]
+            indicates that objects without an associated Image object are to be
+            disregarded.  If None, there are no required associations.
+        """
+        # Obtain object(s) of required data type and subtype(s).
+        obj_types = getattr(self, f"{dtype.lower()}_types", {})
+        subtypes = subtypes or list(obj_types)
+        if isinstance(subtypes, str):
+            subtypes = [subtypes]
+        objs = sum([obj_types.get(subtype.lower(), [])
+                    for subtype in subtypes], [])
+
+        # Return object(s) with required associations.
+        if associations is None:
+            associations = []
+        elif isinstance(associations, str):
+            associations = [associations]
+        return sorted(
+                [obj for obj in objs
+                 if all([getattr(obj, dtype, None) for dtype in associations])])
+
+    def get_images(self, subtypes=None, associations=None):
+        """
+        Get list of study-associated images of specified subtype(s).
+
+        **Parameter:**
+
+        subtypes: str/list, default=None
+            String, or list of strings, identifying subtype(s) of images
+            to be returned.  A subtype corresponds to an imaging modality,
+            for example "ct", "mr", "us".  If None, all subtypes are accepted.
+
+        associations: str/list, default=None
+            String, or list of strings, identifying required associations for
+            the images to be returned.  For example,
+            associations=["structure_sets"] indicates that Image objects
+            without at least one associated StructureSet object are to be
+            disregarded.  If None, there are no required associations.
+        """
+        return self.get_objs("image", subtypes, associations)
+
+    def get_structure_sets(self, subtypes=None, associations=None):
+        """
+        Get list of study-associated structure sets of specified subtype(s).
+
+        **Parameter:**
+
+        subtypes: str/list, default=None
+            String, or list of strings, identifying subtype(s) of structure
+            sets to be returned.  A subtype may correspond to the modality
+            of the image associated with a structure set, or may be the
+            generic identifier "rtstruct" if there is no associated image.
+            If None, all subtypes are accepted.
+
+        associations: str/list, default=None
+            String, or list of strings, identifying required associations for
+            the structure sets to be returned.  For example,
+            associations=["image"] indicates that StructureSet objects
+            without an associated Image object are to be disregarded.  If None,
+            there are no required associations.
+        """
+        return self.get_objs("structure_set", subtypes, associations)
+
+    def get_doses(self, subtypes=None, associations=None):
+        """
+        Get list of study-associated doses of specified subtype(s).
+
+        **Parameter:**
+
+        subtypes: str/list, default=None
+            String, or list of strings, identifying subtype(s) of doses
+            to be returned.  A subtype may correspond to the modality
+            of the image associated with a dose, or may be the generic
+            identifier "rtdose" if there is no associated image.
+            If None, all subtypes are accepted.
+
+        associations: str/list, default=None
+            String, or list of strings, identifying required associations for
+            the doses to be returned.  For example, associations=["image"]
+            indicates that Dose objects without an associated Image object
+            are to be disregarded.  If None, there are no required associations.
+        """
+        return self.get_objs("dose", subtypes, associations)
+
+    def get_plans(self, subtypes=None, associations=None):
+        """
+        Get list of study-associated plans of specified subtype(s).
+
+        **Parameter:**
+
+        subtypes: str/list, default=None
+            String, or list of strings, identifying subtype(s) of plans
+            to be returned.  A subtype may correspond to the modality
+            of the image associated with a dose, or may be the generic
+            identifier "rtplan" if there is no associated image.
+            If None, all subtypes are accepted.
+
+        associations: str/list, default=None
+            String, or list of strings, identifying required associations for
+            the plans to be returned.  For example,
+            associations=["structure_set"] indicates that Plan objects without
+            an associated StructureSet object are to be disregarded.  If None,
+            there are no required associations.
+        """
+        return self.get_objs("plan", subtypes, associations)
+
     def get_plan_data(self, dtype="RtPlan", subdir="RTPLAN", exclude=[], images=[]):
         """Get list of RT dose or plan objects specified by dtype='RtDose' or
         'RtPlan' <dtype>, respectively) by searching within a given directory,
         <subdir> (or within the top level directory of this Study, if
         <subdir> is not provided).
 
         Subdirectories with names in <exclude> will be ignored.
@@ -787,17 +914,15 @@
         **Parameters:**
 
         overwrite - bool, default=True
             If False, skip images with pre-existing output directories.
             If True, delete pre-existing output directories.
 
         outdir - str, default='.'
-            Top-level directory to which nifti files for InnerEye will
-            be written for study.  Each output image will be in a separate
-            sub-directory, along with a file per associated ROI.
+            Top-level directory to which data will be copied.
 
         images_to_copy : list/str/dict, default=None
             String specifiying image type for which all images are
             to be copied; list of strings specifying image types
             for which all images are to be copied; dictionary where
             the keys are image types and the values are lists of
             timestamp indices for the images to be copied, 0 being
@@ -1280,14 +1405,191 @@
             for obj_type in sorted(obj_types):
                 if not obj_type in all_types:
                     all_types.append(obj_type)
 
         all_types.sort()
         return all_types
 
+    def get_studies(self, subdirs=None):
+        '''
+        Get list of studies for this patient.
+
+        Optionally restrict to studies within specified sub-directories.
+
+        **Parameter:**
+
+        subdirs : str/list, default=None
+            Subdirectory, or list of subdirectories, grouping studies.
+            If specified, only studies in this subdirectory, or
+            in these subdirectories, are considered.
+        '''
+        if subdirs:
+            if isinstance(subdirs, str):
+                subdirs = [subdirs]
+            studies = [study for study in self.studies
+                       if study.subdir in subdirs]
+        else:
+            studies = self.studies
+
+        return sorted(studies)
+
+    def get_objs(self, dtype, subtypes=None, associations=None, subdirs=None):
+        '''
+        Get list of patient-associated objects of specified type and subtype(s).
+
+        Objects may be taken across all studies, or across studies within
+        specified sub-directories.
+
+        Returned objects are sorted by timestamp (earliest first).
+
+        **Parameters:**
+
+        dtype: str
+            String identifying type of objects to be returned.  This may
+            be any of: "image", "structure_set", "dose", "plan".
+
+        subtypes: str/list, default=None
+            String, or list of strings, identifying subtype(s) of objects
+            to be returned.  A subtype may correspond to an imaging modality,
+            for example "ct", "mr", "us", or may be a generic identifier,
+            for example "rtstruct", "rtdose", "rtplan".  If None,
+            all subtypes are accepted.
+
+        associations: str/list, default=None
+            String, or list of strings, identifying required associations for
+            the objects to be returned.  For example, associations=["image"]
+            indicates that objects without an associated Image object are to be
+            disregarded.  If None, there are no required associations.
+
+        subdirs : str/list, default=None
+            Subdirectory, or list of subdirectories, grouping studies.
+            If specified, only studies in this subdirectory, or
+            in these subdirectories, are considered.
+        '''
+        return sorted(sum([study.get_objs(dtype, subtypes, associations)
+                    for study in self.get_studies(subdirs)], []))
+
+    def get_images(self, subtypes=None, associations=None, subdirs=None):
+        """
+        Get list of patient-associated images of specified subtype(s).
+
+        Images may be taken across all studies, or across studies within
+        specified sub-directories.
+
+        **Parameter:**
+
+        subtypes: str/list, default=None
+            String, or list of strings, identifying subtype(s) of images
+            to be returned.  A subtype corresponds to an imaging modality,
+            for example "ct", "mr", "us".  If None, all subtypes are accepted.
+
+        associations: str/list, default=None
+            String, or list of strings, identifying required associations for
+            the images to be returned.  For example,
+            associations=["structure_sets"] indicates that Image objects
+            without at least one associated StructureSet object are to be
+            disregarded.  If None, there are no required associations.
+
+        subdirs : str/list, default=None
+            Subdirectory, or list of subdirectories, grouping studies.
+            If specified, only studies in this subdirectory, or
+            in these subdirectories, are considered.
+        """
+        return self.get_objs("image", subtypes, associations, subdirs)
+
+    def get_structure_sets(self, subtypes=None, associations=None,
+                           subdirs=None):
+        """
+        Get list of patient-associated structure sets of specified subtype(s).
+
+        Structure sets may be taken across all studies, or across studies within
+        specified sub-directories.
+
+        **Parameter:**
+
+        subtypes: str/list, default=None
+            String, or list of strings, identifying subtype(s) of structure
+            sets to be returned.  A subtype may correspond to the modality
+            of the image associated with a structure set, or may be the
+            generic identifier "rtstruct" if there is no associated image.
+            If None, all subtypes are accepted.
+
+        associations: str/list, default=None
+            String, or list of strings, identifying required associations for
+            the structure sets to be returned.  For example,
+            associations=["image"] indicates that StructureSet objects
+            without an associated Image object are to be disregarded.  If None,
+            there are no required associations.
+
+        subdirs : str/list, default=None
+            Subdirectory, or list of subdirectories, grouping studies.
+            If specified, only studies in this subdirectory, or
+            in these subdirectories, are considered.
+        """
+        return self.get_objs("structure_set", subtypes, subdirs)
+
+    def get_doses(self, subtypes=None, associations=None, subdirs=None):
+        """
+        Get list of patient-associated doses of specified subtype(s).
+
+        Doses may be taken across all studies, or across studies within
+        specified sub-directories.
+
+        **Parameter:**
+
+        subtypes: str/list, default=None
+            String, or list of strings, identifying subtype(s) of doses
+            to be returned.  A subtype may correspond to the modality
+            of the image associated with a dose, or may be the generic
+            identifier "rtdose" if there is no associated image.
+            If None, all subtypes are accepted.
+
+        associations: str/list, default=None
+            String, or list of strings, identifying required associations for
+            the doses to be returned.  For example, associations=["image"]
+            indicates that Dose objects without an associated Image object
+            are to be disregarded.  If None, there are no required associations.
+
+        subdirs : str/list, default=None
+            Subdirectory, or list of subdirectories, grouping studies.
+            If specified, only studies in this subdirectory, or
+            in these subdirectories, are considered.
+        """
+        return self.get_objs("dose", subtypes, associations, subdirs)
+
+    def get_plans(self, subtypes=None, associations=None, subdirs=None):
+        """
+        Get list of patient-associated plans of specified subtype(s).
+
+        Plans may be taken across all studies, or across studies within
+        specified sub-directories.
+
+        **Parameter:**
+
+        subtypes: str/list, default=None
+            String, or list of strings, identifying subtype(s) of plans
+            to be returned.  A subtype may correspond to the modality
+            of the image associated with a dose, or may be the generic
+            identifier "rtplan" if there is no associated image.
+            If None, all subtypes are accepted.
+
+        associations: str/list, default=None
+            String, or list of strings, identifying required associations for
+            the plans to be returned.  For example,
+            associations=["structure_set"] indicates that Plan objects without
+            an associated StructureSet object are to be disregarded.  If None,
+            there are no required associations.
+
+        subdirs : str/list, default=None
+            Subdirectory, or list of subdirectories, grouping studies.
+            If specified, only studies in this subdirectory, or
+            in these subdirectories, are considered.
+        """
+        return self.get_objs("plan", subtypes, associations, subdirs)
+
     def get_structure_set_with_image(
             self, roi_names=None, modality=None, study_index=None,
             structure_set_index=None, filter_rois=False, link_image=False,
             clone=False):
         """
         Get structure set containing specified ROIs, and with an
         associated image of a given modality.
@@ -1343,20 +1645,24 @@
         rois = None
         for study in studies:
             # Exit loop if structure set satisfying conditions found.
             if rois is not None:
                 break
 
             # Define the list of structure sets to be considered.
+            """
             if modality is not None:
                 structure_sets = study.structure_set_types.get(modality, [])
             else:
                 structure_sets = sorted(
                         [ss for ss in structure_set_types.values()
                          if ss.image is not None])
+            """
+            structure_sets = study.get_structure_sets(
+                    subtypes=modality, associations="image")
             if not structure_sets:
                 continue
             if structure_set_index is not None:
                 structure_sets = [structure_sets[structure_set_index]]
 
             # If no constraints on ROI names, accept the first structure set.
             if roi_names is None:
```

### Comparing `scikit-rt-0.4.5/src/skrt/registration.py` & `scikit-rt-0.4.6/src/skrt/registration.py`

 * *Files 1% similar despite different names*

```diff
@@ -1623,14 +1623,60 @@
 
             # Create output object
             output_file = os.path.join(outdir, expected_outname)
             assert os.path.exists(output_file)
             kwargs = {} if is_jac else {"signs": self.engine.def_signs}
             return dtype(path=output_file, image=image, title=title, **kwargs)
 
+    def get_comparison(self, step=-1, force=False, **kwargs):
+        """
+        Return a pandas DataFrame comparing fixed image
+        and transformed moving image after step.
+
+        **Parameters:**
+        step : int/str/list, default=None
+            Name or number of the registration step after which
+            mutual information is to be calculated.  Available
+            steps are listed in self.steps.
+
+        force : bool, default=False
+            If True, transformation of the moving image will be
+            forced, even if the image was transformed previously.
+
+        **kwargs
+            Keyword arguments passed to
+            skrt.image.Image.get_comparison()
+            See this method's documentation for options.
+        """
+        return self.fixed_image.get_comparison(
+                self.get_transformed_image(step, force), **kwargs)
+
+    def get_foreground_comparison(self, step=-1, force=False, **kwargs):
+        """
+        Return a pandas DataFrame comparing the foregrounds of
+        fixed image and transformed moving image after step.
+
+        **Parameters:**
+        step : int/str/list, default=None
+            Name or number of the registration step after which
+            mutual information is to be calculated.  Available
+            steps are listed in self.steps.
+
+        force : bool, default=False
+            If True, transformation of the moving image will be
+            forced, even if the image was transformed previously.
+
+        **kwargs
+            Keyword arguments passed to
+            skrt.image.Image.get_foreground_comparison()
+            See this method's documentation for options.
+        """
+        return self.fixed_image.get_comparison(
+                self.get_foreground_image(step, force), **kwargs)
+
     def get_mutual_information(self, step=-1, force=False, **kwargs):
         """
         For fixed image and transformed moving image after step,
         calculate mutual information or a variant.
         after step.
 
         **Parameters:**
@@ -1647,82 +1693,91 @@
             Keyword arguments passed to
             skrt.image.Image.get_mutual_information()
             See this method's documentation for options.
         """
         return self.fixed_image.get_mutual_information(
                 self.get_transformed_image(step, force), **kwargs)
 
-    def get_relative_structural_content(self, step=-1, force=False, **kwargs):
+    def get_quality(self, step=-1, force=False, metrics=None):
+        """
+        Evaluate quality relative to fixed image of transformed moving image
+        after step.
+
+        For information on quality metrics, see documentation of
+        skrt.image.Image.get_quality().
+
+        **Parameters:**
+        step : int/str/list, default=None
+            Name or number of the registration step after which relative
+            structure content is to be calculated. Available steps are
+            listed in self.steps.
+
+        force : bool, default=False
+            If True, transformation of the moving image will be
+            forced, even if the image was transformed previously.
+
+        metrics: list, default=None
+            List of strings specifying quality metrics to be evaluated.
+            If None, all defined quality metrics are evaluated.
+        """
+        return self.get_transformed_image(
+                step, force).get_quality(self.fixed_image, metrics)
+
+    def get_relative_structural_content(self, step=-1, force=False):
         """
         Quantify structural content relative to fixed image of
         transformed moving image after step.
 
         **Parameters:**
         step : int/str/list, default=None
             Name or number of the registration step after which relative
             structure content is to be calculated. Available steps are
             listed in self.steps.
 
         force : bool, default=False
             If True, transformation of the moving image will be
             forced, even if the image was transformed previously.
-
-        **kwargs
-            Keyword arguments passed to
-            skrt.image.Image.get_relative_structural_content()
-            See this method's documentation for options.
         """
         return self.get_transformed_image(
-                step, force).get_relative_structural_content(
-                        self.fixed_image, **kwargs)
+                step, force).get_relative_structural_content(self.fixed_image)
 
-    def get_fidelity(self, step=-1, force=False, **kwargs):
+    def get_fidelity(self, step=-1, force=False):
         """
         Calculate fidelity with which transformed moving image after step
         matches fixed image.
 
         **Parameters:**
         step : int/str/list, default=None
             Name or number of the registration step after which fidelity
             is to be calculated. Available steps are listed in self.steps.
 
         force : bool, default=False
             If True, transformation of the moving image will be
             forced, even if the image was transformed previously.
-
-        **kwargs
-            Keyword arguments passed to
-            skrt.image.Image.get_relative_structural_content()
-            See this method's documentation for options.
         """
         return self.get_transformed_image(
-                step, force).get_fidelity(self.fixed_image, **kwargs)
+                step, force).get_fidelity(self.fixed_image)
 
-    def get_correlation_quality(self, step=-1, force=False, **kwargs):
+    def get_correlation_quality(self, step=-1, force=False):
         """
         Calculate quality of correlation between transformed moving image
         after step and fixed image.
 
         **Parameters:**
         step : int/str/list, default=None
             Name or number of the registration step after which correlation
             quality is to be calculated. Available steps are listed
             in self.steps.
 
         force : bool, default=False
             If True, transformation of the moving image will be
             forced, even if the image was transformed previously.
-
-        **kwargs
-            Keyword arguments passed to
-            skrt.image.Image.get_relative_structural_content()
-            See this method's documentation for options.
         """
         return self.get_transformed_image(
-                step, force).get_correlation_quality(self.fixed_image, **kwargs)
+                step, force).get_correlation_quality(self.fixed_image)
 
 class Grid(ImageOverlay):
     """
     Class representating a grid.
 
     This is the same as the ImageOverlay class, but sets different
     attribute values at instantiation.
```

### Comparing `scikit-rt-0.4.5/src/skrt/segmentation.py` & `scikit-rt-0.4.6/src/skrt/segmentation.py`

 * *Files 20% similar despite different names*

```diff
@@ -47,22 +47,26 @@
 """
 
 from concurrent.futures import ThreadPoolExecutor
 from copy import deepcopy
 from inspect import signature
 from itertools import combinations
 from pathlib import Path
+import random
 from shutil import rmtree
 
 import pandas as pd
 
 from skrt.core import (
         Data, Defaults, get_dict_permutations, get_logger, get_stat_functions,
         is_list, tic, toc)
-from skrt.image import Image, match_images
+from skrt.image import (
+        Image, get_mi_metrics, get_quality_metrics, match_images,
+        match_images_for_comparison)
+from skrt.patient import Patient
 from skrt.structures import (
         StructureSet,
         get_by_slice_methods, get_comparison_metrics, get_consensus_types)
 from skrt.registration import Registration, engines
 
 class MultiAtlasSegmentation(Data):
     def __init__(
@@ -818,19 +822,14 @@
             roi_names = sorted([key
                 for key in self.registrations[strategy][step]])
             roi_name = get_option(roi_name, None, roi_names)
             return self.registrations[strategy][step][roi_name]
         else:
             return self.registrations[strategy][step]
 
-    def get_mutual_information(self, strategy=None, step=None, roi_name=None,
-            reg_step=None, force=False, **kwargs):
-        reg = self.get_registration(strategy, step, roi_name, force)
-        return reg.get_mutual_information(reg_step, **kwargs)
-
     def get_segmentation(self, strategy=None, step=None, reg_step=None,
             force=False):
         strategy = get_strategy(strategy, self.default_strategy,
                                 self.engine, self.engine_dir)
         step = get_option(step, self.default_step, self.steps)
         self.segment(strategy, step, force)
         segmentations = self.segmentations[strategy][step]
@@ -882,46 +881,28 @@
         return steps
 
     def get_comparison(
             self, id1=None, id2=None, to_keep=None, strategies=None,
             steps=None, reg_steps=None, force=False, metrics=None,
             slice_stats=None, default_by_slice=None, 
             voxel_size=None, name_as_index=False,
-            mi_variants=None, mi_init=False, mi_reg_step=False, **kwargs):
+            **kwargs):
 
         if not hasattr(self, "ss1_filtered"):
             return
 
         strategies = get_options(
                 strategies, self.default_strategy, self.strategies)
         steps = get_options(
                 steps, self.default_step, self.steps)
         metrics = get_options(metrics, self.metrics, get_comparison_metrics())
         slice_stats = slice_stats or self.default_slice_stats
         default_by_slice = get_option(default_by_slice, self.default_by_slice,
                                       get_by_slice_methods())
 
-        if mi_variants is None:
-            mi_variants = ["mi"]
-        elif isinstance(mi_variants, str):
-            mi_variants = [mi_variants]
-        elif not mi_variants:
-            mi_variants = []
-
-        mi_parameters = list(signature(Image.get_mutual_information).parameters)
-        comparison_parameters = list(signature(
-            SingleAtlasSegmentation.get_comparison).parameters)
-        mi_kwargs = {}
-        comparison_kwargs = {}
-        for key, value in kwargs.items():
-            if key in mi_parameters:
-                mi_kwargs[key] = value
-            else:
-                comparison_kwargs[key] = value
-
         df = None
         ss1 = self.ss1_filtered.filtered_copy(to_keep=to_keep)
         ss1.set_image(self.im1, add_to_image=False)
         for strategy in strategies:
             method = kwargs.get("method", None)
             if method is None:
                 kwargs["method"] = "mask" if "pull" == strategy else "contour"
@@ -933,43 +914,26 @@
                     ss2 = (self.get_segmentation(strategy, step, reg_step)
                            .filtered_copy(to_keep=to_keep))
 
                     df_tmp = ss1.get_comparison(
                             ss2, metrics=metrics, slice_stats=slice_stats,
                             default_by_slice=default_by_slice,
                             voxel_size=voxel_size, name_as_index=name_as_index,
-                            **comparison_kwargs)
+                            **kwargs)
 
                     if df_tmp is None:
                         continue
 
                     for label, value in [
                             ("id1", id1), ("id2", id2), ("strategy", strategy),
                             ("step", step), ("reg_step", reg_step)]:
                         if value is not None:
                             df_tmp[label] = pd.Series(
                                     df_tmp.shape[0] * [value])
 
-                    if mi_init:
-                        for mi_variant in mi_variants:
-                            mi_kwargs["variant"] = mi_variant
-                            mi = self.get_mutual_information(
-                                    strategy, 0, None, 0, **mi_kwargs)
-                            df_tmp[f"{mi_variant}_init"] = pd.Series(
-                                    df_tmp.shape[0] * [mi])
-
-                    if mi_reg_step:
-                        for mi_variant in mi_variants:
-                            mi_kwargs["variant"] = mi_variant
-                            #print(df_tmp.apply(lambda row: print(row), axis=1))
-                            df_tmp[f"{mi_variant}_reg_step"] = df_tmp.apply(
-                                    lambda row: self.get_mutual_information(
-                                        strategy, step, row["ROI"], reg_step,
-                                        **mi_kwargs), axis=1)
-
                     if df is None:
                         df = df_tmp
                     else:
                         df = pd.concat([df, df_tmp], ignore_index=True)
 
         return df
 
@@ -1023,14 +987,264 @@
     """Return Image cloned from <im>; return None if <im> is None."""
     return (im if im is None else Image(im))
 
 def ensure_structure_set(ss):
     """Return StructureSet cloned from <im>; return None if <im> is None."""
     return (ss if ss is None else StructureSet(ss))
 
+def get_atlases(paths, subtypes=None, subdirs=None, roi_names=None,
+                structure_set_index=None, unsorted_dicom=True, max_atlas=None):
+    """
+    Obtain dictionary of atlas tuples (structure set and associated image).
+
+    By default, all structure sets in each dataset are considered, in
+    reverse order of timestamp, and the first structure set with an
+    associated image is accepted.  It's possible to consider only
+    a specified structure set, or only structure sets that include specified
+    ROIs.
+
+    In the dictionary returned, keys are identifiers, and values are
+    tuples of the form (skrt.image.Image, skrt.structures.StructureSet).
+
+    **Parameters:**
+
+    paths: str/pathlib.Path/list
+        Path, or list of paths, to patient datasets to be considered as atlases.
+
+    subtypes: 
+        String, or list of strings, identifying subtype(s) of
+        imaging modality, for example "ct", "mr", "us", to be considered
+        as atlases.  If None, all imaging modalities are considered.
+
+    subdirs : str/list, default=None
+        Subdirectory, or list of subdirectories, grouping studies.
+        If specified, only studies in this subdirectory, or
+        in these subdirectories, are considered.  Disregarded if
+        unsorted_dicom is True.
+
+    structure_set_index: int, default=None
+        Index, across all studies, of the structure set to be considered.
+        If None, each structure set is considered, in reverse order
+        of timestamp.  Setting the index to be different from None can
+        be useful if, for example, only the earliest structure set
+        (index 0), or only the most-recent structure set (index -1),
+        should be considered.
+
+    unsorted_dicom: bool, default=True
+        If False, assume that data in a patient dataset are organised
+        according to the VoxTox model.  If True, don't assume any particular
+        organisation, and create data hierarchy based on information
+        read from DICOM files.
+
+    max_atlas: int, default=None
+        Maximum number of atlases to be returned.  If None, there is
+        no maximum.
+    """
+    logger = get_logger(identifier="funcName")
+
+    # If single path given as input, convert to a single-element list.
+    if isinstance(paths, (str, Path)):
+        paths = [paths]
+
+    # Ensure value set for maximum number of atlases to be returned.
+    if max_atlas is None:
+        max_atlas = len(paths)
+
+    # Disallow study subdirectories for unsorted data.
+    if unsorted_dicom:
+        subdirs = None
+
+    # Create dictionary of atlas tuples.
+    atlases = {}
+    for path in paths:
+        if len(atlases) >= max_atlas:
+            break
+
+        # Read dataset.
+        logger.info(f"Reading atlas dataset from: '{path}'")
+        atlas = Patient(path, unsorted_dicom=unsorted_dicom)
+
+        # Load structure sets.
+        structure_sets = atlas.get_structure_sets(subtypes, subdirs)
+
+        # Consider only structure set identified by a particular index.
+        if structure_set_index is not None:
+            try:
+                structure_sets = [structure_sets[structure_set_index]]
+            except IndexError:
+                structure_sets = []
+
+        # Intialise atlas image and structure set.
+        im_atlas = None
+        ss_atlas = None
+
+        # Consider structure sets in order of timestamp,
+        # starting from most recent.
+        for structure_set in reversed(structure_sets):
+            # Disregard structure set if it doesn't have an associated image.
+            im_atlas = structure_set.get_image()
+            if im_atlas is None:
+                continue
+
+            # Disregard structure set if it doesn't contain specified ROIs.
+            if roi_names:
+                ss_atlas = structure_set.filtered_copy(
+                        names=roi_names, keep_renamed_only=True,
+                        copy_roi_data=False)
+                if len(ss_atlas.get_roi_names()) != len(roi_names):
+                    ss_atlas = None
+            else:
+                ss_atlas = structure_set
+
+            if ss_atlas is not None:
+                break
+
+        # Add entry to atlas dictionary.
+        if im_atlas is not None and ss_atlas is not None:
+            atlases[atlas.id] = (im_atlas, ss_atlas)
+
+    return atlases
+
+def select_atlases(atlases, target=None, n_atlas=None, exclude_ids=None,
+                   selection=None, high_to_low=True, alignment=None,
+                   **kwargs):
+    """
+    Select atlases to register against target.
+
+    **Parameters:**
+    atlases: dict
+        Dictionary of atlas tuples (structure set and associated image),
+        such as returned by skrt.segmentation.get_atlases().
+
+    target: skrt.image.Image, default=None
+        Image against which to register.  When selection ordering
+        isn't based on a comparison metric, this can be None.
+
+    n_atlas: int, default=None
+        Number of atlases to select, from those given as input.  If None,
+        all input atlases are returned, ordered according to selection.
+
+    exclude_ids: list, default=None
+        List of atlas identifiers to be excluded from selection.  This may
+        be used, for example, if the target image is also an atlas,
+        and self-registration isn't wanted.  If None, no atlases are
+        excluded.
+
+    selection: str/None, default=None
+        Ordering to be performed prior to selecting the first
+        <n_atlas> atlases:
+
+        - None: the input order is retained;
+
+        - "random": atlases are ordered randomly;
+
+        - "sorted": atlases are sorted in alphabetic order of identifier;
+
+        - "reverse_sorted": atlases are sorted in reverse alphabetic order
+          of identifier;
+
+        - image-comparison metric: atlases are compared with the target,
+          and are ordered according to the specified image-comparison metric.
+          Possibilities include "mutual-information",
+          "information quality ratio", "fidelity"  For a list of available
+          metrics, see documentation for skrt.image.Image.get_comparison().
+
+        - foreground-comparison metric: atlas foregrounds are compared with
+          the target foreground and are ordered according to the specified
+          foreground-comparison metric.  Possibilities include "dice",
+          "centroid", "volume_ratio".  For a list of available metrics,
+          see documentation for skrt.structures.ROI.get_comparison().
+          
+    high_to_low: bool, default=True
+        When ordering for selection is based on a comparison metric,
+        the ordering is from high to low if high_to_low is True, or
+        otherwise is from low to high.
+
+    alignment: tuple/dict/str, default=None
+        Strategy to be used for aligning atlases and target when
+        comparing them.  For strategy details, see documentation of
+        skrt.image.get_alignment_translation().  The value set is
+        passed to skrt.image.match_images_for_comparison(), to match
+        atlas and target prior to evaluation of a comparison metric.
+        Disregarded when ordering for selection isn't based on
+        a comparison metric.
+
+    kwargs: dict
+        Keyword arguments passed to comparison methods:
+        skrt.image.get_comparison() or skrt.image.get_foreground_comparison(),
+        depending on selection specified.
+    """
+    # If no constraints defined, return input atlases.
+    if n_atlas is None and exclude_ids is None and selection is None:
+        return atlases
+
+    logger = get_logger(identifier="funcName")
+
+    # Check that specified selection is allowed.
+    metric_independent_selections = [None, "random", "sorted", "reverse_sorted"]
+    allowed_selections = (metric_independent_selections + get_mi_metrics()
+                          + get_quality_metrics() + get_comparison_metrics())
+    if selection not in allowed_selections:
+        raise RuntimeError(f"Selection {selection} not allowed; "
+                           f"allowed selections: {allowed_selections}")
+
+    # Create list of non-excluded identifiers.
+    if exclude_ids:
+        if not is_list(exclude_ids):
+            exclude_ids = [exclude_ids]
+        atlas_ids = [atlas_id for atlas_id in atlases
+                     if atlas_id not in exclude_ids]
+    else:
+        atlas_ids = list(atlases)
+
+    # Check number of atlases against request.
+    n_atlas = n_atlas if n_atlas is not None else len(atlas_ids)
+    if n_atlas > len(atlas_ids):
+        raise RuntimeError(f"Requested selection of {n_atlas} atlases, "
+                           f"but only {len(atlas_ids)} atlases "
+                           f"after exclusions: {atlas_ids}")
+
+    # Deal with selections not requiring metric evaluations.
+    if selection in metric_independent_selections:
+        if "random" == selection:
+            atlas_ids = random.sample(atlas_ids, n_atlas)
+        elif "sorted" == selection:
+            atlas_ids.sort()
+        elif "reverse_sorted" == selection:
+            atlas_ids.sort(reverse=True)
+        return {atlas_id: atlases[atlas_id] for atlas_id in atlas_ids}
+
+    # Determine type of comparison to be performed for selection.
+    if selection in get_image_comparison_metrics():
+        comparison_method = "get_comparison"
+    else:
+        comparison_method = "get_foreground_comparison"
+    kwargs["metrics"] = [selection]
+
+    # Obtain comparison scores.
+    scores = {}
+    for atlas_id in list(atlas_ids):
+        im1, im2 = match_images_for_comparison(
+            target, atlases[atlas_id][0], alignment=alignment)
+        df = getattr(im1, comparison_method)(im2, **kwargs)
+        score = df.iloc[0][selection]
+        # Save list of atlas identifiers for each score.
+        if score not in scores:
+            scores[score] = []
+        scores[score].append(atlas_id)
+
+    # Sort scores, from high to low or from low to high,
+    # then loop through to select the requested number of atlases.
+    selected_atlases = {}
+    for score, atlas_ids in sorted(scores.items(), reverse=high_to_low):
+        for atlas_id in atlas_ids:
+            selected_atlases[atlas_id] = atlases[atlas_id]
+            if len(selected_atlases) >= n_atlas:
+                return selected_atlases
+
 def get_contour_propagation_strategies(engine=None, engine_dir=None):
     """
     Return list of contour propagation strategies for registration engine.
 
     engine: str, default=None
         String identifying registration engine, corresponding to
         a key of the dictionary skrt.registration.engines.
```

### Comparing `scikit-rt-0.4.5/src/skrt/simulation.py` & `scikit-rt-0.4.6/src/skrt/simulation.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/src/skrt/structures.py` & `scikit-rt-0.4.6/src/skrt/structures.py`

 * *Files 1% similar despite different names*

```diff
@@ -9,21930 +9,22011 @@
 00000080: 2069 6d70 6f72 7420 6472 6177 0a66 726f   import draw.fro
 00000090: 6d20 7368 6170 656c 7920 696d 706f 7274  m shapely import
 000000a0: 2061 6666 696e 6974 790a 6672 6f6d 2073   affinity.from s
 000000b0: 6861 7065 6c79 2069 6d70 6f72 7420 6765  hapely import ge
 000000c0: 6f6d 6574 7279 0a66 726f 6d20 7368 6170  ometry.from shap
 000000d0: 656c 7920 696d 706f 7274 206f 7073 0a69  ely import ops.i
 000000e0: 6d70 6f72 7420 666e 6d61 7463 680a 696d  mport fnmatch.im
-000000f0: 706f 7274 206d 6174 706c 6f74 6c69 622e  port matplotlib.
-00000100: 636d 0a69 6d70 6f72 7420 6d61 7470 6c6f  cm.import matplo
-00000110: 746c 6962 2e63 6f6c 6f72 730a 696d 706f  tlib.colors.impo
-00000120: 7274 206d 6174 706c 6f74 6c69 622e 7061  rt matplotlib.pa
-00000130: 7463 6865 7320 6173 206d 7061 7463 6865  tches as mpatche
-00000140: 730a 696d 706f 7274 206d 6174 706c 6f74  s.import matplot
-00000150: 6c69 622e 7079 706c 6f74 2061 7320 706c  lib.pyplot as pl
-00000160: 740a 6672 6f6d 206d 6174 706c 6f74 6c69  t.from matplotli
-00000170: 6220 696d 706f 7274 2064 6566 6175 6c74  b import default
-00000180: 5061 7261 6d73 0a69 6d70 6f72 7420 6e75  Params.import nu
-00000190: 6d70 7920 6173 206e 700a 696d 706f 7274  mpy as np.import
-000001a0: 206f 730a 696d 706f 7274 2070 616e 6461   os.import panda
-000001b0: 7320 6173 2070 640a 696d 706f 7274 2070  s as pd.import p
-000001c0: 7964 6963 6f6d 0a69 6d70 6f72 7420 7265  ydicom.import re
-000001d0: 0a69 6d70 6f72 7420 7368 7574 696c 0a69  .import shutil.i
-000001e0: 6d70 6f72 7420 736b 696d 6167 652e 6d65  mport skimage.me
-000001f0: 6173 7572 650a 696d 706f 7274 2074 696d  asure.import tim
-00000200: 650a 696d 706f 7274 2077 6172 6e69 6e67  e.import warning
-00000210: 730a 0a69 6d70 6f72 7420 736b 7274 2e63  s..import skrt.c
-00000220: 6f72 650a 696d 706f 7274 2073 6b72 742e  ore.import skrt.
-00000230: 696d 6167 650a 6672 6f6d 2073 6b72 742e  image.from skrt.
-00000240: 6469 636f 6d5f 7772 6974 6572 2069 6d70  dicom_writer imp
-00000250: 6f72 7420 4469 636f 6d57 7269 7465 720a  ort DicomWriter.
-00000260: 0a23 2053 6574 2067 6c6f 6261 6c20 6465  .# Set global de
-00000270: 6661 756c 7473 2e0a 736b 7274 2e63 6f72  faults..skrt.cor
-00000280: 652e 4465 6661 756c 7473 287b 2262 795f  e.Defaults({"by_
-00000290: 736c 6963 6522 3a20 2275 6e69 6f6e 227d  slice": "union"}
-000002a0: 290a 736b 7274 2e63 6f72 652e 4465 6661  ).skrt.core.Defa
-000002b0: 756c 7473 287b 2273 6c69 6365 5f73 7461  ults({"slice_sta
-000002c0: 7473 223a 205b 226d 6561 6e22 5d7d 290a  ts": ["mean"]}).
-000002d0: 0a63 6c61 7373 2052 4f49 4465 6661 756c  .class ROIDefaul
-000002e0: 7473 3a0a 2020 2020 2222 2253 696e 676c  ts:.    """Singl
-000002f0: 6574 6f6e 2063 6c61 7373 2066 6f72 2061  eton class for a
-00000300: 7373 6967 6e69 6e67 2064 6566 6175 6c74  ssigning default
-00000310: 2052 4f49 206e 616d 6573 2061 6e64 2063   ROI names and c
-00000320: 6f6c 6f75 7273 2e22 2222 0a0a 2020 2020  olours."""..    
-00000330: 2320 4465 6669 6e65 2074 6865 2073 696e  # Define the sin
-00000340: 676c 6520 696e 7374 616e 6365 2061 7320  gle instance as 
-00000350: 6120 636c 6173 7320 6174 7472 6962 7574  a class attribut
-00000360: 650a 2020 2020 696e 7374 616e 6365 203d  e.    instance =
-00000370: 204e 6f6e 650a 0a20 2020 2023 2043 7265   None..    # Cre
-00000380: 6174 6520 7369 6e67 6c65 2069 6e73 7461  ate single insta
-00000390: 6e63 6520 696e 2069 6e6e 6572 2063 6c61  nce in inner cla
-000003a0: 7373 0a20 2020 2063 6c61 7373 205f 5f52  ss.    class __R
-000003b0: 4f49 4465 6661 756c 7473 3a0a 2020 2020  OIDefaults:.    
-000003c0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-000003d0: 2873 656c 6629 3a0a 0a20 2020 2020 2020  (self):..       
-000003e0: 2020 2020 2073 656c 662e 6e5f 726f 6973       self.n_rois
-000003f0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-00000400: 2073 656c 662e 6e5f 7374 7275 6374 7572   self.n_structur
-00000410: 655f 7365 7473 203d 2030 0a20 2020 2020  e_sets = 0.     
-00000420: 2020 2020 2020 2073 656c 662e 6e5f 636f         self.n_co
-00000430: 6c6f 7273 5f75 7365 6420 3d20 300a 0a20  lors_used = 0.. 
-00000440: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00000450: 636f 6c6f 7273 203d 2028 0a20 2020 2020  colors = (.     
-00000460: 2020 2020 2020 2020 2020 206c 6973 7428             list(
-00000470: 6d61 7470 6c6f 746c 6962 2e63 6d2e 5365  matplotlib.cm.Se
-00000480: 7431 2e63 6f6c 6f72 7329 5b3a 2d31 5d0a  t1.colors)[:-1].
-00000490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000004a0: 2b20 6c69 7374 286d 6174 706c 6f74 6c69  + list(matplotli
-000004b0: 622e 636d 2e53 6574 322e 636f 6c6f 7273  b.cm.Set2.colors
-000004c0: 295b 3a2d 315d 0a20 2020 2020 2020 2020  )[:-1].         
-000004d0: 2020 2020 2020 202b 206c 6973 7428 6d61         + list(ma
-000004e0: 7470 6c6f 746c 6962 2e63 6d2e 5365 7433  tplotlib.cm.Set3
-000004f0: 2e63 6f6c 6f72 7329 0a20 2020 2020 2020  .colors).       
-00000500: 2020 2020 2020 2020 202b 206c 6973 7428           + list(
-00000510: 6d61 7470 6c6f 746c 6962 2e63 6d2e 7461  matplotlib.cm.ta
-00000520: 6232 302e 636f 6c6f 7273 290a 2020 2020  b20.colors).    
-00000530: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00000540: 2020 2020 2020 666f 7220 6920 696e 205b        for i in [
-00000550: 392c 2031 305d 3a20 2023 2052 656d 6f76  9, 10]:  # Remov
-00000560: 6520 6772 6579 730a 2020 2020 2020 2020  e greys.        
-00000570: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
-00000580: 2e63 6f6c 6f72 735b 695d 0a0a 2020 2020  .colors[i]..    
-00000590: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-000005a0: 662c 2072 6573 6574 3d46 616c 7365 293a  f, reset=False):
-000005b0: 0a20 2020 2020 2020 2022 2222 436f 6e73  .        """Cons
-000005c0: 7472 7563 746f 7220 6f66 2052 4f49 4465  tructor of ROIDe
-000005d0: 6661 756c 7473 2073 696e 676c 6574 6f6e  faults singleton
-000005e0: 2063 6c61 7373 2e22 2222 0a0a 2020 2020   class."""..    
-000005f0: 2020 2020 6966 206e 6f74 2052 4f49 4465      if not ROIDe
-00000600: 6661 756c 7473 2e69 6e73 7461 6e63 653a  faults.instance:
-00000610: 0a20 2020 2020 2020 2020 2020 2052 4f49  .            ROI
-00000620: 4465 6661 756c 7473 2e69 6e73 7461 6e63  Defaults.instanc
-00000630: 6520 3d20 524f 4944 6566 6175 6c74 732e  e = ROIDefaults.
-00000640: 5f5f 524f 4944 6566 6175 6c74 7328 290a  __ROIDefaults().
-00000650: 2020 2020 2020 2020 656c 6966 2072 6573          elif res
-00000660: 6574 3a0a 2020 2020 2020 2020 2020 2020  et:.            
-00000670: 524f 4944 6566 6175 6c74 732e 696e 7374  ROIDefaults.inst
-00000680: 616e 6365 2e5f 5f69 6e69 745f 5f28 290a  ance.__init__().
-00000690: 0a20 2020 2064 6566 2067 6574 5f64 6566  .    def get_def
-000006a0: 6175 6c74 5f72 6f69 5f6e 616d 6528 7365  ault_roi_name(se
-000006b0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-000006c0: 4765 7420 6120 6465 6661 756c 7420 6e61  Get a default na
-000006d0: 6d65 2066 6f72 2061 6e20 524f 492e 2222  me for an ROI.""
-000006e0: 220a 0a20 2020 2020 2020 2052 4f49 4465  "..        ROIDe
-000006f0: 6661 756c 7473 2e69 6e73 7461 6e63 652e  faults.instance.
-00000700: 6e5f 726f 6973 202b 3d20 310a 2020 2020  n_rois += 1.    
-00000710: 2020 2020 7265 7475 726e 2066 2252 4f49      return f"ROI
-00000720: 207b 524f 4944 6566 6175 6c74 732e 696e   {ROIDefaults.in
-00000730: 7374 616e 6365 2e6e 5f72 6f69 737d 220a  stance.n_rois}".
-00000740: 0a20 2020 2064 6566 2067 6574 5f64 6566  .    def get_def
-00000750: 6175 6c74 5f72 6f69 5f63 6f6c 6f72 2873  ault_roi_color(s
-00000760: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00000770: 2247 6574 2061 2064 6566 6175 6c74 2072  "Get a default r
-00000780: 6f69 2063 6f6c 6f72 2e22 2222 0a0a 2020  oi color."""..  
-00000790: 2020 2020 2020 6966 2052 4f49 4465 6661        if ROIDefa
-000007a0: 756c 7473 2e69 6e73 7461 6e63 652e 6e5f  ults.instance.n_
-000007b0: 636f 6c6f 7273 5f75 7365 6420 3e3d 206c  colors_used >= l
-000007c0: 656e 2852 4f49 4465 6661 756c 7473 2e69  en(ROIDefaults.i
-000007d0: 6e73 7461 6e63 652e 636f 6c6f 7273 293a  nstance.colors):
-000007e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000007f0: 7572 6e20 6e70 2e72 616e 646f 6d2e 7261  urn np.random.ra
-00000800: 6e64 2833 290a 2020 2020 2020 2020 636f  nd(3).        co
-00000810: 6c6f 7220 3d20 524f 4944 6566 6175 6c74  lor = ROIDefault
-00000820: 732e 696e 7374 616e 6365 2e63 6f6c 6f72  s.instance.color
-00000830: 735b 524f 4944 6566 6175 6c74 732e 696e  s[ROIDefaults.in
-00000840: 7374 616e 6365 2e6e 5f63 6f6c 6f72 735f  stance.n_colors_
-00000850: 7573 6564 5d0a 2020 2020 2020 2020 524f  used].        RO
+000000f0: 706f 7274 206c 6f67 6769 6e67 0a69 6d70  port logging.imp
+00000100: 6f72 7420 6d61 7470 6c6f 746c 6962 2e63  ort matplotlib.c
+00000110: 6d0a 696d 706f 7274 206d 6174 706c 6f74  m.import matplot
+00000120: 6c69 622e 636f 6c6f 7273 0a69 6d70 6f72  lib.colors.impor
+00000130: 7420 6d61 7470 6c6f 746c 6962 2e70 6174  t matplotlib.pat
+00000140: 6368 6573 2061 7320 6d70 6174 6368 6573  ches as mpatches
+00000150: 0a69 6d70 6f72 7420 6d61 7470 6c6f 746c  .import matplotl
+00000160: 6962 2e70 7970 6c6f 7420 6173 2070 6c74  ib.pyplot as plt
+00000170: 0a66 726f 6d20 6d61 7470 6c6f 746c 6962  .from matplotlib
+00000180: 2069 6d70 6f72 7420 6465 6661 756c 7450   import defaultP
+00000190: 6172 616d 730a 696d 706f 7274 206e 756d  arams.import num
+000001a0: 7079 2061 7320 6e70 0a69 6d70 6f72 7420  py as np.import 
+000001b0: 6f73 0a69 6d70 6f72 7420 7061 6e64 6173  os.import pandas
+000001c0: 2061 7320 7064 0a69 6d70 6f72 7420 7079   as pd.import py
+000001d0: 6469 636f 6d0a 696d 706f 7274 2072 650a  dicom.import re.
+000001e0: 696d 706f 7274 2073 6875 7469 6c0a 696d  import shutil.im
+000001f0: 706f 7274 2073 6b69 6d61 6765 2e6d 6561  port skimage.mea
+00000200: 7375 7265 0a69 6d70 6f72 7420 7469 6d65  sure.import time
+00000210: 0a69 6d70 6f72 7420 7761 726e 696e 6773  .import warnings
+00000220: 0a0a 696d 706f 7274 2073 6b72 742e 636f  ..import skrt.co
+00000230: 7265 0a69 6d70 6f72 7420 736b 7274 2e69  re.import skrt.i
+00000240: 6d61 6765 0a66 726f 6d20 736b 7274 2e64  mage.from skrt.d
+00000250: 6963 6f6d 5f77 7269 7465 7220 696d 706f  icom_writer impo
+00000260: 7274 2044 6963 6f6d 5772 6974 6572 0a0a  rt DicomWriter..
+00000270: 2320 5365 7420 676c 6f62 616c 2064 6566  # Set global def
+00000280: 6175 6c74 732e 0a73 6b72 742e 636f 7265  aults..skrt.core
+00000290: 2e44 6566 6175 6c74 7328 7b22 6279 5f73  .Defaults({"by_s
+000002a0: 6c69 6365 223a 2022 756e 696f 6e22 7d29  lice": "union"})
+000002b0: 0a73 6b72 742e 636f 7265 2e44 6566 6175  .skrt.core.Defau
+000002c0: 6c74 7328 7b22 736c 6963 655f 7374 6174  lts({"slice_stat
+000002d0: 7322 3a20 5b22 6d65 616e 225d 7d29 0a73  s": ["mean"]}).s
+000002e0: 6b72 742e 636f 7265 2e44 6566 6175 6c74  krt.core.Default
+000002f0: 7328 7b22 7368 6170 656c 795f 6c6f 675f  s({"shapely_log_
+00000300: 6c65 7665 6c22 3a20 6c6f 6767 696e 672e  level": logging.
+00000310: 4552 524f 527d 290a 0a63 6c61 7373 2052  ERROR})..class R
+00000320: 4f49 4465 6661 756c 7473 3a0a 2020 2020  OIDefaults:.    
+00000330: 2222 2253 696e 676c 6574 6f6e 2063 6c61  """Singleton cla
+00000340: 7373 2066 6f72 2061 7373 6967 6e69 6e67  ss for assigning
+00000350: 2064 6566 6175 6c74 2052 4f49 206e 616d   default ROI nam
+00000360: 6573 2061 6e64 2063 6f6c 6f75 7273 2e22  es and colours."
+00000370: 2222 0a0a 2020 2020 2320 4465 6669 6e65  ""..    # Define
+00000380: 2074 6865 2073 696e 676c 6520 696e 7374   the single inst
+00000390: 616e 6365 2061 7320 6120 636c 6173 7320  ance as a class 
+000003a0: 6174 7472 6962 7574 650a 2020 2020 696e  attribute.    in
+000003b0: 7374 616e 6365 203d 204e 6f6e 650a 0a20  stance = None.. 
+000003c0: 2020 2023 2043 7265 6174 6520 7369 6e67     # Create sing
+000003d0: 6c65 2069 6e73 7461 6e63 6520 696e 2069  le instance in i
+000003e0: 6e6e 6572 2063 6c61 7373 0a20 2020 2063  nner class.    c
+000003f0: 6c61 7373 205f 5f52 4f49 4465 6661 756c  lass __ROIDefaul
+00000400: 7473 3a0a 2020 2020 2020 2020 6465 6620  ts:.        def 
+00000410: 5f5f 696e 6974 5f5f 2873 656c 6629 3a0a  __init__(self):.
+00000420: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00000430: 662e 6e5f 726f 6973 203d 2030 0a20 2020  f.n_rois = 0.   
+00000440: 2020 2020 2020 2020 2073 656c 662e 6e5f           self.n_
+00000450: 7374 7275 6374 7572 655f 7365 7473 203d  structure_sets =
+00000460: 2030 0a20 2020 2020 2020 2020 2020 2073   0.            s
+00000470: 656c 662e 6e5f 636f 6c6f 7273 5f75 7365  elf.n_colors_use
+00000480: 6420 3d20 300a 0a20 2020 2020 2020 2020  d = 0..         
+00000490: 2020 2073 656c 662e 636f 6c6f 7273 203d     self.colors =
+000004a0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+000004b0: 2020 206c 6973 7428 6d61 7470 6c6f 746c     list(matplotl
+000004c0: 6962 2e63 6d2e 5365 7431 2e63 6f6c 6f72  ib.cm.Set1.color
+000004d0: 7329 5b3a 2d31 5d0a 2020 2020 2020 2020  s)[:-1].        
+000004e0: 2020 2020 2020 2020 2b20 6c69 7374 286d          + list(m
+000004f0: 6174 706c 6f74 6c69 622e 636d 2e53 6574  atplotlib.cm.Set
+00000500: 322e 636f 6c6f 7273 295b 3a2d 315d 0a20  2.colors)[:-1]. 
+00000510: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00000520: 206c 6973 7428 6d61 7470 6c6f 746c 6962   list(matplotlib
+00000530: 2e63 6d2e 5365 7433 2e63 6f6c 6f72 7329  .cm.Set3.colors)
+00000540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000550: 202b 206c 6973 7428 6d61 7470 6c6f 746c   + list(matplotl
+00000560: 6962 2e63 6d2e 7461 6232 302e 636f 6c6f  ib.cm.tab20.colo
+00000570: 7273 290a 2020 2020 2020 2020 2020 2020  rs).            
+00000580: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+00000590: 7220 6920 696e 205b 392c 2031 305d 3a20  r i in [9, 10]: 
+000005a0: 2023 2052 656d 6f76 6520 6772 6579 730a   # Remove greys.
+000005b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000005c0: 6465 6c20 7365 6c66 2e63 6f6c 6f72 735b  del self.colors[
+000005d0: 695d 0a0a 2020 2020 6465 6620 5f5f 696e  i]..    def __in
+000005e0: 6974 5f5f 2873 656c 662c 2072 6573 6574  it__(self, reset
+000005f0: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+00000600: 2022 2222 436f 6e73 7472 7563 746f 7220   """Constructor 
+00000610: 6f66 2052 4f49 4465 6661 756c 7473 2073  of ROIDefaults s
+00000620: 696e 676c 6574 6f6e 2063 6c61 7373 2e22  ingleton class."
+00000630: 2222 0a0a 2020 2020 2020 2020 6966 206e  ""..        if n
+00000640: 6f74 2052 4f49 4465 6661 756c 7473 2e69  ot ROIDefaults.i
+00000650: 6e73 7461 6e63 653a 0a20 2020 2020 2020  nstance:.       
+00000660: 2020 2020 2052 4f49 4465 6661 756c 7473       ROIDefaults
+00000670: 2e69 6e73 7461 6e63 6520 3d20 524f 4944  .instance = ROID
+00000680: 6566 6175 6c74 732e 5f5f 524f 4944 6566  efaults.__ROIDef
+00000690: 6175 6c74 7328 290a 2020 2020 2020 2020  aults().        
+000006a0: 656c 6966 2072 6573 6574 3a0a 2020 2020  elif reset:.    
+000006b0: 2020 2020 2020 2020 524f 4944 6566 6175          ROIDefau
+000006c0: 6c74 732e 696e 7374 616e 6365 2e5f 5f69  lts.instance.__i
+000006d0: 6e69 745f 5f28 290a 0a20 2020 2064 6566  nit__()..    def
+000006e0: 2067 6574 5f64 6566 6175 6c74 5f72 6f69   get_default_roi
+000006f0: 5f6e 616d 6528 7365 6c66 293a 0a20 2020  _name(self):.   
+00000700: 2020 2020 2022 2222 4765 7420 6120 6465       """Get a de
+00000710: 6661 756c 7420 6e61 6d65 2066 6f72 2061  fault name for a
+00000720: 6e20 524f 492e 2222 220a 0a20 2020 2020  n ROI."""..     
+00000730: 2020 2052 4f49 4465 6661 756c 7473 2e69     ROIDefaults.i
+00000740: 6e73 7461 6e63 652e 6e5f 726f 6973 202b  nstance.n_rois +
+00000750: 3d20 310a 2020 2020 2020 2020 7265 7475  = 1.        retu
+00000760: 726e 2066 2252 4f49 207b 524f 4944 6566  rn f"ROI {ROIDef
+00000770: 6175 6c74 732e 696e 7374 616e 6365 2e6e  aults.instance.n
+00000780: 5f72 6f69 737d 220a 0a20 2020 2064 6566  _rois}"..    def
+00000790: 2067 6574 5f64 6566 6175 6c74 5f72 6f69   get_default_roi
+000007a0: 5f63 6f6c 6f72 2873 656c 6629 3a0a 2020  _color(self):.  
+000007b0: 2020 2020 2020 2222 2247 6574 2061 2064        """Get a d
+000007c0: 6566 6175 6c74 2072 6f69 2063 6f6c 6f72  efault roi color
+000007d0: 2e22 2222 0a0a 2020 2020 2020 2020 6966  ."""..        if
+000007e0: 2052 4f49 4465 6661 756c 7473 2e69 6e73   ROIDefaults.ins
+000007f0: 7461 6e63 652e 6e5f 636f 6c6f 7273 5f75  tance.n_colors_u
+00000800: 7365 6420 3e3d 206c 656e 2852 4f49 4465  sed >= len(ROIDe
+00000810: 6661 756c 7473 2e69 6e73 7461 6e63 652e  faults.instance.
+00000820: 636f 6c6f 7273 293a 0a20 2020 2020 2020  colors):.       
+00000830: 2020 2020 2072 6574 7572 6e20 6e70 2e72       return np.r
+00000840: 616e 646f 6d2e 7261 6e64 2833 290a 2020  andom.rand(3).  
+00000850: 2020 2020 2020 636f 6c6f 7220 3d20 524f        color = RO
 00000860: 4944 6566 6175 6c74 732e 696e 7374 616e  IDefaults.instan
-00000870: 6365 2e6e 5f63 6f6c 6f72 735f 7573 6564  ce.n_colors_used
-00000880: 202b 3d20 310a 2020 2020 2020 2020 7265   += 1.        re
-00000890: 7475 726e 2063 6f6c 6f72 0a0a 2020 2020  turn color..    
-000008a0: 6465 6620 6765 745f 6465 6661 756c 745f  def get_default_
-000008b0: 7374 7275 6374 7572 655f 7365 745f 6e61  structure_set_na
-000008c0: 6d65 2873 656c 6629 3a0a 2020 2020 2020  me(self):.      
-000008d0: 2020 2222 2247 6574 2061 2064 6566 6175    """Get a defau
-000008e0: 6c74 206e 616d 6520 666f 7220 6120 7374  lt name for a st
-000008f0: 7275 6374 7572 6520 7365 742e 2222 220a  ructure set.""".
-00000900: 0a20 2020 2020 2020 2052 4f49 4465 6661  .        ROIDefa
-00000910: 756c 7473 2e69 6e73 7461 6e63 652e 6e5f  ults.instance.n_
-00000920: 7374 7275 6374 7572 655f 7365 7473 202b  structure_sets +
-00000930: 3d20 310a 2020 2020 2020 2020 7265 7475  = 1.        retu
-00000940: 726e 2066 2253 7472 7563 7475 7265 5365  rn f"StructureSe
-00000950: 7420 7b52 4f49 4465 6661 756c 7473 2e69  t {ROIDefaults.i
-00000960: 6e73 7461 6e63 652e 6e5f 7374 7275 6374  nstance.n_struct
-00000970: 7572 655f 7365 7473 7d22 0a0a 0a52 4f49  ure_sets}"...ROI
-00000980: 4465 6661 756c 7473 2829 0a0a 636c 6173  Defaults()..clas
-00000990: 7320 524f 4928 736b 7274 2e63 6f72 652e  s ROI(skrt.core.
-000009a0: 4172 6368 6976 6529 3a0a 2020 2020 2222  Archive):.    ""
-000009b0: 220a 2020 2020 436c 6173 7320 7265 7072  ".    Class repr
-000009c0: 6573 656e 7469 6e67 2061 2073 696e 676c  esenting a singl
-000009d0: 6520 7265 6769 6f6e 206f 6620 696e 7465  e region of inte
-000009e0: 7265 7374 2028 524f 4929 2e0a 0a20 2020  rest (ROI)...   
-000009f0: 2041 7474 7269 6275 7465 7320 6f66 2061   Attributes of a
-00000a00: 6e20 524f 4920 6f62 6a65 6374 2073 686f  n ROI object sho
-00000a10: 756c 6420 7573 7561 6c6c 7920 6265 2061  uld usually be a
-00000a20: 6363 6573 7365 6420 7669 610a 2020 2020  ccessed via.    
-00000a30: 7468 6569 7220 6765 7474 6572 206d 6574  their getter met
-00000a40: 686f 6473 2c20 7261 7468 6572 2074 6861  hods, rather tha
-00000a50: 6e20 6469 7265 6374 6c79 2c20 746f 2065  n directly, to e
-00000a60: 6e73 7572 6520 7468 6174 0a20 2020 2061  nsure that.    a
-00000a70: 7474 7269 6275 7465 2076 616c 7565 7320  ttribute values 
-00000a80: 6861 7665 2062 6565 6e20 6c6f 6164 6564  have been loaded
-00000a90: 2e0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
-00000aa0: 6566 205f 5f69 6e69 745f 5f28 0a20 2020  ef __init__(.   
-00000ab0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00000ac0: 2020 2073 6f75 7263 653d 4e6f 6e65 2c0a     source=None,.
-00000ad0: 2020 2020 2020 2020 6e61 6d65 3d4e 6f6e          name=Non
-00000ae0: 652c 0a20 2020 2020 2020 2063 6f6c 6f72  e,.        color
-00000af0: 3d4e 6f6e 652c 0a20 2020 2020 2020 206c  =None,.        l
-00000b00: 6f61 643d 5472 7565 2c0a 2020 2020 2020  oad=True,.      
-00000b10: 2020 696d 6167 653d 4e6f 6e65 2c0a 2020    image=None,.  
-00000b20: 2020 2020 2020 7368 6170 653d 4e6f 6e65        shape=None
-00000b30: 2c0a 2020 2020 2020 2020 6166 6669 6e65  ,.        affine
-00000b40: 3d4e 6f6e 652c 0a20 2020 2020 2020 2076  =None,.        v
-00000b50: 6f78 656c 5f73 697a 653d 4e6f 6e65 2c0a  oxel_size=None,.
-00000b60: 2020 2020 2020 2020 6f72 6967 696e 3d4e          origin=N
-00000b70: 6f6e 652c 0a20 2020 2020 2020 206d 6173  one,.        mas
-00000b80: 6b5f 7468 7265 7368 6f6c 643d 302e 3235  k_threshold=0.25
-00000b90: 2c0a 2020 2020 2020 2020 6465 6661 756c  ,.        defaul
-00000ba0: 745f 6765 6f6d 5f6d 6574 686f 643d 2261  t_geom_method="a
-00000bb0: 7574 6f22 2c0a 2020 2020 2020 2020 6f76  uto",.        ov
-00000bc0: 6572 6c61 705f 6c65 7665 6c3d 4e6f 6e65  erlap_level=None
-00000bd0: 2c0a 2020 2020 2020 2020 616c 7068 615f  ,.        alpha_
-00000be0: 6f76 6572 5f62 6574 613d 4e6f 6e65 2c0a  over_beta=None,.
-00000bf0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-00000c00: 2c0a 2020 2020 293a 0a0a 2020 2020 2020  ,.    ):..      
-00000c10: 2020 2222 224c 6f61 6420 524f 4920 6672    """Load ROI fr
-00000c20: 6f6d 206d 6173 6b20 6f72 2063 6f6e 746f  om mask or conto
-00000c30: 7572 2e0a 0a20 2020 2020 2020 202a 2a50  ur...        **P
-00000c40: 6172 616d 6574 6572 733a 2a2a 0a20 2020  arameters:**.   
-00000c50: 2020 2020 200a 2020 2020 2020 2020 736f       .        so
-00000c60: 7572 6365 203a 2073 7472 2f61 7272 6179  urce : str/array
-00000c70: 2f6e 6966 7469 2c20 6465 6661 756c 743d  /nifti, default=
-00000c80: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00000c90: 2053 6f75 7263 6520 6f66 2069 6d61 6765   Source of image
-00000ca0: 2064 6174 6120 746f 206c 6f61 642e 2043   data to load. C
-00000cb0: 616e 2062 6520 6569 7468 6572 3a0a 0a20  an be either:.. 
-00000cc0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00000cd0: 6129 2054 6865 2070 6174 6820 746f 2061  a) The path to a
-00000ce0: 206e 6966 7469 2066 696c 6520 636f 6e74   nifti file cont
-00000cf0: 6169 6e69 6e67 2061 2062 696e 6172 7920  aining a binary 
-00000d00: 6d61 736b 3b0a 2020 2020 2020 2020 2020  mask;.          
-00000d10: 2020 2020 2020 2862 2920 4120 6e75 6d70        (b) A nump
-00000d20: 7920 6172 7261 7920 636f 6e74 6169 6e69  y array containi
-00000d30: 6e67 2061 2062 696e 6172 7920 6d61 736b  ng a binary mask
-00000d40: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-00000d50: 2020 2863 2920 5468 6520 7061 7468 2074    (c) The path t
-00000d60: 6f20 6120 6669 6c65 2063 6f6e 7461 696e  o a file contain
-00000d70: 696e 6720 6120 6e75 6d70 7920 6172 7261  ing a numpy arra
-00000d80: 793b 0a20 2020 2020 2020 2020 2020 2020  y;.             
-00000d90: 2020 2028 6429 2054 6865 2070 6174 6820     (d) The path 
-00000da0: 746f 2061 2064 6963 6f6d 2073 7472 7563  to a dicom struc
-00000db0: 7475 7265 2073 6574 2066 696c 652e 0a20  ture set file.. 
-00000dc0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00000dd0: 6529 2044 6963 7469 6f6e 6172 7920 6f66  e) Dictionary of
-00000de0: 2063 6f6e 746f 7572 7320 696e 2074 6865   contours in the
-00000df0: 2078 2d79 206f 7269 656e 7461 7469 6f6e   x-y orientation
-00000e00: 2c20 7768 6572 6520 7468 650a 2020 2020  , where the.    
-00000e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000e20: 6b65 7973 2061 7265 207a 2070 6f73 6974  keys are z posit
-00000e30: 696f 6e73 2069 6e20 6d6d 2061 6e64 2076  ions in mm and v
-00000e40: 616c 7565 7320 6172 6520 6c69 7374 7320  alues are lists 
-00000e50: 6f66 206c 6973 7473 206f 660a 2020 2020  of lists of.    
-00000e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000e70: 3344 2063 6f6e 746f 7572 2070 6f69 6e74  3D contour point
-00000e80: 7320 696e 206f 7264 6572 2028 782c 2079  s in order (x, y
-00000e90: 2c20 7a29 206f 7220 3244 2063 6f6e 746f  , z) or 2D conto
-00000ea0: 7572 2070 6f69 6e74 7320 696e 0a20 2020  ur points in.   
-00000eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000ec0: 206f 7264 6572 2028 782c 2079 2920 6f6e   order (x, y) on
-00000ed0: 2065 6163 6820 736c 6963 652e 0a20 2020   each slice..   
-00000ee0: 2020 2020 2020 2020 2020 2020 2028 6629               (f)
-00000ef0: 2044 6963 7469 6f6e 6172 7920 6f66 2073   Dictionary of s
-00000f00: 6861 7065 6c79 2070 6f6c 7967 6f6e 7320  hapely polygons 
-00000f10: 616e 642f 6f72 206d 756c 7469 706f 6c79  and/or multipoly
-00000f20: 676f 6e73 0a20 2020 2020 2020 2020 2020  gons.           
-00000f30: 2020 2020 2020 2020 2069 6e20 7468 6520           in the 
-00000f40: 782d 7920 6f72 6965 6e74 6174 696f 6e2c  x-y orientation,
-00000f50: 2077 6865 7265 2074 6865 206b 6579 7320   where the keys 
-00000f60: 6172 6520 7a20 706f 7369 7469 6f6e 730a  are z positions.
+00000870: 6365 2e63 6f6c 6f72 735b 524f 4944 6566  ce.colors[ROIDef
+00000880: 6175 6c74 732e 696e 7374 616e 6365 2e6e  aults.instance.n
+00000890: 5f63 6f6c 6f72 735f 7573 6564 5d0a 2020  _colors_used].  
+000008a0: 2020 2020 2020 524f 4944 6566 6175 6c74        ROIDefault
+000008b0: 732e 696e 7374 616e 6365 2e6e 5f63 6f6c  s.instance.n_col
+000008c0: 6f72 735f 7573 6564 202b 3d20 310a 2020  ors_used += 1.  
+000008d0: 2020 2020 2020 7265 7475 726e 2063 6f6c        return col
+000008e0: 6f72 0a0a 2020 2020 6465 6620 6765 745f  or..    def get_
+000008f0: 6465 6661 756c 745f 7374 7275 6374 7572  default_structur
+00000900: 655f 7365 745f 6e61 6d65 2873 656c 6629  e_set_name(self)
+00000910: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
+00000920: 2061 2064 6566 6175 6c74 206e 616d 6520   a default name 
+00000930: 666f 7220 6120 7374 7275 6374 7572 6520  for a structure 
+00000940: 7365 742e 2222 220a 0a20 2020 2020 2020  set."""..       
+00000950: 2052 4f49 4465 6661 756c 7473 2e69 6e73   ROIDefaults.ins
+00000960: 7461 6e63 652e 6e5f 7374 7275 6374 7572  tance.n_structur
+00000970: 655f 7365 7473 202b 3d20 310a 2020 2020  e_sets += 1.    
+00000980: 2020 2020 7265 7475 726e 2066 2253 7472      return f"Str
+00000990: 7563 7475 7265 5365 7420 7b52 4f49 4465  uctureSet {ROIDe
+000009a0: 6661 756c 7473 2e69 6e73 7461 6e63 652e  faults.instance.
+000009b0: 6e5f 7374 7275 6374 7572 655f 7365 7473  n_structure_sets
+000009c0: 7d22 0a0a 0a52 4f49 4465 6661 756c 7473  }"...ROIDefaults
+000009d0: 2829 0a0a 636c 6173 7320 524f 4928 736b  ()..class ROI(sk
+000009e0: 7274 2e63 6f72 652e 4172 6368 6976 6529  rt.core.Archive)
+000009f0: 3a0a 2020 2020 2222 220a 2020 2020 436c  :.    """.    Cl
+00000a00: 6173 7320 7265 7072 6573 656e 7469 6e67  ass representing
+00000a10: 2061 2073 696e 676c 6520 7265 6769 6f6e   a single region
+00000a20: 206f 6620 696e 7465 7265 7374 2028 524f   of interest (RO
+00000a30: 4929 2e0a 0a20 2020 2041 7474 7269 6275  I)...    Attribu
+00000a40: 7465 7320 6f66 2061 6e20 524f 4920 6f62  tes of an ROI ob
+00000a50: 6a65 6374 2073 686f 756c 6420 7573 7561  ject should usua
+00000a60: 6c6c 7920 6265 2061 6363 6573 7365 6420  lly be accessed 
+00000a70: 7669 610a 2020 2020 7468 6569 7220 6765  via.    their ge
+00000a80: 7474 6572 206d 6574 686f 6473 2c20 7261  tter methods, ra
+00000a90: 7468 6572 2074 6861 6e20 6469 7265 6374  ther than direct
+00000aa0: 6c79 2c20 746f 2065 6e73 7572 6520 7468  ly, to ensure th
+00000ab0: 6174 0a20 2020 2061 7474 7269 6275 7465  at.    attribute
+00000ac0: 2076 616c 7565 7320 6861 7665 2062 6565   values have bee
+00000ad0: 6e20 6c6f 6164 6564 2e0a 2020 2020 2222  n loaded..    ""
+00000ae0: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+00000af0: 745f 5f28 0a20 2020 2020 2020 2073 656c  t__(.        sel
+00000b00: 662c 0a20 2020 2020 2020 2073 6f75 7263  f,.        sourc
+00000b10: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+00000b20: 6e61 6d65 3d4e 6f6e 652c 0a20 2020 2020  name=None,.     
+00000b30: 2020 2063 6f6c 6f72 3d4e 6f6e 652c 0a20     color=None,. 
+00000b40: 2020 2020 2020 206c 6f61 643d 5472 7565         load=True
+00000b50: 2c0a 2020 2020 2020 2020 696d 6167 653d  ,.        image=
+00000b60: 4e6f 6e65 2c0a 2020 2020 2020 2020 7368  None,.        sh
+00000b70: 6170 653d 4e6f 6e65 2c0a 2020 2020 2020  ape=None,.      
+00000b80: 2020 6166 6669 6e65 3d4e 6f6e 652c 0a20    affine=None,. 
+00000b90: 2020 2020 2020 2076 6f78 656c 5f73 697a         voxel_siz
+00000ba0: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+00000bb0: 6f72 6967 696e 3d4e 6f6e 652c 0a20 2020  origin=None,.   
+00000bc0: 2020 2020 206d 6173 6b5f 7468 7265 7368       mask_thresh
+00000bd0: 6f6c 643d 302e 3235 2c0a 2020 2020 2020  old=0.25,.      
+00000be0: 2020 6465 6661 756c 745f 6765 6f6d 5f6d    default_geom_m
+00000bf0: 6574 686f 643d 2261 7574 6f22 2c0a 2020  ethod="auto",.  
+00000c00: 2020 2020 2020 6f76 6572 6c61 705f 6c65        overlap_le
+00000c10: 7665 6c3d 4e6f 6e65 2c0a 2020 2020 2020  vel=None,.      
+00000c20: 2020 616c 7068 615f 6f76 6572 5f62 6574    alpha_over_bet
+00000c30: 613d 4e6f 6e65 2c0a 2020 2020 2020 2020  a=None,.        
+00000c40: 2a2a 6b77 6172 6773 2c0a 2020 2020 293a  **kwargs,.    ):
+00000c50: 0a0a 2020 2020 2020 2020 2222 224c 6f61  ..        """Loa
+00000c60: 6420 524f 4920 6672 6f6d 206d 6173 6b20  d ROI from mask 
+00000c70: 6f72 2063 6f6e 746f 7572 2e0a 0a20 2020  or contour...   
+00000c80: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
+00000c90: 733a 2a2a 0a20 2020 2020 2020 200a 2020  s:**.        .  
+00000ca0: 2020 2020 2020 736f 7572 6365 203a 2073        source : s
+00000cb0: 7472 2f61 7272 6179 2f6e 6966 7469 2c20  tr/array/nifti, 
+00000cc0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00000cd0: 2020 2020 2020 2020 2053 6f75 7263 6520           Source 
+00000ce0: 6f66 2069 6d61 6765 2064 6174 6120 746f  of image data to
+00000cf0: 206c 6f61 642e 2043 616e 2062 6520 6569   load. Can be ei
+00000d00: 7468 6572 3a0a 0a20 2020 2020 2020 2020  ther:..         
+00000d10: 2020 2020 2020 2028 6129 2054 6865 2070         (a) The p
+00000d20: 6174 6820 746f 2061 206e 6966 7469 2066  ath to a nifti f
+00000d30: 696c 6520 636f 6e74 6169 6e69 6e67 2061  ile containing a
+00000d40: 2062 696e 6172 7920 6d61 736b 3b0a 2020   binary mask;.  
+00000d50: 2020 2020 2020 2020 2020 2020 2020 2862                (b
+00000d60: 2920 4120 6e75 6d70 7920 6172 7261 7920  ) A numpy array 
+00000d70: 636f 6e74 6169 6e69 6e67 2061 2062 696e  containing a bin
+00000d80: 6172 7920 6d61 736b 3b0a 2020 2020 2020  ary mask;.      
+00000d90: 2020 2020 2020 2020 2020 2863 2920 5468            (c) Th
+00000da0: 6520 7061 7468 2074 6f20 6120 6669 6c65  e path to a file
+00000db0: 2063 6f6e 7461 696e 696e 6720 6120 6e75   containing a nu
+00000dc0: 6d70 7920 6172 7261 793b 0a20 2020 2020  mpy array;.     
+00000dd0: 2020 2020 2020 2020 2020 2028 6429 2054             (d) T
+00000de0: 6865 2070 6174 6820 746f 2061 2064 6963  he path to a dic
+00000df0: 6f6d 2073 7472 7563 7475 7265 2073 6574  om structure set
+00000e00: 2066 696c 652e 0a20 2020 2020 2020 2020   file..         
+00000e10: 2020 2020 2020 2028 6529 2044 6963 7469         (e) Dicti
+00000e20: 6f6e 6172 7920 6f66 2063 6f6e 746f 7572  onary of contour
+00000e30: 7320 696e 2074 6865 2078 2d79 206f 7269  s in the x-y ori
+00000e40: 656e 7461 7469 6f6e 2c20 7768 6572 6520  entation, where 
+00000e50: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+00000e60: 2020 2020 2020 2020 6b65 7973 2061 7265          keys are
+00000e70: 207a 2070 6f73 6974 696f 6e73 2069 6e20   z positions in 
+00000e80: 6d6d 2061 6e64 2076 616c 7565 7320 6172  mm and values ar
+00000e90: 6520 6c69 7374 7320 6f66 206c 6973 7473  e lists of lists
+00000ea0: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
+00000eb0: 2020 2020 2020 2020 3344 2063 6f6e 746f          3D conto
+00000ec0: 7572 2070 6f69 6e74 7320 696e 206f 7264  ur points in ord
+00000ed0: 6572 2028 782c 2079 2c20 7a29 206f 7220  er (x, y, z) or 
+00000ee0: 3244 2063 6f6e 746f 7572 2070 6f69 6e74  2D contour point
+00000ef0: 7320 696e 0a20 2020 2020 2020 2020 2020  s in.           
+00000f00: 2020 2020 2020 2020 206f 7264 6572 2028           order (
+00000f10: 782c 2079 2920 6f6e 2065 6163 6820 736c  x, y) on each sl
+00000f20: 6963 652e 0a20 2020 2020 2020 2020 2020  ice..           
+00000f30: 2020 2020 2028 6629 2044 6963 7469 6f6e       (f) Diction
+00000f40: 6172 7920 6f66 2073 6861 7065 6c79 2070  ary of shapely p
+00000f50: 6f6c 7967 6f6e 7320 616e 642f 6f72 206d  olygons and/or m
+00000f60: 756c 7469 706f 6c79 676f 6e73 0a20 2020  ultipolygons.   
 00000f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000f80: 2020 2020 696e 2020 6d6d 2061 6e64 2076      in  mm and v
-00000f90: 616c 7565 7320 6172 6520 6c69 7374 7320  alues are lists 
-00000fa0: 6f66 2070 6f6c 7967 6f6e 732f 6d75 6c74  of polygons/mult
-00000fb0: 6970 6f6c 7967 6f6e 730a 2020 2020 2020  ipolygons.      
-00000fc0: 2020 2020 2020 2020 2020 2020 2020 6f6e                on
-00000fd0: 2065 6163 6820 736c 6963 652e 0a0a 2020   each slice...  
-00000fe0: 2020 2020 2020 6e61 6d65 203a 2073 7472        name : str
-00000ff0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00001000: 2020 2020 2020 2020 2020 204e 616d 6520             Name 
-00001010: 6f66 2074 6865 2052 4f49 2e20 4966 203c  of the ROI. If <
-00001020: 736f 7572 6365 3e20 6973 2061 2066 696c  source> is a fil
-00001030: 6520 616e 6420 6e6f 206e 616d 6520 6973  e and no name is
-00001040: 2067 6976 656e 2c0a 2020 2020 2020 2020   given,.        
-00001050: 2020 2020 7468 6520 6e61 6d65 2077 696c      the name wil
-00001060: 6c20 6265 2069 6e66 6572 7265 6420 6672  l be inferred fr
-00001070: 6f6d 2074 6865 2066 696c 656e 616d 652e  om the filename.
-00001080: 0a0a 2020 2020 2020 2020 636f 6c6f 7220  ..        color 
-00001090: 3a20 6d61 7470 6c6f 746c 6962 2063 6f6c  : matplotlib col
-000010a0: 6f72 2c20 6465 6661 756c 743d 4e6f 6e65  or, default=None
-000010b0: 0a20 2020 2020 2020 2020 2020 2043 6f6c  .            Col
-000010c0: 6f72 2069 6e20 7768 6963 6820 7468 6973  or in which this
-000010d0: 2052 4f49 2077 696c 6c20 6265 2070 6c6f   ROI will be plo
-000010e0: 7474 6564 2e20 4966 204e 6f6e 652c 2061  tted. If None, a
-000010f0: 2063 6f6c 6f72 0a20 2020 2020 2020 2020   color.         
-00001100: 2020 2077 696c 6c20 6265 2061 7373 6967     will be assig
-00001110: 6e65 642e 0a0a 2020 2020 2020 2020 6c6f  ned...        lo
-00001120: 6164 203a 2062 6f6f 6c2c 2064 6566 6175  ad : bool, defau
-00001130: 6c74 3d54 7275 650a 2020 2020 2020 2020  lt=True.        
-00001140: 2020 2020 4966 2054 7275 652c 2063 6f6e      If True, con
-00001150: 746f 7572 732f 6d61 736b 2077 696c 6c20  tours/mask will 
-00001160: 6265 2063 7265 6174 6564 2064 7572 696e  be created durin
-00001170: 6720 696e 6974 6961 6c69 7361 7469 6f6e  g initialisation
-00001180: 3b0a 2020 2020 2020 2020 2020 2020 6f74  ;.            ot
-00001190: 6865 7277 6973 6520 7468 6579 2077 696c  herwise they wil
-000011a0: 6c20 6265 2063 7265 6174 6564 206f 6e2d  l be created on-
-000011b0: 6465 6d61 6e64 2e0a 0a20 2020 2020 2020  demand...       
-000011c0: 2069 6d61 6765 203a 2049 6d61 6765 2f73   image : Image/s
-000011d0: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
-000011e0: 0a20 2020 2020 2020 2020 2020 2041 7373  .            Ass
-000011f0: 6f63 6961 7465 6420 696d 6167 6520 6672  ociated image fr
-00001200: 6f6d 2077 6869 6368 2074 6f20 6578 7472  om which to extr
-00001210: 6163 7420 7368 6170 6520 616e 6420 6166  act shape and af
-00001220: 6669 6e65 206d 6174 7269 782e 0a20 2020  fine matrix..   
-00001230: 2020 2020 2020 2020 2043 616e 2065 6974           Can eit
-00001240: 6865 7220 6265 2061 6e20 6578 6973 7469  her be an existi
-00001250: 6e67 2049 6d61 6765 206f 626a 6563 742c  ng Image object,
-00001260: 206f 7220 6120 7061 7468 2066 726f 6d20   or a path from 
-00001270: 7768 6963 680a 2020 2020 2020 2020 2020  which.          
-00001280: 2020 616e 2049 6d61 6765 2063 616e 2062    an Image can b
-00001290: 6520 6372 6561 7465 642e 0a0a 2020 2020  e created...    
-000012a0: 2020 2020 7368 6170 6520 3a20 6c69 7374      shape : list
-000012b0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-000012c0: 2020 2020 2020 2020 2020 204e 756d 6265             Numbe
-000012d0: 7220 6f66 2076 6f78 656c 7320 696e 2074  r of voxels in t
-000012e0: 6865 2069 6d61 6765 2074 6f20 7768 6963  he image to whic
-000012f0: 6820 7468 6520 524f 4920 6265 6c6f 6e67  h the ROI belong
-00001300: 732c 2069 6e0a 2020 2020 2020 2020 2020  s, in.          
-00001310: 2020 6f72 6465 7220 2878 2c20 792c 207a    order (x, y, z
-00001320: 293b 206e 6565 6465 6420 746f 2063 7265  ); needed to cre
-00001330: 6174 6520 6d61 736b 2069 6620 636f 6e74  ate mask if cont
-00001340: 6f75 7273 2061 7265 2070 726f 7669 6465  ours are provide
-00001350: 640a 2020 2020 2020 2020 2020 2020 696e  d.            in
-00001360: 203c 736f 7572 6365 3e20 6275 7420 6e6f   <source> but no
-00001370: 2061 7373 6f63 6961 7465 6420 3c69 6d61   associated <ima
-00001380: 6765 3e20 6973 2061 7373 6967 6e65 642e  ge> is assigned.
-00001390: 0a0a 2020 2020 2020 2020 6166 6669 6e65  ..        affine
-000013a0: 203a 206e 702e 6e64 6172 7261 792c 2064   : np.ndarray, d
-000013b0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-000013c0: 2020 2020 2020 2020 4166 6669 6e65 206d          Affine m
-000013d0: 6174 7269 7820 6f66 2074 6865 2069 6d61  atrix of the ima
-000013e0: 6765 2074 6f20 7768 6963 6820 7468 6520  ge to which the 
-000013f0: 524f 4920 6265 6c6f 6e67 732e 0a20 2020  ROI belongs..   
-00001400: 2020 2020 2020 2020 204e 6565 6465 6420           Needed 
-00001410: 746f 2063 7265 6174 6520 6d61 736b 2069  to create mask i
-00001420: 6620 636f 6e74 6f75 7273 2061 7265 2070  f contours are p
-00001430: 726f 7669 6465 640a 2020 2020 2020 2020  rovided.        
-00001440: 2020 2020 696e 203c 736f 7572 6365 3e20      in <source> 
-00001450: 6275 7420 6e6f 2061 7373 6f63 6961 7465  but no associate
-00001460: 6420 3c69 6d61 6765 3e20 6973 2061 7373  d <image> is ass
-00001470: 6967 6e65 642c 2061 6e64 206e 6f20 0a20  igned, and no . 
-00001480: 2020 2020 2020 2020 2020 203c 766f 7865             <voxe
-00001490: 6c5f 7369 7a65 3e20 616e 6420 3c6f 7269  l_size> and <ori
-000014a0: 6769 6e3e 2061 7265 2067 6976 656e 2e20  gin> are given. 
-000014b0: 4966 203c 6166 6669 6e65 3e20 6973 2067  If <affine> is g
-000014c0: 6976 656e 2c20 6974 0a20 2020 2020 2020  iven, it.       
-000014d0: 2020 2020 2073 7570 6572 6365 6465 7320       supercedes 
-000014e0: 7468 6520 6c61 7474 6572 2074 776f 2061  the latter two a
-000014f0: 7267 756d 656e 7473 2e0a 0a20 2020 2020  rguments...     
-00001500: 2020 2076 6f78 656c 5f73 697a 6520 3a20     voxel_size : 
-00001510: 7475 706c 652c 2064 6566 6175 6c74 3d28  tuple, default=(
-00001520: 312c 2031 2c20 3129 0a20 2020 2020 2020  1, 1, 1).       
-00001530: 2020 2020 2056 6f78 656c 2073 697a 6573       Voxel sizes
-00001540: 2069 6e20 6d6d 2069 6e20 6f72 6465 7220   in mm in order 
-00001550: 2878 2c20 792c 207a 293b 2075 7365 6420  (x, y, z); used 
-00001560: 6966 203c 6166 6669 6e65 3e20 616e 6420  if <affine> and 
-00001570: 3c69 6d61 6765 3e0a 2020 2020 2020 2020  <image>.        
-00001580: 2020 2020 6172 6520 6e6f 7420 7072 6f76      are not prov
-00001590: 6964 6564 2e0a 0a20 2020 2020 2020 206f  ided...        o
-000015a0: 7269 6769 6e20 3a20 7475 706c 652c 2064  rigin : tuple, d
-000015b0: 6566 6175 6c74 3d28 302c 2030 2c20 3029  efault=(0, 0, 0)
-000015c0: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
-000015d0: 6769 6e20 706f 7369 7469 6f6e 2069 6e20  gin position in 
-000015e0: 6d6d 2069 6e20 6f72 6465 7220 2878 2c20  mm in order (x, 
-000015f0: 792c 207a 293b 2075 7365 6420 6966 203c  y, z); used if <
-00001600: 6166 6669 6e65 3e20 616e 6420 3c69 6d61  affine> and <ima
-00001610: 6765 3e0a 2020 2020 2020 2020 2020 2020  ge>.            
-00001620: 6172 6520 6e6f 7420 7072 6f76 6964 6564  are not provided
-00001630: 2e0a 0a20 2020 2020 2020 206d 6173 6b5f  ...        mask_
-00001640: 7468 7265 7368 6f6c 6420 3a20 666c 6f61  threshold : floa
-00001650: 742c 2064 6566 6175 6c74 3d30 2e32 350a  t, default=0.25.
-00001660: 2020 2020 2020 2020 2020 2020 5573 6564              Used
-00001670: 2069 6620 7468 6520 524f 4920 6973 2063   if the ROI is c
-00001680: 7265 6174 6564 2066 726f 6d20 6120 6e6f  reated from a no
-00001690: 6e2d 626f 6f6c 6561 6e20 7069 7865 6c20  n-boolean pixel 
-000016a0: 6172 7261 792e 2056 616c 7565 7320 0a20  array. Values . 
-000016b0: 2020 2020 2020 2020 2020 2069 6e20 7468             in th
-000016c0: 6520 6172 7261 7920 6578 6365 6564 696e  e array exceedin
-000016d0: 6720 7468 6973 206c 6576 656c 2061 7265  g this level are
-000016e0: 2074 616b 656e 2074 6f20 6265 2069 6e73   taken to be ins
-000016f0: 6964 6520 7468 6520 524f 490a 2020 2020  ide the ROI.    
-00001700: 2020 2020 2020 2020 7768 656e 2069 7420          when it 
-00001710: 6973 2063 6f6e 7665 7274 6564 2074 6f20  is converted to 
-00001720: 6120 626f 6f6c 6561 6e20 6172 7261 792e  a boolean array.
-00001730: 0a0a 2020 2020 2020 2020 6465 6661 756c  ..        defaul
-00001740: 745f 6765 6f6d 5f6d 6574 686f 6420 3a20  t_geom_method : 
-00001750: 7374 722c 2064 6566 6175 6c74 3d22 6175  str, default="au
-00001760: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
-00001770: 4465 6661 756c 7420 6d65 7468 6f64 2066  Default method f
-00001780: 6f72 2063 6f6d 7075 7469 6e67 2067 656f  or computing geo
-00001790: 6d65 7472 6963 2071 7561 6e74 6974 6965  metric quantitie
-000017a0: 7320 2861 7265 612c 2063 656e 7472 6f69  s (area, centroi
-000017b0: 642c 2065 7463 292e 0a20 2020 2020 2020  d, etc)..       
-000017c0: 2020 2020 2043 616e 2062 6520 616e 7920       Can be any 
-000017d0: 6f66 3a0a 0a20 2020 2020 2020 2020 2020  of:..           
-000017e0: 2020 2020 2028 6129 2022 636f 6e74 6f75       (a) "contou
-000017f0: 7222 3a20 6765 6f6d 6574 7269 6320 7175  r": geometric qu
-00001800: 616e 7469 7469 6573 2077 696c 6c20 6265  antities will be
-00001810: 2063 616c 6375 6c61 7465 6420 6672 6f6d   calculated from
-00001820: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00001830: 2020 2020 2020 5368 6170 656c 7920 706f        Shapely po
-00001840: 6c79 676f 6e73 206d 6164 6520 6672 6f6d  lygons made from
-00001850: 2063 6f6e 746f 7572 2070 6f69 6e74 732e   contour points.
-00001860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001870: 2028 6229 2022 6d61 736b 223a 2067 656f   (b) "mask": geo
-00001880: 6d65 7472 6963 2071 7561 6e74 6974 6965  metric quantitie
-00001890: 7320 7769 6c6c 2062 6520 6361 6c63 756c  s will be calcul
-000018a0: 6174 6564 2066 726f 6d20 0a20 2020 2020  ated from .     
-000018b0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000018c0: 756d 7079 2061 7272 6179 2072 6570 7265  umpy array repre
-000018d0: 7365 6e74 696e 6720 6120 6269 6e61 7279  senting a binary
-000018e0: 206d 6173 6b2e 0a20 2020 2020 2020 2020   mask..         
-000018f0: 2020 2020 2020 2028 6329 2022 6175 746f         (c) "auto
-00001900: 223a 2074 6865 2022 636f 6e74 6f75 7222  ": the "contour"
-00001910: 206f 7220 226d 6173 6b22 206d 6574 686f   or "mask" metho
-00001920: 6420 7769 6c6c 2062 6520 7573 6564 2c20  d will be used, 
-00001930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001940: 2020 2020 2064 6570 656e 6469 6e67 206f       depending o
-00001950: 6e20 7768 6574 6865 7220 7468 6520 696e  n whether the in
-00001960: 7075 7420 7468 6174 2063 7265 6174 6520  put that create 
-00001970: 7468 6520 524f 4920 636f 6d70 7269 7365  the ROI comprise
-00001980: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-00001990: 2020 2020 2020 6f66 2063 6f6e 746f 7572        of contour
-000019a0: 7320 6f72 2061 6e20 6172 7261 792c 2072  s or an array, r
-000019b0: 6573 7065 6374 6976 656c 792e 0a0a 2020  espectively...  
-000019c0: 2020 2020 2020 6f76 6572 6c61 705f 6c65        overlap_le
-000019d0: 7665 6c20 3a20 666c 6f61 742c 2064 6566  vel : float, def
-000019e0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-000019f0: 2020 2020 2020 5573 6564 2077 6865 6e20        Used when 
-00001a00: 636f 6e76 6572 7469 6e67 2061 6e20 696e  converting an in
-00001a10: 7075 7420 524f 4920 636f 6e74 6f75 7220  put ROI contour 
-00001a20: 746f 2061 206d 6173 6b3b 2072 6571 7569  to a mask; requi
-00001a30: 7265 6420 0a20 2020 2020 2020 2020 2020  red .           
-00001a40: 206f 7665 726c 6170 206f 6620 6120 7069   overlap of a pi
-00001a50: 7865 6c20 7769 7468 2074 6865 2052 4f49  xel with the ROI
-00001a60: 2063 6f6e 746f 7572 2069 6e20 6f72 6465   contour in orde
-00001a70: 7220 666f 7220 7468 6520 0a20 2020 2020  r for the .     
-00001a80: 2020 2020 2020 2070 6978 656c 2074 6f20         pixel to 
-00001a90: 6265 2061 6464 6564 2074 6f20 7468 6520  be added to the 
-00001aa0: 6d61 736b 2e20 4966 204e 6f6e 652c 2074  mask. If None, t
-00001ab0: 6865 206f 7574 7075 7420 6f66 200a 2020  he output of .  
-00001ac0: 2020 2020 2020 2020 2020 736b 696d 6167            skimag
-00001ad0: 652e 6472 6177 2e70 6f6c 7967 6f6e 326d  e.draw.polygon2m
-00001ae0: 6173 6b20 7769 6c6c 2062 6520 7265 7475  ask will be retu
-00001af0: 726e 6564 2077 6974 6820 6e6f 2062 6f72  rned with no bor
-00001b00: 6465 7220 6368 6563 6b73 2c20 0a20 2020  der checks, .   
-00001b10: 2020 2020 2020 2020 2077 6869 6368 2069           which i
-00001b20: 7320 6661 7374 6572 2074 6861 6e20 7065  s faster than pe
-00001b30: 7266 6f72 6d69 6e67 2062 6f72 6465 7220  rforming border 
-00001b40: 6368 6563 6b73 2e0a 0a20 2020 2020 2020  checks...       
-00001b50: 200a 2020 2020 2020 2020 616c 7068 615f   .        alpha_
-00001b60: 6f76 6572 5f62 6574 6120 3a20 666c 6f61  over_beta : floa
-00001b70: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-00001b80: 2020 2020 2020 2020 2020 2020 5261 7469              Rati
-00001b90: 6f20 666f 7220 524f 4920 7469 7373 7565  o for ROI tissue
-00001ba0: 206f 6620 636f 6566 6669 6369 656e 7473   of coefficients
-00001bb0: 2c20 616c 7068 612c 2062 6574 612c 0a20  , alpha, beta,. 
-00001bc0: 2020 2020 2020 2020 2020 206f 6620 6c69             of li
-00001bd0: 6e65 6172 2d71 7561 6472 6174 6963 2065  near-quadratic e
-00001be0: 7175 6174 696f 6e2e 2020 5468 6973 2072  quation.  This r
-00001bf0: 6174 696f 2069 7320 7573 6564 2069 6e0a  atio is used in.
-00001c00: 2020 2020 2020 2020 2020 2020 6361 6c63              calc
-00001c10: 756c 6174 696e 6720 6269 6f6c 6f67 6963  ulating biologic
-00001c20: 616c 6c79 2065 6666 6563 7469 7665 2064  ally effective d
-00001c30: 6f73 652c 2042 4544 2c20 6672 6f6d 0a20  ose, BED, from. 
-00001c40: 2020 2020 2020 2020 2020 2070 6879 7369             physi
-00001c50: 6361 6c20 646f 7365 2c20 442c 2064 656c  cal dose, D, del
-00001c60: 6976 6572 6564 206f 7665 7220 6e20 6571  ivered over n eq
-00001c70: 7561 6c20 6672 6163 7469 6f6e 733a 0a20  ual fractions:. 
-00001c80: 2020 2020 2020 2020 2020 2020 2020 2042                 B
-00001c90: 4544 203d 2044 202a 2028 3120 2b20 2844  ED = D * (1 + (D
-00001ca0: 2f6e 2920 2f20 2861 6c70 6861 2f62 6574  /n) / (alpha/bet
-00001cb0: 6129 292e 0a20 2020 2020 2020 2020 2020  a))..           
-00001cc0: 2049 6620 4e6f 6e65 2c20 7468 6520 6269   If None, the bi
-00001cd0: 6f6c 6f67 6963 616c 6c79 2065 6666 6563  ologically effec
-00001ce0: 7469 7665 2064 6f73 6520 6973 2074 616b  tive dose is tak
-00001cf0: 656e 2074 6f20 6265 0a20 2020 2020 2020  en to be.       
-00001d00: 2020 2020 2065 7175 616c 2074 6f20 7468       equal to th
-00001d10: 6520 7068 7973 6963 616c 2064 6f73 6520  e physical dose 
-00001d20: 2862 6574 6120 3e3e 2061 6c70 6861 292e  (beta >> alpha).
-00001d30: 0a0a 2020 2020 2020 2020 6b77 6172 6773  ..        kwargs
-00001d40: 203a 2064 6963 742c 2064 6566 6175 6c74   : dict, default
-00001d50: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-00001d60: 2020 4578 7472 6120 6172 6775 6d65 6e74    Extra argument
-00001d70: 7320 746f 2070 6173 7320 746f 2074 6865  s to pass to the
-00001d80: 2069 6e69 7469 616c 6973 6174 696f 6e20   initialisation 
-00001d90: 6f66 2074 6865 2070 6172 656e 740a 2020  of the parent.  
-00001da0: 2020 2020 2020 2020 2020 496d 6167 6520            Image 
-00001db0: 6f62 6a65 6374 2e0a 2020 2020 2020 2020  object..        
-00001dc0: 2222 220a 0a20 2020 2020 2020 2023 2043  """..        # C
-00001dd0: 6c6f 6e65 2066 726f 6d20 616e 6f74 6865  lone from anothe
-00001de0: 7220 524f 4920 6f62 6a65 6374 0a20 2020  r ROI object.   
-00001df0: 2020 2020 2069 6620 6973 7375 6263 6c61       if issubcla
-00001e00: 7373 2874 7970 6528 736f 7572 6365 292c  ss(type(source),
-00001e10: 2052 4f49 293a 0a20 2020 2020 2020 2020   ROI):.         
-00001e20: 2020 2073 6f75 7263 652e 636c 6f6e 655f     source.clone_
-00001e30: 6174 7472 7328 7365 6c66 290a 2020 2020  attrs(self).    
-00001e40: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-00001e50: 2020 2020 2020 2020 2320 5072 6f63 6573          # Proces
-00001e60: 7320 636f 6e74 6f75 7220 6469 6374 696f  s contour dictio
-00001e70: 6e61 7279 0a20 2020 2020 2020 2073 656c  nary.        sel
-00001e80: 662e 696e 7075 745f 636f 6e74 6f75 7273  f.input_contours
-00001e90: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00001ea0: 6966 2069 7369 6e73 7461 6e63 6528 736f  if isinstance(so
-00001eb0: 7572 6365 2c20 6469 6374 293a 0a20 2020  urce, dict):.   
-00001ec0: 2020 2020 2020 2020 2073 656c 662e 736f           self.so
-00001ed0: 7572 6365 203d 204e 6f6e 650a 2020 2020  urce = None.    
-00001ee0: 2020 2020 2020 2020 7365 6c66 2e69 6e70          self.inp
-00001ef0: 7574 5f63 6f6e 746f 7572 7320 3d20 7b7d  ut_contours = {}
-00001f00: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00001f10: 207a 2c20 636f 6e74 6f75 7273 2069 6e20   z, contours in 
-00001f20: 736f 7572 6365 2e69 7465 6d73 2829 3a0a  source.items():.
-00001f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001f40: 7365 6c66 2e69 6e70 7574 5f63 6f6e 746f  self.input_conto
-00001f50: 7572 735b 7a5d 203d 205b 5d0a 2020 2020  urs[z] = [].    
-00001f60: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00001f70: 636f 6e74 6f75 7220 696e 2063 6f6e 746f  contour in conto
-00001f80: 7572 733a 0a20 2020 2020 2020 2020 2020  urs:.           
-00001f90: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-00001fa0: 7374 616e 6365 2863 6f6e 746f 7572 2c20  stance(contour, 
-00001fb0: 6765 6f6d 6574 7279 2e70 6f6c 7967 6f6e  geometry.polygon
-00001fc0: 2e50 6f6c 7967 6f6e 293a 0a20 2020 2020  .Polygon):.     
+00000f80: 2069 6e20 7468 6520 782d 7920 6f72 6965   in the x-y orie
+00000f90: 6e74 6174 696f 6e2c 2077 6865 7265 2074  ntation, where t
+00000fa0: 6865 206b 6579 7320 6172 6520 7a20 706f  he keys are z po
+00000fb0: 7369 7469 6f6e 730a 2020 2020 2020 2020  sitions.        
+00000fc0: 2020 2020 2020 2020 2020 2020 696e 2020              in  
+00000fd0: 6d6d 2061 6e64 2076 616c 7565 7320 6172  mm and values ar
+00000fe0: 6520 6c69 7374 7320 6f66 2070 6f6c 7967  e lists of polyg
+00000ff0: 6f6e 732f 6d75 6c74 6970 6f6c 7967 6f6e  ons/multipolygon
+00001000: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00001010: 2020 2020 2020 6f6e 2065 6163 6820 736c        on each sl
+00001020: 6963 652e 0a0a 2020 2020 2020 2020 6e61  ice...        na
+00001030: 6d65 203a 2073 7472 2c20 6465 6661 756c  me : str, defaul
+00001040: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00001050: 2020 204e 616d 6520 6f66 2074 6865 2052     Name of the R
+00001060: 4f49 2e20 4966 203c 736f 7572 6365 3e20  OI. If <source> 
+00001070: 6973 2061 2066 696c 6520 616e 6420 6e6f  is a file and no
+00001080: 206e 616d 6520 6973 2067 6976 656e 2c0a   name is given,.
+00001090: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+000010a0: 6e61 6d65 2077 696c 6c20 6265 2069 6e66  name will be inf
+000010b0: 6572 7265 6420 6672 6f6d 2074 6865 2066  erred from the f
+000010c0: 696c 656e 616d 652e 0a0a 2020 2020 2020  ilename...      
+000010d0: 2020 636f 6c6f 7220 3a20 6d61 7470 6c6f    color : matplo
+000010e0: 746c 6962 2063 6f6c 6f72 2c20 6465 6661  tlib color, defa
+000010f0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+00001100: 2020 2020 2043 6f6c 6f72 2069 6e20 7768       Color in wh
+00001110: 6963 6820 7468 6973 2052 4f49 2077 696c  ich this ROI wil
+00001120: 6c20 6265 2070 6c6f 7474 6564 2e20 4966  l be plotted. If
+00001130: 204e 6f6e 652c 2061 2063 6f6c 6f72 0a20   None, a color. 
+00001140: 2020 2020 2020 2020 2020 2077 696c 6c20             will 
+00001150: 6265 2061 7373 6967 6e65 642e 0a0a 2020  be assigned...  
+00001160: 2020 2020 2020 6c6f 6164 203a 2062 6f6f        load : boo
+00001170: 6c2c 2064 6566 6175 6c74 3d54 7275 650a  l, default=True.
+00001180: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+00001190: 7275 652c 2063 6f6e 746f 7572 732f 6d61  rue, contours/ma
+000011a0: 736b 2077 696c 6c20 6265 2063 7265 6174  sk will be creat
+000011b0: 6564 2064 7572 696e 6720 696e 6974 6961  ed during initia
+000011c0: 6c69 7361 7469 6f6e 3b0a 2020 2020 2020  lisation;.      
+000011d0: 2020 2020 2020 6f74 6865 7277 6973 6520        otherwise 
+000011e0: 7468 6579 2077 696c 6c20 6265 2063 7265  they will be cre
+000011f0: 6174 6564 206f 6e2d 6465 6d61 6e64 2e0a  ated on-demand..
+00001200: 0a20 2020 2020 2020 2069 6d61 6765 203a  .        image :
+00001210: 2049 6d61 6765 2f73 7472 2c20 6465 6661   Image/str, defa
+00001220: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+00001230: 2020 2020 2041 7373 6f63 6961 7465 6420       Associated 
+00001240: 696d 6167 6520 6672 6f6d 2077 6869 6368  image from which
+00001250: 2074 6f20 6578 7472 6163 7420 7368 6170   to extract shap
+00001260: 6520 616e 6420 6166 6669 6e65 206d 6174  e and affine mat
+00001270: 7269 782e 0a20 2020 2020 2020 2020 2020  rix..           
+00001280: 2043 616e 2065 6974 6865 7220 6265 2061   Can either be a
+00001290: 6e20 6578 6973 7469 6e67 2049 6d61 6765  n existing Image
+000012a0: 206f 626a 6563 742c 206f 7220 6120 7061   object, or a pa
+000012b0: 7468 2066 726f 6d20 7768 6963 680a 2020  th from which.  
+000012c0: 2020 2020 2020 2020 2020 616e 2049 6d61            an Ima
+000012d0: 6765 2063 616e 2062 6520 6372 6561 7465  ge can be create
+000012e0: 642e 0a0a 2020 2020 2020 2020 7368 6170  d...        shap
+000012f0: 6520 3a20 6c69 7374 2c20 6465 6661 756c  e : list, defaul
+00001300: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00001310: 2020 204e 756d 6265 7220 6f66 2076 6f78     Number of vox
+00001320: 656c 7320 696e 2074 6865 2069 6d61 6765  els in the image
+00001330: 2074 6f20 7768 6963 6820 7468 6520 524f   to which the RO
+00001340: 4920 6265 6c6f 6e67 732c 2069 6e0a 2020  I belongs, in.  
+00001350: 2020 2020 2020 2020 2020 6f72 6465 7220            order 
+00001360: 2878 2c20 792c 207a 293b 206e 6565 6465  (x, y, z); neede
+00001370: 6420 746f 2063 7265 6174 6520 6d61 736b  d to create mask
+00001380: 2069 6620 636f 6e74 6f75 7273 2061 7265   if contours are
+00001390: 2070 726f 7669 6465 640a 2020 2020 2020   provided.      
+000013a0: 2020 2020 2020 696e 203c 736f 7572 6365        in <source
+000013b0: 3e20 6275 7420 6e6f 2061 7373 6f63 6961  > but no associa
+000013c0: 7465 6420 3c69 6d61 6765 3e20 6973 2061  ted <image> is a
+000013d0: 7373 6967 6e65 642e 0a0a 2020 2020 2020  ssigned...      
+000013e0: 2020 6166 6669 6e65 203a 206e 702e 6e64    affine : np.nd
+000013f0: 6172 7261 792c 2064 6566 6175 6c74 3d4e  array, default=N
+00001400: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00001410: 4166 6669 6e65 206d 6174 7269 7820 6f66  Affine matrix of
+00001420: 2074 6865 2069 6d61 6765 2074 6f20 7768   the image to wh
+00001430: 6963 6820 7468 6520 524f 4920 6265 6c6f  ich the ROI belo
+00001440: 6e67 732e 0a20 2020 2020 2020 2020 2020  ngs..           
+00001450: 204e 6565 6465 6420 746f 2063 7265 6174   Needed to creat
+00001460: 6520 6d61 736b 2069 6620 636f 6e74 6f75  e mask if contou
+00001470: 7273 2061 7265 2070 726f 7669 6465 640a  rs are provided.
+00001480: 2020 2020 2020 2020 2020 2020 696e 203c              in <
+00001490: 736f 7572 6365 3e20 6275 7420 6e6f 2061  source> but no a
+000014a0: 7373 6f63 6961 7465 6420 3c69 6d61 6765  ssociated <image
+000014b0: 3e20 6973 2061 7373 6967 6e65 642c 2061  > is assigned, a
+000014c0: 6e64 206e 6f20 0a20 2020 2020 2020 2020  nd no .         
+000014d0: 2020 203c 766f 7865 6c5f 7369 7a65 3e20     <voxel_size> 
+000014e0: 616e 6420 3c6f 7269 6769 6e3e 2061 7265  and <origin> are
+000014f0: 2067 6976 656e 2e20 4966 203c 6166 6669   given. If <affi
+00001500: 6e65 3e20 6973 2067 6976 656e 2c20 6974  ne> is given, it
+00001510: 0a20 2020 2020 2020 2020 2020 2073 7570  .            sup
+00001520: 6572 6365 6465 7320 7468 6520 6c61 7474  ercedes the latt
+00001530: 6572 2074 776f 2061 7267 756d 656e 7473  er two arguments
+00001540: 2e0a 0a20 2020 2020 2020 2076 6f78 656c  ...        voxel
+00001550: 5f73 697a 6520 3a20 7475 706c 652c 2064  _size : tuple, d
+00001560: 6566 6175 6c74 3d28 312c 2031 2c20 3129  efault=(1, 1, 1)
+00001570: 0a20 2020 2020 2020 2020 2020 2056 6f78  .            Vox
+00001580: 656c 2073 697a 6573 2069 6e20 6d6d 2069  el sizes in mm i
+00001590: 6e20 6f72 6465 7220 2878 2c20 792c 207a  n order (x, y, z
+000015a0: 293b 2075 7365 6420 6966 203c 6166 6669  ); used if <affi
+000015b0: 6e65 3e20 616e 6420 3c69 6d61 6765 3e0a  ne> and <image>.
+000015c0: 2020 2020 2020 2020 2020 2020 6172 6520              are 
+000015d0: 6e6f 7420 7072 6f76 6964 6564 2e0a 0a20  not provided... 
+000015e0: 2020 2020 2020 206f 7269 6769 6e20 3a20         origin : 
+000015f0: 7475 706c 652c 2064 6566 6175 6c74 3d28  tuple, default=(
+00001600: 302c 2030 2c20 3029 0a20 2020 2020 2020  0, 0, 0).       
+00001610: 2020 2020 204f 7269 6769 6e20 706f 7369       Origin posi
+00001620: 7469 6f6e 2069 6e20 6d6d 2069 6e20 6f72  tion in mm in or
+00001630: 6465 7220 2878 2c20 792c 207a 293b 2075  der (x, y, z); u
+00001640: 7365 6420 6966 203c 6166 6669 6e65 3e20  sed if <affine> 
+00001650: 616e 6420 3c69 6d61 6765 3e0a 2020 2020  and <image>.    
+00001660: 2020 2020 2020 2020 6172 6520 6e6f 7420          are not 
+00001670: 7072 6f76 6964 6564 2e0a 0a20 2020 2020  provided...     
+00001680: 2020 206d 6173 6b5f 7468 7265 7368 6f6c     mask_threshol
+00001690: 6420 3a20 666c 6f61 742c 2064 6566 6175  d : float, defau
+000016a0: 6c74 3d30 2e32 350a 2020 2020 2020 2020  lt=0.25.        
+000016b0: 2020 2020 5573 6564 2069 6620 7468 6520      Used if the 
+000016c0: 524f 4920 6973 2063 7265 6174 6564 2066  ROI is created f
+000016d0: 726f 6d20 6120 6e6f 6e2d 626f 6f6c 6561  rom a non-boolea
+000016e0: 6e20 7069 7865 6c20 6172 7261 792e 2056  n pixel array. V
+000016f0: 616c 7565 7320 0a20 2020 2020 2020 2020  alues .         
+00001700: 2020 2069 6e20 7468 6520 6172 7261 7920     in the array 
+00001710: 6578 6365 6564 696e 6720 7468 6973 206c  exceeding this l
+00001720: 6576 656c 2061 7265 2074 616b 656e 2074  evel are taken t
+00001730: 6f20 6265 2069 6e73 6964 6520 7468 6520  o be inside the 
+00001740: 524f 490a 2020 2020 2020 2020 2020 2020  ROI.            
+00001750: 7768 656e 2069 7420 6973 2063 6f6e 7665  when it is conve
+00001760: 7274 6564 2074 6f20 6120 626f 6f6c 6561  rted to a boolea
+00001770: 6e20 6172 7261 792e 0a0a 2020 2020 2020  n array...      
+00001780: 2020 6465 6661 756c 745f 6765 6f6d 5f6d    default_geom_m
+00001790: 6574 686f 6420 3a20 7374 722c 2064 6566  ethod : str, def
+000017a0: 6175 6c74 3d22 6175 746f 220a 2020 2020  ault="auto".    
+000017b0: 2020 2020 2020 2020 4465 6661 756c 7420          Default 
+000017c0: 6d65 7468 6f64 2066 6f72 2063 6f6d 7075  method for compu
+000017d0: 7469 6e67 2067 656f 6d65 7472 6963 2071  ting geometric q
+000017e0: 7561 6e74 6974 6965 7320 2861 7265 612c  uantities (area,
+000017f0: 2063 656e 7472 6f69 642c 2065 7463 292e   centroid, etc).
+00001800: 0a20 2020 2020 2020 2020 2020 2043 616e  .            Can
+00001810: 2062 6520 616e 7920 6f66 3a0a 0a20 2020   be any of:..   
+00001820: 2020 2020 2020 2020 2020 2020 2028 6129               (a)
+00001830: 2022 636f 6e74 6f75 7222 3a20 6765 6f6d   "contour": geom
+00001840: 6574 7269 6320 7175 616e 7469 7469 6573  etric quantities
+00001850: 2077 696c 6c20 6265 2063 616c 6375 6c61   will be calcula
+00001860: 7465 6420 6672 6f6d 200a 2020 2020 2020  ted from .      
+00001870: 2020 2020 2020 2020 2020 2020 2020 5368                Sh
+00001880: 6170 656c 7920 706f 6c79 676f 6e73 206d  apely polygons m
+00001890: 6164 6520 6672 6f6d 2063 6f6e 746f 7572  ade from contour
+000018a0: 2070 6f69 6e74 732e 0a20 2020 2020 2020   points..       
+000018b0: 2020 2020 2020 2020 2028 6229 2022 6d61           (b) "ma
+000018c0: 736b 223a 2067 656f 6d65 7472 6963 2071  sk": geometric q
+000018d0: 7561 6e74 6974 6965 7320 7769 6c6c 2062  uantities will b
+000018e0: 6520 6361 6c63 756c 6174 6564 2066 726f  e calculated fro
+000018f0: 6d20 0a20 2020 2020 2020 2020 2020 2020  m .             
+00001900: 2020 2020 2020 206e 756d 7079 2061 7272         numpy arr
+00001910: 6179 2072 6570 7265 7365 6e74 696e 6720  ay representing 
+00001920: 6120 6269 6e61 7279 206d 6173 6b2e 0a20  a binary mask.. 
+00001930: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00001940: 6329 2022 6175 746f 223a 2074 6865 2022  c) "auto": the "
+00001950: 636f 6e74 6f75 7222 206f 7220 226d 6173  contour" or "mas
+00001960: 6b22 206d 6574 686f 6420 7769 6c6c 2062  k" method will b
+00001970: 6520 7573 6564 2c20 0a20 2020 2020 2020  e used, .       
+00001980: 2020 2020 2020 2020 2020 2020 2064 6570               dep
+00001990: 656e 6469 6e67 206f 6e20 7768 6574 6865  ending on whethe
+000019a0: 7220 7468 6520 696e 7075 7420 7468 6174  r the input that
+000019b0: 2063 7265 6174 6520 7468 6520 524f 4920   create the ROI 
+000019c0: 636f 6d70 7269 7365 640a 2020 2020 2020  comprised.      
+000019d0: 2020 2020 2020 2020 2020 2020 2020 6f66                of
+000019e0: 2063 6f6e 746f 7572 7320 6f72 2061 6e20   contours or an 
+000019f0: 6172 7261 792c 2072 6573 7065 6374 6976  array, respectiv
+00001a00: 656c 792e 0a0a 2020 2020 2020 2020 6f76  ely...        ov
+00001a10: 6572 6c61 705f 6c65 7665 6c20 3a20 666c  erlap_level : fl
+00001a20: 6f61 742c 2064 6566 6175 6c74 3d4e 6f6e  oat, default=Non
+00001a30: 650a 2020 2020 2020 2020 2020 2020 5573  e.            Us
+00001a40: 6564 2077 6865 6e20 636f 6e76 6572 7469  ed when converti
+00001a50: 6e67 2061 6e20 696e 7075 7420 524f 4920  ng an input ROI 
+00001a60: 636f 6e74 6f75 7220 746f 2061 206d 6173  contour to a mas
+00001a70: 6b3b 2072 6571 7569 7265 6420 0a20 2020  k; required .   
+00001a80: 2020 2020 2020 2020 206f 7665 726c 6170           overlap
+00001a90: 206f 6620 6120 7069 7865 6c20 7769 7468   of a pixel with
+00001aa0: 2074 6865 2052 4f49 2063 6f6e 746f 7572   the ROI contour
+00001ab0: 2069 6e20 6f72 6465 7220 666f 7220 7468   in order for th
+00001ac0: 6520 0a20 2020 2020 2020 2020 2020 2070  e .            p
+00001ad0: 6978 656c 2074 6f20 6265 2061 6464 6564  ixel to be added
+00001ae0: 2074 6f20 7468 6520 6d61 736b 2e20 4966   to the mask. If
+00001af0: 204e 6f6e 652c 2074 6865 206f 7574 7075   None, the outpu
+00001b00: 7420 6f66 200a 2020 2020 2020 2020 2020  t of .          
+00001b10: 2020 736b 696d 6167 652e 6472 6177 2e70    skimage.draw.p
+00001b20: 6f6c 7967 6f6e 326d 6173 6b20 7769 6c6c  olygon2mask will
+00001b30: 2062 6520 7265 7475 726e 6564 2077 6974   be returned wit
+00001b40: 6820 6e6f 2062 6f72 6465 7220 6368 6563  h no border chec
+00001b50: 6b73 2c20 0a20 2020 2020 2020 2020 2020  ks, .           
+00001b60: 2077 6869 6368 2069 7320 6661 7374 6572   which is faster
+00001b70: 2074 6861 6e20 7065 7266 6f72 6d69 6e67   than performing
+00001b80: 2062 6f72 6465 7220 6368 6563 6b73 2e0a   border checks..
+00001b90: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+00001ba0: 2020 616c 7068 615f 6f76 6572 5f62 6574    alpha_over_bet
+00001bb0: 6120 3a20 666c 6f61 742c 2064 6566 6175  a : float, defau
+00001bc0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00001bd0: 2020 2020 5261 7469 6f20 666f 7220 524f      Ratio for RO
+00001be0: 4920 7469 7373 7565 206f 6620 636f 6566  I tissue of coef
+00001bf0: 6669 6369 656e 7473 2c20 616c 7068 612c  ficients, alpha,
+00001c00: 2062 6574 612c 0a20 2020 2020 2020 2020   beta,.         
+00001c10: 2020 206f 6620 6c69 6e65 6172 2d71 7561     of linear-qua
+00001c20: 6472 6174 6963 2065 7175 6174 696f 6e2e  dratic equation.
+00001c30: 2020 5468 6973 2072 6174 696f 2069 7320    This ratio is 
+00001c40: 7573 6564 2069 6e0a 2020 2020 2020 2020  used in.        
+00001c50: 2020 2020 6361 6c63 756c 6174 696e 6720      calculating 
+00001c60: 6269 6f6c 6f67 6963 616c 6c79 2065 6666  biologically eff
+00001c70: 6563 7469 7665 2064 6f73 652c 2042 4544  ective dose, BED
+00001c80: 2c20 6672 6f6d 0a20 2020 2020 2020 2020  , from.         
+00001c90: 2020 2070 6879 7369 6361 6c20 646f 7365     physical dose
+00001ca0: 2c20 442c 2064 656c 6976 6572 6564 206f  , D, delivered o
+00001cb0: 7665 7220 6e20 6571 7561 6c20 6672 6163  ver n equal frac
+00001cc0: 7469 6f6e 733a 0a20 2020 2020 2020 2020  tions:.         
+00001cd0: 2020 2020 2020 2042 4544 203d 2044 202a         BED = D *
+00001ce0: 2028 3120 2b20 2844 2f6e 2920 2f20 2861   (1 + (D/n) / (a
+00001cf0: 6c70 6861 2f62 6574 6129 292e 0a20 2020  lpha/beta))..   
+00001d00: 2020 2020 2020 2020 2049 6620 4e6f 6e65           If None
+00001d10: 2c20 7468 6520 6269 6f6c 6f67 6963 616c  , the biological
+00001d20: 6c79 2065 6666 6563 7469 7665 2064 6f73  ly effective dos
+00001d30: 6520 6973 2074 616b 656e 2074 6f20 6265  e is taken to be
+00001d40: 0a20 2020 2020 2020 2020 2020 2065 7175  .            equ
+00001d50: 616c 2074 6f20 7468 6520 7068 7973 6963  al to the physic
+00001d60: 616c 2064 6f73 6520 2862 6574 6120 3e3e  al dose (beta >>
+00001d70: 2061 6c70 6861 292e 0a0a 2020 2020 2020   alpha)...      
+00001d80: 2020 6b77 6172 6773 203a 2064 6963 742c    kwargs : dict,
+00001d90: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00001da0: 2020 2020 2020 2020 2020 4578 7472 6120            Extra 
+00001db0: 6172 6775 6d65 6e74 7320 746f 2070 6173  arguments to pas
+00001dc0: 7320 746f 2074 6865 2069 6e69 7469 616c  s to the initial
+00001dd0: 6973 6174 696f 6e20 6f66 2074 6865 2070  isation of the p
+00001de0: 6172 656e 740a 2020 2020 2020 2020 2020  arent.          
+00001df0: 2020 496d 6167 6520 6f62 6a65 6374 2e0a    Image object..
+00001e00: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00001e10: 2020 2020 2023 2043 6c6f 6e65 2066 726f       # Clone fro
+00001e20: 6d20 616e 6f74 6865 7220 524f 4920 6f62  m another ROI ob
+00001e30: 6a65 6374 0a20 2020 2020 2020 2069 6620  ject.        if 
+00001e40: 6973 7375 6263 6c61 7373 2874 7970 6528  issubclass(type(
+00001e50: 736f 7572 6365 292c 2052 4f49 293a 0a20  source), ROI):. 
+00001e60: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
+00001e70: 652e 636c 6f6e 655f 6174 7472 7328 7365  e.clone_attrs(se
+00001e80: 6c66 290a 2020 2020 2020 2020 2020 2020  lf).            
+00001e90: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
+00001ea0: 2320 5072 6f63 6573 7320 636f 6e74 6f75  # Process contou
+00001eb0: 7220 6469 6374 696f 6e61 7279 0a20 2020  r dictionary.   
+00001ec0: 2020 2020 2073 656c 662e 696e 7075 745f       self.input_
+00001ed0: 636f 6e74 6f75 7273 203d 204e 6f6e 650a  contours = None.
+00001ee0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00001ef0: 7461 6e63 6528 736f 7572 6365 2c20 6469  tance(source, di
+00001f00: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
+00001f10: 2073 656c 662e 736f 7572 6365 203d 204e   self.source = N
+00001f20: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00001f30: 7365 6c66 2e69 6e70 7574 5f63 6f6e 746f  self.input_conto
+00001f40: 7572 7320 3d20 7b7d 0a20 2020 2020 2020  urs = {}.       
+00001f50: 2020 2020 2066 6f72 207a 2c20 636f 6e74       for z, cont
+00001f60: 6f75 7273 2069 6e20 736f 7572 6365 2e69  ours in source.i
+00001f70: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+00001f80: 2020 2020 2020 2020 7365 6c66 2e69 6e70          self.inp
+00001f90: 7574 5f63 6f6e 746f 7572 735b 7a5d 203d  ut_contours[z] =
+00001fa0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00001fb0: 2020 2020 666f 7220 636f 6e74 6f75 7220      for contour 
+00001fc0: 696e 2063 6f6e 746f 7572 733a 0a20 2020  in contours:.   
 00001fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001fe0: 2020 2073 656c 662e 696e 7075 745f 636f     self.input_co
-00001ff0: 6e74 6f75 7273 5b7a 5d2e 6170 7065 6e64  ntours[z].append
-00002000: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00002010: 2020 2020 2020 2020 2020 2020 2020 6e70                np
-00002020: 2e63 6f6c 756d 6e5f 7374 6163 6b28 636f  .column_stack(co
-00002030: 6e74 6f75 722e 6578 7465 7269 6f72 2e78  ntour.exterior.x
-00002040: 7929 0a20 2020 2020 2020 2020 2020 2020  y).             
-00002050: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00002060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002070: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00002080: 2863 6f6e 746f 7572 2c0a 2020 2020 2020  (contour,.      
+00001fe0: 2069 6620 6973 696e 7374 616e 6365 2863   if isinstance(c
+00001ff0: 6f6e 746f 7572 2c20 6765 6f6d 6574 7279  ontour, geometry
+00002000: 2e70 6f6c 7967 6f6e 2e50 6f6c 7967 6f6e  .polygon.Polygon
+00002010: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00002020: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00002030: 696e 7075 745f 636f 6e74 6f75 7273 5b7a  input_contours[z
+00002040: 5d2e 6170 7065 6e64 280a 2020 2020 2020  ].append(.      
+00002050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002060: 2020 2020 2020 6e70 2e63 6f6c 756d 6e5f        np.column_
+00002070: 7374 6163 6b28 636f 6e74 6f75 722e 6578  stack(contour.ex
+00002080: 7465 7269 6f72 2e78 7929 0a20 2020 2020  terior.xy).     
 00002090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000020a0: 2020 2020 2020 6765 6f6d 6574 7279 2e6d        geometry.m
-000020b0: 756c 7469 706f 6c79 676f 6e2e 4d75 6c74  ultipolygon.Mult
-000020c0: 6950 6f6c 7967 6f6e 293a 0a20 2020 2020  iPolygon):.     
-000020d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000020e0: 2020 2066 6f72 2070 6f6c 7967 6f6e 2069     for polygon i
-000020f0: 6e20 636f 6e74 6f75 722e 6765 6f6d 733a  n contour.geoms:
-00002100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002110: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00002120: 662e 696e 7075 745f 636f 6e74 6f75 7273  f.input_contours
-00002130: 5b7a 5d2e 6170 7065 6e64 280a 2020 2020  [z].append(.    
-00002140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002150: 2020 2020 2020 2020 2020 2020 6e70 2e63              np.c
-00002160: 6f6c 756d 6e5f 7374 6163 6b28 706f 6c79  olumn_stack(poly
-00002170: 676f 6e2e 6578 7465 7269 6f72 2e78 7929  gon.exterior.xy)
-00002180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002190: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000021a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000021b0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000021c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000021d0: 662e 696e 7075 745f 636f 6e74 6f75 7273  f.input_contours
-000021e0: 5b7a 5d2e 6170 7065 6e64 2863 6f6e 746f  [z].append(conto
-000021f0: 7572 290a 2020 2020 2020 2020 656c 7365  ur).        else
-00002200: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00002210: 6c66 2e73 6f75 7263 6520 3d20 2873 6b72  lf.source = (skr
-00002220: 742e 636f 7265 2e66 756c 6c70 6174 6828  t.core.fullpath(
-00002230: 736f 7572 6365 290a 2020 2020 2020 2020  source).        
-00002240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002250: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00002260: 2873 6f75 7263 652c 2028 7374 722c 2050  (source, (str, P
-00002270: 6174 6829 2920 656c 7365 2073 6f75 7263  ath)) else sourc
-00002280: 6529 0a0a 2020 2020 2020 2020 2320 4173  e)..        # As
-00002290: 7369 676e 206f 7468 6572 2070 726f 7065  sign other prope
-000022a0: 7274 6965 730a 2020 2020 2020 2020 7365  rties.        se
-000022b0: 6c66 2e63 7573 746f 6d5f 636f 6c6f 7220  lf.custom_color 
-000022c0: 3d20 636f 6c6f 7220 6973 206e 6f74 204e  = color is not N
-000022d0: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
-000022e0: 2e73 6574 5f63 6f6c 6f72 2863 6f6c 6f72  .set_color(color
-000022f0: 290a 2020 2020 2020 2020 7365 6c66 2e6d  ).        self.m
-00002300: 6173 6b20 3d20 4e6f 6e65 0a20 2020 2020  ask = None.     
-00002310: 2020 2073 656c 662e 696d 6167 6520 3d20     self.image = 
-00002320: 696d 6167 650a 2020 2020 2020 2020 6966  image.        if
-00002330: 2069 6d61 6765 2061 6e64 206e 6f74 2069   image and not i
-00002340: 7369 6e73 7461 6e63 6528 696d 6167 652c  sinstance(image,
-00002350: 2073 6b72 742e 696d 6167 652e 496d 6167   skrt.image.Imag
-00002360: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00002370: 7365 6c66 2e69 6d61 6765 203d 2073 6b72  self.image = skr
-00002380: 742e 696d 6167 652e 496d 6167 6528 696d  t.image.Image(im
-00002390: 6167 6529 0a20 2020 2020 2020 2073 656c  age).        sel
-000023a0: 662e 7368 6170 6520 3d20 7368 6170 650a  f.shape = shape.
-000023b0: 2020 2020 2020 2020 7365 6c66 2e61 6666          self.aff
-000023c0: 696e 652c 2073 656c 662e 766f 7865 6c5f  ine, self.voxel_
-000023d0: 7369 7a65 2c20 7365 6c66 2e6f 7269 6769  size, self.origi
-000023e0: 6e20 3d20 5c0a 2020 2020 2020 2020 2020  n = \.          
-000023f0: 2020 2020 2020 736b 7274 2e69 6d61 6765        skrt.image
-00002400: 2e67 6574 5f67 656f 6d65 7472 7928 6166  .get_geometry(af
-00002410: 6669 6e65 2c20 766f 7865 6c5f 7369 7a65  fine, voxel_size
-00002420: 2c20 6f72 6967 696e 290a 2020 2020 2020  , origin).      
-00002430: 2020 7365 6c66 2e73 6c69 6365 5f74 6869    self.slice_thi
-00002440: 636b 6e65 7373 5f63 6f6e 746f 7572 7320  ckness_contours 
-00002450: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
-00002460: 656c 662e 6d61 736b 5f74 6872 6573 686f  elf.mask_thresho
-00002470: 6c64 203d 206d 6173 6b5f 7468 7265 7368  ld = mask_thresh
-00002480: 6f6c 640a 2020 2020 2020 2020 7365 6c66  old.        self
-00002490: 2e6f 7665 726c 6170 5f6c 6576 656c 203d  .overlap_level =
-000024a0: 206f 7665 726c 6170 5f6c 6576 656c 0a20   overlap_level. 
-000024b0: 2020 2020 2020 2073 656c 662e 636f 6e74         self.cont
-000024c0: 6f75 7273 203d 207b 7d0a 2020 2020 2020  ours = {}.      
-000024d0: 2020 7365 6c66 2e64 6566 6175 6c74 5f67    self.default_g
-000024e0: 656f 6d5f 6d65 7468 6f64 203d 2064 6566  eom_method = def
-000024f0: 6175 6c74 5f67 656f 6d5f 6d65 7468 6f64  ault_geom_method
-00002500: 0a20 2020 2020 2020 2073 656c 662e 6b77  .        self.kw
-00002510: 6172 6773 203d 206b 7761 7267 730a 2020  args = kwargs.  
-00002520: 2020 2020 2020 7365 6c66 2e73 6f75 7263        self.sourc
-00002530: 655f 7479 7065 203d 204e 6f6e 650a 2020  e_type = None.  
-00002540: 2020 2020 2020 7365 6c66 2e64 6963 6f6d        self.dicom
-00002550: 5f64 6174 6173 6574 203d 204e 6f6e 650a  _dataset = None.
-00002560: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
-00002570: 746f 7572 735f 6f6e 6c79 203d 2046 616c  tours_only = Fal
-00002580: 7365 0a20 2020 2020 2020 2073 656c 662e  se.        self.
-00002590: 706c 616e 7320 3d20 5b5d 0a20 2020 2020  plans = [].     
-000025a0: 2020 2073 656c 662e 616c 7068 615f 6f76     self.alpha_ov
-000025b0: 6572 5f62 6574 6120 3d20 616c 7068 615f  er_beta = alpha_
-000025c0: 6f76 6572 5f62 6574 610a 0a20 2020 2020  over_beta..     
-000025d0: 2020 2023 2050 726f 7065 7274 6965 7320     # Properties 
-000025e0: 7265 6c61 7469 6e67 2074 6f20 706c 616e  relating to plan
-000025f0: 2064 6f73 6520 636f 6e73 7472 6169 6e74   dose constraint
-00002600: 730a 2020 2020 2020 2020 7365 6c66 2e72  s.        self.r
-00002610: 6f69 5f74 7970 6520 3d20 4e6f 6e65 0a20  oi_type = None. 
-00002620: 2020 2020 2020 2073 656c 662e 636f 6e73         self.cons
-00002630: 7472 6169 6e74 203d 204e 6f6e 650a 0a20  traint = None.. 
-00002640: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
-00002650: 6e61 6d65 0a20 2020 2020 2020 2073 656c  name.        sel
-00002660: 662e 6e61 6d65 203d 206e 616d 650a 2020  f.name = name.  
-00002670: 2020 2020 2020 6966 2073 656c 662e 6e61        if self.na
-00002680: 6d65 2069 7320 4e6f 6e65 3a0a 2020 2020  me is None:.    
-00002690: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000026a0: 7461 6e63 6528 7365 6c66 2e73 6f75 7263  tance(self.sourc
-000026b0: 652c 2073 7472 293a 0a20 2020 2020 2020  e, str):.       
-000026c0: 2020 2020 2020 2020 2062 6173 656e 616d           basenam
-000026d0: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
-000026e0: 6e61 6d65 2873 656c 662e 736f 7572 6365  name(self.source
-000026f0: 292e 7370 6c69 7428 222e 2229 5b30 5d0a  ).split(".")[0].
-00002700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002710: 6e61 6d65 203d 2072 652e 7375 6228 7222  name = re.sub(r"
-00002720: 5254 5354 5255 4354 5f5b 4d56 4354 5d2b  RTSTRUCT_[MVCT]+
-00002730: 5f5c 642b 5f5c 642b 5f5c 642b 222c 2022  _\d+_\d+_\d+", "
-00002740: 222c 2062 6173 656e 616d 6529 0a20 2020  ", basename).   
-00002750: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00002760: 7365 6c66 2e6e 616d 6520 3d20 6e61 6d65  self.name = name
-00002770: 5b30 5d2e 7570 7065 7228 2920 2b20 6e61  [0].upper() + na
-00002780: 6d65 5b31 3a5d 0a20 2020 2020 2020 2020  me[1:].         
-00002790: 2020 2020 2020 2073 656c 662e 6e61 6d65         self.name
-000027a0: 203d 206e 616d 650a 2020 2020 2020 2020   = name.        
-000027b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000027c0: 2020 2020 2020 2020 2020 7365 6c66 2e6e            self.n
-000027d0: 616d 6520 3d20 524f 4944 6566 6175 6c74  ame = ROIDefault
-000027e0: 7328 292e 6765 745f 6465 6661 756c 745f  s().get_default_
-000027f0: 726f 695f 6e61 6d65 2829 0a20 2020 2020  roi_name().     
-00002800: 2020 2073 656c 662e 6f72 6967 696e 616c     self.original
-00002810: 5f6e 616d 6520 3d20 6e61 6d65 0a20 2020  _name = name.   
-00002820: 2020 2020 2073 656c 662e 7469 746c 6520       self.title 
-00002830: 3d20 4e6f 6e65 0a0a 2020 2020 2020 2020  = None..        
-00002840: 2320 524f 4920 6e75 6d62 6572 2061 7320  # ROI number as 
-00002850: 6465 6669 6e65 6420 696e 2044 4943 4f4d  defined in DICOM
-00002860: 2052 5453 5452 5543 5420 6669 6c65 2e0a   RTSTRUCT file..
-00002870: 2020 2020 2020 2020 2320 4c65 6674 2074          # Left t
-00002880: 6f20 4e6f 6e65 2066 6f72 2052 4f49 206c  o None for ROI l
-00002890: 6f61 6465 6420 6672 6f6d 206e 6f6e 2d44  oaded from non-D
-000028a0: 4943 4f4d 2073 6f75 7263 652e 0a20 2020  ICOM source..   
-000028b0: 2020 2020 2073 656c 662e 6e75 6d62 6572       self.number
-000028c0: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
-000028d0: 2023 204c 6f61 6420 524f 4920 6461 7461   # Load ROI data
-000028e0: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-000028f0: 6164 6564 203d 2046 616c 7365 0a20 2020  aded = False.   
-00002900: 2020 2020 2073 656c 662e 6c6f 6164 6564       self.loaded
-00002910: 5f6d 6173 6b20 3d20 4661 6c73 650a 2020  _mask = False.  
-00002920: 2020 2020 2020 6966 206c 6f61 643a 0a20        if load:. 
-00002930: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00002940: 6c6f 6164 2829 0a0a 2020 2020 2020 2020  load()..        
-00002950: 2320 496e 6974 6961 6c69 7365 2061 7320  # Initialise as 
-00002960: 736b 7274 2e63 6f72 652e 4172 6368 6976  skrt.core.Archiv
-00002970: 6520 6f62 6a65 6374 0a20 2020 2020 2020  e object.       
-00002980: 2070 6174 6820 3d20 7365 6c66 2e73 6f75   path = self.sou
-00002990: 7263 6520 6966 2069 7369 6e73 7461 6e63  rce if isinstanc
-000029a0: 6528 7365 6c66 2e73 6f75 7263 652c 2073  e(self.source, s
-000029b0: 7472 2920 656c 7365 2022 220a 2020 2020  tr) else "".    
-000029c0: 2020 2020 736b 7274 2e63 6f72 652e 4172      skrt.core.Ar
-000029d0: 6368 6976 652e 5f5f 696e 6974 5f5f 2873  chive.__init__(s
-000029e0: 656c 662c 2070 6174 6829 0a0a 2020 2020  elf, path)..    
-000029f0: 6465 6620 5f5f 6571 5f5f 2873 656c 662c  def __eq__(self,
-00002a00: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
-00002a10: 2072 6574 7572 6e20 6f74 6865 7220 6973   return other is
-00002a20: 2073 656c 660a 0a20 2020 2064 6566 206c   self..    def l
-00002a30: 6f61 6428 7365 6c66 2c20 666f 7263 653d  oad(self, force=
-00002a40: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-00002a50: 2222 224c 6f61 6420 524f 4920 6672 6f6d  """Load ROI from
-00002a60: 2066 696c 6520 6f72 2073 6f75 7263 652e   file or source.
-00002a70: 2054 6865 206c 6f61 6469 6e67 2073 6571   The loading seq
-00002a80: 7565 6e63 6520 6973 2061 7320 666f 6c6c  uence is as foll
-00002a90: 6f77 733a 0a0a 2020 2020 2020 2020 312e  ows:..        1.
-00002aa0: 2049 6620 7365 6c66 2e69 6d61 6765 2069   If self.image i
-00002ab0: 7320 6e6f 7420 4e6f 6e65 2c20 656e 7375  s not None, ensu
-00002ac0: 7265 2074 6861 7420 7468 6520 696d 6167  re that the imag
-00002ad0: 6520 6973 206c 6f61 6465 6420 616e 6420  e is loaded and 
-00002ae0: 0a20 2020 2020 2020 2061 7373 6967 6e20  .        assign 
-00002af0: 6974 7320 6765 6f6d 6574 7269 6320 7072  its geometric pr
-00002b00: 6f70 6572 7469 6573 2074 6f20 7468 6973  operties to this
-00002b10: 2052 4f49 2e0a 0a20 2020 2020 2020 2032   ROI...        2
-00002b20: 2e20 4174 7465 6d70 7420 746f 206c 6f61  . Attempt to loa
-00002b30: 6420 6461 7461 2066 726f 6d20 7365 6c66  d data from self
-00002b40: 2e73 6f75 7263 653a 0a0a 2020 2020 2020  .source:..      
-00002b50: 2020 2861 2920 4966 2074 6869 7320 6973    (a) If this is
-00002b60: 2061 6e20 496d 6167 6520 6f62 6a65 6374   an Image object
-00002b70: 2c20 7468 6520 524f 4920 7769 6c6c 2062  , the ROI will b
-00002b80: 6520 6372 6561 7465 6420 6279 2061 7070  e created by app
-00002b90: 6c79 696e 6720 6120 0a20 2020 2020 2020  lying a .       
-00002ba0: 2074 6872 6573 686f 6c64 2074 6f20 7468   threshold to th
-00002bb0: 6520 496d 6167 6527 7320 6172 7261 792e  e Image's array.
-00002bc0: 2053 6574 2073 656c 662e 6d61 736b 2074   Set self.mask t
-00002bd0: 6f20 7468 6520 7468 7265 7368 6f6c 6465  o the thresholde
-00002be0: 6420 696d 6167 650a 2020 2020 2020 2020  d image.        
-00002bf0: 616e 6420 7365 6c66 2e69 6e70 7574 5f74  and self.input_t
-00002c00: 7970 6520 3d20 226d 6173 6b22 2e0a 2020  ype = "mask"..  
-00002c10: 2020 2020 2020 2862 2920 4966 2073 656c        (b) If sel
-00002c20: 662e 736f 7572 6365 2069 7320 6120 7374  f.source is a st
-00002c30: 7269 6e67 2c20 6174 7465 6d70 7420 746f  ring, attempt to
-00002c40: 206c 6f61 6420 6672 6f6d 2061 2066 696c   load from a fil
-00002c50: 650a 2020 2020 2020 2020 636f 6e66 6f72  e.        confor
-00002c60: 6d69 6e67 2074 6f20 7472 616e 7366 6f72  ming to transfor
-00002c70: 6d69 7820 6f75 7470 7574 2028 2e74 7874  mix output (.txt
-00002c80: 2065 7874 656e 7369 6f6e 2920 6f72 2066   extension) or f
-00002c90: 726f 6d20 610a 2020 2020 2020 2020 6469  rom a.        di
-00002ca0: 636f 6d20 7374 7275 6374 7572 6520 7365  com structure se
-00002cb0: 7420 2869 6e20 626f 7468 2063 6173 6573  t (in both cases
-00002cc0: 2073 6574 7469 6e67 2073 656c 662e 696e   setting self.in
-00002cd0: 7075 745f 636f 6e74 6f75 7273 292e 0a20  put_contours).. 
-00002ce0: 2020 2020 2020 2028 6329 2049 6620 7472         (c) If tr
-00002cf0: 616e 7366 6f72 6d69 7820 6f72 2064 6963  ansformix or dic
-00002d00: 6f6d 206c 6f61 6469 6e67 2066 6169 6c73  om loading fails
-00002d10: 2c20 6174 7465 6d70 7420 746f 206c 6f61  , attempt to loa
-00002d20: 640a 2020 2020 2020 2020 7365 6c66 2e73  d.        self.s
-00002d30: 6f75 7263 6520 6173 2061 6e20 496d 6167  ource as an Imag
-00002d40: 6520 6f62 6a65 6374 2074 6f20 6372 6561  e object to crea
-00002d50: 7465 2061 6e20 524f 4920 6d61 736b 2e20  te an ROI mask. 
-00002d60: 4966 2074 6869 730a 2020 2020 2020 2020  If this.        
-00002d70: 6669 6e64 7320 6120 7661 6c69 6420 496d  finds a valid Im
-00002d80: 6167 652c 2073 6574 2073 656c 662e 6d61  age, set self.ma
-00002d90: 736b 2074 6f20 7468 6174 2069 6d61 6765  sk to that image
-00002da0: 2061 6e64 2073 6574 0a20 2020 2020 2020   and set.       
-00002db0: 2073 656c 662e 696e 7075 745f 7479 7065   self.input_type
-00002dc0: 203d 2022 6d61 736b 222e 0a20 2020 2020   = "mask"..     
-00002dd0: 2020 2028 6429 2049 6620 7365 6c66 2e73     (d) If self.s
-00002de0: 6f75 7263 6520 6973 204e 6f6e 652c 2064  ource is None, d
-00002df0: 6f20 6e6f 7468 696e 6720 7769 7468 2069  o nothing with i
-00002e00: 742e 0a0a 2020 2020 2020 2020 332e 2043  t...        3. C
-00002e10: 6865 636b 2077 6865 7468 6572 2073 656c  heck whether sel
-00002e20: 662e 696e 7075 745f 636f 6e74 6f75 7273  f.input_contours
-00002e30: 2063 6f6e 7461 696e 7320 6461 7461 2e20   contains data. 
-00002e40: 5468 6973 2063 6f75 6c64 2061 7269 7365  This could arise
-00002e50: 0a20 2020 2020 2020 2069 6e20 7477 6f20  .        in two 
-00002e60: 7363 656e 6172 696f 733a 0a20 2020 2020  scenarios:.     
-00002e70: 2020 200a 2020 2020 2020 2020 2861 2920     .        (a) 
-00002e80: 5468 6520 524f 4920 7761 7320 696e 6974  The ROI was init
-00002e90: 6961 6c69 7365 6420 6672 6f6d 2061 2064  ialised from a d
-00002ea0: 6963 7420 6f66 2063 6f6e 746f 7572 732c  ict of contours,
-00002eb0: 2077 6869 6368 2077 6572 650a 2020 2020   which were.    
-00002ec0: 2020 2020 6173 7369 676e 6564 2074 6f20      assigned to 
-00002ed0: 7365 6c66 2e69 6e70 7574 5f63 6f6e 746f  self.input_conto
-00002ee0: 7572 7320 696e 2073 656c 662e 5f5f 696e  urs in self.__in
-00002ef0: 6974 2829 3b20 6f72 0a20 2020 2020 2020  it(); or.       
-00002f00: 2028 6229 2041 2073 6574 206f 6620 636f   (b) A set of co
-00002f10: 6e74 6f75 7273 2077 6173 2073 7563 6365  ntours was succe
-00002f20: 7373 6675 6c6c 7920 6c6f 6164 6564 2066  ssfully loaded f
-00002f30: 726f 6d20 6120 7472 616e 7366 6f72 6d69  rom a transformi
-00002f40: 7820 6f72 0a20 2020 2020 2020 2064 6963  x or.        dic
-00002f50: 6f6d 2066 696c 6520 666f 756e 6420 6174  om file found at
-00002f60: 2073 656c 662e 736f 7572 6365 2069 6e20   self.source in 
-00002f70: 7374 6570 2031 2862 292e 0a0a 2020 2020  step 1(b)...    
-00002f80: 2020 2020 4966 2069 6e70 7574 2063 6f6e      If input con
-00002f90: 746f 7572 7320 6172 6520 666f 756e 642c  tours are found,
-00002fa0: 2074 6865 7365 2061 7265 2061 7373 6967   these are assig
-00002fb0: 6e65 6420 746f 2073 656c 662e 636f 6e74  ned to self.cont
-00002fc0: 6f75 7273 5b22 782d 7922 5d0a 2020 2020  ours["x-y"].    
-00002fd0: 2020 2020 616e 6420 7365 6c66 2e73 6f75      and self.sou
-00002fe0: 7263 655f 7479 7065 2069 7320 7365 7420  rce_type is set 
-00002ff0: 746f 2022 636f 6e74 6f75 7222 2e20 4164  to "contour". Ad
-00003000: 6469 7469 6f6e 616c 6c79 2c20 6966 2073  ditionally, if s
-00003010: 656c 662e 696d 6167 650a 2020 2020 2020  elf.image.      
-00003020: 2020 6973 206e 6f74 204e 6f6e 652c 2073    is not None, s
-00003030: 6574 2073 656c 662e 6d61 736b 2074 6f20  et self.mask to 
-00003040: 616e 2061 7272 6179 206f 6620 7a65 726f  an array of zero
-00003050: 7320 7468 6520 7361 6d65 2073 697a 6520  s the same size 
-00003060: 6173 2074 6865 200a 2020 2020 2020 2020  as the .        
-00003070: 696d 6167 652e 0a0a 2020 2020 2020 2020  image...        
-00003080: 342e 2053 6574 2061 2066 6c61 6720 696e  4. Set a flag in
-00003090: 6469 6361 7469 6e67 2077 6865 7468 6572  dicating whether
-000030a0: 2074 6869 7320 524f 4920 6861 7320 636f   this ROI has co
-000030b0: 6e74 6f75 7273 206f 6e6c 7920 2869 2e65  ntours only (i.e
-000030c0: 206e 6f0a 2020 2020 2020 2020 6d61 736b   no.        mask
-000030d0: 206f 7220 696d 6167 6520 6672 6f6d 2077   or image from w
-000030e0: 6869 6368 2074 6f20 6472 6177 206f 7269  hich to draw ori
-000030f0: 6769 6e2f 766f 7865 6c20 7369 7a65 7329  gin/voxel sizes)
-00003100: 2c20 616e 6420 7365 740a 2020 2020 2020  , and set.      
-00003110: 2020 6465 6661 756c 7420 6765 6f6d 6574    default geomet
-00003120: 7269 6320 6361 6c63 756c 6174 696f 6e20  ric calculation 
-00003130: 6d65 7468 6f64 2074 6f20 7365 6c66 2e73  method to self.s
-00003140: 6f75 7263 655f 7479 7065 2e20 5365 740a  ource_type. Set.
-00003150: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-00003160: 6465 6420 746f 2054 7275 652e 0a20 2020  ded to True..   
-00003170: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00003180: 2020 6966 2073 656c 662e 6c6f 6164 6564    if self.loaded
-00003190: 2061 6e64 206e 6f74 2066 6f72 6365 3a0a   and not force:.
-000031a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000031b0: 726e 0a0a 2020 2020 2020 2020 6966 2073  rn..        if s
-000031c0: 656c 662e 696d 6167 653a 0a20 2020 2020  elf.image:.     
-000031d0: 2020 2020 2020 2073 656c 662e 696d 6167         self.imag
-000031e0: 652e 6c6f 6164 2829 0a20 2020 2020 2020  e.load().       
-000031f0: 2020 2020 2073 656c 662e 7368 6170 6520       self.shape 
-00003200: 3d20 7365 6c66 2e69 6d61 6765 2e67 6574  = self.image.get
-00003210: 5f64 6174 6128 292e 7368 6170 650a 2020  _data().shape.  
-00003220: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00003230: 6666 696e 6520 3d20 7365 6c66 2e69 6d61  ffine = self.ima
-00003240: 6765 2e67 6574 5f61 6666 696e 6528 290a  ge.get_affine().
-00003250: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00003260: 2e76 6f78 656c 5f73 697a 6520 3d20 7365  .voxel_size = se
-00003270: 6c66 2e69 6d61 6765 2e67 6574 5f76 6f78  lf.image.get_vox
-00003280: 656c 5f73 697a 6528 290a 2020 2020 2020  el_size().      
-00003290: 2020 2020 2020 7365 6c66 2e6f 7269 6769        self.origi
-000032a0: 6e20 3d20 7365 6c66 2e69 6d61 6765 2e67  n = self.image.g
-000032b0: 6574 5f6f 7269 6769 6e28 290a 0a20 2020  et_origin()..   
-000032c0: 2020 2020 2072 6f69 7320 3d20 5b5d 0a0a       rois = []..
-000032d0: 2020 2020 2020 2020 2320 4c6f 6164 2066          # Load f
-000032e0: 726f 6d20 616e 2065 7869 7374 696e 6720  rom an existing 
-000032f0: 496d 6167 650a 2020 2020 2020 2020 6966  Image.        if
-00003300: 2069 7373 7562 636c 6173 7328 7479 7065   issubclass(type
-00003310: 2873 656c 662e 736f 7572 6365 292c 2073  (self.source), s
-00003320: 6b72 742e 696d 6167 652e 496d 6167 6529  krt.image.Image)
-00003330: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00003340: 206e 6f74 2073 656c 662e 696d 6167 653a   not self.image:
-00003350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003360: 2073 656c 662e 696d 6167 6520 3d20 7365   self.image = se
-00003370: 6c66 2e73 6f75 7263 650a 2020 2020 2020  lf.source.      
-00003380: 2020 2020 2020 7365 6c66 2e6d 6173 6b20        self.mask 
-00003390: 3d20 736b 7274 2e69 6d61 6765 2e49 6d61  = skrt.image.Ima
-000033a0: 6765 280a 2020 2020 2020 2020 2020 2020  ge(.            
-000033b0: 2020 2020 7365 6c66 2e73 6f75 7263 652e      self.source.
-000033c0: 6765 745f 6461 7461 2829 203e 2073 656c  get_data() > sel
-000033d0: 662e 6d61 736b 5f74 6872 6573 686f 6c64  f.mask_threshold
-000033e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000033f0: 2020 6166 6669 6e65 3d73 656c 662e 736f    affine=self.so
-00003400: 7572 6365 2e67 6574 5f61 6666 696e 6528  urce.get_affine(
-00003410: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00003420: 2020 2064 7479 7065 3d62 6f6f 6c0a 2020     dtype=bool.  
-00003430: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00003440: 2020 2020 2020 2020 7365 6c66 2e73 6f75          self.sou
-00003450: 7263 655f 7479 7065 203d 2022 6d61 736b  rce_type = "mask
-00003460: 220a 2020 2020 2020 2020 2020 2020 7365  ".            se
-00003470: 6c66 2e6c 6f61 6465 6420 3d20 5472 7565  lf.loaded = True
-00003480: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00003490: 662e 6372 6561 7465 5f6d 6173 6b28 290a  f.create_mask().
-000034a0: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-000034b0: 696e 7374 616e 6365 2873 656c 662e 736f  instance(self.so
-000034c0: 7572 6365 2c20 7374 7229 3a0a 2020 2020  urce, str):.    
-000034d0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000034e0: 736f 7572 6365 2e65 6e64 7377 6974 6828  source.endswith(
-000034f0: 272e 7478 7427 293a 0a20 2020 2020 2020  '.txt'):.       
-00003500: 2020 2020 2020 2020 2023 2054 7279 206c           # Try l
-00003510: 6f61 6469 6e67 2066 726f 6d20 7472 616e  oading from tran
-00003520: 7366 6f72 6d69 782d 636f 6d70 6174 6962  sformix-compatib
-00003530: 6c65 2070 6f69 6e74 2063 6c6f 7564 0a20  le point cloud. 
-00003540: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00003550: 6f69 6e74 7320 3d20 7365 6c66 2e6c 6f61  oints = self.loa
-00003560: 645f 7472 616e 7366 6f72 6d69 785f 706f  d_transformix_po
-00003570: 696e 7473 2829 0a0a 2020 2020 2020 2020  ints()..        
-00003580: 2020 2020 2020 2020 2320 4578 7472 6163          # Extrac
-00003590: 7420 736c 6963 652d 6279 2d73 6c69 6365  t slice-by-slice
-000035a0: 2064 6963 7469 6f6e 6172 7920 6f66 2028   dictionary of (
-000035b0: 782c 2079 2920 706f 696e 7473 0a20 2020  x, y) points.   
-000035c0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-000035d0: 746f 7572 7320 3d20 7b7d 0a20 2020 2020  tours = {}.     
-000035e0: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
-000035f0: 6f69 6e74 2069 6e20 736f 7274 6564 2870  oint in sorted(p
-00003600: 6f69 6e74 7329 3a0a 2020 2020 2020 2020  oints):.        
-00003610: 2020 2020 2020 2020 2020 2020 785f 706f              x_po
-00003620: 696e 742c 2079 5f70 6f69 6e74 2c20 7a5f  int, y_point, z_
-00003630: 706f 696e 7420 3d20 706f 696e 7473 5b70  point = points[p
-00003640: 6f69 6e74 5d5b 274f 7574 7075 7450 6f69  oint]['OutputPoi
-00003650: 6e74 275d 0a20 2020 2020 2020 2020 2020  nt'].           
-00003660: 2020 2020 2020 2020 206b 6579 203d 2066           key = f
-00003670: 277b 7a5f 706f 696e 743a 2e32 667d 270a  '{z_point:.2f}'.
-00003680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003690: 2020 2020 6966 206e 6f74 206b 6579 2069      if not key i
-000036a0: 6e20 636f 6e74 6f75 7273 3a0a 2020 2020  n contours:.    
-000036b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000036c0: 2020 2020 636f 6e74 6f75 7273 5b6b 6579      contours[key
-000036d0: 5d20 3d20 7b7d 0a20 2020 2020 2020 2020  ] = {}.         
-000036e0: 2020 2020 2020 2020 2020 2063 5f69 6e64             c_ind
-000036f0: 6578 203d 2070 6f69 6e74 735b 706f 696e  ex = points[poin
-00003700: 745d 5b27 436f 6e74 6f75 7249 6e64 6578  t]['ContourIndex
-00003710: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-00003720: 2020 2020 2020 2069 6620 6e6f 7420 635f         if not c_
-00003730: 696e 6465 7820 696e 2063 6f6e 746f 7572  index in contour
-00003740: 735b 6b65 795d 3a0a 2020 2020 2020 2020  s[key]:.        
-00003750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003760: 636f 6e74 6f75 7273 5b6b 6579 5d5b 635f  contours[key][c_
-00003770: 696e 6465 785d 203d 205b 5d0a 2020 2020  index] = [].    
-00003780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003790: 636f 6e74 6f75 7273 5b6b 6579 5d5b 635f  contours[key][c_
-000037a0: 696e 6465 785d 2e61 7070 656e 6428 5b78  index].append([x
-000037b0: 5f70 6f69 6e74 2c20 795f 706f 696e 745d  _point, y_point]
-000037c0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-000037d0: 2020 2023 2053 746f 7265 2074 6865 206c     # Store the l
-000037e0: 6973 7420 6f66 2063 6f6e 746f 7572 732e  ist of contours.
-000037f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003800: 2073 656c 662e 696e 7075 745f 636f 6e74   self.input_cont
-00003810: 6f75 7273 203d 207b 7d0a 2020 2020 2020  ours = {}.      
-00003820: 2020 2020 2020 2020 2020 666f 7220 6b65            for ke
-00003830: 7920 696e 2073 6f72 7465 6428 636f 6e74  y in sorted(cont
-00003840: 6f75 7273 293a 0a20 2020 2020 2020 2020  ours):.         
-00003850: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00003860: 696e 7075 745f 636f 6e74 6f75 7273 5b66  input_contours[f
-00003870: 6c6f 6174 286b 6579 295d 203d 205b 5d0a  loat(key)] = [].
-00003880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003890: 2020 2020 666f 7220 635f 696e 6465 7820      for c_index 
-000038a0: 696e 2073 6f72 7465 6428 636f 6e74 6f75  in sorted(contou
-000038b0: 7273 5b6b 6579 5d29 3a0a 2020 2020 2020  rs[key]):.      
-000038c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000038d0: 2020 7365 6c66 2e69 6e70 7574 5f63 6f6e    self.input_con
-000038e0: 746f 7572 735b 666c 6f61 7428 6b65 7929  tours[float(key)
-000038f0: 5d2e 6170 7065 6e64 280a 2020 2020 2020  ].append(.      
-00003900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003910: 2020 2020 2020 6e70 2e61 7272 6179 2863        np.array(c
-00003920: 6f6e 746f 7572 735b 6b65 795d 5b63 5f69  ontours[key][c_i
-00003930: 6e64 6578 5d29 290a 2020 2020 2020 2020  ndex])).        
-00003940: 2020 2020 2020 2020 726f 6973 2e61 7070          rois.app
-00003950: 656e 6428 7365 6c66 2e6e 616d 6529 0a0a  end(self.name)..
-00003960: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00003970: 206f 732e 7061 7468 2e69 7364 6972 2873   os.path.isdir(s
-00003980: 656c 662e 736f 7572 6365 2920 6f72 206e  elf.source) or n
-00003990: 6f74 2073 656c 662e 736f 7572 6365 2e65  ot self.source.e
-000039a0: 6e64 7377 6974 6828 272e 6e69 6927 293a  ndswith('.nii'):
-000039b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000039c0: 2023 2054 7279 206c 6f61 6469 6e67 2066   # Try loading f
-000039d0: 726f 6d20 6469 636f 6d20 7374 7275 6374  rom dicom struct
-000039e0: 7572 6520 7365 740a 2020 2020 2020 2020  ure set.        
-000039f0: 2020 2020 2020 2020 726f 6973 2c20 6473          rois, ds
-00003a00: 203d 206c 6f61 645f 726f 6973 5f64 6963   = load_rois_dic
-00003a10: 6f6d 2873 656c 662e 736f 7572 6365 2c20  om(self.source, 
-00003a20: 6e61 6d65 733d 7365 6c66 2e6e 616d 6529  names=self.name)
-00003a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003a40: 2069 6620 6c65 6e28 726f 6973 293a 0a20   if len(rois):. 
-00003a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003a60: 2020 206e 756d 6265 7220 3d20 6c69 7374     number = list
-00003a70: 2872 6f69 732e 6b65 7973 2829 295b 305d  (rois.keys())[0]
-00003a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003a90: 2020 2020 2072 6f69 203d 2072 6f69 735b       roi = rois[
-00003aa0: 6e75 6d62 6572 5d0a 2020 2020 2020 2020  number].        
-00003ab0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00003ac0: 2e6e 616d 6520 3d20 726f 695b 226e 616d  .name = roi["nam
-00003ad0: 6522 5d0a 2020 2020 2020 2020 2020 2020  e"].            
-00003ae0: 2020 2020 2020 2020 7365 6c66 2e6e 756d          self.num
-00003af0: 6265 7220 3d20 6e75 6d62 6572 0a20 2020  ber = number.   
-00003b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003b10: 2073 656c 662e 696e 7075 745f 636f 6e74   self.input_cont
-00003b20: 6f75 7273 203d 2072 6f69 5b22 636f 6e74  ours = roi["cont
-00003b30: 6f75 7273 225d 0a20 2020 2020 2020 2020  ours"].         
-00003b40: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00003b50: 7420 7365 6c66 2e63 7573 746f 6d5f 636f  t self.custom_co
-00003b60: 6c6f 723a 0a20 2020 2020 2020 2020 2020  lor:.           
-00003b70: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00003b80: 662e 7365 745f 636f 6c6f 7228 726f 695b  f.set_color(roi[
-00003b90: 2263 6f6c 6f72 225d 290a 2020 2020 2020  "color"]).      
-00003ba0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00003bb0: 6c66 2e64 6963 6f6d 5f64 6174 6173 6574  lf.dicom_dataset
-00003bc0: 203d 2064 730a 0a20 2020 2020 2020 2023   = ds..        #
-00003bd0: 204c 6f61 6420 524f 4920 6d61 736b 0a20   Load ROI mask. 
-00003be0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00003bf0: 6c66 2e6c 6f61 6465 6420 616e 6420 6e6f  lf.loaded and no
-00003c00: 7420 6c65 6e28 726f 6973 2920 616e 6420  t len(rois) and 
-00003c10: 7365 6c66 2e73 6f75 7263 6520 6973 206e  self.source is n
-00003c20: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00003c30: 2020 2020 2073 656c 662e 6d61 736b 203d       self.mask =
-00003c40: 2073 6b72 742e 696d 6167 652e 496d 6167   skrt.image.Imag
-00003c50: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-00003c60: 2020 2073 656c 662e 736f 7572 6365 2c20     self.source, 
-00003c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003c80: 2061 6666 696e 653d 7365 6c66 2e61 6666   affine=self.aff
-00003c90: 696e 652c 200a 2020 2020 2020 2020 2020  ine, .          
-00003ca0: 2020 2020 2020 766f 7865 6c5f 7369 7a65        voxel_size
-00003cb0: 3d73 656c 662e 766f 7865 6c5f 7369 7a65  =self.voxel_size
-00003cc0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-00003cd0: 2020 206f 7269 6769 6e3d 7365 6c66 2e6f     origin=self.o
-00003ce0: 7269 6769 6e2c 200a 2020 2020 2020 2020  rigin, .        
-00003cf0: 2020 2020 2020 2020 6474 7970 653d 626f          dtype=bo
-00003d00: 6f6c 2c0a 2020 2020 2020 2020 2020 2020  ol,.            
-00003d10: 2020 2020 2a2a 7365 6c66 2e6b 7761 7267      **self.kwarg
-00003d20: 730a 2020 2020 2020 2020 2020 2020 290a  s.            ).
-00003d30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00003d40: 2e6c 6f61 6465 6420 3d20 5472 7565 0a20  .loaded = True. 
-00003d50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00003d60: 736f 7572 6365 5f74 7970 6520 3d20 226d  source_type = "m
-00003d70: 6173 6b22 0a20 2020 2020 2020 2020 2020  ask".           
-00003d80: 2073 656c 662e 6372 6561 7465 5f6d 6173   self.create_mas
-00003d90: 6b28 290a 0a20 2020 2020 2020 2023 2044  k()..        # D
-00003da0: 6561 6c20 7769 7468 2069 6e70 7574 2063  eal with input c
-00003db0: 6f6e 746f 7572 730a 2020 2020 2020 2020  ontours.        
-00003dc0: 6966 2073 656c 662e 696e 7075 745f 636f  if self.input_co
-00003dd0: 6e74 6f75 7273 2069 7320 6e6f 7420 4e6f  ntours is not No
-00003de0: 6e65 3a0a 0a20 2020 2020 2020 2020 2020  ne:..           
-00003df0: 2023 2043 7265 6174 6520 496d 6167 6520   # Create Image 
-00003e00: 6f62 6a65 6374 0a20 2020 2020 2020 2020  object.         
-00003e10: 2020 2069 6620 7365 6c66 2e69 6d61 6765     if self.image
-00003e20: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00003e30: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00003e40: 6c66 2e73 6861 7065 203d 2073 656c 662e  lf.shape = self.
-00003e50: 696d 6167 652e 6461 7461 2e73 6861 7065  image.data.shape
-00003e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003e70: 2073 656c 662e 6d61 736b 203d 2073 6b72   self.mask = skr
-00003e80: 742e 696d 6167 652e 496d 6167 6528 0a20  t.image.Image(. 
-00003e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003ea0: 2020 206e 702e 7a65 726f 7328 7365 6c66     np.zeros(self
-00003eb0: 2e73 6861 7065 292c 200a 2020 2020 2020  .shape), .      
-00003ec0: 2020 2020 2020 2020 2020 2020 2020 6166                af
-00003ed0: 6669 6e65 3d73 656c 662e 696d 6167 652e  fine=self.image.
-00003ee0: 6765 745f 6166 6669 6e65 2829 2c20 0a20  get_affine(), . 
-00003ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f00: 2020 2064 7479 7065 3d62 6f6f 6c2c 0a20     dtype=bool,. 
-00003f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f20: 2020 202a 2a73 656c 662e 6b77 6172 6773     **self.kwargs
-00003f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003f40: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-00003f50: 2320 5365 7420 782d 7920 636f 6e74 6f75  # Set x-y contou
-00003f60: 7273 2077 6974 6820 7a20 706f 7369 7469  rs with z positi
-00003f70: 6f6e 7320 6173 206b 6579 730a 2020 2020  ons as keys.    
-00003f80: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
-00003f90: 746f 7572 735b 2278 2d79 225d 203d 207b  tours["x-y"] = {
-00003fa0: 7d0a 2020 2020 2020 2020 2020 2020 666f  }.            fo
-00003fb0: 7220 7a2c 2063 6f6e 746f 7572 7320 696e  r z, contours in
-00003fc0: 2073 656c 662e 696e 7075 745f 636f 6e74   self.input_cont
-00003fd0: 6f75 7273 2e69 7465 6d73 2829 3a0a 2020  ours.items():.  
-00003fe0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00003ff0: 6c66 2e63 6f6e 746f 7572 735b 2278 2d79  lf.contours["x-y
-00004000: 225d 5b7a 5d20 3d20 5b63 6f6e 746f 7572  "][z] = [contour
-00004010: 5b3a 2c20 3a32 5d20 666f 7220 636f 6e74  [:, :2] for cont
-00004020: 6f75 7220 696e 2063 6f6e 746f 7572 735d  our in contours]
-00004030: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00004040: 662e 736f 7572 6365 5f74 7970 6520 3d20  f.source_type = 
-00004050: 2263 6f6e 746f 7572 220a 2020 2020 2020  "contour".      
-00004060: 2020 2020 2020 7365 6c66 2e6c 6f61 6465        self.loade
-00004070: 6420 3d20 5472 7565 0a0a 2020 2020 2020  d = True..      
-00004080: 2020 2320 5374 6f72 6520 666c 6167 2066    # Store flag f
-00004090: 6f72 2063 6173 6573 2077 6974 6820 6e6f  or cases with no
-000040a0: 2061 7373 6f63 6961 7465 6420 696d 6167   associated imag
-000040b0: 6520 6f72 2067 656f 6d65 7472 6963 2069  e or geometric i
-000040c0: 6e66 6f0a 2020 2020 2020 2020 6861 735f  nfo.        has_
-000040d0: 696d 6167 6520 3d20 7365 6c66 2e69 6d61  image = self.ima
-000040e0: 6765 2069 7320 6e6f 7420 4e6f 6e65 0a20  ge is not None. 
-000040f0: 2020 2020 2020 2068 6173 5f67 656f 6d20         has_geom 
-00004100: 3d20 7365 6c66 2e73 6861 7065 2069 7320  = self.shape is 
-00004110: 6e6f 7420 4e6f 6e65 2061 6e64 2028 0a20  not None and (. 
-00004120: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00004130: 6166 6669 6e65 2069 7320 6e6f 7420 4e6f  affine is not No
-00004140: 6e65 206f 7220 280a 2020 2020 2020 2020  ne or (.        
-00004150: 2020 2020 2020 2020 7365 6c66 2e76 6f78          self.vox
-00004160: 656c 5f73 697a 6520 6973 206e 6f74 204e  el_size is not N
-00004170: 6f6e 6520 616e 6420 7365 6c66 2e6f 7269  one and self.ori
-00004180: 6769 6e20 6973 206e 6f74 204e 6f6e 650a  gin is not None.
-00004190: 2020 2020 2020 2020 2020 2020 2929 0a20              )). 
-000041a0: 2020 2020 2020 2073 656c 662e 636f 6e74         self.cont
-000041b0: 6f75 7273 5f6f 6e6c 7920 3d20 7365 6c66  ours_only = self
-000041c0: 2e73 6f75 7263 655f 7479 7065 203d 3d20  .source_type == 
-000041d0: 2263 6f6e 746f 7572 2220 5c0a 2020 2020  "contour" \.    
-000041e0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-000041f0: 6e6f 7420 6861 735f 696d 6167 6520 616e  not has_image an
-00004200: 6420 6e6f 7420 6861 735f 6765 6f6d 0a20  d not has_geom. 
-00004210: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
-00004220: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
-00004230: 6f64 203d 3d20 2261 7574 6f22 3a0a 2020  od == "auto":.  
-00004240: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00004250: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
-00004260: 6f64 203d 2073 656c 662e 736f 7572 6365  od = self.source
-00004270: 5f74 7970 650a 0a20 2020 2020 2020 2023  _type..        #
-00004280: 2053 746f 7265 2066 6c61 6720 666f 7220   Store flag for 
-00004290: 656d 7074 696e 6573 730a 2020 2020 2020  emptiness.      
-000042a0: 2020 6966 2073 656c 662e 736f 7572 6365    if self.source
-000042b0: 5f74 7970 6520 3d3d 2022 636f 6e74 6f75  _type == "contou
-000042c0: 7222 3a0a 2020 2020 2020 2020 2020 2020  r":.            
-000042d0: 7365 6c66 2e65 6d70 7479 203d 206e 6f74  self.empty = not
-000042e0: 206c 656e 2873 656c 662e 696e 7075 745f   len(self.input_
-000042f0: 636f 6e74 6f75 7273 290a 2020 2020 2020  contours).      
-00004300: 2020 2020 2020 7365 6c66 2e73 6c69 6365        self.slice
-00004310: 5f74 6869 636b 6e65 7373 5f63 6f6e 746f  _thickness_conto
-00004320: 7572 7320 3d20 7365 6c66 2e67 6574 5f73  urs = self.get_s
-00004330: 6c69 6365 5f74 6869 636b 6e65 7373 5f63  lice_thickness_c
-00004340: 6f6e 746f 7572 7328 290a 2020 2020 2020  ontours().      
-00004350: 2020 656c 6966 2073 656c 662e 736f 7572    elif self.sour
-00004360: 6365 5f74 7970 6520 3d3d 2022 6d61 736b  ce_type == "mask
-00004370: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
-00004380: 656c 662e 656d 7074 7920 3d20 6e6f 7420  elf.empty = not 
-00004390: 6e70 2e61 6e79 2873 656c 662e 6d61 736b  np.any(self.mask
-000043a0: 2e67 6574 5f64 6174 6128 2929 0a20 2020  .get_data()).   
-000043b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000020a0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000020b0: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
+000020c0: 696e 7374 616e 6365 2863 6f6e 746f 7572  instance(contour
+000020d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000020e0: 2020 2020 2020 2020 2020 2020 2020 6765                ge
+000020f0: 6f6d 6574 7279 2e6d 756c 7469 706f 6c79  ometry.multipoly
+00002100: 676f 6e2e 4d75 6c74 6950 6f6c 7967 6f6e  gon.MultiPolygon
+00002110: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00002120: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
+00002130: 6f6c 7967 6f6e 2069 6e20 636f 6e74 6f75  olygon in contou
+00002140: 722e 6765 6f6d 733a 0a20 2020 2020 2020  r.geoms:.       
+00002150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002160: 2020 2020 2073 656c 662e 696e 7075 745f       self.input_
+00002170: 636f 6e74 6f75 7273 5b7a 5d2e 6170 7065  contours[z].appe
+00002180: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
+00002190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000021a0: 2020 2020 6e70 2e63 6f6c 756d 6e5f 7374      np.column_st
+000021b0: 6163 6b28 706f 6c79 676f 6e2e 6578 7465  ack(polygon.exte
+000021c0: 7269 6f72 2e78 7929 0a20 2020 2020 2020  rior.xy).       
+000021d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000021e0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+000021f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00002200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002210: 2020 2020 2073 656c 662e 696e 7075 745f       self.input_
+00002220: 636f 6e74 6f75 7273 5b7a 5d2e 6170 7065  contours[z].appe
+00002230: 6e64 2863 6f6e 746f 7572 290a 2020 2020  nd(contour).    
+00002240: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00002250: 2020 2020 2020 7365 6c66 2e73 6f75 7263        self.sourc
+00002260: 6520 3d20 2873 6b72 742e 636f 7265 2e66  e = (skrt.core.f
+00002270: 756c 6c70 6174 6828 736f 7572 6365 290a  ullpath(source).
+00002280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002290: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+000022a0: 696e 7374 616e 6365 2873 6f75 7263 652c  instance(source,
+000022b0: 2028 7374 722c 2050 6174 6829 2920 656c   (str, Path)) el
+000022c0: 7365 2073 6f75 7263 6529 0a0a 2020 2020  se source)..    
+000022d0: 2020 2020 2320 4173 7369 676e 206f 7468      # Assign oth
+000022e0: 6572 2070 726f 7065 7274 6965 730a 2020  er properties.  
+000022f0: 2020 2020 2020 7365 6c66 2e63 7573 746f        self.custo
+00002300: 6d5f 636f 6c6f 7220 3d20 636f 6c6f 7220  m_color = color 
+00002310: 6973 206e 6f74 204e 6f6e 650a 2020 2020  is not None.    
+00002320: 2020 2020 7365 6c66 2e73 6574 5f63 6f6c      self.set_col
+00002330: 6f72 2863 6f6c 6f72 290a 2020 2020 2020  or(color).      
+00002340: 2020 7365 6c66 2e6d 6173 6b20 3d20 4e6f    self.mask = No
+00002350: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
+00002360: 696d 6167 6520 3d20 696d 6167 650a 2020  image = image.  
+00002370: 2020 2020 2020 6966 2069 6d61 6765 2061        if image a
+00002380: 6e64 206e 6f74 2069 7369 6e73 7461 6e63  nd not isinstanc
+00002390: 6528 696d 6167 652c 2073 6b72 742e 696d  e(image, skrt.im
+000023a0: 6167 652e 496d 6167 6529 3a0a 2020 2020  age.Image):.    
+000023b0: 2020 2020 2020 2020 7365 6c66 2e69 6d61          self.ima
+000023c0: 6765 203d 2073 6b72 742e 696d 6167 652e  ge = skrt.image.
+000023d0: 496d 6167 6528 696d 6167 6529 0a20 2020  Image(image).   
+000023e0: 2020 2020 2073 656c 662e 7368 6170 6520       self.shape 
+000023f0: 3d20 7368 6170 650a 2020 2020 2020 2020  = shape.        
+00002400: 7365 6c66 2e61 6666 696e 652c 2073 656c  self.affine, sel
+00002410: 662e 766f 7865 6c5f 7369 7a65 2c20 7365  f.voxel_size, se
+00002420: 6c66 2e6f 7269 6769 6e20 3d20 5c0a 2020  lf.origin = \.  
+00002430: 2020 2020 2020 2020 2020 2020 2020 736b                sk
+00002440: 7274 2e69 6d61 6765 2e67 6574 5f67 656f  rt.image.get_geo
+00002450: 6d65 7472 7928 6166 6669 6e65 2c20 766f  metry(affine, vo
+00002460: 7865 6c5f 7369 7a65 2c20 6f72 6967 696e  xel_size, origin
+00002470: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
+00002480: 6c69 6365 5f74 6869 636b 6e65 7373 5f63  lice_thickness_c
+00002490: 6f6e 746f 7572 7320 3d20 4e6f 6e65 0a20  ontours = None. 
+000024a0: 2020 2020 2020 2073 656c 662e 6d61 736b         self.mask
+000024b0: 5f74 6872 6573 686f 6c64 203d 206d 6173  _threshold = mas
+000024c0: 6b5f 7468 7265 7368 6f6c 640a 2020 2020  k_threshold.    
+000024d0: 2020 2020 7365 6c66 2e6f 7665 726c 6170      self.overlap
+000024e0: 5f6c 6576 656c 203d 206f 7665 726c 6170  _level = overlap
+000024f0: 5f6c 6576 656c 0a20 2020 2020 2020 2073  _level.        s
+00002500: 656c 662e 636f 6e74 6f75 7273 203d 207b  elf.contours = {
+00002510: 7d0a 2020 2020 2020 2020 7365 6c66 2e64  }.        self.d
+00002520: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
+00002530: 6f64 203d 2064 6566 6175 6c74 5f67 656f  od = default_geo
+00002540: 6d5f 6d65 7468 6f64 0a20 2020 2020 2020  m_method.       
+00002550: 2073 656c 662e 6b77 6172 6773 203d 206b   self.kwargs = k
+00002560: 7761 7267 730a 2020 2020 2020 2020 7365  wargs.        se
+00002570: 6c66 2e73 6f75 7263 655f 7479 7065 203d  lf.source_type =
+00002580: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
+00002590: 6c66 2e64 6963 6f6d 5f64 6174 6173 6574  lf.dicom_dataset
+000025a0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+000025b0: 7365 6c66 2e63 6f6e 746f 7572 735f 6f6e  self.contours_on
+000025c0: 6c79 203d 2046 616c 7365 0a20 2020 2020  ly = False.     
+000025d0: 2020 2073 656c 662e 706c 616e 7320 3d20     self.plans = 
+000025e0: 5b5d 0a20 2020 2020 2020 2073 656c 662e  [].        self.
+000025f0: 616c 7068 615f 6f76 6572 5f62 6574 6120  alpha_over_beta 
+00002600: 3d20 616c 7068 615f 6f76 6572 5f62 6574  = alpha_over_bet
+00002610: 610a 0a20 2020 2020 2020 2023 2050 726f  a..        # Pro
+00002620: 7065 7274 6965 7320 7265 6c61 7469 6e67  perties relating
+00002630: 2074 6f20 706c 616e 2064 6f73 6520 636f   to plan dose co
+00002640: 6e73 7472 6169 6e74 730a 2020 2020 2020  nstraints.      
+00002650: 2020 7365 6c66 2e72 6f69 5f74 7970 6520    self.roi_type 
+00002660: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
+00002670: 656c 662e 636f 6e73 7472 6169 6e74 203d  elf.constraint =
+00002680: 204e 6f6e 650a 0a20 2020 2020 2020 2023   None..        #
+00002690: 2043 7265 6174 6520 6e61 6d65 0a20 2020   Create name.   
+000026a0: 2020 2020 2073 656c 662e 6e61 6d65 203d       self.name =
+000026b0: 206e 616d 650a 2020 2020 2020 2020 6966   name.        if
+000026c0: 2073 656c 662e 6e61 6d65 2069 7320 4e6f   self.name is No
+000026d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000026e0: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
+000026f0: 6c66 2e73 6f75 7263 652c 2073 7472 293a  lf.source, str):
+00002700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002710: 2062 6173 656e 616d 6520 3d20 6f73 2e70   basename = os.p
+00002720: 6174 682e 6261 7365 6e61 6d65 2873 656c  ath.basename(sel
+00002730: 662e 736f 7572 6365 292e 7370 6c69 7428  f.source).split(
+00002740: 222e 2229 5b30 5d0a 2020 2020 2020 2020  ".")[0].        
+00002750: 2020 2020 2020 2020 6e61 6d65 203d 2072          name = r
+00002760: 652e 7375 6228 7222 5254 5354 5255 4354  e.sub(r"RTSTRUCT
+00002770: 5f5b 4d56 4354 5d2b 5f5c 642b 5f5c 642b  _[MVCT]+_\d+_\d+
+00002780: 5f5c 642b 222c 2022 222c 2062 6173 656e  _\d+", "", basen
+00002790: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+000027a0: 2020 2020 2023 2020 7365 6c66 2e6e 616d       #  self.nam
+000027b0: 6520 3d20 6e61 6d65 5b30 5d2e 7570 7065  e = name[0].uppe
+000027c0: 7228 2920 2b20 6e61 6d65 5b31 3a5d 0a20  r() + name[1:]. 
+000027d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000027e0: 656c 662e 6e61 6d65 203d 206e 616d 650a  elf.name = name.
+000027f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00002800: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002810: 2020 7365 6c66 2e6e 616d 6520 3d20 524f    self.name = RO
+00002820: 4944 6566 6175 6c74 7328 292e 6765 745f  IDefaults().get_
+00002830: 6465 6661 756c 745f 726f 695f 6e61 6d65  default_roi_name
+00002840: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+00002850: 6f72 6967 696e 616c 5f6e 616d 6520 3d20  original_name = 
+00002860: 6e61 6d65 0a20 2020 2020 2020 2073 656c  name.        sel
+00002870: 662e 7469 746c 6520 3d20 4e6f 6e65 0a0a  f.title = None..
+00002880: 2020 2020 2020 2020 2320 524f 4920 6e75          # ROI nu
+00002890: 6d62 6572 2061 7320 6465 6669 6e65 6420  mber as defined 
+000028a0: 696e 2044 4943 4f4d 2052 5453 5452 5543  in DICOM RTSTRUC
+000028b0: 5420 6669 6c65 2e0a 2020 2020 2020 2020  T file..        
+000028c0: 2320 4c65 6674 2074 6f20 4e6f 6e65 2066  # Left to None f
+000028d0: 6f72 2052 4f49 206c 6f61 6465 6420 6672  or ROI loaded fr
+000028e0: 6f6d 206e 6f6e 2d44 4943 4f4d 2073 6f75  om non-DICOM sou
+000028f0: 7263 652e 0a20 2020 2020 2020 2073 656c  rce..        sel
+00002900: 662e 6e75 6d62 6572 203d 204e 6f6e 650a  f.number = None.
+00002910: 0a20 2020 2020 2020 2023 204c 6f61 6420  .        # Load 
+00002920: 524f 4920 6461 7461 0a20 2020 2020 2020  ROI data.       
+00002930: 2073 656c 662e 6c6f 6164 6564 203d 2046   self.loaded = F
+00002940: 616c 7365 0a20 2020 2020 2020 2073 656c  alse.        sel
+00002950: 662e 6c6f 6164 6564 5f6d 6173 6b20 3d20  f.loaded_mask = 
+00002960: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
+00002970: 206c 6f61 643a 0a20 2020 2020 2020 2020   load:.         
+00002980: 2020 2073 656c 662e 6c6f 6164 2829 0a0a     self.load()..
+00002990: 2020 2020 2020 2020 2320 496e 6974 6961          # Initia
+000029a0: 6c69 7365 2061 7320 736b 7274 2e63 6f72  lise as skrt.cor
+000029b0: 652e 4172 6368 6976 6520 6f62 6a65 6374  e.Archive object
+000029c0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+000029d0: 7365 6c66 2e73 6f75 7263 6520 6966 2069  self.source if i
+000029e0: 7369 6e73 7461 6e63 6528 7365 6c66 2e73  sinstance(self.s
+000029f0: 6f75 7263 652c 2073 7472 2920 656c 7365  ource, str) else
+00002a00: 2022 220a 2020 2020 2020 2020 736b 7274   "".        skrt
+00002a10: 2e63 6f72 652e 4172 6368 6976 652e 5f5f  .core.Archive.__
+00002a20: 696e 6974 5f5f 2873 656c 662c 2070 6174  init__(self, pat
+00002a30: 6829 0a0a 2020 2020 6465 6620 5f5f 6571  h)..    def __eq
+00002a40: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
+00002a50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00002a60: 6f74 6865 7220 6973 2073 656c 660a 0a20  other is self.. 
+00002a70: 2020 2064 6566 206c 6f61 6428 7365 6c66     def load(self
+00002a80: 2c20 666f 7263 653d 4661 6c73 6529 3a0a  , force=False):.
+00002a90: 2020 2020 2020 2020 2222 224c 6f61 6420          """Load 
+00002aa0: 524f 4920 6672 6f6d 2066 696c 6520 6f72  ROI from file or
+00002ab0: 2073 6f75 7263 652e 2054 6865 206c 6f61   source. The loa
+00002ac0: 6469 6e67 2073 6571 7565 6e63 6520 6973  ding sequence is
+00002ad0: 2061 7320 666f 6c6c 6f77 733a 0a0a 2020   as follows:..  
+00002ae0: 2020 2020 2020 312e 2049 6620 7365 6c66        1. If self
+00002af0: 2e69 6d61 6765 2069 7320 6e6f 7420 4e6f  .image is not No
+00002b00: 6e65 2c20 656e 7375 7265 2074 6861 7420  ne, ensure that 
+00002b10: 7468 6520 696d 6167 6520 6973 206c 6f61  the image is loa
+00002b20: 6465 6420 616e 6420 0a20 2020 2020 2020  ded and .       
+00002b30: 2061 7373 6967 6e20 6974 7320 6765 6f6d   assign its geom
+00002b40: 6574 7269 6320 7072 6f70 6572 7469 6573  etric properties
+00002b50: 2074 6f20 7468 6973 2052 4f49 2e0a 0a20   to this ROI... 
+00002b60: 2020 2020 2020 2032 2e20 4174 7465 6d70         2. Attemp
+00002b70: 7420 746f 206c 6f61 6420 6461 7461 2066  t to load data f
+00002b80: 726f 6d20 7365 6c66 2e73 6f75 7263 653a  rom self.source:
+00002b90: 0a0a 2020 2020 2020 2020 2861 2920 4966  ..        (a) If
+00002ba0: 2074 6869 7320 6973 2061 6e20 496d 6167   this is an Imag
+00002bb0: 6520 6f62 6a65 6374 2c20 7468 6520 524f  e object, the RO
+00002bc0: 4920 7769 6c6c 2062 6520 6372 6561 7465  I will be create
+00002bd0: 6420 6279 2061 7070 6c79 696e 6720 6120  d by applying a 
+00002be0: 0a20 2020 2020 2020 2074 6872 6573 686f  .        thresho
+00002bf0: 6c64 2074 6f20 7468 6520 496d 6167 6527  ld to the Image'
+00002c00: 7320 6172 7261 792e 2053 6574 2073 656c  s array. Set sel
+00002c10: 662e 6d61 736b 2074 6f20 7468 6520 7468  f.mask to the th
+00002c20: 7265 7368 6f6c 6465 6420 696d 6167 650a  resholded image.
+00002c30: 2020 2020 2020 2020 616e 6420 7365 6c66          and self
+00002c40: 2e69 6e70 7574 5f74 7970 6520 3d20 226d  .input_type = "m
+00002c50: 6173 6b22 2e0a 2020 2020 2020 2020 2862  ask"..        (b
+00002c60: 2920 4966 2073 656c 662e 736f 7572 6365  ) If self.source
+00002c70: 2069 7320 6120 7374 7269 6e67 2c20 6174   is a string, at
+00002c80: 7465 6d70 7420 746f 206c 6f61 6420 6672  tempt to load fr
+00002c90: 6f6d 2061 2066 696c 650a 2020 2020 2020  om a file.      
+00002ca0: 2020 636f 6e66 6f72 6d69 6e67 2074 6f20    conforming to 
+00002cb0: 7472 616e 7366 6f72 6d69 7820 6f75 7470  transformix outp
+00002cc0: 7574 2028 2e74 7874 2065 7874 656e 7369  ut (.txt extensi
+00002cd0: 6f6e 2920 6f72 2066 726f 6d20 610a 2020  on) or from a.  
+00002ce0: 2020 2020 2020 6469 636f 6d20 7374 7275        dicom stru
+00002cf0: 6374 7572 6520 7365 7420 2869 6e20 626f  cture set (in bo
+00002d00: 7468 2063 6173 6573 2073 6574 7469 6e67  th cases setting
+00002d10: 2073 656c 662e 696e 7075 745f 636f 6e74   self.input_cont
+00002d20: 6f75 7273 292e 0a20 2020 2020 2020 2028  ours)..        (
+00002d30: 6329 2049 6620 7472 616e 7366 6f72 6d69  c) If transformi
+00002d40: 7820 6f72 2064 6963 6f6d 206c 6f61 6469  x or dicom loadi
+00002d50: 6e67 2066 6169 6c73 2c20 6174 7465 6d70  ng fails, attemp
+00002d60: 7420 746f 206c 6f61 640a 2020 2020 2020  t to load.      
+00002d70: 2020 7365 6c66 2e73 6f75 7263 6520 6173    self.source as
+00002d80: 2061 6e20 496d 6167 6520 6f62 6a65 6374   an Image object
+00002d90: 2074 6f20 6372 6561 7465 2061 6e20 524f   to create an RO
+00002da0: 4920 6d61 736b 2e20 4966 2074 6869 730a  I mask. If this.
+00002db0: 2020 2020 2020 2020 6669 6e64 7320 6120          finds a 
+00002dc0: 7661 6c69 6420 496d 6167 652c 2073 6574  valid Image, set
+00002dd0: 2073 656c 662e 6d61 736b 2074 6f20 7468   self.mask to th
+00002de0: 6174 2069 6d61 6765 2061 6e64 2073 6574  at image and set
+00002df0: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
+00002e00: 7075 745f 7479 7065 203d 2022 6d61 736b  put_type = "mask
+00002e10: 222e 0a20 2020 2020 2020 2028 6429 2049  "..        (d) I
+00002e20: 6620 7365 6c66 2e73 6f75 7263 6520 6973  f self.source is
+00002e30: 204e 6f6e 652c 2064 6f20 6e6f 7468 696e   None, do nothin
+00002e40: 6720 7769 7468 2069 742e 0a0a 2020 2020  g with it...    
+00002e50: 2020 2020 332e 2043 6865 636b 2077 6865      3. Check whe
+00002e60: 7468 6572 2073 656c 662e 696e 7075 745f  ther self.input_
+00002e70: 636f 6e74 6f75 7273 2063 6f6e 7461 696e  contours contain
+00002e80: 7320 6461 7461 2e20 5468 6973 2063 6f75  s data. This cou
+00002e90: 6c64 2061 7269 7365 0a20 2020 2020 2020  ld arise.       
+00002ea0: 2069 6e20 7477 6f20 7363 656e 6172 696f   in two scenario
+00002eb0: 733a 0a20 2020 2020 2020 200a 2020 2020  s:.        .    
+00002ec0: 2020 2020 2861 2920 5468 6520 524f 4920      (a) The ROI 
+00002ed0: 7761 7320 696e 6974 6961 6c69 7365 6420  was initialised 
+00002ee0: 6672 6f6d 2061 2064 6963 7420 6f66 2063  from a dict of c
+00002ef0: 6f6e 746f 7572 732c 2077 6869 6368 2077  ontours, which w
+00002f00: 6572 650a 2020 2020 2020 2020 6173 7369  ere.        assi
+00002f10: 676e 6564 2074 6f20 7365 6c66 2e69 6e70  gned to self.inp
+00002f20: 7574 5f63 6f6e 746f 7572 7320 696e 2073  ut_contours in s
+00002f30: 656c 662e 5f5f 696e 6974 2829 3b20 6f72  elf.__init(); or
+00002f40: 0a20 2020 2020 2020 2028 6229 2041 2073  .        (b) A s
+00002f50: 6574 206f 6620 636f 6e74 6f75 7273 2077  et of contours w
+00002f60: 6173 2073 7563 6365 7373 6675 6c6c 7920  as successfully 
+00002f70: 6c6f 6164 6564 2066 726f 6d20 6120 7472  loaded from a tr
+00002f80: 616e 7366 6f72 6d69 7820 6f72 0a20 2020  ansformix or.   
+00002f90: 2020 2020 2064 6963 6f6d 2066 696c 6520       dicom file 
+00002fa0: 666f 756e 6420 6174 2073 656c 662e 736f  found at self.so
+00002fb0: 7572 6365 2069 6e20 7374 6570 2031 2862  urce in step 1(b
+00002fc0: 292e 0a0a 2020 2020 2020 2020 4966 2069  )...        If i
+00002fd0: 6e70 7574 2063 6f6e 746f 7572 7320 6172  nput contours ar
+00002fe0: 6520 666f 756e 642c 2074 6865 7365 2061  e found, these a
+00002ff0: 7265 2061 7373 6967 6e65 6420 746f 2073  re assigned to s
+00003000: 656c 662e 636f 6e74 6f75 7273 5b22 782d  elf.contours["x-
+00003010: 7922 5d0a 2020 2020 2020 2020 616e 6420  y"].        and 
+00003020: 7365 6c66 2e73 6f75 7263 655f 7479 7065  self.source_type
+00003030: 2069 7320 7365 7420 746f 2022 636f 6e74   is set to "cont
+00003040: 6f75 7222 2e20 4164 6469 7469 6f6e 616c  our". Additional
+00003050: 6c79 2c20 6966 2073 656c 662e 696d 6167  ly, if self.imag
+00003060: 650a 2020 2020 2020 2020 6973 206e 6f74  e.        is not
+00003070: 204e 6f6e 652c 2073 6574 2073 656c 662e   None, set self.
+00003080: 6d61 736b 2074 6f20 616e 2061 7272 6179  mask to an array
+00003090: 206f 6620 7a65 726f 7320 7468 6520 7361   of zeros the sa
+000030a0: 6d65 2073 697a 6520 6173 2074 6865 200a  me size as the .
+000030b0: 2020 2020 2020 2020 696d 6167 652e 0a0a          image...
+000030c0: 2020 2020 2020 2020 342e 2053 6574 2061          4. Set a
+000030d0: 2066 6c61 6720 696e 6469 6361 7469 6e67   flag indicating
+000030e0: 2077 6865 7468 6572 2074 6869 7320 524f   whether this RO
+000030f0: 4920 6861 7320 636f 6e74 6f75 7273 206f  I has contours o
+00003100: 6e6c 7920 2869 2e65 206e 6f0a 2020 2020  nly (i.e no.    
+00003110: 2020 2020 6d61 736b 206f 7220 696d 6167      mask or imag
+00003120: 6520 6672 6f6d 2077 6869 6368 2074 6f20  e from which to 
+00003130: 6472 6177 206f 7269 6769 6e2f 766f 7865  draw origin/voxe
+00003140: 6c20 7369 7a65 7329 2c20 616e 6420 7365  l sizes), and se
+00003150: 740a 2020 2020 2020 2020 6465 6661 756c  t.        defaul
+00003160: 7420 6765 6f6d 6574 7269 6320 6361 6c63  t geometric calc
+00003170: 756c 6174 696f 6e20 6d65 7468 6f64 2074  ulation method t
+00003180: 6f20 7365 6c66 2e73 6f75 7263 655f 7479  o self.source_ty
+00003190: 7065 2e20 5365 740a 2020 2020 2020 2020  pe. Set.        
+000031a0: 7365 6c66 2e6c 6f61 6465 6420 746f 2054  self.loaded to T
+000031b0: 7275 652e 0a20 2020 2020 2020 2022 2222  rue..        """
+000031c0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+000031d0: 662e 6c6f 6164 6564 2061 6e64 206e 6f74  f.loaded and not
+000031e0: 2066 6f72 6365 3a0a 2020 2020 2020 2020   force:.        
+000031f0: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+00003200: 2020 2020 6966 2073 656c 662e 696d 6167      if self.imag
+00003210: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00003220: 656c 662e 696d 6167 652e 6c6f 6164 2829  elf.image.load()
+00003230: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00003240: 662e 7368 6170 6520 3d20 7365 6c66 2e69  f.shape = self.i
+00003250: 6d61 6765 2e67 6574 5f64 6174 6128 292e  mage.get_data().
+00003260: 7368 6170 650a 2020 2020 2020 2020 2020  shape.          
+00003270: 2020 7365 6c66 2e61 6666 696e 6520 3d20    self.affine = 
+00003280: 7365 6c66 2e69 6d61 6765 2e67 6574 5f61  self.image.get_a
+00003290: 6666 696e 6528 290a 2020 2020 2020 2020  ffine().        
+000032a0: 2020 2020 7365 6c66 2e76 6f78 656c 5f73      self.voxel_s
+000032b0: 697a 6520 3d20 7365 6c66 2e69 6d61 6765  ize = self.image
+000032c0: 2e67 6574 5f76 6f78 656c 5f73 697a 6528  .get_voxel_size(
+000032d0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000032e0: 6c66 2e6f 7269 6769 6e20 3d20 7365 6c66  lf.origin = self
+000032f0: 2e69 6d61 6765 2e67 6574 5f6f 7269 6769  .image.get_origi
+00003300: 6e28 290a 0a20 2020 2020 2020 2072 6f69  n()..        roi
+00003310: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
+00003320: 2320 4c6f 6164 2066 726f 6d20 616e 2065  # Load from an e
+00003330: 7869 7374 696e 6720 496d 6167 650a 2020  xisting Image.  
+00003340: 2020 2020 2020 6966 2069 7373 7562 636c        if issubcl
+00003350: 6173 7328 7479 7065 2873 656c 662e 736f  ass(type(self.so
+00003360: 7572 6365 292c 2073 6b72 742e 696d 6167  urce), skrt.imag
+00003370: 652e 496d 6167 6529 3a0a 2020 2020 2020  e.Image):.      
+00003380: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00003390: 662e 696d 6167 653a 0a20 2020 2020 2020  f.image:.       
+000033a0: 2020 2020 2020 2020 2073 656c 662e 696d           self.im
+000033b0: 6167 6520 3d20 7365 6c66 2e73 6f75 7263  age = self.sourc
+000033c0: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
+000033d0: 6c66 2e6d 6173 6b20 3d20 736b 7274 2e69  lf.mask = skrt.i
+000033e0: 6d61 6765 2e49 6d61 6765 280a 2020 2020  mage.Image(.    
+000033f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00003400: 2e73 6f75 7263 652e 6765 745f 6461 7461  .source.get_data
+00003410: 2829 203e 2073 656c 662e 6d61 736b 5f74  () > self.mask_t
+00003420: 6872 6573 686f 6c64 2c0a 2020 2020 2020  hreshold,.      
+00003430: 2020 2020 2020 2020 2020 6166 6669 6e65            affine
+00003440: 3d73 656c 662e 736f 7572 6365 2e67 6574  =self.source.get
+00003450: 5f61 6666 696e 6528 292c 0a20 2020 2020  _affine(),.     
+00003460: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
+00003470: 3d62 6f6f 6c0a 2020 2020 2020 2020 2020  =bool.          
+00003480: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00003490: 7365 6c66 2e73 6f75 7263 655f 7479 7065  self.source_type
+000034a0: 203d 2022 6d61 736b 220a 2020 2020 2020   = "mask".      
+000034b0: 2020 2020 2020 7365 6c66 2e6c 6f61 6465        self.loade
+000034c0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
+000034d0: 2020 2020 2073 656c 662e 6372 6561 7465       self.create
+000034e0: 5f6d 6173 6b28 290a 0a20 2020 2020 2020  _mask()..       
+000034f0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+00003500: 2873 656c 662e 736f 7572 6365 2c20 7374  (self.source, st
+00003510: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00003520: 6966 2073 656c 662e 736f 7572 6365 2e65  if self.source.e
+00003530: 6e64 7377 6974 6828 272e 7478 7427 293a  ndswith('.txt'):
+00003540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003550: 2023 2054 7279 206c 6f61 6469 6e67 2066   # Try loading f
+00003560: 726f 6d20 7472 616e 7366 6f72 6d69 782d  rom transformix-
+00003570: 636f 6d70 6174 6962 6c65 2070 6f69 6e74  compatible point
+00003580: 2063 6c6f 7564 0a20 2020 2020 2020 2020   cloud.         
+00003590: 2020 2020 2020 2070 6f69 6e74 7320 3d20         points = 
+000035a0: 7365 6c66 2e6c 6f61 645f 7472 616e 7366  self.load_transf
+000035b0: 6f72 6d69 785f 706f 696e 7473 2829 0a0a  ormix_points()..
+000035c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000035d0: 2320 4578 7472 6163 7420 736c 6963 652d  # Extract slice-
+000035e0: 6279 2d73 6c69 6365 2064 6963 7469 6f6e  by-slice diction
+000035f0: 6172 7920 6f66 2028 782c 2079 2920 706f  ary of (x, y) po
+00003600: 696e 7473 0a20 2020 2020 2020 2020 2020  ints.           
+00003610: 2020 2020 2063 6f6e 746f 7572 7320 3d20       contours = 
+00003620: 7b7d 0a20 2020 2020 2020 2020 2020 2020  {}.             
+00003630: 2020 2066 6f72 2070 6f69 6e74 2069 6e20     for point in 
+00003640: 736f 7274 6564 2870 6f69 6e74 7329 3a0a  sorted(points):.
+00003650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003660: 2020 2020 785f 706f 696e 742c 2079 5f70      x_point, y_p
+00003670: 6f69 6e74 2c20 7a5f 706f 696e 7420 3d20  oint, z_point = 
+00003680: 706f 696e 7473 5b70 6f69 6e74 5d5b 274f  points[point]['O
+00003690: 7574 7075 7450 6f69 6e74 275d 0a20 2020  utputPoint'].   
+000036a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000036b0: 206b 6579 203d 2066 277b 7a5f 706f 696e   key = f'{z_poin
+000036c0: 743a 2e32 667d 270a 2020 2020 2020 2020  t:.2f}'.        
+000036d0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+000036e0: 6f74 206b 6579 2069 6e20 636f 6e74 6f75  ot key in contou
+000036f0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+00003700: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00003710: 6f75 7273 5b6b 6579 5d20 3d20 7b7d 0a20  ours[key] = {}. 
+00003720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003730: 2020 2063 5f69 6e64 6578 203d 2070 6f69     c_index = poi
+00003740: 6e74 735b 706f 696e 745d 5b27 436f 6e74  nts[point]['Cont
+00003750: 6f75 7249 6e64 6578 275d 0a20 2020 2020  ourIndex'].     
+00003760: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00003770: 6620 6e6f 7420 635f 696e 6465 7820 696e  f not c_index in
+00003780: 2063 6f6e 746f 7572 735b 6b65 795d 3a0a   contours[key]:.
+00003790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000037a0: 2020 2020 2020 2020 636f 6e74 6f75 7273          contours
+000037b0: 5b6b 6579 5d5b 635f 696e 6465 785d 203d  [key][c_index] =
+000037c0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+000037d0: 2020 2020 2020 2020 636f 6e74 6f75 7273          contours
+000037e0: 5b6b 6579 5d5b 635f 696e 6465 785d 2e61  [key][c_index].a
+000037f0: 7070 656e 6428 5b78 5f70 6f69 6e74 2c20  ppend([x_point, 
+00003800: 795f 706f 696e 745d 290a 0a20 2020 2020  y_point])..     
+00003810: 2020 2020 2020 2020 2020 2023 2053 746f             # Sto
+00003820: 7265 2074 6865 206c 6973 7420 6f66 2063  re the list of c
+00003830: 6f6e 746f 7572 732e 0a20 2020 2020 2020  ontours..       
+00003840: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
+00003850: 7075 745f 636f 6e74 6f75 7273 203d 207b  put_contours = {
+00003860: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00003870: 2020 666f 7220 6b65 7920 696e 2073 6f72    for key in sor
+00003880: 7465 6428 636f 6e74 6f75 7273 293a 0a20  ted(contours):. 
+00003890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000038a0: 2020 2073 656c 662e 696e 7075 745f 636f     self.input_co
+000038b0: 6e74 6f75 7273 5b66 6c6f 6174 286b 6579  ntours[float(key
+000038c0: 295d 203d 205b 5d0a 2020 2020 2020 2020  )] = [].        
+000038d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000038e0: 635f 696e 6465 7820 696e 2073 6f72 7465  c_index in sorte
+000038f0: 6428 636f 6e74 6f75 7273 5b6b 6579 5d29  d(contours[key])
+00003900: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00003910: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+00003920: 6e70 7574 5f63 6f6e 746f 7572 735b 666c  nput_contours[fl
+00003930: 6f61 7428 6b65 7929 5d2e 6170 7065 6e64  oat(key)].append
+00003940: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00003950: 2020 2020 2020 2020 2020 2020 2020 6e70                np
+00003960: 2e61 7272 6179 2863 6f6e 746f 7572 735b  .array(contours[
+00003970: 6b65 795d 5b63 5f69 6e64 6578 5d29 290a  key][c_index])).
+00003980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003990: 726f 6973 2e61 7070 656e 6428 7365 6c66  rois.append(self
+000039a0: 2e6e 616d 6529 0a0a 2020 2020 2020 2020  .name)..        
+000039b0: 2020 2020 656c 6966 206f 732e 7061 7468      elif os.path
+000039c0: 2e69 7364 6972 2873 656c 662e 736f 7572  .isdir(self.sour
+000039d0: 6365 2920 6f72 206e 6f74 2073 656c 662e  ce) or not self.
+000039e0: 736f 7572 6365 2e65 6e64 7377 6974 6828  source.endswith(
+000039f0: 272e 6e69 6927 293a 0a20 2020 2020 2020  '.nii'):.       
+00003a00: 2020 2020 2020 2020 2023 2054 7279 206c           # Try l
+00003a10: 6f61 6469 6e67 2066 726f 6d20 6469 636f  oading from dico
+00003a20: 6d20 7374 7275 6374 7572 6520 7365 740a  m structure set.
+00003a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a40: 726f 6973 2c20 6473 203d 206c 6f61 645f  rois, ds = load_
+00003a50: 726f 6973 5f64 6963 6f6d 2873 656c 662e  rois_dicom(self.
+00003a60: 736f 7572 6365 2c20 6e61 6d65 733d 7365  source, names=se
+00003a70: 6c66 2e6e 616d 6529 0a20 2020 2020 2020  lf.name).       
+00003a80: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00003a90: 726f 6973 293a 0a20 2020 2020 2020 2020  rois):.         
+00003aa0: 2020 2020 2020 2020 2020 206e 756d 6265             numbe
+00003ab0: 7220 3d20 6c69 7374 2872 6f69 732e 6b65  r = list(rois.ke
+00003ac0: 7973 2829 295b 305d 0a20 2020 2020 2020  ys())[0].       
+00003ad0: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+00003ae0: 203d 2072 6f69 735b 6e75 6d62 6572 5d0a   = rois[number].
+00003af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b00: 2020 2020 7365 6c66 2e6e 616d 6520 3d20      self.name = 
+00003b10: 726f 695b 226e 616d 6522 5d0a 2020 2020  roi["name"].    
+00003b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b30: 7365 6c66 2e6e 756d 6265 7220 3d20 6e75  self.number = nu
+00003b40: 6d62 6572 0a20 2020 2020 2020 2020 2020  mber.           
+00003b50: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
+00003b60: 7075 745f 636f 6e74 6f75 7273 203d 2072  put_contours = r
+00003b70: 6f69 5b22 636f 6e74 6f75 7273 225d 0a20  oi["contours"]. 
+00003b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b90: 2020 2069 6620 6e6f 7420 7365 6c66 2e63     if not self.c
+00003ba0: 7573 746f 6d5f 636f 6c6f 723a 0a20 2020  ustom_color:.   
+00003bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003bc0: 2020 2020 2073 656c 662e 7365 745f 636f       self.set_co
+00003bd0: 6c6f 7228 726f 695b 2263 6f6c 6f72 225d  lor(roi["color"]
+00003be0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00003bf0: 2020 2020 2020 7365 6c66 2e64 6963 6f6d        self.dicom
+00003c00: 5f64 6174 6173 6574 203d 2064 730a 0a20  _dataset = ds.. 
+00003c10: 2020 2020 2020 2023 204c 6f61 6420 524f         # Load RO
+00003c20: 4920 6d61 736b 0a20 2020 2020 2020 2069  I mask.        i
+00003c30: 6620 6e6f 7420 7365 6c66 2e6c 6f61 6465  f not self.loade
+00003c40: 6420 616e 6420 6e6f 7420 6c65 6e28 726f  d and not len(ro
+00003c50: 6973 2920 616e 6420 7365 6c66 2e73 6f75  is) and self.sou
+00003c60: 7263 6520 6973 206e 6f74 204e 6f6e 653a  rce is not None:
+00003c70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00003c80: 662e 6d61 736b 203d 2073 6b72 742e 696d  f.mask = skrt.im
+00003c90: 6167 652e 496d 6167 6528 0a20 2020 2020  age.Image(.     
+00003ca0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00003cb0: 736f 7572 6365 2c20 0a20 2020 2020 2020  source, .       
+00003cc0: 2020 2020 2020 2020 2061 6666 696e 653d           affine=
+00003cd0: 7365 6c66 2e61 6666 696e 652c 200a 2020  self.affine, .  
+00003ce0: 2020 2020 2020 2020 2020 2020 2020 766f                vo
+00003cf0: 7865 6c5f 7369 7a65 3d73 656c 662e 766f  xel_size=self.vo
+00003d00: 7865 6c5f 7369 7a65 2c20 0a20 2020 2020  xel_size, .     
+00003d10: 2020 2020 2020 2020 2020 206f 7269 6769             origi
+00003d20: 6e3d 7365 6c66 2e6f 7269 6769 6e2c 200a  n=self.origin, .
+00003d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d40: 6474 7970 653d 626f 6f6c 2c0a 2020 2020  dtype=bool,.    
+00003d50: 2020 2020 2020 2020 2020 2020 2a2a 7365              **se
+00003d60: 6c66 2e6b 7761 7267 730a 2020 2020 2020  lf.kwargs.      
+00003d70: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00003d80: 2020 2020 7365 6c66 2e6c 6f61 6465 6420      self.loaded 
+00003d90: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00003da0: 2020 2073 656c 662e 736f 7572 6365 5f74     self.source_t
+00003db0: 7970 6520 3d20 226d 6173 6b22 0a20 2020  ype = "mask".   
+00003dc0: 2020 2020 2020 2020 2073 656c 662e 6372           self.cr
+00003dd0: 6561 7465 5f6d 6173 6b28 290a 0a20 2020  eate_mask()..   
+00003de0: 2020 2020 2023 2044 6561 6c20 7769 7468       # Deal with
+00003df0: 2069 6e70 7574 2063 6f6e 746f 7572 730a   input contours.
+00003e00: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00003e10: 696e 7075 745f 636f 6e74 6f75 7273 2069  input_contours i
+00003e20: 7320 6e6f 7420 4e6f 6e65 3a0a 0a20 2020  s not None:..   
+00003e30: 2020 2020 2020 2020 2023 2043 7265 6174           # Creat
+00003e40: 6520 496d 6167 6520 6f62 6a65 6374 0a20  e Image object. 
+00003e50: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00003e60: 6c66 2e69 6d61 6765 2069 7320 6e6f 7420  lf.image is not 
+00003e70: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00003e80: 2020 2020 2020 7365 6c66 2e73 6861 7065        self.shape
+00003e90: 203d 2073 656c 662e 696d 6167 652e 6461   = self.image.da
+00003ea0: 7461 2e73 6861 7065 0a20 2020 2020 2020  ta.shape.       
+00003eb0: 2020 2020 2020 2020 2073 656c 662e 6d61           self.ma
+00003ec0: 736b 203d 2073 6b72 742e 696d 6167 652e  sk = skrt.image.
+00003ed0: 496d 6167 6528 0a20 2020 2020 2020 2020  Image(.         
+00003ee0: 2020 2020 2020 2020 2020 206e 702e 7a65             np.ze
+00003ef0: 726f 7328 7365 6c66 2e73 6861 7065 292c  ros(self.shape),
+00003f00: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00003f10: 2020 2020 2020 6166 6669 6e65 3d73 656c        affine=sel
+00003f20: 662e 696d 6167 652e 6765 745f 6166 6669  f.image.get_affi
+00003f30: 6e65 2829 2c20 0a20 2020 2020 2020 2020  ne(), .         
+00003f40: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
+00003f50: 3d62 6f6f 6c2c 0a20 2020 2020 2020 2020  =bool,.         
+00003f60: 2020 2020 2020 2020 2020 202a 2a73 656c             **sel
+00003f70: 662e 6b77 6172 6773 0a20 2020 2020 2020  f.kwargs.       
+00003f80: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00003f90: 2020 2020 2020 2020 2320 5365 7420 782d          # Set x-
+00003fa0: 7920 636f 6e74 6f75 7273 2077 6974 6820  y contours with 
+00003fb0: 7a20 706f 7369 7469 6f6e 7320 6173 206b  z positions as k
+00003fc0: 6579 730a 2020 2020 2020 2020 2020 2020  eys.            
+00003fd0: 7365 6c66 2e63 6f6e 746f 7572 735b 2278  self.contours["x
+00003fe0: 2d79 225d 203d 207b 7d0a 2020 2020 2020  -y"] = {}.      
+00003ff0: 2020 2020 2020 666f 7220 7a2c 2063 6f6e        for z, con
+00004000: 746f 7572 7320 696e 2073 656c 662e 696e  tours in self.in
+00004010: 7075 745f 636f 6e74 6f75 7273 2e69 7465  put_contours.ite
+00004020: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+00004030: 2020 2020 2020 7365 6c66 2e63 6f6e 746f        self.conto
+00004040: 7572 735b 2278 2d79 225d 5b7a 5d20 3d20  urs["x-y"][z] = 
+00004050: 5b63 6f6e 746f 7572 5b3a 2c20 3a32 5d20  [contour[:, :2] 
+00004060: 666f 7220 636f 6e74 6f75 7220 696e 2063  for contour in c
+00004070: 6f6e 746f 7572 735d 0a20 2020 2020 2020  ontours].       
+00004080: 2020 2020 2073 656c 662e 736f 7572 6365       self.source
+00004090: 5f74 7970 6520 3d20 2263 6f6e 746f 7572  _type = "contour
+000040a0: 220a 2020 2020 2020 2020 2020 2020 7365  ".            se
+000040b0: 6c66 2e6c 6f61 6465 6420 3d20 5472 7565  lf.loaded = True
+000040c0: 0a0a 2020 2020 2020 2020 2320 5374 6f72  ..        # Stor
+000040d0: 6520 666c 6167 2066 6f72 2063 6173 6573  e flag for cases
+000040e0: 2077 6974 6820 6e6f 2061 7373 6f63 6961   with no associa
+000040f0: 7465 6420 696d 6167 6520 6f72 2067 656f  ted image or geo
+00004100: 6d65 7472 6963 2069 6e66 6f0a 2020 2020  metric info.    
+00004110: 2020 2020 6861 735f 696d 6167 6520 3d20      has_image = 
+00004120: 7365 6c66 2e69 6d61 6765 2069 7320 6e6f  self.image is no
+00004130: 7420 4e6f 6e65 0a20 2020 2020 2020 2068  t None.        h
+00004140: 6173 5f67 656f 6d20 3d20 7365 6c66 2e73  as_geom = self.s
+00004150: 6861 7065 2069 7320 6e6f 7420 4e6f 6e65  hape is not None
+00004160: 2061 6e64 2028 0a20 2020 2020 2020 2020   and (.         
+00004170: 2020 2073 656c 662e 6166 6669 6e65 2069     self.affine i
+00004180: 7320 6e6f 7420 4e6f 6e65 206f 7220 280a  s not None or (.
+00004190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000041a0: 7365 6c66 2e76 6f78 656c 5f73 697a 6520  self.voxel_size 
+000041b0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+000041c0: 7365 6c66 2e6f 7269 6769 6e20 6973 206e  self.origin is n
+000041d0: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
+000041e0: 2020 2020 2929 0a20 2020 2020 2020 2073      )).        s
+000041f0: 656c 662e 636f 6e74 6f75 7273 5f6f 6e6c  elf.contours_onl
+00004200: 7920 3d20 7365 6c66 2e73 6f75 7263 655f  y = self.source_
+00004210: 7479 7065 203d 3d20 2263 6f6e 746f 7572  type == "contour
+00004220: 2220 5c0a 2020 2020 2020 2020 2020 2020  " \.            
+00004230: 2020 2020 616e 6420 6e6f 7420 6861 735f      and not has_
+00004240: 696d 6167 6520 616e 6420 6e6f 7420 6861  image and not ha
+00004250: 735f 6765 6f6d 0a20 2020 2020 2020 2069  s_geom.        i
+00004260: 6620 7365 6c66 2e64 6566 6175 6c74 5f67  f self.default_g
+00004270: 656f 6d5f 6d65 7468 6f64 203d 3d20 2261  eom_method == "a
+00004280: 7574 6f22 3a0a 2020 2020 2020 2020 2020  uto":.          
+00004290: 2020 7365 6c66 2e64 6566 6175 6c74 5f67    self.default_g
+000042a0: 656f 6d5f 6d65 7468 6f64 203d 2073 656c  eom_method = sel
+000042b0: 662e 736f 7572 6365 5f74 7970 650a 0a20  f.source_type.. 
+000042c0: 2020 2020 2020 2023 2053 746f 7265 2066         # Store f
+000042d0: 6c61 6720 666f 7220 656d 7074 696e 6573  lag for emptines
+000042e0: 730a 2020 2020 2020 2020 6966 2073 656c  s.        if sel
+000042f0: 662e 736f 7572 6365 5f74 7970 6520 3d3d  f.source_type ==
+00004300: 2022 636f 6e74 6f75 7222 3a0a 2020 2020   "contour":.    
+00004310: 2020 2020 2020 2020 7365 6c66 2e65 6d70          self.emp
+00004320: 7479 203d 206e 6f74 206c 656e 2873 656c  ty = not len(sel
+00004330: 662e 696e 7075 745f 636f 6e74 6f75 7273  f.input_contours
+00004340: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00004350: 6c66 2e73 6c69 6365 5f74 6869 636b 6e65  lf.slice_thickne
+00004360: 7373 5f63 6f6e 746f 7572 7320 3d20 7365  ss_contours = se
+00004370: 6c66 2e67 6574 5f73 6c69 6365 5f74 6869  lf.get_slice_thi
+00004380: 636b 6e65 7373 5f63 6f6e 746f 7572 7328  ckness_contours(
+00004390: 290a 2020 2020 2020 2020 656c 6966 2073  ).        elif s
+000043a0: 656c 662e 736f 7572 6365 5f74 7970 6520  elf.source_type 
+000043b0: 3d3d 2022 6d61 736b 223a 0a20 2020 2020  == "mask":.     
 000043c0: 2020 2020 2020 2073 656c 662e 656d 7074         self.empt
-000043d0: 7920 3d20 5472 7565 0a0a 2020 2020 2020  y = True..      
-000043e0: 2020 7365 6c66 2e6c 6f61 6465 6420 3d20    self.loaded = 
-000043f0: 5472 7565 0a0a 2020 2020 6465 6620 5f6c  True..    def _l
-00004400: 6f61 645f 6672 6f6d 5f66 696c 6528 7365  oad_from_file(se
-00004410: 6c66 2c20 6669 6c65 6e61 6d65 293a 0a20  lf, filename):. 
-00004420: 2020 2020 2020 2022 2222 4174 7465 6d70         """Attemp
-00004430: 7420 746f 206c 6f61 6420 524f 4920 6672  t to load ROI fr
-00004440: 6f6d 2061 2064 6963 6f6d 206f 7220 6e69  om a dicom or ni
-00004450: 6674 6920 6669 6c65 2e22 2222 0a0a 2020  fti file."""..  
-00004460: 2020 6465 6620 6c6f 6164 5f74 7261 6e73    def load_trans
-00004470: 666f 726d 6978 5f70 6f69 6e74 7328 7365  formix_points(se
-00004480: 6c66 293a 0a20 2020 2020 2020 2027 2727  lf):.        '''
-00004490: 0a20 2020 2020 2020 204c 6f61 6420 706f  .        Load po
-000044a0: 696e 7420 636f 6f72 6469 6e61 7465 7320  int coordinates 
-000044b0: 6672 6f6d 2066 696c 6520 6f66 2074 6865  from file of the
-000044c0: 2066 6f72 6d61 7420 7072 6f64 7563 6564   format produced
-000044d0: 2062 7920 5472 616e 7366 6f72 6d69 782e   by Transformix.
-000044e0: 0a20 2020 2020 2020 2027 2727 0a20 2020  .        '''.   
-000044f0: 2020 2020 2064 6566 2067 6574 5f63 6f6f       def get_coo
-00004500: 7264 696e 6174 6573 2869 6e5f 6461 7461  rdinates(in_data
-00004510: 3d27 2729 3a0a 2020 2020 2020 2020 2020  =''):.          
-00004520: 2020 2727 270a 2020 2020 2020 2020 2020    '''.          
-00004530: 2020 4865 6c70 6572 2066 756e 6374 696f    Helper functio
-00004540: 6e2c 2074 6f20 756e 7061 636b 2073 7472  n, to unpack str
-00004550: 696e 6720 6f66 2064 6174 6120 696e 746f  ing of data into
-00004560: 206c 6973 7420 6f66 2063 6f6f 7264 696e   list of coordin
-00004570: 6174 6573 2e20 0a20 2020 2020 2020 2020  ates. .         
-00004580: 2020 2027 2727 0a20 2020 2020 2020 2020     '''.         
-00004590: 2020 2063 6f6f 7264 696e 6174 6573 203d     coordinates =
-000045a0: 205b 6576 616c 2873 290a 2020 2020 2020   [eval(s).      
-000045b0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-000045c0: 7220 7320 696e 2072 652e 6669 6e64 616c  r s in re.findal
-000045d0: 6c28 7227 5b2d 5c64 5c2e 5d2b 272c 2069  l(r'[-\d\.]+', i
-000045e0: 6e5f 6461 7461 295d 0a20 2020 2020 2020  n_data)].       
-000045f0: 2020 2020 2072 6574 7572 6e20 636f 6f72       return coor
-00004600: 6469 6e61 7465 730a 0a20 2020 2020 2020  dinates..       
-00004610: 2023 2052 6561 6420 6669 6c65 2e0a 2020   # Read file..  
-00004620: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-00004630: 7365 6c66 2e73 6f75 7263 652c 2027 7227  self.source, 'r'
-00004640: 2c20 656e 636f 6469 6e67 3d27 6173 6369  , encoding='asci
-00004650: 6927 2920 6173 2069 6e5f 6669 6c65 3a0a  i') as in_file:.
-00004660: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00004670: 5f72 6f77 7320 3d20 696e 5f66 696c 652e  _rows = in_file.
-00004680: 7265 6164 6c69 6e65 7328 290a 0a20 2020  readlines()..   
-00004690: 2020 2020 2023 2045 7874 7261 6374 2070       # Extract p
-000046a0: 6f69 6e74 2064 6174 6120 746f 2064 6963  oint data to dic
-000046b0: 7469 6f6e 6172 792e 0a20 2020 2020 2020  tionary..       
-000046c0: 2070 6f69 6e74 7320 3d20 7b7d 0a20 2020   points = {}.   
-000046d0: 2020 2020 2066 6f72 2072 6f77 2069 6e20       for row in 
-000046e0: 6461 7461 5f72 6f77 733a 0a20 2020 2020  data_rows:.     
-000046f0: 2020 2020 2020 2070 6f69 6e74 2c20 696e         point, in
-00004700: 7075 745f 696e 6465 782c 2069 6e70 7574  put_index, input
-00004710: 5f70 6f69 6e74 2c20 6f75 7470 7574 5f69  _point, output_i
-00004720: 6e64 6578 5f66 6978 6564 2c20 5c0a 2020  ndex_fixed, \.  
-00004730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004740: 2020 6f75 7470 7574 5f70 6f69 6e74 2c20    output_point, 
-00004750: 6465 666f 726d 6174 696f 6e20 3d20 726f  deformation = ro
-00004760: 772e 7370 6c69 7428 273b 2729 0a0a 2020  w.split(';')..  
-00004770: 2020 2020 2020 2020 2020 706f 696e 7420            point 
-00004780: 3d20 696e 7428 706f 696e 742e 7370 6c69  = int(point.spli
-00004790: 7428 295b 2d31 5d29 0a20 2020 2020 2020  t()[-1]).       
-000047a0: 2020 2020 2070 6f69 6e74 735b 706f 696e       points[poin
-000047b0: 745d 203d 207b 7d0a 2020 2020 2020 2020  t] = {}.        
-000047c0: 2020 2020 706f 696e 7473 5b70 6f69 6e74      points[point
-000047d0: 5d5b 2749 6e70 7574 496e 6465 7827 5d20  ]['InputIndex'] 
-000047e0: 3d20 6765 745f 636f 6f72 6469 6e61 7465  = get_coordinate
-000047f0: 7328 696e 7075 745f 696e 6465 7829 0a20  s(input_index). 
-00004800: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
-00004810: 735b 706f 696e 745d 5b27 496e 7075 7450  s[point]['InputP
-00004820: 6f69 6e74 275d 203d 2067 6574 5f63 6f6f  oint'] = get_coo
-00004830: 7264 696e 6174 6573 2869 6e70 7574 5f70  rdinates(input_p
-00004840: 6f69 6e74 290a 2020 2020 2020 2020 2020  oint).          
-00004850: 2020 706f 696e 7473 5b70 6f69 6e74 5d5b    points[point][
-00004860: 274f 7574 7075 7449 6e64 6578 4669 7865  'OutputIndexFixe
-00004870: 6427 5d20 3d20 6765 745f 636f 6f72 6469  d'] = get_coordi
-00004880: 6e61 7465 7328 0a20 2020 2020 2020 2020  nates(.         
-00004890: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
-000048a0: 745f 696e 6465 785f 6669 7865 6429 0a20  t_index_fixed). 
-000048b0: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
-000048c0: 735b 706f 696e 745d 5b27 4f75 7470 7574  s[point]['Output
-000048d0: 506f 696e 7427 5d20 3d20 6765 745f 636f  Point'] = get_co
-000048e0: 6f72 6469 6e61 7465 7328 6f75 7470 7574  ordinates(output
-000048f0: 5f70 6f69 6e74 290a 2020 2020 2020 2020  _point).        
-00004900: 2020 2020 706f 696e 7473 5b70 6f69 6e74      points[point
-00004910: 5d5b 2744 6566 6f72 6d61 7469 6f6e 275d  ]['Deformation']
-00004920: 203d 2067 6574 5f63 6f6f 7264 696e 6174   = get_coordinat
-00004930: 6573 2864 6566 6f72 6d61 7469 6f6e 290a  es(deformation).
-00004940: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-00004950: 6620 7468 6520 5472 616e 7366 6f72 6d69  f the Transformi
-00004960: 7820 696e 7075 7420 7761 7320 7772 6974  x input was writ
-00004970: 7465 6e20 7573 696e 6720 524f 492e 7772  ten using ROI.wr
-00004980: 6974 6528 292c 0a20 2020 2020 2020 2020  ite(),.         
-00004990: 2020 2023 2061 2070 6f69 6e74 207a 2d63     # a point z-c
-000049a0: 6f6f 7264 696e 6174 6520 7769 6c6c 2068  oordinate will h
-000049b0: 6176 6520 7369 7820 6469 6769 7473 2061  ave six digits a
-000049c0: 6674 6572 2074 6865 2064 6563 696d 616c  fter the decimal
-000049d0: 0a20 2020 2020 2020 2020 2020 2023 2070  .            # p
-000049e0: 6f69 6e74 2c20 7769 7468 2074 6865 2063  oint, with the c
-000049f0: 6f6e 746f 7572 2069 6e64 6578 2069 6e20  ontour index in 
-00004a00: 7468 6520 6c61 7374 2074 6872 6565 2e0a  the last three..
-00004a10: 2020 2020 2020 2020 2020 2020 2320 2849              # (I
-00004a20: 6e70 7574 2070 6f69 6e74 7320 6172 6520  nput points are 
-00004a30: 7772 6974 7465 6e20 746f 2074 6865 2054  written to the T
-00004a40: 7261 6e73 666f 726d 6978 206f 7574 7075  ransformix outpu
-00004a50: 740a 2020 2020 2020 2020 2020 2020 2320  t.            # 
-00004a60: 7769 7468 2073 6978 2064 6967 6974 7320  with six digits 
-00004a70: 6166 7465 7220 7468 6520 6465 6369 6d61  after the decima
-00004a80: 6c20 706f 696e 7420 666f 7220 616c 6c20  l point for all 
-00004a90: 636f 6f72 6469 6e61 7465 732e 290a 2020  coordinates.).  
-00004aa0: 2020 2020 2020 2020 2020 7a64 5f69 6e20            zd_in 
-00004ab0: 3d20 7265 2e66 696e 6461 6c6c 2872 275b  = re.findall(r'[
-00004ac0: 2d5c 645c 2e5d 2b27 2c20 696e 7075 745f  -\d\.]+', input_
-00004ad0: 706f 696e 7429 5b2d 315d 2e72 7370 6c69  point)[-1].rspli
-00004ae0: 7428 222e 222c 2031 295b 2d31 5d0a 2020  t(".", 1)[-1].  
-00004af0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00004b00: 287a 645f 696e 2920 3d3d 2036 3a0a 2020  (zd_in) == 6:.  
-00004b10: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00004b20: 696e 7473 5b70 6f69 6e74 5d5b 2243 6f6e  ints[point]["Con
-00004b30: 746f 7572 496e 6465 7822 5d20 3d20 696e  tourIndex"] = in
-00004b40: 7428 7a64 5f69 6e5b 333a 5d29 0a20 2020  t(zd_in[3:]).   
-00004b50: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00004b60: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00004b70: 6f69 6e74 735b 706f 696e 745d 5b22 436f  oints[point]["Co
-00004b80: 6e74 6f75 7249 6e64 6578 225d 203d 2030  ntourIndex"] = 0
-00004b90: 0a0a 2020 2020 2020 2020 2320 4166 7465  ..        # Afte
-00004ba0: 7220 6170 706c 6963 6174 696f 6e20 6f66  r application of
-00004bb0: 2061 2072 6567 6973 7472 6174 696f 6e20   a registration 
-00004bc0: 7472 616e 7366 6f72 6d2c 2070 6f69 6e74  transform, point
-00004bd0: 7320 6f72 6967 696e 616c 6c79 0a20 2020  s originally.   
-00004be0: 2020 2020 2023 2069 6e20 7468 6520 7361       # in the sa
-00004bf0: 6d65 206d 6179 2065 6e64 2075 7020 7769  me may end up wi
-00004c00: 7468 2073 6c69 6768 746c 7920 6469 6666  th slightly diff
-00004c10: 6572 656e 7420 7a2d 636f 6f72 6469 6e61  erent z-coordina
-00004c20: 7465 732e 0a20 2020 2020 2020 2023 2046  tes..        # F
-00004c30: 6f72 206d 6f73 7420 7075 7270 6f73 6573  or most purposes
-00004c40: 2028 616e 6420 736c 6963 6520 7468 6963   (and slice thic
-00004c50: 6b6e 6573 7365 7329 2069 7427 7320 7072  knesses) it's pr
-00004c60: 6f62 6162 6c79 0a20 2020 2020 2020 2023  obably.        #
-00004c70: 2061 2072 6561 736f 6e61 626c 6520 6170   a reasonable ap
-00004c80: 7072 6f78 696d 6174 696f 6e20 746f 206d  proximation to m
-00004c90: 6170 2061 6c6c 2070 6f69 6e74 7320 746f  ap all points to
-00004ca0: 2074 6865 206d 6561 6e0a 2020 2020 2020   the mean.      
-00004cb0: 2020 2320 7a2d 636f 6f72 6469 6e61 7465    # z-coordinate
-00004cc0: 206f 6620 616c 6c20 706f 696e 7473 206f   of all points o
-00004cd0: 7269 6769 6e61 6c6c 7920 696e 2074 6865  riginally in the
-00004ce0: 2073 616d 6520 706c 616e 652e 0a20 2020   same plane..   
-00004cf0: 2020 2020 206b 6565 705f 6f72 6967 696e       keep_origin
-00004d00: 616c 5f70 6c61 6e65 7320 3d20 6765 7461  al_planes = geta
-00004d10: 7474 7228 7365 6c66 2c20 276b 6565 705f  ttr(self, 'keep_
-00004d20: 6f72 6967 696e 616c 5f70 6c61 6e65 7327  original_planes'
-00004d30: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
-00004d40: 6966 206b 6565 705f 6f72 6967 696e 616c  if keep_original
-00004d50: 5f70 6c61 6e65 733a 0a20 2020 2020 2020  _planes:.       
-00004d60: 2020 2020 2023 2053 6f72 7420 706f 696e       # Sort poin
-00004d70: 7473 2062 7920 736c 6963 6520 7a2d 636f  ts by slice z-co
-00004d80: 6f72 6469 6e61 7465 2c0a 2020 2020 2020  ordinate,.      
-00004d90: 2020 2020 2020 2320 6b65 6570 696e 6720        # keeping 
-00004da0: 7265 6c61 7469 7665 206f 7264 6572 2077  relative order w
-00004db0: 6974 6869 6e20 6120 736c 6963 652e 0a20  ithin a slice.. 
-00004dc0: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
-00004dd0: 7320 3d20 7b7d 0a20 2020 2020 2020 2020  s = {}.         
-00004de0: 2020 2066 6f72 2070 6f69 6e74 2069 6e20     for point in 
-00004df0: 736f 7274 6564 2870 6f69 6e74 7329 3a0a  sorted(points):.
-00004e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e10: 692c 206a 2c20 6b20 3d20 706f 696e 7473  i, j, k = points
-00004e20: 5b70 6f69 6e74 5d5b 2249 6e70 7574 496e  [point]["InputIn
-00004e30: 6465 7822 5d0a 2020 2020 2020 2020 2020  dex"].          
-00004e40: 2020 2020 2020 782c 2079 2c20 7a20 3d20        x, y, z = 
-00004e50: 706f 696e 7473 5b70 6f69 6e74 5d5b 224f  points[point]["O
-00004e60: 7574 7075 7450 6f69 6e74 225d 0a20 2020  utputPoint"].   
-00004e70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00004e80: 6b20 6e6f 7420 696e 2073 6c69 6365 733a  k not in slices:
-00004e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004ea0: 2020 2020 2073 6c69 6365 735b 6b5d 203d       slices[k] =
-00004eb0: 207b 2770 6f69 6e74 7327 3a20 5b5d 2c20   {'points': [], 
-00004ec0: 277a 5f70 6f69 6e74 7327 3a20 5b5d 7d0a  'z_points': []}.
-00004ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ee0: 736c 6963 6573 5b6b 5d5b 2270 6f69 6e74  slices[k]["point
-00004ef0: 7322 5d2e 6170 7065 6e64 2870 6f69 6e74  s"].append(point
-00004f00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00004f10: 2020 736c 6963 6573 5b6b 5d5b 227a 5f70    slices[k]["z_p
-00004f20: 6f69 6e74 7322 5d2e 6170 7065 6e64 287a  oints"].append(z
-00004f30: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00004f40: 2046 6f72 2070 6f69 6e74 7320 696e 2065   For points in e
-00004f50: 6163 6820 736c 6963 652c 2072 6573 6574  ach slice, reset
-00004f60: 207a 2d63 6f6f 7264 696e 6174 6573 2074   z-coordinates t
-00004f70: 6f20 6d65 616e 2076 616c 7565 2e0a 2020  o mean value..  
-00004f80: 2020 2020 2020 2020 2020 666f 7220 6b20            for k 
-00004f90: 696e 2073 6f72 7465 6428 736c 6963 6573  in sorted(slices
-00004fa0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00004fb0: 2020 207a 5f6d 6561 6e20 3d20 6e70 2e6d     z_mean = np.m
-00004fc0: 6561 6e28 736c 6963 6573 5b6b 5d5b 227a  ean(slices[k]["z
-00004fd0: 5f70 6f69 6e74 7322 5d29 0a20 2020 2020  _points"]).     
-00004fe0: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
-00004ff0: 6f69 6e74 2069 6e20 736c 6963 6573 5b6b  oint in slices[k
-00005000: 5d5b 2270 6f69 6e74 7322 5d3a 0a20 2020  ]["points"]:.   
-00005010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005020: 2078 2c20 792c 207a 203d 2070 6f69 6e74   x, y, z = point
-00005030: 735b 706f 696e 745d 5b22 4f75 7470 7574  s[point]["Output
-00005040: 506f 696e 7422 5d0a 2020 2020 2020 2020  Point"].        
-00005050: 2020 2020 2020 2020 2020 2020 706f 696e              poin
-00005060: 7473 5b70 6f69 6e74 5d5b 224f 7574 7075  ts[point]["Outpu
-00005070: 7450 6f69 6e74 225d 203d 2028 782c 2079  tPoint"] = (x, y
-00005080: 2c20 7a5f 6d65 616e 290a 0a20 2020 2020  , z_mean)..     
-00005090: 2020 2072 6574 7572 6e20 706f 696e 7473     return points
-000050a0: 0a0a 2020 2020 6465 6620 636c 6f6e 655f  ..    def clone_
-000050b0: 6174 7472 7328 7365 6c66 2c20 6f62 6a2c  attrs(self, obj,
-000050c0: 2063 6f70 795f 6461 7461 3d54 7275 6529   copy_data=True)
-000050d0: 3a0a 2020 2020 2020 2020 2222 2241 7373  :.        """Ass
-000050e0: 6967 6e20 616c 6c20 6174 7472 6962 7574  ign all attribut
-000050f0: 6573 206f 6620 3c73 656c 663e 2074 6f20  es of <self> to 
-00005100: 616e 6f74 6865 7220 6f62 6a65 6374 2c20  another object, 
-00005110: 3c6f 626a 3e2c 2020 656e 7375 7269 6e67  <obj>,  ensuring
-00005120: 200a 2020 2020 2020 2020 7468 6174 206f   .        that o
-00005130: 776e 206d 6173 6b27 7320 6461 7461 2067  wn mask's data g
-00005140: 6574 7320 636f 7272 6563 746c 7920 636f  ets correctly co
-00005150: 7069 6564 2069 6620 3c63 6f70 795f 6461  pied if <copy_da
-00005160: 7461 3e20 6973 2054 7275 652e 2222 220a  ta> is True.""".
-00005170: 0a20 2020 2020 2020 2073 6b72 742e 636f  .        skrt.co
-00005180: 7265 2e44 6174 612e 636c 6f6e 655f 6174  re.Data.clone_at
-00005190: 7472 7328 7365 6c66 2c20 6f62 6a2c 2063  trs(self, obj, c
-000051a0: 6f70 795f 6461 7461 3d63 6f70 795f 6461  opy_data=copy_da
-000051b0: 7461 290a 2020 2020 2020 2020 6966 2063  ta).        if c
-000051c0: 6f70 795f 6461 7461 2061 6e64 2073 656c  opy_data and sel
-000051d0: 662e 6d61 736b 2069 7320 6e6f 7420 4e6f  f.mask is not No
-000051e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000051f0: 6f62 6a2e 6d61 736b 203d 2073 656c 662e  obj.mask = self.
-00005200: 6d61 736b 2e63 6c6f 6e65 2863 6f70 795f  mask.clone(copy_
-00005210: 6461 7461 3d54 7275 6529 0a0a 2020 2020  data=True)..    
-00005220: 6465 6620 6765 745f 6469 636f 6d5f 6461  def get_dicom_da
-00005230: 7461 7365 7428 7365 6c66 293a 0a20 2020  taset(self):.   
-00005240: 2020 2020 2022 2222 5265 7475 726e 2070       """Return p
-00005250: 7964 6963 6f6d 2e64 6174 6173 6574 2e46  ydicom.dataset.F
-00005260: 696c 6544 6174 6173 6574 206f 626a 6563  ileDataset objec
-00005270: 7420 6173 736f 6369 6174 6564 2077 6974  t associated wit
-00005280: 6820 7468 6973 2052 4f49 0a20 2020 2020  h this ROI.     
-00005290: 2020 2069 6620 6c6f 6164 6564 2066 726f     if loaded fro
-000052a0: 6d20 6469 636f 6d3b 206f 7468 6572 7769  m dicom; otherwi
-000052b0: 7365 2c20 7265 7475 726e 204e 6f6e 652e  se, return None.
-000052c0: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
-000052d0: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
-000052e0: 2072 6574 7572 6e20 7365 6c66 2e64 6963   return self.dic
-000052f0: 6f6d 5f64 6174 6173 6574 0a0a 2020 2020  om_dataset..    
-00005300: 6465 6620 7265 7365 745f 636f 6e74 6f75  def reset_contou
-00005310: 7273 2873 656c 662c 2063 6f6e 746f 7572  rs(self, contour
-00005320: 733d 4e6f 6e65 2c20 6d6f 7374 5f70 6f69  s=None, most_poi
-00005330: 6e74 733d 4661 6c73 6529 3a0a 2020 2020  nts=False):.    
-00005340: 2020 2020 2222 2252 6573 6574 2078 2d79      """Reset x-y
-00005350: 2063 6f6e 746f 7572 7320 746f 2061 2067   contours to a g
-00005360: 6976 656e 2064 6963 7420 6f66 2073 6c69  iven dict of sli
-00005370: 6365 7320 616e 6420 636f 6e74 6f75 7220  ces and contour 
-00005380: 6c69 7374 732c 200a 2020 2020 2020 2020  lists, .        
-00005390: 616e 6420 656e 7375 7265 2074 6861 7420  and ensure that 
-000053a0: 6d61 736b 2061 6e64 2079 2d7a 2f78 2d7a  mask and y-z/x-z
-000053b0: 2063 6f6e 746f 7572 7320 7769 6c6c 2062   contours will b
-000053c0: 6520 7265 6372 6561 7465 642e 2049 6620  e recreated. If 
-000053d0: 0a20 2020 2020 2020 2063 6f6e 746f 7572  .        contour
-000053e0: 7320 6973 204e 6f6e 652c 2063 6f6e 746f  s is None, conto
-000053f0: 7572 7320 7769 6c6c 2062 6520 7265 7365  urs will be rese
-00005400: 7420 7573 696e 6720 6f77 6e20 782d 7920  t using own x-y 
-00005410: 636f 6e74 6f75 7273 2e0a 2020 2020 2020  contours..      
-00005420: 2020 4966 206d 6f73 745f 706f 696e 7473    If most_points
-00005430: 2069 7320 5472 7565 2c20 6f6e 6c79 2074   is True, only t
-00005440: 6865 2063 6f6e 746f 7572 2077 6974 6820  he contour with 
-00005450: 6d6f 7374 2070 6f69 6e74 7320 666f 720a  most points for.
-00005460: 2020 2020 2020 2020 6561 6368 2073 6c69          each sli
-00005470: 6365 2069 7320 636f 6e73 6964 6572 6564  ce is considered
-00005480: 2e22 2222 0a0a 2020 2020 2020 2020 2320  ."""..        # 
-00005490: 4368 6563 6b20 666f 726d 6174 2069 7320  Check format is 
-000054a0: 636f 7272 6563 740a 2020 2020 2020 2020  correct.        
-000054b0: 6966 2063 6f6e 746f 7572 7320 6973 204e  if contours is N
-000054c0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000054d0: 2063 6f6e 746f 7572 7320 3d20 7365 6c66   contours = self
-000054e0: 2e67 6574 5f63 6f6e 746f 7572 7328 290a  .get_contours().
-000054f0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00005500: 7369 6e73 7461 6e63 6528 636f 6e74 6f75  sinstance(contou
-00005510: 7273 2c20 6469 6374 293a 0a20 2020 2020  rs, dict):.     
-00005520: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-00005530: 6545 7272 6f72 2822 636f 6e74 6f75 7273  eError("contours
-00005540: 2073 686f 756c 6420 6265 2061 2064 6963   should be a dic
-00005550: 7422 290a 2020 2020 2020 2020 666f 7220  t").        for 
-00005560: 7a2c 2063 2069 6e20 636f 6e74 6f75 7273  z, c in contours
-00005570: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-00005580: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-00005590: 6e73 7461 6e63 6528 632c 206c 6973 7429  nstance(c, list)
-000055a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000055b0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-000055c0: 7228 6622 636f 6e74 6f75 7273 5b7b 7a7d  r(f"contours[{z}
-000055d0: 5d20 7368 6f75 6c64 2062 6520 6120 6c69  ] should be a li
-000055e0: 7374 206f 6620 636f 6e74 6f75 7273 2022  st of contours "
-000055f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005610: 2066 226f 6e20 736c 6963 6520 7b7a 7d22   f"on slice {z}"
-00005620: 290a 0a20 2020 2020 2020 2023 2046 6f72  )..        # For
-00005630: 2065 6163 6820 736c 6963 652c 206b 6565   each slice, kee
-00005640: 7020 6f6e 6c79 2063 6f6e 746f 7572 2077  p only contour w
-00005650: 6974 6820 6d6f 7374 2070 6f69 6e74 732e  ith most points.
-00005660: 0a20 2020 2020 2020 2069 6620 6d6f 7374  .        if most
-00005670: 5f70 6f69 6e74 733a 0a20 2020 2020 2020  _points:.       
-00005680: 2020 2020 2063 6f6e 746f 7572 7320 3d20       contours = 
-00005690: 7b6b 6579 3a20 5b6d 6178 2876 616c 7565  {key: [max(value
-000056a0: 2c20 6b65 793d 6c65 6e29 5d0a 2020 2020  , key=len)].    
-000056b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000056c0: 666f 7220 6b65 792c 2076 616c 7565 2069  for key, value i
-000056d0: 6e20 636f 6e74 6f75 7273 2e69 7465 6d73  n contours.items
-000056e0: 2829 7d0a 0a20 2020 2020 2020 2073 656c  ()}..        sel
-000056f0: 662e 696e 7075 745f 636f 6e74 6f75 7273  f.input_contours
-00005700: 203d 2063 6f6e 746f 7572 730a 2020 2020   = contours.    
-00005710: 2020 2020 7365 6c66 2e65 6d70 7479 203d      self.empty =
-00005720: 206e 6f74 206c 656e 2873 656c 662e 696e   not len(self.in
-00005730: 7075 745f 636f 6e74 6f75 7273 290a 2020  put_contours).  
-00005740: 2020 2020 2020 7365 6c66 2e63 6f6e 746f        self.conto
-00005750: 7572 7320 3d20 7b22 782d 7922 3a20 636f  urs = {"x-y": co
-00005760: 6e74 6f75 7273 7d0a 2020 2020 2020 2020  ntours}.        
-00005770: 7365 6c66 2e6c 6f61 6465 645f 6d61 736b  self.loaded_mask
-00005780: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00005790: 2073 656c 662e 6d61 736b 203d 204e 6f6e   self.mask = Non
-000057a0: 650a 0a20 2020 2064 6566 2072 6573 6574  e..    def reset
-000057b0: 5f6d 6173 6b28 7365 6c66 2c20 6d61 736b  _mask(self, mask
-000057c0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-000057d0: 2222 2253 6574 206d 6173 6b20 746f 2065  """Set mask to e
-000057e0: 6974 6865 7220 6120 6e75 6d70 7920 6172  ither a numpy ar
-000057f0: 7261 7920 6f72 2061 6e20 496d 6167 6520  ray or an Image 
-00005800: 6f62 6a65 6374 2c20 616e 6420 656e 7375  object, and ensu
-00005810: 7265 200a 2020 2020 2020 2020 7468 6174  re .        that
-00005820: 2063 6f6e 746f 7572 7320 7769 6c6c 2062   contours will b
-00005830: 6520 7265 6372 6561 7465 642e 2049 6620  e recreated. If 
-00005840: 6d61 736b 2069 7320 4e6f 6e65 2c20 636f  mask is None, co
-00005850: 6e74 6f75 7273 2077 696c 6c20 6265 200a  ntours will be .
-00005860: 2020 2020 2020 2020 7265 7365 7420 7573          reset us
-00005870: 696e 6720 6f77 6e20 6d61 736b 2e22 2222  ing own mask."""
-00005880: 0a0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-00005890: 6e73 7461 6e63 6528 6d61 736b 2c20 736b  nstance(mask, sk
-000058a0: 7274 2e69 6d61 6765 2e49 6d61 6765 293a  rt.image.Image):
-000058b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000058c0: 662e 6d61 736b 203d 206d 6173 6b0a 2020  f.mask = mask.  
-000058d0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000058e0: 6666 696e 6520 3d20 6d61 736b 2e67 6574  ffine = mask.get
-000058f0: 5f61 6666 696e 6528 290a 2020 2020 2020  _affine().      
-00005900: 2020 2020 2020 7365 6c66 2e76 6f78 656c        self.voxel
-00005910: 5f73 697a 6520 3d20 6d61 736b 2e67 6574  _size = mask.get
-00005920: 5f76 6f78 656c 5f73 697a 6528 290a 2020  _voxel_size().  
-00005930: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
-00005940: 7269 6769 6e20 3d20 6d61 736b 2e67 6574  rigin = mask.get
-00005950: 5f6f 7269 6769 6e28 290a 2020 2020 2020  _origin().      
-00005960: 2020 2020 2020 7365 6c66 2e73 6861 7065        self.shape
-00005970: 203d 206d 6173 6b2e 6765 745f 6461 7461   = mask.get_data
-00005980: 2829 2e73 6861 7065 0a0a 2020 2020 2020  ().shape..      
-00005990: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-000059a0: 6528 6d61 736b 2c20 6e70 2e6e 6461 7272  e(mask, np.ndarr
-000059b0: 6179 293a 0a20 2020 2020 2020 2020 2020  ay):.           
-000059c0: 2073 656c 662e 6d61 736b 203d 2073 6b72   self.mask = skr
-000059d0: 742e 696d 6167 652e 496d 6167 6528 0a20  t.image.Image(. 
-000059e0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000059f0: 6173 6b2c 0a20 2020 2020 2020 2020 2020  ask,.           
-00005a00: 2020 2020 2061 6666 696e 6520 3d20 7365       affine = se
-00005a10: 6c66 2e61 6666 696e 652c 0a20 2020 2020  lf.affine,.     
-00005a20: 2020 2020 2020 2020 2020 2076 6f78 656c             voxel
-00005a30: 5f73 697a 653d 7365 6c66 2e76 6f78 656c  _size=self.voxel
-00005a40: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
-00005a50: 2020 2020 2020 206f 7269 6769 6e3d 7365         origin=se
-00005a60: 6c66 2e6f 7269 6769 6e2c 0a20 2020 2020  lf.origin,.     
-00005a70: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
-00005a80: 3d62 6f6f 6c0a 2020 2020 2020 2020 2020  =bool.          
-00005a90: 2020 290a 0a20 2020 2020 2020 2065 6c69    )..        eli
-00005aa0: 6620 6d61 736b 2069 7320 6e6f 7420 4e6f  f mask is not No
-00005ab0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00005ac0: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
-00005ad0: 226d 6173 6b20 7368 6f75 6c64 2062 6520  "mask should be 
-00005ae0: 616e 2049 6d61 6765 206f 7220 6120 6e75  an Image or a nu
-00005af0: 6d70 7920 6172 7261 7922 290a 0a20 2020  mpy array")..   
-00005b00: 2020 2020 2073 656c 662e 6d61 736b 2e67       self.mask.g
-00005b10: 6574 5f73 7461 6e64 6172 6469 7365 645f  et_standardised_
-00005b20: 6461 7461 2866 6f72 6365 3d54 7275 6529  data(force=True)
-00005b30: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-00005b40: 6164 6564 5f6d 6173 6b20 3d20 5472 7565  aded_mask = True
-00005b50: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-00005b60: 6e74 6f75 7273 203d 207b 7d0a 2020 2020  ntours = {}.    
-00005b70: 2020 2020 7365 6c66 2e65 6d70 7479 203d      self.empty =
-00005b80: 206e 6f74 206e 702e 616e 7928 7365 6c66   not np.any(self
-00005b90: 2e6d 6173 6b2e 6765 745f 6461 7461 2829  .mask.get_data()
-00005ba0: 290a 2020 2020 2020 2020 7365 6c66 2e69  ).        self.i
-00005bb0: 6e70 7574 5f63 6f6e 746f 7572 7320 3d20  nput_contours = 
-00005bc0: 4e6f 6e65 0a0a 2020 2020 6465 6620 6765  None..    def ge
-00005bd0: 745f 636f 6e74 6f75 7273 2873 656c 662c  t_contours(self,
-00005be0: 2076 6965 773d 2278 2d79 222c 2069 6478   view="x-y", idx
-00005bf0: 5f61 735f 6b65 793d 4661 6c73 652c 206d  _as_key=False, m
-00005c00: 6f73 745f 706f 696e 7473 3d46 616c 7365  ost_points=False
-00005c10: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00005c20: 2020 2020 2020 2047 6574 2064 6963 7420         Get dict 
-00005c30: 6f66 2063 6f6e 746f 7572 7320 696e 2061  of contours in a
-00005c40: 2067 6976 656e 206f 7269 656e 7461 7469   given orientati
-00005c50: 6f6e 2e0a 0a20 2020 2020 2020 202a 2a50  on...        **P
-00005c60: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
-00005c70: 2020 2020 2020 7669 6577 203a 2073 7472        view : str
-00005c80: 2c20 6465 6661 756c 743d 2278 2d79 220a  , default="x-y".
-00005c90: 2020 2020 2020 2020 2020 2020 5669 6577              View
-00005ca0: 2069 6e20 7768 6963 6820 746f 206f 6274   in which to obt
-00005cb0: 6169 6e20 636f 6e74 6f75 7273 2e0a 0a20  ain contours... 
-00005cc0: 2020 2020 2020 2069 6478 5f61 735f 6b65         idx_as_ke
-00005cd0: 7920 3a20 626f 6f6c 2c20 6465 6661 756c  y : bool, defaul
-00005ce0: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
-00005cf0: 2020 2020 4966 2054 7275 652c 2075 7365      If True, use
-00005d00: 2073 6c69 6365 2069 6e64 6963 6573 2061   slice indices a
-00005d10: 7320 6469 6374 696f 6e61 7279 206b 6579  s dictionary key
-00005d20: 733b 2069 6620 4661 6c73 652c 0a20 2020  s; if False,.   
-00005d30: 2020 2020 2020 2020 2075 7365 2073 6c69           use sli
-00005d40: 6365 207a 2d63 6f6f 7264 696e 6174 6573  ce z-coordinates
-00005d50: 2061 7320 6469 6374 696f 6e61 7279 206b   as dictionary k
-00005d60: 6579 732e 0a0a 2020 2020 2020 2020 6d6f  eys...        mo
-00005d70: 7374 5f70 6f69 6e74 7320 3a20 626f 6f6c  st_points : bool
-00005d80: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
-00005d90: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-00005da0: 7275 652c 2072 6574 7572 6e20 6f6e 6c79  rue, return only
-00005db0: 2074 6865 2063 6f6e 746f 7572 2077 6974   the contour wit
-00005dc0: 6820 6d6f 7374 2070 6f69 6e74 7320 666f  h most points fo
-00005dd0: 7220 6561 6368 2073 6c69 6365 3b0a 2020  r each slice;.  
-00005de0: 2020 2020 2020 2020 2020 6966 2046 616c            if Fal
-00005df0: 7365 2c20 7265 7475 726e 2061 6c6c 2063  se, return all c
-00005e00: 6f6e 746f 7572 7320 666f 7220 6561 6368  ontours for each
-00005e10: 2073 6c69 6365 2e0a 2020 2020 2020 2020   slice..        
-00005e20: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
-00005e30: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
-00005e40: 2069 6620 7669 6577 206e 6f74 2069 6e20   if view not in 
-00005e50: 7365 6c66 2e63 6f6e 746f 7572 733a 0a20  self.contours:. 
-00005e60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005e70: 6372 6561 7465 5f63 6f6e 746f 7572 7328  create_contours(
-00005e80: 7669 6577 290a 2020 2020 2020 2020 636f  view).        co
-00005e90: 6e74 6f75 7273 203d 2073 656c 662e 636f  ntours = self.co
-00005ea0: 6e74 6f75 7273 5b76 6965 775d 0a0a 2020  ntours[view]..  
-00005eb0: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
-00005ec0: 6b65 7973 2074 6f20 696e 6469 6365 7320  keys to indices 
-00005ed0: 7261 7468 6572 2074 6861 6e20 706f 7369  rather than posi
-00005ee0: 7469 6f6e 730a 2020 2020 2020 2020 6966  tions.        if
-00005ef0: 2069 6478 5f61 735f 6b65 793a 0a20 2020   idx_as_key:.   
-00005f00: 2020 2020 2020 2020 2063 6f6e 746f 7572           contour
-00005f10: 7320 3d20 7b73 656c 662e 706f 735f 746f  s = {self.pos_to
-00005f20: 5f69 6478 286b 6579 2c20 736b 7274 2e69  _idx(key, skrt.i
-00005f30: 6d61 6765 2e5f 736c 6963 655f 6178 6573  mage._slice_axes
-00005f40: 5b76 6965 775d 293a 200a 2020 2020 2020  [view]): .      
-00005f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f60: 2020 7661 6c75 6520 666f 7220 6b65 792c    value for key,
-00005f70: 2076 616c 7565 2069 6e20 636f 6e74 6f75   value in contou
-00005f80: 7273 2e69 7465 6d73 2829 7d0a 0a20 2020  rs.items()}..   
-00005f90: 2020 2020 2023 2046 6f72 2065 6163 6820       # For each 
-00005fa0: 736c 6963 652c 206b 6565 7020 6f6e 6c79  slice, keep only
-00005fb0: 2063 6f6e 746f 7572 2077 6974 6820 6d6f   contour with mo
-00005fc0: 7374 2070 6f69 6e74 732e 0a20 2020 2020  st points..     
-00005fd0: 2020 2069 6620 6d6f 7374 5f70 6f69 6e74     if most_point
-00005fe0: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
-00005ff0: 6f6e 746f 7572 7320 3d20 7b6b 6579 3a20  ontours = {key: 
-00006000: 5b6d 6178 2876 616c 7565 2c20 6b65 793d  [max(value, key=
-00006010: 6c65 6e29 5d0a 2020 2020 2020 2020 2020  len)].          
-00006020: 2020 2020 2020 2020 2020 666f 7220 6b65            for ke
-00006030: 792c 2076 616c 7565 2069 6e20 636f 6e74  y, value in cont
-00006040: 6f75 7273 2e69 7465 6d73 2829 7d0a 0a20  ours.items()}.. 
-00006050: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
-00006060: 6e74 6f75 7273 0a0a 2020 2020 6465 6620  ntours..    def 
-00006070: 6765 745f 636f 6e74 6f75 7273 5f6f 6e5f  get_contours_on_
-00006080: 736c 6963 6528 7365 6c66 2c20 7669 6577  slice(self, view
-00006090: 3d22 782d 7922 2c20 736c 3d4e 6f6e 652c  ="x-y", sl=None,
-000060a0: 2069 6478 3d4e 6f6e 652c 2070 6f73 3d4e   idx=None, pos=N
-000060b0: 6f6e 6529 3a0a 0a20 2020 2020 2020 2073  one):..        s
-000060c0: 656c 662e 6c6f 6164 2829 0a20 2020 2020  elf.load().     
-000060d0: 2020 2069 6620 736c 2069 7320 4e6f 6e65     if sl is None
-000060e0: 2061 6e64 2069 6478 2069 7320 4e6f 6e65   and idx is None
-000060f0: 2061 6e64 2070 6f73 2069 7320 4e6f 6e65   and pos is None
-00006100: 3a0a 2020 2020 2020 2020 2020 2020 6964  :.            id
-00006110: 7820 3d20 7365 6c66 2e67 6574 5f6d 6964  x = self.get_mid
-00006120: 5f69 6478 2876 6965 7729 0a20 2020 2020  _idx(view).     
-00006130: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00006140: 2020 2020 2069 6478 203d 2073 656c 662e       idx = self.
-00006150: 6765 745f 6964 7828 7669 6577 2c20 736c  get_idx(view, sl
-00006160: 2c20 6964 782c 2070 6f73 290a 2020 2020  , idx, pos).    
-00006170: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00006180: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00006190: 2e67 6574 5f63 6f6e 746f 7572 7328 7669  .get_contours(vi
-000061a0: 6577 2c20 6964 785f 6173 5f6b 6579 3d54  ew, idx_as_key=T
-000061b0: 7275 6529 5b69 6478 5d0a 2020 2020 2020  rue)[idx].      
-000061c0: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-000061d0: 723a 0a20 2020 2020 2020 2020 2020 2072  r:.            r
-000061e0: 6574 7572 6e20 5b5d 0a0a 2020 2020 6465  eturn []..    de
-000061f0: 6620 6765 745f 736c 6963 655f 706f 7369  f get_slice_posi
-00006200: 7469 6f6e 7328 7365 6c66 2c20 6f74 6865  tions(self, othe
-00006210: 723d 4e6f 6e65 2c20 7669 6577 3d22 782d  r=None, view="x-
-00006220: 7922 2c20 706f 7369 7469 6f6e 5f61 735f  y", position_as_
-00006230: 6964 783d 4661 6c73 652c 0a20 2020 2020  idx=False,.     
-00006240: 2020 2020 2020 206d 6574 686f 643d 2275         method="u
-00006250: 6e69 6f6e 2229 3a0a 2020 2020 2020 2020  nion"):.        
-00006260: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
-00006270: 6f72 6465 7265 6420 6c69 7374 206f 6620  ordered list of 
-00006280: 736c 6963 6520 706f 7369 7469 6f6e 7320  slice positions 
-00006290: 666f 7220 7365 6c66 2061 6e64 206f 7468  for self and oth
-000062a0: 6572 2e0a 0a20 2020 2020 2020 202a 2a50  er...        **P
-000062b0: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
-000062c0: 2020 2020 2020 6f74 6865 7220 3a20 736b        other : sk
-000062d0: 7274 2e73 7472 7563 7475 7265 732e 524f  rt.structures.RO
-000062e0: 492c 2064 6566 6175 6c74 3d4e 6f6e 650a  I, default=None.
-000062f0: 2020 2020 2020 2020 2020 2020 5365 636f              Seco
-00006300: 6e64 2052 4f49 206f 6620 6120 7061 6972  nd ROI of a pair
-00006310: 2066 6f72 2077 6869 6368 2073 6c69 6365   for which slice
-00006320: 2070 6f73 6974 696f 6e73 2061 7265 2062   positions are b
-00006330: 6520 6f62 7461 696e 6564 2e0a 2020 2020  e obtained..    
-00006340: 2020 2020 2020 2020 4469 7372 6567 6172          Disregar
-00006350: 6465 6420 6966 204e 6f6e 652e 0a0a 2020  ded if None...  
-00006360: 2020 2020 2020 7669 6577 203a 2073 7472        view : str
-00006370: 2c20 6465 6661 756c 743d 2278 2d79 220a  , default="x-y".
-00006380: 2020 2020 2020 2020 2020 2020 5669 6577              View
-00006390: 2069 6e20 7768 6963 6820 746f 206f 6274   in which to obt
-000063a0: 6169 6e20 736c 6963 6573 2e0a 0a20 2020  ain slices...   
-000063b0: 2020 2020 2070 6f73 6974 696f 6e5f 6173       position_as
-000063c0: 5f69 6478 203a 2062 6f6f 6c2c 2064 6566  _idx : bool, def
-000063d0: 6175 6c74 3d46 616c 7365 0a20 2020 2020  ault=False.     
-000063e0: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-000063f0: 7265 7475 726e 2070 6f73 6974 696f 6e73  return positions
-00006400: 2061 7320 736c 6963 6520 696e 6469 6365   as slice indice
-00006410: 733b 2069 6620 4661 6c73 652c 0a20 2020  s; if False,.   
-00006420: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00006430: 706f 7369 7469 6f6e 7320 6173 2073 6c69  positions as sli
-00006440: 6365 207a 2d63 6f6f 7264 696e 6174 6573  ce z-coordinates
-00006450: 2028 6d6d 292e 0a0a 2020 2020 2020 2020   (mm)...        
-00006460: 6d65 7468 6f64 3a20 7374 722c 2064 6566  method: str, def
-00006470: 6175 6c74 3d22 756e 696f 6e22 0a20 2020  ault="union".   
-00006480: 2020 2020 2020 2020 2053 7472 696e 6720           String 
-00006490: 7370 6563 6966 7969 6e67 2073 6c69 6365  specifying slice
-000064a0: 7320 666f 7220 7768 6963 6820 706f 7369  s for which posi
-000064b0: 7469 6f6e 7320 6172 6520 746f 2062 6520  tions are to be 
-000064c0: 6f62 7461 696e 6564 2c0a 2020 2020 2020  obtained,.      
-000064d0: 2020 2020 2020 666f 7220 524f 4973 2073        for ROIs s
-000064e0: 656c 6620 616e 6420 6f74 6865 722e 0a0a  elf and other...
-000064f0: 2020 2020 2020 2020 2020 2020 2d20 226c              - "l
-00006500: 6566 7422 2028 6f72 206f 7468 6572 2069  eft" (or other i
-00006510: 7320 4e6f 6e65 293a 2072 6574 7572 6e20  s None): return 
-00006520: 706f 7369 7469 6f6e 7320 6f66 0a20 2020  positions of.   
-00006530: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
-00006540: 7320 636f 6e74 6169 6e69 6e67 2073 656c  s containing sel
-00006550: 663b 0a20 2020 2020 2020 2020 2020 202d  f;.            -
-00006560: 2022 7269 6768 7422 3a20 7265 7475 726e   "right": return
-00006570: 2070 6f73 6974 696f 6e73 206f 6620 736c   positions of sl
-00006580: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
-00006590: 6f74 6865 723b 0a20 2020 2020 2020 2020  other;.         
-000065a0: 2020 202d 2022 756e 696f 6e22 3a20 7265     - "union": re
-000065b0: 7475 726e 2070 6f73 6974 696f 6e73 206f  turn positions o
-000065c0: 6620 736c 6963 6573 2063 6f6e 7461 696e  f slices contain
-000065d0: 696e 6720 6569 7468 6572 2073 656c 660a  ing either self.
-000065e0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-000065f0: 206f 7468 6572 3b0a 2020 2020 2020 2020   other;.        
-00006600: 2020 2020 2d20 2269 6e74 6572 7365 6374      - "intersect
-00006610: 696f 6e22 3a20 7265 7475 726e 2070 6f73  ion": return pos
-00006620: 6974 696f 6e73 206f 6620 736c 6963 6573  itions of slices
-00006630: 2063 6f6e 7461 696e 696e 6720 626f 7468   containing both
-00006640: 0a20 2020 2020 2020 2020 2020 2020 2073  .              s
-00006650: 656c 6620 616e 6420 6f74 6865 722e 0a20  elf and other.. 
-00006660: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00006670: 2020 2072 6574 7572 6e20 6765 745f 736c     return get_sl
-00006680: 6963 655f 706f 7369 7469 6f6e 7328 7365  ice_positions(se
-00006690: 6c66 2c20 6f74 6865 722c 2076 6965 772c  lf, other, view,
-000066a0: 2070 6f73 6974 696f 6e5f 6173 5f69 6478   position_as_idx
-000066b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000066c0: 2020 6d65 7468 6f64 290a 0a20 2020 2064    method)..    d
-000066d0: 6566 2067 6574 5f61 6666 696e 6528 7365  ef get_affine(se
-000066e0: 6c66 2c20 666f 7263 655f 7374 616e 6461  lf, force_standa
-000066f0: 7264 6973 653d 4661 6c73 652c 202a 2a6b  rdise=False, **k
-00006700: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-00006710: 2222 224c 6f61 6420 7365 6c66 2061 6e64  """Load self and
-00006720: 2067 6574 2061 6666 696e 6520 6d61 7472   get affine matr
-00006730: 6978 2e22 2222 0a0a 2020 2020 2020 2020  ix."""..        
-00006740: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
-00006750: 2020 2020 6966 2073 656c 662e 6c6f 6164      if self.load
-00006760: 6564 5f6d 6173 6b3a 0a20 2020 2020 2020  ed_mask:.       
-00006770: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00006780: 2e6d 6173 6b2e 6765 745f 6166 6669 6e65  .mask.get_affine
-00006790: 2866 6f72 6365 5f73 7461 6e64 6172 6469  (force_standardi
-000067a0: 7365 3d66 6f72 6365 5f73 7461 6e64 6172  se=force_standar
-000067b0: 6469 7365 2c20 0a20 2020 2020 2020 2020  dise, .         
-000067c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000067d0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-000067e0: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-000067f0: 2065 6c69 6620 7365 6c66 2e69 6d61 6765   elif self.image
-00006800: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00006810: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00006820: 2073 656c 662e 696d 6167 652e 6765 745f   self.image.get_
-00006830: 6166 6669 6e65 2866 6f72 6365 5f73 7461  affine(force_sta
-00006840: 6e64 6172 6469 7365 3d66 6f72 6365 5f73  ndardise=force_s
-00006850: 7461 6e64 6172 6469 7365 2c0a 2020 2020  tandardise,.    
-00006860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006880: 2020 2020 202a 2a6b 7761 7267 7329 0a20       **kwargs). 
-00006890: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000068a0: 6c66 2e61 6666 696e 650a 0a20 2020 2064  lf.affine..    d
-000068b0: 6566 2067 6574 5f74 7261 6e73 6c61 7469  ef get_translati
-000068c0: 6f6e 5f74 6f5f 616c 6967 6e28 0a20 2020  on_to_align(.   
-000068d0: 2020 2020 2020 2020 2073 656c 662c 206f           self, o
-000068e0: 7468 6572 2c20 7a5f 6672 6163 7469 6f6e  ther, z_fraction
-000068f0: 313d 4e6f 6e65 2c20 7a5f 6672 6163 7469  1=None, z_fracti
-00006900: 6f6e 323d 4e6f 6e65 293a 0a20 2020 2020  on2=None):.     
-00006910: 2020 2022 2222 0a20 2020 2020 2020 2044     """.        D
-00006920: 6574 6572 6d69 6e65 2074 7261 6e73 6c61  etermine transla
-00006930: 7469 6f6e 2066 6f72 2061 6c69 676e 696e  tion for alignin
-00006940: 6720 3c73 656c 663e 2074 6f20 3c6f 7468  g <self> to <oth
-00006950: 6572 3e2e 0a0a 2020 2020 2020 2020 2a2a  er>...        **
-00006960: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
-00006970: 2020 2020 2020 206f 7468 6572 203a 2052         other : R
-00006980: 4f49 2f53 7472 7563 7475 7265 5365 742f  OI/StructureSet/
-00006990: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
-000069a0: 2052 4f49 2077 6974 6820 7768 6963 6820   ROI with which 
-000069b0: 616c 6967 6e6d 656e 7420 6973 2074 6f20  alignment is to 
-000069c0: 6265 2070 6572 666f 726d 6564 2e20 2054  be performed.  T
-000069d0: 6869 7320 6361 6e20 6265 0a20 2020 2020  his can be.     
-000069e0: 2020 2020 2020 2073 7065 6369 6669 6564         specified
-000069f0: 2064 6972 6563 746c 7920 6173 2061 2073   directly as a s
-00006a00: 696e 676c 6520 524f 492e 2020 416c 7465  ingle ROI.  Alte
-00006a10: 726e 6174 6976 656c 792c 2069 7420 6361  rnatively, it ca
-00006a20: 6e0a 2020 2020 2020 2020 2020 2020 6265  n.            be
-00006a30: 2061 2053 7472 7563 7475 7265 5365 742c   a StructureSet,
-00006a40: 206f 7220 6120 6c69 7374 206f 7220 524f   or a list or RO
-00006a50: 492f 5374 7275 6374 7572 6553 6574 206f  I/StructureSet o
-00006a60: 626a 6563 7473 2c0a 2020 2020 2020 2020  bjects,.        
-00006a70: 2020 2020 696e 2077 6869 6368 2063 6173      in which cas
-00006a80: 6520 7468 6520 696e 6469 7669 6475 616c  e the individual
-00006a90: 2052 4f49 7320 7769 6c6c 2062 6520 636f   ROIs will be co
-00006aa0: 6d62 696e 6564 2e0a 0a20 2020 2020 2020  mbined...       
-00006ab0: 207a 5f66 7261 6374 696f 6e31 203a 2066   z_fraction1 : f
-00006ac0: 6c6f 6174 2c20 6465 6661 756c 743d 4e6f  loat, default=No
-00006ad0: 6e65 0a20 2020 2020 2020 2020 2020 2050  ne.            P
-00006ae0: 6f73 6974 696f 6e20 616c 6f6e 6720 7a20  osition along z 
-00006af0: 6178 6973 206f 6620 736c 6963 6520 7468  axis of slice th
-00006b00: 726f 7567 6820 3c73 656c 663e 206f 6e20  rough <self> on 
-00006b10: 7768 6963 680a 2020 2020 2020 2020 2020  which.          
-00006b20: 2020 746f 2061 6c69 676e 2e20 2049 6620    to align.  If 
-00006b30: 4e6f 6e65 2c20 616c 6967 6e6d 656e 7420  None, alignment 
-00006b40: 6973 2074 6f20 7468 6520 6365 6e74 726f  is to the centro
-00006b50: 6964 206f 6620 7468 650a 2020 2020 2020  id of the.      
-00006b60: 2020 2020 2020 7768 6f6c 6520 524f 4920        whole ROI 
-00006b70: 766f 6c75 6d65 2e20 204f 7468 6572 7769  volume.  Otherwi
-00006b80: 7365 2c20 616c 6967 6e6d 656e 7420 6973  se, alignment is
-00006b90: 2074 6f20 7468 650a 2020 2020 2020 2020   to the.        
-00006ba0: 2020 2020 6365 6e74 726f 6964 206f 6620      centroid of 
-00006bb0: 7468 6520 736c 6963 6520 6174 2074 6865  the slice at the
-00006bc0: 2073 7065 6369 6669 6564 2064 6973 7461   specified dista
-00006bd0: 6e63 650a 2020 2020 2020 2020 2020 2020  nce.            
-00006be0: 6672 6f6d 2074 6865 2052 4f49 2773 206d  from the ROI's m
-00006bf0: 6f73 742d 696e 6665 7269 6f72 2070 6f69  ost-inferior poi
-00006c00: 6e74 3a20 3020 636f 7272 6573 706f 6e64  nt: 0 correspond
-00006c10: 7320 746f 0a20 2020 2020 2020 2020 2020  s to.           
-00006c20: 2074 6865 206d 6f73 742d 696e 6665 7269   the most-inferi
-00006c30: 6f72 2070 6f69 6e74 2028 6c6f 7765 7374  or point (lowest
-00006c40: 207a 293b 2031 2063 6f72 7265 7370 6f6e   z); 1 correspon
-00006c50: 6473 2074 6f20 7468 650a 2020 2020 2020  ds to the.      
-00006c60: 2020 2020 2020 6d6f 7374 2d73 7570 6572        most-super
-00006c70: 696f 7220 706f 696e 7420 2868 6967 6865  ior point (highe
-00006c80: 7374 207a 292e 2020 5661 6c75 6573 2066  st z).  Values f
-00006c90: 6f72 207a 5f66 7261 6374 696f 6e0a 2020  or z_fraction.  
-00006ca0: 2020 2020 2020 2020 2020 6f75 7473 6964            outsid
-00006cb0: 6520 7468 6520 696e 7465 7276 616c 205b  e the interval [
-00006cc0: 302c 2031 5d20 7265 7375 6c74 2069 6e20  0, 1] result in 
-00006cd0: 6120 5275 6e74 696d 6545 7272 6f72 2e0a  a RuntimeError..
-00006ce0: 0a20 2020 2020 2020 207a 5f66 7261 6374  .        z_fract
-00006cf0: 696f 6e32 203a 2066 6c6f 6174 2c20 6465  ion2 : float, de
-00006d00: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00006d10: 2020 2020 2020 2050 6f73 6974 696f 6e20         Position 
-00006d20: 616c 6f6e 6720 7a20 6178 6973 206f 6620  along z axis of 
-00006d30: 736c 6963 6520 7468 726f 7567 6820 3c6f  slice through <o
-00006d40: 7468 6572 3e20 6f6e 2077 6869 6368 0a20  ther> on which. 
-00006d50: 2020 2020 2020 2020 2020 2074 6f20 616c             to al
-00006d60: 6967 6e2e 2020 4966 204e 6f6e 652c 2061  ign.  If None, a
-00006d70: 6c69 676e 6d65 6e74 2069 7320 746f 2074  lignment is to t
-00006d80: 6865 2063 656e 7472 6f69 6420 6f66 2074  he centroid of t
-00006d90: 6865 0a20 2020 2020 2020 2020 2020 2077  he.            w
-00006da0: 686f 6c65 2052 4f49 2076 6f6c 756d 652e  hole ROI volume.
-00006db0: 2020 4f74 6865 7277 6973 652c 2061 6c69    Otherwise, ali
-00006dc0: 676e 6d65 6e74 2069 7320 746f 2074 6865  gnment is to the
-00006dd0: 0a20 2020 2020 2020 2020 2020 2063 656e  .            cen
-00006de0: 7472 6f69 6420 6f66 2074 6865 2073 6c69  troid of the sli
-00006df0: 6365 2061 7420 7468 6520 7370 6563 6966  ce at the specif
-00006e00: 6965 6420 6469 7374 616e 6365 0a20 2020  ied distance.   
-00006e10: 2020 2020 2020 2020 2066 726f 6d20 7468           from th
-00006e20: 6520 524f 4927 7320 6d6f 7374 2d69 6e66  e ROI's most-inf
-00006e30: 6572 696f 7220 706f 696e 743a 2030 2063  erior point: 0 c
-00006e40: 6f72 7265 7370 6f6e 6473 2074 6f0a 2020  orresponds to.  
-00006e50: 2020 2020 2020 2020 2020 7468 6520 6d6f            the mo
-00006e60: 7374 2d69 6e66 6572 696f 7220 706f 696e  st-inferior poin
-00006e70: 7420 286c 6f77 6573 7420 7a29 3b20 3120  t (lowest z); 1 
-00006e80: 636f 7272 6573 706f 6e64 7320 746f 2074  corresponds to t
-00006e90: 6865 0a20 2020 2020 2020 2020 2020 206d  he.            m
-00006ea0: 6f73 742d 7375 7065 7269 6f72 2070 6f69  ost-superior poi
-00006eb0: 6e74 2028 6869 6768 6573 7420 7a29 2e20  nt (highest z). 
-00006ec0: 2056 616c 7565 7320 666f 7220 7a5f 6672   Values for z_fr
-00006ed0: 6163 7469 6f6e 0a20 2020 2020 2020 2020  action.         
-00006ee0: 2020 206f 7574 7369 6465 2074 6865 2069     outside the i
-00006ef0: 6e74 6572 7661 6c20 5b30 2c20 315d 2072  nterval [0, 1] r
-00006f00: 6573 756c 7420 696e 2061 2052 756e 7469  esult in a Runti
-00006f10: 6d65 4572 726f 722e 0a20 2020 2020 2020  meError..       
-00006f20: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00006f30: 2072 6574 7572 6e20 6765 745f 7472 616e   return get_tran
-00006f40: 736c 6174 696f 6e5f 746f 5f61 6c69 676e  slation_to_align
-00006f50: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00006f60: 2020 7365 6c66 2c20 6f74 6865 722c 207a    self, other, z
-00006f70: 5f66 7261 6374 696f 6e31 2c20 7a5f 6672  _fraction1, z_fr
-00006f80: 6163 7469 6f6e 3229 0a0a 2020 2020 6465  action2)..    de
-00006f90: 6620 6765 745f 766f 7865 6c5f 7369 7a65  f get_voxel_size
-00006fa0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00006fb0: 2222 224c 6f61 6420 7365 6c66 2061 6e64  """Load self and
-00006fc0: 2067 6574 2076 6f78 656c 5f73 697a 652e   get voxel_size.
-00006fd0: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
-00006fe0: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
-00006ff0: 2072 6574 7572 6e20 7365 6c66 2e76 6f78   return self.vox
-00007000: 656c 5f73 697a 650a 0a20 2020 2064 6566  el_size..    def
-00007010: 2067 6574 5f6e 705f 766f 7865 6c5f 7369   get_np_voxel_si
-00007020: 7a65 2873 656c 662c 2076 6965 773d 4e6f  ze(self, view=No
-00007030: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
-00007040: 0a20 2020 2020 2020 2047 6574 2076 6f78  .        Get vox
-00007050: 656c 5f73 697a 6520 666f 7220 6e75 6d70  el_size for nump
-00007060: 7920 6178 6973 206f 7264 6572 696e 6720  y axis ordering 
-00007070: 616e 6420 7370 6563 6966 6965 6420 7669  and specified vi
-00007080: 6577 2e0a 0a20 2020 2020 2020 2076 6965  ew...        vie
-00007090: 7720 3a20 7374 720a 2020 2020 2020 2020  w : str.        
-000070a0: 2020 2020 4f72 6965 6e74 6174 696f 6e20      Orientation 
-000070b0: 636f 6e73 6964 6572 6564 2066 6f72 2032  considered for 2
-000070c0: 4420 696d 6167 6520 6f72 2070 726f 6a65  D image or proje
-000070d0: 6374 696f 6e2e 0a20 2020 2020 2020 2020  ction..         
-000070e0: 2020 2043 616e 2062 6520 2278 2d79 222c     Can be "x-y",
-000070f0: 2022 792d 7a22 2c20 6f72 2022 782d 7a22   "y-z", or "x-z"
-00007100: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00007110: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
-00007120: 2829 0a20 2020 2020 2020 2069 6620 7669  ().        if vi
-00007130: 6577 2069 7320 4e6f 6e65 3a0a 2020 2020  ew is None:.    
-00007140: 2020 2020 2020 2020 7678 2c20 7679 2c20          vx, vy, 
-00007150: 767a 203d 2073 656c 662e 766f 7865 6c5f  vz = self.voxel_
-00007160: 7369 7a65 0a20 2020 2020 2020 2020 2020  size.           
-00007170: 2076 6f78 656c 5f73 697a 6520 3d20 5b76   voxel_size = [v
-00007180: 792c 2076 782c 2076 7a5d 0a20 2020 2020  y, vx, vz].     
-00007190: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000071a0: 2020 2020 2076 6f78 656c 5f73 697a 6520       voxel_size 
-000071b0: 3d20 5b73 656c 662e 766f 7865 6c5f 7369  = [self.voxel_si
-000071c0: 7a65 5b69 5d0a 2020 2020 2020 2020 2020  ze[i].          
-000071d0: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
-000071e0: 696e 2073 6b72 742e 696d 6167 652e 5f70  in skrt.image._p
-000071f0: 6c6f 745f 6178 6573 5b76 6965 775d 5d0a  lot_axes[view]].
-00007200: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00007210: 766f 7865 6c5f 7369 7a65 0a0a 2020 2020  voxel_size..    
-00007220: 6465 6620 6765 745f 6f72 6967 696e 2873  def get_origin(s
-00007230: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00007240: 224c 6f61 6420 7365 6c66 2061 6e64 2067  "Load self and g
-00007250: 6574 206f 7269 6769 6e2e 2222 220a 0a20  et origin.""".. 
-00007260: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
-00007270: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-00007280: 6e20 7365 6c66 2e6f 7269 6769 6e0a 0a20  n self.origin.. 
-00007290: 2020 2064 6566 2067 6574 5f6e 616d 6528     def get_name(
-000072a0: 7365 6c66 2c20 6f72 6967 696e 616c 3d46  self, original=F
-000072b0: 616c 7365 293a 0a20 2020 2020 2020 2022  alse):.        "
-000072c0: 2222 0a20 2020 2020 2020 204c 6f61 6420  "".        Load 
-000072d0: 7365 6c66 2061 6e64 2067 6574 206e 616d  self and get nam
-000072e0: 652e 2049 6620 3c6f 7269 6769 6e61 6c3e  e. If <original>
-000072f0: 2069 7320 5472 7565 2c20 6765 7420 7468   is True, get th
-00007300: 6520 6f72 6967 696e 616c 206e 616d 652e  e original name.
-00007310: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00007320: 2020 2020 2020 7365 6c66 2e6c 6f61 6428        self.load(
-00007330: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00007340: 2028 7365 6c66 2e6f 7269 6769 6e61 6c5f   (self.original_
-00007350: 6e61 6d65 2069 6620 6f72 6967 696e 616c  name if original
-00007360: 2065 6c73 6520 7365 6c66 2e6e 616d 6529   else self.name)
-00007370: 0a0a 2020 2020 6465 6620 6765 745f 6d61  ..    def get_ma
-00007380: 736b 2873 656c 662c 2076 6965 773d 2278  sk(self, view="x
-00007390: 2d79 222c 2066 6c61 7474 656e 3d46 616c  -y", flatten=Fal
-000073a0: 7365 2c20 7374 616e 6461 7264 6973 653d  se, standardise=
-000073b0: 4661 6c73 652c 200a 2020 2020 2020 2020  False, .        
-000073c0: 2020 2020 2020 2020 2066 6f72 6365 5f73           force_s
-000073d0: 7461 6e64 6172 6469 7365 3d46 616c 7365  tandardise=False
-000073e0: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
-000073f0: 7420 6269 6e61 7279 206d 6173 6b2c 206f  t binary mask, o
-00007400: 7074 696f 6e61 6c6c 7920 666c 6174 7465  ptionally flatte
-00007410: 6e65 6420 696e 2061 2067 6976 656e 206f  ned in a given o
-00007420: 7269 656e 7461 7469 6f6e 2e22 2222 0a0a  rientation."""..
-00007430: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-00007440: 6428 290a 2020 2020 2020 2020 7365 6c66  d().        self
-00007450: 2e63 7265 6174 655f 6d61 736b 2829 0a20  .create_mask(). 
-00007460: 2020 2020 2020 2069 6620 6e6f 7420 666c         if not fl
-00007470: 6174 7465 6e3a 0a20 2020 2020 2020 2020  atten:.         
-00007480: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
-00007490: 6173 6b2e 6765 745f 6461 7461 2873 7461  ask.get_data(sta
-000074a0: 6e64 6172 6469 7365 3d73 7461 6e64 6172  ndardise=standar
-000074b0: 6469 7365 2c20 0a20 2020 2020 2020 2020  dise, .         
-000074c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000074d0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000074e0: 6365 5f73 7461 6e64 6172 6469 7365 3d66  ce_standardise=f
-000074f0: 6f72 6365 5f73 7461 6e64 6172 6469 7365  orce_standardise
-00007500: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00007510: 206e 702e 7375 6d28 0a20 2020 2020 2020   np.sum(.       
-00007520: 2020 2020 2073 656c 662e 6d61 736b 2e67       self.mask.g
-00007530: 6574 5f64 6174 6128 7374 616e 6461 7264  et_data(standard
-00007540: 6973 653d 7374 616e 6461 7264 6973 652c  ise=standardise,
-00007550: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00007560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007570: 2066 6f72 6365 5f73 7461 6e64 6172 6469   force_standardi
-00007580: 7365 3d66 6f72 6365 5f73 7461 6e64 6172  se=force_standar
-00007590: 6469 7365 292c 0a20 2020 2020 2020 2020  dise),.         
-000075a0: 2020 2061 7869 733d 736b 7274 2e69 6d61     axis=skrt.ima
-000075b0: 6765 2e5f 736c 6963 655f 6178 6573 5b76  ge._slice_axes[v
-000075c0: 6965 775d 0a20 2020 2020 2020 2029 2e61  iew].        ).a
-000075d0: 7374 7970 6528 626f 6f6c 290a 0a20 2020  stype(bool)..   
-000075e0: 2064 6566 2067 6574 5f6d 6173 6b5f 696d   def get_mask_im
-000075f0: 6167 6528 7365 6c66 293a 0a20 2020 2020  age(self):.     
-00007600: 2020 2022 2222 4765 7420 696d 6167 6520     """Get image 
-00007610: 6f62 6a65 6374 2072 6570 7265 7365 6e74  object represent
-00007620: 696e 6720 524f 4920 6d61 736b 2e22 2222  ing ROI mask."""
-00007630: 0a0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
-00007640: 6f61 6428 290a 2020 2020 2020 2020 7365  oad().        se
-00007650: 6c66 2e63 7265 6174 655f 6d61 736b 2829  lf.create_mask()
-00007660: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00007670: 7365 6c66 2e6d 6173 6b0a 0a20 2020 2064  self.mask..    d
-00007680: 6566 2067 6574 5f70 6f6c 7967 6f6e 7328  ef get_polygons(
-00007690: 7365 6c66 2c20 7669 6577 3d22 782d 7922  self, view="x-y"
-000076a0: 2c20 6964 785f 6173 5f6b 6579 3d46 616c  , idx_as_key=Fal
-000076b0: 7365 293a 0a20 2020 2020 2020 2022 2222  se):.        """
-000076c0: 4765 7420 6469 6374 206f 6620 706f 6c79  Get dict of poly
-000076d0: 676f 6e73 2066 6f72 2065 6163 6820 736c  gons for each sl
-000076e0: 6963 652e 2222 220a 0a20 2020 2020 2020  ice."""..       
-000076f0: 2070 6f6c 7967 6f6e 7320 3d20 7b7d 0a20   polygons = {}. 
-00007700: 2020 2020 2020 2066 6f72 2069 2c20 636f         for i, co
-00007710: 6e74 6f75 7273 2069 6e20 7365 6c66 2e67  ntours in self.g
-00007720: 6574 5f63 6f6e 746f 7572 7328 7669 6577  et_contours(view
-00007730: 2c20 6964 785f 6173 5f6b 6579 292e 6974  , idx_as_key).it
-00007740: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-00007750: 2020 2070 6f6c 7967 6f6e 735b 695d 203d     polygons[i] =
-00007760: 205b 636f 6e74 6f75 725f 746f 5f70 6f6c   [contour_to_pol
-00007770: 7967 6f6e 2863 2920 666f 7220 6320 696e  ygon(c) for c in
-00007780: 2063 6f6e 746f 7572 735d 0a20 2020 2020   contours].     
-00007790: 2020 2072 6574 7572 6e20 706f 6c79 676f     return polygo
-000077a0: 6e73 0a0a 2020 2020 6465 6620 6765 745f  ns..    def get_
-000077b0: 706f 6c79 676f 6e73 5f6f 6e5f 736c 6963  polygons_on_slic
-000077c0: 6528 7365 6c66 2c20 7669 6577 3d22 782d  e(self, view="x-
-000077d0: 7922 2c20 736c 3d4e 6f6e 652c 2069 6478  y", sl=None, idx
-000077e0: 3d4e 6f6e 652c 2070 6f73 3d4e 6f6e 6529  =None, pos=None)
-000077f0: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
-00007800: 2073 6861 7065 6c79 2070 6f6c 7967 6f6e   shapely polygon
-00007810: 206f 626a 6563 7473 2063 6f72 7265 7370   objects corresp
-00007820: 6f6e 6469 6e67 2074 6f20 6120 6769 7665  onding to a give
-00007830: 6e20 736c 6963 652e 2222 220a 0a20 2020  n slice."""..   
-00007840: 2020 2020 2063 6f6e 746f 7572 7320 3d20       contours = 
-00007850: 7365 6c66 2e67 6574 5f63 6f6e 746f 7572  self.get_contour
-00007860: 735f 6f6e 5f73 6c69 6365 2876 6965 772c  s_on_slice(view,
-00007870: 2073 6c2c 2069 6478 2c20 706f 7329 0a20   sl, idx, pos). 
-00007880: 2020 2020 2020 2072 6574 7572 6e20 5b63         return [c
-00007890: 6f6e 746f 7572 5f74 6f5f 706f 6c79 676f  ontour_to_polygo
-000078a0: 6e28 6329 2066 6f72 2063 2069 6e20 636f  n(c) for c in co
-000078b0: 6e74 6f75 7273 5d0a 0a20 2020 2064 6566  ntours]..    def
-000078c0: 2063 7265 6174 655f 636f 6e74 6f75 7273   create_contours
-000078d0: 2873 656c 662c 2076 6965 773d 2261 6c6c  (self, view="all
-000078e0: 222c 2066 6f72 6365 3d46 616c 7365 293a  ", force=False):
-000078f0: 0a20 2020 2020 2020 2022 2222 4372 6561  .        """Crea
-00007900: 7465 2063 6f6e 746f 7572 7320 696e 2061  te contours in a
-00007910: 6c6c 206f 7269 656e 7461 7469 6f6e 732e  ll orientations.
-00007920: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
-00007930: 6e6f 7420 666f 7263 653a 0a20 2020 2020  not force:.     
-00007940: 2020 2020 2020 2069 6620 7669 6577 203d         if view =
-00007950: 3d20 2261 6c6c 2220 616e 6420 616c 6c28  = "all" and all(
-00007960: 5b76 2069 6e20 7365 6c66 2e63 6f6e 746f  [v in self.conto
-00007970: 7572 7320 666f 7220 7620 696e 200a 2020  urs for v in .  
-00007980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079a0: 2020 2020 736b 7274 2e69 6d61 6765 2e5f      skrt.image._
-000079b0: 706c 6f74 5f61 7865 735d 293a 0a20 2020  plot_axes]):.   
-000079c0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000079d0: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
-000079e0: 6966 2076 6965 7720 696e 2073 656c 662e  if view in self.
-000079f0: 636f 6e74 6f75 7273 3a0a 2020 2020 2020  contours:.      
-00007a00: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00007a10: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00007a20: 2073 656c 662e 6c6f 6164 6564 3a0a 2020   self.loaded:.  
-00007a30: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00007a40: 6f61 6428 290a 0a20 2020 2020 2020 2073  oad()..        s
-00007a50: 656c 662e 6372 6561 7465 5f6d 6173 6b28  elf.create_mask(
-00007a60: 290a 2020 2020 2020 2020 6966 2066 6f72  ).        if for
-00007a70: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-00007a80: 7365 6c66 2e63 6f6e 746f 7572 7320 3d20  self.contours = 
-00007a90: 7b7d 0a0a 2020 2020 2020 2020 2320 4372  {}..        # Cr
-00007aa0: 6561 7465 2063 6f6e 746f 7572 7320 696e  eate contours in
-00007ab0: 2065 7665 7279 206f 7269 656e 7461 7469   every orientati
-00007ac0: 6f6e 0a20 2020 2020 2020 2076 6965 7773  on.        views
-00007ad0: 203d 206c 6973 7428 736b 7274 2e69 6d61   = list(skrt.ima
-00007ae0: 6765 2e5f 706c 6f74 5f61 7865 732e 6b65  ge._plot_axes.ke
-00007af0: 7973 2829 2920 6966 2076 6965 7720 3d3d  ys()) if view ==
-00007b00: 2022 616c 6c22 2065 6c73 6520 5b76 6965   "all" else [vie
-00007b10: 775d 0a20 2020 2020 2020 2066 6f72 2076  w].        for v
-00007b20: 2069 6e20 7669 6577 733a 0a0a 2020 2020   in views:..    
-00007b30: 2020 2020 2020 2020 6966 2076 2069 6e20          if v in 
-00007b40: 7365 6c66 2e63 6f6e 746f 7572 733a 0a20  self.contours:. 
-00007b50: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00007b60: 6f6e 7469 6e75 650a 0a20 2020 2020 2020  ontinue..       
-00007b70: 2020 2020 2023 204d 616b 6520 6e65 7720       # Make new 
-00007b80: 636f 6e74 6f75 7273 2066 726f 6d20 6d61  contours from ma
-00007b90: 736b 0a20 2020 2020 2020 2020 2020 207a  sk.            z
-00007ba0: 5f61 7820 3d20 736b 7274 2e69 6d61 6765  _ax = skrt.image
-00007bb0: 2e5f 736c 6963 655f 6178 6573 5b76 5d0a  ._slice_axes[v].
-00007bc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007bd0: 2e63 6f6e 746f 7572 735b 765d 203d 207b  .contours[v] = {
-00007be0: 7d0a 2020 2020 2020 2020 2020 2020 666f  }.            fo
-00007bf0: 7220 697a 2069 6e20 7365 6c66 2e67 6574  r iz in self.get
-00007c00: 5f69 6e64 6963 6573 2876 2c20 6d65 7468  _indices(v, meth
-00007c10: 6f64 3d22 6d61 736b 2229 3a0a 0a20 2020  od="mask"):..   
-00007c20: 2020 2020 2020 2020 2020 2020 2023 2047               # G
-00007c30: 6574 2073 6c69 6365 206f 6620 6d61 736b  et slice of mask
-00007c40: 2061 7272 6179 0a20 2020 2020 2020 2020   array.         
-00007c50: 2020 2020 2020 206d 6173 6b5f 736c 6963         mask_slic
-00007c60: 6520 3d20 7365 6c66 2e67 6574 5f73 6c69  e = self.get_sli
-00007c70: 6365 2876 2c20 6964 783d 697a 292e 540a  ce(v, idx=iz).T.
-00007c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c90: 6966 206d 6173 6b5f 736c 6963 652e 6d61  if mask_slice.ma
-00007ca0: 7828 2920 3c20 302e 353a 0a20 2020 2020  x() < 0.5:.     
-00007cb0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00007cc0: 6f6e 7469 6e75 650a 0a20 2020 2020 2020  ontinue..       
-00007cd0: 2020 2020 2020 2020 2070 6f69 6e74 7320           points 
-00007ce0: 3d20 7365 6c66 2e6d 6173 6b5f 746f 5f63  = self.mask_to_c
-00007cf0: 6f6e 746f 7572 7328 6d61 736b 5f73 6c69  ontours(mask_sli
-00007d00: 6365 2c20 7629 0a20 2020 2020 2020 2020  ce, v).         
-00007d10: 2020 2020 2020 2069 6620 706f 696e 7473         if points
-00007d20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007d30: 2020 2020 2020 7365 6c66 2e63 6f6e 746f        self.conto
-00007d40: 7572 735b 765d 5b73 656c 662e 6964 785f  urs[v][self.idx_
-00007d50: 746f 5f70 6f73 2869 7a2c 207a 5f61 7829  to_pos(iz, z_ax)
-00007d60: 5d20 3d20 706f 696e 7473 0a0a 2020 2020  ] = points..    
-00007d70: 6465 6620 6d61 736b 5f74 6f5f 636f 6e74  def mask_to_cont
-00007d80: 6f75 7273 2873 656c 662c 206d 6173 6b2c  ours(self, mask,
-00007d90: 2076 6965 772c 2069 6e76 6572 743d 4661   view, invert=Fa
-00007da0: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
-00007db0: 2243 7265 6174 6520 636f 6e74 6f75 7273  "Create contours
-00007dc0: 2066 726f 6d20 6120 6d61 736b 2e22 2222   from a mask."""
-00007dd0: 0a0a 2020 2020 2020 2020 636f 6e74 6f75  ..        contou
-00007de0: 7273 203d 2073 6b69 6d61 6765 2e6d 6561  rs = skimage.mea
-00007df0: 7375 7265 2e66 696e 645f 636f 6e74 6f75  sure.find_contou
-00007e00: 7273 286d 6173 6b2c 2030 2e35 2c20 226c  rs(mask, 0.5, "l
-00007e10: 6f77 222c 2022 6c6f 7722 290a 0a20 2020  ow", "low")..   
-00007e20: 2020 2020 2023 2043 6f6e 7665 7274 2069       # Convert i
-00007e30: 6e64 6963 6573 2074 6f20 706f 7369 7469  ndices to positi
-00007e40: 6f6e 7320 696e 206d 6d0a 2020 2020 2020  ons in mm.      
-00007e50: 2020 785f 6178 2c20 795f 6178 203d 2073    x_ax, y_ax = s
-00007e60: 6b72 742e 696d 6167 652e 5f70 6c6f 745f  krt.image._plot_
-00007e70: 6178 6573 5b76 6965 775d 0a20 2020 2020  axes[view].     
-00007e80: 2020 2070 6f69 6e74 7320 3d20 5b5d 0a20     points = []. 
-00007e90: 2020 2020 2020 2066 6f72 2063 6f6e 746f         for conto
-00007ea0: 7572 2069 6e20 636f 6e74 6f75 7273 3a0a  ur in contours:.
-00007eb0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00007ec0: 6f75 725f 706f 696e 7473 203d 205b 5d0a  our_points = [].
-00007ed0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00007ee0: 6978 2c20 6979 2069 6e20 636f 6e74 6f75  ix, iy in contou
-00007ef0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00007f00: 2020 2070 7820 3d20 7365 6c66 2e69 6478     px = self.idx
-00007f10: 5f74 6f5f 706f 7328 6978 2c20 785f 6178  _to_pos(ix, x_ax
-00007f20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00007f30: 2020 7079 203d 2073 656c 662e 6964 785f    py = self.idx_
-00007f40: 746f 5f70 6f73 2869 792c 2079 5f61 7829  to_pos(iy, y_ax)
-00007f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007f60: 2069 6620 696e 7665 7274 3a0a 2020 2020   if invert:.    
-00007f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f80: 7078 2c20 7079 203d 2070 792c 2070 780a  px, py = py, px.
-00007f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007fa0: 636f 6e74 6f75 725f 706f 696e 7473 2e61  contour_points.a
-00007fb0: 7070 656e 6428 5b70 782c 2070 795d 290a  ppend([px, py]).
-00007fc0: 2020 2020 2020 2020 2020 2020 706f 696e              poin
-00007fd0: 7473 2e61 7070 656e 6428 6e70 2e61 7272  ts.append(np.arr
-00007fe0: 6179 2863 6f6e 746f 7572 5f70 6f69 6e74  ay(contour_point
-00007ff0: 7329 290a 0a20 2020 2020 2020 2072 6574  s))..        ret
-00008000: 7572 6e20 706f 696e 7473 0a0a 2020 2020  urn points..    
-00008010: 6465 6620 6372 6561 7465 5f6d 6173 6b28  def create_mask(
-00008020: 0a20 2020 2020 2020 2073 656c 662c 200a  .        self, .
-00008030: 2020 2020 2020 2020 666f 7263 653d 4661          force=Fa
-00008040: 6c73 652c 200a 2020 2020 2020 2020 6f76  lse, .        ov
-00008050: 6572 6c61 705f 6c65 7665 6c3d 4e6f 6e65  erlap_level=None
-00008060: 2c20 0a20 2020 2020 2020 2076 6f78 656c  , .        voxel
-00008070: 5f73 697a 653d 4e6f 6e65 2c20 0a20 2020  _size=None, .   
-00008080: 2020 2020 2073 6861 7065 3d4e 6f6e 650a       shape=None.
-00008090: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-000080a0: 2222 4372 6561 7465 2062 696e 6172 7920  ""Create binary 
-000080b0: 6d61 736b 2072 6570 7265 7365 6e74 6174  mask representat
-000080c0: 696f 6e20 6f66 2074 6869 7320 524f 492e  ion of this ROI.
-000080d0: 2049 6620 7468 6520 524f 4920 7761 7320   If the ROI was 
-000080e0: 6372 6561 7465 640a 2020 2020 2020 2020  created.        
-000080f0: 6672 6f6d 2063 6f6e 746f 7572 732c 2074  from contours, t
-00008100: 6865 7365 2063 6f6e 746f 7572 7320 7769  hese contours wi
-00008110: 6c6c 2062 6520 636f 6e76 6572 7465 6420  ll be converted 
-00008120: 746f 2061 206d 6173 6b3b 2069 6620 7468  to a mask; if th
-00008130: 6520 524f 490a 2020 2020 2020 2020 7761  e ROI.        wa
-00008140: 7320 6372 6561 7465 6420 6672 6f6d 2061  s created from a
-00008150: 206d 6173 6b2c 2074 6869 7320 6d61 736b   mask, this mask
-00008160: 2077 696c 6c20 6265 2063 6173 7420 746f   will be cast to
-00008170: 2061 2062 6f6f 6c65 616e 2061 7272 6179   a boolean array
-00008180: 2061 6e64 0a20 2020 2020 2020 2069 7473   and.        its
-00008190: 2067 656f 656d 7472 6963 2070 726f 7065   geoemtric prope
-000081a0: 7274 6965 7320 7769 6c6c 2062 6520 6173  rties will be as
-000081b0: 7369 676e 6564 2074 6f20 7468 6973 2052  signed to this R
-000081c0: 4f49 2e20 4966 2061 206d 6173 6b20 6861  OI. If a mask ha
-000081d0: 7320 0a20 2020 2020 2020 2061 6c72 6561  s .        alrea
-000081e0: 6479 2062 6565 6e20 6372 6561 7465 642c  dy been created,
-000081f0: 206e 6f74 6869 6e67 2077 696c 6c20 6861   nothing will ha
-00008200: 7070 656e 2075 6e6c 6573 7320 666f 7263  ppen unless forc
-00008210: 653d 5472 7565 2e0a 0a20 2020 2020 2020  e=True...       
-00008220: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-00008230: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00008240: 2020 666f 7263 6520 3a20 626f 6f6c 2c20    force : bool, 
-00008250: 6465 6661 756c 743d 4661 6c73 650a 2020  default=False.  
-00008260: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-00008270: 652c 2074 6865 206d 6173 6b20 7769 6c6c  e, the mask will
-00008280: 2062 6520 7265 6372 6561 7465 6420 6576   be recreated ev
-00008290: 656e 2069 6620 6974 2061 6c72 6561 6479  en if it already
-000082a0: 2065 7869 7374 732e 0a0a 2020 2020 2020   exists...      
-000082b0: 2020 6f76 6572 6c61 705f 6c65 7665 6c20    overlap_level 
-000082c0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
-000082d0: 3d30 2e32 350a 2020 2020 2020 2020 2020  =0.25.          
-000082e0: 2020 5265 7175 6972 6564 206f 7665 726c    Required overl
-000082f0: 6170 206f 6620 6120 7069 7865 6c20 7769  ap of a pixel wi
-00008300: 7468 2074 6865 2052 4f49 2063 6f6e 746f  th the ROI conto
-00008310: 7572 2069 6e20 6f72 6465 7220 666f 7220  ur in order for 
-00008320: 7468 6520 0a20 2020 2020 2020 2020 2020  the .           
-00008330: 2070 6978 656c 2074 6f20 6265 2061 6464   pixel to be add
-00008340: 6564 2074 6f20 7468 6520 6d61 736b 2e20  ed to the mask. 
-00008350: 4966 204e 6f6e 652c 2074 6865 2076 616c  If None, the val
-00008360: 7565 206f 660a 2020 2020 2020 2020 2020  ue of.          
-00008370: 2020 7365 6c66 2e6f 7665 726c 6170 5f6c    self.overlap_l
-00008380: 6576 656c 2077 696c 6c20 6265 2075 7365  evel will be use
-00008390: 643b 206f 7468 6572 7769 7365 2c0a 2020  d; otherwise,.  
-000083a0: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
-000083b0: 7665 726c 6170 5f6c 6576 656c 2077 696c  verlap_level wil
-000083c0: 6c20 6265 206f 7665 7277 7269 7474 656e  l be overwritten
-000083d0: 2077 6974 6820 7468 6973 2076 616c 7565   with this value
-000083e0: 2e20 4966 2062 6f74 6820 6172 6520 0a20  . If both are . 
-000083f0: 2020 2020 2020 2020 2020 204e 6f6e 652c             None,
-00008400: 2074 6865 206f 7574 7075 7420 6f66 2073   the output of s
-00008410: 6b69 6d61 6765 2e64 7261 772e 706f 6c79  kimage.draw.poly
-00008420: 676f 6e32 6d61 736b 2077 696c 6c20 6265  gon2mask will be
-00008430: 2072 6574 7572 6e65 6420 0a20 2020 2020   returned .     
-00008440: 2020 2020 2020 2077 6974 6820 6e6f 2062         with no b
-00008450: 6f72 6465 7220 6368 6563 6b73 2c20 7768  order checks, wh
-00008460: 6963 6820 6973 2066 6173 7465 7220 7468  ich is faster th
-00008470: 616e 2070 6572 666f 726d 696e 6720 626f  an performing bo
-00008480: 7264 6572 2063 6865 636b 732e 0a0a 2020  rder checks...  
-00008490: 2020 2020 2020 766f 7865 6c5f 7369 7a65        voxel_size
-000084a0: 203a 206c 6973 742c 2064 6566 6175 6c74   : list, default
-000084b0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-000084c0: 2020 566f 7865 6c20 7369 7a65 7320 6f66    Voxel sizes of
-000084d0: 2074 6865 2064 6573 6972 6564 206d 6173   the desired mas
-000084e0: 6b20 696e 2074 6865 205b 782c 2079 5d20  k in the [x, y] 
-000084f0: 6469 7265 6374 696f 6e2e 204f 6e6c 7920  direction. Only 
-00008500: 7573 6564 2069 6620 0a20 2020 2020 2020  used if .       
-00008510: 2020 2020 2074 6865 2052 4f49 2077 6173       the ROI was
-00008520: 2063 7265 6174 6564 2066 726f 6d20 636f   created from co
-00008530: 6e74 6f75 7273 3b20 6967 6e6f 7265 6420  ntours; ignored 
-00008540: 6966 2052 4f49 2077 6173 2063 7265 6174  if ROI was creat
-00008550: 6564 2066 726f 6d20 0a20 2020 2020 2020  ed from .       
-00008560: 2020 2020 206d 6173 6b2e 2043 6175 7365       mask. Cause
-00008570: 7320 7365 6c66 2e69 6d61 6765 2074 6f20  s self.image to 
-00008580: 6265 2072 6570 6c61 6365 6420 7769 7468  be replaced with
-00008590: 2061 200a 2020 2020 2020 2020 2020 2020   a .            
-000085a0: 626c 616e 6b20 6475 6d6d 7920 696d 6167  blank dummy imag
-000085b0: 6520 7769 7468 2074 6865 7365 2076 6f78  e with these vox
-000085c0: 656c 2073 697a 6573 2e0a 0a20 2020 2020  el sizes...     
-000085d0: 2020 2073 6861 7065 203a 206c 6973 742c     shape : list,
-000085e0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-000085f0: 2020 2020 2020 2020 2020 5368 6170 6520            Shape 
-00008600: 6f66 2074 6865 2064 6573 6972 6564 206d  of the desired m
-00008610: 6173 6b20 696e 2074 6865 205b 782c 2079  ask in the [x, y
-00008620: 5d20 6469 7265 6374 696f 6e2e 204f 6e6c  ] direction. Onl
-00008630: 7920 7573 6564 2069 6620 0a20 2020 2020  y used if .     
-00008640: 2020 2020 2020 203c 766f 7865 6c5f 7369         <voxel_si
-00008650: 7a65 3e20 6973 204e 6f6e 6520 616e 6420  ze> is None and 
-00008660: 7468 6520 524f 4920 7761 7320 6372 6561  the ROI was crea
-00008670: 7465 6420 6672 6f6d 2063 6f6e 746f 7572  ted from contour
-00008680: 733b 200a 2020 2020 2020 2020 2020 2020  s; .            
-00008690: 6967 6e6f 7265 6420 6966 2052 4f49 2077  ignored if ROI w
-000086a0: 6173 2063 7265 6174 6564 2066 726f 6d20  as created from 
-000086b0: 6d61 736b 2e20 4361 7573 6573 2073 656c  mask. Causes sel
-000086c0: 662e 696d 6167 6520 746f 2062 6520 0a20  f.image to be . 
-000086d0: 2020 2020 2020 2020 2020 2072 6570 6c61             repla
-000086e0: 6365 6420 7769 7468 2061 2062 6c61 6e6b  ced with a blank
-000086f0: 2064 756d 6d79 2069 6d61 6765 206f 6620   dummy image of 
-00008700: 7468 6973 2073 6861 7065 2e0a 2020 2020  this shape..    
-00008710: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00008720: 2069 6620 7365 6c66 2e6c 6f61 6465 645f   if self.loaded_
-00008730: 6d61 736b 2061 6e64 206e 6f74 2066 6f72  mask and not for
-00008740: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-00008750: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
-00008760: 6966 206e 6f74 2073 656c 662e 6c6f 6164  if not self.load
-00008770: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
-00008780: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
-00008790: 2020 2020 6966 206f 7665 726c 6170 5f6c      if overlap_l
-000087a0: 6576 656c 2069 7320 6e6f 7420 4e6f 6e65  evel is not None
-000087b0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-000087c0: 6c66 2e6f 7665 726c 6170 5f6c 6576 656c  lf.overlap_level
-000087d0: 203d 206f 7665 726c 6170 5f6c 6576 656c   = overlap_level
-000087e0: 0a0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
-000087f0: 696d 6167 6520 746f 2064 756d 6d79 2069  image to dummy i
-00008800: 6d61 6765 2069 6620 6e65 6564 6564 0a20  mage if needed. 
-00008810: 2020 2020 2020 2069 6620 2866 6f72 6365         if (force
-00008820: 2061 6e64 2028 7368 6170 6520 6973 206e   and (shape is n
-00008830: 6f74 204e 6f6e 6520 6f72 2076 6f78 656c  ot None or voxel
-00008840: 5f73 697a 6520 6973 206e 6f74 204e 6f6e  _size is not Non
-00008850: 6529 2920 5c0a 2020 2020 2020 2020 2020  e)) \.          
-00008860: 206f 7220 2873 656c 662e 636f 6e74 6f75   or (self.contou
-00008870: 7273 5f6f 6e6c 7920 616e 6420 7365 6c66  rs_only and self
-00008880: 2e69 6d61 6765 2069 7320 4e6f 6e65 293a  .image is None):
-00008890: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000088a0: 662e 7365 745f 696d 6167 655f 746f 5f64  f.set_image_to_d
-000088b0: 756d 6d79 2873 6861 7065 3d73 6861 7065  ummy(shape=shape
-000088c0: 2c20 766f 7865 6c5f 7369 7a65 3d76 6f78  , voxel_size=vox
-000088d0: 656c 5f73 697a 6529 0a0a 2020 2020 2020  el_size)..      
-000088e0: 2020 2320 4372 6561 7465 206d 6173 6b20    # Create mask 
-000088f0: 6672 6f6d 2069 6e70 7574 2078 2d79 2063  from input x-y c
-00008900: 6f6e 746f 7572 7320 0a20 2020 2020 2020  ontours .       
-00008910: 2069 6620 7365 6c66 2e69 6e70 7574 5f63   if self.input_c
-00008920: 6f6e 746f 7572 733a 0a0a 2020 2020 2020  ontours:..      
-00008930: 2020 2020 2020 2320 496e 6974 6961 6c69        # Initiali
-00008940: 7365 2073 656c 662e 6d61 736b 2061 7320  se self.mask as 
-00008950: 696d 6167 650a 2020 2020 2020 2020 2020  image.          
-00008960: 2020 7365 6c66 2e6d 6173 6b20 3d20 736b    self.mask = sk
-00008970: 7274 2e69 6d61 6765 2e49 6d61 6765 280a  rt.image.Image(.
-00008980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008990: 6e70 2e7a 6572 6f73 2828 7365 6c66 2e73  np.zeros((self.s
-000089a0: 6861 7065 5b31 5d2c 2073 656c 662e 7368  hape[1], self.sh
-000089b0: 6170 655b 305d 2c20 7365 6c66 2e73 6861  ape[0], self.sha
-000089c0: 7065 5b32 5d29 2c0a 2020 2020 2020 2020  pe[2]),.        
-000089d0: 2020 2020 2020 2020 2020 2020 6474 7970              dtyp
-000089e0: 653d 626f 6f6c 292c 0a20 2020 2020 2020  e=bool),.       
-000089f0: 2020 2020 2020 2020 2061 6666 696e 653d           affine=
-00008a00: 7365 6c66 2e61 6666 696e 652c 200a 2020  self.affine, .  
-00008a10: 2020 2020 2020 2020 2020 2020 2020 766f                vo
-00008a20: 7865 6c5f 7369 7a65 3d73 656c 662e 766f  xel_size=self.vo
-00008a30: 7865 6c5f 7369 7a65 2c0a 2020 2020 2020  xel_size,.      
-00008a40: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
-00008a50: 3d73 656c 662e 6f72 6967 696e 0a20 2020  =self.origin.   
-00008a60: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00008a70: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
-00008a80: 206d 6173 6b20 6f6e 2065 6163 6820 7a20   mask on each z 
-00008a90: 6c61 7965 720a 2020 2020 2020 2020 2020  layer.          
-00008aa0: 2020 666f 7220 7a2c 2063 6f6e 746f 7572    for z, contour
-00008ab0: 7320 696e 2073 656c 662e 696e 7075 745f  s in self.input_
-00008ac0: 636f 6e74 6f75 7273 2e69 7465 6d73 2829  contours.items()
-00008ad0: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
-00008ae0: 2020 2023 204c 6f6f 7020 6f76 6572 2065     # Loop over e
-00008af0: 6163 6820 636f 6e74 6f75 7220 6f6e 2074  ach contour on t
-00008b00: 6865 207a 2073 6c69 6365 0a20 2020 2020  he z slice.     
-00008b10: 2020 2020 2020 2020 2020 2069 7a20 3d20             iz = 
-00008b20: 696e 7428 7365 6c66 2e70 6f73 5f74 6f5f  int(self.pos_to_
-00008b30: 6964 7828 7a2c 2022 7a22 2929 0a20 2020  idx(z, "z")).   
-00008b40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00008b50: 697a 203e 3d20 7365 6c66 2e6d 6173 6b2e  iz >= self.mask.
-00008b60: 6461 7461 2e73 6861 7065 5b32 5d3a 2020  data.shape[2]:  
-00008b70: 2320 4967 6e6f 7265 2073 6c69 6365 7320  # Ignore slices 
-00008b80: 6f75 7473 6964 6520 6d61 736b 2072 616e  outside mask ran
-00008b90: 6765 0a20 2020 2020 2020 2020 2020 2020  ge.             
-00008ba0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-00008bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008bc0: 2070 6f73 5f74 6f5f 6964 785f 7665 6320   pos_to_idx_vec 
-00008bd0: 3d20 6e70 2e76 6563 746f 7269 7a65 2873  = np.vectorize(s
-00008be0: 656c 662e 706f 735f 746f 5f69 6478 290a  elf.pos_to_idx).
-00008bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c00: 666f 7220 706f 696e 7473 2069 6e20 636f  for points in co
-00008c10: 6e74 6f75 7273 3a0a 0a20 2020 2020 2020  ntours:..       
-00008c20: 2020 2020 2020 2020 2020 2020 2023 2052               # R
-00008c30: 6571 7569 7265 2061 7420 6c65 6173 7420  equire at least 
-00008c40: 3320 706f 696e 7473 2074 6f20 6465 6669  3 points to defi
-00008c50: 6e65 2061 2070 6f6c 7967 6f6e 2e0a 2020  ne a polygon..  
-00008c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c70: 2020 6966 206c 656e 2870 6f69 6e74 7329    if len(points)
-00008c80: 203c 2033 3a0a 2020 2020 2020 2020 2020   < 3:.          
-00008c90: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00008ca0: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
-00008cb0: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
-00008cc0: 6e76 6572 7420 2878 2c20 7929 2070 6f73  nvert (x, y) pos
-00008cd0: 6974 696f 6e73 2074 6f20 6172 7261 7920  itions to array 
-00008ce0: 696e 6469 6365 730a 2020 2020 2020 2020  indices.        
-00008cf0: 2020 2020 2020 2020 2020 2020 706f 696e              poin
-00008d00: 7473 5f69 6478 203d 206e 702e 7a65 726f  ts_idx = np.zero
-00008d10: 7328 2870 6f69 6e74 732e 7368 6170 655b  s((points.shape[
-00008d20: 305d 2c20 3229 290a 2020 2020 2020 2020  0], 2)).        
-00008d30: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00008d40: 6920 696e 2072 616e 6765 2832 293a 0a20  i in range(2):. 
-00008d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d60: 2020 2020 2020 2070 6f69 6e74 735f 6964         points_id
-00008d70: 785b 3a2c 2069 5d20 3d20 706f 735f 746f  x[:, i] = pos_to
-00008d80: 5f69 6478 5f76 6563 280a 2020 2020 2020  _idx_vec(.      
-00008d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008da0: 2020 2020 2020 706f 696e 7473 5b3a 2c20        points[:, 
-00008db0: 695d 2c20 692c 2072 6574 7572 6e5f 696e  i], i, return_in
-00008dc0: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
-00008dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008de0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00008df0: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
-00008e00: 706f 6c79 676f 6e20 696e 2069 6e64 6578  polygon in index
-00008e10: 2073 7061 6365 0a20 2020 2020 2020 2020   space.         
-00008e20: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-00008e30: 6f6e 203d 2063 6f6e 746f 7572 5f74 6f5f  on = contour_to_
-00008e40: 706f 6c79 676f 6e28 706f 696e 7473 5f69  polygon(points_i
-00008e50: 6478 290a 0a20 2020 2020 2020 2020 2020  dx)..           
-00008e60: 2020 2020 2020 2020 2023 2047 6574 206d           # Get m
-00008e70: 6173 6b20 6f66 2061 6c6c 2070 6978 656c  ask of all pixel
-00008e80: 7320 696e 7369 6465 2063 6f6e 746f 7572  s inside contour
-00008e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008ea0: 2020 2020 206d 6173 6b20 3d20 6472 6177       mask = draw
-00008eb0: 2e70 6f6c 7967 6f6e 326d 6173 6b28 5b73  .polygon2mask([s
-00008ec0: 656c 662e 6d61 736b 2e64 6174 612e 7368  elf.mask.data.sh
-00008ed0: 6170 655b 315d 2c20 0a20 2020 2020 2020  ape[1], .       
-00008ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f00: 2020 2020 2020 7365 6c66 2e6d 6173 6b2e        self.mask.
-00008f10: 6461 7461 2e73 6861 7065 5b30 5d5d 2c0a  data.shape[0]],.
-00008f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043d0: 7920 3d20 6e6f 7420 6e70 2e61 6e79 2873  y = not np.any(s
+000043e0: 656c 662e 6d61 736b 2e67 6574 5f64 6174  elf.mask.get_dat
+000043f0: 6128 2929 0a20 2020 2020 2020 2065 6c73  a()).        els
+00004400: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00004410: 656c 662e 656d 7074 7920 3d20 5472 7565  elf.empty = True
+00004420: 0a0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+00004430: 6f61 6465 6420 3d20 5472 7565 0a0a 2020  oaded = True..  
+00004440: 2020 6465 6620 5f6c 6f61 645f 6672 6f6d    def _load_from
+00004450: 5f66 696c 6528 7365 6c66 2c20 6669 6c65  _file(self, file
+00004460: 6e61 6d65 293a 0a20 2020 2020 2020 2022  name):.        "
+00004470: 2222 4174 7465 6d70 7420 746f 206c 6f61  ""Attempt to loa
+00004480: 6420 524f 4920 6672 6f6d 2061 2064 6963  d ROI from a dic
+00004490: 6f6d 206f 7220 6e69 6674 6920 6669 6c65  om or nifti file
+000044a0: 2e22 2222 0a0a 2020 2020 6465 6620 6c6f  ."""..    def lo
+000044b0: 6164 5f74 7261 6e73 666f 726d 6978 5f70  ad_transformix_p
+000044c0: 6f69 6e74 7328 7365 6c66 293a 0a20 2020  oints(self):.   
+000044d0: 2020 2020 2027 2727 0a20 2020 2020 2020       '''.       
+000044e0: 204c 6f61 6420 706f 696e 7420 636f 6f72   Load point coor
+000044f0: 6469 6e61 7465 7320 6672 6f6d 2066 696c  dinates from fil
+00004500: 6520 6f66 2074 6865 2066 6f72 6d61 7420  e of the format 
+00004510: 7072 6f64 7563 6564 2062 7920 5472 616e  produced by Tran
+00004520: 7366 6f72 6d69 782e 0a20 2020 2020 2020  sformix..       
+00004530: 2027 2727 0a20 2020 2020 2020 2064 6566   '''.        def
+00004540: 2067 6574 5f63 6f6f 7264 696e 6174 6573   get_coordinates
+00004550: 2869 6e5f 6461 7461 3d27 2729 3a0a 2020  (in_data=''):.  
+00004560: 2020 2020 2020 2020 2020 2727 270a 2020            '''.  
+00004570: 2020 2020 2020 2020 2020 4865 6c70 6572            Helper
+00004580: 2066 756e 6374 696f 6e2c 2074 6f20 756e   function, to un
+00004590: 7061 636b 2073 7472 696e 6720 6f66 2064  pack string of d
+000045a0: 6174 6120 696e 746f 206c 6973 7420 6f66  ata into list of
+000045b0: 2063 6f6f 7264 696e 6174 6573 2e20 0a20   coordinates. . 
+000045c0: 2020 2020 2020 2020 2020 2027 2727 0a20             '''. 
+000045d0: 2020 2020 2020 2020 2020 2063 6f6f 7264             coord
+000045e0: 696e 6174 6573 203d 205b 6576 616c 2873  inates = [eval(s
+000045f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004600: 2020 2020 2020 666f 7220 7320 696e 2072        for s in r
+00004610: 652e 6669 6e64 616c 6c28 7227 5b2d 5c64  e.findall(r'[-\d
+00004620: 5c2e 5d2b 272c 2069 6e5f 6461 7461 295d  \.]+', in_data)]
+00004630: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00004640: 7572 6e20 636f 6f72 6469 6e61 7465 730a  urn coordinates.
+00004650: 0a20 2020 2020 2020 2023 2052 6561 6420  .        # Read 
+00004660: 6669 6c65 2e0a 2020 2020 2020 2020 7769  file..        wi
+00004670: 7468 206f 7065 6e28 7365 6c66 2e73 6f75  th open(self.sou
+00004680: 7263 652c 2027 7227 2c20 656e 636f 6469  rce, 'r', encodi
+00004690: 6e67 3d27 6173 6369 6927 2920 6173 2069  ng='ascii') as i
+000046a0: 6e5f 6669 6c65 3a0a 2020 2020 2020 2020  n_file:.        
+000046b0: 2020 2020 6461 7461 5f72 6f77 7320 3d20      data_rows = 
+000046c0: 696e 5f66 696c 652e 7265 6164 6c69 6e65  in_file.readline
+000046d0: 7328 290a 0a20 2020 2020 2020 2023 2045  s()..        # E
+000046e0: 7874 7261 6374 2070 6f69 6e74 2064 6174  xtract point dat
+000046f0: 6120 746f 2064 6963 7469 6f6e 6172 792e  a to dictionary.
+00004700: 0a20 2020 2020 2020 2070 6f69 6e74 7320  .        points 
+00004710: 3d20 7b7d 0a20 2020 2020 2020 2066 6f72  = {}.        for
+00004720: 2072 6f77 2069 6e20 6461 7461 5f72 6f77   row in data_row
+00004730: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
+00004740: 6f69 6e74 2c20 696e 7075 745f 696e 6465  oint, input_inde
+00004750: 782c 2069 6e70 7574 5f70 6f69 6e74 2c20  x, input_point, 
+00004760: 6f75 7470 7574 5f69 6e64 6578 5f66 6978  output_index_fix
+00004770: 6564 2c20 5c0a 2020 2020 2020 2020 2020  ed, \.          
+00004780: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+00004790: 5f70 6f69 6e74 2c20 6465 666f 726d 6174  _point, deformat
+000047a0: 696f 6e20 3d20 726f 772e 7370 6c69 7428  ion = row.split(
+000047b0: 273b 2729 0a0a 2020 2020 2020 2020 2020  ';')..          
+000047c0: 2020 706f 696e 7420 3d20 696e 7428 706f    point = int(po
+000047d0: 696e 742e 7370 6c69 7428 295b 2d31 5d29  int.split()[-1])
+000047e0: 0a20 2020 2020 2020 2020 2020 2070 6f69  .            poi
+000047f0: 6e74 735b 706f 696e 745d 203d 207b 7d0a  nts[point] = {}.
+00004800: 2020 2020 2020 2020 2020 2020 706f 696e              poin
+00004810: 7473 5b70 6f69 6e74 5d5b 2749 6e70 7574  ts[point]['Input
+00004820: 496e 6465 7827 5d20 3d20 6765 745f 636f  Index'] = get_co
+00004830: 6f72 6469 6e61 7465 7328 696e 7075 745f  ordinates(input_
+00004840: 696e 6465 7829 0a20 2020 2020 2020 2020  index).         
+00004850: 2020 2070 6f69 6e74 735b 706f 696e 745d     points[point]
+00004860: 5b27 496e 7075 7450 6f69 6e74 275d 203d  ['InputPoint'] =
+00004870: 2067 6574 5f63 6f6f 7264 696e 6174 6573   get_coordinates
+00004880: 2869 6e70 7574 5f70 6f69 6e74 290a 2020  (input_point).  
+00004890: 2020 2020 2020 2020 2020 706f 696e 7473            points
+000048a0: 5b70 6f69 6e74 5d5b 274f 7574 7075 7449  [point]['OutputI
+000048b0: 6e64 6578 4669 7865 6427 5d20 3d20 6765  ndexFixed'] = ge
+000048c0: 745f 636f 6f72 6469 6e61 7465 7328 0a20  t_coordinates(. 
+000048d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048e0: 2020 206f 7574 7075 745f 696e 6465 785f     output_index_
+000048f0: 6669 7865 6429 0a20 2020 2020 2020 2020  fixed).         
+00004900: 2020 2070 6f69 6e74 735b 706f 696e 745d     points[point]
+00004910: 5b27 4f75 7470 7574 506f 696e 7427 5d20  ['OutputPoint'] 
+00004920: 3d20 6765 745f 636f 6f72 6469 6e61 7465  = get_coordinate
+00004930: 7328 6f75 7470 7574 5f70 6f69 6e74 290a  s(output_point).
+00004940: 2020 2020 2020 2020 2020 2020 706f 696e              poin
+00004950: 7473 5b70 6f69 6e74 5d5b 2744 6566 6f72  ts[point]['Defor
+00004960: 6d61 7469 6f6e 275d 203d 2067 6574 5f63  mation'] = get_c
+00004970: 6f6f 7264 696e 6174 6573 2864 6566 6f72  oordinates(defor
+00004980: 6d61 7469 6f6e 290a 0a20 2020 2020 2020  mation)..       
+00004990: 2020 2020 2023 2049 6620 7468 6520 5472       # If the Tr
+000049a0: 616e 7366 6f72 6d69 7820 696e 7075 7420  ansformix input 
+000049b0: 7761 7320 7772 6974 7465 6e20 7573 696e  was written usin
+000049c0: 6720 524f 492e 7772 6974 6528 292c 0a20  g ROI.write(),. 
+000049d0: 2020 2020 2020 2020 2020 2023 2061 2070             # a p
+000049e0: 6f69 6e74 207a 2d63 6f6f 7264 696e 6174  oint z-coordinat
+000049f0: 6520 7769 6c6c 2068 6176 6520 7369 7820  e will have six 
+00004a00: 6469 6769 7473 2061 6674 6572 2074 6865  digits after the
+00004a10: 2064 6563 696d 616c 0a20 2020 2020 2020   decimal.       
+00004a20: 2020 2020 2023 2070 6f69 6e74 2c20 7769       # point, wi
+00004a30: 7468 2074 6865 2063 6f6e 746f 7572 2069  th the contour i
+00004a40: 6e64 6578 2069 6e20 7468 6520 6c61 7374  ndex in the last
+00004a50: 2074 6872 6565 2e0a 2020 2020 2020 2020   three..        
+00004a60: 2020 2020 2320 2849 6e70 7574 2070 6f69      # (Input poi
+00004a70: 6e74 7320 6172 6520 7772 6974 7465 6e20  nts are written 
+00004a80: 746f 2074 6865 2054 7261 6e73 666f 726d  to the Transform
+00004a90: 6978 206f 7574 7075 740a 2020 2020 2020  ix output.      
+00004aa0: 2020 2020 2020 2320 7769 7468 2073 6978        # with six
+00004ab0: 2064 6967 6974 7320 6166 7465 7220 7468   digits after th
+00004ac0: 6520 6465 6369 6d61 6c20 706f 696e 7420  e decimal point 
+00004ad0: 666f 7220 616c 6c20 636f 6f72 6469 6e61  for all coordina
+00004ae0: 7465 732e 290a 2020 2020 2020 2020 2020  tes.).          
+00004af0: 2020 7a64 5f69 6e20 3d20 7265 2e66 696e    zd_in = re.fin
+00004b00: 6461 6c6c 2872 275b 2d5c 645c 2e5d 2b27  dall(r'[-\d\.]+'
+00004b10: 2c20 696e 7075 745f 706f 696e 7429 5b2d  , input_point)[-
+00004b20: 315d 2e72 7370 6c69 7428 222e 222c 2031  1].rsplit(".", 1
+00004b30: 295b 2d31 5d0a 2020 2020 2020 2020 2020  )[-1].          
+00004b40: 2020 6966 206c 656e 287a 645f 696e 2920    if len(zd_in) 
+00004b50: 3d3d 2036 3a0a 2020 2020 2020 2020 2020  == 6:.          
+00004b60: 2020 2020 2020 706f 696e 7473 5b70 6f69        points[poi
+00004b70: 6e74 5d5b 2243 6f6e 746f 7572 496e 6465  nt]["ContourInde
+00004b80: 7822 5d20 3d20 696e 7428 7a64 5f69 6e5b  x"] = int(zd_in[
+00004b90: 333a 5d29 0a20 2020 2020 2020 2020 2020  3:]).           
+00004ba0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00004bb0: 2020 2020 2020 2070 6f69 6e74 735b 706f         points[po
+00004bc0: 696e 745d 5b22 436f 6e74 6f75 7249 6e64  int]["ContourInd
+00004bd0: 6578 225d 203d 2030 0a0a 2020 2020 2020  ex"] = 0..      
+00004be0: 2020 2320 4166 7465 7220 6170 706c 6963    # After applic
+00004bf0: 6174 696f 6e20 6f66 2061 2072 6567 6973  ation of a regis
+00004c00: 7472 6174 696f 6e20 7472 616e 7366 6f72  tration transfor
+00004c10: 6d2c 2070 6f69 6e74 7320 6f72 6967 696e  m, points origin
+00004c20: 616c 6c79 0a20 2020 2020 2020 2023 2069  ally.        # i
+00004c30: 6e20 7468 6520 7361 6d65 206d 6179 2065  n the same may e
+00004c40: 6e64 2075 7020 7769 7468 2073 6c69 6768  nd up with sligh
+00004c50: 746c 7920 6469 6666 6572 656e 7420 7a2d  tly different z-
+00004c60: 636f 6f72 6469 6e61 7465 732e 0a20 2020  coordinates..   
+00004c70: 2020 2020 2023 2046 6f72 206d 6f73 7420       # For most 
+00004c80: 7075 7270 6f73 6573 2028 616e 6420 736c  purposes (and sl
+00004c90: 6963 6520 7468 6963 6b6e 6573 7365 7329  ice thicknesses)
+00004ca0: 2069 7427 7320 7072 6f62 6162 6c79 0a20   it's probably. 
+00004cb0: 2020 2020 2020 2023 2061 2072 6561 736f         # a reaso
+00004cc0: 6e61 626c 6520 6170 7072 6f78 696d 6174  nable approximat
+00004cd0: 696f 6e20 746f 206d 6170 2061 6c6c 2070  ion to map all p
+00004ce0: 6f69 6e74 7320 746f 2074 6865 206d 6561  oints to the mea
+00004cf0: 6e0a 2020 2020 2020 2020 2320 7a2d 636f  n.        # z-co
+00004d00: 6f72 6469 6e61 7465 206f 6620 616c 6c20  ordinate of all 
+00004d10: 706f 696e 7473 206f 7269 6769 6e61 6c6c  points originall
+00004d20: 7920 696e 2074 6865 2073 616d 6520 706c  y in the same pl
+00004d30: 616e 652e 0a20 2020 2020 2020 206b 6565  ane..        kee
+00004d40: 705f 6f72 6967 696e 616c 5f70 6c61 6e65  p_original_plane
+00004d50: 7320 3d20 6765 7461 7474 7228 7365 6c66  s = getattr(self
+00004d60: 2c20 276b 6565 705f 6f72 6967 696e 616c  , 'keep_original
+00004d70: 5f70 6c61 6e65 7327 2c20 5472 7565 290a  _planes', True).
+00004d80: 2020 2020 2020 2020 6966 206b 6565 705f          if keep_
+00004d90: 6f72 6967 696e 616c 5f70 6c61 6e65 733a  original_planes:
+00004da0: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+00004db0: 6f72 7420 706f 696e 7473 2062 7920 736c  ort points by sl
+00004dc0: 6963 6520 7a2d 636f 6f72 6469 6e61 7465  ice z-coordinate
+00004dd0: 2c0a 2020 2020 2020 2020 2020 2020 2320  ,.            # 
+00004de0: 6b65 6570 696e 6720 7265 6c61 7469 7665  keeping relative
+00004df0: 206f 7264 6572 2077 6974 6869 6e20 6120   order within a 
+00004e00: 736c 6963 652e 0a20 2020 2020 2020 2020  slice..         
+00004e10: 2020 2073 6c69 6365 7320 3d20 7b7d 0a20     slices = {}. 
+00004e20: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
+00004e30: 6f69 6e74 2069 6e20 736f 7274 6564 2870  oint in sorted(p
+00004e40: 6f69 6e74 7329 3a0a 2020 2020 2020 2020  oints):.        
+00004e50: 2020 2020 2020 2020 692c 206a 2c20 6b20          i, j, k 
+00004e60: 3d20 706f 696e 7473 5b70 6f69 6e74 5d5b  = points[point][
+00004e70: 2249 6e70 7574 496e 6465 7822 5d0a 2020  "InputIndex"].  
+00004e80: 2020 2020 2020 2020 2020 2020 2020 782c                x,
+00004e90: 2079 2c20 7a20 3d20 706f 696e 7473 5b70   y, z = points[p
+00004ea0: 6f69 6e74 5d5b 224f 7574 7075 7450 6f69  oint]["OutputPoi
+00004eb0: 6e74 225d 0a20 2020 2020 2020 2020 2020  nt"].           
+00004ec0: 2020 2020 2069 6620 6b20 6e6f 7420 696e       if k not in
+00004ed0: 2073 6c69 6365 733a 0a20 2020 2020 2020   slices:.       
+00004ee0: 2020 2020 2020 2020 2020 2020 2073 6c69               sli
+00004ef0: 6365 735b 6b5d 203d 207b 2770 6f69 6e74  ces[k] = {'point
+00004f00: 7327 3a20 5b5d 2c20 277a 5f70 6f69 6e74  s': [], 'z_point
+00004f10: 7327 3a20 5b5d 7d0a 2020 2020 2020 2020  s': []}.        
+00004f20: 2020 2020 2020 2020 736c 6963 6573 5b6b          slices[k
+00004f30: 5d5b 2270 6f69 6e74 7322 5d2e 6170 7065  ]["points"].appe
+00004f40: 6e64 2870 6f69 6e74 290a 2020 2020 2020  nd(point).      
+00004f50: 2020 2020 2020 2020 2020 736c 6963 6573            slices
+00004f60: 5b6b 5d5b 227a 5f70 6f69 6e74 7322 5d2e  [k]["z_points"].
+00004f70: 6170 7065 6e64 287a 290a 0a20 2020 2020  append(z)..     
+00004f80: 2020 2020 2020 2023 2046 6f72 2070 6f69         # For poi
+00004f90: 6e74 7320 696e 2065 6163 6820 736c 6963  nts in each slic
+00004fa0: 652c 2072 6573 6574 207a 2d63 6f6f 7264  e, reset z-coord
+00004fb0: 696e 6174 6573 2074 6f20 6d65 616e 2076  inates to mean v
+00004fc0: 616c 7565 2e0a 2020 2020 2020 2020 2020  alue..          
+00004fd0: 2020 666f 7220 6b20 696e 2073 6f72 7465    for k in sorte
+00004fe0: 6428 736c 6963 6573 293a 0a20 2020 2020  d(slices):.     
+00004ff0: 2020 2020 2020 2020 2020 207a 5f6d 6561             z_mea
+00005000: 6e20 3d20 6e70 2e6d 6561 6e28 736c 6963  n = np.mean(slic
+00005010: 6573 5b6b 5d5b 227a 5f70 6f69 6e74 7322  es[k]["z_points"
+00005020: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00005030: 2020 2066 6f72 2070 6f69 6e74 2069 6e20     for point in 
+00005040: 736c 6963 6573 5b6b 5d5b 2270 6f69 6e74  slices[k]["point
+00005050: 7322 5d3a 0a20 2020 2020 2020 2020 2020  s"]:.           
+00005060: 2020 2020 2020 2020 2078 2c20 792c 207a           x, y, z
+00005070: 203d 2070 6f69 6e74 735b 706f 696e 745d   = points[point]
+00005080: 5b22 4f75 7470 7574 506f 696e 7422 5d0a  ["OutputPoint"].
+00005090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000050a0: 2020 2020 706f 696e 7473 5b70 6f69 6e74      points[point
+000050b0: 5d5b 224f 7574 7075 7450 6f69 6e74 225d  ]["OutputPoint"]
+000050c0: 203d 2028 782c 2079 2c20 7a5f 6d65 616e   = (x, y, z_mean
+000050d0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+000050e0: 6e20 706f 696e 7473 0a0a 2020 2020 6465  n points..    de
+000050f0: 6620 636c 6f6e 655f 6174 7472 7328 7365  f clone_attrs(se
+00005100: 6c66 2c20 6f62 6a2c 2063 6f70 795f 6461  lf, obj, copy_da
+00005110: 7461 3d54 7275 6529 3a0a 2020 2020 2020  ta=True):.      
+00005120: 2020 2222 2241 7373 6967 6e20 616c 6c20    """Assign all 
+00005130: 6174 7472 6962 7574 6573 206f 6620 3c73  attributes of <s
+00005140: 656c 663e 2074 6f20 616e 6f74 6865 7220  elf> to another 
+00005150: 6f62 6a65 6374 2c20 3c6f 626a 3e2c 2020  object, <obj>,  
+00005160: 656e 7375 7269 6e67 200a 2020 2020 2020  ensuring .      
+00005170: 2020 7468 6174 206f 776e 206d 6173 6b27    that own mask'
+00005180: 7320 6461 7461 2067 6574 7320 636f 7272  s data gets corr
+00005190: 6563 746c 7920 636f 7069 6564 2069 6620  ectly copied if 
+000051a0: 3c63 6f70 795f 6461 7461 3e20 6973 2054  <copy_data> is T
+000051b0: 7275 652e 2222 220a 0a20 2020 2020 2020  rue."""..       
+000051c0: 2073 6b72 742e 636f 7265 2e44 6174 612e   skrt.core.Data.
+000051d0: 636c 6f6e 655f 6174 7472 7328 7365 6c66  clone_attrs(self
+000051e0: 2c20 6f62 6a2c 2063 6f70 795f 6461 7461  , obj, copy_data
+000051f0: 3d63 6f70 795f 6461 7461 290a 2020 2020  =copy_data).    
+00005200: 2020 2020 6966 2063 6f70 795f 6461 7461      if copy_data
+00005210: 2061 6e64 2073 656c 662e 6d61 736b 2069   and self.mask i
+00005220: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00005230: 2020 2020 2020 2020 6f62 6a2e 6d61 736b          obj.mask
+00005240: 203d 2073 656c 662e 6d61 736b 2e63 6c6f   = self.mask.clo
+00005250: 6e65 2863 6f70 795f 6461 7461 3d54 7275  ne(copy_data=Tru
+00005260: 6529 0a0a 2020 2020 6465 6620 6765 745f  e)..    def get_
+00005270: 6469 636f 6d5f 6461 7461 7365 7428 7365  dicom_dataset(se
+00005280: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00005290: 5265 7475 726e 2070 7964 6963 6f6d 2e64  Return pydicom.d
+000052a0: 6174 6173 6574 2e46 696c 6544 6174 6173  ataset.FileDatas
+000052b0: 6574 206f 626a 6563 7420 6173 736f 6369  et object associ
+000052c0: 6174 6564 2077 6974 6820 7468 6973 2052  ated with this R
+000052d0: 4f49 0a20 2020 2020 2020 2069 6620 6c6f  OI.        if lo
+000052e0: 6164 6564 2066 726f 6d20 6469 636f 6d3b  aded from dicom;
+000052f0: 206f 7468 6572 7769 7365 2c20 7265 7475   otherwise, retu
+00005300: 726e 204e 6f6e 652e 2222 220a 0a20 2020  rn None."""..   
+00005310: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
+00005320: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00005330: 7365 6c66 2e64 6963 6f6d 5f64 6174 6173  self.dicom_datas
+00005340: 6574 0a0a 2020 2020 6465 6620 7265 7365  et..    def rese
+00005350: 745f 636f 6e74 6f75 7273 2873 656c 662c  t_contours(self,
+00005360: 2063 6f6e 746f 7572 733d 4e6f 6e65 2c20   contours=None, 
+00005370: 6d6f 7374 5f70 6f69 6e74 733d 4661 6c73  most_points=Fals
+00005380: 6529 3a0a 2020 2020 2020 2020 2222 2252  e):.        """R
+00005390: 6573 6574 2078 2d79 2063 6f6e 746f 7572  eset x-y contour
+000053a0: 7320 746f 2061 2067 6976 656e 2064 6963  s to a given dic
+000053b0: 7420 6f66 2073 6c69 6365 7320 616e 6420  t of slices and 
+000053c0: 636f 6e74 6f75 7220 6c69 7374 732c 200a  contour lists, .
+000053d0: 2020 2020 2020 2020 616e 6420 656e 7375          and ensu
+000053e0: 7265 2074 6861 7420 6d61 736b 2061 6e64  re that mask and
+000053f0: 2079 2d7a 2f78 2d7a 2063 6f6e 746f 7572   y-z/x-z contour
+00005400: 7320 7769 6c6c 2062 6520 7265 6372 6561  s will be recrea
+00005410: 7465 642e 2049 6620 0a20 2020 2020 2020  ted. If .       
+00005420: 2063 6f6e 746f 7572 7320 6973 204e 6f6e   contours is Non
+00005430: 652c 2063 6f6e 746f 7572 7320 7769 6c6c  e, contours will
+00005440: 2062 6520 7265 7365 7420 7573 696e 6720   be reset using 
+00005450: 6f77 6e20 782d 7920 636f 6e74 6f75 7273  own x-y contours
+00005460: 2e0a 2020 2020 2020 2020 4966 206d 6f73  ..        If mos
+00005470: 745f 706f 696e 7473 2069 7320 5472 7565  t_points is True
+00005480: 2c20 6f6e 6c79 2074 6865 2063 6f6e 746f  , only the conto
+00005490: 7572 2077 6974 6820 6d6f 7374 2070 6f69  ur with most poi
+000054a0: 6e74 7320 666f 720a 2020 2020 2020 2020  nts for.        
+000054b0: 6561 6368 2073 6c69 6365 2069 7320 636f  each slice is co
+000054c0: 6e73 6964 6572 6564 2e22 2222 0a0a 2020  nsidered."""..  
+000054d0: 2020 2020 2020 2320 4368 6563 6b20 666f        # Check fo
+000054e0: 726d 6174 2069 7320 636f 7272 6563 740a  rmat is correct.
+000054f0: 2020 2020 2020 2020 6966 2063 6f6e 746f          if conto
+00005500: 7572 7320 6973 204e 6f6e 653a 0a20 2020  urs is None:.   
+00005510: 2020 2020 2020 2020 2063 6f6e 746f 7572           contour
+00005520: 7320 3d20 7365 6c66 2e67 6574 5f63 6f6e  s = self.get_con
+00005530: 746f 7572 7328 290a 2020 2020 2020 2020  tours().        
+00005540: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00005550: 6528 636f 6e74 6f75 7273 2c20 6469 6374  e(contours, dict
+00005560: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00005570: 6169 7365 2054 7970 6545 7272 6f72 2822  aise TypeError("
+00005580: 636f 6e74 6f75 7273 2073 686f 756c 6420  contours should 
+00005590: 6265 2061 2064 6963 7422 290a 2020 2020  be a dict").    
+000055a0: 2020 2020 666f 7220 7a2c 2063 2069 6e20      for z, c in 
+000055b0: 636f 6e74 6f75 7273 2e69 7465 6d73 2829  contours.items()
+000055c0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+000055d0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+000055e0: 632c 206c 6973 7429 3a0a 2020 2020 2020  c, list):.      
+000055f0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00005600: 5479 7065 4572 726f 7228 6622 636f 6e74  TypeError(f"cont
+00005610: 6f75 7273 5b7b 7a7d 5d20 7368 6f75 6c64  ours[{z}] should
+00005620: 2062 6520 6120 6c69 7374 206f 6620 636f   be a list of co
+00005630: 6e74 6f75 7273 2022 0a20 2020 2020 2020  ntours ".       
+00005640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005650: 2020 2020 2020 2020 2066 226f 6e20 736c           f"on sl
+00005660: 6963 6520 7b7a 7d22 290a 0a20 2020 2020  ice {z}")..     
+00005670: 2020 2023 2046 6f72 2065 6163 6820 736c     # For each sl
+00005680: 6963 652c 206b 6565 7020 6f6e 6c79 2063  ice, keep only c
+00005690: 6f6e 746f 7572 2077 6974 6820 6d6f 7374  ontour with most
+000056a0: 2070 6f69 6e74 732e 0a20 2020 2020 2020   points..       
+000056b0: 2069 6620 6d6f 7374 5f70 6f69 6e74 733a   if most_points:
+000056c0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+000056d0: 746f 7572 7320 3d20 7b6b 6579 3a20 5b6d  tours = {key: [m
+000056e0: 6178 2876 616c 7565 2c20 6b65 793d 6c65  ax(value, key=le
+000056f0: 6e29 5d0a 2020 2020 2020 2020 2020 2020  n)].            
+00005700: 2020 2020 2020 2020 666f 7220 6b65 792c          for key,
+00005710: 2076 616c 7565 2069 6e20 636f 6e74 6f75   value in contou
+00005720: 7273 2e69 7465 6d73 2829 7d0a 0a20 2020  rs.items()}..   
+00005730: 2020 2020 2073 656c 662e 696e 7075 745f       self.input_
+00005740: 636f 6e74 6f75 7273 203d 2063 6f6e 746f  contours = conto
+00005750: 7572 730a 2020 2020 2020 2020 7365 6c66  urs.        self
+00005760: 2e65 6d70 7479 203d 206e 6f74 206c 656e  .empty = not len
+00005770: 2873 656c 662e 696e 7075 745f 636f 6e74  (self.input_cont
+00005780: 6f75 7273 290a 2020 2020 2020 2020 7365  ours).        se
+00005790: 6c66 2e63 6f6e 746f 7572 7320 3d20 7b22  lf.contours = {"
+000057a0: 782d 7922 3a20 636f 6e74 6f75 7273 7d0a  x-y": contours}.
+000057b0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+000057c0: 6465 645f 6d61 736b 203d 2046 616c 7365  ded_mask = False
+000057d0: 0a20 2020 2020 2020 2073 656c 662e 6d61  .        self.ma
+000057e0: 736b 203d 204e 6f6e 650a 0a20 2020 2064  sk = None..    d
+000057f0: 6566 2072 6573 6574 5f6d 6173 6b28 7365  ef reset_mask(se
+00005800: 6c66 2c20 6d61 736b 3d4e 6f6e 6529 3a0a  lf, mask=None):.
+00005810: 2020 2020 2020 2020 2222 2253 6574 206d          """Set m
+00005820: 6173 6b20 746f 2065 6974 6865 7220 6120  ask to either a 
+00005830: 6e75 6d70 7920 6172 7261 7920 6f72 2061  numpy array or a
+00005840: 6e20 496d 6167 6520 6f62 6a65 6374 2c20  n Image object, 
+00005850: 616e 6420 656e 7375 7265 200a 2020 2020  and ensure .    
+00005860: 2020 2020 7468 6174 2063 6f6e 746f 7572      that contour
+00005870: 7320 7769 6c6c 2062 6520 7265 6372 6561  s will be recrea
+00005880: 7465 642e 2049 6620 6d61 736b 2069 7320  ted. If mask is 
+00005890: 4e6f 6e65 2c20 636f 6e74 6f75 7273 2077  None, contours w
+000058a0: 696c 6c20 6265 200a 2020 2020 2020 2020  ill be .        
+000058b0: 7265 7365 7420 7573 696e 6720 6f77 6e20  reset using own 
+000058c0: 6d61 736b 2e22 2222 0a0a 2020 2020 2020  mask."""..      
+000058d0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000058e0: 6d61 736b 2c20 736b 7274 2e69 6d61 6765  mask, skrt.image
+000058f0: 2e49 6d61 6765 293a 0a20 2020 2020 2020  .Image):.       
+00005900: 2020 2020 2073 656c 662e 6d61 736b 203d       self.mask =
+00005910: 206d 6173 6b0a 2020 2020 2020 2020 2020   mask.          
+00005920: 2020 7365 6c66 2e61 6666 696e 6520 3d20    self.affine = 
+00005930: 6d61 736b 2e67 6574 5f61 6666 696e 6528  mask.get_affine(
+00005940: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00005950: 6c66 2e76 6f78 656c 5f73 697a 6520 3d20  lf.voxel_size = 
+00005960: 6d61 736b 2e67 6574 5f76 6f78 656c 5f73  mask.get_voxel_s
+00005970: 697a 6528 290a 2020 2020 2020 2020 2020  ize().          
+00005980: 2020 7365 6c66 2e6f 7269 6769 6e20 3d20    self.origin = 
+00005990: 6d61 736b 2e67 6574 5f6f 7269 6769 6e28  mask.get_origin(
+000059a0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000059b0: 6c66 2e73 6861 7065 203d 206d 6173 6b2e  lf.shape = mask.
+000059c0: 6765 745f 6461 7461 2829 2e73 6861 7065  get_data().shape
+000059d0: 0a0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
+000059e0: 7369 6e73 7461 6e63 6528 6d61 736b 2c20  sinstance(mask, 
+000059f0: 6e70 2e6e 6461 7272 6179 293a 0a20 2020  np.ndarray):.   
+00005a00: 2020 2020 2020 2020 2073 656c 662e 6d61           self.ma
+00005a10: 736b 203d 2073 6b72 742e 696d 6167 652e  sk = skrt.image.
+00005a20: 496d 6167 6528 0a20 2020 2020 2020 2020  Image(.         
+00005a30: 2020 2020 2020 206d 6173 6b2c 0a20 2020         mask,.   
+00005a40: 2020 2020 2020 2020 2020 2020 2061 6666               aff
+00005a50: 696e 6520 3d20 7365 6c66 2e61 6666 696e  ine = self.affin
+00005a60: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00005a70: 2020 2076 6f78 656c 5f73 697a 653d 7365     voxel_size=se
+00005a80: 6c66 2e76 6f78 656c 5f73 697a 652c 0a20  lf.voxel_size,. 
+00005a90: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00005aa0: 7269 6769 6e3d 7365 6c66 2e6f 7269 6769  rigin=self.origi
+00005ab0: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+00005ac0: 2020 2064 7479 7065 3d62 6f6f 6c0a 2020     dtype=bool.  
+00005ad0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00005ae0: 2020 2020 2065 6c69 6620 6d61 736b 2069       elif mask i
+00005af0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00005b00: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+00005b10: 7065 4572 726f 7228 226d 6173 6b20 7368  peError("mask sh
+00005b20: 6f75 6c64 2062 6520 616e 2049 6d61 6765  ould be an Image
+00005b30: 206f 7220 6120 6e75 6d70 7920 6172 7261   or a numpy arra
+00005b40: 7922 290a 0a20 2020 2020 2020 2073 656c  y")..        sel
+00005b50: 662e 6d61 736b 2e67 6574 5f73 7461 6e64  f.mask.get_stand
+00005b60: 6172 6469 7365 645f 6461 7461 2866 6f72  ardised_data(for
+00005b70: 6365 3d54 7275 6529 0a20 2020 2020 2020  ce=True).       
+00005b80: 2073 656c 662e 6c6f 6164 6564 5f6d 6173   self.loaded_mas
+00005b90: 6b20 3d20 5472 7565 0a20 2020 2020 2020  k = True.       
+00005ba0: 2073 656c 662e 636f 6e74 6f75 7273 203d   self.contours =
+00005bb0: 207b 7d0a 2020 2020 2020 2020 7365 6c66   {}.        self
+00005bc0: 2e65 6d70 7479 203d 206e 6f74 206e 702e  .empty = not np.
+00005bd0: 616e 7928 7365 6c66 2e6d 6173 6b2e 6765  any(self.mask.ge
+00005be0: 745f 6461 7461 2829 290a 2020 2020 2020  t_data()).      
+00005bf0: 2020 7365 6c66 2e69 6e70 7574 5f63 6f6e    self.input_con
+00005c00: 746f 7572 7320 3d20 4e6f 6e65 0a0a 2020  tours = None..  
+00005c10: 2020 6465 6620 6765 745f 636f 6e74 6f75    def get_contou
+00005c20: 7273 2873 656c 662c 2076 6965 773d 2278  rs(self, view="x
+00005c30: 2d79 222c 2069 6478 5f61 735f 6b65 793d  -y", idx_as_key=
+00005c40: 4661 6c73 652c 206d 6f73 745f 706f 696e  False, most_poin
+00005c50: 7473 3d46 616c 7365 293a 0a20 2020 2020  ts=False):.     
+00005c60: 2020 2022 2222 0a20 2020 2020 2020 2047     """.        G
+00005c70: 6574 2064 6963 7420 6f66 2063 6f6e 746f  et dict of conto
+00005c80: 7572 7320 696e 2061 2067 6976 656e 206f  urs in a given o
+00005c90: 7269 656e 7461 7469 6f6e 2e0a 0a20 2020  rientation...   
+00005ca0: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
+00005cb0: 733a 2a2a 0a0a 2020 2020 2020 2020 7669  s:**..        vi
+00005cc0: 6577 203a 2073 7472 2c20 6465 6661 756c  ew : str, defaul
+00005cd0: 743d 2278 2d79 220a 2020 2020 2020 2020  t="x-y".        
+00005ce0: 2020 2020 5669 6577 2069 6e20 7768 6963      View in whic
+00005cf0: 6820 746f 206f 6274 6169 6e20 636f 6e74  h to obtain cont
+00005d00: 6f75 7273 2e0a 0a20 2020 2020 2020 2069  ours...        i
+00005d10: 6478 5f61 735f 6b65 7920 3a20 626f 6f6c  dx_as_key : bool
+00005d20: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
+00005d30: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+00005d40: 7275 652c 2075 7365 2073 6c69 6365 2069  rue, use slice i
+00005d50: 6e64 6963 6573 2061 7320 6469 6374 696f  ndices as dictio
+00005d60: 6e61 7279 206b 6579 733b 2069 6620 4661  nary keys; if Fa
+00005d70: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+00005d80: 2075 7365 2073 6c69 6365 207a 2d63 6f6f   use slice z-coo
+00005d90: 7264 696e 6174 6573 2061 7320 6469 6374  rdinates as dict
+00005da0: 696f 6e61 7279 206b 6579 732e 0a0a 2020  ionary keys...  
+00005db0: 2020 2020 2020 6d6f 7374 5f70 6f69 6e74        most_point
+00005dc0: 7320 3a20 626f 6f6c 2c20 6465 6661 756c  s : bool, defaul
+00005dd0: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
+00005de0: 2020 2020 4966 2054 7275 652c 2072 6574      If True, ret
+00005df0: 7572 6e20 6f6e 6c79 2074 6865 2063 6f6e  urn only the con
+00005e00: 746f 7572 2077 6974 6820 6d6f 7374 2070  tour with most p
+00005e10: 6f69 6e74 7320 666f 7220 6561 6368 2073  oints for each s
+00005e20: 6c69 6365 3b0a 2020 2020 2020 2020 2020  lice;.          
+00005e30: 2020 6966 2046 616c 7365 2c20 7265 7475    if False, retu
+00005e40: 726e 2061 6c6c 2063 6f6e 746f 7572 7320  rn all contours 
+00005e50: 666f 7220 6561 6368 2073 6c69 6365 2e0a  for each slice..
+00005e60: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00005e70: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
+00005e80: 0a20 2020 2020 2020 2069 6620 7669 6577  .        if view
+00005e90: 206e 6f74 2069 6e20 7365 6c66 2e63 6f6e   not in self.con
+00005ea0: 746f 7572 733a 0a20 2020 2020 2020 2020  tours:.         
+00005eb0: 2020 2073 656c 662e 6372 6561 7465 5f63     self.create_c
+00005ec0: 6f6e 746f 7572 7328 7669 6577 290a 2020  ontours(view).  
+00005ed0: 2020 2020 2020 636f 6e74 6f75 7273 203d        contours =
+00005ee0: 2073 656c 662e 636f 6e74 6f75 7273 5b76   self.contours[v
+00005ef0: 6965 775d 0a0a 2020 2020 2020 2020 2320  iew]..        # 
+00005f00: 436f 6e76 6572 7420 6b65 7973 2074 6f20  Convert keys to 
+00005f10: 696e 6469 6365 7320 7261 7468 6572 2074  indices rather t
+00005f20: 6861 6e20 706f 7369 7469 6f6e 730a 2020  han positions.  
+00005f30: 2020 2020 2020 6966 2069 6478 5f61 735f        if idx_as_
+00005f40: 6b65 793a 0a20 2020 2020 2020 2020 2020  key:.           
+00005f50: 2063 6f6e 746f 7572 7320 3d20 7b73 656c   contours = {sel
+00005f60: 662e 706f 735f 746f 5f69 6478 286b 6579  f.pos_to_idx(key
+00005f70: 2c20 736b 7274 2e69 6d61 6765 2e5f 736c  , skrt.image._sl
+00005f80: 6963 655f 6178 6573 5b76 6965 775d 293a  ice_axes[view]):
+00005f90: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00005fa0: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
+00005fb0: 666f 7220 6b65 792c 2076 616c 7565 2069  for key, value i
+00005fc0: 6e20 636f 6e74 6f75 7273 2e69 7465 6d73  n contours.items
+00005fd0: 2829 7d0a 0a20 2020 2020 2020 2023 2046  ()}..        # F
+00005fe0: 6f72 2065 6163 6820 736c 6963 652c 206b  or each slice, k
+00005ff0: 6565 7020 6f6e 6c79 2063 6f6e 746f 7572  eep only contour
+00006000: 2077 6974 6820 6d6f 7374 2070 6f69 6e74   with most point
+00006010: 732e 0a20 2020 2020 2020 2069 6620 6d6f  s..        if mo
+00006020: 7374 5f70 6f69 6e74 733a 0a20 2020 2020  st_points:.     
+00006030: 2020 2020 2020 2063 6f6e 746f 7572 7320         contours 
+00006040: 3d20 7b6b 6579 3a20 5b6d 6178 2876 616c  = {key: [max(val
+00006050: 7565 2c20 6b65 793d 6c65 6e29 5d0a 2020  ue, key=len)].  
+00006060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006070: 2020 666f 7220 6b65 792c 2076 616c 7565    for key, value
+00006080: 2069 6e20 636f 6e74 6f75 7273 2e69 7465   in contours.ite
+00006090: 6d73 2829 7d0a 0a20 2020 2020 2020 2072  ms()}..        r
+000060a0: 6574 7572 6e20 636f 6e74 6f75 7273 0a0a  eturn contours..
+000060b0: 2020 2020 6465 6620 6765 745f 636f 6e74      def get_cont
+000060c0: 6f75 7273 5f6f 6e5f 736c 6963 6528 7365  ours_on_slice(se
+000060d0: 6c66 2c20 7669 6577 3d22 782d 7922 2c20  lf, view="x-y", 
+000060e0: 736c 3d4e 6f6e 652c 2069 6478 3d4e 6f6e  sl=None, idx=Non
+000060f0: 652c 2070 6f73 3d4e 6f6e 6529 3a0a 0a20  e, pos=None):.. 
+00006100: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
+00006110: 2829 0a20 2020 2020 2020 2069 6620 736c  ().        if sl
+00006120: 2069 7320 4e6f 6e65 2061 6e64 2069 6478   is None and idx
+00006130: 2069 7320 4e6f 6e65 2061 6e64 2070 6f73   is None and pos
+00006140: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00006150: 2020 2020 2020 6964 7820 3d20 7365 6c66        idx = self
+00006160: 2e67 6574 5f6d 6964 5f69 6478 2876 6965  .get_mid_idx(vie
+00006170: 7729 0a20 2020 2020 2020 2065 6c73 653a  w).        else:
+00006180: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
+00006190: 203d 2073 656c 662e 6765 745f 6964 7828   = self.get_idx(
+000061a0: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
+000061b0: 6f73 290a 2020 2020 2020 2020 7472 793a  os).        try:
+000061c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000061d0: 7572 6e20 7365 6c66 2e67 6574 5f63 6f6e  urn self.get_con
+000061e0: 746f 7572 7328 7669 6577 2c20 6964 785f  tours(view, idx_
+000061f0: 6173 5f6b 6579 3d54 7275 6529 5b69 6478  as_key=True)[idx
+00006200: 5d0a 2020 2020 2020 2020 6578 6365 7074  ].        except
+00006210: 204b 6579 4572 726f 723a 0a20 2020 2020   KeyError:.     
+00006220: 2020 2020 2020 2072 6574 7572 6e20 5b5d         return []
+00006230: 0a0a 2020 2020 6465 6620 6765 745f 736c  ..    def get_sl
+00006240: 6963 655f 706f 7369 7469 6f6e 7328 7365  ice_positions(se
+00006250: 6c66 2c20 6f74 6865 723d 4e6f 6e65 2c20  lf, other=None, 
+00006260: 7669 6577 3d22 782d 7922 2c20 706f 7369  view="x-y", posi
+00006270: 7469 6f6e 5f61 735f 6964 783d 4661 6c73  tion_as_idx=Fals
+00006280: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
+00006290: 6574 686f 643d 2275 6e69 6f6e 2229 3a0a  ethod="union"):.
+000062a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000062b0: 2020 2020 4765 7420 6f72 6465 7265 6420      Get ordered 
+000062c0: 6c69 7374 206f 6620 736c 6963 6520 706f  list of slice po
+000062d0: 7369 7469 6f6e 7320 666f 7220 7365 6c66  sitions for self
+000062e0: 2061 6e64 206f 7468 6572 2e0a 0a20 2020   and other...   
+000062f0: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
+00006300: 733a 2a2a 0a0a 2020 2020 2020 2020 6f74  s:**..        ot
+00006310: 6865 7220 3a20 736b 7274 2e73 7472 7563  her : skrt.struc
+00006320: 7475 7265 732e 524f 492c 2064 6566 6175  tures.ROI, defau
+00006330: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00006340: 2020 2020 5365 636f 6e64 2052 4f49 206f      Second ROI o
+00006350: 6620 6120 7061 6972 2066 6f72 2077 6869  f a pair for whi
+00006360: 6368 2073 6c69 6365 2070 6f73 6974 696f  ch slice positio
+00006370: 6e73 2061 7265 2062 6520 6f62 7461 696e  ns are be obtain
+00006380: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
+00006390: 4469 7372 6567 6172 6465 6420 6966 204e  Disregarded if N
+000063a0: 6f6e 652e 0a0a 2020 2020 2020 2020 7669  one...        vi
+000063b0: 6577 203a 2073 7472 2c20 6465 6661 756c  ew : str, defaul
+000063c0: 743d 2278 2d79 220a 2020 2020 2020 2020  t="x-y".        
+000063d0: 2020 2020 5669 6577 2069 6e20 7768 6963      View in whic
+000063e0: 6820 746f 206f 6274 6169 6e20 736c 6963  h to obtain slic
+000063f0: 6573 2e0a 0a20 2020 2020 2020 2070 6f73  es...        pos
+00006400: 6974 696f 6e5f 6173 5f69 6478 203a 2062  ition_as_idx : b
+00006410: 6f6f 6c2c 2064 6566 6175 6c74 3d46 616c  ool, default=Fal
+00006420: 7365 0a20 2020 2020 2020 2020 2020 2049  se.            I
+00006430: 6620 5472 7565 2c20 7265 7475 726e 2070  f True, return p
+00006440: 6f73 6974 696f 6e73 2061 7320 736c 6963  ositions as slic
+00006450: 6520 696e 6469 6365 733b 2069 6620 4661  e indices; if Fa
+00006460: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+00006470: 2072 6574 7572 6e20 706f 7369 7469 6f6e   return position
+00006480: 7320 6173 2073 6c69 6365 207a 2d63 6f6f  s as slice z-coo
+00006490: 7264 696e 6174 6573 2028 6d6d 292e 0a0a  rdinates (mm)...
+000064a0: 2020 2020 2020 2020 6d65 7468 6f64 3a20          method: 
+000064b0: 7374 722c 2064 6566 6175 6c74 3d22 756e  str, default="un
+000064c0: 696f 6e22 0a20 2020 2020 2020 2020 2020  ion".           
+000064d0: 2053 7472 696e 6720 7370 6563 6966 7969   String specifyi
+000064e0: 6e67 2073 6c69 6365 7320 666f 7220 7768  ng slices for wh
+000064f0: 6963 6820 706f 7369 7469 6f6e 7320 6172  ich positions ar
+00006500: 6520 746f 2062 6520 6f62 7461 696e 6564  e to be obtained
+00006510: 2c0a 2020 2020 2020 2020 2020 2020 666f  ,.            fo
+00006520: 7220 524f 4973 2073 656c 6620 616e 6420  r ROIs self and 
+00006530: 6f74 6865 722e 0a0a 2020 2020 2020 2020  other...        
+00006540: 2020 2020 2d20 226c 6566 7422 2028 6f72      - "left" (or
+00006550: 206f 7468 6572 2069 7320 4e6f 6e65 293a   other is None):
+00006560: 2072 6574 7572 6e20 706f 7369 7469 6f6e   return position
+00006570: 7320 6f66 0a20 2020 2020 2020 2020 2020  s of.           
+00006580: 2020 2073 6c69 6365 7320 636f 6e74 6169     slices contai
+00006590: 6e69 6e67 2073 656c 663b 0a20 2020 2020  ning self;.     
+000065a0: 2020 2020 2020 202d 2022 7269 6768 7422         - "right"
+000065b0: 3a20 7265 7475 726e 2070 6f73 6974 696f  : return positio
+000065c0: 6e73 206f 6620 736c 6963 6573 2063 6f6e  ns of slices con
+000065d0: 7461 696e 696e 6720 6f74 6865 723b 0a20  taining other;. 
+000065e0: 2020 2020 2020 2020 2020 202d 2022 756e             - "un
+000065f0: 696f 6e22 3a20 7265 7475 726e 2070 6f73  ion": return pos
+00006600: 6974 696f 6e73 206f 6620 736c 6963 6573  itions of slices
+00006610: 2063 6f6e 7461 696e 696e 6720 6569 7468   containing eith
+00006620: 6572 2073 656c 660a 2020 2020 2020 2020  er self.        
+00006630: 2020 2020 2020 6f72 206f 7468 6572 3b0a        or other;.
+00006640: 2020 2020 2020 2020 2020 2020 2d20 2269              - "i
+00006650: 6e74 6572 7365 6374 696f 6e22 3a20 7265  ntersection": re
+00006660: 7475 726e 2070 6f73 6974 696f 6e73 206f  turn positions o
+00006670: 6620 736c 6963 6573 2063 6f6e 7461 696e  f slices contain
+00006680: 696e 6720 626f 7468 0a20 2020 2020 2020  ing both.       
+00006690: 2020 2020 2020 2073 656c 6620 616e 6420         self and 
+000066a0: 6f74 6865 722e 0a20 2020 2020 2020 2022  other..        "
+000066b0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+000066c0: 6e20 6765 745f 736c 6963 655f 706f 7369  n get_slice_posi
+000066d0: 7469 6f6e 7328 7365 6c66 2c20 6f74 6865  tions(self, othe
+000066e0: 722c 2076 6965 772c 2070 6f73 6974 696f  r, view, positio
+000066f0: 6e5f 6173 5f69 6478 2c0a 2020 2020 2020  n_as_idx,.      
+00006700: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+00006710: 290a 0a20 2020 2064 6566 2067 6574 5f61  )..    def get_a
+00006720: 6666 696e 6528 7365 6c66 2c20 666f 7263  ffine(self, forc
+00006730: 655f 7374 616e 6461 7264 6973 653d 4661  e_standardise=Fa
+00006740: 6c73 652c 202a 2a6b 7761 7267 7329 3a0a  lse, **kwargs):.
+00006750: 2020 2020 2020 2020 2222 224c 6f61 6420          """Load 
+00006760: 7365 6c66 2061 6e64 2067 6574 2061 6666  self and get aff
+00006770: 696e 6520 6d61 7472 6978 2e22 2222 0a0a  ine matrix."""..
+00006780: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+00006790: 6428 290a 2020 2020 2020 2020 6966 2073  d().        if s
+000067a0: 656c 662e 6c6f 6164 6564 5f6d 6173 6b3a  elf.loaded_mask:
+000067b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000067c0: 7572 6e20 7365 6c66 2e6d 6173 6b2e 6765  urn self.mask.ge
+000067d0: 745f 6166 6669 6e65 2866 6f72 6365 5f73  t_affine(force_s
+000067e0: 7461 6e64 6172 6469 7365 3d66 6f72 6365  tandardise=force
+000067f0: 5f73 7461 6e64 6172 6469 7365 2c20 0a20  _standardise, . 
+00006800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006820: 2020 2020 2020 202a 2a6b 7761 7267 7329         **kwargs)
+00006830: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
+00006840: 6c66 2e69 6d61 6765 2069 7320 6e6f 7420  lf.image is not 
+00006850: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00006860: 2020 7265 7475 726e 2073 656c 662e 696d    return self.im
+00006870: 6167 652e 6765 745f 6166 6669 6e65 2866  age.get_affine(f
+00006880: 6f72 6365 5f73 7461 6e64 6172 6469 7365  orce_standardise
+00006890: 3d66 6f72 6365 5f73 7461 6e64 6172 6469  =force_standardi
+000068a0: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+000068b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000068c0: 2020 2020 2020 2020 2020 2020 202a 2a6b               **k
+000068d0: 7761 7267 7329 0a20 2020 2020 2020 2072  wargs).        r
+000068e0: 6574 7572 6e20 7365 6c66 2e61 6666 696e  eturn self.affin
+000068f0: 650a 0a20 2020 2064 6566 2067 6574 5f74  e..    def get_t
+00006900: 7261 6e73 6c61 7469 6f6e 5f74 6f5f 616c  ranslation_to_al
+00006910: 6967 6e28 0a20 2020 2020 2020 2020 2020  ign(.           
+00006920: 2073 656c 662c 206f 7468 6572 2c20 7a5f   self, other, z_
+00006930: 6672 6163 7469 6f6e 313d 4e6f 6e65 2c20  fraction1=None, 
+00006940: 7a5f 6672 6163 7469 6f6e 323d 4e6f 6e65  z_fraction2=None
+00006950: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00006960: 2020 2020 2020 2044 6574 6572 6d69 6e65         Determine
+00006970: 2074 7261 6e73 6c61 7469 6f6e 2066 6f72   translation for
+00006980: 2061 6c69 676e 696e 6720 3c73 656c 663e   aligning <self>
+00006990: 2074 6f20 3c6f 7468 6572 3e2e 0a0a 2020   to <other>...  
+000069a0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+000069b0: 7273 3a2a 2a0a 0a20 2020 2020 2020 206f  rs:**..        o
+000069c0: 7468 6572 203a 2052 4f49 2f53 7472 7563  ther : ROI/Struc
+000069d0: 7475 7265 5365 742f 6c69 7374 0a20 2020  tureSet/list.   
+000069e0: 2020 2020 2020 2020 2052 4f49 2077 6974           ROI wit
+000069f0: 6820 7768 6963 6820 616c 6967 6e6d 656e  h which alignmen
+00006a00: 7420 6973 2074 6f20 6265 2070 6572 666f  t is to be perfo
+00006a10: 726d 6564 2e20 2054 6869 7320 6361 6e20  rmed.  This can 
+00006a20: 6265 0a20 2020 2020 2020 2020 2020 2073  be.            s
+00006a30: 7065 6369 6669 6564 2064 6972 6563 746c  pecified directl
+00006a40: 7920 6173 2061 2073 696e 676c 6520 524f  y as a single RO
+00006a50: 492e 2020 416c 7465 726e 6174 6976 656c  I.  Alternativel
+00006a60: 792c 2069 7420 6361 6e0a 2020 2020 2020  y, it can.      
+00006a70: 2020 2020 2020 6265 2061 2053 7472 7563        be a Struc
+00006a80: 7475 7265 5365 742c 206f 7220 6120 6c69  tureSet, or a li
+00006a90: 7374 206f 7220 524f 492f 5374 7275 6374  st or ROI/Struct
+00006aa0: 7572 6553 6574 206f 626a 6563 7473 2c0a  ureSet objects,.
+00006ab0: 2020 2020 2020 2020 2020 2020 696e 2077              in w
+00006ac0: 6869 6368 2063 6173 6520 7468 6520 696e  hich case the in
+00006ad0: 6469 7669 6475 616c 2052 4f49 7320 7769  dividual ROIs wi
+00006ae0: 6c6c 2062 6520 636f 6d62 696e 6564 2e0a  ll be combined..
+00006af0: 0a20 2020 2020 2020 207a 5f66 7261 6374  .        z_fract
+00006b00: 696f 6e31 203a 2066 6c6f 6174 2c20 6465  ion1 : float, de
+00006b10: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00006b20: 2020 2020 2020 2050 6f73 6974 696f 6e20         Position 
+00006b30: 616c 6f6e 6720 7a20 6178 6973 206f 6620  along z axis of 
+00006b40: 736c 6963 6520 7468 726f 7567 6820 3c73  slice through <s
+00006b50: 656c 663e 206f 6e20 7768 6963 680a 2020  elf> on which.  
+00006b60: 2020 2020 2020 2020 2020 746f 2061 6c69            to ali
+00006b70: 676e 2e20 2049 6620 4e6f 6e65 2c20 616c  gn.  If None, al
+00006b80: 6967 6e6d 656e 7420 6973 2074 6f20 7468  ignment is to th
+00006b90: 6520 6365 6e74 726f 6964 206f 6620 7468  e centroid of th
+00006ba0: 650a 2020 2020 2020 2020 2020 2020 7768  e.            wh
+00006bb0: 6f6c 6520 524f 4920 766f 6c75 6d65 2e20  ole ROI volume. 
+00006bc0: 204f 7468 6572 7769 7365 2c20 616c 6967   Otherwise, alig
+00006bd0: 6e6d 656e 7420 6973 2074 6f20 7468 650a  nment is to the.
+00006be0: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
+00006bf0: 726f 6964 206f 6620 7468 6520 736c 6963  roid of the slic
+00006c00: 6520 6174 2074 6865 2073 7065 6369 6669  e at the specifi
+00006c10: 6564 2064 6973 7461 6e63 650a 2020 2020  ed distance.    
+00006c20: 2020 2020 2020 2020 6672 6f6d 2074 6865          from the
+00006c30: 2052 4f49 2773 206d 6f73 742d 696e 6665   ROI's most-infe
+00006c40: 7269 6f72 2070 6f69 6e74 3a20 3020 636f  rior point: 0 co
+00006c50: 7272 6573 706f 6e64 7320 746f 0a20 2020  rresponds to.   
+00006c60: 2020 2020 2020 2020 2074 6865 206d 6f73           the mos
+00006c70: 742d 696e 6665 7269 6f72 2070 6f69 6e74  t-inferior point
+00006c80: 2028 6c6f 7765 7374 207a 293b 2031 2063   (lowest z); 1 c
+00006c90: 6f72 7265 7370 6f6e 6473 2074 6f20 7468  orresponds to th
+00006ca0: 650a 2020 2020 2020 2020 2020 2020 6d6f  e.            mo
+00006cb0: 7374 2d73 7570 6572 696f 7220 706f 696e  st-superior poin
+00006cc0: 7420 2868 6967 6865 7374 207a 292e 2020  t (highest z).  
+00006cd0: 5661 6c75 6573 2066 6f72 207a 5f66 7261  Values for z_fra
+00006ce0: 6374 696f 6e0a 2020 2020 2020 2020 2020  ction.          
+00006cf0: 2020 6f75 7473 6964 6520 7468 6520 696e    outside the in
+00006d00: 7465 7276 616c 205b 302c 2031 5d20 7265  terval [0, 1] re
+00006d10: 7375 6c74 2069 6e20 6120 5275 6e74 696d  sult in a Runtim
+00006d20: 6545 7272 6f72 2e0a 0a20 2020 2020 2020  eError...       
+00006d30: 207a 5f66 7261 6374 696f 6e32 203a 2066   z_fraction2 : f
+00006d40: 6c6f 6174 2c20 6465 6661 756c 743d 4e6f  loat, default=No
+00006d50: 6e65 0a20 2020 2020 2020 2020 2020 2050  ne.            P
+00006d60: 6f73 6974 696f 6e20 616c 6f6e 6720 7a20  osition along z 
+00006d70: 6178 6973 206f 6620 736c 6963 6520 7468  axis of slice th
+00006d80: 726f 7567 6820 3c6f 7468 6572 3e20 6f6e  rough <other> on
+00006d90: 2077 6869 6368 0a20 2020 2020 2020 2020   which.         
+00006da0: 2020 2074 6f20 616c 6967 6e2e 2020 4966     to align.  If
+00006db0: 204e 6f6e 652c 2061 6c69 676e 6d65 6e74   None, alignment
+00006dc0: 2069 7320 746f 2074 6865 2063 656e 7472   is to the centr
+00006dd0: 6f69 6420 6f66 2074 6865 0a20 2020 2020  oid of the.     
+00006de0: 2020 2020 2020 2077 686f 6c65 2052 4f49         whole ROI
+00006df0: 2076 6f6c 756d 652e 2020 4f74 6865 7277   volume.  Otherw
+00006e00: 6973 652c 2061 6c69 676e 6d65 6e74 2069  ise, alignment i
+00006e10: 7320 746f 2074 6865 0a20 2020 2020 2020  s to the.       
+00006e20: 2020 2020 2063 656e 7472 6f69 6420 6f66       centroid of
+00006e30: 2074 6865 2073 6c69 6365 2061 7420 7468   the slice at th
+00006e40: 6520 7370 6563 6966 6965 6420 6469 7374  e specified dist
+00006e50: 616e 6365 0a20 2020 2020 2020 2020 2020  ance.           
+00006e60: 2066 726f 6d20 7468 6520 524f 4927 7320   from the ROI's 
+00006e70: 6d6f 7374 2d69 6e66 6572 696f 7220 706f  most-inferior po
+00006e80: 696e 743a 2030 2063 6f72 7265 7370 6f6e  int: 0 correspon
+00006e90: 6473 2074 6f0a 2020 2020 2020 2020 2020  ds to.          
+00006ea0: 2020 7468 6520 6d6f 7374 2d69 6e66 6572    the most-infer
+00006eb0: 696f 7220 706f 696e 7420 286c 6f77 6573  ior point (lowes
+00006ec0: 7420 7a29 3b20 3120 636f 7272 6573 706f  t z); 1 correspo
+00006ed0: 6e64 7320 746f 2074 6865 0a20 2020 2020  nds to the.     
+00006ee0: 2020 2020 2020 206d 6f73 742d 7375 7065         most-supe
+00006ef0: 7269 6f72 2070 6f69 6e74 2028 6869 6768  rior point (high
+00006f00: 6573 7420 7a29 2e20 2056 616c 7565 7320  est z).  Values 
+00006f10: 666f 7220 7a5f 6672 6163 7469 6f6e 0a20  for z_fraction. 
+00006f20: 2020 2020 2020 2020 2020 206f 7574 7369             outsi
+00006f30: 6465 2074 6865 2069 6e74 6572 7661 6c20  de the interval 
+00006f40: 5b30 2c20 315d 2072 6573 756c 7420 696e  [0, 1] result in
+00006f50: 2061 2052 756e 7469 6d65 4572 726f 722e   a RuntimeError.
+00006f60: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
+00006f70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00006f80: 6765 745f 7472 616e 736c 6174 696f 6e5f  get_translation_
+00006f90: 746f 5f61 6c69 676e 280a 2020 2020 2020  to_align(.      
+00006fa0: 2020 2020 2020 2020 2020 7365 6c66 2c20            self, 
+00006fb0: 6f74 6865 722c 207a 5f66 7261 6374 696f  other, z_fractio
+00006fc0: 6e31 2c20 7a5f 6672 6163 7469 6f6e 3229  n1, z_fraction2)
+00006fd0: 0a0a 2020 2020 6465 6620 6765 745f 766f  ..    def get_vo
+00006fe0: 7865 6c5f 7369 7a65 2873 656c 6629 3a0a  xel_size(self):.
+00006ff0: 2020 2020 2020 2020 2222 224c 6f61 6420          """Load 
+00007000: 7365 6c66 2061 6e64 2067 6574 2076 6f78  self and get vox
+00007010: 656c 5f73 697a 652e 2222 220a 0a20 2020  el_size."""..   
+00007020: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
+00007030: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00007040: 7365 6c66 2e76 6f78 656c 5f73 697a 650a  self.voxel_size.
+00007050: 0a20 2020 2064 6566 2067 6574 5f6e 705f  .    def get_np_
+00007060: 766f 7865 6c5f 7369 7a65 2873 656c 662c  voxel_size(self,
+00007070: 2076 6965 773d 4e6f 6e65 293a 0a20 2020   view=None):.   
+00007080: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00007090: 2047 6574 2076 6f78 656c 5f73 697a 6520   Get voxel_size 
+000070a0: 666f 7220 6e75 6d70 7920 6178 6973 206f  for numpy axis o
+000070b0: 7264 6572 696e 6720 616e 6420 7370 6563  rdering and spec
+000070c0: 6966 6965 6420 7669 6577 2e0a 0a20 2020  ified view...   
+000070d0: 2020 2020 2076 6965 7720 3a20 7374 720a       view : str.
+000070e0: 2020 2020 2020 2020 2020 2020 4f72 6965              Orie
+000070f0: 6e74 6174 696f 6e20 636f 6e73 6964 6572  ntation consider
+00007100: 6564 2066 6f72 2032 4420 696d 6167 6520  ed for 2D image 
+00007110: 6f72 2070 726f 6a65 6374 696f 6e2e 0a20  or projection.. 
+00007120: 2020 2020 2020 2020 2020 2043 616e 2062             Can b
+00007130: 6520 2278 2d79 222c 2022 792d 7a22 2c20  e "x-y", "y-z", 
+00007140: 6f72 2022 782d 7a22 2e0a 2020 2020 2020  or "x-z"..      
+00007150: 2020 2222 220a 0a20 2020 2020 2020 2073    """..        s
+00007160: 656c 662e 6c6f 6164 2829 0a20 2020 2020  elf.load().     
+00007170: 2020 2069 6620 7669 6577 2069 7320 4e6f     if view is No
+00007180: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00007190: 7678 2c20 7679 2c20 767a 203d 2073 656c  vx, vy, vz = sel
+000071a0: 662e 766f 7865 6c5f 7369 7a65 0a20 2020  f.voxel_size.   
+000071b0: 2020 2020 2020 2020 2076 6f78 656c 5f73           voxel_s
+000071c0: 697a 6520 3d20 5b76 792c 2076 782c 2076  ize = [vy, vx, v
+000071d0: 7a5d 0a20 2020 2020 2020 2065 6c73 653a  z].        else:
+000071e0: 0a20 2020 2020 2020 2020 2020 2076 6f78  .            vox
+000071f0: 656c 5f73 697a 6520 3d20 5b73 656c 662e  el_size = [self.
+00007200: 766f 7865 6c5f 7369 7a65 5b69 5d0a 2020  voxel_size[i].  
+00007210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007220: 2020 666f 7220 6920 696e 2073 6b72 742e    for i in skrt.
+00007230: 696d 6167 652e 5f70 6c6f 745f 6178 6573  image._plot_axes
+00007240: 5b76 6965 775d 5d0a 0a20 2020 2020 2020  [view]]..       
+00007250: 2072 6574 7572 6e20 766f 7865 6c5f 7369   return voxel_si
+00007260: 7a65 0a0a 2020 2020 6465 6620 6765 745f  ze..    def get_
+00007270: 6f72 6967 696e 2873 656c 6629 3a0a 2020  origin(self):.  
+00007280: 2020 2020 2020 2222 224c 6f61 6420 7365        """Load se
+00007290: 6c66 2061 6e64 2067 6574 206f 7269 6769  lf and get origi
+000072a0: 6e2e 2222 220a 0a20 2020 2020 2020 2073  n."""..        s
+000072b0: 656c 662e 6c6f 6164 2829 0a20 2020 2020  elf.load().     
+000072c0: 2020 2072 6574 7572 6e20 7365 6c66 2e6f     return self.o
+000072d0: 7269 6769 6e0a 0a20 2020 2064 6566 2067  rigin..    def g
+000072e0: 6574 5f6e 616d 6528 7365 6c66 2c20 6f72  et_name(self, or
+000072f0: 6967 696e 616c 3d46 616c 7365 293a 0a20  iginal=False):. 
+00007300: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00007310: 2020 204c 6f61 6420 7365 6c66 2061 6e64     Load self and
+00007320: 2067 6574 206e 616d 652e 2049 6620 3c6f   get name. If <o
+00007330: 7269 6769 6e61 6c3e 2069 7320 5472 7565  riginal> is True
+00007340: 2c20 6765 7420 7468 6520 6f72 6967 696e  , get the origin
+00007350: 616c 206e 616d 652e 0a20 2020 2020 2020  al name..       
+00007360: 2022 2222 0a0a 2020 2020 2020 2020 7365   """..        se
+00007370: 6c66 2e6c 6f61 6428 290a 2020 2020 2020  lf.load().      
+00007380: 2020 7265 7475 726e 2028 7365 6c66 2e6f    return (self.o
+00007390: 7269 6769 6e61 6c5f 6e61 6d65 2069 6620  riginal_name if 
+000073a0: 6f72 6967 696e 616c 2065 6c73 6520 7365  original else se
+000073b0: 6c66 2e6e 616d 6529 0a0a 2020 2020 6465  lf.name)..    de
+000073c0: 6620 6765 745f 6d61 736b 2873 656c 662c  f get_mask(self,
+000073d0: 2076 6965 773d 2278 2d79 222c 2066 6c61   view="x-y", fla
+000073e0: 7474 656e 3d46 616c 7365 2c20 7374 616e  tten=False, stan
+000073f0: 6461 7264 6973 653d 4661 6c73 652c 200a  dardise=False, .
+00007400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007410: 2066 6f72 6365 5f73 7461 6e64 6172 6469   force_standardi
+00007420: 7365 3d46 616c 7365 293a 0a20 2020 2020  se=False):.     
+00007430: 2020 2022 2222 4765 7420 6269 6e61 7279     """Get binary
+00007440: 206d 6173 6b2c 206f 7074 696f 6e61 6c6c   mask, optionall
+00007450: 7920 666c 6174 7465 6e65 6420 696e 2061  y flattened in a
+00007460: 2067 6976 656e 206f 7269 656e 7461 7469   given orientati
+00007470: 6f6e 2e22 2222 0a0a 2020 2020 2020 2020  on."""..        
+00007480: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
+00007490: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
+000074a0: 6d61 736b 2829 0a20 2020 2020 2020 2069  mask().        i
+000074b0: 6620 6e6f 7420 666c 6174 7465 6e3a 0a20  f not flatten:. 
+000074c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000074d0: 6e20 7365 6c66 2e6d 6173 6b2e 6765 745f  n self.mask.get_
+000074e0: 6461 7461 2873 7461 6e64 6172 6469 7365  data(standardise
+000074f0: 3d73 7461 6e64 6172 6469 7365 2c20 0a20  =standardise, . 
+00007500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007520: 2020 2020 2066 6f72 6365 5f73 7461 6e64       force_stand
+00007530: 6172 6469 7365 3d66 6f72 6365 5f73 7461  ardise=force_sta
+00007540: 6e64 6172 6469 7365 290a 2020 2020 2020  ndardise).      
+00007550: 2020 7265 7475 726e 206e 702e 7375 6d28    return np.sum(
+00007560: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007570: 662e 6d61 736b 2e67 6574 5f64 6174 6128  f.mask.get_data(
+00007580: 7374 616e 6461 7264 6973 653d 7374 616e  standardise=stan
+00007590: 6461 7264 6973 652c 200a 2020 2020 2020  dardise, .      
+000075a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075b0: 2020 2020 2020 2020 2066 6f72 6365 5f73           force_s
+000075c0: 7461 6e64 6172 6469 7365 3d66 6f72 6365  tandardise=force
+000075d0: 5f73 7461 6e64 6172 6469 7365 292c 0a20  _standardise),. 
+000075e0: 2020 2020 2020 2020 2020 2061 7869 733d             axis=
+000075f0: 736b 7274 2e69 6d61 6765 2e5f 736c 6963  skrt.image._slic
+00007600: 655f 6178 6573 5b76 6965 775d 0a20 2020  e_axes[view].   
+00007610: 2020 2020 2029 2e61 7374 7970 6528 626f       ).astype(bo
+00007620: 6f6c 290a 0a20 2020 2064 6566 2067 6574  ol)..    def get
+00007630: 5f6d 6173 6b5f 696d 6167 6528 7365 6c66  _mask_image(self
+00007640: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+00007650: 7420 696d 6167 6520 6f62 6a65 6374 2072  t image object r
+00007660: 6570 7265 7365 6e74 696e 6720 524f 4920  epresenting ROI 
+00007670: 6d61 736b 2e22 2222 0a0a 2020 2020 2020  mask."""..      
+00007680: 2020 7365 6c66 2e6c 6f61 6428 290a 2020    self.load().  
+00007690: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
+000076a0: 655f 6d61 736b 2829 0a20 2020 2020 2020  e_mask().       
+000076b0: 2072 6574 7572 6e20 7365 6c66 2e6d 6173   return self.mas
+000076c0: 6b0a 0a20 2020 2064 6566 2067 6574 5f70  k..    def get_p
+000076d0: 6f6c 7967 6f6e 7328 7365 6c66 2c20 7669  olygons(self, vi
+000076e0: 6577 3d22 782d 7922 2c20 6964 785f 6173  ew="x-y", idx_as
+000076f0: 5f6b 6579 3d46 616c 7365 293a 0a20 2020  _key=False):.   
+00007700: 2020 2020 2022 2222 4765 7420 6469 6374       """Get dict
+00007710: 206f 6620 706f 6c79 676f 6e73 2066 6f72   of polygons for
+00007720: 2065 6163 6820 736c 6963 652e 2222 220a   each slice.""".
+00007730: 0a20 2020 2020 2020 2070 6f6c 7967 6f6e  .        polygon
+00007740: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
+00007750: 6f72 2069 2c20 636f 6e74 6f75 7273 2069  or i, contours i
+00007760: 6e20 7365 6c66 2e67 6574 5f63 6f6e 746f  n self.get_conto
+00007770: 7572 7328 7669 6577 2c20 6964 785f 6173  urs(view, idx_as
+00007780: 5f6b 6579 292e 6974 656d 7328 293a 0a20  _key).items():. 
+00007790: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+000077a0: 6f6e 735b 695d 203d 205b 636f 6e74 6f75  ons[i] = [contou
+000077b0: 725f 746f 5f70 6f6c 7967 6f6e 2863 2920  r_to_polygon(c) 
+000077c0: 666f 7220 6320 696e 2063 6f6e 746f 7572  for c in contour
+000077d0: 735d 0a20 2020 2020 2020 2072 6574 7572  s].        retur
+000077e0: 6e20 706f 6c79 676f 6e73 0a0a 2020 2020  n polygons..    
+000077f0: 6465 6620 6765 745f 706f 6c79 676f 6e73  def get_polygons
+00007800: 5f6f 6e5f 736c 6963 6528 7365 6c66 2c20  _on_slice(self, 
+00007810: 7669 6577 3d22 782d 7922 2c20 736c 3d4e  view="x-y", sl=N
+00007820: 6f6e 652c 2069 6478 3d4e 6f6e 652c 2070  one, idx=None, p
+00007830: 6f73 3d4e 6f6e 6529 3a0a 2020 2020 2020  os=None):.      
+00007840: 2020 2222 2247 6574 2073 6861 7065 6c79    """Get shapely
+00007850: 2070 6f6c 7967 6f6e 206f 626a 6563 7473   polygon objects
+00007860: 2063 6f72 7265 7370 6f6e 6469 6e67 2074   corresponding t
+00007870: 6f20 6120 6769 7665 6e20 736c 6963 652e  o a given slice.
+00007880: 2222 220a 0a20 2020 2020 2020 2063 6f6e  """..        con
+00007890: 746f 7572 7320 3d20 7365 6c66 2e67 6574  tours = self.get
+000078a0: 5f63 6f6e 746f 7572 735f 6f6e 5f73 6c69  _contours_on_sli
+000078b0: 6365 2876 6965 772c 2073 6c2c 2069 6478  ce(view, sl, idx
+000078c0: 2c20 706f 7329 0a20 2020 2020 2020 2072  , pos).        r
+000078d0: 6574 7572 6e20 5b63 6f6e 746f 7572 5f74  eturn [contour_t
+000078e0: 6f5f 706f 6c79 676f 6e28 6329 2066 6f72  o_polygon(c) for
+000078f0: 2063 2069 6e20 636f 6e74 6f75 7273 5d0a   c in contours].
+00007900: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
+00007910: 636f 6e74 6f75 7273 2873 656c 662c 2076  contours(self, v
+00007920: 6965 773d 2261 6c6c 222c 2066 6f72 6365  iew="all", force
+00007930: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+00007940: 2022 2222 4372 6561 7465 2063 6f6e 746f   """Create conto
+00007950: 7572 7320 696e 2061 6c6c 206f 7269 656e  urs in all orien
+00007960: 7461 7469 6f6e 732e 2222 220a 0a20 2020  tations."""..   
+00007970: 2020 2020 2069 6620 6e6f 7420 666f 7263       if not forc
+00007980: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+00007990: 6620 7669 6577 203d 3d20 2261 6c6c 2220  f view == "all" 
+000079a0: 616e 6420 616c 6c28 5b76 2069 6e20 7365  and all([v in se
+000079b0: 6c66 2e63 6f6e 746f 7572 7320 666f 7220  lf.contours for 
+000079c0: 7620 696e 200a 2020 2020 2020 2020 2020  v in .          
+000079d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000079e0: 2020 2020 2020 2020 2020 2020 736b 7274              skrt
+000079f0: 2e69 6d61 6765 2e5f 706c 6f74 5f61 7865  .image._plot_axe
+00007a00: 735d 293a 0a20 2020 2020 2020 2020 2020  s]):.           
+00007a10: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00007a20: 2020 2020 2020 2020 6966 2076 6965 7720          if view 
+00007a30: 696e 2073 656c 662e 636f 6e74 6f75 7273  in self.contours
+00007a40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007a50: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+00007a60: 2020 6966 206e 6f74 2073 656c 662e 6c6f    if not self.lo
+00007a70: 6164 6564 3a0a 2020 2020 2020 2020 2020  aded:.          
+00007a80: 2020 7365 6c66 2e6c 6f61 6428 290a 0a20    self.load().. 
+00007a90: 2020 2020 2020 2073 656c 662e 6372 6561         self.crea
+00007aa0: 7465 5f6d 6173 6b28 290a 2020 2020 2020  te_mask().      
+00007ab0: 2020 6966 2066 6f72 6365 3a0a 2020 2020    if force:.    
+00007ac0: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
+00007ad0: 746f 7572 7320 3d20 7b7d 0a0a 2020 2020  tours = {}..    
+00007ae0: 2020 2020 2320 4372 6561 7465 2063 6f6e      # Create con
+00007af0: 746f 7572 7320 696e 2065 7665 7279 206f  tours in every o
+00007b00: 7269 656e 7461 7469 6f6e 0a20 2020 2020  rientation.     
+00007b10: 2020 2076 6965 7773 203d 206c 6973 7428     views = list(
+00007b20: 736b 7274 2e69 6d61 6765 2e5f 706c 6f74  skrt.image._plot
+00007b30: 5f61 7865 732e 6b65 7973 2829 2920 6966  _axes.keys()) if
+00007b40: 2076 6965 7720 3d3d 2022 616c 6c22 2065   view == "all" e
+00007b50: 6c73 6520 5b76 6965 775d 0a20 2020 2020  lse [view].     
+00007b60: 2020 2066 6f72 2076 2069 6e20 7669 6577     for v in view
+00007b70: 733a 0a0a 2020 2020 2020 2020 2020 2020  s:..            
+00007b80: 6966 2076 2069 6e20 7365 6c66 2e63 6f6e  if v in self.con
+00007b90: 746f 7572 733a 0a20 2020 2020 2020 2020  tours:.         
+00007ba0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00007bb0: 0a20 2020 2020 2020 2020 2020 2023 204d  .            # M
+00007bc0: 616b 6520 6e65 7720 636f 6e74 6f75 7273  ake new contours
+00007bd0: 2066 726f 6d20 6d61 736b 0a20 2020 2020   from mask.     
+00007be0: 2020 2020 2020 207a 5f61 7820 3d20 736b         z_ax = sk
+00007bf0: 7274 2e69 6d61 6765 2e5f 736c 6963 655f  rt.image._slice_
+00007c00: 6178 6573 5b76 5d0a 2020 2020 2020 2020  axes[v].        
+00007c10: 2020 2020 7365 6c66 2e63 6f6e 746f 7572      self.contour
+00007c20: 735b 765d 203d 207b 7d0a 2020 2020 2020  s[v] = {}.      
+00007c30: 2020 2020 2020 666f 7220 697a 2069 6e20        for iz in 
+00007c40: 7365 6c66 2e67 6574 5f69 6e64 6963 6573  self.get_indices
+00007c50: 2876 2c20 6d65 7468 6f64 3d22 6d61 736b  (v, method="mask
+00007c60: 2229 3a0a 0a20 2020 2020 2020 2020 2020  "):..           
+00007c70: 2020 2020 2023 2047 6574 2073 6c69 6365       # Get slice
+00007c80: 206f 6620 6d61 736b 2061 7272 6179 0a20   of mask array. 
+00007c90: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00007ca0: 6173 6b5f 736c 6963 6520 3d20 7365 6c66  ask_slice = self
+00007cb0: 2e67 6574 5f73 6c69 6365 2876 2c20 6964  .get_slice(v, id
+00007cc0: 783d 697a 292e 540a 2020 2020 2020 2020  x=iz).T.        
+00007cd0: 2020 2020 2020 2020 6966 206d 6173 6b5f          if mask_
+00007ce0: 736c 6963 652e 6d61 7828 2920 3c20 302e  slice.max() < 0.
+00007cf0: 353a 0a20 2020 2020 2020 2020 2020 2020  5:.             
+00007d00: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00007d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007d20: 2070 6f69 6e74 7320 3d20 7365 6c66 2e6d   points = self.m
+00007d30: 6173 6b5f 746f 5f63 6f6e 746f 7572 7328  ask_to_contours(
+00007d40: 6d61 736b 5f73 6c69 6365 2c20 7629 0a20  mask_slice, v). 
+00007d50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00007d60: 6620 706f 696e 7473 3a0a 2020 2020 2020  f points:.      
+00007d70: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00007d80: 6c66 2e63 6f6e 746f 7572 735b 765d 5b73  lf.contours[v][s
+00007d90: 656c 662e 6964 785f 746f 5f70 6f73 2869  elf.idx_to_pos(i
+00007da0: 7a2c 207a 5f61 7829 5d20 3d20 706f 696e  z, z_ax)] = poin
+00007db0: 7473 0a0a 2020 2020 6465 6620 6d61 736b  ts..    def mask
+00007dc0: 5f74 6f5f 636f 6e74 6f75 7273 2873 656c  _to_contours(sel
+00007dd0: 662c 206d 6173 6b2c 2076 6965 772c 2069  f, mask, view, i
+00007de0: 6e76 6572 743d 4661 6c73 6529 3a0a 2020  nvert=False):.  
+00007df0: 2020 2020 2020 2222 2243 7265 6174 6520        """Create 
+00007e00: 636f 6e74 6f75 7273 2066 726f 6d20 6120  contours from a 
+00007e10: 6d61 736b 2e22 2222 0a0a 2020 2020 2020  mask."""..      
+00007e20: 2020 636f 6e74 6f75 7273 203d 2073 6b69    contours = ski
+00007e30: 6d61 6765 2e6d 6561 7375 7265 2e66 696e  mage.measure.fin
+00007e40: 645f 636f 6e74 6f75 7273 286d 6173 6b2c  d_contours(mask,
+00007e50: 2030 2e35 2c20 226c 6f77 222c 2022 6c6f   0.5, "low", "lo
+00007e60: 7722 290a 0a20 2020 2020 2020 2023 2043  w")..        # C
+00007e70: 6f6e 7665 7274 2069 6e64 6963 6573 2074  onvert indices t
+00007e80: 6f20 706f 7369 7469 6f6e 7320 696e 206d  o positions in m
+00007e90: 6d0a 2020 2020 2020 2020 785f 6178 2c20  m.        x_ax, 
+00007ea0: 795f 6178 203d 2073 6b72 742e 696d 6167  y_ax = skrt.imag
+00007eb0: 652e 5f70 6c6f 745f 6178 6573 5b76 6965  e._plot_axes[vie
+00007ec0: 775d 0a20 2020 2020 2020 2070 6f69 6e74  w].        point
+00007ed0: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
+00007ee0: 6f72 2063 6f6e 746f 7572 2069 6e20 636f  or contour in co
+00007ef0: 6e74 6f75 7273 3a0a 2020 2020 2020 2020  ntours:.        
+00007f00: 2020 2020 636f 6e74 6f75 725f 706f 696e      contour_poin
+00007f10: 7473 203d 205b 5d0a 2020 2020 2020 2020  ts = [].        
+00007f20: 2020 2020 666f 7220 6978 2c20 6979 2069      for ix, iy i
+00007f30: 6e20 636f 6e74 6f75 723a 0a20 2020 2020  n contour:.     
+00007f40: 2020 2020 2020 2020 2020 2070 7820 3d20             px = 
+00007f50: 7365 6c66 2e69 6478 5f74 6f5f 706f 7328  self.idx_to_pos(
+00007f60: 6978 2c20 785f 6178 290a 2020 2020 2020  ix, x_ax).      
+00007f70: 2020 2020 2020 2020 2020 7079 203d 2073            py = s
+00007f80: 656c 662e 6964 785f 746f 5f70 6f73 2869  elf.idx_to_pos(i
+00007f90: 792c 2079 5f61 7829 0a20 2020 2020 2020  y, y_ax).       
+00007fa0: 2020 2020 2020 2020 2069 6620 696e 7665           if inve
+00007fb0: 7274 3a0a 2020 2020 2020 2020 2020 2020  rt:.            
+00007fc0: 2020 2020 2020 2020 7078 2c20 7079 203d          px, py =
+00007fd0: 2070 792c 2070 780a 2020 2020 2020 2020   py, px.        
+00007fe0: 2020 2020 2020 2020 636f 6e74 6f75 725f          contour_
+00007ff0: 706f 696e 7473 2e61 7070 656e 6428 5b70  points.append([p
+00008000: 782c 2070 795d 290a 2020 2020 2020 2020  x, py]).        
+00008010: 2020 2020 706f 696e 7473 2e61 7070 656e      points.appen
+00008020: 6428 6e70 2e61 7272 6179 2863 6f6e 746f  d(np.array(conto
+00008030: 7572 5f70 6f69 6e74 7329 290a 0a20 2020  ur_points))..   
+00008040: 2020 2020 2072 6574 7572 6e20 706f 696e       return poin
+00008050: 7473 0a0a 2020 2020 6465 6620 6372 6561  ts..    def crea
+00008060: 7465 5f6d 6173 6b28 0a20 2020 2020 2020  te_mask(.       
+00008070: 2073 656c 662c 200a 2020 2020 2020 2020   self, .        
+00008080: 666f 7263 653d 4661 6c73 652c 200a 2020  force=False, .  
+00008090: 2020 2020 2020 6f76 6572 6c61 705f 6c65        overlap_le
+000080a0: 7665 6c3d 4e6f 6e65 2c20 0a20 2020 2020  vel=None, .     
+000080b0: 2020 2076 6f78 656c 5f73 697a 653d 4e6f     voxel_size=No
+000080c0: 6e65 2c20 0a20 2020 2020 2020 2073 6861  ne, .        sha
+000080d0: 7065 3d4e 6f6e 650a 2020 2020 293a 0a20  pe=None.    ):. 
+000080e0: 2020 2020 2020 2022 2222 4372 6561 7465         """Create
+000080f0: 2062 696e 6172 7920 6d61 736b 2072 6570   binary mask rep
+00008100: 7265 7365 6e74 6174 696f 6e20 6f66 2074  resentation of t
+00008110: 6869 7320 524f 492e 2049 6620 7468 6520  his ROI. If the 
+00008120: 524f 4920 7761 7320 6372 6561 7465 640a  ROI was created.
+00008130: 2020 2020 2020 2020 6672 6f6d 2063 6f6e          from con
+00008140: 746f 7572 732c 2074 6865 7365 2063 6f6e  tours, these con
+00008150: 746f 7572 7320 7769 6c6c 2062 6520 636f  tours will be co
+00008160: 6e76 6572 7465 6420 746f 2061 206d 6173  nverted to a mas
+00008170: 6b3b 2069 6620 7468 6520 524f 490a 2020  k; if the ROI.  
+00008180: 2020 2020 2020 7761 7320 6372 6561 7465        was create
+00008190: 6420 6672 6f6d 2061 206d 6173 6b2c 2074  d from a mask, t
+000081a0: 6869 7320 6d61 736b 2077 696c 6c20 6265  his mask will be
+000081b0: 2063 6173 7420 746f 2061 2062 6f6f 6c65   cast to a boole
+000081c0: 616e 2061 7272 6179 2061 6e64 0a20 2020  an array and.   
+000081d0: 2020 2020 2069 7473 2067 656f 656d 7472       its geoemtr
+000081e0: 6963 2070 726f 7065 7274 6965 7320 7769  ic properties wi
+000081f0: 6c6c 2062 6520 6173 7369 676e 6564 2074  ll be assigned t
+00008200: 6f20 7468 6973 2052 4f49 2e20 4966 2061  o this ROI. If a
+00008210: 206d 6173 6b20 6861 7320 0a20 2020 2020   mask has .     
+00008220: 2020 2061 6c72 6561 6479 2062 6565 6e20     already been 
+00008230: 6372 6561 7465 642c 206e 6f74 6869 6e67  created, nothing
+00008240: 2077 696c 6c20 6861 7070 656e 2075 6e6c   will happen unl
+00008250: 6573 7320 666f 7263 653d 5472 7565 2e0a  ess force=True..
+00008260: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
+00008270: 6574 6572 733a 2a2a 0a20 2020 2020 2020  eters:**.       
+00008280: 200a 2020 2020 2020 2020 666f 7263 6520   .        force 
+00008290: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
+000082a0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+000082b0: 2020 4966 2054 7275 652c 2074 6865 206d    If True, the m
+000082c0: 6173 6b20 7769 6c6c 2062 6520 7265 6372  ask will be recr
+000082d0: 6561 7465 6420 6576 656e 2069 6620 6974  eated even if it
+000082e0: 2061 6c72 6561 6479 2065 7869 7374 732e   already exists.
+000082f0: 0a0a 2020 2020 2020 2020 6f76 6572 6c61  ..        overla
+00008300: 705f 6c65 7665 6c20 3a20 666c 6f61 742c  p_level : float,
+00008310: 2064 6566 6175 6c74 3d30 2e32 350a 2020   default=0.25.  
+00008320: 2020 2020 2020 2020 2020 5265 7175 6972            Requir
+00008330: 6564 206f 7665 726c 6170 206f 6620 6120  ed overlap of a 
+00008340: 7069 7865 6c20 7769 7468 2074 6865 2052  pixel with the R
+00008350: 4f49 2063 6f6e 746f 7572 2069 6e20 6f72  OI contour in or
+00008360: 6465 7220 666f 7220 7468 6520 0a20 2020  der for the .   
+00008370: 2020 2020 2020 2020 2070 6978 656c 2074           pixel t
+00008380: 6f20 6265 2061 6464 6564 2074 6f20 7468  o be added to th
+00008390: 6520 6d61 736b 2e20 4966 204e 6f6e 652c  e mask. If None,
+000083a0: 2074 6865 2076 616c 7565 206f 660a 2020   the value of.  
+000083b0: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
+000083c0: 7665 726c 6170 5f6c 6576 656c 2077 696c  verlap_level wil
+000083d0: 6c20 6265 2075 7365 643b 206f 7468 6572  l be used; other
+000083e0: 7769 7365 2c0a 2020 2020 2020 2020 2020  wise,.          
+000083f0: 2020 7365 6c66 2e6f 7665 726c 6170 5f6c    self.overlap_l
+00008400: 6576 656c 2077 696c 6c20 6265 206f 7665  evel will be ove
+00008410: 7277 7269 7474 656e 2077 6974 6820 7468  rwritten with th
+00008420: 6973 2076 616c 7565 2e20 4966 2062 6f74  is value. If bot
+00008430: 6820 6172 6520 0a20 2020 2020 2020 2020  h are .         
+00008440: 2020 204e 6f6e 652c 2074 6865 206f 7574     None, the out
+00008450: 7075 7420 6f66 2073 6b69 6d61 6765 2e64  put of skimage.d
+00008460: 7261 772e 706f 6c79 676f 6e32 6d61 736b  raw.polygon2mask
+00008470: 2077 696c 6c20 6265 2072 6574 7572 6e65   will be returne
+00008480: 6420 0a20 2020 2020 2020 2020 2020 2077  d .            w
+00008490: 6974 6820 6e6f 2062 6f72 6465 7220 6368  ith no border ch
+000084a0: 6563 6b73 2c20 7768 6963 6820 6973 2066  ecks, which is f
+000084b0: 6173 7465 7220 7468 616e 2070 6572 666f  aster than perfo
+000084c0: 726d 696e 6720 626f 7264 6572 2063 6865  rming border che
+000084d0: 636b 732e 0a0a 2020 2020 2020 2020 766f  cks...        vo
+000084e0: 7865 6c5f 7369 7a65 203a 206c 6973 742c  xel_size : list,
+000084f0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00008500: 2020 2020 2020 2020 2020 566f 7865 6c20            Voxel 
+00008510: 7369 7a65 7320 6f66 2074 6865 2064 6573  sizes of the des
+00008520: 6972 6564 206d 6173 6b20 696e 2074 6865  ired mask in the
+00008530: 205b 782c 2079 5d20 6469 7265 6374 696f   [x, y] directio
+00008540: 6e2e 204f 6e6c 7920 7573 6564 2069 6620  n. Only used if 
+00008550: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00008560: 2052 4f49 2077 6173 2063 7265 6174 6564   ROI was created
+00008570: 2066 726f 6d20 636f 6e74 6f75 7273 3b20   from contours; 
+00008580: 6967 6e6f 7265 6420 6966 2052 4f49 2077  ignored if ROI w
+00008590: 6173 2063 7265 6174 6564 2066 726f 6d20  as created from 
+000085a0: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
+000085b0: 6b2e 2043 6175 7365 7320 7365 6c66 2e69  k. Causes self.i
+000085c0: 6d61 6765 2074 6f20 6265 2072 6570 6c61  mage to be repla
+000085d0: 6365 6420 7769 7468 2061 200a 2020 2020  ced with a .    
+000085e0: 2020 2020 2020 2020 626c 616e 6b20 6475          blank du
+000085f0: 6d6d 7920 696d 6167 6520 7769 7468 2074  mmy image with t
+00008600: 6865 7365 2076 6f78 656c 2073 697a 6573  hese voxel sizes
+00008610: 2e0a 0a20 2020 2020 2020 2073 6861 7065  ...        shape
+00008620: 203a 206c 6973 742c 2064 6566 6175 6c74   : list, default
+00008630: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+00008640: 2020 5368 6170 6520 6f66 2074 6865 2064    Shape of the d
+00008650: 6573 6972 6564 206d 6173 6b20 696e 2074  esired mask in t
+00008660: 6865 205b 782c 2079 5d20 6469 7265 6374  he [x, y] direct
+00008670: 696f 6e2e 204f 6e6c 7920 7573 6564 2069  ion. Only used i
+00008680: 6620 0a20 2020 2020 2020 2020 2020 203c  f .            <
+00008690: 766f 7865 6c5f 7369 7a65 3e20 6973 204e  voxel_size> is N
+000086a0: 6f6e 6520 616e 6420 7468 6520 524f 4920  one and the ROI 
+000086b0: 7761 7320 6372 6561 7465 6420 6672 6f6d  was created from
+000086c0: 2063 6f6e 746f 7572 733b 200a 2020 2020   contours; .    
+000086d0: 2020 2020 2020 2020 6967 6e6f 7265 6420          ignored 
+000086e0: 6966 2052 4f49 2077 6173 2063 7265 6174  if ROI was creat
+000086f0: 6564 2066 726f 6d20 6d61 736b 2e20 4361  ed from mask. Ca
+00008700: 7573 6573 2073 656c 662e 696d 6167 6520  uses self.image 
+00008710: 746f 2062 6520 0a20 2020 2020 2020 2020  to be .         
+00008720: 2020 2072 6570 6c61 6365 6420 7769 7468     replaced with
+00008730: 2061 2062 6c61 6e6b 2064 756d 6d79 2069   a blank dummy i
+00008740: 6d61 6765 206f 6620 7468 6973 2073 6861  mage of this sha
+00008750: 7065 2e0a 2020 2020 2020 2020 2222 220a  pe..        """.
+00008760: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00008770: 2e6c 6f61 6465 645f 6d61 736b 2061 6e64  .loaded_mask and
+00008780: 206e 6f74 2066 6f72 6365 3a0a 2020 2020   not force:.    
+00008790: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+000087a0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+000087b0: 656c 662e 6c6f 6164 6564 3a0a 2020 2020  elf.loaded:.    
+000087c0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+000087d0: 6428 290a 2020 2020 2020 2020 6966 206f  d().        if o
+000087e0: 7665 726c 6170 5f6c 6576 656c 2069 7320  verlap_level is 
+000087f0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00008800: 2020 2020 2020 7365 6c66 2e6f 7665 726c        self.overl
+00008810: 6170 5f6c 6576 656c 203d 206f 7665 726c  ap_level = overl
+00008820: 6170 5f6c 6576 656c 0a0a 2020 2020 2020  ap_level..      
+00008830: 2020 2320 5365 7420 696d 6167 6520 746f    # Set image to
+00008840: 2064 756d 6d79 2069 6d61 6765 2069 6620   dummy image if 
+00008850: 6e65 6564 6564 0a20 2020 2020 2020 2069  needed.        i
+00008860: 6620 2866 6f72 6365 2061 6e64 2028 7368  f (force and (sh
+00008870: 6170 6520 6973 206e 6f74 204e 6f6e 6520  ape is not None 
+00008880: 6f72 2076 6f78 656c 5f73 697a 6520 6973  or voxel_size is
+00008890: 206e 6f74 204e 6f6e 6529 2920 5c0a 2020   not None)) \.  
+000088a0: 2020 2020 2020 2020 206f 7220 2873 656c           or (sel
+000088b0: 662e 636f 6e74 6f75 7273 5f6f 6e6c 7920  f.contours_only 
+000088c0: 616e 6420 7365 6c66 2e69 6d61 6765 2069  and self.image i
+000088d0: 7320 4e6f 6e65 293a 0a20 2020 2020 2020  s None):.       
+000088e0: 2020 2020 2073 656c 662e 7365 745f 696d       self.set_im
+000088f0: 6167 655f 746f 5f64 756d 6d79 2873 6861  age_to_dummy(sha
+00008900: 7065 3d73 6861 7065 2c20 766f 7865 6c5f  pe=shape, voxel_
+00008910: 7369 7a65 3d76 6f78 656c 5f73 697a 6529  size=voxel_size)
+00008920: 0a0a 2020 2020 2020 2020 2320 4372 6561  ..        # Crea
+00008930: 7465 206d 6173 6b20 6672 6f6d 2069 6e70  te mask from inp
+00008940: 7574 2078 2d79 2063 6f6e 746f 7572 7320  ut x-y contours 
+00008950: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00008960: 2e69 6e70 7574 5f63 6f6e 746f 7572 733a  .input_contours:
+00008970: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00008980: 496e 6974 6961 6c69 7365 2073 656c 662e  Initialise self.
+00008990: 6d61 736b 2061 7320 696d 6167 650a 2020  mask as image.  
+000089a0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+000089b0: 6173 6b20 3d20 736b 7274 2e69 6d61 6765  ask = skrt.image
+000089c0: 2e49 6d61 6765 280a 2020 2020 2020 2020  .Image(.        
+000089d0: 2020 2020 2020 2020 6e70 2e7a 6572 6f73          np.zeros
+000089e0: 2828 7365 6c66 2e73 6861 7065 5b31 5d2c  ((self.shape[1],
+000089f0: 2073 656c 662e 7368 6170 655b 305d 2c20   self.shape[0], 
+00008a00: 7365 6c66 2e73 6861 7065 5b32 5d29 2c0a  self.shape[2]),.
+00008a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008a20: 2020 2020 6474 7970 653d 626f 6f6c 292c      dtype=bool),
+00008a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008a40: 2061 6666 696e 653d 7365 6c66 2e61 6666   affine=self.aff
+00008a50: 696e 652c 200a 2020 2020 2020 2020 2020  ine, .          
+00008a60: 2020 2020 2020 766f 7865 6c5f 7369 7a65        voxel_size
+00008a70: 3d73 656c 662e 766f 7865 6c5f 7369 7a65  =self.voxel_size
+00008a80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00008a90: 2020 6f72 6967 696e 3d73 656c 662e 6f72    origin=self.or
+00008aa0: 6967 696e 0a20 2020 2020 2020 2020 2020  igin.           
+00008ab0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+00008ac0: 2320 4372 6561 7465 206d 6173 6b20 6f6e  # Create mask on
+00008ad0: 2065 6163 6820 7a20 6c61 7965 720a 2020   each z layer.  
+00008ae0: 2020 2020 2020 2020 2020 666f 7220 7a2c            for z,
+00008af0: 2063 6f6e 746f 7572 7320 696e 2073 656c   contours in sel
+00008b00: 662e 696e 7075 745f 636f 6e74 6f75 7273  f.input_contours
+00008b10: 2e69 7465 6d73 2829 3a0a 0a20 2020 2020  .items():..     
+00008b20: 2020 2020 2020 2020 2020 2023 204c 6f6f             # Loo
+00008b30: 7020 6f76 6572 2065 6163 6820 636f 6e74  p over each cont
+00008b40: 6f75 7220 6f6e 2074 6865 207a 2073 6c69  our on the z sli
+00008b50: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
+00008b60: 2020 2069 7a20 3d20 696e 7428 7365 6c66     iz = int(self
+00008b70: 2e70 6f73 5f74 6f5f 6964 7828 7a2c 2022  .pos_to_idx(z, "
+00008b80: 7a22 2929 0a20 2020 2020 2020 2020 2020  z")).           
+00008b90: 2020 2020 2069 6620 697a 203e 3d20 7365       if iz >= se
+00008ba0: 6c66 2e6d 6173 6b2e 6461 7461 2e73 6861  lf.mask.data.sha
+00008bb0: 7065 5b32 5d3a 2020 2320 4967 6e6f 7265  pe[2]:  # Ignore
+00008bc0: 2073 6c69 6365 7320 6f75 7473 6964 6520   slices outside 
+00008bd0: 6d61 736b 2072 616e 6765 0a20 2020 2020  mask range.     
+00008be0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00008bf0: 6f6e 7469 6e75 650a 0a20 2020 2020 2020  ontinue..       
+00008c00: 2020 2020 2020 2020 2070 6f73 5f74 6f5f           pos_to_
+00008c10: 6964 785f 7665 6320 3d20 6e70 2e76 6563  idx_vec = np.vec
+00008c20: 746f 7269 7a65 2873 656c 662e 706f 735f  torize(self.pos_
+00008c30: 746f 5f69 6478 290a 2020 2020 2020 2020  to_idx).        
+00008c40: 2020 2020 2020 2020 666f 7220 706f 696e          for poin
+00008c50: 7473 2069 6e20 636f 6e74 6f75 7273 3a0a  ts in contours:.
+00008c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008c70: 2020 2020 2023 2052 6571 7569 7265 2061       # Require a
+00008c80: 7420 6c65 6173 7420 3320 706f 696e 7473  t least 3 points
+00008c90: 2074 6f20 6465 6669 6e65 2061 2070 6f6c   to define a pol
+00008ca0: 7967 6f6e 2e0a 2020 2020 2020 2020 2020  ygon..          
+00008cb0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00008cc0: 2870 6f69 6e74 7329 203c 2033 3a0a 2020  (points) < 3:.  
+00008cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ce0: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
+00008cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008d00: 2020 2020 2320 436f 6e76 6572 7420 2878      # Convert (x
+00008d10: 2c20 7929 2070 6f73 6974 696f 6e73 2074  , y) positions t
+00008d20: 6f20 6172 7261 7920 696e 6469 6365 730a  o array indices.
+00008d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008d40: 2020 2020 706f 696e 7473 5f69 6478 203d      points_idx =
+00008d50: 206e 702e 7a65 726f 7328 2870 6f69 6e74   np.zeros((point
+00008d60: 732e 7368 6170 655b 305d 2c20 3229 290a  s.shape[0], 2)).
+00008d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008d80: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+00008d90: 6765 2832 293a 0a20 2020 2020 2020 2020  ge(2):.         
+00008da0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00008db0: 6f69 6e74 735f 6964 785b 3a2c 2069 5d20  oints_idx[:, i] 
+00008dc0: 3d20 706f 735f 746f 5f69 6478 5f76 6563  = pos_to_idx_vec
+00008dd0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00008de0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00008df0: 696e 7473 5b3a 2c20 695d 2c20 692c 2072  ints[:, i], i, r
+00008e00: 6574 7572 6e5f 696e 743d 4661 6c73 650a  eturn_int=False.
+00008e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008e20: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00008e30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00008e40: 2043 7265 6174 6520 706f 6c79 676f 6e20   Create polygon 
+00008e50: 696e 2069 6e64 6578 2073 7061 6365 0a20  in index space. 
+00008e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008e70: 2020 2070 6f6c 7967 6f6e 203d 2063 6f6e     polygon = con
+00008e80: 746f 7572 5f74 6f5f 706f 6c79 676f 6e28  tour_to_polygon(
+00008e90: 706f 696e 7473 5f69 6478 290a 0a20 2020  points_idx)..   
+00008ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008eb0: 2023 2047 6574 206d 6173 6b20 6f66 2061   # Get mask of a
+00008ec0: 6c6c 2070 6978 656c 7320 696e 7369 6465  ll pixels inside
+00008ed0: 2063 6f6e 746f 7572 0a20 2020 2020 2020   contour.       
+00008ee0: 2020 2020 2020 2020 2020 2020 206d 6173               mas
+00008ef0: 6b20 3d20 6472 6177 2e70 6f6c 7967 6f6e  k = draw.polygon
+00008f00: 326d 6173 6b28 5b73 656c 662e 6d61 736b  2mask([self.mask
+00008f10: 2e64 6174 612e 7368 6170 655b 315d 2c20  .data.shape[1], 
+00008f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00008f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f40: 2020 2020 2020 2020 2020 2020 2070 6f69               poi
-00008f50: 6e74 735f 6964 7829 0a0a 2020 2020 2020  nts_idx)..      
-00008f60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00008f70: 4966 206e 6f20 7069 7865 6c20 6964 656e  If no pixel iden
-00008f80: 7469 6669 6564 2061 7320 6265 696e 6720  tified as being 
-00008f90: 696e 7369 6465 2063 6f6e 746f 7572 2c0a  inside contour,.
-00008fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008fb0: 2020 2020 2320 6c61 6265 6c20 7069 7865      # label pixe
-00008fc0: 6c20 636f 6e74 6169 6e69 6e67 2063 6f6e  l containing con
-00008fd0: 746f 7572 2063 656e 7472 6f69 642e 0a20  tour centroid.. 
-00008fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ff0: 2020 2069 6620 6e6f 7420 6d61 736b 2e73     if not mask.s
-00009000: 756d 2829 3a0a 2020 2020 2020 2020 2020  um():.          
-00009010: 2020 2020 2020 2020 2020 2020 2020 6978                ix
-00009020: 2c20 6979 203d 205b 696e 7428 726f 756e  , iy = [int(roun
-00009030: 6428 7879 5b30 5d29 290a 2020 2020 2020  d(xy[0])).      
-00009040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009050: 2020 2020 2020 2020 2020 666f 7220 7879            for xy
-00009060: 2069 6e20 706f 6c79 676f 6e2e 6365 6e74   in polygon.cent
-00009070: 726f 6964 2e78 795d 0a20 2020 2020 2020  roid.xy].       
-00009080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009090: 2069 6620 2828 6978 203e 3d20 3020 616e   if ((ix >= 0 an
-000090a0: 6420 6978 203c 206d 6173 6b2e 7368 6170  d ix < mask.shap
-000090b0: 655b 305d 290a 2020 2020 2020 2020 2020  e[0]).          
-000090c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000090d0: 2020 2020 2020 616e 6420 2869 7920 3e3d        and (iy >=
-000090e0: 2030 2061 6e64 2069 7920 3c20 6d61 736b   0 and iy < mask
-000090f0: 2e73 6861 7065 5b31 5d29 293a 0a20 2020  .shape[1])):.   
+00008f40: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00008f50: 6c66 2e6d 6173 6b2e 6461 7461 2e73 6861  lf.mask.data.sha
+00008f60: 7065 5b30 5d5d 2c0a 2020 2020 2020 2020  pe[0]],.        
+00008f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f90: 2020 2020 2070 6f69 6e74 735f 6964 7829       points_idx)
+00008fa0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008fb0: 2020 2020 2020 2320 4966 206e 6f20 7069        # If no pi
+00008fc0: 7865 6c20 6964 656e 7469 6669 6564 2061  xel identified a
+00008fd0: 7320 6265 696e 6720 696e 7369 6465 2063  s being inside c
+00008fe0: 6f6e 746f 7572 2c0a 2020 2020 2020 2020  ontour,.        
+00008ff0: 2020 2020 2020 2020 2020 2020 2320 6c61              # la
+00009000: 6265 6c20 7069 7865 6c20 636f 6e74 6169  bel pixel contai
+00009010: 6e69 6e67 2063 6f6e 746f 7572 2063 656e  ning contour cen
+00009020: 7472 6f69 642e 0a20 2020 2020 2020 2020  troid..         
+00009030: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00009040: 7420 6d61 736b 2e73 756d 2829 3a0a 2020  t mask.sum():.  
+00009050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009060: 2020 2020 2020 6978 2c20 6979 203d 205b        ix, iy = [
+00009070: 696e 7428 726f 756e 6428 7879 5b30 5d29  int(round(xy[0])
+00009080: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00009090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000090a0: 2020 666f 7220 7879 2069 6e20 706f 6c79    for xy in poly
+000090b0: 676f 6e2e 6365 6e74 726f 6964 2e78 795d  gon.centroid.xy]
+000090c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000090d0: 2020 2020 2020 2020 2069 6620 2828 6978           if ((ix
+000090e0: 203e 3d20 3020 616e 6420 6978 203c 206d   >= 0 and ix < m
+000090f0: 6173 6b2e 7368 6170 655b 305d 290a 2020  ask.shape[0]).  
 00009100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009110: 2020 2020 2020 2020 206d 6173 6b5b 6978           mask[ix
-00009120: 2c20 6979 5d20 3d20 5472 7565 0a0a 2020  , iy] = True..  
-00009130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009140: 2020 2320 4368 6563 6b20 6f76 6572 6c61    # Check overla
-00009150: 7020 6f66 2065 6467 6520 7069 7865 6c73  p of edge pixels
-00009160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009170: 2020 2020 2069 6620 7365 6c66 2e6f 7665       if self.ove
-00009180: 726c 6170 5f6c 6576 656c 2069 7320 6e6f  rlap_level is no
-00009190: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-000091a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000091b0: 636f 6e6e 203d 206e 6469 6d61 6765 2e67  conn = ndimage.g
-000091c0: 656e 6572 6174 655f 6269 6e61 7279 5f73  enerate_binary_s
-000091d0: 7472 7563 7475 7265 280a 2020 2020 2020  tructure(.      
+00009110: 2020 2020 2020 2020 2020 2020 2020 616e                an
+00009120: 6420 2869 7920 3e3d 2030 2061 6e64 2069  d (iy >= 0 and i
+00009130: 7920 3c20 6d61 736b 2e73 6861 7065 5b31  y < mask.shape[1
+00009140: 5d29 293a 0a20 2020 2020 2020 2020 2020  ])):.           
+00009150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009160: 206d 6173 6b5b 6978 2c20 6979 5d20 3d20   mask[ix, iy] = 
+00009170: 5472 7565 0a0a 2020 2020 2020 2020 2020  True..          
+00009180: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
+00009190: 6b20 6f76 6572 6c61 7020 6f66 2065 6467  k overlap of edg
+000091a0: 6520 7069 7865 6c73 0a20 2020 2020 2020  e pixels.       
+000091b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000091c0: 7365 6c66 2e6f 7665 726c 6170 5f6c 6576  self.overlap_lev
+000091d0: 656c 2069 7320 6e6f 7420 4e6f 6e65 3a0a  el is not None:.
 000091e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000091f0: 2020 2020 2020 322c 2032 290a 2020 2020        2, 2).    
-00009200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009210: 2020 2020 6564 6765 203d 206d 6173 6b20      edge = mask 
-00009220: 5e20 6e64 696d 6167 652e 6269 6e61 7279  ^ ndimage.binary
-00009230: 5f64 696c 6174 696f 6e28 0a20 2020 2020  _dilation(.     
-00009240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009250: 2020 2020 2020 206d 6173 6b2c 2063 6f6e         mask, con
-00009260: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
-00009270: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00009280: 6c66 2e6f 7665 726c 6170 5f6c 6576 656c  lf.overlap_level
-00009290: 203e 3d20 302e 353a 0a20 2020 2020 2020   >= 0.5:.       
-000092a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000092b0: 2020 2020 2065 6467 6520 2b3d 206d 6173       edge += mas
-000092c0: 6b20 5e20 6e64 696d 6167 652e 6269 6e61  k ^ ndimage.bina
-000092d0: 7279 5f65 726f 7369 6f6e 280a 2020 2020  ry_erosion(.    
-000092e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000092f0: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-00009300: 2c20 636f 6e6e 290a 0a20 2020 2020 2020  , conn)..       
-00009310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009320: 2023 2043 6865 636b 2077 6865 7468 6572   # Check whether
-00009330: 2065 6163 6820 6564 6765 2070 6978 656c   each edge pixel
-00009340: 2068 6173 2073 7566 6669 6369 656e 7420   has sufficient 
-00009350: 6f76 6572 6c61 700a 2020 2020 2020 2020  overlap.        
-00009360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009370: 666f 7220 6978 2c20 6979 2069 6e20 6e70  for ix, iy in np
-00009380: 2e61 7267 7768 6572 6528 6564 6765 293a  .argwhere(edge):
-00009390: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000093a0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000093b0: 4d61 6b65 2070 6f6c 7967 6f6e 206f 6620  Make polygon of 
-000093c0: 6375 7272 656e 7420 7069 7865 6c0a 2020  current pixel.  
-000093d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000093e0: 2020 2020 2020 2020 2020 7069 7865 6c20            pixel 
-000093f0: 3d20 6765 6f6d 6574 7279 2e50 6f6c 7967  = geometry.Polyg
-00009400: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-00009410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009420: 2020 2020 5b0a 2020 2020 2020 2020 2020      [.          
-00009430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009440: 2020 2020 2020 2020 2020 5b69 7820 2d20            [ix - 
-00009450: 302e 352c 2069 7920 2d20 302e 355d 2c0a  0.5, iy - 0.5],.
-00009460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000091f0: 2020 2020 2020 2020 636f 6e6e 203d 206e          conn = n
+00009200: 6469 6d61 6765 2e67 656e 6572 6174 655f  dimage.generate_
+00009210: 6269 6e61 7279 5f73 7472 7563 7475 7265  binary_structure
+00009220: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00009230: 2020 2020 2020 2020 2020 2020 2020 322c                2,
+00009240: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
+00009250: 2020 2020 2020 2020 2020 2020 6564 6765              edge
+00009260: 203d 206d 6173 6b20 5e20 6e64 696d 6167   = mask ^ ndimag
+00009270: 652e 6269 6e61 7279 5f64 696c 6174 696f  e.binary_dilatio
+00009280: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00009290: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000092a0: 6173 6b2c 2063 6f6e 6e29 0a20 2020 2020  ask, conn).     
+000092b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000092c0: 2020 2069 6620 7365 6c66 2e6f 7665 726c     if self.overl
+000092d0: 6170 5f6c 6576 656c 203e 3d20 302e 353a  ap_level >= 0.5:
+000092e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000092f0: 2020 2020 2020 2020 2020 2020 2065 6467               edg
+00009300: 6520 2b3d 206d 6173 6b20 5e20 6e64 696d  e += mask ^ ndim
+00009310: 6167 652e 6269 6e61 7279 5f65 726f 7369  age.binary_erosi
+00009320: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+00009330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009340: 2020 2020 6d61 736b 2c20 636f 6e6e 290a      mask, conn).
+00009350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009360: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
+00009370: 2077 6865 7468 6572 2065 6163 6820 6564   whether each ed
+00009380: 6765 2070 6978 656c 2068 6173 2073 7566  ge pixel has suf
+00009390: 6669 6369 656e 7420 6f76 6572 6c61 700a  ficient overlap.
+000093a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093b0: 2020 2020 2020 2020 666f 7220 6978 2c20          for ix, 
+000093c0: 6979 2069 6e20 6e70 2e61 7267 7768 6572  iy in np.argwher
+000093d0: 6528 6564 6765 293a 0a0a 2020 2020 2020  e(edge):..      
+000093e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093f0: 2020 2020 2020 2320 4d61 6b65 2070 6f6c        # Make pol
+00009400: 7967 6f6e 206f 6620 6375 7272 656e 7420  ygon of current 
+00009410: 7069 7865 6c0a 2020 2020 2020 2020 2020  pixel.          
+00009420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009430: 2020 7069 7865 6c20 3d20 6765 6f6d 6574    pixel = geomet
+00009440: 7279 2e50 6f6c 7967 6f6e 280a 2020 2020  ry.Polygon(.    
+00009450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009460: 2020 2020 2020 2020 2020 2020 5b0a 2020              [.  
 00009470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009480: 2020 2020 5b69 7820 2d20 302e 352c 2069      [ix - 0.5, i
-00009490: 7920 2b20 302e 355d 2c0a 2020 2020 2020  y + 0.5],.      
-000094a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094b0: 2020 2020 2020 2020 2020 2020 2020 5b69                [i
-000094c0: 7820 2b20 302e 352c 2069 7920 2b20 302e  x + 0.5, iy + 0.
-000094d0: 355d 2c0a 2020 2020 2020 2020 2020 2020  5],.            
-000094e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094f0: 2020 2020 2020 2020 5b69 7820 2b20 302e          [ix + 0.
-00009500: 352c 2069 7920 2d20 302e 355d 2c0a 2020  5, iy - 0.5],.  
-00009510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009520: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
+00009480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009490: 2020 5b69 7820 2d20 302e 352c 2069 7920    [ix - 0.5, iy 
+000094a0: 2d20 302e 355d 2c0a 2020 2020 2020 2020  - 0.5],.        
+000094b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094c0: 2020 2020 2020 2020 2020 2020 5b69 7820              [ix 
+000094d0: 2d20 302e 352c 2069 7920 2b20 302e 355d  - 0.5, iy + 0.5]
+000094e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000094f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009500: 2020 2020 2020 5b69 7820 2b20 302e 352c        [ix + 0.5,
+00009510: 2069 7920 2b20 302e 355d 2c0a 2020 2020   iy + 0.5],.    
+00009520: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00009530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009540: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00009550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009560: 2020 2020 2020 2020 2020 2023 2043 6f6d             # Com
-00009570: 7075 7465 206f 7665 726c 6170 0a20 2020  pute overlap.   
+00009540: 5b69 7820 2b20 302e 352c 2069 7920 2d20  [ix + 0.5, iy - 
+00009550: 302e 355d 2c0a 2020 2020 2020 2020 2020  0.5],.          
+00009560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009570: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
 00009580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009590: 2020 2020 2020 2020 206f 7665 726c 6170           overlap
-000095a0: 203d 2070 6f6c 7967 6f6e 2e69 6e74 6572   = polygon.inter
-000095b0: 7365 6374 696f 6e28 7069 7865 6c29 2e61  section(pixel).a
-000095c0: 7265 610a 2020 2020 2020 2020 2020 2020  rea.            
+00009590: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+000095a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000095b0: 2020 2023 2043 6f6d 7075 7465 206f 7665     # Compute ove
+000095c0: 726c 6170 0a20 2020 2020 2020 2020 2020  rlap.           
 000095d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095e0: 6d61 736b 5b69 782c 2069 795d 203d 206f  mask[ix, iy] = o
-000095f0: 7665 726c 6170 203e 2073 656c 662e 6f76  verlap > self.ov
-00009600: 6572 6c61 705f 6c65 7665 6c0a 0a20 2020  erlap_level..   
+000095e0: 206f 7665 726c 6170 203d 2070 6f6c 7967   overlap = polyg
+000095f0: 6f6e 2e69 6e74 6572 7365 6374 696f 6e28  on.intersection(
+00009600: 7069 7865 6c29 2e61 7265 610a 2020 2020  pixel).area.    
 00009610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009620: 2023 2041 6464 2074 6f20 3344 206d 6173   # Add to 3D mas
-00009630: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-00009640: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00009650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009660: 2020 2073 656c 662e 6d61 736b 2e64 6174     self.mask.dat
-00009670: 615b 3a2c 203a 2c20 697a 5d20 2b3d 206d  a[:, :, iz] += m
-00009680: 6173 6b2e 540a 2020 2020 2020 2020 2020  ask.T.          
-00009690: 2020 2020 2020 2020 2020 6578 6365 7074            except
-000096a0: 2049 6e64 6578 4572 726f 723a 0a20 2020   IndexError:.   
-000096b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096c0: 2020 2020 2070 6173 730a 0a20 2020 2020       pass..     
-000096d0: 2020 2023 2043 6f6e 7665 7274 2074 6f20     # Convert to 
-000096e0: 626f 6f6c 6561 6e20 6d61 736b 0a20 2020  boolean mask.   
-000096f0: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
-00009700: 7365 6c66 2e6d 6173 6b2c 2022 6461 7461  self.mask, "data
-00009710: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-00009720: 6966 206e 6f74 2073 656c 662e 6d61 736b  if not self.mask
-00009730: 2e64 6174 612e 6474 7970 6520 3d3d 2062  .data.dtype == b
-00009740: 6f6f 6c3a 0a20 2020 2020 2020 2020 2020  ool:.           
-00009750: 2020 2020 2073 656c 662e 6d61 736b 2e64       self.mask.d
-00009760: 6174 6120 3d20 7365 6c66 2e6d 6173 6b2e  ata = self.mask.
-00009770: 6461 7461 2e61 7374 7970 6528 626f 6f6c  data.astype(bool
-00009780: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00009790: 6c66 2e6c 6f61 6465 645f 6d61 736b 203d  lf.loaded_mask =
-000097a0: 2054 7275 650a 0a20 2020 2020 2020 2023   True..        #
-000097b0: 2053 6574 206f 776e 2067 656f 6d65 7472   Set own geometr
-000097c0: 6963 2070 726f 7065 7274 6965 7320 6672  ic properties fr
-000097d0: 6f6d 206d 6173 6b0a 2020 2020 2020 2020  om mask.        
-000097e0: 7365 6c66 2e76 6f78 656c 5f73 697a 6520  self.voxel_size 
-000097f0: 3d20 7365 6c66 2e6d 6173 6b2e 6765 745f  = self.mask.get_
-00009800: 766f 7865 6c5f 7369 7a65 2829 0a20 2020  voxel_size().   
-00009810: 2020 2020 2073 656c 662e 6f72 6967 696e       self.origin
-00009820: 203d 2073 656c 662e 6d61 736b 2e67 6574   = self.mask.get
-00009830: 5f6f 7269 6769 6e28 290a 2020 2020 2020  _origin().      
-00009840: 2020 7365 6c66 2e61 6666 696e 6520 3d20    self.affine = 
-00009850: 7365 6c66 2e6d 6173 6b2e 6765 745f 6166  self.mask.get_af
-00009860: 6669 6e65 2829 0a20 2020 2020 2020 2073  fine().        s
-00009870: 656c 662e 7368 6170 6520 3d20 7365 6c66  elf.shape = self
-00009880: 2e6d 6173 6b2e 6765 745f 6461 7461 2829  .mask.get_data()
-00009890: 2e73 6861 7065 0a0a 2020 2020 6465 6620  .shape..    def 
-000098a0: 6973 5f65 6d70 7479 2873 656c 6629 3a0a  is_empty(self):.
-000098b0: 2020 2020 2020 2020 2222 2243 6865 636b          """Check
-000098c0: 2077 6865 7468 6572 2074 6869 7320 524f   whether this RO
-000098d0: 4920 6973 2065 6d70 7479 2e22 2222 0a0a  I is empty."""..
-000098e0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-000098f0: 6428 290a 2020 2020 2020 2020 6966 2073  d().        if s
-00009900: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
-00009910: 5f6d 6574 686f 6420 3d3d 2022 636f 6e74  _method == "cont
-00009920: 6f75 7222 3a0a 2020 2020 2020 2020 2020  our":.          
-00009930: 2020 7265 7475 726e 206e 6f74 2062 6f6f    return not boo
-00009940: 6c28 6c65 6e28 7365 6c66 2e67 6574 5f63  l(len(self.get_c
-00009950: 6f6e 746f 7572 7328 2278 2d79 2229 2929  ontours("x-y")))
-00009960: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00009970: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00009980: 6e20 6e6f 7420 6e70 2e61 6e79 2873 656c  n not np.any(sel
-00009990: 662e 6765 745f 6d61 736b 2829 290a 0a20  f.get_mask()).. 
-000099a0: 2020 2064 6566 2072 6573 616d 706c 6528     def resample(
-000099b0: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
-000099c0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-000099d0: 7365 6c66 2e63 7265 6174 655f 6d61 736b  self.create_mask
-000099e0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-000099f0: 6d61 736b 2e72 6573 616d 706c 6528 2a61  mask.resample(*a
-00009a00: 7267 732c 202a 2a6b 7761 7267 7329 0a0a  rgs, **kwargs)..
-00009a10: 2020 2020 6465 6620 6d61 7463 685f 766f      def match_vo
-00009a20: 7865 6c5f 7369 7a65 2873 656c 662c 206f  xel_size(self, o
-00009a30: 7468 6572 2c20 2a61 7267 732c 202a 2a6b  ther, *args, **k
-00009a40: 7761 7267 7329 3a0a 0a20 2020 2020 2020  wargs):..       
-00009a50: 2069 6620 6973 696e 7374 616e 6365 286f   if isinstance(o
-00009a60: 7468 6572 2c20 524f 4929 3a0a 2020 2020  ther, ROI):.    
-00009a70: 2020 2020 2020 2020 6f74 6865 722e 6372          other.cr
-00009a80: 6561 7465 5f6d 6173 6b28 290a 2020 2020  eate_mask().    
-00009a90: 2020 2020 2020 2020 6d61 736b 203d 206f          mask = o
-00009aa0: 7468 6572 2e6d 6173 6b0a 2020 2020 2020  ther.mask.      
-00009ab0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00009ac0: 2020 2020 6d61 736b 203d 206f 7468 6572      mask = other
-00009ad0: 0a20 2020 2020 2020 2073 656c 662e 6372  .        self.cr
-00009ae0: 6561 7465 5f6d 6173 6b28 290a 2020 2020  eate_mask().    
-00009af0: 2020 2020 7365 6c66 2e6d 6173 6b2e 6d61      self.mask.ma
-00009b00: 7463 685f 766f 7865 6c5f 7369 7a65 286d  tch_voxel_size(m
-00009b10: 6173 6b2c 202a 6172 6773 2c20 2a2a 6b77  ask, *args, **kw
-00009b20: 6172 6773 290a 0a20 2020 2064 6566 2067  args)..    def g
-00009b30: 6574 5f73 6c69 6365 2873 656c 662c 202a  et_slice(self, *
-00009b40: 6172 6773 2c20 666f 7263 655f 7374 616e  args, force_stan
-00009b50: 6461 7264 6973 653d 4661 6c73 652c 202a  dardise=False, *
-00009b60: 2a6b 7761 7267 7329 3a0a 0a20 2020 2020  *kwargs):..     
-00009b70: 2020 2073 656c 662e 6372 6561 7465 5f6d     self.create_m
-00009b80: 6173 6b28 290a 2020 2020 2020 2020 6461  ask().        da
-00009b90: 7461 203d 2073 656c 662e 6d61 736b 2e67  ta = self.mask.g
-00009ba0: 6574 5f73 6c69 6365 282a 6172 6773 2c20  et_slice(*args, 
-00009bb0: 666f 7263 655f 7374 616e 6461 7264 6973  force_standardis
-00009bc0: 653d 666f 7263 655f 7374 616e 6461 7264  e=force_standard
-00009bd0: 6973 652c 200a 2020 2020 2020 2020 2020  ise, .          
-00009be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bf0: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
-00009c00: 7329 0a20 2020 2020 2020 2069 6620 6461  s).        if da
-00009c10: 7461 2e64 7479 7065 2021 3d20 626f 6f6c  ta.dtype != bool
-00009c20: 3a0a 2020 2020 2020 2020 2020 2020 6461  :.            da
-00009c30: 7461 203d 2064 6174 612e 6173 7479 7065  ta = data.astype
-00009c40: 2862 6f6f 6c29 0a20 2020 2020 2020 2072  (bool).        r
-00009c50: 6574 7572 6e20 6461 7461 0a0a 2020 2020  eturn data..    
-00009c60: 6465 6620 6765 745f 726f 695f 736c 6963  def get_roi_slic
-00009c70: 6528 7365 6c66 2c20 7a5f 6672 6163 7469  e(self, z_fracti
-00009c80: 6f6e 3d31 2c20 7375 6666 6978 3d4e 6f6e  on=1, suffix=Non
-00009c90: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
-00009ca0: 2020 2020 2020 2020 4765 7420 524f 4920          Get ROI 
-00009cb0: 6f62 6a65 6374 2063 6f72 7265 7370 6f6e  object correspon
-00009cc0: 6469 6e67 2074 6f20 782d 7920 736c 6963  ding to x-y slic
-00009cd0: 6520 7468 726f 7567 6820 7468 6973 2052  e through this R
-00009ce0: 4f49 2e0a 0a20 2020 2020 2020 202a 2a50  OI...        **P
-00009cf0: 6172 616d 6574 6572 3a2a 2a0a 0a20 2020  arameter:**..   
-00009d00: 2020 2020 207a 5f66 7261 6374 696f 6e20       z_fraction 
-00009d10: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
-00009d20: 3d31 0a20 2020 2020 2020 2020 2020 2050  =1.            P
-00009d30: 6f73 6974 696f 6e20 616c 6f6e 6720 7a20  osition along z 
-00009d40: 6178 6973 2061 7420 7768 6963 6820 746f  axis at which to
-00009d50: 2074 616b 6520 736c 6963 6520 7468 726f   take slice thro
-00009d60: 7567 6820 524f 492e 0a20 2020 2020 2020  ugh ROI..       
-00009d70: 2020 2020 2054 6865 2070 6f73 6974 696f       The positio
-00009d80: 6e20 6973 2073 7065 6369 6669 6564 2061  n is specified a
-00009d90: 7320 7468 6520 6672 6163 7469 6f6e 616c  s the fractional
-00009da0: 2064 6973 7461 6e63 650a 2020 2020 2020   distance.      
-00009db0: 2020 2020 2020 6672 6f6d 2074 6865 2052        from the R
-00009dc0: 4f49 2773 206d 6f73 742d 696e 6665 7269  OI's most-inferi
-00009dd0: 6f72 2070 6f69 6e74 3a20 3020 636f 7272  or point: 0 corr
-00009de0: 6573 706f 6e64 7320 746f 0a20 2020 2020  esponds to.     
-00009df0: 2020 2020 2020 2074 6865 206d 6f73 742d         the most-
-00009e00: 696e 6665 7269 6f72 2070 6f69 6e74 2028  inferior point (
-00009e10: 6c6f 7765 7374 207a 293b 2031 2063 6f72  lowest z); 1 cor
-00009e20: 7265 7370 6f6e 6473 2074 6f20 7468 650a  responds to the.
-00009e30: 2020 2020 2020 2020 2020 2020 6d6f 7374              most
-00009e40: 2d73 7570 6572 696f 7220 706f 696e 7420  -superior point 
-00009e50: 2868 6967 6865 7374 207a 292e 2020 5661  (highest z).  Va
-00009e60: 6c75 6573 2066 6f72 207a 5f66 7261 6374  lues for z_fract
-00009e70: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-00009e80: 6f75 7473 6964 6520 7468 6520 696e 7465  outside the inte
-00009e90: 7276 616c 205b 302c 2031 5d20 7265 7375  rval [0, 1] resu
-00009ea0: 6c74 2069 6e20 6120 5275 6e74 696d 6545  lt in a RuntimeE
-00009eb0: 7272 6f72 2e0a 0a20 2020 2073 7566 6669  rror...    suffi
-00009ec0: 7820 3a20 7374 722c 2064 6566 6175 6c74  x : str, default
-00009ed0: 3d4e 6f6e 650a 2020 2020 2020 2020 5375  =None.        Su
-00009ee0: 6666 6978 2074 6f20 6170 7065 6e64 2074  ffix to append t
-00009ef0: 6f20 6f77 6e20 6e61 6d65 2c20 746f 2066  o own name, to f
-00009f00: 6f72 6d20 6e61 6d65 206f 6620 6f75 7470  orm name of outp
-00009f10: 7574 2052 4f49 2e20 2049 660a 2020 2020  ut ROI.  If.    
-00009f20: 2020 2020 4e6f 6e65 2c20 6170 7065 6e64      None, append
-00009f30: 207a 5f66 7261 6374 696f 6e2c 2077 6974   z_fraction, wit
-00009f40: 6820 7661 6c75 6520 6769 7665 6e20 746f  h value given to
-00009f50: 2074 776f 2064 6563 696d 616c 2070 6c61   two decimal pla
-00009f60: 6365 732e 0a20 2020 2020 2020 2022 2222  ces..        """
-00009f70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00009f80: 6765 745f 726f 695f 736c 6963 6528 7365  get_roi_slice(se
-00009f90: 6c66 2c20 7a5f 6672 6163 7469 6f6e 290a  lf, z_fraction).
-00009fa0: 0a20 2020 2064 6566 2067 6574 5f69 6e64  .    def get_ind
-00009fb0: 6963 6573 2873 656c 662c 2076 6965 773d  ices(self, view=
-00009fc0: 2278 2d79 222c 206d 6574 686f 643d 4e6f  "x-y", method=No
-00009fd0: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
-00009fe0: 4765 7420 6c69 7374 206f 6620 736c 6963  Get list of slic
-00009ff0: 6520 696e 6469 6365 7320 6f6e 2077 6869  e indices on whi
-0000a000: 6368 2074 6869 7320 524f 4920 6578 6973  ch this ROI exis
-0000a010: 7473 2e22 2222 0a0a 2020 2020 2020 2020  ts."""..        
-0000a020: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
-0000a030: 2020 2020 6966 2073 656c 662e 656d 7074      if self.empt
-0000a040: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
-0000a050: 6574 7572 6e20 5b5d 0a0a 2020 2020 2020  eturn []..      
-0000a060: 2020 6966 206d 6574 686f 6420 6973 204e    if method is N
-0000a070: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000a080: 206d 6574 686f 6420 3d20 7365 6c66 2e64   method = self.d
-0000a090: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
-0000a0a0: 6f64 0a0a 2020 2020 2020 2020 6966 206d  od..        if m
-0000a0b0: 6574 686f 6420 3d3d 2022 636f 6e74 6f75  ethod == "contou
-0000a0c0: 7222 3a0a 2020 2020 2020 2020 2020 2020  r":.            
-0000a0d0: 7265 7475 726e 206c 6973 7428 7365 6c66  return list(self
-0000a0e0: 2e67 6574 5f63 6f6e 746f 7572 7328 7669  .get_contours(vi
-0000a0f0: 6577 2c20 6964 785f 6173 5f6b 6579 3d54  ew, idx_as_key=T
-0000a100: 7275 6529 2e6b 6579 7328 2929 0a20 2020  rue).keys()).   
-0000a110: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000a120: 2020 2020 2020 2061 7820 3d20 736b 7274         ax = skrt
-0000a130: 2e69 6d61 6765 2e5f 736c 6963 655f 6178  .image._slice_ax
-0000a140: 6573 5b76 6965 775d 0a20 2020 2020 2020  es[view].       
-0000a150: 2020 2020 206d 6173 6b20 3d20 7365 6c66       mask = self
-0000a160: 2e67 6574 5f6d 6173 6b28 7374 616e 6461  .get_mask(standa
-0000a170: 7264 6973 653d 5472 7565 292e 7472 616e  rdise=True).tran
-0000a180: 7370 6f73 6528 312c 2030 2c20 3229 0a20  spose(1, 0, 2). 
-0000a190: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000a1a0: 6e20 6c69 7374 286e 702e 756e 6971 7565  n list(np.unique
-0000a1b0: 286e 702e 6172 6777 6865 7265 286d 6173  (np.argwhere(mas
-0000a1c0: 6b29 5b3a 2c20 6178 5d29 290a 0a20 2020  k)[:, ax]))..   
-0000a1d0: 2064 6566 2067 6574 5f6d 6964 5f69 6478   def get_mid_idx
-0000a1e0: 2873 656c 662c 2076 6965 773d 2278 2d79  (self, view="x-y
-0000a1f0: 222c 202a 2a6b 7761 7267 7329 3a0a 2020  ", **kwargs):.  
-0000a200: 2020 2020 2020 2222 2247 6574 2063 656e        """Get cen
-0000a210: 7472 616c 2073 6c69 6365 2069 6e64 6578  tral slice index
-0000a220: 206f 6620 7468 6973 2052 4f49 2069 6e20   of this ROI in 
-0000a230: 6120 6769 7665 6e20 6f72 6965 6e74 6174  a given orientat
-0000a240: 696f 6e2e 2222 220a 0a20 2020 2020 2020  ion."""..       
-0000a250: 2069 6e64 6963 6573 203d 2073 656c 662e   indices = self.
-0000a260: 6765 745f 696e 6469 6365 7328 7669 6577  get_indices(view
-0000a270: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
-0000a280: 2020 2020 6966 206e 6f74 206c 656e 2869      if not len(i
-0000a290: 6e64 6963 6573 293a 0a20 2020 2020 2020  ndices):.       
-0000a2a0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0000a2b0: 0a20 2020 2020 2020 206d 6964 203d 2069  .        mid = i
-0000a2c0: 6e74 286c 656e 2869 6e64 6963 6573 2920  nt(len(indices) 
-0000a2d0: 2f20 3229 0a20 2020 2020 2020 2072 6574  / 2).        ret
-0000a2e0: 7572 6e20 696e 6469 6365 735b 6d69 645d  urn indices[mid]
-0000a2f0: 0a0a 2020 2020 6465 6620 6964 785f 746f  ..    def idx_to
-0000a300: 5f70 6f73 2873 656c 662c 2069 6478 2c20  _pos(self, idx, 
-0000a310: 6178 2c20 7374 616e 6461 7264 6973 653d  ax, standardise=
-0000a320: 5472 7565 293a 0a20 2020 2020 2020 2022  True):.        "
-0000a330: 2222 436f 6e76 6572 7420 616e 2061 7272  ""Convert an arr
-0000a340: 6179 2069 6e64 6578 2074 6f20 6120 706f  ay index to a po
-0000a350: 7369 7469 6f6e 2069 6e20 6d6d 2061 6c6f  sition in mm alo
-0000a360: 6e67 2061 2067 6976 656e 2061 7869 732e  ng a given axis.
-0000a370: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
-0000a380: 662e 6c6f 6164 2829 0a0a 2020 2020 2020  f.load()..      
-0000a390: 2020 6966 2073 656c 662e 636f 6e74 6f75    if self.contou
-0000a3a0: 7273 5f6f 6e6c 793a 0a0a 2020 2020 2020  rs_only:..      
-0000a3b0: 2020 2020 2020 2320 5573 6520 7365 6c66        # Use self
-0000a3c0: 2e69 6d61 6765 2773 2063 6f6e 7665 7273  .image's convers
-0000a3d0: 696f 6e20 6675 6e63 7469 6f6e 0a20 2020  ion function.   
-0000a3e0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0000a3f0: 2e69 6d61 6765 2069 7320 6e6f 7420 4e6f  .image is not No
-0000a400: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000a410: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000a420: 696d 6167 652e 6964 785f 746f 5f70 6f73  image.idx_to_pos
-0000a430: 2869 6478 2c20 6178 290a 0a20 2020 2020  (idx, ax)..     
-0000a440: 2020 2020 2020 2023 204f 7468 6572 7769         # Otherwi
-0000a450: 7365 2063 6f75 6e74 206e 756d 6265 7220  se count number 
-0000a460: 6f66 207a 2073 6c69 6365 7320 696e 2063  of z slices in c
-0000a470: 6f6e 746f 7572 7320 6469 6374 0a20 2020  ontours dict.   
-0000a480: 2020 2020 2020 2020 2023 2049 6620 696e           # If in
-0000a490: 6465 7820 646f 6573 206e 6f74 2063 6f72  dex does not cor
-0000a4a0: 7265 7370 6f6e 6420 746f 2061 2073 6c69  respond to a sli
-0000a4b0: 6365 2c20 7265 7475 726e 204e 6f6e 650a  ce, return None.
-0000a4c0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0000a4d0: 2061 7820 696e 205b 227a 222c 2032 5d3a   ax in ["z", 2]:
-0000a4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a4f0: 2063 6f6e 7665 7273 696f 6e20 3d20 7b69   conversion = {i
-0000a500: 3a20 7020 666f 7220 692c 2070 2069 6e20  : p for i, p in 
-0000a510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a520: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000a530: 6e75 6d65 7261 7465 2873 656c 662e 6765  numerate(self.ge
-0000a540: 745f 636f 6e74 6f75 7273 2822 782d 7922  t_contours("x-y"
-0000a550: 292e 6b65 7973 2829 297d 0a20 2020 2020  ).keys())}.     
-0000a560: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000a570: 6e20 636f 6e76 6572 7369 6f6e 2e67 6574  n conversion.get
-0000a580: 2869 6478 2c20 4e6f 6e65 290a 0a20 2020  (idx, None)..   
-0000a590: 2020 2020 2020 2020 2023 204f 7468 6572           # Other
-0000a5a0: 7769 7365 2c20 6e6f 7420 706f 7373 6962  wise, not possib
-0000a5b0: 6c65 2074 6f20 636f 6e76 6572 7420 782f  le to convert x/
-0000a5c0: 7920 706f 696e 7473 2074 6f20 696e 6469  y points to indi
-0000a5d0: 6365 730a 2020 2020 2020 2020 2020 2020  ces.            
-0000a5e0: 2320 6672 6f6d 2063 6f6e 746f 7572 7320  # from contours 
-0000a5f0: 616c 6f6e 650a 2020 2020 2020 2020 2020  alone.          
-0000a600: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000a610: 2020 2020 2020 2020 7072 696e 7428 2257          print("W
-0000a620: 6172 6e69 6e67 3a20 6361 6e6e 6f74 2063  arning: cannot c
-0000a630: 6f6e 7665 7274 2069 6e64 6578 2074 6f20  onvert index to 
-0000a640: 706f 7369 7469 6f6e 2069 6e20 7468 6520  position in the 
-0000a650: 782f 7920 220a 2020 2020 2020 2020 2020  x/y ".          
-0000a660: 2020 2020 2020 2020 2020 2020 2264 6972              "dir
-0000a670: 6563 7469 6f6e 7320 7769 7468 6f75 7420  ections without 
-0000a680: 6173 736f 6369 6174 6564 2069 6d61 6765  associated image
-0000a690: 2067 656f 6d65 7472 7921 2229 0a20 2020   geometry!").   
-0000a6a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000a6b0: 7572 6e0a 0a20 2020 2020 2020 2023 204f  urn..        # O
-0000a6c0: 7468 6572 7769 7365 2c20 7472 7920 746f  therwise, try to
-0000a6d0: 2075 7365 206d 6173 6b20 6f72 2069 6d61   use mask or ima
-0000a6e0: 6765 2773 2063 6f6e 7665 7273 696f 6e0a  ge's conversion.
-0000a6f0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-0000a700: 662e 6d61 736b 2069 7320 6e6f 7420 4e6f  f.mask is not No
-0000a710: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000a720: 7265 7475 726e 2073 656c 662e 6d61 736b  return self.mask
-0000a730: 2e69 6478 5f74 6f5f 706f 7328 6964 782c  .idx_to_pos(idx,
-0000a740: 2061 7829 0a20 2020 2020 2020 2065 6c69   ax).        eli
-0000a750: 6620 7365 6c66 2e69 6d61 6765 2069 7320  f self.image is 
-0000a760: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0000a770: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000a780: 662e 696d 6167 652e 6964 785f 746f 5f70  f.image.idx_to_p
-0000a790: 6f73 2869 6478 2c20 6178 290a 0a20 2020  os(idx, ax)..   
-0000a7a0: 2020 2020 2023 2045 6c73 652c 2074 7279       # Else, try
-0000a7b0: 2074 6f20 6361 6c63 756c 6174 6520 6672   to calculate fr
-0000a7c0: 6f6d 206f 776e 2067 656f 6d65 7472 6963  om own geometric
-0000a7d0: 2070 726f 7065 7274 6965 730a 2020 2020   properties.    
-0000a7e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000a7f0: 2020 2020 2020 695f 6178 203d 2073 6b72        i_ax = skr
-0000a800: 742e 696d 6167 652e 5f61 7865 732e 696e  t.image._axes.in
-0000a810: 6465 7828 6178 2920 6966 2061 7820 696e  dex(ax) if ax in
-0000a820: 2073 6b72 742e 696d 6167 652e 5f61 7865   skrt.image._axe
-0000a830: 7320 656c 7365 2061 780a 2020 2020 2020  s else ax.      
-0000a840: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000a850: 662e 6f72 6967 696e 5b69 5f61 785d 202b  f.origin[i_ax] +
-0000a860: 2069 6478 202a 2073 656c 662e 766f 7865   idx * self.voxe
-0000a870: 6c5f 7369 7a65 5b69 5f61 785d 0a0a 2020  l_size[i_ax]..  
-0000a880: 2020 6465 6620 706f 735f 746f 5f69 6478    def pos_to_idx
-0000a890: 2873 656c 662c 2070 6f73 2c20 6178 2c20  (self, pos, ax, 
-0000a8a0: 7265 7475 726e 5f69 6e74 3d54 7275 652c  return_int=True,
-0000a8b0: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
-0000a8c0: 2020 2020 2222 2243 6f6e 7665 7274 2061      """Convert a
-0000a8d0: 2070 6f73 6974 696f 6e20 696e 206d 6d20   position in mm 
-0000a8e0: 746f 2061 6e20 6172 7261 7920 696e 6465  to an array inde
-0000a8f0: 7820 616c 6f6e 6720 6120 6769 7665 6e20  x along a given 
-0000a900: 6178 6973 2e22 2222 0a0a 2020 2020 2020  axis."""..      
-0000a910: 2020 7365 6c66 2e6c 6f61 6428 290a 2020    self.load().  
-0000a920: 2020 2020 2020 6966 2073 656c 662e 636f        if self.co
-0000a930: 6e74 6f75 7273 5f6f 6e6c 793a 0a0a 2020  ntours_only:..  
-0000a940: 2020 2020 2020 2020 2020 2320 5573 6520            # Use 
-0000a950: 7365 6c66 2e69 6d61 6765 2773 2063 6f6e  self.image's con
-0000a960: 7665 7273 696f 6e20 6675 6e63 7469 6f6e  version function
-0000a970: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000a980: 7365 6c66 2e69 6d61 6765 2069 7320 6e6f  self.image is no
-0000a990: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000a9a0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000a9b0: 656c 662e 696d 6167 652e 706f 735f 746f  elf.image.pos_to
-0000a9c0: 5f69 6478 2870 6f73 2c20 6178 2c20 7265  _idx(pos, ax, re
-0000a9d0: 7475 726e 5f69 6e74 290a 0a20 2020 2020  turn_int)..     
-0000a9e0: 2020 2020 2020 2023 204f 7468 6572 7769         # Otherwi
-0000a9f0: 7365 2063 6f75 6e74 206e 756d 6265 7220  se count number 
-0000aa00: 6f66 207a 2073 6c69 6365 7320 696e 2063  of z slices in c
-0000aa10: 6f6e 746f 7572 7320 6469 6374 0a20 2020  ontours dict.   
-0000aa20: 2020 2020 2020 2020 2023 2049 6620 706f           # If po
-0000aa30: 7369 7469 6f6e 2064 6f65 7320 6e6f 7420  sition does not 
-0000aa40: 636f 7272 6573 706f 6e64 2074 6f20 6120  correspond to a 
-0000aa50: 736c 6965 2c20 7265 7475 726e 204e 6f6e  slie, return Non
-0000aa60: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
-0000aa70: 6966 2061 7820 696e 205b 227a 222c 2032  if ax in ["z", 2
-0000aa80: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-0000aa90: 2020 2063 6f6e 7665 7273 696f 6e20 3d20     conversion = 
-0000aaa0: 7b70 3a20 6920 666f 7220 692c 2070 2069  {p: i for i, p i
-0000aab0: 6e20 0a20 2020 2020 2020 2020 2020 2020  n .             
-0000aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aad0: 2065 6e75 6d65 7261 7465 2873 656c 662e   enumerate(self.
-0000aae0: 6765 745f 636f 6e74 6f75 7273 2822 782d  get_contours("x-
-0000aaf0: 7922 292e 6b65 7973 2829 297d 0a20 2020  y").keys())}.   
-0000ab00: 2020 2020 2020 2020 2020 2020 2069 6478               idx
-0000ab10: 203d 2063 6f6e 7665 7273 696f 6e2e 6765   = conversion.ge
-0000ab20: 7428 706f 732c 204e 6f6e 6529 0a0a 2020  t(pos, None)..  
-0000ab30: 2020 2020 2020 2020 2020 2320 4f74 6865            # Othe
-0000ab40: 7277 6973 652c 206e 6f74 2070 6f73 7369  rwise, not possi
-0000ab50: 626c 6520 746f 2063 6f6e 7665 7274 2078  ble to convert x
-0000ab60: 2f79 2070 6f69 6e74 7320 746f 2069 6e64  /y points to ind
-0000ab70: 6963 6573 0a20 2020 2020 2020 2020 2020  ices.           
-0000ab80: 2023 2066 726f 6d20 636f 6e74 6f75 7273   # from contours
-0000ab90: 2061 6c6f 6e65 0a20 2020 2020 2020 2020   alone.         
-0000aba0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000abb0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-0000abc0: 5761 726e 696e 673a 2063 616e 6e6f 7420  Warning: cannot 
-0000abd0: 636f 6e76 6572 7420 706f 7369 7469 6f6e  convert position
-0000abe0: 2074 6f20 696e 6465 7820 696e 2074 6865   to index in the
-0000abf0: 2078 2f79 2022 0a20 2020 2020 2020 2020   x/y ".         
-0000ac00: 2020 2020 2020 2020 2020 2020 2022 6469               "di
-0000ac10: 7265 6374 696f 6e73 2077 6974 686f 7574  rections without
-0000ac20: 2061 7373 6f63 6961 7465 6420 696d 6167   associated imag
-0000ac30: 6520 6765 6f6d 6574 7279 2122 290a 2020  e geometry!").  
-0000ac40: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000ac50: 7475 726e 0a20 2020 2020 2020 2020 2020  turn.           
-0000ac60: 2069 6620 7265 7475 726e 5f69 6e74 2061   if return_int a
-0000ac70: 6e64 2069 6478 2069 7320 6e6f 7420 4e6f  nd idx is not No
-0000ac80: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000ac90: 2020 2020 7265 7475 726e 2072 6f75 6e64      return round
-0000aca0: 2869 6478 290a 2020 2020 2020 2020 2020  (idx).          
-0000acb0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000acc0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-0000acd0: 6478 0a0a 2020 2020 2020 2020 2320 4f74  dx..        # Ot
-0000ace0: 6865 7277 6973 652c 2074 7279 2074 6f20  herwise, try to 
-0000acf0: 7573 6520 6d61 736b 206f 7220 696d 6167  use mask or imag
-0000ad00: 6527 7320 636f 6e76 6572 7369 6f6e 0a20  e's conversion. 
-0000ad10: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-0000ad20: 2e6d 6173 6b20 6973 206e 6f74 204e 6f6e  .mask is not Non
-0000ad30: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0000ad40: 6574 7572 6e20 7365 6c66 2e6d 6173 6b2e  eturn self.mask.
-0000ad50: 706f 735f 746f 5f69 6478 2870 6f73 2c20  pos_to_idx(pos, 
-0000ad60: 6178 2c20 7265 7475 726e 5f69 6e74 290a  ax, return_int).
-0000ad70: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-0000ad80: 662e 696d 6167 6520 6973 206e 6f74 204e  f.image is not N
-0000ad90: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000ada0: 2072 6574 7572 6e20 7365 6c66 2e69 6d61   return self.ima
-0000adb0: 6765 2e70 6f73 5f74 6f5f 6964 7828 706f  ge.pos_to_idx(po
-0000adc0: 732c 2061 782c 2072 6574 7572 6e5f 696e  s, ax, return_in
-0000add0: 7429 0a0a 2020 2020 2020 2020 2320 456c  t)..        # El
-0000ade0: 7365 2c20 7472 7920 746f 2063 616c 6375  se, try to calcu
-0000adf0: 6c61 7465 2066 726f 6d20 6f77 6e20 6765  late from own ge
-0000ae00: 6f6d 7472 6963 2070 726f 7065 7274 6965  omtric propertie
-0000ae10: 730a 2020 2020 2020 2020 656c 7365 3a0a  s.        else:.
-0000ae20: 2020 2020 2020 2020 2020 2020 695f 6178              i_ax
-0000ae30: 203d 2073 6b72 742e 696d 6167 652e 5f61   = skrt.image._a
-0000ae40: 7865 732e 696e 6465 7828 6178 2920 6966  xes.index(ax) if
-0000ae50: 2061 7820 696e 2073 6b72 742e 696d 6167   ax in skrt.imag
-0000ae60: 652e 5f61 7865 7320 656c 7365 2061 780a  e._axes else ax.
-0000ae70: 2020 2020 2020 2020 2020 2020 6964 7820              idx 
-0000ae80: 3d20 2870 6f73 202d 2073 656c 662e 6f72  = (pos - self.or
-0000ae90: 6967 696e 5b69 5f61 785d 2920 2f20 7365  igin[i_ax]) / se
-0000aea0: 6c66 2e76 6f78 656c 5f73 697a 655b 695f  lf.voxel_size[i_
-0000aeb0: 6178 5d0a 2020 2020 2020 2020 2020 2020  ax].            
-0000aec0: 6966 2072 6574 7572 6e5f 696e 743a 0a20  if return_int:. 
-0000aed0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000aee0: 6574 7572 6e20 726f 756e 6428 6964 7829  eturn round(idx)
-0000aef0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000af00: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000af10: 2020 2072 6574 7572 6e20 6964 780a 0a20     return idx.. 
-0000af20: 2020 2064 6566 2069 6478 5f74 6f5f 736c     def idx_to_sl
-0000af30: 6963 6528 7365 6c66 2c20 6964 782c 2061  ice(self, idx, a
-0000af40: 7829 3a0a 2020 2020 2020 2020 2222 2243  x):.        """C
-0000af50: 6f6e 7665 7274 2061 6e20 6172 7261 7920  onvert an array 
-0000af60: 696e 6465 7820 746f 2061 2073 6c69 6365  index to a slice
-0000af70: 206e 756d 6265 7220 616c 6f6e 6720 6120   number along a 
-0000af80: 6769 7665 6e20 6178 6973 2e22 2222 0a0a  given axis."""..
-0000af90: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-0000afa0: 6428 290a 2020 2020 2020 2020 6966 2073  d().        if s
-0000afb0: 656c 662e 636f 6e74 6f75 7273 5f6f 6e6c  elf.contours_onl
-0000afc0: 7920 6f72 2028 7365 6c66 2e6d 6173 6b20  y or (self.mask 
-0000afd0: 6973 204e 6f6e 6520 616e 6420 7365 6c66  is None and self
-0000afe0: 2e69 6d61 6765 2069 7320 4e6f 6e65 293a  .image is None):
-0000aff0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0000b000: 436f 756e 7420 6e75 6d62 6572 206f 6620  Count number of 
-0000b010: 7a20 736c 6963 6573 2069 6e20 636f 6e74  z slices in cont
-0000b020: 6f75 7273 2064 6963 740a 2020 2020 2020  ours dict.      
-0000b030: 2020 2020 2020 6966 2061 7820 696e 205b        if ax in [
-0000b040: 227a 222c 2032 5d3a 0a20 2020 2020 2020  "z", 2]:.       
-0000b050: 2020 2020 2020 2020 206e 7a20 3d20 7365           nz = se
-0000b060: 6c66 2e67 6574 5f6e 7a5f 636f 6e74 6f75  lf.get_nz_contou
-0000b070: 7273 2829 0a20 2020 2020 2020 2020 2020  rs().           
-0000b080: 2020 2020 2072 6574 7572 6e20 6e7a 202d       return nz -
-0000b090: 2069 6478 0a20 2020 2020 2020 2020 2020   idx.           
-0000b0a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000b0b0: 2020 2020 2020 2072 6574 7572 6e20 6964         return id
-0000b0c0: 7820 2b20 310a 0a20 2020 2020 2020 2023  x + 1..        #
-0000b0d0: 2054 7279 2074 6f20 7573 6520 6d61 736b   Try to use mask
-0000b0e0: 206f 7220 696d 6167 6527 7320 636f 6e76   or image's conv
-0000b0f0: 6572 7369 6f6e 0a20 2020 2020 2020 2065  ersion.        e
-0000b100: 6c69 6620 7365 6c66 2e6d 6173 6b20 6973  lif self.mask is
-0000b110: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000b120: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000b130: 6c66 2e6d 6173 6b2e 6964 785f 746f 5f73  lf.mask.idx_to_s
-0000b140: 6c69 6365 2869 6478 2c20 6178 290a 2020  lice(idx, ax).  
-0000b150: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000b160: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000b170: 656c 662e 696d 6167 652e 6964 785f 746f  elf.image.idx_to
-0000b180: 5f73 6c69 6365 2869 6478 2c20 6178 290a  _slice(idx, ax).
-0000b190: 0a20 2020 2064 6566 2073 6c69 6365 5f74  .    def slice_t
-0000b1a0: 6f5f 6964 7828 7365 6c66 2c20 736c 2c20  o_idx(self, sl, 
-0000b1b0: 6178 293a 0a20 2020 2020 2020 2022 2222  ax):.        """
-0000b1c0: 436f 6e76 6572 7420 6120 736c 6963 6520  Convert a slice 
-0000b1d0: 6e75 6d62 6572 2074 6f20 616e 2061 7272  number to an arr
-0000b1e0: 6179 2069 6e64 6578 2e22 2222 0a0a 2020  ay index."""..  
-0000b1f0: 2020 2020 2020 7365 6c66 2e6c 6f61 6428        self.load(
-0000b200: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
-0000b210: 662e 636f 6e74 6f75 7273 5f6f 6e6c 7920  f.contours_only 
-0000b220: 6f72 2028 7365 6c66 2e6d 6173 6b20 6973  or (self.mask is
-0000b230: 204e 6f6e 6520 616e 6420 7365 6c66 2e69   None and self.i
-0000b240: 6d61 6765 2069 7320 4e6f 6e65 293a 0a0a  mage is None):..
-0000b250: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
-0000b260: 756e 7420 6e75 6d62 6572 206f 6620 7a20  unt number of z 
-0000b270: 736c 6963 6573 2069 6e20 636f 6e74 6f75  slices in contou
-0000b280: 7273 2064 6963 740a 2020 2020 2020 2020  rs dict.        
-0000b290: 2020 2020 6966 2061 7820 696e 205b 227a      if ax in ["z
-0000b2a0: 222c 2032 5d3a 0a20 2020 2020 2020 2020  ", 2]:.         
-0000b2b0: 2020 2020 2020 206e 7a20 3d20 7365 6c66         nz = self
-0000b2c0: 2e67 6574 5f6e 7a5f 636f 6e74 6f75 7273  .get_nz_contours
-0000b2d0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0000b2e0: 2020 2072 6574 7572 6e20 6e7a 202d 2073     return nz - s
-0000b2f0: 6c0a 2020 2020 2020 2020 2020 2020 656c  l.            el
-0000b300: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000b310: 2020 2020 7265 7475 726e 2073 6c20 2d20      return sl - 
-0000b320: 310a 0a20 2020 2020 2020 2023 2054 7279  1..        # Try
-0000b330: 2074 6f20 7573 6520 6d61 736b 206f 7220   to use mask or 
-0000b340: 696d 6167 6527 7320 636f 6e76 6572 7369  image's conversi
-0000b350: 6f6e 0a20 2020 2020 2020 2065 6c69 6620  on.        elif 
-0000b360: 7365 6c66 2e6d 6173 6b20 6973 206e 6f74  self.mask is not
-0000b370: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000b380: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
-0000b390: 6173 6b2e 736c 6963 655f 746f 5f69 6478  ask.slice_to_idx
-0000b3a0: 2873 6c2c 2061 7829 0a20 2020 2020 2020  (sl, ax).       
-0000b3b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000b3c0: 2020 2072 6574 7572 6e20 7365 6c66 2e69     return self.i
-0000b3d0: 6d61 6765 2e73 6c69 6365 5f74 6f5f 6964  mage.slice_to_id
-0000b3e0: 7828 736c 2c20 6178 290a 0a20 2020 2064  x(sl, ax)..    d
-0000b3f0: 6566 2070 6f73 5f74 6f5f 736c 6963 6528  ef pos_to_slice(
-0000b400: 7365 6c66 2c20 706f 732c 2061 782c 2072  self, pos, ax, r
-0000b410: 6574 7572 6e5f 696e 743d 5472 7565 2c20  eturn_int=True, 
-0000b420: 7374 616e 6461 7264 6973 653d 5472 7565  standardise=True
-0000b430: 293a 0a20 2020 2020 2020 2022 2222 436f  ):.        """Co
-0000b440: 6e76 6572 7420 6120 706f 7369 7469 6f6e  nvert a position
-0000b450: 2069 6e20 6d6d 2074 6f20 6120 736c 6963   in mm to a slic
-0000b460: 6520 6e75 6d62 6572 2061 6c6f 6e67 2061  e number along a
-0000b470: 2067 6976 656e 2061 7869 732e 2222 220a   given axis.""".
-0000b480: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000b490: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
-0000b4a0: 2e70 6f73 5f74 6f5f 736c 6963 6528 7365  .pos_to_slice(se
-0000b4b0: 6c66 2c20 706f 732c 2061 782c 2072 6574  lf, pos, ax, ret
-0000b4c0: 7572 6e5f 696e 7429 0a0a 2020 2020 6465  urn_int)..    de
-0000b4d0: 6620 736c 6963 655f 746f 5f70 6f73 2873  f slice_to_pos(s
-0000b4e0: 656c 662c 2073 6c2c 2061 782c 2073 7461  elf, sl, ax, sta
-0000b4f0: 6e64 6172 6469 7365 3d54 7275 6529 3a0a  ndardise=True):.
-0000b500: 2020 2020 2020 2020 2222 2243 6f6e 7665          """Conve
-0000b510: 7274 2061 2073 6c69 6365 206e 756d 6265  rt a slice numbe
-0000b520: 7220 746f 2061 2070 6f73 6974 696f 6e20  r to a position 
-0000b530: 696e 206d 6d20 616c 6f6e 6720 6120 6769  in mm along a gi
-0000b540: 7665 6e20 6178 6973 2e22 2222 0a0a 2020  ven axis."""..  
-0000b550: 2020 2020 2020 7265 7475 726e 2073 6b72        return skr
-0000b560: 742e 696d 6167 652e 496d 6167 652e 736c  t.image.Image.sl
-0000b570: 6963 655f 746f 5f70 6f73 2873 656c 662c  ice_to_pos(self,
-0000b580: 2073 6c2c 2061 7829 0a0a 2020 2020 6465   sl, ax)..    de
-0000b590: 6620 6765 745f 6964 7828 7365 6c66 2c20  f get_idx(self, 
-0000b5a0: 7669 6577 2c20 736c 3d4e 6f6e 652c 2069  view, sl=None, i
-0000b5b0: 6478 3d4e 6f6e 652c 2070 6f73 3d4e 6f6e  dx=None, pos=Non
-0000b5c0: 6529 3a0a 2020 2020 2020 2020 2222 2247  e):.        """G
-0000b5d0: 6574 2061 6e20 6172 7261 7920 696e 6465  et an array inde
-0000b5e0: 7820 6672 6f6d 2065 6974 6865 7220 6120  x from either a 
-0000b5f0: 736c 6963 6520 6e75 6d62 6572 2c20 696e  slice number, in
-0000b600: 6465 782c 206f 720a 2020 2020 2020 2020  dex, or.        
-0000b610: 706f 7369 7469 6f6e 2e22 2222 0a0a 2020  position."""..  
-0000b620: 2020 2020 2020 7265 7475 726e 2073 6b72        return skr
-0000b630: 742e 696d 6167 652e 496d 6167 652e 6765  t.image.Image.ge
-0000b640: 745f 6964 7828 7365 6c66 2c20 7669 6577  t_idx(self, view
-0000b650: 2c20 736c 3d73 6c2c 2069 6478 3d69 6478  , sl=sl, idx=idx
-0000b660: 2c20 706f 733d 706f 7329 0a0a 2020 2020  , pos=pos)..    
-0000b670: 6465 6620 6f6e 5f73 6c69 6365 2873 656c  def on_slice(sel
-0000b680: 662c 2076 6965 772c 2073 6c3d 4e6f 6e65  f, view, sl=None
-0000b690: 2c20 6964 783d 4e6f 6e65 2c20 706f 733d  , idx=None, pos=
-0000b6a0: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
-0000b6b0: 2222 4368 6563 6b20 7768 6574 6865 7220  ""Check whether 
-0000b6c0: 7468 6973 2052 4f49 2065 7869 7374 7320  this ROI exists 
-0000b6d0: 6f6e 2061 2067 6976 656e 2073 6c69 6365  on a given slice
-0000b6e0: 2e22 2222 0a0a 2020 2020 2020 2020 6966  ."""..        if
-0000b6f0: 2073 6c20 6973 204e 6f6e 6520 616e 6420   sl is None and 
-0000b700: 6964 7820 6973 204e 6f6e 6520 616e 6420  idx is None and 
-0000b710: 706f 7320 6973 204e 6f6e 653a 0a20 2020  pos is None:.   
-0000b720: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000b730: 4661 6c73 650a 2020 2020 2020 2020 6964  False.        id
-0000b740: 7820 3d20 7365 6c66 2e67 6574 5f69 6478  x = self.get_idx
-0000b750: 2876 6965 772c 2073 6c2c 2069 6478 2c20  (view, sl, idx, 
-0000b760: 706f 7329 0a20 2020 2020 2020 2069 6620  pos).        if 
-0000b770: 6964 7820 6973 204e 6f6e 653a 0a20 2020  idx is None:.   
-0000b780: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000b790: 4661 6c73 650a 2020 2020 2020 2020 7265  False.        re
-0000b7a0: 7475 726e 2069 6478 2069 6e20 7365 6c66  turn idx in self
-0000b7b0: 2e67 6574 5f69 6e64 6963 6573 2876 6965  .get_indices(vie
-0000b7c0: 7729 0a0a 2020 2020 6465 6620 696e 7465  w)..    def inte
-0000b7d0: 7270 6f6c 6174 655f 706f 696e 7473 2873  rpolate_points(s
-0000b7e0: 656c 662c 206e 5f70 6f69 6e74 3d4e 6f6e  elf, n_point=Non
-0000b7f0: 652c 2064 7879 3d4e 6f6e 652c 0a20 2020  e, dxy=None,.   
-0000b800: 2020 2020 2073 6d6f 6f74 686e 6573 735f       smoothness_
-0000b810: 7065 725f 706f 696e 743d 3029 3a0a 2020  per_point=0):.  
-0000b820: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
-0000b830: 2020 5265 7475 726e 206e 6577 2052 4f49    Return new ROI
-0000b840: 206f 626a 6563 742c 2077 6974 6820 696e   object, with in
-0000b850: 7465 7270 6f6c 6174 6564 2063 6f6e 746f  terpolated conto
-0000b860: 7572 2070 6f69 6e74 732e 0a0a 2020 2020  ur points...    
-0000b870: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
-0000b880: 3a2a 2a0a 0a20 2020 2020 2020 206e 5f70  :**..        n_p
-0000b890: 6f69 6e74 203a 2069 6e74 2c20 6465 6661  oint : int, defa
-0000b8a0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0000b8b0: 2020 2020 204e 756d 6265 7220 6f66 2070       Number of p
-0000b8c0: 6f69 6e74 7320 7065 7220 636f 6e74 6f75  oints per contou
-0000b8d0: 722c 2061 6674 6572 2069 6e74 6572 706f  r, after interpo
-0000b8e0: 6c61 7469 6f6e 2e20 2054 6869 7320 6d75  lation.  This mu
-0000b8f0: 7374 0a20 2020 2020 2020 2020 2020 2062  st.            b
-0000b900: 6520 7365 7420 746f 204e 6f6e 6520 666f  e set to None fo
-0000b910: 7220 6478 7920 746f 2062 6520 636f 6e73  r dxy to be cons
-0000b920: 6964 6572 6564 2e0a 0a20 2020 2020 2020  idered...       
-0000b930: 2064 7879 203a 2066 6c6f 6174 2c20 6465   dxy : float, de
-0000b940: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-0000b950: 2020 2020 2020 2041 7070 726f 7869 6d61         Approxima
-0000b960: 7465 2064 6973 7461 6e63 6520 7265 7175  te distance requ
-0000b970: 6972 6564 2062 6574 7765 656e 2063 6f6e  ired between con
-0000b980: 746f 7572 2070 6f69 6e74 732e 2020 5468  tour points.  Th
-0000b990: 6973 2069 7320 7461 6b65 6e0a 2020 2020  is is taken.    
-0000b9a0: 2020 2020 2020 2020 696e 746f 2061 6363          into acc
-0000b9b0: 6f75 6e74 206f 6e6c 7920 6966 206e 5f70  ount only if n_p
-0000b9c0: 6f69 6e74 2069 7320 7365 7420 746f 204e  oint is set to N
-0000b9d0: 6f6e 652e 2020 466f 7220 6120 636f 6e74  one.  For a cont
-0000b9e0: 6f75 7220 6f66 0a20 2020 2020 2020 2020  our of.         
-0000b9f0: 2020 206c 656e 6774 6820 636f 6e74 6f75     length contou
-0000ba00: 725f 6c65 6e67 7468 2c20 7468 6520 6e75  r_length, the nu
-0000ba10: 6d62 6572 206f 6620 636f 6e74 6f75 7220  mber of contour 
-0000ba20: 706f 696e 7473 2069 7320 7468 656e 2074  points is then t
-0000ba30: 616b 656e 0a20 2020 2020 2020 2020 2020  aken.           
-0000ba40: 2074 6f20 6265 206d 6178 2869 6e74 2863   to be max(int(c
-0000ba50: 6f6e 746f 7572 5f6c 656e 6774 6820 2f20  ontour_length / 
-0000ba60: 6478 7929 2c20 3329 2e20 200a 0a20 2020  dxy), 3).  ..   
-0000ba70: 2020 2020 2073 6d6f 6f74 686e 6573 735f       smoothness_
-0000ba80: 7065 725f 706f 696e 7420 3a20 666c 6f61  per_point : floa
-0000ba90: 742c 2064 6566 6175 6c74 3d30 0a20 2020  t, default=0.   
-0000baa0: 2020 2020 2020 2020 2050 6172 616d 6574           Paramet
-0000bab0: 6572 2064 6574 6572 6d69 6e69 6e67 2074  er determining t
-0000bac0: 6865 2073 6d6f 6f74 686e 6573 7320 6f66  he smoothness of
-0000bad0: 2074 6865 2042 2d73 706c 696e 6520 6375   the B-spline cu
-0000bae0: 7276 6520 7573 6564 0a20 2020 2020 2020  rve used.       
-0000baf0: 2020 2020 2069 6e20 636f 6e74 6f75 7220       in contour 
-0000bb00: 6170 7072 6f78 696d 6174 696f 6e20 666f  approximation fo
-0000bb10: 7220 696e 7465 7270 6f6c 6174 696f 6e2e  r interpolation.
-0000bb20: 2020 5468 6520 7072 6f64 7563 7420 6f66    The product of
-0000bb30: 0a20 2020 2020 2020 2020 2020 2073 6d6f  .            smo
-0000bb40: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
-0000bb50: 7420 616e 6420 7468 6520 6e75 6d62 6572  t and the number
-0000bb60: 206f 6620 636f 6e74 6f75 7220 706f 696e   of contour poin
-0000bb70: 7473 2028 7370 6563 6966 6965 640a 2020  ts (specified.  
-0000bb80: 2020 2020 2020 2020 2020 6469 7265 6374            direct
-0000bb90: 6c79 2076 6961 206e 5f70 6f69 6e74 2c20  ly via n_point, 
-0000bba0: 6f72 2069 6e64 6972 6563 746c 7920 7669  or indirectly vi
-0000bbb0: 6120 6478 7929 2063 6f72 7265 7370 6f6e  a dxy) correspon
-0000bbc0: 6473 2074 6f20 7468 650a 2020 2020 2020  ds to the.      
-0000bbd0: 2020 2020 2020 7061 7261 6d65 7465 7220        parameter 
-0000bbe0: 7320 6f66 2073 6369 7079 2e69 6e74 6572  s of scipy.inter
-0000bbf0: 706f 6c61 7465 2e73 706c 7072 6570 202d  polate.splprep -
-0000bc00: 2073 6565 2064 6f63 756d 656e 7461 7469   see documentati
-0000bc10: 6f6e 2061 743a 0a20 2020 2020 2020 200a  on at:.        .
-0000bc20: 2020 2020 2020 2020 2020 2020 6874 7470              http
-0000bc30: 733a 2f2f 7363 6970 792e 6769 7468 7562  s://scipy.github
-0000bc40: 2e69 6f2f 6465 7664 6f63 732f 7265 6665  .io/devdocs/refe
-0000bc50: 7265 6e63 652f 6765 6e65 7261 7465 642f  rence/generated/
-0000bc60: 7363 6970 792e 696e 7465 7270 6f6c 6174  scipy.interpolat
-0000bc70: 652e 7370 6c70 7265 702e 6874 6d6c 2373  e.splprep.html#s
-0000bc80: 6369 7079 2e69 6e74 6572 706f 6c61 7465  cipy.interpolate
-0000bc90: 2e73 706c 7072 6570 0a0a 2020 2020 2020  .splprep..      
-0000bca0: 2020 2020 2020 4120 736d 6f6f 7468 6e65        A smoothne
-0000bcb0: 7373 5f70 6572 5f70 6f69 6e74 206f 6620  ss_per_point of 
-0000bcc0: 3020 666f 7263 6573 2074 6865 2042 2d73  0 forces the B-s
-0000bcd0: 706c 696e 6520 746f 2070 6173 7320 7468  pline to pass th
-0000bce0: 726f 7567 680a 2020 2020 2020 2020 2020  rough.          
-0000bcf0: 2020 616c 6c20 6f66 2074 6865 2070 7265    all of the pre
-0000bd00: 2d69 6e74 6572 706f 6c61 7469 6f6e 2063  -interpolation c
-0000bd10: 6f6e 746f 7572 2070 6f69 6e74 732e 0a20  ontour points.. 
-0000bd20: 2020 2020 2020 2027 2727 0a0a 2020 2020         '''..    
-0000bd30: 2020 2020 6e65 775f 636f 6e74 6f75 7273      new_contours
-0000bd40: 203d 207b 7d0a 2020 2020 2020 2020 666f   = {}.        fo
-0000bd50: 7220 7a2c 2063 6f6e 746f 7572 7320 696e  r z, contours in
-0000bd60: 2073 656c 662e 6765 745f 636f 6e74 6f75   self.get_contou
-0000bd70: 7273 2829 2e69 7465 6d73 2829 3a0a 2020  rs().items():.  
-0000bd80: 2020 2020 2020 2020 2020 6e65 775f 636f            new_co
-0000bd90: 6e74 6f75 7273 5b7a 5d20 3d20 5b5d 0a20  ntours[z] = []. 
-0000bda0: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
-0000bdb0: 6f6e 746f 7572 2069 6e20 636f 6e74 6f75  ontour in contou
-0000bdc0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-0000bdd0: 2020 2020 6e65 775f 636f 6e74 6f75 7220      new_contour 
-0000bde0: 3d20 696e 7465 7270 6f6c 6174 655f 706f  = interpolate_po
-0000bdf0: 696e 7473 5f73 696e 676c 655f 636f 6e74  ints_single_cont
-0000be00: 6f75 7228 0a20 2020 2020 2020 2020 2020  our(.           
-0000be10: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0000be20: 746f 7572 2c20 6e5f 706f 696e 742c 2064  tour, n_point, d
-0000be30: 7879 2c20 736d 6f6f 7468 6e65 7373 5f70  xy, smoothness_p
-0000be40: 6572 5f70 6f69 6e74 290a 2020 2020 2020  er_point).      
-0000be50: 2020 2020 2020 2020 2020 6e65 775f 636f            new_co
-0000be60: 6e74 6f75 7273 5b7a 5d2e 6170 7065 6e64  ntours[z].append
-0000be70: 286e 6577 5f63 6f6e 746f 7572 290a 0a20  (new_contour).. 
-0000be80: 2020 2020 2020 2023 2043 6c6f 6e65 2073         # Clone s
-0000be90: 656c 662c 2074 6865 6e20 636c 6561 7220  elf, then clear 
-0000bea0: 6d61 736b 2061 6e64 2072 6573 6574 2063  mask and reset c
-0000beb0: 6f6e 746f 7572 7320 6f66 2063 6c6f 6e65  ontours of clone
-0000bec0: 0a20 2020 2020 2020 2072 6f69 203d 2052  .        roi = R
-0000bed0: 4f49 2873 656c 6629 0a20 2020 2020 2020  OI(self).       
-0000bee0: 2072 6f69 2e69 6e70 7574 5f63 6f6e 746f   roi.input_conto
-0000bef0: 7572 7320 3d20 6e65 775f 636f 6e74 6f75  urs = new_contou
-0000bf00: 7273 0a20 2020 2020 2020 2072 6f69 2e63  rs.        roi.c
-0000bf10: 6f6e 746f 7572 7320 3d20 7b22 782d 7922  ontours = {"x-y"
-0000bf20: 3a20 6e65 775f 636f 6e74 6f75 7273 7d0a  : new_contours}.
-0000bf30: 2020 2020 2020 2020 726f 692e 6c6f 6164          roi.load
-0000bf40: 6564 5f6d 6173 6b20 3d20 4661 6c73 650a  ed_mask = False.
-0000bf50: 2020 2020 2020 2020 726f 692e 6d61 736b          roi.mask
-0000bf60: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
-0000bf70: 2072 6574 7572 6e20 726f 690a 0a20 2020   return roi..   
-0000bf80: 2064 6566 2067 6574 5f63 656e 7472 6f69   def get_centroi
-0000bf90: 6428 0a20 2020 2020 2020 2073 656c 662c  d(.        self,
-0000bfa0: 0a20 2020 2020 2020 2076 6965 773d 2278  .        view="x
-0000bfb0: 2d79 222c 0a20 2020 2020 2020 2073 696e  -y",.        sin
-0000bfc0: 676c 655f 736c 6963 653d 4661 6c73 652c  gle_slice=False,
-0000bfd0: 0a20 2020 2020 2020 2073 6c3d 4e6f 6e65  .        sl=None
-0000bfe0: 2c0a 2020 2020 2020 2020 6964 783d 4e6f  ,.        idx=No
-0000bff0: 6e65 2c0a 2020 2020 2020 2020 706f 733d  ne,.        pos=
-0000c000: 4e6f 6e65 2c0a 2020 2020 2020 2020 756e  None,.        un
-0000c010: 6974 733d 226d 6d22 2c0a 2020 2020 2020  its="mm",.      
-0000c020: 2020 6d65 7468 6f64 3d4e 6f6e 652c 0a20    method=None,. 
-0000c030: 2020 2020 2020 2066 6f72 6365 3d54 7275         force=Tru
-0000c040: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
-0000c050: 2020 2222 2247 6574 2065 6974 6865 7220    """Get either 
-0000c060: 3344 2067 6c6f 6261 6c20 6365 6e74 726f  3D global centro
-0000c070: 6964 2070 6f73 6974 696f 6e20 6f72 2032  id position or 2
-0000c080: 4420 6365 6e74 726f 6964 2070 6f73 6974  D centroid posit
-0000c090: 696f 6e20 6f6e 200a 2020 2020 2020 2020  ion on .        
-0000c0a0: 6120 7369 6e67 6c65 2073 6c69 6365 2e20  a single slice. 
-0000c0b0: 4966 2073 696e 676c 655f 736c 6963 653d  If single_slice=
-0000c0c0: 4661 6c73 652c 2074 6865 2063 616c 6375  False, the calcu
-0000c0d0: 6c61 7465 6420 676c 6f62 616c 2063 656e  lated global cen
-0000c0e0: 7472 6f69 6420 0a20 2020 2020 2020 2077  troid .        w
-0000c0f0: 696c 6c20 6265 2063 6163 6865 6420 696e  ill be cached in
-0000c100: 2073 656c 662e 5f63 656e 7472 6f69 645b   self._centroid[
-0000c110: 756e 6974 735d 2061 6e64 2072 6574 7572  units] and retur
-0000c120: 6e65 6420 6966 2063 616c 6c65 6420 6167  ned if called ag
-0000c130: 6169 6e2c 0a20 2020 2020 2020 2075 6e6c  ain,.        unl
-0000c140: 6573 7320 666f 7263 653d 5472 7565 2e0a  ess force=True..
-0000c150: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
-0000c160: 6574 6572 733a 2a2a 0a20 2020 2020 2020  eters:**.       
-0000c170: 200a 2020 2020 2020 2020 7369 6e67 6c65   .        single
-0000c180: 5f73 6c69 6365 203a 2062 6f6f 6c2c 2064  _slice : bool, d
-0000c190: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
-0000c1a0: 2020 2020 2020 2020 2049 6620 4661 6c73           If Fals
-0000c1b0: 652c 2074 6865 2067 6c6f 6261 6c20 3344  e, the global 3D
-0000c1c0: 2063 656e 7472 6f69 6420 6f66 2074 6865   centroid of the
-0000c1d0: 2065 6e74 6972 6520 524f 4920 7769 6c6c   entire ROI will
-0000c1e0: 2062 6520 7265 7475 726e 6564 3b0a 2020   be returned;.  
-0000c1f0: 2020 2020 2020 2020 2020 6f74 6865 7277            otherw
-0000c200: 6973 652c 2074 6865 2032 4420 6365 6e74  ise, the 2D cent
-0000c210: 726f 6964 206f 6e20 6120 7369 6e67 6c65  roid on a single
-0000c220: 2073 6c69 6365 2077 696c 6c20 6265 2072   slice will be r
-0000c230: 6574 7572 6e65 642e 0a0a 2020 2020 2020  eturned...      
-0000c240: 2020 7669 6577 203a 2073 7472 2c20 6465    view : str, de
-0000c250: 6661 756c 743d 2278 2d79 220a 2020 2020  fault="x-y".    
-0000c260: 2020 2020 2020 2020 4f72 6965 6e74 6174          Orientat
-0000c270: 696f 6e20 6f66 2073 6c69 6365 206f 6e20  ion of slice on 
-0000c280: 7768 6963 6820 746f 2067 6574 2063 656e  which to get cen
-0000c290: 7472 6f69 642e 204f 6e6c 7920 7573 6564  troid. Only used
-0000c2a0: 2069 6620 0a20 2020 2020 2020 2020 2020   if .           
-0000c2b0: 2073 696e 676c 655f 736c 6963 653d 5472   single_slice=Tr
-0000c2c0: 7565 2e20 4966 2075 7369 6e67 2c20 3c61  ue. If using, <a
-0000c2d0: 783e 206d 7573 7420 6265 2061 6e20 6178  x> must be an ax
-0000c2e0: 6973 2074 6861 7420 6c69 6573 2061 6c6f  is that lies alo
-0000c2f0: 6e67 0a20 2020 2020 2020 2020 2020 2074  ng.            t
-0000c300: 6865 2073 6c69 6365 2069 6e20 7468 6973  he slice in this
-0000c310: 206f 7269 656e 7461 7469 6f6e 2e0a 0a20   orientation... 
-0000c320: 2020 2020 2020 2073 6c20 3a20 696e 742c         sl : int,
-0000c330: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0000c340: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
-0000c350: 6e75 6d62 6572 2e20 4966 206e 6f6e 6520  number. If none 
-0000c360: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
-0000c370: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
-0000c380: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
-0000c390: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
-0000c3a0: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
-0000c3b0: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
-0000c3c0: 6620 7468 6520 524f 4920 7769 6c6c 2062  f the ROI will b
-0000c3d0: 6520 7573 6564 2e0a 0a20 2020 2020 2020  e used...       
-0000c3e0: 2069 6478 203a 2069 6e74 2c20 6465 6661   idx : int, defa
-0000c3f0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0000c400: 2020 2020 2041 7272 6179 2069 6e64 6578       Array index
-0000c410: 206f 6620 736c 6963 652e 2049 6620 6e6f   of slice. If no
-0000c420: 6e65 206f 6620 3c73 6c3e 2c20 3c69 6478  ne of <sl>, <idx
-0000c430: 3e20 6f72 203c 706f 733e 2061 7265 2073  > or <pos> are s
-0000c440: 7570 706c 6965 6420 6275 740a 2020 2020  upplied but.    
-0000c450: 2020 2020 2020 2020 3c73 696e 676c 655f          <single_
-0000c460: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
-0000c470: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
-0000c480: 6520 6f66 2074 6865 2052 4f49 2077 696c  e of the ROI wil
-0000c490: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
-0000c4a0: 2020 2020 706f 7320 3a20 666c 6f61 742c      pos : float,
-0000c4b0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0000c4c0: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
-0000c4d0: 706f 7369 7469 6f6e 2069 6e20 6d6d 2e20  position in mm. 
-0000c4e0: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
-0000c4f0: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
-0000c500: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
-0000c510: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
-0000c520: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
-0000c530: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
-0000c540: 2073 6c69 6365 206f 6620 7468 6520 524f   slice of the RO
-0000c550: 4920 7769 6c6c 2062 6520 7573 6564 2e0a  I will be used..
-0000c560: 0a20 2020 2020 2020 2075 6e69 7473 203a  .        units :
-0000c570: 2073 7472 2c20 6465 6661 756c 743d 226d   str, default="m
-0000c580: 6d22 0a20 2020 2020 2020 2020 2020 2055  m".            U
-0000c590: 6e69 7473 206f 6620 6365 6e74 726f 6964  nits of centroid
-0000c5a0: 2e20 4361 6e20 6265 2065 6974 6865 7220  . Can be either 
-0000c5b0: 6f66 3a0a 2020 2020 2020 2020 2020 2020  of:.            
-0000c5c0: 2020 2020 2d20 226d 6d22 3a20 7265 7475      - "mm": retu
-0000c5d0: 726e 2063 656e 7472 6f69 6420 706f 7369  rn centroid posi
-0000c5e0: 7469 6f6e 2069 6e20 6d69 6c6c 696d 6574  tion in millimet
-0000c5f0: 7265 732e 0a20 2020 2020 2020 2020 2020  res..           
-0000c600: 2020 2020 202d 2022 766f 7865 6c73 223a       - "voxels":
-0000c610: 2072 6574 7572 6e20 6365 6e74 726f 6964   return centroid
-0000c620: 2070 6f73 6974 696f 6e20 696e 2074 6572   position in ter
-0000c630: 6d73 206f 6620 6172 7261 7920 696e 6469  ms of array indi
-0000c640: 6365 732e 0a20 2020 2020 2020 2020 2020  ces..           
-0000c650: 2020 2020 202d 2022 736c 6963 6522 3a20       - "slice": 
-0000c660: 7265 7475 726e 2063 656e 7472 6f69 6420  return centroid 
-0000c670: 706f 7369 7469 6f6e 2069 6e20 7465 726d  position in term
-0000c680: 7320 6f66 2073 6c69 6365 206e 756d 6265  s of slice numbe
-0000c690: 7273 2e0a 0a20 2020 2020 2020 2020 2020  rs...           
-0000c6a0: 2049 6620 756e 6974 733d 2276 6f78 656c   If units="voxel
-0000c6b0: 7322 206f 7220 2273 6c69 6365 2220 6973  s" or "slice" is
-0000c6c0: 2072 6571 7565 7374 6564 2062 7574 2074   requested but t
-0000c6d0: 6869 7320 524f 4920 6f6e 6c79 2068 6173  his ROI only has
-0000c6e0: 200a 2020 2020 2020 2020 2020 2020 636f   .            co
-0000c6f0: 6e74 6f75 7273 2061 6e64 206e 6f20 6d61  ntours and no ma
-0000c700: 736b 2073 6861 7065 2f76 6f78 656c 2073  sk shape/voxel s
-0000c710: 697a 6520 696e 666f 726d 6174 696f 6e2c  ize information,
-0000c720: 2061 6e20 6572 726f 7220 7769 6c6c 2062   an error will b
-0000c730: 6520 0a20 2020 2020 2020 2020 2020 2072  e .            r
-0000c740: 6169 7365 6420 2875 6e6c 6573 7320 6178  aised (unless ax
-0000c750: 3d22 7a22 2c20 696e 2077 6869 6368 2063  ="z", in which c
-0000c760: 6173 6520 766f 7865 6c20 7369 7a65 2077  ase voxel size w
-0000c770: 696c 6c20 6265 2069 6e66 6572 7265 6420  ill be inferred 
-0000c780: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
-0000c790: 6d20 7370 6163 696e 6720 6265 7477 6565  m spacing betwee
-0000c7a0: 6e20 736c 6963 6573 292e 0a0a 2020 2020  n slices)...    
-0000c7b0: 2020 2020 6d65 7468 6f64 203a 2073 7472      method : str
-0000c7c0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0000c7d0: 2020 2020 2020 2020 2020 204d 6574 686f             Metho
-0000c7e0: 6420 746f 2075 7365 2066 6f72 2063 656e  d to use for cen
-0000c7f0: 7472 6f69 6420 6361 6c63 756c 6174 696f  troid calculatio
-0000c800: 6e2e 2043 616e 2062 653a 200a 2020 2020  n. Can be: .    
-0000c810: 2020 2020 2020 2020 2020 2020 2d20 2263              - "c
-0000c820: 6f6e 746f 7572 223a 2067 6574 2063 656e  ontour": get cen
-0000c830: 7472 6f69 6420 6f66 2073 6861 7065 6c79  troid of shapely
-0000c840: 2063 6f6e 746f 7572 2873 292e 0a20 2020   contour(s)..   
-0000c850: 2020 2020 2020 2020 2020 2020 202d 2022               - "
-0000c860: 6d61 736b 223a 2067 6574 2061 7665 7261  mask": get avera
-0000c870: 6765 2070 6f73 6974 696f 6e20 6f66 2076  ge position of v
-0000c880: 6f78 656c 7320 696e 2062 696e 6172 7920  oxels in binary 
-0000c890: 6d61 736b 2e0a 2020 2020 2020 2020 2020  mask..          
-0000c8a0: 2020 2020 2020 2d20 4e6f 6e65 3a20 7573        - None: us
-0000c8b0: 6520 7468 6520 6d65 7468 6f64 2073 6574  e the method set
-0000c8c0: 2069 6e20 7365 6c66 2e64 6566 6175 6c74   in self.default
-0000c8d0: 5f67 656f 6d5f 6d65 7468 6f64 2e0a 0a20  _geom_method... 
-0000c8e0: 2020 2020 2020 2066 6f72 6365 203a 2062         force : b
-0000c8f0: 6f6f 6c2c 2064 6566 6175 6c74 3d54 7275  ool, default=Tru
-0000c900: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
-0000c910: 2054 7275 652c 2074 6865 2067 6c6f 6261   True, the globa
-0000c920: 6c20 6365 6e74 726f 6964 2077 696c 6c20  l centroid will 
-0000c930: 616c 7761 7973 2062 6520 7265 6361 6c63  always be recalc
-0000c940: 756c 6174 6564 3b20 0a20 2020 2020 2020  ulated; .       
-0000c950: 2020 2020 206f 7468 6572 7769 7365 2c20       otherwise, 
-0000c960: 6974 2077 696c 6c20 6f6e 6c79 2062 6520  it will only be 
-0000c970: 6361 6c63 756c 6174 6564 2069 6620 6974  calculated if it
-0000c980: 2068 6173 206e 6f74 2079 6574 2062 6565   has not yet bee
-0000c990: 6e20 6361 6368 6564 200a 2020 2020 2020  n cached .      
-0000c9a0: 2020 2020 2020 696e 2073 656c 662e 5f76        in self._v
-0000c9b0: 6f6c 756d 652e 2020 4e6f 7465 2074 6861  olume.  Note tha
-0000c9c0: 7420 6966 2073 696e 676c 655f 736c 6963  t if single_slic
-0000c9d0: 653d 5472 7565 2c20 7468 6520 6365 6e74  e=True, the cent
-0000c9e0: 726f 6964 2077 696c 6c20 0a20 2020 2020  roid will .     
-0000c9f0: 2020 2020 2020 2061 6c77 6179 7320 6265         always be
-0000ca00: 2072 6563 616c 6375 6c61 7465 642e 0a20   recalculated.. 
-0000ca10: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0000ca20: 2020 2020 2320 4966 2067 6c6f 6261 6c20      # If global 
-0000ca30: 6365 6e74 726f 6964 2061 6c72 6561 6479  centroid already
-0000ca40: 2063 6163 6865 642c 2072 6574 7572 6e20   cached, return 
-0000ca50: 6361 6368 6564 2076 616c 7565 0a20 2020  cached value.   
-0000ca60: 2020 2020 2069 6620 6e6f 7420 7369 6e67       if not sing
-0000ca70: 6c65 5f73 6c69 6365 2061 6e64 206e 6f74  le_slice and not
-0000ca80: 2066 6f72 6365 3a0a 2020 2020 2020 2020   force:.        
-0000ca90: 2020 2020 6966 2068 6173 6174 7472 2873      if hasattr(s
-0000caa0: 656c 662c 2022 5f63 656e 7472 6f69 6422  elf, "_centroid"
-0000cab0: 2920 616e 6420 756e 6974 7320 696e 2073  ) and units in s
-0000cac0: 656c 662e 5f63 656e 7472 6f69 643a 0a20  elf._centroid:. 
-0000cad0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000cae0: 6574 7572 6e20 7365 6c66 2e5f 6365 6e74  eturn self._cent
-0000caf0: 726f 6964 5b75 6e69 7473 5d0a 0a20 2020  roid[units]..   
-0000cb00: 2020 2020 2023 2047 6574 2064 6566 6175       # Get defau
-0000cb10: 6c74 2073 6c69 6365 2061 6e64 206d 6574  lt slice and met
-0000cb20: 686f 640a 2020 2020 2020 2020 7365 6c66  hod.        self
-0000cb30: 2e6c 6f61 6428 290a 2020 2020 2020 2020  .load().        
-0000cb40: 6966 206d 6574 686f 6420 6973 204e 6f6e  if method is Non
-0000cb50: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
-0000cb60: 6574 686f 6420 3d20 7365 6c66 2e64 6566  ethod = self.def
-0000cb70: 6175 6c74 5f67 656f 6d5f 6d65 7468 6f64  ault_geom_method
-0000cb80: 0a20 2020 2020 2020 2069 6620 7369 6e67  .        if sing
-0000cb90: 6c65 5f73 6c69 6365 2061 6e64 2070 6f73  le_slice and pos
-0000cba0: 2069 7320 4e6f 6e65 2061 6e64 2073 6c20   is None and sl 
-0000cbb0: 6973 204e 6f6e 6520 616e 6420 6964 7820  is None and idx 
-0000cbc0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0000cbd0: 2020 2020 2069 6478 203d 2073 656c 662e       idx = self.
-0000cbe0: 6765 745f 6d69 645f 6964 7828 7669 6577  get_mid_idx(view
-0000cbf0: 290a 0a20 2020 2020 2020 2023 2049 6620  )..        # If 
-0000cc00: 7369 6e67 6c65 2073 6c69 6365 2072 6571  single slice req
-0000cc10: 7565 7374 6564 2061 6e64 206e 6f74 206f  uested and not o
-0000cc20: 6e20 6375 7272 656e 7420 736c 6963 652c  n current slice,
-0000cc30: 2072 6574 7572 6e20 4e6f 6e65 2c20 4e6f   return None, No
-0000cc40: 6e65 0a20 2020 2020 2020 2069 6620 7369  ne.        if si
-0000cc50: 6e67 6c65 5f73 6c69 6365 2061 6e64 206e  ngle_slice and n
-0000cc60: 6f74 2073 656c 662e 6f6e 5f73 6c69 6365  ot self.on_slice
-0000cc70: 2876 6965 772c 2073 6c3d 736c 2c20 6964  (view, sl=sl, id
-0000cc80: 783d 6964 782c 2070 6f73 3d70 6f73 293a  x=idx, pos=pos):
-0000cc90: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000cca0: 7572 6e20 6e70 2e61 7272 6179 285b 4e6f  urn np.array([No
-0000ccb0: 6e65 2c20 4e6f 6e65 5d29 0a0a 2020 2020  ne, None])..    
-0000ccc0: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
-0000ccd0: 6365 6e74 726f 6964 2066 726f 6d20 5368  centroid from Sh
-0000cce0: 6170 656c 7920 706f 6c79 676f 6e73 0a20  apely polygons. 
-0000ccf0: 2020 2020 2020 2063 656e 7472 6f69 6420         centroid 
-0000cd00: 3d20 7b7d 0a20 2020 2020 2020 2069 6620  = {}.        if 
-0000cd10: 6d65 7468 6f64 203d 3d20 2263 6f6e 746f  method == "conto
-0000cd20: 7572 223a 0a0a 2020 2020 2020 2020 2020  ur":..          
-0000cd30: 2020 2320 4765 7420 3244 206f 7220 3344    # Get 2D or 3D
-0000cd40: 2063 656e 7472 6f69 6473 2061 6e64 2061   centroids and a
-0000cd50: 7265 6173 206f 6620 6561 6368 2070 6f6c  reas of each pol
-0000cd60: 7967 6f6e 206f 6e20 7468 6520 6465 7369  ygon on the desi
-0000cd70: 7265 640a 2020 2020 2020 2020 2020 2020  red.            
-0000cd80: 2320 736c 6963 6528 7329 0a20 2020 2020  # slice(s).     
-0000cd90: 2020 2020 2020 2069 6620 7369 6e67 6c65         if single
-0000cda0: 5f73 6c69 6365 3a0a 2020 2020 2020 2020  _slice:.        
-0000cdb0: 2020 2020 2020 2020 706f 6c79 676f 6e73          polygons
-0000cdc0: 203d 2073 656c 662e 6765 745f 706f 6c79   = self.get_poly
-0000cdd0: 676f 6e73 5f6f 6e5f 736c 6963 6528 7669  gons_on_slice(vi
-0000cde0: 6577 2c20 736c 2c20 6964 782c 2070 6f73  ew, sl, idx, pos
-0000cdf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000ce00: 2020 6365 6e74 726f 6964 7320 3d20 5b5d    centroids = []
-0000ce10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ce20: 2061 7265 6173 203d 205b 5d0a 2020 2020   areas = [].    
-0000ce30: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000ce40: 7020 696e 2070 6f6c 7967 6f6e 733a 0a20  p in polygons:. 
-0000ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce60: 2020 2063 656e 7472 6f69 645f 7879 203d     centroid_xy =
-0000ce70: 2070 2e63 656e 7472 6f69 642e 7879 0a20   p.centroid.xy. 
-0000ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce90: 2020 2063 656e 7472 6f69 6473 2e61 7070     centroids.app
-0000cea0: 656e 6428 6e70 2e61 7272 6179 285b 0a20  end(np.array([. 
-0000ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cec0: 2020 2020 2020 2063 656e 7472 6f69 645f         centroid_
-0000ced0: 7879 5b30 5d5b 305d 2c20 6365 6e74 726f  xy[0][0], centro
-0000cee0: 6964 5f78 795b 315d 5b30 5d0a 2020 2020  id_xy[1][0].    
-0000cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf00: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
-0000cf10: 2020 2020 2020 2020 6172 6561 732e 6170          areas.ap
-0000cf20: 7065 6e64 2870 2e61 7265 6129 0a20 2020  pend(p.area).   
-0000cf30: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000cf40: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000cf50: 656e 7472 6f69 6473 203d 205b 5d0a 2020  entroids = [].  
-0000cf60: 2020 2020 2020 2020 2020 2020 2020 6172                ar
-0000cf70: 6561 7320 3d20 5b5d 0a20 2020 2020 2020  eas = [].       
-0000cf80: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
-0000cf90: 5f64 6963 7420 3d20 7365 6c66 2e67 6574  _dict = self.get
-0000cfa0: 5f70 6f6c 7967 6f6e 7328 290a 2020 2020  _polygons().    
-0000cfb0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000cfc0: 7a2c 2070 6f6c 7967 6f6e 7320 696e 2070  z, polygons in p
-0000cfd0: 6f6c 7967 6f6e 5f64 6963 742e 6974 656d  olygon_dict.item
-0000cfe0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0000cff0: 2020 2020 2020 2020 2066 6f72 2070 2069           for p i
-0000d000: 6e20 706f 6c79 676f 6e73 3a0a 2020 2020  n polygons:.    
-0000d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d020: 2020 2020 6365 6e74 726f 6964 5f78 7920      centroid_xy 
-0000d030: 3d20 702e 6365 6e74 726f 6964 2e78 790a  = p.centroid.xy.
-0000d040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d050: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
-0000d060: 732e 6170 7065 6e64 286e 702e 6172 7261  s.append(np.arra
-0000d070: 7928 5b0a 2020 2020 2020 2020 2020 2020  y([.            
-0000d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d090: 6365 6e74 726f 6964 5f78 795b 305d 5b30  centroid_xy[0][0
-0000d0a0: 5d2c 2063 656e 7472 6f69 645f 7879 5b31  ], centroid_xy[1
-0000d0b0: 5d5b 305d 2c20 7a0a 2020 2020 2020 2020  ][0], z.        
+00009620: 2020 2020 2020 2020 6d61 736b 5b69 782c          mask[ix,
+00009630: 2069 795d 203d 206f 7665 726c 6170 203e   iy] = overlap >
+00009640: 2073 656c 662e 6f76 6572 6c61 705f 6c65   self.overlap_le
+00009650: 7665 6c0a 0a20 2020 2020 2020 2020 2020  vel..           
+00009660: 2020 2020 2020 2020 2023 2041 6464 2074           # Add t
+00009670: 6f20 3344 206d 6173 6b0a 2020 2020 2020  o 3D mask.      
+00009680: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00009690: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+000096a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000096b0: 6d61 736b 2e64 6174 615b 3a2c 203a 2c20  mask.data[:, :, 
+000096c0: 697a 5d20 2b3d 206d 6173 6b2e 540a 2020  iz] += mask.T.  
+000096d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000096e0: 2020 6578 6365 7074 2049 6e64 6578 4572    except IndexEr
+000096f0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+00009700: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00009710: 730a 0a20 2020 2020 2020 2023 2043 6f6e  s..        # Con
+00009720: 7665 7274 2074 6f20 626f 6f6c 6561 6e20  vert to boolean 
+00009730: 6d61 736b 0a20 2020 2020 2020 2069 6620  mask.        if 
+00009740: 6861 7361 7474 7228 7365 6c66 2e6d 6173  hasattr(self.mas
+00009750: 6b2c 2022 6461 7461 2229 3a0a 2020 2020  k, "data"):.    
+00009760: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00009770: 656c 662e 6d61 736b 2e64 6174 612e 6474  elf.mask.data.dt
+00009780: 7970 6520 3d3d 2062 6f6f 6c3a 0a20 2020  ype == bool:.   
+00009790: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000097a0: 662e 6d61 736b 2e64 6174 6120 3d20 7365  f.mask.data = se
+000097b0: 6c66 2e6d 6173 6b2e 6461 7461 2e61 7374  lf.mask.data.ast
+000097c0: 7970 6528 626f 6f6c 290a 2020 2020 2020  ype(bool).      
+000097d0: 2020 2020 2020 7365 6c66 2e6c 6f61 6465        self.loade
+000097e0: 645f 6d61 736b 203d 2054 7275 650a 0a20  d_mask = True.. 
+000097f0: 2020 2020 2020 2023 2053 6574 206f 776e         # Set own
+00009800: 2067 656f 6d65 7472 6963 2070 726f 7065   geometric prope
+00009810: 7274 6965 7320 6672 6f6d 206d 6173 6b0a  rties from mask.
+00009820: 2020 2020 2020 2020 7365 6c66 2e76 6f78          self.vox
+00009830: 656c 5f73 697a 6520 3d20 7365 6c66 2e6d  el_size = self.m
+00009840: 6173 6b2e 6765 745f 766f 7865 6c5f 7369  ask.get_voxel_si
+00009850: 7a65 2829 0a20 2020 2020 2020 2073 656c  ze().        sel
+00009860: 662e 6f72 6967 696e 203d 2073 656c 662e  f.origin = self.
+00009870: 6d61 736b 2e67 6574 5f6f 7269 6769 6e28  mask.get_origin(
+00009880: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00009890: 6666 696e 6520 3d20 7365 6c66 2e6d 6173  ffine = self.mas
+000098a0: 6b2e 6765 745f 6166 6669 6e65 2829 0a20  k.get_affine(). 
+000098b0: 2020 2020 2020 2073 656c 662e 7368 6170         self.shap
+000098c0: 6520 3d20 7365 6c66 2e6d 6173 6b2e 6765  e = self.mask.ge
+000098d0: 745f 6461 7461 2829 2e73 6861 7065 0a0a  t_data().shape..
+000098e0: 2020 2020 6465 6620 6973 5f65 6d70 7479      def is_empty
+000098f0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00009900: 2222 2243 6865 636b 2077 6865 7468 6572  """Check whether
+00009910: 2074 6869 7320 524f 4920 6973 2065 6d70   this ROI is emp
+00009920: 7479 2e22 2222 0a0a 2020 2020 2020 2020  ty."""..        
+00009930: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
+00009940: 2020 2020 6966 2073 656c 662e 6465 6661      if self.defa
+00009950: 756c 745f 6765 6f6d 5f6d 6574 686f 6420  ult_geom_method 
+00009960: 3d3d 2022 636f 6e74 6f75 7222 3a0a 2020  == "contour":.  
+00009970: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00009980: 206e 6f74 2062 6f6f 6c28 6c65 6e28 7365   not bool(len(se
+00009990: 6c66 2e67 6574 5f63 6f6e 746f 7572 7328  lf.get_contours(
+000099a0: 2278 2d79 2229 2929 0a20 2020 2020 2020  "x-y"))).       
+000099b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000099c0: 2020 2072 6574 7572 6e20 6e6f 7420 6e70     return not np
+000099d0: 2e61 6e79 2873 656c 662e 6765 745f 6d61  .any(self.get_ma
+000099e0: 736b 2829 290a 0a20 2020 2064 6566 2072  sk())..    def r
+000099f0: 6573 616d 706c 6528 7365 6c66 2c20 2a61  esample(self, *a
+00009a00: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
+00009a10: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
+00009a20: 6174 655f 6d61 736b 2829 0a20 2020 2020  ate_mask().     
+00009a30: 2020 2073 656c 662e 6d61 736b 2e72 6573     self.mask.res
+00009a40: 616d 706c 6528 2a61 7267 732c 202a 2a6b  ample(*args, **k
+00009a50: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
+00009a60: 6d61 7463 685f 766f 7865 6c5f 7369 7a65  match_voxel_size
+00009a70: 2873 656c 662c 206f 7468 6572 2c20 2a61  (self, other, *a
+00009a80: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
+00009a90: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+00009aa0: 7374 616e 6365 286f 7468 6572 2c20 524f  stance(other, RO
+00009ab0: 4929 3a0a 2020 2020 2020 2020 2020 2020  I):.            
+00009ac0: 6f74 6865 722e 6372 6561 7465 5f6d 6173  other.create_mas
+00009ad0: 6b28 290a 2020 2020 2020 2020 2020 2020  k().            
+00009ae0: 6d61 736b 203d 206f 7468 6572 2e6d 6173  mask = other.mas
+00009af0: 6b0a 2020 2020 2020 2020 656c 7365 3a0a  k.        else:.
+00009b00: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+00009b10: 203d 206f 7468 6572 0a20 2020 2020 2020   = other.       
+00009b20: 2073 656c 662e 6372 6561 7465 5f6d 6173   self.create_mas
+00009b30: 6b28 290a 2020 2020 2020 2020 7365 6c66  k().        self
+00009b40: 2e6d 6173 6b2e 6d61 7463 685f 766f 7865  .mask.match_voxe
+00009b50: 6c5f 7369 7a65 286d 6173 6b2c 202a 6172  l_size(mask, *ar
+00009b60: 6773 2c20 2a2a 6b77 6172 6773 290a 0a20  gs, **kwargs).. 
+00009b70: 2020 2064 6566 2067 6574 5f73 6c69 6365     def get_slice
+00009b80: 2873 656c 662c 202a 6172 6773 2c20 666f  (self, *args, fo
+00009b90: 7263 655f 7374 616e 6461 7264 6973 653d  rce_standardise=
+00009ba0: 4661 6c73 652c 202a 2a6b 7761 7267 7329  False, **kwargs)
+00009bb0: 3a0a 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+00009bc0: 6372 6561 7465 5f6d 6173 6b28 290a 2020  create_mask().  
+00009bd0: 2020 2020 2020 6461 7461 203d 2073 656c        data = sel
+00009be0: 662e 6d61 736b 2e67 6574 5f73 6c69 6365  f.mask.get_slice
+00009bf0: 282a 6172 6773 2c20 666f 7263 655f 7374  (*args, force_st
+00009c00: 616e 6461 7264 6973 653d 666f 7263 655f  andardise=force_
+00009c10: 7374 616e 6461 7264 6973 652c 200a 2020  standardise, .  
+00009c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c40: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
+00009c50: 2020 2069 6620 6461 7461 2e64 7479 7065     if data.dtype
+00009c60: 2021 3d20 626f 6f6c 3a0a 2020 2020 2020   != bool:.      
+00009c70: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+00009c80: 612e 6173 7479 7065 2862 6f6f 6c29 0a20  a.astype(bool). 
+00009c90: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
+00009ca0: 7461 0a0a 2020 2020 6465 6620 6765 745f  ta..    def get_
+00009cb0: 726f 695f 736c 6963 6528 7365 6c66 2c20  roi_slice(self, 
+00009cc0: 7a5f 6672 6163 7469 6f6e 3d31 2c20 7375  z_fraction=1, su
+00009cd0: 6666 6978 3d4e 6f6e 6529 3a0a 2020 2020  ffix=None):.    
+00009ce0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00009cf0: 4765 7420 524f 4920 6f62 6a65 6374 2063  Get ROI object c
+00009d00: 6f72 7265 7370 6f6e 6469 6e67 2074 6f20  orresponding to 
+00009d10: 782d 7920 736c 6963 6520 7468 726f 7567  x-y slice throug
+00009d20: 6820 7468 6973 2052 4f49 2e0a 0a20 2020  h this ROI...   
+00009d30: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
+00009d40: 3a2a 2a0a 0a20 2020 2020 2020 207a 5f66  :**..        z_f
+00009d50: 7261 6374 696f 6e20 3a20 666c 6f61 742c  raction : float,
+00009d60: 2064 6566 6175 6c74 3d31 0a20 2020 2020   default=1.     
+00009d70: 2020 2020 2020 2050 6f73 6974 696f 6e20         Position 
+00009d80: 616c 6f6e 6720 7a20 6178 6973 2061 7420  along z axis at 
+00009d90: 7768 6963 6820 746f 2074 616b 6520 736c  which to take sl
+00009da0: 6963 6520 7468 726f 7567 6820 524f 492e  ice through ROI.
+00009db0: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+00009dc0: 2070 6f73 6974 696f 6e20 6973 2073 7065   position is spe
+00009dd0: 6369 6669 6564 2061 7320 7468 6520 6672  cified as the fr
+00009de0: 6163 7469 6f6e 616c 2064 6973 7461 6e63  actional distanc
+00009df0: 650a 2020 2020 2020 2020 2020 2020 6672  e.            fr
+00009e00: 6f6d 2074 6865 2052 4f49 2773 206d 6f73  om the ROI's mos
+00009e10: 742d 696e 6665 7269 6f72 2070 6f69 6e74  t-inferior point
+00009e20: 3a20 3020 636f 7272 6573 706f 6e64 7320  : 0 corresponds 
+00009e30: 746f 0a20 2020 2020 2020 2020 2020 2074  to.            t
+00009e40: 6865 206d 6f73 742d 696e 6665 7269 6f72  he most-inferior
+00009e50: 2070 6f69 6e74 2028 6c6f 7765 7374 207a   point (lowest z
+00009e60: 293b 2031 2063 6f72 7265 7370 6f6e 6473  ); 1 corresponds
+00009e70: 2074 6f20 7468 650a 2020 2020 2020 2020   to the.        
+00009e80: 2020 2020 6d6f 7374 2d73 7570 6572 696f      most-superio
+00009e90: 7220 706f 696e 7420 2868 6967 6865 7374  r point (highest
+00009ea0: 207a 292e 2020 5661 6c75 6573 2066 6f72   z).  Values for
+00009eb0: 207a 5f66 7261 6374 696f 6e0a 2020 2020   z_fraction.    
+00009ec0: 2020 2020 2020 2020 6f75 7473 6964 6520          outside 
+00009ed0: 7468 6520 696e 7465 7276 616c 205b 302c  the interval [0,
+00009ee0: 2031 5d20 7265 7375 6c74 2069 6e20 6120   1] result in a 
+00009ef0: 5275 6e74 696d 6545 7272 6f72 2e0a 0a20  RuntimeError... 
+00009f00: 2020 2073 7566 6669 7820 3a20 7374 722c     suffix : str,
+00009f10: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00009f20: 2020 2020 2020 5375 6666 6978 2074 6f20        Suffix to 
+00009f30: 6170 7065 6e64 2074 6f20 6f77 6e20 6e61  append to own na
+00009f40: 6d65 2c20 746f 2066 6f72 6d20 6e61 6d65  me, to form name
+00009f50: 206f 6620 6f75 7470 7574 2052 4f49 2e20   of output ROI. 
+00009f60: 2049 660a 2020 2020 2020 2020 4e6f 6e65   If.        None
+00009f70: 2c20 6170 7065 6e64 207a 5f66 7261 6374  , append z_fract
+00009f80: 696f 6e2c 2077 6974 6820 7661 6c75 6520  ion, with value 
+00009f90: 6769 7665 6e20 746f 2074 776f 2064 6563  given to two dec
+00009fa0: 696d 616c 2070 6c61 6365 732e 0a20 2020  imal places..   
+00009fb0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00009fc0: 2072 6574 7572 6e20 6765 745f 726f 695f   return get_roi_
+00009fd0: 736c 6963 6528 7365 6c66 2c20 7a5f 6672  slice(self, z_fr
+00009fe0: 6163 7469 6f6e 290a 0a20 2020 2064 6566  action)..    def
+00009ff0: 2067 6574 5f69 6e64 6963 6573 2873 656c   get_indices(sel
+0000a000: 662c 2076 6965 773d 2278 2d79 222c 206d  f, view="x-y", m
+0000a010: 6574 686f 643d 4e6f 6e65 293a 0a20 2020  ethod=None):.   
+0000a020: 2020 2020 2022 2222 4765 7420 6c69 7374       """Get list
+0000a030: 206f 6620 736c 6963 6520 696e 6469 6365   of slice indice
+0000a040: 7320 6f6e 2077 6869 6368 2074 6869 7320  s on which this 
+0000a050: 524f 4920 6578 6973 7473 2e22 2222 0a0a  ROI exists."""..
+0000a060: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+0000a070: 6428 290a 2020 2020 2020 2020 6966 2073  d().        if s
+0000a080: 656c 662e 656d 7074 793a 0a20 2020 2020  elf.empty:.     
+0000a090: 2020 2020 2020 2072 6574 7572 6e20 5b5d         return []
+0000a0a0: 0a0a 2020 2020 2020 2020 6966 206d 6574  ..        if met
+0000a0b0: 686f 6420 6973 204e 6f6e 653a 0a20 2020  hod is None:.   
+0000a0c0: 2020 2020 2020 2020 206d 6574 686f 6420           method 
+0000a0d0: 3d20 7365 6c66 2e64 6566 6175 6c74 5f67  = self.default_g
+0000a0e0: 656f 6d5f 6d65 7468 6f64 0a0a 2020 2020  eom_method..    
+0000a0f0: 2020 2020 6966 206d 6574 686f 6420 3d3d      if method ==
+0000a100: 2022 636f 6e74 6f75 7222 3a0a 2020 2020   "contour":.    
+0000a110: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+0000a120: 6973 7428 7365 6c66 2e67 6574 5f63 6f6e  ist(self.get_con
+0000a130: 746f 7572 7328 7669 6577 2c20 6964 785f  tours(view, idx_
+0000a140: 6173 5f6b 6579 3d54 7275 6529 2e6b 6579  as_key=True).key
+0000a150: 7328 2929 0a20 2020 2020 2020 2065 6c73  s()).        els
+0000a160: 653a 0a20 2020 2020 2020 2020 2020 2061  e:.            a
+0000a170: 7820 3d20 736b 7274 2e69 6d61 6765 2e5f  x = skrt.image._
+0000a180: 736c 6963 655f 6178 6573 5b76 6965 775d  slice_axes[view]
+0000a190: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
+0000a1a0: 6b20 3d20 7365 6c66 2e67 6574 5f6d 6173  k = self.get_mas
+0000a1b0: 6b28 7374 616e 6461 7264 6973 653d 5472  k(standardise=Tr
+0000a1c0: 7565 292e 7472 616e 7370 6f73 6528 312c  ue).transpose(1,
+0000a1d0: 2030 2c20 3229 0a20 2020 2020 2020 2020   0, 2).         
+0000a1e0: 2020 2072 6574 7572 6e20 6c69 7374 286e     return list(n
+0000a1f0: 702e 756e 6971 7565 286e 702e 6172 6777  p.unique(np.argw
+0000a200: 6865 7265 286d 6173 6b29 5b3a 2c20 6178  here(mask)[:, ax
+0000a210: 5d29 290a 0a20 2020 2064 6566 2067 6574  ]))..    def get
+0000a220: 5f6d 6964 5f69 6478 2873 656c 662c 2076  _mid_idx(self, v
+0000a230: 6965 773d 2278 2d79 222c 202a 2a6b 7761  iew="x-y", **kwa
+0000a240: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
+0000a250: 2247 6574 2063 656e 7472 616c 2073 6c69  "Get central sli
+0000a260: 6365 2069 6e64 6578 206f 6620 7468 6973  ce index of this
+0000a270: 2052 4f49 2069 6e20 6120 6769 7665 6e20   ROI in a given 
+0000a280: 6f72 6965 6e74 6174 696f 6e2e 2222 220a  orientation.""".
+0000a290: 0a20 2020 2020 2020 2069 6e64 6963 6573  .        indices
+0000a2a0: 203d 2073 656c 662e 6765 745f 696e 6469   = self.get_indi
+0000a2b0: 6365 7328 7669 6577 2c20 2a2a 6b77 6172  ces(view, **kwar
+0000a2c0: 6773 290a 2020 2020 2020 2020 6966 206e  gs).        if n
+0000a2d0: 6f74 206c 656e 2869 6e64 6963 6573 293a  ot len(indices):
+0000a2e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000a2f0: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
+0000a300: 206d 6964 203d 2069 6e74 286c 656e 2869   mid = int(len(i
+0000a310: 6e64 6963 6573 2920 2f20 3229 0a20 2020  ndices) / 2).   
+0000a320: 2020 2020 2072 6574 7572 6e20 696e 6469       return indi
+0000a330: 6365 735b 6d69 645d 0a0a 2020 2020 6465  ces[mid]..    de
+0000a340: 6620 6964 785f 746f 5f70 6f73 2873 656c  f idx_to_pos(sel
+0000a350: 662c 2069 6478 2c20 6178 2c20 7374 616e  f, idx, ax, stan
+0000a360: 6461 7264 6973 653d 5472 7565 293a 0a20  dardise=True):. 
+0000a370: 2020 2020 2020 2022 2222 436f 6e76 6572         """Conver
+0000a380: 7420 616e 2061 7272 6179 2069 6e64 6578  t an array index
+0000a390: 2074 6f20 6120 706f 7369 7469 6f6e 2069   to a position i
+0000a3a0: 6e20 6d6d 2061 6c6f 6e67 2061 2067 6976  n mm along a giv
+0000a3b0: 656e 2061 7869 732e 2222 220a 0a20 2020  en axis."""..   
+0000a3c0: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
+0000a3d0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0000a3e0: 662e 636f 6e74 6f75 7273 5f6f 6e6c 793a  f.contours_only:
+0000a3f0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000a400: 5573 6520 7365 6c66 2e69 6d61 6765 2773  Use self.image's
+0000a410: 2063 6f6e 7665 7273 696f 6e20 6675 6e63   conversion func
+0000a420: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+0000a430: 2069 6620 7365 6c66 2e69 6d61 6765 2069   if self.image i
+0000a440: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000a450: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000a460: 726e 2073 656c 662e 696d 6167 652e 6964  rn self.image.id
+0000a470: 785f 746f 5f70 6f73 2869 6478 2c20 6178  x_to_pos(idx, ax
+0000a480: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+0000a490: 204f 7468 6572 7769 7365 2063 6f75 6e74   Otherwise count
+0000a4a0: 206e 756d 6265 7220 6f66 207a 2073 6c69   number of z sli
+0000a4b0: 6365 7320 696e 2063 6f6e 746f 7572 7320  ces in contours 
+0000a4c0: 6469 6374 0a20 2020 2020 2020 2020 2020  dict.           
+0000a4d0: 2023 2049 6620 696e 6465 7820 646f 6573   # If index does
+0000a4e0: 206e 6f74 2063 6f72 7265 7370 6f6e 6420   not correspond 
+0000a4f0: 746f 2061 2073 6c69 6365 2c20 7265 7475  to a slice, retu
+0000a500: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
+0000a510: 2020 2020 656c 6966 2061 7820 696e 205b      elif ax in [
+0000a520: 227a 222c 2032 5d3a 0a20 2020 2020 2020  "z", 2]:.       
+0000a530: 2020 2020 2020 2020 2063 6f6e 7665 7273           convers
+0000a540: 696f 6e20 3d20 7b69 3a20 7020 666f 7220  ion = {i: p for 
+0000a550: 692c 2070 2069 6e20 0a20 2020 2020 2020  i, p in .       
+0000a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a570: 2020 2020 2020 2065 6e75 6d65 7261 7465         enumerate
+0000a580: 2873 656c 662e 6765 745f 636f 6e74 6f75  (self.get_contou
+0000a590: 7273 2822 782d 7922 292e 6b65 7973 2829  rs("x-y").keys()
+0000a5a0: 297d 0a20 2020 2020 2020 2020 2020 2020  )}.             
+0000a5b0: 2020 2072 6574 7572 6e20 636f 6e76 6572     return conver
+0000a5c0: 7369 6f6e 2e67 6574 2869 6478 2c20 4e6f  sion.get(idx, No
+0000a5d0: 6e65 290a 0a20 2020 2020 2020 2020 2020  ne)..           
+0000a5e0: 2023 204f 7468 6572 7769 7365 2c20 6e6f   # Otherwise, no
+0000a5f0: 7420 706f 7373 6962 6c65 2074 6f20 636f  t possible to co
+0000a600: 6e76 6572 7420 782f 7920 706f 696e 7473  nvert x/y points
+0000a610: 2074 6f20 696e 6469 6365 730a 2020 2020   to indices.    
+0000a620: 2020 2020 2020 2020 2320 6672 6f6d 2063          # from c
+0000a630: 6f6e 746f 7572 7320 616c 6f6e 650a 2020  ontours alone.  
+0000a640: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a660: 7072 696e 7428 2257 6172 6e69 6e67 3a20  print("Warning: 
+0000a670: 6361 6e6e 6f74 2063 6f6e 7665 7274 2069  cannot convert i
+0000a680: 6e64 6578 2074 6f20 706f 7369 7469 6f6e  ndex to position
+0000a690: 2069 6e20 7468 6520 782f 7920 220a 2020   in the x/y ".  
+0000a6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6b0: 2020 2020 2264 6972 6563 7469 6f6e 7320      "directions 
+0000a6c0: 7769 7468 6f75 7420 6173 736f 6369 6174  without associat
+0000a6d0: 6564 2069 6d61 6765 2067 656f 6d65 7472  ed image geometr
+0000a6e0: 7921 2229 0a20 2020 2020 2020 2020 2020  y!").           
+0000a6f0: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+0000a700: 2020 2020 2023 204f 7468 6572 7769 7365       # Otherwise
+0000a710: 2c20 7472 7920 746f 2075 7365 206d 6173  , try to use mas
+0000a720: 6b20 6f72 2069 6d61 6765 2773 2063 6f6e  k or image's con
+0000a730: 7665 7273 696f 6e0a 2020 2020 2020 2020  version.        
+0000a740: 656c 6966 2073 656c 662e 6d61 736b 2069  elif self.mask i
+0000a750: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000a760: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000a770: 656c 662e 6d61 736b 2e69 6478 5f74 6f5f  elf.mask.idx_to_
+0000a780: 706f 7328 6964 782c 2061 7829 0a20 2020  pos(idx, ax).   
+0000a790: 2020 2020 2065 6c69 6620 7365 6c66 2e69       elif self.i
+0000a7a0: 6d61 6765 2069 7320 6e6f 7420 4e6f 6e65  mage is not None
+0000a7b0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000a7c0: 7475 726e 2073 656c 662e 696d 6167 652e  turn self.image.
+0000a7d0: 6964 785f 746f 5f70 6f73 2869 6478 2c20  idx_to_pos(idx, 
+0000a7e0: 6178 290a 0a20 2020 2020 2020 2023 2045  ax)..        # E
+0000a7f0: 6c73 652c 2074 7279 2074 6f20 6361 6c63  lse, try to calc
+0000a800: 756c 6174 6520 6672 6f6d 206f 776e 2067  ulate from own g
+0000a810: 656f 6d65 7472 6963 2070 726f 7065 7274  eometric propert
+0000a820: 6965 730a 2020 2020 2020 2020 656c 7365  ies.        else
+0000a830: 3a0a 2020 2020 2020 2020 2020 2020 695f  :.            i_
+0000a840: 6178 203d 2073 6b72 742e 696d 6167 652e  ax = skrt.image.
+0000a850: 5f61 7865 732e 696e 6465 7828 6178 2920  _axes.index(ax) 
+0000a860: 6966 2061 7820 696e 2073 6b72 742e 696d  if ax in skrt.im
+0000a870: 6167 652e 5f61 7865 7320 656c 7365 2061  age._axes else a
+0000a880: 780a 2020 2020 2020 2020 2020 2020 7265  x.            re
+0000a890: 7475 726e 2073 656c 662e 6f72 6967 696e  turn self.origin
+0000a8a0: 5b69 5f61 785d 202b 2069 6478 202a 2073  [i_ax] + idx * s
+0000a8b0: 656c 662e 766f 7865 6c5f 7369 7a65 5b69  elf.voxel_size[i
+0000a8c0: 5f61 785d 0a0a 2020 2020 6465 6620 706f  _ax]..    def po
+0000a8d0: 735f 746f 5f69 6478 2873 656c 662c 2070  s_to_idx(self, p
+0000a8e0: 6f73 2c20 6178 2c20 7265 7475 726e 5f69  os, ax, return_i
+0000a8f0: 6e74 3d54 7275 652c 202a 2a6b 7761 7267  nt=True, **kwarg
+0000a900: 7329 3a0a 2020 2020 2020 2020 2222 2243  s):.        """C
+0000a910: 6f6e 7665 7274 2061 2070 6f73 6974 696f  onvert a positio
+0000a920: 6e20 696e 206d 6d20 746f 2061 6e20 6172  n in mm to an ar
+0000a930: 7261 7920 696e 6465 7820 616c 6f6e 6720  ray index along 
+0000a940: 6120 6769 7665 6e20 6178 6973 2e22 2222  a given axis."""
+0000a950: 0a0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+0000a960: 6f61 6428 290a 2020 2020 2020 2020 6966  oad().        if
+0000a970: 2073 656c 662e 636f 6e74 6f75 7273 5f6f   self.contours_o
+0000a980: 6e6c 793a 0a0a 2020 2020 2020 2020 2020  nly:..          
+0000a990: 2020 2320 5573 6520 7365 6c66 2e69 6d61    # Use self.ima
+0000a9a0: 6765 2773 2063 6f6e 7665 7273 696f 6e20  ge's conversion 
+0000a9b0: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
+0000a9c0: 2020 2020 2069 6620 7365 6c66 2e69 6d61       if self.ima
+0000a9d0: 6765 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ge is not None:.
+0000a9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a9f0: 7265 7475 726e 2073 656c 662e 696d 6167  return self.imag
+0000aa00: 652e 706f 735f 746f 5f69 6478 2870 6f73  e.pos_to_idx(pos
+0000aa10: 2c20 6178 2c20 7265 7475 726e 5f69 6e74  , ax, return_int
+0000aa20: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+0000aa30: 204f 7468 6572 7769 7365 2063 6f75 6e74   Otherwise count
+0000aa40: 206e 756d 6265 7220 6f66 207a 2073 6c69   number of z sli
+0000aa50: 6365 7320 696e 2063 6f6e 746f 7572 7320  ces in contours 
+0000aa60: 6469 6374 0a20 2020 2020 2020 2020 2020  dict.           
+0000aa70: 2023 2049 6620 706f 7369 7469 6f6e 2064   # If position d
+0000aa80: 6f65 7320 6e6f 7420 636f 7272 6573 706f  oes not correspo
+0000aa90: 6e64 2074 6f20 6120 736c 6965 2c20 7265  nd to a slie, re
+0000aaa0: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
+0000aab0: 2020 2020 2020 656c 6966 2061 7820 696e        elif ax in
+0000aac0: 205b 227a 222c 2032 5d3a 0a20 2020 2020   ["z", 2]:.     
+0000aad0: 2020 2020 2020 2020 2020 2063 6f6e 7665             conve
+0000aae0: 7273 696f 6e20 3d20 7b70 3a20 6920 666f  rsion = {p: i fo
+0000aaf0: 7220 692c 2070 2069 6e20 0a20 2020 2020  r i, p in .     
+0000ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab10: 2020 2020 2020 2020 2065 6e75 6d65 7261           enumera
+0000ab20: 7465 2873 656c 662e 6765 745f 636f 6e74  te(self.get_cont
+0000ab30: 6f75 7273 2822 782d 7922 292e 6b65 7973  ours("x-y").keys
+0000ab40: 2829 297d 0a20 2020 2020 2020 2020 2020  ())}.           
+0000ab50: 2020 2020 2069 6478 203d 2063 6f6e 7665       idx = conve
+0000ab60: 7273 696f 6e2e 6765 7428 706f 732c 204e  rsion.get(pos, N
+0000ab70: 6f6e 6529 0a0a 2020 2020 2020 2020 2020  one)..          
+0000ab80: 2020 2320 4f74 6865 7277 6973 652c 206e    # Otherwise, n
+0000ab90: 6f74 2070 6f73 7369 626c 6520 746f 2063  ot possible to c
+0000aba0: 6f6e 7665 7274 2078 2f79 2070 6f69 6e74  onvert x/y point
+0000abb0: 7320 746f 2069 6e64 6963 6573 0a20 2020  s to indices.   
+0000abc0: 2020 2020 2020 2020 2023 2066 726f 6d20           # from 
+0000abd0: 636f 6e74 6f75 7273 2061 6c6f 6e65 0a20  contours alone. 
+0000abe0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000abf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ac00: 2070 7269 6e74 2822 5761 726e 696e 673a   print("Warning:
+0000ac10: 2063 616e 6e6f 7420 636f 6e76 6572 7420   cannot convert 
+0000ac20: 706f 7369 7469 6f6e 2074 6f20 696e 6465  position to inde
+0000ac30: 7820 696e 2074 6865 2078 2f79 2022 0a20  x in the x/y ". 
+0000ac40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac50: 2020 2020 2022 6469 7265 6374 696f 6e73       "directions
+0000ac60: 2077 6974 686f 7574 2061 7373 6f63 6961   without associa
+0000ac70: 7465 6420 696d 6167 6520 6765 6f6d 6574  ted image geomet
+0000ac80: 7279 2122 290a 2020 2020 2020 2020 2020  ry!").          
+0000ac90: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+0000aca0: 2020 2020 2020 2020 2069 6620 7265 7475           if retu
+0000acb0: 726e 5f69 6e74 2061 6e64 2069 6478 2069  rn_int and idx i
+0000acc0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000acd0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000ace0: 726e 2072 6f75 6e64 2869 6478 290a 2020  rn round(idx).  
+0000acf0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad10: 7265 7475 726e 2069 6478 0a0a 2020 2020  return idx..    
+0000ad20: 2020 2020 2320 4f74 6865 7277 6973 652c      # Otherwise,
+0000ad30: 2074 7279 2074 6f20 7573 6520 6d61 736b   try to use mask
+0000ad40: 206f 7220 696d 6167 6527 7320 636f 6e76   or image's conv
+0000ad50: 6572 7369 6f6e 0a20 2020 2020 2020 2065  ersion.        e
+0000ad60: 6c69 6620 7365 6c66 2e6d 6173 6b20 6973  lif self.mask is
+0000ad70: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000ad80: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000ad90: 6c66 2e6d 6173 6b2e 706f 735f 746f 5f69  lf.mask.pos_to_i
+0000ada0: 6478 2870 6f73 2c20 6178 2c20 7265 7475  dx(pos, ax, retu
+0000adb0: 726e 5f69 6e74 290a 2020 2020 2020 2020  rn_int).        
+0000adc0: 656c 6966 2073 656c 662e 696d 6167 6520  elif self.image 
+0000add0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000ade0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000adf0: 7365 6c66 2e69 6d61 6765 2e70 6f73 5f74  self.image.pos_t
+0000ae00: 6f5f 6964 7828 706f 732c 2061 782c 2072  o_idx(pos, ax, r
+0000ae10: 6574 7572 6e5f 696e 7429 0a0a 2020 2020  eturn_int)..    
+0000ae20: 2020 2020 2320 456c 7365 2c20 7472 7920      # Else, try 
+0000ae30: 746f 2063 616c 6375 6c61 7465 2066 726f  to calculate fro
+0000ae40: 6d20 6f77 6e20 6765 6f6d 7472 6963 2070  m own geomtric p
+0000ae50: 726f 7065 7274 6965 730a 2020 2020 2020  roperties.      
+0000ae60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000ae70: 2020 2020 695f 6178 203d 2073 6b72 742e      i_ax = skrt.
+0000ae80: 696d 6167 652e 5f61 7865 732e 696e 6465  image._axes.inde
+0000ae90: 7828 6178 2920 6966 2061 7820 696e 2073  x(ax) if ax in s
+0000aea0: 6b72 742e 696d 6167 652e 5f61 7865 7320  krt.image._axes 
+0000aeb0: 656c 7365 2061 780a 2020 2020 2020 2020  else ax.        
+0000aec0: 2020 2020 6964 7820 3d20 2870 6f73 202d      idx = (pos -
+0000aed0: 2073 656c 662e 6f72 6967 696e 5b69 5f61   self.origin[i_a
+0000aee0: 785d 2920 2f20 7365 6c66 2e76 6f78 656c  x]) / self.voxel
+0000aef0: 5f73 697a 655b 695f 6178 5d0a 2020 2020  _size[i_ax].    
+0000af00: 2020 2020 2020 2020 6966 2072 6574 7572          if retur
+0000af10: 6e5f 696e 743a 0a20 2020 2020 2020 2020  n_int:.         
+0000af20: 2020 2020 2020 2072 6574 7572 6e20 726f         return ro
+0000af30: 756e 6428 6964 7829 0a20 2020 2020 2020  und(idx).       
+0000af40: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000af50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000af60: 6e20 6964 780a 0a20 2020 2064 6566 2069  n idx..    def i
+0000af70: 6478 5f74 6f5f 736c 6963 6528 7365 6c66  dx_to_slice(self
+0000af80: 2c20 6964 782c 2061 7829 3a0a 2020 2020  , idx, ax):.    
+0000af90: 2020 2020 2222 2243 6f6e 7665 7274 2061      """Convert a
+0000afa0: 6e20 6172 7261 7920 696e 6465 7820 746f  n array index to
+0000afb0: 2061 2073 6c69 6365 206e 756d 6265 7220   a slice number 
+0000afc0: 616c 6f6e 6720 6120 6769 7665 6e20 6178  along a given ax
+0000afd0: 6973 2e22 2222 0a0a 2020 2020 2020 2020  is."""..        
+0000afe0: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
+0000aff0: 2020 2020 6966 2073 656c 662e 636f 6e74      if self.cont
+0000b000: 6f75 7273 5f6f 6e6c 7920 6f72 2028 7365  ours_only or (se
+0000b010: 6c66 2e6d 6173 6b20 6973 204e 6f6e 6520  lf.mask is None 
+0000b020: 616e 6420 7365 6c66 2e69 6d61 6765 2069  and self.image i
+0000b030: 7320 4e6f 6e65 293a 0a0a 2020 2020 2020  s None):..      
+0000b040: 2020 2020 2020 2320 436f 756e 7420 6e75        # Count nu
+0000b050: 6d62 6572 206f 6620 7a20 736c 6963 6573  mber of z slices
+0000b060: 2069 6e20 636f 6e74 6f75 7273 2064 6963   in contours dic
+0000b070: 740a 2020 2020 2020 2020 2020 2020 6966  t.            if
+0000b080: 2061 7820 696e 205b 227a 222c 2032 5d3a   ax in ["z", 2]:
+0000b090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b0a0: 206e 7a20 3d20 7365 6c66 2e67 6574 5f6e   nz = self.get_n
+0000b0b0: 7a5f 636f 6e74 6f75 7273 2829 0a20 2020  z_contours().   
+0000b0c0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000b0d0: 7572 6e20 6e7a 202d 2069 6478 0a20 2020  urn nz - idx.   
+0000b0e0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000b0f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000b100: 6574 7572 6e20 6964 7820 2b20 310a 0a20  eturn idx + 1.. 
+0000b110: 2020 2020 2020 2023 2054 7279 2074 6f20         # Try to 
+0000b120: 7573 6520 6d61 736b 206f 7220 696d 6167  use mask or imag
+0000b130: 6527 7320 636f 6e76 6572 7369 6f6e 0a20  e's conversion. 
+0000b140: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+0000b150: 2e6d 6173 6b20 6973 206e 6f74 204e 6f6e  .mask is not Non
+0000b160: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000b170: 6574 7572 6e20 7365 6c66 2e6d 6173 6b2e  eturn self.mask.
+0000b180: 6964 785f 746f 5f73 6c69 6365 2869 6478  idx_to_slice(idx
+0000b190: 2c20 6178 290a 2020 2020 2020 2020 656c  , ax).        el
+0000b1a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000b1b0: 7265 7475 726e 2073 656c 662e 696d 6167  return self.imag
+0000b1c0: 652e 6964 785f 746f 5f73 6c69 6365 2869  e.idx_to_slice(i
+0000b1d0: 6478 2c20 6178 290a 0a20 2020 2064 6566  dx, ax)..    def
+0000b1e0: 2073 6c69 6365 5f74 6f5f 6964 7828 7365   slice_to_idx(se
+0000b1f0: 6c66 2c20 736c 2c20 6178 293a 0a20 2020  lf, sl, ax):.   
+0000b200: 2020 2020 2022 2222 436f 6e76 6572 7420       """Convert 
+0000b210: 6120 736c 6963 6520 6e75 6d62 6572 2074  a slice number t
+0000b220: 6f20 616e 2061 7272 6179 2069 6e64 6578  o an array index
+0000b230: 2e22 2222 0a0a 2020 2020 2020 2020 7365  ."""..        se
+0000b240: 6c66 2e6c 6f61 6428 290a 2020 2020 2020  lf.load().      
+0000b250: 2020 6966 2073 656c 662e 636f 6e74 6f75    if self.contou
+0000b260: 7273 5f6f 6e6c 7920 6f72 2028 7365 6c66  rs_only or (self
+0000b270: 2e6d 6173 6b20 6973 204e 6f6e 6520 616e  .mask is None an
+0000b280: 6420 7365 6c66 2e69 6d61 6765 2069 7320  d self.image is 
+0000b290: 4e6f 6e65 293a 0a0a 2020 2020 2020 2020  None):..        
+0000b2a0: 2020 2020 2320 436f 756e 7420 6e75 6d62      # Count numb
+0000b2b0: 6572 206f 6620 7a20 736c 6963 6573 2069  er of z slices i
+0000b2c0: 6e20 636f 6e74 6f75 7273 2064 6963 740a  n contours dict.
+0000b2d0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+0000b2e0: 7820 696e 205b 227a 222c 2032 5d3a 0a20  x in ["z", 2]:. 
+0000b2f0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0000b300: 7a20 3d20 7365 6c66 2e67 6574 5f6e 7a5f  z = self.get_nz_
+0000b310: 636f 6e74 6f75 7273 2829 0a20 2020 2020  contours().     
+0000b320: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000b330: 6e20 6e7a 202d 2073 6c0a 2020 2020 2020  n nz - sl.      
+0000b340: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000b350: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000b360: 726e 2073 6c20 2d20 310a 0a20 2020 2020  rn sl - 1..     
+0000b370: 2020 2023 2054 7279 2074 6f20 7573 6520     # Try to use 
+0000b380: 6d61 736b 206f 7220 696d 6167 6527 7320  mask or image's 
+0000b390: 636f 6e76 6572 7369 6f6e 0a20 2020 2020  conversion.     
+0000b3a0: 2020 2065 6c69 6620 7365 6c66 2e6d 6173     elif self.mas
+0000b3b0: 6b20 6973 206e 6f74 204e 6f6e 653a 0a20  k is not None:. 
+0000b3c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000b3d0: 6e20 7365 6c66 2e6d 6173 6b2e 736c 6963  n self.mask.slic
+0000b3e0: 655f 746f 5f69 6478 2873 6c2c 2061 7829  e_to_idx(sl, ax)
+0000b3f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000b400: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000b410: 6e20 7365 6c66 2e69 6d61 6765 2e73 6c69  n self.image.sli
+0000b420: 6365 5f74 6f5f 6964 7828 736c 2c20 6178  ce_to_idx(sl, ax
+0000b430: 290a 0a20 2020 2064 6566 2070 6f73 5f74  )..    def pos_t
+0000b440: 6f5f 736c 6963 6528 7365 6c66 2c20 706f  o_slice(self, po
+0000b450: 732c 2061 782c 2072 6574 7572 6e5f 696e  s, ax, return_in
+0000b460: 743d 5472 7565 2c20 7374 616e 6461 7264  t=True, standard
+0000b470: 6973 653d 5472 7565 293a 0a20 2020 2020  ise=True):.     
+0000b480: 2020 2022 2222 436f 6e76 6572 7420 6120     """Convert a 
+0000b490: 706f 7369 7469 6f6e 2069 6e20 6d6d 2074  position in mm t
+0000b4a0: 6f20 6120 736c 6963 6520 6e75 6d62 6572  o a slice number
+0000b4b0: 2061 6c6f 6e67 2061 2067 6976 656e 2061   along a given a
+0000b4c0: 7869 732e 2222 220a 0a20 2020 2020 2020  xis."""..       
+0000b4d0: 2072 6574 7572 6e20 736b 7274 2e69 6d61   return skrt.ima
+0000b4e0: 6765 2e49 6d61 6765 2e70 6f73 5f74 6f5f  ge.Image.pos_to_
+0000b4f0: 736c 6963 6528 7365 6c66 2c20 706f 732c  slice(self, pos,
+0000b500: 2061 782c 2072 6574 7572 6e5f 696e 7429   ax, return_int)
+0000b510: 0a0a 2020 2020 6465 6620 736c 6963 655f  ..    def slice_
+0000b520: 746f 5f70 6f73 2873 656c 662c 2073 6c2c  to_pos(self, sl,
+0000b530: 2061 782c 2073 7461 6e64 6172 6469 7365   ax, standardise
+0000b540: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
+0000b550: 2222 2243 6f6e 7665 7274 2061 2073 6c69  """Convert a sli
+0000b560: 6365 206e 756d 6265 7220 746f 2061 2070  ce number to a p
+0000b570: 6f73 6974 696f 6e20 696e 206d 6d20 616c  osition in mm al
+0000b580: 6f6e 6720 6120 6769 7665 6e20 6178 6973  ong a given axis
+0000b590: 2e22 2222 0a0a 2020 2020 2020 2020 7265  ."""..        re
+0000b5a0: 7475 726e 2073 6b72 742e 696d 6167 652e  turn skrt.image.
+0000b5b0: 496d 6167 652e 736c 6963 655f 746f 5f70  Image.slice_to_p
+0000b5c0: 6f73 2873 656c 662c 2073 6c2c 2061 7829  os(self, sl, ax)
+0000b5d0: 0a0a 2020 2020 6465 6620 6765 745f 6964  ..    def get_id
+0000b5e0: 7828 7365 6c66 2c20 7669 6577 2c20 736c  x(self, view, sl
+0000b5f0: 3d4e 6f6e 652c 2069 6478 3d4e 6f6e 652c  =None, idx=None,
+0000b600: 2070 6f73 3d4e 6f6e 6529 3a0a 2020 2020   pos=None):.    
+0000b610: 2020 2020 2222 2247 6574 2061 6e20 6172      """Get an ar
+0000b620: 7261 7920 696e 6465 7820 6672 6f6d 2065  ray index from e
+0000b630: 6974 6865 7220 6120 736c 6963 6520 6e75  ither a slice nu
+0000b640: 6d62 6572 2c20 696e 6465 782c 206f 720a  mber, index, or.
+0000b650: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
+0000b660: 2e22 2222 0a0a 2020 2020 2020 2020 7265  ."""..        re
+0000b670: 7475 726e 2073 6b72 742e 696d 6167 652e  turn skrt.image.
+0000b680: 496d 6167 652e 6765 745f 6964 7828 7365  Image.get_idx(se
+0000b690: 6c66 2c20 7669 6577 2c20 736c 3d73 6c2c  lf, view, sl=sl,
+0000b6a0: 2069 6478 3d69 6478 2c20 706f 733d 706f   idx=idx, pos=po
+0000b6b0: 7329 0a0a 2020 2020 6465 6620 6f6e 5f73  s)..    def on_s
+0000b6c0: 6c69 6365 2873 656c 662c 2076 6965 772c  lice(self, view,
+0000b6d0: 2073 6c3d 4e6f 6e65 2c20 6964 783d 4e6f   sl=None, idx=No
+0000b6e0: 6e65 2c20 706f 733d 4e6f 6e65 293a 0a20  ne, pos=None):. 
+0000b6f0: 2020 2020 2020 2022 2222 4368 6563 6b20         """Check 
+0000b700: 7768 6574 6865 7220 7468 6973 2052 4f49  whether this ROI
+0000b710: 2065 7869 7374 7320 6f6e 2061 2067 6976   exists on a giv
+0000b720: 656e 2073 6c69 6365 2e22 2222 0a0a 2020  en slice."""..  
+0000b730: 2020 2020 2020 6966 2073 6c20 6973 204e        if sl is N
+0000b740: 6f6e 6520 616e 6420 6964 7820 6973 204e  one and idx is N
+0000b750: 6f6e 6520 616e 6420 706f 7320 6973 204e  one and pos is N
+0000b760: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000b770: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0000b780: 2020 2020 2020 6964 7820 3d20 7365 6c66        idx = self
+0000b790: 2e67 6574 5f69 6478 2876 6965 772c 2073  .get_idx(view, s
+0000b7a0: 6c2c 2069 6478 2c20 706f 7329 0a20 2020  l, idx, pos).   
+0000b7b0: 2020 2020 2069 6620 6964 7820 6973 204e       if idx is N
+0000b7c0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000b7d0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0000b7e0: 2020 2020 2020 7265 7475 726e 2069 6478        return idx
+0000b7f0: 2069 6e20 7365 6c66 2e67 6574 5f69 6e64   in self.get_ind
+0000b800: 6963 6573 2876 6965 7729 0a0a 2020 2020  ices(view)..    
+0000b810: 6465 6620 696e 7465 7270 6f6c 6174 655f  def interpolate_
+0000b820: 706f 696e 7473 2873 656c 662c 206e 5f70  points(self, n_p
+0000b830: 6f69 6e74 3d4e 6f6e 652c 2064 7879 3d4e  oint=None, dxy=N
+0000b840: 6f6e 652c 0a20 2020 2020 2020 2073 6d6f  one,.        smo
+0000b850: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
+0000b860: 743d 3029 3a0a 2020 2020 2020 2020 2727  t=0):.        ''
+0000b870: 270a 2020 2020 2020 2020 5265 7475 726e  '.        Return
+0000b880: 206e 6577 2052 4f49 206f 626a 6563 742c   new ROI object,
+0000b890: 2077 6974 6820 696e 7465 7270 6f6c 6174   with interpolat
+0000b8a0: 6564 2063 6f6e 746f 7572 2070 6f69 6e74  ed contour point
+0000b8b0: 732e 0a0a 2020 2020 2020 2020 2a2a 5061  s...        **Pa
+0000b8c0: 7261 6d65 7465 7273 3a2a 2a0a 0a20 2020  rameters:**..   
+0000b8d0: 2020 2020 206e 5f70 6f69 6e74 203a 2069       n_point : i
+0000b8e0: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
+0000b8f0: 0a20 2020 2020 2020 2020 2020 204e 756d  .            Num
+0000b900: 6265 7220 6f66 2070 6f69 6e74 7320 7065  ber of points pe
+0000b910: 7220 636f 6e74 6f75 722c 2061 6674 6572  r contour, after
+0000b920: 2069 6e74 6572 706f 6c61 7469 6f6e 2e20   interpolation. 
+0000b930: 2054 6869 7320 6d75 7374 0a20 2020 2020   This must.     
+0000b940: 2020 2020 2020 2062 6520 7365 7420 746f         be set to
+0000b950: 204e 6f6e 6520 666f 7220 6478 7920 746f   None for dxy to
+0000b960: 2062 6520 636f 6e73 6964 6572 6564 2e0a   be considered..
+0000b970: 0a20 2020 2020 2020 2064 7879 203a 2066  .        dxy : f
+0000b980: 6c6f 6174 2c20 6465 6661 756c 743d 4e6f  loat, default=No
+0000b990: 6e65 0a20 2020 2020 2020 2020 2020 2041  ne.            A
+0000b9a0: 7070 726f 7869 6d61 7465 2064 6973 7461  pproximate dista
+0000b9b0: 6e63 6520 7265 7175 6972 6564 2062 6574  nce required bet
+0000b9c0: 7765 656e 2063 6f6e 746f 7572 2070 6f69  ween contour poi
+0000b9d0: 6e74 732e 2020 5468 6973 2069 7320 7461  nts.  This is ta
+0000b9e0: 6b65 6e0a 2020 2020 2020 2020 2020 2020  ken.            
+0000b9f0: 696e 746f 2061 6363 6f75 6e74 206f 6e6c  into account onl
+0000ba00: 7920 6966 206e 5f70 6f69 6e74 2069 7320  y if n_point is 
+0000ba10: 7365 7420 746f 204e 6f6e 652e 2020 466f  set to None.  Fo
+0000ba20: 7220 6120 636f 6e74 6f75 7220 6f66 0a20  r a contour of. 
+0000ba30: 2020 2020 2020 2020 2020 206c 656e 6774             lengt
+0000ba40: 6820 636f 6e74 6f75 725f 6c65 6e67 7468  h contour_length
+0000ba50: 2c20 7468 6520 6e75 6d62 6572 206f 6620  , the number of 
+0000ba60: 636f 6e74 6f75 7220 706f 696e 7473 2069  contour points i
+0000ba70: 7320 7468 656e 2074 616b 656e 0a20 2020  s then taken.   
+0000ba80: 2020 2020 2020 2020 2074 6f20 6265 206d           to be m
+0000ba90: 6178 2869 6e74 2863 6f6e 746f 7572 5f6c  ax(int(contour_l
+0000baa0: 656e 6774 6820 2f20 6478 7929 2c20 3329  ength / dxy), 3)
+0000bab0: 2e20 200a 0a20 2020 2020 2020 2073 6d6f  .  ..        smo
+0000bac0: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
+0000bad0: 7420 3a20 666c 6f61 742c 2064 6566 6175  t : float, defau
+0000bae0: 6c74 3d30 0a20 2020 2020 2020 2020 2020  lt=0.           
+0000baf0: 2050 6172 616d 6574 6572 2064 6574 6572   Parameter deter
+0000bb00: 6d69 6e69 6e67 2074 6865 2073 6d6f 6f74  mining the smoot
+0000bb10: 686e 6573 7320 6f66 2074 6865 2042 2d73  hness of the B-s
+0000bb20: 706c 696e 6520 6375 7276 6520 7573 6564  pline curve used
+0000bb30: 0a20 2020 2020 2020 2020 2020 2069 6e20  .            in 
+0000bb40: 636f 6e74 6f75 7220 6170 7072 6f78 696d  contour approxim
+0000bb50: 6174 696f 6e20 666f 7220 696e 7465 7270  ation for interp
+0000bb60: 6f6c 6174 696f 6e2e 2020 5468 6520 7072  olation.  The pr
+0000bb70: 6f64 7563 7420 6f66 0a20 2020 2020 2020  oduct of.       
+0000bb80: 2020 2020 2073 6d6f 6f74 686e 6573 735f       smoothness_
+0000bb90: 7065 725f 706f 696e 7420 616e 6420 7468  per_point and th
+0000bba0: 6520 6e75 6d62 6572 206f 6620 636f 6e74  e number of cont
+0000bbb0: 6f75 7220 706f 696e 7473 2028 7370 6563  our points (spec
+0000bbc0: 6966 6965 640a 2020 2020 2020 2020 2020  ified.          
+0000bbd0: 2020 6469 7265 6374 6c79 2076 6961 206e    directly via n
+0000bbe0: 5f70 6f69 6e74 2c20 6f72 2069 6e64 6972  _point, or indir
+0000bbf0: 6563 746c 7920 7669 6120 6478 7929 2063  ectly via dxy) c
+0000bc00: 6f72 7265 7370 6f6e 6473 2074 6f20 7468  orresponds to th
+0000bc10: 650a 2020 2020 2020 2020 2020 2020 7061  e.            pa
+0000bc20: 7261 6d65 7465 7220 7320 6f66 2073 6369  rameter s of sci
+0000bc30: 7079 2e69 6e74 6572 706f 6c61 7465 2e73  py.interpolate.s
+0000bc40: 706c 7072 6570 202d 2073 6565 2064 6f63  plprep - see doc
+0000bc50: 756d 656e 7461 7469 6f6e 2061 743a 0a20  umentation at:. 
+0000bc60: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0000bc70: 2020 2020 6874 7470 733a 2f2f 7363 6970      https://scip
+0000bc80: 792e 6769 7468 7562 2e69 6f2f 6465 7664  y.github.io/devd
+0000bc90: 6f63 732f 7265 6665 7265 6e63 652f 6765  ocs/reference/ge
+0000bca0: 6e65 7261 7465 642f 7363 6970 792e 696e  nerated/scipy.in
+0000bcb0: 7465 7270 6f6c 6174 652e 7370 6c70 7265  terpolate.splpre
+0000bcc0: 702e 6874 6d6c 2373 6369 7079 2e69 6e74  p.html#scipy.int
+0000bcd0: 6572 706f 6c61 7465 2e73 706c 7072 6570  erpolate.splprep
+0000bce0: 0a0a 2020 2020 2020 2020 2020 2020 4120  ..            A 
+0000bcf0: 736d 6f6f 7468 6e65 7373 5f70 6572 5f70  smoothness_per_p
+0000bd00: 6f69 6e74 206f 6620 3020 666f 7263 6573  oint of 0 forces
+0000bd10: 2074 6865 2042 2d73 706c 696e 6520 746f   the B-spline to
+0000bd20: 2070 6173 7320 7468 726f 7567 680a 2020   pass through.  
+0000bd30: 2020 2020 2020 2020 2020 616c 6c20 6f66            all of
+0000bd40: 2074 6865 2070 7265 2d69 6e74 6572 706f   the pre-interpo
+0000bd50: 6c61 7469 6f6e 2063 6f6e 746f 7572 2070  lation contour p
+0000bd60: 6f69 6e74 732e 0a20 2020 2020 2020 2027  oints..        '
+0000bd70: 2727 0a0a 2020 2020 2020 2020 6e65 775f  ''..        new_
+0000bd80: 636f 6e74 6f75 7273 203d 207b 7d0a 2020  contours = {}.  
+0000bd90: 2020 2020 2020 666f 7220 7a2c 2063 6f6e        for z, con
+0000bda0: 746f 7572 7320 696e 2073 656c 662e 6765  tours in self.ge
+0000bdb0: 745f 636f 6e74 6f75 7273 2829 2e69 7465  t_contours().ite
+0000bdc0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+0000bdd0: 2020 6e65 775f 636f 6e74 6f75 7273 5b7a    new_contours[z
+0000bde0: 5d20 3d20 5b5d 0a20 2020 2020 2020 2020  ] = [].         
+0000bdf0: 2020 2066 6f72 2063 6f6e 746f 7572 2069     for contour i
+0000be00: 6e20 636f 6e74 6f75 7273 3a0a 2020 2020  n contours:.    
+0000be10: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0000be20: 636f 6e74 6f75 7220 3d20 696e 7465 7270  contour = interp
+0000be30: 6f6c 6174 655f 706f 696e 7473 5f73 696e  olate_points_sin
+0000be40: 676c 655f 636f 6e74 6f75 7228 0a20 2020  gle_contour(.   
+0000be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be60: 2020 2020 2063 6f6e 746f 7572 2c20 6e5f       contour, n_
+0000be70: 706f 696e 742c 2064 7879 2c20 736d 6f6f  point, dxy, smoo
+0000be80: 7468 6e65 7373 5f70 6572 5f70 6f69 6e74  thness_per_point
+0000be90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000bea0: 2020 6e65 775f 636f 6e74 6f75 7273 5b7a    new_contours[z
+0000beb0: 5d2e 6170 7065 6e64 286e 6577 5f63 6f6e  ].append(new_con
+0000bec0: 746f 7572 290a 0a20 2020 2020 2020 2023  tour)..        #
+0000bed0: 2043 6c6f 6e65 2073 656c 662c 2074 6865   Clone self, the
+0000bee0: 6e20 636c 6561 7220 6d61 736b 2061 6e64  n clear mask and
+0000bef0: 2072 6573 6574 2063 6f6e 746f 7572 7320   reset contours 
+0000bf00: 6f66 2063 6c6f 6e65 0a20 2020 2020 2020  of clone.       
+0000bf10: 2072 6f69 203d 2052 4f49 2873 656c 6629   roi = ROI(self)
+0000bf20: 0a20 2020 2020 2020 2072 6f69 2e69 6e70  .        roi.inp
+0000bf30: 7574 5f63 6f6e 746f 7572 7320 3d20 6e65  ut_contours = ne
+0000bf40: 775f 636f 6e74 6f75 7273 0a20 2020 2020  w_contours.     
+0000bf50: 2020 2072 6f69 2e63 6f6e 746f 7572 7320     roi.contours 
+0000bf60: 3d20 7b22 782d 7922 3a20 6e65 775f 636f  = {"x-y": new_co
+0000bf70: 6e74 6f75 7273 7d0a 2020 2020 2020 2020  ntours}.        
+0000bf80: 726f 692e 6c6f 6164 6564 5f6d 6173 6b20  roi.loaded_mask 
+0000bf90: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+0000bfa0: 726f 692e 6d61 736b 203d 204e 6f6e 650a  roi.mask = None.
+0000bfb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000bfc0: 726f 690a 0a20 2020 2064 6566 2067 6574  roi..    def get
+0000bfd0: 5f63 656e 7472 6f69 6428 0a20 2020 2020  _centroid(.     
+0000bfe0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0000bff0: 2076 6965 773d 2278 2d79 222c 0a20 2020   view="x-y",.   
+0000c000: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
+0000c010: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
+0000c020: 2073 6c3d 4e6f 6e65 2c0a 2020 2020 2020   sl=None,.      
+0000c030: 2020 6964 783d 4e6f 6e65 2c0a 2020 2020    idx=None,.    
+0000c040: 2020 2020 706f 733d 4e6f 6e65 2c0a 2020      pos=None,.  
+0000c050: 2020 2020 2020 756e 6974 733d 226d 6d22        units="mm"
+0000c060: 2c0a 2020 2020 2020 2020 6d65 7468 6f64  ,.        method
+0000c070: 3d4e 6f6e 652c 0a20 2020 2020 2020 2066  =None,.        f
+0000c080: 6f72 6365 3d54 7275 652c 0a20 2020 2029  orce=True,.    )
+0000c090: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
+0000c0a0: 2065 6974 6865 7220 3344 2067 6c6f 6261   either 3D globa
+0000c0b0: 6c20 6365 6e74 726f 6964 2070 6f73 6974  l centroid posit
+0000c0c0: 696f 6e20 6f72 2032 4420 6365 6e74 726f  ion or 2D centro
+0000c0d0: 6964 2070 6f73 6974 696f 6e20 6f6e 200a  id position on .
+0000c0e0: 2020 2020 2020 2020 6120 7369 6e67 6c65          a single
+0000c0f0: 2073 6c69 6365 2e20 4966 2073 696e 676c   slice. If singl
+0000c100: 655f 736c 6963 653d 4661 6c73 652c 2074  e_slice=False, t
+0000c110: 6865 2063 616c 6375 6c61 7465 6420 676c  he calculated gl
+0000c120: 6f62 616c 2063 656e 7472 6f69 6420 0a20  obal centroid . 
+0000c130: 2020 2020 2020 2077 696c 6c20 6265 2063         will be c
+0000c140: 6163 6865 6420 696e 2073 656c 662e 5f63  ached in self._c
+0000c150: 656e 7472 6f69 645b 756e 6974 735d 2061  entroid[units] a
+0000c160: 6e64 2072 6574 7572 6e65 6420 6966 2063  nd returned if c
+0000c170: 616c 6c65 6420 6167 6169 6e2c 0a20 2020  alled again,.   
+0000c180: 2020 2020 2075 6e6c 6573 7320 666f 7263       unless forc
+0000c190: 653d 5472 7565 2e0a 0a20 2020 2020 2020  e=True...       
+0000c1a0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+0000c1b0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0000c1c0: 2020 7369 6e67 6c65 5f73 6c69 6365 203a    single_slice :
+0000c1d0: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
+0000c1e0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+0000c1f0: 2049 6620 4661 6c73 652c 2074 6865 2067   If False, the g
+0000c200: 6c6f 6261 6c20 3344 2063 656e 7472 6f69  lobal 3D centroi
+0000c210: 6420 6f66 2074 6865 2065 6e74 6972 6520  d of the entire 
+0000c220: 524f 4920 7769 6c6c 2062 6520 7265 7475  ROI will be retu
+0000c230: 726e 6564 3b0a 2020 2020 2020 2020 2020  rned;.          
+0000c240: 2020 6f74 6865 7277 6973 652c 2074 6865    otherwise, the
+0000c250: 2032 4420 6365 6e74 726f 6964 206f 6e20   2D centroid on 
+0000c260: 6120 7369 6e67 6c65 2073 6c69 6365 2077  a single slice w
+0000c270: 696c 6c20 6265 2072 6574 7572 6e65 642e  ill be returned.
+0000c280: 0a0a 2020 2020 2020 2020 7669 6577 203a  ..        view :
+0000c290: 2073 7472 2c20 6465 6661 756c 743d 2278   str, default="x
+0000c2a0: 2d79 220a 2020 2020 2020 2020 2020 2020  -y".            
+0000c2b0: 4f72 6965 6e74 6174 696f 6e20 6f66 2073  Orientation of s
+0000c2c0: 6c69 6365 206f 6e20 7768 6963 6820 746f  lice on which to
+0000c2d0: 2067 6574 2063 656e 7472 6f69 642e 204f   get centroid. O
+0000c2e0: 6e6c 7920 7573 6564 2069 6620 0a20 2020  nly used if .   
+0000c2f0: 2020 2020 2020 2020 2073 696e 676c 655f           single_
+0000c300: 736c 6963 653d 5472 7565 2e20 4966 2075  slice=True. If u
+0000c310: 7369 6e67 2c20 3c61 783e 206d 7573 7420  sing, <ax> must 
+0000c320: 6265 2061 6e20 6178 6973 2074 6861 7420  be an axis that 
+0000c330: 6c69 6573 2061 6c6f 6e67 0a20 2020 2020  lies along.     
+0000c340: 2020 2020 2020 2074 6865 2073 6c69 6365         the slice
+0000c350: 2069 6e20 7468 6973 206f 7269 656e 7461   in this orienta
+0000c360: 7469 6f6e 2e0a 0a20 2020 2020 2020 2073  tion...        s
+0000c370: 6c20 3a20 696e 742c 2064 6566 6175 6c74  l : int, default
+0000c380: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0000c390: 2020 536c 6963 6520 6e75 6d62 6572 2e20    Slice number. 
+0000c3a0: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
+0000c3b0: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
+0000c3c0: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
+0000c3d0: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
+0000c3e0: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
+0000c3f0: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
+0000c400: 2073 6c69 6365 206f 6620 7468 6520 524f   slice of the RO
+0000c410: 4920 7769 6c6c 2062 6520 7573 6564 2e0a  I will be used..
+0000c420: 0a20 2020 2020 2020 2069 6478 203a 2069  .        idx : i
+0000c430: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
+0000c440: 0a20 2020 2020 2020 2020 2020 2041 7272  .            Arr
+0000c450: 6179 2069 6e64 6578 206f 6620 736c 6963  ay index of slic
+0000c460: 652e 2049 6620 6e6f 6e65 206f 6620 3c73  e. If none of <s
+0000c470: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
+0000c480: 733e 2061 7265 2073 7570 706c 6965 6420  s> are supplied 
+0000c490: 6275 740a 2020 2020 2020 2020 2020 2020  but.            
+0000c4a0: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
+0000c4b0: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
+0000c4c0: 7261 6c20 736c 6963 6520 6f66 2074 6865  ral slice of the
+0000c4d0: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
+0000c4e0: 642e 0a0a 2020 2020 2020 2020 706f 7320  d...        pos 
+0000c4f0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+0000c500: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0000c510: 2020 536c 6963 6520 706f 7369 7469 6f6e    Slice position
+0000c520: 2069 6e20 6d6d 2e20 4966 206e 6f6e 6520   in mm. If none 
+0000c530: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
+0000c540: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
+0000c550: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
+0000c560: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
+0000c570: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
+0000c580: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
+0000c590: 6620 7468 6520 524f 4920 7769 6c6c 2062  f the ROI will b
+0000c5a0: 6520 7573 6564 2e0a 0a20 2020 2020 2020  e used...       
+0000c5b0: 2075 6e69 7473 203a 2073 7472 2c20 6465   units : str, de
+0000c5c0: 6661 756c 743d 226d 6d22 0a20 2020 2020  fault="mm".     
+0000c5d0: 2020 2020 2020 2055 6e69 7473 206f 6620         Units of 
+0000c5e0: 6365 6e74 726f 6964 2e20 4361 6e20 6265  centroid. Can be
+0000c5f0: 2065 6974 6865 7220 6f66 3a0a 2020 2020   either of:.    
+0000c600: 2020 2020 2020 2020 2020 2020 2d20 226d              - "m
+0000c610: 6d22 3a20 7265 7475 726e 2063 656e 7472  m": return centr
+0000c620: 6f69 6420 706f 7369 7469 6f6e 2069 6e20  oid position in 
+0000c630: 6d69 6c6c 696d 6574 7265 732e 0a20 2020  millimetres..   
+0000c640: 2020 2020 2020 2020 2020 2020 202d 2022               - "
+0000c650: 766f 7865 6c73 223a 2072 6574 7572 6e20  voxels": return 
+0000c660: 6365 6e74 726f 6964 2070 6f73 6974 696f  centroid positio
+0000c670: 6e20 696e 2074 6572 6d73 206f 6620 6172  n in terms of ar
+0000c680: 7261 7920 696e 6469 6365 732e 0a20 2020  ray indices..   
+0000c690: 2020 2020 2020 2020 2020 2020 202d 2022               - "
+0000c6a0: 736c 6963 6522 3a20 7265 7475 726e 2063  slice": return c
+0000c6b0: 656e 7472 6f69 6420 706f 7369 7469 6f6e  entroid position
+0000c6c0: 2069 6e20 7465 726d 7320 6f66 2073 6c69   in terms of sli
+0000c6d0: 6365 206e 756d 6265 7273 2e0a 0a20 2020  ce numbers...   
+0000c6e0: 2020 2020 2020 2020 2049 6620 756e 6974           If unit
+0000c6f0: 733d 2276 6f78 656c 7322 206f 7220 2273  s="voxels" or "s
+0000c700: 6c69 6365 2220 6973 2072 6571 7565 7374  lice" is request
+0000c710: 6564 2062 7574 2074 6869 7320 524f 4920  ed but this ROI 
+0000c720: 6f6e 6c79 2068 6173 200a 2020 2020 2020  only has .      
+0000c730: 2020 2020 2020 636f 6e74 6f75 7273 2061        contours a
+0000c740: 6e64 206e 6f20 6d61 736b 2073 6861 7065  nd no mask shape
+0000c750: 2f76 6f78 656c 2073 697a 6520 696e 666f  /voxel size info
+0000c760: 726d 6174 696f 6e2c 2061 6e20 6572 726f  rmation, an erro
+0000c770: 7220 7769 6c6c 2062 6520 0a20 2020 2020  r will be .     
+0000c780: 2020 2020 2020 2072 6169 7365 6420 2875         raised (u
+0000c790: 6e6c 6573 7320 6178 3d22 7a22 2c20 696e  nless ax="z", in
+0000c7a0: 2077 6869 6368 2063 6173 6520 766f 7865   which case voxe
+0000c7b0: 6c20 7369 7a65 2077 696c 6c20 6265 2069  l size will be i
+0000c7c0: 6e66 6572 7265 6420 0a20 2020 2020 2020  nferred .       
+0000c7d0: 2020 2020 2066 726f 6d20 7370 6163 696e       from spacin
+0000c7e0: 6720 6265 7477 6565 6e20 736c 6963 6573  g between slices
+0000c7f0: 292e 0a0a 2020 2020 2020 2020 6d65 7468  )...        meth
+0000c800: 6f64 203a 2073 7472 2c20 6465 6661 756c  od : str, defaul
+0000c810: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+0000c820: 2020 204d 6574 686f 6420 746f 2075 7365     Method to use
+0000c830: 2066 6f72 2063 656e 7472 6f69 6420 6361   for centroid ca
+0000c840: 6c63 756c 6174 696f 6e2e 2043 616e 2062  lculation. Can b
+0000c850: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
+0000c860: 2020 2020 2d20 2263 6f6e 746f 7572 223a      - "contour":
+0000c870: 2067 6574 2063 656e 7472 6f69 6420 6f66   get centroid of
+0000c880: 2073 6861 7065 6c79 2063 6f6e 746f 7572   shapely contour
+0000c890: 2873 292e 0a20 2020 2020 2020 2020 2020  (s)..           
+0000c8a0: 2020 2020 202d 2022 6d61 736b 223a 2067       - "mask": g
+0000c8b0: 6574 2061 7665 7261 6765 2070 6f73 6974  et average posit
+0000c8c0: 696f 6e20 6f66 2076 6f78 656c 7320 696e  ion of voxels in
+0000c8d0: 2062 696e 6172 7920 6d61 736b 2e0a 2020   binary mask..  
+0000c8e0: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
+0000c8f0: 4e6f 6e65 3a20 7573 6520 7468 6520 6d65  None: use the me
+0000c900: 7468 6f64 2073 6574 2069 6e20 7365 6c66  thod set in self
+0000c910: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
+0000c920: 7468 6f64 2e0a 0a20 2020 2020 2020 2066  thod...        f
+0000c930: 6f72 6365 203a 2062 6f6f 6c2c 2064 6566  orce : bool, def
+0000c940: 6175 6c74 3d54 7275 650a 2020 2020 2020  ault=True.      
+0000c950: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
+0000c960: 6865 2067 6c6f 6261 6c20 6365 6e74 726f  he global centro
+0000c970: 6964 2077 696c 6c20 616c 7761 7973 2062  id will always b
+0000c980: 6520 7265 6361 6c63 756c 6174 6564 3b20  e recalculated; 
+0000c990: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
+0000c9a0: 6572 7769 7365 2c20 6974 2077 696c 6c20  erwise, it will 
+0000c9b0: 6f6e 6c79 2062 6520 6361 6c63 756c 6174  only be calculat
+0000c9c0: 6564 2069 6620 6974 2068 6173 206e 6f74  ed if it has not
+0000c9d0: 2079 6574 2062 6565 6e20 6361 6368 6564   yet been cached
+0000c9e0: 200a 2020 2020 2020 2020 2020 2020 696e   .            in
+0000c9f0: 2073 656c 662e 5f76 6f6c 756d 652e 2020   self._volume.  
+0000ca00: 4e6f 7465 2074 6861 7420 6966 2073 696e  Note that if sin
+0000ca10: 676c 655f 736c 6963 653d 5472 7565 2c20  gle_slice=True, 
+0000ca20: 7468 6520 6365 6e74 726f 6964 2077 696c  the centroid wil
+0000ca30: 6c20 0a20 2020 2020 2020 2020 2020 2061  l .            a
+0000ca40: 6c77 6179 7320 6265 2072 6563 616c 6375  lways be recalcu
+0000ca50: 6c61 7465 642e 0a20 2020 2020 2020 2022  lated..        "
+0000ca60: 2222 0a0a 2020 2020 2020 2020 2320 4966  ""..        # If
+0000ca70: 2067 6c6f 6261 6c20 6365 6e74 726f 6964   global centroid
+0000ca80: 2061 6c72 6561 6479 2063 6163 6865 642c   already cached,
+0000ca90: 2072 6574 7572 6e20 6361 6368 6564 2076   return cached v
+0000caa0: 616c 7565 0a20 2020 2020 2020 2069 6620  alue.        if 
+0000cab0: 6e6f 7420 7369 6e67 6c65 5f73 6c69 6365  not single_slice
+0000cac0: 2061 6e64 206e 6f74 2066 6f72 6365 3a0a   and not force:.
+0000cad0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+0000cae0: 6173 6174 7472 2873 656c 662c 2022 5f63  asattr(self, "_c
+0000caf0: 656e 7472 6f69 6422 2920 616e 6420 756e  entroid") and un
+0000cb00: 6974 7320 696e 2073 656c 662e 5f63 656e  its in self._cen
+0000cb10: 7472 6f69 643a 0a20 2020 2020 2020 2020  troid:.         
+0000cb20: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000cb30: 6c66 2e5f 6365 6e74 726f 6964 5b75 6e69  lf._centroid[uni
+0000cb40: 7473 5d0a 0a20 2020 2020 2020 2023 2047  ts]..        # G
+0000cb50: 6574 2064 6566 6175 6c74 2073 6c69 6365  et default slice
+0000cb60: 2061 6e64 206d 6574 686f 640a 2020 2020   and method.    
+0000cb70: 2020 2020 7365 6c66 2e6c 6f61 6428 290a      self.load().
+0000cb80: 2020 2020 2020 2020 6966 206d 6574 686f          if metho
+0000cb90: 6420 6973 204e 6f6e 653a 0a20 2020 2020  d is None:.     
+0000cba0: 2020 2020 2020 206d 6574 686f 6420 3d20         method = 
+0000cbb0: 7365 6c66 2e64 6566 6175 6c74 5f67 656f  self.default_geo
+0000cbc0: 6d5f 6d65 7468 6f64 0a20 2020 2020 2020  m_method.       
+0000cbd0: 2069 6620 7369 6e67 6c65 5f73 6c69 6365   if single_slice
+0000cbe0: 2061 6e64 2070 6f73 2069 7320 4e6f 6e65   and pos is None
+0000cbf0: 2061 6e64 2073 6c20 6973 204e 6f6e 6520   and sl is None 
+0000cc00: 616e 6420 6964 7820 6973 204e 6f6e 653a  and idx is None:
+0000cc10: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
+0000cc20: 203d 2073 656c 662e 6765 745f 6d69 645f   = self.get_mid_
+0000cc30: 6964 7828 7669 6577 290a 0a20 2020 2020  idx(view)..     
+0000cc40: 2020 2023 2049 6620 7369 6e67 6c65 2073     # If single s
+0000cc50: 6c69 6365 2072 6571 7565 7374 6564 2061  lice requested a
+0000cc60: 6e64 206e 6f74 206f 6e20 6375 7272 656e  nd not on curren
+0000cc70: 7420 736c 6963 652c 2072 6574 7572 6e20  t slice, return 
+0000cc80: 4e6f 6e65 2c20 4e6f 6e65 0a20 2020 2020  None, None.     
+0000cc90: 2020 2069 6620 7369 6e67 6c65 5f73 6c69     if single_sli
+0000cca0: 6365 2061 6e64 206e 6f74 2073 656c 662e  ce and not self.
+0000ccb0: 6f6e 5f73 6c69 6365 2876 6965 772c 2073  on_slice(view, s
+0000ccc0: 6c3d 736c 2c20 6964 783d 6964 782c 2070  l=sl, idx=idx, p
+0000ccd0: 6f73 3d70 6f73 293a 0a20 2020 2020 2020  os=pos):.       
+0000cce0: 2020 2020 2072 6574 7572 6e20 6e70 2e61       return np.a
+0000ccf0: 7272 6179 285b 4e6f 6e65 2c20 4e6f 6e65  rray([None, None
+0000cd00: 5d29 0a0a 2020 2020 2020 2020 2320 4361  ])..        # Ca
+0000cd10: 6c63 756c 6174 6520 6365 6e74 726f 6964  lculate centroid
+0000cd20: 2066 726f 6d20 5368 6170 656c 7920 706f   from Shapely po
+0000cd30: 6c79 676f 6e73 0a20 2020 2020 2020 2063  lygons.        c
+0000cd40: 656e 7472 6f69 6420 3d20 7b7d 0a20 2020  entroid = {}.   
+0000cd50: 2020 2020 2069 6620 6d65 7468 6f64 203d       if method =
+0000cd60: 3d20 2263 6f6e 746f 7572 223a 0a0a 2020  = "contour":..  
+0000cd70: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
+0000cd80: 3244 206f 7220 3344 2063 656e 7472 6f69  2D or 3D centroi
+0000cd90: 6473 2061 6e64 2061 7265 6173 206f 6620  ds and areas of 
+0000cda0: 6561 6368 2070 6f6c 7967 6f6e 206f 6e20  each polygon on 
+0000cdb0: 7468 6520 6465 7369 7265 640a 2020 2020  the desired.    
+0000cdc0: 2020 2020 2020 2020 2320 736c 6963 6528          # slice(
+0000cdd0: 7329 0a20 2020 2020 2020 2020 2020 2069  s).            i
+0000cde0: 6620 7369 6e67 6c65 5f73 6c69 6365 3a0a  f single_slice:.
+0000cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce00: 706f 6c79 676f 6e73 203d 2073 656c 662e  polygons = self.
+0000ce10: 6765 745f 706f 6c79 676f 6e73 5f6f 6e5f  get_polygons_on_
+0000ce20: 736c 6963 6528 7669 6577 2c20 736c 2c20  slice(view, sl, 
+0000ce30: 6964 782c 2070 6f73 290a 2020 2020 2020  idx, pos).      
+0000ce40: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
+0000ce50: 6964 7320 3d20 5b5d 0a20 2020 2020 2020  ids = [].       
+0000ce60: 2020 2020 2020 2020 2061 7265 6173 203d           areas =
+0000ce70: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+0000ce80: 2020 2020 666f 7220 7020 696e 2070 6f6c      for p in pol
+0000ce90: 7967 6f6e 733a 0a20 2020 2020 2020 2020  ygons:.         
+0000cea0: 2020 2020 2020 2020 2020 2063 656e 7472             centr
+0000ceb0: 6f69 645f 7879 203d 2070 2e63 656e 7472  oid_xy = p.centr
+0000cec0: 6f69 642e 7879 0a20 2020 2020 2020 2020  oid.xy.         
+0000ced0: 2020 2020 2020 2020 2020 2063 656e 7472             centr
+0000cee0: 6f69 6473 2e61 7070 656e 6428 6e70 2e61  oids.append(np.a
+0000cef0: 7272 6179 285b 0a20 2020 2020 2020 2020  rray([.         
+0000cf00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000cf10: 656e 7472 6f69 645f 7879 5b30 5d5b 305d  entroid_xy[0][0]
+0000cf20: 2c20 6365 6e74 726f 6964 5f78 795b 315d  , centroid_xy[1]
+0000cf30: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+0000cf40: 2020 2020 2020 2020 5d29 290a 2020 2020          ])).    
+0000cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf60: 6172 6561 732e 6170 7065 6e64 2870 2e61  areas.append(p.a
+0000cf70: 7265 6129 0a20 2020 2020 2020 2020 2020  rea).           
+0000cf80: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000cf90: 2020 2020 2020 2063 656e 7472 6f69 6473         centroids
+0000cfa0: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+0000cfb0: 2020 2020 2020 6172 6561 7320 3d20 5b5d        areas = []
+0000cfc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cfd0: 2070 6f6c 7967 6f6e 5f64 6963 7420 3d20   polygon_dict = 
+0000cfe0: 7365 6c66 2e67 6574 5f70 6f6c 7967 6f6e  self.get_polygon
+0000cff0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+0000d000: 2020 2020 666f 7220 7a2c 2070 6f6c 7967      for z, polyg
+0000d010: 6f6e 7320 696e 2070 6f6c 7967 6f6e 5f64  ons in polygon_d
+0000d020: 6963 742e 6974 656d 7328 293a 0a20 2020  ict.items():.   
+0000d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d040: 2066 6f72 2070 2069 6e20 706f 6c79 676f   for p in polygo
+0000d050: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+0000d060: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
+0000d070: 726f 6964 5f78 7920 3d20 702e 6365 6e74  roid_xy = p.cent
+0000d080: 726f 6964 2e78 790a 2020 2020 2020 2020  roid.xy.        
+0000d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0a0: 6365 6e74 726f 6964 732e 6170 7065 6e64  centroids.append
+0000d0b0: 286e 702e 6172 7261 7928 5b0a 2020 2020  (np.array([.    
 0000d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0d0: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
-0000d0e0: 2020 2020 2020 2020 2020 2020 6172 6561              area
-0000d0f0: 732e 6170 7065 6e64 2870 2e61 7265 6129  s.append(p.area)
-0000d100: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0000d110: 4765 7420 7765 6967 6874 6564 2061 7665  Get weighted ave
-0000d120: 7261 6765 206f 6620 706f 6c79 676f 6e20  rage of polygon 
-0000d130: 6365 6e74 726f 6964 730a 2020 2020 2020  centroids.      
-0000d140: 2020 2020 2020 7765 6967 6874 6564 5f73        weighted_s
-0000d150: 756d 203d 206e 702e 7375 6d28 0a20 2020  um = np.sum(.   
-0000d160: 2020 2020 2020 2020 2020 2020 205b 6365               [ce
-0000d170: 6e74 726f 6964 735b 695d 202a 2061 7265  ntroids[i] * are
-0000d180: 6173 5b69 5d20 666f 7220 6920 696e 2072  as[i] for i in r
-0000d190: 616e 6765 286c 656e 2863 656e 7472 6f69  ange(len(centroi
-0000d1a0: 6473 2929 5d2c 0a20 2020 2020 2020 2020  ds))],.         
-0000d1b0: 2020 2020 2020 2061 7869 733d 300a 2020         axis=0.  
-0000d1c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000d1d0: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
-0000d1e0: 5b22 6d6d 225d 203d 2077 6569 6768 7465  ["mm"] = weighte
-0000d1f0: 645f 7375 6d20 2f20 7375 6d28 6172 6561  d_sum / sum(area
-0000d200: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
-0000d210: 2320 4361 6c63 756c 6174 6520 696e 2076  # Calculate in v
-0000d220: 6f78 656c 7320 616e 6420 736c 6963 6573  oxels and slices
-0000d230: 2069 6620 706f 7373 6962 6c65 0a20 2020   if possible.   
-0000d240: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0000d250: 2e76 6f78 656c 5f73 697a 6520 6973 204e  .voxel_size is N
-0000d260: 6f6e 6520 616e 6420 7365 6c66 2e73 6861  one and self.sha
-0000d270: 7065 2069 7320 4e6f 6e65 3a0a 2020 2020  pe is None:.    
-0000d280: 2020 2020 2020 2020 2020 2020 6966 2075              if u
-0000d290: 6e69 7473 2069 6e20 5b22 766f 7865 6c73  nits in ["voxels
-0000d2a0: 222c 2022 736c 6963 6522 5d20 2061 6e64  ", "slice"]  and
-0000d2b0: 2073 656c 662e 7368 6170 6520 6973 204e   self.shape is N
-0000d2c0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000d2d0: 2020 2020 2020 2020 2072 6169 7365 2052           raise R
-0000d2e0: 756e 7469 6d65 4572 726f 7228 2243 616e  untimeError("Can
-0000d2f0: 6e6f 7420 636f 6d70 7574 6520 6365 6e74  not compute cent
-0000d300: 726f 6964 2069 6e20 766f 7865 6c73 2f73  roid in voxels/s
-0000d310: 6c69 6365 220a 2020 2020 2020 2020 2020  lice".          
-0000d320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d330: 2020 2020 2020 2020 2020 2020 2022 206e               " n
-0000d340: 756d 6265 7273 2066 726f 6d20 636f 6e74  umbers from cont
-0000d350: 6f75 7273 2077 6974 686f 7574 206b 6e6f  ours without kno
-0000d360: 7769 6e67 2076 6f78 656c 220a 2020 2020  wing voxel".    
+0000d0d0: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+0000d0e0: 5f78 795b 305d 5b30 5d2c 2063 656e 7472  _xy[0][0], centr
+0000d0f0: 6f69 645f 7879 5b31 5d5b 305d 2c20 7a0a  oid_xy[1][0], z.
+0000d100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d110: 2020 2020 2020 2020 5d29 290a 2020 2020          ])).    
+0000d120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d130: 2020 2020 6172 6561 732e 6170 7065 6e64      areas.append
+0000d140: 2870 2e61 7265 6129 0a0a 2020 2020 2020  (p.area)..      
+0000d150: 2020 2020 2020 2320 4765 7420 7765 6967        # Get weig
+0000d160: 6874 6564 2061 7665 7261 6765 206f 6620  hted average of 
+0000d170: 706f 6c79 676f 6e20 6365 6e74 726f 6964  polygon centroid
+0000d180: 730a 2020 2020 2020 2020 2020 2020 7765  s.            we
+0000d190: 6967 6874 6564 5f73 756d 203d 206e 702e  ighted_sum = np.
+0000d1a0: 7375 6d28 0a20 2020 2020 2020 2020 2020  sum(.           
+0000d1b0: 2020 2020 205b 6365 6e74 726f 6964 735b       [centroids[
+0000d1c0: 695d 202a 2061 7265 6173 5b69 5d20 666f  i] * areas[i] fo
+0000d1d0: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+0000d1e0: 2863 656e 7472 6f69 6473 2929 5d2c 0a20  (centroids))],. 
+0000d1f0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000d200: 7869 733d 300a 2020 2020 2020 2020 2020  xis=0.          
+0000d210: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000d220: 6365 6e74 726f 6964 5b22 6d6d 225d 203d  centroid["mm"] =
+0000d230: 2077 6569 6768 7465 645f 7375 6d20 2f20   weighted_sum / 
+0000d240: 7375 6d28 6172 6561 7329 0a0a 2020 2020  sum(areas)..    
+0000d250: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
+0000d260: 6174 6520 696e 2076 6f78 656c 7320 616e  ate in voxels an
+0000d270: 6420 736c 6963 6573 2069 6620 706f 7373  d slices if poss
+0000d280: 6962 6c65 0a20 2020 2020 2020 2020 2020  ible.           
+0000d290: 2069 6620 7365 6c66 2e76 6f78 656c 5f73   if self.voxel_s
+0000d2a0: 697a 6520 6973 204e 6f6e 6520 616e 6420  ize is None and 
+0000d2b0: 7365 6c66 2e73 6861 7065 2069 7320 4e6f  self.shape is No
+0000d2c0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000d2d0: 2020 2020 6966 2075 6e69 7473 2069 6e20      if units in 
+0000d2e0: 5b22 766f 7865 6c73 222c 2022 736c 6963  ["voxels", "slic
+0000d2f0: 6522 5d20 2061 6e64 2073 656c 662e 7368  e"]  and self.sh
+0000d300: 6170 6520 6973 204e 6f6e 653a 0a20 2020  ape is None:.   
+0000d310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d320: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
+0000d330: 726f 7228 2243 616e 6e6f 7420 636f 6d70  ror("Cannot comp
+0000d340: 7574 6520 6365 6e74 726f 6964 2069 6e20  ute centroid in 
+0000d350: 766f 7865 6c73 2f73 6c69 6365 220a 2020  voxels/slice".  
+0000d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d390: 2020 2022 2073 697a 6573 2061 6e64 206d     " sizes and m
-0000d3a0: 6173 6b20 7368 6170 6521 2229 0a20 2020  ask shape!").   
-0000d3b0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000d3c0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0000d3d0: 6965 775f 6178 6573 203d 2028 5b30 2c20  iew_axes = ([0, 
-0000d3e0: 312c 2032 5d20 6966 206c 656e 2863 656e  1, 2] if len(cen
-0000d3f0: 7472 6f69 645b 276d 6d27 5d29 203d 3d20  troid['mm']) == 
-0000d400: 3320 656c 7365 0a20 2020 2020 2020 2020  3 else.         
-0000d410: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000d420: 6b72 742e 696d 6167 652e 5f70 6c6f 745f  krt.image._plot_
-0000d430: 6178 6573 5b76 6965 775d 290a 0a20 2020  axes[view])..   
-0000d440: 2020 2020 2020 2020 2020 2020 2063 656e               cen
-0000d450: 7472 6f69 645b 2276 6f78 656c 7322 5d20  troid["voxels"] 
-0000d460: 3d20 6e70 2e61 7272 6179 285b 0a20 2020  = np.array([.   
-0000d470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d480: 2073 656c 662e 706f 735f 746f 5f69 6478   self.pos_to_idx
-0000d490: 2863 2c20 6178 3d69 2c20 7265 7475 726e  (c, ax=i, return
-0000d4a0: 5f69 6e74 3d46 616c 7365 2920 0a20 2020  _int=False) .   
-0000d4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d4c0: 2066 6f72 2069 2c20 6320 696e 207a 6970   for i, c in zip
-0000d4d0: 2876 6965 775f 6178 6573 2c20 6365 6e74  (view_axes, cent
-0000d4e0: 726f 6964 5b22 6d6d 225d 290a 2020 2020  roid["mm"]).    
-0000d4f0: 2020 2020 2020 2020 2020 2020 5d29 0a0a              ])..
-0000d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d510: 6365 6e74 726f 6964 5b22 736c 6963 6522  centroid["slice"
-0000d520: 5d20 3d20 6e70 2e61 7272 6179 285b 0a20  ] = np.array([. 
-0000d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d540: 2020 2073 656c 662e 706f 735f 746f 5f73     self.pos_to_s
-0000d550: 6c69 6365 2863 2c20 6178 3d69 2c20 7265  lice(c, ax=i, re
-0000d560: 7475 726e 5f69 6e74 3d46 616c 7365 2920  turn_int=False) 
-0000d570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d580: 2020 2020 2066 6f72 2069 2c20 6320 696e       for i, c in
-0000d590: 207a 6970 2876 6965 775f 6178 6573 2c20   zip(view_axes, 
-0000d5a0: 6365 6e74 726f 6964 5b22 6d6d 225d 290a  centroid["mm"]).
-0000d5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5c0: 5d29 0a0a 2020 2020 2020 2020 2320 4f74  ])..        # Ot
-0000d5d0: 6865 7277 6973 652c 2063 616c 6375 6c61  herwise, calcula
-0000d5e0: 7465 2063 656e 7472 6f69 6420 6672 6f6d  te centroid from
-0000d5f0: 2062 696e 6172 7920 6d61 736b 0a20 2020   binary mask.   
-0000d600: 2020 2020 2065 6c73 653a 200a 0a20 2020       else: ..   
-0000d610: 2020 2020 2020 2020 2023 2047 6574 2032           # Get 2
-0000d620: 4420 6f72 2033 4420 6461 7461 2066 726f  D or 3D data fro
-0000d630: 6d20 7768 6963 6820 746f 2063 616c 6375  m which to calcu
-0000d640: 6c61 7465 2063 656e 7472 6f69 640a 2020  late centroid.  
-0000d650: 2020 2020 2020 2020 2020 6966 2073 696e            if sin
-0000d660: 676c 655f 736c 6963 653a 0a20 2020 2020  gle_slice:.     
-0000d670: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000d680: 7420 7365 6c66 2e6f 6e5f 736c 6963 6528  t self.on_slice(
-0000d690: 7669 6577 2c20 736c 3d73 6c2c 2069 6478  view, sl=sl, idx
-0000d6a0: 3d69 6478 2c20 706f 733d 706f 7329 3a0a  =idx, pos=pos):.
-0000d6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6c0: 2020 2020 7265 7475 726e 206e 702e 6172      return np.ar
-0000d6d0: 7261 7928 5b4e 6f6e 652c 204e 6f6e 655d  ray([None, None]
-0000d6e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000d6f0: 2020 6461 7461 203d 2073 656c 662e 6765    data = self.ge
-0000d700: 745f 736c 6963 6528 7669 6577 2c20 736c  t_slice(view, sl
-0000d710: 3d73 6c2c 2069 6478 3d69 6478 2c20 706f  =sl, idx=idx, po
-0000d720: 733d 706f 7329 0a20 2020 2020 2020 2020  s=pos).         
-0000d730: 2020 2020 2020 2061 7865 7320 3d20 736b         axes = sk
-0000d740: 7274 2e69 6d61 6765 2e5f 706c 6f74 5f61  rt.image._plot_a
-0000d750: 7865 735b 7669 6577 5d0a 2020 2020 2020  xes[view].      
-0000d760: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000d770: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000d780: 2e63 7265 6174 655f 6d61 736b 2829 0a20  .create_mask(). 
-0000d790: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000d7a0: 6174 6120 3d20 7365 6c66 2e67 6574 5f6d  ata = self.get_m
-0000d7b0: 6173 6b28 7374 616e 6461 7264 6973 653d  ask(standardise=
-0000d7c0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-0000d7d0: 2020 2020 2020 6178 6573 203d 2073 6b72        axes = skr
-0000d7e0: 742e 696d 6167 652e 5f61 7865 730a 0a20  t.image._axes.. 
-0000d7f0: 2020 2020 2020 2020 2020 2023 2043 6f6d             # Com
-0000d800: 7075 7465 2063 656e 7472 6f69 6420 6672  pute centroid fr
-0000d810: 6f6d 2032 4420 6f72 2033 4420 6269 6e61  om 2D or 3D bina
-0000d820: 7279 206d 6173 6b0a 2020 2020 2020 2020  ry mask.        
-0000d830: 2020 2020 6e6f 6e5f 7a65 726f 203d 206e      non_zero = n
-0000d840: 702e 6172 6777 6865 7265 2864 6174 6129  p.argwhere(data)
-0000d850: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000d860: 6e6f 7420 6c65 6e28 6e6f 6e5f 7a65 726f  not len(non_zero
-0000d870: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000d880: 2020 2069 6620 6461 7461 2e6e 6469 6d20     if data.ndim 
-0000d890: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
-0000d8a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000d8b0: 204e 6f6e 652c 204e 6f6e 650a 2020 2020   None, None.    
-0000d8c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000d8d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d8e0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-0000d8f0: 652c 204e 6f6e 652c 204e 6f6e 650a 2020  e, None, None.  
-0000d900: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
-0000d910: 6964 5f72 6f77 636f 6c20 3d20 6c69 7374  id_rowcol = list
-0000d920: 286e 6f6e 5f7a 6572 6f2e 6d65 616e 2830  (non_zero.mean(0
-0000d930: 2929 0a20 2020 2020 2020 2020 2020 2063  )).            c
-0000d940: 656e 7472 6f69 645f 766f 7865 6c73 203d  entroid_voxels =
-0000d950: 205b 6365 6e74 726f 6964 5f72 6f77 636f   [centroid_rowco
-0000d960: 6c5b 315d 2c20 6365 6e74 726f 6964 5f72  l[1], centroid_r
-0000d970: 6f77 636f 6c5b 305d 5d20 5c0a 2020 2020  owcol[0]] \.    
-0000d980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d990: 2b20 6365 6e74 726f 6964 5f72 6f77 636f  + centroid_rowco
-0000d9a0: 6c5b 323a 5d0a 2020 2020 2020 2020 2020  l[2:].          
-0000d9b0: 2020 6365 6e74 726f 6964 5b22 766f 7865    centroid["voxe
-0000d9c0: 6c73 225d 203d 206e 702e 6172 7261 7928  ls"] = np.array(
-0000d9d0: 6365 6e74 726f 6964 5f76 6f78 656c 7329  centroid_voxels)
-0000d9e0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0000d9f0: 436f 6e76 6572 7420 746f 206d 6d20 616e  Convert to mm an
-0000da00: 6420 736c 6963 6573 0a20 2020 2020 2020  d slices.       
-0000da10: 2020 2020 2076 6965 775f 6178 6573 203d       view_axes =
-0000da20: 2028 5b30 2c20 312c 2032 5d20 6966 206c   ([0, 1, 2] if l
-0000da30: 656e 2863 656e 7472 6f69 645b 2776 6f78  en(centroid['vox
-0000da40: 656c 7327 5d29 203d 3d20 3320 656c 7365  els']) == 3 else
-0000da50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000da60: 2020 2020 2073 6b72 742e 696d 6167 652e       skrt.image.
-0000da70: 5f70 6c6f 745f 6178 6573 5b76 6965 775d  _plot_axes[view]
-0000da80: 290a 0a20 2020 2020 2020 2020 2020 2063  )..            c
-0000da90: 656e 7472 6f69 645b 226d 6d22 5d20 3d20  entroid["mm"] = 
-0000daa0: 6e70 2e61 7272 6179 285b 0a20 2020 2020  np.array([.     
-0000dab0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000dac0: 6964 785f 746f 5f70 6f73 2863 2c20 6178  idx_to_pos(c, ax
-0000dad0: 3d69 290a 2020 2020 2020 2020 2020 2020  =i).            
-0000dae0: 2020 2020 666f 7220 692c 2063 2069 6e20      for i, c in 
-0000daf0: 7a69 7028 7669 6577 5f61 7865 732c 2063  zip(view_axes, c
-0000db00: 656e 7472 6f69 645b 2276 6f78 656c 7322  entroid["voxels"
-0000db10: 5d29 0a20 2020 2020 2020 2020 2020 205d  ]).            ]
-0000db20: 290a 0a20 2020 2020 2020 2020 2020 2063  )..            c
-0000db30: 656e 7472 6f69 645b 2273 6c69 6365 225d  entroid["slice"]
-0000db40: 203d 206e 702e 6172 7261 7928 5b0a 2020   = np.array([.  
-0000db50: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000db60: 6c66 2e69 6478 5f74 6f5f 736c 6963 6528  lf.idx_to_slice(
-0000db70: 632c 2061 783d 6929 0a20 2020 2020 2020  c, ax=i).       
-0000db80: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
-0000db90: 6320 696e 207a 6970 2876 6965 775f 6178  c in zip(view_ax
-0000dba0: 6573 2c20 6365 6e74 726f 6964 5b22 766f  es, centroid["vo
-0000dbb0: 7865 6c73 225d 290a 2020 2020 2020 2020  xels"]).        
-0000dbc0: 2020 2020 5d29 0a0a 2020 2020 2020 2020      ])..        
-0000dbd0: 2320 4361 6368 6520 676c 6f62 616c 2063  # Cache global c
-0000dbe0: 656e 7472 6f69 640a 2020 2020 2020 2020  entroid.        
-0000dbf0: 6966 206e 6f74 2073 696e 676c 655f 736c  if not single_sl
-0000dc00: 6963 653a 0a20 2020 2020 2020 2020 2020  ice:.           
-0000dc10: 2073 656c 662e 5f63 656e 7472 6f69 6420   self._centroid 
-0000dc20: 3d20 6365 6e74 726f 6964 0a0a 2020 2020  = centroid..    
-0000dc30: 2020 2020 2320 5265 7475 726e 2063 656e      # Return cen
-0000dc40: 7472 6f69 6420 696e 2072 6571 7565 7374  troid in request
-0000dc50: 6564 2075 6e69 7473 0a20 2020 2020 2020  ed units.       
-0000dc60: 2072 6574 7572 6e20 6365 6e74 726f 6964   return centroid
-0000dc70: 5b75 6e69 7473 5d0a 0a20 2020 2064 6566  [units]..    def
-0000dc80: 2073 6574 5f73 6c69 6365 5f74 6869 636b   set_slice_thick
-0000dc90: 6e65 7373 5f63 6f6e 746f 7572 7328 7365  ness_contours(se
-0000dca0: 6c66 2c20 647a 293a 0a20 2020 2020 2020  lf, dz):.       
-0000dcb0: 2022 2222 0a20 2020 2020 2020 2053 6574   """.        Set
-0000dcc0: 206e 6f6d 696e 616c 207a 2073 7061 6369   nominal z spaci
-0000dcd0: 6e67 206f 6620 636f 6e74 6f75 7273 2e0a  ng of contours..
-0000dce0: 0a20 2020 2020 2020 2054 6869 7320 6d61  .        This ma
-0000dcf0: 7920 6265 2075 7365 6675 6c20 696e 2070  y be useful in p
-0000dd00: 6172 7469 6375 6c61 7220 666f 7220 2073  articular for  s
-0000dd10: 696e 676c 652d 736c 6963 6520 524f 4973  ingle-slice ROIs
-0000dd20: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-0000dd30: 2020 2020 2020 2073 656c 662e 736c 6963         self.slic
-0000dd40: 655f 7468 6963 6b6e 6573 735f 636f 6e74  e_thickness_cont
-0000dd50: 6f75 7273 203d 2064 7a0a 0a20 2020 2064  ours = dz..    d
-0000dd60: 6566 2067 6574 5f73 6c69 6365 5f74 6869  ef get_slice_thi
-0000dd70: 636b 6e65 7373 5f63 6f6e 746f 7572 7328  ckness_contours(
-0000dd80: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0000dd90: 2222 4765 7420 7a20 766f 7865 6c20 7369  ""Get z voxel si
-0000dda0: 7a65 2075 7369 6e67 2070 6f73 6974 696f  ze using positio
-0000ddb0: 6e73 206f 6620 636f 6e74 6f75 7273 2e22  ns of contours."
-0000ddc0: 2222 0a0a 2020 2020 2020 2020 636f 6e74  ""..        cont
-0000ddd0: 6f75 7273 203d 2073 656c 662e 6765 745f  ours = self.get_
-0000dde0: 636f 6e74 6f75 7273 2822 782d 7922 290a  contours("x-y").
-0000ddf0: 2020 2020 2020 2020 7a5f 6b65 7973 203d          z_keys =
-0000de00: 2073 6f72 7465 6428 636f 6e74 6f75 7273   sorted(contours
-0000de10: 2e6b 6579 7328 2929 0a20 2020 2020 2020  .keys()).       
-0000de20: 2069 6620 6c65 6e28 7a5f 6b65 7973 2920   if len(z_keys) 
-0000de30: 3c20 323a 0a20 2020 2020 2020 2020 2020  < 2:.           
-0000de40: 2069 6620 7365 6c66 2e73 6f75 7263 655f   if self.source_
-0000de50: 7479 7065 203d 3d20 2263 6f6e 746f 7572  type == "contour
-0000de60: 2220 616e 6420 7365 6c66 2e73 6c69 6365  " and self.slice
-0000de70: 5f74 6869 636b 6e65 7373 5f63 6f6e 746f  _thickness_conto
-0000de80: 7572 733a 0a20 2020 2020 2020 2020 2020  urs:.           
-0000de90: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000dea0: 2e73 6c69 6365 5f74 6869 636b 6e65 7373  .slice_thickness
-0000deb0: 5f63 6f6e 746f 7572 730a 2020 2020 2020  _contours.      
-0000dec0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000ded0: 2020 2020 2020 2020 2020 2020 766f 7865              voxe
-0000dee0: 6c5f 7369 7a65 203d 2073 656c 662e 6765  l_size = self.ge
-0000def0: 745f 766f 7865 6c5f 7369 7a65 2829 0a20  t_voxel_size(). 
-0000df00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000df10: 6620 766f 7865 6c5f 7369 7a65 2069 7320  f voxel_size is 
-0000df20: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0000df30: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000df40: 7475 726e 2076 6f78 656c 5f73 697a 655b  turn voxel_size[
-0000df50: 325d 0a20 2020 2020 2020 2020 2020 2020  2].             
-0000df60: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
-0000df70: 2020 6469 6666 7320 3d20 5b7a 5f6b 6579    diffs = [z_key
-0000df80: 735b 695d 202d 207a 5f6b 6579 735b 6920  s[i] - z_keys[i 
-0000df90: 2d20 315d 2066 6f72 2069 2069 6e20 7261  - 1] for i in ra
-0000dfa0: 6e67 6528 312c 206c 656e 287a 5f6b 6579  nge(1, len(z_key
-0000dfb0: 7329 295d 0a20 2020 2020 2020 2072 6574  s))].        ret
-0000dfc0: 7572 6e20 6d69 6e28 6469 6666 7329 0a0a  urn min(diffs)..
-0000dfd0: 2020 2020 6465 6620 6765 745f 6e7a 5f63      def get_nz_c
-0000dfe0: 6f6e 746f 7572 7328 7365 6c66 293a 0a20  ontours(self):. 
-0000dff0: 2020 2020 2020 2022 2222 4765 7420 6e75         """Get nu
-0000e000: 6d62 6572 206f 6620 766f 7865 6c73 2069  mber of voxels i
-0000e010: 6e20 7468 6520 7a20 6469 7265 6374 696f  n the z directio
-0000e020: 6e20 7573 696e 6720 706f 7369 7469 6f6e  n using position
-0000e030: 7320 6f66 2063 6f6e 746f 7572 732e 2222  s of contours.""
-0000e040: 220a 0a20 2020 2020 2020 2076 7a20 3d20  "..        vz = 
-0000e050: 7365 6c66 2e67 6574 5f73 6c69 6365 5f74  self.get_slice_t
-0000e060: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
-0000e070: 7328 290a 2020 2020 2020 2020 7a5f 6b65  s().        z_ke
-0000e080: 7973 203d 206c 6973 7428 7365 6c66 2e67  ys = list(self.g
-0000e090: 6574 5f63 6f6e 746f 7572 7328 2278 2d79  et_contours("x-y
-0000e0a0: 2229 2e6b 6579 7328 2929 0a20 2020 2020  ").keys()).     
-0000e0b0: 2020 2072 6574 7572 6e20 696e 7428 286d     return int((m
-0000e0c0: 6178 287a 5f6b 6579 7329 202d 206d 696e  ax(z_keys) - min
-0000e0d0: 287a 5f6b 6579 7329 2920 2f20 767a 2920  (z_keys)) / vz) 
-0000e0e0: 2b20 310a 0a20 2020 2064 6566 2067 6574  + 1..    def get
-0000e0f0: 5f63 656e 7472 6528 0a20 2020 2020 2020  _centre(.       
-0000e100: 2073 656c 662c 200a 2020 2020 2020 2020   self, .        
-0000e110: 7669 6577 3d22 782d 7922 2c20 0a20 2020  view="x-y", .   
-0000e120: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
-0000e130: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
-0000e140: 2073 6c3d 4e6f 6e65 2c20 0a20 2020 2020   sl=None, .     
-0000e150: 2020 2069 6478 3d4e 6f6e 652c 200a 2020     idx=None, .  
-0000e160: 2020 2020 2020 706f 733d 4e6f 6e65 2c20        pos=None, 
-0000e170: 0a20 2020 2020 2020 206d 6574 686f 643d  .        method=
-0000e180: 4e6f 6e65 2c0a 2020 2020 293a 0a20 2020  None,.    ):.   
-0000e190: 2020 2020 2022 2222 4765 7420 6365 6e74       """Get cent
-0000e1a0: 7265 2070 6f73 6974 696f 6e20 696e 2032  re position in 2
-0000e1b0: 4420 6f72 2033 4420 696e 206d 6d2e 2222  D or 3D in mm.""
-0000e1c0: 220a 0a20 2020 2020 2020 2023 2047 6574  "..        # Get
-0000e1d0: 2064 6566 6175 6c74 2073 6c69 6365 2069   default slice i
-0000e1e0: 6e64 6578 2061 6e64 206d 6574 686f 640a  ndex and method.
-0000e1f0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-0000e200: 6428 290a 2020 2020 2020 2020 6966 2073  d().        if s
-0000e210: 6c20 6973 204e 6f6e 6520 616e 6420 6964  l is None and id
-0000e220: 7820 6973 204e 6f6e 6520 616e 6420 706f  x is None and po
-0000e230: 7320 6973 204e 6f6e 653a 200a 2020 2020  s is None: .    
-0000e240: 2020 2020 2020 2020 6964 7820 3d20 7365          idx = se
-0000e250: 6c66 2e67 6574 5f6d 6964 5f69 6478 2876  lf.get_mid_idx(v
-0000e260: 6965 7729 0a20 2020 2020 2020 2069 6620  iew).        if 
-0000e270: 6d65 7468 6f64 2069 7320 4e6f 6e65 3a0a  method is None:.
-0000e280: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
-0000e290: 6f64 203d 2073 656c 662e 6465 6661 756c  od = self.defaul
-0000e2a0: 745f 6765 6f6d 5f6d 6574 686f 640a 0a20  t_geom_method.. 
-0000e2b0: 2020 2020 2020 2023 2047 6574 206c 6973         # Get lis
-0000e2c0: 7420 6f66 2061 7865 7320 746f 2063 6f6e  t of axes to con
-0000e2d0: 7369 6465 720a 2020 2020 2020 2020 6966  sider.        if
-0000e2e0: 2073 696e 676c 655f 736c 6963 653a 0a20   single_slice:. 
-0000e2f0: 2020 2020 2020 2020 2020 2061 7865 7320             axes 
-0000e300: 3d20 736b 7274 2e69 6d61 6765 2e5f 706c  = skrt.image._pl
-0000e310: 6f74 5f61 7865 735b 7669 6577 5d0a 2020  ot_axes[view].  
-0000e320: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000e330: 2020 2020 2020 2020 6178 6573 203d 2073          axes = s
-0000e340: 6b72 742e 696d 6167 652e 5f61 7865 730a  krt.image._axes.
-0000e350: 0a20 2020 2020 2020 2023 2047 6574 2063  .        # Get c
-0000e360: 656e 7472 6520 696e 206d 6d0a 2020 2020  entre in mm.    
-0000e370: 2020 2020 6365 6e74 7265 203d 205b 5d0a      centre = [].
-0000e380: 2020 2020 2020 2020 666f 7220 6178 2069          for ax i
-0000e390: 6e20 6178 6573 3a0a 2020 2020 2020 2020  n axes:.        
-0000e3a0: 2020 2020 6578 7465 6e74 203d 2073 656c      extent = sel
-0000e3b0: 662e 6765 745f 6578 7465 6e74 280a 2020  f.get_extent(.  
-0000e3c0: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-0000e3d0: 3d61 782c 0a20 2020 2020 2020 2020 2020  =ax,.           
-0000e3e0: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
-0000e3f0: 653d 7369 6e67 6c65 5f73 6c69 6365 2c0a  e=single_slice,.
-0000e400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e410: 7669 6577 3d76 6965 772c 0a20 2020 2020  view=view,.     
-0000e420: 2020 2020 2020 2020 2020 2073 6c3d 736c             sl=sl
-0000e430: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000e440: 2020 6964 783d 6964 782c 0a20 2020 2020    idx=idx,.     
-0000e450: 2020 2020 2020 2020 2020 2070 6f73 3d70             pos=p
-0000e460: 6f73 2c0a 2020 2020 2020 2020 2020 2020  os,.            
-0000e470: 2020 2020 6d65 7468 6f64 3d6d 6574 686f      method=metho
-0000e480: 642c 0a20 2020 2020 2020 2020 2020 2029  d,.            )
-0000e490: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000e4a0: 4e6f 6e65 2069 6e20 6578 7465 6e74 3a0a  None in extent:.
-0000e4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e4c0: 6365 6e74 7265 2e61 7070 656e 6428 4e6f  centre.append(No
-0000e4d0: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
-0000e4e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000e4f0: 2020 2020 2020 6365 6e74 7265 2e61 7070        centre.app
-0000e500: 656e 6428 6e70 2e6d 6561 6e28 6578 7465  end(np.mean(exte
-0000e510: 6e74 2929 0a0a 2020 2020 2020 2020 7265  nt))..        re
-0000e520: 7475 726e 206e 702e 6172 7261 7928 6365  turn np.array(ce
-0000e530: 6e74 7265 290a 0a20 2020 2064 6566 2067  ntre)..    def g
-0000e540: 6574 5f76 6f6c 756d 6528 0a20 2020 2020  et_volume(.     
-0000e550: 2020 2073 656c 662c 200a 2020 2020 2020     self, .      
-0000e560: 2020 756e 6974 733d 226d 6d22 2c20 0a20    units="mm", . 
-0000e570: 2020 2020 2020 206d 6574 686f 643d 4e6f         method=No
-0000e580: 6e65 2c20 0a20 2020 2020 2020 2066 6f72  ne, .        for
-0000e590: 6365 3d54 7275 650a 2020 2020 293a 0a20  ce=True.    ):. 
-0000e5a0: 2020 2020 2020 2022 2222 4765 7420 524f         """Get RO
-0000e5b0: 4920 766f 6c75 6d65 2e20 5468 6520 6361  I volume. The ca
-0000e5c0: 6c63 756c 6174 6564 2076 6f6c 756d 6520  lculated volume 
-0000e5d0: 7769 6c6c 2062 6520 6361 6368 6564 2069  will be cached i
-0000e5e0: 6e20 0a20 2020 2020 2020 2073 656c 662e  n .        self.
-0000e5f0: 5f76 6f6c 756d 655b 756e 6974 735d 2061  _volume[units] a
-0000e600: 6e64 2072 6574 7572 6e65 6420 6966 2063  nd returned if c
-0000e610: 616c 6c65 6420 6167 6169 6e2c 2075 6e6c  alled again, unl
-0000e620: 6573 7320 666f 7263 653d 5472 7565 2e0a  ess force=True..
-0000e630: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
-0000e640: 6574 6572 733a 2a2a 0a20 2020 2020 2020  eters:**.       
-0000e650: 200a 2020 2020 2020 2020 756e 6974 7320   .        units 
-0000e660: 3a20 7374 722c 2064 6566 6175 6c74 3d22  : str, default="
-0000e670: 6d6d 220a 2020 2020 2020 2020 2020 2020  mm".            
-0000e680: 556e 6974 7320 6f66 2076 6f6c 756d 652e  Units of volume.
-0000e690: 2043 616e 2062 6520 616e 7920 6f66 3a0a   Can be any of:.
-0000e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6b0: 2d20 226d 6d22 3a20 7265 7475 726e 2076  - "mm": return v
-0000e6c0: 6f6c 756d 6520 696e 206d 696c 6c69 6d65  olume in millime
-0000e6d0: 7472 6573 2063 7562 6564 2e0a 2020 2020  tres cubed..    
-0000e6e0: 2020 2020 2020 2020 2020 2020 2d20 226d              - "m
-0000e6f0: 6c22 3a20 7265 7475 726e 2076 6f6c 756d  l": return volum
-0000e700: 6520 696e 206d 696c 6c69 6c69 7472 6573  e in millilitres
-0000e710: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e720: 2020 2d20 2263 6322 3a20 7265 7475 726e    - "cc": return
-0000e730: 2076 6f6c 756d 6520 696e 2063 7562 6963   volume in cubic
-0000e740: 2063 656e 7469 6d65 7472 6573 2028 6571   centimetres (eq
-0000e750: 7569 7661 6c65 6e74 2074 6f20 226d 6c22  uivalent to "ml"
-0000e760: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000e770: 2020 2d20 2276 6f78 656c 7322 3a20 7265    - "voxels": re
-0000e780: 7475 726e 2076 6f6c 756d 6520 696e 206e  turn volume in n
-0000e790: 756d 6265 7220 6f66 2076 6f78 656c 732e  umber of voxels.
-0000e7a0: 0a0a 2020 2020 2020 2020 2020 2020 4966  ..            If
-0000e7b0: 2075 6e69 7473 3d22 766f 7865 6c73 2220   units="voxels" 
-0000e7c0: 6973 2072 6571 7565 7374 6564 2062 7574  is requested but
-0000e7d0: 2074 6869 7320 524f 4920 6f6e 6c79 2068   this ROI only h
-0000e7e0: 6173 2063 6f6e 746f 7572 7320 616e 6420  as contours and 
-0000e7f0: 6e6f 0a20 2020 2020 2020 2020 2020 2076  no.            v
-0000e800: 6f78 656c 2073 697a 6520 696e 666f 726d  oxel size inform
-0000e810: 6174 696f 6e2c 2061 6e20 6572 726f 7220  ation, an error 
-0000e820: 7769 6c6c 2062 6520 7261 6973 6564 2e0a  will be raised..
-0000e830: 0a20 2020 2020 2020 206d 6574 686f 6420  .        method 
-0000e840: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
-0000e850: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0000e860: 4d65 7468 6f64 2074 6f20 7573 6520 666f  Method to use fo
-0000e870: 7220 766f 6c75 6d65 2063 616c 6375 6c61  r volume calcula
-0000e880: 7469 6f6e 2e20 4361 6e20 6265 3a20 0a20  tion. Can be: . 
-0000e890: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-0000e8a0: 2022 636f 6e74 6f75 7222 3a20 636f 6d70   "contour": comp
-0000e8b0: 7574 6520 766f 6c75 6d65 2062 7920 7375  ute volume by su
-0000e8c0: 6d6d 696e 6720 6172 6561 7320 6f66 2073  mming areas of s
-0000e8d0: 6861 7065 6c79 0a20 2020 2020 2020 2020  hapely.         
-0000e8e0: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
-0000e8f0: 7320 6f6e 2065 6163 6820 736c 6963 6520  s on each slice 
-0000e900: 616e 6420 6d75 6c74 6970 6c79 696e 6720  and multiplying 
-0000e910: 6279 2073 6c69 6365 2074 6869 636b 6e65  by slice thickne
-0000e920: 7373 2e0a 2020 2020 2020 2020 2020 2020  ss..            
-0000e930: 2020 2020 2d20 226d 6173 6b22 3a20 636f      - "mask": co
-0000e940: 6d70 7574 6520 766f 6c75 6d65 2062 7920  mpute volume by 
-0000e950: 7375 6d6d 696e 6720 766f 7865 6c73 2069  summing voxels i
-0000e960: 6e73 6964 6520 7468 6520 524f 4920 616e  nside the ROI an
-0000e970: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-0000e980: 2020 2020 6d75 6c74 6970 6c79 696e 6720      multiplying 
-0000e990: 6279 2074 6865 2076 6f6c 756d 6520 6f66  by the volume of
-0000e9a0: 206f 6e65 2076 6f78 656c 2e0a 2020 2020   one voxel..    
-0000e9b0: 2020 2020 2020 2020 2020 2020 2d20 4e6f              - No
-0000e9c0: 6e65 3a20 7573 6520 7468 6520 6d65 7468  ne: use the meth
-0000e9d0: 6f64 2073 6574 2069 6e20 7365 6c66 2e64  od set in self.d
-0000e9e0: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
-0000e9f0: 6f64 2e0a 0a20 2020 2020 2020 2020 2020  od...           
-0000ea00: 204e 6f74 6520 7468 6174 2069 6620 7365   Note that if se
-0000ea10: 6c66 2e67 6574 5f76 6f6c 756d 6520 6861  lf.get_volume ha
-0000ea20: 7320 616c 7265 6164 7920 6265 656e 2063  s already been c
-0000ea30: 616c 6c65 6420 7769 7468 206f 6e65 200a  alled with one .
-0000ea40: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
-0000ea50: 6f64 2c20 7468 6520 7361 6d65 2063 6163  od, the same cac
-0000ea60: 6865 6420 7265 7375 6c74 2077 696c 6c20  hed result will 
-0000ea70: 6265 2072 6574 7572 6e65 6420 6966 2063  be returned if c
-0000ea80: 616c 6c69 6e67 2077 6974 6820 6120 0a20  alling with a . 
-0000ea90: 2020 2020 2020 2020 2020 2064 6966 6665             diffe
-0000eaa0: 7265 6e74 206d 6574 686f 6420 756e 6c65  rent method unle
-0000eab0: 7373 2066 6f72 6365 3d54 7275 652e 0a0a  ss force=True...
-0000eac0: 2020 2020 2020 2020 666f 7263 6520 3a20          force : 
-0000ead0: 626f 6f6c 2c20 6465 6661 756c 743d 5472  bool, default=Tr
-0000eae0: 7565 0a20 2020 2020 2020 2020 2020 2049  ue.            I
-0000eaf0: 6620 5472 7565 2c20 7468 6520 766f 6c75  f True, the volu
-0000eb00: 6d65 2077 696c 6c20 616c 7761 7973 2062  me will always b
-0000eb10: 6520 7265 6361 6c63 756c 6174 6564 3b20  e recalculated; 
-0000eb20: 6f74 6865 7277 6973 652c 2069 7420 7769  otherwise, it wi
-0000eb30: 6c6c 0a20 2020 2020 2020 2020 2020 206f  ll.            o
-0000eb40: 6e6c 7920 6265 2063 616c 6375 6c61 7465  nly be calculate
-0000eb50: 6420 6966 2069 7420 6861 7320 6e6f 7420  d if it has not 
-0000eb60: 7965 7420 6265 656e 2063 6163 6865 6420  yet been cached 
-0000eb70: 696e 2073 656c 662e 5f76 6f6c 756d 652e  in self._volume.
-0000eb80: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0000eb90: 2020 2020 2020 2320 4966 2061 6c72 6561        # If alrea
-0000eba0: 6479 2063 6163 6865 6420 616e 6420 6e6f  dy cached and no
-0000ebb0: 7420 666f 7263 696e 672c 2072 6574 7572  t forcing, retur
-0000ebc0: 6e0a 2020 2020 2020 2020 6966 2068 6173  n.        if has
-0000ebd0: 6174 7472 2873 656c 662c 2022 5f76 6f6c  attr(self, "_vol
-0000ebe0: 756d 6522 2920 616e 6420 6e6f 7420 666f  ume") and not fo
-0000ebf0: 7263 653a 0a20 2020 2020 2020 2020 2020  rce:.           
-0000ec00: 2069 6620 756e 6974 7320 696e 2073 656c   if units in sel
-0000ec10: 662e 5f76 6f6c 756d 653a 0a20 2020 2020  f._volume:.     
-0000ec20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000ec30: 6e20 7365 6c66 2e5f 766f 6c75 6d65 5b75  n self._volume[u
-0000ec40: 6e69 7473 5d0a 0a20 2020 2020 2020 2073  nits]..        s
-0000ec50: 656c 662e 6c6f 6164 2829 0a20 2020 2020  elf.load().     
-0000ec60: 2020 2069 6620 6d65 7468 6f64 2069 7320     if method is 
-0000ec70: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000ec80: 2020 6d65 7468 6f64 203d 2073 656c 662e    method = self.
-0000ec90: 6465 6661 756c 745f 6765 6f6d 5f6d 6574  default_geom_met
-0000eca0: 686f 640a 0a20 2020 2020 2020 2023 204d  hod..        # M
-0000ecb0: 616b 6520 6361 6368 6564 2070 726f 7065  ake cached prope
-0000ecc0: 7274 790a 2020 2020 2020 2020 7365 6c66  rty.        self
-0000ecd0: 2e5f 766f 6c75 6d65 203d 207b 7d0a 0a20  ._volume = {}.. 
-0000ece0: 2020 2020 2020 2023 2043 616c 6375 6c61         # Calcula
-0000ecf0: 7465 2066 726f 6d20 706f 6c79 676f 6e20  te from polygon 
-0000ed00: 6172 6561 730a 2020 2020 2020 2020 6966  areas.        if
-0000ed10: 206d 6574 686f 6420 3d3d 2022 636f 6e74   method == "cont
-0000ed20: 6f75 7222 3a0a 0a20 2020 2020 2020 2020  our":..         
-0000ed30: 2020 2023 2043 6865 636b 2069 7427 7320     # Check it's 
-0000ed40: 706f 7373 6962 6c65 2074 6f20 6361 6c63  possible to calc
-0000ed50: 756c 6174 6520 766f 6c75 6d65 2077 6974  ulate volume wit
-0000ed60: 6820 7468 6520 7265 7175 6573 7465 6420  h the requested 
-0000ed70: 756e 6974 730a 2020 2020 2020 2020 2020  units.          
-0000ed80: 2020 6966 2073 656c 662e 766f 7865 6c5f    if self.voxel_
-0000ed90: 7369 7a65 2069 7320 4e6f 6e65 2061 6e64  size is None and
-0000eda0: 2075 6e69 7473 203d 3d20 2276 6f78 656c   units == "voxel
-0000edb0: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
-0000edc0: 2020 2020 7261 6973 6520 5275 6e74 696d      raise Runtim
-0000edd0: 6545 7272 6f72 2822 4361 6e6e 6f74 2063  eError("Cannot c
-0000ede0: 6f6d 7075 7465 2076 6f6c 756d 6520 696e  ompute volume in
-0000edf0: 2076 6f78 656c 7320 6672 6f6d 2022 0a20   voxels from ". 
-0000ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee20: 2020 2263 6f6e 746f 7572 7320 7769 7468    "contours with
-0000ee30: 6f75 7420 6b6e 6f77 696e 6720 766f 7865  out knowing voxe
-0000ee40: 6c20 7369 7a65 7321 2229 0a0a 2020 2020  l sizes!")..    
-0000ee50: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
-0000ee60: 6174 6520 6172 6561 206f 6e20 6561 6368  ate area on each
-0000ee70: 2073 6c69 6365 0a20 2020 2020 2020 2020   slice.         
-0000ee80: 2020 2073 6c69 6365 5f61 7265 6173 203d     slice_areas =
-0000ee90: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-0000eea0: 666f 7220 6964 7820 696e 2073 656c 662e  for idx in self.
-0000eeb0: 6765 745f 636f 6e74 6f75 7273 2822 782d  get_contours("x-
-0000eec0: 7922 2c20 6964 785f 6173 5f6b 6579 3d54  y", idx_as_key=T
-0000eed0: 7275 6529 3a0a 2020 2020 2020 2020 2020  rue):.          
-0000eee0: 2020 2020 2020 736c 6963 655f 6172 6561        slice_area
-0000eef0: 732e 6170 7065 6e64 2873 656c 662e 6765  s.append(self.ge
-0000ef00: 745f 6172 6561 2822 782d 7922 2c20 6964  t_area("x-y", id
-0000ef10: 783d 6964 782c 206d 6574 686f 643d 6d65  x=idx, method=me
-0000ef20: 7468 6f64 2929 0a0a 2020 2020 2020 2020  thod))..        
-0000ef30: 2020 2020 2320 436f 6e76 6572 7420 746f      # Convert to
-0000ef40: 2076 6f6c 756d 6520 696e 206d 6d0a 2020   volume in mm.  
-0000ef50: 2020 2020 2020 2020 2020 6172 6561 5f73            area_s
-0000ef60: 756d 203d 2073 756d 2873 6c69 6365 5f61  um = sum(slice_a
-0000ef70: 7265 6173 290a 2020 2020 2020 2020 2020  reas).          
-0000ef80: 2020 7365 6c66 2e5f 766f 6c75 6d65 5b22    self._volume["
-0000ef90: 6d6d 225d 203d 2061 7265 615f 7375 6d20  mm"] = area_sum 
-0000efa0: 2a20 7365 6c66 2e67 6574 5f73 6c69 6365  * self.get_slice
-0000efb0: 5f74 6869 636b 6e65 7373 5f63 6f6e 746f  _thickness_conto
-0000efc0: 7572 7328 290a 0a20 2020 2020 2020 2020  urs()..         
-0000efd0: 2020 2023 2049 6620 706f 7373 6962 6c65     # If possible
-0000efe0: 2c20 636f 6e76 6572 7420 746f 2076 6f6c  , convert to vol
-0000eff0: 756d 6520 696e 2076 6f78 656c 730a 2020  ume in voxels.  
-0000f000: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0000f010: 662e 766f 7865 6c5f 7369 7a65 2069 7320  f.voxel_size is 
-0000f020: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0000f030: 2020 2020 2020 2020 2020 7879 5f76 6f78            xy_vox
-0000f040: 656c 5f61 7265 6120 3d20 7365 6c66 2e76  el_area = self.v
-0000f050: 6f78 656c 5f73 697a 655b 305d 202a 2073  oxel_size[0] * s
-0000f060: 656c 662e 766f 7865 6c5f 7369 7a65 5b31  elf.voxel_size[1
-0000f070: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0000f080: 2020 7365 6c66 2e5f 766f 6c75 6d65 5b22    self._volume["
-0000f090: 766f 7865 6c73 225d 203d 2061 7265 615f  voxels"] = area_
-0000f0a0: 7375 6d20 2f20 7879 5f76 6f78 656c 5f61  sum / xy_voxel_a
-0000f0b0: 7265 610a 0a20 2020 2020 2020 2023 204f  rea..        # O
-0000f0c0: 7468 6572 7769 7365 2c20 6361 6c63 756c  therwise, calcul
-0000f0d0: 6174 6520 6672 6f6d 206e 756d 6265 7220  ate from number 
-0000f0e0: 6f66 2076 6f78 656c 7320 696e 206d 6173  of voxels in mas
-0000f0f0: 6b0a 2020 2020 2020 2020 656c 7365 3a0a  k.        else:.
-0000f100: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000f110: 2e63 7265 6174 655f 6d61 736b 2829 0a20  .create_mask(). 
-0000f120: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000f130: 5f76 6f6c 756d 655b 2276 6f78 656c 7322  _volume["voxels"
-0000f140: 5d20 3d20 7365 6c66 2e6d 6173 6b2e 6461  ] = self.mask.da
-0000f150: 7461 2e61 7374 7970 6528 626f 6f6c 292e  ta.astype(bool).
-0000f160: 7375 6d28 290a 2020 2020 2020 2020 2020  sum().          
-0000f170: 2020 766f 7865 6c5f 766f 6c20 3d20 6162    voxel_vol = ab
-0000f180: 7328 6e70 2e70 726f 6428 7365 6c66 2e67  s(np.prod(self.g
-0000f190: 6574 5f76 6f78 656c 5f73 697a 6528 2929  et_voxel_size())
-0000f1a0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0000f1b0: 6c66 2e5f 766f 6c75 6d65 5b22 6d6d 225d  lf._volume["mm"]
-0000f1c0: 203d 2073 656c 662e 5f76 6f6c 756d 655b   = self._volume[
-0000f1d0: 2276 6f78 656c 7322 5d20 2a20 766f 7865  "voxels"] * voxe
-0000f1e0: 6c5f 766f 6c0a 0a20 2020 2020 2020 2023  l_vol..        #
-0000f1f0: 2047 6574 2076 6f6c 756d 6520 696e 206d   Get volume in m
-0000f200: 6c20 6f72 2065 7175 6976 616c 656e 746c  l or equivalentl
-0000f210: 7920 6363 0a20 2020 2020 2020 2073 656c  y cc.        sel
-0000f220: 662e 5f76 6f6c 756d 655b 226d 6c22 5d20  f._volume["ml"] 
-0000f230: 3d20 7365 6c66 2e5f 766f 6c75 6d65 5b22  = self._volume["
-0000f240: 6d6d 225d 202f 2031 3030 300a 2020 2020  mm"] / 1000.    
-0000f250: 2020 2020 7365 6c66 2e5f 766f 6c75 6d65      self._volume
-0000f260: 5b22 6363 225d 203d 2073 656c 662e 5f76  ["cc"] = self._v
-0000f270: 6f6c 756d 655b 226d 6c22 5d0a 0a20 2020  olume["ml"]..   
-0000f280: 2020 2020 2023 2052 6574 7572 6e20 766f       # Return vo
-0000f290: 6c75 6d65 2069 6e20 7468 6520 7265 7175  lume in the requ
-0000f2a0: 6573 7465 6420 756e 6974 730a 2020 2020  ested units.    
-0000f2b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000f2c0: 5f76 6f6c 756d 655b 756e 6974 735d 0a0a  _volume[units]..
-0000f2d0: 2020 2020 6465 6620 6765 745f 6d61 736b      def get_mask
-0000f2e0: 5f74 6f5f 636f 6e74 6f75 725f 766f 6c75  _to_contour_volu
-0000f2f0: 6d65 5f72 6174 696f 2873 656c 6629 3a0a  me_ratio(self):.
-0000f300: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000f310: 2020 2020 4765 7420 7261 7469 6f20 746f      Get ratio to
-0000f320: 2052 4f49 2022 6d61 736b 2220 766f 6c75   ROI "mask" volu
-0000f330: 6d65 2074 6f20 524f 4920 2263 6f6e 746f  me to ROI "conto
-0000f340: 7572 2220 766f 6c75 6d65 2e0a 0a20 2020  ur" volume...   
-0000f350: 2020 2020 2049 6e20 7072 696e 6369 706c       In principl
-0000f360: 652c 2076 6f6c 756d 6520 6573 7469 6d61  e, volume estima
-0000f370: 7465 7320 6672 6f6d 2022 6d61 736b 2220  tes from "mask" 
-0000f380: 616e 6420 2263 6f6e 746f 7572 2220 6d65  and "contour" me
-0000f390: 7468 6f64 730a 2020 2020 2020 2020 7368  thods.        sh
-0000f3a0: 6f75 6c64 2062 6520 7369 6d69 6c61 722e  ould be similar.
-0000f3b0: 2020 5468 6520 7477 6f20 6573 7469 6d61    The two estima
-0000f3c0: 7465 7320 6d61 7920 6265 2064 6966 6665  tes may be diffe
-0000f3d0: 7265 6e74 2069 662c 2066 6f72 0a20 2020  rent if, for.   
-0000f3e0: 2020 2020 2065 7861 6d70 6c65 2c20 7468       example, th
-0000f3f0: 6520 696d 6167 6520 6672 6f6d 2077 6869  e image from whi
-0000f400: 6368 2061 206d 6173 6b20 6973 2063 7265  ch a mask is cre
-0000f410: 6174 6564 2064 6f65 736e 2774 2066 756c  ated doesn't ful
-0000f420: 6c79 2063 6f76 6572 0a20 2020 2020 2020  ly cover.       
-0000f430: 2074 6865 2063 6f6e 746f 7572 2065 7874   the contour ext
-0000f440: 656e 7473 2e0a 2020 2020 2020 2020 2222  ents..        ""
-0000f450: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-0000f460: 2028 7365 6c66 2e67 6574 5f76 6f6c 756d   (self.get_volum
-0000f470: 6528 6d65 7468 6f64 3d22 6d61 736b 222c  e(method="mask",
-0000f480: 2066 6f72 6365 3d54 7275 6529 202f 0a20   force=True) /. 
-0000f490: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000f4a0: 656c 662e 6765 745f 766f 6c75 6d65 286d  elf.get_volume(m
-0000f4b0: 6574 686f 643d 2263 6f6e 746f 7572 222c  ethod="contour",
-0000f4c0: 2066 6f72 6365 3d54 7275 6529 290a 0a20   force=True)).. 
-0000f4d0: 2020 2064 6566 2067 6574 5f61 7265 6128     def get_area(
-0000f4e0: 0a20 2020 2020 2020 2073 656c 662c 200a  .        self, .
-0000f4f0: 2020 2020 2020 2020 7669 6577 3d22 782d          view="x-
-0000f500: 7922 2c20 0a20 2020 2020 2020 2073 6c3d  y", .        sl=
-0000f510: 4e6f 6e65 2c20 0a20 2020 2020 2020 2069  None, .        i
-0000f520: 6478 3d4e 6f6e 652c 200a 2020 2020 2020  dx=None, .      
-0000f530: 2020 706f 733d 4e6f 6e65 2c20 0a20 2020    pos=None, .   
-0000f540: 2020 2020 2075 6e69 7473 3d22 6d6d 222c       units="mm",
-0000f550: 200a 2020 2020 2020 2020 6d65 7468 6f64   .        method
-0000f560: 3d4e 6f6e 652c 0a20 2020 2020 2020 2066  =None,.        f
-0000f570: 6c61 7474 656e 3d46 616c 7365 2c0a 2020  latten=False,.  
-0000f580: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-0000f590: 4765 7420 7468 6520 6172 6561 206f 6620  Get the area of 
-0000f5a0: 7468 6520 524f 4920 6f6e 2061 2067 6976  the ROI on a giv
-0000f5b0: 656e 2073 6c69 6365 2e0a 0a20 2020 2020  en slice...     
-0000f5c0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-0000f5d0: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
-0000f5e0: 2020 2020 7669 6577 203a 2073 7472 2c20      view : str, 
-0000f5f0: 6465 6661 756c 743d 2278 2d79 220a 2020  default="x-y".  
-0000f600: 2020 2020 2020 2020 2020 4f72 6965 6e74            Orient
-0000f610: 6174 696f 6e20 6f66 2073 6c69 6365 2066  ation of slice f
-0000f620: 6f72 2077 6869 6368 2074 6f20 6765 7420  or which to get 
-0000f630: 6172 6561 2e0a 0a20 2020 2020 2020 2073  area...        s
-0000f640: 6c20 3a20 696e 742c 2064 6566 6175 6c74  l : int, default
-0000f650: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0000f660: 2020 536c 6963 6520 6e75 6d62 6572 2e20    Slice number. 
-0000f670: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
-0000f680: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
-0000f690: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
-0000f6a0: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
-0000f6b0: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
-0000f6c0: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
-0000f6d0: 2073 6c69 6365 206f 6620 7468 6520 524f   slice of the RO
-0000f6e0: 4920 7769 6c6c 2062 6520 7573 6564 2e0a  I will be used..
-0000f6f0: 0a20 2020 2020 2020 2069 6478 203a 2069  .        idx : i
-0000f700: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
-0000f710: 0a20 2020 2020 2020 2020 2020 2041 7272  .            Arr
-0000f720: 6179 2069 6e64 6578 206f 6620 736c 6963  ay index of slic
-0000f730: 652e 2049 6620 6e6f 6e65 206f 6620 3c73  e. If none of <s
-0000f740: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
-0000f750: 733e 2061 7265 2073 7570 706c 6965 6420  s> are supplied 
-0000f760: 6275 740a 2020 2020 2020 2020 2020 2020  but.            
-0000f770: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
-0000f780: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
-0000f790: 7261 6c20 736c 6963 6520 6f66 2074 6865  ral slice of the
-0000f7a0: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
-0000f7b0: 642e 0a0a 2020 2020 2020 2020 706f 7320  d...        pos 
-0000f7c0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
-0000f7d0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0000f7e0: 2020 536c 6963 6520 706f 7369 7469 6f6e    Slice position
-0000f7f0: 2069 6e20 6d6d 2e20 4966 206e 6f6e 6520   in mm. If none 
-0000f800: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
-0000f810: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
-0000f820: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
-0000f830: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
-0000f840: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
-0000f850: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
-0000f860: 6620 7468 6520 524f 4920 7769 6c6c 2062  f the ROI will b
-0000f870: 6520 7573 6564 2e0a 0a20 2020 2020 2020  e used...       
-0000f880: 2075 6e69 7473 203a 2073 7472 2c20 6465   units : str, de
-0000f890: 6661 756c 743d 226d 6d22 0a20 2020 2020  fault="mm".     
-0000f8a0: 2020 2020 2020 2055 6e69 7473 206f 6620         Units of 
-0000f8b0: 6172 6561 2e20 4361 6e20 6265 2065 6974  area. Can be eit
-0000f8c0: 6865 7220 6f66 3a0a 0a20 2020 2020 2020  her of:..       
-0000f8d0: 2020 2020 2020 2020 202a 2022 6d6d 223a           * "mm":
-0000f8e0: 2072 6574 7572 6e20 6172 6561 2069 6e20   return area in 
-0000f8f0: 6d69 6c6c 696d 6574 7265 7320 7371 7561  millimetres squa
-0000f900: 7265 642e 0a20 2020 2020 2020 2020 2020  red..           
-0000f910: 2020 2020 202a 2022 766f 7865 6c73 223a       * "voxels":
-0000f920: 2072 6574 7572 6e20 6172 6561 2069 6e20   return area in 
-0000f930: 6e75 6d62 6572 206f 6620 766f 7865 6c73  number of voxels
-0000f940: 2e0a 0a20 2020 2020 2020 2020 2020 2049  ...            I
-0000f950: 6620 756e 6974 733d 2276 6f78 656c 7322  f units="voxels"
-0000f960: 2069 7320 7265 7175 6573 7465 6420 6275   is requested bu
-0000f970: 7420 7468 6973 2052 4f49 206f 6e6c 7920  t this ROI only 
-0000f980: 6861 7320 636f 6e74 6f75 7273 2061 6e64  has contours and
-0000f990: 206e 6f0a 2020 2020 2020 2020 2020 2020   no.            
-0000f9a0: 766f 7865 6c20 7369 7a65 2069 6e66 6f72  voxel size infor
-0000f9b0: 6d61 7469 6f6e 2c20 616e 2065 7272 6f72  mation, an error
-0000f9c0: 2077 696c 6c20 6265 2072 6169 7365 642e   will be raised.
-0000f9d0: 0a0a 2020 2020 2020 2020 6d65 7468 6f64  ..        method
-0000f9e0: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
-0000f9f0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0000fa00: 204d 6574 686f 6420 746f 2075 7365 2066   Method to use f
-0000fa10: 6f72 2061 7265 6120 6361 6c63 756c 6174  or area calculat
-0000fa20: 696f 6e2e 2043 616e 2062 653a 200a 0a20  ion. Can be: .. 
-0000fa30: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-0000fa40: 2022 636f 6e74 6f75 7222 3a20 636f 6d70   "contour": comp
-0000fa50: 7574 6520 6172 6561 2066 726f 6d20 7368  ute area from sh
-0000fa60: 6170 656c 7920 706f 6c79 676f 6e20 6f6e  apely polygon on
-0000fa70: 2074 6865 2073 6c69 6365 2e0a 2020 2020   the slice..    
-0000fa80: 2020 2020 2020 2020 2020 2020 2a20 226d              * "m
-0000fa90: 6173 6b22 3a20 636f 6d70 7574 6520 6172  ask": compute ar
-0000faa0: 6561 2062 7920 7375 6d6d 696e 6720 7069  ea by summing pi
-0000fab0: 7865 6c73 206f 6e20 7468 6520 736c 6963  xels on the slic
-0000fac0: 6520 616e 6420 0a20 2020 2020 2020 2020  e and .         
-0000fad0: 2020 2020 2020 2020 206d 756c 7469 706c           multipl
-0000fae0: 7969 6e67 2062 7920 7468 6520 6172 6561  ying by the area
-0000faf0: 206f 6620 6f6e 6520 7069 7865 6c2e 0a20   of one pixel.. 
-0000fb00: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-0000fb10: 204e 6f6e 653a 2075 7365 2074 6865 206d   None: use the m
-0000fb20: 6574 686f 6420 7365 7420 696e 2073 656c  ethod set in sel
-0000fb30: 662e 6465 6661 756c 745f 6765 6f6d 5f6d  f.default_geom_m
-0000fb40: 6574 686f 642e 0a0a 2020 2020 2020 2020  ethod...        
-0000fb50: 666c 6174 7465 6e20 3a20 626f 6f6c 2c20  flatten : bool, 
-0000fb60: 6465 6661 756c 743d 4661 6c73 650a 2020  default=False.  
-0000fb70: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-0000fb80: 652c 2061 6c6c 2073 6c69 6365 7320 7769  e, all slices wi
-0000fb90: 6c6c 2062 6520 666c 6174 7465 6e65 6420  ll be flattened 
-0000fba0: 696e 2074 6865 2067 6976 656e 206f 7269  in the given ori
-0000fbb0: 656e 7461 7469 6f6e 2061 6e64 0a20 2020  entation and.   
-0000fbc0: 2020 2020 2020 2020 2074 6865 2061 7265           the are
-0000fbd0: 6120 6f66 2074 6865 2066 6c61 7474 656e  a of the flatten
-0000fbe0: 6564 2073 6c69 6365 2077 696c 6c20 6265  ed slice will be
-0000fbf0: 2072 6574 7572 6e65 642e 204f 6e6c 7920   returned. Only 
-0000fc00: 6176 6169 6c61 626c 650a 2020 2020 2020  available.      
-0000fc10: 2020 2020 2020 6966 206d 6574 686f 643d        if method=
-0000fc20: 226d 6173 6b22 2e0a 2020 2020 2020 2020  "mask"..        
-0000fc30: 2222 220a 0a20 2020 2020 2020 2023 2047  """..        # G
-0000fc40: 6574 2064 6566 6175 6c74 2073 6c69 6365  et default slice
-0000fc50: 2069 6e64 6578 2061 6e64 206d 6574 686f   index and metho
-0000fc60: 640a 2020 2020 2020 2020 7365 6c66 2e6c  d.        self.l
-0000fc70: 6f61 6428 290a 2020 2020 2020 2020 6966  oad().        if
-0000fc80: 2073 6c20 6973 204e 6f6e 6520 616e 6420   sl is None and 
-0000fc90: 6964 7820 6973 204e 6f6e 6520 616e 6420  idx is None and 
-0000fca0: 706f 7320 6973 204e 6f6e 653a 200a 2020  pos is None: .  
-0000fcb0: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
-0000fcc0: 7365 6c66 2e67 6574 5f6d 6964 5f69 6478  self.get_mid_idx
-0000fcd0: 2876 6965 7729 0a20 2020 2020 2020 2069  (view).        i
-0000fce0: 6620 6d65 7468 6f64 2069 7320 4e6f 6e65  f method is None
-0000fcf0: 3a0a 2020 2020 2020 2020 2020 2020 6d65  :.            me
-0000fd00: 7468 6f64 203d 2073 656c 662e 6465 6661  thod = self.defa
-0000fd10: 756c 745f 6765 6f6d 5f6d 6574 686f 640a  ult_geom_method.
-0000fd20: 0a20 2020 2020 2020 2023 2049 6620 524f  .        # If RO
-0000fd30: 4920 6973 206e 6f74 206f 6e20 7468 6520  I is not on the 
-0000fd40: 6769 7665 6e20 736c 6963 652c 2072 6574  given slice, ret
-0000fd50: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-0000fd60: 2069 6620 6e6f 7420 7365 6c66 2e6f 6e5f   if not self.on_
-0000fd70: 736c 6963 6528 7669 6577 2c20 736c 3d73  slice(view, sl=s
-0000fd80: 6c2c 2069 6478 3d69 6478 2c20 706f 733d  l, idx=idx, pos=
-0000fd90: 706f 7329 3a0a 2020 2020 2020 2020 2020  pos):.          
-0000fda0: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-0000fdb0: 2020 6966 2066 6c61 7474 656e 3a20 2023    if flatten:  #
-0000fdc0: 2046 6c61 7474 656e 696e 6720 6f6e 6c79   Flattening only
-0000fdd0: 2070 6f73 7369 626c 6520 7769 7468 2022   possible with "
-0000fde0: 6d61 736b 220a 2020 2020 2020 2020 2020  mask".          
-0000fdf0: 2020 6d65 7468 6f64 203d 2022 6d61 736b    method = "mask
-0000fe00: 220a 0a20 2020 2020 2020 2023 2043 616c  "..        # Cal
-0000fe10: 6375 6c61 7465 2061 7265 6120 6672 6f6d  culate area from
-0000fe20: 2073 6861 7065 6c79 2070 6f6c 7967 6f6e   shapely polygon
-0000fe30: 2873 290a 2020 2020 2020 2020 6966 206d  (s).        if m
-0000fe40: 6574 686f 6420 3d3d 2022 636f 6e74 6f75  ethod == "contou
-0000fe50: 7222 3a0a 0a20 2020 2020 2020 2020 2020  r":..           
-0000fe60: 2023 2043 6865 636b 2069 7427 7320 706f   # Check it's po
-0000fe70: 7373 6962 6c65 2074 6f20 6361 6c63 756c  ssible to calcul
-0000fe80: 6174 6520 6172 6561 2077 6974 6820 7468  ate area with th
-0000fe90: 6520 7265 7175 6573 7465 6420 756e 6974  e requested unit
-0000fea0: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
-0000feb0: 2073 656c 662e 766f 7865 6c5f 7369 7a65   self.voxel_size
-0000fec0: 2069 7320 4e6f 6e65 2061 6e64 2075 6e69   is None and uni
-0000fed0: 7473 203d 3d20 2276 6f78 656c 7322 3a0a  ts == "voxels":.
-0000fee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fef0: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
-0000ff00: 6f72 2822 4361 6e6e 6f74 2063 6f6d 7075  or("Cannot compu
-0000ff10: 7465 2061 7265 6120 696e 2076 6f78 656c  te area in voxel
-0000ff20: 7320 6672 6f6d 2022 0a20 2020 2020 2020  s from ".       
-0000ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff40: 2020 2020 2020 2020 2020 2020 2263 6f6e              "con
-0000ff50: 746f 7572 7320 7769 7468 6f75 7420 6b6e  tours without kn
-0000ff60: 6f77 696e 6720 766f 7865 6c20 7369 7a65  owing voxel size
-0000ff70: 7321 2229 0a0a 2020 2020 2020 2020 2020  s!")..          
-0000ff80: 2020 706f 6c79 676f 6e73 203d 2073 656c    polygons = sel
-0000ff90: 662e 6765 745f 706f 6c79 676f 6e73 5f6f  f.get_polygons_o
-0000ffa0: 6e5f 736c 6963 6528 7669 6577 2c20 736c  n_slice(view, sl
-0000ffb0: 2c20 6964 782c 2070 6f73 290a 2020 2020  , idx, pos).    
-0000ffc0: 2020 2020 2020 2020 6172 6561 203d 2073          area = s
-0000ffd0: 756d 285b 702e 6172 6561 2066 6f72 2070  um([p.area for p
-0000ffe0: 2069 6e20 706f 6c79 676f 6e73 5d29 0a20   in polygons]). 
-0000fff0: 2020 2020 2020 2020 2020 2069 6620 756e             if un
-00010000: 6974 7320 3d3d 2022 766f 7865 6c73 223a  its == "voxels":
-00010010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010020: 2078 5f61 782c 2079 5f61 7820 3d20 736b   x_ax, y_ax = sk
-00010030: 7274 2e69 6d61 6765 2e5f 706c 6f74 5f61  rt.image._plot_a
-00010040: 7865 735b 7669 6577 5d0a 2020 2020 2020  xes[view].      
-00010050: 2020 2020 2020 2020 2020 7879 5f61 7265            xy_are
-00010060: 6120 3d20 6162 7328 7365 6c66 2e76 6f78  a = abs(self.vox
-00010070: 656c 5f73 697a 655b 785f 6178 5d20 2a20  el_size[x_ax] * 
-00010080: 7365 6c66 2e76 6f78 656c 5f73 697a 655b  self.voxel_size[
-00010090: 795f 6178 5d29 0a20 2020 2020 2020 2020  y_ax]).         
-000100a0: 2020 2020 2020 2061 7265 6120 2f3d 2078         area /= x
-000100b0: 795f 6172 6561 0a20 2020 2020 2020 2020  y_area.         
-000100c0: 2020 2072 6574 7572 6e20 6172 6561 0a0a     return area..
-000100d0: 2020 2020 2020 2020 2320 4f74 6865 7277          # Otherw
-000100e0: 6973 652c 2063 616c 6375 6c61 7465 2061  ise, calculate a
-000100f0: 7265 6120 6672 6f6d 2062 696e 6172 7920  rea from binary 
-00010100: 6d61 736b 0a20 2020 2020 2020 2069 6d5f  mask.        im_
-00010110: 736c 6963 6520 3d20 7365 6c66 2e67 6574  slice = self.get
-00010120: 5f73 6c69 6365 2876 6965 772c 2073 6c3d  _slice(view, sl=
-00010130: 736c 2c20 6964 783d 6964 782c 2070 6f73  sl, idx=idx, pos
-00010140: 3d70 6f73 2c20 0a20 2020 2020 2020 2020  =pos, .         
-00010150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010160: 2020 2020 2020 2020 2066 6c61 7474 656e           flatten
-00010170: 3d66 6c61 7474 656e 290a 2020 2020 2020  =flatten).      
-00010180: 2020 6172 6561 203d 2069 6d5f 736c 6963    area = im_slic
-00010190: 652e 6173 7479 7065 2862 6f6f 6c29 2e73  e.astype(bool).s
-000101a0: 756d 2829 0a20 2020 2020 2020 2069 6620  um().        if 
-000101b0: 756e 6974 7320 3d3d 2022 6d6d 223a 0a20  units == "mm":. 
-000101c0: 2020 2020 2020 2020 2020 2078 5f61 782c             x_ax,
-000101d0: 2079 5f61 7820 3d20 736b 7274 2e69 6d61   y_ax = skrt.ima
-000101e0: 6765 2e5f 706c 6f74 5f61 7865 735b 7669  ge._plot_axes[vi
-000101f0: 6577 5d0a 2020 2020 2020 2020 2020 2020  ew].            
-00010200: 7879 5f61 7265 6120 3d20 6162 7328 7365  xy_area = abs(se
-00010210: 6c66 2e76 6f78 656c 5f73 697a 655b 785f  lf.voxel_size[x_
-00010220: 6178 5d20 2a20 7365 6c66 2e76 6f78 656c  ax] * self.voxel
-00010230: 5f73 697a 655b 795f 6178 5d29 0a20 2020  _size[y_ax]).   
-00010240: 2020 2020 2020 2020 2061 7265 6120 2a3d           area *=
-00010250: 2078 795f 6172 6561 0a20 2020 2020 2020   xy_area.       
-00010260: 2072 6574 7572 6e20 6172 6561 0a0a 2020   return area..  
-00010270: 2020 6465 6620 6765 745f 6262 6f78 5f63    def get_bbox_c
-00010280: 656e 7472 655f 616e 645f 7769 6474 6873  entre_and_widths
-00010290: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
-000102a0: 2020 2062 7566 6665 723d 4e6f 6e65 2c20     buffer=None, 
-000102b0: 6275 6666 6572 5f75 6e69 7473 3d22 6d6d  buffer_units="mm
-000102c0: 222c 206d 6574 686f 643d 4e6f 6e65 293a  ", method=None):
-000102d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000102e0: 2020 2020 2047 6574 2063 656e 7472 6520       Get centre 
-000102f0: 616e 6420 7769 6474 6873 2069 6e20 6d6d  and widths in mm
-00010300: 2061 6c6f 6e67 2061 6c6c 2074 6872 6565   along all three
-00010310: 2061 7865 7320 6f66 2061 0a20 2020 2020   axes of a.     
-00010320: 2020 2062 6f75 6e64 696e 6720 626f 7820     bounding box 
-00010330: 656e 636c 6f73 696e 6720 7468 6520 524f  enclosing the RO
-00010340: 4920 616e 6420 6f70 7469 6f6e 616c 2062  I and optional b
-00010350: 7566 6665 722e 2020 4365 6e74 7265 0a20  uffer.  Centre. 
-00010360: 2020 2020 2020 2061 6e64 2077 6964 7468         and width
-00010370: 7320 6172 6520 7265 7475 726e 6564 2061  s are returned a
-00010380: 7320 6120 7475 706c 6520 285b 782c 2079  s a tuple ([x, y
-00010390: 2c20 7a5d 2c20 5b64 782c 2064 792c 2064  , z], [dx, dy, d
-000103a0: 7a5d 292e 0a0a 2020 2020 2020 2020 4d65  z])...        Me
-000103b0: 7468 6f64 2070 6172 616d 6574 6572 7320  thod parameters 
-000103c0: 6172 6520 7061 7373 6564 2074 6f20 736b  are passed to sk
-000103d0: 7274 2e73 7472 7563 7475 7265 732e 524f  rt.structures.RO
-000103e0: 492e 6765 745f 6578 7465 6e74 7328 290a  I.get_extents().
-000103f0: 2020 2020 2020 2020 746f 206f 6274 6169          to obtai
-00010400: 6e20 524f 4920 6578 7465 6e74 732e 2020  n ROI extents.  
-00010410: 466f 7220 7061 7261 6d65 7465 7220 6578  For parameter ex
-00010420: 706c 616e 6174 696f 6e73 2c20 7365 650a  planations, see.
-00010430: 2020 2020 2020 2020 736b 7274 2e73 7472          skrt.str
-00010440: 7563 7475 7265 732e 524f 492e 6765 745f  uctures.ROI.get_
-00010450: 6578 7465 6e74 7328 2920 646f 6375 6d65  extents() docume
-00010460: 6e74 6174 696f 6e2e 0a20 2020 2020 2020  ntation..       
-00010470: 2022 2222 0a20 2020 2020 2020 2065 7874   """.        ext
-00010480: 656e 7473 203d 2073 656c 662e 6765 745f  ents = self.get_
-00010490: 6578 7465 6e74 7328 6275 6666 6572 2c20  extents(buffer, 
-000104a0: 6275 6666 6572 5f75 6e69 7473 2c20 6d65  buffer_units, me
-000104b0: 7468 6f64 2920 0a20 2020 2020 2020 2063  thod) .        c
-000104c0: 656e 7472 6520 3d20 5b30 2e35 202a 2028  entre = [0.5 * (
-000104d0: 6578 7465 6e74 5b30 5d20 2b20 6578 7465  extent[0] + exte
-000104e0: 6e74 5b31 5d29 2066 6f72 2065 7874 656e  nt[1]) for exten
-000104f0: 7420 696e 2065 7874 656e 7473 5d0a 2020  t in extents].  
-00010500: 2020 2020 2020 7769 6474 6873 203d 205b        widths = [
-00010510: 2865 7874 656e 745b 315d 202d 2065 7874  (extent[1] - ext
-00010520: 656e 745b 305d 2920 666f 7220 6578 7465  ent[0]) for exte
-00010530: 6e74 2069 6e20 6578 7465 6e74 735d 0a20  nt in extents]. 
-00010540: 2020 2020 2020 2072 6574 7572 6e20 2863         return (c
-00010550: 656e 7472 652c 2077 6964 7468 7329 0a0a  entre, widths)..
-00010560: 2020 2020 6465 6620 6765 745f 6578 7465      def get_exte
-00010570: 6e74 7328 7365 6c66 2c20 6275 6666 6572  nts(self, buffer
-00010580: 3d4e 6f6e 652c 2062 7566 6665 725f 756e  =None, buffer_un
-00010590: 6974 733d 226d 6d22 2c20 6d65 7468 6f64  its="mm", method
-000105a0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-000105b0: 2020 206f 7269 6769 6e3d 4e6f 6e65 293a     origin=None):
-000105c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000105d0: 2020 2020 2047 6574 206d 696e 696d 756d       Get minimum
-000105e0: 2061 6e64 206d 6178 696d 756d 2065 7874   and maximum ext
-000105f0: 656e 7420 6f66 2074 6865 2052 4f49 2069  ent of the ROI i
-00010600: 6e20 6d6d 2061 6c6f 6e67 2061 6c6c 2074  n mm along all t
-00010610: 6872 6565 2061 7865 732c 0a20 2020 2020  hree axes,.     
-00010620: 2020 2072 6574 7572 6e65 6420 696e 206f     returned in o
-00010630: 7264 6572 205b 782c 2079 2c20 7a5d 2e20  rder [x, y, z]. 
-00010640: 4f70 7469 6f6e 616c 6c79 2061 7070 6c79  Optionally apply
-00010650: 2061 2062 7566 6665 7220 746f 2074 6865   a buffer to the
-00010660: 2065 7874 656e 7473 0a20 2020 2020 2020   extents.       
-00010670: 2073 7563 6820 7468 6174 2074 6865 7920   such that they 
-00010680: 636f 7665 7220 6d6f 7265 2074 6861 6e20  cover more than 
-00010690: 7468 6520 524f 4927 7320 6172 6561 2e0a  the ROI's area..
-000106a0: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
-000106b0: 6574 6572 733a 2a2a 0a0a 2020 2020 2020  eters:**..      
-000106c0: 2020 6275 6666 6572 203a 2066 6c6f 6174    buffer : float
-000106d0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-000106e0: 2020 2020 2020 2020 2020 204f 7074 696f             Optio
-000106f0: 6e61 6c20 6275 6666 6572 2074 6f20 6164  nal buffer to ad
-00010700: 6420 746f 2074 6865 2065 7874 656e 7473  d to the extents
-00010710: 2e20 556e 6974 7320 7365 7420 6279 2060  . Units set by `
-00010720: 6275 6666 6572 5f75 6e69 7473 602e 0a0a  buffer_units`...
-00010730: 2020 2020 2020 2020 6275 6666 6572 5f75          buffer_u
-00010740: 6e69 7473 203a 2073 7472 2c20 6465 6661  nits : str, defa
-00010750: 756c 743d 226d 6d22 0a20 2020 2020 2020  ult="mm".       
-00010760: 2020 2020 2055 6e69 7473 2066 6f72 2062       Units for b
-00010770: 7566 6665 722c 2069 6620 7573 696e 672e  uffer, if using.
-00010780: 2043 616e 2062 6520 226d 6d22 2c20 2276   Can be "mm", "v
-00010790: 6f78 656c 7322 2c20 6f72 2022 6672 6163  oxels", or "frac
-000107a0: 2220 2877 6869 6368 0a20 2020 2020 2020  " (which.       
-000107b0: 2020 2020 2061 7070 6c69 6573 2062 7566       applies buf
-000107c0: 6665 7220 6173 2061 2066 7261 6374 696f  fer as a fractio
-000107d0: 6e20 6f66 2074 6f74 616c 206c 656e 6774  n of total lengt
-000107e0: 6820 696e 2065 6163 6820 6469 6d65 6e73  h in each dimens
-000107f0: 696f 6e29 2e0a 0a20 2020 2020 2020 206d  ion)...        m
-00010800: 6574 686f 6420 3a20 7374 722c 2064 6566  ethod : str, def
-00010810: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00010820: 2020 2020 2020 4d65 7468 6f64 2074 6f20        Method to 
-00010830: 7573 6520 666f 7220 6578 7465 6e74 2063  use for extent c
-00010840: 616c 6375 6c61 7469 6f6e 2e20 4361 6e20  alculation. Can 
-00010850: 6265 3a20 0a0a 2020 2020 2020 2020 2020  be: ..          
-00010860: 2020 2020 2020 2a20 2263 6f6e 746f 7572        * "contour
-00010870: 223a 2067 6574 2065 7874 656e 7420 6672  ": get extent fr
-00010880: 6f6d 206d 696e 2f6d 6178 2070 6f73 6974  om min/max posit
-00010890: 696f 6e73 206f 6620 636f 6e74 6f75 7228  ions of contour(
-000108a0: 7329 2e0a 2020 2020 2020 2020 2020 2020  s)..            
-000108b0: 2020 2020 2a20 226d 6173 6b22 3a20 6765      * "mask": ge
-000108c0: 7420 6578 7465 6e74 2066 726f 6d20 6d69  t extent from mi
-000108d0: 6e2f 6d61 7820 706f 7369 7469 6f6e 7320  n/max positions 
-000108e0: 6f66 2076 6f78 656c 7320 696e 2074 6865  of voxels in the
-000108f0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00010900: 2020 2020 6269 6e61 7279 206d 6173 6b2e      binary mask.
-00010910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010920: 202a 204e 6f6e 653a 2075 7365 2074 6865   * None: use the
-00010930: 206d 6574 686f 6420 7365 7420 696e 2073   method set in s
-00010940: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
-00010950: 5f6d 6574 686f 642e 0a0a 2020 2020 2020  _method...      
-00010960: 2020 6f72 6967 696e 203a 2074 7570 6c65    origin : tuple
-00010970: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00010980: 2020 2020 2020 2020 2020 2054 7570 6c65             Tuple
-00010990: 2073 7065 6369 6679 696e 6720 7468 6520   specifying the 
-000109a0: 2878 2c20 792c 207a 2920 636f 6f72 6469  (x, y, z) coordi
-000109b0: 6e61 7465 7320 6f66 2074 6865 2070 6f69  nates of the poi
-000109c0: 6e74 0a20 2020 2020 2020 2020 2020 2077  nt.            w
-000109d0: 6974 6820 7265 7370 6563 7420 746f 2077  ith respect to w
-000109e0: 6869 6368 2065 7874 656e 7473 2061 7265  hich extents are
-000109f0: 2074 6f20 6265 2064 6574 6572 6d69 6e65   to be determine
-00010a00: 642e 0a20 2020 2020 2020 2020 2020 2049  d..            I
-00010a10: 6620 4e6f 6e65 2c20 7468 656e 2028 302c  f None, then (0,
-00010a20: 2030 2c20 3029 2069 7320 7573 6564 2e0a   0, 0) is used..
-00010a30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00010a40: 2020 2020 2320 456e 7375 7265 2074 6861      # Ensure tha
-00010a50: 7420 6f72 6967 696e 2069 7320 6465 6669  t origin is defi
-00010a60: 6e65 642e 0a20 2020 2020 2020 206f 7269  ned..        ori
-00010a70: 6769 6e20 3d20 6f72 6967 696e 206f 7220  gin = origin or 
-00010a80: 2830 2c20 302c 2030 290a 0a20 2020 2020  (0, 0, 0)..     
-00010a90: 2020 2023 2047 6574 2065 7874 656e 7420     # Get extent 
-00010aa0: 696e 2065 6163 6820 6469 7265 6374 696f  in each directio
-00010ab0: 6e0a 2020 2020 2020 2020 6578 7465 6e74  n.        extent
-00010ac0: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
-00010ad0: 6f72 2061 7820 696e 2073 6b72 742e 696d  or ax in skrt.im
-00010ae0: 6167 652e 5f61 7865 733a 0a20 2020 2020  age._axes:.     
-00010af0: 2020 2020 2020 2065 7874 656e 7473 2e61         extents.a
-00010b00: 7070 656e 6428 7365 6c66 2e67 6574 5f65  ppend(self.get_e
-00010b10: 7874 656e 7428 6178 2c20 6d65 7468 6f64  xtent(ax, method
-00010b20: 3d6d 6574 686f 642c 206f 7269 6769 6e3d  =method, origin=
-00010b30: 6f72 6967 696e 2929 0a0a 2020 2020 2020  origin))..      
-00010b40: 2020 2320 4170 706c 7920 6275 6666 6572    # Apply buffer
-00010b50: 2069 6620 7265 7175 6573 7465 640a 2020   if requested.  
-00010b60: 2020 2020 2020 6966 2062 7566 6665 723a        if buffer:
-00010b70: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00010b80: 2061 7820 696e 2072 616e 6765 2833 293a   ax in range(3):
-00010b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010ba0: 2069 6620 6275 6666 6572 5f75 6e69 7473   if buffer_units
-00010bb0: 203d 3d20 226d 6d22 3a0a 2020 2020 2020   == "mm":.      
-00010bc0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00010bd0: 6c74 6120 3d20 6275 6666 6572 0a20 2020  lta = buffer.   
-00010be0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-00010bf0: 6620 6275 6666 6572 5f75 6e69 7473 203d  f buffer_units =
-00010c00: 3d20 2276 6f78 656c 7322 3a0a 2020 2020  = "voxels":.    
-00010c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c20: 6465 6c74 6120 3d20 6162 7328 6275 6666  delta = abs(buff
-00010c30: 6572 202a 2073 656c 662e 766f 7865 6c5f  er * self.voxel_
-00010c40: 7369 7a65 5b61 785d 290a 2020 2020 2020  size[ax]).      
-00010c50: 2020 2020 2020 2020 2020 656c 6966 2062            elif b
-00010c60: 7566 6665 725f 756e 6974 7320 3d3d 2022  uffer_units == "
-00010c70: 6672 6163 223a 0a20 2020 2020 2020 2020  frac":.         
-00010c80: 2020 2020 2020 2020 2020 2064 656c 7461             delta
-00010c90: 203d 2062 7566 6665 7220 2a20 6162 7328   = buffer * abs(
-00010ca0: 6578 7465 6e74 735b 6178 5d5b 315d 202d  extents[ax][1] -
-00010cb0: 2065 7874 656e 7473 5b61 785d 5b30 5d29   extents[ax][0])
-00010cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010cd0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00010ce0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00010cf0: 2866 2255 6e72 6563 6f67 6e69 7365 6420  (f"Unrecognised 
-00010d00: 6275 6666 6572 2075 6e69 7473 207b 6275  buffer units {bu
-00010d10: 6666 6572 5f75 6e69 7473 7d2e 2053 686f  ffer_units}. Sho
-00010d20: 756c 6420 220a 2020 2020 2020 2020 2020  uld ".          
-00010d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d40: 2762 6520 226d 6d22 2c20 2276 6f78 656c  'be "mm", "voxel
-00010d50: 7322 2c20 6f72 2022 6672 6163 222e 2729  s", or "frac".')
-00010d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010d70: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-00010d80: 2020 2020 2020 2020 2020 2020 6578 7465              exte
-00010d90: 6e74 735b 6178 5d5b 305d 202d 3d20 6465  nts[ax][0] -= de
-00010da0: 6c74 610a 2020 2020 2020 2020 2020 2020  lta.            
-00010db0: 2020 2020 6578 7465 6e74 735b 6178 5d5b      extents[ax][
-00010dc0: 315d 202b 3d20 6465 6c74 610a 0a20 2020  1] += delta..   
-00010dd0: 2020 2020 2072 6574 7572 6e20 6578 7465       return exte
-00010de0: 6e74 730a 0a20 2020 2064 6566 2067 6574  nts..    def get
-00010df0: 5f65 7874 656e 7428 7365 6c66 2c20 0a20  _extent(self, . 
-00010e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e10: 2020 6178 3d22 7a22 2c20 0a20 2020 2020    ax="z", .     
-00010e20: 2020 2020 2020 2020 2020 2020 2020 7369                si
-00010e30: 6e67 6c65 5f73 6c69 6365 3d46 616c 7365  ngle_slice=False
-00010e40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00010e50: 2020 2020 2076 6965 773d 2278 2d79 222c       view="x-y",
-00010e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010e70: 2020 2020 736c 3d4e 6f6e 652c 200a 2020      sl=None, .  
-00010e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e90: 2069 6478 3d4e 6f6e 652c 200a 2020 2020   idx=None, .    
-00010ea0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00010eb0: 6f73 3d4e 6f6e 652c 200a 2020 2020 2020  os=None, .      
-00010ec0: 2020 2020 2020 2020 2020 2020 206d 6574               met
-00010ed0: 686f 643d 4e6f 6e65 2c20 0a20 2020 2020  hod=None, .     
-00010ee0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-00010ef0: 6967 696e 3d4e 6f6e 652c 0a20 2020 2020  igin=None,.     
-00010f00: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
-00010f10: 2020 2020 2020 2020 2222 2247 6574 206d          """Get m
-00010f20: 696e 696d 756d 2061 6e64 206d 6178 696d  inimum and maxim
-00010f30: 756d 2065 7874 656e 7420 6f66 2074 6865  um extent of the
-00010f40: 2052 4f49 2069 6e20 6d6d 2061 6c6f 6e67   ROI in mm along
-00010f50: 2061 2067 6976 656e 2061 7869 732e 0a0a   a given axis...
-00010f60: 2020 2020 2020 2020 6178 203a 2073 7472          ax : str
-00010f70: 2f69 6e74 2c20 6465 6661 756c 743d 227a  /int, default="z
-00010f80: 220a 2020 2020 2020 2020 2020 2020 4178  ".            Ax
-00010f90: 6973 2061 6c6f 6e67 2077 6869 6368 2074  is along which t
-00010fa0: 6f20 7265 7475 726e 2065 7874 656e 742e  o return extent.
-00010fb0: 2053 686f 756c 6420 6265 206f 6e65 206f   Should be one o
-00010fc0: 6620 5b22 7822 2c20 2279 222c 2022 7a22  f ["x", "y", "z"
-00010fd0: 5d20 0a20 2020 2020 2020 2020 2020 206f  ] .            o
-00010fe0: 7220 5b30 2c20 312c 2032 5d0a 0a20 2020  r [0, 1, 2]..   
-00010ff0: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
-00011000: 6520 3a20 626f 6f6c 2c20 6465 6661 756c  e : bool, defaul
-00011010: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
-00011020: 2020 2020 4966 2046 616c 7365 2c20 7468      If False, th
-00011030: 6520 3344 2065 7874 656e 7420 6f66 2074  e 3D extent of t
-00011040: 6865 2065 6e74 6972 6520 524f 4920 7769  he entire ROI wi
-00011050: 6c6c 2062 6520 7265 7475 726e 6564 3b0a  ll be returned;.
-00011060: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
-00011070: 7277 6973 652c 2074 6865 2032 4420 6578  rwise, the 2D ex
-00011080: 7465 6e74 206f 6620 6120 7369 6e67 6c65  tent of a single
-00011090: 2073 6c69 6365 2077 696c 6c20 6265 2072   slice will be r
-000110a0: 6574 7572 6e65 642e 0a0a 2020 2020 2020  eturned...      
-000110b0: 2020 7669 6577 203a 2073 7472 2c20 6465    view : str, de
-000110c0: 6661 756c 743d 2278 2d79 220a 2020 2020  fault="x-y".    
-000110d0: 2020 2020 2020 2020 4f72 6965 6e74 6174          Orientat
-000110e0: 696f 6e20 6f66 2073 6c69 6365 206f 6e20  ion of slice on 
-000110f0: 7768 6963 6820 746f 2067 6574 2065 7874  which to get ext
-00011100: 656e 742e 204f 6e6c 7920 7573 6564 2069  ent. Only used i
-00011110: 6620 0a20 2020 2020 2020 2020 2020 2073  f .            s
-00011120: 696e 676c 655f 736c 6963 653d 5472 7565  ingle_slice=True
-00011130: 2e20 4966 2075 7369 6e67 2c20 3c61 783e  . If using, <ax>
-00011140: 206d 7573 7420 6265 2061 6e20 6178 6973   must be an axis
-00011150: 2074 6861 7420 6c69 6573 2061 6c6f 6e67   that lies along
-00011160: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-00011170: 2073 6c69 6365 2069 6e20 7468 6973 206f   slice in this o
-00011180: 7269 656e 7461 7469 6f6e 2e0a 0a20 2020  rientation...   
-00011190: 2020 2020 2073 6c20 3a20 696e 742c 2064       sl : int, d
-000111a0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-000111b0: 2020 2020 2020 2020 536c 6963 6520 6e75          Slice nu
-000111c0: 6d62 6572 2e20 4966 206e 6f6e 6520 6f66  mber. If none of
-000111d0: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
-000111e0: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
-000111f0: 6564 2062 7574 0a20 2020 2020 2020 2020  ed but.         
-00011200: 2020 203c 7369 6e67 6c65 5f73 6c69 6365     <single_slice
-00011210: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
-00011220: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
-00011230: 7468 6520 524f 4920 7769 6c6c 2062 6520  the ROI will be 
-00011240: 7573 6564 2e0a 0a20 2020 2020 2020 2069  used...        i
-00011250: 6478 203a 2069 6e74 2c20 6465 6661 756c  dx : int, defaul
-00011260: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-00011270: 2020 2041 7272 6179 2069 6e64 6578 206f     Array index o
-00011280: 6620 736c 6963 652e 2049 6620 6e6f 6e65  f slice. If none
-00011290: 206f 6620 3c73 6c3e 2c20 3c69 6478 3e20   of <sl>, <idx> 
-000112a0: 6f72 203c 706f 733e 2061 7265 2073 7570  or <pos> are sup
-000112b0: 706c 6965 6420 6275 740a 2020 2020 2020  plied but.      
-000112c0: 2020 2020 2020 3c73 696e 676c 655f 736c        <single_sl
-000112d0: 6963 653e 2069 7320 5472 7565 2c20 7468  ice> is True, th
-000112e0: 6520 6365 6e74 7261 6c20 736c 6963 6520  e central slice 
-000112f0: 6f66 2074 6865 2052 4f49 2077 696c 6c20  of the ROI will 
-00011300: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
-00011310: 2020 706f 7320 3a20 666c 6f61 742c 2064    pos : float, d
-00011320: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00011330: 2020 2020 2020 2020 536c 6963 6520 706f          Slice po
-00011340: 7369 7469 6f6e 2069 6e20 6d6d 2e20 4966  sition in mm. If
-00011350: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
-00011360: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
-00011370: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
-00011380: 2020 2020 2020 2020 2020 203c 7369 6e67             <sing
-00011390: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
-000113a0: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
-000113b0: 6c69 6365 206f 6620 7468 6520 524f 4920  lice of the ROI 
-000113c0: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
-000113d0: 2020 2020 2020 206d 6574 686f 6420 3a20         method : 
-000113e0: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
-000113f0: 650a 2020 2020 2020 2020 2020 2020 4d65  e.            Me
-00011400: 7468 6f64 2074 6f20 7573 6520 666f 7220  thod to use for 
-00011410: 6578 7465 6e74 2063 616c 6375 6c61 7469  extent calculati
-00011420: 6f6e 2e20 4361 6e20 6265 3a20 0a0a 2020  on. Can be: ..  
-00011430: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-00011440: 2263 6f6e 746f 7572 223a 2067 6574 2065  "contour": get e
-00011450: 7874 656e 7420 6672 6f6d 206d 696e 2f6d  xtent from min/m
-00011460: 6178 2070 6f73 6974 696f 6e73 206f 6620  ax positions of 
-00011470: 636f 6e74 6f75 7228 7329 2e0a 2020 2020  contour(s)..    
-00011480: 2020 2020 2020 2020 2020 2020 2a20 226d              * "m
-00011490: 6173 6b22 3a20 6765 7420 6578 7465 6e74  ask": get extent
-000114a0: 2066 726f 6d20 6d69 6e2f 6d61 7820 706f   from min/max po
-000114b0: 7369 7469 6f6e 7320 6f66 2076 6f78 656c  sitions of voxel
-000114c0: 7320 696e 2074 6865 200a 2020 2020 2020  s in the .      
-000114d0: 2020 2020 2020 2020 2020 2020 6269 6e61              bina
-000114e0: 7279 206d 6173 6b2e 0a20 2020 2020 2020  ry mask..       
-000114f0: 2020 2020 2020 2020 202a 204e 6f6e 653a           * None:
-00011500: 2075 7365 2074 6865 206d 6574 686f 6420   use the method 
-00011510: 7365 7420 696e 2073 656c 662e 6465 6661  set in self.defa
-00011520: 756c 745f 6765 6f6d 5f6d 6574 686f 642e  ult_geom_method.
-00011530: 0a0a 2020 2020 2020 2020 6f72 6967 696e  ..        origin
-00011540: 203a 2069 6e74 2f66 6c6f 6174 2f74 7570   : int/float/tup
-00011550: 6c65 2c20 6465 6661 756c 743d 4e6f 6e65  le, default=None
-00011560: 0a20 2020 2020 2020 2020 2020 2050 6f69  .            Poi
-00011570: 6e74 2077 6974 6820 7265 7370 6563 7420  nt with respect 
-00011580: 746f 2077 6869 6368 2065 7874 656e 7473  to which extents
-00011590: 2061 7265 2074 6f20 6265 2064 6574 6572   are to be deter
-000115a0: 6d69 6e65 642e 0a20 2020 2020 2020 2020  mined..         
-000115b0: 2020 2054 6869 7320 6361 6e20 6265 2061     This can be a
-000115c0: 6e20 696e 7465 6765 7220 6f72 2066 6c6f  n integer or flo
-000115d0: 6174 2073 7065 6369 6679 696e 6720 7468  at specifying th
-000115e0: 6520 706f 696e 7427 730a 2020 2020 2020  e point's.      
-000115f0: 2020 2020 2020 636f 6f72 6469 6e61 7465        coordinate
-00011600: 2061 6c6f 6e67 2061 7869 7320 3c61 783e   along axis <ax>
-00011610: 3b20 6f72 2069 7420 6361 6e20 6265 2061  ; or it can be a
-00011620: 2074 7570 6c65 2073 7065 6369 6679 696e   tuple specifyin
-00011630: 670a 2020 2020 2020 2020 2020 2020 7468  g.            th
-00011640: 6520 706f 696e 7427 7320 2878 2c20 792c  e point's (x, y,
-00011650: 207a 2920 636f 6f72 6469 6e61 7465 732c   z) coordinates,
-00011660: 2077 6865 7265 206f 6e6c 7920 7468 6520   where only the 
-00011670: 636f 6f72 6469 6e61 7465 0a20 2020 2020  coordinate.     
-00011680: 2020 2020 2020 2061 6c6f 6e67 2061 7869         along axi
-00011690: 7320 3c61 783e 2077 696c 6c20 6265 2063  s <ax> will be c
-000116a0: 6f6e 7369 6465 7265 642e 2020 4966 204e  onsidered.  If N
-000116b0: 6f6e 652c 2074 6865 206f 7269 6769 6e0a  one, the origin.
-000116c0: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
-000116d0: 6469 6e61 7465 2069 7320 7461 6b65 6e20  dinate is taken 
-000116e0: 746f 2062 6520 302e 0a20 2020 2020 2020  to be 0..       
-000116f0: 2022 2222 0a0a 2020 2020 2020 2020 2320   """..        # 
-00011700: 4765 7420 6465 6661 756c 7420 736c 6963  Get default slic
-00011710: 6520 616e 6420 6d65 7468 6f64 0a20 2020  e and method.   
-00011720: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
-00011730: 0a20 2020 2020 2020 2069 6620 6d65 7468  .        if meth
-00011740: 6f64 2069 7320 4e6f 6e65 3a0a 2020 2020  od is None:.    
-00011750: 2020 2020 2020 2020 6d65 7468 6f64 203d          method =
-00011760: 2073 656c 662e 6465 6661 756c 745f 6765   self.default_ge
-00011770: 6f6d 5f6d 6574 686f 640a 2020 2020 2020  om_method.      
-00011780: 2020 6966 2073 696e 676c 655f 736c 6963    if single_slic
-00011790: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-000117a0: 6620 6964 7820 6973 204e 6f6e 6520 616e  f idx is None an
-000117b0: 6420 736c 2069 7320 4e6f 6e65 2061 6e64  d sl is None and
-000117c0: 2070 6f73 2069 7320 4e6f 6e65 3a0a 2020   pos is None:.  
-000117d0: 2020 2020 2020 2020 2020 2020 2020 6964                id
-000117e0: 7820 3d20 7365 6c66 2e67 6574 5f6d 6964  x = self.get_mid
-000117f0: 5f69 6478 2829 0a0a 2020 2020 2020 2020  _idx()..        
-00011800: 2320 4966 2075 7369 6e67 2073 696e 676c  # If using singl
-00011810: 6520 736c 6963 652c 2063 6865 636b 2074  e slice, check t
-00011820: 6865 2061 7869 7320 6c69 6573 2061 6c6f  he axis lies alo
-00011830: 6e67 2074 6865 2073 6c69 6365 0a20 2020  ng the slice.   
-00011840: 2020 2020 2069 5f61 7820 3d20 736b 7274       i_ax = skrt
-00011850: 2e69 6d61 6765 2e5f 6178 6573 2e69 6e64  .image._axes.ind
-00011860: 6578 2861 7829 2069 6620 6973 696e 7374  ex(ax) if isinst
-00011870: 616e 6365 2861 782c 2073 7472 2920 656c  ance(ax, str) el
-00011880: 7365 2061 780a 2020 2020 2020 2020 6966  se ax.        if
-00011890: 2073 696e 676c 655f 736c 6963 653a 0a20   single_slice:. 
-000118a0: 2020 2020 2020 2020 2020 2069 6620 695f             if i_
-000118b0: 6178 206e 6f74 2069 6e20 736b 7274 2e69  ax not in skrt.i
-000118c0: 6d61 6765 2e5f 706c 6f74 5f61 7865 735b  mage._plot_axes[
-000118d0: 7669 6577 5d3a 0a20 2020 2020 2020 2020  view]:.         
-000118e0: 2020 2020 2020 2072 6169 7365 2052 756e         raise Run
-000118f0: 7469 6d65 4572 726f 7228 0a20 2020 2020  timeError(.     
-00011900: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00011910: 2243 616e 6e6f 7420 636f 6d70 7574 6520  "Cannot compute 
-00011920: 6578 7465 6e74 206f 6620 6178 6973 207b  extent of axis {
-00011930: 6178 7d20 696e 2074 6865 207b 7669 6577  ax} in the {view
-00011940: 7d20 706c 616e 6521 2229 0a20 2020 2020  } plane!").     
-00011950: 2020 2020 2020 2069 5f61 7820 3d20 736b         i_ax = sk
-00011960: 7274 2e69 6d61 6765 2e5f 706c 6f74 5f61  rt.image._plot_a
-00011970: 7865 735b 7669 6577 5d2e 696e 6465 7828  xes[view].index(
-00011980: 695f 6178 290a 0a20 2020 2020 2020 2023  i_ax)..        #
-00011990: 2045 6e73 7572 6520 7468 6174 206f 7269   Ensure that ori
-000119a0: 6769 6e20 6973 2061 2073 696e 676c 6520  gin is a single 
-000119b0: 6e75 6d65 7269 6320 7661 6c75 652e 0a20  numeric value.. 
-000119c0: 2020 2020 2020 206f 7269 6769 6e20 3d20         origin = 
-000119d0: 6f72 6967 696e 206f 7220 300a 2020 2020  origin or 0.    
-000119e0: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
-000119f0: 7461 6e63 6528 6f72 6967 696e 2c20 2866  tance(origin, (f
-00011a00: 6c6f 6174 2c20 696e 7429 293a 0a20 2020  loat, int)):.   
-00011a10: 2020 2020 2020 2020 206f 7269 6769 6e20           origin 
-00011a20: 3d20 6f72 6967 696e 5b69 5f61 785d 0a0a  = origin[i_ax]..
-00011a30: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
-00011a40: 6174 6520 6578 7465 6e74 2066 726f 6d20  ate extent from 
-00011a50: 636f 6e74 6f75 7273 0a20 2020 2020 2020  contours.       
-00011a60: 2069 6620 6d65 7468 6f64 203d 3d20 2263   if method == "c
-00011a70: 6f6e 746f 7572 223a 0a0a 2020 2020 2020  ontour":..      
-00011a80: 2020 2020 2020 2320 4361 6c63 756c 6174        # Calculat
-00011a90: 6520 6675 6c6c 207a 2065 7874 656e 7420  e full z extent 
-00011aa0: 6672 6f6d 2063 6f6e 746f 7572 2070 6f73  from contour pos
-00011ab0: 6974 696f 6e73 0a20 2020 2020 2020 2020  itions.         
-00011ac0: 2020 2069 6620 2861 7820 3d3d 2022 7a22     if (ax == "z"
-00011ad0: 206f 7220 6178 203d 3d20 3229 2061 6e64   or ax == 2) and
-00011ae0: 206e 6f74 2073 696e 676c 655f 736c 6963   not single_slic
-00011af0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00011b00: 2020 207a 5f6b 6579 7320 3d20 6c69 7374     z_keys = list
-00011b10: 2873 656c 662e 6765 745f 636f 6e74 6f75  (self.get_contou
-00011b20: 7273 2822 782d 7922 292e 6b65 7973 2829  rs("x-y").keys()
-00011b30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00011b40: 2020 767a 203d 2073 656c 662e 6765 745f    vz = self.get_
-00011b50: 736c 6963 655f 7468 6963 6b6e 6573 735f  slice_thickness_
-00011b60: 636f 6e74 6f75 7273 2829 0a20 2020 2020  contours().     
-00011b70: 2020 2020 2020 2020 2020 2069 6620 7a5f             if z_
-00011b80: 6b65 7973 3a0a 2020 2020 2020 2020 2020  keys:.          
-00011b90: 2020 2020 2020 2020 2020 7a5f 6d61 7820            z_max 
-00011ba0: 3d20 6d61 7828 7a5f 6b65 7973 2920 2b20  = max(z_keys) + 
-00011bb0: 2076 7a20 2f20 320a 2020 2020 2020 2020   vz / 2.        
-00011bc0: 2020 2020 2020 2020 2020 2020 7a5f 6d69              z_mi
-00011bd0: 6e20 3d20 6d69 6e28 7a5f 6b65 7973 2920  n = min(z_keys) 
-00011be0: 2d20 767a 202f 2032 0a20 2020 2020 2020  - vz / 2.       
-00011bf0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000d380: 2020 2020 2022 206e 756d 6265 7273 2066       " numbers f
+0000d390: 726f 6d20 636f 6e74 6f75 7273 2077 6974  rom contours wit
+0000d3a0: 686f 7574 206b 6e6f 7769 6e67 2076 6f78  hout knowing vox
+0000d3b0: 656c 220a 2020 2020 2020 2020 2020 2020  el".            
+0000d3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3d0: 2020 2020 2020 2020 2020 2022 2073 697a             " siz
+0000d3e0: 6573 2061 6e64 206d 6173 6b20 7368 6170  es and mask shap
+0000d3f0: 6521 2229 0a20 2020 2020 2020 2020 2020  e!").           
+0000d400: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000d410: 2020 2020 2020 2076 6965 775f 6178 6573         view_axes
+0000d420: 203d 2028 5b30 2c20 312c 2032 5d20 6966   = ([0, 1, 2] if
+0000d430: 206c 656e 2863 656e 7472 6f69 645b 276d   len(centroid['m
+0000d440: 6d27 5d29 203d 3d20 3320 656c 7365 0a20  m']) == 3 else. 
+0000d450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d460: 2020 2020 2020 2073 6b72 742e 696d 6167         skrt.imag
+0000d470: 652e 5f70 6c6f 745f 6178 6573 5b76 6965  e._plot_axes[vie
+0000d480: 775d 290a 0a20 2020 2020 2020 2020 2020  w])..           
+0000d490: 2020 2020 2063 656e 7472 6f69 645b 2276       centroid["v
+0000d4a0: 6f78 656c 7322 5d20 3d20 6e70 2e61 7272  oxels"] = np.arr
+0000d4b0: 6179 285b 0a20 2020 2020 2020 2020 2020  ay([.           
+0000d4c0: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
+0000d4d0: 735f 746f 5f69 6478 2863 2c20 6178 3d69  s_to_idx(c, ax=i
+0000d4e0: 2c20 7265 7475 726e 5f69 6e74 3d46 616c  , return_int=Fal
+0000d4f0: 7365 2920 0a20 2020 2020 2020 2020 2020  se) .           
+0000d500: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
+0000d510: 6320 696e 207a 6970 2876 6965 775f 6178  c in zip(view_ax
+0000d520: 6573 2c20 6365 6e74 726f 6964 5b22 6d6d  es, centroid["mm
+0000d530: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
+0000d540: 2020 2020 5d29 0a0a 2020 2020 2020 2020      ])..        
+0000d550: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+0000d560: 5b22 736c 6963 6522 5d20 3d20 6e70 2e61  ["slice"] = np.a
+0000d570: 7272 6179 285b 0a20 2020 2020 2020 2020  rray([.         
+0000d580: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000d590: 706f 735f 746f 5f73 6c69 6365 2863 2c20  pos_to_slice(c, 
+0000d5a0: 6178 3d69 2c20 7265 7475 726e 5f69 6e74  ax=i, return_int
+0000d5b0: 3d46 616c 7365 2920 0a20 2020 2020 2020  =False) .       
+0000d5c0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0000d5d0: 2069 2c20 6320 696e 207a 6970 2876 6965   i, c in zip(vie
+0000d5e0: 775f 6178 6573 2c20 6365 6e74 726f 6964  w_axes, centroid
+0000d5f0: 5b22 6d6d 225d 290a 2020 2020 2020 2020  ["mm"]).        
+0000d600: 2020 2020 2020 2020 5d29 0a0a 2020 2020          ])..    
+0000d610: 2020 2020 2320 4f74 6865 7277 6973 652c      # Otherwise,
+0000d620: 2063 616c 6375 6c61 7465 2063 656e 7472   calculate centr
+0000d630: 6f69 6420 6672 6f6d 2062 696e 6172 7920  oid from binary 
+0000d640: 6d61 736b 0a20 2020 2020 2020 2065 6c73  mask.        els
+0000d650: 653a 200a 0a20 2020 2020 2020 2020 2020  e: ..           
+0000d660: 2023 2047 6574 2032 4420 6f72 2033 4420   # Get 2D or 3D 
+0000d670: 6461 7461 2066 726f 6d20 7768 6963 6820  data from which 
+0000d680: 746f 2063 616c 6375 6c61 7465 2063 656e  to calculate cen
+0000d690: 7472 6f69 640a 2020 2020 2020 2020 2020  troid.          
+0000d6a0: 2020 6966 2073 696e 676c 655f 736c 6963    if single_slic
+0000d6b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000d6c0: 2020 2069 6620 6e6f 7420 7365 6c66 2e6f     if not self.o
+0000d6d0: 6e5f 736c 6963 6528 7669 6577 2c20 736c  n_slice(view, sl
+0000d6e0: 3d73 6c2c 2069 6478 3d69 6478 2c20 706f  =sl, idx=idx, po
+0000d6f0: 733d 706f 7329 3a0a 2020 2020 2020 2020  s=pos):.        
+0000d700: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000d710: 726e 206e 702e 6172 7261 7928 5b4e 6f6e  rn np.array([Non
+0000d720: 652c 204e 6f6e 655d 290a 2020 2020 2020  e, None]).      
+0000d730: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+0000d740: 2073 656c 662e 6765 745f 736c 6963 6528   self.get_slice(
+0000d750: 7669 6577 2c20 736c 3d73 6c2c 2069 6478  view, sl=sl, idx
+0000d760: 3d69 6478 2c20 706f 733d 706f 7329 0a20  =idx, pos=pos). 
+0000d770: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000d780: 7865 7320 3d20 736b 7274 2e69 6d61 6765  xes = skrt.image
+0000d790: 2e5f 706c 6f74 5f61 7865 735b 7669 6577  ._plot_axes[view
+0000d7a0: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
+0000d7b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000d7c0: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
+0000d7d0: 6d61 736b 2829 0a20 2020 2020 2020 2020  mask().         
+0000d7e0: 2020 2020 2020 2064 6174 6120 3d20 7365         data = se
+0000d7f0: 6c66 2e67 6574 5f6d 6173 6b28 7374 616e  lf.get_mask(stan
+0000d800: 6461 7264 6973 653d 5472 7565 290a 2020  dardise=True).  
+0000d810: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+0000d820: 6573 203d 2073 6b72 742e 696d 6167 652e  es = skrt.image.
+0000d830: 5f61 7865 730a 0a20 2020 2020 2020 2020  _axes..         
+0000d840: 2020 2023 2043 6f6d 7075 7465 2063 656e     # Compute cen
+0000d850: 7472 6f69 6420 6672 6f6d 2032 4420 6f72  troid from 2D or
+0000d860: 2033 4420 6269 6e61 7279 206d 6173 6b0a   3D binary mask.
+0000d870: 2020 2020 2020 2020 2020 2020 6e6f 6e5f              non_
+0000d880: 7a65 726f 203d 206e 702e 6172 6777 6865  zero = np.argwhe
+0000d890: 7265 2864 6174 6129 0a20 2020 2020 2020  re(data).       
+0000d8a0: 2020 2020 2069 6620 6e6f 7420 6c65 6e28       if not len(
+0000d8b0: 6e6f 6e5f 7a65 726f 293a 0a20 2020 2020  non_zero):.     
+0000d8c0: 2020 2020 2020 2020 2020 2069 6620 6461             if da
+0000d8d0: 7461 2e6e 6469 6d20 3d3d 2032 3a0a 2020  ta.ndim == 2:.  
+0000d8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8f0: 2020 7265 7475 726e 204e 6f6e 652c 204e    return None, N
+0000d900: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0000d910: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000d920: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000d930: 7475 726e 204e 6f6e 652c 204e 6f6e 652c  turn None, None,
+0000d940: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+0000d950: 2020 6365 6e74 726f 6964 5f72 6f77 636f    centroid_rowco
+0000d960: 6c20 3d20 6c69 7374 286e 6f6e 5f7a 6572  l = list(non_zer
+0000d970: 6f2e 6d65 616e 2830 2929 0a20 2020 2020  o.mean(0)).     
+0000d980: 2020 2020 2020 2063 656e 7472 6f69 645f         centroid_
+0000d990: 766f 7865 6c73 203d 205b 6365 6e74 726f  voxels = [centro
+0000d9a0: 6964 5f72 6f77 636f 6c5b 315d 2c20 6365  id_rowcol[1], ce
+0000d9b0: 6e74 726f 6964 5f72 6f77 636f 6c5b 305d  ntroid_rowcol[0]
+0000d9c0: 5d20 5c0a 2020 2020 2020 2020 2020 2020  ] \.            
+0000d9d0: 2020 2020 2020 2020 2b20 6365 6e74 726f          + centro
+0000d9e0: 6964 5f72 6f77 636f 6c5b 323a 5d0a 2020  id_rowcol[2:].  
+0000d9f0: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
+0000da00: 6964 5b22 766f 7865 6c73 225d 203d 206e  id["voxels"] = n
+0000da10: 702e 6172 7261 7928 6365 6e74 726f 6964  p.array(centroid
+0000da20: 5f76 6f78 656c 7329 0a0a 2020 2020 2020  _voxels)..      
+0000da30: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
+0000da40: 746f 206d 6d20 616e 6420 736c 6963 6573  to mm and slices
+0000da50: 0a20 2020 2020 2020 2020 2020 2076 6965  .            vie
+0000da60: 775f 6178 6573 203d 2028 5b30 2c20 312c  w_axes = ([0, 1,
+0000da70: 2032 5d20 6966 206c 656e 2863 656e 7472   2] if len(centr
+0000da80: 6f69 645b 2776 6f78 656c 7327 5d29 203d  oid['voxels']) =
+0000da90: 3d20 3320 656c 7365 0a20 2020 2020 2020  = 3 else.       
+0000daa0: 2020 2020 2020 2020 2020 2020 2073 6b72               skr
+0000dab0: 742e 696d 6167 652e 5f70 6c6f 745f 6178  t.image._plot_ax
+0000dac0: 6573 5b76 6965 775d 290a 0a20 2020 2020  es[view])..     
+0000dad0: 2020 2020 2020 2063 656e 7472 6f69 645b         centroid[
+0000dae0: 226d 6d22 5d20 3d20 6e70 2e61 7272 6179  "mm"] = np.array
+0000daf0: 285b 0a20 2020 2020 2020 2020 2020 2020  ([.             
+0000db00: 2020 2073 656c 662e 6964 785f 746f 5f70     self.idx_to_p
+0000db10: 6f73 2863 2c20 6178 3d69 290a 2020 2020  os(c, ax=i).    
+0000db20: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000db30: 692c 2063 2069 6e20 7a69 7028 7669 6577  i, c in zip(view
+0000db40: 5f61 7865 732c 2063 656e 7472 6f69 645b  _axes, centroid[
+0000db50: 2276 6f78 656c 7322 5d29 0a20 2020 2020  "voxels"]).     
+0000db60: 2020 2020 2020 205d 290a 0a20 2020 2020         ])..     
+0000db70: 2020 2020 2020 2063 656e 7472 6f69 645b         centroid[
+0000db80: 2273 6c69 6365 225d 203d 206e 702e 6172  "slice"] = np.ar
+0000db90: 7261 7928 5b0a 2020 2020 2020 2020 2020  ray([.          
+0000dba0: 2020 2020 2020 7365 6c66 2e69 6478 5f74        self.idx_t
+0000dbb0: 6f5f 736c 6963 6528 632c 2061 783d 6929  o_slice(c, ax=i)
+0000dbc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dbd0: 2066 6f72 2069 2c20 6320 696e 207a 6970   for i, c in zip
+0000dbe0: 2876 6965 775f 6178 6573 2c20 6365 6e74  (view_axes, cent
+0000dbf0: 726f 6964 5b22 766f 7865 6c73 225d 290a  roid["voxels"]).
+0000dc00: 2020 2020 2020 2020 2020 2020 5d29 0a0a              ])..
+0000dc10: 2020 2020 2020 2020 2320 4361 6368 6520          # Cache 
+0000dc20: 676c 6f62 616c 2063 656e 7472 6f69 640a  global centroid.
+0000dc30: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0000dc40: 696e 676c 655f 736c 6963 653a 0a20 2020  ingle_slice:.   
+0000dc50: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+0000dc60: 656e 7472 6f69 6420 3d20 6365 6e74 726f  entroid = centro
+0000dc70: 6964 0a0a 2020 2020 2020 2020 2320 5265  id..        # Re
+0000dc80: 7475 726e 2063 656e 7472 6f69 6420 696e  turn centroid in
+0000dc90: 2072 6571 7565 7374 6564 2075 6e69 7473   requested units
+0000dca0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000dcb0: 6365 6e74 726f 6964 5b75 6e69 7473 5d0a  centroid[units].
+0000dcc0: 0a20 2020 2064 6566 2073 6574 5f73 6c69  .    def set_sli
+0000dcd0: 6365 5f74 6869 636b 6e65 7373 5f63 6f6e  ce_thickness_con
+0000dce0: 746f 7572 7328 7365 6c66 2c20 647a 293a  tours(self, dz):
+0000dcf0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000dd00: 2020 2020 2053 6574 206e 6f6d 696e 616c       Set nominal
+0000dd10: 207a 2073 7061 6369 6e67 206f 6620 636f   z spacing of co
+0000dd20: 6e74 6f75 7273 2e0a 0a20 2020 2020 2020  ntours...       
+0000dd30: 2054 6869 7320 6d61 7920 6265 2075 7365   This may be use
+0000dd40: 6675 6c20 696e 2070 6172 7469 6375 6c61  ful in particula
+0000dd50: 7220 666f 7220 2073 696e 676c 652d 736c  r for  single-sl
+0000dd60: 6963 6520 524f 4973 2e0a 2020 2020 2020  ice ROIs..      
+0000dd70: 2020 2222 220a 0a20 2020 2020 2020 2073    """..        s
+0000dd80: 656c 662e 736c 6963 655f 7468 6963 6b6e  elf.slice_thickn
+0000dd90: 6573 735f 636f 6e74 6f75 7273 203d 2064  ess_contours = d
+0000dda0: 7a0a 0a20 2020 2064 6566 2067 6574 5f73  z..    def get_s
+0000ddb0: 6c69 6365 5f74 6869 636b 6e65 7373 5f63  lice_thickness_c
+0000ddc0: 6f6e 746f 7572 7328 7365 6c66 293a 0a20  ontours(self):. 
+0000ddd0: 2020 2020 2020 2022 2222 4765 7420 7a20         """Get z 
+0000dde0: 766f 7865 6c20 7369 7a65 2075 7369 6e67  voxel size using
+0000ddf0: 2070 6f73 6974 696f 6e73 206f 6620 636f   positions of co
+0000de00: 6e74 6f75 7273 2e22 2222 0a0a 2020 2020  ntours."""..    
+0000de10: 2020 2020 636f 6e74 6f75 7273 203d 2073      contours = s
+0000de20: 656c 662e 6765 745f 636f 6e74 6f75 7273  elf.get_contours
+0000de30: 2822 782d 7922 290a 2020 2020 2020 2020  ("x-y").        
+0000de40: 7a5f 6b65 7973 203d 2073 6f72 7465 6428  z_keys = sorted(
+0000de50: 636f 6e74 6f75 7273 2e6b 6579 7328 2929  contours.keys())
+0000de60: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+0000de70: 7a5f 6b65 7973 2920 3c20 323a 0a20 2020  z_keys) < 2:.   
+0000de80: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000de90: 2e73 6f75 7263 655f 7479 7065 203d 3d20  .source_type == 
+0000dea0: 2263 6f6e 746f 7572 2220 616e 6420 7365  "contour" and se
+0000deb0: 6c66 2e73 6c69 6365 5f74 6869 636b 6e65  lf.slice_thickne
+0000dec0: 7373 5f63 6f6e 746f 7572 733a 0a20 2020  ss_contours:.   
+0000ded0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000dee0: 7572 6e20 7365 6c66 2e73 6c69 6365 5f74  urn self.slice_t
+0000def0: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
+0000df00: 730a 2020 2020 2020 2020 2020 2020 656c  s.            el
+0000df10: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000df20: 2020 2020 766f 7865 6c5f 7369 7a65 203d      voxel_size =
+0000df30: 2073 656c 662e 6765 745f 766f 7865 6c5f   self.get_voxel_
+0000df40: 7369 7a65 2829 0a20 2020 2020 2020 2020  size().         
+0000df50: 2020 2020 2020 2069 6620 766f 7865 6c5f         if voxel_
+0000df60: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
+0000df70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000df80: 2020 2020 2020 7265 7475 726e 2076 6f78        return vox
+0000df90: 656c 5f73 697a 655b 325d 0a20 2020 2020  el_size[2].     
+0000dfa0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000dfb0: 6e0a 2020 2020 2020 2020 6469 6666 7320  n.        diffs 
+0000dfc0: 3d20 5b7a 5f6b 6579 735b 695d 202d 207a  = [z_keys[i] - z
+0000dfd0: 5f6b 6579 735b 6920 2d20 315d 2066 6f72  _keys[i - 1] for
+0000dfe0: 2069 2069 6e20 7261 6e67 6528 312c 206c   i in range(1, l
+0000dff0: 656e 287a 5f6b 6579 7329 295d 0a20 2020  en(z_keys))].   
+0000e000: 2020 2020 2072 6574 7572 6e20 6d69 6e28       return min(
+0000e010: 6469 6666 7329 0a0a 2020 2020 6465 6620  diffs)..    def 
+0000e020: 6765 745f 6e7a 5f63 6f6e 746f 7572 7328  get_nz_contours(
+0000e030: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+0000e040: 2222 4765 7420 6e75 6d62 6572 206f 6620  ""Get number of 
+0000e050: 766f 7865 6c73 2069 6e20 7468 6520 7a20  voxels in the z 
+0000e060: 6469 7265 6374 696f 6e20 7573 696e 6720  direction using 
+0000e070: 706f 7369 7469 6f6e 7320 6f66 2063 6f6e  positions of con
+0000e080: 746f 7572 732e 2222 220a 0a20 2020 2020  tours."""..     
+0000e090: 2020 2076 7a20 3d20 7365 6c66 2e67 6574     vz = self.get
+0000e0a0: 5f73 6c69 6365 5f74 6869 636b 6e65 7373  _slice_thickness
+0000e0b0: 5f63 6f6e 746f 7572 7328 290a 2020 2020  _contours().    
+0000e0c0: 2020 2020 7a5f 6b65 7973 203d 206c 6973      z_keys = lis
+0000e0d0: 7428 7365 6c66 2e67 6574 5f63 6f6e 746f  t(self.get_conto
+0000e0e0: 7572 7328 2278 2d79 2229 2e6b 6579 7328  urs("x-y").keys(
+0000e0f0: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
+0000e100: 6e20 696e 7428 286d 6178 287a 5f6b 6579  n int((max(z_key
+0000e110: 7329 202d 206d 696e 287a 5f6b 6579 7329  s) - min(z_keys)
+0000e120: 2920 2f20 767a 2920 2b20 310a 0a20 2020  ) / vz) + 1..   
+0000e130: 2064 6566 2067 6574 5f63 656e 7472 6528   def get_centre(
+0000e140: 0a20 2020 2020 2020 2073 656c 662c 200a  .        self, .
+0000e150: 2020 2020 2020 2020 7669 6577 3d22 782d          view="x-
+0000e160: 7922 2c20 0a20 2020 2020 2020 2073 696e  y", .        sin
+0000e170: 676c 655f 736c 6963 653d 4661 6c73 652c  gle_slice=False,
+0000e180: 0a20 2020 2020 2020 2073 6c3d 4e6f 6e65  .        sl=None
+0000e190: 2c20 0a20 2020 2020 2020 2069 6478 3d4e  , .        idx=N
+0000e1a0: 6f6e 652c 200a 2020 2020 2020 2020 706f  one, .        po
+0000e1b0: 733d 4e6f 6e65 2c20 0a20 2020 2020 2020  s=None, .       
+0000e1c0: 206d 6574 686f 643d 4e6f 6e65 2c0a 2020   method=None,.  
+0000e1d0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+0000e1e0: 4765 7420 6365 6e74 7265 2070 6f73 6974  Get centre posit
+0000e1f0: 696f 6e20 696e 2032 4420 6f72 2033 4420  ion in 2D or 3D 
+0000e200: 696e 206d 6d2e 2222 220a 0a20 2020 2020  in mm."""..     
+0000e210: 2020 2023 2047 6574 2064 6566 6175 6c74     # Get default
+0000e220: 2073 6c69 6365 2069 6e64 6578 2061 6e64   slice index and
+0000e230: 206d 6574 686f 640a 2020 2020 2020 2020   method.        
+0000e240: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
+0000e250: 2020 2020 6966 2073 6c20 6973 204e 6f6e      if sl is Non
+0000e260: 6520 616e 6420 6964 7820 6973 204e 6f6e  e and idx is Non
+0000e270: 6520 616e 6420 706f 7320 6973 204e 6f6e  e and pos is Non
+0000e280: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
+0000e290: 6964 7820 3d20 7365 6c66 2e67 6574 5f6d  idx = self.get_m
+0000e2a0: 6964 5f69 6478 2876 6965 7729 0a20 2020  id_idx(view).   
+0000e2b0: 2020 2020 2069 6620 6d65 7468 6f64 2069       if method i
+0000e2c0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0000e2d0: 2020 2020 6d65 7468 6f64 203d 2073 656c      method = sel
+0000e2e0: 662e 6465 6661 756c 745f 6765 6f6d 5f6d  f.default_geom_m
+0000e2f0: 6574 686f 640a 0a20 2020 2020 2020 2023  ethod..        #
+0000e300: 2047 6574 206c 6973 7420 6f66 2061 7865   Get list of axe
+0000e310: 7320 746f 2063 6f6e 7369 6465 720a 2020  s to consider.  
+0000e320: 2020 2020 2020 6966 2073 696e 676c 655f        if single_
+0000e330: 736c 6963 653a 0a20 2020 2020 2020 2020  slice:.         
+0000e340: 2020 2061 7865 7320 3d20 736b 7274 2e69     axes = skrt.i
+0000e350: 6d61 6765 2e5f 706c 6f74 5f61 7865 735b  mage._plot_axes[
+0000e360: 7669 6577 5d0a 2020 2020 2020 2020 656c  view].        el
+0000e370: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000e380: 6178 6573 203d 2073 6b72 742e 696d 6167  axes = skrt.imag
+0000e390: 652e 5f61 7865 730a 0a20 2020 2020 2020  e._axes..       
+0000e3a0: 2023 2047 6574 2063 656e 7472 6520 696e   # Get centre in
+0000e3b0: 206d 6d0a 2020 2020 2020 2020 6365 6e74   mm.        cent
+0000e3c0: 7265 203d 205b 5d0a 2020 2020 2020 2020  re = [].        
+0000e3d0: 666f 7220 6178 2069 6e20 6178 6573 3a0a  for ax in axes:.
+0000e3e0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
+0000e3f0: 6e74 203d 2073 656c 662e 6765 745f 6578  nt = self.get_ex
+0000e400: 7465 6e74 280a 2020 2020 2020 2020 2020  tent(.          
+0000e410: 2020 2020 2020 6178 3d61 782c 0a20 2020        ax=ax,.   
+0000e420: 2020 2020 2020 2020 2020 2020 2073 696e               sin
+0000e430: 676c 655f 736c 6963 653d 7369 6e67 6c65  gle_slice=single
+0000e440: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
+0000e450: 2020 2020 2020 2020 7669 6577 3d76 6965          view=vie
+0000e460: 772c 0a20 2020 2020 2020 2020 2020 2020  w,.             
+0000e470: 2020 2073 6c3d 736c 2c0a 2020 2020 2020     sl=sl,.      
+0000e480: 2020 2020 2020 2020 2020 6964 783d 6964            idx=id
+0000e490: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
+0000e4a0: 2020 2070 6f73 3d70 6f73 2c0a 2020 2020     pos=pos,.    
+0000e4b0: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+0000e4c0: 6f64 3d6d 6574 686f 642c 0a20 2020 2020  od=method,.     
+0000e4d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000e4e0: 2020 2020 2069 6620 4e6f 6e65 2069 6e20       if None in 
+0000e4f0: 6578 7465 6e74 3a0a 2020 2020 2020 2020  extent:.        
+0000e500: 2020 2020 2020 2020 6365 6e74 7265 2e61          centre.a
+0000e510: 7070 656e 6428 4e6f 6e65 290a 2020 2020  ppend(None).    
+0000e520: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000e530: 2020 2020 2020 2020 2020 2020 2020 6365                ce
+0000e540: 6e74 7265 2e61 7070 656e 6428 6e70 2e6d  ntre.append(np.m
+0000e550: 6561 6e28 6578 7465 6e74 2929 0a0a 2020  ean(extent))..  
+0000e560: 2020 2020 2020 7265 7475 726e 206e 702e        return np.
+0000e570: 6172 7261 7928 6365 6e74 7265 290a 0a20  array(centre).. 
+0000e580: 2020 2064 6566 2067 6574 5f76 6f6c 756d     def get_volum
+0000e590: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
+0000e5a0: 200a 2020 2020 2020 2020 756e 6974 733d   .        units=
+0000e5b0: 226d 6d22 2c20 0a20 2020 2020 2020 206d  "mm", .        m
+0000e5c0: 6574 686f 643d 4e6f 6e65 2c20 0a20 2020  ethod=None, .   
+0000e5d0: 2020 2020 2066 6f72 6365 3d54 7275 650a       force=True.
+0000e5e0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+0000e5f0: 2222 4765 7420 524f 4920 766f 6c75 6d65  ""Get ROI volume
+0000e600: 2e20 5468 6520 6361 6c63 756c 6174 6564  . The calculated
+0000e610: 2076 6f6c 756d 6520 7769 6c6c 2062 6520   volume will be 
+0000e620: 6361 6368 6564 2069 6e20 0a20 2020 2020  cached in .     
+0000e630: 2020 2073 656c 662e 5f76 6f6c 756d 655b     self._volume[
+0000e640: 756e 6974 735d 2061 6e64 2072 6574 7572  units] and retur
+0000e650: 6e65 6420 6966 2063 616c 6c65 6420 6167  ned if called ag
+0000e660: 6169 6e2c 2075 6e6c 6573 7320 666f 7263  ain, unless forc
+0000e670: 653d 5472 7565 2e0a 0a20 2020 2020 2020  e=True...       
+0000e680: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+0000e690: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0000e6a0: 2020 756e 6974 7320 3a20 7374 722c 2064    units : str, d
+0000e6b0: 6566 6175 6c74 3d22 6d6d 220a 2020 2020  efault="mm".    
+0000e6c0: 2020 2020 2020 2020 556e 6974 7320 6f66          Units of
+0000e6d0: 2076 6f6c 756d 652e 2043 616e 2062 6520   volume. Can be 
+0000e6e0: 616e 7920 6f66 3a0a 2020 2020 2020 2020  any of:.        
+0000e6f0: 2020 2020 2020 2020 2d20 226d 6d22 3a20          - "mm": 
+0000e700: 7265 7475 726e 2076 6f6c 756d 6520 696e  return volume in
+0000e710: 206d 696c 6c69 6d65 7472 6573 2063 7562   millimetres cub
+0000e720: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
+0000e730: 2020 2020 2d20 226d 6c22 3a20 7265 7475      - "ml": retu
+0000e740: 726e 2076 6f6c 756d 6520 696e 206d 696c  rn volume in mil
+0000e750: 6c69 6c69 7472 6573 2e0a 2020 2020 2020  lilitres..      
+0000e760: 2020 2020 2020 2020 2020 2d20 2263 6322            - "cc"
+0000e770: 3a20 7265 7475 726e 2076 6f6c 756d 6520  : return volume 
+0000e780: 696e 2063 7562 6963 2063 656e 7469 6d65  in cubic centime
+0000e790: 7472 6573 2028 6571 7569 7661 6c65 6e74  tres (equivalent
+0000e7a0: 2074 6f20 226d 6c22 290a 2020 2020 2020   to "ml").      
+0000e7b0: 2020 2020 2020 2020 2020 2d20 2276 6f78            - "vox
+0000e7c0: 656c 7322 3a20 7265 7475 726e 2076 6f6c  els": return vol
+0000e7d0: 756d 6520 696e 206e 756d 6265 7220 6f66  ume in number of
+0000e7e0: 2076 6f78 656c 732e 0a0a 2020 2020 2020   voxels...      
+0000e7f0: 2020 2020 2020 4966 2075 6e69 7473 3d22        If units="
+0000e800: 766f 7865 6c73 2220 6973 2072 6571 7565  voxels" is reque
+0000e810: 7374 6564 2062 7574 2074 6869 7320 524f  sted but this RO
+0000e820: 4920 6f6e 6c79 2068 6173 2063 6f6e 746f  I only has conto
+0000e830: 7572 7320 616e 6420 6e6f 0a20 2020 2020  urs and no.     
+0000e840: 2020 2020 2020 2076 6f78 656c 2073 697a         voxel siz
+0000e850: 6520 696e 666f 726d 6174 696f 6e2c 2061  e information, a
+0000e860: 6e20 6572 726f 7220 7769 6c6c 2062 6520  n error will be 
+0000e870: 7261 6973 6564 2e0a 0a20 2020 2020 2020  raised...       
+0000e880: 206d 6574 686f 6420 3a20 7374 722c 2064   method : str, d
+0000e890: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0000e8a0: 2020 2020 2020 2020 4d65 7468 6f64 2074          Method t
+0000e8b0: 6f20 7573 6520 666f 7220 766f 6c75 6d65  o use for volume
+0000e8c0: 2063 616c 6375 6c61 7469 6f6e 2e20 4361   calculation. Ca
+0000e8d0: 6e20 6265 3a20 0a20 2020 2020 2020 2020  n be: .         
+0000e8e0: 2020 2020 2020 202d 2022 636f 6e74 6f75         - "contou
+0000e8f0: 7222 3a20 636f 6d70 7574 6520 766f 6c75  r": compute volu
+0000e900: 6d65 2062 7920 7375 6d6d 696e 6720 6172  me by summing ar
+0000e910: 6561 7320 6f66 2073 6861 7065 6c79 0a20  eas of shapely. 
+0000e920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e930: 2070 6f6c 7967 6f6e 7320 6f6e 2065 6163   polygons on eac
+0000e940: 6820 736c 6963 6520 616e 6420 6d75 6c74  h slice and mult
+0000e950: 6970 6c79 696e 6720 6279 2073 6c69 6365  iplying by slice
+0000e960: 2074 6869 636b 6e65 7373 2e0a 2020 2020   thickness..    
+0000e970: 2020 2020 2020 2020 2020 2020 2d20 226d              - "m
+0000e980: 6173 6b22 3a20 636f 6d70 7574 6520 766f  ask": compute vo
+0000e990: 6c75 6d65 2062 7920 7375 6d6d 696e 6720  lume by summing 
+0000e9a0: 766f 7865 6c73 2069 6e73 6964 6520 7468  voxels inside th
+0000e9b0: 6520 524f 4920 616e 640a 2020 2020 2020  e ROI and.      
+0000e9c0: 2020 2020 2020 2020 2020 2020 6d75 6c74              mult
+0000e9d0: 6970 6c79 696e 6720 6279 2074 6865 2076  iplying by the v
+0000e9e0: 6f6c 756d 6520 6f66 206f 6e65 2076 6f78  olume of one vox
+0000e9f0: 656c 2e0a 2020 2020 2020 2020 2020 2020  el..            
+0000ea00: 2020 2020 2d20 4e6f 6e65 3a20 7573 6520      - None: use 
+0000ea10: 7468 6520 6d65 7468 6f64 2073 6574 2069  the method set i
+0000ea20: 6e20 7365 6c66 2e64 6566 6175 6c74 5f67  n self.default_g
+0000ea30: 656f 6d5f 6d65 7468 6f64 2e0a 0a20 2020  eom_method...   
+0000ea40: 2020 2020 2020 2020 204e 6f74 6520 7468           Note th
+0000ea50: 6174 2069 6620 7365 6c66 2e67 6574 5f76  at if self.get_v
+0000ea60: 6f6c 756d 6520 6861 7320 616c 7265 6164  olume has alread
+0000ea70: 7920 6265 656e 2063 616c 6c65 6420 7769  y been called wi
+0000ea80: 7468 206f 6e65 200a 2020 2020 2020 2020  th one .        
+0000ea90: 2020 2020 6d65 7468 6f64 2c20 7468 6520      method, the 
+0000eaa0: 7361 6d65 2063 6163 6865 6420 7265 7375  same cached resu
+0000eab0: 6c74 2077 696c 6c20 6265 2072 6574 7572  lt will be retur
+0000eac0: 6e65 6420 6966 2063 616c 6c69 6e67 2077  ned if calling w
+0000ead0: 6974 6820 6120 0a20 2020 2020 2020 2020  ith a .         
+0000eae0: 2020 2064 6966 6665 7265 6e74 206d 6574     different met
+0000eaf0: 686f 6420 756e 6c65 7373 2066 6f72 6365  hod unless force
+0000eb00: 3d54 7275 652e 0a0a 2020 2020 2020 2020  =True...        
+0000eb10: 666f 7263 6520 3a20 626f 6f6c 2c20 6465  force : bool, de
+0000eb20: 6661 756c 743d 5472 7565 0a20 2020 2020  fault=True.     
+0000eb30: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+0000eb40: 7468 6520 766f 6c75 6d65 2077 696c 6c20  the volume will 
+0000eb50: 616c 7761 7973 2062 6520 7265 6361 6c63  always be recalc
+0000eb60: 756c 6174 6564 3b20 6f74 6865 7277 6973  ulated; otherwis
+0000eb70: 652c 2069 7420 7769 6c6c 0a20 2020 2020  e, it will.     
+0000eb80: 2020 2020 2020 206f 6e6c 7920 6265 2063         only be c
+0000eb90: 616c 6375 6c61 7465 6420 6966 2069 7420  alculated if it 
+0000eba0: 6861 7320 6e6f 7420 7965 7420 6265 656e  has not yet been
+0000ebb0: 2063 6163 6865 6420 696e 2073 656c 662e   cached in self.
+0000ebc0: 5f76 6f6c 756d 652e 0a20 2020 2020 2020  _volume..       
+0000ebd0: 2022 2222 0a0a 2020 2020 2020 2020 2320   """..        # 
+0000ebe0: 4966 2061 6c72 6561 6479 2063 6163 6865  If already cache
+0000ebf0: 6420 616e 6420 6e6f 7420 666f 7263 696e  d and not forcin
+0000ec00: 672c 2072 6574 7572 6e0a 2020 2020 2020  g, return.      
+0000ec10: 2020 6966 2068 6173 6174 7472 2873 656c    if hasattr(sel
+0000ec20: 662c 2022 5f76 6f6c 756d 6522 2920 616e  f, "_volume") an
+0000ec30: 6420 6e6f 7420 666f 7263 653a 0a20 2020  d not force:.   
+0000ec40: 2020 2020 2020 2020 2069 6620 756e 6974           if unit
+0000ec50: 7320 696e 2073 656c 662e 5f76 6f6c 756d  s in self._volum
+0000ec60: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000ec70: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0000ec80: 766f 6c75 6d65 5b75 6e69 7473 5d0a 0a20  volume[units].. 
+0000ec90: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
+0000eca0: 2829 0a20 2020 2020 2020 2069 6620 6d65  ().        if me
+0000ecb0: 7468 6f64 2069 7320 4e6f 6e65 3a0a 2020  thod is None:.  
+0000ecc0: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+0000ecd0: 203d 2073 656c 662e 6465 6661 756c 745f   = self.default_
+0000ece0: 6765 6f6d 5f6d 6574 686f 640a 0a20 2020  geom_method..   
+0000ecf0: 2020 2020 2023 204d 616b 6520 6361 6368       # Make cach
+0000ed00: 6564 2070 726f 7065 7274 790a 2020 2020  ed property.    
+0000ed10: 2020 2020 7365 6c66 2e5f 766f 6c75 6d65      self._volume
+0000ed20: 203d 207b 7d0a 0a20 2020 2020 2020 2023   = {}..        #
+0000ed30: 2043 616c 6375 6c61 7465 2066 726f 6d20   Calculate from 
+0000ed40: 706f 6c79 676f 6e20 6172 6561 730a 2020  polygon areas.  
+0000ed50: 2020 2020 2020 6966 206d 6574 686f 6420        if method 
+0000ed60: 3d3d 2022 636f 6e74 6f75 7222 3a0a 0a20  == "contour":.. 
+0000ed70: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+0000ed80: 636b 2069 7427 7320 706f 7373 6962 6c65  ck it's possible
+0000ed90: 2074 6f20 6361 6c63 756c 6174 6520 766f   to calculate vo
+0000eda0: 6c75 6d65 2077 6974 6820 7468 6520 7265  lume with the re
+0000edb0: 7175 6573 7465 6420 756e 6974 730a 2020  quested units.  
+0000edc0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0000edd0: 662e 766f 7865 6c5f 7369 7a65 2069 7320  f.voxel_size is 
+0000ede0: 4e6f 6e65 2061 6e64 2075 6e69 7473 203d  None and units =
+0000edf0: 3d20 2276 6f78 656c 7322 3a0a 2020 2020  = "voxels":.    
+0000ee00: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000ee10: 6520 5275 6e74 696d 6545 7272 6f72 2822  e RuntimeError("
+0000ee20: 4361 6e6e 6f74 2063 6f6d 7075 7465 2076  Cannot compute v
+0000ee30: 6f6c 756d 6520 696e 2076 6f78 656c 7320  olume in voxels 
+0000ee40: 6672 6f6d 2022 0a20 2020 2020 2020 2020  from ".         
+0000ee50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee60: 2020 2020 2020 2020 2020 2263 6f6e 746f            "conto
+0000ee70: 7572 7320 7769 7468 6f75 7420 6b6e 6f77  urs without know
+0000ee80: 696e 6720 766f 7865 6c20 7369 7a65 7321  ing voxel sizes!
+0000ee90: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+0000eea0: 2320 4361 6c63 756c 6174 6520 6172 6561  # Calculate area
+0000eeb0: 206f 6e20 6561 6368 2073 6c69 6365 0a20   on each slice. 
+0000eec0: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
+0000eed0: 5f61 7265 6173 203d 205b 5d0a 2020 2020  _areas = [].    
+0000eee0: 2020 2020 2020 2020 666f 7220 6964 7820          for idx 
+0000eef0: 696e 2073 656c 662e 6765 745f 636f 6e74  in self.get_cont
+0000ef00: 6f75 7273 2822 782d 7922 2c20 6964 785f  ours("x-y", idx_
+0000ef10: 6173 5f6b 6579 3d54 7275 6529 3a0a 2020  as_key=True):.  
+0000ef20: 2020 2020 2020 2020 2020 2020 2020 736c                sl
+0000ef30: 6963 655f 6172 6561 732e 6170 7065 6e64  ice_areas.append
+0000ef40: 2873 656c 662e 6765 745f 6172 6561 2822  (self.get_area("
+0000ef50: 782d 7922 2c20 6964 783d 6964 782c 206d  x-y", idx=idx, m
+0000ef60: 6574 686f 643d 6d65 7468 6f64 2929 0a0a  ethod=method))..
+0000ef70: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
+0000ef80: 6e76 6572 7420 746f 2076 6f6c 756d 6520  nvert to volume 
+0000ef90: 696e 206d 6d0a 2020 2020 2020 2020 2020  in mm.          
+0000efa0: 2020 6172 6561 5f73 756d 203d 2073 756d    area_sum = sum
+0000efb0: 2873 6c69 6365 5f61 7265 6173 290a 2020  (slice_areas).  
+0000efc0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000efd0: 766f 6c75 6d65 5b22 6d6d 225d 203d 2061  volume["mm"] = a
+0000efe0: 7265 615f 7375 6d20 2a20 7365 6c66 2e67  rea_sum * self.g
+0000eff0: 6574 5f73 6c69 6365 5f74 6869 636b 6e65  et_slice_thickne
+0000f000: 7373 5f63 6f6e 746f 7572 7328 290a 0a20  ss_contours().. 
+0000f010: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
+0000f020: 706f 7373 6962 6c65 2c20 636f 6e76 6572  possible, conver
+0000f030: 7420 746f 2076 6f6c 756d 6520 696e 2076  t to volume in v
+0000f040: 6f78 656c 730a 2020 2020 2020 2020 2020  oxels.          
+0000f050: 2020 6966 2073 656c 662e 766f 7865 6c5f    if self.voxel_
+0000f060: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
+0000f070: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f080: 2020 7879 5f76 6f78 656c 5f61 7265 6120    xy_voxel_area 
+0000f090: 3d20 7365 6c66 2e76 6f78 656c 5f73 697a  = self.voxel_siz
+0000f0a0: 655b 305d 202a 2073 656c 662e 766f 7865  e[0] * self.voxe
+0000f0b0: 6c5f 7369 7a65 5b31 5d0a 2020 2020 2020  l_size[1].      
+0000f0c0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000f0d0: 766f 6c75 6d65 5b22 766f 7865 6c73 225d  volume["voxels"]
+0000f0e0: 203d 2061 7265 615f 7375 6d20 2f20 7879   = area_sum / xy
+0000f0f0: 5f76 6f78 656c 5f61 7265 610a 0a20 2020  _voxel_area..   
+0000f100: 2020 2020 2023 204f 7468 6572 7769 7365       # Otherwise
+0000f110: 2c20 6361 6c63 756c 6174 6520 6672 6f6d  , calculate from
+0000f120: 206e 756d 6265 7220 6f66 2076 6f78 656c   number of voxel
+0000f130: 7320 696e 206d 6173 6b0a 2020 2020 2020  s in mask.      
+0000f140: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000f150: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
+0000f160: 6d61 736b 2829 0a20 2020 2020 2020 2020  mask().         
+0000f170: 2020 2073 656c 662e 5f76 6f6c 756d 655b     self._volume[
+0000f180: 2276 6f78 656c 7322 5d20 3d20 7365 6c66  "voxels"] = self
+0000f190: 2e6d 6173 6b2e 6461 7461 2e61 7374 7970  .mask.data.astyp
+0000f1a0: 6528 626f 6f6c 292e 7375 6d28 290a 2020  e(bool).sum().  
+0000f1b0: 2020 2020 2020 2020 2020 766f 7865 6c5f            voxel_
+0000f1c0: 766f 6c20 3d20 6162 7328 6e70 2e70 726f  vol = abs(np.pro
+0000f1d0: 6428 7365 6c66 2e67 6574 5f76 6f78 656c  d(self.get_voxel
+0000f1e0: 5f73 697a 6528 2929 290a 2020 2020 2020  _size())).      
+0000f1f0: 2020 2020 2020 7365 6c66 2e5f 766f 6c75        self._volu
+0000f200: 6d65 5b22 6d6d 225d 203d 2073 656c 662e  me["mm"] = self.
+0000f210: 5f76 6f6c 756d 655b 2276 6f78 656c 7322  _volume["voxels"
+0000f220: 5d20 2a20 766f 7865 6c5f 766f 6c0a 0a20  ] * voxel_vol.. 
+0000f230: 2020 2020 2020 2023 2047 6574 2076 6f6c         # Get vol
+0000f240: 756d 6520 696e 206d 6c20 6f72 2065 7175  ume in ml or equ
+0000f250: 6976 616c 656e 746c 7920 6363 0a20 2020  ivalently cc.   
+0000f260: 2020 2020 2073 656c 662e 5f76 6f6c 756d       self._volum
+0000f270: 655b 226d 6c22 5d20 3d20 7365 6c66 2e5f  e["ml"] = self._
+0000f280: 766f 6c75 6d65 5b22 6d6d 225d 202f 2031  volume["mm"] / 1
+0000f290: 3030 300a 2020 2020 2020 2020 7365 6c66  000.        self
+0000f2a0: 2e5f 766f 6c75 6d65 5b22 6363 225d 203d  ._volume["cc"] =
+0000f2b0: 2073 656c 662e 5f76 6f6c 756d 655b 226d   self._volume["m
+0000f2c0: 6c22 5d0a 0a20 2020 2020 2020 2023 2052  l"]..        # R
+0000f2d0: 6574 7572 6e20 766f 6c75 6d65 2069 6e20  eturn volume in 
+0000f2e0: 7468 6520 7265 7175 6573 7465 6420 756e  the requested un
+0000f2f0: 6974 730a 2020 2020 2020 2020 7265 7475  its.        retu
+0000f300: 726e 2073 656c 662e 5f76 6f6c 756d 655b  rn self._volume[
+0000f310: 756e 6974 735d 0a0a 2020 2020 6465 6620  units]..    def 
+0000f320: 6765 745f 6d61 736b 5f74 6f5f 636f 6e74  get_mask_to_cont
+0000f330: 6f75 725f 766f 6c75 6d65 5f72 6174 696f  our_volume_ratio
+0000f340: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0000f350: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
+0000f360: 7261 7469 6f20 746f 2052 4f49 2022 6d61  ratio to ROI "ma
+0000f370: 736b 2220 766f 6c75 6d65 2074 6f20 524f  sk" volume to RO
+0000f380: 4920 2263 6f6e 746f 7572 2220 766f 6c75  I "contour" volu
+0000f390: 6d65 2e0a 0a20 2020 2020 2020 2049 6e20  me...        In 
+0000f3a0: 7072 696e 6369 706c 652c 2076 6f6c 756d  principle, volum
+0000f3b0: 6520 6573 7469 6d61 7465 7320 6672 6f6d  e estimates from
+0000f3c0: 2022 6d61 736b 2220 616e 6420 2263 6f6e   "mask" and "con
+0000f3d0: 746f 7572 2220 6d65 7468 6f64 730a 2020  tour" methods.  
+0000f3e0: 2020 2020 2020 7368 6f75 6c64 2062 6520        should be 
+0000f3f0: 7369 6d69 6c61 722e 2020 5468 6520 7477  similar.  The tw
+0000f400: 6f20 6573 7469 6d61 7465 7320 6d61 7920  o estimates may 
+0000f410: 6265 2064 6966 6665 7265 6e74 2069 662c  be different if,
+0000f420: 2066 6f72 0a20 2020 2020 2020 2065 7861   for.        exa
+0000f430: 6d70 6c65 2c20 7468 6520 696d 6167 6520  mple, the image 
+0000f440: 6672 6f6d 2077 6869 6368 2061 206d 6173  from which a mas
+0000f450: 6b20 6973 2063 7265 6174 6564 2064 6f65  k is created doe
+0000f460: 736e 2774 2066 756c 6c79 2063 6f76 6572  sn't fully cover
+0000f470: 0a20 2020 2020 2020 2074 6865 2063 6f6e  .        the con
+0000f480: 746f 7572 2065 7874 656e 7473 2e0a 2020  tour extents..  
+0000f490: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000f4a0: 2020 7265 7475 726e 2028 7365 6c66 2e67    return (self.g
+0000f4b0: 6574 5f76 6f6c 756d 6528 6d65 7468 6f64  et_volume(method
+0000f4c0: 3d22 6d61 736b 222c 2066 6f72 6365 3d54  ="mask", force=T
+0000f4d0: 7275 6529 202f 0a20 2020 2020 2020 2020  rue) /.         
+0000f4e0: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
+0000f4f0: 766f 6c75 6d65 286d 6574 686f 643d 2263  volume(method="c
+0000f500: 6f6e 746f 7572 222c 2066 6f72 6365 3d54  ontour", force=T
+0000f510: 7275 6529 290a 0a20 2020 2064 6566 2067  rue))..    def g
+0000f520: 6574 5f61 7265 6128 0a20 2020 2020 2020  et_area(.       
+0000f530: 2073 656c 662c 200a 2020 2020 2020 2020   self, .        
+0000f540: 7669 6577 3d22 782d 7922 2c20 0a20 2020  view="x-y", .   
+0000f550: 2020 2020 2073 6c3d 4e6f 6e65 2c20 0a20       sl=None, . 
+0000f560: 2020 2020 2020 2069 6478 3d4e 6f6e 652c         idx=None,
+0000f570: 200a 2020 2020 2020 2020 706f 733d 4e6f   .        pos=No
+0000f580: 6e65 2c20 0a20 2020 2020 2020 2075 6e69  ne, .        uni
+0000f590: 7473 3d22 6d6d 222c 200a 2020 2020 2020  ts="mm", .      
+0000f5a0: 2020 6d65 7468 6f64 3d4e 6f6e 652c 0a20    method=None,. 
+0000f5b0: 2020 2020 2020 2066 6c61 7474 656e 3d46         flatten=F
+0000f5c0: 616c 7365 2c0a 2020 2020 293a 0a20 2020  alse,.    ):.   
+0000f5d0: 2020 2020 2022 2222 4765 7420 7468 6520       """Get the 
+0000f5e0: 6172 6561 206f 6620 7468 6520 524f 4920  area of the ROI 
+0000f5f0: 6f6e 2061 2067 6976 656e 2073 6c69 6365  on a given slice
+0000f600: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
+0000f610: 616d 6574 6572 733a 2a2a 0a20 2020 2020  ameters:**.     
+0000f620: 2020 200a 2020 2020 2020 2020 7669 6577     .        view
+0000f630: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
+0000f640: 2278 2d79 220a 2020 2020 2020 2020 2020  "x-y".          
+0000f650: 2020 4f72 6965 6e74 6174 696f 6e20 6f66    Orientation of
+0000f660: 2073 6c69 6365 2066 6f72 2077 6869 6368   slice for which
+0000f670: 2074 6f20 6765 7420 6172 6561 2e0a 0a20   to get area... 
+0000f680: 2020 2020 2020 2073 6c20 3a20 696e 742c         sl : int,
+0000f690: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0000f6a0: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
+0000f6b0: 6e75 6d62 6572 2e20 4966 206e 6f6e 6520  number. If none 
+0000f6c0: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
+0000f6d0: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
+0000f6e0: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
+0000f6f0: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
+0000f700: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
+0000f710: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
+0000f720: 6620 7468 6520 524f 4920 7769 6c6c 2062  f the ROI will b
+0000f730: 6520 7573 6564 2e0a 0a20 2020 2020 2020  e used...       
+0000f740: 2069 6478 203a 2069 6e74 2c20 6465 6661   idx : int, defa
+0000f750: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+0000f760: 2020 2020 2041 7272 6179 2069 6e64 6578       Array index
+0000f770: 206f 6620 736c 6963 652e 2049 6620 6e6f   of slice. If no
+0000f780: 6e65 206f 6620 3c73 6c3e 2c20 3c69 6478  ne of <sl>, <idx
+0000f790: 3e20 6f72 203c 706f 733e 2061 7265 2073  > or <pos> are s
+0000f7a0: 7570 706c 6965 6420 6275 740a 2020 2020  upplied but.    
+0000f7b0: 2020 2020 2020 2020 3c73 696e 676c 655f          <single_
+0000f7c0: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
+0000f7d0: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
+0000f7e0: 6520 6f66 2074 6865 2052 4f49 2077 696c  e of the ROI wil
+0000f7f0: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
+0000f800: 2020 2020 706f 7320 3a20 666c 6f61 742c      pos : float,
+0000f810: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0000f820: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
+0000f830: 706f 7369 7469 6f6e 2069 6e20 6d6d 2e20  position in mm. 
+0000f840: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
+0000f850: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
+0000f860: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
+0000f870: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
+0000f880: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
+0000f890: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
+0000f8a0: 2073 6c69 6365 206f 6620 7468 6520 524f   slice of the RO
+0000f8b0: 4920 7769 6c6c 2062 6520 7573 6564 2e0a  I will be used..
+0000f8c0: 0a20 2020 2020 2020 2075 6e69 7473 203a  .        units :
+0000f8d0: 2073 7472 2c20 6465 6661 756c 743d 226d   str, default="m
+0000f8e0: 6d22 0a20 2020 2020 2020 2020 2020 2055  m".            U
+0000f8f0: 6e69 7473 206f 6620 6172 6561 2e20 4361  nits of area. Ca
+0000f900: 6e20 6265 2065 6974 6865 7220 6f66 3a0a  n be either of:.
+0000f910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f920: 202a 2022 6d6d 223a 2072 6574 7572 6e20   * "mm": return 
+0000f930: 6172 6561 2069 6e20 6d69 6c6c 696d 6574  area in millimet
+0000f940: 7265 7320 7371 7561 7265 642e 0a20 2020  res squared..   
+0000f950: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+0000f960: 766f 7865 6c73 223a 2072 6574 7572 6e20  voxels": return 
+0000f970: 6172 6561 2069 6e20 6e75 6d62 6572 206f  area in number o
+0000f980: 6620 766f 7865 6c73 2e0a 0a20 2020 2020  f voxels...     
+0000f990: 2020 2020 2020 2049 6620 756e 6974 733d         If units=
+0000f9a0: 2276 6f78 656c 7322 2069 7320 7265 7175  "voxels" is requ
+0000f9b0: 6573 7465 6420 6275 7420 7468 6973 2052  ested but this R
+0000f9c0: 4f49 206f 6e6c 7920 6861 7320 636f 6e74  OI only has cont
+0000f9d0: 6f75 7273 2061 6e64 206e 6f0a 2020 2020  ours and no.    
+0000f9e0: 2020 2020 2020 2020 766f 7865 6c20 7369          voxel si
+0000f9f0: 7a65 2069 6e66 6f72 6d61 7469 6f6e 2c20  ze information, 
+0000fa00: 616e 2065 7272 6f72 2077 696c 6c20 6265  an error will be
+0000fa10: 2072 6169 7365 642e 0a0a 2020 2020 2020   raised...      
+0000fa20: 2020 6d65 7468 6f64 203a 2073 7472 2c20    method : str, 
+0000fa30: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+0000fa40: 2020 2020 2020 2020 204d 6574 686f 6420           Method 
+0000fa50: 746f 2075 7365 2066 6f72 2061 7265 6120  to use for area 
+0000fa60: 6361 6c63 756c 6174 696f 6e2e 2043 616e  calculation. Can
+0000fa70: 2062 653a 200a 0a20 2020 2020 2020 2020   be: ..         
+0000fa80: 2020 2020 2020 202a 2022 636f 6e74 6f75         * "contou
+0000fa90: 7222 3a20 636f 6d70 7574 6520 6172 6561  r": compute area
+0000faa0: 2066 726f 6d20 7368 6170 656c 7920 706f   from shapely po
+0000fab0: 6c79 676f 6e20 6f6e 2074 6865 2073 6c69  lygon on the sli
+0000fac0: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
+0000fad0: 2020 2020 2a20 226d 6173 6b22 3a20 636f      * "mask": co
+0000fae0: 6d70 7574 6520 6172 6561 2062 7920 7375  mpute area by su
+0000faf0: 6d6d 696e 6720 7069 7865 6c73 206f 6e20  mming pixels on 
+0000fb00: 7468 6520 736c 6963 6520 616e 6420 0a20  the slice and . 
+0000fb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb20: 206d 756c 7469 706c 7969 6e67 2062 7920   multiplying by 
+0000fb30: 7468 6520 6172 6561 206f 6620 6f6e 6520  the area of one 
+0000fb40: 7069 7865 6c2e 0a20 2020 2020 2020 2020  pixel..         
+0000fb50: 2020 2020 2020 202a 204e 6f6e 653a 2075         * None: u
+0000fb60: 7365 2074 6865 206d 6574 686f 6420 7365  se the method se
+0000fb70: 7420 696e 2073 656c 662e 6465 6661 756c  t in self.defaul
+0000fb80: 745f 6765 6f6d 5f6d 6574 686f 642e 0a0a  t_geom_method...
+0000fb90: 2020 2020 2020 2020 666c 6174 7465 6e20          flatten 
+0000fba0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
+0000fbb0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0000fbc0: 2020 4966 2054 7275 652c 2061 6c6c 2073    If True, all s
+0000fbd0: 6c69 6365 7320 7769 6c6c 2062 6520 666c  lices will be fl
+0000fbe0: 6174 7465 6e65 6420 696e 2074 6865 2067  attened in the g
+0000fbf0: 6976 656e 206f 7269 656e 7461 7469 6f6e  iven orientation
+0000fc00: 2061 6e64 0a20 2020 2020 2020 2020 2020   and.           
+0000fc10: 2074 6865 2061 7265 6120 6f66 2074 6865   the area of the
+0000fc20: 2066 6c61 7474 656e 6564 2073 6c69 6365   flattened slice
+0000fc30: 2077 696c 6c20 6265 2072 6574 7572 6e65   will be returne
+0000fc40: 642e 204f 6e6c 7920 6176 6169 6c61 626c  d. Only availabl
+0000fc50: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+0000fc60: 206d 6574 686f 643d 226d 6173 6b22 2e0a   method="mask"..
+0000fc70: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0000fc80: 2020 2020 2023 2047 6574 2064 6566 6175       # Get defau
+0000fc90: 6c74 2073 6c69 6365 2069 6e64 6578 2061  lt slice index a
+0000fca0: 6e64 206d 6574 686f 640a 2020 2020 2020  nd method.      
+0000fcb0: 2020 7365 6c66 2e6c 6f61 6428 290a 2020    self.load().  
+0000fcc0: 2020 2020 2020 6966 2073 6c20 6973 204e        if sl is N
+0000fcd0: 6f6e 6520 616e 6420 6964 7820 6973 204e  one and idx is N
+0000fce0: 6f6e 6520 616e 6420 706f 7320 6973 204e  one and pos is N
+0000fcf0: 6f6e 653a 200a 2020 2020 2020 2020 2020  one: .          
+0000fd00: 2020 6964 7820 3d20 7365 6c66 2e67 6574    idx = self.get
+0000fd10: 5f6d 6964 5f69 6478 2876 6965 7729 0a20  _mid_idx(view). 
+0000fd20: 2020 2020 2020 2069 6620 6d65 7468 6f64         if method
+0000fd30: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000fd40: 2020 2020 2020 6d65 7468 6f64 203d 2073        method = s
+0000fd50: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
+0000fd60: 5f6d 6574 686f 640a 0a20 2020 2020 2020  _method..       
+0000fd70: 2023 2049 6620 524f 4920 6973 206e 6f74   # If ROI is not
+0000fd80: 206f 6e20 7468 6520 6769 7665 6e20 736c   on the given sl
+0000fd90: 6963 652c 2072 6574 7572 6e20 4e6f 6e65  ice, return None
+0000fda0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000fdb0: 7365 6c66 2e6f 6e5f 736c 6963 6528 7669  self.on_slice(vi
+0000fdc0: 6577 2c20 736c 3d73 6c2c 2069 6478 3d69  ew, sl=sl, idx=i
+0000fdd0: 6478 2c20 706f 733d 706f 7329 3a0a 2020  dx, pos=pos):.  
+0000fde0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000fdf0: 0a0a 2020 2020 2020 2020 6966 2066 6c61  ..        if fla
+0000fe00: 7474 656e 3a20 2023 2046 6c61 7474 656e  tten:  # Flatten
+0000fe10: 696e 6720 6f6e 6c79 2070 6f73 7369 626c  ing only possibl
+0000fe20: 6520 7769 7468 2022 6d61 736b 220a 2020  e with "mask".  
+0000fe30: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+0000fe40: 203d 2022 6d61 736b 220a 0a20 2020 2020   = "mask"..     
+0000fe50: 2020 2023 2043 616c 6375 6c61 7465 2061     # Calculate a
+0000fe60: 7265 6120 6672 6f6d 2073 6861 7065 6c79  rea from shapely
+0000fe70: 2070 6f6c 7967 6f6e 2873 290a 2020 2020   polygon(s).    
+0000fe80: 2020 2020 6966 206d 6574 686f 6420 3d3d      if method ==
+0000fe90: 2022 636f 6e74 6f75 7222 3a0a 0a20 2020   "contour":..   
+0000fea0: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
+0000feb0: 2069 7427 7320 706f 7373 6962 6c65 2074   it's possible t
+0000fec0: 6f20 6361 6c63 756c 6174 6520 6172 6561  o calculate area
+0000fed0: 2077 6974 6820 7468 6520 7265 7175 6573   with the reques
+0000fee0: 7465 6420 756e 6974 730a 2020 2020 2020  ted units.      
+0000fef0: 2020 2020 2020 6966 2073 656c 662e 766f        if self.vo
+0000ff00: 7865 6c5f 7369 7a65 2069 7320 4e6f 6e65  xel_size is None
+0000ff10: 2061 6e64 2075 6e69 7473 203d 3d20 2276   and units == "v
+0000ff20: 6f78 656c 7322 3a0a 2020 2020 2020 2020  oxels":.        
+0000ff30: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
+0000ff40: 6e74 696d 6545 7272 6f72 2822 4361 6e6e  ntimeError("Cann
+0000ff50: 6f74 2063 6f6d 7075 7465 2061 7265 6120  ot compute area 
+0000ff60: 696e 2076 6f78 656c 7320 6672 6f6d 2022  in voxels from "
+0000ff70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ff80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff90: 2020 2020 2263 6f6e 746f 7572 7320 7769      "contours wi
+0000ffa0: 7468 6f75 7420 6b6e 6f77 696e 6720 766f  thout knowing vo
+0000ffb0: 7865 6c20 7369 7a65 7321 2229 0a0a 2020  xel sizes!")..  
+0000ffc0: 2020 2020 2020 2020 2020 706f 6c79 676f            polygo
+0000ffd0: 6e73 203d 2073 656c 662e 6765 745f 706f  ns = self.get_po
+0000ffe0: 6c79 676f 6e73 5f6f 6e5f 736c 6963 6528  lygons_on_slice(
+0000fff0: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
+00010000: 6f73 290a 2020 2020 2020 2020 2020 2020  os).            
+00010010: 6172 6561 203d 2073 756d 285b 702e 6172  area = sum([p.ar
+00010020: 6561 2066 6f72 2070 2069 6e20 706f 6c79  ea for p in poly
+00010030: 676f 6e73 5d29 0a20 2020 2020 2020 2020  gons]).         
+00010040: 2020 2069 6620 756e 6974 7320 3d3d 2022     if units == "
+00010050: 766f 7865 6c73 223a 0a20 2020 2020 2020  voxels":.       
+00010060: 2020 2020 2020 2020 2078 5f61 782c 2079           x_ax, y
+00010070: 5f61 7820 3d20 736b 7274 2e69 6d61 6765  _ax = skrt.image
+00010080: 2e5f 706c 6f74 5f61 7865 735b 7669 6577  ._plot_axes[view
+00010090: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000100a0: 2020 7879 5f61 7265 6120 3d20 6162 7328    xy_area = abs(
+000100b0: 7365 6c66 2e76 6f78 656c 5f73 697a 655b  self.voxel_size[
+000100c0: 785f 6178 5d20 2a20 7365 6c66 2e76 6f78  x_ax] * self.vox
+000100d0: 656c 5f73 697a 655b 795f 6178 5d29 0a20  el_size[y_ax]). 
+000100e0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000100f0: 7265 6120 2f3d 2078 795f 6172 6561 0a20  rea /= xy_area. 
+00010100: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00010110: 6e20 6172 6561 0a0a 2020 2020 2020 2020  n area..        
+00010120: 2320 4f74 6865 7277 6973 652c 2063 616c  # Otherwise, cal
+00010130: 6375 6c61 7465 2061 7265 6120 6672 6f6d  culate area from
+00010140: 2062 696e 6172 7920 6d61 736b 0a20 2020   binary mask.   
+00010150: 2020 2020 2069 6d5f 736c 6963 6520 3d20       im_slice = 
+00010160: 7365 6c66 2e67 6574 5f73 6c69 6365 2876  self.get_slice(v
+00010170: 6965 772c 2073 6c3d 736c 2c20 6964 783d  iew, sl=sl, idx=
+00010180: 6964 782c 2070 6f73 3d70 6f73 2c20 0a20  idx, pos=pos, . 
+00010190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101b0: 2066 6c61 7474 656e 3d66 6c61 7474 656e   flatten=flatten
+000101c0: 290a 2020 2020 2020 2020 6172 6561 203d  ).        area =
+000101d0: 2069 6d5f 736c 6963 652e 6173 7479 7065   im_slice.astype
+000101e0: 2862 6f6f 6c29 2e73 756d 2829 0a20 2020  (bool).sum().   
+000101f0: 2020 2020 2069 6620 756e 6974 7320 3d3d       if units ==
+00010200: 2022 6d6d 223a 0a20 2020 2020 2020 2020   "mm":.         
+00010210: 2020 2078 5f61 782c 2079 5f61 7820 3d20     x_ax, y_ax = 
+00010220: 736b 7274 2e69 6d61 6765 2e5f 706c 6f74  skrt.image._plot
+00010230: 5f61 7865 735b 7669 6577 5d0a 2020 2020  _axes[view].    
+00010240: 2020 2020 2020 2020 7879 5f61 7265 6120          xy_area 
+00010250: 3d20 6162 7328 7365 6c66 2e76 6f78 656c  = abs(self.voxel
+00010260: 5f73 697a 655b 785f 6178 5d20 2a20 7365  _size[x_ax] * se
+00010270: 6c66 2e76 6f78 656c 5f73 697a 655b 795f  lf.voxel_size[y_
+00010280: 6178 5d29 0a20 2020 2020 2020 2020 2020  ax]).           
+00010290: 2061 7265 6120 2a3d 2078 795f 6172 6561   area *= xy_area
+000102a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000102b0: 6172 6561 0a0a 2020 2020 6465 6620 6765  area..    def ge
+000102c0: 745f 6262 6f78 5f63 656e 7472 655f 616e  t_bbox_centre_an
+000102d0: 645f 7769 6474 6873 2873 656c 662c 0a20  d_widths(self,. 
+000102e0: 2020 2020 2020 2020 2020 2062 7566 6665             buffe
+000102f0: 723d 4e6f 6e65 2c20 6275 6666 6572 5f75  r=None, buffer_u
+00010300: 6e69 7473 3d22 6d6d 222c 206d 6574 686f  nits="mm", metho
+00010310: 643d 4e6f 6e65 293a 0a20 2020 2020 2020  d=None):.       
+00010320: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
+00010330: 2063 656e 7472 6520 616e 6420 7769 6474   centre and widt
+00010340: 6873 2069 6e20 6d6d 2061 6c6f 6e67 2061  hs in mm along a
+00010350: 6c6c 2074 6872 6565 2061 7865 7320 6f66  ll three axes of
+00010360: 2061 0a20 2020 2020 2020 2062 6f75 6e64   a.        bound
+00010370: 696e 6720 626f 7820 656e 636c 6f73 696e  ing box enclosin
+00010380: 6720 7468 6520 524f 4920 616e 6420 6f70  g the ROI and op
+00010390: 7469 6f6e 616c 2062 7566 6665 722e 2020  tional buffer.  
+000103a0: 4365 6e74 7265 0a20 2020 2020 2020 2061  Centre.        a
+000103b0: 6e64 2077 6964 7468 7320 6172 6520 7265  nd widths are re
+000103c0: 7475 726e 6564 2061 7320 6120 7475 706c  turned as a tupl
+000103d0: 6520 285b 782c 2079 2c20 7a5d 2c20 5b64  e ([x, y, z], [d
+000103e0: 782c 2064 792c 2064 7a5d 292e 0a0a 2020  x, dy, dz])...  
+000103f0: 2020 2020 2020 4d65 7468 6f64 2070 6172        Method par
+00010400: 616d 6574 6572 7320 6172 6520 7061 7373  ameters are pass
+00010410: 6564 2074 6f20 736b 7274 2e73 7472 7563  ed to skrt.struc
+00010420: 7475 7265 732e 524f 492e 6765 745f 6578  tures.ROI.get_ex
+00010430: 7465 6e74 7328 290a 2020 2020 2020 2020  tents().        
+00010440: 746f 206f 6274 6169 6e20 524f 4920 6578  to obtain ROI ex
+00010450: 7465 6e74 732e 2020 466f 7220 7061 7261  tents.  For para
+00010460: 6d65 7465 7220 6578 706c 616e 6174 696f  meter explanatio
+00010470: 6e73 2c20 7365 650a 2020 2020 2020 2020  ns, see.        
+00010480: 736b 7274 2e73 7472 7563 7475 7265 732e  skrt.structures.
+00010490: 524f 492e 6765 745f 6578 7465 6e74 7328  ROI.get_extents(
+000104a0: 2920 646f 6375 6d65 6e74 6174 696f 6e2e  ) documentation.
+000104b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000104c0: 2020 2020 2065 7874 656e 7473 203d 2073       extents = s
+000104d0: 656c 662e 6765 745f 6578 7465 6e74 7328  elf.get_extents(
+000104e0: 6275 6666 6572 2c20 6275 6666 6572 5f75  buffer, buffer_u
+000104f0: 6e69 7473 2c20 6d65 7468 6f64 2920 0a20  nits, method) . 
+00010500: 2020 2020 2020 2063 656e 7472 6520 3d20         centre = 
+00010510: 5b30 2e35 202a 2028 6578 7465 6e74 5b30  [0.5 * (extent[0
+00010520: 5d20 2b20 6578 7465 6e74 5b31 5d29 2066  ] + extent[1]) f
+00010530: 6f72 2065 7874 656e 7420 696e 2065 7874  or extent in ext
+00010540: 656e 7473 5d0a 2020 2020 2020 2020 7769  ents].        wi
+00010550: 6474 6873 203d 205b 2865 7874 656e 745b  dths = [(extent[
+00010560: 315d 202d 2065 7874 656e 745b 305d 2920  1] - extent[0]) 
+00010570: 666f 7220 6578 7465 6e74 2069 6e20 6578  for extent in ex
+00010580: 7465 6e74 735d 0a20 2020 2020 2020 2072  tents].        r
+00010590: 6574 7572 6e20 2863 656e 7472 652c 2077  eturn (centre, w
+000105a0: 6964 7468 7329 0a0a 2020 2020 6465 6620  idths)..    def 
+000105b0: 6765 745f 6578 7465 6e74 7328 7365 6c66  get_extents(self
+000105c0: 2c20 6275 6666 6572 3d4e 6f6e 652c 2062  , buffer=None, b
+000105d0: 7566 6665 725f 756e 6974 733d 226d 6d22  uffer_units="mm"
+000105e0: 2c20 6d65 7468 6f64 3d4e 6f6e 652c 0a20  , method=None,. 
+000105f0: 2020 2020 2020 2020 2020 206f 7269 6769             origi
+00010600: 6e3d 4e6f 6e65 293a 0a20 2020 2020 2020  n=None):.       
+00010610: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
+00010620: 206d 696e 696d 756d 2061 6e64 206d 6178   minimum and max
+00010630: 696d 756d 2065 7874 656e 7420 6f66 2074  imum extent of t
+00010640: 6865 2052 4f49 2069 6e20 6d6d 2061 6c6f  he ROI in mm alo
+00010650: 6e67 2061 6c6c 2074 6872 6565 2061 7865  ng all three axe
+00010660: 732c 0a20 2020 2020 2020 2072 6574 7572  s,.        retur
+00010670: 6e65 6420 696e 206f 7264 6572 205b 782c  ned in order [x,
+00010680: 2079 2c20 7a5d 2e20 4f70 7469 6f6e 616c   y, z]. Optional
+00010690: 6c79 2061 7070 6c79 2061 2062 7566 6665  ly apply a buffe
+000106a0: 7220 746f 2074 6865 2065 7874 656e 7473  r to the extents
+000106b0: 0a20 2020 2020 2020 2073 7563 6820 7468  .        such th
+000106c0: 6174 2074 6865 7920 636f 7665 7220 6d6f  at they cover mo
+000106d0: 7265 2074 6861 6e20 7468 6520 524f 4927  re than the ROI'
+000106e0: 7320 6172 6561 2e0a 0a20 2020 2020 2020  s area...       
+000106f0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+00010700: 0a0a 2020 2020 2020 2020 6275 6666 6572  ..        buffer
+00010710: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
+00010720: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00010730: 2020 204f 7074 696f 6e61 6c20 6275 6666     Optional buff
+00010740: 6572 2074 6f20 6164 6420 746f 2074 6865  er to add to the
+00010750: 2065 7874 656e 7473 2e20 556e 6974 7320   extents. Units 
+00010760: 7365 7420 6279 2060 6275 6666 6572 5f75  set by `buffer_u
+00010770: 6e69 7473 602e 0a0a 2020 2020 2020 2020  nits`...        
+00010780: 6275 6666 6572 5f75 6e69 7473 203a 2073  buffer_units : s
+00010790: 7472 2c20 6465 6661 756c 743d 226d 6d22  tr, default="mm"
+000107a0: 0a20 2020 2020 2020 2020 2020 2055 6e69  .            Uni
+000107b0: 7473 2066 6f72 2062 7566 6665 722c 2069  ts for buffer, i
+000107c0: 6620 7573 696e 672e 2043 616e 2062 6520  f using. Can be 
+000107d0: 226d 6d22 2c20 2276 6f78 656c 7322 2c20  "mm", "voxels", 
+000107e0: 6f72 2022 6672 6163 2220 2877 6869 6368  or "frac" (which
+000107f0: 0a20 2020 2020 2020 2020 2020 2061 7070  .            app
+00010800: 6c69 6573 2062 7566 6665 7220 6173 2061  lies buffer as a
+00010810: 2066 7261 6374 696f 6e20 6f66 2074 6f74   fraction of tot
+00010820: 616c 206c 656e 6774 6820 696e 2065 6163  al length in eac
+00010830: 6820 6469 6d65 6e73 696f 6e29 2e0a 0a20  h dimension)... 
+00010840: 2020 2020 2020 206d 6574 686f 6420 3a20         method : 
+00010850: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
+00010860: 650a 2020 2020 2020 2020 2020 2020 4d65  e.            Me
+00010870: 7468 6f64 2074 6f20 7573 6520 666f 7220  thod to use for 
+00010880: 6578 7465 6e74 2063 616c 6375 6c61 7469  extent calculati
+00010890: 6f6e 2e20 4361 6e20 6265 3a20 0a0a 2020  on. Can be: ..  
+000108a0: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
+000108b0: 2263 6f6e 746f 7572 223a 2067 6574 2065  "contour": get e
+000108c0: 7874 656e 7420 6672 6f6d 206d 696e 2f6d  xtent from min/m
+000108d0: 6178 2070 6f73 6974 696f 6e73 206f 6620  ax positions of 
+000108e0: 636f 6e74 6f75 7228 7329 2e0a 2020 2020  contour(s)..    
+000108f0: 2020 2020 2020 2020 2020 2020 2a20 226d              * "m
+00010900: 6173 6b22 3a20 6765 7420 6578 7465 6e74  ask": get extent
+00010910: 2066 726f 6d20 6d69 6e2f 6d61 7820 706f   from min/max po
+00010920: 7369 7469 6f6e 7320 6f66 2076 6f78 656c  sitions of voxel
+00010930: 7320 696e 2074 6865 200a 2020 2020 2020  s in the .      
+00010940: 2020 2020 2020 2020 2020 2020 6269 6e61              bina
+00010950: 7279 206d 6173 6b2e 0a20 2020 2020 2020  ry mask..       
+00010960: 2020 2020 2020 2020 202a 204e 6f6e 653a           * None:
+00010970: 2075 7365 2074 6865 206d 6574 686f 6420   use the method 
+00010980: 7365 7420 696e 2073 656c 662e 6465 6661  set in self.defa
+00010990: 756c 745f 6765 6f6d 5f6d 6574 686f 642e  ult_geom_method.
+000109a0: 0a0a 2020 2020 2020 2020 6f72 6967 696e  ..        origin
+000109b0: 203a 2074 7570 6c65 2c20 6465 6661 756c   : tuple, defaul
+000109c0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+000109d0: 2020 2054 7570 6c65 2073 7065 6369 6679     Tuple specify
+000109e0: 696e 6720 7468 6520 2878 2c20 792c 207a  ing the (x, y, z
+000109f0: 2920 636f 6f72 6469 6e61 7465 7320 6f66  ) coordinates of
+00010a00: 2074 6865 2070 6f69 6e74 0a20 2020 2020   the point.     
+00010a10: 2020 2020 2020 2077 6974 6820 7265 7370         with resp
+00010a20: 6563 7420 746f 2077 6869 6368 2065 7874  ect to which ext
+00010a30: 656e 7473 2061 7265 2074 6f20 6265 2064  ents are to be d
+00010a40: 6574 6572 6d69 6e65 642e 0a20 2020 2020  etermined..     
+00010a50: 2020 2020 2020 2049 6620 4e6f 6e65 2c20         If None, 
+00010a60: 7468 656e 2028 302c 2030 2c20 3029 2069  then (0, 0, 0) i
+00010a70: 7320 7573 6564 2e0a 2020 2020 2020 2020  s used..        
+00010a80: 2222 220a 2020 2020 2020 2020 2320 456e  """.        # En
+00010a90: 7375 7265 2074 6861 7420 6f72 6967 696e  sure that origin
+00010aa0: 2069 7320 6465 6669 6e65 642e 0a20 2020   is defined..   
+00010ab0: 2020 2020 206f 7269 6769 6e20 3d20 6f72       origin = or
+00010ac0: 6967 696e 206f 7220 2830 2c20 302c 2030  igin or (0, 0, 0
+00010ad0: 290a 0a20 2020 2020 2020 2023 2047 6574  )..        # Get
+00010ae0: 2065 7874 656e 7420 696e 2065 6163 6820   extent in each 
+00010af0: 6469 7265 6374 696f 6e0a 2020 2020 2020  direction.      
+00010b00: 2020 6578 7465 6e74 7320 3d20 5b5d 0a20    extents = []. 
+00010b10: 2020 2020 2020 2066 6f72 2061 7820 696e         for ax in
+00010b20: 2073 6b72 742e 696d 6167 652e 5f61 7865   skrt.image._axe
+00010b30: 733a 0a20 2020 2020 2020 2020 2020 2065  s:.            e
+00010b40: 7874 656e 7473 2e61 7070 656e 6428 7365  xtents.append(se
+00010b50: 6c66 2e67 6574 5f65 7874 656e 7428 6178  lf.get_extent(ax
+00010b60: 2c20 6d65 7468 6f64 3d6d 6574 686f 642c  , method=method,
+00010b70: 206f 7269 6769 6e3d 6f72 6967 696e 2929   origin=origin))
+00010b80: 0a0a 2020 2020 2020 2020 2320 4170 706c  ..        # Appl
+00010b90: 7920 6275 6666 6572 2069 6620 7265 7175  y buffer if requ
+00010ba0: 6573 7465 640a 2020 2020 2020 2020 6966  ested.        if
+00010bb0: 2062 7566 6665 723a 0a20 2020 2020 2020   buffer:.       
+00010bc0: 2020 2020 2066 6f72 2061 7820 696e 2072       for ax in r
+00010bd0: 616e 6765 2833 293a 0a20 2020 2020 2020  ange(3):.       
+00010be0: 2020 2020 2020 2020 2069 6620 6275 6666           if buff
+00010bf0: 6572 5f75 6e69 7473 203d 3d20 226d 6d22  er_units == "mm"
+00010c00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010c10: 2020 2020 2020 6465 6c74 6120 3d20 6275        delta = bu
+00010c20: 6666 6572 0a20 2020 2020 2020 2020 2020  ffer.           
+00010c30: 2020 2020 2065 6c69 6620 6275 6666 6572       elif buffer
+00010c40: 5f75 6e69 7473 203d 3d20 2276 6f78 656c  _units == "voxel
+00010c50: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
+00010c60: 2020 2020 2020 2020 6465 6c74 6120 3d20          delta = 
+00010c70: 6162 7328 6275 6666 6572 202a 2073 656c  abs(buffer * sel
+00010c80: 662e 766f 7865 6c5f 7369 7a65 5b61 785d  f.voxel_size[ax]
+00010c90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00010ca0: 2020 656c 6966 2062 7566 6665 725f 756e    elif buffer_un
+00010cb0: 6974 7320 3d3d 2022 6672 6163 223a 0a20  its == "frac":. 
+00010cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010cd0: 2020 2064 656c 7461 203d 2062 7566 6665     delta = buffe
+00010ce0: 7220 2a20 6162 7328 6578 7465 6e74 735b  r * abs(extents[
+00010cf0: 6178 5d5b 315d 202d 2065 7874 656e 7473  ax][1] - extents
+00010d00: 5b61 785d 5b30 5d29 0a20 2020 2020 2020  [ax][0]).       
+00010d10: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00010d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d30: 2020 2070 7269 6e74 2866 2255 6e72 6563     print(f"Unrec
+00010d40: 6f67 6e69 7365 6420 6275 6666 6572 2075  ognised buffer u
+00010d50: 6e69 7473 207b 6275 6666 6572 5f75 6e69  nits {buffer_uni
+00010d60: 7473 7d2e 2053 686f 756c 6420 220a 2020  ts}. Should ".  
+00010d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d80: 2020 2020 2020 2020 2762 6520 226d 6d22          'be "mm"
+00010d90: 2c20 2276 6f78 656c 7322 2c20 6f72 2022  , "voxels", or "
+00010da0: 6672 6163 222e 2729 0a20 2020 2020 2020  frac".').       
+00010db0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00010dc0: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
+00010dd0: 2020 2020 6578 7465 6e74 735b 6178 5d5b      extents[ax][
+00010de0: 305d 202d 3d20 6465 6c74 610a 2020 2020  0] -= delta.    
+00010df0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
+00010e00: 6e74 735b 6178 5d5b 315d 202b 3d20 6465  nts[ax][1] += de
+00010e10: 6c74 610a 0a20 2020 2020 2020 2072 6574  lta..        ret
+00010e20: 7572 6e20 6578 7465 6e74 730a 0a20 2020  urn extents..   
+00010e30: 2064 6566 2067 6574 5f65 7874 656e 7428   def get_extent(
+00010e40: 7365 6c66 2c20 0a20 2020 2020 2020 2020  self, .         
+00010e50: 2020 2020 2020 2020 2020 6178 3d22 7a22            ax="z"
+00010e60: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+00010e70: 2020 2020 2020 7369 6e67 6c65 5f73 6c69        single_sli
+00010e80: 6365 3d46 616c 7365 2c0a 2020 2020 2020  ce=False,.      
+00010e90: 2020 2020 2020 2020 2020 2020 2076 6965               vie
+00010ea0: 773d 2278 2d79 222c 0a20 2020 2020 2020  w="x-y",.       
+00010eb0: 2020 2020 2020 2020 2020 2020 736c 3d4e              sl=N
+00010ec0: 6f6e 652c 200a 2020 2020 2020 2020 2020  one, .          
+00010ed0: 2020 2020 2020 2020 2069 6478 3d4e 6f6e           idx=Non
+00010ee0: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
+00010ef0: 2020 2020 2020 2070 6f73 3d4e 6f6e 652c         pos=None,
+00010f00: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00010f10: 2020 2020 206d 6574 686f 643d 4e6f 6e65       method=None
+00010f20: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+00010f30: 2020 2020 2020 6f72 6967 696e 3d4e 6f6e        origin=Non
+00010f40: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00010f50: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00010f60: 2222 2247 6574 206d 696e 696d 756d 2061  """Get minimum a
+00010f70: 6e64 206d 6178 696d 756d 2065 7874 656e  nd maximum exten
+00010f80: 7420 6f66 2074 6865 2052 4f49 2069 6e20  t of the ROI in 
+00010f90: 6d6d 2061 6c6f 6e67 2061 2067 6976 656e  mm along a given
+00010fa0: 2061 7869 732e 0a0a 2020 2020 2020 2020   axis...        
+00010fb0: 6178 203a 2073 7472 2f69 6e74 2c20 6465  ax : str/int, de
+00010fc0: 6661 756c 743d 227a 220a 2020 2020 2020  fault="z".      
+00010fd0: 2020 2020 2020 4178 6973 2061 6c6f 6e67        Axis along
+00010fe0: 2077 6869 6368 2074 6f20 7265 7475 726e   which to return
+00010ff0: 2065 7874 656e 742e 2053 686f 756c 6420   extent. Should 
+00011000: 6265 206f 6e65 206f 6620 5b22 7822 2c20  be one of ["x", 
+00011010: 2279 222c 2022 7a22 5d20 0a20 2020 2020  "y", "z"] .     
+00011020: 2020 2020 2020 206f 7220 5b30 2c20 312c         or [0, 1,
+00011030: 2032 5d0a 0a20 2020 2020 2020 2073 696e   2]..        sin
+00011040: 676c 655f 736c 6963 6520 3a20 626f 6f6c  gle_slice : bool
+00011050: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
+00011060: 2020 2020 2020 2020 2020 2020 4966 2046              If F
+00011070: 616c 7365 2c20 7468 6520 3344 2065 7874  alse, the 3D ext
+00011080: 656e 7420 6f66 2074 6865 2065 6e74 6972  ent of the entir
+00011090: 6520 524f 4920 7769 6c6c 2062 6520 7265  e ROI will be re
+000110a0: 7475 726e 6564 3b0a 2020 2020 2020 2020  turned;.        
+000110b0: 2020 2020 6f74 6865 7277 6973 652c 2074      otherwise, t
+000110c0: 6865 2032 4420 6578 7465 6e74 206f 6620  he 2D extent of 
+000110d0: 6120 7369 6e67 6c65 2073 6c69 6365 2077  a single slice w
+000110e0: 696c 6c20 6265 2072 6574 7572 6e65 642e  ill be returned.
+000110f0: 0a0a 2020 2020 2020 2020 7669 6577 203a  ..        view :
+00011100: 2073 7472 2c20 6465 6661 756c 743d 2278   str, default="x
+00011110: 2d79 220a 2020 2020 2020 2020 2020 2020  -y".            
+00011120: 4f72 6965 6e74 6174 696f 6e20 6f66 2073  Orientation of s
+00011130: 6c69 6365 206f 6e20 7768 6963 6820 746f  lice on which to
+00011140: 2067 6574 2065 7874 656e 742e 204f 6e6c   get extent. Onl
+00011150: 7920 7573 6564 2069 6620 0a20 2020 2020  y used if .     
+00011160: 2020 2020 2020 2073 696e 676c 655f 736c         single_sl
+00011170: 6963 653d 5472 7565 2e20 4966 2075 7369  ice=True. If usi
+00011180: 6e67 2c20 3c61 783e 206d 7573 7420 6265  ng, <ax> must be
+00011190: 2061 6e20 6178 6973 2074 6861 7420 6c69   an axis that li
+000111a0: 6573 2061 6c6f 6e67 0a20 2020 2020 2020  es along.       
+000111b0: 2020 2020 2074 6865 2073 6c69 6365 2069       the slice i
+000111c0: 6e20 7468 6973 206f 7269 656e 7461 7469  n this orientati
+000111d0: 6f6e 2e0a 0a20 2020 2020 2020 2073 6c20  on...        sl 
+000111e0: 3a20 696e 742c 2064 6566 6175 6c74 3d4e  : int, default=N
+000111f0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00011200: 536c 6963 6520 6e75 6d62 6572 2e20 4966  Slice number. If
+00011210: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
+00011220: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
+00011230: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
+00011240: 2020 2020 2020 2020 2020 203c 7369 6e67             <sing
+00011250: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
+00011260: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
+00011270: 6c69 6365 206f 6620 7468 6520 524f 4920  lice of the ROI 
+00011280: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
+00011290: 2020 2020 2020 2069 6478 203a 2069 6e74         idx : int
+000112a0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+000112b0: 2020 2020 2020 2020 2020 2041 7272 6179             Array
+000112c0: 2069 6e64 6578 206f 6620 736c 6963 652e   index of slice.
+000112d0: 2049 6620 6e6f 6e65 206f 6620 3c73 6c3e   If none of <sl>
+000112e0: 2c20 3c69 6478 3e20 6f72 203c 706f 733e  , <idx> or <pos>
+000112f0: 2061 7265 2073 7570 706c 6965 6420 6275   are supplied bu
+00011300: 740a 2020 2020 2020 2020 2020 2020 3c73  t.            <s
+00011310: 696e 676c 655f 736c 6963 653e 2069 7320  ingle_slice> is 
+00011320: 5472 7565 2c20 7468 6520 6365 6e74 7261  True, the centra
+00011330: 6c20 736c 6963 6520 6f66 2074 6865 2052  l slice of the R
+00011340: 4f49 2077 696c 6c20 6265 2075 7365 642e  OI will be used.
+00011350: 0a0a 2020 2020 2020 2020 706f 7320 3a20  ..        pos : 
+00011360: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+00011370: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00011380: 536c 6963 6520 706f 7369 7469 6f6e 2069  Slice position i
+00011390: 6e20 6d6d 2e20 4966 206e 6f6e 6520 6f66  n mm. If none of
+000113a0: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
+000113b0: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
+000113c0: 6564 2062 7574 0a20 2020 2020 2020 2020  ed but.         
+000113d0: 2020 203c 7369 6e67 6c65 5f73 6c69 6365     <single_slice
+000113e0: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
+000113f0: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
+00011400: 7468 6520 524f 4920 7769 6c6c 2062 6520  the ROI will be 
+00011410: 7573 6564 2e0a 0a20 2020 2020 2020 206d  used...        m
+00011420: 6574 686f 6420 3a20 7374 722c 2064 6566  ethod : str, def
+00011430: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+00011440: 2020 2020 2020 4d65 7468 6f64 2074 6f20        Method to 
+00011450: 7573 6520 666f 7220 6578 7465 6e74 2063  use for extent c
+00011460: 616c 6375 6c61 7469 6f6e 2e20 4361 6e20  alculation. Can 
+00011470: 6265 3a20 0a0a 2020 2020 2020 2020 2020  be: ..          
+00011480: 2020 2020 2020 2a20 2263 6f6e 746f 7572        * "contour
+00011490: 223a 2067 6574 2065 7874 656e 7420 6672  ": get extent fr
+000114a0: 6f6d 206d 696e 2f6d 6178 2070 6f73 6974  om min/max posit
+000114b0: 696f 6e73 206f 6620 636f 6e74 6f75 7228  ions of contour(
+000114c0: 7329 2e0a 2020 2020 2020 2020 2020 2020  s)..            
+000114d0: 2020 2020 2a20 226d 6173 6b22 3a20 6765      * "mask": ge
+000114e0: 7420 6578 7465 6e74 2066 726f 6d20 6d69  t extent from mi
+000114f0: 6e2f 6d61 7820 706f 7369 7469 6f6e 7320  n/max positions 
+00011500: 6f66 2076 6f78 656c 7320 696e 2074 6865  of voxels in the
+00011510: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00011520: 2020 2020 6269 6e61 7279 206d 6173 6b2e      binary mask.
+00011530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011540: 202a 204e 6f6e 653a 2075 7365 2074 6865   * None: use the
+00011550: 206d 6574 686f 6420 7365 7420 696e 2073   method set in s
+00011560: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
+00011570: 5f6d 6574 686f 642e 0a0a 2020 2020 2020  _method...      
+00011580: 2020 6f72 6967 696e 203a 2069 6e74 2f66    origin : int/f
+00011590: 6c6f 6174 2f74 7570 6c65 2c20 6465 6661  loat/tuple, defa
+000115a0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+000115b0: 2020 2020 2050 6f69 6e74 2077 6974 6820       Point with 
+000115c0: 7265 7370 6563 7420 746f 2077 6869 6368  respect to which
+000115d0: 2065 7874 656e 7473 2061 7265 2074 6f20   extents are to 
+000115e0: 6265 2064 6574 6572 6d69 6e65 642e 0a20  be determined.. 
+000115f0: 2020 2020 2020 2020 2020 2054 6869 7320             This 
+00011600: 6361 6e20 6265 2061 6e20 696e 7465 6765  can be an intege
+00011610: 7220 6f72 2066 6c6f 6174 2073 7065 6369  r or float speci
+00011620: 6679 696e 6720 7468 6520 706f 696e 7427  fying the point'
+00011630: 730a 2020 2020 2020 2020 2020 2020 636f  s.            co
+00011640: 6f72 6469 6e61 7465 2061 6c6f 6e67 2061  ordinate along a
+00011650: 7869 7320 3c61 783e 3b20 6f72 2069 7420  xis <ax>; or it 
+00011660: 6361 6e20 6265 2061 2074 7570 6c65 2073  can be a tuple s
+00011670: 7065 6369 6679 696e 670a 2020 2020 2020  pecifying.      
+00011680: 2020 2020 2020 7468 6520 706f 696e 7427        the point'
+00011690: 7320 2878 2c20 792c 207a 2920 636f 6f72  s (x, y, z) coor
+000116a0: 6469 6e61 7465 732c 2077 6865 7265 206f  dinates, where o
+000116b0: 6e6c 7920 7468 6520 636f 6f72 6469 6e61  nly the coordina
+000116c0: 7465 0a20 2020 2020 2020 2020 2020 2061  te.            a
+000116d0: 6c6f 6e67 2061 7869 7320 3c61 783e 2077  long axis <ax> w
+000116e0: 696c 6c20 6265 2063 6f6e 7369 6465 7265  ill be considere
+000116f0: 642e 2020 4966 204e 6f6e 652c 2074 6865  d.  If None, the
+00011700: 206f 7269 6769 6e0a 2020 2020 2020 2020   origin.        
+00011710: 2020 2020 636f 6f72 6469 6e61 7465 2069      coordinate i
+00011720: 7320 7461 6b65 6e20 746f 2062 6520 302e  s taken to be 0.
+00011730: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00011740: 2020 2020 2020 2320 4765 7420 6465 6661        # Get defa
+00011750: 756c 7420 736c 6963 6520 616e 6420 6d65  ult slice and me
+00011760: 7468 6f64 0a20 2020 2020 2020 2073 656c  thod.        sel
+00011770: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
+00011780: 2069 6620 6d65 7468 6f64 2069 7320 4e6f   if method is No
+00011790: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000117a0: 6d65 7468 6f64 203d 2073 656c 662e 6465  method = self.de
+000117b0: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
+000117c0: 640a 2020 2020 2020 2020 6966 2073 696e  d.        if sin
+000117d0: 676c 655f 736c 6963 653a 0a20 2020 2020  gle_slice:.     
+000117e0: 2020 2020 2020 2069 6620 6964 7820 6973         if idx is
+000117f0: 204e 6f6e 6520 616e 6420 736c 2069 7320   None and sl is 
+00011800: 4e6f 6e65 2061 6e64 2070 6f73 2069 7320  None and pos is 
+00011810: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00011820: 2020 2020 2020 6964 7820 3d20 7365 6c66        idx = self
+00011830: 2e67 6574 5f6d 6964 5f69 6478 2829 0a0a  .get_mid_idx()..
+00011840: 2020 2020 2020 2020 2320 4966 2075 7369          # If usi
+00011850: 6e67 2073 696e 676c 6520 736c 6963 652c  ng single slice,
+00011860: 2063 6865 636b 2074 6865 2061 7869 7320   check the axis 
+00011870: 6c69 6573 2061 6c6f 6e67 2074 6865 2073  lies along the s
+00011880: 6c69 6365 0a20 2020 2020 2020 2069 5f61  lice.        i_a
+00011890: 7820 3d20 736b 7274 2e69 6d61 6765 2e5f  x = skrt.image._
+000118a0: 6178 6573 2e69 6e64 6578 2861 7829 2069  axes.index(ax) i
+000118b0: 6620 6973 696e 7374 616e 6365 2861 782c  f isinstance(ax,
+000118c0: 2073 7472 2920 656c 7365 2061 780a 2020   str) else ax.  
+000118d0: 2020 2020 2020 6966 2073 696e 676c 655f        if single_
+000118e0: 736c 6963 653a 0a20 2020 2020 2020 2020  slice:.         
+000118f0: 2020 2069 6620 695f 6178 206e 6f74 2069     if i_ax not i
+00011900: 6e20 736b 7274 2e69 6d61 6765 2e5f 706c  n skrt.image._pl
+00011910: 6f74 5f61 7865 735b 7669 6577 5d3a 0a20  ot_axes[view]:. 
+00011920: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00011930: 6169 7365 2052 756e 7469 6d65 4572 726f  aise RuntimeErro
+00011940: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00011950: 2020 2020 2020 2066 2243 616e 6e6f 7420         f"Cannot 
+00011960: 636f 6d70 7574 6520 6578 7465 6e74 206f  compute extent o
+00011970: 6620 6178 6973 207b 6178 7d20 696e 2074  f axis {ax} in t
+00011980: 6865 207b 7669 6577 7d20 706c 616e 6521  he {view} plane!
+00011990: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
+000119a0: 5f61 7820 3d20 736b 7274 2e69 6d61 6765  _ax = skrt.image
+000119b0: 2e5f 706c 6f74 5f61 7865 735b 7669 6577  ._plot_axes[view
+000119c0: 5d2e 696e 6465 7828 695f 6178 290a 0a20  ].index(i_ax).. 
+000119d0: 2020 2020 2020 2023 2045 6e73 7572 6520         # Ensure 
+000119e0: 7468 6174 206f 7269 6769 6e20 6973 2061  that origin is a
+000119f0: 2073 696e 676c 6520 6e75 6d65 7269 6320   single numeric 
+00011a00: 7661 6c75 652e 0a20 2020 2020 2020 206f  value..        o
+00011a10: 7269 6769 6e20 3d20 6f72 6967 696e 206f  rigin = origin o
+00011a20: 7220 300a 2020 2020 2020 2020 6966 206e  r 0.        if n
+00011a30: 6f74 2069 7369 6e73 7461 6e63 6528 6f72  ot isinstance(or
+00011a40: 6967 696e 2c20 2866 6c6f 6174 2c20 696e  igin, (float, in
+00011a50: 7429 293a 0a20 2020 2020 2020 2020 2020  t)):.           
+00011a60: 206f 7269 6769 6e20 3d20 6f72 6967 696e   origin = origin
+00011a70: 5b69 5f61 785d 0a0a 2020 2020 2020 2020  [i_ax]..        
+00011a80: 2320 4361 6c63 756c 6174 6520 6578 7465  # Calculate exte
+00011a90: 6e74 2066 726f 6d20 636f 6e74 6f75 7273  nt from contours
+00011aa0: 0a20 2020 2020 2020 2069 6620 6d65 7468  .        if meth
+00011ab0: 6f64 203d 3d20 2263 6f6e 746f 7572 223a  od == "contour":
+00011ac0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00011ad0: 4361 6c63 756c 6174 6520 6675 6c6c 207a  Calculate full z
+00011ae0: 2065 7874 656e 7420 6672 6f6d 2063 6f6e   extent from con
+00011af0: 746f 7572 2070 6f73 6974 696f 6e73 0a20  tour positions. 
+00011b00: 2020 2020 2020 2020 2020 2069 6620 2861             if (a
+00011b10: 7820 3d3d 2022 7a22 206f 7220 6178 203d  x == "z" or ax =
+00011b20: 3d20 3229 2061 6e64 206e 6f74 2073 696e  = 2) and not sin
+00011b30: 676c 655f 736c 6963 653a 0a20 2020 2020  gle_slice:.     
+00011b40: 2020 2020 2020 2020 2020 207a 5f6b 6579             z_key
+00011b50: 7320 3d20 6c69 7374 2873 656c 662e 6765  s = list(self.ge
+00011b60: 745f 636f 6e74 6f75 7273 2822 782d 7922  t_contours("x-y"
+00011b70: 292e 6b65 7973 2829 290a 2020 2020 2020  ).keys()).      
+00011b80: 2020 2020 2020 2020 2020 767a 203d 2073            vz = s
+00011b90: 656c 662e 6765 745f 736c 6963 655f 7468  elf.get_slice_th
+00011ba0: 6963 6b6e 6573 735f 636f 6e74 6f75 7273  ickness_contours
+00011bb0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00011bc0: 2020 2069 6620 7a5f 6b65 7973 3a0a 2020     if z_keys:.  
+00011bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011be0: 2020 7a5f 6d61 7820 3d20 6d61 7828 7a5f    z_max = max(z_
+00011bf0: 6b65 7973 2920 2b20 2076 7a20 2f20 320a  keys) +  vz / 2.
 00011c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c10: 2020 207a 5f6d 696e 203d 204e 6f6e 650a     z_min = None.
-00011c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c30: 2020 2020 7a5f 6d61 7820 3d20 4e6f 6e65      z_max = None
-00011c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011c50: 2072 6574 7572 6e20 5b7a 5f6d 696e 2c20   return [z_min, 
-00011c60: 7a5f 6d61 785d 0a0a 2020 2020 2020 2020  z_max]..        
-00011c70: 2020 2020 2320 4f74 6865 7277 6973 652c      # Otherwise,
-00011c80: 2063 616c 6375 6c61 7465 2065 7874 656e   calculate exten
-00011c90: 7420 6672 6f6d 206d 696e 2f6d 6178 2063  t from min/max c
-00011ca0: 6f6e 746f 7572 2070 6f73 6974 696f 6e73  ontour positions
-00011cb0: 200a 2020 2020 2020 2020 2020 2020 706f   .            po
-00011cc0: 696e 7473 203d 205b 5d0a 0a20 2020 2020  ints = []..     
-00011cd0: 2020 2020 2020 2023 2047 6c6f 6261 6c3a         # Global:
-00011ce0: 2075 7365 2065 7665 7279 2063 6f6e 746f   use every conto
-00011cf0: 7572 0a20 2020 2020 2020 2020 2020 2069  ur.            i
-00011d00: 6620 6e6f 7420 7369 6e67 6c65 5f73 6c69  f not single_sli
-00011d10: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-00011d20: 2020 2020 666f 7220 692c 2063 6f6e 746f      for i, conto
-00011d30: 7572 7320 696e 2073 656c 662e 6765 745f  urs in self.get_
-00011d40: 636f 6e74 6f75 7273 2822 782d 7922 292e  contours("x-y").
-00011d50: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-00011d60: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00011d70: 2063 6f6e 746f 7572 2069 6e20 636f 6e74   contour in cont
-00011d80: 6f75 7273 3a0a 2020 2020 2020 2020 2020  ours:.          
-00011d90: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00011da0: 696e 7473 2e65 7874 656e 6428 5b70 5b69  ints.extend([p[i
-00011db0: 5f61 785d 2066 6f72 2070 2069 6e20 636f  _ax] for p in co
-00011dc0: 6e74 6f75 725d 290a 0a20 2020 2020 2020  ntour])..       
-00011dd0: 2020 2020 2023 2053 696e 676c 6520 736c       # Single sl
-00011de0: 6963 653a 206a 7573 7420 7573 6520 7468  ice: just use th
-00011df0: 6520 636f 6e74 6f75 7220 6f6e 2074 6865  e contour on the
-00011e00: 2073 6c69 6365 0a20 2020 2020 2020 2020   slice.         
-00011e10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00011e20: 2020 2020 2020 2020 2066 6f72 2063 6f6e           for con
-00011e30: 746f 7572 2069 6e20 7365 6c66 2e67 6574  tour in self.get
-00011e40: 5f63 6f6e 746f 7572 735f 6f6e 5f73 6c69  _contours_on_sli
-00011e50: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
-00011e60: 2020 2020 2020 2020 7669 6577 2c20 736c          view, sl
-00011e70: 3d73 6c2c 2069 6478 3d69 6478 2c20 706f  =sl, idx=idx, po
-00011e80: 733d 706f 7329 3a0a 2020 2020 2020 2020  s=pos):.        
-00011e90: 2020 2020 2020 2020 2020 2020 706f 696e              poin
-00011ea0: 7473 2e65 7874 656e 6428 5b70 5b69 5f61  ts.extend([p[i_a
-00011eb0: 785d 2066 6f72 2070 2069 6e20 636f 6e74  x] for p in cont
-00011ec0: 6f75 725d 290a 0a20 2020 2020 2020 2020  our])..         
-00011ed0: 2020 2023 2052 6574 7572 6e20 6d69 6e20     # Return min 
-00011ee0: 616e 6420 6d61 7820 6f66 2074 6865 2070  and max of the p
-00011ef0: 6f69 6e74 7320 696e 2074 6865 2063 6f6e  oints in the con
-00011f00: 746f 7572 2873 290a 2020 2020 2020 2020  tour(s).        
-00011f10: 2020 2020 6966 206c 656e 2870 6f69 6e74      if len(point
-00011f20: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00011f30: 2020 2020 7265 7475 726e 205b 6d69 6e28      return [min(
-00011f40: 706f 696e 7473 2920 2d20 6f72 6967 696e  points) - origin
-00011f50: 2c20 6d61 7828 706f 696e 7473 2920 2d20  , max(points) - 
-00011f60: 6f72 6967 696e 5d0a 2020 2020 2020 2020  origin].        
-00011f70: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00011f80: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00011f90: 205b 4e6f 6e65 2c20 4e6f 6e65 5d0a 0a20   [None, None].. 
-00011fa0: 2020 2020 2020 2023 204f 7468 6572 7769         # Otherwi
-00011fb0: 7365 2c20 6765 7420 6578 7465 6e74 2066  se, get extent f
-00011fc0: 726f 6d20 6d61 736b 0a20 2020 2020 2020  rom mask.       
-00011fd0: 2073 656c 662e 6372 6561 7465 5f6d 6173   self.create_mas
-00011fe0: 6b28 290a 2020 2020 2020 2020 6966 2069  k().        if i
-00011ff0: 5f61 7820 213d 2032 3a20 2023 2054 7261  _ax != 2:  # Tra
-00012000: 6e73 706f 7365 2078 2d79 2061 7865 730a  nspose x-y axes.
-00012010: 2020 2020 2020 2020 2020 2020 695f 6178              i_ax
-00012020: 203d 2031 202d 2069 5f61 780a 0a20 2020   = 1 - i_ax..   
-00012030: 2020 2020 2023 2047 6574 2070 6f73 6974       # Get posit
-00012040: 696f 6e73 206f 6620 766f 7865 6c73 2069  ions of voxels i
-00012050: 6e73 6964 6520 7468 6520 6d61 736b 0a20  nside the mask. 
-00012060: 2020 2020 2020 2069 6620 6e6f 7420 7369         if not si
-00012070: 6e67 6c65 5f73 6c69 6365 3a0a 2020 2020  ngle_slice:.    
-00012080: 2020 2020 2020 2020 6e6f 6e7a 6572 6f20          nonzero 
-00012090: 3d20 6e70 2e61 7267 7768 6572 6528 7365  = np.argwhere(se
-000120a0: 6c66 2e67 6574 5f6d 6173 6b28 7374 616e  lf.get_mask(stan
-000120b0: 6461 7264 6973 653d 5472 7565 2929 0a20  dardise=True)). 
-000120c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000120d0: 2020 2020 2020 2020 206e 6f6e 7a65 726f           nonzero
-000120e0: 203d 206e 702e 6172 6777 6865 7265 2873   = np.argwhere(s
-000120f0: 656c 662e 6765 745f 736c 6963 6528 0a20  elf.get_slice(. 
-00012100: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00012110: 6965 772c 2073 6c3d 736c 2c20 6964 783d  iew, sl=sl, idx=
-00012120: 6964 782c 2070 6f73 3d70 6f73 2929 0a20  idx, pos=pos)). 
-00012130: 2020 2020 2020 2076 616c 7320 3d20 6e6f         vals = no
-00012140: 6e7a 6572 6f5b 3a2c 2069 5f61 785d 0a20  nzero[:, i_ax]. 
-00012150: 2020 2020 2020 2069 6620 6e6f 7420 6c65         if not le
-00012160: 6e28 7661 6c73 293a 0a20 2020 2020 2020  n(vals):.       
-00012170: 2020 2020 2072 6574 7572 6e20 5b4e 6f6e       return [Non
-00012180: 652c 204e 6f6e 655d 0a0a 2020 2020 2020  e, None]..      
-00012190: 2020 2320 4669 6e64 206d 696e 2061 6e64    # Find min and
-000121a0: 206d 6178 2076 6f78 656c 733b 2061 6464   max voxels; add
-000121b0: 2068 616c 6620 6120 766f 7865 6c20 6569   half a voxel ei
-000121c0: 7468 6572 2073 6964 6520 746f 2067 6574  ther side to get
-000121d0: 200a 2020 2020 2020 2020 2320 6675 6c6c   .        # full
-000121e0: 2065 7874 656e 740a 2020 2020 2020 2020   extent.        
-000121f0: 6d69 6e5f 706f 7320 3d20 6d69 6e28 7661  min_pos = min(va
-00012200: 6c73 2920 2d20 302e 350a 2020 2020 2020  ls) - 0.5.      
-00012210: 2020 6d61 785f 706f 7320 3d20 6d61 7828    max_pos = max(
-00012220: 7661 6c73 2920 2b20 302e 350a 0a20 2020  vals) + 0.5..   
-00012230: 2020 2020 2023 2043 6f6e 7665 7274 2070       # Convert p
-00012240: 6f73 6974 696f 6e73 2074 6f20 6d6d 0a20  ositions to mm. 
-00012250: 2020 2020 2020 2072 6574 7572 6e20 5b73         return [s
-00012260: 656c 662e 6964 785f 746f 5f70 6f73 286d  elf.idx_to_pos(m
-00012270: 696e 5f70 6f73 2c20 6178 2920 2d20 6f72  in_pos, ax) - or
-00012280: 6967 696e 2c0a 2020 2020 2020 2020 2020  igin,.          
-00012290: 2020 2020 2020 7365 6c66 2e69 6478 5f74        self.idx_t
-000122a0: 6f5f 706f 7328 6d61 785f 706f 732c 2061  o_pos(max_pos, a
-000122b0: 7829 202d 206f 7269 6769 6e5d 0a0a 2020  x) - origin]..  
-000122c0: 2020 6465 6620 6765 745f 6372 6f70 5f6c    def get_crop_l
-000122d0: 696d 6974 7328 7365 6c66 2c20 6372 6f70  imits(self, crop
-000122e0: 5f6d 6172 6769 6e73 3d4e 6f6e 652c 206d  _margins=None, m
-000122f0: 6574 686f 643d 4e6f 6e65 293a 0a20 2020  ethod=None):.   
-00012300: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00012310: 2047 6574 2063 726f 7020 6c69 6d69 7473   Get crop limits
-00012320: 2063 6f72 7265 7370 6f6e 6469 6e67 2074   corresponding t
-00012330: 6f20 524f 4920 6578 7465 6e74 7320 706c  o ROI extents pl
-00012340: 7573 206d 6172 6769 6e73 2e0a 0a20 2020  us margins...   
-00012350: 2020 2020 2054 6865 2074 7570 6c65 7320       The tuples 
-00012360: 6f66 206c 696d 6974 7320 7265 7475 726e  of limits return
-00012370: 6564 2c20 696e 2074 6865 206f 7264 6572  ed, in the order
-00012380: 2028 782c 2079 2c20 7a29 2063 616e 0a20   (x, y, z) can. 
-00012390: 2020 2020 2020 2062 6520 7573 6564 2c20         be used, 
-000123a0: 666f 7220 6578 616d 706c 652c 2061 7320  for example, as 
-000123b0: 696e 7075 7473 2074 6f20 736b 7274 2e69  inputs to skrt.i
-000123c0: 6d61 6765 2e49 6d61 6765 2e63 726f 7028  mage.Image.crop(
-000123d0: 292e 0a0a 2020 2020 2020 2020 5468 6973  )...        This
-000123e0: 206d 6574 686f 6420 6973 2073 696d 696c   method is simil
-000123f0: 6172 2074 6f20 7468 6520 6d65 7468 6f64  ar to the method
-00012400: 2067 6574 5f65 7874 656e 7473 2829 2c20   get_extents(), 
-00012410: 6275 7420 616c 6c6f 7773 0a20 2020 2020  but allows.     
-00012420: 2020 2064 6966 6665 7265 6e74 206d 6172     different mar
-00012430: 6769 6e73 206f 6e20 6561 6368 2073 6964  gins on each sid
-00012440: 6520 6f66 2074 6865 2052 4f49 2e0a 0a20  e of the ROI... 
-00012450: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
-00012460: 6572 733a 2a2a 0a0a 2020 2020 2020 2020  ers:**..        
-00012470: 6372 6f70 5f6d 6172 6769 6e73 203a 2066  crop_margins : f
-00012480: 6c6f 6174 2f74 7570 6c65 2c20 6465 6661  loat/tuple, defa
-00012490: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-000124a0: 2020 2020 2046 6c6f 6174 206f 7220 7468       Float or th
-000124b0: 7265 652d 656c 656d 656e 7420 7475 706c  ree-element tupl
-000124c0: 6520 7370 6563 6966 7969 6e67 2074 6865  e specifying the
-000124d0: 206d 6172 6769 6e73 2c20 696e 206d 6d2c   margins, in mm,
-000124e0: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
-000124f0: 6265 2061 6464 6564 2074 6f20 524f 4920  be added to ROI 
-00012500: 6578 7465 6e74 732e 2020 4966 2061 2066  extents.  If a f
-00012510: 6c6f 6174 2c20 6d69 6e75 7320 616e 6420  loat, minus and 
-00012520: 706c 7573 2074 6865 0a20 2020 2020 2020  plus the.       
-00012530: 2020 2020 2076 616c 7565 2073 7065 6369       value speci
-00012540: 6669 6564 2061 7265 2061 6464 6564 2074  fied are added t
-00012550: 6f20 6c6f 7765 7220 616e 6420 7570 7065  o lower and uppe
-00012560: 7220 6578 7465 6e74 7320 7265 7370 6563  r extents respec
-00012570: 7469 7665 6c79 0a20 2020 2020 2020 2020  tively.         
-00012580: 2020 2061 6c6f 6e67 2065 6163 6820 6178     along each ax
-00012590: 6973 2e20 2049 6620 6120 7468 7265 652d  is.  If a three-
-000125a0: 656c 656d 656e 7420 7475 706c 652c 2065  element tuple, e
-000125b0: 6c65 6d65 6e74 7320 6172 650a 2020 2020  lements are.    
-000125c0: 2020 2020 2020 2020 7461 6b65 6e20 746f          taken to
-000125d0: 2073 7065 6369 6679 206d 6172 6769 6e73   specify margins
-000125e0: 2069 6e20 7468 6520 6f72 6465 7220 2878   in the order (x
-000125f0: 2c20 792c 207a 292e 2020 456c 656d 656e  , y, z).  Elemen
-00012600: 7473 0a20 2020 2020 2020 2020 2020 2063  ts.            c
-00012610: 616e 2062 6520 6569 7468 6572 2066 6c6f  an be either flo
-00012620: 6174 7320 286d 696e 7573 2061 6e64 2070  ats (minus and p
-00012630: 6c75 7320 7468 6520 7661 6c75 6520 6164  lus the value ad
-00012640: 6465 6420 7265 7370 6563 7469 7665 6c79  ded respectively
-00012650: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
-00012660: 6c6f 7765 7220 616e 6420 7570 7065 7220  lower and upper 
-00012670: 6578 7465 6e74 7329 206f 7220 7477 6f2d  extents) or two-
-00012680: 656c 656d 656e 7420 7475 706c 6573 2028  element tuples (
-00012690: 656c 656d 656e 7473 2030 2061 6e64 2031  elements 0 and 1
-000126a0: 0a20 2020 2020 2020 2020 2020 2061 6464  .            add
-000126b0: 6564 2072 6573 7065 6374 6976 656c 7920  ed respectively 
-000126c0: 746f 206c 6f77 6572 2061 6e64 2075 7070  to lower and upp
-000126d0: 6572 2065 7874 656e 7473 292e 0a0a 2020  er extents)...  
-000126e0: 2020 2020 2020 6d65 7468 6f64 203a 2073        method : s
-000126f0: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
-00012700: 0a20 2020 2020 2020 2020 2020 204d 6574  .            Met
-00012710: 686f 6420 746f 2075 7365 2066 6f72 2065  hod to use for e
-00012720: 7874 656e 7420 6361 6c63 756c 6174 696f  xtent calculatio
-00012730: 6e2e 2043 616e 2062 653a 0a0a 2020 2020  n. Can be:..    
-00012740: 2020 2020 2020 2020 2020 2020 2a20 2263              * "c
-00012750: 6f6e 746f 7572 223a 2067 6574 2065 7874  ontour": get ext
-00012760: 656e 7420 6672 6f6d 206d 696e 2f6d 6178  ent from min/max
-00012770: 2070 6f73 6974 696f 6e73 206f 6620 636f   positions of co
-00012780: 6e74 6f75 7228 7329 2e0a 2020 2020 2020  ntour(s)..      
-00012790: 2020 2020 2020 2020 2020 2a20 226d 6173            * "mas
-000127a0: 6b22 3a20 6765 7420 6578 7465 6e74 2066  k": get extent f
-000127b0: 726f 6d20 6d69 6e2f 6d61 7820 706f 7369  rom min/max posi
-000127c0: 7469 6f6e 7320 6f66 2076 6f78 656c 7320  tions of voxels 
-000127d0: 696e 2074 6865 0a20 2020 2020 2020 2020  in the.         
-000127e0: 2020 2020 2020 2020 2062 696e 6172 7920           binary 
-000127f0: 6d61 736b 2e0a 2020 2020 2020 2020 2020  mask..          
-00012800: 2020 2020 2020 2a20 4e6f 6e65 3a20 7573        * None: us
-00012810: 6520 7468 6520 6d65 7468 6f64 2073 6574  e the method set
-00012820: 2069 6e20 7365 6c66 2e64 6566 6175 6c74   in self.default
-00012830: 5f67 656f 6d5f 6d65 7468 6f64 2e0a 2020  _geom_method..  
-00012840: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00012850: 2020 6372 6f70 5f6c 696d 6974 7320 3d20    crop_limits = 
-00012860: 7365 6c66 2e67 6574 5f65 7874 656e 7473  self.get_extents
-00012870: 286d 6574 686f 643d 6d65 7468 6f64 290a  (method=method).
-00012880: 2020 2020 2020 2020 6d61 7267 696e 7320          margins 
-00012890: 3d20 736b 7274 2e69 6d61 6765 2e63 6865  = skrt.image.che
-000128a0: 636b 6564 5f63 726f 705f 6c69 6d69 7473  cked_crop_limits
-000128b0: 2863 726f 705f 6d61 7267 696e 7329 0a20  (crop_margins). 
-000128c0: 2020 2020 2020 2066 6f72 2069 6478 3120         for idx1 
-000128d0: 696e 2072 616e 6765 2833 293a 0a20 2020  in range(3):.   
-000128e0: 2020 2020 2020 2020 2069 6620 6d61 7267           if marg
-000128f0: 696e 735b 6964 7831 5d20 6973 206e 6f74  ins[idx1] is not
-00012900: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00012910: 2020 2020 2020 2066 6f72 2069 6478 3220         for idx2 
-00012920: 696e 2072 616e 6765 2832 293a 0a20 2020  in range(2):.   
-00012930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012940: 2063 726f 705f 6c69 6d69 7473 5b69 6478   crop_limits[idx
-00012950: 315d 5b69 6478 325d 202b 3d20 6d61 7267  1][idx2] += marg
-00012960: 696e 735b 6964 7831 5d5b 6964 7832 5d0a  ins[idx1][idx2].
-00012970: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00012980: 6372 6f70 5f6c 696d 6974 730a 0a20 2020  crop_limits..   
-00012990: 2064 6566 2067 6574 5f6c 656e 6774 6828   def get_length(
-000129a0: 0a20 2020 2020 2020 2073 656c 662c 200a  .        self, .
-000129b0: 2020 2020 2020 2020 6178 3d22 7a22 2c20          ax="z", 
-000129c0: 0a20 2020 2020 2020 2073 696e 676c 655f  .        single_
-000129d0: 736c 6963 653d 4661 6c73 652c 0a20 2020  slice=False,.   
-000129e0: 2020 2020 2076 6965 773d 2278 2d79 222c       view="x-y",
-000129f0: 0a20 2020 2020 2020 2073 6c3d 4e6f 6e65  .        sl=None
-00012a00: 2c20 0a20 2020 2020 2020 2069 6478 3d4e  , .        idx=N
-00012a10: 6f6e 652c 200a 2020 2020 2020 2020 706f  one, .        po
-00012a20: 733d 4e6f 6e65 2c20 0a20 2020 2020 2020  s=None, .       
-00012a30: 2075 6e69 7473 3d22 6d6d 222c 0a20 2020   units="mm",.   
-00012a40: 2020 2020 206d 6574 686f 643d 4e6f 6e65       method=None
-00012a50: 2c20 0a20 2020 2020 2020 2066 6f72 6365  , .        force
-00012a60: 3d54 7275 650a 2020 2020 293a 0a20 2020  =True.    ):.   
-00012a70: 2020 2020 2022 2222 4765 7420 524f 4920       """Get ROI 
-00012a80: 6c65 6e67 7468 2061 6c6f 6e67 2061 2067  length along a g
-00012a90: 6976 656e 2061 7869 732e 2049 6620 7369  iven axis. If si
-00012aa0: 6e67 6c65 5f73 6c69 6365 3d46 616c 7365  ngle_slice=False
-00012ab0: 2028 692e 652e 2061 200a 2020 2020 2020   (i.e. a .      
-00012ac0: 2020 676c 6f62 616c 206c 656e 6774 6820    global length 
-00012ad0: 6973 2072 6571 7565 7374 6564 292c 2063  is requested), c
-00012ae0: 616c 6375 6c61 7465 6420 6c65 6e67 7468  alculated length
-00012af0: 2077 696c 6c20 6265 2063 6163 6865 6420   will be cached 
-00012b00: 696e 200a 2020 2020 2020 2020 7365 6c66  in .        self
-00012b10: 2e5f 6c65 6e67 7468 5b61 785d 5b75 6e69  ._length[ax][uni
-00012b20: 7473 5d20 616e 6420 7265 7475 726e 6564  ts] and returned
-00012b30: 2069 6620 6361 6c6c 6564 2061 6761 696e   if called again
-00012b40: 2c20 756e 6c65 7373 2066 6f72 6365 3d54  , unless force=T
-00012b50: 7275 652e 0a0a 2020 2020 2020 2020 2a2a  rue...        **
-00012b60: 5061 7261 6d65 7465 7273 3a2a 2a0a 2020  Parameters:**.  
-00012b70: 2020 2020 2020 0a20 2020 2020 2020 2061        .        a
-00012b80: 7820 3a20 7374 722f 696e 742c 2064 6566  x : str/int, def
-00012b90: 6175 6c74 3d22 7a22 0a20 2020 2020 2020  ault="z".       
-00012ba0: 2020 2020 2041 7869 7320 616c 6f6e 6720       Axis along 
-00012bb0: 7768 6963 6820 746f 2072 6574 7572 6e20  which to return 
-00012bc0: 6c65 6e67 7468 3b20 7368 6f75 6c64 2062  length; should b
-00012bd0: 6520 6f6e 6520 6f66 205b 2278 222c 2022  e one of ["x", "
-00012be0: 7922 2c20 227a 225d 0a20 2020 2020 2020  y", "z"].       
-00012bf0: 2020 2020 206f 7220 5b30 2c20 312c 2032       or [0, 1, 2
-00012c00: 5d2e 0a0a 2020 2020 2020 2020 7369 6e67  ]...        sing
-00012c10: 6c65 5f73 6c69 6365 203a 2062 6f6f 6c2c  le_slice : bool,
-00012c20: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
-00012c30: 2020 2020 2020 2020 2020 2049 6620 4661             If Fa
-00012c40: 6c73 652c 2074 6865 206c 656e 6774 6820  lse, the length 
-00012c50: 6f66 2074 6865 2065 6e74 6972 6520 524f  of the entire RO
-00012c60: 4920 7769 6c6c 2062 6520 7265 7475 726e  I will be return
-00012c70: 6564 3b0a 2020 2020 2020 2020 2020 2020  ed;.            
-00012c80: 6f74 6865 7277 6973 652c 2074 6865 206c  otherwise, the l
-00012c90: 656e 6774 6820 6f6e 2061 2073 696e 676c  ength on a singl
-00012ca0: 6520 736c 6963 6520 7769 6c6c 2062 6520  e slice will be 
-00012cb0: 7265 7475 726e 6564 2e0a 0a20 2020 2020  returned...     
-00012cc0: 2020 2076 6965 7720 3a20 7374 722c 2064     view : str, d
-00012cd0: 6566 6175 6c74 3d22 782d 7922 0a20 2020  efault="x-y".   
-00012ce0: 2020 2020 2020 2020 204f 7269 656e 7461           Orienta
-00012cf0: 7469 6f6e 206f 6620 736c 6963 6520 6f6e  tion of slice on
-00012d00: 2077 6869 6368 2074 6f20 6765 7420 6c65   which to get le
-00012d10: 6e67 7468 2e20 4f6e 6c79 2075 7365 6420  ngth. Only used 
-00012d20: 6966 200a 2020 2020 2020 2020 2020 2020  if .            
-00012d30: 7369 6e67 6c65 5f73 6c69 6365 3d54 7275  single_slice=Tru
-00012d40: 652e 2049 6620 7573 696e 672c 203c 6178  e. If using, <ax
-00012d50: 3e20 6d75 7374 2062 6520 616e 2061 7869  > must be an axi
-00012d60: 7320 7468 6174 206c 6965 7320 616c 6f6e  s that lies alon
-00012d70: 670a 2020 2020 2020 2020 2020 2020 7468  g.            th
-00012d80: 6520 736c 6963 6520 696e 2074 6869 7320  e slice in this 
-00012d90: 6f72 6965 6e74 6174 696f 6e2e 0a0a 2020  orientation...  
-00012da0: 2020 2020 2020 736c 203a 2069 6e74 2c20        sl : int, 
-00012db0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-00012dc0: 2020 2020 2020 2020 2053 6c69 6365 206e           Slice n
-00012dd0: 756d 6265 722e 2049 6620 6e6f 6e65 206f  umber. If none o
-00012de0: 6620 3c73 6c3e 2c20 3c69 6478 3e20 6f72  f <sl>, <idx> or
-00012df0: 203c 706f 733e 2061 7265 2073 7570 706c   <pos> are suppl
-00012e00: 6965 6420 6275 740a 2020 2020 2020 2020  ied but.        
-00012e10: 2020 2020 3c73 696e 676c 655f 736c 6963      <single_slic
-00012e20: 653e 2069 7320 5472 7565 2c20 7468 6520  e> is True, the 
-00012e30: 6365 6e74 7261 6c20 736c 6963 6520 6f66  central slice of
-00012e40: 2074 6865 2052 4f49 2077 696c 6c20 6265   the ROI will be
-00012e50: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
-00012e60: 6964 7820 3a20 696e 742c 2064 6566 6175  idx : int, defau
-00012e70: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00012e80: 2020 2020 4172 7261 7920 696e 6465 7820      Array index 
-00012e90: 6f66 2073 6c69 6365 2e20 4966 206e 6f6e  of slice. If non
-00012ea0: 6520 6f66 203c 736c 3e2c 203c 6964 783e  e of <sl>, <idx>
-00012eb0: 206f 7220 3c70 6f73 3e20 6172 6520 7375   or <pos> are su
-00012ec0: 7070 6c69 6564 2062 7574 0a20 2020 2020  pplied but.     
-00012ed0: 2020 2020 2020 203c 7369 6e67 6c65 5f73         <single_s
-00012ee0: 6c69 6365 3e20 6973 2054 7275 652c 2074  lice> is True, t
-00012ef0: 6865 2063 656e 7472 616c 2073 6c69 6365  he central slice
-00012f00: 206f 6620 7468 6520 524f 4920 7769 6c6c   of the ROI will
-00012f10: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
-00012f20: 2020 2070 6f73 203a 2066 6c6f 6174 2c20     pos : float, 
-00012f30: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-00012f40: 2020 2020 2020 2020 2053 6c69 6365 2070           Slice p
-00012f50: 6f73 6974 696f 6e20 696e 206d 6d2e 2049  osition in mm. I
-00012f60: 6620 6e6f 6e65 206f 6620 3c73 6c3e 2c20  f none of <sl>, 
-00012f70: 3c69 6478 3e20 6f72 203c 706f 733e 2061  <idx> or <pos> a
-00012f80: 7265 2073 7570 706c 6965 6420 6275 740a  re supplied but.
-00012f90: 2020 2020 2020 2020 2020 2020 3c73 696e              <sin
-00012fa0: 676c 655f 736c 6963 653e 2069 7320 5472  gle_slice> is Tr
-00012fb0: 7565 2c20 7468 6520 6365 6e74 7261 6c20  ue, the central 
-00012fc0: 736c 6963 6520 6f66 2074 6865 2052 4f49  slice of the ROI
-00012fd0: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
-00012fe0: 2020 2020 2020 2020 756e 6974 7320 3a20          units : 
-00012ff0: 7374 722c 2064 6566 6175 6c74 3d22 6d6d  str, default="mm
-00013000: 220a 2020 2020 2020 2020 2020 2020 556e  ".            Un
-00013010: 6974 7320 6f66 206c 656e 6774 682e 2043  its of length. C
-00013020: 616e 2062 6520 6569 7468 6572 206f 663a  an be either of:
-00013030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013040: 202d 2022 6d6d 223a 2072 6574 7572 6e20   - "mm": return 
-00013050: 6c65 6e67 7468 2069 6e20 6d69 6c6c 696d  length in millim
-00013060: 6574 7265 732e 0a20 2020 2020 2020 2020  etres..         
-00013070: 2020 2020 2020 202d 2022 766f 7865 6c73         - "voxels
-00013080: 223a 2072 6574 7572 6e20 6c65 6e67 7468  ": return length
-00013090: 2069 6e20 6e75 6d62 6572 206f 6620 766f   in number of vo
-000130a0: 7865 6c73 2e0a 0a20 2020 2020 2020 2020  xels...         
-000130b0: 2020 2049 6620 756e 6974 733d 2276 6f78     If units="vox
-000130c0: 656c 7322 2069 7320 7265 7175 6573 7465  els" is requeste
-000130d0: 6420 6275 7420 7468 6973 2052 4f49 206f  d but this ROI o
-000130e0: 6e6c 7920 6861 7320 636f 6e74 6f75 7273  nly has contours
-000130f0: 2061 6e64 206e 6f0a 2020 2020 2020 2020   and no.        
-00013100: 2020 2020 766f 7865 6c20 7369 7a65 2069      voxel size i
-00013110: 6e66 6f72 6d61 7469 6f6e 2c20 616e 2065  nformation, an e
-00013120: 7272 6f72 2077 696c 6c20 6265 2072 6169  rror will be rai
-00013130: 7365 6420 2875 6e6c 6573 7320 6178 3d22  sed (unless ax="
-00013140: 7a22 2c20 0a20 2020 2020 2020 2020 2020  z", .           
-00013150: 2069 6e20 7768 6963 6820 6361 7365 2076   in which case v
-00013160: 6f78 656c 2073 697a 6520 7769 6c6c 2062  oxel size will b
-00013170: 6520 696e 6665 7272 6564 2066 726f 6d20  e inferred from 
-00013180: 7370 6163 696e 6720 6265 7477 6565 6e0a  spacing between.
-00013190: 2020 2020 2020 2020 2020 2020 736c 6963              slic
-000131a0: 6573 292e 0a0a 2020 2020 2020 2020 6d65  es)...        me
-000131b0: 7468 6f64 203a 2073 7472 2c20 6465 6661  thod : str, defa
-000131c0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-000131d0: 2020 2020 204d 6574 686f 6420 746f 2075       Method to u
-000131e0: 7365 2066 6f72 206c 656e 6774 6820 6361  se for length ca
-000131f0: 6c63 756c 6174 696f 6e2e 2043 616e 2062  lculation. Can b
-00013200: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
-00013210: 2020 2020 2d20 2263 6f6e 746f 7572 223a      - "contour":
-00013220: 2067 6574 206c 656e 6774 6820 6672 6f6d   get length from
-00013230: 206d 696e 2f6d 6178 2070 6f73 6974 696f   min/max positio
-00013240: 6e73 206f 6620 636f 6e74 6f75 7228 7329  ns of contour(s)
-00013250: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013260: 2020 2d20 226d 6173 6b22 3a20 6765 7420    - "mask": get 
-00013270: 6c65 6e67 7468 2066 726f 6d20 6d69 6e2f  length from min/
-00013280: 6d61 7820 706f 7369 7469 6f6e 7320 6f66  max positions of
-00013290: 2076 6f78 656c 7320 696e 2074 6865 200a   voxels in the .
-000132a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132b0: 2020 6269 6e61 7279 206d 6173 6b2e 0a20    binary mask.. 
-000132c0: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-000132d0: 204e 6f6e 653a 2075 7365 2074 6865 206d   None: use the m
-000132e0: 6574 686f 6420 7365 7420 696e 2073 656c  ethod set in sel
-000132f0: 662e 6465 6661 756c 745f 6765 6f6d 5f6d  f.default_geom_m
-00013300: 6574 686f 642e 0a0a 2020 2020 2020 2020  ethod...        
-00013310: 666f 7263 6520 3a20 626f 6f6c 2c20 6465  force : bool, de
-00013320: 6661 756c 743d 5472 7565 0a20 2020 2020  fault=True.     
-00013330: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-00013340: 7468 6520 6c65 6e67 7468 2077 696c 6c20  the length will 
-00013350: 616c 7761 7973 2062 6520 7265 6361 6c63  always be recalc
-00013360: 756c 6174 6564 3b20 6f74 6865 7277 6973  ulated; otherwis
-00013370: 652c 2069 7420 7769 6c6c 0a20 2020 2020  e, it will.     
-00013380: 2020 2020 2020 206f 6e6c 7920 6265 2063         only be c
-00013390: 616c 6375 6c61 7465 6420 6966 2069 7420  alculated if it 
-000133a0: 6861 7320 6e6f 7420 7965 7420 6265 656e  has not yet been
-000133b0: 2063 6163 6865 6420 696e 2073 656c 662e   cached in self.
-000133c0: 5f76 6f6c 756d 652e 0a20 2020 2020 2020  _volume..       
-000133d0: 2020 2020 204e 6f74 6520 7468 6174 2069       Note that i
-000133e0: 6620 7369 6e67 6c65 5f73 6c69 6365 3d54  f single_slice=T
-000133f0: 7275 652c 2074 6865 206c 656e 6774 6820  rue, the length 
-00013400: 7769 6c6c 2061 6c77 6179 7320 6265 200a  will always be .
-00013410: 2020 2020 2020 2020 2020 2020 7265 6361              reca
-00013420: 6c63 756c 6174 6564 2e0a 2020 2020 2020  lculated..      
-00013430: 2020 2222 220a 0a20 2020 2020 2020 2023    """..        #
-00013440: 2049 6620 676c 6f62 616c 206c 656e 6774   If global lengt
-00013450: 6820 616c 7265 6164 7920 6361 6368 6564  h already cached
-00013460: 2c20 7265 7475 726e 2063 6163 6865 6420  , return cached 
-00013470: 7661 6c75 650a 2020 2020 2020 2020 6966  value.        if
-00013480: 206e 6f74 2073 696e 676c 655f 736c 6963   not single_slic
-00013490: 6520 616e 6420 6e6f 7420 666f 7263 653a  e and not force:
-000134a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000134b0: 6861 7361 7474 7228 7365 6c66 2c20 225f  hasattr(self, "_
-000134c0: 6c65 6e67 7468 2229 2061 6e64 2061 7820  length") and ax 
-000134d0: 696e 2073 656c 662e 5f6c 656e 6774 6820  in self._length 
-000134e0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-000134f0: 2061 6e64 2075 6e69 7473 2069 6e20 7365   and units in se
-00013500: 6c66 2e5f 6c65 6e67 7468 5b61 785d 3a0a  lf._length[ax]:.
-00013510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013520: 7265 7475 726e 2073 656c 662e 5f6c 656e  return self._len
-00013530: 6774 685b 6178 5d5b 756e 6974 735d 0a0a  gth[ax][units]..
-00013540: 2020 2020 2020 2020 2320 4966 2073 696e          # If sin
-00013550: 676c 6520 736c 6963 6520 7265 7175 6573  gle slice reques
-00013560: 7465 6420 616e 6420 6e6f 7420 6f6e 2063  ted and not on c
-00013570: 7572 7265 6e74 2073 6c69 6365 2c20 7265  urrent slice, re
-00013580: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
-00013590: 2020 6966 2073 696e 676c 655f 736c 6963    if single_slic
-000135a0: 6520 616e 6420 6e6f 7420 7365 6c66 2e6f  e and not self.o
-000135b0: 6e5f 736c 6963 6528 7669 6577 2c20 736c  n_slice(view, sl
-000135c0: 3d73 6c2c 2069 6478 3d69 6478 2c20 706f  =sl, idx=idx, po
-000135d0: 733d 706f 7329 3a0a 2020 2020 2020 2020  s=pos):.        
-000135e0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-000135f0: 0a20 2020 2020 2020 2023 2047 6574 206c  .        # Get l
-00013600: 656e 6774 6820 696e 206d 6d20 6672 6f6d  ength in mm from
-00013610: 206d 696e 2061 6e64 206d 6178 2070 6f73   min and max pos
-00013620: 6974 696f 6e73 0a20 2020 2020 2020 2073  itions.        s
-00013630: 656c 662e 6c6f 6164 2829 0a20 2020 2020  elf.load().     
-00013640: 2020 206d 696e 5f70 6f73 2c20 6d61 785f     min_pos, max_
-00013650: 706f 7320 3d20 7365 6c66 2e67 6574 5f65  pos = self.get_e
-00013660: 7874 656e 7428 0a20 2020 2020 2020 2020  xtent(.         
-00013670: 2020 2061 783d 6178 2c20 0a20 2020 2020     ax=ax, .     
-00013680: 2020 2020 2020 2073 696e 676c 655f 736c         single_sl
-00013690: 6963 653d 7369 6e67 6c65 5f73 6c69 6365  ice=single_slice
-000136a0: 2c0a 2020 2020 2020 2020 2020 2020 7669  ,.            vi
-000136b0: 6577 3d76 6965 772c 0a20 2020 2020 2020  ew=view,.       
-000136c0: 2020 2020 2073 6c3d 736c 2c0a 2020 2020       sl=sl,.    
-000136d0: 2020 2020 2020 2020 6964 783d 6964 782c          idx=idx,
-000136e0: 0a20 2020 2020 2020 2020 2020 2070 6f73  .            pos
-000136f0: 3d70 6f73 2c0a 2020 2020 2020 2020 2020  =pos,.          
-00013700: 2020 6d65 7468 6f64 3d6d 6574 686f 640a    method=method.
-00013710: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00013720: 2020 6c65 6e67 7468 203d 207b 0a20 2020    length = {.   
-00013730: 2020 2020 2020 2020 2022 6d6d 223a 2061           "mm": a
-00013740: 6273 286d 6178 5f70 6f73 202d 206d 696e  bs(max_pos - min
-00013750: 5f70 6f73 290a 2020 2020 2020 2020 7d0a  _pos).        }.
-00013760: 0a20 2020 2020 2020 2023 2047 6574 206c  .        # Get l
-00013770: 656e 6774 6820 696e 2076 6f78 656c 730a  ength in voxels.
-00013780: 2020 2020 2020 2020 2320 4361 7365 2077          # Case w
-00013790: 6865 7265 2076 6f78 656c 2073 697a 6520  here voxel size 
-000137a0: 6973 206b 6e6f 776e 0a20 2020 2020 2020  is known.       
-000137b0: 2069 5f61 7820 3d20 736b 7274 2e69 6d61   i_ax = skrt.ima
-000137c0: 6765 2e5f 6178 6573 2e69 6e64 6578 2861  ge._axes.index(a
-000137d0: 7829 2069 6620 6973 696e 7374 616e 6365  x) if isinstance
-000137e0: 2861 782c 2073 7472 2920 656c 7365 2061  (ax, str) else a
-000137f0: 780a 2020 2020 2020 2020 6966 2073 656c  x.        if sel
-00013800: 662e 766f 7865 6c5f 7369 7a65 2069 7320  f.voxel_size is 
-00013810: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00013820: 2020 2020 2020 6c65 6e67 7468 5b22 766f        length["vo
-00013830: 7865 6c73 225d 203d 206c 656e 6774 685b  xels"] = length[
-00013840: 226d 6d22 5d20 2f20 7365 6c66 2e76 6f78  "mm"] / self.vox
-00013850: 656c 5f73 697a 655b 695f 6178 5d0a 0a20  el_size[i_ax].. 
-00013860: 2020 2020 2020 2023 2044 6561 6c20 7769         # Deal wi
-00013870: 7468 2063 6173 6520 7768 6572 6520 7365  th case where se
-00013880: 6c66 2e76 6f78 656c 5f73 697a 6520 6973  lf.voxel_size is
-00013890: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
-000138a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000138b0: 6966 2069 5f61 7820 3d3d 2032 3a0a 2020  if i_ax == 2:.  
-000138c0: 2020 2020 2020 2020 2020 2020 2020 6c65                le
-000138d0: 6e67 7468 5b22 766f 7865 6c73 225d 203d  ngth["voxels"] =
-000138e0: 206c 656e 6774 685b 226d 6d22 5d20 2f20   length["mm"] / 
-000138f0: 7365 6c66 2e67 6574 5f73 6c69 6365 5f74  self.get_slice_t
-00013900: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
-00013910: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-00013920: 656c 6966 2075 6e69 7473 203d 3d20 2276  elif units == "v
-00013930: 6f78 656c 7322 3a0a 2020 2020 2020 2020  oxels":.        
-00013940: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
-00013950: 6e74 696d 6545 7272 6f72 2822 4361 6e6e  ntimeError("Cann
-00013960: 6f74 2063 6f6d 7075 7465 206c 656e 6774  ot compute lengt
-00013970: 6820 696e 2076 6f78 656c 7320 6672 6f6d  h in voxels from
-00013980: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00013990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139a0: 2020 2020 2020 2263 6f6e 746f 7572 7320        "contours 
-000139b0: 7769 7468 6f75 7420 6b6e 6f77 696e 6720  without knowing 
-000139c0: 766f 7865 6c20 7369 7a65 7321 2229 0a0a  voxel sizes!")..
-000139d0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-000139e0: 2023 2043 6163 6865 2074 6865 2070 726f   # Cache the pro
-000139f0: 7065 7274 7920 6966 2067 6c6f 6261 6c0a  perty if global.
-00013a00: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00013a10: 696e 676c 655f 736c 6963 653a 0a20 2020  ingle_slice:.   
-00013a20: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00013a30: 6861 7361 7474 7228 7365 6c66 2c20 225f  hasattr(self, "_
-00013a40: 6c65 6e67 7468 2229 3a0a 2020 2020 2020  length"):.      
-00013a50: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00013a60: 6c65 6e67 7468 203d 207b 7d0a 2020 2020  length = {}.    
-00013a70: 2020 2020 2020 2020 7365 6c66 2e5f 6c65          self._le
-00013a80: 6e67 7468 5b73 6b72 742e 696d 6167 652e  ngth[skrt.image.
-00013a90: 5f61 7865 735b 695f 6178 5d5d 203d 206c  _axes[i_ax]] = l
-00013aa0: 656e 6774 680a 2020 2020 2020 2020 0a20  ength.        . 
-00013ab0: 2020 2020 2020 2023 2052 6574 7572 6e20         # Return 
-00013ac0: 6465 7369 7265 6420 756e 6974 730a 2020  desired units.  
-00013ad0: 2020 2020 2020 7265 7475 726e 206c 656e        return len
-00013ae0: 6774 685b 756e 6974 735d 0a0a 2020 2020  gth[units]..    
-00013af0: 6465 6620 6765 745f 6765 6f6d 6574 7279  def get_geometry
-00013b00: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00013b10: 2020 2020 2020 2020 6d65 7472 6963 733d          metrics=
-00013b20: 4e6f 6e65 2c0a 2020 2020 2020 2020 766f  None,.        vo
-00013b30: 6c5f 756e 6974 733d 226d 6d22 2c0a 2020  l_units="mm",.  
-00013b40: 2020 2020 2020 6172 6561 5f75 6e69 7473        area_units
-00013b50: 3d22 6d6d 222c 0a20 2020 2020 2020 206c  ="mm",.        l
-00013b60: 656e 6774 685f 756e 6974 733d 226d 6d22  ength_units="mm"
-00013b70: 2c0a 2020 2020 2020 2020 6365 6e74 726f  ,.        centro
-00013b80: 6964 5f75 6e69 7473 3d22 6d6d 222c 0a20  id_units="mm",. 
-00013b90: 2020 2020 2020 2076 6965 773d 2278 2d79         view="x-y
-00013ba0: 222c 0a20 2020 2020 2020 2073 6c3d 4e6f  ",.        sl=No
-00013bb0: 6e65 2c0a 2020 2020 2020 2020 706f 733d  ne,.        pos=
-00013bc0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6964  None,.        id
-00013bd0: 783d 4e6f 6e65 2c0a 2020 2020 2020 2020  x=None,.        
-00013be0: 6d65 7468 6f64 3d4e 6f6e 652c 0a20 2020  method=None,.   
-00013bf0: 2020 2020 2075 6e69 7473 5f69 6e5f 6865       units_in_he
-00013c00: 6164 6572 3d46 616c 7365 2c0a 2020 2020  ader=False,.    
-00013c10: 2020 2020 676c 6f62 616c 5f76 735f 736c      global_vs_sl
-00013c20: 6963 655f 6865 6164 6572 3d46 616c 7365  ice_header=False
-00013c30: 2c0a 2020 2020 2020 2020 6e61 6d65 5f61  ,.        name_a
-00013c40: 735f 696e 6465 783d 5472 7565 2c0a 2020  s_index=True,.  
-00013c50: 2020 2020 2020 6e69 6365 5f63 6f6c 756d        nice_colum
-00013c60: 6e73 3d46 616c 7365 2c0a 2020 2020 2020  ns=False,.      
-00013c70: 2020 6465 6369 6d61 6c5f 706c 6163 6573    decimal_places
-00013c80: 3d4e 6f6e 652c 0a20 2020 2020 2020 2066  =None,.        f
-00013c90: 6f72 6365 3d54 7275 652c 0a20 2020 2020  orce=True,.     
-00013ca0: 2020 2068 746d 6c3d 4661 6c73 650a 2020     html=False.  
-00013cb0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-00013cc0: 5265 7475 726e 2061 2070 616e 6461 7320  Return a pandas 
-00013cd0: 4461 7461 4672 616d 6520 6f72 2068 746d  DataFrame or htm
-00013ce0: 6c20 7461 626c 6520 6f66 2074 6865 2067  l table of the g
-00013cf0: 656f 6d65 7472 6963 2070 726f 7065 7274  eometric propert
-00013d00: 6965 7320 0a20 2020 2020 2020 206c 6973  ies .        lis
-00013d10: 7465 6420 696e 203c 6d65 7472 6963 733e  ted in <metrics>
-00013d20: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
-00013d30: 616d 6574 6572 733a 2a2a 0a20 2020 2020  ameters:**.     
-00013d40: 2020 200a 2020 2020 2020 2020 6d65 7472     .        metr
-00013d50: 6963 7320 3a20 6c69 7374 2c20 6465 6661  ics : list, defa
-00013d60: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00013d70: 2020 2020 204c 6973 7420 6f66 206d 6574       List of met
-00013d80: 7269 6373 2074 6f20 696e 636c 7564 6520  rics to include 
-00013d90: 696e 2074 6865 2074 6162 6c65 2e20 4f70  in the table. Op
-00013da0: 7469 6f6e 733a 0a0a 2020 2020 2020 2020  tions:..        
-00013db0: 2020 2020 2020 2020 2d20 2276 6f6c 756d          - "volum
-00013dc0: 6522 203a 2076 6f6c 756d 6520 6f66 2065  e" : volume of e
-00013dd0: 6e74 6972 6520 524f 492e 0a20 2020 2020  ntire ROI..     
-00013de0: 2020 2020 2020 2020 2020 202d 2022 6172             - "ar
-00013df0: 6561 223a 2061 7265 6120 6f66 2052 4f49  ea": area of ROI
-00013e00: 206f 6e20 6120 7369 6e67 6c65 2073 6c69   on a single sli
-00013e10: 6365 2e0a 0a20 2020 2020 2020 2020 2020  ce...           
-00013e20: 2020 2020 202d 2022 6365 6e74 726f 6964       - "centroid
-00013e30: 223a 2033 4420 6365 6e74 7265 2d6f 662d  ": 3D centre-of-
-00013e40: 6d61 7373 206f 6620 524f 493b 2077 696c  mass of ROI; wil
-00013e50: 6c20 6265 2073 706c 6974 2069 6e74 6f0a  l be split into.
-00013e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e70: 2020 7468 7265 6520 636f 6c75 6d6e 7320    three columns 
-00013e80: 636f 7272 6573 706f 6e64 696e 6720 746f  corresponding to
-00013e90: 2074 6865 2074 6872 6565 2061 7865 732e   the three axes.
-00013ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013eb0: 202d 2022 6365 6e74 726f 6964 5f73 6c69   - "centroid_sli
-00013ec0: 6365 223a 2032 4420 6365 6e74 7265 206f  ce": 2D centre o
-00013ed0: 6620 6d61 7373 206f 6e20 6120 7369 6e67  f mass on a sing
-00013ee0: 6c65 2073 6c69 6365 2e20 5769 6c6c 0a20  le slice. Will. 
-00013ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f00: 2062 6520 7370 6c69 7420 696e 746f 2074   be split into t
-00013f10: 776f 2063 6f6c 756d 6e73 2063 6f72 7265  wo columns corre
-00013f20: 7370 6f6e 6469 6e67 2074 6f20 7468 6520  sponding to the 
-00013f30: 7477 6f20 6178 6573 206f 6e0a 2020 2020  two axes on.    
-00013f40: 2020 2020 2020 2020 2020 2020 2020 7468                th
-00013f50: 6520 736c 6963 652e 0a0a 2020 2020 2020  e slice...      
-00013f60: 2020 2020 2020 2020 2020 2d20 226c 656e            - "len
-00013f70: 6774 6822 3a20 6c65 6e67 7468 7320 6f66  gth": lengths of
-00013f80: 2074 6865 2052 4f49 2069 6e20 6561 6368   the ROI in each
-00013f90: 2064 6972 6563 7469 6f6e 3b20 7769 6c6c   direction; will
-00013fa0: 2062 6520 7370 6c69 740a 2020 2020 2020   be split.      
-00013fb0: 2020 2020 2020 2020 2020 2020 696e 746f              into
-00013fc0: 2074 6872 6565 2063 6f6c 756d 6e73 2063   three columns c
-00013fd0: 6f72 7265 7370 6f6e 6469 6e67 2074 6f20  orresponding to 
-00013fe0: 7468 6520 7468 7265 6520 6178 6573 2e0a  the three axes..
-00013ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014000: 2d20 226c 656e 6774 685f 736c 6963 6522  - "length_slice"
-00014010: 3a20 6c65 6e67 7468 206f 6620 7468 6520  : length of the 
-00014020: 524f 4920 6f6e 2061 2073 696e 676c 6520  ROI on a single 
-00014030: 736c 6963 653b 2077 696c 6c20 6265 0a20  slice; will be. 
-00014040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014050: 2073 706c 6974 2069 6e74 6f20 7477 6f20   split into two 
-00014060: 636f 6c75 6d6e 7320 636f 7272 6573 706f  columns correspo
-00014070: 6e64 696e 6720 746f 2074 6865 2074 776f  nding to the two
-00014080: 2061 7865 7320 6f6e 2074 6865 0a20 2020   axes on the.   
-00014090: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000140a0: 6c69 6365 2e0a 0a20 2020 2020 2020 2020  lice...         
-000140b0: 2020 2049 6620 4e6f 6e65 2c20 6465 6661     If None, defa
-000140c0: 756c 7473 2074 6f20 5b22 766f 6c75 6d65  ults to ["volume
-000140d0: 222c 2022 6365 6e74 726f 6964 225d 0a0a  ", "centroid"]..
-000140e0: 2020 2020 2020 2020 766f 6c5f 756e 6974          vol_unit
-000140f0: 7320 3a20 7374 722c 2064 6566 6175 6c74  s : str, default
-00014100: 3d22 6d6d 220a 2020 2020 2020 2020 2020  ="mm".          
-00014110: 2020 556e 6974 7320 746f 2075 7365 2066    Units to use f
-00014120: 6f72 2076 6f6c 756d 652e 2043 616e 2062  or volume. Can b
-00014130: 6520 226d 6d22 2028 3d6d 6d5e 3329 2c20  e "mm" (=mm^3), 
-00014140: 226d 6c22 2c0a 2020 2020 2020 2020 2020  "ml",.          
-00014150: 2020 6f72 2022 766f 7865 6c73 222e 0a0a    or "voxels"...
-00014160: 2020 2020 2020 2020 6172 6561 5f75 6e69          area_uni
-00014170: 7473 203a 2073 7472 2c20 6465 6661 756c  ts : str, defaul
-00014180: 743d 226d 6d22 0a20 2020 2020 2020 2020  t="mm".         
-00014190: 2020 2055 6e69 7473 2074 6f20 7573 6520     Units to use 
-000141a0: 666f 7220 6172 6561 732e 2043 616e 2062  for areas. Can b
-000141b0: 6520 226d 6d22 2028 3d6d 6d5e 3229 206f  e "mm" (=mm^2) o
-000141c0: 7220 2276 6f78 656c 7322 2e0a 0a20 2020  r "voxels"...   
-000141d0: 2020 2020 206c 656e 6774 685f 756e 6974       length_unit
-000141e0: 7320 3a20 7374 722c 2064 6566 6175 6c74  s : str, default
-000141f0: 3d22 6d6d 223a 0a20 2020 2020 2020 2020  ="mm":.         
-00014200: 2020 2055 6e69 7473 2074 6f20 7573 6520     Units to use 
-00014210: 666f 7220 6c65 6e67 7468 732e 2043 616e  for lengths. Can
-00014220: 2062 6520 226d 6d22 206f 7220 2276 6f78   be "mm" or "vox
-00014230: 656c 7322 2e0a 0a20 2020 2020 2020 2063  els"...        c
-00014240: 656e 7472 6f69 645f 756e 6974 733a 0a20  entroid_units:. 
-00014250: 2020 2020 2020 2020 2020 2055 6e69 7473             Units
-00014260: 2074 6f20 7573 6520 666f 7220 6365 6e74   to use for cent
-00014270: 726f 6964 732e 2043 616e 2062 6520 226d  roids. Can be "m
-00014280: 6d22 206f 7220 2276 6f78 656c 7322 2e0a  m" or "voxels"..
-00014290: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
-000142a0: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
-000142b0: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
-000142c0: 7269 656e 7461 7469 6f6e 2069 6e20 7768  rientation in wh
-000142d0: 6963 6820 746f 2063 6f6d 7075 7465 206d  ich to compute m
-000142e0: 6574 7269 6373 2e20 4f6e 6c79 2072 656c  etrics. Only rel
-000142f0: 6576 616e 7420 666f 7220 0a20 2020 2020  evant for .     
-00014300: 2020 2020 2020 2073 696e 676c 652d 736c         single-sl
-00014310: 6963 6520 6d65 7472 6963 7320 2861 7265  ice metrics (are
-00014320: 612c 2063 656e 7472 6f69 645f 736c 6963  a, centroid_slic
-00014330: 652c 206c 656e 6774 685f 736c 6963 6529  e, length_slice)
-00014340: 2e0a 0a20 2020 2020 2020 2073 6c20 3a20  ...        sl : 
-00014350: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
-00014360: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
-00014370: 6963 6520 6e75 6d62 6572 206f 6e20 7768  ice number on wh
-00014380: 6963 6820 746f 2063 6f6d 7075 7465 206d  ich to compute m
-00014390: 6574 7269 6373 2e20 4f6e 6c79 2072 656c  etrics. Only rel
-000143a0: 6576 616e 7420 666f 7220 0a20 2020 2020  evant for .     
-000143b0: 2020 2020 2020 2073 696e 676c 652d 736c         single-sl
-000143c0: 6963 6520 6d65 7472 6963 7320 2861 7265  ice metrics (are
-000143d0: 612c 2063 656e 7472 6f69 645f 736c 6963  a, centroid_slic
-000143e0: 652c 206c 656e 6774 685f 736c 6963 6529  e, length_slice)
-000143f0: 2e0a 2020 2020 2020 2020 2020 2020 4966  ..            If
-00014400: 203c 736c 3e2c 203c 6964 783e 2c20 616e   <sl>, <idx>, an
-00014410: 6420 3c70 6f73 3e20 6172 6520 616c 6c20  d <pos> are all 
-00014420: 4e6f 6e65 2c20 7468 6520 6365 6e74 7261  None, the centra
-00014430: 6c20 736c 6963 6520 6f66 2074 6865 0a20  l slice of the. 
-00014440: 2020 2020 2020 2020 2020 2052 4f49 2077             ROI w
-00014450: 696c 6c20 6265 2075 7365 642e 0a0a 2020  ill be used...  
-00014460: 2020 2020 2020 6964 7820 3a20 696e 742c        idx : int,
-00014470: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00014480: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
-00014490: 696e 6465 7820 6172 7261 7920 6f6e 2077  index array on w
-000144a0: 6869 6368 2074 6f20 636f 6d70 7574 6520  hich to compute 
-000144b0: 6d65 7472 6963 732e 204f 6e6c 7920 7265  metrics. Only re
-000144c0: 6c65 7661 6e74 2066 6f72 200a 2020 2020  levant for .    
-000144d0: 2020 2020 2020 2020 7369 6e67 6c65 2d73          single-s
-000144e0: 6c69 6365 206d 6574 7269 6373 2028 6172  lice metrics (ar
-000144f0: 6561 2c20 6365 6e74 726f 6964 5f73 6c69  ea, centroid_sli
-00014500: 6365 2c20 6c65 6e67 7468 5f73 6c69 6365  ce, length_slice
-00014510: 292e 0a20 2020 2020 2020 2020 2020 2055  )..            U
-00014520: 7365 6420 6966 203c 736c 3e20 6973 204e  sed if <sl> is N
-00014530: 6f6e 652e 0a0a 2020 2020 2020 2020 706f  one...        po
-00014540: 7320 3a20 666c 6f61 742c 2064 6566 6175  s : float, defau
-00014550: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00014560: 2020 2020 536c 6963 6520 706f 7369 7469      Slice positi
-00014570: 6f6e 2069 6e20 6d6d 206f 6e20 7768 6963  on in mm on whic
-00014580: 6820 746f 2063 6f6d 7075 7465 206d 6574  h to compute met
-00014590: 7269 6373 2e20 4f6e 6c79 2072 656c 6576  rics. Only relev
-000145a0: 616e 7420 666f 7220 0a20 2020 2020 2020  ant for .       
-000145b0: 2020 2020 2073 696e 676c 652d 736c 6963       single-slic
-000145c0: 6520 6d65 7472 6963 7320 2861 7265 612c  e metrics (area,
-000145d0: 2063 656e 7472 6f69 645f 736c 6963 652c   centroid_slice,
-000145e0: 206c 656e 6774 685f 736c 6963 6529 2e0a   length_slice)..
-000145f0: 2020 2020 2020 2020 2020 2020 5573 6564              Used
-00014600: 2069 6620 3c73 6c3e 2061 6e64 203c 6964   if <sl> and <id
-00014610: 783e 2061 7265 2062 6f74 6820 4e6f 6e65  x> are both None
-00014620: 2e0a 0a20 2020 2020 2020 206d 6574 686f  ...        metho
-00014630: 6420 3a20 7374 722c 2064 6566 6175 6c74  d : str, default
-00014640: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-00014650: 2020 4d65 7468 6f64 2074 6f20 7573 6520    Method to use 
-00014660: 666f 7220 6d65 7472 6963 2063 616c 6375  for metric calcu
-00014670: 6c61 7469 6f6e 2e20 4361 6e20 6265 2065  lation. Can be e
-00014680: 6974 6865 7220 2263 6f6e 746f 7572 2220  ither "contour" 
-00014690: 0a20 2020 2020 2020 2020 2020 2028 7573  .            (us
-000146a0: 6520 7368 6170 656c 7920 706f 6c79 676f  e shapely polygo
-000146b0: 6e73 2920 6f72 2022 6d61 736b 2220 2875  ns) or "mask" (u
-000146c0: 7365 2062 696e 6172 7920 6d61 736b 292e  se binary mask).
-000146d0: 2049 6620 4e6f 6e65 2c0a 2020 2020 2020   If None,.      
-000146e0: 2020 2020 2020 7468 6520 7661 6c75 6520        the value 
-000146f0: 7365 7420 696e 2073 656c 662e 6465 6661  set in self.defa
-00014700: 756c 745f 6765 6f6d 5f6d 6574 686f 6420  ult_geom_method 
-00014710: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
-00014720: 2020 2020 2020 2075 6e69 7473 5f69 6e5f         units_in_
-00014730: 6865 6164 6572 203a 2062 6f6f 6c2c 2064  header : bool, d
-00014740: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
-00014750: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-00014760: 2c20 756e 6974 7320 7769 6c6c 2062 6520  , units will be 
-00014770: 696e 636c 7564 6564 2069 6e20 636f 6c75  included in colu
-00014780: 6d6e 2068 6561 6465 7273 2e0a 0a20 2020  mn headers...   
-00014790: 2020 2020 2067 6c6f 6261 6c5f 7673 5f73       global_vs_s
-000147a0: 6c69 6365 5f68 6561 6465 7220 3a20 626f  lice_header : bo
-000147b0: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
-000147c0: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
-000147d0: 2054 7275 652c 2074 6865 2072 6574 7572   True, the retur
-000147e0: 6e65 6420 4461 7461 4672 616d 6520 7769  ned DataFrame wi
-000147f0: 6c6c 2068 6176 6520 616e 2065 7874 7261  ll have an extra
-00014800: 2073 6574 206f 6620 6865 6164 6572 730a   set of headers.
-00014810: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
-00014820: 7474 696e 6720 7468 6520 7461 626c 6520  tting the table 
-00014830: 696e 746f 2022 676c 6f62 616c 2220 616e  into "global" an
-00014840: 6420 2273 6c69 6365 2220 6d65 7472 6963  d "slice" metric
-00014850: 732e 0a0a 2020 2020 2020 2020 6e61 6d65  s...        name
-00014860: 5f61 735f 696e 6465 7820 3a20 626f 6f6c  _as_index : bool
-00014870: 2c20 6465 6661 756c 743d 5472 7565 0a20  , default=True. 
-00014880: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
-00014890: 7565 2c20 7468 6520 696e 6465 7820 636f  ue, the index co
-000148a0: 6c75 6d6e 206f 6620 7468 6520 7061 6e64  lumn of the pand
-000148b0: 6173 2044 6174 6146 7261 6d65 2077 696c  as DataFrame wil
-000148c0: 6c20 0a20 2020 2020 2020 2020 2020 2063  l .            c
-000148d0: 6f6e 7461 696e 2074 6865 2052 4f49 2773  ontain the ROI's
-000148e0: 206e 616d 653b 206f 7468 6572 7769 7365   name; otherwise
-000148f0: 2c20 7468 6520 6e61 6d65 2077 696c 6c20  , the name will 
-00014900: 6170 7065 6172 2069 6e20 6120 636f 6c75  appear in a colu
-00014910: 6d6e 0a20 2020 2020 2020 2020 2020 206e  mn.            n
-00014920: 616d 6564 2022 524f 4922 2e0a 0a20 2020  amed "ROI"...   
-00014930: 2020 2020 206e 6963 655f 636f 6c75 6d6e       nice_column
-00014940: 7320 3a20 626f 6f6c 2c20 6465 6661 756c  s : bool, defaul
-00014950: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
-00014960: 2020 2020 4966 2046 616c 7365 2c20 636f      If False, co
-00014970: 6c75 6d6e 206e 616d 6573 2077 696c 6c20  lumn names will 
-00014980: 6265 2074 6865 2073 616d 6520 6173 2074  be the same as t
-00014990: 6865 2069 6e70 7574 206d 6574 7269 6373  he input metrics
-000149a0: 206e 616d 6573 3b0a 2020 2020 2020 2020   names;.        
-000149b0: 2020 2020 6966 2054 7275 652c 2074 6865      if True, the
-000149c0: 206e 616d 6573 2077 696c 6c20 6265 2063   names will be c
-000149d0: 6170 6974 616c 697a 6564 2061 6e64 2075  apitalized and u
-000149e0: 6e64 6572 7363 6f72 6573 2077 696c 6c20  nderscores will 
-000149f0: 6265 200a 2020 2020 2020 2020 2020 2020  be .            
-00014a00: 7265 706c 6163 6564 2077 6974 6820 7370  replaced with sp
-00014a10: 6163 6573 2e0a 0a20 2020 2020 2020 2064  aces...        d
-00014a20: 6563 696d 616c 5f70 6c61 6365 7320 3a20  ecimal_places : 
-00014a30: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
-00014a40: 650a 2020 2020 2020 2020 2020 2020 4e75  e.            Nu
-00014a50: 6d62 6572 206f 6620 6465 6369 6d61 6c20  mber of decimal 
-00014a60: 706c 6163 6573 2074 6f20 6b65 6570 2066  places to keep f
-00014a70: 6f72 2065 6163 6820 6d65 7472 6963 2e20  or each metric. 
-00014a80: 4966 204e 6f6e 652c 2066 756c 6c0a 2020  If None, full.  
-00014a90: 2020 2020 2020 2020 2020 7072 6563 6973            precis
-00014aa0: 696f 6e20 7769 6c6c 2062 6520 7573 6564  ion will be used
-00014ab0: 2e0a 0a20 2020 2020 2020 2066 6f72 6365  ...        force
-00014ac0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-00014ad0: 3d54 7275 650a 2020 2020 2020 2020 2020  =True.          
-00014ae0: 2020 4966 2046 616c 7365 2c20 676c 6f62    If False, glob
-00014af0: 616c 206d 6574 7269 6373 2028 766f 6c75  al metrics (volu
-00014b00: 6d65 2c20 3344 2063 656e 7472 6f69 642c  me, 3D centroid,
-00014b10: 2033 4420 6c65 6e67 7468 7329 2077 696c   3D lengths) wil
-00014b20: 6c0a 2020 2020 2020 2020 2020 2020 6f6e  l.            on
-00014b30: 6c79 2062 6520 6361 6c63 756c 6174 6564  ly be calculated
-00014b40: 2069 6620 7468 6579 2068 6176 6520 6e6f   if they have no
-00014b50: 7420 6265 656e 2063 616c 6375 6c61 7465  t been calculate
-00014b60: 6420 6265 666f 7265 3b0a 2020 2020 2020  d before;.      
-00014b70: 2020 2020 2020 6966 2054 7275 652c 2061        if True, a
-00014b80: 6c6c 206d 6574 7269 6373 2077 696c 6c20  ll metrics will 
-00014b90: 6265 2072 6563 616c 6375 6c61 7465 642e  be recalculated.
-00014ba0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00014bb0: 2020 2020 2020 2320 4966 206e 6f20 696e        # If no in
-00014bc0: 6465 7820 6769 7665 6e2c 2075 7365 2063  dex given, use c
-00014bd0: 656e 7472 616c 2073 6c69 6365 0a20 2020  entral slice.   
-00014be0: 2020 2020 2069 6620 736c 2069 7320 4e6f       if sl is No
-00014bf0: 6e65 2061 6e64 2069 6478 2069 7320 4e6f  ne and idx is No
-00014c00: 6e65 2061 6e64 2070 6f73 2069 7320 4e6f  ne and pos is No
-00014c10: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00014c20: 6964 7820 3d20 7365 6c66 2e67 6574 5f6d  idx = self.get_m
-00014c30: 6964 5f69 6478 2876 6965 7729 0a0a 2020  id_idx(view)..  
-00014c40: 2020 2020 2020 2320 4465 6661 756c 7420        # Default 
-00014c50: 6d65 7472 6963 730a 2020 2020 2020 2020  metrics.        
-00014c60: 6966 206d 6574 7269 6373 2069 7320 4e6f  if metrics is No
-00014c70: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00014c80: 6d65 7472 6963 7320 3d20 5b22 766f 6c75  metrics = ["volu
-00014c90: 6d65 222c 2022 6365 6e74 726f 6964 225d  me", "centroid"]
-00014ca0: 0a0a 2020 2020 2020 2020 2320 436f 6d70  ..        # Comp
-00014cb0: 7574 6520 6d65 7472 6963 730a 2020 2020  ute metrics.    
-00014cc0: 2020 2020 6765 6f6d 203d 207b 7d0a 2020      geom = {}.  
-00014cd0: 2020 2020 2020 736c 6963 655f 6b77 6172        slice_kwar
-00014ce0: 6773 203d 207b 0a20 2020 2020 2020 2020  gs = {.         
-00014cf0: 2020 2022 7669 6577 223a 2076 6965 772c     "view": view,
-00014d00: 0a20 2020 2020 2020 2020 2020 2022 736c  .            "sl
-00014d10: 223a 2073 6c2c 0a20 2020 2020 2020 2020  ": sl,.         
-00014d20: 2020 2022 6964 7822 3a20 6964 782c 0a20     "idx": idx,. 
-00014d30: 2020 2020 2020 2020 2020 2022 706f 7322             "pos"
-00014d40: 3a20 706f 730a 2020 2020 2020 2020 7d0a  : pos.        }.
-00014d50: 2020 2020 2020 2020 666f 7220 6d20 696e          for m in
-00014d60: 206d 6574 7269 6373 3a0a 0a20 2020 2020   metrics:..     
-00014d70: 2020 2020 2020 2023 2033 4420 766f 6c75         # 3D volu
-00014d80: 6d65 0a20 2020 2020 2020 2020 2020 2069  me.            i
-00014d90: 6620 6d20 3d3d 2022 766f 6c75 6d65 223a  f m == "volume":
-00014da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014db0: 2067 656f 6d5b 6d5d 203d 2073 656c 662e   geom[m] = self.
-00014dc0: 6765 745f 766f 6c75 6d65 280a 2020 2020  get_volume(.    
-00014dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014de0: 756e 6974 733d 766f 6c5f 756e 6974 732c  units=vol_units,
-00014df0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00014e00: 2020 2020 2020 6d65 7468 6f64 3d6d 6574        method=met
-00014e10: 686f 642c 0a20 2020 2020 2020 2020 2020  hod,.           
-00014e20: 2020 2020 2020 2020 2066 6f72 6365 3d66           force=f
-00014e30: 6f72 6365 0a20 2020 2020 2020 2020 2020  orce.           
-00014e40: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00014e50: 2020 2020 2320 4172 6561 206f 6e20 6120      # Area on a 
-00014e60: 736c 6963 650a 2020 2020 2020 2020 2020  slice.          
-00014e70: 2020 656c 6966 206d 203d 3d20 2261 7265    elif m == "are
-00014e80: 6122 3a0a 2020 2020 2020 2020 2020 2020  a":.            
-00014e90: 2020 2020 6765 6f6d 5b6d 5d20 3d20 7365      geom[m] = se
-00014ea0: 6c66 2e67 6574 5f61 7265 6128 0a20 2020  lf.get_area(.   
-00014eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ec0: 2075 6e69 7473 3d61 7265 615f 756e 6974   units=area_unit
-00014ed0: 732c 200a 2020 2020 2020 2020 2020 2020  s, .            
-00014ee0: 2020 2020 2020 2020 6d65 7468 6f64 3d6d          method=m
-00014ef0: 6574 686f 642c 0a20 2020 2020 2020 2020  ethod,.         
-00014f00: 2020 2020 2020 2020 2020 202a 2a73 6c69             **sli
-00014f10: 6365 5f6b 7761 7267 730a 2020 2020 2020  ce_kwargs.      
-00014f20: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00014f30: 2020 2020 2020 2020 2023 2033 4420 6365           # 3D ce
-00014f40: 6e74 726f 6964 0a20 2020 2020 2020 2020  ntroid.         
-00014f50: 2020 2065 6c69 6620 6d20 3d3d 2022 6365     elif m == "ce
-00014f60: 6e74 726f 6964 223a 0a20 2020 2020 2020  ntroid":.       
-00014f70: 2020 2020 2020 2020 2063 656e 7472 6f69           centroi
-00014f80: 6420 3d20 7365 6c66 2e67 6574 5f63 656e  d = self.get_cen
-00014f90: 7472 6f69 6428 0a20 2020 2020 2020 2020  troid(.         
-00014fa0: 2020 2020 2020 2020 2020 2075 6e69 7473             units
-00014fb0: 3d63 656e 7472 6f69 645f 756e 6974 732c  =centroid_units,
-00014fc0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00014fd0: 2020 2020 2020 6d65 7468 6f64 3d6d 6574        method=met
-00014fe0: 686f 642c 0a20 2020 2020 2020 2020 2020  hod,.           
-00014ff0: 2020 2020 2020 2020 2066 6f72 6365 3d66           force=f
-00015000: 6f72 6365 0a20 2020 2020 2020 2020 2020  orce.           
-00015010: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00015020: 2020 2020 2020 2066 6f72 2069 2c20 6178         for i, ax
-00015030: 2069 6e20 656e 756d 6572 6174 6528 736b   in enumerate(sk
-00015040: 7274 2e69 6d61 6765 2e5f 6178 6573 293a  rt.image._axes):
-00015050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015060: 2020 2020 2067 656f 6d5b 6622 6365 6e74       geom[f"cent
-00015070: 726f 6964 5f7b 6178 7d22 5d20 3d20 6365  roid_{ax}"] = ce
-00015080: 6e74 726f 6964 5b69 5d0a 0a20 2020 2020  ntroid[i]..     
-00015090: 2020 2020 2020 2023 2032 4420 6365 6e74         # 2D cent
-000150a0: 726f 6964 0a20 2020 2020 2020 2020 2020  roid.           
-000150b0: 2065 6c69 6620 6d20 3d3d 2022 6365 6e74   elif m == "cent
-000150c0: 726f 6964 5f73 6c69 6365 223a 0a20 2020  roid_slice":.   
-000150d0: 2020 2020 2020 2020 2020 2020 2063 656e               cen
-000150e0: 7472 6f69 6420 3d20 7365 6c66 2e67 6574  troid = self.get
-000150f0: 5f63 656e 7472 6f69 6428 0a20 2020 2020  _centroid(.     
-00015100: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00015110: 6e69 7473 3d63 656e 7472 6f69 645f 756e  nits=centroid_un
-00015120: 6974 732c 200a 2020 2020 2020 2020 2020  its, .          
-00015130: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-00015140: 3d6d 6574 686f 642c 0a20 2020 2020 2020  =method,.       
-00015150: 2020 2020 2020 2020 2020 2020 2073 696e               sin
-00015160: 676c 655f 736c 6963 653d 5472 7565 2c0a  gle_slice=True,.
+00011c10: 2020 2020 7a5f 6d69 6e20 3d20 6d69 6e28      z_min = min(
+00011c20: 7a5f 6b65 7973 2920 2d20 767a 202f 2032  z_keys) - vz / 2
+00011c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011c40: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00011c50: 2020 2020 2020 2020 2020 207a 5f6d 696e             z_min
+00011c60: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00011c70: 2020 2020 2020 2020 2020 2020 7a5f 6d61              z_ma
+00011c80: 7820 3d20 4e6f 6e65 0a20 2020 2020 2020  x = None.       
+00011c90: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00011ca0: 5b7a 5f6d 696e 2c20 7a5f 6d61 785d 0a0a  [z_min, z_max]..
+00011cb0: 2020 2020 2020 2020 2020 2020 2320 4f74              # Ot
+00011cc0: 6865 7277 6973 652c 2063 616c 6375 6c61  herwise, calcula
+00011cd0: 7465 2065 7874 656e 7420 6672 6f6d 206d  te extent from m
+00011ce0: 696e 2f6d 6178 2063 6f6e 746f 7572 2070  in/max contour p
+00011cf0: 6f73 6974 696f 6e73 200a 2020 2020 2020  ositions .      
+00011d00: 2020 2020 2020 706f 696e 7473 203d 205b        points = [
+00011d10: 5d0a 0a20 2020 2020 2020 2020 2020 2023  ]..            #
+00011d20: 2047 6c6f 6261 6c3a 2075 7365 2065 7665   Global: use eve
+00011d30: 7279 2063 6f6e 746f 7572 0a20 2020 2020  ry contour.     
+00011d40: 2020 2020 2020 2069 6620 6e6f 7420 7369         if not si
+00011d50: 6e67 6c65 5f73 6c69 6365 3a0a 2020 2020  ngle_slice:.    
+00011d60: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00011d70: 692c 2063 6f6e 746f 7572 7320 696e 2073  i, contours in s
+00011d80: 656c 662e 6765 745f 636f 6e74 6f75 7273  elf.get_contours
+00011d90: 2822 782d 7922 292e 6974 656d 7328 293a  ("x-y").items():
+00011da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011db0: 2020 2020 2066 6f72 2063 6f6e 746f 7572       for contour
+00011dc0: 2069 6e20 636f 6e74 6f75 7273 3a0a 2020   in contours:.  
+00011dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011de0: 2020 2020 2020 706f 696e 7473 2e65 7874        points.ext
+00011df0: 656e 6428 5b70 5b69 5f61 785d 2066 6f72  end([p[i_ax] for
+00011e00: 2070 2069 6e20 636f 6e74 6f75 725d 290a   p in contour]).
+00011e10: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+00011e20: 696e 676c 6520 736c 6963 653a 206a 7573  ingle slice: jus
+00011e30: 7420 7573 6520 7468 6520 636f 6e74 6f75  t use the contou
+00011e40: 7220 6f6e 2074 6865 2073 6c69 6365 0a20  r on the slice. 
+00011e50: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00011e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011e70: 2066 6f72 2063 6f6e 746f 7572 2069 6e20   for contour in 
+00011e80: 7365 6c66 2e67 6574 5f63 6f6e 746f 7572  self.get_contour
+00011e90: 735f 6f6e 5f73 6c69 6365 280a 2020 2020  s_on_slice(.    
+00011ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011eb0: 7669 6577 2c20 736c 3d73 6c2c 2069 6478  view, sl=sl, idx
+00011ec0: 3d69 6478 2c20 706f 733d 706f 7329 3a0a  =idx, pos=pos):.
+00011ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ee0: 2020 2020 706f 696e 7473 2e65 7874 656e      points.exten
+00011ef0: 6428 5b70 5b69 5f61 785d 2066 6f72 2070  d([p[i_ax] for p
+00011f00: 2069 6e20 636f 6e74 6f75 725d 290a 0a20   in contour]).. 
+00011f10: 2020 2020 2020 2020 2020 2023 2052 6574             # Ret
+00011f20: 7572 6e20 6d69 6e20 616e 6420 6d61 7820  urn min and max 
+00011f30: 6f66 2074 6865 2070 6f69 6e74 7320 696e  of the points in
+00011f40: 2074 6865 2063 6f6e 746f 7572 2873 290a   the contour(s).
+00011f50: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00011f60: 656e 2870 6f69 6e74 7329 3a0a 2020 2020  en(points):.    
+00011f70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00011f80: 726e 205b 6d69 6e28 706f 696e 7473 2920  rn [min(points) 
+00011f90: 2d20 6f72 6967 696e 2c20 6d61 7828 706f  - origin, max(po
+00011fa0: 696e 7473 2920 2d20 6f72 6967 696e 5d0a  ints) - origin].
+00011fb0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00011fc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011fd0: 2020 7265 7475 726e 205b 4e6f 6e65 2c20    return [None, 
+00011fe0: 4e6f 6e65 5d0a 0a20 2020 2020 2020 2023  None]..        #
+00011ff0: 204f 7468 6572 7769 7365 2c20 6765 7420   Otherwise, get 
+00012000: 6578 7465 6e74 2066 726f 6d20 6d61 736b  extent from mask
+00012010: 0a20 2020 2020 2020 2073 656c 662e 6372  .        self.cr
+00012020: 6561 7465 5f6d 6173 6b28 290a 2020 2020  eate_mask().    
+00012030: 2020 2020 6966 2069 5f61 7820 213d 2032      if i_ax != 2
+00012040: 3a20 2023 2054 7261 6e73 706f 7365 2078  :  # Transpose x
+00012050: 2d79 2061 7865 730a 2020 2020 2020 2020  -y axes.        
+00012060: 2020 2020 695f 6178 203d 2031 202d 2069      i_ax = 1 - i
+00012070: 5f61 780a 0a20 2020 2020 2020 2023 2047  _ax..        # G
+00012080: 6574 2070 6f73 6974 696f 6e73 206f 6620  et positions of 
+00012090: 766f 7865 6c73 2069 6e73 6964 6520 7468  voxels inside th
+000120a0: 6520 6d61 736b 0a20 2020 2020 2020 2069  e mask.        i
+000120b0: 6620 6e6f 7420 7369 6e67 6c65 5f73 6c69  f not single_sli
+000120c0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+000120d0: 6e6f 6e7a 6572 6f20 3d20 6e70 2e61 7267  nonzero = np.arg
+000120e0: 7768 6572 6528 7365 6c66 2e67 6574 5f6d  where(self.get_m
+000120f0: 6173 6b28 7374 616e 6461 7264 6973 653d  ask(standardise=
+00012100: 5472 7565 2929 0a20 2020 2020 2020 2065  True)).        e
+00012110: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00012120: 206e 6f6e 7a65 726f 203d 206e 702e 6172   nonzero = np.ar
+00012130: 6777 6865 7265 2873 656c 662e 6765 745f  gwhere(self.get_
+00012140: 736c 6963 6528 0a20 2020 2020 2020 2020  slice(.         
+00012150: 2020 2020 2020 2076 6965 772c 2073 6c3d         view, sl=
+00012160: 736c 2c20 6964 783d 6964 782c 2070 6f73  sl, idx=idx, pos
+00012170: 3d70 6f73 2929 0a20 2020 2020 2020 2076  =pos)).        v
+00012180: 616c 7320 3d20 6e6f 6e7a 6572 6f5b 3a2c  als = nonzero[:,
+00012190: 2069 5f61 785d 0a20 2020 2020 2020 2069   i_ax].        i
+000121a0: 6620 6e6f 7420 6c65 6e28 7661 6c73 293a  f not len(vals):
+000121b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000121c0: 7572 6e20 5b4e 6f6e 652c 204e 6f6e 655d  urn [None, None]
+000121d0: 0a0a 2020 2020 2020 2020 2320 4669 6e64  ..        # Find
+000121e0: 206d 696e 2061 6e64 206d 6178 2076 6f78   min and max vox
+000121f0: 656c 733b 2061 6464 2068 616c 6620 6120  els; add half a 
+00012200: 766f 7865 6c20 6569 7468 6572 2073 6964  voxel either sid
+00012210: 6520 746f 2067 6574 200a 2020 2020 2020  e to get .      
+00012220: 2020 2320 6675 6c6c 2065 7874 656e 740a    # full extent.
+00012230: 2020 2020 2020 2020 6d69 6e5f 706f 7320          min_pos 
+00012240: 3d20 6d69 6e28 7661 6c73 2920 2d20 302e  = min(vals) - 0.
+00012250: 350a 2020 2020 2020 2020 6d61 785f 706f  5.        max_po
+00012260: 7320 3d20 6d61 7828 7661 6c73 2920 2b20  s = max(vals) + 
+00012270: 302e 350a 0a20 2020 2020 2020 2023 2043  0.5..        # C
+00012280: 6f6e 7665 7274 2070 6f73 6974 696f 6e73  onvert positions
+00012290: 2074 6f20 6d6d 0a20 2020 2020 2020 2072   to mm.        r
+000122a0: 6574 7572 6e20 5b73 656c 662e 6964 785f  eturn [self.idx_
+000122b0: 746f 5f70 6f73 286d 696e 5f70 6f73 2c20  to_pos(min_pos, 
+000122c0: 6178 2920 2d20 6f72 6967 696e 2c0a 2020  ax) - origin,.  
+000122d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000122e0: 6c66 2e69 6478 5f74 6f5f 706f 7328 6d61  lf.idx_to_pos(ma
+000122f0: 785f 706f 732c 2061 7829 202d 206f 7269  x_pos, ax) - ori
+00012300: 6769 6e5d 0a0a 2020 2020 6465 6620 6765  gin]..    def ge
+00012310: 745f 6372 6f70 5f6c 696d 6974 7328 7365  t_crop_limits(se
+00012320: 6c66 2c20 6372 6f70 5f6d 6172 6769 6e73  lf, crop_margins
+00012330: 3d4e 6f6e 652c 206d 6574 686f 643d 4e6f  =None, method=No
+00012340: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+00012350: 0a20 2020 2020 2020 2047 6574 2063 726f  .        Get cro
+00012360: 7020 6c69 6d69 7473 2063 6f72 7265 7370  p limits corresp
+00012370: 6f6e 6469 6e67 2074 6f20 524f 4920 6578  onding to ROI ex
+00012380: 7465 6e74 7320 706c 7573 206d 6172 6769  tents plus margi
+00012390: 6e73 2e0a 0a20 2020 2020 2020 2054 6865  ns...        The
+000123a0: 2074 7570 6c65 7320 6f66 206c 696d 6974   tuples of limit
+000123b0: 7320 7265 7475 726e 6564 2c20 696e 2074  s returned, in t
+000123c0: 6865 206f 7264 6572 2028 782c 2079 2c20  he order (x, y, 
+000123d0: 7a29 2063 616e 0a20 2020 2020 2020 2062  z) can.        b
+000123e0: 6520 7573 6564 2c20 666f 7220 6578 616d  e used, for exam
+000123f0: 706c 652c 2061 7320 696e 7075 7473 2074  ple, as inputs t
+00012400: 6f20 736b 7274 2e69 6d61 6765 2e49 6d61  o skrt.image.Ima
+00012410: 6765 2e63 726f 7028 292e 0a0a 2020 2020  ge.crop()...    
+00012420: 2020 2020 5468 6973 206d 6574 686f 6420      This method 
+00012430: 6973 2073 696d 696c 6172 2074 6f20 7468  is similar to th
+00012440: 6520 6d65 7468 6f64 2067 6574 5f65 7874  e method get_ext
+00012450: 656e 7473 2829 2c20 6275 7420 616c 6c6f  ents(), but allo
+00012460: 7773 0a20 2020 2020 2020 2064 6966 6665  ws.        diffe
+00012470: 7265 6e74 206d 6172 6769 6e73 206f 6e20  rent margins on 
+00012480: 6561 6368 2073 6964 6520 6f66 2074 6865  each side of the
+00012490: 2052 4f49 2e0a 0a20 2020 2020 2020 202a   ROI...        *
+000124a0: 2a50 6172 616d 6574 6572 733a 2a2a 0a0a  *Parameters:**..
+000124b0: 2020 2020 2020 2020 6372 6f70 5f6d 6172          crop_mar
+000124c0: 6769 6e73 203a 2066 6c6f 6174 2f74 7570  gins : float/tup
+000124d0: 6c65 2c20 6465 6661 756c 743d 4e6f 6e65  le, default=None
+000124e0: 0a20 2020 2020 2020 2020 2020 2046 6c6f  .            Flo
+000124f0: 6174 206f 7220 7468 7265 652d 656c 656d  at or three-elem
+00012500: 656e 7420 7475 706c 6520 7370 6563 6966  ent tuple specif
+00012510: 7969 6e67 2074 6865 206d 6172 6769 6e73  ying the margins
+00012520: 2c20 696e 206d 6d2c 0a20 2020 2020 2020  , in mm,.       
+00012530: 2020 2020 2074 6f20 6265 2061 6464 6564       to be added
+00012540: 2074 6f20 524f 4920 6578 7465 6e74 732e   to ROI extents.
+00012550: 2020 4966 2061 2066 6c6f 6174 2c20 6d69    If a float, mi
+00012560: 6e75 7320 616e 6420 706c 7573 2074 6865  nus and plus the
+00012570: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00012580: 7565 2073 7065 6369 6669 6564 2061 7265  ue specified are
+00012590: 2061 6464 6564 2074 6f20 6c6f 7765 7220   added to lower 
+000125a0: 616e 6420 7570 7065 7220 6578 7465 6e74  and upper extent
+000125b0: 7320 7265 7370 6563 7469 7665 6c79 0a20  s respectively. 
+000125c0: 2020 2020 2020 2020 2020 2061 6c6f 6e67             along
+000125d0: 2065 6163 6820 6178 6973 2e20 2049 6620   each axis.  If 
+000125e0: 6120 7468 7265 652d 656c 656d 656e 7420  a three-element 
+000125f0: 7475 706c 652c 2065 6c65 6d65 6e74 7320  tuple, elements 
+00012600: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
+00012610: 7461 6b65 6e20 746f 2073 7065 6369 6679  taken to specify
+00012620: 206d 6172 6769 6e73 2069 6e20 7468 6520   margins in the 
+00012630: 6f72 6465 7220 2878 2c20 792c 207a 292e  order (x, y, z).
+00012640: 2020 456c 656d 656e 7473 0a20 2020 2020    Elements.     
+00012650: 2020 2020 2020 2063 616e 2062 6520 6569         can be ei
+00012660: 7468 6572 2066 6c6f 6174 7320 286d 696e  ther floats (min
+00012670: 7573 2061 6e64 2070 6c75 7320 7468 6520  us and plus the 
+00012680: 7661 6c75 6520 6164 6465 6420 7265 7370  value added resp
+00012690: 6563 7469 7665 6c79 0a20 2020 2020 2020  ectively.       
+000126a0: 2020 2020 2074 6f20 6c6f 7765 7220 616e       to lower an
+000126b0: 6420 7570 7065 7220 6578 7465 6e74 7329  d upper extents)
+000126c0: 206f 7220 7477 6f2d 656c 656d 656e 7420   or two-element 
+000126d0: 7475 706c 6573 2028 656c 656d 656e 7473  tuples (elements
+000126e0: 2030 2061 6e64 2031 0a20 2020 2020 2020   0 and 1.       
+000126f0: 2020 2020 2061 6464 6564 2072 6573 7065       added respe
+00012700: 6374 6976 656c 7920 746f 206c 6f77 6572  ctively to lower
+00012710: 2061 6e64 2075 7070 6572 2065 7874 656e   and upper exten
+00012720: 7473 292e 0a0a 2020 2020 2020 2020 6d65  ts)...        me
+00012730: 7468 6f64 203a 2073 7472 2c20 6465 6661  thod : str, defa
+00012740: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+00012750: 2020 2020 204d 6574 686f 6420 746f 2075       Method to u
+00012760: 7365 2066 6f72 2065 7874 656e 7420 6361  se for extent ca
+00012770: 6c63 756c 6174 696f 6e2e 2043 616e 2062  lculation. Can b
+00012780: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
+00012790: 2020 2020 2a20 2263 6f6e 746f 7572 223a      * "contour":
+000127a0: 2067 6574 2065 7874 656e 7420 6672 6f6d   get extent from
+000127b0: 206d 696e 2f6d 6178 2070 6f73 6974 696f   min/max positio
+000127c0: 6e73 206f 6620 636f 6e74 6f75 7228 7329  ns of contour(s)
+000127d0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000127e0: 2020 2a20 226d 6173 6b22 3a20 6765 7420    * "mask": get 
+000127f0: 6578 7465 6e74 2066 726f 6d20 6d69 6e2f  extent from min/
+00012800: 6d61 7820 706f 7369 7469 6f6e 7320 6f66  max positions of
+00012810: 2076 6f78 656c 7320 696e 2074 6865 0a20   voxels in the. 
+00012820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012830: 2062 696e 6172 7920 6d61 736b 2e0a 2020   binary mask..  
+00012840: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
+00012850: 4e6f 6e65 3a20 7573 6520 7468 6520 6d65  None: use the me
+00012860: 7468 6f64 2073 6574 2069 6e20 7365 6c66  thod set in self
+00012870: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
+00012880: 7468 6f64 2e0a 2020 2020 2020 2020 2222  thod..        ""
+00012890: 220a 2020 2020 2020 2020 6372 6f70 5f6c  ".        crop_l
+000128a0: 696d 6974 7320 3d20 7365 6c66 2e67 6574  imits = self.get
+000128b0: 5f65 7874 656e 7473 286d 6574 686f 643d  _extents(method=
+000128c0: 6d65 7468 6f64 290a 2020 2020 2020 2020  method).        
+000128d0: 6d61 7267 696e 7320 3d20 736b 7274 2e69  margins = skrt.i
+000128e0: 6d61 6765 2e63 6865 636b 6564 5f63 726f  mage.checked_cro
+000128f0: 705f 6c69 6d69 7473 2863 726f 705f 6d61  p_limits(crop_ma
+00012900: 7267 696e 7329 0a20 2020 2020 2020 2066  rgins).        f
+00012910: 6f72 2069 6478 3120 696e 2072 616e 6765  or idx1 in range
+00012920: 2833 293a 0a20 2020 2020 2020 2020 2020  (3):.           
+00012930: 2069 6620 6d61 7267 696e 735b 6964 7831   if margins[idx1
+00012940: 5d20 6973 206e 6f74 204e 6f6e 653a 0a20  ] is not None:. 
+00012950: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00012960: 6f72 2069 6478 3220 696e 2072 616e 6765  or idx2 in range
+00012970: 2832 293a 0a20 2020 2020 2020 2020 2020  (2):.           
+00012980: 2020 2020 2020 2020 2063 726f 705f 6c69           crop_li
+00012990: 6d69 7473 5b69 6478 315d 5b69 6478 325d  mits[idx1][idx2]
+000129a0: 202b 3d20 6d61 7267 696e 735b 6964 7831   += margins[idx1
+000129b0: 5d5b 6964 7832 5d0a 0a20 2020 2020 2020  ][idx2]..       
+000129c0: 2072 6574 7572 6e20 6372 6f70 5f6c 696d   return crop_lim
+000129d0: 6974 730a 0a20 2020 2064 6566 2067 6574  its..    def get
+000129e0: 5f6c 656e 6774 6828 0a20 2020 2020 2020  _length(.       
+000129f0: 2073 656c 662c 200a 2020 2020 2020 2020   self, .        
+00012a00: 6178 3d22 7a22 2c20 0a20 2020 2020 2020  ax="z", .       
+00012a10: 2073 696e 676c 655f 736c 6963 653d 4661   single_slice=Fa
+00012a20: 6c73 652c 0a20 2020 2020 2020 2076 6965  lse,.        vie
+00012a30: 773d 2278 2d79 222c 0a20 2020 2020 2020  w="x-y",.       
+00012a40: 2073 6c3d 4e6f 6e65 2c20 0a20 2020 2020   sl=None, .     
+00012a50: 2020 2069 6478 3d4e 6f6e 652c 200a 2020     idx=None, .  
+00012a60: 2020 2020 2020 706f 733d 4e6f 6e65 2c20        pos=None, 
+00012a70: 0a20 2020 2020 2020 2075 6e69 7473 3d22  .        units="
+00012a80: 6d6d 222c 0a20 2020 2020 2020 206d 6574  mm",.        met
+00012a90: 686f 643d 4e6f 6e65 2c20 0a20 2020 2020  hod=None, .     
+00012aa0: 2020 2066 6f72 6365 3d54 7275 650a 2020     force=True.  
+00012ab0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+00012ac0: 4765 7420 524f 4920 6c65 6e67 7468 2061  Get ROI length a
+00012ad0: 6c6f 6e67 2061 2067 6976 656e 2061 7869  long a given axi
+00012ae0: 732e 2049 6620 7369 6e67 6c65 5f73 6c69  s. If single_sli
+00012af0: 6365 3d46 616c 7365 2028 692e 652e 2061  ce=False (i.e. a
+00012b00: 200a 2020 2020 2020 2020 676c 6f62 616c   .        global
+00012b10: 206c 656e 6774 6820 6973 2072 6571 7565   length is reque
+00012b20: 7374 6564 292c 2063 616c 6375 6c61 7465  sted), calculate
+00012b30: 6420 6c65 6e67 7468 2077 696c 6c20 6265  d length will be
+00012b40: 2063 6163 6865 6420 696e 200a 2020 2020   cached in .    
+00012b50: 2020 2020 7365 6c66 2e5f 6c65 6e67 7468      self._length
+00012b60: 5b61 785d 5b75 6e69 7473 5d20 616e 6420  [ax][units] and 
+00012b70: 7265 7475 726e 6564 2069 6620 6361 6c6c  returned if call
+00012b80: 6564 2061 6761 696e 2c20 756e 6c65 7373  ed again, unless
+00012b90: 2066 6f72 6365 3d54 7275 652e 0a0a 2020   force=True...  
+00012ba0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+00012bb0: 7273 3a2a 2a0a 2020 2020 2020 2020 0a20  rs:**.        . 
+00012bc0: 2020 2020 2020 2061 7820 3a20 7374 722f         ax : str/
+00012bd0: 696e 742c 2064 6566 6175 6c74 3d22 7a22  int, default="z"
+00012be0: 0a20 2020 2020 2020 2020 2020 2041 7869  .            Axi
+00012bf0: 7320 616c 6f6e 6720 7768 6963 6820 746f  s along which to
+00012c00: 2072 6574 7572 6e20 6c65 6e67 7468 3b20   return length; 
+00012c10: 7368 6f75 6c64 2062 6520 6f6e 6520 6f66  should be one of
+00012c20: 205b 2278 222c 2022 7922 2c20 227a 225d   ["x", "y", "z"]
+00012c30: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
+00012c40: 5b30 2c20 312c 2032 5d2e 0a0a 2020 2020  [0, 1, 2]...    
+00012c50: 2020 2020 7369 6e67 6c65 5f73 6c69 6365      single_slice
+00012c60: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+00012c70: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+00012c80: 2020 2049 6620 4661 6c73 652c 2074 6865     If False, the
+00012c90: 206c 656e 6774 6820 6f66 2074 6865 2065   length of the e
+00012ca0: 6e74 6972 6520 524f 4920 7769 6c6c 2062  ntire ROI will b
+00012cb0: 6520 7265 7475 726e 6564 3b0a 2020 2020  e returned;.    
+00012cc0: 2020 2020 2020 2020 6f74 6865 7277 6973          otherwis
+00012cd0: 652c 2074 6865 206c 656e 6774 6820 6f6e  e, the length on
+00012ce0: 2061 2073 696e 676c 6520 736c 6963 6520   a single slice 
+00012cf0: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
+00012d00: 2e0a 0a20 2020 2020 2020 2076 6965 7720  ...        view 
+00012d10: 3a20 7374 722c 2064 6566 6175 6c74 3d22  : str, default="
+00012d20: 782d 7922 0a20 2020 2020 2020 2020 2020  x-y".           
+00012d30: 204f 7269 656e 7461 7469 6f6e 206f 6620   Orientation of 
+00012d40: 736c 6963 6520 6f6e 2077 6869 6368 2074  slice on which t
+00012d50: 6f20 6765 7420 6c65 6e67 7468 2e20 4f6e  o get length. On
+00012d60: 6c79 2075 7365 6420 6966 200a 2020 2020  ly used if .    
+00012d70: 2020 2020 2020 2020 7369 6e67 6c65 5f73          single_s
+00012d80: 6c69 6365 3d54 7275 652e 2049 6620 7573  lice=True. If us
+00012d90: 696e 672c 203c 6178 3e20 6d75 7374 2062  ing, <ax> must b
+00012da0: 6520 616e 2061 7869 7320 7468 6174 206c  e an axis that l
+00012db0: 6965 7320 616c 6f6e 670a 2020 2020 2020  ies along.      
+00012dc0: 2020 2020 2020 7468 6520 736c 6963 6520        the slice 
+00012dd0: 696e 2074 6869 7320 6f72 6965 6e74 6174  in this orientat
+00012de0: 696f 6e2e 0a0a 2020 2020 2020 2020 736c  ion...        sl
+00012df0: 203a 2069 6e74 2c20 6465 6661 756c 743d   : int, default=
+00012e00: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00012e10: 2053 6c69 6365 206e 756d 6265 722e 2049   Slice number. I
+00012e20: 6620 6e6f 6e65 206f 6620 3c73 6c3e 2c20  f none of <sl>, 
+00012e30: 3c69 6478 3e20 6f72 203c 706f 733e 2061  <idx> or <pos> a
+00012e40: 7265 2073 7570 706c 6965 6420 6275 740a  re supplied but.
+00012e50: 2020 2020 2020 2020 2020 2020 3c73 696e              <sin
+00012e60: 676c 655f 736c 6963 653e 2069 7320 5472  gle_slice> is Tr
+00012e70: 7565 2c20 7468 6520 6365 6e74 7261 6c20  ue, the central 
+00012e80: 736c 6963 6520 6f66 2074 6865 2052 4f49  slice of the ROI
+00012e90: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
+00012ea0: 2020 2020 2020 2020 6964 7820 3a20 696e          idx : in
+00012eb0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+00012ec0: 2020 2020 2020 2020 2020 2020 4172 7261              Arra
+00012ed0: 7920 696e 6465 7820 6f66 2073 6c69 6365  y index of slice
+00012ee0: 2e20 4966 206e 6f6e 6520 6f66 203c 736c  . If none of <sl
+00012ef0: 3e2c 203c 6964 783e 206f 7220 3c70 6f73  >, <idx> or <pos
+00012f00: 3e20 6172 6520 7375 7070 6c69 6564 2062  > are supplied b
+00012f10: 7574 0a20 2020 2020 2020 2020 2020 203c  ut.            <
+00012f20: 7369 6e67 6c65 5f73 6c69 6365 3e20 6973  single_slice> is
+00012f30: 2054 7275 652c 2074 6865 2063 656e 7472   True, the centr
+00012f40: 616c 2073 6c69 6365 206f 6620 7468 6520  al slice of the 
+00012f50: 524f 4920 7769 6c6c 2062 6520 7573 6564  ROI will be used
+00012f60: 2e0a 0a20 2020 2020 2020 2070 6f73 203a  ...        pos :
+00012f70: 2066 6c6f 6174 2c20 6465 6661 756c 743d   float, default=
+00012f80: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00012f90: 2053 6c69 6365 2070 6f73 6974 696f 6e20   Slice position 
+00012fa0: 696e 206d 6d2e 2049 6620 6e6f 6e65 206f  in mm. If none o
+00012fb0: 6620 3c73 6c3e 2c20 3c69 6478 3e20 6f72  f <sl>, <idx> or
+00012fc0: 203c 706f 733e 2061 7265 2073 7570 706c   <pos> are suppl
+00012fd0: 6965 6420 6275 740a 2020 2020 2020 2020  ied but.        
+00012fe0: 2020 2020 3c73 696e 676c 655f 736c 6963      <single_slic
+00012ff0: 653e 2069 7320 5472 7565 2c20 7468 6520  e> is True, the 
+00013000: 6365 6e74 7261 6c20 736c 6963 6520 6f66  central slice of
+00013010: 2074 6865 2052 4f49 2077 696c 6c20 6265   the ROI will be
+00013020: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
+00013030: 756e 6974 7320 3a20 7374 722c 2064 6566  units : str, def
+00013040: 6175 6c74 3d22 6d6d 220a 2020 2020 2020  ault="mm".      
+00013050: 2020 2020 2020 556e 6974 7320 6f66 206c        Units of l
+00013060: 656e 6774 682e 2043 616e 2062 6520 6569  ength. Can be ei
+00013070: 7468 6572 206f 663a 0a20 2020 2020 2020  ther of:.       
+00013080: 2020 2020 2020 2020 202d 2022 6d6d 223a           - "mm":
+00013090: 2072 6574 7572 6e20 6c65 6e67 7468 2069   return length i
+000130a0: 6e20 6d69 6c6c 696d 6574 7265 732e 0a20  n millimetres.. 
+000130b0: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+000130c0: 2022 766f 7865 6c73 223a 2072 6574 7572   "voxels": retur
+000130d0: 6e20 6c65 6e67 7468 2069 6e20 6e75 6d62  n length in numb
+000130e0: 6572 206f 6620 766f 7865 6c73 2e0a 0a20  er of voxels... 
+000130f0: 2020 2020 2020 2020 2020 2049 6620 756e             If un
+00013100: 6974 733d 2276 6f78 656c 7322 2069 7320  its="voxels" is 
+00013110: 7265 7175 6573 7465 6420 6275 7420 7468  requested but th
+00013120: 6973 2052 4f49 206f 6e6c 7920 6861 7320  is ROI only has 
+00013130: 636f 6e74 6f75 7273 2061 6e64 206e 6f0a  contours and no.
+00013140: 2020 2020 2020 2020 2020 2020 766f 7865              voxe
+00013150: 6c20 7369 7a65 2069 6e66 6f72 6d61 7469  l size informati
+00013160: 6f6e 2c20 616e 2065 7272 6f72 2077 696c  on, an error wil
+00013170: 6c20 6265 2072 6169 7365 6420 2875 6e6c  l be raised (unl
+00013180: 6573 7320 6178 3d22 7a22 2c20 0a20 2020  ess ax="z", .   
+00013190: 2020 2020 2020 2020 2069 6e20 7768 6963           in whic
+000131a0: 6820 6361 7365 2076 6f78 656c 2073 697a  h case voxel siz
+000131b0: 6520 7769 6c6c 2062 6520 696e 6665 7272  e will be inferr
+000131c0: 6564 2066 726f 6d20 7370 6163 696e 6720  ed from spacing 
+000131d0: 6265 7477 6565 6e0a 2020 2020 2020 2020  between.        
+000131e0: 2020 2020 736c 6963 6573 292e 0a0a 2020      slices)...  
+000131f0: 2020 2020 2020 6d65 7468 6f64 203a 2073        method : s
+00013200: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
+00013210: 0a20 2020 2020 2020 2020 2020 204d 6574  .            Met
+00013220: 686f 6420 746f 2075 7365 2066 6f72 206c  hod to use for l
+00013230: 656e 6774 6820 6361 6c63 756c 6174 696f  ength calculatio
+00013240: 6e2e 2043 616e 2062 653a 200a 2020 2020  n. Can be: .    
+00013250: 2020 2020 2020 2020 2020 2020 2d20 2263              - "c
+00013260: 6f6e 746f 7572 223a 2067 6574 206c 656e  ontour": get len
+00013270: 6774 6820 6672 6f6d 206d 696e 2f6d 6178  gth from min/max
+00013280: 2070 6f73 6974 696f 6e73 206f 6620 636f   positions of co
+00013290: 6e74 6f75 7228 7329 2e0a 2020 2020 2020  ntour(s)..      
+000132a0: 2020 2020 2020 2020 2020 2d20 226d 6173            - "mas
+000132b0: 6b22 3a20 6765 7420 6c65 6e67 7468 2066  k": get length f
+000132c0: 726f 6d20 6d69 6e2f 6d61 7820 706f 7369  rom min/max posi
+000132d0: 7469 6f6e 7320 6f66 2076 6f78 656c 7320  tions of voxels 
+000132e0: 696e 2074 6865 200a 2020 2020 2020 2020  in the .        
+000132f0: 2020 2020 2020 2020 2020 6269 6e61 7279            binary
+00013300: 206d 6173 6b2e 0a20 2020 2020 2020 2020   mask..         
+00013310: 2020 2020 2020 202d 204e 6f6e 653a 2075         - None: u
+00013320: 7365 2074 6865 206d 6574 686f 6420 7365  se the method se
+00013330: 7420 696e 2073 656c 662e 6465 6661 756c  t in self.defaul
+00013340: 745f 6765 6f6d 5f6d 6574 686f 642e 0a0a  t_geom_method...
+00013350: 2020 2020 2020 2020 666f 7263 6520 3a20          force : 
+00013360: 626f 6f6c 2c20 6465 6661 756c 743d 5472  bool, default=Tr
+00013370: 7565 0a20 2020 2020 2020 2020 2020 2049  ue.            I
+00013380: 6620 5472 7565 2c20 7468 6520 6c65 6e67  f True, the leng
+00013390: 7468 2077 696c 6c20 616c 7761 7973 2062  th will always b
+000133a0: 6520 7265 6361 6c63 756c 6174 6564 3b20  e recalculated; 
+000133b0: 6f74 6865 7277 6973 652c 2069 7420 7769  otherwise, it wi
+000133c0: 6c6c 0a20 2020 2020 2020 2020 2020 206f  ll.            o
+000133d0: 6e6c 7920 6265 2063 616c 6375 6c61 7465  nly be calculate
+000133e0: 6420 6966 2069 7420 6861 7320 6e6f 7420  d if it has not 
+000133f0: 7965 7420 6265 656e 2063 6163 6865 6420  yet been cached 
+00013400: 696e 2073 656c 662e 5f76 6f6c 756d 652e  in self._volume.
+00013410: 0a20 2020 2020 2020 2020 2020 204e 6f74  .            Not
+00013420: 6520 7468 6174 2069 6620 7369 6e67 6c65  e that if single
+00013430: 5f73 6c69 6365 3d54 7275 652c 2074 6865  _slice=True, the
+00013440: 206c 656e 6774 6820 7769 6c6c 2061 6c77   length will alw
+00013450: 6179 7320 6265 200a 2020 2020 2020 2020  ays be .        
+00013460: 2020 2020 7265 6361 6c63 756c 6174 6564      recalculated
+00013470: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+00013480: 2020 2020 2020 2023 2049 6620 676c 6f62         # If glob
+00013490: 616c 206c 656e 6774 6820 616c 7265 6164  al length alread
+000134a0: 7920 6361 6368 6564 2c20 7265 7475 726e  y cached, return
+000134b0: 2063 6163 6865 6420 7661 6c75 650a 2020   cached value.  
+000134c0: 2020 2020 2020 6966 206e 6f74 2073 696e        if not sin
+000134d0: 676c 655f 736c 6963 6520 616e 6420 6e6f  gle_slice and no
+000134e0: 7420 666f 7263 653a 0a20 2020 2020 2020  t force:.       
+000134f0: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
+00013500: 7365 6c66 2c20 225f 6c65 6e67 7468 2229  self, "_length")
+00013510: 2061 6e64 2061 7820 696e 2073 656c 662e   and ax in self.
+00013520: 5f6c 656e 6774 6820 5c0a 2020 2020 2020  _length \.      
+00013530: 2020 2020 2020 2020 2061 6e64 2075 6e69           and uni
+00013540: 7473 2069 6e20 7365 6c66 2e5f 6c65 6e67  ts in self._leng
+00013550: 7468 5b61 785d 3a0a 2020 2020 2020 2020  th[ax]:.        
+00013560: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00013570: 656c 662e 5f6c 656e 6774 685b 6178 5d5b  elf._length[ax][
+00013580: 756e 6974 735d 0a0a 2020 2020 2020 2020  units]..        
+00013590: 2320 4966 2073 696e 676c 6520 736c 6963  # If single slic
+000135a0: 6520 7265 7175 6573 7465 6420 616e 6420  e requested and 
+000135b0: 6e6f 7420 6f6e 2063 7572 7265 6e74 2073  not on current s
+000135c0: 6c69 6365 2c20 7265 7475 726e 204e 6f6e  lice, return Non
+000135d0: 650a 2020 2020 2020 2020 6966 2073 696e  e.        if sin
+000135e0: 676c 655f 736c 6963 6520 616e 6420 6e6f  gle_slice and no
+000135f0: 7420 7365 6c66 2e6f 6e5f 736c 6963 6528  t self.on_slice(
+00013600: 7669 6577 2c20 736c 3d73 6c2c 2069 6478  view, sl=sl, idx
+00013610: 3d69 6478 2c20 706f 733d 706f 7329 3a0a  =idx, pos=pos):.
+00013620: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00013630: 726e 204e 6f6e 650a 0a20 2020 2020 2020  rn None..       
+00013640: 2023 2047 6574 206c 656e 6774 6820 696e   # Get length in
+00013650: 206d 6d20 6672 6f6d 206d 696e 2061 6e64   mm from min and
+00013660: 206d 6178 2070 6f73 6974 696f 6e73 0a20   max positions. 
+00013670: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
+00013680: 2829 0a20 2020 2020 2020 206d 696e 5f70  ().        min_p
+00013690: 6f73 2c20 6d61 785f 706f 7320 3d20 7365  os, max_pos = se
+000136a0: 6c66 2e67 6574 5f65 7874 656e 7428 0a20  lf.get_extent(. 
+000136b0: 2020 2020 2020 2020 2020 2061 783d 6178             ax=ax
+000136c0: 2c20 0a20 2020 2020 2020 2020 2020 2073  , .            s
+000136d0: 696e 676c 655f 736c 6963 653d 7369 6e67  ingle_slice=sing
+000136e0: 6c65 5f73 6c69 6365 2c0a 2020 2020 2020  le_slice,.      
+000136f0: 2020 2020 2020 7669 6577 3d76 6965 772c        view=view,
+00013700: 0a20 2020 2020 2020 2020 2020 2073 6c3d  .            sl=
+00013710: 736c 2c0a 2020 2020 2020 2020 2020 2020  sl,.            
+00013720: 6964 783d 6964 782c 0a20 2020 2020 2020  idx=idx,.       
+00013730: 2020 2020 2070 6f73 3d70 6f73 2c0a 2020       pos=pos,.  
+00013740: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+00013750: 3d6d 6574 686f 640a 2020 2020 2020 2020  =method.        
+00013760: 290a 2020 2020 2020 2020 6c65 6e67 7468  ).        length
+00013770: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+00013780: 2022 6d6d 223a 2061 6273 286d 6178 5f70   "mm": abs(max_p
+00013790: 6f73 202d 206d 696e 5f70 6f73 290a 2020  os - min_pos).  
+000137a0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+000137b0: 2023 2047 6574 206c 656e 6774 6820 696e   # Get length in
+000137c0: 2076 6f78 656c 730a 2020 2020 2020 2020   voxels.        
+000137d0: 2320 4361 7365 2077 6865 7265 2076 6f78  # Case where vox
+000137e0: 656c 2073 697a 6520 6973 206b 6e6f 776e  el size is known
+000137f0: 0a20 2020 2020 2020 2069 5f61 7820 3d20  .        i_ax = 
+00013800: 736b 7274 2e69 6d61 6765 2e5f 6178 6573  skrt.image._axes
+00013810: 2e69 6e64 6578 2861 7829 2069 6620 6973  .index(ax) if is
+00013820: 696e 7374 616e 6365 2861 782c 2073 7472  instance(ax, str
+00013830: 2920 656c 7365 2061 780a 2020 2020 2020  ) else ax.      
+00013840: 2020 6966 2073 656c 662e 766f 7865 6c5f    if self.voxel_
+00013850: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
+00013860: 3a0a 2020 2020 2020 2020 2020 2020 6c65  :.            le
+00013870: 6e67 7468 5b22 766f 7865 6c73 225d 203d  ngth["voxels"] =
+00013880: 206c 656e 6774 685b 226d 6d22 5d20 2f20   length["mm"] / 
+00013890: 7365 6c66 2e76 6f78 656c 5f73 697a 655b  self.voxel_size[
+000138a0: 695f 6178 5d0a 0a20 2020 2020 2020 2023  i_ax]..        #
+000138b0: 2044 6561 6c20 7769 7468 2063 6173 6520   Deal with case 
+000138c0: 7768 6572 6520 7365 6c66 2e76 6f78 656c  where self.voxel
+000138d0: 5f73 697a 6520 6973 204e 6f6e 650a 2020  _size is None.  
+000138e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000138f0: 2020 2020 2020 2020 6966 2069 5f61 7820          if i_ax 
+00013900: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
+00013910: 2020 2020 2020 6c65 6e67 7468 5b22 766f        length["vo
+00013920: 7865 6c73 225d 203d 206c 656e 6774 685b  xels"] = length[
+00013930: 226d 6d22 5d20 2f20 7365 6c66 2e67 6574  "mm"] / self.get
+00013940: 5f73 6c69 6365 5f74 6869 636b 6e65 7373  _slice_thickness
+00013950: 5f63 6f6e 746f 7572 7328 290a 2020 2020  _contours().    
+00013960: 2020 2020 2020 2020 656c 6966 2075 6e69          elif uni
+00013970: 7473 203d 3d20 2276 6f78 656c 7322 3a0a  ts == "voxels":.
+00013980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013990: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
+000139a0: 6f72 2822 4361 6e6e 6f74 2063 6f6d 7075  or("Cannot compu
+000139b0: 7465 206c 656e 6774 6820 696e 2076 6f78  te length in vox
+000139c0: 656c 7320 6672 6f6d 2022 0a20 2020 2020  els from ".     
+000139d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000139e0: 2020 2020 2020 2020 2020 2020 2020 2263                "c
+000139f0: 6f6e 746f 7572 7320 7769 7468 6f75 7420  ontours without 
+00013a00: 6b6e 6f77 696e 6720 766f 7865 6c20 7369  knowing voxel si
+00013a10: 7a65 7321 2229 0a0a 2020 2020 2020 2020  zes!")..        
+00013a20: 0a20 2020 2020 2020 2023 2043 6163 6865  .        # Cache
+00013a30: 2074 6865 2070 726f 7065 7274 7920 6966   the property if
+00013a40: 2067 6c6f 6261 6c0a 2020 2020 2020 2020   global.        
+00013a50: 6966 206e 6f74 2073 696e 676c 655f 736c  if not single_sl
+00013a60: 6963 653a 0a20 2020 2020 2020 2020 2020  ice:.           
+00013a70: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
+00013a80: 7365 6c66 2c20 225f 6c65 6e67 7468 2229  self, "_length")
+00013a90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013aa0: 2020 7365 6c66 2e5f 6c65 6e67 7468 203d    self._length =
+00013ab0: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
+00013ac0: 7365 6c66 2e5f 6c65 6e67 7468 5b73 6b72  self._length[skr
+00013ad0: 742e 696d 6167 652e 5f61 7865 735b 695f  t.image._axes[i_
+00013ae0: 6178 5d5d 203d 206c 656e 6774 680a 2020  ax]] = length.  
+00013af0: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
+00013b00: 2052 6574 7572 6e20 6465 7369 7265 6420   Return desired 
+00013b10: 756e 6974 730a 2020 2020 2020 2020 7265  units.        re
+00013b20: 7475 726e 206c 656e 6774 685b 756e 6974  turn length[unit
+00013b30: 735d 0a0a 2020 2020 6465 6620 6765 745f  s]..    def get_
+00013b40: 6765 6f6d 6574 7279 280a 2020 2020 2020  geometry(.      
+00013b50: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00013b60: 6d65 7472 6963 733d 4e6f 6e65 2c0a 2020  metrics=None,.  
+00013b70: 2020 2020 2020 766f 6c5f 756e 6974 733d        vol_units=
+00013b80: 226d 6d22 2c0a 2020 2020 2020 2020 6172  "mm",.        ar
+00013b90: 6561 5f75 6e69 7473 3d22 6d6d 222c 0a20  ea_units="mm",. 
+00013ba0: 2020 2020 2020 206c 656e 6774 685f 756e         length_un
+00013bb0: 6974 733d 226d 6d22 2c0a 2020 2020 2020  its="mm",.      
+00013bc0: 2020 6365 6e74 726f 6964 5f75 6e69 7473    centroid_units
+00013bd0: 3d22 6d6d 222c 0a20 2020 2020 2020 2076  ="mm",.        v
+00013be0: 6965 773d 2278 2d79 222c 0a20 2020 2020  iew="x-y",.     
+00013bf0: 2020 2073 6c3d 4e6f 6e65 2c0a 2020 2020     sl=None,.    
+00013c00: 2020 2020 706f 733d 4e6f 6e65 2c0a 2020      pos=None,.  
+00013c10: 2020 2020 2020 6964 783d 4e6f 6e65 2c0a        idx=None,.
+00013c20: 2020 2020 2020 2020 6d65 7468 6f64 3d4e          method=N
+00013c30: 6f6e 652c 0a20 2020 2020 2020 2075 6e69  one,.        uni
+00013c40: 7473 5f69 6e5f 6865 6164 6572 3d46 616c  ts_in_header=Fal
+00013c50: 7365 2c0a 2020 2020 2020 2020 676c 6f62  se,.        glob
+00013c60: 616c 5f76 735f 736c 6963 655f 6865 6164  al_vs_slice_head
+00013c70: 6572 3d46 616c 7365 2c0a 2020 2020 2020  er=False,.      
+00013c80: 2020 6e61 6d65 5f61 735f 696e 6465 783d    name_as_index=
+00013c90: 5472 7565 2c0a 2020 2020 2020 2020 6e69  True,.        ni
+00013ca0: 6365 5f63 6f6c 756d 6e73 3d46 616c 7365  ce_columns=False
+00013cb0: 2c0a 2020 2020 2020 2020 6465 6369 6d61  ,.        decima
+00013cc0: 6c5f 706c 6163 6573 3d4e 6f6e 652c 0a20  l_places=None,. 
+00013cd0: 2020 2020 2020 2066 6f72 6365 3d54 7275         force=Tru
+00013ce0: 652c 0a20 2020 2020 2020 2068 746d 6c3d  e,.        html=
+00013cf0: 4661 6c73 650a 2020 2020 293a 0a20 2020  False.    ):.   
+00013d00: 2020 2020 2022 2222 5265 7475 726e 2061       """Return a
+00013d10: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
+00013d20: 6520 6f72 2068 746d 6c20 7461 626c 6520  e or html table 
+00013d30: 6f66 2074 6865 2067 656f 6d65 7472 6963  of the geometric
+00013d40: 2070 726f 7065 7274 6965 7320 0a20 2020   properties .   
+00013d50: 2020 2020 206c 6973 7465 6420 696e 203c       listed in <
+00013d60: 6d65 7472 6963 733e 2e0a 0a20 2020 2020  metrics>...     
+00013d70: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+00013d80: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
+00013d90: 2020 2020 6d65 7472 6963 7320 3a20 6c69      metrics : li
+00013da0: 7374 2c20 6465 6661 756c 743d 4e6f 6e65  st, default=None
+00013db0: 0a20 2020 2020 2020 2020 2020 204c 6973  .            Lis
+00013dc0: 7420 6f66 206d 6574 7269 6373 2074 6f20  t of metrics to 
+00013dd0: 696e 636c 7564 6520 696e 2074 6865 2074  include in the t
+00013de0: 6162 6c65 2e20 4f70 7469 6f6e 733a 0a0a  able. Options:..
+00013df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e00: 2d20 2276 6f6c 756d 6522 203a 2076 6f6c  - "volume" : vol
+00013e10: 756d 6520 6f66 2065 6e74 6972 6520 524f  ume of entire RO
+00013e20: 492e 0a20 2020 2020 2020 2020 2020 2020  I..             
+00013e30: 2020 202d 2022 6172 6561 223a 2061 7265     - "area": are
+00013e40: 6120 6f66 2052 4f49 206f 6e20 6120 7369  a of ROI on a si
+00013e50: 6e67 6c65 2073 6c69 6365 2e0a 0a20 2020  ngle slice...   
+00013e60: 2020 2020 2020 2020 2020 2020 202d 2022               - "
+00013e70: 6365 6e74 726f 6964 223a 2033 4420 6365  centroid": 3D ce
+00013e80: 6e74 7265 2d6f 662d 6d61 7373 206f 6620  ntre-of-mass of 
+00013e90: 524f 493b 2077 696c 6c20 6265 2073 706c  ROI; will be spl
+00013ea0: 6974 2069 6e74 6f0a 2020 2020 2020 2020  it into.        
+00013eb0: 2020 2020 2020 2020 2020 7468 7265 6520            three 
+00013ec0: 636f 6c75 6d6e 7320 636f 7272 6573 706f  columns correspo
+00013ed0: 6e64 696e 6720 746f 2074 6865 2074 6872  nding to the thr
+00013ee0: 6565 2061 7865 732e 0a20 2020 2020 2020  ee axes..       
+00013ef0: 2020 2020 2020 2020 202d 2022 6365 6e74           - "cent
+00013f00: 726f 6964 5f73 6c69 6365 223a 2032 4420  roid_slice": 2D 
+00013f10: 6365 6e74 7265 206f 6620 6d61 7373 206f  centre of mass o
+00013f20: 6e20 6120 7369 6e67 6c65 2073 6c69 6365  n a single slice
+00013f30: 2e20 5769 6c6c 0a20 2020 2020 2020 2020  . Will.         
+00013f40: 2020 2020 2020 2020 2062 6520 7370 6c69           be spli
+00013f50: 7420 696e 746f 2074 776f 2063 6f6c 756d  t into two colum
+00013f60: 6e73 2063 6f72 7265 7370 6f6e 6469 6e67  ns corresponding
+00013f70: 2074 6f20 7468 6520 7477 6f20 6178 6573   to the two axes
+00013f80: 206f 6e0a 2020 2020 2020 2020 2020 2020   on.            
+00013f90: 2020 2020 2020 7468 6520 736c 6963 652e        the slice.
+00013fa0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013fb0: 2020 2d20 226c 656e 6774 6822 3a20 6c65    - "length": le
+00013fc0: 6e67 7468 7320 6f66 2074 6865 2052 4f49  ngths of the ROI
+00013fd0: 2069 6e20 6561 6368 2064 6972 6563 7469   in each directi
+00013fe0: 6f6e 3b20 7769 6c6c 2062 6520 7370 6c69  on; will be spli
+00013ff0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00014000: 2020 2020 696e 746f 2074 6872 6565 2063      into three c
+00014010: 6f6c 756d 6e73 2063 6f72 7265 7370 6f6e  olumns correspon
+00014020: 6469 6e67 2074 6f20 7468 6520 7468 7265  ding to the thre
+00014030: 6520 6178 6573 2e0a 2020 2020 2020 2020  e axes..        
+00014040: 2020 2020 2020 2020 2d20 226c 656e 6774          - "lengt
+00014050: 685f 736c 6963 6522 3a20 6c65 6e67 7468  h_slice": length
+00014060: 206f 6620 7468 6520 524f 4920 6f6e 2061   of the ROI on a
+00014070: 2073 696e 676c 6520 736c 6963 653b 2077   single slice; w
+00014080: 696c 6c20 6265 0a20 2020 2020 2020 2020  ill be.         
+00014090: 2020 2020 2020 2020 2073 706c 6974 2069           split i
+000140a0: 6e74 6f20 7477 6f20 636f 6c75 6d6e 7320  nto two columns 
+000140b0: 636f 7272 6573 706f 6e64 696e 6720 746f  corresponding to
+000140c0: 2074 6865 2074 776f 2061 7865 7320 6f6e   the two axes on
+000140d0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+000140e0: 2020 2020 2020 2073 6c69 6365 2e0a 0a20         slice... 
+000140f0: 2020 2020 2020 2020 2020 2049 6620 4e6f             If No
+00014100: 6e65 2c20 6465 6661 756c 7473 2074 6f20  ne, defaults to 
+00014110: 5b22 766f 6c75 6d65 222c 2022 6365 6e74  ["volume", "cent
+00014120: 726f 6964 225d 0a0a 2020 2020 2020 2020  roid"]..        
+00014130: 766f 6c5f 756e 6974 7320 3a20 7374 722c  vol_units : str,
+00014140: 2064 6566 6175 6c74 3d22 6d6d 220a 2020   default="mm".  
+00014150: 2020 2020 2020 2020 2020 556e 6974 7320            Units 
+00014160: 746f 2075 7365 2066 6f72 2076 6f6c 756d  to use for volum
+00014170: 652e 2043 616e 2062 6520 226d 6d22 2028  e. Can be "mm" (
+00014180: 3d6d 6d5e 3329 2c20 226d 6c22 2c0a 2020  =mm^3), "ml",.  
+00014190: 2020 2020 2020 2020 2020 6f72 2022 766f            or "vo
+000141a0: 7865 6c73 222e 0a0a 2020 2020 2020 2020  xels"...        
+000141b0: 6172 6561 5f75 6e69 7473 203a 2073 7472  area_units : str
+000141c0: 2c20 6465 6661 756c 743d 226d 6d22 0a20  , default="mm". 
+000141d0: 2020 2020 2020 2020 2020 2055 6e69 7473             Units
+000141e0: 2074 6f20 7573 6520 666f 7220 6172 6561   to use for area
+000141f0: 732e 2043 616e 2062 6520 226d 6d22 2028  s. Can be "mm" (
+00014200: 3d6d 6d5e 3229 206f 7220 2276 6f78 656c  =mm^2) or "voxel
+00014210: 7322 2e0a 0a20 2020 2020 2020 206c 656e  s"...        len
+00014220: 6774 685f 756e 6974 7320 3a20 7374 722c  gth_units : str,
+00014230: 2064 6566 6175 6c74 3d22 6d6d 223a 0a20   default="mm":. 
+00014240: 2020 2020 2020 2020 2020 2055 6e69 7473             Units
+00014250: 2074 6f20 7573 6520 666f 7220 6c65 6e67   to use for leng
+00014260: 7468 732e 2043 616e 2062 6520 226d 6d22  ths. Can be "mm"
+00014270: 206f 7220 2276 6f78 656c 7322 2e0a 0a20   or "voxels"... 
+00014280: 2020 2020 2020 2063 656e 7472 6f69 645f         centroid_
+00014290: 756e 6974 733a 0a20 2020 2020 2020 2020  units:.         
+000142a0: 2020 2055 6e69 7473 2074 6f20 7573 6520     Units to use 
+000142b0: 666f 7220 6365 6e74 726f 6964 732e 2043  for centroids. C
+000142c0: 616e 2062 6520 226d 6d22 206f 7220 2276  an be "mm" or "v
+000142d0: 6f78 656c 7322 2e0a 0a20 2020 2020 2020  oxels"...       
+000142e0: 2076 6965 7720 3a20 7374 722c 2064 6566   view : str, def
+000142f0: 6175 6c74 3d22 782d 7922 0a20 2020 2020  ault="x-y".     
+00014300: 2020 2020 2020 204f 7269 656e 7461 7469         Orientati
+00014310: 6f6e 2069 6e20 7768 6963 6820 746f 2063  on in which to c
+00014320: 6f6d 7075 7465 206d 6574 7269 6373 2e20  ompute metrics. 
+00014330: 4f6e 6c79 2072 656c 6576 616e 7420 666f  Only relevant fo
+00014340: 7220 0a20 2020 2020 2020 2020 2020 2073  r .            s
+00014350: 696e 676c 652d 736c 6963 6520 6d65 7472  ingle-slice metr
+00014360: 6963 7320 2861 7265 612c 2063 656e 7472  ics (area, centr
+00014370: 6f69 645f 736c 6963 652c 206c 656e 6774  oid_slice, lengt
+00014380: 685f 736c 6963 6529 2e0a 0a20 2020 2020  h_slice)...     
+00014390: 2020 2073 6c20 3a20 696e 742c 2064 6566     sl : int, def
+000143a0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+000143b0: 2020 2020 2020 536c 6963 6520 6e75 6d62        Slice numb
+000143c0: 6572 206f 6e20 7768 6963 6820 746f 2063  er on which to c
+000143d0: 6f6d 7075 7465 206d 6574 7269 6373 2e20  ompute metrics. 
+000143e0: 4f6e 6c79 2072 656c 6576 616e 7420 666f  Only relevant fo
+000143f0: 7220 0a20 2020 2020 2020 2020 2020 2073  r .            s
+00014400: 696e 676c 652d 736c 6963 6520 6d65 7472  ingle-slice metr
+00014410: 6963 7320 2861 7265 612c 2063 656e 7472  ics (area, centr
+00014420: 6f69 645f 736c 6963 652c 206c 656e 6774  oid_slice, lengt
+00014430: 685f 736c 6963 6529 2e0a 2020 2020 2020  h_slice)..      
+00014440: 2020 2020 2020 4966 203c 736c 3e2c 203c        If <sl>, <
+00014450: 6964 783e 2c20 616e 6420 3c70 6f73 3e20  idx>, and <pos> 
+00014460: 6172 6520 616c 6c20 4e6f 6e65 2c20 7468  are all None, th
+00014470: 6520 6365 6e74 7261 6c20 736c 6963 6520  e central slice 
+00014480: 6f66 2074 6865 0a20 2020 2020 2020 2020  of the.         
+00014490: 2020 2052 4f49 2077 696c 6c20 6265 2075     ROI will be u
+000144a0: 7365 642e 0a0a 2020 2020 2020 2020 6964  sed...        id
+000144b0: 7820 3a20 696e 742c 2064 6566 6175 6c74  x : int, default
+000144c0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+000144d0: 2020 536c 6963 6520 696e 6465 7820 6172    Slice index ar
+000144e0: 7261 7920 6f6e 2077 6869 6368 2074 6f20  ray on which to 
+000144f0: 636f 6d70 7574 6520 6d65 7472 6963 732e  compute metrics.
+00014500: 204f 6e6c 7920 7265 6c65 7661 6e74 2066   Only relevant f
+00014510: 6f72 200a 2020 2020 2020 2020 2020 2020  or .            
+00014520: 7369 6e67 6c65 2d73 6c69 6365 206d 6574  single-slice met
+00014530: 7269 6373 2028 6172 6561 2c20 6365 6e74  rics (area, cent
+00014540: 726f 6964 5f73 6c69 6365 2c20 6c65 6e67  roid_slice, leng
+00014550: 7468 5f73 6c69 6365 292e 0a20 2020 2020  th_slice)..     
+00014560: 2020 2020 2020 2055 7365 6420 6966 203c         Used if <
+00014570: 736c 3e20 6973 204e 6f6e 652e 0a0a 2020  sl> is None...  
+00014580: 2020 2020 2020 706f 7320 3a20 666c 6f61        pos : floa
+00014590: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+000145a0: 2020 2020 2020 2020 2020 2020 536c 6963              Slic
+000145b0: 6520 706f 7369 7469 6f6e 2069 6e20 6d6d  e position in mm
+000145c0: 206f 6e20 7768 6963 6820 746f 2063 6f6d   on which to com
+000145d0: 7075 7465 206d 6574 7269 6373 2e20 4f6e  pute metrics. On
+000145e0: 6c79 2072 656c 6576 616e 7420 666f 7220  ly relevant for 
+000145f0: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
+00014600: 676c 652d 736c 6963 6520 6d65 7472 6963  gle-slice metric
+00014610: 7320 2861 7265 612c 2063 656e 7472 6f69  s (area, centroi
+00014620: 645f 736c 6963 652c 206c 656e 6774 685f  d_slice, length_
+00014630: 736c 6963 6529 2e0a 2020 2020 2020 2020  slice)..        
+00014640: 2020 2020 5573 6564 2069 6620 3c73 6c3e      Used if <sl>
+00014650: 2061 6e64 203c 6964 783e 2061 7265 2062   and <idx> are b
+00014660: 6f74 6820 4e6f 6e65 2e0a 0a20 2020 2020  oth None...     
+00014670: 2020 206d 6574 686f 6420 3a20 7374 722c     method : str,
+00014680: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00014690: 2020 2020 2020 2020 2020 4d65 7468 6f64            Method
+000146a0: 2074 6f20 7573 6520 666f 7220 6d65 7472   to use for metr
+000146b0: 6963 2063 616c 6375 6c61 7469 6f6e 2e20  ic calculation. 
+000146c0: 4361 6e20 6265 2065 6974 6865 7220 2263  Can be either "c
+000146d0: 6f6e 746f 7572 2220 0a20 2020 2020 2020  ontour" .       
+000146e0: 2020 2020 2028 7573 6520 7368 6170 656c       (use shapel
+000146f0: 7920 706f 6c79 676f 6e73 2920 6f72 2022  y polygons) or "
+00014700: 6d61 736b 2220 2875 7365 2062 696e 6172  mask" (use binar
+00014710: 7920 6d61 736b 292e 2049 6620 4e6f 6e65  y mask). If None
+00014720: 2c0a 2020 2020 2020 2020 2020 2020 7468  ,.            th
+00014730: 6520 7661 6c75 6520 7365 7420 696e 2073  e value set in s
+00014740: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
+00014750: 5f6d 6574 686f 6420 7769 6c6c 2062 6520  _method will be 
+00014760: 7573 6564 2e0a 0a20 2020 2020 2020 2075  used...        u
+00014770: 6e69 7473 5f69 6e5f 6865 6164 6572 203a  nits_in_header :
+00014780: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
+00014790: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+000147a0: 2049 6620 5472 7565 2c20 756e 6974 7320   If True, units 
+000147b0: 7769 6c6c 2062 6520 696e 636c 7564 6564  will be included
+000147c0: 2069 6e20 636f 6c75 6d6e 2068 6561 6465   in column heade
+000147d0: 7273 2e0a 0a20 2020 2020 2020 2067 6c6f  rs...        glo
+000147e0: 6261 6c5f 7673 5f73 6c69 6365 5f68 6561  bal_vs_slice_hea
+000147f0: 6465 7220 3a20 626f 6f6c 2c20 6465 6661  der : bool, defa
+00014800: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
+00014810: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
+00014820: 6865 2072 6574 7572 6e65 6420 4461 7461  he returned Data
+00014830: 4672 616d 6520 7769 6c6c 2068 6176 6520  Frame will have 
+00014840: 616e 2065 7874 7261 2073 6574 206f 6620  an extra set of 
+00014850: 6865 6164 6572 730a 2020 2020 2020 2020  headers.        
+00014860: 2020 2020 7370 6c69 7474 696e 6720 7468      splitting th
+00014870: 6520 7461 626c 6520 696e 746f 2022 676c  e table into "gl
+00014880: 6f62 616c 2220 616e 6420 2273 6c69 6365  obal" and "slice
+00014890: 2220 6d65 7472 6963 732e 0a0a 2020 2020  " metrics...    
+000148a0: 2020 2020 6e61 6d65 5f61 735f 696e 6465      name_as_inde
+000148b0: 7820 3a20 626f 6f6c 2c20 6465 6661 756c  x : bool, defaul
+000148c0: 743d 5472 7565 0a20 2020 2020 2020 2020  t=True.         
+000148d0: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
+000148e0: 696e 6465 7820 636f 6c75 6d6e 206f 6620  index column of 
+000148f0: 7468 6520 7061 6e64 6173 2044 6174 6146  the pandas DataF
+00014900: 7261 6d65 2077 696c 6c20 0a20 2020 2020  rame will .     
+00014910: 2020 2020 2020 2063 6f6e 7461 696e 2074         contain t
+00014920: 6865 2052 4f49 2773 206e 616d 653b 206f  he ROI's name; o
+00014930: 7468 6572 7769 7365 2c20 7468 6520 6e61  therwise, the na
+00014940: 6d65 2077 696c 6c20 6170 7065 6172 2069  me will appear i
+00014950: 6e20 6120 636f 6c75 6d6e 0a20 2020 2020  n a column.     
+00014960: 2020 2020 2020 206e 616d 6564 2022 524f         named "RO
+00014970: 4922 2e0a 0a20 2020 2020 2020 206e 6963  I"...        nic
+00014980: 655f 636f 6c75 6d6e 7320 3a20 626f 6f6c  e_columns : bool
+00014990: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
+000149a0: 2020 2020 2020 2020 2020 2020 4966 2046              If F
+000149b0: 616c 7365 2c20 636f 6c75 6d6e 206e 616d  alse, column nam
+000149c0: 6573 2077 696c 6c20 6265 2074 6865 2073  es will be the s
+000149d0: 616d 6520 6173 2074 6865 2069 6e70 7574  ame as the input
+000149e0: 206d 6574 7269 6373 206e 616d 6573 3b0a   metrics names;.
+000149f0: 2020 2020 2020 2020 2020 2020 6966 2054              if T
+00014a00: 7275 652c 2074 6865 206e 616d 6573 2077  rue, the names w
+00014a10: 696c 6c20 6265 2063 6170 6974 616c 697a  ill be capitaliz
+00014a20: 6564 2061 6e64 2075 6e64 6572 7363 6f72  ed and underscor
+00014a30: 6573 2077 696c 6c20 6265 200a 2020 2020  es will be .    
+00014a40: 2020 2020 2020 2020 7265 706c 6163 6564          replaced
+00014a50: 2077 6974 6820 7370 6163 6573 2e0a 0a20   with spaces... 
+00014a60: 2020 2020 2020 2064 6563 696d 616c 5f70         decimal_p
+00014a70: 6c61 6365 7320 3a20 696e 742c 2064 6566  laces : int, def
+00014a80: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+00014a90: 2020 2020 2020 4e75 6d62 6572 206f 6620        Number of 
+00014aa0: 6465 6369 6d61 6c20 706c 6163 6573 2074  decimal places t
+00014ab0: 6f20 6b65 6570 2066 6f72 2065 6163 6820  o keep for each 
+00014ac0: 6d65 7472 6963 2e20 4966 204e 6f6e 652c  metric. If None,
+00014ad0: 2066 756c 6c0a 2020 2020 2020 2020 2020   full.          
+00014ae0: 2020 7072 6563 6973 696f 6e20 7769 6c6c    precision will
+00014af0: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
+00014b00: 2020 2066 6f72 6365 203a 2062 6f6f 6c2c     force : bool,
+00014b10: 2064 6566 6175 6c74 3d54 7275 650a 2020   default=True.  
+00014b20: 2020 2020 2020 2020 2020 4966 2046 616c            If Fal
+00014b30: 7365 2c20 676c 6f62 616c 206d 6574 7269  se, global metri
+00014b40: 6373 2028 766f 6c75 6d65 2c20 3344 2063  cs (volume, 3D c
+00014b50: 656e 7472 6f69 642c 2033 4420 6c65 6e67  entroid, 3D leng
+00014b60: 7468 7329 2077 696c 6c0a 2020 2020 2020  ths) will.      
+00014b70: 2020 2020 2020 6f6e 6c79 2062 6520 6361        only be ca
+00014b80: 6c63 756c 6174 6564 2069 6620 7468 6579  lculated if they
+00014b90: 2068 6176 6520 6e6f 7420 6265 656e 2063   have not been c
+00014ba0: 616c 6375 6c61 7465 6420 6265 666f 7265  alculated before
+00014bb0: 3b0a 2020 2020 2020 2020 2020 2020 6966  ;.            if
+00014bc0: 2054 7275 652c 2061 6c6c 206d 6574 7269   True, all metri
+00014bd0: 6373 2077 696c 6c20 6265 2072 6563 616c  cs will be recal
+00014be0: 6375 6c61 7465 642e 0a20 2020 2020 2020  culated..       
+00014bf0: 2022 2222 0a0a 2020 2020 2020 2020 2320   """..        # 
+00014c00: 4966 206e 6f20 696e 6465 7820 6769 7665  If no index give
+00014c10: 6e2c 2075 7365 2063 656e 7472 616c 2073  n, use central s
+00014c20: 6c69 6365 0a20 2020 2020 2020 2069 6620  lice.        if 
+00014c30: 736c 2069 7320 4e6f 6e65 2061 6e64 2069  sl is None and i
+00014c40: 6478 2069 7320 4e6f 6e65 2061 6e64 2070  dx is None and p
+00014c50: 6f73 2069 7320 4e6f 6e65 3a0a 2020 2020  os is None:.    
+00014c60: 2020 2020 2020 2020 6964 7820 3d20 7365          idx = se
+00014c70: 6c66 2e67 6574 5f6d 6964 5f69 6478 2876  lf.get_mid_idx(v
+00014c80: 6965 7729 0a0a 2020 2020 2020 2020 2320  iew)..        # 
+00014c90: 4465 6661 756c 7420 6d65 7472 6963 730a  Default metrics.
+00014ca0: 2020 2020 2020 2020 6966 206d 6574 7269          if metri
+00014cb0: 6373 2069 7320 4e6f 6e65 3a0a 2020 2020  cs is None:.    
+00014cc0: 2020 2020 2020 2020 6d65 7472 6963 7320          metrics 
+00014cd0: 3d20 5b22 766f 6c75 6d65 222c 2022 6365  = ["volume", "ce
+00014ce0: 6e74 726f 6964 225d 0a0a 2020 2020 2020  ntroid"]..      
+00014cf0: 2020 2320 436f 6d70 7574 6520 6d65 7472    # Compute metr
+00014d00: 6963 730a 2020 2020 2020 2020 6765 6f6d  ics.        geom
+00014d10: 203d 207b 7d0a 2020 2020 2020 2020 736c   = {}.        sl
+00014d20: 6963 655f 6b77 6172 6773 203d 207b 0a20  ice_kwargs = {. 
+00014d30: 2020 2020 2020 2020 2020 2022 7669 6577             "view
+00014d40: 223a 2076 6965 772c 0a20 2020 2020 2020  ": view,.       
+00014d50: 2020 2020 2022 736c 223a 2073 6c2c 0a20       "sl": sl,. 
+00014d60: 2020 2020 2020 2020 2020 2022 6964 7822             "idx"
+00014d70: 3a20 6964 782c 0a20 2020 2020 2020 2020  : idx,.         
+00014d80: 2020 2022 706f 7322 3a20 706f 730a 2020     "pos": pos.  
+00014d90: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00014da0: 666f 7220 6d20 696e 206d 6574 7269 6373  for m in metrics
+00014db0: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
+00014dc0: 2033 4420 766f 6c75 6d65 0a20 2020 2020   3D volume.     
+00014dd0: 2020 2020 2020 2069 6620 6d20 3d3d 2022         if m == "
+00014de0: 766f 6c75 6d65 223a 0a20 2020 2020 2020  volume":.       
+00014df0: 2020 2020 2020 2020 2067 656f 6d5b 6d5d           geom[m]
+00014e00: 203d 2073 656c 662e 6765 745f 766f 6c75   = self.get_volu
+00014e10: 6d65 280a 2020 2020 2020 2020 2020 2020  me(.            
+00014e20: 2020 2020 2020 2020 756e 6974 733d 766f          units=vo
+00014e30: 6c5f 756e 6974 732c 200a 2020 2020 2020  l_units, .      
+00014e40: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00014e50: 7468 6f64 3d6d 6574 686f 642c 0a20 2020  thod=method,.   
+00014e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e70: 2066 6f72 6365 3d66 6f72 6365 0a20 2020   force=force.   
+00014e80: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+00014e90: 2020 2020 2020 2020 2020 2020 2320 4172              # Ar
+00014ea0: 6561 206f 6e20 6120 736c 6963 650a 2020  ea on a slice.  
+00014eb0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+00014ec0: 203d 3d20 2261 7265 6122 3a0a 2020 2020   == "area":.    
+00014ed0: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
+00014ee0: 5b6d 5d20 3d20 7365 6c66 2e67 6574 5f61  [m] = self.get_a
+00014ef0: 7265 6128 0a20 2020 2020 2020 2020 2020  rea(.           
+00014f00: 2020 2020 2020 2020 2075 6e69 7473 3d61           units=a
+00014f10: 7265 615f 756e 6974 732c 200a 2020 2020  rea_units, .    
+00014f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f30: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
+00014f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f50: 2020 202a 2a73 6c69 6365 5f6b 7761 7267     **slice_kwarg
+00014f60: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00014f70: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+00014f80: 2023 2033 4420 6365 6e74 726f 6964 0a20   # 3D centroid. 
+00014f90: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00014fa0: 6d20 3d3d 2022 6365 6e74 726f 6964 223a  m == "centroid":
+00014fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014fc0: 2063 656e 7472 6f69 6420 3d20 7365 6c66   centroid = self
+00014fd0: 2e67 6574 5f63 656e 7472 6f69 6428 0a20  .get_centroid(. 
+00014fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ff0: 2020 2075 6e69 7473 3d63 656e 7472 6f69     units=centroi
+00015000: 645f 756e 6974 732c 200a 2020 2020 2020  d_units, .      
+00015010: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00015020: 7468 6f64 3d6d 6574 686f 642c 0a20 2020  thod=method,.   
+00015030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015040: 2066 6f72 6365 3d66 6f72 6365 0a20 2020   force=force.   
+00015050: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00015060: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00015070: 6f72 2069 2c20 6178 2069 6e20 656e 756d  or i, ax in enum
+00015080: 6572 6174 6528 736b 7274 2e69 6d61 6765  erate(skrt.image
+00015090: 2e5f 6178 6573 293a 0a20 2020 2020 2020  ._axes):.       
+000150a0: 2020 2020 2020 2020 2020 2020 2067 656f               geo
+000150b0: 6d5b 6622 6365 6e74 726f 6964 5f7b 6178  m[f"centroid_{ax
+000150c0: 7d22 5d20 3d20 6365 6e74 726f 6964 5b69  }"] = centroid[i
+000150d0: 5d0a 0a20 2020 2020 2020 2020 2020 2023  ]..            #
+000150e0: 2032 4420 6365 6e74 726f 6964 0a20 2020   2D centroid.   
+000150f0: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
+00015100: 3d3d 2022 6365 6e74 726f 6964 5f73 6c69  == "centroid_sli
+00015110: 6365 223a 0a20 2020 2020 2020 2020 2020  ce":.           
+00015120: 2020 2020 2063 656e 7472 6f69 6420 3d20       centroid = 
+00015130: 7365 6c66 2e67 6574 5f63 656e 7472 6f69  self.get_centroi
+00015140: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
+00015150: 2020 2020 2020 2075 6e69 7473 3d63 656e         units=cen
+00015160: 7472 6f69 645f 756e 6974 732c 200a 2020  troid_units, .  
 00015170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015180: 2020 2020 2a2a 736c 6963 655f 6b77 6172      **slice_kwar
-00015190: 6773 0a20 2020 2020 2020 2020 2020 2020  gs.             
-000151a0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-000151b0: 2020 2020 2066 6f72 2069 2c20 695f 6178       for i, i_ax
-000151c0: 2069 6e20 656e 756d 6572 6174 6528 736b   in enumerate(sk
-000151d0: 7274 2e69 6d61 6765 2e5f 706c 6f74 5f61  rt.image._plot_a
-000151e0: 7865 735b 7669 6577 5d29 3a0a 2020 2020  xes[view]):.    
-000151f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015200: 6178 203d 2073 6b72 742e 696d 6167 652e  ax = skrt.image.
-00015210: 5f61 7865 735b 695f 6178 5d0a 2020 2020  _axes[i_ax].    
-00015220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015230: 6765 6f6d 5b66 2263 656e 7472 6f69 645f  geom[f"centroid_
-00015240: 736c 6963 655f 7b61 787d 225d 203d 2063  slice_{ax}"] = c
-00015250: 656e 7472 6f69 645b 695d 0a0a 2020 2020  entroid[i]..    
-00015260: 2020 2020 2020 2020 2320 4675 6c6c 206c          # Full l
-00015270: 656e 6774 6873 2061 6c6f 6e67 2065 6163  engths along eac
-00015280: 6820 6178 6973 0a20 2020 2020 2020 2020  h axis.         
-00015290: 2020 2065 6c69 6620 6d20 3d3d 2022 6c65     elif m == "le
-000152a0: 6e67 7468 223a 0a20 2020 2020 2020 2020  ngth":.         
-000152b0: 2020 2020 2020 2066 6f72 2061 7820 696e         for ax in
-000152c0: 2073 6b72 742e 696d 6167 652e 5f61 7865   skrt.image._axe
-000152d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000152e0: 2020 2020 2020 2067 656f 6d5b 6622 6c65         geom[f"le
-000152f0: 6e67 7468 5f7b 6178 7d22 5d20 3d20 7365  ngth_{ax}"] = se
-00015300: 6c66 2e67 6574 5f6c 656e 6774 6828 0a20  lf.get_length(. 
-00015310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015320: 2020 2020 2020 2061 783d 6178 2c20 0a20         ax=ax, . 
-00015330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015340: 2020 2020 2020 2075 6e69 7473 3d6c 656e         units=len
-00015350: 6774 685f 756e 6974 732c 0a20 2020 2020  gth_units,.     
-00015360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015370: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
-00015380: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00015390: 2020 2020 2020 2020 2020 666f 7263 653d            force=
-000153a0: 666f 7263 650a 2020 2020 2020 2020 2020  force.          
-000153b0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-000153c0: 2020 2020 2020 2020 2023 204c 656e 6774           # Lengt
-000153d0: 6873 206f 6e20 6120 736c 6963 650a 2020  hs on a slice.  
-000153e0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-000153f0: 203d 3d20 226c 656e 6774 685f 736c 6963   == "length_slic
-00015400: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
-00015410: 2020 2020 666f 7220 695f 6178 2069 6e20      for i_ax in 
-00015420: 736b 7274 2e69 6d61 6765 2e5f 706c 6f74  skrt.image._plot
-00015430: 5f61 7865 735b 7669 6577 5d3a 0a20 2020  _axes[view]:.   
-00015440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015450: 2061 7820 3d20 736b 7274 2e69 6d61 6765   ax = skrt.image
-00015460: 2e5f 6178 6573 5b69 5f61 785d 0a20 2020  ._axes[i_ax].   
-00015470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015480: 2067 656f 6d5b 6622 6c65 6e67 7468 5f73   geom[f"length_s
-00015490: 6c69 6365 5f7b 6178 7d22 5d20 3d20 7365  lice_{ax}"] = se
-000154a0: 6c66 2e67 6574 5f6c 656e 6774 6828 0a20  lf.get_length(. 
-000154b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154c0: 2020 2020 2020 2061 783d 6178 2c20 0a20         ax=ax, . 
-000154d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154e0: 2020 2020 2020 2075 6e69 7473 3d6c 656e         units=len
-000154f0: 6774 685f 756e 6974 732c 0a20 2020 2020  gth_units,.     
-00015500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015510: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
-00015520: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00015530: 2020 2020 2020 2020 2020 7369 6e67 6c65            single
-00015540: 5f73 6c69 6365 3d54 7275 652c 0a20 2020  _slice=True,.   
-00015550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015560: 2020 2020 202a 2a73 6c69 6365 5f6b 7761       **slice_kwa
-00015570: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
-00015580: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00015590: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000155a0: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
-000155b0: 6e64 203d 2046 616c 7365 0a0a 2020 2020  nd = False..    
-000155c0: 2020 2020 2020 2020 2020 2020 2320 4178              # Ax
-000155d0: 6973 2d73 7065 6369 6669 6320 6d65 7472  is-specific metr
-000155e0: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
-000155f0: 2020 2020 666f 7220 692c 2061 7820 696e      for i, ax in
-00015600: 2065 6e75 6d65 7261 7465 2873 6b72 742e   enumerate(skrt.
-00015610: 696d 6167 652e 5f61 7865 7329 3a0a 0a20  image._axes):.. 
-00015620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015630: 2020 2023 2047 6c6f 6261 6c20 6365 6e74     # Global cent
-00015640: 726f 6964 2070 6f73 6974 696f 6e20 6f6e  roid position on
-00015650: 2061 2067 6976 656e 2061 7869 730a 2020   a given axis.  
-00015660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015670: 2020 6966 206d 203d 3d20 6622 6365 6e74    if m == f"cent
-00015680: 726f 6964 5f7b 6178 7d22 3a0a 2020 2020  roid_{ax}":.    
-00015690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156a0: 2020 2020 6765 6f6d 5b6d 5d20 3d20 7365      geom[m] = se
-000156b0: 6c66 2e67 6574 5f63 656e 7472 6f69 6428  lf.get_centroid(
-000156c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000156d0: 2020 2020 2020 2020 2020 2020 2075 6e69               uni
-000156e0: 7473 3d63 656e 7472 6f69 645f 756e 6974  ts=centroid_unit
-000156f0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00015700: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00015710: 6574 686f 643d 6d65 7468 6f64 2c0a 2020  ethod=method,.  
-00015720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015730: 2020 2020 2020 2020 2020 666f 7263 653d            force=
-00015740: 666f 7263 650a 2020 2020 2020 2020 2020  force.          
-00015750: 2020 2020 2020 2020 2020 2020 2020 295b                )[
-00015760: 695d 0a20 2020 2020 2020 2020 2020 2020  i].             
-00015770: 2020 2020 2020 2020 2020 2066 6f75 6e64             found
-00015780: 203d 2054 7275 650a 0a20 2020 2020 2020   = True..       
-00015790: 2020 2020 2020 2020 2020 2020 2023 2046               # F
-000157a0: 756c 6c20 6c65 6e67 7468 2061 6c6f 6e67  ull length along
-000157b0: 2061 2067 6976 656e 2061 7869 730a 2020   a given axis.  
-000157c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000157d0: 2020 656c 6966 206d 203d 3d20 6622 6c65    elif m == f"le
-000157e0: 6e67 7468 5f7b 6178 7d22 3a0a 2020 2020  ngth_{ax}":.    
-000157f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015800: 2020 2020 6765 6f6d 5b6d 5d20 3d20 7365      geom[m] = se
-00015810: 6c66 2e67 6574 5f6c 656e 6774 6828 0a20  lf.get_length(. 
-00015820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015830: 2020 2020 2020 2020 2020 2061 783d 6178             ax=ax
-00015840: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00015850: 2020 2020 2020 2020 2020 2020 2020 756e                un
-00015860: 6974 733d 6c65 6e67 7468 5f75 6e69 7473  its=length_units
-00015870: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-00015880: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00015890: 6574 686f 643d 6d65 7468 6f64 2c0a 2020  ethod=method,.  
-000158a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158b0: 2020 2020 2020 2020 2020 666f 7263 653d            force=
-000158c0: 666f 7263 650a 2020 2020 2020 2020 2020  force.          
-000158d0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-000158e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158f0: 2020 2020 2020 2020 666f 756e 6420 3d20          found = 
-00015900: 5472 7565 0a0a 2020 2020 2020 2020 2020  True..          
-00015910: 2020 2020 2020 6966 206e 6f74 2066 6f75        if not fou
-00015920: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
-00015930: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
-00015940: 6e74 696d 6545 7272 6f72 2866 224d 6574  ntimeError(f"Met
-00015950: 7269 6320 7b6d 7d20 6e6f 7420 7265 636f  ric {m} not reco
-00015960: 676e 6973 6564 2062 7920 220a 2020 2020  gnised by ".    
+00015180: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
+00015190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000151a0: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
+000151b0: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
+000151c0: 2020 2020 2020 2020 2020 2020 2a2a 736c              **sl
+000151d0: 6963 655f 6b77 6172 6773 0a20 2020 2020  ice_kwargs.     
+000151e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000151f0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00015200: 2069 2c20 695f 6178 2069 6e20 656e 756d   i, i_ax in enum
+00015210: 6572 6174 6528 736b 7274 2e69 6d61 6765  erate(skrt.image
+00015220: 2e5f 706c 6f74 5f61 7865 735b 7669 6577  ._plot_axes[view
+00015230: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+00015240: 2020 2020 2020 2020 6178 203d 2073 6b72          ax = skr
+00015250: 742e 696d 6167 652e 5f61 7865 735b 695f  t.image._axes[i_
+00015260: 6178 5d0a 2020 2020 2020 2020 2020 2020  ax].            
+00015270: 2020 2020 2020 2020 6765 6f6d 5b66 2263          geom[f"c
+00015280: 656e 7472 6f69 645f 736c 6963 655f 7b61  entroid_slice_{a
+00015290: 787d 225d 203d 2063 656e 7472 6f69 645b  x}"] = centroid[
+000152a0: 695d 0a0a 2020 2020 2020 2020 2020 2020  i]..            
+000152b0: 2320 4675 6c6c 206c 656e 6774 6873 2061  # Full lengths a
+000152c0: 6c6f 6e67 2065 6163 6820 6178 6973 0a20  long each axis. 
+000152d0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+000152e0: 6d20 3d3d 2022 6c65 6e67 7468 223a 0a20  m == "length":. 
+000152f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00015300: 6f72 2061 7820 696e 2073 6b72 742e 696d  or ax in skrt.im
+00015310: 6167 652e 5f61 7865 733a 0a20 2020 2020  age._axes:.     
+00015320: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00015330: 656f 6d5b 6622 6c65 6e67 7468 5f7b 6178  eom[f"length_{ax
+00015340: 7d22 5d20 3d20 7365 6c66 2e67 6574 5f6c  }"] = self.get_l
+00015350: 656e 6774 6828 0a20 2020 2020 2020 2020  ength(.         
+00015360: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00015370: 783d 6178 2c20 0a20 2020 2020 2020 2020  x=ax, .         
+00015380: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00015390: 6e69 7473 3d6c 656e 6774 685f 756e 6974  nits=length_unit
+000153a0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+000153b0: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+000153c0: 643d 6d65 7468 6f64 2c0a 2020 2020 2020  d=method,.      
+000153d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153e0: 2020 666f 7263 653d 666f 7263 650a 2020    force=force.  
+000153f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015400: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+00015410: 2023 204c 656e 6774 6873 206f 6e20 6120   # Lengths on a 
+00015420: 736c 6963 650a 2020 2020 2020 2020 2020  slice.          
+00015430: 2020 656c 6966 206d 203d 3d20 226c 656e    elif m == "len
+00015440: 6774 685f 736c 6963 6522 3a0a 2020 2020  gth_slice":.    
+00015450: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00015460: 695f 6178 2069 6e20 736b 7274 2e69 6d61  i_ax in skrt.ima
+00015470: 6765 2e5f 706c 6f74 5f61 7865 735b 7669  ge._plot_axes[vi
+00015480: 6577 5d3a 0a20 2020 2020 2020 2020 2020  ew]:.           
+00015490: 2020 2020 2020 2020 2061 7820 3d20 736b           ax = sk
+000154a0: 7274 2e69 6d61 6765 2e5f 6178 6573 5b69  rt.image._axes[i
+000154b0: 5f61 785d 0a20 2020 2020 2020 2020 2020  _ax].           
+000154c0: 2020 2020 2020 2020 2067 656f 6d5b 6622           geom[f"
+000154d0: 6c65 6e67 7468 5f73 6c69 6365 5f7b 6178  length_slice_{ax
+000154e0: 7d22 5d20 3d20 7365 6c66 2e67 6574 5f6c  }"] = self.get_l
+000154f0: 656e 6774 6828 0a20 2020 2020 2020 2020  ength(.         
+00015500: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00015510: 783d 6178 2c20 0a20 2020 2020 2020 2020  x=ax, .         
+00015520: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00015530: 6e69 7473 3d6c 656e 6774 685f 756e 6974  nits=length_unit
+00015540: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00015550: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+00015560: 643d 6d65 7468 6f64 2c0a 2020 2020 2020  d=method,.      
+00015570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015580: 2020 7369 6e67 6c65 5f73 6c69 6365 3d54    single_slice=T
+00015590: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+000155a0: 2020 2020 2020 2020 2020 2020 202a 2a73               **s
+000155b0: 6c69 6365 5f6b 7761 7267 730a 2020 2020  lice_kwargs.    
+000155c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155d0: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
+000155e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000155f0: 2020 2020 2066 6f75 6e64 203d 2046 616c       found = Fal
+00015600: 7365 0a0a 2020 2020 2020 2020 2020 2020  se..            
+00015610: 2020 2020 2320 4178 6973 2d73 7065 6369      # Axis-speci
+00015620: 6669 6320 6d65 7472 6963 730a 2020 2020  fic metrics.    
+00015630: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00015640: 692c 2061 7820 696e 2065 6e75 6d65 7261  i, ax in enumera
+00015650: 7465 2873 6b72 742e 696d 6167 652e 5f61  te(skrt.image._a
+00015660: 7865 7329 3a0a 0a20 2020 2020 2020 2020  xes):..         
+00015670: 2020 2020 2020 2020 2020 2023 2047 6c6f             # Glo
+00015680: 6261 6c20 6365 6e74 726f 6964 2070 6f73  bal centroid pos
+00015690: 6974 696f 6e20 6f6e 2061 2067 6976 656e  ition on a given
+000156a0: 2061 7869 730a 2020 2020 2020 2020 2020   axis.          
+000156b0: 2020 2020 2020 2020 2020 6966 206d 203d            if m =
+000156c0: 3d20 6622 6365 6e74 726f 6964 5f7b 6178  = f"centroid_{ax
+000156d0: 7d22 3a0a 2020 2020 2020 2020 2020 2020  }":.            
+000156e0: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
+000156f0: 5b6d 5d20 3d20 7365 6c66 2e67 6574 5f63  [m] = self.get_c
+00015700: 656e 7472 6f69 6428 0a20 2020 2020 2020  entroid(.       
+00015710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015720: 2020 2020 2075 6e69 7473 3d63 656e 7472       units=centr
+00015730: 6f69 645f 756e 6974 732c 0a20 2020 2020  oid_units,.     
+00015740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015750: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
+00015760: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
+00015770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015780: 2020 666f 7263 653d 666f 7263 650a 2020    force=force.  
+00015790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000157a0: 2020 2020 2020 295b 695d 0a20 2020 2020        )[i].     
+000157b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000157c0: 2020 2066 6f75 6e64 203d 2054 7275 650a     found = True.
+000157d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000157e0: 2020 2020 2023 2046 756c 6c20 6c65 6e67       # Full leng
+000157f0: 7468 2061 6c6f 6e67 2061 2067 6976 656e  th along a given
+00015800: 2061 7869 730a 2020 2020 2020 2020 2020   axis.          
+00015810: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+00015820: 203d 3d20 6622 6c65 6e67 7468 5f7b 6178   == f"length_{ax
+00015830: 7d22 3a0a 2020 2020 2020 2020 2020 2020  }":.            
+00015840: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
+00015850: 5b6d 5d20 3d20 7365 6c66 2e67 6574 5f6c  [m] = self.get_l
+00015860: 656e 6774 6828 0a20 2020 2020 2020 2020  ength(.         
+00015870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015880: 2020 2061 783d 6178 2c0a 2020 2020 2020     ax=ax,.      
+00015890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158a0: 2020 2020 2020 756e 6974 733d 6c65 6e67        units=leng
+000158b0: 7468 5f75 6e69 7473 2c20 0a20 2020 2020  th_units, .     
+000158c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158d0: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
+000158e0: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
+000158f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015900: 2020 666f 7263 653d 666f 7263 650a 2020    force=force.  
+00015910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015920: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00015930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015940: 666f 756e 6420 3d20 5472 7565 0a0a 2020  found = True..  
+00015950: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00015960: 206e 6f74 2066 6f75 6e64 3a0a 2020 2020   not found:.    
 00015970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015990: 2020 2022 524f 492e 6765 745f 6765 6f6d     "ROI.get_geom
-000159a0: 6574 7279 2829 2229 0a0a 2020 2020 2020  etry()")..      
-000159b0: 2020 2320 4164 6420 756e 6974 7320 746f    # Add units to
-000159c0: 206d 6574 7269 6320 6e61 6d65 7320 6966   metric names if
-000159d0: 2072 6571 7565 7374 6564 0a20 2020 2020   requested.     
-000159e0: 2020 2067 656f 6d5f 6e61 6d65 6420 3d20     geom_named = 
-000159f0: 7b7d 0a20 2020 2020 2020 2069 6620 6e6f  {}.        if no
-00015a00: 7420 756e 6974 735f 696e 5f68 6561 6465  t units_in_heade
-00015a10: 723a 0a20 2020 2020 2020 2020 2020 2067  r:.            g
-00015a20: 656f 6d5f 6e61 6d65 6420 3d20 6765 6f6d  eom_named = geom
-00015a30: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00015a40: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
-00015a50: 6574 7269 632c 2076 616c 2069 6e20 6765  etric, val in ge
-00015a60: 6f6d 2e69 7465 6d73 2829 3a0a 2020 2020  om.items():.    
-00015a70: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00015a80: 203d 206d 6574 7269 630a 2020 2020 2020   = metric.      
-00015a90: 2020 2020 2020 2020 2020 6966 2022 766f            if "vo
-00015aa0: 6c75 6d65 2220 696e 206d 6574 7269 633a  lume" in metric:
-00015ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015ac0: 2020 2020 2069 6620 766f 6c5f 756e 6974       if vol_unit
-00015ad0: 7320 3d3d 2022 6d6d 223a 0a20 2020 2020  s == "mm":.     
-00015ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015af0: 2020 206e 616d 6520 2b3d 2022 2028 6d6d     name += " (mm
-00015b00: 5e33 2922 0a20 2020 2020 2020 2020 2020  ^3)".           
-00015b10: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00015b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b30: 2020 2020 2020 206e 616d 6520 2b3d 2022         name += "
-00015b40: 2028 2220 2b20 766f 6c5f 756e 6974 7320   (" + vol_units 
-00015b50: 2b20 2229 220a 2020 2020 2020 2020 2020  + ")".          
-00015b60: 2020 2020 2020 656c 6966 2022 6172 6561        elif "area
-00015b70: 2220 696e 206d 6574 7269 633a 0a20 2020  " in metric:.   
-00015b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b90: 2069 6620 6172 6561 5f75 6e69 7473 203d   if area_units =
-00015ba0: 3d20 226d 6d22 3a0a 2020 2020 2020 2020  = "mm":.        
-00015bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015bc0: 6e61 6d65 202b 3d20 2220 286d 6d5e 3229  name += " (mm^2)
-00015bd0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00015be0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00015980: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
+00015990: 6f72 2866 224d 6574 7269 6320 7b6d 7d20  or(f"Metric {m} 
+000159a0: 6e6f 7420 7265 636f 676e 6973 6564 2062  not recognised b
+000159b0: 7920 220a 2020 2020 2020 2020 2020 2020  y ".            
+000159c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000159d0: 2020 2020 2020 2020 2020 2022 524f 492e             "ROI.
+000159e0: 6765 745f 6765 6f6d 6574 7279 2829 2229  get_geometry()")
+000159f0: 0a0a 2020 2020 2020 2020 2320 4164 6420  ..        # Add 
+00015a00: 756e 6974 7320 746f 206d 6574 7269 6320  units to metric 
+00015a10: 6e61 6d65 7320 6966 2072 6571 7565 7374  names if request
+00015a20: 6564 0a20 2020 2020 2020 2067 656f 6d5f  ed.        geom_
+00015a30: 6e61 6d65 6420 3d20 7b7d 0a20 2020 2020  named = {}.     
+00015a40: 2020 2069 6620 6e6f 7420 756e 6974 735f     if not units_
+00015a50: 696e 5f68 6561 6465 723a 0a20 2020 2020  in_header:.     
+00015a60: 2020 2020 2020 2067 656f 6d5f 6e61 6d65         geom_name
+00015a70: 6420 3d20 6765 6f6d 0a20 2020 2020 2020  d = geom.       
+00015a80: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00015a90: 2020 2066 6f72 206d 6574 7269 632c 2076     for metric, v
+00015aa0: 616c 2069 6e20 6765 6f6d 2e69 7465 6d73  al in geom.items
+00015ab0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00015ac0: 2020 2020 6e61 6d65 203d 206d 6574 7269      name = metri
+00015ad0: 630a 2020 2020 2020 2020 2020 2020 2020  c.              
+00015ae0: 2020 6966 2022 766f 6c75 6d65 2220 696e    if "volume" in
+00015af0: 206d 6574 7269 633a 0a20 2020 2020 2020   metric:.       
+00015b00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00015b10: 766f 6c5f 756e 6974 7320 3d3d 2022 6d6d  vol_units == "mm
+00015b20: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00015b30: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+00015b40: 2b3d 2022 2028 6d6d 5e33 2922 0a20 2020  += " (mm^3)".   
+00015b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015b60: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00015b70: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00015b80: 616d 6520 2b3d 2022 2028 2220 2b20 766f  ame += " (" + vo
+00015b90: 6c5f 756e 6974 7320 2b20 2229 220a 2020  l_units + ")".  
+00015ba0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00015bb0: 6966 2022 6172 6561 2220 696e 206d 6574  if "area" in met
+00015bc0: 7269 633a 0a20 2020 2020 2020 2020 2020  ric:.           
+00015bd0: 2020 2020 2020 2020 2069 6620 6172 6561           if area
+00015be0: 5f75 6e69 7473 203d 3d20 226d 6d22 3a0a  _units == "mm":.
 00015bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c00: 2020 2020 6e61 6d65 202b 3d20 2220 2822      name += " ("
-00015c10: 202b 2061 7265 615f 756e 6974 7320 2b20   + area_units + 
-00015c20: 2229 220a 2020 2020 2020 2020 2020 2020  ")".            
-00015c30: 2020 2020 656c 6966 2022 6c65 6e67 7468      elif "length
-00015c40: 2220 696e 206d 6574 7269 633a 0a20 2020  " in metric:.   
-00015c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c60: 206e 616d 6520 2b3d 2022 2028 2220 2b20   name += " (" + 
-00015c70: 6c65 6e67 7468 5f75 6e69 7473 202b 2022  length_units + "
-00015c80: 2922 0a20 2020 2020 2020 2020 2020 2020  )".             
-00015c90: 2020 2065 6c69 6620 2263 656e 7472 6f69     elif "centroi
-00015ca0: 6422 2069 6e20 6d65 7472 6963 3a0a 2020  d" in metric:.  
-00015cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015cc0: 2020 6e61 6d65 202b 3d20 2220 2822 202b    name += " (" +
-00015cd0: 2063 656e 7472 6f69 645f 756e 6974 7320   centroid_units 
-00015ce0: 2b20 2229 220a 2020 2020 2020 2020 2020  + ")".          
-00015cf0: 2020 2020 2020 6765 6f6d 5f6e 616d 6564        geom_named
-00015d00: 5b6e 616d 655d 203d 2076 616c 0a0a 2020  [name] = val..  
-00015d10: 2020 2020 2020 2320 4164 6a75 7374 206e        # Adjust n
-00015d20: 756d 6265 7220 6f66 2064 6563 696d 616c  umber of decimal
-00015d30: 2070 6c61 6365 730a 2020 2020 2020 2020   places.        
-00015d40: 6966 2064 6563 696d 616c 5f70 6c61 6365  if decimal_place
-00015d50: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
-00015d60: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
-00015d70: 6574 7269 632c 2076 616c 2069 6e20 6765  etric, val in ge
-00015d80: 6f6d 5f6e 616d 6564 2e69 7465 6d73 2829  om_named.items()
-00015d90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015da0: 2020 666d 7420 3d20 6622 7b7b 7661 6c3a    fmt = f"{{val:
-00015db0: 2e7b 6465 6369 6d61 6c5f 706c 6163 6573  .{decimal_places
-00015dc0: 7d66 7d7d 220a 2020 2020 2020 2020 2020  }f}}".          
-00015dd0: 2020 2020 2020 6966 2067 656f 6d5f 6e61        if geom_na
-00015de0: 6d65 645b 6d65 7472 6963 5d20 6973 206e  med[metric] is n
-00015df0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00015e00: 2020 2020 2020 2020 2020 2020 2067 656f               geo
-00015e10: 6d5f 6e61 6d65 645b 6d65 7472 6963 5d20  m_named[metric] 
-00015e20: 3d20 666c 6f61 7428 666d 742e 666f 726d  = float(fmt.form
-00015e30: 6174 2876 616c 3d76 616c 2929 0a0a 2020  at(val=val))..  
-00015e40: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
-00015e50: 746f 2070 616e 6461 7320 4461 7461 4672  to pandas DataFr
-00015e60: 616d 650a 2020 2020 2020 2020 6466 203d  ame.        df =
-00015e70: 2070 642e 4461 7461 4672 616d 6528 6765   pd.DataFrame(ge
-00015e80: 6f6d 5f6e 616d 6564 2c20 696e 6465 783d  om_named, index=
-00015e90: 5b73 656c 662e 6e61 6d65 5d29 0a0a 2020  [self.name])..  
-00015ea0: 2020 2020 2020 2320 4361 7069 7461 6c69        # Capitali
-00015eb0: 7a65 2063 6f6c 756d 6e20 6e61 6d65 7320  ze column names 
-00015ec0: 616e 6420 7265 6d6f 7665 2075 6e64 6572  and remove under
-00015ed0: 7363 6f72 6573 2069 6620 7265 7175 6573  scores if reques
-00015ee0: 7465 640a 2020 2020 2020 2020 6966 206e  ted.        if n
-00015ef0: 6963 655f 636f 6c75 6d6e 7320 616e 6420  ice_columns and 
-00015f00: 6e6f 7420 676c 6f62 616c 5f76 735f 736c  not global_vs_sl
-00015f10: 6963 655f 6865 6164 6572 3a0a 2020 2020  ice_header:.    
-00015f20: 2020 2020 2020 2020 6466 2e63 6f6c 756d          df.colum
-00015f30: 6e73 203d 205b 636f 6c2e 6361 7069 7461  ns = [col.capita
-00015f40: 6c69 7a65 2829 2e72 6570 6c61 6365 2822  lize().replace("
-00015f50: 5f22 2c20 2220 2229 200a 2020 2020 2020  _", " ") .      
-00015f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f70: 2020 2020 666f 7220 636f 6c20 696e 2064      for col in d
-00015f80: 662e 636f 6c75 6d6e 735d 0a0a 2020 2020  f.columns]..    
-00015f90: 2020 2020 2320 5475 726e 206e 616d 6520      # Turn name 
-00015fa0: 696e 746f 2061 2072 6567 756c 6172 2063  into a regular c
-00015fb0: 6f6c 756d 6e20 6966 2072 6571 7565 7374  olumn if request
-00015fc0: 6564 0a20 2020 2020 2020 2069 6620 6e6f  ed.        if no
-00015fd0: 7420 6e61 6d65 5f61 735f 696e 6465 783a  t name_as_index:
-00015fe0: 0a20 2020 2020 2020 2020 2020 2064 6620  .            df 
-00015ff0: 3d20 6466 2e72 6573 6574 5f69 6e64 6578  = df.reset_index
-00016000: 2829 2e72 656e 616d 6528 7b22 696e 6465  ().rename({"inde
-00016010: 7822 3a20 2252 4f49 227d 2c20 6178 6973  x": "ROI"}, axis
-00016020: 3d31 290a 0a20 2020 2020 2020 2023 2041  =1)..        # A
-00016030: 6464 2067 6c6f 6261 6c2f 736c 6963 6520  dd global/slice 
-00016040: 6865 6164 6572 730a 2020 2020 2020 2020  headers.        
-00016050: 6966 2067 6c6f 6261 6c5f 7673 5f73 6c69  if global_vs_sli
-00016060: 6365 5f68 6561 6465 723a 0a0a 2020 2020  ce_header:..    
-00016070: 2020 2020 2020 2020 2320 536f 7274 2063          # Sort c
-00016080: 6f6c 756d 6e73 2069 6e74 6f20 676c 6f62  olumns into glob
-00016090: 616c 206f 7220 736c 6963 650a 2020 2020  al or slice.    
-000160a0: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
-000160b0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-000160c0: 2073 6c69 6365 5f63 6f6c 7320 3d20 5b5d   slice_cols = []
-000160d0: 0a20 2020 2020 2020 2020 2020 2067 6c6f  .            glo
-000160e0: 6261 6c5f 636f 6c73 203d 205b 5d0a 2020  bal_cols = [].  
-000160f0: 2020 2020 2020 2020 2020 736c 6963 655f            slice_
-00016100: 6e61 6d65 203d 2022 736c 6963 6522 2069  name = "slice" i
-00016110: 6620 6e6f 7420 6e69 6365 5f63 6f6c 756d  f not nice_colum
-00016120: 6e73 2065 6c73 6520 2253 6c69 6365 220a  ns else "Slice".
-00016130: 2020 2020 2020 2020 2020 2020 676c 6f62              glob
-00016140: 616c 5f6e 616d 6520 3d20 2267 6c6f 6261  al_name = "globa
-00016150: 6c22 2069 6620 6e6f 7420 6e69 6365 5f63  l" if not nice_c
-00016160: 6f6c 756d 6e73 2065 6c73 6520 2247 6c6f  olumns else "Glo
-00016170: 6261 6c22 0a20 2020 2020 2020 2020 2020  bal".           
-00016180: 2066 6f72 206d 6574 7269 6320 696e 2067   for metric in g
-00016190: 656f 6d5f 6e61 6d65 643a 0a20 2020 2020  eom_named:.     
-000161a0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-000161b0: 3d20 6d65 7472 6963 2069 6620 6e6f 7420  = metric if not 
-000161c0: 6e69 6365 5f63 6f6c 756d 6e73 2065 6c73  nice_columns els
-000161d0: 6520 5c0a 2020 2020 2020 2020 2020 2020  e \.            
-000161e0: 2020 2020 2020 2020 2020 2020 6d65 7472              metr
-000161f0: 6963 2e63 6170 6974 616c 697a 6528 292e  ic.capitalize().
-00016200: 7265 706c 6163 6528 225f 222c 2022 2229  replace("_", "")
-00016210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016220: 2069 6620 2261 7265 6122 2069 6e20 6d65   if "area" in me
-00016230: 7472 6963 206f 7220 2273 6c69 6365 2220  tric or "slice" 
-00016240: 696e 206d 6574 7269 633a 0a20 2020 2020  in metric:.     
-00016250: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00016260: 6561 6465 7273 2e61 7070 656e 6428 2873  eaders.append((s
-00016270: 6c69 6365 5f6e 616d 652c 206d 6574 7269  lice_name, metri
-00016280: 6329 290a 2020 2020 2020 2020 2020 2020  c)).            
-00016290: 2020 2020 2020 2020 736c 6963 655f 636f          slice_co
-000162a0: 6c73 2e61 7070 656e 6428 6d65 7472 6963  ls.append(metric
-000162b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000162c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000162d0: 2020 2020 2020 2020 2020 2020 6865 6164              head
-000162e0: 6572 732e 6170 7065 6e64 2828 676c 6f62  ers.append((glob
-000162f0: 616c 5f6e 616d 652c 206d 6574 7269 6329  al_name, metric)
-00016300: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00016310: 2020 2020 2020 676c 6f62 616c 5f63 6f6c        global_col
-00016320: 732e 6170 7065 6e64 286d 6574 7269 6329  s.append(metric)
-00016330: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00016340: 5265 6f72 6465 7220 636f 6c75 6d6e 730a  Reorder columns.
-00016350: 2020 2020 2020 2020 2020 2020 6466 735f              dfs_
-00016360: 6f72 6465 7265 6420 3d20 5b64 665b 676c  ordered = [df[gl
-00016370: 6f62 616c 5f63 6f6c 735d 2c20 6466 5b73  obal_cols], df[s
-00016380: 6c69 6365 5f63 6f6c 735d 5d0a 2020 2020  lice_cols]].    
-00016390: 2020 2020 2020 2020 6966 206e 6f74 206e          if not n
-000163a0: 616d 655f 6173 5f69 6e64 6578 3a0a 2020  ame_as_index:.  
-000163b0: 2020 2020 2020 2020 2020 2020 2020 6466                df
-000163c0: 735f 6f72 6465 7265 642e 696e 7365 7274  s_ordered.insert
-000163d0: 2830 2c20 6466 5b22 524f 4922 5d29 0a20  (0, df["ROI"]). 
-000163e0: 2020 2020 2020 2020 2020 2064 6620 3d20             df = 
-000163f0: 7064 2e63 6f6e 6361 7428 6466 735f 6f72  pd.concat(dfs_or
-00016400: 6465 7265 642c 2061 7869 733d 3129 0a0a  dered, axis=1)..
-00016410: 2020 2020 2020 2020 2020 2020 2320 536f              # So
-00016420: 7274 2068 6561 6465 7273 2062 7920 676c  rt headers by gl
-00016430: 6f62 616c 2f73 6c69 6365 0a20 2020 2020  obal/slice.     
-00016440: 2020 2020 2020 2068 6561 6465 7273 203d         headers =
-00016450: 205b 6820 666f 7220 6820 696e 2068 6561   [h for h in hea
-00016460: 6465 7273 2069 6620 685b 305d 203d 3d20  ders if h[0] == 
-00016470: 676c 6f62 616c 5f6e 616d 655d 205c 0a20  global_name] \. 
-00016480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016490: 2020 202b 205b 6820 666f 7220 6820 696e     + [h for h in
-000164a0: 2068 6561 6465 7273 2069 6620 685b 305d   headers if h[0]
-000164b0: 203d 3d20 736c 6963 655f 6e61 6d65 5d0a   == slice_name].
-000164c0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-000164d0: 6f74 206e 616d 655f 6173 5f69 6e64 6578  ot name_as_index
-000164e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000164f0: 2020 6865 6164 6572 732e 696e 7365 7274    headers.insert
-00016500: 2830 2c20 2822 222c 2022 524f 4922 2929  (0, ("", "ROI"))
-00016510: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00016520: 4164 6420 4d75 6c74 6949 6e64 6578 0a20  Add MultiIndex. 
-00016530: 2020 2020 2020 2020 2020 2064 662e 636f             df.co
-00016540: 6c75 6d6e 7320 3d20 7064 2e4d 756c 7469  lumns = pd.Multi
-00016550: 496e 6465 782e 6672 6f6d 5f74 7570 6c65  Index.from_tuple
-00016560: 7328 6865 6164 6572 7329 0a0a 2020 2020  s(headers)..    
-00016570: 2020 2020 6966 2068 746d 6c3a 0a20 2020      if html:.   
-00016580: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00016590: 6466 5f74 6f5f 6874 6d6c 2864 6629 0a20  df_to_html(df). 
-000165a0: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
-000165b0: 0a0a 2020 2020 6465 6620 6765 745f 6365  ..    def get_ce
-000165c0: 6e74 726f 6964 5f64 6973 7461 6e63 6528  ntroid_distance(
-000165d0: 7365 6c66 2c20 726f 692c 2073 696e 676c  self, roi, singl
-000165e0: 655f 736c 6963 653d 4661 6c73 652c 2076  e_slice=False, v
-000165f0: 6965 773d 2278 2d79 222c 0a20 2020 2020  iew="x-y",.     
-00016600: 2020 2020 2020 2073 6c3d 4e6f 6e65 2c20         sl=None, 
-00016610: 6964 783d 4e6f 6e65 2c20 706f 733d 4e6f  idx=None, pos=No
-00016620: 6e65 2c20 756e 6974 733d 226d 6d22 2c20  ne, units="mm", 
-00016630: 6d65 7468 6f64 3d4e 6f6e 652c 2066 6f72  method=None, for
-00016640: 6365 3d54 7275 652c 0a20 2020 2020 2020  ce=True,.       
-00016650: 2020 2020 2062 795f 736c 6963 653d 4e6f       by_slice=No
-00016660: 6e65 2c20 7661 6c75 655f 666f 725f 6e6f  ne, value_for_no
-00016670: 6e65 3d4e 6f6e 652c 2073 6c69 6365 5f73  ne=None, slice_s
-00016680: 7461 743d 4e6f 6e65 2c0a 2020 2020 2020  tat=None,.      
-00016690: 2020 2020 2020 2a2a 736c 6963 655f 7374        **slice_st
-000166a0: 6174 5f6b 7761 7267 7329 3a0a 2020 2020  at_kwargs):.    
-000166b0: 2020 2020 2222 2247 6574 2063 656e 7472      """Get centr
-000166c0: 6f69 6420 6469 7370 6c61 6365 6d65 6e74  oid displacement
-000166d0: 2076 6563 746f 7220 7769 7468 2072 6573   vector with res
-000166e0: 7065 6374 2074 6f20 616e 6f74 6865 7220  pect to another 
-000166f0: 524f 492e 0a0a 2020 2020 2020 2020 2a2a  ROI...        **
-00016700: 5061 7261 6d65 7465 7273 3a2a 2a0a 2020  Parameters:**.  
-00016710: 2020 2020 2020 0a20 2020 2020 2020 2072        .        r
-00016720: 6f69 203a 2052 4f49 0a20 2020 2020 2020  oi : ROI.       
-00016730: 2020 2020 204f 7468 6572 2052 4f49 2077       Other ROI w
-00016740: 6974 6820 7768 6963 6820 746f 2063 6f6d  ith which to com
-00016750: 7061 7265 2063 656e 7472 6f69 642e 0a0a  pare centroid...
-00016760: 2020 2020 2020 2020 7369 6e67 6c65 5f73          single_s
-00016770: 6c69 6365 203a 2062 6f6f 6c2c 2064 6566  lice : bool, def
-00016780: 6175 6c74 3d46 616c 7365 0a20 2020 2020  ault=False.     
-00016790: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-000167a0: 7468 6520 6365 6e74 726f 6964 2077 696c  the centroid wil
-000167b0: 6c20 6265 2072 6574 7572 6e65 6420 666f  l be returned fo
-000167c0: 7220 6120 7369 6e67 6c65 2073 6c69 6365  r a single slice
-000167d0: 2e0a 0a20 2020 2020 2020 2076 6965 7720  ...        view 
-000167e0: 3a20 7374 722c 2064 6566 6175 6c74 3d22  : str, default="
-000167f0: 782d 7922 0a20 2020 2020 2020 2020 2020  x-y".           
-00016800: 204f 7269 656e 7461 7469 6f6e 2069 6e20   Orientation in 
-00016810: 7768 6963 6820 746f 2067 6574 2063 656e  which to get cen
-00016820: 7472 6f69 6473 2069 6620 7573 696e 6720  troids if using 
-00016830: 6120 7369 6e67 6c65 2073 6c69 6365 206f  a single slice o
-00016840: 720a 2020 2020 2020 2020 2020 2020 666c  r.            fl
-00016850: 6174 7465 6e69 6e67 2e0a 0a20 2020 2020  attening...     
-00016860: 2020 2066 6c61 7474 656e 203a 2062 6f6f     flatten : boo
-00016870: 6c2c 2064 6566 6175 6c74 3d46 616c 7365  l, default=False
-00016880: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00016890: 5472 7565 2c20 7468 6520 3344 2063 656e  True, the 3D cen
-000168a0: 7472 6f69 6420 7769 6c6c 2062 6520 6f62  troid will be ob
-000168b0: 7461 696e 6564 2061 6e64 2074 6865 6e20  tained and then 
-000168c0: 7468 6520 6162 736f 6c75 7465 200a 2020  the absolute .  
-000168d0: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
-000168e0: 616c 6f6e 6720 6f6e 6c79 2074 6865 2032  along only the 2
-000168f0: 4420 6178 6573 2069 6e20 7468 6520 6f72  D axes in the or
-00016900: 6965 6e74 6174 696f 6e20 696e 203c 7669  ientation in <vi
-00016910: 6577 3e20 7769 6c6c 0a20 2020 2020 2020  ew> will.       
-00016920: 2020 2020 2062 6520 7265 7475 726e 6564       be returned
-00016930: 2e0a 0a20 2020 2020 2020 2073 6c20 3a20  ...        sl : 
-00016940: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
-00016950: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
-00016960: 6963 6520 6e75 6d62 6572 2e20 4966 206e  ice number. If n
-00016970: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
-00016980: 783e 206f 7220 3c70 6f73 3e20 6172 6520  x> or <pos> are 
-00016990: 7375 7070 6c69 6564 2062 7574 0a20 2020  supplied but.   
-000169a0: 2020 2020 2020 2020 203c 7369 6e67 6c65           <single
-000169b0: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
-000169c0: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
-000169d0: 6365 206f 6620 6561 6368 2052 4f49 0a20  ce of each ROI. 
-000169e0: 2020 2020 2020 2020 2020 2077 696c 6c20             will 
-000169f0: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
-00016a00: 2020 6964 7820 3a20 696e 742c 2064 6566    idx : int, def
-00016a10: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00016a20: 2020 2020 2020 4172 7261 7920 696e 6465        Array inde
-00016a30: 7820 6f66 2073 6c69 6365 2e20 4966 206e  x of slice. If n
-00016a40: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
-00016a50: 783e 206f 7220 3c70 6f73 3e20 6172 6520  x> or <pos> are 
-00016a60: 7375 7070 6c69 6564 0a20 2020 2020 2020  supplied.       
-00016a70: 2020 2020 2062 7574 203c 7369 6e67 6c65       but <single
-00016a80: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
-00016a90: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
-00016aa0: 6365 206f 6620 6561 6368 2052 4f49 0a20  ce of each ROI. 
-00016ab0: 2020 2020 2020 2020 2020 2077 696c 6c20             will 
-00016ac0: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
-00016ad0: 2020 706f 7320 3a20 666c 6f61 742c 2064    pos : float, d
-00016ae0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00016af0: 2020 2020 2020 2020 536c 6963 6520 706f          Slice po
-00016b00: 7369 7469 6f6e 2069 6e20 6d6d 2e20 4966  sition in mm. If
-00016b10: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
-00016b20: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
-00016b30: 6520 7375 7070 6c69 6564 0a20 2020 2020  e supplied.     
-00016b40: 2020 2020 2020 2062 7574 203c 7369 6e67         but <sing
-00016b50: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
-00016b60: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
-00016b70: 6c69 6365 206f 6620 6561 6368 2052 4f49  lice of each ROI
-00016b80: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
-00016b90: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
-00016ba0: 2020 2020 756e 6974 7320 3a20 7374 722c      units : str,
-00016bb0: 2064 6566 6175 6c74 3d22 6d6d 220a 2020   default="mm".  
-00016bc0: 2020 2020 2020 2020 2020 556e 6974 7320            Units 
-00016bd0: 6f66 2061 6273 6f6c 7574 6520 6365 6e74  of absolute cent
-00016be0: 726f 6964 2064 6973 7461 6e63 652e 2043  roid distance. C
-00016bf0: 616e 2062 6520 616e 7920 6f66 3a0a 2020  an be any of:.  
-00016c00: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
-00016c10: 226d 6d22 3a20 7265 7475 726e 2063 656e  "mm": return cen
-00016c20: 7472 6f69 6420 706f 7369 7469 6f6e 2069  troid position i
-00016c30: 6e20 6d69 6c6c 696d 6574 7265 732e 0a20  n millimetres.. 
-00016c40: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-00016c50: 2022 766f 7865 6c73 223a 2072 6574 7572   "voxels": retur
-00016c60: 6e20 6365 6e74 726f 6964 2070 6f73 6974  n centroid posit
-00016c70: 696f 6e20 696e 2074 6572 6d73 206f 6620  ion in terms of 
-00016c80: 6172 7261 7920 696e 6469 6365 732e 0a20  array indices.. 
-00016c90: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-00016ca0: 2022 736c 6963 6522 3a20 7265 7475 726e   "slice": return
-00016cb0: 2063 656e 7472 6f69 6420 706f 7369 7469   centroid positi
-00016cc0: 6f6e 2069 6e20 7465 726d 7320 6f66 2073  on in terms of s
-00016cd0: 6c69 6365 206e 756d 6265 7273 2e0a 0a20  lice numbers... 
-00016ce0: 2020 2020 2020 2020 2020 2049 6620 756e             If un
-00016cf0: 6974 733d 2276 6f78 656c 7322 206f 7220  its="voxels" or 
-00016d00: 2273 6c69 6365 2220 6973 2072 6571 7565  "slice" is reque
-00016d10: 7374 6564 2062 7574 2065 6974 6865 7220  sted but either 
-00016d20: 524f 4920 6f6e 6c79 2068 6173 200a 2020  ROI only has .  
-00016d30: 2020 2020 2020 2020 2020 636f 6e74 6f75            contou
-00016d40: 7273 2061 6e64 206e 6f20 6d61 736b 2073  rs and no mask s
-00016d50: 6861 7065 2f76 6f78 656c 2073 697a 6520  hape/voxel size 
-00016d60: 696e 666f 726d 6174 696f 6e2c 2061 6e20  information, an 
-00016d70: 6572 726f 7220 7769 6c6c 2062 6520 0a20  error will be . 
-00016d80: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00016d90: 6420 2875 6e6c 6573 7320 6178 3d22 7a22  d (unless ax="z"
-00016da0: 2c20 696e 2077 6869 6368 2063 6173 6520  , in which case 
-00016db0: 766f 7865 6c20 7369 7a65 2077 696c 6c20  voxel size will 
-00016dc0: 6265 2069 6e66 6572 7265 6420 0a20 2020  be inferred .   
-00016dd0: 2020 2020 2020 2020 2066 726f 6d20 7370           from sp
-00016de0: 6163 696e 6720 6265 7477 6565 6e20 736c  acing between sl
-00016df0: 6963 6573 292e 0a0a 2020 2020 2020 2020  ices)...        
-00016e00: 6d65 7468 6f64 203a 2073 7472 2c20 6465  method : str, de
-00016e10: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00016e20: 2020 2020 2020 204d 6574 686f 6420 746f         Method to
-00016e30: 2075 7365 2066 6f72 2063 656e 7472 6f69   use for centroi
-00016e40: 6420 6361 6c63 756c 6174 696f 6e2e 2043  d calculation. C
-00016e50: 616e 2062 653a 200a 2020 2020 2020 2020  an be: .        
-00016e60: 2020 2020 2020 2020 2d20 2263 6f6e 746f          - "conto
-00016e70: 7572 223a 2067 6574 2063 656e 7472 6f69  ur": get centroi
-00016e80: 6420 6f66 2073 6861 7065 6c79 2063 6f6e  d of shapely con
-00016e90: 746f 7572 2873 292e 0a20 2020 2020 2020  tour(s)..       
-00016ea0: 2020 2020 2020 2020 202d 2022 6d61 736b           - "mask
-00016eb0: 223a 2067 6574 2061 7665 7261 6765 2070  ": get average p
-00016ec0: 6f73 6974 696f 6e20 6f66 2076 6f78 656c  osition of voxel
-00016ed0: 7320 696e 2062 696e 6172 7920 6d61 736b  s in binary mask
-00016ee0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016ef0: 2020 2d20 4e6f 6e65 3a20 7573 6520 7468    - None: use th
-00016f00: 6520 6d65 7468 6f64 2073 6574 2069 6e20  e method set in 
-00016f10: 7365 6c66 2e64 6566 6175 6c74 5f67 656f  self.default_geo
-00016f20: 6d5f 6d65 7468 6f64 2e0a 0a20 2020 2020  m_method...     
-00016f30: 2020 2066 6f72 6365 203a 2062 6f6f 6c2c     force : bool,
-00016f40: 2064 6566 6175 6c74 3d54 7275 650a 2020   default=True.  
-00016f50: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-00016f60: 652c 2074 6865 2067 6c6f 6261 6c20 6365  e, the global ce
-00016f70: 6e74 726f 6964 2077 696c 6c20 616c 7761  ntroid will alwa
-00016f80: 7973 2062 6520 7265 6361 6c63 756c 6174  ys be recalculat
-00016f90: 6564 3b20 0a20 2020 2020 2020 2020 2020  ed; .           
-00016fa0: 206f 7468 6572 7769 7365 2c20 6974 2077   otherwise, it w
-00016fb0: 696c 6c20 6f6e 6c79 2062 6520 6361 6c63  ill only be calc
-00016fc0: 756c 6174 6564 2069 6620 6974 2068 6173  ulated if it has
-00016fd0: 206e 6f74 2079 6574 2062 6565 6e20 6361   not yet been ca
-00016fe0: 6368 6564 200a 2020 2020 2020 2020 2020  ched .          
-00016ff0: 2020 696e 2073 656c 662e 5f76 6f6c 756d    in self._volum
-00017000: 652e 2020 4e6f 7465 2074 6861 7420 6966  e.  Note that if
-00017010: 2073 696e 676c 655f 736c 6963 653d 5472   single_slice=Tr
-00017020: 7565 2c20 7468 6520 6365 6e74 726f 6964  ue, the centroid
-00017030: 2077 696c 6c20 0a20 2020 2020 2020 2020   will .         
-00017040: 2020 2061 6c77 6179 7320 6265 2072 6563     always be rec
-00017050: 616c 6375 6c61 7465 642e 0a0a 2020 2020  alculated...    
-00017060: 2020 2020 6279 5f73 6c69 6365 203a 2073      by_slice : s
-00017070: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
-00017080: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00017090: 6f6e 6520 6f66 2022 6c65 6674 222c 2022  one of "left", "
-000170a0: 7269 6768 7422 2c20 2275 6e69 6f6e 222c  right", "union",
-000170b0: 2022 696e 7465 7273 6563 7469 6f6e 222c   "intersection",
-000170c0: 2063 616c 6375 6c61 7465 0a20 2020 2020   calculate.     
-000170d0: 2020 2020 2020 2044 6963 6520 7363 6f72         Dice scor
-000170e0: 6573 2073 6c69 6365 2062 7920 736c 6963  es slice by slic
-000170f0: 6520 666f 7220 6561 6368 2073 6c69 6365  e for each slice
-00017100: 2063 6f6e 7461 696e 696e 670a 2020 2020   containing.    
-00017110: 2020 2020 2020 2020 7365 6c66 2061 6e64          self and
-00017120: 2f6f 7220 6f74 6865 723a 0a0a 2020 2020  /or other:..    
-00017130: 2020 2020 2020 2020 2d20 226c 6566 7422          - "left"
-00017140: 3a20 636f 6e73 6964 6572 206f 6e6c 7920  : consider only 
-00017150: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
-00017160: 6720 7365 6c66 3b0a 2020 2020 2020 2020  g self;.        
-00017170: 2020 2020 2d20 2272 6967 6874 223a 2063      - "right": c
-00017180: 6f6e 7369 6465 7220 6f6e 6c79 2073 6c69  onsider only sli
-00017190: 6365 7320 636f 6e74 6169 6e69 6e67 206f  ces containing o
-000171a0: 7468 6572 3b0a 2020 2020 2020 2020 2020  ther;.          
-000171b0: 2020 2d20 2275 6e69 6f6e 223a 2063 6f6e    - "union": con
-000171c0: 7369 6465 7220 736c 6963 6573 2063 6f6e  sider slices con
-000171d0: 7461 696e 696e 6720 6569 7468 6572 206f  taining either o
-000171e0: 6620 7365 6c66 2061 6e64 206f 7468 6572  f self and other
-000171f0: 3b0a 2020 2020 2020 2020 2020 2020 2d20  ;.            - 
-00017200: 2269 6e74 6572 7365 6374 696f 6e22 3a20  "intersection": 
-00017210: 636f 6e73 6964 6572 2073 6c69 6365 7320  consider slices 
-00017220: 636f 6e74 6169 6e69 6e67 2062 6f74 6820  containing both 
-00017230: 6f66 2073 656c 6620 616e 6420 6f74 6865  of self and othe
-00017240: 722e 0a0a 2020 2020 2020 2020 2020 2020  r...            
-00017250: 4966 2073 6c69 6365 5f73 7461 7420 6973  If slice_stat is
-00017260: 204e 6f6e 652c 2072 6574 7572 6e20 6120   None, return a 
-00017270: 6469 6374 696f 6e61 7279 2077 6865 7265  dictionary where
-00017280: 206b 6579 7320 6172 650a 2020 2020 2020   keys are.      
-00017290: 2020 2020 2020 736c 6963 6520 706f 7369        slice posi
-000172a0: 7469 6f6e 7320 616e 6420 7661 6c75 6573  tions and values
-000172b0: 2061 7265 2074 6865 2063 616c 6375 6c61   are the calcula
-000172c0: 7465 6420 4469 6365 2073 636f 7265 732e  ted Dice scores.
-000172d0: 0a20 2020 2020 2020 2020 2020 204f 7468  .            Oth
-000172e0: 6572 7769 7365 2c20 7265 7475 726e 2066  erwise, return f
-000172f0: 6f72 2074 6865 2063 616c 6375 6c61 7465  or the calculate
-00017300: 6420 4469 6365 2073 636f 7265 7320 7468  d Dice scores th
-00017310: 6520 7374 6174 6973 7469 630a 2020 2020  e statistic.    
-00017320: 2020 2020 2020 2020 7370 6563 6966 6965          specifie
-00017330: 6420 6279 2073 6c69 6365 5f73 7461 742e  d by slice_stat.
-00017340: 0a0a 2020 2020 2020 2020 7661 6c75 655f  ..        value_
-00017350: 666f 725f 6e6f 6e65 203a 2066 6c6f 6174  for_none : float
-00017360: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00017370: 2020 2020 2020 2020 2020 2046 6f72 2073             For s
-00017380: 696e 676c 655f 736c 6963 6520 616e 6420  ingle_slice and 
-00017390: 6279 5f73 6c69 6365 2c20 7661 6c75 6520  by_slice, value 
-000173a0: 746f 2062 6520 7265 7475 726e 6564 2066  to be returned f
-000173b0: 6f72 0a20 2020 2020 2020 2020 2020 2073  or.            s
-000173c0: 6c69 6365 7320 7768 6572 6520 4469 6365  lices where Dice
-000173d0: 2073 636f 7265 2069 7320 756e 6465 7465   score is undete
-000173e0: 726d 696e 6564 2028 4e6f 6e65 292e 2020  rmined (None).  
-000173f0: 466f 7220 736c 6963 655f 7374 6174 2c0a  For slice_stat,.
-00017400: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-00017410: 6520 746f 2073 7562 7374 6974 7574 6520  e to substitute 
-00017420: 666f 7220 616e 7920 4e6f 6e65 2076 616c  for any None val
-00017430: 7565 7320 616d 6f6e 6720 7468 6520 696e  ues among the in
-00017440: 7075 7473 0a20 2020 2020 2020 2020 2020  puts.           
-00017450: 2066 6f72 2063 616c 6375 6c61 7469 6e67   for calculating
-00017460: 2073 6c69 6365 2d62 6173 6564 2073 7461   slice-based sta
-00017470: 7469 7374 6963 2e20 2049 6620 4e6f 6e65  tistic.  If None
-00017480: 2069 6e20 7468 6520 6c61 7474 6572 0a20   in the latter. 
-00017490: 2020 2020 2020 2020 2020 2063 6173 652c             case,
-000174a0: 204e 6f6e 6520 7661 6c75 6573 2061 6d6f   None values amo
-000174b0: 6e67 2074 6865 2069 6e70 7574 7320 6172  ng the inputs ar
-000174c0: 6520 6f6d 6974 7465 642e 0a0a 2020 2020  e omitted...    
-000174d0: 2020 2020 736c 6963 655f 7374 6174 203a      slice_stat :
-000174e0: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
-000174f0: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
-00017500: 696e 676c 652d 7661 7269 6162 6c65 2073  ingle-variable s
-00017510: 7461 7469 7374 6963 2873 2920 746f 2062  tatistic(s) to b
-00017520: 6520 7265 7475 726e 6564 2066 6f72 2073  e returned for s
-00017530: 6c69 6365 2d62 792d 736c 6963 650a 2020  lice-by-slice.  
-00017540: 2020 2020 2020 2020 2020 4469 6365 2073            Dice s
-00017550: 636f 7265 732e 2020 5468 6973 2073 686f  cores.  This sho
-00017560: 756c 6420 6265 2074 6865 206e 616d 6520  uld be the name 
-00017570: 6f66 2074 6865 2066 756e 6374 696f 6e20  of the function 
-00017580: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
-00017590: 6361 6c63 756c 6174 696f 6e20 6f66 2074  calculation of t
-000175a0: 6865 2073 7461 7469 7374 6963 2873 2920  he statistic(s) 
-000175b0: 696e 2074 6865 2050 7974 686f 6e20 7374  in the Python st
-000175c0: 6174 6973 7469 6373 206d 6f64 756c 653a  atistics module:
-000175d0: 0a0a 2020 2020 2020 2020 2020 2020 6874  ..            ht
-000175e0: 7470 733a 2f2f 646f 6373 2e70 7974 686f  tps://docs.pytho
-000175f0: 6e2e 6f72 672f 332f 6c69 6272 6172 792f  n.org/3/library/
-00017600: 7374 6174 6973 7469 6373 2e68 746d 6c0a  statistics.html.
-00017610: 0a20 2020 2020 2020 2020 2020 2041 7661  .            Ava
-00017620: 696c 6162 6c65 206f 7074 696f 6e73 2069  ilable options i
-00017630: 6e63 6c75 6465 3a20 226d 6561 6e22 2c20  nclude: "mean", 
-00017640: 226d 6564 6961 6e22 2c20 226d 6f64 6522  "median", "mode"
-00017650: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-00017660: 7464 6576 222c 2022 7175 616e 7469 6c65  tdev", "quantile
-00017670: 7322 2e20 2044 6973 7265 6761 7264 6564  s".  Disregarded
-00017680: 2069 6620 4e6f 6e65 2e0a 0a20 2020 2020   if None...     
-00017690: 2020 2020 2020 2049 6620 6279 5f73 6c69         If by_sli
-000176a0: 6365 2069 7320 4e6f 6e65 2061 6e64 2073  ce is None and s
-000176b0: 6c69 6365 5f73 7461 7420 6973 2064 6966  lice_stat is dif
-000176c0: 6665 7265 6e74 2066 726f 6d20 4e6f 6e65  ferent from None
-000176d0: 2c0a 2020 2020 2020 2020 2020 2020 736b  ,.            sk
-000176e0: 7274 2e63 6f72 652e 4465 6661 756c 7473  rt.core.Defaults
-000176f0: 2829 2e62 795f 736c 6963 6520 6973 2075  ().by_slice is u
-00017700: 7365 6420 666f 7220 7468 6520 666f 726d  sed for the form
-00017710: 6572 2e0a 0a20 2020 2020 2020 2073 6c69  er...        sli
-00017720: 6365 5f73 7461 745f 6b77 6172 6773 203a  ce_stat_kwargs :
-00017730: 2064 6963 742c 2064 6566 6175 6c74 3d4e   dict, default=N
-00017740: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00017750: 4b65 7977 6f72 6420 6172 6775 6d65 6e74  Keyword argument
-00017760: 7320 746f 2062 6520 7061 7373 6564 2074  s to be passed t
-00017770: 6f20 6675 6e63 7469 6f6e 206f 6620 7374  o function of st
-00017780: 6174 6973 7469 6373 0a20 2020 2020 2020  atistics.       
-00017790: 2020 2020 206d 6f64 756c 6520 666f 7220       module for 
-000177a0: 6361 6c63 756c 6174 696f 6e20 7265 6c61  calculation rela
-000177b0: 7469 7665 2074 6f20 736c 6963 6520 7661  tive to slice va
-000177c0: 6c75 6573 2e20 2046 6f72 2065 7861 6d70  lues.  For examp
-000177d0: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-000177e0: 6966 2071 7561 6e74 696c 6573 2061 7265  if quantiles are
-000177f0: 2072 6571 7569 7265 6420 666f 7220 3130   required for 10
-00017800: 2069 6e74 6572 7661 6c73 2c20 7261 7468   intervals, rath
-00017810: 6572 2074 6861 6e20 666f 720a 2020 2020  er than for.    
-00017820: 2020 2020 2020 2020 7468 6520 6465 6661          the defa
-00017830: 756c 7420 6f66 2034 2c20 7468 6973 2063  ult of 4, this c
-00017840: 616e 2062 6520 7370 6563 6966 6965 6420  an be specified 
-00017850: 7573 696e 673a 0a0a 2020 2020 2020 2020  using:..        
-00017860: 2020 2020 736c 6963 655f 7374 6174 5f6b      slice_stat_k
-00017870: 7761 7267 737b 226e 2220 3a20 3130 7d0a  wargs{"n" : 10}.
-00017880: 0a20 2020 2020 2020 2020 2020 2046 6f72  .            For
-00017890: 2061 7661 696c 6162 6c65 206b 6579 776f   available keywo
-000178a0: 7264 206f 7074 696f 6e73 2c20 7365 6520  rd options, see 
-000178b0: 646f 6375 6d65 6e74 6174 696f 6e20 6f66  documentation of
-000178c0: 2073 7461 7469 7374 6963 730a 2020 2020   statistics.    
-000178d0: 2020 2020 2020 2020 6d6f 6475 6c65 2061          module a
-000178e0: 743a 0a0a 2020 2020 2020 2020 2020 2020  t:..            
-000178f0: 6874 7470 733a 2f2f 646f 6373 2e70 7974  https://docs.pyt
-00017900: 686f 6e2e 6f72 672f 332f 6c69 6272 6172  hon.org/3/librar
-00017910: 792f 7374 6174 6973 7469 6373 2e68 746d  y/statistics.htm
-00017920: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
-00017930: 2020 2020 2020 6966 2073 6c69 6365 5f73        if slice_s
-00017940: 7461 743a 0a20 2020 2020 2020 2020 2020  tat:.           
-00017950: 2072 6574 7572 6e20 7365 6c66 2e67 6574   return self.get
-00017960: 5f73 6c69 6365 5f73 7461 7428 726f 692c  _slice_stat(roi,
-00017970: 2022 6365 6e74 726f 6964 222c 2073 6c69   "centroid", sli
-00017980: 6365 5f73 7461 742c 0a20 2020 2020 2020  ce_stat,.       
-00017990: 2020 2020 2020 2020 2020 2020 2062 795f               by_
-000179a0: 736c 6963 652c 2076 616c 7565 5f66 6f72  slice, value_for
-000179b0: 5f6e 6f6e 652c 2076 6965 772c 206d 6574  _none, view, met
-000179c0: 686f 642c 0a20 2020 2020 2020 2020 2020  hod,.           
-000179d0: 2020 2020 2020 2020 202a 2a28 736c 6963           **(slic
-000179e0: 655f 7374 6174 5f6b 7761 7267 7320 6f72  e_stat_kwargs or
-000179f0: 207b 7d29 290a 0a20 2020 2020 2020 2069   {}))..        i
-00017a00: 6620 6279 5f73 6c69 6365 3a0a 2020 2020  f by_slice:.    
-00017a10: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00017a20: 656c 662e 6765 745f 6d65 7472 6963 5f62  elf.get_metric_b
-00017a30: 795f 736c 6963 6528 726f 692c 2022 6365  y_slice(roi, "ce
-00017a40: 6e74 726f 6964 222c 2062 795f 736c 6963  ntroid", by_slic
-00017a50: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00017a60: 2020 2020 2020 2076 6965 772c 206d 6574         view, met
-00017a70: 686f 6429 0a0a 2020 2020 2020 2020 7468  hod)..        th
-00017a80: 6973 5f63 656e 7472 6f69 6420 3d20 6e70  is_centroid = np
-00017a90: 2e61 7272 6179 2873 656c 662e 6765 745f  .array(self.get_
-00017aa0: 6365 6e74 726f 6964 280a 2020 2020 2020  centroid(.      
-00017ab0: 2020 2020 2020 7369 6e67 6c65 5f73 6c69        single_sli
-00017ac0: 6365 3d73 696e 676c 655f 736c 6963 652c  ce=single_slice,
-00017ad0: 2076 6965 773d 7669 6577 2c20 736c 3d73   view=view, sl=s
-00017ae0: 6c2c 2069 6478 3d69 6478 2c20 706f 733d  l, idx=idx, pos=
-00017af0: 706f 732c 0a20 2020 2020 2020 2020 2020  pos,.           
-00017b00: 2075 6e69 7473 3d75 6e69 7473 2c20 6d65   units=units, me
-00017b10: 7468 6f64 3d6d 6574 686f 642c 2066 6f72  thod=method, for
-00017b20: 6365 3d66 6f72 6365 290a 2020 2020 2020  ce=force).      
-00017b30: 2020 290a 2020 2020 2020 2020 6f74 6865    ).        othe
-00017b40: 725f 6365 6e74 726f 6964 203d 206e 702e  r_centroid = np.
-00017b50: 6172 7261 7928 726f 692e 6765 745f 6365  array(roi.get_ce
-00017b60: 6e74 726f 6964 280a 2020 2020 2020 2020  ntroid(.        
-00017b70: 2020 2020 7369 6e67 6c65 5f73 6c69 6365      single_slice
-00017b80: 3d73 696e 676c 655f 736c 6963 652c 2076  =single_slice, v
-00017b90: 6965 773d 7669 6577 2c20 736c 3d73 6c2c  iew=view, sl=sl,
-00017ba0: 2069 6478 3d69 6478 2c20 706f 733d 706f   idx=idx, pos=po
-00017bb0: 732c 0a20 2020 2020 2020 2020 2020 2075  s,.            u
-00017bc0: 6e69 7473 3d75 6e69 7473 2c20 6d65 7468  nits=units, meth
-00017bd0: 6f64 3d6d 6574 686f 642c 2066 6f72 6365  od=method, force
-00017be0: 3d66 6f72 6365 290a 2020 2020 2020 2020  =force).        
-00017bf0: 290a 2020 2020 2020 2020 6966 204e 6f6e  ).        if Non
-00017c00: 6520 696e 2074 6869 735f 6365 6e74 726f  e in this_centro
-00017c10: 6964 206f 7220 4e6f 6e65 2069 6e20 6f74  id or None in ot
-00017c20: 6865 725f 6365 6e74 726f 6964 3a0a 2020  her_centroid:.  
-00017c30: 2020 2020 2020 2020 2020 6966 2073 696e            if sin
-00017c40: 676c 655f 736c 6963 653a 0a20 2020 2020  gle_slice:.     
-00017c50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00017c60: 6e20 6e70 2e61 7272 6179 285b 7661 6c75  n np.array([valu
-00017c70: 655f 666f 725f 6e6f 6e65 2c20 7661 6c75  e_for_none, valu
-00017c80: 655f 666f 725f 6e6f 6e65 5d29 0a20 2020  e_for_none]).   
-00017c90: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00017ca0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00017cb0: 6574 7572 6e20 6e70 2e61 7272 6179 285b  eturn np.array([
-00017cc0: 7661 6c75 655f 666f 725f 6e6f 6e65 2c20  value_for_none, 
-00017cd0: 7661 6c75 655f 666f 725f 6e6f 6e65 2c0a  value_for_none,.
-00017ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017cf0: 2020 2020 7661 6c75 655f 666f 725f 6e6f      value_for_no
-00017d00: 6e65 5d29 0a20 2020 2020 2020 2072 6574  ne]).        ret
-00017d10: 7572 6e20 6f74 6865 725f 6365 6e74 726f  urn other_centro
-00017d20: 6964 202d 2074 6869 735f 6365 6e74 726f  id - this_centro
-00017d30: 6964 0a0a 2020 2020 6465 6620 6765 745f  id..    def get_
-00017d40: 6162 735f 6365 6e74 726f 6964 5f64 6973  abs_centroid_dis
-00017d50: 7461 6e63 6528 0a20 2020 2020 2020 2073  tance(.        s
-00017d60: 656c 662c 200a 2020 2020 2020 2020 726f  elf, .        ro
-00017d70: 692c 200a 2020 2020 2020 2020 7669 6577  i, .        view
-00017d80: 3d22 782d 7922 2c20 0a20 2020 2020 2020  ="x-y", .       
-00017d90: 2073 696e 676c 655f 736c 6963 653d 4661   single_slice=Fa
-00017da0: 6c73 652c 0a20 2020 2020 2020 2066 6c61  lse,.        fla
-00017db0: 7474 656e 3d46 616c 7365 2c20 0a20 2020  tten=False, .   
-00017dc0: 2020 2020 2073 6c3d 4e6f 6e65 2c0a 2020       sl=None,.  
-00017dd0: 2020 2020 2020 6964 783d 4e6f 6e65 2c0a        idx=None,.
-00017de0: 2020 2020 2020 2020 706f 733d 4e6f 6e65          pos=None
-00017df0: 2c0a 2020 2020 2020 2020 756e 6974 733d  ,.        units=
-00017e00: 226d 6d22 2c0a 2020 2020 2020 2020 6d65  "mm",.        me
-00017e10: 7468 6f64 3d4e 6f6e 652c 0a20 2020 2020  thod=None,.     
-00017e20: 2020 2066 6f72 6365 3d54 7275 652c 0a20     force=True,. 
-00017e30: 2020 2020 2020 2062 795f 736c 6963 653d         by_slice=
-00017e40: 4e6f 6e65 2c0a 2020 2020 2020 2020 7661  None,.        va
-00017e50: 6c75 655f 666f 725f 6e6f 6e65 3d4e 6f6e  lue_for_none=Non
-00017e60: 652c 0a20 2020 2020 2020 2073 6c69 6365  e,.        slice
-00017e70: 5f73 7461 743d 4e6f 6e65 2c0a 2020 2020  _stat=None,.    
-00017e80: 2020 2020 736c 6963 655f 7374 6174 5f6b      slice_stat_k
-00017e90: 7761 7267 733d 4e6f 6e65 2c0a 2020 2020  wargs=None,.    
-00017ea0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-00017eb0: 2222 4765 7420 6162 736f 6c75 7465 2063  ""Get absolute c
-00017ec0: 656e 7472 6f69 6420 6469 7374 616e 6365  entroid distance
-00017ed0: 2077 6974 6820 7265 7370 6563 7420 746f   with respect to
-00017ee0: 2061 6e6f 7468 6572 2052 4f49 2e0a 0a20   another ROI... 
-00017ef0: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
-00017f00: 6572 733a 2a2a 0a20 2020 2020 2020 200a  ers:**.        .
-00017f10: 2020 2020 2020 2020 726f 6920 3a20 524f          roi : RO
-00017f20: 490a 2020 2020 2020 2020 2020 2020 4f74  I.            Ot
-00017f30: 6865 7220 524f 4920 7769 7468 2077 6869  her ROI with whi
-00017f40: 6368 2074 6f20 636f 6d70 6172 6520 6365  ch to compare ce
-00017f50: 6e74 726f 6964 2e0a 0a20 2020 2020 2020  ntroid...       
-00017f60: 2076 6965 7720 3a20 7374 722c 2064 6566   view : str, def
-00017f70: 6175 6c74 3d22 782d 7922 0a20 2020 2020  ault="x-y".     
-00017f80: 2020 2020 2020 204f 7269 656e 7461 7469         Orientati
-00017f90: 6f6e 2069 6e20 7768 6963 6820 746f 2067  on in which to g
-00017fa0: 6574 2063 656e 7472 6f69 6473 2069 6620  et centroids if 
-00017fb0: 7573 696e 6720 6120 7369 6e67 6c65 2073  using a single s
-00017fc0: 6c69 6365 206f 720a 2020 2020 2020 2020  lice or.        
-00017fd0: 2020 2020 666c 6174 7465 6e69 6e67 2e0a      flattening..
-00017fe0: 0a20 2020 2020 2020 2073 696e 676c 655f  .        single_
-00017ff0: 736c 6963 6520 3a20 626f 6f6c 2c20 6465  slice : bool, de
-00018000: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-00018010: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-00018020: 2074 6865 2063 656e 7472 6f69 6420 7769   the centroid wi
-00018030: 6c6c 2062 6520 7265 7475 726e 6564 2066  ll be returned f
-00018040: 6f72 2061 2073 696e 676c 6520 736c 6963  or a single slic
-00018050: 652e 0a0a 2020 2020 2020 2020 666c 6174  e...        flat
-00018060: 7465 6e20 3a20 626f 6f6c 2c20 6465 6661  ten : bool, defa
-00018070: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
-00018080: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
-00018090: 6865 2033 4420 6365 6e74 726f 6964 2077  he 3D centroid w
-000180a0: 696c 6c20 6265 206f 6274 6169 6e65 6420  ill be obtained 
-000180b0: 616e 6420 7468 656e 2074 6865 2061 6273  and then the abs
-000180c0: 6f6c 7574 6520 0a20 2020 2020 2020 2020  olute .         
-000180d0: 2020 2076 616c 7565 2061 6c6f 6e67 206f     value along o
-000180e0: 6e6c 7920 7468 6520 3244 2061 7865 7320  nly the 2D axes 
-000180f0: 696e 2074 6865 206f 7269 656e 7461 7469  in the orientati
-00018100: 6f6e 2069 6e20 3c76 6965 773e 2077 696c  on in <view> wil
-00018110: 6c0a 2020 2020 2020 2020 2020 2020 6265  l.            be
-00018120: 2072 6574 7572 6e65 642e 0a0a 2020 2020   returned...    
-00018130: 2020 2020 736c 203a 2069 6e74 2c20 6465      sl : int, de
-00018140: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00018150: 2020 2020 2020 2053 6c69 6365 206e 756d         Slice num
-00018160: 6265 722e 2049 6620 6e6f 6e65 206f 6620  ber. If none of 
-00018170: 3c73 6c3e 2c20 3c69 6478 3e20 6f72 203c  <sl>, <idx> or <
-00018180: 706f 733e 2061 7265 2073 7570 706c 6965  pos> are supplie
-00018190: 6420 6275 740a 2020 2020 2020 2020 2020  d but.          
-000181a0: 2020 3c73 696e 676c 655f 736c 6963 653e    <single_slice>
-000181b0: 2069 7320 5472 7565 2c20 7468 6520 6365   is True, the ce
-000181c0: 6e74 7261 6c20 736c 6963 6520 6f66 2065  ntral slice of e
-000181d0: 6163 6820 524f 490a 2020 2020 2020 2020  ach ROI.        
-000181e0: 2020 2020 7769 6c6c 2062 6520 7573 6564      will be used
-000181f0: 2e0a 0a20 2020 2020 2020 2069 6478 203a  ...        idx :
-00018200: 2069 6e74 2c20 6465 6661 756c 743d 4e6f   int, default=No
-00018210: 6e65 0a20 2020 2020 2020 2020 2020 2041  ne.            A
-00018220: 7272 6179 2069 6e64 6578 206f 6620 736c  rray index of sl
-00018230: 6963 652e 2049 6620 6e6f 6e65 206f 6620  ice. If none of 
-00018240: 3c73 6c3e 2c20 3c69 6478 3e20 6f72 203c  <sl>, <idx> or <
-00018250: 706f 733e 2061 7265 2073 7570 706c 6965  pos> are supplie
-00018260: 640a 2020 2020 2020 2020 2020 2020 6275  d.            bu
-00018270: 7420 3c73 696e 676c 655f 736c 6963 653e  t <single_slice>
-00018280: 2069 7320 5472 7565 2c20 7468 6520 6365   is True, the ce
-00018290: 6e74 7261 6c20 736c 6963 6520 6f66 2065  ntral slice of e
-000182a0: 6163 6820 524f 490a 2020 2020 2020 2020  ach ROI.        
-000182b0: 2020 2020 7769 6c6c 2062 6520 7573 6564      will be used
-000182c0: 2e0a 0a20 2020 2020 2020 2070 6f73 203a  ...        pos :
-000182d0: 2066 6c6f 6174 2c20 6465 6661 756c 743d   float, default=
-000182e0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-000182f0: 2053 6c69 6365 2070 6f73 6974 696f 6e20   Slice position 
-00018300: 696e 206d 6d2e 2049 6620 6e6f 6e65 206f  in mm. If none o
-00018310: 6620 3c73 6c3e 2c20 3c69 6478 3e20 6f72  f <sl>, <idx> or
-00018320: 203c 706f 733e 2061 7265 2073 7570 706c   <pos> are suppl
-00018330: 6965 640a 2020 2020 2020 2020 2020 2020  ied.            
-00018340: 6275 7420 3c73 696e 676c 655f 736c 6963  but <single_slic
-00018350: 653e 2069 7320 5472 7565 2c20 7468 6520  e> is True, the 
-00018360: 6365 6e74 7261 6c20 736c 6963 6520 6f66  central slice of
-00018370: 2065 6163 6820 524f 490a 2020 2020 2020   each ROI.      
-00018380: 2020 2020 2020 7769 6c6c 2062 6520 7573        will be us
-00018390: 6564 2e0a 0a20 2020 2020 2020 2075 6e69  ed...        uni
-000183a0: 7473 203a 2073 7472 2c20 6465 6661 756c  ts : str, defaul
-000183b0: 743d 226d 6d22 0a20 2020 2020 2020 2020  t="mm".         
-000183c0: 2020 2055 6e69 7473 206f 6620 6162 736f     Units of abso
-000183d0: 6c75 7465 2063 656e 7472 6f69 6420 6469  lute centroid di
-000183e0: 7374 616e 6365 2e20 4361 6e20 6265 2061  stance. Can be a
-000183f0: 6e79 206f 663a 0a20 2020 2020 2020 2020  ny of:.         
-00018400: 2020 2020 2020 202d 2022 6d6d 223a 2072         - "mm": r
-00018410: 6574 7572 6e20 6365 6e74 726f 6964 2070  eturn centroid p
-00018420: 6f73 6974 696f 6e20 696e 206d 696c 6c69  osition in milli
-00018430: 6d65 7472 6573 2e0a 2020 2020 2020 2020  metres..        
-00018440: 2020 2020 2020 2020 2d20 2276 6f78 656c          - "voxel
-00018450: 7322 3a20 7265 7475 726e 2063 656e 7472  s": return centr
-00018460: 6f69 6420 706f 7369 7469 6f6e 2069 6e20  oid position in 
-00018470: 7465 726d 7320 6f66 2061 7272 6179 2069  terms of array i
-00018480: 6e64 6963 6573 2e0a 2020 2020 2020 2020  ndices..        
-00018490: 2020 2020 2020 2020 2d20 2273 6c69 6365          - "slice
-000184a0: 223a 2072 6574 7572 6e20 6365 6e74 726f  ": return centro
-000184b0: 6964 2070 6f73 6974 696f 6e20 696e 2074  id position in t
-000184c0: 6572 6d73 206f 6620 736c 6963 6520 6e75  erms of slice nu
-000184d0: 6d62 6572 732e 0a0a 2020 2020 2020 2020  mbers...        
-000184e0: 2020 2020 4966 2075 6e69 7473 3d22 766f      If units="vo
-000184f0: 7865 6c73 2220 6f72 2022 736c 6963 6522  xels" or "slice"
-00018500: 2069 7320 7265 7175 6573 7465 6420 6275   is requested bu
-00018510: 7420 6569 7468 6572 2052 4f49 206f 6e6c  t either ROI onl
-00018520: 7920 6861 7320 0a20 2020 2020 2020 2020  y has .         
-00018530: 2020 2063 6f6e 746f 7572 7320 616e 6420     contours and 
-00018540: 6e6f 206d 6173 6b20 7368 6170 652f 766f  no mask shape/vo
-00018550: 7865 6c20 7369 7a65 2069 6e66 6f72 6d61  xel size informa
-00018560: 7469 6f6e 2c20 616e 2065 7272 6f72 2077  tion, an error w
-00018570: 696c 6c20 6265 200a 2020 2020 2020 2020  ill be .        
-00018580: 2020 2020 7261 6973 6564 2028 756e 6c65      raised (unle
-00018590: 7373 2061 783d 227a 222c 2069 6e20 7768  ss ax="z", in wh
-000185a0: 6963 6820 6361 7365 2076 6f78 656c 2073  ich case voxel s
-000185b0: 697a 6520 7769 6c6c 2062 6520 696e 6665  ize will be infe
-000185c0: 7272 6564 200a 2020 2020 2020 2020 2020  rred .          
-000185d0: 2020 6672 6f6d 2073 7061 6369 6e67 2062    from spacing b
-000185e0: 6574 7765 656e 2073 6c69 6365 7329 2e0a  etween slices)..
-000185f0: 0a20 2020 2020 2020 206d 6574 686f 6420  .        method 
-00018600: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
-00018610: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00018620: 4d65 7468 6f64 2074 6f20 7573 6520 666f  Method to use fo
-00018630: 7220 6365 6e74 726f 6964 2063 616c 6375  r centroid calcu
-00018640: 6c61 7469 6f6e 2e20 4361 6e20 6265 3a20  lation. Can be: 
-00018650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018660: 202d 2022 636f 6e74 6f75 7222 3a20 6765   - "contour": ge
-00018670: 7420 6365 6e74 726f 6964 206f 6620 7368  t centroid of sh
-00018680: 6170 656c 7920 636f 6e74 6f75 7228 7329  apely contour(s)
-00018690: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000186a0: 2020 2d20 226d 6173 6b22 3a20 6765 7420    - "mask": get 
-000186b0: 6176 6572 6167 6520 706f 7369 7469 6f6e  average position
-000186c0: 206f 6620 766f 7865 6c73 2069 6e20 6269   of voxels in bi
-000186d0: 6e61 7279 206d 6173 6b2e 0a20 2020 2020  nary mask..     
-000186e0: 2020 2020 2020 2020 2020 202d 204e 6f6e             - Non
-000186f0: 653a 2075 7365 2074 6865 206d 6574 686f  e: use the metho
-00018700: 6420 7365 7420 696e 2073 656c 662e 6465  d set in self.de
-00018710: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
-00018720: 642e 0a0a 2020 2020 2020 2020 666f 7263  d...        forc
-00018730: 6520 3a20 626f 6f6c 2c20 6465 6661 756c  e : bool, defaul
-00018740: 743d 5472 7565 0a20 2020 2020 2020 2020  t=True.         
-00018750: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
-00018760: 676c 6f62 616c 2063 656e 7472 6f69 6420  global centroid 
-00018770: 7769 6c6c 2061 6c77 6179 7320 6265 2072  will always be r
-00018780: 6563 616c 6375 6c61 7465 643b 200a 2020  ecalculated; .  
-00018790: 2020 2020 2020 2020 2020 6f74 6865 7277            otherw
-000187a0: 6973 652c 2069 7420 7769 6c6c 206f 6e6c  ise, it will onl
-000187b0: 7920 6265 2063 616c 6375 6c61 7465 6420  y be calculated 
-000187c0: 6966 2069 7420 6861 7320 6e6f 7420 7965  if it has not ye
-000187d0: 7420 6265 656e 2063 6163 6865 6420 0a20  t been cached . 
-000187e0: 2020 2020 2020 2020 2020 2069 6e20 7365             in se
-000187f0: 6c66 2e5f 766f 6c75 6d65 2e20 204e 6f74  lf._volume.  Not
-00018800: 6520 7468 6174 2069 6620 7369 6e67 6c65  e that if single
-00018810: 5f73 6c69 6365 3d54 7275 652c 2074 6865  _slice=True, the
-00018820: 2063 656e 7472 6f69 6420 7769 6c6c 200a   centroid will .
-00018830: 2020 2020 2020 2020 2020 2020 616c 7761              alwa
-00018840: 7973 2062 6520 7265 6361 6c63 756c 6174  ys be recalculat
-00018850: 6564 2e0a 0a20 2020 2020 2020 2062 795f  ed...        by_
-00018860: 736c 6963 6520 3a20 7374 722c 2064 6566  slice : str, def
-00018870: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00018880: 2020 2020 2020 4966 206f 6e65 206f 6620        If one of 
-00018890: 226c 6566 7422 2c20 2272 6967 6874 222c  "left", "right",
-000188a0: 2022 756e 696f 6e22 2c20 2269 6e74 6572   "union", "inter
-000188b0: 7365 6374 696f 6e22 2c20 6361 6c63 756c  section", calcul
-000188c0: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
-000188d0: 4469 6365 2073 636f 7265 7320 736c 6963  Dice scores slic
-000188e0: 6520 6279 2073 6c69 6365 2066 6f72 2065  e by slice for e
-000188f0: 6163 6820 736c 6963 6520 636f 6e74 6169  ach slice contai
-00018900: 6e69 6e67 0a20 2020 2020 2020 2020 2020  ning.           
-00018910: 2073 656c 6620 616e 642f 6f72 206f 7468   self and/or oth
-00018920: 6572 3a0a 0a20 2020 2020 2020 2020 2020  er:..           
-00018930: 202d 2022 6c65 6674 223a 2063 6f6e 7369   - "left": consi
-00018940: 6465 7220 6f6e 6c79 2073 6c69 6365 7320  der only slices 
-00018950: 636f 6e74 6169 6e69 6e67 2073 656c 663b  containing self;
-00018960: 0a20 2020 2020 2020 2020 2020 202d 2022  .            - "
-00018970: 7269 6768 7422 3a20 636f 6e73 6964 6572  right": consider
-00018980: 206f 6e6c 7920 736c 6963 6573 2063 6f6e   only slices con
-00018990: 7461 696e 696e 6720 6f74 6865 723b 0a20  taining other;. 
-000189a0: 2020 2020 2020 2020 2020 202d 2022 756e             - "un
-000189b0: 696f 6e22 3a20 636f 6e73 6964 6572 2073  ion": consider s
-000189c0: 6c69 6365 7320 636f 6e74 6169 6e69 6e67  lices containing
-000189d0: 2065 6974 6865 7220 6f66 2073 656c 6620   either of self 
-000189e0: 616e 6420 6f74 6865 723b 0a20 2020 2020  and other;.     
-000189f0: 2020 2020 2020 202d 2022 696e 7465 7273         - "inters
-00018a00: 6563 7469 6f6e 223a 2063 6f6e 7369 6465  ection": conside
-00018a10: 7220 736c 6963 6573 2063 6f6e 7461 696e  r slices contain
-00018a20: 696e 6720 626f 7468 206f 6620 7365 6c66  ing both of self
-00018a30: 2061 6e64 206f 7468 6572 2e0a 0a20 2020   and other...   
-00018a40: 2020 2020 2020 2020 2049 6620 736c 6963           If slic
-00018a50: 655f 7374 6174 2069 7320 4e6f 6e65 2c20  e_stat is None, 
-00018a60: 7265 7475 726e 2061 2064 6963 7469 6f6e  return a diction
-00018a70: 6172 7920 7768 6572 6520 6b65 7973 2061  ary where keys a
-00018a80: 7265 0a20 2020 2020 2020 2020 2020 2073  re.            s
-00018a90: 6c69 6365 2070 6f73 6974 696f 6e73 2061  lice positions a
-00018aa0: 6e64 2076 616c 7565 7320 6172 6520 7468  nd values are th
-00018ab0: 6520 6361 6c63 756c 6174 6564 2044 6963  e calculated Dic
-00018ac0: 6520 7363 6f72 6573 2e0a 2020 2020 2020  e scores..      
-00018ad0: 2020 2020 2020 4f74 6865 7277 6973 652c        Otherwise,
-00018ae0: 2072 6574 7572 6e20 666f 7220 7468 6520   return for the 
-00018af0: 6361 6c63 756c 6174 6564 2044 6963 6520  calculated Dice 
-00018b00: 7363 6f72 6573 2074 6865 2073 7461 7469  scores the stati
-00018b10: 7374 6963 0a20 2020 2020 2020 2020 2020  stic.           
-00018b20: 2073 7065 6369 6669 6564 2062 7920 736c   specified by sl
-00018b30: 6963 655f 7374 6174 2e0a 0a20 2020 2020  ice_stat...     
-00018b40: 2020 2076 616c 7565 5f66 6f72 5f6e 6f6e     value_for_non
-00018b50: 6520 3a20 666c 6f61 742c 2064 6566 6175  e : float, defau
-00018b60: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00018b70: 2020 2020 466f 7220 7369 6e67 6c65 5f73      For single_s
-00018b80: 6c69 6365 2061 6e64 2062 795f 736c 6963  lice and by_slic
-00018b90: 652c 2076 616c 7565 2074 6f20 6265 2072  e, value to be r
-00018ba0: 6574 7572 6e65 6420 666f 720a 2020 2020  eturned for.    
-00018bb0: 2020 2020 2020 2020 736c 6963 6573 2077          slices w
-00018bc0: 6865 7265 2044 6963 6520 7363 6f72 6520  here Dice score 
-00018bd0: 6973 2075 6e64 6574 6572 6d69 6e65 6420  is undetermined 
-00018be0: 284e 6f6e 6529 2e20 2046 6f72 2073 6c69  (None).  For sli
-00018bf0: 6365 5f73 7461 742c 0a20 2020 2020 2020  ce_stat,.       
-00018c00: 2020 2020 2076 616c 7565 2074 6f20 7375       value to su
-00018c10: 6273 7469 7475 7465 2066 6f72 2061 6e79  bstitute for any
-00018c20: 204e 6f6e 6520 7661 6c75 6573 2061 6d6f   None values amo
-00018c30: 6e67 2074 6865 2069 6e70 7574 730a 2020  ng the inputs.  
-00018c40: 2020 2020 2020 2020 2020 666f 7220 6361            for ca
-00018c50: 6c63 756c 6174 696e 6720 736c 6963 652d  lculating slice-
-00018c60: 6261 7365 6420 7374 6174 6973 7469 632e  based statistic.
-00018c70: 2020 4966 204e 6f6e 6520 696e 2074 6865    If None in the
-00018c80: 206c 6174 7465 720a 2020 2020 2020 2020   latter.        
-00018c90: 2020 2020 6361 7365 2c20 4e6f 6e65 2076      case, None v
-00018ca0: 616c 7565 7320 616d 6f6e 6720 7468 6520  alues among the 
-00018cb0: 696e 7075 7473 2061 7265 206f 6d69 7474  inputs are omitt
-00018cc0: 6564 2e0a 0a20 2020 2020 2020 2073 6c69  ed...        sli
-00018cd0: 6365 5f73 7461 7420 3a20 7374 722c 2064  ce_stat : str, d
-00018ce0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00018cf0: 2020 2020 2020 2020 5369 6e67 6c65 2d76          Single-v
-00018d00: 6172 6961 626c 6520 7374 6174 6973 7469  ariable statisti
-00018d10: 6328 7329 2074 6f20 6265 2072 6574 7572  c(s) to be retur
-00018d20: 6e65 6420 666f 7220 736c 6963 652d 6279  ned for slice-by
-00018d30: 2d73 6c69 6365 0a20 2020 2020 2020 2020  -slice.         
-00018d40: 2020 2044 6963 6520 7363 6f72 6573 2e20     Dice scores. 
-00018d50: 2054 6869 7320 7368 6f75 6c64 2062 6520   This should be 
-00018d60: 7468 6520 6e61 6d65 206f 6620 7468 6520  the name of the 
-00018d70: 6675 6e63 7469 6f6e 2066 6f72 0a20 2020  function for.   
-00018d80: 2020 2020 2020 2020 2063 616c 6375 6c61           calcula
-00018d90: 7469 6f6e 206f 6620 7468 6520 7374 6174  tion of the stat
-00018da0: 6973 7469 6328 7329 2069 6e20 7468 6520  istic(s) in the 
-00018db0: 5079 7468 6f6e 2073 7461 7469 7374 6963  Python statistic
-00018dc0: 7320 6d6f 6475 6c65 3a0a 0a20 2020 2020  s module:..     
-00018dd0: 2020 2020 2020 2068 7474 7073 3a2f 2f64         https://d
-00018de0: 6f63 732e 7079 7468 6f6e 2e6f 7267 2f33  ocs.python.org/3
-00018df0: 2f6c 6962 7261 7279 2f73 7461 7469 7374  /library/statist
-00018e00: 6963 732e 6874 6d6c 0a0a 2020 2020 2020  ics.html..      
-00018e10: 2020 2020 2020 4176 6169 6c61 626c 6520        Available 
-00018e20: 6f70 7469 6f6e 7320 696e 636c 7564 653a  options include:
-00018e30: 2022 6d65 616e 222c 2022 6d65 6469 616e   "mean", "median
-00018e40: 222c 2022 6d6f 6465 222c 0a20 2020 2020  ", "mode",.     
-00018e50: 2020 2020 2020 2022 7374 6465 7622 2c20         "stdev", 
-00018e60: 2271 7561 6e74 696c 6573 222e 2020 4469  "quantiles".  Di
-00018e70: 7372 6567 6172 6465 6420 6966 204e 6f6e  sregarded if Non
-00018e80: 652e 0a0a 2020 2020 2020 2020 2020 2020  e...            
-00018e90: 4966 2062 795f 736c 6963 6520 6973 204e  If by_slice is N
-00018ea0: 6f6e 6520 616e 6420 736c 6963 655f 7374  one and slice_st
-00018eb0: 6174 2069 7320 6469 6666 6572 656e 7420  at is different 
-00018ec0: 6672 6f6d 204e 6f6e 652c 0a20 2020 2020  from None,.     
-00018ed0: 2020 2020 2020 2073 6b72 742e 636f 7265         skrt.core
-00018ee0: 2e44 6566 6175 6c74 7328 292e 6279 5f73  .Defaults().by_s
-00018ef0: 6c69 6365 2069 7320 7573 6564 2066 6f72  lice is used for
-00018f00: 2074 6865 2066 6f72 6d65 722e 0a0a 2020   the former...  
-00018f10: 2020 2020 2020 736c 6963 655f 7374 6174        slice_stat
-00018f20: 5f6b 7761 7267 7320 3a20 6469 6374 2c20  _kwargs : dict, 
-00018f30: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-00018f40: 2020 2020 2020 2020 204b 6579 776f 7264           Keyword
-00018f50: 2061 7267 756d 656e 7473 2074 6f20 6265   arguments to be
-00018f60: 2070 6173 7365 6420 746f 2066 756e 6374   passed to funct
-00018f70: 696f 6e20 6f66 2073 7461 7469 7374 6963  ion of statistic
-00018f80: 730a 2020 2020 2020 2020 2020 2020 6d6f  s.            mo
-00018f90: 6475 6c65 2066 6f72 2063 616c 6375 6c61  dule for calcula
-00018fa0: 7469 6f6e 2072 656c 6174 6976 6520 746f  tion relative to
-00018fb0: 2073 6c69 6365 2076 616c 7565 732e 2020   slice values.  
-00018fc0: 466f 7220 6578 616d 706c 652c 0a20 2020  For example,.   
-00018fd0: 2020 2020 2020 2020 2069 6620 7175 616e           if quan
-00018fe0: 7469 6c65 7320 6172 6520 7265 7175 6972  tiles are requir
-00018ff0: 6564 2066 6f72 2031 3020 696e 7465 7276  ed for 10 interv
-00019000: 616c 732c 2072 6174 6865 7220 7468 616e  als, rather than
-00019010: 2066 6f72 0a20 2020 2020 2020 2020 2020   for.           
-00019020: 2074 6865 2064 6566 6175 6c74 206f 6620   the default of 
-00019030: 342c 2074 6869 7320 6361 6e20 6265 2073  4, this can be s
-00019040: 7065 6369 6669 6564 2075 7369 6e67 3a0a  pecified using:.
-00019050: 0a20 2020 2020 2020 2020 2020 2073 6c69  .            sli
-00019060: 6365 5f73 7461 745f 6b77 6172 6773 7b22  ce_stat_kwargs{"
-00019070: 6e22 203a 2031 307d 0a0a 2020 2020 2020  n" : 10}..      
-00019080: 2020 2020 2020 466f 7220 6176 6169 6c61        For availa
-00019090: 626c 6520 6b65 7977 6f72 6420 6f70 7469  ble keyword opti
-000190a0: 6f6e 732c 2073 6565 2064 6f63 756d 656e  ons, see documen
-000190b0: 7461 7469 6f6e 206f 6620 7374 6174 6973  tation of statis
-000190c0: 7469 6373 0a20 2020 2020 2020 2020 2020  tics.           
-000190d0: 206d 6f64 756c 6520 6174 3a0a 0a20 2020   module at:..   
-000190e0: 2020 2020 2020 2020 2068 7474 7073 3a2f           https:/
-000190f0: 2f64 6f63 732e 7079 7468 6f6e 2e6f 7267  /docs.python.org
-00019100: 2f33 2f6c 6962 7261 7279 2f73 7461 7469  /3/library/stati
-00019110: 7374 6963 732e 6874 6d6c 0a20 2020 2020  stics.html.     
-00019120: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00019130: 6620 736c 6963 655f 7374 6174 3a0a 2020  f slice_stat:.  
-00019140: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00019150: 2073 656c 662e 6765 745f 736c 6963 655f   self.get_slice_
-00019160: 7374 6174 2872 6f69 2c20 2261 6273 5f63  stat(roi, "abs_c
-00019170: 656e 7472 6f69 6422 2c20 736c 6963 655f  entroid", slice_
-00019180: 7374 6174 2c0a 2020 2020 2020 2020 2020  stat,.          
-00019190: 2020 2020 2020 2020 2020 6279 5f73 6c69            by_sli
-000191a0: 6365 2c20 7661 6c75 655f 666f 725f 6e6f  ce, value_for_no
-000191b0: 6e65 2c20 7669 6577 2c20 6d65 7468 6f64  ne, view, method
-000191c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000191d0: 2020 2020 2020 2a2a 2873 6c69 6365 5f73        **(slice_s
-000191e0: 7461 745f 6b77 6172 6773 206f 7220 7b7d  tat_kwargs or {}
-000191f0: 2929 0a0a 2020 2020 2020 2020 6966 2062  ))..        if b
-00019200: 795f 736c 6963 653a 0a20 2020 2020 2020  y_slice:.       
-00019210: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00019220: 2e67 6574 5f6d 6574 7269 635f 6279 5f73  .get_metric_by_s
-00019230: 6c69 6365 2872 6f69 2c20 2261 6273 5f63  lice(roi, "abs_c
-00019240: 656e 7472 6f69 6422 2c20 6279 5f73 6c69  entroid", by_sli
-00019250: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
-00019260: 2020 2020 2020 2020 7669 6577 2c20 6d65          view, me
-00019270: 7468 6f64 290a 0a20 2020 2020 2020 2023  thod)..        #
-00019280: 2049 6620 666c 6174 7465 6e69 6e67 2c20   If flattening, 
-00019290: 6e65 6564 2074 6f20 6765 7420 3344 2063  need to get 3D c
-000192a0: 656e 7472 6f69 6420 7665 6374 6f72 0a20  entroid vector. 
-000192b0: 2020 2020 2020 2069 6620 666c 6174 7465         if flatte
-000192c0: 6e3a 0a20 2020 2020 2020 2020 2020 2073  n:.            s
-000192d0: 696e 676c 655f 736c 6963 6520 3d20 4661  ingle_slice = Fa
-000192e0: 6c73 650a 0a20 2020 2020 2020 2023 2047  lse..        # G
-000192f0: 6574 2063 656e 7472 6f69 6420 7665 6374  et centroid vect
-00019300: 6f72 0a20 2020 2020 2020 2063 656e 7472  or.        centr
-00019310: 6f69 6420 3d20 7365 6c66 2e67 6574 5f63  oid = self.get_c
-00019320: 656e 7472 6f69 645f 6469 7374 616e 6365  entroid_distance
-00019330: 280a 2020 2020 2020 2020 2020 2020 726f  (.            ro
-00019340: 692c 200a 2020 2020 2020 2020 2020 2020  i, .            
-00019350: 7669 6577 3d76 6965 772c 200a 2020 2020  view=view, .    
-00019360: 2020 2020 2020 2020 7369 6e67 6c65 5f73          single_s
-00019370: 6c69 6365 3d73 696e 676c 655f 736c 6963  lice=single_slic
-00019380: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-00019390: 6c3d 736c 2c0a 2020 2020 2020 2020 2020  l=sl,.          
-000193a0: 2020 6964 783d 6964 782c 0a20 2020 2020    idx=idx,.     
-000193b0: 2020 2020 2020 2070 6f73 3d70 6f73 2c0a         pos=pos,.
-000193c0: 2020 2020 2020 2020 2020 2020 756e 6974              unit
-000193d0: 733d 756e 6974 732c 0a20 2020 2020 2020  s=units,.       
-000193e0: 2020 2020 206d 6574 686f 643d 6d65 7468       method=meth
-000193f0: 6f64 2c0a 2020 2020 2020 2020 2020 2020  od,.            
-00019400: 666f 7263 653d 666f 7263 652c 0a20 2020  force=force,.   
-00019410: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00019420: 2320 4966 2063 656e 7472 6f69 6420 7761  # If centroid wa
-00019430: 736e 2774 2061 7661 696c 6162 6c65 2c20  sn't available, 
-00019440: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
-00019450: 2020 2020 6966 204e 6f6e 6520 696e 2063      if None in c
-00019460: 656e 7472 6f69 643a 0a20 2020 2020 2020  entroid:.       
-00019470: 2020 2020 2072 6574 7572 6e20 7661 6c75       return valu
-00019480: 655f 666f 725f 6e6f 6e65 0a0a 2020 2020  e_for_none..    
-00019490: 2020 2020 2320 4966 2066 6c61 7474 656e      # If flatten
-000194a0: 696e 672c 2074 616b 6520 3220 6178 6573  ing, take 2 axes
-000194b0: 206f 6e6c 790a 2020 2020 2020 2020 6966   only.        if
-000194c0: 2066 6c61 7474 656e 3a0a 2020 2020 2020   flatten:.      
-000194d0: 2020 2020 2020 785f 6178 2c20 795f 6178        x_ax, y_ax
-000194e0: 203d 2073 6b72 742e 696d 6167 652e 5f70   = skrt.image._p
-000194f0: 6c6f 745f 6178 6573 5b76 6965 775d 0a20  lot_axes[view]. 
-00019500: 2020 2020 2020 2020 2020 2063 656e 7472             centr
-00019510: 6f69 6420 3d20 6e70 2e61 7272 6179 285b  oid = np.array([
-00019520: 6365 6e74 726f 6964 5b78 5f61 785d 2c20  centroid[x_ax], 
-00019530: 6365 6e74 726f 6964 5b79 5f61 785d 5d29  centroid[y_ax]])
-00019540: 0a0a 2020 2020 2020 2020 2320 5265 7475  ..        # Retu
-00019550: 726e 206d 6167 6e69 7475 6465 206f 6620  rn magnitude of 
-00019560: 7665 6374 6f72 0a20 2020 2020 2020 2072  vector.        r
-00019570: 6574 7572 6e20 6e70 2e6c 696e 616c 672e  eturn np.linalg.
-00019580: 6e6f 726d 2863 656e 7472 6f69 6429 0a0a  norm(centroid)..
-00019590: 2020 2020 6465 6620 6765 745f 6469 6365      def get_dice
-000195a0: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
-000195b0: 0a20 2020 2020 2020 206f 7468 6572 2c20  .        other, 
-000195c0: 0a20 2020 2020 2020 2073 696e 676c 655f  .        single_
-000195d0: 736c 6963 653d 4661 6c73 652c 0a20 2020  slice=False,.   
-000195e0: 2020 2020 2076 6965 773d 2278 2d79 222c       view="x-y",
-000195f0: 200a 2020 2020 2020 2020 736c 3d4e 6f6e   .        sl=Non
-00019600: 652c 200a 2020 2020 2020 2020 6964 783d  e, .        idx=
-00019610: 4e6f 6e65 2c20 0a20 2020 2020 2020 2070  None, .        p
-00019620: 6f73 3d4e 6f6e 652c 200a 2020 2020 2020  os=None, .      
-00019630: 2020 6d65 7468 6f64 3d4e 6f6e 652c 0a20    method=None,. 
-00019640: 2020 2020 2020 2066 6c61 7474 656e 3d46         flatten=F
-00019650: 616c 7365 2c0a 2020 2020 2020 2020 6279  alse,.        by
-00019660: 5f73 6c69 6365 3d4e 6f6e 652c 0a20 2020  _slice=None,.   
-00019670: 2020 2020 2076 616c 7565 5f66 6f72 5f6e       value_for_n
-00019680: 6f6e 653d 4e6f 6e65 2c0a 2020 2020 2020  one=None,.      
-00019690: 2020 736c 6963 655f 7374 6174 3d4e 6f6e    slice_stat=Non
-000196a0: 652c 0a20 2020 2020 2020 2073 6c69 6365  e,.        slice
-000196b0: 5f73 7461 745f 6b77 6172 6773 3d4e 6f6e  _stat_kwargs=Non
-000196c0: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
-000196d0: 2020 2222 220a 2020 2020 2020 2020 4765    """.        Ge
-000196e0: 7420 4469 6365 2073 636f 7265 2077 6974  t Dice score wit
-000196f0: 6820 7265 7370 6563 7420 746f 2061 6e6f  h respect to ano
-00019700: 7468 6572 2052 4f49 2c0a 2020 2020 2020  ther ROI,.      
-00019710: 2020 676c 6f62 616c 6c79 2c20 6f6e 2061    globally, on a
-00019720: 2073 696e 676c 6520 736c 6963 652c 2073   single slice, s
-00019730: 6c69 6365 2062 7920 736c 6963 652c 206f  lice by slice, o
-00019740: 7220 736c 6963 6520 6176 6572 6167 6564  r slice averaged
-00019750: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
-00019760: 616d 6574 6572 733a 2a2a 0a20 2020 2020  ameters:**.     
-00019770: 2020 200a 2020 2020 2020 2020 6f74 6865     .        othe
-00019780: 7220 3a20 524f 490a 2020 2020 2020 2020  r : ROI.        
-00019790: 2020 2020 4f74 6865 7220 524f 4920 746f      Other ROI to
-000197a0: 2063 6f6d 7061 7265 2077 6974 6820 7468   compare with th
-000197b0: 6973 2052 4f49 2e0a 0a20 2020 2020 2020  is ROI...       
-000197c0: 2073 696e 676c 655f 736c 6963 6520 3a20   single_slice : 
-000197d0: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
-000197e0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-000197f0: 4966 2046 616c 7365 2c20 7468 6520 676c  If False, the gl
-00019800: 6f62 616c 2033 4420 4469 6365 2073 636f  obal 3D Dice sco
-00019810: 7265 206f 6620 7468 6520 6675 6c6c 2052  re of the full R
-00019820: 4f49 7320 7769 6c6c 2062 6520 7265 7475  OIs will be retu
-00019830: 726e 6564 3b0a 2020 2020 2020 2020 2020  rned;.          
-00019840: 2020 6f74 6865 7277 6973 652c 2074 6865    otherwise, the
-00019850: 2032 4420 4469 6365 2073 636f 7265 206f   2D Dice score o
-00019860: 6e20 6120 7369 6e67 6c65 2073 6c69 6365  n a single slice
-00019870: 2077 696c 6c20 6265 2072 6574 7572 6e65   will be returne
-00019880: 642e 0a0a 2020 2020 2020 2020 7669 6577  d...        view
-00019890: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
-000198a0: 2278 2d79 220a 2020 2020 2020 2020 2020  "x-y".          
-000198b0: 2020 4f72 6965 6e74 6174 696f 6e20 6f66    Orientation of
-000198c0: 2073 6c69 6365 206f 6e20 7768 6963 6820   slice on which 
-000198d0: 746f 2067 6574 2044 6963 6520 7363 6f72  to get Dice scor
-000198e0: 652e 204f 6e6c 7920 7573 6564 2069 6620  e. Only used if 
-000198f0: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
-00019900: 676c 655f 736c 6963 653d 5472 7565 2e20  gle_slice=True. 
-00019910: 4966 2075 7369 6e67 2c20 3c61 783e 206d  If using, <ax> m
-00019920: 7573 7420 6265 2061 6e20 6178 6973 2074  ust be an axis t
-00019930: 6861 7420 6c69 6573 2061 6c6f 6e67 0a20  hat lies along. 
-00019940: 2020 2020 2020 2020 2020 2074 6865 2073             the s
-00019950: 6c69 6365 2069 6e20 7468 6973 206f 7269  lice in this ori
-00019960: 656e 7461 7469 6f6e 2e0a 0a20 2020 2020  entation...     
-00019970: 2020 2073 6c20 3a20 696e 742c 2064 6566     sl : int, def
-00019980: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00019990: 2020 2020 2020 536c 6963 6520 6e75 6d62        Slice numb
-000199a0: 6572 2e20 4966 206e 6f6e 6520 6f66 203c  er. If none of <
-000199b0: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
-000199c0: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
-000199d0: 2062 7574 0a20 2020 2020 2020 2020 2020   but.           
-000199e0: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
-000199f0: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
-00019a00: 7472 616c 2073 6c69 6365 206f 6620 7468  tral slice of th
-00019a10: 6973 2052 4f49 2077 696c 6c20 6265 2075  is ROI will be u
-00019a20: 7365 642e 0a0a 2020 2020 2020 2020 6964  sed...        id
-00019a30: 7820 3a20 696e 742c 2064 6566 6175 6c74  x : int, default
-00019a40: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-00019a50: 2020 4172 7261 7920 696e 6465 7820 6f66    Array index of
-00019a60: 2073 6c69 6365 2e20 4966 206e 6f6e 6520   slice. If none 
-00019a70: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
-00019a80: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
-00019a90: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
-00019aa0: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
-00019ab0: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
-00019ac0: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
-00019ad0: 6620 7468 6973 2052 4f49 2077 696c 6c20  f this ROI will 
-00019ae0: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
-00019af0: 2020 706f 7320 3a20 666c 6f61 742c 2064    pos : float, d
-00019b00: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00019b10: 2020 2020 2020 2020 536c 6963 6520 706f          Slice po
-00019b20: 7369 7469 6f6e 2069 6e20 6d6d 2e20 4966  sition in mm. If
-00019b30: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
-00019b40: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
-00019b50: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
-00019b60: 2020 2020 2020 2020 2020 203c 7369 6e67             <sing
-00019b70: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
-00019b80: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
-00019b90: 6c69 6365 206f 6620 7468 6973 2052 4f49  lice of this ROI
-00019ba0: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
-00019bb0: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
-00019bc0: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
-00019bd0: 6e65 0a20 2020 2020 2020 2020 2020 204d  ne.            M
-00019be0: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
-00019bf0: 2044 6963 6520 7363 6f72 6520 6361 6c63   Dice score calc
-00019c00: 756c 6174 696f 6e2e 2043 616e 2062 653a  ulation. Can be:
-00019c10: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00019c20: 2020 2d20 2263 6f6e 746f 7572 223a 2067    - "contour": g
-00019c30: 6574 2069 6e74 6572 7365 6374 696f 6e73  et intersections
-00019c40: 2061 6e64 2061 7265 6173 206f 6620 7368   and areas of sh
-00019c50: 6170 656c 7920 636f 6e74 6f75 7273 2e0a  apely contours..
-00019c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c70: 2d20 226d 6173 6b22 3a20 636f 756e 7420  - "mask": count 
-00019c80: 696e 7465 7273 6563 7469 6e67 2076 6f78  intersecting vox
-00019c90: 656c 7320 696e 2062 696e 6172 7920 6d61  els in binary ma
-00019ca0: 736b 732e 0a20 2020 2020 2020 2020 2020  sks..           
-00019cb0: 2020 2020 202d 204e 6f6e 653a 2075 7365       - None: use
-00019cc0: 2074 6865 206d 6574 686f 6420 7365 7420   the method set 
-00019cd0: 696e 2073 656c 662e 6465 6661 756c 745f  in self.default_
-00019ce0: 6765 6f6d 5f6d 6574 686f 642e 0a0a 2020  geom_method...  
-00019cf0: 2020 2020 2020 666c 6174 7465 6e20 3a20        flatten : 
-00019d00: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
-00019d10: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00019d20: 4966 2054 7275 652c 2061 6c6c 2073 6c69  If True, all sli
-00019d30: 6365 7320 7769 6c6c 2062 6520 666c 6174  ces will be flat
-00019d40: 7465 6e65 6420 696e 2074 6865 2067 6976  tened in the giv
-00019d50: 656e 206f 7269 656e 7461 7469 6f6e 2061  en orientation a
-00019d60: 6e64 0a20 2020 2020 2020 2020 2020 2074  nd.            t
-00019d70: 6865 2044 6963 6520 7363 6f72 6520 6f66  he Dice score of
-00019d80: 2074 6865 2066 6c61 7474 656e 6564 2073   the flattened s
-00019d90: 6c69 6365 7320 7769 6c6c 2062 6520 7265  lices will be re
-00019da0: 7475 726e 6564 2e20 4f6e 6c79 200a 2020  turned. Only .  
-00019db0: 2020 2020 2020 2020 2020 6176 6169 6c61            availa
-00019dc0: 626c 6520 6966 206d 6574 686f 643d 226d  ble if method="m
-00019dd0: 6173 6b22 2e0a 0a20 2020 2020 2020 2062  ask"...        b
-00019de0: 795f 736c 6963 6520 3a20 7374 722c 2064  y_slice : str, d
-00019df0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00019e00: 2020 2020 2020 2020 4966 206f 6e65 206f          If one o
-00019e10: 6620 226c 6566 7422 2c20 2272 6967 6874  f "left", "right
-00019e20: 222c 2022 756e 696f 6e22 2c20 2269 6e74  ", "union", "int
-00019e30: 6572 7365 6374 696f 6e22 2c20 6361 6c63  ersection", calc
-00019e40: 756c 6174 650a 2020 2020 2020 2020 2020  ulate.          
-00019e50: 2020 4469 6365 2073 636f 7265 7320 736c    Dice scores sl
-00019e60: 6963 6520 6279 2073 6c69 6365 2066 6f72  ice by slice for
-00019e70: 2065 6163 6820 736c 6963 6520 636f 6e74   each slice cont
-00019e80: 6169 6e69 6e67 0a20 2020 2020 2020 2020  aining.         
-00019e90: 2020 2073 656c 6620 616e 642f 6f72 206f     self and/or o
-00019ea0: 7468 6572 3a0a 0a20 2020 2020 2020 2020  ther:..         
-00019eb0: 2020 202d 2022 6c65 6674 223a 2063 6f6e     - "left": con
-00019ec0: 7369 6465 7220 6f6e 6c79 2073 6c69 6365  sider only slice
-00019ed0: 7320 636f 6e74 6169 6e69 6e67 2073 656c  s containing sel
-00019ee0: 663b 0a20 2020 2020 2020 2020 2020 202d  f;.            -
-00019ef0: 2022 7269 6768 7422 3a20 636f 6e73 6964   "right": consid
-00019f00: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
-00019f10: 6f6e 7461 696e 696e 6720 6f74 6865 723b  ontaining other;
-00019f20: 0a20 2020 2020 2020 2020 2020 202d 2022  .            - "
-00019f30: 756e 696f 6e22 3a20 636f 6e73 6964 6572  union": consider
-00019f40: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
-00019f50: 6e67 2065 6974 6865 7220 6f66 2073 656c  ng either of sel
-00019f60: 6620 616e 6420 6f74 6865 723b 0a20 2020  f and other;.   
-00019f70: 2020 2020 2020 2020 202d 2022 696e 7465           - "inte
-00019f80: 7273 6563 7469 6f6e 223a 2063 6f6e 7369  rsection": consi
-00019f90: 6465 7220 736c 6963 6573 2063 6f6e 7461  der slices conta
-00019fa0: 696e 696e 6720 626f 7468 206f 6620 7365  ining both of se
-00019fb0: 6c66 2061 6e64 206f 7468 6572 2e0a 0a20  lf and other... 
-00019fc0: 2020 2020 2020 2020 2020 2049 6620 736c             If sl
-00019fd0: 6963 655f 7374 6174 2069 7320 4e6f 6e65  ice_stat is None
-00019fe0: 2c20 7265 7475 726e 2061 2064 6963 7469  , return a dicti
-00019ff0: 6f6e 6172 7920 7768 6572 6520 6b65 7973  onary where keys
-0001a000: 2061 7265 0a20 2020 2020 2020 2020 2020   are.           
-0001a010: 2073 6c69 6365 2070 6f73 6974 696f 6e73   slice positions
-0001a020: 2061 6e64 2076 616c 7565 7320 6172 6520   and values are 
-0001a030: 7468 6520 6361 6c63 756c 6174 6564 2044  the calculated D
-0001a040: 6963 6520 7363 6f72 6573 2e0a 2020 2020  ice scores..    
-0001a050: 2020 2020 2020 2020 4f74 6865 7277 6973          Otherwis
-0001a060: 652c 2072 6574 7572 6e20 666f 7220 7468  e, return for th
-0001a070: 6520 6361 6c63 756c 6174 6564 2044 6963  e calculated Dic
-0001a080: 6520 7363 6f72 6573 2074 6865 2073 7461  e scores the sta
-0001a090: 7469 7374 6963 0a20 2020 2020 2020 2020  tistic.         
-0001a0a0: 2020 2073 7065 6369 6669 6564 2062 7920     specified by 
-0001a0b0: 736c 6963 655f 7374 6174 2e0a 0a20 2020  slice_stat...   
-0001a0c0: 2020 2020 2076 616c 7565 5f66 6f72 5f6e       value_for_n
-0001a0d0: 6f6e 6520 3a20 666c 6f61 742c 2064 6566  one : float, def
-0001a0e0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-0001a0f0: 2020 2020 2020 466f 7220 7369 6e67 6c65        For single
-0001a100: 5f73 6c69 6365 2061 6e64 2062 795f 736c  _slice and by_sl
-0001a110: 6963 652c 2076 616c 7565 2074 6f20 6265  ice, value to be
-0001a120: 2072 6574 7572 6e65 6420 666f 720a 2020   returned for.  
-0001a130: 2020 2020 2020 2020 2020 736c 6963 6573            slices
-0001a140: 2077 6865 7265 2044 6963 6520 7363 6f72   where Dice scor
-0001a150: 6520 6973 2075 6e64 6574 6572 6d69 6e65  e is undetermine
-0001a160: 6420 284e 6f6e 6529 2e20 2046 6f72 2073  d (None).  For s
-0001a170: 6c69 6365 5f73 7461 742c 0a20 2020 2020  lice_stat,.     
-0001a180: 2020 2020 2020 2076 616c 7565 2074 6f20         value to 
-0001a190: 7375 6273 7469 7475 7465 2066 6f72 2061  substitute for a
-0001a1a0: 6e79 204e 6f6e 6520 7661 6c75 6573 2061  ny None values a
-0001a1b0: 6d6f 6e67 2074 6865 2069 6e70 7574 730a  mong the inputs.
-0001a1c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001a1d0: 6361 6c63 756c 6174 696e 6720 736c 6963  calculating slic
-0001a1e0: 652d 6261 7365 6420 7374 6174 6973 7469  e-based statisti
-0001a1f0: 632e 2020 4966 204e 6f6e 6520 696e 2074  c.  If None in t
-0001a200: 6865 206c 6174 7465 720a 2020 2020 2020  he latter.      
-0001a210: 2020 2020 2020 6361 7365 2c20 4e6f 6e65        case, None
-0001a220: 2076 616c 7565 7320 616d 6f6e 6720 7468   values among th
-0001a230: 6520 696e 7075 7473 2061 7265 206f 6d69  e inputs are omi
-0001a240: 7474 6564 2e0a 0a20 2020 2020 2020 2073  tted...        s
-0001a250: 6c69 6365 5f73 7461 7420 3a20 7374 722c  lice_stat : str,
-0001a260: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0001a270: 2020 2020 2020 2020 2020 5369 6e67 6c65            Single
-0001a280: 2d76 6172 6961 626c 6520 7374 6174 6973  -variable statis
-0001a290: 7469 6328 7329 2074 6f20 6265 2072 6574  tic(s) to be ret
-0001a2a0: 7572 6e65 6420 666f 7220 736c 6963 652d  urned for slice-
-0001a2b0: 6279 2d73 6c69 6365 0a20 2020 2020 2020  by-slice.       
-0001a2c0: 2020 2020 2044 6963 6520 7363 6f72 6573       Dice scores
-0001a2d0: 2e20 2054 6869 7320 7368 6f75 6c64 2062  .  This should b
-0001a2e0: 6520 7468 6520 6e61 6d65 206f 6620 7468  e the name of th
-0001a2f0: 6520 6675 6e63 7469 6f6e 2066 6f72 0a20  e function for. 
-0001a300: 2020 2020 2020 2020 2020 2063 616c 6375             calcu
-0001a310: 6c61 7469 6f6e 206f 6620 7468 6520 7374  lation of the st
-0001a320: 6174 6973 7469 6328 7329 2069 6e20 7468  atistic(s) in th
-0001a330: 6520 5079 7468 6f6e 2073 7461 7469 7374  e Python statist
-0001a340: 6963 7320 6d6f 6475 6c65 3a0a 0a20 2020  ics module:..   
-0001a350: 2020 2020 2020 2020 2068 7474 7073 3a2f           https:/
-0001a360: 2f64 6f63 732e 7079 7468 6f6e 2e6f 7267  /docs.python.org
-0001a370: 2f33 2f6c 6962 7261 7279 2f73 7461 7469  /3/library/stati
-0001a380: 7374 6963 732e 6874 6d6c 0a0a 2020 2020  stics.html..    
-0001a390: 2020 2020 2020 2020 4176 6169 6c61 626c          Availabl
-0001a3a0: 6520 6f70 7469 6f6e 7320 696e 636c 7564  e options includ
-0001a3b0: 653a 2022 6d65 616e 222c 2022 6d65 6469  e: "mean", "medi
-0001a3c0: 616e 222c 2022 6d6f 6465 222c 0a20 2020  an", "mode",.   
-0001a3d0: 2020 2020 2020 2020 2022 7374 6465 7622           "stdev"
-0001a3e0: 2c20 2271 7561 6e74 696c 6573 222e 2020  , "quantiles".  
-0001a3f0: 4469 7372 6567 6172 6465 6420 6966 204e  Disregarded if N
-0001a400: 6f6e 652e 0a0a 2020 2020 2020 2020 2020  one...          
-0001a410: 2020 4966 2062 795f 736c 6963 6520 6973    If by_slice is
-0001a420: 204e 6f6e 6520 616e 6420 736c 6963 655f   None and slice_
-0001a430: 7374 6174 2069 7320 6469 6666 6572 656e  stat is differen
-0001a440: 7420 6672 6f6d 204e 6f6e 652c 0a20 2020  t from None,.   
-0001a450: 2020 2020 2020 2020 2073 6b72 742e 636f           skrt.co
-0001a460: 7265 2e44 6566 6175 6c74 7328 292e 6279  re.Defaults().by
-0001a470: 5f73 6c69 6365 2069 7320 7573 6564 2066  _slice is used f
-0001a480: 6f72 2074 6865 2066 6f72 6d65 722e 0a0a  or the former...
-0001a490: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
-0001a4a0: 6174 5f6b 7761 7267 7320 3a20 6469 6374  at_kwargs : dict
-0001a4b0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0001a4c0: 2020 2020 2020 2020 2020 204b 6579 776f             Keywo
-0001a4d0: 7264 2061 7267 756d 656e 7473 2074 6f20  rd arguments to 
-0001a4e0: 6265 2070 6173 7365 6420 746f 2066 756e  be passed to fun
-0001a4f0: 6374 696f 6e20 6f66 2073 7461 7469 7374  ction of statist
-0001a500: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
-0001a510: 6d6f 6475 6c65 2066 6f72 2063 616c 6375  module for calcu
-0001a520: 6c61 7469 6f6e 2072 656c 6174 6976 6520  lation relative 
-0001a530: 746f 2073 6c69 6365 2076 616c 7565 732e  to slice values.
-0001a540: 2020 466f 7220 6578 616d 706c 652c 0a20    For example,. 
-0001a550: 2020 2020 2020 2020 2020 2069 6620 7175             if qu
-0001a560: 616e 7469 6c65 7320 6172 6520 7265 7175  antiles are requ
-0001a570: 6972 6564 2066 6f72 2031 3020 696e 7465  ired for 10 inte
-0001a580: 7276 616c 732c 2072 6174 6865 7220 7468  rvals, rather th
-0001a590: 616e 2066 6f72 0a20 2020 2020 2020 2020  an for.         
-0001a5a0: 2020 2074 6865 2064 6566 6175 6c74 206f     the default o
-0001a5b0: 6620 342c 2074 6869 7320 6361 6e20 6265  f 4, this can be
-0001a5c0: 2073 7065 6369 6669 6564 2075 7369 6e67   specified using
-0001a5d0: 3a0a 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0001a5e0: 6c69 6365 5f73 7461 745f 6b77 6172 6773  lice_stat_kwargs
-0001a5f0: 7b22 6e22 203a 2031 307d 0a0a 2020 2020  {"n" : 10}..    
-0001a600: 2020 2020 2020 2020 466f 7220 6176 6169          For avai
-0001a610: 6c61 626c 6520 6b65 7977 6f72 6420 6f70  lable keyword op
-0001a620: 7469 6f6e 732c 2073 6565 2064 6f63 756d  tions, see docum
-0001a630: 656e 7461 7469 6f6e 206f 6620 7374 6174  entation of stat
-0001a640: 6973 7469 6373 0a20 2020 2020 2020 2020  istics.         
-0001a650: 2020 206d 6f64 756c 6520 6174 3a0a 0a20     module at:.. 
-0001a660: 2020 2020 2020 2020 2020 2068 7474 7073             https
-0001a670: 3a2f 2f64 6f63 732e 7079 7468 6f6e 2e6f  ://docs.python.o
-0001a680: 7267 2f33 2f6c 6962 7261 7279 2f73 7461  rg/3/library/sta
-0001a690: 7469 7374 6963 732e 6874 6d6c 0a20 2020  tistics.html.   
-0001a6a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001a6b0: 2069 6620 736c 6963 655f 7374 6174 3a0a   if slice_stat:.
-0001a6c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001a6d0: 726e 2073 656c 662e 6765 745f 736c 6963  rn self.get_slic
-0001a6e0: 655f 7374 6174 286f 7468 6572 2c20 2264  e_stat(other, "d
-0001a6f0: 6963 6522 2c20 736c 6963 655f 7374 6174  ice", slice_stat
-0001a700: 2c20 6279 5f73 6c69 6365 2c0a 2020 2020  , by_slice,.    
-0001a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a720: 7661 6c75 655f 666f 725f 6e6f 6e65 2c20  value_for_none, 
-0001a730: 7669 6577 2c20 6d65 7468 6f64 2c20 2a2a  view, method, **
-0001a740: 2873 6c69 6365 5f73 7461 745f 6b77 6172  (slice_stat_kwar
-0001a750: 6773 206f 7220 7b7d 2929 0a0a 2020 2020  gs or {}))..    
-0001a760: 2020 2020 6966 2062 795f 736c 6963 653a      if by_slice:
-0001a770: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001a780: 7572 6e20 7365 6c66 2e67 6574 5f6d 6574  urn self.get_met
-0001a790: 7269 635f 6279 5f73 6c69 6365 286f 7468  ric_by_slice(oth
-0001a7a0: 6572 2c20 2264 6963 6522 2c20 6279 5f73  er, "dice", by_s
-0001a7b0: 6c69 6365 2c0a 2020 2020 2020 2020 2020  lice,.          
-0001a7c0: 2020 2020 2020 2020 2020 7669 6577 2c20            view, 
-0001a7d0: 6d65 7468 6f64 290a 0a20 2020 2020 2020  method)..       
-0001a7e0: 2069 6e74 6572 7365 6374 696f 6e2c 2075   intersection, u
-0001a7f0: 6e69 6f6e 2c20 6d65 616e 5f73 697a 6520  nion, mean_size 
-0001a800: 3d20 7365 6c66 2e67 6574 5f69 6e74 6572  = self.get_inter
-0001a810: 7365 6374 696f 6e5f 756e 696f 6e5f 7369  section_union_si
-0001a820: 7a65 280a 2020 2020 2020 2020 2020 2020  ze(.            
-0001a830: 2020 2020 6f74 6865 722c 2073 696e 676c      other, singl
-0001a840: 655f 736c 6963 652c 2076 6965 772c 2073  e_slice, view, s
-0001a850: 6c2c 2069 6478 2c20 706f 732c 206d 6574  l, idx, pos, met
-0001a860: 686f 642c 2066 6c61 7474 656e 290a 0a20  hod, flatten).. 
-0001a870: 2020 2020 2020 2072 6574 7572 6e20 2869         return (i
-0001a880: 6e74 6572 7365 6374 696f 6e20 2f20 6d65  ntersection / me
-0001a890: 616e 5f73 697a 6520 6966 206d 6561 6e5f  an_size if mean_
-0001a8a0: 7369 7a65 2065 6c73 6520 7661 6c75 655f  size else value_
-0001a8b0: 666f 725f 6e6f 6e65 290a 0a20 2020 2064  for_none)..    d
-0001a8c0: 6566 2067 6574 5f6a 6163 6361 7264 280a  ef get_jaccard(.
-0001a8d0: 2020 2020 2020 2020 7365 6c66 2c20 0a20          self, . 
-0001a8e0: 2020 2020 2020 206f 7468 6572 2c20 0a20         other, . 
-0001a8f0: 2020 2020 2020 2073 696e 676c 655f 736c         single_sl
-0001a900: 6963 653d 4661 6c73 652c 0a20 2020 2020  ice=False,.     
-0001a910: 2020 2076 6965 773d 2278 2d79 222c 200a     view="x-y", .
-0001a920: 2020 2020 2020 2020 736c 3d4e 6f6e 652c          sl=None,
-0001a930: 200a 2020 2020 2020 2020 6964 783d 4e6f   .        idx=No
-0001a940: 6e65 2c20 0a20 2020 2020 2020 2070 6f73  ne, .        pos
-0001a950: 3d4e 6f6e 652c 200a 2020 2020 2020 2020  =None, .        
-0001a960: 6d65 7468 6f64 3d4e 6f6e 652c 0a20 2020  method=None,.   
-0001a970: 2020 2020 2066 6c61 7474 656e 3d46 616c       flatten=Fal
-0001a980: 7365 2c0a 2020 2020 2020 2020 6279 5f73  se,.        by_s
-0001a990: 6c69 6365 3d4e 6f6e 652c 0a20 2020 2020  lice=None,.     
-0001a9a0: 2020 2076 616c 7565 5f66 6f72 5f6e 6f6e     value_for_non
-0001a9b0: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
-0001a9c0: 736c 6963 655f 7374 6174 3d4e 6f6e 652c  slice_stat=None,
-0001a9d0: 0a20 2020 2020 2020 2073 6c69 6365 5f73  .        slice_s
-0001a9e0: 7461 745f 6b77 6172 6773 3d4e 6f6e 652c  tat_kwargs=None,
-0001a9f0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-0001aa00: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
-0001aa10: 4a61 6363 6172 6420 696e 6465 7820 7769  Jaccard index wi
-0001aa20: 7468 2072 6573 7065 6374 2074 6f20 616e  th respect to an
-0001aa30: 6f74 6865 7220 524f 492e 0a0a 2020 2020  other ROI...    
-0001aa40: 2020 2020 5468 6520 4a61 6363 6172 6420      The Jaccard 
-0001aa50: 696e 6465 7820 6d61 7920 6265 206f 6274  index may be obt
-0001aa60: 6169 6e65 6420 6569 7468 6572 2067 6c6f  ained either glo
-0001aa70: 6261 6c6c 7920 6f72 206f 6e20 6120 0a20  bally or on a . 
-0001aa80: 2020 2020 2020 2073 696e 676c 6520 736c         single sl
-0001aa90: 6963 652e 0a0a 2020 2020 2020 2020 2a2a  ice...        **
-0001aaa0: 5061 7261 6d65 7465 7273 3a2a 2a0a 2020  Parameters:**.  
-0001aab0: 2020 2020 2020 0a20 2020 2020 2020 206f        .        o
-0001aac0: 7468 6572 203a 2052 4f49 0a20 2020 2020  ther : ROI.     
-0001aad0: 2020 2020 2020 204f 7468 6572 2052 4f49         Other ROI
-0001aae0: 2074 6f20 636f 6d70 6172 6520 7769 7468   to compare with
-0001aaf0: 2074 6869 7320 524f 492e 0a0a 2020 2020   this ROI...    
-0001ab00: 2020 2020 7369 6e67 6c65 5f73 6c69 6365      single_slice
-0001ab10: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-0001ab20: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
-0001ab30: 2020 2049 6620 4661 6c73 652c 2074 6865     If False, the
-0001ab40: 2067 6c6f 6261 6c20 3344 204a 6163 6361   global 3D Jacca
-0001ab50: 7264 2069 6e64 6578 206f 6620 7468 6520  rd index of the 
-0001ab60: 6675 6c6c 2052 4f49 7320 7769 6c6c 2062  full ROIs will b
-0001ab70: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
-0001ab80: 7475 726e 6564 3b20 6f74 6865 7277 6973  turned; otherwis
-0001ab90: 652c 2074 6865 2032 4420 4a61 6363 6172  e, the 2D Jaccar
-0001aba0: 6420 696e 6465 7820 6f6e 2061 2073 696e  d index on a sin
-0001abb0: 676c 6520 736c 6963 650a 2020 2020 2020  gle slice.      
-0001abc0: 2020 2020 2020 7769 6c6c 2062 6520 7265        will be re
-0001abd0: 7475 726e 6564 2e0a 0a20 2020 2020 2020  turned...       
-0001abe0: 2076 6965 7720 3a20 7374 722c 2064 6566   view : str, def
-0001abf0: 6175 6c74 3d22 782d 7922 0a20 2020 2020  ault="x-y".     
-0001ac00: 2020 2020 2020 204f 7269 656e 7461 7469         Orientati
-0001ac10: 6f6e 206f 6620 736c 6963 6520 6f6e 2077  on of slice on w
-0001ac20: 6869 6368 2074 6f20 6765 7420 4a61 6363  hich to get Jacc
-0001ac30: 6172 6420 696e 6465 782e 204f 6e6c 7920  ard index. Only 
-0001ac40: 7573 6564 2069 6620 0a20 2020 2020 2020  used if .       
-0001ac50: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
-0001ac60: 653d 5472 7565 2e20 4966 2075 7369 6e67  e=True. If using
-0001ac70: 2c20 3c61 783e 206d 7573 7420 6265 2061  , <ax> must be a
-0001ac80: 6e20 6178 6973 2074 6861 7420 6c69 6573  n axis that lies
-0001ac90: 2061 6c6f 6e67 0a20 2020 2020 2020 2020   along.         
-0001aca0: 2020 2074 6865 2073 6c69 6365 2069 6e20     the slice in 
-0001acb0: 7468 6973 206f 7269 656e 7461 7469 6f6e  this orientation
-0001acc0: 2e0a 0a20 2020 2020 2020 2073 6c20 3a20  ...        sl : 
-0001acd0: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
-0001ace0: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
-0001acf0: 6963 6520 6e75 6d62 6572 2e20 4966 206e  ice number. If n
-0001ad00: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
-0001ad10: 783e 206f 7220 3c70 6f73 3e20 6172 6520  x> or <pos> are 
-0001ad20: 7375 7070 6c69 6564 2062 7574 0a20 2020  supplied but.   
-0001ad30: 2020 2020 2020 2020 203c 7369 6e67 6c65           <single
-0001ad40: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
-0001ad50: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
-0001ad60: 6365 206f 6620 7468 6973 2052 4f49 2077  ce of this ROI w
-0001ad70: 696c 6c20 6265 2075 7365 642e 0a0a 2020  ill be used...  
-0001ad80: 2020 2020 2020 6964 7820 3a20 696e 742c        idx : int,
-0001ad90: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0001ada0: 2020 2020 2020 2020 2020 4172 7261 7920            Array 
-0001adb0: 696e 6465 7820 6f66 2073 6c69 6365 2e20  index of slice. 
-0001adc0: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
-0001add0: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
-0001ade0: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
-0001adf0: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
-0001ae00: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
-0001ae10: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
-0001ae20: 2073 6c69 6365 206f 6620 7468 6973 2052   slice of this R
-0001ae30: 4f49 2077 696c 6c20 6265 2075 7365 642e  OI will be used.
-0001ae40: 0a0a 2020 2020 2020 2020 706f 7320 3a20  ..        pos : 
-0001ae50: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
-0001ae60: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0001ae70: 536c 6963 6520 706f 7369 7469 6f6e 2069  Slice position i
-0001ae80: 6e20 6d6d 2e20 4966 206e 6f6e 6520 6f66  n mm. If none of
-0001ae90: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
-0001aea0: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
-0001aeb0: 6564 2062 7574 0a20 2020 2020 2020 2020  ed but.         
-0001aec0: 2020 203c 7369 6e67 6c65 5f73 6c69 6365     <single_slice
-0001aed0: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
-0001aee0: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
-0001aef0: 7468 6973 2052 4f49 2077 696c 6c20 6265  this ROI will be
-0001af00: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
-0001af10: 6d65 7468 6f64 203a 2073 7472 2c20 6465  method : str, de
-0001af20: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-0001af30: 2020 2020 2020 204d 6574 686f 6420 746f         Method to
-0001af40: 2075 7365 2066 6f72 2044 6963 6520 7363   use for Dice sc
-0001af50: 6f72 6520 6361 6c63 756c 6174 696f 6e2e  ore calculation.
-0001af60: 2043 616e 2062 653a 200a 2020 2020 2020   Can be: .      
-0001af70: 2020 2020 2020 2020 2020 2d20 2263 6f6e            - "con
-0001af80: 746f 7572 223a 2067 6574 2069 6e74 6572  tour": get inter
-0001af90: 7365 6374 696f 6e73 2061 6e64 2061 7265  sections and are
-0001afa0: 6173 206f 6620 7368 6170 656c 7920 636f  as of shapely co
-0001afb0: 6e74 6f75 7273 2e0a 2020 2020 2020 2020  ntours..        
-0001afc0: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
-0001afd0: 3a20 636f 756e 7420 696e 7465 7273 6563  : count intersec
-0001afe0: 7469 6e67 2076 6f78 656c 7320 696e 2062  ting voxels in b
-0001aff0: 696e 6172 7920 6d61 736b 732e 0a20 2020  inary masks..   
-0001b000: 2020 2020 2020 2020 2020 2020 202d 204e               - N
-0001b010: 6f6e 653a 2075 7365 2074 6865 206d 6574  one: use the met
-0001b020: 686f 6420 7365 7420 696e 2073 656c 662e  hod set in self.
-0001b030: 6465 6661 756c 745f 6765 6f6d 5f6d 6574  default_geom_met
-0001b040: 686f 642e 0a0a 2020 2020 2020 2020 666c  hod...        fl
-0001b050: 6174 7465 6e20 3a20 626f 6f6c 2c20 6465  atten : bool, de
-0001b060: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-0001b070: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-0001b080: 2061 6c6c 2073 6c69 6365 7320 7769 6c6c   all slices will
-0001b090: 2062 6520 666c 6174 7465 6e65 6420 696e   be flattened in
-0001b0a0: 2074 6865 2067 6976 656e 206f 7269 656e   the given orien
-0001b0b0: 7461 7469 6f6e 2061 6e64 0a20 2020 2020  tation and.     
-0001b0c0: 2020 2020 2020 2074 6865 2044 6963 6520         the Dice 
-0001b0d0: 7363 6f72 6520 6f66 2074 6865 2066 6c61  score of the fla
-0001b0e0: 7474 656e 6564 2073 6c69 6365 7320 7769  ttened slices wi
-0001b0f0: 6c6c 2062 6520 7265 7475 726e 6564 2e20  ll be returned. 
-0001b100: 4f6e 6c79 200a 2020 2020 2020 2020 2020  Only .          
-0001b110: 2020 6176 6169 6c61 626c 6520 6966 206d    available if m
-0001b120: 6574 686f 643d 226d 6173 6b22 2e0a 0a20  ethod="mask"... 
-0001b130: 2020 2020 2020 2062 795f 736c 6963 6520         by_slice 
-0001b140: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
-0001b150: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0001b160: 4966 206f 6e65 206f 6620 226c 6566 7422  If one of "left"
-0001b170: 2c20 2272 6967 6874 222c 2022 756e 696f  , "right", "unio
-0001b180: 6e22 2c20 2269 6e74 6572 7365 6374 696f  n", "intersectio
-0001b190: 6e22 2c20 6361 6c63 756c 6174 650a 2020  n", calculate.  
-0001b1a0: 2020 2020 2020 2020 2020 4469 6365 2073            Dice s
-0001b1b0: 636f 7265 7320 736c 6963 6520 6279 2073  cores slice by s
-0001b1c0: 6c69 6365 2066 6f72 2065 6163 6820 736c  lice for each sl
-0001b1d0: 6963 6520 636f 6e74 6169 6e69 6e67 0a20  ice containing. 
-0001b1e0: 2020 2020 2020 2020 2020 2073 656c 6620             self 
-0001b1f0: 616e 642f 6f72 206f 7468 6572 3a0a 0a20  and/or other:.. 
-0001b200: 2020 2020 2020 2020 2020 202d 2022 6c65             - "le
-0001b210: 6674 223a 2063 6f6e 7369 6465 7220 6f6e  ft": consider on
-0001b220: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
-0001b230: 6e69 6e67 2073 656c 663b 0a20 2020 2020  ning self;.     
-0001b240: 2020 2020 2020 202d 2022 7269 6768 7422         - "right"
-0001b250: 3a20 636f 6e73 6964 6572 206f 6e6c 7920  : consider only 
-0001b260: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
-0001b270: 6720 6f74 6865 723b 0a20 2020 2020 2020  g other;.       
-0001b280: 2020 2020 202d 2022 756e 696f 6e22 3a20       - "union": 
-0001b290: 636f 6e73 6964 6572 2073 6c69 6365 7320  consider slices 
-0001b2a0: 636f 6e74 6169 6e69 6e67 2065 6974 6865  containing eithe
-0001b2b0: 7220 6f66 2073 656c 6620 616e 6420 6f74  r of self and ot
-0001b2c0: 6865 723b 0a20 2020 2020 2020 2020 2020  her;.           
-0001b2d0: 202d 2022 696e 7465 7273 6563 7469 6f6e   - "intersection
-0001b2e0: 223a 2063 6f6e 7369 6465 7220 736c 6963  ": consider slic
-0001b2f0: 6573 2063 6f6e 7461 696e 696e 6720 626f  es containing bo
-0001b300: 7468 206f 6620 7365 6c66 2061 6e64 206f  th of self and o
-0001b310: 7468 6572 2e0a 0a20 2020 2020 2020 2020  ther...         
-0001b320: 2020 2049 6620 736c 6963 655f 7374 6174     If slice_stat
-0001b330: 2069 7320 4e6f 6e65 2c20 7265 7475 726e   is None, return
-0001b340: 2061 2064 6963 7469 6f6e 6172 7920 7768   a dictionary wh
-0001b350: 6572 6520 6b65 7973 2061 7265 0a20 2020  ere keys are.   
-0001b360: 2020 2020 2020 2020 2073 6c69 6365 2070           slice p
-0001b370: 6f73 6974 696f 6e73 2061 6e64 2076 616c  ositions and val
-0001b380: 7565 7320 6172 6520 7468 6520 6361 6c63  ues are the calc
-0001b390: 756c 6174 6564 204a 6163 6361 7264 2069  ulated Jaccard i
-0001b3a0: 6e64 6963 6573 2e0a 2020 2020 2020 2020  ndices..        
-0001b3b0: 2020 2020 4f74 6865 7277 6973 652c 2072      Otherwise, r
-0001b3c0: 6574 7572 6e20 666f 7220 7468 6520 6361  eturn for the ca
-0001b3d0: 6c63 756c 6174 6564 204a 6163 6361 7264  lculated Jaccard
-0001b3e0: 2069 6e64 6963 6573 2074 6865 2073 7461   indices the sta
-0001b3f0: 7469 7374 6963 0a20 2020 2020 2020 2020  tistic.         
-0001b400: 2020 2073 7065 6369 6669 6564 2062 7920     specified by 
-0001b410: 736c 6963 655f 7374 6174 2e0a 0a20 2020  slice_stat...   
-0001b420: 2020 2020 2076 616c 7565 5f66 6f72 5f6e       value_for_n
-0001b430: 6f6e 6520 3a20 666c 6f61 742c 2064 6566  one : float, def
-0001b440: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-0001b450: 2020 2020 2020 466f 7220 7369 6e67 6c65        For single
-0001b460: 5f73 6c69 6365 2061 6e64 2062 795f 736c  _slice and by_sl
-0001b470: 6963 652c 2076 616c 7565 2074 6f20 6265  ice, value to be
-0001b480: 2072 6574 7572 6e65 6420 666f 720a 2020   returned for.  
-0001b490: 2020 2020 2020 2020 2020 736c 6963 6573            slices
-0001b4a0: 2077 6865 7265 204a 6163 6361 7264 2069   where Jaccard i
-0001b4b0: 6e64 6578 2069 7320 756e 6465 7465 726d  ndex is undeterm
-0001b4c0: 696e 6564 2028 4e6f 6e65 292e 2020 466f  ined (None).  Fo
-0001b4d0: 7220 736c 6963 655f 7374 6174 2c0a 2020  r slice_stat,.  
-0001b4e0: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
-0001b4f0: 746f 2073 7562 7374 6974 7574 6520 666f  to substitute fo
-0001b500: 7220 616e 7920 4e6f 6e65 2076 616c 7565  r any None value
-0001b510: 7320 616d 6f6e 6720 7468 6520 696e 7075  s among the inpu
-0001b520: 7473 0a20 2020 2020 2020 2020 2020 2066  ts.            f
-0001b530: 6f72 2063 616c 6375 6c61 7469 6e67 2073  or calculating s
-0001b540: 6c69 6365 2d62 6173 6564 2073 7461 7469  lice-based stati
-0001b550: 7374 6963 2e20 2049 6620 4e6f 6e65 2069  stic.  If None i
-0001b560: 6e20 7468 6520 6c61 7474 6572 0a20 2020  n the latter.   
-0001b570: 2020 2020 2020 2020 2063 6173 652c 204e           case, N
-0001b580: 6f6e 6520 7661 6c75 6573 2061 6d6f 6e67  one values among
-0001b590: 2074 6865 2069 6e70 7574 7320 6172 6520   the inputs are 
-0001b5a0: 6f6d 6974 7465 642e 0a0a 2020 2020 2020  omitted...      
-0001b5b0: 2020 736c 6963 655f 7374 6174 203a 2073    slice_stat : s
-0001b5c0: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
-0001b5d0: 0a20 2020 2020 2020 2020 2020 2053 696e  .            Sin
-0001b5e0: 676c 652d 7661 7269 6162 6c65 2073 7461  gle-variable sta
-0001b5f0: 7469 7374 6963 2873 2920 746f 2062 6520  tistic(s) to be 
-0001b600: 7265 7475 726e 6564 2066 6f72 2073 6c69  returned for sli
-0001b610: 6365 2d62 792d 736c 6963 650a 2020 2020  ce-by-slice.    
-0001b620: 2020 2020 2020 2020 4a61 6363 6172 6420          Jaccard 
-0001b630: 696e 6469 6365 732e 2020 5468 6973 2073  indices.  This s
-0001b640: 686f 756c 6420 6265 2074 6865 206e 616d  hould be the nam
-0001b650: 6520 6f66 2074 6865 2066 756e 6374 696f  e of the functio
-0001b660: 6e20 666f 720a 2020 2020 2020 2020 2020  n for.          
-0001b670: 2020 6361 6c63 756c 6174 696f 6e20 6f66    calculation of
-0001b680: 2074 6865 2073 7461 7469 7374 6963 2873   the statistic(s
-0001b690: 2920 696e 2074 6865 2050 7974 686f 6e20  ) in the Python 
-0001b6a0: 7374 6174 6973 7469 6373 206d 6f64 756c  statistics modul
-0001b6b0: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
-0001b6c0: 6874 7470 733a 2f2f 646f 6373 2e70 7974  https://docs.pyt
-0001b6d0: 686f 6e2e 6f72 672f 332f 6c69 6272 6172  hon.org/3/librar
-0001b6e0: 792f 7374 6174 6973 7469 6373 2e68 746d  y/statistics.htm
-0001b6f0: 6c0a 0a20 2020 2020 2020 2020 2020 2041  l..            A
-0001b700: 7661 696c 6162 6c65 206f 7074 696f 6e73  vailable options
-0001b710: 2069 6e63 6c75 6465 3a20 226d 6561 6e22   include: "mean"
-0001b720: 2c20 226d 6564 6961 6e22 2c20 226d 6f64  , "median", "mod
-0001b730: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-0001b740: 2273 7464 6576 222c 2022 7175 616e 7469  "stdev", "quanti
-0001b750: 6c65 7322 2e20 2044 6973 7265 6761 7264  les".  Disregard
-0001b760: 6564 2069 6620 4e6f 6e65 2e0a 0a20 2020  ed if None...   
-0001b770: 2020 2020 2020 2020 2049 6620 6279 5f73           If by_s
-0001b780: 6c69 6365 2069 7320 4e6f 6e65 2061 6e64  lice is None and
-0001b790: 2073 6c69 6365 5f73 7461 7420 6973 2064   slice_stat is d
-0001b7a0: 6966 6665 7265 6e74 2066 726f 6d20 4e6f  ifferent from No
-0001b7b0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-0001b7c0: 7468 6520 666f 726d 6572 2064 6566 6175  the former defau
-0001b7d0: 6c74 7320 746f 2022 756e 696f 6e22 2e0a  lts to "union"..
-0001b7e0: 0a20 2020 2020 2020 2073 6c69 6365 5f73  .        slice_s
-0001b7f0: 7461 745f 6b77 6172 6773 203a 2064 6963  tat_kwargs : dic
-0001b800: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-0001b810: 2020 2020 2020 2020 2020 2020 4b65 7977              Keyw
-0001b820: 6f72 6420 6172 6775 6d65 6e74 7320 746f  ord arguments to
-0001b830: 2062 6520 7061 7373 6564 2074 6f20 6675   be passed to fu
-0001b840: 6e63 7469 6f6e 206f 6620 7374 6174 6973  nction of statis
-0001b850: 7469 6373 0a20 2020 2020 2020 2020 2020  tics.           
-0001b860: 206d 6f64 756c 6520 666f 7220 6361 6c63   module for calc
-0001b870: 756c 6174 696f 6e20 7265 6c61 7469 7665  ulation relative
-0001b880: 2074 6f20 736c 6963 6520 7661 6c75 6573   to slice values
-0001b890: 2e20 2046 6f72 2065 7861 6d70 6c65 2c0a  .  For example,.
-0001b8a0: 2020 2020 2020 2020 2020 2020 6966 2071              if q
-0001b8b0: 7561 6e74 696c 6573 2061 7265 2072 6571  uantiles are req
-0001b8c0: 7569 7265 6420 666f 7220 3130 2069 6e74  uired for 10 int
-0001b8d0: 6572 7661 6c73 2c20 7261 7468 6572 2074  ervals, rather t
-0001b8e0: 6861 6e20 666f 720a 2020 2020 2020 2020  han for.        
-0001b8f0: 2020 2020 7468 6520 6465 6661 756c 7420      the default 
-0001b900: 6f66 2034 2c20 7468 6973 2063 616e 2062  of 4, this can b
-0001b910: 6520 7370 6563 6966 6965 6420 7573 696e  e specified usin
-0001b920: 673a 0a0a 2020 2020 2020 2020 2020 2020  g:..            
-0001b930: 736c 6963 655f 7374 6174 5f6b 7761 7267  slice_stat_kwarg
-0001b940: 737b 226e 2220 3a20 3130 7d0a 0a20 2020  s{"n" : 10}..   
-0001b950: 2020 2020 2020 2020 2046 6f72 2061 7661           For ava
-0001b960: 696c 6162 6c65 206b 6579 776f 7264 206f  ilable keyword o
-0001b970: 7074 696f 6e73 2c20 7365 6520 646f 6375  ptions, see docu
-0001b980: 6d65 6e74 6174 696f 6e20 6f66 2073 7461  mentation of sta
-0001b990: 7469 7374 6963 730a 2020 2020 2020 2020  tistics.        
-0001b9a0: 2020 2020 6d6f 6475 6c65 2061 743a 0a0a      module at:..
-0001b9b0: 2020 2020 2020 2020 2020 2020 6874 7470              http
-0001b9c0: 733a 2f2f 646f 6373 2e70 7974 686f 6e2e  s://docs.python.
-0001b9d0: 6f72 672f 332f 6c69 6272 6172 792f 7374  org/3/library/st
-0001b9e0: 6174 6973 7469 6373 2e68 746d 6c0a 2020  atistics.html.  
-0001b9f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001ba00: 2020 6966 2073 6c69 6365 5f73 7461 743a    if slice_stat:
-0001ba10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001ba20: 7572 6e20 7365 6c66 2e67 6574 5f73 6c69  urn self.get_sli
-0001ba30: 6365 5f73 7461 7428 6f74 6865 722c 2022  ce_stat(other, "
-0001ba40: 6a61 6363 6172 6422 2c20 736c 6963 655f  jaccard", slice_
-0001ba50: 7374 6174 2c20 6279 5f73 6c69 6365 2c0a  stat, by_slice,.
-0001ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba70: 2020 2020 7661 6c75 655f 666f 725f 6e6f      value_for_no
-0001ba80: 6e65 2c20 7669 6577 2c20 6d65 7468 6f64  ne, view, method
-0001ba90: 2c20 2a2a 2873 6c69 6365 5f73 7461 745f  , **(slice_stat_
-0001baa0: 6b77 6172 6773 206f 7220 7b7d 2929 0a0a  kwargs or {}))..
-0001bab0: 2020 2020 2020 2020 6966 2062 795f 736c          if by_sl
-0001bac0: 6963 653a 0a20 2020 2020 2020 2020 2020  ice:.           
-0001bad0: 2072 6574 7572 6e20 7365 6c66 2e67 6574   return self.get
-0001bae0: 5f6d 6574 7269 635f 6279 5f73 6c69 6365  _metric_by_slice
-0001baf0: 286f 7468 6572 2c20 226a 6163 6361 7264  (other, "jaccard
-0001bb00: 222c 2062 795f 736c 6963 652c 0a20 2020  ", by_slice,.   
-0001bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb20: 2076 6965 772c 206d 6574 686f 6429 0a0a   view, method)..
-0001bb30: 2020 2020 2020 2020 696e 7465 7273 6563          intersec
-0001bb40: 7469 6f6e 2c20 756e 696f 6e2c 206d 6561  tion, union, mea
-0001bb50: 6e5f 7369 7a65 203d 2073 656c 662e 6765  n_size = self.ge
-0001bb60: 745f 696e 7465 7273 6563 7469 6f6e 5f75  t_intersection_u
-0001bb70: 6e69 6f6e 5f73 697a 6528 0a20 2020 2020  nion_size(.     
-0001bb80: 2020 2020 2020 2020 2020 206f 7468 6572             other
-0001bb90: 2c20 7369 6e67 6c65 5f73 6c69 6365 2c20  , single_slice, 
-0001bba0: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
-0001bbb0: 6f73 2c20 6d65 7468 6f64 2c20 666c 6174  os, method, flat
-0001bbc0: 7465 6e29 0a0a 2020 2020 2020 2020 7265  ten)..        re
-0001bbd0: 7475 726e 2028 696e 7465 7273 6563 7469  turn (intersecti
-0001bbe0: 6f6e 202f 2075 6e69 6f6e 2069 6620 756e  on / union if un
-0001bbf0: 696f 6e20 656c 7365 2076 616c 7565 5f66  ion else value_f
-0001bc00: 6f72 5f6e 6f6e 6529 0a0a 2020 2020 6465  or_none)..    de
-0001bc10: 6620 6765 745f 766f 6c75 6d65 5f72 6174  f get_volume_rat
-0001bc20: 696f 2873 656c 662c 206f 7468 6572 2c20  io(self, other, 
-0001bc30: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-0001bc40: 2020 2022 2222 4765 7420 7261 7469 6f20     """Get ratio 
-0001bc50: 6f66 2061 6e6f 7468 6572 2052 4f49 2773  of another ROI's
-0001bc60: 2076 6f6c 756d 6520 7769 7468 2072 6573   volume with res
-0001bc70: 7065 6374 2074 6f20 6f77 6e20 766f 6c75  pect to own volu
-0001bc80: 6d65 2e22 2222 0a0a 2020 2020 2020 2020  me."""..        
-0001bc90: 6f77 6e5f 766f 6c75 6d65 203d 206f 7468  own_volume = oth
-0001bca0: 6572 2e67 6574 5f76 6f6c 756d 6528 2a2a  er.get_volume(**
-0001bcb0: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-0001bcc0: 6f74 6865 725f 766f 6c75 6d65 203d 2073  other_volume = s
-0001bcd0: 656c 662e 6765 745f 766f 6c75 6d65 282a  elf.get_volume(*
-0001bce0: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-0001bcf0: 2069 6620 6e6f 7420 6f74 6865 725f 766f   if not other_vo
-0001bd00: 6c75 6d65 206f 7220 6e6f 7420 6f77 6e5f  lume or not own_
-0001bd10: 766f 6c75 6d65 3a0a 2020 2020 2020 2020  volume:.        
-0001bd20: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-0001bd30: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-0001bd40: 776e 5f76 6f6c 756d 6520 2f20 6f74 6865  wn_volume / othe
-0001bd50: 725f 766f 6c75 6d65 0a0a 2020 2020 6465  r_volume..    de
-0001bd60: 6620 6765 745f 6172 6561 5f72 6174 696f  f get_area_ratio
-0001bd70: 2873 656c 662c 206f 7468 6572 2c20 7669  (self, other, vi
-0001bd80: 6577 3d22 782d 7922 2c20 736c 3d4e 6f6e  ew="x-y", sl=Non
-0001bd90: 652c 2069 6478 3d4e 6f6e 652c 2070 6f73  e, idx=None, pos
-0001bda0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-0001bdb0: 2020 2075 6e69 7473 3d22 6d6d 222c 206d     units="mm", m
-0001bdc0: 6574 686f 643d 4e6f 6e65 2c20 666c 6174  ethod=None, flat
-0001bdd0: 7465 6e3d 4661 6c73 652c 2062 795f 736c  ten=False, by_sl
-0001bde0: 6963 653d 4e6f 6e65 2c0a 2020 2020 2020  ice=None,.      
-0001bdf0: 2020 2020 2020 736c 6963 655f 7374 6174        slice_stat
-0001be00: 3d4e 6f6e 652c 2076 616c 7565 5f66 6f72  =None, value_for
-0001be10: 5f6e 6f6e 653d 4e6f 6e65 2c20 2a2a 736c  _none=None, **sl
-0001be20: 6963 655f 7374 6174 5f6b 7761 7267 7329  ice_stat_kwargs)
-0001be30: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
-0001be40: 2072 6174 696f 206f 6620 616e 6f74 6865   ratio of anothe
-0001be50: 7220 524f 4927 7320 6172 6561 2077 6974  r ROI's area wit
-0001be60: 6820 7265 7370 6563 7420 746f 206f 776e  h respect to own
-0001be70: 2061 7265 612e 2222 220a 0a20 2020 2020   area."""..     
-0001be80: 2020 2069 6620 736c 6963 655f 7374 6174     if slice_stat
-0001be90: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001bea0: 7475 726e 2073 656c 662e 6765 745f 736c  turn self.get_sl
-0001beb0: 6963 655f 7374 6174 286f 7468 6572 2c20  ice_stat(other, 
-0001bec0: 2261 7265 615f 7261 7469 6f22 2c20 736c  "area_ratio", sl
-0001bed0: 6963 655f 7374 6174 2c0a 2020 2020 2020  ice_stat,.      
-0001bee0: 2020 2020 2020 2020 2020 2020 2020 6279                by
-0001bef0: 5f73 6c69 6365 2c20 7661 6c75 655f 666f  _slice, value_fo
-0001bf00: 725f 6e6f 6e65 2c20 7669 6577 2c20 6d65  r_none, view, me
-0001bf10: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
-0001bf20: 2020 2020 2020 2020 2020 2a2a 2873 6c69            **(sli
-0001bf30: 6365 5f73 7461 745f 6b77 6172 6773 206f  ce_stat_kwargs o
-0001bf40: 7220 7b7d 2929 0a0a 2020 2020 2020 2020  r {}))..        
-0001bf50: 6966 2062 795f 736c 6963 653a 0a20 2020  if by_slice:.   
-0001bf60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001bf70: 7365 6c66 2e67 6574 5f6d 6574 7269 635f  self.get_metric_
-0001bf80: 6279 5f73 6c69 6365 286f 7468 6572 2c20  by_slice(other, 
-0001bf90: 2261 7265 615f 7261 7469 6f22 2c20 6279  "area_ratio", by
-0001bfa0: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
-0001bfb0: 2020 2020 2020 2020 2020 2020 7669 6577              view
-0001bfc0: 2c20 6d65 7468 6f64 290a 0a20 2020 2020  , method)..     
-0001bfd0: 2020 206f 776e 5f61 7265 6120 3d20 6f74     own_area = ot
-0001bfe0: 6865 722e 6765 745f 6172 6561 2876 6965  her.get_area(vie
-0001bff0: 772c 2073 6c2c 2069 6478 2c20 706f 732c  w, sl, idx, pos,
-0001c000: 2075 6e69 7473 2c20 6d65 7468 6f64 2c20   units, method, 
-0001c010: 666c 6174 7465 6e29 0a20 2020 2020 2020  flatten).       
-0001c020: 206f 7468 6572 5f61 7265 6120 3d20 7365   other_area = se
-0001c030: 6c66 2e67 6574 5f61 7265 6128 7669 6577  lf.get_area(view
-0001c040: 2c20 736c 2c20 6964 782c 2070 6f73 2c20  , sl, idx, pos, 
-0001c050: 756e 6974 732c 206d 6574 686f 642c 2066  units, method, f
-0001c060: 6c61 7474 656e 290a 2020 2020 2020 2020  latten).        
-0001c070: 6966 206e 6f74 206f 7468 6572 5f61 7265  if not other_are
-0001c080: 6120 6f72 206e 6f74 206f 776e 5f61 7265  a or not own_are
-0001c090: 613a 0a20 2020 2020 2020 2020 2020 2072  a:.            r
-0001c0a0: 6574 7572 6e20 7661 6c75 655f 666f 725f  eturn value_for_
-0001c0b0: 6e6f 6e65 0a20 2020 2020 2020 2072 6574  none.        ret
-0001c0c0: 7572 6e20 6f77 6e5f 6172 6561 202f 206f  urn own_area / o
-0001c0d0: 7468 6572 5f61 7265 610a 0a20 2020 2064  ther_area..    d
-0001c0e0: 6566 2067 6574 5f76 6f6c 756d 655f 6469  ef get_volume_di
-0001c0f0: 6666 2873 656c 662c 206f 7468 6572 2c20  ff(self, other, 
-0001c100: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-0001c110: 2020 2022 2222 4765 7420 6f77 6e20 766f     """Get own vo
-0001c120: 6c75 6d65 206d 696e 7573 2076 6f6c 756d  lume minus volum
-0001c130: 6520 6f66 206f 7468 6572 2052 4f49 2e22  e of other ROI."
-0001c140: 2222 0a0a 2020 2020 2020 2020 6f77 6e5f  ""..        own_
-0001c150: 766f 6c75 6d65 203d 2073 656c 662e 6765  volume = self.ge
-0001c160: 745f 766f 6c75 6d65 282a 2a6b 7761 7267  t_volume(**kwarg
-0001c170: 7329 0a20 2020 2020 2020 206f 7468 6572  s).        other
-0001c180: 5f76 6f6c 756d 6520 3d20 6f74 6865 722e  _volume = other.
-0001c190: 6765 745f 766f 6c75 6d65 282a 2a6b 7761  get_volume(**kwa
-0001c1a0: 7267 7329 0a20 2020 2020 2020 2069 6620  rgs).        if 
-0001c1b0: 6e6f 7420 6f77 6e5f 766f 6c75 6d65 206f  not own_volume o
-0001c1c0: 7220 6e6f 7420 6f74 6865 725f 766f 6c75  r not other_volu
-0001c1d0: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
-0001c1e0: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
-0001c1f0: 2020 2020 7265 7475 726e 2028 6f77 6e5f      return (own_
-0001c200: 766f 6c75 6d65 202d 206f 7468 6572 5f76  volume - other_v
-0001c210: 6f6c 756d 6529 0a0a 2020 2020 6465 6620  olume)..    def 
-0001c220: 6765 745f 7265 6c61 7469 7665 5f76 6f6c  get_relative_vol
-0001c230: 756d 655f 6469 6666 2873 656c 662c 206f  ume_diff(self, o
-0001c240: 7468 6572 2c20 2a2a 6b77 6172 6773 293a  ther, **kwargs):
-0001c250: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
-0001c260: 7265 6c61 7469 7665 2076 6f6c 756d 6520  relative volume 
-0001c270: 6f66 2061 6e6f 7468 6572 2052 4f49 2077  of another ROI w
-0001c280: 6974 6820 7265 7370 6563 7420 746f 206f  ith respect to o
-0001c290: 776e 2076 6f6c 756d 652e 2222 220a 0a20  wn volume.""".. 
-0001c2a0: 2020 2020 2020 206f 776e 5f76 6f6c 756d         own_volum
-0001c2b0: 6520 3d20 7365 6c66 2e67 6574 5f76 6f6c  e = self.get_vol
-0001c2c0: 756d 6528 2a2a 6b77 6172 6773 290a 2020  ume(**kwargs).  
-0001c2d0: 2020 2020 2020 766f 6c75 6d65 5f64 6966        volume_dif
-0001c2e0: 6620 3d20 7365 6c66 2e67 6574 5f76 6f6c  f = self.get_vol
-0001c2f0: 756d 655f 6469 6666 286f 7468 6572 2c20  ume_diff(other, 
-0001c300: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
-0001c310: 2020 6966 2076 6f6c 756d 655f 6469 6666    if volume_diff
-0001c320: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001c330: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-0001c340: 2020 2020 2072 6574 7572 6e20 766f 6c75       return volu
-0001c350: 6d65 5f64 6966 6620 2f20 6f77 6e5f 766f  me_diff / own_vo
-0001c360: 6c75 6d65 0a0a 2020 2020 6465 6620 6765  lume..    def ge
-0001c370: 745f 6172 6561 5f64 6966 6628 7365 6c66  t_area_diff(self
-0001c380: 2c20 6f74 6865 722c 2076 6965 773d 2278  , other, view="x
-0001c390: 2d79 222c 2073 6c3d 4e6f 6e65 2c20 6964  -y", sl=None, id
-0001c3a0: 783d 4e6f 6e65 2c20 706f 733d 4e6f 6e65  x=None, pos=None
-0001c3b0: 2c0a 2020 2020 2020 2020 2020 2020 756e  ,.            un
-0001c3c0: 6974 733d 226d 6d22 2c20 6d65 7468 6f64  its="mm", method
-0001c3d0: 3d4e 6f6e 652c 2066 6c61 7474 656e 3d46  =None, flatten=F
-0001c3e0: 616c 7365 2c20 6279 5f73 6c69 6365 3d4e  alse, by_slice=N
-0001c3f0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-0001c400: 2073 6c69 6365 5f73 7461 743d 4e6f 6e65   slice_stat=None
-0001c410: 2c20 7661 6c75 655f 666f 725f 6e6f 6e65  , value_for_none
-0001c420: 3d4e 6f6e 652c 202a 2a73 6c69 6365 5f73  =None, **slice_s
-0001c430: 7461 745f 6b77 6172 6773 293a 0a20 2020  tat_kwargs):.   
-0001c440: 2020 2020 2022 2222 4765 7420 6162 736f       """Get abso
-0001c450: 6c75 7465 2061 7265 6120 6469 6666 6572  lute area differ
-0001c460: 656e 6365 2062 6574 7765 656e 2074 776f  ence between two
-0001c470: 2052 4f49 732e 2222 220a 0a20 2020 2020   ROIs."""..     
-0001c480: 2020 2069 6620 736c 6963 655f 7374 6174     if slice_stat
-0001c490: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001c4a0: 7475 726e 2073 656c 662e 6765 745f 736c  turn self.get_sl
-0001c4b0: 6963 655f 7374 6174 286f 7468 6572 2c20  ice_stat(other, 
-0001c4c0: 2261 7265 615f 6469 6666 222c 2073 6c69  "area_diff", sli
-0001c4d0: 6365 5f73 7461 742c 0a20 2020 2020 2020  ce_stat,.       
-0001c4e0: 2020 2020 2020 2020 2020 2020 2062 795f               by_
-0001c4f0: 736c 6963 652c 2076 616c 7565 5f66 6f72  slice, value_for
-0001c500: 5f6e 6f6e 652c 2076 6965 772c 206d 6574  _none, view, met
-0001c510: 686f 642c 0a20 2020 2020 2020 2020 2020  hod,.           
-0001c520: 2020 2020 2020 2020 202a 2a28 736c 6963           **(slic
-0001c530: 655f 7374 6174 5f6b 7761 7267 7320 6f72  e_stat_kwargs or
-0001c540: 207b 7d29 290a 0a20 2020 2020 2020 2069   {}))..        i
-0001c550: 6620 6279 5f73 6c69 6365 3a0a 2020 2020  f by_slice:.    
-0001c560: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001c570: 656c 662e 6765 745f 6d65 7472 6963 5f62  elf.get_metric_b
-0001c580: 795f 736c 6963 6528 6f74 6865 722c 2022  y_slice(other, "
-0001c590: 6172 6561 5f64 6966 6622 2c20 6279 5f73  area_diff", by_s
-0001c5a0: 6c69 6365 2c0a 2020 2020 2020 2020 2020  lice,.          
-0001c5b0: 2020 2020 2020 2020 2020 7669 6577 2c20            view, 
-0001c5c0: 6d65 7468 6f64 290a 0a20 2020 2020 2020  method)..       
-0001c5d0: 206f 776e 5f61 7265 6120 3d20 7365 6c66   own_area = self
-0001c5e0: 2e67 6574 5f61 7265 6128 7669 6577 2c20  .get_area(view, 
-0001c5f0: 736c 2c20 6964 782c 2070 6f73 2c20 756e  sl, idx, pos, un
-0001c600: 6974 732c 206d 6574 686f 642c 2066 6c61  its, method, fla
-0001c610: 7474 656e 290a 2020 2020 2020 2020 6f74  tten).        ot
-0001c620: 6865 725f 6172 6561 203d 206f 7468 6572  her_area = other
-0001c630: 2e67 6574 5f61 7265 6128 7669 6577 2c20  .get_area(view, 
-0001c640: 736c 2c20 6964 782c 2070 6f73 2c20 756e  sl, idx, pos, un
-0001c650: 6974 732c 206d 6574 686f 642c 2066 6c61  its, method, fla
-0001c660: 7474 656e 290a 2020 2020 2020 2020 6966  tten).        if
-0001c670: 206e 6f74 206f 776e 5f61 7265 6120 6f72   not own_area or
-0001c680: 206e 6f74 206f 7468 6572 5f61 7265 613a   not other_area:
-0001c690: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001c6a0: 7572 6e20 7661 6c75 655f 666f 725f 6e6f  urn value_for_no
-0001c6b0: 6e65 0a20 2020 2020 2020 2072 6574 7572  ne.        retur
-0001c6c0: 6e20 6f77 6e5f 6172 6561 202d 206f 7468  n own_area - oth
-0001c6d0: 6572 5f61 7265 610a 0a20 2020 2064 6566  er_area..    def
-0001c6e0: 2067 6574 5f72 656c 6174 6976 655f 6172   get_relative_ar
-0001c6f0: 6561 5f64 6966 6628 7365 6c66 2c20 6f74  ea_diff(self, ot
-0001c700: 6865 722c 2076 6965 773d 2278 2d79 222c  her, view="x-y",
-0001c710: 2073 6c3d 4e6f 6e65 2c20 6964 783d 4e6f   sl=None, idx=No
-0001c720: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-0001c730: 706f 733d 4e6f 6e65 2c20 756e 6974 733d  pos=None, units=
-0001c740: 226d 6d22 2c20 6d65 7468 6f64 3d4e 6f6e  "mm", method=Non
-0001c750: 652c 2066 6c61 7474 656e 3d46 616c 7365  e, flatten=False
-0001c760: 2c20 6279 5f73 6c69 6365 3d4e 6f6e 652c  , by_slice=None,
-0001c770: 0a20 2020 2020 2020 2020 2020 2073 6c69  .            sli
-0001c780: 6365 5f73 7461 743d 4e6f 6e65 2c20 7661  ce_stat=None, va
-0001c790: 6c75 655f 666f 725f 6e6f 6e65 3d4e 6f6e  lue_for_none=Non
-0001c7a0: 652c 202a 2a73 6c69 6365 5f73 7461 745f  e, **slice_stat_
-0001c7b0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-0001c7c0: 2022 2222 4765 7420 7265 6c61 7469 7665   """Get relative
-0001c7d0: 2061 7265 6120 6f66 2061 6e6f 7468 6572   area of another
-0001c7e0: 2052 4f49 2077 6974 6820 7265 7370 6563   ROI with respec
-0001c7f0: 7420 746f 206f 776e 2061 7265 612e 2222  t to own area.""
-0001c800: 220a 0a20 2020 2020 2020 2069 6620 736c  "..        if sl
-0001c810: 6963 655f 7374 6174 3a0a 2020 2020 2020  ice_stat:.      
-0001c820: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001c830: 662e 6765 745f 736c 6963 655f 7374 6174  f.get_slice_stat
-0001c840: 286f 7468 6572 2c20 2272 656c 5f61 7265  (other, "rel_are
-0001c850: 615f 6469 6666 222c 2073 6c69 6365 5f73  a_diff", slice_s
-0001c860: 7461 742c 0a20 2020 2020 2020 2020 2020  tat,.           
-0001c870: 2020 2020 2020 2020 2062 795f 736c 6963           by_slic
-0001c880: 652c 2076 616c 7565 5f66 6f72 5f6e 6f6e  e, value_for_non
-0001c890: 652c 2076 6965 772c 206d 6574 686f 642c  e, view, method,
-0001c8a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c8b0: 2020 2020 202a 2a28 736c 6963 655f 7374       **(slice_st
-0001c8c0: 6174 5f6b 7761 7267 7320 6f72 207b 7d29  at_kwargs or {})
-0001c8d0: 290a 0a20 2020 2020 2020 2069 6620 6279  )..        if by
-0001c8e0: 5f73 6c69 6365 3a0a 2020 2020 2020 2020  _slice:.        
-0001c8f0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0001c900: 6765 745f 6d65 7472 6963 5f62 795f 736c  get_metric_by_sl
-0001c910: 6963 6528 6f74 6865 722c 2022 7265 6c5f  ice(other, "rel_
-0001c920: 6172 6561 5f64 6966 6622 2c0a 2020 2020  area_diff",.    
-0001c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c940: 6279 5f73 6c69 6365 2c20 7669 6577 2c20  by_slice, view, 
-0001c950: 6d65 7468 6f64 290a 0a20 2020 2020 2020  method)..       
-0001c960: 206f 776e 5f61 7265 6120 3d20 7365 6c66   own_area = self
-0001c970: 2e67 6574 5f61 7265 6128 7669 6577 2c20  .get_area(view, 
-0001c980: 736c 2c20 6964 782c 2070 6f73 2c20 756e  sl, idx, pos, un
-0001c990: 6974 732c 206d 6574 686f 642c 2066 6c61  its, method, fla
-0001c9a0: 7474 656e 290a 2020 2020 2020 2020 6172  tten).        ar
-0001c9b0: 6561 5f64 6966 6620 3d20 7365 6c66 2e67  ea_diff = self.g
-0001c9c0: 6574 5f61 7265 615f 6469 6666 286f 7468  et_area_diff(oth
-0001c9d0: 6572 2c20 7669 6577 2c20 736c 2c20 6964  er, view, sl, id
-0001c9e0: 782c 2070 6f73 2c20 756e 6974 732c 206d  x, pos, units, m
-0001c9f0: 6574 686f 642c 0a20 2020 2020 2020 2020  ethod,.         
-0001ca00: 2020 2020 2020 2066 6c61 7474 656e 290a         flatten).
-0001ca10: 0a20 2020 2020 2020 2069 6620 6172 6561  .        if area
-0001ca20: 5f64 6966 6620 6973 204e 6f6e 653a 0a20  _diff is None:. 
-0001ca30: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001ca40: 6e20 7661 6c75 655f 666f 725f 6e6f 6e65  n value_for_none
-0001ca50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001ca60: 6172 6561 5f64 6966 6620 2f20 6f77 6e5f  area_diff / own_
-0001ca70: 6172 6561 0a0a 2020 2020 6465 6620 6765  area..    def ge
-0001ca80: 745f 696e 7465 7273 6563 7469 6f6e 5f75  t_intersection_u
-0001ca90: 6e69 6f6e 5f73 697a 6528 0a20 2020 2020  nion_size(.     
-0001caa0: 2020 2073 656c 662c 200a 2020 2020 2020     self, .      
-0001cab0: 2020 6f74 6865 722c 200a 2020 2020 2020    other, .      
-0001cac0: 2020 7369 6e67 6c65 5f73 6c69 6365 3d46    single_slice=F
-0001cad0: 616c 7365 2c0a 2020 2020 2020 2020 7669  alse,.        vi
-0001cae0: 6577 3d22 782d 7922 2c20 0a20 2020 2020  ew="x-y", .     
-0001caf0: 2020 2073 6c3d 4e6f 6e65 2c20 0a20 2020     sl=None, .   
-0001cb00: 2020 2020 2069 6478 3d4e 6f6e 652c 200a       idx=None, .
-0001cb10: 2020 2020 2020 2020 706f 733d 4e6f 6e65          pos=None
-0001cb20: 2c20 0a20 2020 2020 2020 206d 6574 686f  , .        metho
-0001cb30: 643d 4e6f 6e65 2c0a 2020 2020 2020 2020  d=None,.        
-0001cb40: 666c 6174 7465 6e3d 4661 6c73 652c 0a20  flatten=False,. 
-0001cb50: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-0001cb60: 220a 2020 2020 2020 2020 4765 7420 696e  ".        Get in
-0001cb70: 7465 7273 6563 7469 6f6e 2c20 756e 696f  tersection, unio
-0001cb80: 6e20 616e 6420 6d65 616e 2073 697a 6520  n and mean size 
-0001cb90: 7769 7468 2072 6573 7065 6374 2074 6f20  with respect to 
-0001cba0: 616e 6f74 6865 7220 524f 492e 0a20 2020  another ROI..   
-0001cbb0: 2020 2020 2056 616c 7565 7320 6172 6520       Values are 
-0001cbc0: 7265 7475 726e 6564 2061 7320 766f 6c75  returned as volu
-0001cbd0: 6d65 7320 666f 7220 7468 6520 6675 6c6c  mes for the full
-0001cbe0: 2052 4f49 732c 0a20 2020 2020 2020 206f   ROIs,.        o
-0001cbf0: 7220 6173 2061 7265 6173 2066 6f72 2061  r as areas for a
-0001cc00: 2073 696e 676c 6520 736c 6963 652e 0a0a   single slice...
-0001cc10: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
-0001cc20: 7465 7273 3a2a 2a0a 2020 2020 2020 2020  ters:**.        
-0001cc30: 0a20 2020 2020 2020 206f 7468 6572 203a  .        other :
-0001cc40: 2052 4f49 0a20 2020 2020 2020 2020 2020   ROI.           
-0001cc50: 204f 7468 6572 2052 4f49 2074 6f20 636f   Other ROI to co
-0001cc60: 6d70 6172 6520 7769 7468 2074 6869 7320  mpare with this 
-0001cc70: 524f 492e 0a0a 2020 2020 2020 2020 7369  ROI...        si
-0001cc80: 6e67 6c65 5f73 6c69 6365 203a 2062 6f6f  ngle_slice : boo
-0001cc90: 6c2c 2064 6566 6175 6c74 3d46 616c 7365  l, default=False
-0001cca0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-0001ccb0: 4661 6c73 652c 2074 6865 2076 6f6c 756d  False, the volum
-0001ccc0: 6573 206f 6620 696e 7465 7273 6563 7469  es of intersecti
-0001ccd0: 6f6e 2061 6e64 2020 756e 696f 6e20 6f66  on and  union of
-0001cce0: 2074 6865 2066 756c 6c20 524f 4973 2c0a   the full ROIs,.
-0001ccf0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-0001cd00: 7468 6520 6d65 616e 2052 4f49 2076 6f6c  the mean ROI vol
-0001cd10: 756d 6520 7769 6c6c 2062 6520 7265 7475  ume will be retu
-0001cd20: 726e 6564 3b0a 2020 2020 2020 2020 2020  rned;.          
-0001cd30: 2020 6f74 6865 7277 6973 652c 2074 6865    otherwise, the
-0001cd40: 2061 7265 6173 206f 6620 696e 7465 7273   areas of inters
-0001cd50: 6563 7469 6f6e 2061 6e64 2075 6e69 6f6e  ection and union
-0001cd60: 206f 6e20 6120 7369 6e67 6c65 2073 6c69   on a single sli
-0001cd70: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
-0001cd80: 616e 6420 7468 6520 6d65 616e 2052 4f49  and the mean ROI
-0001cd90: 2061 7265 612c 2077 696c 6c20 6265 2072   area, will be r
-0001cda0: 6574 7572 6e65 642e 0a0a 2020 2020 2020  eturned...      
-0001cdb0: 2020 7669 6577 203a 2073 7472 2c20 6465    view : str, de
-0001cdc0: 6661 756c 743d 2278 2d79 220a 2020 2020  fault="x-y".    
-0001cdd0: 2020 2020 2020 2020 4f72 6965 6e74 6174          Orientat
-0001cde0: 696f 6e20 6f66 2073 6c69 6365 206f 6e20  ion of slice on 
-0001cdf0: 7768 6963 6820 746f 2067 6574 2061 7265  which to get are
-0001ce00: 6173 206f 6620 696e 7465 7273 6563 7469  as of intersecti
-0001ce10: 6f6e 0a20 2020 2020 2020 2020 2020 2061  on.            a
-0001ce20: 6e64 2075 6e69 6f6e 2c20 616e 6420 6d65  nd union, and me
-0001ce30: 616e 2052 4f49 2061 7265 612e 2020 4f6e  an ROI area.  On
-0001ce40: 6c79 2075 7365 6420 6966 2073 696e 676c  ly used if singl
-0001ce50: 655f 736c 6963 653d 5472 7565 2e0a 0a20  e_slice=True... 
-0001ce60: 2020 2020 2020 2073 6c20 3a20 696e 742c         sl : int,
-0001ce70: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0001ce80: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
-0001ce90: 6e75 6d62 6572 2e20 4966 206e 6f6e 6520  number. If none 
-0001cea0: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
-0001ceb0: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
-0001cec0: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
-0001ced0: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
-0001cee0: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
-0001cef0: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
-0001cf00: 6620 7468 6973 2052 4f49 2077 696c 6c20  f this ROI will 
-0001cf10: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
-0001cf20: 2020 6964 7820 3a20 696e 742c 2064 6566    idx : int, def
-0001cf30: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-0001cf40: 2020 2020 2020 4172 7261 7920 696e 6465        Array inde
-0001cf50: 7820 6f66 2073 6c69 6365 2e20 4966 206e  x of slice. If n
-0001cf60: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
-0001cf70: 783e 206f 7220 3c70 6f73 3e20 6172 6520  x> or <pos> are 
-0001cf80: 7375 7070 6c69 6564 0a20 2020 2020 2020  supplied.       
-0001cf90: 2020 2020 2062 7574 203c 7369 6e67 6c65       but <single
-0001cfa0: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
-0001cfb0: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
-0001cfc0: 6365 206f 6620 7468 6973 2052 4f49 2077  ce of this ROI w
-0001cfd0: 696c 6c20 6265 0a20 2020 2020 2020 2020  ill be.         
-0001cfe0: 2020 2075 7365 642e 0a0a 2020 2020 2020     used...      
-0001cff0: 2020 706f 7320 3a20 666c 6f61 742c 2064    pos : float, d
-0001d000: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-0001d010: 2020 2020 2020 2020 536c 6963 6520 706f          Slice po
-0001d020: 7369 7469 6f6e 2069 6e20 6d6d 2e20 4966  sition in mm. If
-0001d030: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
-0001d040: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
-0001d050: 6520 7375 7070 6c69 6564 0a20 2020 2020  e supplied.     
-0001d060: 2020 2020 2020 2062 7574 203c 7369 6e67         but <sing
-0001d070: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
-0001d080: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
-0001d090: 6c69 6365 206f 6620 7468 6973 2052 4f49  lice of this ROI
-0001d0a0: 2077 696c 6c0a 2020 2020 2020 2020 2020   will.          
-0001d0b0: 2020 6265 2075 7365 642e 0a0a 2020 2020    be used...    
-0001d0c0: 2020 2020 6d65 7468 6f64 203a 2073 7472      method : str
-0001d0d0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0001d0e0: 2020 2020 2020 2020 2020 204d 6574 686f             Metho
-0001d0f0: 6420 746f 2075 7365 2066 6f72 2063 616c  d to use for cal
-0001d100: 6375 6c61 7469 6e67 2069 6e74 6572 7365  culating interse
-0001d110: 6374 696f 6e2c 2075 6e69 6f6e 2c20 616e  ction, union, an
-0001d120: 6420 6d65 616e 0a20 2020 2020 2020 2020  d mean.         
-0001d130: 2020 2073 697a 652e 2043 616e 2062 653a     size. Can be:
-0001d140: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0001d150: 2020 2d20 2263 6f6e 746f 7572 223a 2067    - "contour": g
-0001d160: 6574 2069 6e74 6572 7365 6374 696f 6e73  et intersections
-0001d170: 2061 6e64 2061 7265 6173 206f 6620 7368   and areas of sh
-0001d180: 6170 656c 7920 636f 6e74 6f75 7273 2e0a  apely contours..
-0001d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d1a0: 2d20 226d 6173 6b22 3a20 636f 756e 7420  - "mask": count 
-0001d1b0: 696e 7465 7273 6563 7469 6e67 2076 6f78  intersecting vox
-0001d1c0: 656c 7320 696e 2062 696e 6172 7920 6d61  els in binary ma
-0001d1d0: 736b 732e 0a20 2020 2020 2020 2020 2020  sks..           
-0001d1e0: 2020 2020 202d 204e 6f6e 653a 2075 7365       - None: use
-0001d1f0: 2074 6865 206d 6574 686f 6420 7365 7420   the method set 
-0001d200: 696e 2073 656c 662e 6465 6661 756c 745f  in self.default_
-0001d210: 6765 6f6d 5f6d 6574 686f 642e 0a0a 2020  geom_method...  
-0001d220: 2020 2020 2020 666c 6174 7465 6e20 3a20        flatten : 
-0001d230: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
-0001d240: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-0001d250: 4966 2054 7275 652c 2061 6c6c 2073 6c69  If True, all sli
-0001d260: 6365 7320 7769 6c6c 2062 6520 666c 6174  ces will be flat
-0001d270: 7465 6e65 6420 696e 2074 6865 2067 6976  tened in the giv
-0001d280: 656e 206f 7269 656e 7461 7469 6f6e 2061  en orientation a
-0001d290: 6e64 0a20 2020 2020 2020 2020 2020 2074  nd.            t
-0001d2a0: 6865 2061 7265 6173 206f 6620 696e 7465  he areas of inte
-0001d2b0: 7273 6563 7469 6f6e 2061 6e64 2075 6e69  rsection and uni
-0001d2c0: 6f6e 2c20 616e 6420 7468 6520 6d65 616e  on, and the mean
-0001d2d0: 2052 4f49 2061 7265 612c 0a20 2020 2020   ROI area,.     
-0001d2e0: 2020 2020 2020 2077 696c 6c20 6265 2072         will be r
-0001d2f0: 6574 7572 6e65 6420 666f 7220 7468 6520  eturned for the 
-0001d300: 666c 6174 7465 6e65 6420 736c 6963 6573  flattened slices
-0001d310: 2e20 4f6e 6c79 2061 7661 696c 6162 6c65  . Only available
-0001d320: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001d330: 6d65 7468 6f64 3d22 6d61 736b 222e 0a20  method="mask".. 
-0001d340: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0001d350: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
-0001d360: 6d61 736b 2829 0a0a 2020 2020 2020 2020  mask()..        
-0001d370: 2320 4465 6669 6e65 2076 6f78 656c 2076  # Define voxel v
-0001d380: 6f6c 756d 652c 2061 6e64 2076 6f78 656c  olume, and voxel
-0001d390: 2061 7265 6120 696e 2076 6965 772e 0a20   area in view.. 
-0001d3a0: 2020 2020 2020 2076 6f78 656c 5f76 6f6c         voxel_vol
-0001d3b0: 756d 6520 3d20 310a 2020 2020 2020 2020  ume = 1.        
-0001d3c0: 666f 7220 6478 797a 2069 6e20 7365 6c66  for dxyz in self
-0001d3d0: 2e6d 6173 6b2e 766f 7865 6c5f 7369 7a65  .mask.voxel_size
-0001d3e0: 3a0a 2020 2020 2020 2020 2020 2020 766f  :.            vo
-0001d3f0: 7865 6c5f 766f 6c75 6d65 202a 3d20 6478  xel_volume *= dx
-0001d400: 797a 0a20 2020 2020 2020 207a 5f61 7820  yz.        z_ax 
-0001d410: 3d20 736b 7274 2e69 6d61 6765 2e5f 736c  = skrt.image._sl
-0001d420: 6963 655f 6178 6573 5b76 6965 775d 0a20  ice_axes[view]. 
-0001d430: 2020 2020 2020 2073 6c69 6365 5f74 6869         slice_thi
-0001d440: 636b 6e65 7373 203d 2073 656c 662e 6d61  ckness = self.ma
-0001d450: 736b 2e76 6f78 656c 5f73 697a 655b 7a5f  sk.voxel_size[z_
-0001d460: 6178 5d0a 2020 2020 2020 2020 766f 7865  ax].        voxe
-0001d470: 6c5f 6172 6561 203d 2076 6f78 656c 5f76  l_area = voxel_v
-0001d480: 6f6c 756d 6520 2f20 736c 6963 655f 7468  olume / slice_th
-0001d490: 6963 6b6e 6573 730a 0a20 2020 2020 2020  ickness..       
-0001d4a0: 2023 2047 6574 2064 6566 6175 6c74 2073   # Get default s
-0001d4b0: 6c69 6365 2061 6e64 206d 6574 686f 640a  lice and method.
-0001d4c0: 2020 2020 2020 2020 6966 2073 696e 676c          if singl
-0001d4d0: 655f 736c 6963 653a 0a20 2020 2020 2020  e_slice:.       
-0001d4e0: 2020 2020 2069 6620 736c 2069 7320 4e6f       if sl is No
-0001d4f0: 6e65 2061 6e64 2069 6478 2069 7320 4e6f  ne and idx is No
-0001d500: 6e65 2061 6e64 2070 6f73 2069 7320 4e6f  ne and pos is No
-0001d510: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0001d520: 2020 2020 6964 7820 3d20 7365 6c66 2e67      idx = self.g
-0001d530: 6574 5f6d 6964 5f69 6478 2876 6965 7729  et_mid_idx(view)
-0001d540: 0a20 2020 2020 2020 2069 6620 6d65 7468  .        if meth
-0001d550: 6f64 2069 7320 4e6f 6e65 3a0a 2020 2020  od is None:.    
-0001d560: 2020 2020 2020 2020 6d65 7468 6f64 203d          method =
-0001d570: 2073 656c 662e 6465 6661 756c 745f 6765   self.default_ge
-0001d580: 6f6d 5f6d 6574 686f 640a 0a20 2020 2020  om_method..     
-0001d590: 2020 2069 6620 666c 6174 7465 6e3a 2020     if flatten:  
-0001d5a0: 2320 466c 6174 7465 6e69 6e67 206f 6e6c  # Flattening onl
-0001d5b0: 7920 706f 7373 6962 6c65 2077 6974 6820  y possible with 
-0001d5c0: 226d 6173 6b22 0a20 2020 2020 2020 2020  "mask".         
-0001d5d0: 2020 206d 6574 686f 6420 3d20 226d 6173     method = "mas
-0001d5e0: 6b22 0a0a 2020 2020 2020 2020 2320 4361  k"..        # Ca
-0001d5f0: 6c63 756c 6174 6520 696e 7465 7273 6563  lculate intersec
-0001d600: 7469 6f6e 7320 616e 6420 6172 6561 7320  tions and areas 
-0001d610: 6672 6f6d 2070 6f6c 7967 6f6e 730a 2020  from polygons.  
-0001d620: 2020 2020 2020 6966 206d 6574 686f 6420        if method 
-0001d630: 3d3d 2022 636f 6e74 6f75 7222 3a0a 0a20  == "contour":.. 
-0001d640: 2020 2020 2020 2020 2020 2023 2047 6574             # Get
-0001d650: 2070 6f73 6974 696f 6e73 206f 6620 736c   positions of sl
-0001d660: 6963 6528 7329 0a20 2020 2020 2020 2020  ice(s).         
-0001d670: 2020 2023 206f 6e20 7768 6963 6820 746f     # on which to
-0001d680: 2063 6f6d 7061 7265 2061 7265 6173 2061   compare areas a
-0001d690: 6e64 2074 6f74 616c 2061 7265 6173 2e0a  nd total areas..
-0001d6a0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0001d6b0: 6f74 2073 696e 676c 655f 736c 6963 653a  ot single_slice:
-0001d6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d6d0: 2070 6f73 6974 696f 6e73 203d 2073 6574   positions = set
-0001d6e0: 2873 656c 662e 6765 745f 636f 6e74 6f75  (self.get_contou
-0001d6f0: 7273 2822 782d 7922 292e 6b65 7973 2829  rs("x-y").keys()
-0001d700: 292e 756e 696f 6e28 0a20 2020 2020 2020  ).union(.       
-0001d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d720: 2073 6574 286f 7468 6572 2e67 6574 5f63   set(other.get_c
-0001d730: 6f6e 746f 7572 7328 2278 2d79 2229 2e6b  ontours("x-y").k
-0001d740: 6579 7328 2929 290a 2020 2020 2020 2020  eys())).        
-0001d750: 2020 2020 2020 2020 6172 6561 7331 203d          areas1 =
-0001d760: 205b 7365 6c66 2e67 6574 5f61 7265 6128   [self.get_area(
-0001d770: 2278 2d79 222c 2070 6f73 3d70 2c20 6d65  "x-y", pos=p, me
-0001d780: 7468 6f64 3d6d 6574 686f 6429 0a20 2020  thod=method).   
+00015c00: 2020 2020 2020 2020 6e61 6d65 202b 3d20          name += 
+00015c10: 2220 286d 6d5e 3229 220a 2020 2020 2020  " (mm^2)".      
+00015c20: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00015c30: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00015c40: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00015c50: 202b 3d20 2220 2822 202b 2061 7265 615f   += " (" + area_
+00015c60: 756e 6974 7320 2b20 2229 220a 2020 2020  units + ")".    
+00015c70: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00015c80: 2022 6c65 6e67 7468 2220 696e 206d 6574   "length" in met
+00015c90: 7269 633a 0a20 2020 2020 2020 2020 2020  ric:.           
+00015ca0: 2020 2020 2020 2020 206e 616d 6520 2b3d           name +=
+00015cb0: 2022 2028 2220 2b20 6c65 6e67 7468 5f75   " (" + length_u
+00015cc0: 6e69 7473 202b 2022 2922 0a20 2020 2020  nits + ")".     
+00015cd0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00015ce0: 2263 656e 7472 6f69 6422 2069 6e20 6d65  "centroid" in me
+00015cf0: 7472 6963 3a0a 2020 2020 2020 2020 2020  tric:.          
+00015d00: 2020 2020 2020 2020 2020 6e61 6d65 202b            name +
+00015d10: 3d20 2220 2822 202b 2063 656e 7472 6f69  = " (" + centroi
+00015d20: 645f 756e 6974 7320 2b20 2229 220a 2020  d_units + ")".  
+00015d30: 2020 2020 2020 2020 2020 2020 2020 6765                ge
+00015d40: 6f6d 5f6e 616d 6564 5b6e 616d 655d 203d  om_named[name] =
+00015d50: 2076 616c 0a0a 2020 2020 2020 2020 2320   val..        # 
+00015d60: 4164 6a75 7374 206e 756d 6265 7220 6f66  Adjust number of
+00015d70: 2064 6563 696d 616c 2070 6c61 6365 730a   decimal places.
+00015d80: 2020 2020 2020 2020 6966 2064 6563 696d          if decim
+00015d90: 616c 5f70 6c61 6365 7320 6973 206e 6f74  al_places is not
+00015da0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00015db0: 2020 2066 6f72 206d 6574 7269 632c 2076     for metric, v
+00015dc0: 616c 2069 6e20 6765 6f6d 5f6e 616d 6564  al in geom_named
+00015dd0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+00015de0: 2020 2020 2020 2020 2020 666d 7420 3d20            fmt = 
+00015df0: 6622 7b7b 7661 6c3a 2e7b 6465 6369 6d61  f"{{val:.{decima
+00015e00: 6c5f 706c 6163 6573 7d66 7d7d 220a 2020  l_places}f}}".  
+00015e10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00015e20: 2067 656f 6d5f 6e61 6d65 645b 6d65 7472   geom_named[metr
+00015e30: 6963 5d20 6973 206e 6f74 204e 6f6e 653a  ic] is not None:
+00015e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015e50: 2020 2020 2067 656f 6d5f 6e61 6d65 645b       geom_named[
+00015e60: 6d65 7472 6963 5d20 3d20 666c 6f61 7428  metric] = float(
+00015e70: 666d 742e 666f 726d 6174 2876 616c 3d76  fmt.format(val=v
+00015e80: 616c 2929 0a0a 2020 2020 2020 2020 2320  al))..        # 
+00015e90: 436f 6e76 6572 7420 746f 2070 616e 6461  Convert to panda
+00015ea0: 7320 4461 7461 4672 616d 650a 2020 2020  s DataFrame.    
+00015eb0: 2020 2020 6466 203d 2070 642e 4461 7461      df = pd.Data
+00015ec0: 4672 616d 6528 6765 6f6d 5f6e 616d 6564  Frame(geom_named
+00015ed0: 2c20 696e 6465 783d 5b73 656c 662e 6e61  , index=[self.na
+00015ee0: 6d65 5d29 0a0a 2020 2020 2020 2020 2320  me])..        # 
+00015ef0: 4361 7069 7461 6c69 7a65 2063 6f6c 756d  Capitalize colum
+00015f00: 6e20 6e61 6d65 7320 616e 6420 7265 6d6f  n names and remo
+00015f10: 7665 2075 6e64 6572 7363 6f72 6573 2069  ve underscores i
+00015f20: 6620 7265 7175 6573 7465 640a 2020 2020  f requested.    
+00015f30: 2020 2020 6966 206e 6963 655f 636f 6c75      if nice_colu
+00015f40: 6d6e 7320 616e 6420 6e6f 7420 676c 6f62  mns and not glob
+00015f50: 616c 5f76 735f 736c 6963 655f 6865 6164  al_vs_slice_head
+00015f60: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00015f70: 6466 2e63 6f6c 756d 6e73 203d 205b 636f  df.columns = [co
+00015f80: 6c2e 6361 7069 7461 6c69 7a65 2829 2e72  l.capitalize().r
+00015f90: 6570 6c61 6365 2822 5f22 2c20 2220 2229  eplace("_", " ")
+00015fa0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00015fb0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00015fc0: 636f 6c20 696e 2064 662e 636f 6c75 6d6e  col in df.column
+00015fd0: 735d 0a0a 2020 2020 2020 2020 2320 5475  s]..        # Tu
+00015fe0: 726e 206e 616d 6520 696e 746f 2061 2072  rn name into a r
+00015ff0: 6567 756c 6172 2063 6f6c 756d 6e20 6966  egular column if
+00016000: 2072 6571 7565 7374 6564 0a20 2020 2020   requested.     
+00016010: 2020 2069 6620 6e6f 7420 6e61 6d65 5f61     if not name_a
+00016020: 735f 696e 6465 783a 0a20 2020 2020 2020  s_index:.       
+00016030: 2020 2020 2064 6620 3d20 6466 2e72 6573       df = df.res
+00016040: 6574 5f69 6e64 6578 2829 2e72 656e 616d  et_index().renam
+00016050: 6528 7b22 696e 6465 7822 3a20 2252 4f49  e({"index": "ROI
+00016060: 227d 2c20 6178 6973 3d31 290a 0a20 2020  "}, axis=1)..   
+00016070: 2020 2020 2023 2041 6464 2067 6c6f 6261       # Add globa
+00016080: 6c2f 736c 6963 6520 6865 6164 6572 730a  l/slice headers.
+00016090: 2020 2020 2020 2020 6966 2067 6c6f 6261          if globa
+000160a0: 6c5f 7673 5f73 6c69 6365 5f68 6561 6465  l_vs_slice_heade
+000160b0: 723a 0a0a 2020 2020 2020 2020 2020 2020  r:..            
+000160c0: 2320 536f 7274 2063 6f6c 756d 6e73 2069  # Sort columns i
+000160d0: 6e74 6f20 676c 6f62 616c 206f 7220 736c  nto global or sl
+000160e0: 6963 650a 2020 2020 2020 2020 2020 2020  ice.            
+000160f0: 6865 6164 6572 7320 3d20 5b5d 0a20 2020  headers = [].   
+00016100: 2020 2020 2020 2020 2073 6c69 6365 5f63           slice_c
+00016110: 6f6c 7320 3d20 5b5d 0a20 2020 2020 2020  ols = [].       
+00016120: 2020 2020 2067 6c6f 6261 6c5f 636f 6c73       global_cols
+00016130: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+00016140: 2020 736c 6963 655f 6e61 6d65 203d 2022    slice_name = "
+00016150: 736c 6963 6522 2069 6620 6e6f 7420 6e69  slice" if not ni
+00016160: 6365 5f63 6f6c 756d 6e73 2065 6c73 6520  ce_columns else 
+00016170: 2253 6c69 6365 220a 2020 2020 2020 2020  "Slice".        
+00016180: 2020 2020 676c 6f62 616c 5f6e 616d 6520      global_name 
+00016190: 3d20 2267 6c6f 6261 6c22 2069 6620 6e6f  = "global" if no
+000161a0: 7420 6e69 6365 5f63 6f6c 756d 6e73 2065  t nice_columns e
+000161b0: 6c73 6520 2247 6c6f 6261 6c22 0a20 2020  lse "Global".   
+000161c0: 2020 2020 2020 2020 2066 6f72 206d 6574           for met
+000161d0: 7269 6320 696e 2067 656f 6d5f 6e61 6d65  ric in geom_name
+000161e0: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+000161f0: 2020 206e 616d 6520 3d20 6d65 7472 6963     name = metric
+00016200: 2069 6620 6e6f 7420 6e69 6365 5f63 6f6c   if not nice_col
+00016210: 756d 6e73 2065 6c73 6520 5c0a 2020 2020  umns else \.    
+00016220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016230: 2020 2020 6d65 7472 6963 2e63 6170 6974      metric.capit
+00016240: 616c 697a 6528 292e 7265 706c 6163 6528  alize().replace(
+00016250: 225f 222c 2022 2229 0a20 2020 2020 2020  "_", "").       
+00016260: 2020 2020 2020 2020 2069 6620 2261 7265           if "are
+00016270: 6122 2069 6e20 6d65 7472 6963 206f 7220  a" in metric or 
+00016280: 2273 6c69 6365 2220 696e 206d 6574 7269  "slice" in metri
+00016290: 633a 0a20 2020 2020 2020 2020 2020 2020  c:.             
+000162a0: 2020 2020 2020 2068 6561 6465 7273 2e61         headers.a
+000162b0: 7070 656e 6428 2873 6c69 6365 5f6e 616d  ppend((slice_nam
+000162c0: 652c 206d 6574 7269 6329 290a 2020 2020  e, metric)).    
+000162d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000162e0: 736c 6963 655f 636f 6c73 2e61 7070 656e  slice_cols.appen
+000162f0: 6428 6d65 7472 6963 290a 2020 2020 2020  d(metric).      
+00016300: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00016310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016320: 2020 2020 6865 6164 6572 732e 6170 7065      headers.appe
+00016330: 6e64 2828 676c 6f62 616c 5f6e 616d 652c  nd((global_name,
+00016340: 206d 6574 7269 6329 290a 2020 2020 2020   metric)).      
+00016350: 2020 2020 2020 2020 2020 2020 2020 676c                gl
+00016360: 6f62 616c 5f63 6f6c 732e 6170 7065 6e64  obal_cols.append
+00016370: 286d 6574 7269 6329 0a0a 2020 2020 2020  (metric)..      
+00016380: 2020 2020 2020 2320 5265 6f72 6465 7220        # Reorder 
+00016390: 636f 6c75 6d6e 730a 2020 2020 2020 2020  columns.        
+000163a0: 2020 2020 6466 735f 6f72 6465 7265 6420      dfs_ordered 
+000163b0: 3d20 5b64 665b 676c 6f62 616c 5f63 6f6c  = [df[global_col
+000163c0: 735d 2c20 6466 5b73 6c69 6365 5f63 6f6c  s], df[slice_col
+000163d0: 735d 5d0a 2020 2020 2020 2020 2020 2020  s]].            
+000163e0: 6966 206e 6f74 206e 616d 655f 6173 5f69  if not name_as_i
+000163f0: 6e64 6578 3a0a 2020 2020 2020 2020 2020  ndex:.          
+00016400: 2020 2020 2020 6466 735f 6f72 6465 7265        dfs_ordere
+00016410: 642e 696e 7365 7274 2830 2c20 6466 5b22  d.insert(0, df["
+00016420: 524f 4922 5d29 0a20 2020 2020 2020 2020  ROI"]).         
+00016430: 2020 2064 6620 3d20 7064 2e63 6f6e 6361     df = pd.conca
+00016440: 7428 6466 735f 6f72 6465 7265 642c 2061  t(dfs_ordered, a
+00016450: 7869 733d 3129 0a0a 2020 2020 2020 2020  xis=1)..        
+00016460: 2020 2020 2320 536f 7274 2068 6561 6465      # Sort heade
+00016470: 7273 2062 7920 676c 6f62 616c 2f73 6c69  rs by global/sli
+00016480: 6365 0a20 2020 2020 2020 2020 2020 2068  ce.            h
+00016490: 6561 6465 7273 203d 205b 6820 666f 7220  eaders = [h for 
+000164a0: 6820 696e 2068 6561 6465 7273 2069 6620  h in headers if 
+000164b0: 685b 305d 203d 3d20 676c 6f62 616c 5f6e  h[0] == global_n
+000164c0: 616d 655d 205c 0a20 2020 2020 2020 2020  ame] \.         
+000164d0: 2020 2020 2020 2020 2020 202b 205b 6820             + [h 
+000164e0: 666f 7220 6820 696e 2068 6561 6465 7273  for h in headers
+000164f0: 2069 6620 685b 305d 203d 3d20 736c 6963   if h[0] == slic
+00016500: 655f 6e61 6d65 5d0a 2020 2020 2020 2020  e_name].        
+00016510: 2020 2020 6966 206e 6f74 206e 616d 655f      if not name_
+00016520: 6173 5f69 6e64 6578 3a0a 2020 2020 2020  as_index:.      
+00016530: 2020 2020 2020 2020 2020 6865 6164 6572            header
+00016540: 732e 696e 7365 7274 2830 2c20 2822 222c  s.insert(0, ("",
+00016550: 2022 524f 4922 2929 0a0a 2020 2020 2020   "ROI"))..      
+00016560: 2020 2020 2020 2320 4164 6420 4d75 6c74        # Add Mult
+00016570: 6949 6e64 6578 0a20 2020 2020 2020 2020  iIndex.         
+00016580: 2020 2064 662e 636f 6c75 6d6e 7320 3d20     df.columns = 
+00016590: 7064 2e4d 756c 7469 496e 6465 782e 6672  pd.MultiIndex.fr
+000165a0: 6f6d 5f74 7570 6c65 7328 6865 6164 6572  om_tuples(header
+000165b0: 7329 0a0a 2020 2020 2020 2020 6966 2068  s)..        if h
+000165c0: 746d 6c3a 0a20 2020 2020 2020 2020 2020  tml:.           
+000165d0: 2072 6574 7572 6e20 6466 5f74 6f5f 6874   return df_to_ht
+000165e0: 6d6c 2864 6629 0a20 2020 2020 2020 2072  ml(df).        r
+000165f0: 6574 7572 6e20 6466 0a0a 2020 2020 6465  eturn df..    de
+00016600: 6620 6765 745f 6365 6e74 726f 6964 5f64  f get_centroid_d
+00016610: 6973 7461 6e63 6528 7365 6c66 2c20 726f  istance(self, ro
+00016620: 692c 2073 696e 676c 655f 736c 6963 653d  i, single_slice=
+00016630: 4661 6c73 652c 2076 6965 773d 2278 2d79  False, view="x-y
+00016640: 222c 0a20 2020 2020 2020 2020 2020 2073  ",.            s
+00016650: 6c3d 4e6f 6e65 2c20 6964 783d 4e6f 6e65  l=None, idx=None
+00016660: 2c20 706f 733d 4e6f 6e65 2c20 756e 6974  , pos=None, unit
+00016670: 733d 226d 6d22 2c20 6d65 7468 6f64 3d4e  s="mm", method=N
+00016680: 6f6e 652c 2066 6f72 6365 3d54 7275 652c  one, force=True,
+00016690: 0a20 2020 2020 2020 2020 2020 2062 795f  .            by_
+000166a0: 736c 6963 653d 4e6f 6e65 2c20 7661 6c75  slice=None, valu
+000166b0: 655f 666f 725f 6e6f 6e65 3d4e 6f6e 652c  e_for_none=None,
+000166c0: 2073 6c69 6365 5f73 7461 743d 4e6f 6e65   slice_stat=None
+000166d0: 2c0a 2020 2020 2020 2020 2020 2020 2a2a  ,.            **
+000166e0: 736c 6963 655f 7374 6174 5f6b 7761 7267  slice_stat_kwarg
+000166f0: 7329 3a0a 2020 2020 2020 2020 2222 2247  s):.        """G
+00016700: 6574 2063 656e 7472 6f69 6420 6469 7370  et centroid disp
+00016710: 6c61 6365 6d65 6e74 2076 6563 746f 7220  lacement vector 
+00016720: 7769 7468 2072 6573 7065 6374 2074 6f20  with respect to 
+00016730: 616e 6f74 6865 7220 524f 492e 0a0a 2020  another ROI...  
+00016740: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+00016750: 7273 3a2a 2a0a 2020 2020 2020 2020 0a20  rs:**.        . 
+00016760: 2020 2020 2020 2072 6f69 203a 2052 4f49         roi : ROI
+00016770: 0a20 2020 2020 2020 2020 2020 204f 7468  .            Oth
+00016780: 6572 2052 4f49 2077 6974 6820 7768 6963  er ROI with whic
+00016790: 6820 746f 2063 6f6d 7061 7265 2063 656e  h to compare cen
+000167a0: 7472 6f69 642e 0a0a 2020 2020 2020 2020  troid...        
+000167b0: 7369 6e67 6c65 5f73 6c69 6365 203a 2062  single_slice : b
+000167c0: 6f6f 6c2c 2064 6566 6175 6c74 3d46 616c  ool, default=Fal
+000167d0: 7365 0a20 2020 2020 2020 2020 2020 2049  se.            I
+000167e0: 6620 5472 7565 2c20 7468 6520 6365 6e74  f True, the cent
+000167f0: 726f 6964 2077 696c 6c20 6265 2072 6574  roid will be ret
+00016800: 7572 6e65 6420 666f 7220 6120 7369 6e67  urned for a sing
+00016810: 6c65 2073 6c69 6365 2e0a 0a20 2020 2020  le slice...     
+00016820: 2020 2076 6965 7720 3a20 7374 722c 2064     view : str, d
+00016830: 6566 6175 6c74 3d22 782d 7922 0a20 2020  efault="x-y".   
+00016840: 2020 2020 2020 2020 204f 7269 656e 7461           Orienta
+00016850: 7469 6f6e 2069 6e20 7768 6963 6820 746f  tion in which to
+00016860: 2067 6574 2063 656e 7472 6f69 6473 2069   get centroids i
+00016870: 6620 7573 696e 6720 6120 7369 6e67 6c65  f using a single
+00016880: 2073 6c69 6365 206f 720a 2020 2020 2020   slice or.      
+00016890: 2020 2020 2020 666c 6174 7465 6e69 6e67        flattening
+000168a0: 2e0a 0a20 2020 2020 2020 2066 6c61 7474  ...        flatt
+000168b0: 656e 203a 2062 6f6f 6c2c 2064 6566 6175  en : bool, defau
+000168c0: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
+000168d0: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
+000168e0: 6520 3344 2063 656e 7472 6f69 6420 7769  e 3D centroid wi
+000168f0: 6c6c 2062 6520 6f62 7461 696e 6564 2061  ll be obtained a
+00016900: 6e64 2074 6865 6e20 7468 6520 6162 736f  nd then the abso
+00016910: 6c75 7465 200a 2020 2020 2020 2020 2020  lute .          
+00016920: 2020 7661 6c75 6520 616c 6f6e 6720 6f6e    value along on
+00016930: 6c79 2074 6865 2032 4420 6178 6573 2069  ly the 2D axes i
+00016940: 6e20 7468 6520 6f72 6965 6e74 6174 696f  n the orientatio
+00016950: 6e20 696e 203c 7669 6577 3e20 7769 6c6c  n in <view> will
+00016960: 0a20 2020 2020 2020 2020 2020 2062 6520  .            be 
+00016970: 7265 7475 726e 6564 2e0a 0a20 2020 2020  returned...     
+00016980: 2020 2073 6c20 3a20 696e 742c 2064 6566     sl : int, def
+00016990: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+000169a0: 2020 2020 2020 536c 6963 6520 6e75 6d62        Slice numb
+000169b0: 6572 2e20 4966 206e 6f6e 6520 6f66 203c  er. If none of <
+000169c0: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
+000169d0: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
+000169e0: 2062 7574 0a20 2020 2020 2020 2020 2020   but.           
+000169f0: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
+00016a00: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
+00016a10: 7472 616c 2073 6c69 6365 206f 6620 6561  tral slice of ea
+00016a20: 6368 2052 4f49 0a20 2020 2020 2020 2020  ch ROI.         
+00016a30: 2020 2077 696c 6c20 6265 2075 7365 642e     will be used.
+00016a40: 0a0a 2020 2020 2020 2020 6964 7820 3a20  ..        idx : 
+00016a50: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
+00016a60: 650a 2020 2020 2020 2020 2020 2020 4172  e.            Ar
+00016a70: 7261 7920 696e 6465 7820 6f66 2073 6c69  ray index of sli
+00016a80: 6365 2e20 4966 206e 6f6e 6520 6f66 203c  ce. If none of <
+00016a90: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
+00016aa0: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
+00016ab0: 0a20 2020 2020 2020 2020 2020 2062 7574  .            but
+00016ac0: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
+00016ad0: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
+00016ae0: 7472 616c 2073 6c69 6365 206f 6620 6561  tral slice of ea
+00016af0: 6368 2052 4f49 0a20 2020 2020 2020 2020  ch ROI.         
+00016b00: 2020 2077 696c 6c20 6265 2075 7365 642e     will be used.
+00016b10: 0a0a 2020 2020 2020 2020 706f 7320 3a20  ..        pos : 
+00016b20: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+00016b30: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00016b40: 536c 6963 6520 706f 7369 7469 6f6e 2069  Slice position i
+00016b50: 6e20 6d6d 2e20 4966 206e 6f6e 6520 6f66  n mm. If none of
+00016b60: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
+00016b70: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
+00016b80: 6564 0a20 2020 2020 2020 2020 2020 2062  ed.            b
+00016b90: 7574 203c 7369 6e67 6c65 5f73 6c69 6365  ut <single_slice
+00016ba0: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
+00016bb0: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
+00016bc0: 6561 6368 2052 4f49 0a20 2020 2020 2020  each ROI.       
+00016bd0: 2020 2020 2077 696c 6c20 6265 2075 7365       will be use
+00016be0: 642e 0a0a 2020 2020 2020 2020 756e 6974  d...        unit
+00016bf0: 7320 3a20 7374 722c 2064 6566 6175 6c74  s : str, default
+00016c00: 3d22 6d6d 220a 2020 2020 2020 2020 2020  ="mm".          
+00016c10: 2020 556e 6974 7320 6f66 2061 6273 6f6c    Units of absol
+00016c20: 7574 6520 6365 6e74 726f 6964 2064 6973  ute centroid dis
+00016c30: 7461 6e63 652e 2043 616e 2062 6520 616e  tance. Can be an
+00016c40: 7920 6f66 3a0a 2020 2020 2020 2020 2020  y of:.          
+00016c50: 2020 2020 2020 2d20 226d 6d22 3a20 7265        - "mm": re
+00016c60: 7475 726e 2063 656e 7472 6f69 6420 706f  turn centroid po
+00016c70: 7369 7469 6f6e 2069 6e20 6d69 6c6c 696d  sition in millim
+00016c80: 6574 7265 732e 0a20 2020 2020 2020 2020  etres..         
+00016c90: 2020 2020 2020 202d 2022 766f 7865 6c73         - "voxels
+00016ca0: 223a 2072 6574 7572 6e20 6365 6e74 726f  ": return centro
+00016cb0: 6964 2070 6f73 6974 696f 6e20 696e 2074  id position in t
+00016cc0: 6572 6d73 206f 6620 6172 7261 7920 696e  erms of array in
+00016cd0: 6469 6365 732e 0a20 2020 2020 2020 2020  dices..         
+00016ce0: 2020 2020 2020 202d 2022 736c 6963 6522         - "slice"
+00016cf0: 3a20 7265 7475 726e 2063 656e 7472 6f69  : return centroi
+00016d00: 6420 706f 7369 7469 6f6e 2069 6e20 7465  d position in te
+00016d10: 726d 7320 6f66 2073 6c69 6365 206e 756d  rms of slice num
+00016d20: 6265 7273 2e0a 0a20 2020 2020 2020 2020  bers...         
+00016d30: 2020 2049 6620 756e 6974 733d 2276 6f78     If units="vox
+00016d40: 656c 7322 206f 7220 2273 6c69 6365 2220  els" or "slice" 
+00016d50: 6973 2072 6571 7565 7374 6564 2062 7574  is requested but
+00016d60: 2065 6974 6865 7220 524f 4920 6f6e 6c79   either ROI only
+00016d70: 2068 6173 200a 2020 2020 2020 2020 2020   has .          
+00016d80: 2020 636f 6e74 6f75 7273 2061 6e64 206e    contours and n
+00016d90: 6f20 6d61 736b 2073 6861 7065 2f76 6f78  o mask shape/vox
+00016da0: 656c 2073 697a 6520 696e 666f 726d 6174  el size informat
+00016db0: 696f 6e2c 2061 6e20 6572 726f 7220 7769  ion, an error wi
+00016dc0: 6c6c 2062 6520 0a20 2020 2020 2020 2020  ll be .         
+00016dd0: 2020 2072 6169 7365 6420 2875 6e6c 6573     raised (unles
+00016de0: 7320 6178 3d22 7a22 2c20 696e 2077 6869  s ax="z", in whi
+00016df0: 6368 2063 6173 6520 766f 7865 6c20 7369  ch case voxel si
+00016e00: 7a65 2077 696c 6c20 6265 2069 6e66 6572  ze will be infer
+00016e10: 7265 6420 0a20 2020 2020 2020 2020 2020  red .           
+00016e20: 2066 726f 6d20 7370 6163 696e 6720 6265   from spacing be
+00016e30: 7477 6565 6e20 736c 6963 6573 292e 0a0a  tween slices)...
+00016e40: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
+00016e50: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
+00016e60: 6e65 0a20 2020 2020 2020 2020 2020 204d  ne.            M
+00016e70: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
+00016e80: 2063 656e 7472 6f69 6420 6361 6c63 756c   centroid calcul
+00016e90: 6174 696f 6e2e 2043 616e 2062 653a 200a  ation. Can be: .
+00016ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016eb0: 2d20 2263 6f6e 746f 7572 223a 2067 6574  - "contour": get
+00016ec0: 2063 656e 7472 6f69 6420 6f66 2073 6861   centroid of sha
+00016ed0: 7065 6c79 2063 6f6e 746f 7572 2873 292e  pely contour(s).
+00016ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016ef0: 202d 2022 6d61 736b 223a 2067 6574 2061   - "mask": get a
+00016f00: 7665 7261 6765 2070 6f73 6974 696f 6e20  verage position 
+00016f10: 6f66 2076 6f78 656c 7320 696e 2062 696e  of voxels in bin
+00016f20: 6172 7920 6d61 736b 2e0a 2020 2020 2020  ary mask..      
+00016f30: 2020 2020 2020 2020 2020 2d20 4e6f 6e65            - None
+00016f40: 3a20 7573 6520 7468 6520 6d65 7468 6f64  : use the method
+00016f50: 2073 6574 2069 6e20 7365 6c66 2e64 6566   set in self.def
+00016f60: 6175 6c74 5f67 656f 6d5f 6d65 7468 6f64  ault_geom_method
+00016f70: 2e0a 0a20 2020 2020 2020 2066 6f72 6365  ...        force
+00016f80: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+00016f90: 3d54 7275 650a 2020 2020 2020 2020 2020  =True.          
+00016fa0: 2020 4966 2054 7275 652c 2074 6865 2067    If True, the g
+00016fb0: 6c6f 6261 6c20 6365 6e74 726f 6964 2077  lobal centroid w
+00016fc0: 696c 6c20 616c 7761 7973 2062 6520 7265  ill always be re
+00016fd0: 6361 6c63 756c 6174 6564 3b20 0a20 2020  calculated; .   
+00016fe0: 2020 2020 2020 2020 206f 7468 6572 7769           otherwi
+00016ff0: 7365 2c20 6974 2077 696c 6c20 6f6e 6c79  se, it will only
+00017000: 2062 6520 6361 6c63 756c 6174 6564 2069   be calculated i
+00017010: 6620 6974 2068 6173 206e 6f74 2079 6574  f it has not yet
+00017020: 2062 6565 6e20 6361 6368 6564 200a 2020   been cached .  
+00017030: 2020 2020 2020 2020 2020 696e 2073 656c            in sel
+00017040: 662e 5f76 6f6c 756d 652e 2020 4e6f 7465  f._volume.  Note
+00017050: 2074 6861 7420 6966 2073 696e 676c 655f   that if single_
+00017060: 736c 6963 653d 5472 7565 2c20 7468 6520  slice=True, the 
+00017070: 6365 6e74 726f 6964 2077 696c 6c20 0a20  centroid will . 
+00017080: 2020 2020 2020 2020 2020 2061 6c77 6179             alway
+00017090: 7320 6265 2072 6563 616c 6375 6c61 7465  s be recalculate
+000170a0: 642e 0a0a 2020 2020 2020 2020 6279 5f73  d...        by_s
+000170b0: 6c69 6365 203a 2073 7472 2c20 6465 6661  lice : str, defa
+000170c0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+000170d0: 2020 2020 2049 6620 6f6e 6520 6f66 2022       If one of "
+000170e0: 6c65 6674 222c 2022 7269 6768 7422 2c20  left", "right", 
+000170f0: 2275 6e69 6f6e 222c 2022 696e 7465 7273  "union", "inters
+00017100: 6563 7469 6f6e 222c 2063 616c 6375 6c61  ection", calcula
+00017110: 7465 0a20 2020 2020 2020 2020 2020 2044  te.            D
+00017120: 6963 6520 7363 6f72 6573 2073 6c69 6365  ice scores slice
+00017130: 2062 7920 736c 6963 6520 666f 7220 6561   by slice for ea
+00017140: 6368 2073 6c69 6365 2063 6f6e 7461 696e  ch slice contain
+00017150: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+00017160: 7365 6c66 2061 6e64 2f6f 7220 6f74 6865  self and/or othe
+00017170: 723a 0a0a 2020 2020 2020 2020 2020 2020  r:..            
+00017180: 2d20 226c 6566 7422 3a20 636f 6e73 6964  - "left": consid
+00017190: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
+000171a0: 6f6e 7461 696e 696e 6720 7365 6c66 3b0a  ontaining self;.
+000171b0: 2020 2020 2020 2020 2020 2020 2d20 2272              - "r
+000171c0: 6967 6874 223a 2063 6f6e 7369 6465 7220  ight": consider 
+000171d0: 6f6e 6c79 2073 6c69 6365 7320 636f 6e74  only slices cont
+000171e0: 6169 6e69 6e67 206f 7468 6572 3b0a 2020  aining other;.  
+000171f0: 2020 2020 2020 2020 2020 2d20 2275 6e69            - "uni
+00017200: 6f6e 223a 2063 6f6e 7369 6465 7220 736c  on": consider sl
+00017210: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
+00017220: 6569 7468 6572 206f 6620 7365 6c66 2061  either of self a
+00017230: 6e64 206f 7468 6572 3b0a 2020 2020 2020  nd other;.      
+00017240: 2020 2020 2020 2d20 2269 6e74 6572 7365        - "interse
+00017250: 6374 696f 6e22 3a20 636f 6e73 6964 6572  ction": consider
+00017260: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
+00017270: 6e67 2062 6f74 6820 6f66 2073 656c 6620  ng both of self 
+00017280: 616e 6420 6f74 6865 722e 0a0a 2020 2020  and other...    
+00017290: 2020 2020 2020 2020 4966 2073 6c69 6365          If slice
+000172a0: 5f73 7461 7420 6973 204e 6f6e 652c 2072  _stat is None, r
+000172b0: 6574 7572 6e20 6120 6469 6374 696f 6e61  eturn a dictiona
+000172c0: 7279 2077 6865 7265 206b 6579 7320 6172  ry where keys ar
+000172d0: 650a 2020 2020 2020 2020 2020 2020 736c  e.            sl
+000172e0: 6963 6520 706f 7369 7469 6f6e 7320 616e  ice positions an
+000172f0: 6420 7661 6c75 6573 2061 7265 2074 6865  d values are the
+00017300: 2063 616c 6375 6c61 7465 6420 4469 6365   calculated Dice
+00017310: 2073 636f 7265 732e 0a20 2020 2020 2020   scores..       
+00017320: 2020 2020 204f 7468 6572 7769 7365 2c20       Otherwise, 
+00017330: 7265 7475 726e 2066 6f72 2074 6865 2063  return for the c
+00017340: 616c 6375 6c61 7465 6420 4469 6365 2073  alculated Dice s
+00017350: 636f 7265 7320 7468 6520 7374 6174 6973  cores the statis
+00017360: 7469 630a 2020 2020 2020 2020 2020 2020  tic.            
+00017370: 7370 6563 6966 6965 6420 6279 2073 6c69  specified by sli
+00017380: 6365 5f73 7461 742e 0a0a 2020 2020 2020  ce_stat...      
+00017390: 2020 7661 6c75 655f 666f 725f 6e6f 6e65    value_for_none
+000173a0: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
+000173b0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+000173c0: 2020 2046 6f72 2073 696e 676c 655f 736c     For single_sl
+000173d0: 6963 6520 616e 6420 6279 5f73 6c69 6365  ice and by_slice
+000173e0: 2c20 7661 6c75 6520 746f 2062 6520 7265  , value to be re
+000173f0: 7475 726e 6564 2066 6f72 0a20 2020 2020  turned for.     
+00017400: 2020 2020 2020 2073 6c69 6365 7320 7768         slices wh
+00017410: 6572 6520 4469 6365 2073 636f 7265 2069  ere Dice score i
+00017420: 7320 756e 6465 7465 726d 696e 6564 2028  s undetermined (
+00017430: 4e6f 6e65 292e 2020 466f 7220 736c 6963  None).  For slic
+00017440: 655f 7374 6174 2c0a 2020 2020 2020 2020  e_stat,.        
+00017450: 2020 2020 7661 6c75 6520 746f 2073 7562      value to sub
+00017460: 7374 6974 7574 6520 666f 7220 616e 7920  stitute for any 
+00017470: 4e6f 6e65 2076 616c 7565 7320 616d 6f6e  None values amon
+00017480: 6720 7468 6520 696e 7075 7473 0a20 2020  g the inputs.   
+00017490: 2020 2020 2020 2020 2066 6f72 2063 616c           for cal
+000174a0: 6375 6c61 7469 6e67 2073 6c69 6365 2d62  culating slice-b
+000174b0: 6173 6564 2073 7461 7469 7374 6963 2e20  ased statistic. 
+000174c0: 2049 6620 4e6f 6e65 2069 6e20 7468 6520   If None in the 
+000174d0: 6c61 7474 6572 0a20 2020 2020 2020 2020  latter.         
+000174e0: 2020 2063 6173 652c 204e 6f6e 6520 7661     case, None va
+000174f0: 6c75 6573 2061 6d6f 6e67 2074 6865 2069  lues among the i
+00017500: 6e70 7574 7320 6172 6520 6f6d 6974 7465  nputs are omitte
+00017510: 642e 0a0a 2020 2020 2020 2020 736c 6963  d...        slic
+00017520: 655f 7374 6174 203a 2073 7472 2c20 6465  e_stat : str, de
+00017530: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00017540: 2020 2020 2020 2053 696e 676c 652d 7661         Single-va
+00017550: 7269 6162 6c65 2073 7461 7469 7374 6963  riable statistic
+00017560: 2873 2920 746f 2062 6520 7265 7475 726e  (s) to be return
+00017570: 6564 2066 6f72 2073 6c69 6365 2d62 792d  ed for slice-by-
+00017580: 736c 6963 650a 2020 2020 2020 2020 2020  slice.          
+00017590: 2020 4469 6365 2073 636f 7265 732e 2020    Dice scores.  
+000175a0: 5468 6973 2073 686f 756c 6420 6265 2074  This should be t
+000175b0: 6865 206e 616d 6520 6f66 2074 6865 2066  he name of the f
+000175c0: 756e 6374 696f 6e20 666f 720a 2020 2020  unction for.    
+000175d0: 2020 2020 2020 2020 6361 6c63 756c 6174          calculat
+000175e0: 696f 6e20 6f66 2074 6865 2073 7461 7469  ion of the stati
+000175f0: 7374 6963 2873 2920 696e 2074 6865 2050  stic(s) in the P
+00017600: 7974 686f 6e20 7374 6174 6973 7469 6373  ython statistics
+00017610: 206d 6f64 756c 653a 0a0a 2020 2020 2020   module:..      
+00017620: 2020 2020 2020 6874 7470 733a 2f2f 646f        https://do
+00017630: 6373 2e70 7974 686f 6e2e 6f72 672f 332f  cs.python.org/3/
+00017640: 6c69 6272 6172 792f 7374 6174 6973 7469  library/statisti
+00017650: 6373 2e68 746d 6c0a 0a20 2020 2020 2020  cs.html..       
+00017660: 2020 2020 2041 7661 696c 6162 6c65 206f       Available o
+00017670: 7074 696f 6e73 2069 6e63 6c75 6465 3a20  ptions include: 
+00017680: 226d 6561 6e22 2c20 226d 6564 6961 6e22  "mean", "median"
+00017690: 2c20 226d 6f64 6522 2c0a 2020 2020 2020  , "mode",.      
+000176a0: 2020 2020 2020 2273 7464 6576 222c 2022        "stdev", "
+000176b0: 7175 616e 7469 6c65 7322 2e20 2044 6973  quantiles".  Dis
+000176c0: 7265 6761 7264 6564 2069 6620 4e6f 6e65  regarded if None
+000176d0: 2e0a 0a20 2020 2020 2020 2020 2020 2049  ...            I
+000176e0: 6620 6279 5f73 6c69 6365 2069 7320 4e6f  f by_slice is No
+000176f0: 6e65 2061 6e64 2073 6c69 6365 5f73 7461  ne and slice_sta
+00017700: 7420 6973 2064 6966 6665 7265 6e74 2066  t is different f
+00017710: 726f 6d20 4e6f 6e65 2c0a 2020 2020 2020  rom None,.      
+00017720: 2020 2020 2020 736b 7274 2e63 6f72 652e        skrt.core.
+00017730: 4465 6661 756c 7473 2829 2e62 795f 736c  Defaults().by_sl
+00017740: 6963 6520 6973 2075 7365 6420 666f 7220  ice is used for 
+00017750: 7468 6520 666f 726d 6572 2e0a 0a20 2020  the former...   
+00017760: 2020 2020 2073 6c69 6365 5f73 7461 745f       slice_stat_
+00017770: 6b77 6172 6773 203a 2064 6963 742c 2064  kwargs : dict, d
+00017780: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00017790: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
+000177a0: 6172 6775 6d65 6e74 7320 746f 2062 6520  arguments to be 
+000177b0: 7061 7373 6564 2074 6f20 6675 6e63 7469  passed to functi
+000177c0: 6f6e 206f 6620 7374 6174 6973 7469 6373  on of statistics
+000177d0: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
+000177e0: 756c 6520 666f 7220 6361 6c63 756c 6174  ule for calculat
+000177f0: 696f 6e20 7265 6c61 7469 7665 2074 6f20  ion relative to 
+00017800: 736c 6963 6520 7661 6c75 6573 2e20 2046  slice values.  F
+00017810: 6f72 2065 7861 6d70 6c65 2c0a 2020 2020  or example,.    
+00017820: 2020 2020 2020 2020 6966 2071 7561 6e74          if quant
+00017830: 696c 6573 2061 7265 2072 6571 7569 7265  iles are require
+00017840: 6420 666f 7220 3130 2069 6e74 6572 7661  d for 10 interva
+00017850: 6c73 2c20 7261 7468 6572 2074 6861 6e20  ls, rather than 
+00017860: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+00017870: 7468 6520 6465 6661 756c 7420 6f66 2034  the default of 4
+00017880: 2c20 7468 6973 2063 616e 2062 6520 7370  , this can be sp
+00017890: 6563 6966 6965 6420 7573 696e 673a 0a0a  ecified using:..
+000178a0: 2020 2020 2020 2020 2020 2020 736c 6963              slic
+000178b0: 655f 7374 6174 5f6b 7761 7267 737b 226e  e_stat_kwargs{"n
+000178c0: 2220 3a20 3130 7d0a 0a20 2020 2020 2020  " : 10}..       
+000178d0: 2020 2020 2046 6f72 2061 7661 696c 6162       For availab
+000178e0: 6c65 206b 6579 776f 7264 206f 7074 696f  le keyword optio
+000178f0: 6e73 2c20 7365 6520 646f 6375 6d65 6e74  ns, see document
+00017900: 6174 696f 6e20 6f66 2073 7461 7469 7374  ation of statist
+00017910: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
+00017920: 6d6f 6475 6c65 2061 743a 0a0a 2020 2020  module at:..    
+00017930: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
+00017940: 646f 6373 2e70 7974 686f 6e2e 6f72 672f  docs.python.org/
+00017950: 332f 6c69 6272 6172 792f 7374 6174 6973  3/library/statis
+00017960: 7469 6373 2e68 746d 6c0a 2020 2020 2020  tics.html.      
+00017970: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+00017980: 2073 6c69 6365 5f73 7461 743a 0a20 2020   slice_stat:.   
+00017990: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000179a0: 7365 6c66 2e67 6574 5f73 6c69 6365 5f73  self.get_slice_s
+000179b0: 7461 7428 726f 692c 2022 6365 6e74 726f  tat(roi, "centro
+000179c0: 6964 222c 2073 6c69 6365 5f73 7461 742c  id", slice_stat,
+000179d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000179e0: 2020 2020 2062 795f 736c 6963 652c 2076       by_slice, v
+000179f0: 616c 7565 5f66 6f72 5f6e 6f6e 652c 2076  alue_for_none, v
+00017a00: 6965 772c 206d 6574 686f 642c 0a20 2020  iew, method,.   
+00017a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a20: 202a 2a28 736c 6963 655f 7374 6174 5f6b   **(slice_stat_k
+00017a30: 7761 7267 7320 6f72 207b 7d29 290a 0a20  wargs or {})).. 
+00017a40: 2020 2020 2020 2069 6620 6279 5f73 6c69         if by_sli
+00017a50: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+00017a60: 7265 7475 726e 2073 656c 662e 6765 745f  return self.get_
+00017a70: 6d65 7472 6963 5f62 795f 736c 6963 6528  metric_by_slice(
+00017a80: 726f 692c 2022 6365 6e74 726f 6964 222c  roi, "centroid",
+00017a90: 2062 795f 736c 6963 652c 0a20 2020 2020   by_slice,.     
+00017aa0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00017ab0: 6965 772c 206d 6574 686f 6429 0a0a 2020  iew, method)..  
+00017ac0: 2020 2020 2020 7468 6973 5f63 656e 7472        this_centr
+00017ad0: 6f69 6420 3d20 6e70 2e61 7272 6179 2873  oid = np.array(s
+00017ae0: 656c 662e 6765 745f 6365 6e74 726f 6964  elf.get_centroid
+00017af0: 280a 2020 2020 2020 2020 2020 2020 7369  (.            si
+00017b00: 6e67 6c65 5f73 6c69 6365 3d73 696e 676c  ngle_slice=singl
+00017b10: 655f 736c 6963 652c 2076 6965 773d 7669  e_slice, view=vi
+00017b20: 6577 2c20 736c 3d73 6c2c 2069 6478 3d69  ew, sl=sl, idx=i
+00017b30: 6478 2c20 706f 733d 706f 732c 0a20 2020  dx, pos=pos,.   
+00017b40: 2020 2020 2020 2020 2075 6e69 7473 3d75           units=u
+00017b50: 6e69 7473 2c20 6d65 7468 6f64 3d6d 6574  nits, method=met
+00017b60: 686f 642c 2066 6f72 6365 3d66 6f72 6365  hod, force=force
+00017b70: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+00017b80: 2020 2020 6f74 6865 725f 6365 6e74 726f      other_centro
+00017b90: 6964 203d 206e 702e 6172 7261 7928 726f  id = np.array(ro
+00017ba0: 692e 6765 745f 6365 6e74 726f 6964 280a  i.get_centroid(.
+00017bb0: 2020 2020 2020 2020 2020 2020 7369 6e67              sing
+00017bc0: 6c65 5f73 6c69 6365 3d73 696e 676c 655f  le_slice=single_
+00017bd0: 736c 6963 652c 2076 6965 773d 7669 6577  slice, view=view
+00017be0: 2c20 736c 3d73 6c2c 2069 6478 3d69 6478  , sl=sl, idx=idx
+00017bf0: 2c20 706f 733d 706f 732c 0a20 2020 2020  , pos=pos,.     
+00017c00: 2020 2020 2020 2075 6e69 7473 3d75 6e69         units=uni
+00017c10: 7473 2c20 6d65 7468 6f64 3d6d 6574 686f  ts, method=metho
+00017c20: 642c 2066 6f72 6365 3d66 6f72 6365 290a  d, force=force).
+00017c30: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00017c40: 2020 6966 204e 6f6e 6520 696e 2074 6869    if None in thi
+00017c50: 735f 6365 6e74 726f 6964 206f 7220 4e6f  s_centroid or No
+00017c60: 6e65 2069 6e20 6f74 6865 725f 6365 6e74  ne in other_cent
+00017c70: 726f 6964 3a0a 2020 2020 2020 2020 2020  roid:.          
+00017c80: 2020 6966 2073 696e 676c 655f 736c 6963    if single_slic
+00017c90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00017ca0: 2020 2072 6574 7572 6e20 6e70 2e61 7272     return np.arr
+00017cb0: 6179 285b 7661 6c75 655f 666f 725f 6e6f  ay([value_for_no
+00017cc0: 6e65 2c20 7661 6c75 655f 666f 725f 6e6f  ne, value_for_no
+00017cd0: 6e65 5d29 0a20 2020 2020 2020 2020 2020  ne]).           
+00017ce0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00017cf0: 2020 2020 2020 2072 6574 7572 6e20 6e70         return np
+00017d00: 2e61 7272 6179 285b 7661 6c75 655f 666f  .array([value_fo
+00017d10: 725f 6e6f 6e65 2c20 7661 6c75 655f 666f  r_none, value_fo
+00017d20: 725f 6e6f 6e65 2c0a 2020 2020 2020 2020  r_none,.        
+00017d30: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+00017d40: 655f 666f 725f 6e6f 6e65 5d29 0a20 2020  e_for_none]).   
+00017d50: 2020 2020 2072 6574 7572 6e20 6f74 6865       return othe
+00017d60: 725f 6365 6e74 726f 6964 202d 2074 6869  r_centroid - thi
+00017d70: 735f 6365 6e74 726f 6964 0a0a 2020 2020  s_centroid..    
+00017d80: 6465 6620 6765 745f 6162 735f 6365 6e74  def get_abs_cent
+00017d90: 726f 6964 5f64 6973 7461 6e63 6528 0a20  roid_distance(. 
+00017da0: 2020 2020 2020 2073 656c 662c 200a 2020         self, .  
+00017db0: 2020 2020 2020 726f 692c 200a 2020 2020        roi, .    
+00017dc0: 2020 2020 7669 6577 3d22 782d 7922 2c20      view="x-y", 
+00017dd0: 0a20 2020 2020 2020 2073 696e 676c 655f  .        single_
+00017de0: 736c 6963 653d 4661 6c73 652c 0a20 2020  slice=False,.   
+00017df0: 2020 2020 2066 6c61 7474 656e 3d46 616c       flatten=Fal
+00017e00: 7365 2c20 0a20 2020 2020 2020 2073 6c3d  se, .        sl=
+00017e10: 4e6f 6e65 2c0a 2020 2020 2020 2020 6964  None,.        id
+00017e20: 783d 4e6f 6e65 2c0a 2020 2020 2020 2020  x=None,.        
+00017e30: 706f 733d 4e6f 6e65 2c0a 2020 2020 2020  pos=None,.      
+00017e40: 2020 756e 6974 733d 226d 6d22 2c0a 2020    units="mm",.  
+00017e50: 2020 2020 2020 6d65 7468 6f64 3d4e 6f6e        method=Non
+00017e60: 652c 0a20 2020 2020 2020 2066 6f72 6365  e,.        force
+00017e70: 3d54 7275 652c 0a20 2020 2020 2020 2062  =True,.        b
+00017e80: 795f 736c 6963 653d 4e6f 6e65 2c0a 2020  y_slice=None,.  
+00017e90: 2020 2020 2020 7661 6c75 655f 666f 725f        value_for_
+00017ea0: 6e6f 6e65 3d4e 6f6e 652c 0a20 2020 2020  none=None,.     
+00017eb0: 2020 2073 6c69 6365 5f73 7461 743d 4e6f     slice_stat=No
+00017ec0: 6e65 2c0a 2020 2020 2020 2020 736c 6963  ne,.        slic
+00017ed0: 655f 7374 6174 5f6b 7761 7267 733d 4e6f  e_stat_kwargs=No
+00017ee0: 6e65 2c0a 2020 2020 2020 2020 293a 0a20  ne,.        ):. 
+00017ef0: 2020 2020 2020 2022 2222 4765 7420 6162         """Get ab
+00017f00: 736f 6c75 7465 2063 656e 7472 6f69 6420  solute centroid 
+00017f10: 6469 7374 616e 6365 2077 6974 6820 7265  distance with re
+00017f20: 7370 6563 7420 746f 2061 6e6f 7468 6572  spect to another
+00017f30: 2052 4f49 2e0a 0a20 2020 2020 2020 202a   ROI...        *
+00017f40: 2a50 6172 616d 6574 6572 733a 2a2a 0a20  *Parameters:**. 
+00017f50: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00017f60: 726f 6920 3a20 524f 490a 2020 2020 2020  roi : ROI.      
+00017f70: 2020 2020 2020 4f74 6865 7220 524f 4920        Other ROI 
+00017f80: 7769 7468 2077 6869 6368 2074 6f20 636f  with which to co
+00017f90: 6d70 6172 6520 6365 6e74 726f 6964 2e0a  mpare centroid..
+00017fa0: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
+00017fb0: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
+00017fc0: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
+00017fd0: 7269 656e 7461 7469 6f6e 2069 6e20 7768  rientation in wh
+00017fe0: 6963 6820 746f 2067 6574 2063 656e 7472  ich to get centr
+00017ff0: 6f69 6473 2069 6620 7573 696e 6720 6120  oids if using a 
+00018000: 7369 6e67 6c65 2073 6c69 6365 206f 720a  single slice or.
+00018010: 2020 2020 2020 2020 2020 2020 666c 6174              flat
+00018020: 7465 6e69 6e67 2e0a 0a20 2020 2020 2020  tening...       
+00018030: 2073 696e 676c 655f 736c 6963 6520 3a20   single_slice : 
+00018040: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
+00018050: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00018060: 4966 2054 7275 652c 2074 6865 2063 656e  If True, the cen
+00018070: 7472 6f69 6420 7769 6c6c 2062 6520 7265  troid will be re
+00018080: 7475 726e 6564 2066 6f72 2061 2073 696e  turned for a sin
+00018090: 676c 6520 736c 6963 652e 0a0a 2020 2020  gle slice...    
+000180a0: 2020 2020 666c 6174 7465 6e20 3a20 626f      flatten : bo
+000180b0: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
+000180c0: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+000180d0: 2054 7275 652c 2074 6865 2033 4420 6365   True, the 3D ce
+000180e0: 6e74 726f 6964 2077 696c 6c20 6265 206f  ntroid will be o
+000180f0: 6274 6169 6e65 6420 616e 6420 7468 656e  btained and then
+00018100: 2074 6865 2061 6273 6f6c 7574 6520 0a20   the absolute . 
+00018110: 2020 2020 2020 2020 2020 2076 616c 7565             value
+00018120: 2061 6c6f 6e67 206f 6e6c 7920 7468 6520   along only the 
+00018130: 3244 2061 7865 7320 696e 2074 6865 206f  2D axes in the o
+00018140: 7269 656e 7461 7469 6f6e 2069 6e20 3c76  rientation in <v
+00018150: 6965 773e 2077 696c 6c0a 2020 2020 2020  iew> will.      
+00018160: 2020 2020 2020 6265 2072 6574 7572 6e65        be returne
+00018170: 642e 0a0a 2020 2020 2020 2020 736c 203a  d...        sl :
+00018180: 2069 6e74 2c20 6465 6661 756c 743d 4e6f   int, default=No
+00018190: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
+000181a0: 6c69 6365 206e 756d 6265 722e 2049 6620  lice number. If 
+000181b0: 6e6f 6e65 206f 6620 3c73 6c3e 2c20 3c69  none of <sl>, <i
+000181c0: 6478 3e20 6f72 203c 706f 733e 2061 7265  dx> or <pos> are
+000181d0: 2073 7570 706c 6965 6420 6275 740a 2020   supplied but.  
+000181e0: 2020 2020 2020 2020 2020 3c73 696e 676c            <singl
+000181f0: 655f 736c 6963 653e 2069 7320 5472 7565  e_slice> is True
+00018200: 2c20 7468 6520 6365 6e74 7261 6c20 736c  , the central sl
+00018210: 6963 6520 6f66 2065 6163 6820 524f 490a  ice of each ROI.
+00018220: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
+00018230: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
+00018240: 2020 2069 6478 203a 2069 6e74 2c20 6465     idx : int, de
+00018250: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00018260: 2020 2020 2020 2041 7272 6179 2069 6e64         Array ind
+00018270: 6578 206f 6620 736c 6963 652e 2049 6620  ex of slice. If 
+00018280: 6e6f 6e65 206f 6620 3c73 6c3e 2c20 3c69  none of <sl>, <i
+00018290: 6478 3e20 6f72 203c 706f 733e 2061 7265  dx> or <pos> are
+000182a0: 2073 7570 706c 6965 640a 2020 2020 2020   supplied.      
+000182b0: 2020 2020 2020 6275 7420 3c73 696e 676c        but <singl
+000182c0: 655f 736c 6963 653e 2069 7320 5472 7565  e_slice> is True
+000182d0: 2c20 7468 6520 6365 6e74 7261 6c20 736c  , the central sl
+000182e0: 6963 6520 6f66 2065 6163 6820 524f 490a  ice of each ROI.
+000182f0: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
+00018300: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
+00018310: 2020 2070 6f73 203a 2066 6c6f 6174 2c20     pos : float, 
+00018320: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00018330: 2020 2020 2020 2020 2053 6c69 6365 2070           Slice p
+00018340: 6f73 6974 696f 6e20 696e 206d 6d2e 2049  osition in mm. I
+00018350: 6620 6e6f 6e65 206f 6620 3c73 6c3e 2c20  f none of <sl>, 
+00018360: 3c69 6478 3e20 6f72 203c 706f 733e 2061  <idx> or <pos> a
+00018370: 7265 2073 7570 706c 6965 640a 2020 2020  re supplied.    
+00018380: 2020 2020 2020 2020 6275 7420 3c73 696e          but <sin
+00018390: 676c 655f 736c 6963 653e 2069 7320 5472  gle_slice> is Tr
+000183a0: 7565 2c20 7468 6520 6365 6e74 7261 6c20  ue, the central 
+000183b0: 736c 6963 6520 6f66 2065 6163 6820 524f  slice of each RO
+000183c0: 490a 2020 2020 2020 2020 2020 2020 7769  I.            wi
+000183d0: 6c6c 2062 6520 7573 6564 2e0a 0a20 2020  ll be used...   
+000183e0: 2020 2020 2075 6e69 7473 203a 2073 7472       units : str
+000183f0: 2c20 6465 6661 756c 743d 226d 6d22 0a20  , default="mm". 
+00018400: 2020 2020 2020 2020 2020 2055 6e69 7473             Units
+00018410: 206f 6620 6162 736f 6c75 7465 2063 656e   of absolute cen
+00018420: 7472 6f69 6420 6469 7374 616e 6365 2e20  troid distance. 
+00018430: 4361 6e20 6265 2061 6e79 206f 663a 0a20  Can be any of:. 
+00018440: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+00018450: 2022 6d6d 223a 2072 6574 7572 6e20 6365   "mm": return ce
+00018460: 6e74 726f 6964 2070 6f73 6974 696f 6e20  ntroid position 
+00018470: 696e 206d 696c 6c69 6d65 7472 6573 2e0a  in millimetres..
+00018480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018490: 2d20 2276 6f78 656c 7322 3a20 7265 7475  - "voxels": retu
+000184a0: 726e 2063 656e 7472 6f69 6420 706f 7369  rn centroid posi
+000184b0: 7469 6f6e 2069 6e20 7465 726d 7320 6f66  tion in terms of
+000184c0: 2061 7272 6179 2069 6e64 6963 6573 2e0a   array indices..
+000184d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184e0: 2d20 2273 6c69 6365 223a 2072 6574 7572  - "slice": retur
+000184f0: 6e20 6365 6e74 726f 6964 2070 6f73 6974  n centroid posit
+00018500: 696f 6e20 696e 2074 6572 6d73 206f 6620  ion in terms of 
+00018510: 736c 6963 6520 6e75 6d62 6572 732e 0a0a  slice numbers...
+00018520: 2020 2020 2020 2020 2020 2020 4966 2075              If u
+00018530: 6e69 7473 3d22 766f 7865 6c73 2220 6f72  nits="voxels" or
+00018540: 2022 736c 6963 6522 2069 7320 7265 7175   "slice" is requ
+00018550: 6573 7465 6420 6275 7420 6569 7468 6572  ested but either
+00018560: 2052 4f49 206f 6e6c 7920 6861 7320 0a20   ROI only has . 
+00018570: 2020 2020 2020 2020 2020 2063 6f6e 746f             conto
+00018580: 7572 7320 616e 6420 6e6f 206d 6173 6b20  urs and no mask 
+00018590: 7368 6170 652f 766f 7865 6c20 7369 7a65  shape/voxel size
+000185a0: 2069 6e66 6f72 6d61 7469 6f6e 2c20 616e   information, an
+000185b0: 2065 7272 6f72 2077 696c 6c20 6265 200a   error will be .
+000185c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000185d0: 6564 2028 756e 6c65 7373 2061 783d 227a  ed (unless ax="z
+000185e0: 222c 2069 6e20 7768 6963 6820 6361 7365  ", in which case
+000185f0: 2076 6f78 656c 2073 697a 6520 7769 6c6c   voxel size will
+00018600: 2062 6520 696e 6665 7272 6564 200a 2020   be inferred .  
+00018610: 2020 2020 2020 2020 2020 6672 6f6d 2073            from s
+00018620: 7061 6369 6e67 2062 6574 7765 656e 2073  pacing between s
+00018630: 6c69 6365 7329 2e0a 0a20 2020 2020 2020  lices)...       
+00018640: 206d 6574 686f 6420 3a20 7374 722c 2064   method : str, d
+00018650: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00018660: 2020 2020 2020 2020 4d65 7468 6f64 2074          Method t
+00018670: 6f20 7573 6520 666f 7220 6365 6e74 726f  o use for centro
+00018680: 6964 2063 616c 6375 6c61 7469 6f6e 2e20  id calculation. 
+00018690: 4361 6e20 6265 3a20 0a20 2020 2020 2020  Can be: .       
+000186a0: 2020 2020 2020 2020 202d 2022 636f 6e74           - "cont
+000186b0: 6f75 7222 3a20 6765 7420 6365 6e74 726f  our": get centro
+000186c0: 6964 206f 6620 7368 6170 656c 7920 636f  id of shapely co
+000186d0: 6e74 6f75 7228 7329 2e0a 2020 2020 2020  ntour(s)..      
+000186e0: 2020 2020 2020 2020 2020 2d20 226d 6173            - "mas
+000186f0: 6b22 3a20 6765 7420 6176 6572 6167 6520  k": get average 
+00018700: 706f 7369 7469 6f6e 206f 6620 766f 7865  position of voxe
+00018710: 6c73 2069 6e20 6269 6e61 7279 206d 6173  ls in binary mas
+00018720: 6b2e 0a20 2020 2020 2020 2020 2020 2020  k..             
+00018730: 2020 202d 204e 6f6e 653a 2075 7365 2074     - None: use t
+00018740: 6865 206d 6574 686f 6420 7365 7420 696e  he method set in
+00018750: 2073 656c 662e 6465 6661 756c 745f 6765   self.default_ge
+00018760: 6f6d 5f6d 6574 686f 642e 0a0a 2020 2020  om_method...    
+00018770: 2020 2020 666f 7263 6520 3a20 626f 6f6c      force : bool
+00018780: 2c20 6465 6661 756c 743d 5472 7565 0a20  , default=True. 
+00018790: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+000187a0: 7565 2c20 7468 6520 676c 6f62 616c 2063  ue, the global c
+000187b0: 656e 7472 6f69 6420 7769 6c6c 2061 6c77  entroid will alw
+000187c0: 6179 7320 6265 2072 6563 616c 6375 6c61  ays be recalcula
+000187d0: 7465 643b 200a 2020 2020 2020 2020 2020  ted; .          
+000187e0: 2020 6f74 6865 7277 6973 652c 2069 7420    otherwise, it 
+000187f0: 7769 6c6c 206f 6e6c 7920 6265 2063 616c  will only be cal
+00018800: 6375 6c61 7465 6420 6966 2069 7420 6861  culated if it ha
+00018810: 7320 6e6f 7420 7965 7420 6265 656e 2063  s not yet been c
+00018820: 6163 6865 6420 0a20 2020 2020 2020 2020  ached .         
+00018830: 2020 2069 6e20 7365 6c66 2e5f 766f 6c75     in self._volu
+00018840: 6d65 2e20 204e 6f74 6520 7468 6174 2069  me.  Note that i
+00018850: 6620 7369 6e67 6c65 5f73 6c69 6365 3d54  f single_slice=T
+00018860: 7275 652c 2074 6865 2063 656e 7472 6f69  rue, the centroi
+00018870: 6420 7769 6c6c 200a 2020 2020 2020 2020  d will .        
+00018880: 2020 2020 616c 7761 7973 2062 6520 7265      always be re
+00018890: 6361 6c63 756c 6174 6564 2e0a 0a20 2020  calculated...   
+000188a0: 2020 2020 2062 795f 736c 6963 6520 3a20       by_slice : 
+000188b0: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
+000188c0: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+000188d0: 206f 6e65 206f 6620 226c 6566 7422 2c20   one of "left", 
+000188e0: 2272 6967 6874 222c 2022 756e 696f 6e22  "right", "union"
+000188f0: 2c20 2269 6e74 6572 7365 6374 696f 6e22  , "intersection"
+00018900: 2c20 6361 6c63 756c 6174 650a 2020 2020  , calculate.    
+00018910: 2020 2020 2020 2020 4469 6365 2073 636f          Dice sco
+00018920: 7265 7320 736c 6963 6520 6279 2073 6c69  res slice by sli
+00018930: 6365 2066 6f72 2065 6163 6820 736c 6963  ce for each slic
+00018940: 6520 636f 6e74 6169 6e69 6e67 0a20 2020  e containing.   
+00018950: 2020 2020 2020 2020 2073 656c 6620 616e           self an
+00018960: 642f 6f72 206f 7468 6572 3a0a 0a20 2020  d/or other:..   
+00018970: 2020 2020 2020 2020 202d 2022 6c65 6674           - "left
+00018980: 223a 2063 6f6e 7369 6465 7220 6f6e 6c79  ": consider only
+00018990: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
+000189a0: 6e67 2073 656c 663b 0a20 2020 2020 2020  ng self;.       
+000189b0: 2020 2020 202d 2022 7269 6768 7422 3a20       - "right": 
+000189c0: 636f 6e73 6964 6572 206f 6e6c 7920 736c  consider only sl
+000189d0: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
+000189e0: 6f74 6865 723b 0a20 2020 2020 2020 2020  other;.         
+000189f0: 2020 202d 2022 756e 696f 6e22 3a20 636f     - "union": co
+00018a00: 6e73 6964 6572 2073 6c69 6365 7320 636f  nsider slices co
+00018a10: 6e74 6169 6e69 6e67 2065 6974 6865 7220  ntaining either 
+00018a20: 6f66 2073 656c 6620 616e 6420 6f74 6865  of self and othe
+00018a30: 723b 0a20 2020 2020 2020 2020 2020 202d  r;.            -
+00018a40: 2022 696e 7465 7273 6563 7469 6f6e 223a   "intersection":
+00018a50: 2063 6f6e 7369 6465 7220 736c 6963 6573   consider slices
+00018a60: 2063 6f6e 7461 696e 696e 6720 626f 7468   containing both
+00018a70: 206f 6620 7365 6c66 2061 6e64 206f 7468   of self and oth
+00018a80: 6572 2e0a 0a20 2020 2020 2020 2020 2020  er...           
+00018a90: 2049 6620 736c 6963 655f 7374 6174 2069   If slice_stat i
+00018aa0: 7320 4e6f 6e65 2c20 7265 7475 726e 2061  s None, return a
+00018ab0: 2064 6963 7469 6f6e 6172 7920 7768 6572   dictionary wher
+00018ac0: 6520 6b65 7973 2061 7265 0a20 2020 2020  e keys are.     
+00018ad0: 2020 2020 2020 2073 6c69 6365 2070 6f73         slice pos
+00018ae0: 6974 696f 6e73 2061 6e64 2076 616c 7565  itions and value
+00018af0: 7320 6172 6520 7468 6520 6361 6c63 756c  s are the calcul
+00018b00: 6174 6564 2044 6963 6520 7363 6f72 6573  ated Dice scores
+00018b10: 2e0a 2020 2020 2020 2020 2020 2020 4f74  ..            Ot
+00018b20: 6865 7277 6973 652c 2072 6574 7572 6e20  herwise, return 
+00018b30: 666f 7220 7468 6520 6361 6c63 756c 6174  for the calculat
+00018b40: 6564 2044 6963 6520 7363 6f72 6573 2074  ed Dice scores t
+00018b50: 6865 2073 7461 7469 7374 6963 0a20 2020  he statistic.   
+00018b60: 2020 2020 2020 2020 2073 7065 6369 6669           specifi
+00018b70: 6564 2062 7920 736c 6963 655f 7374 6174  ed by slice_stat
+00018b80: 2e0a 0a20 2020 2020 2020 2076 616c 7565  ...        value
+00018b90: 5f66 6f72 5f6e 6f6e 6520 3a20 666c 6f61  _for_none : floa
+00018ba0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+00018bb0: 2020 2020 2020 2020 2020 2020 466f 7220              For 
+00018bc0: 7369 6e67 6c65 5f73 6c69 6365 2061 6e64  single_slice and
+00018bd0: 2062 795f 736c 6963 652c 2076 616c 7565   by_slice, value
+00018be0: 2074 6f20 6265 2072 6574 7572 6e65 6420   to be returned 
+00018bf0: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+00018c00: 736c 6963 6573 2077 6865 7265 2044 6963  slices where Dic
+00018c10: 6520 7363 6f72 6520 6973 2075 6e64 6574  e score is undet
+00018c20: 6572 6d69 6e65 6420 284e 6f6e 6529 2e20  ermined (None). 
+00018c30: 2046 6f72 2073 6c69 6365 5f73 7461 742c   For slice_stat,
+00018c40: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00018c50: 7565 2074 6f20 7375 6273 7469 7475 7465  ue to substitute
+00018c60: 2066 6f72 2061 6e79 204e 6f6e 6520 7661   for any None va
+00018c70: 6c75 6573 2061 6d6f 6e67 2074 6865 2069  lues among the i
+00018c80: 6e70 7574 730a 2020 2020 2020 2020 2020  nputs.          
+00018c90: 2020 666f 7220 6361 6c63 756c 6174 696e    for calculatin
+00018ca0: 6720 736c 6963 652d 6261 7365 6420 7374  g slice-based st
+00018cb0: 6174 6973 7469 632e 2020 4966 204e 6f6e  atistic.  If Non
+00018cc0: 6520 696e 2074 6865 206c 6174 7465 720a  e in the latter.
+00018cd0: 2020 2020 2020 2020 2020 2020 6361 7365              case
+00018ce0: 2c20 4e6f 6e65 2076 616c 7565 7320 616d  , None values am
+00018cf0: 6f6e 6720 7468 6520 696e 7075 7473 2061  ong the inputs a
+00018d00: 7265 206f 6d69 7474 6564 2e0a 0a20 2020  re omitted...   
+00018d10: 2020 2020 2073 6c69 6365 5f73 7461 7420       slice_stat 
+00018d20: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
+00018d30: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00018d40: 5369 6e67 6c65 2d76 6172 6961 626c 6520  Single-variable 
+00018d50: 7374 6174 6973 7469 6328 7329 2074 6f20  statistic(s) to 
+00018d60: 6265 2072 6574 7572 6e65 6420 666f 7220  be returned for 
+00018d70: 736c 6963 652d 6279 2d73 6c69 6365 0a20  slice-by-slice. 
+00018d80: 2020 2020 2020 2020 2020 2044 6963 6520             Dice 
+00018d90: 7363 6f72 6573 2e20 2054 6869 7320 7368  scores.  This sh
+00018da0: 6f75 6c64 2062 6520 7468 6520 6e61 6d65  ould be the name
+00018db0: 206f 6620 7468 6520 6675 6e63 7469 6f6e   of the function
+00018dc0: 2066 6f72 0a20 2020 2020 2020 2020 2020   for.           
+00018dd0: 2063 616c 6375 6c61 7469 6f6e 206f 6620   calculation of 
+00018de0: 7468 6520 7374 6174 6973 7469 6328 7329  the statistic(s)
+00018df0: 2069 6e20 7468 6520 5079 7468 6f6e 2073   in the Python s
+00018e00: 7461 7469 7374 6963 7320 6d6f 6475 6c65  tatistics module
+00018e10: 3a0a 0a20 2020 2020 2020 2020 2020 2068  :..            h
+00018e20: 7474 7073 3a2f 2f64 6f63 732e 7079 7468  ttps://docs.pyth
+00018e30: 6f6e 2e6f 7267 2f33 2f6c 6962 7261 7279  on.org/3/library
+00018e40: 2f73 7461 7469 7374 6963 732e 6874 6d6c  /statistics.html
+00018e50: 0a0a 2020 2020 2020 2020 2020 2020 4176  ..            Av
+00018e60: 6169 6c61 626c 6520 6f70 7469 6f6e 7320  ailable options 
+00018e70: 696e 636c 7564 653a 2022 6d65 616e 222c  include: "mean",
+00018e80: 2022 6d65 6469 616e 222c 2022 6d6f 6465   "median", "mode
+00018e90: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+00018ea0: 7374 6465 7622 2c20 2271 7561 6e74 696c  stdev", "quantil
+00018eb0: 6573 222e 2020 4469 7372 6567 6172 6465  es".  Disregarde
+00018ec0: 6420 6966 204e 6f6e 652e 0a0a 2020 2020  d if None...    
+00018ed0: 2020 2020 2020 2020 4966 2062 795f 736c          If by_sl
+00018ee0: 6963 6520 6973 204e 6f6e 6520 616e 6420  ice is None and 
+00018ef0: 736c 6963 655f 7374 6174 2069 7320 6469  slice_stat is di
+00018f00: 6666 6572 656e 7420 6672 6f6d 204e 6f6e  fferent from Non
+00018f10: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
+00018f20: 6b72 742e 636f 7265 2e44 6566 6175 6c74  krt.core.Default
+00018f30: 7328 292e 6279 5f73 6c69 6365 2069 7320  s().by_slice is 
+00018f40: 7573 6564 2066 6f72 2074 6865 2066 6f72  used for the for
+00018f50: 6d65 722e 0a0a 2020 2020 2020 2020 736c  mer...        sl
+00018f60: 6963 655f 7374 6174 5f6b 7761 7267 7320  ice_stat_kwargs 
+00018f70: 3a20 6469 6374 2c20 6465 6661 756c 743d  : dict, default=
+00018f80: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00018f90: 204b 6579 776f 7264 2061 7267 756d 656e   Keyword argumen
+00018fa0: 7473 2074 6f20 6265 2070 6173 7365 6420  ts to be passed 
+00018fb0: 746f 2066 756e 6374 696f 6e20 6f66 2073  to function of s
+00018fc0: 7461 7469 7374 6963 730a 2020 2020 2020  tatistics.      
+00018fd0: 2020 2020 2020 6d6f 6475 6c65 2066 6f72        module for
+00018fe0: 2063 616c 6375 6c61 7469 6f6e 2072 656c   calculation rel
+00018ff0: 6174 6976 6520 746f 2073 6c69 6365 2076  ative to slice v
+00019000: 616c 7565 732e 2020 466f 7220 6578 616d  alues.  For exam
+00019010: 706c 652c 0a20 2020 2020 2020 2020 2020  ple,.           
+00019020: 2069 6620 7175 616e 7469 6c65 7320 6172   if quantiles ar
+00019030: 6520 7265 7175 6972 6564 2066 6f72 2031  e required for 1
+00019040: 3020 696e 7465 7276 616c 732c 2072 6174  0 intervals, rat
+00019050: 6865 7220 7468 616e 2066 6f72 0a20 2020  her than for.   
+00019060: 2020 2020 2020 2020 2074 6865 2064 6566           the def
+00019070: 6175 6c74 206f 6620 342c 2074 6869 7320  ault of 4, this 
+00019080: 6361 6e20 6265 2073 7065 6369 6669 6564  can be specified
+00019090: 2075 7369 6e67 3a0a 0a20 2020 2020 2020   using:..       
+000190a0: 2020 2020 2073 6c69 6365 5f73 7461 745f       slice_stat_
+000190b0: 6b77 6172 6773 7b22 6e22 203a 2031 307d  kwargs{"n" : 10}
+000190c0: 0a0a 2020 2020 2020 2020 2020 2020 466f  ..            Fo
+000190d0: 7220 6176 6169 6c61 626c 6520 6b65 7977  r available keyw
+000190e0: 6f72 6420 6f70 7469 6f6e 732c 2073 6565  ord options, see
+000190f0: 2064 6f63 756d 656e 7461 7469 6f6e 206f   documentation o
+00019100: 6620 7374 6174 6973 7469 6373 0a20 2020  f statistics.   
+00019110: 2020 2020 2020 2020 206d 6f64 756c 6520           module 
+00019120: 6174 3a0a 0a20 2020 2020 2020 2020 2020  at:..           
+00019130: 2068 7474 7073 3a2f 2f64 6f63 732e 7079   https://docs.py
+00019140: 7468 6f6e 2e6f 7267 2f33 2f6c 6962 7261  thon.org/3/libra
+00019150: 7279 2f73 7461 7469 7374 6963 732e 6874  ry/statistics.ht
+00019160: 6d6c 0a20 2020 2020 2020 2022 2222 0a20  ml.        """. 
+00019170: 2020 2020 2020 2069 6620 736c 6963 655f         if slice_
+00019180: 7374 6174 3a0a 2020 2020 2020 2020 2020  stat:.          
+00019190: 2020 7265 7475 726e 2073 656c 662e 6765    return self.ge
+000191a0: 745f 736c 6963 655f 7374 6174 2872 6f69  t_slice_stat(roi
+000191b0: 2c20 2261 6273 5f63 656e 7472 6f69 6422  , "abs_centroid"
+000191c0: 2c20 736c 6963 655f 7374 6174 2c0a 2020  , slice_stat,.  
+000191d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191e0: 2020 6279 5f73 6c69 6365 2c20 7661 6c75    by_slice, valu
+000191f0: 655f 666f 725f 6e6f 6e65 2c20 7669 6577  e_for_none, view
+00019200: 2c20 6d65 7468 6f64 2c0a 2020 2020 2020  , method,.      
+00019210: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
+00019220: 2873 6c69 6365 5f73 7461 745f 6b77 6172  (slice_stat_kwar
+00019230: 6773 206f 7220 7b7d 2929 0a0a 2020 2020  gs or {}))..    
+00019240: 2020 2020 6966 2062 795f 736c 6963 653a      if by_slice:
+00019250: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00019260: 7572 6e20 7365 6c66 2e67 6574 5f6d 6574  urn self.get_met
+00019270: 7269 635f 6279 5f73 6c69 6365 2872 6f69  ric_by_slice(roi
+00019280: 2c20 2261 6273 5f63 656e 7472 6f69 6422  , "abs_centroid"
+00019290: 2c20 6279 5f73 6c69 6365 2c0a 2020 2020  , by_slice,.    
+000192a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192b0: 7669 6577 2c20 6d65 7468 6f64 290a 0a20  view, method).. 
+000192c0: 2020 2020 2020 2023 2049 6620 666c 6174         # If flat
+000192d0: 7465 6e69 6e67 2c20 6e65 6564 2074 6f20  tening, need to 
+000192e0: 6765 7420 3344 2063 656e 7472 6f69 6420  get 3D centroid 
+000192f0: 7665 6374 6f72 0a20 2020 2020 2020 2069  vector.        i
+00019300: 6620 666c 6174 7465 6e3a 0a20 2020 2020  f flatten:.     
+00019310: 2020 2020 2020 2073 696e 676c 655f 736c         single_sl
+00019320: 6963 6520 3d20 4661 6c73 650a 0a20 2020  ice = False..   
+00019330: 2020 2020 2023 2047 6574 2063 656e 7472       # Get centr
+00019340: 6f69 6420 7665 6374 6f72 0a20 2020 2020  oid vector.     
+00019350: 2020 2063 656e 7472 6f69 6420 3d20 7365     centroid = se
+00019360: 6c66 2e67 6574 5f63 656e 7472 6f69 645f  lf.get_centroid_
+00019370: 6469 7374 616e 6365 280a 2020 2020 2020  distance(.      
+00019380: 2020 2020 2020 726f 692c 200a 2020 2020        roi, .    
+00019390: 2020 2020 2020 2020 7669 6577 3d76 6965          view=vie
+000193a0: 772c 200a 2020 2020 2020 2020 2020 2020  w, .            
+000193b0: 7369 6e67 6c65 5f73 6c69 6365 3d73 696e  single_slice=sin
+000193c0: 676c 655f 736c 6963 652c 0a20 2020 2020  gle_slice,.     
+000193d0: 2020 2020 2020 2073 6c3d 736c 2c0a 2020         sl=sl,.  
+000193e0: 2020 2020 2020 2020 2020 6964 783d 6964            idx=id
+000193f0: 782c 0a20 2020 2020 2020 2020 2020 2070  x,.            p
+00019400: 6f73 3d70 6f73 2c0a 2020 2020 2020 2020  os=pos,.        
+00019410: 2020 2020 756e 6974 733d 756e 6974 732c      units=units,
+00019420: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
+00019430: 686f 643d 6d65 7468 6f64 2c0a 2020 2020  hod=method,.    
+00019440: 2020 2020 2020 2020 666f 7263 653d 666f          force=fo
+00019450: 7263 652c 0a20 2020 2020 2020 2029 0a0a  rce,.        )..
+00019460: 2020 2020 2020 2020 2320 4966 2063 656e          # If cen
+00019470: 7472 6f69 6420 7761 736e 2774 2061 7661  troid wasn't ava
+00019480: 696c 6162 6c65 2c20 7265 7475 726e 204e  ilable, return N
+00019490: 6f6e 650a 2020 2020 2020 2020 6966 204e  one.        if N
+000194a0: 6f6e 6520 696e 2063 656e 7472 6f69 643a  one in centroid:
+000194b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000194c0: 7572 6e20 7661 6c75 655f 666f 725f 6e6f  urn value_for_no
+000194d0: 6e65 0a0a 2020 2020 2020 2020 2320 4966  ne..        # If
+000194e0: 2066 6c61 7474 656e 696e 672c 2074 616b   flattening, tak
+000194f0: 6520 3220 6178 6573 206f 6e6c 790a 2020  e 2 axes only.  
+00019500: 2020 2020 2020 6966 2066 6c61 7474 656e        if flatten
+00019510: 3a0a 2020 2020 2020 2020 2020 2020 785f  :.            x_
+00019520: 6178 2c20 795f 6178 203d 2073 6b72 742e  ax, y_ax = skrt.
+00019530: 696d 6167 652e 5f70 6c6f 745f 6178 6573  image._plot_axes
+00019540: 5b76 6965 775d 0a20 2020 2020 2020 2020  [view].         
+00019550: 2020 2063 656e 7472 6f69 6420 3d20 6e70     centroid = np
+00019560: 2e61 7272 6179 285b 6365 6e74 726f 6964  .array([centroid
+00019570: 5b78 5f61 785d 2c20 6365 6e74 726f 6964  [x_ax], centroid
+00019580: 5b79 5f61 785d 5d29 0a0a 2020 2020 2020  [y_ax]])..      
+00019590: 2020 2320 5265 7475 726e 206d 6167 6e69    # Return magni
+000195a0: 7475 6465 206f 6620 7665 6374 6f72 0a20  tude of vector. 
+000195b0: 2020 2020 2020 2072 6574 7572 6e20 6e70         return np
+000195c0: 2e6c 696e 616c 672e 6e6f 726d 2863 656e  .linalg.norm(cen
+000195d0: 7472 6f69 6429 0a0a 2020 2020 6465 6620  troid)..    def 
+000195e0: 6765 745f 6469 6365 280a 2020 2020 2020  get_dice(.      
+000195f0: 2020 7365 6c66 2c20 0a20 2020 2020 2020    self, .       
+00019600: 206f 7468 6572 2c20 0a20 2020 2020 2020   other, .       
+00019610: 2073 696e 676c 655f 736c 6963 653d 4661   single_slice=Fa
+00019620: 6c73 652c 0a20 2020 2020 2020 2076 6965  lse,.        vie
+00019630: 773d 2278 2d79 222c 200a 2020 2020 2020  w="x-y", .      
+00019640: 2020 736c 3d4e 6f6e 652c 200a 2020 2020    sl=None, .    
+00019650: 2020 2020 6964 783d 4e6f 6e65 2c20 0a20      idx=None, . 
+00019660: 2020 2020 2020 2070 6f73 3d4e 6f6e 652c         pos=None,
+00019670: 200a 2020 2020 2020 2020 6d65 7468 6f64   .        method
+00019680: 3d4e 6f6e 652c 0a20 2020 2020 2020 2066  =None,.        f
+00019690: 6c61 7474 656e 3d46 616c 7365 2c0a 2020  latten=False,.  
+000196a0: 2020 2020 2020 6279 5f73 6c69 6365 3d4e        by_slice=N
+000196b0: 6f6e 652c 0a20 2020 2020 2020 2076 616c  one,.        val
+000196c0: 7565 5f66 6f72 5f6e 6f6e 653d 4e6f 6e65  ue_for_none=None
+000196d0: 2c0a 2020 2020 2020 2020 736c 6963 655f  ,.        slice_
+000196e0: 7374 6174 3d4e 6f6e 652c 0a20 2020 2020  stat=None,.     
+000196f0: 2020 2073 6c69 6365 5f73 7461 745f 6b77     slice_stat_kw
+00019700: 6172 6773 3d4e 6f6e 652c 0a20 2020 2029  args=None,.    )
+00019710: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00019720: 2020 2020 2020 4765 7420 4469 6365 2073        Get Dice s
+00019730: 636f 7265 2077 6974 6820 7265 7370 6563  core with respec
+00019740: 7420 746f 2061 6e6f 7468 6572 2052 4f49  t to another ROI
+00019750: 2c0a 2020 2020 2020 2020 676c 6f62 616c  ,.        global
+00019760: 6c79 2c20 6f6e 2061 2073 696e 676c 6520  ly, on a single 
+00019770: 736c 6963 652c 2073 6c69 6365 2062 7920  slice, slice by 
+00019780: 736c 6963 652c 206f 7220 736c 6963 6520  slice, or slice 
+00019790: 6176 6572 6167 6564 2e0a 0a20 2020 2020  averaged...     
+000197a0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+000197b0: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
+000197c0: 2020 2020 6f74 6865 7220 3a20 524f 490a      other : ROI.
+000197d0: 2020 2020 2020 2020 2020 2020 4f74 6865              Othe
+000197e0: 7220 524f 4920 746f 2063 6f6d 7061 7265  r ROI to compare
+000197f0: 2077 6974 6820 7468 6973 2052 4f49 2e0a   with this ROI..
+00019800: 0a20 2020 2020 2020 2073 696e 676c 655f  .        single_
+00019810: 736c 6963 6520 3a20 626f 6f6c 2c20 6465  slice : bool, de
+00019820: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+00019830: 2020 2020 2020 2020 4966 2046 616c 7365          If False
+00019840: 2c20 7468 6520 676c 6f62 616c 2033 4420  , the global 3D 
+00019850: 4469 6365 2073 636f 7265 206f 6620 7468  Dice score of th
+00019860: 6520 6675 6c6c 2052 4f49 7320 7769 6c6c  e full ROIs will
+00019870: 2062 6520 7265 7475 726e 6564 3b0a 2020   be returned;.  
+00019880: 2020 2020 2020 2020 2020 6f74 6865 7277            otherw
+00019890: 6973 652c 2074 6865 2032 4420 4469 6365  ise, the 2D Dice
+000198a0: 2073 636f 7265 206f 6e20 6120 7369 6e67   score on a sing
+000198b0: 6c65 2073 6c69 6365 2077 696c 6c20 6265  le slice will be
+000198c0: 2072 6574 7572 6e65 642e 0a0a 2020 2020   returned...    
+000198d0: 2020 2020 7669 6577 203a 2073 7472 2c20      view : str, 
+000198e0: 6465 6661 756c 743d 2278 2d79 220a 2020  default="x-y".  
+000198f0: 2020 2020 2020 2020 2020 4f72 6965 6e74            Orient
+00019900: 6174 696f 6e20 6f66 2073 6c69 6365 206f  ation of slice o
+00019910: 6e20 7768 6963 6820 746f 2067 6574 2044  n which to get D
+00019920: 6963 6520 7363 6f72 652e 204f 6e6c 7920  ice score. Only 
+00019930: 7573 6564 2069 6620 0a20 2020 2020 2020  used if .       
+00019940: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
+00019950: 653d 5472 7565 2e20 4966 2075 7369 6e67  e=True. If using
+00019960: 2c20 3c61 783e 206d 7573 7420 6265 2061  , <ax> must be a
+00019970: 6e20 6178 6973 2074 6861 7420 6c69 6573  n axis that lies
+00019980: 2061 6c6f 6e67 0a20 2020 2020 2020 2020   along.         
+00019990: 2020 2074 6865 2073 6c69 6365 2069 6e20     the slice in 
+000199a0: 7468 6973 206f 7269 656e 7461 7469 6f6e  this orientation
+000199b0: 2e0a 0a20 2020 2020 2020 2073 6c20 3a20  ...        sl : 
+000199c0: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
+000199d0: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
+000199e0: 6963 6520 6e75 6d62 6572 2e20 4966 206e  ice number. If n
+000199f0: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
+00019a00: 783e 206f 7220 3c70 6f73 3e20 6172 6520  x> or <pos> are 
+00019a10: 7375 7070 6c69 6564 2062 7574 0a20 2020  supplied but.   
+00019a20: 2020 2020 2020 2020 203c 7369 6e67 6c65           <single
+00019a30: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
+00019a40: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
+00019a50: 6365 206f 6620 7468 6973 2052 4f49 2077  ce of this ROI w
+00019a60: 696c 6c20 6265 2075 7365 642e 0a0a 2020  ill be used...  
+00019a70: 2020 2020 2020 6964 7820 3a20 696e 742c        idx : int,
+00019a80: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00019a90: 2020 2020 2020 2020 2020 4172 7261 7920            Array 
+00019aa0: 696e 6465 7820 6f66 2073 6c69 6365 2e20  index of slice. 
+00019ab0: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
+00019ac0: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
+00019ad0: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
+00019ae0: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
+00019af0: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
+00019b00: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
+00019b10: 2073 6c69 6365 206f 6620 7468 6973 2052   slice of this R
+00019b20: 4f49 2077 696c 6c20 6265 2075 7365 642e  OI will be used.
+00019b30: 0a0a 2020 2020 2020 2020 706f 7320 3a20  ..        pos : 
+00019b40: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+00019b50: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00019b60: 536c 6963 6520 706f 7369 7469 6f6e 2069  Slice position i
+00019b70: 6e20 6d6d 2e20 4966 206e 6f6e 6520 6f66  n mm. If none of
+00019b80: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
+00019b90: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
+00019ba0: 6564 2062 7574 0a20 2020 2020 2020 2020  ed but.         
+00019bb0: 2020 203c 7369 6e67 6c65 5f73 6c69 6365     <single_slice
+00019bc0: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
+00019bd0: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
+00019be0: 7468 6973 2052 4f49 2077 696c 6c20 6265  this ROI will be
+00019bf0: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
+00019c00: 6d65 7468 6f64 203a 2073 7472 2c20 6465  method : str, de
+00019c10: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00019c20: 2020 2020 2020 204d 6574 686f 6420 746f         Method to
+00019c30: 2075 7365 2066 6f72 2044 6963 6520 7363   use for Dice sc
+00019c40: 6f72 6520 6361 6c63 756c 6174 696f 6e2e  ore calculation.
+00019c50: 2043 616e 2062 653a 200a 2020 2020 2020   Can be: .      
+00019c60: 2020 2020 2020 2020 2020 2d20 2263 6f6e            - "con
+00019c70: 746f 7572 223a 2067 6574 2069 6e74 6572  tour": get inter
+00019c80: 7365 6374 696f 6e73 2061 6e64 2061 7265  sections and are
+00019c90: 6173 206f 6620 7368 6170 656c 7920 636f  as of shapely co
+00019ca0: 6e74 6f75 7273 2e0a 2020 2020 2020 2020  ntours..        
+00019cb0: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
+00019cc0: 3a20 636f 756e 7420 696e 7465 7273 6563  : count intersec
+00019cd0: 7469 6e67 2076 6f78 656c 7320 696e 2062  ting voxels in b
+00019ce0: 696e 6172 7920 6d61 736b 732e 0a20 2020  inary masks..   
+00019cf0: 2020 2020 2020 2020 2020 2020 202d 204e               - N
+00019d00: 6f6e 653a 2075 7365 2074 6865 206d 6574  one: use the met
+00019d10: 686f 6420 7365 7420 696e 2073 656c 662e  hod set in self.
+00019d20: 6465 6661 756c 745f 6765 6f6d 5f6d 6574  default_geom_met
+00019d30: 686f 642e 0a0a 2020 2020 2020 2020 666c  hod...        fl
+00019d40: 6174 7465 6e20 3a20 626f 6f6c 2c20 6465  atten : bool, de
+00019d50: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+00019d60: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+00019d70: 2061 6c6c 2073 6c69 6365 7320 7769 6c6c   all slices will
+00019d80: 2062 6520 666c 6174 7465 6e65 6420 696e   be flattened in
+00019d90: 2074 6865 2067 6976 656e 206f 7269 656e   the given orien
+00019da0: 7461 7469 6f6e 2061 6e64 0a20 2020 2020  tation and.     
+00019db0: 2020 2020 2020 2074 6865 2044 6963 6520         the Dice 
+00019dc0: 7363 6f72 6520 6f66 2074 6865 2066 6c61  score of the fla
+00019dd0: 7474 656e 6564 2073 6c69 6365 7320 7769  ttened slices wi
+00019de0: 6c6c 2062 6520 7265 7475 726e 6564 2e20  ll be returned. 
+00019df0: 4f6e 6c79 200a 2020 2020 2020 2020 2020  Only .          
+00019e00: 2020 6176 6169 6c61 626c 6520 6966 206d    available if m
+00019e10: 6574 686f 643d 226d 6173 6b22 2e0a 0a20  ethod="mask"... 
+00019e20: 2020 2020 2020 2062 795f 736c 6963 6520         by_slice 
+00019e30: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
+00019e40: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00019e50: 4966 206f 6e65 206f 6620 226c 6566 7422  If one of "left"
+00019e60: 2c20 2272 6967 6874 222c 2022 756e 696f  , "right", "unio
+00019e70: 6e22 2c20 2269 6e74 6572 7365 6374 696f  n", "intersectio
+00019e80: 6e22 2c20 6361 6c63 756c 6174 650a 2020  n", calculate.  
+00019e90: 2020 2020 2020 2020 2020 4469 6365 2073            Dice s
+00019ea0: 636f 7265 7320 736c 6963 6520 6279 2073  cores slice by s
+00019eb0: 6c69 6365 2066 6f72 2065 6163 6820 736c  lice for each sl
+00019ec0: 6963 6520 636f 6e74 6169 6e69 6e67 0a20  ice containing. 
+00019ed0: 2020 2020 2020 2020 2020 2073 656c 6620             self 
+00019ee0: 616e 642f 6f72 206f 7468 6572 3a0a 0a20  and/or other:.. 
+00019ef0: 2020 2020 2020 2020 2020 202d 2022 6c65             - "le
+00019f00: 6674 223a 2063 6f6e 7369 6465 7220 6f6e  ft": consider on
+00019f10: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
+00019f20: 6e69 6e67 2073 656c 663b 0a20 2020 2020  ning self;.     
+00019f30: 2020 2020 2020 202d 2022 7269 6768 7422         - "right"
+00019f40: 3a20 636f 6e73 6964 6572 206f 6e6c 7920  : consider only 
+00019f50: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
+00019f60: 6720 6f74 6865 723b 0a20 2020 2020 2020  g other;.       
+00019f70: 2020 2020 202d 2022 756e 696f 6e22 3a20       - "union": 
+00019f80: 636f 6e73 6964 6572 2073 6c69 6365 7320  consider slices 
+00019f90: 636f 6e74 6169 6e69 6e67 2065 6974 6865  containing eithe
+00019fa0: 7220 6f66 2073 656c 6620 616e 6420 6f74  r of self and ot
+00019fb0: 6865 723b 0a20 2020 2020 2020 2020 2020  her;.           
+00019fc0: 202d 2022 696e 7465 7273 6563 7469 6f6e   - "intersection
+00019fd0: 223a 2063 6f6e 7369 6465 7220 736c 6963  ": consider slic
+00019fe0: 6573 2063 6f6e 7461 696e 696e 6720 626f  es containing bo
+00019ff0: 7468 206f 6620 7365 6c66 2061 6e64 206f  th of self and o
+0001a000: 7468 6572 2e0a 0a20 2020 2020 2020 2020  ther...         
+0001a010: 2020 2049 6620 736c 6963 655f 7374 6174     If slice_stat
+0001a020: 2069 7320 4e6f 6e65 2c20 7265 7475 726e   is None, return
+0001a030: 2061 2064 6963 7469 6f6e 6172 7920 7768   a dictionary wh
+0001a040: 6572 6520 6b65 7973 2061 7265 0a20 2020  ere keys are.   
+0001a050: 2020 2020 2020 2020 2073 6c69 6365 2070           slice p
+0001a060: 6f73 6974 696f 6e73 2061 6e64 2076 616c  ositions and val
+0001a070: 7565 7320 6172 6520 7468 6520 6361 6c63  ues are the calc
+0001a080: 756c 6174 6564 2044 6963 6520 7363 6f72  ulated Dice scor
+0001a090: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
+0001a0a0: 4f74 6865 7277 6973 652c 2072 6574 7572  Otherwise, retur
+0001a0b0: 6e20 666f 7220 7468 6520 6361 6c63 756c  n for the calcul
+0001a0c0: 6174 6564 2044 6963 6520 7363 6f72 6573  ated Dice scores
+0001a0d0: 2074 6865 2073 7461 7469 7374 6963 0a20   the statistic. 
+0001a0e0: 2020 2020 2020 2020 2020 2073 7065 6369             speci
+0001a0f0: 6669 6564 2062 7920 736c 6963 655f 7374  fied by slice_st
+0001a100: 6174 2e0a 0a20 2020 2020 2020 2076 616c  at...        val
+0001a110: 7565 5f66 6f72 5f6e 6f6e 6520 3a20 666c  ue_for_none : fl
+0001a120: 6f61 742c 2064 6566 6175 6c74 3d4e 6f6e  oat, default=Non
+0001a130: 650a 2020 2020 2020 2020 2020 2020 466f  e.            Fo
+0001a140: 7220 7369 6e67 6c65 5f73 6c69 6365 2061  r single_slice a
+0001a150: 6e64 2062 795f 736c 6963 652c 2076 616c  nd by_slice, val
+0001a160: 7565 2074 6f20 6265 2072 6574 7572 6e65  ue to be returne
+0001a170: 6420 666f 720a 2020 2020 2020 2020 2020  d for.          
+0001a180: 2020 736c 6963 6573 2077 6865 7265 2044    slices where D
+0001a190: 6963 6520 7363 6f72 6520 6973 2075 6e64  ice score is und
+0001a1a0: 6574 6572 6d69 6e65 6420 284e 6f6e 6529  etermined (None)
+0001a1b0: 2e20 2046 6f72 2073 6c69 6365 5f73 7461  .  For slice_sta
+0001a1c0: 742c 0a20 2020 2020 2020 2020 2020 2076  t,.            v
+0001a1d0: 616c 7565 2074 6f20 7375 6273 7469 7475  alue to substitu
+0001a1e0: 7465 2066 6f72 2061 6e79 204e 6f6e 6520  te for any None 
+0001a1f0: 7661 6c75 6573 2061 6d6f 6e67 2074 6865  values among the
+0001a200: 2069 6e70 7574 730a 2020 2020 2020 2020   inputs.        
+0001a210: 2020 2020 666f 7220 6361 6c63 756c 6174      for calculat
+0001a220: 696e 6720 736c 6963 652d 6261 7365 6420  ing slice-based 
+0001a230: 7374 6174 6973 7469 632e 2020 4966 204e  statistic.  If N
+0001a240: 6f6e 6520 696e 2074 6865 206c 6174 7465  one in the latte
+0001a250: 720a 2020 2020 2020 2020 2020 2020 6361  r.            ca
+0001a260: 7365 2c20 4e6f 6e65 2076 616c 7565 7320  se, None values 
+0001a270: 616d 6f6e 6720 7468 6520 696e 7075 7473  among the inputs
+0001a280: 2061 7265 206f 6d69 7474 6564 2e0a 0a20   are omitted... 
+0001a290: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
+0001a2a0: 7420 3a20 7374 722c 2064 6566 6175 6c74  t : str, default
+0001a2b0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0001a2c0: 2020 5369 6e67 6c65 2d76 6172 6961 626c    Single-variabl
+0001a2d0: 6520 7374 6174 6973 7469 6328 7329 2074  e statistic(s) t
+0001a2e0: 6f20 6265 2072 6574 7572 6e65 6420 666f  o be returned fo
+0001a2f0: 7220 736c 6963 652d 6279 2d73 6c69 6365  r slice-by-slice
+0001a300: 0a20 2020 2020 2020 2020 2020 2044 6963  .            Dic
+0001a310: 6520 7363 6f72 6573 2e20 2054 6869 7320  e scores.  This 
+0001a320: 7368 6f75 6c64 2062 6520 7468 6520 6e61  should be the na
+0001a330: 6d65 206f 6620 7468 6520 6675 6e63 7469  me of the functi
+0001a340: 6f6e 2066 6f72 0a20 2020 2020 2020 2020  on for.         
+0001a350: 2020 2063 616c 6375 6c61 7469 6f6e 206f     calculation o
+0001a360: 6620 7468 6520 7374 6174 6973 7469 6328  f the statistic(
+0001a370: 7329 2069 6e20 7468 6520 5079 7468 6f6e  s) in the Python
+0001a380: 2073 7461 7469 7374 6963 7320 6d6f 6475   statistics modu
+0001a390: 6c65 3a0a 0a20 2020 2020 2020 2020 2020  le:..           
+0001a3a0: 2068 7474 7073 3a2f 2f64 6f63 732e 7079   https://docs.py
+0001a3b0: 7468 6f6e 2e6f 7267 2f33 2f6c 6962 7261  thon.org/3/libra
+0001a3c0: 7279 2f73 7461 7469 7374 6963 732e 6874  ry/statistics.ht
+0001a3d0: 6d6c 0a0a 2020 2020 2020 2020 2020 2020  ml..            
+0001a3e0: 4176 6169 6c61 626c 6520 6f70 7469 6f6e  Available option
+0001a3f0: 7320 696e 636c 7564 653a 2022 6d65 616e  s include: "mean
+0001a400: 222c 2022 6d65 6469 616e 222c 2022 6d6f  ", "median", "mo
+0001a410: 6465 222c 0a20 2020 2020 2020 2020 2020  de",.           
+0001a420: 2022 7374 6465 7622 2c20 2271 7561 6e74   "stdev", "quant
+0001a430: 696c 6573 222e 2020 4469 7372 6567 6172  iles".  Disregar
+0001a440: 6465 6420 6966 204e 6f6e 652e 0a0a 2020  ded if None...  
+0001a450: 2020 2020 2020 2020 2020 4966 2062 795f            If by_
+0001a460: 736c 6963 6520 6973 204e 6f6e 6520 616e  slice is None an
+0001a470: 6420 736c 6963 655f 7374 6174 2069 7320  d slice_stat is 
+0001a480: 6469 6666 6572 656e 7420 6672 6f6d 204e  different from N
+0001a490: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0001a4a0: 2073 6b72 742e 636f 7265 2e44 6566 6175   skrt.core.Defau
+0001a4b0: 6c74 7328 292e 6279 5f73 6c69 6365 2069  lts().by_slice i
+0001a4c0: 7320 7573 6564 2066 6f72 2074 6865 2066  s used for the f
+0001a4d0: 6f72 6d65 722e 0a0a 2020 2020 2020 2020  ormer...        
+0001a4e0: 736c 6963 655f 7374 6174 5f6b 7761 7267  slice_stat_kwarg
+0001a4f0: 7320 3a20 6469 6374 2c20 6465 6661 756c  s : dict, defaul
+0001a500: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+0001a510: 2020 204b 6579 776f 7264 2061 7267 756d     Keyword argum
+0001a520: 656e 7473 2074 6f20 6265 2070 6173 7365  ents to be passe
+0001a530: 6420 746f 2066 756e 6374 696f 6e20 6f66  d to function of
+0001a540: 2073 7461 7469 7374 6963 730a 2020 2020   statistics.    
+0001a550: 2020 2020 2020 2020 6d6f 6475 6c65 2066          module f
+0001a560: 6f72 2063 616c 6375 6c61 7469 6f6e 2072  or calculation r
+0001a570: 656c 6174 6976 6520 746f 2073 6c69 6365  elative to slice
+0001a580: 2076 616c 7565 732e 2020 466f 7220 6578   values.  For ex
+0001a590: 616d 706c 652c 0a20 2020 2020 2020 2020  ample,.         
+0001a5a0: 2020 2069 6620 7175 616e 7469 6c65 7320     if quantiles 
+0001a5b0: 6172 6520 7265 7175 6972 6564 2066 6f72  are required for
+0001a5c0: 2031 3020 696e 7465 7276 616c 732c 2072   10 intervals, r
+0001a5d0: 6174 6865 7220 7468 616e 2066 6f72 0a20  ather than for. 
+0001a5e0: 2020 2020 2020 2020 2020 2074 6865 2064             the d
+0001a5f0: 6566 6175 6c74 206f 6620 342c 2074 6869  efault of 4, thi
+0001a600: 7320 6361 6e20 6265 2073 7065 6369 6669  s can be specifi
+0001a610: 6564 2075 7369 6e67 3a0a 0a20 2020 2020  ed using:..     
+0001a620: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
+0001a630: 745f 6b77 6172 6773 7b22 6e22 203a 2031  t_kwargs{"n" : 1
+0001a640: 307d 0a0a 2020 2020 2020 2020 2020 2020  0}..            
+0001a650: 466f 7220 6176 6169 6c61 626c 6520 6b65  For available ke
+0001a660: 7977 6f72 6420 6f70 7469 6f6e 732c 2073  yword options, s
+0001a670: 6565 2064 6f63 756d 656e 7461 7469 6f6e  ee documentation
+0001a680: 206f 6620 7374 6174 6973 7469 6373 0a20   of statistics. 
+0001a690: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
+0001a6a0: 6520 6174 3a0a 0a20 2020 2020 2020 2020  e at:..         
+0001a6b0: 2020 2068 7474 7073 3a2f 2f64 6f63 732e     https://docs.
+0001a6c0: 7079 7468 6f6e 2e6f 7267 2f33 2f6c 6962  python.org/3/lib
+0001a6d0: 7261 7279 2f73 7461 7469 7374 6963 732e  rary/statistics.
+0001a6e0: 6874 6d6c 0a20 2020 2020 2020 2022 2222  html.        """
+0001a6f0: 0a20 2020 2020 2020 2069 6620 736c 6963  .        if slic
+0001a700: 655f 7374 6174 3a0a 2020 2020 2020 2020  e_stat:.        
+0001a710: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001a720: 6765 745f 736c 6963 655f 7374 6174 286f  get_slice_stat(o
+0001a730: 7468 6572 2c20 2264 6963 6522 2c20 736c  ther, "dice", sl
+0001a740: 6963 655f 7374 6174 2c20 6279 5f73 6c69  ice_stat, by_sli
+0001a750: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
+0001a760: 2020 2020 2020 2020 7661 6c75 655f 666f          value_fo
+0001a770: 725f 6e6f 6e65 2c20 7669 6577 2c20 6d65  r_none, view, me
+0001a780: 7468 6f64 2c20 2a2a 2873 6c69 6365 5f73  thod, **(slice_s
+0001a790: 7461 745f 6b77 6172 6773 206f 7220 7b7d  tat_kwargs or {}
+0001a7a0: 2929 0a0a 2020 2020 2020 2020 6966 2062  ))..        if b
+0001a7b0: 795f 736c 6963 653a 0a20 2020 2020 2020  y_slice:.       
+0001a7c0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001a7d0: 2e67 6574 5f6d 6574 7269 635f 6279 5f73  .get_metric_by_s
+0001a7e0: 6c69 6365 286f 7468 6572 2c20 2264 6963  lice(other, "dic
+0001a7f0: 6522 2c20 6279 5f73 6c69 6365 2c0a 2020  e", by_slice,.  
+0001a800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a810: 2020 7669 6577 2c20 6d65 7468 6f64 290a    view, method).
+0001a820: 0a20 2020 2020 2020 2069 6e74 6572 7365  .        interse
+0001a830: 6374 696f 6e2c 2075 6e69 6f6e 2c20 6d65  ction, union, me
+0001a840: 616e 5f73 697a 6520 3d20 7365 6c66 2e67  an_size = self.g
+0001a850: 6574 5f69 6e74 6572 7365 6374 696f 6e5f  et_intersection_
+0001a860: 756e 696f 6e5f 7369 7a65 280a 2020 2020  union_size(.    
+0001a870: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
+0001a880: 722c 2073 696e 676c 655f 736c 6963 652c  r, single_slice,
+0001a890: 2076 6965 772c 2073 6c2c 2069 6478 2c20   view, sl, idx, 
+0001a8a0: 706f 732c 206d 6574 686f 642c 2066 6c61  pos, method, fla
+0001a8b0: 7474 656e 290a 0a20 2020 2020 2020 2072  tten)..        r
+0001a8c0: 6574 7572 6e20 2869 6e74 6572 7365 6374  eturn (intersect
+0001a8d0: 696f 6e20 2f20 6d65 616e 5f73 697a 6520  ion / mean_size 
+0001a8e0: 6966 206d 6561 6e5f 7369 7a65 2065 6c73  if mean_size els
+0001a8f0: 6520 7661 6c75 655f 666f 725f 6e6f 6e65  e value_for_none
+0001a900: 290a 0a20 2020 2064 6566 2067 6574 5f6a  )..    def get_j
+0001a910: 6163 6361 7264 280a 2020 2020 2020 2020  accard(.        
+0001a920: 7365 6c66 2c20 0a20 2020 2020 2020 206f  self, .        o
+0001a930: 7468 6572 2c20 0a20 2020 2020 2020 2073  ther, .        s
+0001a940: 696e 676c 655f 736c 6963 653d 4661 6c73  ingle_slice=Fals
+0001a950: 652c 0a20 2020 2020 2020 2076 6965 773d  e,.        view=
+0001a960: 2278 2d79 222c 200a 2020 2020 2020 2020  "x-y", .        
+0001a970: 736c 3d4e 6f6e 652c 200a 2020 2020 2020  sl=None, .      
+0001a980: 2020 6964 783d 4e6f 6e65 2c20 0a20 2020    idx=None, .   
+0001a990: 2020 2020 2070 6f73 3d4e 6f6e 652c 200a       pos=None, .
+0001a9a0: 2020 2020 2020 2020 6d65 7468 6f64 3d4e          method=N
+0001a9b0: 6f6e 652c 0a20 2020 2020 2020 2066 6c61  one,.        fla
+0001a9c0: 7474 656e 3d46 616c 7365 2c0a 2020 2020  tten=False,.    
+0001a9d0: 2020 2020 6279 5f73 6c69 6365 3d4e 6f6e      by_slice=Non
+0001a9e0: 652c 0a20 2020 2020 2020 2076 616c 7565  e,.        value
+0001a9f0: 5f66 6f72 5f6e 6f6e 653d 4e6f 6e65 2c0a  _for_none=None,.
+0001aa00: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
+0001aa10: 6174 3d4e 6f6e 652c 0a20 2020 2020 2020  at=None,.       
+0001aa20: 2073 6c69 6365 5f73 7461 745f 6b77 6172   slice_stat_kwar
+0001aa30: 6773 3d4e 6f6e 652c 0a20 2020 2029 3a0a  gs=None,.    ):.
+0001aa40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001aa50: 2020 2020 4765 7420 4a61 6363 6172 6420      Get Jaccard 
+0001aa60: 696e 6465 7820 7769 7468 2072 6573 7065  index with respe
+0001aa70: 6374 2074 6f20 616e 6f74 6865 7220 524f  ct to another RO
+0001aa80: 492e 0a0a 2020 2020 2020 2020 5468 6520  I...        The 
+0001aa90: 4a61 6363 6172 6420 696e 6465 7820 6d61  Jaccard index ma
+0001aaa0: 7920 6265 206f 6274 6169 6e65 6420 6569  y be obtained ei
+0001aab0: 7468 6572 2067 6c6f 6261 6c6c 7920 6f72  ther globally or
+0001aac0: 206f 6e20 6120 0a20 2020 2020 2020 2073   on a .        s
+0001aad0: 696e 676c 6520 736c 6963 652e 0a0a 2020  ingle slice...  
+0001aae0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+0001aaf0: 7273 3a2a 2a0a 2020 2020 2020 2020 0a20  rs:**.        . 
+0001ab00: 2020 2020 2020 206f 7468 6572 203a 2052         other : R
+0001ab10: 4f49 0a20 2020 2020 2020 2020 2020 204f  OI.            O
+0001ab20: 7468 6572 2052 4f49 2074 6f20 636f 6d70  ther ROI to comp
+0001ab30: 6172 6520 7769 7468 2074 6869 7320 524f  are with this RO
+0001ab40: 492e 0a0a 2020 2020 2020 2020 7369 6e67  I...        sing
+0001ab50: 6c65 5f73 6c69 6365 203a 2062 6f6f 6c2c  le_slice : bool,
+0001ab60: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
+0001ab70: 2020 2020 2020 2020 2020 2049 6620 4661             If Fa
+0001ab80: 6c73 652c 2074 6865 2067 6c6f 6261 6c20  lse, the global 
+0001ab90: 3344 204a 6163 6361 7264 2069 6e64 6578  3D Jaccard index
+0001aba0: 206f 6620 7468 6520 6675 6c6c 2052 4f49   of the full ROI
+0001abb0: 7320 7769 6c6c 2062 650a 2020 2020 2020  s will be.      
+0001abc0: 2020 2020 2020 7265 7475 726e 6564 3b20        returned; 
+0001abd0: 6f74 6865 7277 6973 652c 2074 6865 2032  otherwise, the 2
+0001abe0: 4420 4a61 6363 6172 6420 696e 6465 7820  D Jaccard index 
+0001abf0: 6f6e 2061 2073 696e 676c 6520 736c 6963  on a single slic
+0001ac00: 650a 2020 2020 2020 2020 2020 2020 7769  e.            wi
+0001ac10: 6c6c 2062 6520 7265 7475 726e 6564 2e0a  ll be returned..
+0001ac20: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
+0001ac30: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
+0001ac40: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
+0001ac50: 7269 656e 7461 7469 6f6e 206f 6620 736c  rientation of sl
+0001ac60: 6963 6520 6f6e 2077 6869 6368 2074 6f20  ice on which to 
+0001ac70: 6765 7420 4a61 6363 6172 6420 696e 6465  get Jaccard inde
+0001ac80: 782e 204f 6e6c 7920 7573 6564 2069 6620  x. Only used if 
+0001ac90: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
+0001aca0: 676c 655f 736c 6963 653d 5472 7565 2e20  gle_slice=True. 
+0001acb0: 4966 2075 7369 6e67 2c20 3c61 783e 206d  If using, <ax> m
+0001acc0: 7573 7420 6265 2061 6e20 6178 6973 2074  ust be an axis t
+0001acd0: 6861 7420 6c69 6573 2061 6c6f 6e67 0a20  hat lies along. 
+0001ace0: 2020 2020 2020 2020 2020 2074 6865 2073             the s
+0001acf0: 6c69 6365 2069 6e20 7468 6973 206f 7269  lice in this ori
+0001ad00: 656e 7461 7469 6f6e 2e0a 0a20 2020 2020  entation...     
+0001ad10: 2020 2073 6c20 3a20 696e 742c 2064 6566     sl : int, def
+0001ad20: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0001ad30: 2020 2020 2020 536c 6963 6520 6e75 6d62        Slice numb
+0001ad40: 6572 2e20 4966 206e 6f6e 6520 6f66 203c  er. If none of <
+0001ad50: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
+0001ad60: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
+0001ad70: 2062 7574 0a20 2020 2020 2020 2020 2020   but.           
+0001ad80: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
+0001ad90: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
+0001ada0: 7472 616c 2073 6c69 6365 206f 6620 7468  tral slice of th
+0001adb0: 6973 2052 4f49 2077 696c 6c20 6265 2075  is ROI will be u
+0001adc0: 7365 642e 0a0a 2020 2020 2020 2020 6964  sed...        id
+0001add0: 7820 3a20 696e 742c 2064 6566 6175 6c74  x : int, default
+0001ade0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0001adf0: 2020 4172 7261 7920 696e 6465 7820 6f66    Array index of
+0001ae00: 2073 6c69 6365 2e20 4966 206e 6f6e 6520   slice. If none 
+0001ae10: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
+0001ae20: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
+0001ae30: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
+0001ae40: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
+0001ae50: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
+0001ae60: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
+0001ae70: 6620 7468 6973 2052 4f49 2077 696c 6c20  f this ROI will 
+0001ae80: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
+0001ae90: 2020 706f 7320 3a20 666c 6f61 742c 2064    pos : float, d
+0001aea0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0001aeb0: 2020 2020 2020 2020 536c 6963 6520 706f          Slice po
+0001aec0: 7369 7469 6f6e 2069 6e20 6d6d 2e20 4966  sition in mm. If
+0001aed0: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
+0001aee0: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
+0001aef0: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
+0001af00: 2020 2020 2020 2020 2020 203c 7369 6e67             <sing
+0001af10: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
+0001af20: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
+0001af30: 6c69 6365 206f 6620 7468 6973 2052 4f49  lice of this ROI
+0001af40: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
+0001af50: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
+0001af60: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
+0001af70: 6e65 0a20 2020 2020 2020 2020 2020 204d  ne.            M
+0001af80: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
+0001af90: 2044 6963 6520 7363 6f72 6520 6361 6c63   Dice score calc
+0001afa0: 756c 6174 696f 6e2e 2043 616e 2062 653a  ulation. Can be:
+0001afb0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0001afc0: 2020 2d20 2263 6f6e 746f 7572 223a 2067    - "contour": g
+0001afd0: 6574 2069 6e74 6572 7365 6374 696f 6e73  et intersections
+0001afe0: 2061 6e64 2061 7265 6173 206f 6620 7368   and areas of sh
+0001aff0: 6170 656c 7920 636f 6e74 6f75 7273 2e0a  apely contours..
+0001b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b010: 2d20 226d 6173 6b22 3a20 636f 756e 7420  - "mask": count 
+0001b020: 696e 7465 7273 6563 7469 6e67 2076 6f78  intersecting vox
+0001b030: 656c 7320 696e 2062 696e 6172 7920 6d61  els in binary ma
+0001b040: 736b 732e 0a20 2020 2020 2020 2020 2020  sks..           
+0001b050: 2020 2020 202d 204e 6f6e 653a 2075 7365       - None: use
+0001b060: 2074 6865 206d 6574 686f 6420 7365 7420   the method set 
+0001b070: 696e 2073 656c 662e 6465 6661 756c 745f  in self.default_
+0001b080: 6765 6f6d 5f6d 6574 686f 642e 0a0a 2020  geom_method...  
+0001b090: 2020 2020 2020 666c 6174 7465 6e20 3a20        flatten : 
+0001b0a0: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
+0001b0b0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0001b0c0: 4966 2054 7275 652c 2061 6c6c 2073 6c69  If True, all sli
+0001b0d0: 6365 7320 7769 6c6c 2062 6520 666c 6174  ces will be flat
+0001b0e0: 7465 6e65 6420 696e 2074 6865 2067 6976  tened in the giv
+0001b0f0: 656e 206f 7269 656e 7461 7469 6f6e 2061  en orientation a
+0001b100: 6e64 0a20 2020 2020 2020 2020 2020 2074  nd.            t
+0001b110: 6865 2044 6963 6520 7363 6f72 6520 6f66  he Dice score of
+0001b120: 2074 6865 2066 6c61 7474 656e 6564 2073   the flattened s
+0001b130: 6c69 6365 7320 7769 6c6c 2062 6520 7265  lices will be re
+0001b140: 7475 726e 6564 2e20 4f6e 6c79 200a 2020  turned. Only .  
+0001b150: 2020 2020 2020 2020 2020 6176 6169 6c61            availa
+0001b160: 626c 6520 6966 206d 6574 686f 643d 226d  ble if method="m
+0001b170: 6173 6b22 2e0a 0a20 2020 2020 2020 2062  ask"...        b
+0001b180: 795f 736c 6963 6520 3a20 7374 722c 2064  y_slice : str, d
+0001b190: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0001b1a0: 2020 2020 2020 2020 4966 206f 6e65 206f          If one o
+0001b1b0: 6620 226c 6566 7422 2c20 2272 6967 6874  f "left", "right
+0001b1c0: 222c 2022 756e 696f 6e22 2c20 2269 6e74  ", "union", "int
+0001b1d0: 6572 7365 6374 696f 6e22 2c20 6361 6c63  ersection", calc
+0001b1e0: 756c 6174 650a 2020 2020 2020 2020 2020  ulate.          
+0001b1f0: 2020 4469 6365 2073 636f 7265 7320 736c    Dice scores sl
+0001b200: 6963 6520 6279 2073 6c69 6365 2066 6f72  ice by slice for
+0001b210: 2065 6163 6820 736c 6963 6520 636f 6e74   each slice cont
+0001b220: 6169 6e69 6e67 0a20 2020 2020 2020 2020  aining.         
+0001b230: 2020 2073 656c 6620 616e 642f 6f72 206f     self and/or o
+0001b240: 7468 6572 3a0a 0a20 2020 2020 2020 2020  ther:..         
+0001b250: 2020 202d 2022 6c65 6674 223a 2063 6f6e     - "left": con
+0001b260: 7369 6465 7220 6f6e 6c79 2073 6c69 6365  sider only slice
+0001b270: 7320 636f 6e74 6169 6e69 6e67 2073 656c  s containing sel
+0001b280: 663b 0a20 2020 2020 2020 2020 2020 202d  f;.            -
+0001b290: 2022 7269 6768 7422 3a20 636f 6e73 6964   "right": consid
+0001b2a0: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
+0001b2b0: 6f6e 7461 696e 696e 6720 6f74 6865 723b  ontaining other;
+0001b2c0: 0a20 2020 2020 2020 2020 2020 202d 2022  .            - "
+0001b2d0: 756e 696f 6e22 3a20 636f 6e73 6964 6572  union": consider
+0001b2e0: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
+0001b2f0: 6e67 2065 6974 6865 7220 6f66 2073 656c  ng either of sel
+0001b300: 6620 616e 6420 6f74 6865 723b 0a20 2020  f and other;.   
+0001b310: 2020 2020 2020 2020 202d 2022 696e 7465           - "inte
+0001b320: 7273 6563 7469 6f6e 223a 2063 6f6e 7369  rsection": consi
+0001b330: 6465 7220 736c 6963 6573 2063 6f6e 7461  der slices conta
+0001b340: 696e 696e 6720 626f 7468 206f 6620 7365  ining both of se
+0001b350: 6c66 2061 6e64 206f 7468 6572 2e0a 0a20  lf and other... 
+0001b360: 2020 2020 2020 2020 2020 2049 6620 736c             If sl
+0001b370: 6963 655f 7374 6174 2069 7320 4e6f 6e65  ice_stat is None
+0001b380: 2c20 7265 7475 726e 2061 2064 6963 7469  , return a dicti
+0001b390: 6f6e 6172 7920 7768 6572 6520 6b65 7973  onary where keys
+0001b3a0: 2061 7265 0a20 2020 2020 2020 2020 2020   are.           
+0001b3b0: 2073 6c69 6365 2070 6f73 6974 696f 6e73   slice positions
+0001b3c0: 2061 6e64 2076 616c 7565 7320 6172 6520   and values are 
+0001b3d0: 7468 6520 6361 6c63 756c 6174 6564 204a  the calculated J
+0001b3e0: 6163 6361 7264 2069 6e64 6963 6573 2e0a  accard indices..
+0001b3f0: 2020 2020 2020 2020 2020 2020 4f74 6865              Othe
+0001b400: 7277 6973 652c 2072 6574 7572 6e20 666f  rwise, return fo
+0001b410: 7220 7468 6520 6361 6c63 756c 6174 6564  r the calculated
+0001b420: 204a 6163 6361 7264 2069 6e64 6963 6573   Jaccard indices
+0001b430: 2074 6865 2073 7461 7469 7374 6963 0a20   the statistic. 
+0001b440: 2020 2020 2020 2020 2020 2073 7065 6369             speci
+0001b450: 6669 6564 2062 7920 736c 6963 655f 7374  fied by slice_st
+0001b460: 6174 2e0a 0a20 2020 2020 2020 2076 616c  at...        val
+0001b470: 7565 5f66 6f72 5f6e 6f6e 6520 3a20 666c  ue_for_none : fl
+0001b480: 6f61 742c 2064 6566 6175 6c74 3d4e 6f6e  oat, default=Non
+0001b490: 650a 2020 2020 2020 2020 2020 2020 466f  e.            Fo
+0001b4a0: 7220 7369 6e67 6c65 5f73 6c69 6365 2061  r single_slice a
+0001b4b0: 6e64 2062 795f 736c 6963 652c 2076 616c  nd by_slice, val
+0001b4c0: 7565 2074 6f20 6265 2072 6574 7572 6e65  ue to be returne
+0001b4d0: 6420 666f 720a 2020 2020 2020 2020 2020  d for.          
+0001b4e0: 2020 736c 6963 6573 2077 6865 7265 204a    slices where J
+0001b4f0: 6163 6361 7264 2069 6e64 6578 2069 7320  accard index is 
+0001b500: 756e 6465 7465 726d 696e 6564 2028 4e6f  undetermined (No
+0001b510: 6e65 292e 2020 466f 7220 736c 6963 655f  ne).  For slice_
+0001b520: 7374 6174 2c0a 2020 2020 2020 2020 2020  stat,.          
+0001b530: 2020 7661 6c75 6520 746f 2073 7562 7374    value to subst
+0001b540: 6974 7574 6520 666f 7220 616e 7920 4e6f  itute for any No
+0001b550: 6e65 2076 616c 7565 7320 616d 6f6e 6720  ne values among 
+0001b560: 7468 6520 696e 7075 7473 0a20 2020 2020  the inputs.     
+0001b570: 2020 2020 2020 2066 6f72 2063 616c 6375         for calcu
+0001b580: 6c61 7469 6e67 2073 6c69 6365 2d62 6173  lating slice-bas
+0001b590: 6564 2073 7461 7469 7374 6963 2e20 2049  ed statistic.  I
+0001b5a0: 6620 4e6f 6e65 2069 6e20 7468 6520 6c61  f None in the la
+0001b5b0: 7474 6572 0a20 2020 2020 2020 2020 2020  tter.           
+0001b5c0: 2063 6173 652c 204e 6f6e 6520 7661 6c75   case, None valu
+0001b5d0: 6573 2061 6d6f 6e67 2074 6865 2069 6e70  es among the inp
+0001b5e0: 7574 7320 6172 6520 6f6d 6974 7465 642e  uts are omitted.
+0001b5f0: 0a0a 2020 2020 2020 2020 736c 6963 655f  ..        slice_
+0001b600: 7374 6174 203a 2073 7472 2c20 6465 6661  stat : str, defa
+0001b610: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+0001b620: 2020 2020 2053 696e 676c 652d 7661 7269       Single-vari
+0001b630: 6162 6c65 2073 7461 7469 7374 6963 2873  able statistic(s
+0001b640: 2920 746f 2062 6520 7265 7475 726e 6564  ) to be returned
+0001b650: 2066 6f72 2073 6c69 6365 2d62 792d 736c   for slice-by-sl
+0001b660: 6963 650a 2020 2020 2020 2020 2020 2020  ice.            
+0001b670: 4a61 6363 6172 6420 696e 6469 6365 732e  Jaccard indices.
+0001b680: 2020 5468 6973 2073 686f 756c 6420 6265    This should be
+0001b690: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
+0001b6a0: 2066 756e 6374 696f 6e20 666f 720a 2020   function for.  
+0001b6b0: 2020 2020 2020 2020 2020 6361 6c63 756c            calcul
+0001b6c0: 6174 696f 6e20 6f66 2074 6865 2073 7461  ation of the sta
+0001b6d0: 7469 7374 6963 2873 2920 696e 2074 6865  tistic(s) in the
+0001b6e0: 2050 7974 686f 6e20 7374 6174 6973 7469   Python statisti
+0001b6f0: 6373 206d 6f64 756c 653a 0a0a 2020 2020  cs module:..    
+0001b700: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
+0001b710: 646f 6373 2e70 7974 686f 6e2e 6f72 672f  docs.python.org/
+0001b720: 332f 6c69 6272 6172 792f 7374 6174 6973  3/library/statis
+0001b730: 7469 6373 2e68 746d 6c0a 0a20 2020 2020  tics.html..     
+0001b740: 2020 2020 2020 2041 7661 696c 6162 6c65         Available
+0001b750: 206f 7074 696f 6e73 2069 6e63 6c75 6465   options include
+0001b760: 3a20 226d 6561 6e22 2c20 226d 6564 6961  : "mean", "media
+0001b770: 6e22 2c20 226d 6f64 6522 2c0a 2020 2020  n", "mode",.    
+0001b780: 2020 2020 2020 2020 2273 7464 6576 222c          "stdev",
+0001b790: 2022 7175 616e 7469 6c65 7322 2e20 2044   "quantiles".  D
+0001b7a0: 6973 7265 6761 7264 6564 2069 6620 4e6f  isregarded if No
+0001b7b0: 6e65 2e0a 0a20 2020 2020 2020 2020 2020  ne...           
+0001b7c0: 2049 6620 6279 5f73 6c69 6365 2069 7320   If by_slice is 
+0001b7d0: 4e6f 6e65 2061 6e64 2073 6c69 6365 5f73  None and slice_s
+0001b7e0: 7461 7420 6973 2064 6966 6665 7265 6e74  tat is different
+0001b7f0: 2066 726f 6d20 4e6f 6e65 2c0a 2020 2020   from None,.    
+0001b800: 2020 2020 2020 2020 7468 6520 666f 726d          the form
+0001b810: 6572 2064 6566 6175 6c74 7320 746f 2022  er defaults to "
+0001b820: 756e 696f 6e22 2e0a 0a20 2020 2020 2020  union"...       
+0001b830: 2073 6c69 6365 5f73 7461 745f 6b77 6172   slice_stat_kwar
+0001b840: 6773 203a 2064 6963 742c 2064 6566 6175  gs : dict, defau
+0001b850: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0001b860: 2020 2020 4b65 7977 6f72 6420 6172 6775      Keyword argu
+0001b870: 6d65 6e74 7320 746f 2062 6520 7061 7373  ments to be pass
+0001b880: 6564 2074 6f20 6675 6e63 7469 6f6e 206f  ed to function o
+0001b890: 6620 7374 6174 6973 7469 6373 0a20 2020  f statistics.   
+0001b8a0: 2020 2020 2020 2020 206d 6f64 756c 6520           module 
+0001b8b0: 666f 7220 6361 6c63 756c 6174 696f 6e20  for calculation 
+0001b8c0: 7265 6c61 7469 7665 2074 6f20 736c 6963  relative to slic
+0001b8d0: 6520 7661 6c75 6573 2e20 2046 6f72 2065  e values.  For e
+0001b8e0: 7861 6d70 6c65 2c0a 2020 2020 2020 2020  xample,.        
+0001b8f0: 2020 2020 6966 2071 7561 6e74 696c 6573      if quantiles
+0001b900: 2061 7265 2072 6571 7569 7265 6420 666f   are required fo
+0001b910: 7220 3130 2069 6e74 6572 7661 6c73 2c20  r 10 intervals, 
+0001b920: 7261 7468 6572 2074 6861 6e20 666f 720a  rather than for.
+0001b930: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+0001b940: 6465 6661 756c 7420 6f66 2034 2c20 7468  default of 4, th
+0001b950: 6973 2063 616e 2062 6520 7370 6563 6966  is can be specif
+0001b960: 6965 6420 7573 696e 673a 0a0a 2020 2020  ied using:..    
+0001b970: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
+0001b980: 6174 5f6b 7761 7267 737b 226e 2220 3a20  at_kwargs{"n" : 
+0001b990: 3130 7d0a 0a20 2020 2020 2020 2020 2020  10}..           
+0001b9a0: 2046 6f72 2061 7661 696c 6162 6c65 206b   For available k
+0001b9b0: 6579 776f 7264 206f 7074 696f 6e73 2c20  eyword options, 
+0001b9c0: 7365 6520 646f 6375 6d65 6e74 6174 696f  see documentatio
+0001b9d0: 6e20 6f66 2073 7461 7469 7374 6963 730a  n of statistics.
+0001b9e0: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
+0001b9f0: 6c65 2061 743a 0a0a 2020 2020 2020 2020  le at:..        
+0001ba00: 2020 2020 6874 7470 733a 2f2f 646f 6373      https://docs
+0001ba10: 2e70 7974 686f 6e2e 6f72 672f 332f 6c69  .python.org/3/li
+0001ba20: 6272 6172 792f 7374 6174 6973 7469 6373  brary/statistics
+0001ba30: 2e68 746d 6c0a 2020 2020 2020 2020 2222  .html.        ""
+0001ba40: 220a 2020 2020 2020 2020 6966 2073 6c69  ".        if sli
+0001ba50: 6365 5f73 7461 743a 0a20 2020 2020 2020  ce_stat:.       
+0001ba60: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001ba70: 2e67 6574 5f73 6c69 6365 5f73 7461 7428  .get_slice_stat(
+0001ba80: 6f74 6865 722c 2022 6a61 6363 6172 6422  other, "jaccard"
+0001ba90: 2c20 736c 6963 655f 7374 6174 2c20 6279  , slice_stat, by
+0001baa0: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
+0001bab0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+0001bac0: 655f 666f 725f 6e6f 6e65 2c20 7669 6577  e_for_none, view
+0001bad0: 2c20 6d65 7468 6f64 2c20 2a2a 2873 6c69  , method, **(sli
+0001bae0: 6365 5f73 7461 745f 6b77 6172 6773 206f  ce_stat_kwargs o
+0001baf0: 7220 7b7d 2929 0a0a 2020 2020 2020 2020  r {}))..        
+0001bb00: 6966 2062 795f 736c 6963 653a 0a20 2020  if by_slice:.   
+0001bb10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001bb20: 7365 6c66 2e67 6574 5f6d 6574 7269 635f  self.get_metric_
+0001bb30: 6279 5f73 6c69 6365 286f 7468 6572 2c20  by_slice(other, 
+0001bb40: 226a 6163 6361 7264 222c 2062 795f 736c  "jaccard", by_sl
+0001bb50: 6963 652c 0a20 2020 2020 2020 2020 2020  ice,.           
+0001bb60: 2020 2020 2020 2020 2076 6965 772c 206d           view, m
+0001bb70: 6574 686f 6429 0a0a 2020 2020 2020 2020  ethod)..        
+0001bb80: 696e 7465 7273 6563 7469 6f6e 2c20 756e  intersection, un
+0001bb90: 696f 6e2c 206d 6561 6e5f 7369 7a65 203d  ion, mean_size =
+0001bba0: 2073 656c 662e 6765 745f 696e 7465 7273   self.get_inters
+0001bbb0: 6563 7469 6f6e 5f75 6e69 6f6e 5f73 697a  ection_union_siz
+0001bbc0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+0001bbd0: 2020 206f 7468 6572 2c20 7369 6e67 6c65     other, single
+0001bbe0: 5f73 6c69 6365 2c20 7669 6577 2c20 736c  _slice, view, sl
+0001bbf0: 2c20 6964 782c 2070 6f73 2c20 6d65 7468  , idx, pos, meth
+0001bc00: 6f64 2c20 666c 6174 7465 6e29 0a0a 2020  od, flatten)..  
+0001bc10: 2020 2020 2020 7265 7475 726e 2028 696e        return (in
+0001bc20: 7465 7273 6563 7469 6f6e 202f 2075 6e69  tersection / uni
+0001bc30: 6f6e 2069 6620 756e 696f 6e20 656c 7365  on if union else
+0001bc40: 2076 616c 7565 5f66 6f72 5f6e 6f6e 6529   value_for_none)
+0001bc50: 0a0a 2020 2020 6465 6620 6765 745f 766f  ..    def get_vo
+0001bc60: 6c75 6d65 5f72 6174 696f 2873 656c 662c  lume_ratio(self,
+0001bc70: 206f 7468 6572 2c20 2a2a 6b77 6172 6773   other, **kwargs
+0001bc80: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+0001bc90: 7420 7261 7469 6f20 6f66 2061 6e6f 7468  t ratio of anoth
+0001bca0: 6572 2052 4f49 2773 2076 6f6c 756d 6520  er ROI's volume 
+0001bcb0: 7769 7468 2072 6573 7065 6374 2074 6f20  with respect to 
+0001bcc0: 6f77 6e20 766f 6c75 6d65 2e22 2222 0a0a  own volume."""..
+0001bcd0: 2020 2020 2020 2020 6f77 6e5f 766f 6c75          own_volu
+0001bce0: 6d65 203d 206f 7468 6572 2e67 6574 5f76  me = other.get_v
+0001bcf0: 6f6c 756d 6528 2a2a 6b77 6172 6773 290a  olume(**kwargs).
+0001bd00: 2020 2020 2020 2020 6f74 6865 725f 766f          other_vo
+0001bd10: 6c75 6d65 203d 2073 656c 662e 6765 745f  lume = self.get_
+0001bd20: 766f 6c75 6d65 282a 2a6b 7761 7267 7329  volume(**kwargs)
+0001bd30: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0001bd40: 6f74 6865 725f 766f 6c75 6d65 206f 7220  other_volume or 
+0001bd50: 6e6f 7420 6f77 6e5f 766f 6c75 6d65 3a0a  not own_volume:.
+0001bd60: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001bd70: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
+0001bd80: 7265 7475 726e 206f 776e 5f76 6f6c 756d  return own_volum
+0001bd90: 6520 2f20 6f74 6865 725f 766f 6c75 6d65  e / other_volume
+0001bda0: 0a0a 2020 2020 6465 6620 6765 745f 6172  ..    def get_ar
+0001bdb0: 6561 5f72 6174 696f 2873 656c 662c 206f  ea_ratio(self, o
+0001bdc0: 7468 6572 2c20 7669 6577 3d22 782d 7922  ther, view="x-y"
+0001bdd0: 2c20 736c 3d4e 6f6e 652c 2069 6478 3d4e  , sl=None, idx=N
+0001bde0: 6f6e 652c 2070 6f73 3d4e 6f6e 652c 0a20  one, pos=None,. 
+0001bdf0: 2020 2020 2020 2020 2020 2075 6e69 7473             units
+0001be00: 3d22 6d6d 222c 206d 6574 686f 643d 4e6f  ="mm", method=No
+0001be10: 6e65 2c20 666c 6174 7465 6e3d 4661 6c73  ne, flatten=Fals
+0001be20: 652c 2062 795f 736c 6963 653d 4e6f 6e65  e, by_slice=None
+0001be30: 2c0a 2020 2020 2020 2020 2020 2020 736c  ,.            sl
+0001be40: 6963 655f 7374 6174 3d4e 6f6e 652c 2076  ice_stat=None, v
+0001be50: 616c 7565 5f66 6f72 5f6e 6f6e 653d 4e6f  alue_for_none=No
+0001be60: 6e65 2c20 2a2a 736c 6963 655f 7374 6174  ne, **slice_stat
+0001be70: 5f6b 7761 7267 7329 3a0a 2020 2020 2020  _kwargs):.      
+0001be80: 2020 2222 2247 6574 2072 6174 696f 206f    """Get ratio o
+0001be90: 6620 616e 6f74 6865 7220 524f 4927 7320  f another ROI's 
+0001bea0: 6172 6561 2077 6974 6820 7265 7370 6563  area with respec
+0001beb0: 7420 746f 206f 776e 2061 7265 612e 2222  t to own area.""
+0001bec0: 220a 0a20 2020 2020 2020 2069 6620 736c  "..        if sl
+0001bed0: 6963 655f 7374 6174 3a0a 2020 2020 2020  ice_stat:.      
+0001bee0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0001bef0: 662e 6765 745f 736c 6963 655f 7374 6174  f.get_slice_stat
+0001bf00: 286f 7468 6572 2c20 2261 7265 615f 7261  (other, "area_ra
+0001bf10: 7469 6f22 2c20 736c 6963 655f 7374 6174  tio", slice_stat
+0001bf20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001bf30: 2020 2020 2020 6279 5f73 6c69 6365 2c20        by_slice, 
+0001bf40: 7661 6c75 655f 666f 725f 6e6f 6e65 2c20  value_for_none, 
+0001bf50: 7669 6577 2c20 6d65 7468 6f64 2c0a 2020  view, method,.  
+0001bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf70: 2020 2a2a 2873 6c69 6365 5f73 7461 745f    **(slice_stat_
+0001bf80: 6b77 6172 6773 206f 7220 7b7d 2929 0a0a  kwargs or {}))..
+0001bf90: 2020 2020 2020 2020 6966 2062 795f 736c          if by_sl
+0001bfa0: 6963 653a 0a20 2020 2020 2020 2020 2020  ice:.           
+0001bfb0: 2072 6574 7572 6e20 7365 6c66 2e67 6574   return self.get
+0001bfc0: 5f6d 6574 7269 635f 6279 5f73 6c69 6365  _metric_by_slice
+0001bfd0: 286f 7468 6572 2c20 2261 7265 615f 7261  (other, "area_ra
+0001bfe0: 7469 6f22 2c20 6279 5f73 6c69 6365 2c0a  tio", by_slice,.
+0001bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c000: 2020 2020 7669 6577 2c20 6d65 7468 6f64      view, method
+0001c010: 290a 0a20 2020 2020 2020 206f 776e 5f61  )..        own_a
+0001c020: 7265 6120 3d20 6f74 6865 722e 6765 745f  rea = other.get_
+0001c030: 6172 6561 2876 6965 772c 2073 6c2c 2069  area(view, sl, i
+0001c040: 6478 2c20 706f 732c 2075 6e69 7473 2c20  dx, pos, units, 
+0001c050: 6d65 7468 6f64 2c20 666c 6174 7465 6e29  method, flatten)
+0001c060: 0a20 2020 2020 2020 206f 7468 6572 5f61  .        other_a
+0001c070: 7265 6120 3d20 7365 6c66 2e67 6574 5f61  rea = self.get_a
+0001c080: 7265 6128 7669 6577 2c20 736c 2c20 6964  rea(view, sl, id
+0001c090: 782c 2070 6f73 2c20 756e 6974 732c 206d  x, pos, units, m
+0001c0a0: 6574 686f 642c 2066 6c61 7474 656e 290a  ethod, flatten).
+0001c0b0: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+0001c0c0: 7468 6572 5f61 7265 6120 6f72 206e 6f74  ther_area or not
+0001c0d0: 206f 776e 5f61 7265 613a 0a20 2020 2020   own_area:.     
+0001c0e0: 2020 2020 2020 2072 6574 7572 6e20 7661         return va
+0001c0f0: 6c75 655f 666f 725f 6e6f 6e65 0a20 2020  lue_for_none.   
+0001c100: 2020 2020 2072 6574 7572 6e20 6f77 6e5f       return own_
+0001c110: 6172 6561 202f 206f 7468 6572 5f61 7265  area / other_are
+0001c120: 610a 0a20 2020 2064 6566 2067 6574 5f76  a..    def get_v
+0001c130: 6f6c 756d 655f 6469 6666 2873 656c 662c  olume_diff(self,
+0001c140: 206f 7468 6572 2c20 2a2a 6b77 6172 6773   other, **kwargs
+0001c150: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+0001c160: 7420 6f77 6e20 766f 6c75 6d65 206d 696e  t own volume min
+0001c170: 7573 2076 6f6c 756d 6520 6f66 206f 7468  us volume of oth
+0001c180: 6572 2052 4f49 2e22 2222 0a0a 2020 2020  er ROI."""..    
+0001c190: 2020 2020 6f77 6e5f 766f 6c75 6d65 203d      own_volume =
+0001c1a0: 2073 656c 662e 6765 745f 766f 6c75 6d65   self.get_volume
+0001c1b0: 282a 2a6b 7761 7267 7329 0a20 2020 2020  (**kwargs).     
+0001c1c0: 2020 206f 7468 6572 5f76 6f6c 756d 6520     other_volume 
+0001c1d0: 3d20 6f74 6865 722e 6765 745f 766f 6c75  = other.get_volu
+0001c1e0: 6d65 282a 2a6b 7761 7267 7329 0a20 2020  me(**kwargs).   
+0001c1f0: 2020 2020 2069 6620 6e6f 7420 6f77 6e5f       if not own_
+0001c200: 766f 6c75 6d65 206f 7220 6e6f 7420 6f74  volume or not ot
+0001c210: 6865 725f 766f 6c75 6d65 3a0a 2020 2020  her_volume:.    
+0001c220: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0001c230: 6f6e 650a 2020 2020 2020 2020 7265 7475  one.        retu
+0001c240: 726e 2028 6f77 6e5f 766f 6c75 6d65 202d  rn (own_volume -
+0001c250: 206f 7468 6572 5f76 6f6c 756d 6529 0a0a   other_volume)..
+0001c260: 2020 2020 6465 6620 6765 745f 7265 6c61      def get_rela
+0001c270: 7469 7665 5f76 6f6c 756d 655f 6469 6666  tive_volume_diff
+0001c280: 2873 656c 662c 206f 7468 6572 2c20 2a2a  (self, other, **
+0001c290: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+0001c2a0: 2022 2222 4765 7420 7265 6c61 7469 7665   """Get relative
+0001c2b0: 2076 6f6c 756d 6520 6f66 2061 6e6f 7468   volume of anoth
+0001c2c0: 6572 2052 4f49 2077 6974 6820 7265 7370  er ROI with resp
+0001c2d0: 6563 7420 746f 206f 776e 2076 6f6c 756d  ect to own volum
+0001c2e0: 652e 2222 220a 0a20 2020 2020 2020 206f  e."""..        o
+0001c2f0: 776e 5f76 6f6c 756d 6520 3d20 7365 6c66  wn_volume = self
+0001c300: 2e67 6574 5f76 6f6c 756d 6528 2a2a 6b77  .get_volume(**kw
+0001c310: 6172 6773 290a 2020 2020 2020 2020 766f  args).        vo
+0001c320: 6c75 6d65 5f64 6966 6620 3d20 7365 6c66  lume_diff = self
+0001c330: 2e67 6574 5f76 6f6c 756d 655f 6469 6666  .get_volume_diff
+0001c340: 286f 7468 6572 2c20 2a2a 6b77 6172 6773  (other, **kwargs
+0001c350: 290a 2020 2020 2020 2020 6966 2076 6f6c  ).        if vol
+0001c360: 756d 655f 6469 6666 2069 7320 4e6f 6e65  ume_diff is None
+0001c370: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001c380: 7475 726e 0a20 2020 2020 2020 2072 6574  turn.        ret
+0001c390: 7572 6e20 766f 6c75 6d65 5f64 6966 6620  urn volume_diff 
+0001c3a0: 2f20 6f77 6e5f 766f 6c75 6d65 0a0a 2020  / own_volume..  
+0001c3b0: 2020 6465 6620 6765 745f 6172 6561 5f64    def get_area_d
+0001c3c0: 6966 6628 7365 6c66 2c20 6f74 6865 722c  iff(self, other,
+0001c3d0: 2076 6965 773d 2278 2d79 222c 2073 6c3d   view="x-y", sl=
+0001c3e0: 4e6f 6e65 2c20 6964 783d 4e6f 6e65 2c20  None, idx=None, 
+0001c3f0: 706f 733d 4e6f 6e65 2c0a 2020 2020 2020  pos=None,.      
+0001c400: 2020 2020 2020 756e 6974 733d 226d 6d22        units="mm"
+0001c410: 2c20 6d65 7468 6f64 3d4e 6f6e 652c 2066  , method=None, f
+0001c420: 6c61 7474 656e 3d46 616c 7365 2c20 6279  latten=False, by
+0001c430: 5f73 6c69 6365 3d4e 6f6e 652c 0a20 2020  _slice=None,.   
+0001c440: 2020 2020 2020 2020 2073 6c69 6365 5f73           slice_s
+0001c450: 7461 743d 4e6f 6e65 2c20 7661 6c75 655f  tat=None, value_
+0001c460: 666f 725f 6e6f 6e65 3d4e 6f6e 652c 202a  for_none=None, *
+0001c470: 2a73 6c69 6365 5f73 7461 745f 6b77 6172  *slice_stat_kwar
+0001c480: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
+0001c490: 4765 7420 6162 736f 6c75 7465 2061 7265  Get absolute are
+0001c4a0: 6120 6469 6666 6572 656e 6365 2062 6574  a difference bet
+0001c4b0: 7765 656e 2074 776f 2052 4f49 732e 2222  ween two ROIs.""
+0001c4c0: 220a 0a20 2020 2020 2020 2069 6620 736c  "..        if sl
+0001c4d0: 6963 655f 7374 6174 3a0a 2020 2020 2020  ice_stat:.      
+0001c4e0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0001c4f0: 662e 6765 745f 736c 6963 655f 7374 6174  f.get_slice_stat
+0001c500: 286f 7468 6572 2c20 2261 7265 615f 6469  (other, "area_di
+0001c510: 6666 222c 2073 6c69 6365 5f73 7461 742c  ff", slice_stat,
+0001c520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c530: 2020 2020 2062 795f 736c 6963 652c 2076       by_slice, v
+0001c540: 616c 7565 5f66 6f72 5f6e 6f6e 652c 2076  alue_for_none, v
+0001c550: 6965 772c 206d 6574 686f 642c 0a20 2020  iew, method,.   
+0001c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c570: 202a 2a28 736c 6963 655f 7374 6174 5f6b   **(slice_stat_k
+0001c580: 7761 7267 7320 6f72 207b 7d29 290a 0a20  wargs or {})).. 
+0001c590: 2020 2020 2020 2069 6620 6279 5f73 6c69         if by_sli
+0001c5a0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+0001c5b0: 7265 7475 726e 2073 656c 662e 6765 745f  return self.get_
+0001c5c0: 6d65 7472 6963 5f62 795f 736c 6963 6528  metric_by_slice(
+0001c5d0: 6f74 6865 722c 2022 6172 6561 5f64 6966  other, "area_dif
+0001c5e0: 6622 2c20 6279 5f73 6c69 6365 2c0a 2020  f", by_slice,.  
+0001c5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c600: 2020 7669 6577 2c20 6d65 7468 6f64 290a    view, method).
+0001c610: 0a20 2020 2020 2020 206f 776e 5f61 7265  .        own_are
+0001c620: 6120 3d20 7365 6c66 2e67 6574 5f61 7265  a = self.get_are
+0001c630: 6128 7669 6577 2c20 736c 2c20 6964 782c  a(view, sl, idx,
+0001c640: 2070 6f73 2c20 756e 6974 732c 206d 6574   pos, units, met
+0001c650: 686f 642c 2066 6c61 7474 656e 290a 2020  hod, flatten).  
+0001c660: 2020 2020 2020 6f74 6865 725f 6172 6561        other_area
+0001c670: 203d 206f 7468 6572 2e67 6574 5f61 7265   = other.get_are
+0001c680: 6128 7669 6577 2c20 736c 2c20 6964 782c  a(view, sl, idx,
+0001c690: 2070 6f73 2c20 756e 6974 732c 206d 6574   pos, units, met
+0001c6a0: 686f 642c 2066 6c61 7474 656e 290a 2020  hod, flatten).  
+0001c6b0: 2020 2020 2020 6966 206e 6f74 206f 776e        if not own
+0001c6c0: 5f61 7265 6120 6f72 206e 6f74 206f 7468  _area or not oth
+0001c6d0: 6572 5f61 7265 613a 0a20 2020 2020 2020  er_area:.       
+0001c6e0: 2020 2020 2072 6574 7572 6e20 7661 6c75       return valu
+0001c6f0: 655f 666f 725f 6e6f 6e65 0a20 2020 2020  e_for_none.     
+0001c700: 2020 2072 6574 7572 6e20 6f77 6e5f 6172     return own_ar
+0001c710: 6561 202d 206f 7468 6572 5f61 7265 610a  ea - other_area.
+0001c720: 0a20 2020 2064 6566 2067 6574 5f72 656c  .    def get_rel
+0001c730: 6174 6976 655f 6172 6561 5f64 6966 6628  ative_area_diff(
+0001c740: 7365 6c66 2c20 6f74 6865 722c 2076 6965  self, other, vie
+0001c750: 773d 2278 2d79 222c 2073 6c3d 4e6f 6e65  w="x-y", sl=None
+0001c760: 2c20 6964 783d 4e6f 6e65 2c0a 2020 2020  , idx=None,.    
+0001c770: 2020 2020 2020 2020 706f 733d 4e6f 6e65          pos=None
+0001c780: 2c20 756e 6974 733d 226d 6d22 2c20 6d65  , units="mm", me
+0001c790: 7468 6f64 3d4e 6f6e 652c 2066 6c61 7474  thod=None, flatt
+0001c7a0: 656e 3d46 616c 7365 2c20 6279 5f73 6c69  en=False, by_sli
+0001c7b0: 6365 3d4e 6f6e 652c 0a20 2020 2020 2020  ce=None,.       
+0001c7c0: 2020 2020 2073 6c69 6365 5f73 7461 743d       slice_stat=
+0001c7d0: 4e6f 6e65 2c20 7661 6c75 655f 666f 725f  None, value_for_
+0001c7e0: 6e6f 6e65 3d4e 6f6e 652c 202a 2a73 6c69  none=None, **sli
+0001c7f0: 6365 5f73 7461 745f 6b77 6172 6773 293a  ce_stat_kwargs):
+0001c800: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
+0001c810: 7265 6c61 7469 7665 2061 7265 6120 6f66  relative area of
+0001c820: 2061 6e6f 7468 6572 2052 4f49 2077 6974   another ROI wit
+0001c830: 6820 7265 7370 6563 7420 746f 206f 776e  h respect to own
+0001c840: 2061 7265 612e 2222 220a 0a20 2020 2020   area."""..     
+0001c850: 2020 2069 6620 736c 6963 655f 7374 6174     if slice_stat
+0001c860: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001c870: 7475 726e 2073 656c 662e 6765 745f 736c  turn self.get_sl
+0001c880: 6963 655f 7374 6174 286f 7468 6572 2c20  ice_stat(other, 
+0001c890: 2272 656c 5f61 7265 615f 6469 6666 222c  "rel_area_diff",
+0001c8a0: 2073 6c69 6365 5f73 7461 742c 0a20 2020   slice_stat,.   
+0001c8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8c0: 2062 795f 736c 6963 652c 2076 616c 7565   by_slice, value
+0001c8d0: 5f66 6f72 5f6e 6f6e 652c 2076 6965 772c  _for_none, view,
+0001c8e0: 206d 6574 686f 642c 0a20 2020 2020 2020   method,.       
+0001c8f0: 2020 2020 2020 2020 2020 2020 202a 2a28               **(
+0001c900: 736c 6963 655f 7374 6174 5f6b 7761 7267  slice_stat_kwarg
+0001c910: 7320 6f72 207b 7d29 290a 0a20 2020 2020  s or {}))..     
+0001c920: 2020 2069 6620 6279 5f73 6c69 6365 3a0a     if by_slice:.
+0001c930: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001c940: 726e 2073 656c 662e 6765 745f 6d65 7472  rn self.get_metr
+0001c950: 6963 5f62 795f 736c 6963 6528 6f74 6865  ic_by_slice(othe
+0001c960: 722c 2022 7265 6c5f 6172 6561 5f64 6966  r, "rel_area_dif
+0001c970: 6622 2c0a 2020 2020 2020 2020 2020 2020  f",.            
+0001c980: 2020 2020 2020 2020 6279 5f73 6c69 6365          by_slice
+0001c990: 2c20 7669 6577 2c20 6d65 7468 6f64 290a  , view, method).
+0001c9a0: 0a20 2020 2020 2020 206f 776e 5f61 7265  .        own_are
+0001c9b0: 6120 3d20 7365 6c66 2e67 6574 5f61 7265  a = self.get_are
+0001c9c0: 6128 7669 6577 2c20 736c 2c20 6964 782c  a(view, sl, idx,
+0001c9d0: 2070 6f73 2c20 756e 6974 732c 206d 6574   pos, units, met
+0001c9e0: 686f 642c 2066 6c61 7474 656e 290a 2020  hod, flatten).  
+0001c9f0: 2020 2020 2020 6172 6561 5f64 6966 6620        area_diff 
+0001ca00: 3d20 7365 6c66 2e67 6574 5f61 7265 615f  = self.get_area_
+0001ca10: 6469 6666 286f 7468 6572 2c20 7669 6577  diff(other, view
+0001ca20: 2c20 736c 2c20 6964 782c 2070 6f73 2c20  , sl, idx, pos, 
+0001ca30: 756e 6974 732c 206d 6574 686f 642c 0a20  units, method,. 
+0001ca40: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001ca50: 6c61 7474 656e 290a 0a20 2020 2020 2020  latten)..       
+0001ca60: 2069 6620 6172 6561 5f64 6966 6620 6973   if area_diff is
+0001ca70: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0001ca80: 2020 2072 6574 7572 6e20 7661 6c75 655f     return value_
+0001ca90: 666f 725f 6e6f 6e65 0a20 2020 2020 2020  for_none.       
+0001caa0: 2072 6574 7572 6e20 6172 6561 5f64 6966   return area_dif
+0001cab0: 6620 2f20 6f77 6e5f 6172 6561 0a0a 2020  f / own_area..  
+0001cac0: 2020 6465 6620 6765 745f 696e 7465 7273    def get_inters
+0001cad0: 6563 7469 6f6e 5f75 6e69 6f6e 5f73 697a  ection_union_siz
+0001cae0: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
+0001caf0: 200a 2020 2020 2020 2020 6f74 6865 722c   .        other,
+0001cb00: 200a 2020 2020 2020 2020 7369 6e67 6c65   .        single
+0001cb10: 5f73 6c69 6365 3d46 616c 7365 2c0a 2020  _slice=False,.  
+0001cb20: 2020 2020 2020 7669 6577 3d22 782d 7922        view="x-y"
+0001cb30: 2c20 0a20 2020 2020 2020 2073 6c3d 4e6f  , .        sl=No
+0001cb40: 6e65 2c20 0a20 2020 2020 2020 2069 6478  ne, .        idx
+0001cb50: 3d4e 6f6e 652c 200a 2020 2020 2020 2020  =None, .        
+0001cb60: 706f 733d 4e6f 6e65 2c20 0a20 2020 2020  pos=None, .     
+0001cb70: 2020 206d 6574 686f 643d 4e6f 6e65 2c0a     method=None,.
+0001cb80: 2020 2020 2020 2020 666c 6174 7465 6e3d          flatten=
+0001cb90: 4661 6c73 652c 0a20 2020 2029 3a0a 2020  False,.    ):.  
+0001cba0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001cbb0: 2020 4765 7420 696e 7465 7273 6563 7469    Get intersecti
+0001cbc0: 6f6e 2c20 756e 696f 6e20 616e 6420 6d65  on, union and me
+0001cbd0: 616e 2073 697a 6520 7769 7468 2072 6573  an size with res
+0001cbe0: 7065 6374 2074 6f20 616e 6f74 6865 7220  pect to another 
+0001cbf0: 524f 492e 0a20 2020 2020 2020 2056 616c  ROI..        Val
+0001cc00: 7565 7320 6172 6520 7265 7475 726e 6564  ues are returned
+0001cc10: 2061 7320 766f 6c75 6d65 7320 666f 7220   as volumes for 
+0001cc20: 7468 6520 6675 6c6c 2052 4f49 732c 0a20  the full ROIs,. 
+0001cc30: 2020 2020 2020 206f 7220 6173 2061 7265         or as are
+0001cc40: 6173 2066 6f72 2061 2073 696e 676c 6520  as for a single 
+0001cc50: 736c 6963 652e 0a0a 2020 2020 2020 2020  slice...        
+0001cc60: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+0001cc70: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0001cc80: 206f 7468 6572 203a 2052 4f49 0a20 2020   other : ROI.   
+0001cc90: 2020 2020 2020 2020 204f 7468 6572 2052           Other R
+0001cca0: 4f49 2074 6f20 636f 6d70 6172 6520 7769  OI to compare wi
+0001ccb0: 7468 2074 6869 7320 524f 492e 0a0a 2020  th this ROI...  
+0001ccc0: 2020 2020 2020 7369 6e67 6c65 5f73 6c69        single_sli
+0001ccd0: 6365 203a 2062 6f6f 6c2c 2064 6566 6175  ce : bool, defau
+0001cce0: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
+0001ccf0: 2020 2020 2049 6620 4661 6c73 652c 2074       If False, t
+0001cd00: 6865 2076 6f6c 756d 6573 206f 6620 696e  he volumes of in
+0001cd10: 7465 7273 6563 7469 6f6e 2061 6e64 2020  tersection and  
+0001cd20: 756e 696f 6e20 6f66 2074 6865 2066 756c  union of the ful
+0001cd30: 6c20 524f 4973 2c0a 2020 2020 2020 2020  l ROIs,.        
+0001cd40: 2020 2020 616e 6420 7468 6520 6d65 616e      and the mean
+0001cd50: 2052 4f49 2076 6f6c 756d 6520 7769 6c6c   ROI volume will
+0001cd60: 2062 6520 7265 7475 726e 6564 3b0a 2020   be returned;.  
+0001cd70: 2020 2020 2020 2020 2020 6f74 6865 7277            otherw
+0001cd80: 6973 652c 2074 6865 2061 7265 6173 206f  ise, the areas o
+0001cd90: 6620 696e 7465 7273 6563 7469 6f6e 2061  f intersection a
+0001cda0: 6e64 2075 6e69 6f6e 206f 6e20 6120 7369  nd union on a si
+0001cdb0: 6e67 6c65 2073 6c69 6365 2c0a 2020 2020  ngle slice,.    
+0001cdc0: 2020 2020 2020 2020 616e 6420 7468 6520          and the 
+0001cdd0: 6d65 616e 2052 4f49 2061 7265 612c 2077  mean ROI area, w
+0001cde0: 696c 6c20 6265 2072 6574 7572 6e65 642e  ill be returned.
+0001cdf0: 0a0a 2020 2020 2020 2020 7669 6577 203a  ..        view :
+0001ce00: 2073 7472 2c20 6465 6661 756c 743d 2278   str, default="x
+0001ce10: 2d79 220a 2020 2020 2020 2020 2020 2020  -y".            
+0001ce20: 4f72 6965 6e74 6174 696f 6e20 6f66 2073  Orientation of s
+0001ce30: 6c69 6365 206f 6e20 7768 6963 6820 746f  lice on which to
+0001ce40: 2067 6574 2061 7265 6173 206f 6620 696e   get areas of in
+0001ce50: 7465 7273 6563 7469 6f6e 0a20 2020 2020  tersection.     
+0001ce60: 2020 2020 2020 2061 6e64 2075 6e69 6f6e         and union
+0001ce70: 2c20 616e 6420 6d65 616e 2052 4f49 2061  , and mean ROI a
+0001ce80: 7265 612e 2020 4f6e 6c79 2075 7365 6420  rea.  Only used 
+0001ce90: 6966 2073 696e 676c 655f 736c 6963 653d  if single_slice=
+0001cea0: 5472 7565 2e0a 0a20 2020 2020 2020 2073  True...        s
+0001ceb0: 6c20 3a20 696e 742c 2064 6566 6175 6c74  l : int, default
+0001cec0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0001ced0: 2020 536c 6963 6520 6e75 6d62 6572 2e20    Slice number. 
+0001cee0: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
+0001cef0: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
+0001cf00: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
+0001cf10: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
+0001cf20: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
+0001cf30: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
+0001cf40: 2073 6c69 6365 206f 6620 7468 6973 2052   slice of this R
+0001cf50: 4f49 2077 696c 6c20 6265 2075 7365 642e  OI will be used.
+0001cf60: 0a0a 2020 2020 2020 2020 6964 7820 3a20  ..        idx : 
+0001cf70: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
+0001cf80: 650a 2020 2020 2020 2020 2020 2020 4172  e.            Ar
+0001cf90: 7261 7920 696e 6465 7820 6f66 2073 6c69  ray index of sli
+0001cfa0: 6365 2e20 4966 206e 6f6e 6520 6f66 203c  ce. If none of <
+0001cfb0: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
+0001cfc0: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
+0001cfd0: 0a20 2020 2020 2020 2020 2020 2062 7574  .            but
+0001cfe0: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
+0001cff0: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
+0001d000: 7472 616c 2073 6c69 6365 206f 6620 7468  tral slice of th
+0001d010: 6973 2052 4f49 2077 696c 6c20 6265 0a20  is ROI will be. 
+0001d020: 2020 2020 2020 2020 2020 2075 7365 642e             used.
+0001d030: 0a0a 2020 2020 2020 2020 706f 7320 3a20  ..        pos : 
+0001d040: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+0001d050: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0001d060: 536c 6963 6520 706f 7369 7469 6f6e 2069  Slice position i
+0001d070: 6e20 6d6d 2e20 4966 206e 6f6e 6520 6f66  n mm. If none of
+0001d080: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
+0001d090: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
+0001d0a0: 6564 0a20 2020 2020 2020 2020 2020 2062  ed.            b
+0001d0b0: 7574 203c 7369 6e67 6c65 5f73 6c69 6365  ut <single_slice
+0001d0c0: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
+0001d0d0: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
+0001d0e0: 7468 6973 2052 4f49 2077 696c 6c0a 2020  this ROI will.  
+0001d0f0: 2020 2020 2020 2020 2020 6265 2075 7365            be use
+0001d100: 642e 0a0a 2020 2020 2020 2020 6d65 7468  d...        meth
+0001d110: 6f64 203a 2073 7472 2c20 6465 6661 756c  od : str, defaul
+0001d120: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+0001d130: 2020 204d 6574 686f 6420 746f 2075 7365     Method to use
+0001d140: 2066 6f72 2063 616c 6375 6c61 7469 6e67   for calculating
+0001d150: 2069 6e74 6572 7365 6374 696f 6e2c 2075   intersection, u
+0001d160: 6e69 6f6e 2c20 616e 6420 6d65 616e 0a20  nion, and mean. 
+0001d170: 2020 2020 2020 2020 2020 2073 697a 652e             size.
+0001d180: 2043 616e 2062 653a 200a 2020 2020 2020   Can be: .      
+0001d190: 2020 2020 2020 2020 2020 2d20 2263 6f6e            - "con
+0001d1a0: 746f 7572 223a 2067 6574 2069 6e74 6572  tour": get inter
+0001d1b0: 7365 6374 696f 6e73 2061 6e64 2061 7265  sections and are
+0001d1c0: 6173 206f 6620 7368 6170 656c 7920 636f  as of shapely co
+0001d1d0: 6e74 6f75 7273 2e0a 2020 2020 2020 2020  ntours..        
+0001d1e0: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
+0001d1f0: 3a20 636f 756e 7420 696e 7465 7273 6563  : count intersec
+0001d200: 7469 6e67 2076 6f78 656c 7320 696e 2062  ting voxels in b
+0001d210: 696e 6172 7920 6d61 736b 732e 0a20 2020  inary masks..   
+0001d220: 2020 2020 2020 2020 2020 2020 202d 204e               - N
+0001d230: 6f6e 653a 2075 7365 2074 6865 206d 6574  one: use the met
+0001d240: 686f 6420 7365 7420 696e 2073 656c 662e  hod set in self.
+0001d250: 6465 6661 756c 745f 6765 6f6d 5f6d 6574  default_geom_met
+0001d260: 686f 642e 0a0a 2020 2020 2020 2020 666c  hod...        fl
+0001d270: 6174 7465 6e20 3a20 626f 6f6c 2c20 6465  atten : bool, de
+0001d280: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+0001d290: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+0001d2a0: 2061 6c6c 2073 6c69 6365 7320 7769 6c6c   all slices will
+0001d2b0: 2062 6520 666c 6174 7465 6e65 6420 696e   be flattened in
+0001d2c0: 2074 6865 2067 6976 656e 206f 7269 656e   the given orien
+0001d2d0: 7461 7469 6f6e 2061 6e64 0a20 2020 2020  tation and.     
+0001d2e0: 2020 2020 2020 2074 6865 2061 7265 6173         the areas
+0001d2f0: 206f 6620 696e 7465 7273 6563 7469 6f6e   of intersection
+0001d300: 2061 6e64 2075 6e69 6f6e 2c20 616e 6420   and union, and 
+0001d310: 7468 6520 6d65 616e 2052 4f49 2061 7265  the mean ROI are
+0001d320: 612c 0a20 2020 2020 2020 2020 2020 2077  a,.            w
+0001d330: 696c 6c20 6265 2072 6574 7572 6e65 6420  ill be returned 
+0001d340: 666f 7220 7468 6520 666c 6174 7465 6e65  for the flattene
+0001d350: 6420 736c 6963 6573 2e20 4f6e 6c79 2061  d slices. Only a
+0001d360: 7661 696c 6162 6c65 0a20 2020 2020 2020  vailable.       
+0001d370: 2020 2020 2069 6620 6d65 7468 6f64 3d22       if method="
+0001d380: 6d61 736b 222e 0a20 2020 2020 2020 2022  mask"..        "
+0001d390: 2222 0a0a 2020 2020 2020 2020 7365 6c66  ""..        self
+0001d3a0: 2e63 7265 6174 655f 6d61 736b 2829 0a0a  .create_mask()..
+0001d3b0: 2020 2020 2020 2020 2320 4465 6669 6e65          # Define
+0001d3c0: 2076 6f78 656c 2076 6f6c 756d 652c 2061   voxel volume, a
+0001d3d0: 6e64 2076 6f78 656c 2061 7265 6120 696e  nd voxel area in
+0001d3e0: 2076 6965 772e 0a20 2020 2020 2020 2076   view..        v
+0001d3f0: 6f78 656c 5f76 6f6c 756d 6520 3d20 310a  oxel_volume = 1.
+0001d400: 2020 2020 2020 2020 666f 7220 6478 797a          for dxyz
+0001d410: 2069 6e20 7365 6c66 2e6d 6173 6b2e 766f   in self.mask.vo
+0001d420: 7865 6c5f 7369 7a65 3a0a 2020 2020 2020  xel_size:.      
+0001d430: 2020 2020 2020 766f 7865 6c5f 766f 6c75        voxel_volu
+0001d440: 6d65 202a 3d20 6478 797a 0a20 2020 2020  me *= dxyz.     
+0001d450: 2020 207a 5f61 7820 3d20 736b 7274 2e69     z_ax = skrt.i
+0001d460: 6d61 6765 2e5f 736c 6963 655f 6178 6573  mage._slice_axes
+0001d470: 5b76 6965 775d 0a20 2020 2020 2020 2073  [view].        s
+0001d480: 6c69 6365 5f74 6869 636b 6e65 7373 203d  lice_thickness =
+0001d490: 2073 656c 662e 6d61 736b 2e76 6f78 656c   self.mask.voxel
+0001d4a0: 5f73 697a 655b 7a5f 6178 5d0a 2020 2020  _size[z_ax].    
+0001d4b0: 2020 2020 766f 7865 6c5f 6172 6561 203d      voxel_area =
+0001d4c0: 2076 6f78 656c 5f76 6f6c 756d 6520 2f20   voxel_volume / 
+0001d4d0: 736c 6963 655f 7468 6963 6b6e 6573 730a  slice_thickness.
+0001d4e0: 0a20 2020 2020 2020 2023 2047 6574 2064  .        # Get d
+0001d4f0: 6566 6175 6c74 2073 6c69 6365 2061 6e64  efault slice and
+0001d500: 206d 6574 686f 640a 2020 2020 2020 2020   method.        
+0001d510: 6966 2073 696e 676c 655f 736c 6963 653a  if single_slice:
+0001d520: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001d530: 736c 2069 7320 4e6f 6e65 2061 6e64 2069  sl is None and i
+0001d540: 6478 2069 7320 4e6f 6e65 2061 6e64 2070  dx is None and p
+0001d550: 6f73 2069 7320 4e6f 6e65 3a0a 2020 2020  os is None:.    
+0001d560: 2020 2020 2020 2020 2020 2020 6964 7820              idx 
+0001d570: 3d20 7365 6c66 2e67 6574 5f6d 6964 5f69  = self.get_mid_i
+0001d580: 6478 2876 6965 7729 0a20 2020 2020 2020  dx(view).       
+0001d590: 2069 6620 6d65 7468 6f64 2069 7320 4e6f   if method is No
+0001d5a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0001d5b0: 6d65 7468 6f64 203d 2073 656c 662e 6465  method = self.de
+0001d5c0: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
+0001d5d0: 640a 0a20 2020 2020 2020 2069 6620 666c  d..        if fl
+0001d5e0: 6174 7465 6e3a 2020 2320 466c 6174 7465  atten:  # Flatte
+0001d5f0: 6e69 6e67 206f 6e6c 7920 706f 7373 6962  ning only possib
+0001d600: 6c65 2077 6974 6820 226d 6173 6b22 0a20  le with "mask". 
+0001d610: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+0001d620: 6420 3d20 226d 6173 6b22 0a0a 2020 2020  d = "mask"..    
+0001d630: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
+0001d640: 696e 7465 7273 6563 7469 6f6e 7320 616e  intersections an
+0001d650: 6420 6172 6561 7320 6672 6f6d 2070 6f6c  d areas from pol
+0001d660: 7967 6f6e 730a 2020 2020 2020 2020 6966  ygons.        if
+0001d670: 206d 6574 686f 6420 3d3d 2022 636f 6e74   method == "cont
+0001d680: 6f75 7222 3a0a 0a20 2020 2020 2020 2020  our":..         
+0001d690: 2020 2023 2047 6574 2070 6f73 6974 696f     # Get positio
+0001d6a0: 6e73 206f 6620 736c 6963 6528 7329 0a20  ns of slice(s). 
+0001d6b0: 2020 2020 2020 2020 2020 2023 206f 6e20             # on 
+0001d6c0: 7768 6963 6820 746f 2063 6f6d 7061 7265  which to compare
+0001d6d0: 2061 7265 6173 2061 6e64 2074 6f74 616c   areas and total
+0001d6e0: 2061 7265 6173 2e0a 2020 2020 2020 2020   areas..        
+0001d6f0: 2020 2020 6966 206e 6f74 2073 696e 676c      if not singl
+0001d700: 655f 736c 6963 653a 0a20 2020 2020 2020  e_slice:.       
+0001d710: 2020 2020 2020 2020 2070 6f73 6974 696f           positio
+0001d720: 6e73 203d 2073 6574 2873 656c 662e 6765  ns = set(self.ge
+0001d730: 745f 636f 6e74 6f75 7273 2822 782d 7922  t_contours("x-y"
+0001d740: 292e 6b65 7973 2829 292e 756e 696f 6e28  ).keys()).union(
+0001d750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d760: 2020 2020 2020 2020 2073 6574 286f 7468           set(oth
+0001d770: 6572 2e67 6574 5f63 6f6e 746f 7572 7328  er.get_contours(
+0001d780: 2278 2d79 2229 2e6b 6579 7328 2929 290a  "x-y").keys())).
 0001d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7a0: 2020 2020 2066 6f72 2070 2069 6e20 706f       for p in po
-0001d7b0: 7369 7469 6f6e 735d 0a20 2020 2020 2020  sitions].       
-0001d7c0: 2020 2020 2020 2020 2076 6f6c 756d 6573           volumes
-0001d7d0: 3120 3d20 5b61 202a 2073 6c69 6365 5f74  1 = [a * slice_t
-0001d7e0: 6869 636b 6e65 7373 2066 6f72 2061 2069  hickness for a i
-0001d7f0: 6e20 6172 6561 7331 2069 6620 615d 0a20  n areas1 if a]. 
-0001d800: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0001d810: 6f6c 756d 6531 203d 2073 756d 2876 6f6c  olume1 = sum(vol
-0001d820: 756d 6573 3129 0a20 2020 2020 2020 2020  umes1).         
-0001d830: 2020 2020 2020 2061 7265 6173 3220 3d20         areas2 = 
-0001d840: 5b6f 7468 6572 2e67 6574 5f61 7265 6128  [other.get_area(
-0001d850: 2278 2d79 222c 2070 6f73 3d70 2c20 6d65  "x-y", pos=p, me
-0001d860: 7468 6f64 3d6d 6574 686f 6429 0a20 2020  thod=method).   
-0001d870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d880: 2020 2020 2066 6f72 2070 2069 6e20 706f       for p in po
-0001d890: 7369 7469 6f6e 735d 0a20 2020 2020 2020  sitions].       
-0001d8a0: 2020 2020 2020 2020 2076 6f6c 756d 6573           volumes
-0001d8b0: 3220 3d20 5b61 202a 2073 6c69 6365 5f74  2 = [a * slice_t
-0001d8c0: 6869 636b 6e65 7373 2066 6f72 2061 2069  hickness for a i
-0001d8d0: 6e20 6172 6561 7332 2069 6620 615d 0a20  n areas2 if a]. 
-0001d8e0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0001d8f0: 6f6c 756d 6532 203d 2073 756d 2876 6f6c  olume2 = sum(vol
-0001d900: 756d 6573 3229 0a20 2020 2020 2020 2020  umes2).         
-0001d910: 2020 2020 2020 206d 6561 6e5f 7369 7a65         mean_size
-0001d920: 203d 2030 2e35 202a 2028 766f 6c75 6d65   = 0.5 * (volume
-0001d930: 3120 2b20 766f 6c75 6d65 3229 0a20 2020  1 + volume2).   
-0001d940: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001d950: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001d960: 6f73 6974 696f 6e73 203d 205b 0a20 2020  ositions = [.   
-0001d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d980: 2073 656c 662e 6964 785f 746f 5f70 6f73   self.idx_to_pos
-0001d990: 2873 656c 662e 6765 745f 6964 7828 7669  (self.get_idx(vi
-0001d9a0: 6577 2c20 736c 2c20 6964 782c 2070 6f73  ew, sl, idx, pos
-0001d9b0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0001d9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9d0: 2020 2020 2020 2061 783d 736b 7274 2e69         ax=skrt.i
-0001d9e0: 6d61 6765 2e5f 736c 6963 655f 6178 6573  mage._slice_axes
-0001d9f0: 5b76 6965 775d 290a 2020 2020 2020 2020  [view]).        
-0001da00: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-0001da10: 2020 2020 2020 2020 2020 6172 6561 3120            area1 
-0001da20: 3d20 7365 6c66 2e67 6574 5f61 7265 6128  = self.get_area(
-0001da30: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
-0001da40: 6f73 2c20 6d65 7468 6f64 3d6d 6574 686f  os, method=metho
-0001da50: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
-0001da60: 2020 2069 6620 6172 6561 3120 6973 204e     if area1 is N
-0001da70: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0001da80: 2020 2020 2020 2020 2061 7265 6131 203d           area1 =
-0001da90: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
-0001daa0: 2020 2061 7265 6132 203d 206f 7468 6572     area2 = other
-0001dab0: 2e67 6574 5f61 7265 6128 7669 6577 2c20  .get_area(view, 
-0001dac0: 736c 2c20 6964 782c 2070 6f73 2c20 6d65  sl, idx, pos, me
-0001dad0: 7468 6f64 3d6d 6574 686f 6429 0a20 2020  thod=method).   
-0001dae0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001daf0: 6172 6561 3220 6973 204e 6f6e 653a 0a20  area2 is None:. 
-0001db00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db10: 2020 2061 7265 6132 203d 2030 0a20 2020     area2 = 0.   
-0001db20: 2020 2020 2020 2020 2020 2020 206d 6561               mea
-0001db30: 6e5f 7369 7a65 203d 2030 2e35 202a 2028  n_size = 0.5 * (
-0001db40: 6172 6561 3120 2b20 6172 6561 3229 0a20  area1 + area2). 
-0001db50: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0001db60: 2020 2020 2020 2020 2320 436f 6d70 7574          # Comput
-0001db70: 6520 6172 6561 7320 6f66 2069 6e74 6572  e areas of inter
-0001db80: 7365 6374 696f 6e20 616e 6420 756e 696f  section and unio
-0001db90: 6e20 6f6e 2073 6c69 6365 2873 290a 2020  n on slice(s).  
-0001dba0: 2020 2020 2020 2020 2020 696e 7465 7273            inters
-0001dbb0: 6563 7469 6f6e 203d 2030 0a20 2020 2020  ection = 0.     
-0001dbc0: 2020 2020 2020 2075 6e69 6f6e 203d 2030         union = 0
-0001dbd0: 0a20 2020 2020 2020 2020 2020 2066 6163  .            fac
-0001dbe0: 746f 7220 3d20 3120 6966 2028 7369 6e67  tor = 1 if (sing
-0001dbf0: 6c65 5f73 6c69 6365 206f 7220 666c 6174  le_slice or flat
-0001dc00: 7465 6e29 2065 6c73 6520 736c 6963 655f  ten) else slice_
-0001dc10: 7468 6963 6b6e 6573 730a 2020 2020 2020  thickness.      
-0001dc20: 2020 2020 2020 666f 7220 7020 696e 2070        for p in p
-0001dc30: 6f73 6974 696f 6e73 3a0a 2020 2020 2020  ositions:.      
-0001dc40: 2020 2020 2020 2020 2020 7365 7431 203d            set1 =
-0001dc50: 206f 7073 2e75 6e61 7279 5f75 6e69 6f6e   ops.unary_union
-0001dc60: 2873 656c 662e 6765 745f 706f 6c79 676f  (self.get_polygo
-0001dc70: 6e73 5f6f 6e5f 736c 6963 6528 7669 6577  ns_on_slice(view
-0001dc80: 2c20 706f 733d 7029 290a 2020 2020 2020  , pos=p)).      
-0001dc90: 2020 2020 2020 2020 2020 7365 7432 203d            set2 =
-0001dca0: 206f 7073 2e75 6e61 7279 5f75 6e69 6f6e   ops.unary_union
-0001dcb0: 286f 7468 6572 2e67 6574 5f70 6f6c 7967  (other.get_polyg
-0001dcc0: 6f6e 735f 6f6e 5f73 6c69 6365 2876 6965  ons_on_slice(vie
-0001dcd0: 772c 2070 6f73 3d70 2929 0a20 2020 2020  w, pos=p)).     
-0001dce0: 2020 2020 2020 2020 2020 2069 6e74 6572             inter
-0001dcf0: 7365 6374 696f 6e20 2b3d 2073 6574 312e  section += set1.
-0001dd00: 696e 7465 7273 6563 7469 6f6e 2873 6574  intersection(set
-0001dd10: 3229 2e61 7265 6120 2a20 6661 6374 6f72  2).area * factor
-0001dd20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001dd30: 2075 6e69 6f6e 202b 3d20 7365 7431 2e75   union += set1.u
-0001dd40: 6e69 6f6e 2873 6574 3229 2e61 7265 6120  nion(set2).area 
-0001dd50: 2a20 6661 6374 6f72 0a0a 2020 2020 2020  * factor..      
-0001dd60: 2020 2320 4361 6c63 756c 6174 6520 696e    # Calculate in
-0001dd70: 7465 7273 6563 7469 6f6e 7320 616e 6420  tersections and 
-0001dd80: 6172 6561 7320 6672 6f6d 2062 696e 6172  areas from binar
-0001dd90: 7920 6d61 736b 2076 6f78 656c 2063 6f75  y mask voxel cou
-0001dda0: 6e74 730a 2020 2020 2020 2020 656c 7365  nts.        else
-0001ddb0: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
-0001ddc0: 2055 7365 2033 4420 6d61 736b 0a20 2020   Use 3D mask.   
-0001ddd0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0001dde0: 7369 6e67 6c65 5f73 6c69 6365 3a0a 2020  single_slice:.  
-0001ddf0: 2020 2020 2020 2020 2020 2020 2020 6461                da
-0001de00: 7461 3120 3d20 7365 6c66 2e67 6574 5f6d  ta1 = self.get_m
-0001de10: 6173 6b28 7669 6577 2c20 666c 6174 7465  ask(view, flatte
-0001de20: 6e2c 2073 7461 6e64 6172 6469 7365 3d54  n, standardise=T
-0001de30: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0001de40: 2020 2020 2064 6174 6132 203d 206f 7468       data2 = oth
-0001de50: 6572 2e67 6574 5f6d 6173 6b28 7669 6577  er.get_mask(view
+0001d7a0: 6172 6561 7331 203d 205b 7365 6c66 2e67  areas1 = [self.g
+0001d7b0: 6574 5f61 7265 6128 2278 2d79 222c 2070  et_area("x-y", p
+0001d7c0: 6f73 3d70 2c20 6d65 7468 6f64 3d6d 6574  os=p, method=met
+0001d7d0: 686f 6429 0a20 2020 2020 2020 2020 2020  hod).           
+0001d7e0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001d7f0: 2070 2069 6e20 706f 7369 7469 6f6e 735d   p in positions]
+0001d800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d810: 2076 6f6c 756d 6573 3120 3d20 5b61 202a   volumes1 = [a *
+0001d820: 2073 6c69 6365 5f74 6869 636b 6e65 7373   slice_thickness
+0001d830: 2066 6f72 2061 2069 6e20 6172 6561 7331   for a in areas1
+0001d840: 2069 6620 615d 0a20 2020 2020 2020 2020   if a].         
+0001d850: 2020 2020 2020 2076 6f6c 756d 6531 203d         volume1 =
+0001d860: 2073 756d 2876 6f6c 756d 6573 3129 0a20   sum(volumes1). 
+0001d870: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0001d880: 7265 6173 3220 3d20 5b6f 7468 6572 2e67  reas2 = [other.g
+0001d890: 6574 5f61 7265 6128 2278 2d79 222c 2070  et_area("x-y", p
+0001d8a0: 6f73 3d70 2c20 6d65 7468 6f64 3d6d 6574  os=p, method=met
+0001d8b0: 686f 6429 0a20 2020 2020 2020 2020 2020  hod).           
+0001d8c0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001d8d0: 2070 2069 6e20 706f 7369 7469 6f6e 735d   p in positions]
+0001d8e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d8f0: 2076 6f6c 756d 6573 3220 3d20 5b61 202a   volumes2 = [a *
+0001d900: 2073 6c69 6365 5f74 6869 636b 6e65 7373   slice_thickness
+0001d910: 2066 6f72 2061 2069 6e20 6172 6561 7332   for a in areas2
+0001d920: 2069 6620 615d 0a20 2020 2020 2020 2020   if a].         
+0001d930: 2020 2020 2020 2076 6f6c 756d 6532 203d         volume2 =
+0001d940: 2073 756d 2876 6f6c 756d 6573 3229 0a20   sum(volumes2). 
+0001d950: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001d960: 6561 6e5f 7369 7a65 203d 2030 2e35 202a  ean_size = 0.5 *
+0001d970: 2028 766f 6c75 6d65 3120 2b20 766f 6c75   (volume1 + volu
+0001d980: 6d65 3229 0a20 2020 2020 2020 2020 2020  me2).           
+0001d990: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001d9a0: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
+0001d9b0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+0001d9c0: 2020 2020 2020 2020 2073 656c 662e 6964           self.id
+0001d9d0: 785f 746f 5f70 6f73 2873 656c 662e 6765  x_to_pos(self.ge
+0001d9e0: 745f 6964 7828 7669 6577 2c20 736c 2c20  t_idx(view, sl, 
+0001d9f0: 6964 782c 2070 6f73 292c 0a20 2020 2020  idx, pos),.     
+0001da00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da10: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0001da20: 783d 736b 7274 2e69 6d61 6765 2e5f 736c  x=skrt.image._sl
+0001da30: 6963 655f 6178 6573 5b76 6965 775d 290a  ice_axes[view]).
+0001da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da50: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001da60: 2020 6172 6561 3120 3d20 7365 6c66 2e67    area1 = self.g
+0001da70: 6574 5f61 7265 6128 7669 6577 2c20 736c  et_area(view, sl
+0001da80: 2c20 6964 782c 2070 6f73 2c20 6d65 7468  , idx, pos, meth
+0001da90: 6f64 3d6d 6574 686f 6429 0a20 2020 2020  od=method).     
+0001daa0: 2020 2020 2020 2020 2020 2069 6620 6172             if ar
+0001dab0: 6561 3120 6973 204e 6f6e 653a 0a20 2020  ea1 is None:.   
+0001dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dad0: 2061 7265 6131 203d 2030 0a20 2020 2020   area1 = 0.     
+0001dae0: 2020 2020 2020 2020 2020 2061 7265 6132             area2
+0001daf0: 203d 206f 7468 6572 2e67 6574 5f61 7265   = other.get_are
+0001db00: 6128 7669 6577 2c20 736c 2c20 6964 782c  a(view, sl, idx,
+0001db10: 2070 6f73 2c20 6d65 7468 6f64 3d6d 6574   pos, method=met
+0001db20: 686f 6429 0a20 2020 2020 2020 2020 2020  hod).           
+0001db30: 2020 2020 2069 6620 6172 6561 3220 6973       if area2 is
+0001db40: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0001db50: 2020 2020 2020 2020 2020 2061 7265 6132             area2
+0001db60: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+0001db70: 2020 2020 206d 6561 6e5f 7369 7a65 203d       mean_size =
+0001db80: 2030 2e35 202a 2028 6172 6561 3120 2b20   0.5 * (area1 + 
+0001db90: 6172 6561 3229 0a20 2020 2020 2020 2020  area2).         
+0001dba0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0001dbb0: 2320 436f 6d70 7574 6520 6172 6561 7320  # Compute areas 
+0001dbc0: 6f66 2069 6e74 6572 7365 6374 696f 6e20  of intersection 
+0001dbd0: 616e 6420 756e 696f 6e20 6f6e 2073 6c69  and union on sli
+0001dbe0: 6365 2873 290a 2020 2020 2020 2020 2020  ce(s).          
+0001dbf0: 2020 696e 7465 7273 6563 7469 6f6e 203d    intersection =
+0001dc00: 2030 0a20 2020 2020 2020 2020 2020 2075   0.            u
+0001dc10: 6e69 6f6e 203d 2030 0a20 2020 2020 2020  nion = 0.       
+0001dc20: 2020 2020 2066 6163 746f 7220 3d20 3120       factor = 1 
+0001dc30: 6966 2028 7369 6e67 6c65 5f73 6c69 6365  if (single_slice
+0001dc40: 206f 7220 666c 6174 7465 6e29 2065 6c73   or flatten) els
+0001dc50: 6520 736c 6963 655f 7468 6963 6b6e 6573  e slice_thicknes
+0001dc60: 730a 2020 2020 2020 2020 2020 2020 666f  s.            fo
+0001dc70: 7220 7020 696e 2070 6f73 6974 696f 6e73  r p in positions
+0001dc80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001dc90: 2020 7365 7431 203d 206f 7073 2e75 6e61    set1 = ops.una
+0001dca0: 7279 5f75 6e69 6f6e 2873 656c 662e 6765  ry_union(self.ge
+0001dcb0: 745f 706f 6c79 676f 6e73 5f6f 6e5f 736c  t_polygons_on_sl
+0001dcc0: 6963 6528 7669 6577 2c20 706f 733d 7029  ice(view, pos=p)
+0001dcd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001dce0: 2020 7365 7432 203d 206f 7073 2e75 6e61    set2 = ops.una
+0001dcf0: 7279 5f75 6e69 6f6e 286f 7468 6572 2e67  ry_union(other.g
+0001dd00: 6574 5f70 6f6c 7967 6f6e 735f 6f6e 5f73  et_polygons_on_s
+0001dd10: 6c69 6365 2876 6965 772c 2070 6f73 3d70  lice(view, pos=p
+0001dd20: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0001dd30: 2020 2069 6e74 6572 7365 6374 696f 6e20     intersection 
+0001dd40: 2b3d 2073 6574 312e 696e 7465 7273 6563  += set1.intersec
+0001dd50: 7469 6f6e 2873 6574 3229 2e61 7265 6120  tion(set2).area 
+0001dd60: 2a20 6661 6374 6f72 0a20 2020 2020 2020  * factor.       
+0001dd70: 2020 2020 2020 2020 2075 6e69 6f6e 202b           union +
+0001dd80: 3d20 7365 7431 2e75 6e69 6f6e 2873 6574  = set1.union(set
+0001dd90: 3229 2e61 7265 6120 2a20 6661 6374 6f72  2).area * factor
+0001dda0: 0a0a 2020 2020 2020 2020 2320 4361 6c63  ..        # Calc
+0001ddb0: 756c 6174 6520 696e 7465 7273 6563 7469  ulate intersecti
+0001ddc0: 6f6e 7320 616e 6420 6172 6561 7320 6672  ons and areas fr
+0001ddd0: 6f6d 2062 696e 6172 7920 6d61 736b 2076  om binary mask v
+0001dde0: 6f78 656c 2063 6f75 6e74 730a 2020 2020  oxel counts.    
+0001ddf0: 2020 2020 656c 7365 3a0a 0a20 2020 2020      else:..     
+0001de00: 2020 2020 2020 2023 2055 7365 2033 4420         # Use 3D 
+0001de10: 6d61 736b 0a20 2020 2020 2020 2020 2020  mask.           
+0001de20: 2069 6620 6e6f 7420 7369 6e67 6c65 5f73   if not single_s
+0001de30: 6c69 6365 3a0a 2020 2020 2020 2020 2020  lice:.          
+0001de40: 2020 2020 2020 6461 7461 3120 3d20 7365        data1 = se
+0001de50: 6c66 2e67 6574 5f6d 6173 6b28 7669 6577  lf.get_mask(view
 0001de60: 2c20 666c 6174 7465 6e2c 2073 7461 6e64  , flatten, stand
-0001de70: 6172 6469 7365 3d54 7275 6529 0a0a 2020  ardise=True)..  
-0001de80: 2020 2020 2020 2020 2020 2320 4f74 6865            # Othe
-0001de90: 7277 6973 652c 2075 7365 2073 696e 676c  rwise, use singl
-0001dea0: 6520 3244 2073 6c69 6365 0a20 2020 2020  e 2D slice.     
-0001deb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001dec0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0001ded0: 6131 203d 2073 656c 662e 6765 745f 736c  a1 = self.get_sl
-0001dee0: 6963 6528 7669 6577 2c20 736c 2c20 6964  ice(view, sl, id
-0001def0: 782c 2070 6f73 290a 2020 2020 2020 2020  x, pos).        
-0001df00: 2020 2020 2020 2020 6461 7461 3220 3d20          data2 = 
-0001df10: 6f74 6865 722e 6765 745f 736c 6963 6528  other.get_slice(
-0001df20: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
-0001df30: 6f73 290a 0a20 2020 2020 2020 2020 2020  os)..           
-0001df40: 2066 6163 746f 7220 3d20 766f 7865 6c5f   factor = voxel_
-0001df50: 6172 6561 2069 6620 2873 696e 676c 655f  area if (single_
-0001df60: 736c 6963 6520 6f72 2066 6c61 7474 656e  slice or flatten
-0001df70: 2920 656c 7365 2076 6f78 656c 5f76 6f6c  ) else voxel_vol
-0001df80: 756d 650a 2020 2020 2020 2020 2020 2020  ume.            
-0001df90: 696e 7465 7273 6563 7469 6f6e 203d 2028  intersection = (
-0001dfa0: 6461 7461 3120 2620 6461 7461 3229 2e73  data1 & data2).s
-0001dfb0: 756d 2829 202a 2066 6163 746f 720a 2020  um() * factor.  
-0001dfc0: 2020 2020 2020 2020 2020 756e 696f 6e20            union 
-0001dfd0: 3d20 2864 6174 6131 207c 2064 6174 6132  = (data1 | data2
-0001dfe0: 292e 7375 6d28 2920 2a20 6661 6374 6f72  ).sum() * factor
-0001dff0: 0a20 2020 2020 2020 2020 2020 206d 6561  .            mea
-0001e000: 6e5f 7369 7a65 203d 2030 2e35 202a 2028  n_size = 0.5 * (
-0001e010: 6461 7461 312e 7375 6d28 2920 2b20 6461  data1.sum() + da
-0001e020: 7461 322e 7375 6d28 2929 202a 2066 6163  ta2.sum()) * fac
-0001e030: 746f 720a 0a20 2020 2020 2020 2072 6574  tor..        ret
-0001e040: 7572 6e20 2869 6e74 6572 7365 6374 696f  urn (intersectio
-0001e050: 6e2c 2075 6e69 6f6e 2c20 6d65 616e 5f73  n, union, mean_s
-0001e060: 697a 6529 0a0a 2020 2020 6465 6620 6765  ize)..    def ge
-0001e070: 745f 6d65 7472 6963 5f62 795f 736c 6963  t_metric_by_slic
-0001e080: 6528 7365 6c66 2c20 6f74 6865 722c 206d  e(self, other, m
-0001e090: 6574 7269 633d 4e6f 6e65 2c20 6279 5f73  etric=None, by_s
-0001e0a0: 6c69 6365 3d4e 6f6e 652c 0a20 2020 2020  lice=None,.     
-0001e0b0: 2020 2020 2020 2076 6965 773d 2278 2d79         view="x-y
-0001e0c0: 222c 206d 6574 686f 643d 4e6f 6e65 293a  ", method=None):
-0001e0d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001e0e0: 2020 2020 2047 6574 2064 6963 7469 6f6e       Get diction
-0001e0f0: 6172 7920 6f66 2073 6c69 6365 2d62 792d  ary of slice-by-
-0001e100: 736c 6963 6520 7661 6c75 6573 2066 6f72  slice values for
-0001e110: 2063 6f6d 7061 7269 736f 6e20 6d65 7472   comparison metr
-0001e120: 6963 2e0a 0a20 2020 2020 2020 2045 6163  ic...        Eac
-0001e130: 6820 6b65 7920 6f66 2074 6865 2072 6574  h key of the ret
-0001e140: 7572 6e65 6420 6469 6374 696f 6e61 7279  urned dictionary
-0001e150: 2069 7320 6120 736c 6963 6520 706f 7369   is a slice posi
-0001e160: 7469 6f6e 2028 6d6d 292c 2061 6e64 0a20  tion (mm), and. 
-0001e170: 2020 2020 2020 2074 6865 2061 7373 6f63         the assoc
-0001e180: 6961 7465 6420 7661 6c75 6520 6973 2074  iated value is t
-0001e190: 6865 206d 6574 7269 6320 7661 6c75 6520  he metric value 
-0001e1a0: 666f 7220 7468 6520 736c 6963 652e 0a0a  for the slice...
-0001e1b0: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
-0001e1c0: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
-0001e1d0: 206f 7468 6572 203a 2052 4f49 0a20 2020   other : ROI.   
-0001e1e0: 2020 2020 2020 2020 204f 7468 6572 2052           Other R
-0001e1f0: 4f49 2074 6f20 636f 6d70 6172 6520 7769  OI to compare wi
-0001e200: 7468 2074 6869 7320 524f 492e 0a0a 2020  th this ROI...  
-0001e210: 2020 2020 2020 6d65 7472 6963 203a 2073        metric : s
-0001e220: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
-0001e230: 0a20 2020 2020 2020 2020 2020 204d 6574  .            Met
-0001e240: 7269 6320 746f 2062 6520 6576 616c 7561  ric to be evalua
-0001e250: 7465 642e 0a0a 2020 2020 2020 2020 6279  ted...        by
-0001e260: 5f73 6c69 6365 3a20 7374 722c 2064 6566  _slice: str, def
-0001e270: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-0001e280: 2020 2020 2020 536c 6963 6573 2074 6f20        Slices to 
-0001e290: 6265 2063 6f6e 7369 6465 7265 642e 2020  be considered.  
-0001e2a0: 5468 6520 7661 6c69 6420 7370 6563 6966  The valid specif
-0001e2b0: 6963 6174 696f 6e73 2061 7265 3a0a 0a20  ications are:.. 
-0001e2c0: 2020 2020 2020 2020 2020 202d 2022 6c65             - "le
-0001e2d0: 6674 223a 2063 6f6e 7369 6465 7220 6f6e  ft": consider on
-0001e2e0: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
-0001e2f0: 6e69 6e67 2073 656c 663b 0a20 2020 2020  ning self;.     
-0001e300: 2020 2020 2020 202d 2022 7269 6768 7422         - "right"
-0001e310: 3a20 636f 6e73 6964 6572 206f 6e6c 7920  : consider only 
-0001e320: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
-0001e330: 6720 6f74 6865 7220 726f 693b 0a20 2020  g other roi;.   
-0001e340: 2020 2020 2020 2020 202d 2022 756e 696f           - "unio
-0001e350: 6e22 3a20 636f 6e73 6964 6572 2073 6c69  n": consider sli
-0001e360: 6365 7320 636f 6e74 6169 6e69 6e67 2065  ces containing e
-0001e370: 6974 6865 7220 6f66 2073 656c 6620 616e  ither of self an
-0001e380: 6420 6f74 6865 7220 726f 693b 0a20 2020  d other roi;.   
-0001e390: 2020 2020 2020 2020 202d 2022 696e 7465           - "inte
-0001e3a0: 7273 6563 7469 6f6e 223a 2063 6f6e 7369  rsection": consi
-0001e3b0: 6465 7220 736c 6963 6573 2063 6f6e 7461  der slices conta
-0001e3c0: 696e 696e 6720 626f 7468 206f 6620 7365  ining both of se
-0001e3d0: 6c66 2061 6e64 0a20 2020 2020 2020 2020  lf and.         
-0001e3e0: 2020 2020 206f 7468 6572 2072 6f69 2e0a       other roi..
-0001e3f0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-0001e400: 4e6f 6e65 2c20 7573 6520 736b 7274 2e63  None, use skrt.c
-0001e410: 6f72 652e 4465 6661 756c 7473 2829 2e62  ore.Defaults().b
-0001e420: 795f 736c 6963 650a 0a20 2020 2020 2020  y_slice..       
-0001e430: 2076 6965 7720 3a20 7374 722c 2064 6566   view : str, def
-0001e440: 6175 6c74 3d22 782d 7922 0a20 2020 2020  ault="x-y".     
-0001e450: 2020 2020 2020 204f 7269 656e 7461 7469         Orientati
-0001e460: 6f6e 206f 6620 736c 6963 6573 206f 6e20  on of slices on 
-0001e470: 7768 6963 6820 746f 2067 6574 206d 6574  which to get met
-0001e480: 7269 6320 7661 6c75 6573 2e0a 0a20 2020  ric values...   
-0001e490: 2020 2020 206d 6574 686f 6420 3a20 7374       method : st
-0001e4a0: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
-0001e4b0: 2020 2020 2020 2020 2020 2020 4d65 7468              Meth
-0001e4c0: 6f64 2074 6f20 7573 6520 666f 7220 6d65  od to use for me
-0001e4d0: 7472 6963 2063 616c 6375 6c61 7469 6f6e  tric calculation
-0001e4e0: 2e20 4361 6e20 6265 3a20 0a20 2020 2020  . Can be: .     
-0001e4f0: 2020 2020 2020 2020 2020 202d 2022 636f             - "co
-0001e500: 6e74 6f75 7222 3a20 6361 6c63 756c 6174  ntour": calculat
-0001e510: 6520 6d65 7472 6963 2066 726f 6d20 7368  e metric from sh
-0001e520: 6170 656c 7920 636f 6e74 6f75 7273 2e0a  apely contours..
-0001e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e540: 2d20 226d 6173 6b22 3a20 6361 6c63 7561  - "mask": calcua
-0001e550: 6c74 6520 6d65 7472 6963 2066 726f 6d20  lte metric from 
-0001e560: 6269 6e61 7279 206d 6173 6b73 2e0a 2020  binary masks..  
-0001e570: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
-0001e580: 4e6f 6e65 3a20 7573 6520 7468 6520 6d65  None: use the me
-0001e590: 7468 6f64 2073 6574 2069 6e20 7365 6c66  thod set in self
-0001e5a0: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
-0001e5b0: 7468 6f64 2e0a 2020 2020 2020 2020 2222  thod..        ""
-0001e5c0: 220a 2020 2020 2020 2020 6966 206d 6574  ".        if met
-0001e5d0: 7269 6320 6e6f 7420 696e 2067 6574 5f63  ric not in get_c
-0001e5e0: 6f6d 7061 7269 736f 6e5f 6d65 7472 6963  omparison_metric
-0001e5f0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0001e600: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
-0001e610: 726f 7228 6622 4d65 7472 6963 207b 6d65  ror(f"Metric {me
-0001e620: 7472 6963 7d20 6e6f 7420 7265 636f 676e  tric} not recogn
-0001e630: 6973 6564 2062 7920 220a 2020 2020 2020  ised by ".      
-0001e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e650: 2020 2252 4f49 2e67 6574 5f6d 6574 7269    "ROI.get_metri
-0001e660: 635f 6279 5f73 6c69 6365 2829 2229 0a0a  c_by_slice()")..
-0001e670: 2020 2020 2020 2020 6279 5f73 6c69 6365          by_slice
-0001e680: 203d 2062 795f 736c 6963 6520 6f72 2073   = by_slice or s
-0001e690: 6b72 742e 636f 7265 2e44 6566 6175 6c74  krt.core.Default
-0001e6a0: 7328 292e 6279 5f73 6c69 6365 0a0a 2020  s().by_slice..  
-0001e6b0: 2020 2020 2020 7265 7475 726e 207b 706f        return {po
-0001e6c0: 733a 2067 6574 6174 7472 2873 656c 662c  s: getattr(self,
-0001e6d0: 2066 2267 6574 5f7b 6765 745f 6d65 7472   f"get_{get_metr
-0001e6e0: 6963 5f6d 6574 686f 6428 6d65 7472 6963  ic_method(metric
-0001e6f0: 297d 2229 280a 2020 2020 2020 2020 2020  )}")(.          
-0001e700: 2020 6f74 6865 722c 2073 696e 676c 655f    other, single_
-0001e710: 736c 6963 653d 5472 7565 2c20 7669 6577  slice=True, view
-0001e720: 3d76 6965 772c 2070 6f73 3d70 6f73 2c20  =view, pos=pos, 
-0001e730: 6d65 7468 6f64 3d6d 6574 686f 6429 0a20  method=method). 
-0001e740: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
-0001e750: 6f73 2069 6e20 7365 6c66 2e67 6574 5f73  os in self.get_s
-0001e760: 6c69 6365 5f70 6f73 6974 696f 6e73 286f  lice_positions(o
-0001e770: 7468 6572 2c20 7669 6577 2c20 6d65 7468  ther, view, meth
-0001e780: 6f64 3d62 795f 736c 6963 6529 7d0a 0a20  od=by_slice)}.. 
-0001e790: 2020 2064 6566 2067 6574 5f73 6c69 6365     def get_slice
-0001e7a0: 5f73 7461 7428 7365 6c66 2c20 6f74 6865  _stat(self, othe
-0001e7b0: 722c 206d 6574 7269 633d 4e6f 6e65 2c20  r, metric=None, 
-0001e7c0: 736c 6963 655f 7374 6174 3d4e 6f6e 652c  slice_stat=None,
-0001e7d0: 2062 795f 736c 6963 653d 4e6f 6e65 2c0a   by_slice=None,.
-0001e7e0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-0001e7f0: 655f 666f 725f 6e6f 6e65 3d4e 6f6e 652c  e_for_none=None,
-0001e800: 2076 6965 773d 2278 2d79 222c 206d 6574   view="x-y", met
-0001e810: 686f 643d 4e6f 6e65 2c20 2a2a 736c 6963  hod=None, **slic
-0001e820: 655f 7374 6174 5f6b 7761 7267 7329 3a0a  e_stat_kwargs):.
-0001e830: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001e840: 2020 2020 4765 7420 7374 6174 6973 7469      Get statisti
-0001e850: 6320 666f 7220 736c 6963 652d 6279 2d73  c for slice-by-s
-0001e860: 6c69 6365 2063 6f6d 7061 7269 736f 6e20  lice comparison 
-0001e870: 6d65 7472 6963 2e0a 0a20 2020 2020 2020  metric...       
-0001e880: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-0001e890: 0a0a 2020 2020 2020 2020 6f74 6865 7220  ..        other 
-0001e8a0: 3a20 524f 490a 2020 2020 2020 2020 2020  : ROI.          
-0001e8b0: 2020 4f74 6865 7220 524f 4920 746f 2063    Other ROI to c
-0001e8c0: 6f6d 7061 7265 2077 6974 6820 7468 6973  ompare with this
-0001e8d0: 2052 4f49 2e0a 0a20 2020 2020 2020 206d   ROI...        m
-0001e8e0: 6574 7269 6320 3a20 7374 722c 2064 6566  etric : str, def
-0001e8f0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-0001e900: 2020 2020 2020 4d65 7472 6963 2066 6f72        Metric for
-0001e910: 2077 6869 6368 2073 7461 7469 7374 6963   which statistic
-0001e920: 2066 6f72 2073 6c69 6365 2d62 792d 736c   for slice-by-sl
-0001e930: 6963 6520 7661 6c75 6573 0a20 2020 2020  ice values.     
-0001e940: 2020 2020 2020 2069 7320 746f 2062 6520         is to be 
-0001e950: 7265 7475 726e 6564 2e0a 0a20 2020 2020  returned...     
-0001e960: 2020 2073 6c69 6365 5f73 7461 7420 3a20     slice_stat : 
-0001e970: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
-0001e980: 650a 2020 2020 2020 2020 2020 2020 5369  e.            Si
-0001e990: 6e67 6c65 2d76 6172 6961 626c 6520 7374  ngle-variable st
-0001e9a0: 6174 6973 7469 6328 7329 2074 6f20 6265  atistic(s) to be
-0001e9b0: 2072 6574 7572 6e65 6420 666f 7220 736c   returned for sl
-0001e9c0: 6963 652d 6279 2d73 6c69 6365 0a20 2020  ice-by-slice.   
-0001e9d0: 2020 2020 2020 2020 2044 6963 6520 7363           Dice sc
-0001e9e0: 6f72 6573 2e20 2054 6869 7320 7368 6f75  ores.  This shou
-0001e9f0: 6c64 2062 6520 7468 6520 6e61 6d65 206f  ld be the name o
-0001ea00: 6620 7468 6520 6675 6e63 7469 6f6e 2066  f the function f
-0001ea10: 6f72 0a20 2020 2020 2020 2020 2020 2063  or.            c
-0001ea20: 616c 6375 6c61 7469 6f6e 206f 6620 7468  alculation of th
-0001ea30: 6520 7374 6174 6973 7469 6328 7329 2069  e statistic(s) i
-0001ea40: 6e20 7468 6520 5079 7468 6f6e 2073 7461  n the Python sta
-0001ea50: 7469 7374 6963 7320 6d6f 6475 6c65 3a0a  tistics module:.
-0001ea60: 0a20 2020 2020 2020 2020 2020 2068 7474  .            htt
-0001ea70: 7073 3a2f 2f64 6f63 732e 7079 7468 6f6e  ps://docs.python
-0001ea80: 2e6f 7267 2f33 2f6c 6962 7261 7279 2f73  .org/3/library/s
-0001ea90: 7461 7469 7374 6963 732e 6874 6d6c 0a0a  tatistics.html..
-0001eaa0: 2020 2020 2020 2020 2020 2020 4176 6169              Avai
-0001eab0: 6c61 626c 6520 6f70 7469 6f6e 7320 696e  lable options in
-0001eac0: 636c 7564 653a 2022 6d65 616e 222c 2022  clude: "mean", "
-0001ead0: 6d65 6469 616e 222c 2022 6d6f 6465 222c  median", "mode",
-0001eae0: 0a20 2020 2020 2020 2020 2020 2022 7374  .            "st
-0001eaf0: 6465 7622 2c20 2271 7561 6e74 696c 6573  dev", "quantiles
-0001eb00: 222e 0a0a 2020 2020 2020 2020 6279 5f73  "...        by_s
-0001eb10: 6c69 6365 3a20 7374 722c 2064 6566 6175  lice: str, defau
-0001eb20: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-0001eb30: 2020 2020 536c 6963 6573 2074 6f20 6265      Slices to be
-0001eb40: 2063 6f6e 7369 6465 7265 642e 2020 5468   considered.  Th
-0001eb50: 6520 7661 6c69 6420 7370 6563 6966 6963  e valid specific
-0001eb60: 6174 696f 6e73 2061 7265 3a0a 0a20 2020  ations are:..   
-0001eb70: 2020 2020 2020 2020 202d 2022 6c65 6674           - "left
-0001eb80: 223a 2063 6f6e 7369 6465 7220 6f6e 6c79  ": consider only
-0001eb90: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
-0001eba0: 6e67 2073 656c 663b 0a20 2020 2020 2020  ng self;.       
-0001ebb0: 2020 2020 202d 2022 7269 6768 7422 3a20       - "right": 
-0001ebc0: 636f 6e73 6964 6572 206f 6e6c 7920 736c  consider only sl
-0001ebd0: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
-0001ebe0: 6f74 6865 7220 726f 693b 0a20 2020 2020  other roi;.     
-0001ebf0: 2020 2020 2020 202d 2022 756e 696f 6e22         - "union"
-0001ec00: 3a20 636f 6e73 6964 6572 2073 6c69 6365  : consider slice
-0001ec10: 7320 636f 6e74 6169 6e69 6e67 2065 6974  s containing eit
-0001ec20: 6865 7220 6f66 2073 656c 6620 616e 6420  her of self and 
-0001ec30: 6f74 6865 7220 726f 693b 0a20 2020 2020  other roi;.     
-0001ec40: 2020 2020 2020 202d 2022 696e 7465 7273         - "inters
-0001ec50: 6563 7469 6f6e 223a 2063 6f6e 7369 6465  ection": conside
-0001ec60: 7220 736c 6963 6573 2063 6f6e 7461 696e  r slices contain
-0001ec70: 696e 6720 626f 7468 206f 6620 7365 6c66  ing both of self
-0001ec80: 2061 6e64 0a20 2020 2020 2020 2020 2020   and.           
-0001ec90: 2020 206f 7468 6572 2072 6f69 2e0a 0a20     other roi... 
-0001eca0: 2020 2020 2020 2020 2020 2049 6620 4e6f             If No
-0001ecb0: 6e65 2c20 7573 6520 736b 7274 2e63 6f72  ne, use skrt.cor
-0001ecc0: 652e 4465 6661 756c 7473 2829 2e62 795f  e.Defaults().by_
-0001ecd0: 736c 6963 650a 0a20 2020 2020 2020 2076  slice..        v
-0001ece0: 616c 7565 5f66 6f72 5f6e 6f6e 6520 3a20  alue_for_none : 
-0001ecf0: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
-0001ed00: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0001ed10: 5661 6c75 6520 746f 2073 7562 7374 6974  Value to substit
-0001ed20: 7574 6520 666f 7220 616e 7920 4e6f 6e65  ute for any None
-0001ed30: 2076 616c 7565 7320 616d 6f6e 6720 736c   values among sl
-0001ed40: 6963 650a 2020 2020 2020 2020 2020 2020  ice.            
-0001ed50: 6d65 7472 6963 2076 616c 7565 732e 2020  metric values.  
-0001ed60: 4966 204e 6f6e 652c 204e 6f6e 6520 7661  If None, None va
-0001ed70: 6c75 6573 2061 6d6f 6e67 2074 6865 206d  lues among the m
-0001ed80: 6574 7269 6320 7661 6c75 6573 0a20 2020  etric values.   
-0001ed90: 2020 2020 2020 2020 2061 7265 206f 6d69           are omi
-0001eda0: 7474 6564 2e0a 0a20 2020 2020 2020 2076  tted...        v
-0001edb0: 6965 7720 3a20 7374 722c 2064 6566 6175  iew : str, defau
-0001edc0: 6c74 3d22 782d 7922 0a20 2020 2020 2020  lt="x-y".       
-0001edd0: 2020 2020 204f 7269 656e 7461 7469 6f6e       Orientation
-0001ede0: 206f 6620 736c 6963 6573 206f 6e20 7768   of slices on wh
-0001edf0: 6963 6820 746f 2067 6574 206d 6574 7269  ich to get metri
-0001ee00: 6320 7661 6c75 6573 2e0a 0a20 2020 2020  c values...     
-0001ee10: 2020 206d 6574 686f 6420 3a20 7374 722c     method : str,
-0001ee20: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0001ee30: 2020 2020 2020 2020 2020 4d65 7468 6f64            Method
-0001ee40: 2074 6f20 7573 6520 666f 7220 6d65 7472   to use for metr
-0001ee50: 6963 2063 616c 6375 6c61 7469 6f6e 2e20  ic calculation. 
-0001ee60: 4361 6e20 6265 3a20 0a20 2020 2020 2020  Can be: .       
-0001ee70: 2020 2020 2020 2020 202d 2022 636f 6e74           - "cont
-0001ee80: 6f75 7222 3a20 6361 6c63 756c 6174 6520  our": calculate 
-0001ee90: 6d65 7472 6963 2066 726f 6d20 7368 6170  metric from shap
-0001eea0: 656c 7920 636f 6e74 6f75 7273 2e0a 2020  ely contours..  
-0001eeb0: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
-0001eec0: 226d 6173 6b22 3a20 6361 6c63 7561 6c74  "mask": calcualt
-0001eed0: 6520 6d65 7472 6963 2066 726f 6d20 6269  e metric from bi
-0001eee0: 6e61 7279 206d 6173 6b73 2e0a 2020 2020  nary masks..    
-0001eef0: 2020 2020 2020 2020 2020 2020 2d20 4e6f              - No
-0001ef00: 6e65 3a20 7573 6520 7468 6520 6d65 7468  ne: use the meth
-0001ef10: 6f64 2073 6574 2069 6e20 7365 6c66 2e64  od set in self.d
-0001ef20: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
-0001ef30: 6f64 2e0a 0a20 2020 2020 2020 2073 6c69  od...        sli
-0001ef40: 6365 5f73 7461 745f 6b77 6172 6773 203a  ce_stat_kwargs :
-0001ef50: 2064 6963 742c 2064 6566 6175 6c74 3d4e   dict, default=N
-0001ef60: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0001ef70: 4b65 7977 6f72 6420 6172 6775 6d65 6e74  Keyword argument
-0001ef80: 7320 746f 2062 6520 7061 7373 6564 2074  s to be passed t
-0001ef90: 6f20 6675 6e63 7469 6f6e 206f 6620 7374  o function of st
-0001efa0: 6174 6973 7469 6373 0a20 2020 2020 2020  atistics.       
-0001efb0: 2020 2020 206d 6f64 756c 6520 666f 7220       module for 
-0001efc0: 6361 6c63 756c 6174 696f 6e20 7265 6c61  calculation rela
-0001efd0: 7469 7665 2074 6f20 736c 6963 6520 7661  tive to slice va
-0001efe0: 6c75 6573 2e20 2046 6f72 2065 7861 6d70  lues.  For examp
-0001eff0: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-0001f000: 6966 2071 7561 6e74 696c 6573 2061 7265  if quantiles are
-0001f010: 2072 6571 7569 7265 6420 666f 7220 3130   required for 10
-0001f020: 2069 6e74 6572 7661 6c73 2c20 7261 7468   intervals, rath
-0001f030: 6572 2074 6861 6e20 666f 720a 2020 2020  er than for.    
-0001f040: 2020 2020 2020 2020 7468 6520 6465 6661          the defa
-0001f050: 756c 7420 6f66 2034 2c20 7468 6973 2063  ult of 4, this c
-0001f060: 616e 2062 6520 7370 6563 6966 6965 6420  an be specified 
-0001f070: 7573 696e 673a 0a0a 2020 2020 2020 2020  using:..        
-0001f080: 2020 2020 736c 6963 655f 7374 6174 5f6b      slice_stat_k
-0001f090: 7761 7267 737b 226e 2220 3a20 3130 7d0a  wargs{"n" : 10}.
-0001f0a0: 0a20 2020 2020 2020 2020 2020 2046 6f72  .            For
-0001f0b0: 2061 7661 696c 6162 6c65 206b 6579 776f   available keywo
-0001f0c0: 7264 206f 7074 696f 6e73 2c20 7365 6520  rd options, see 
-0001f0d0: 646f 6375 6d65 6e74 6174 696f 6e20 6f66  documentation of
-0001f0e0: 2073 7461 7469 7374 6963 730a 2020 2020   statistics.    
-0001f0f0: 2020 2020 2020 2020 6d6f 6475 6c65 2061          module a
-0001f100: 743a 0a0a 2020 2020 2020 2020 2020 2020  t:..            
-0001f110: 6874 7470 733a 2f2f 646f 6373 2e70 7974  https://docs.pyt
-0001f120: 686f 6e2e 6f72 672f 332f 6c69 6272 6172  hon.org/3/librar
-0001f130: 792f 7374 6174 6973 7469 6373 2e68 746d  y/statistics.htm
-0001f140: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
-0001f150: 2020 2020 2020 6279 5f73 6c69 6365 203d        by_slice =
-0001f160: 2062 795f 736c 6963 6520 6f72 2073 6b72   by_slice or skr
-0001f170: 742e 636f 7265 2e44 6566 6175 6c74 7328  t.core.Defaults(
-0001f180: 292e 6279 5f73 6c69 6365 0a20 2020 2020  ).by_slice.     
-0001f190: 2020 2073 6c69 6365 5f73 7461 745f 6b77     slice_stat_kw
-0001f1a0: 6172 6773 203d 2073 6c69 6365 5f73 7461  args = slice_sta
-0001f1b0: 745f 6b77 6172 6773 206f 7220 7b7d 0a0a  t_kwargs or {}..
-0001f1c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001f1d0: 6b72 742e 636f 7265 2e67 6574 5f73 7461  krt.core.get_sta
-0001f1e0: 7428 7365 6c66 2e67 6574 5f6d 6574 7269  t(self.get_metri
-0001f1f0: 635f 6279 5f73 6c69 6365 280a 2020 2020  c_by_slice(.    
-0001f200: 2020 2020 2020 2020 6f74 6865 722c 206d          other, m
-0001f210: 6574 7269 632c 2062 795f 736c 6963 652c  etric, by_slice,
-0001f220: 2076 6965 772c 206d 6574 686f 6429 2c0a   view, method),.
-0001f230: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-0001f240: 655f 666f 725f 6e6f 6e65 2c20 736c 6963  e_for_none, slic
-0001f250: 655f 7374 6174 2c20 2a2a 736c 6963 655f  e_stat, **slice_
-0001f260: 7374 6174 5f6b 7761 7267 7329 0a0a 2020  stat_kwargs)..  
-0001f270: 2020 6465 6620 6765 745f 736c 6963 655f    def get_slice_
-0001f280: 7374 6174 7328 7365 6c66 2c20 6f74 6865  stats(self, othe
-0001f290: 722c 206d 6574 7269 6373 3d4e 6f6e 652c  r, metrics=None,
-0001f2a0: 2073 6c69 6365 5f73 7461 7473 3d4e 6f6e   slice_stats=Non
-0001f2b0: 652c 0a20 2020 2020 2020 2020 2020 2064  e,.            d
-0001f2c0: 6566 6175 6c74 5f62 795f 736c 6963 653d  efault_by_slice=
-0001f2d0: 4e6f 6e65 2c20 6d65 7468 6f64 3d4e 6f6e  None, method=Non
-0001f2e0: 652c 2076 6965 773d 2278 2d79 222c 0a20  e, view="x-y",. 
-0001f2f0: 2020 2020 2020 2020 2020 2073 6570 6172             separ
-0001f300: 6174 655f 636f 6d70 6f6e 656e 7473 3d46  ate_components=F
-0001f310: 616c 7365 293a 0a20 2020 2020 2020 2022  alse):.        "
-0001f320: 2222 0a20 2020 2020 2020 2047 6574 2064  "".        Get d
-0001f330: 6963 7469 6f6e 6172 7920 6f66 2073 7461  ictionary of sta
-0001f340: 7469 7374 6963 7320 666f 7220 736c 6963  tistics for slic
-0001f350: 652d 6279 2d73 6c69 6365 2063 6f6d 7061  e-by-slice compa
-0001f360: 7269 736f 6e20 6d65 7472 6963 732e 0a0a  rison metrics...
-0001f370: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
-0001f380: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
-0001f390: 206f 7468 6572 203a 2052 4f49 0a20 2020   other : ROI.   
-0001f3a0: 2020 2020 2020 2020 204f 7468 6572 2052           Other R
-0001f3b0: 4f49 2074 6f20 636f 6d70 6172 6520 7769  OI to compare wi
-0001f3c0: 7468 2074 6869 7320 524f 492e 0a0a 2020  th this ROI...  
-0001f3d0: 2020 2020 2020 6d65 7472 6963 7320 3a20        metrics : 
-0001f3e0: 7374 722f 6c69 7374 2c20 6465 6661 756c  str/list, defaul
-0001f3f0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-0001f400: 2020 204d 6574 7269 6328 7329 2066 6f72     Metric(s) for
-0001f410: 2077 6869 6368 2073 7461 7469 7374 6963   which statistic
-0001f420: 2873 2920 666f 7220 736c 6963 652d 6279  (s) for slice-by
-0001f430: 2d73 6c69 6365 2063 616c 6375 6c61 7469  -slice calculati
-0001f440: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
-0001f450: 6172 6520 746f 2062 6520 7265 7475 726e  are to be return
-0001f460: 6564 2e20 2041 2073 696e 676c 6520 6d65  ed.  A single me
-0001f470: 7472 6963 2063 616e 2062 7920 7370 6566  tric can by spef
-0001f480: 6963 6965 6420 6173 2061 2073 7472 696e  icied as a strin
-0001f490: 672e 0a20 2020 2020 2020 2020 2020 204d  g..            M
-0001f4a0: 756c 7469 706c 6520 6d65 7472 6963 7320  ultiple metrics 
-0001f4b0: 6361 6e20 6265 2073 7065 6369 6669 6564  can be specified
-0001f4c0: 2061 7320 6120 6c69 7374 206f 6620 7374   as a list of st
-0001f4d0: 7269 6e67 732e 0a0a 2020 2020 2020 2020  rings...        
-0001f4e0: 736c 6963 655f 7374 6174 7320 3a20 7374  slice_stats : st
-0001f4f0: 722f 6c69 7374 2f64 6963 742c 2064 6566  r/list/dict, def
-0001f500: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-0001f510: 2020 2020 2020 5370 6563 6966 6963 6174        Specificat
-0001f520: 696f 6e20 6f66 2073 7461 7469 7374 6963  ion of statistic
-0001f530: 7320 746f 2062 6520 6361 6c63 756c 6174  s to be calculat
-0001f540: 6564 2072 656c 6174 6976 650a 2020 2020  ed relative.    
-0001f550: 2020 2020 2020 2020 746f 2073 6c69 6365          to slice
-0001f560: 2d62 792d 736c 6963 6520 6d65 7472 6963  -by-slice metric
-0001f570: 2076 616c 7565 732e 2020 5573 6564 2066   values.  Used f
-0001f580: 6f72 2061 6c6c 206d 6574 7269 6373 2077  or all metrics w
-0001f590: 6974 680a 2020 2020 2020 2020 2020 2020  ith.            
-0001f5a0: 7375 6666 6978 2022 5f73 6c69 6365 5f73  suffix "_slice_s
-0001f5b0: 7461 7473 2220 696e 2074 6865 203c 6d65  tats" in the <me
-0001f5c0: 7472 6963 733e 206c 6973 742e 0a0a 2020  trics> list...  
-0001f5d0: 2020 2020 2020 2020 2020 4120 7374 6174            A stat
-0001f5e0: 6973 7469 6320 6973 2073 7065 6369 6669  istic is specifi
-0001f5f0: 6564 2062 7920 7468 6520 6e61 6d65 206f  ed by the name o
-0001f600: 6620 7468 6520 6675 6e63 7469 6f6e 2066  f the function f
-0001f610: 6f72 0a20 2020 2020 2020 2020 2020 2069  or.            i
-0001f620: 7473 2063 616c 6375 6c61 7469 6f6e 2069  ts calculation i
-0001f630: 6e20 7468 6520 5079 7468 6f6e 2073 7461  n the Python sta
-0001f640: 7469 7374 6963 7320 6d6f 6475 6c65 3a0a  tistics module:.
-0001f650: 0a20 2020 2020 2020 2020 2020 2068 7474  .            htt
-0001f660: 7073 3a2f 2f64 6f63 732e 7079 7468 6f6e  ps://docs.python
-0001f670: 2e6f 7267 2f33 2f6c 6962 7261 7279 2f73  .org/3/library/s
-0001f680: 7461 7469 7374 6963 732e 6874 6d6c 0a0a  tatistics.html..
-0001f690: 2020 2020 2020 2020 2020 2020 466f 7220              For 
-0001f6a0: 6974 7320 7573 6520 6865 7265 2c20 7468  its use here, th
-0001f6b0: 6520 7265 6c65 7661 6e74 2066 756e 6374  e relevant funct
-0001f6c0: 696f 6e20 6d75 7374 2072 6571 7569 7265  ion must require
-0001f6d0: 0a20 2020 2020 2020 2020 2020 2061 2073  .            a s
-0001f6e0: 696e 676c 652d 7661 7269 6162 6c65 2069  ingle-variable i
-0001f6f0: 6e70 7574 2c20 6d75 7374 206e 6f74 2072  nput, must not r
-0001f700: 6571 7569 7265 2061 6e79 206b 6579 776f  equire any keywo
-0001f710: 7264 0a20 2020 2020 2020 2020 2020 2061  rd.            a
-0001f720: 7267 756d 656e 7473 2c20 616e 6420 6d75  rguments, and mu
-0001f730: 7374 2072 6574 7572 6e20 6120 7369 6e67  st return a sing
-0001f740: 6c65 206e 756d 6265 722e 0a0a 2020 2020  le number...    
-0001f750: 2020 2020 2020 2020 4176 6169 6c61 626c          Availabl
-0001f760: 6520 6f70 7469 6f6e 7320 696e 636c 7564  e options includ
-0001f770: 653a 2022 6d65 616e 222c 2022 6d65 6469  e: "mean", "medi
-0001f780: 616e 222c 2022 6d6f 6465 222c 0a20 2020  an", "mode",.   
-0001f790: 2020 2020 2020 2020 2022 7374 6465 7622           "stdev"
-0001f7a0: 2e0a 0a20 2020 2020 2020 2020 2020 5374  ...           St
-0001f7b0: 6174 6973 7469 6373 2074 6f20 6265 2063  atistics to be c
-0001f7c0: 616c 6375 6c61 7465 6420 6361 6e20 6265  alculated can be
-0001f7d0: 2073 7065 6369 6669 6564 2075 7369 6e67   specified using
-0001f7e0: 2061 6e79 206f 660a 2020 2020 2020 2020   any of.        
-0001f7f0: 2020 2074 6865 2066 6f6c 6c6f 7769 6e67     the following
-0001f800: 3a0a 0a20 2020 2020 2020 2020 2020 2d20  :..           - 
-0001f810: 5374 7269 6e67 2073 7065 6369 6679 696e  String specifyin
-0001f820: 6720 7369 6e67 6c65 2073 7461 7469 7374  g single statist
-0001f830: 6963 2074 6f20 6265 2063 616c 6375 6c61  ic to be calcula
-0001f840: 7465 642c 0a20 2020 2020 2020 2020 2020  ted,.           
-0001f850: 2020 7769 7468 2073 6c69 6365 7320 636f    with slices co
-0001f860: 6e73 6964 6572 6564 2061 7320 6769 7665  nsidered as give
-0001f870: 6e20 6279 2064 6566 6175 6c74 5f62 795f  n by default_by_
-0001f880: 736c 6963 652c 0a20 2020 2020 2020 2020  slice,.         
-0001f890: 2020 2020 666f 7220 6578 616d 706c 653a      for example:
-0001f8a0: 2022 6d65 616e 223b 0a20 2020 2020 2020   "mean";.       
-0001f8b0: 2020 2020 2d20 4c69 7374 2073 7065 6369      - List speci
-0001f8c0: 6679 696e 6720 6d75 6c74 6970 6c65 2073  fying multiple s
-0001f8d0: 7461 7469 7374 6963 7320 746f 2062 6520  tatistics to be 
-0001f8e0: 6361 6c63 756c 6174 6564 2c0a 2020 2020  calculated,.    
-0001f8f0: 2020 2020 2020 2020 2077 6974 6820 736c           with sl
-0001f900: 6963 6573 2063 6f6e 7369 6465 7265 6420  ices considered 
-0001f910: 6173 2067 6976 656e 2062 7920 6465 6661  as given by defa
-0001f920: 756c 745f 6279 5f73 6c69 6365 2c0a 2020  ult_by_slice,.  
-0001f930: 2020 2020 2020 2020 2020 2066 6f72 2065             for e
-0001f940: 7861 6d70 6c65 3a20 5b22 6d65 616e 222c  xample: ["mean",
-0001f950: 2022 7374 6465 7622 5d3b 0a20 2020 2020   "stdev"];.     
-0001f960: 2020 2020 2020 2d20 4469 6374 696f 6e61        - Dictiona
-0001f970: 7279 2077 6865 7265 206b 6579 7320 7370  ry where keys sp
-0001f980: 6563 6966 7920 736c 6963 6573 2074 6f20  ecify slices to 
-0001f990: 6265 2063 6f6e 7369 6465 7265 642c 0a20  be considered,. 
-0001f9a0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-0001f9b0: 7661 6c75 6573 2073 7065 6369 6679 2073  values specify s
-0001f9c0: 7461 7469 7374 6963 7320 2873 7472 696e  tatistics (strin
-0001f9d0: 6720 6f72 206c 6973 7429 2c20 666f 720a  g or list), for.
-0001f9e0: 2020 2020 2020 2020 2020 2020 2065 7861               exa
-0001f9f0: 6d70 6c65 3a20 7b22 756e 696f 6e22 3a20  mple: {"union": 
-0001fa00: 5b22 6d65 616e 222c 2022 7374 6465 7622  ["mean", "stdev"
-0001fa10: 5d7d 2e20 2056 616c 6964 2073 6c69 6365  ]}.  Valid slice
-0001fa20: 0a20 2020 2020 2020 2020 2020 2020 7370  .             sp
-0001fa30: 6563 6966 6963 6174 696f 6e73 2061 7265  ecifications are
-0001fa40: 2061 7320 6c69 7374 6564 2066 6f72 2064   as listed for d
-0001fa50: 6566 6175 6c74 5f62 795f 736c 6963 652e  efault_by_slice.
-0001fa60: 0a0a 2020 2020 2020 2020 6465 6661 756c  ..        defaul
-0001fa70: 745f 6279 5f73 6c69 6365 3a20 7374 722c  t_by_slice: str,
-0001fa80: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0001fa90: 2020 2020 2020 2020 2020 4465 6661 756c            Defaul
-0001faa0: 7420 7370 6563 6966 6963 6174 696f 6e20  t specification 
-0001fab0: 6f66 2073 6c69 6365 7320 746f 2062 6520  of slices to be 
-0001fac0: 636f 6e73 6964 6572 6564 2077 6865 6e0a  considered when.
-0001fad0: 2020 2020 2020 2020 2020 2020 6361 6c63              calc
-0001fae0: 756c 6174 696e 6720 736c 6963 652d 6279  ulating slice-by
-0001faf0: 2d73 6c69 6365 2073 7461 7469 7374 6963  -slice statistic
-0001fb00: 732e 2020 5468 6520 7661 6c69 6420 7370  s.  The valid sp
-0001fb10: 6563 6966 6963 6174 696f 6e73 0a20 2020  ecifications.   
-0001fb20: 2020 2020 2020 2020 2061 7265 3a0a 0a20           are:.. 
-0001fb30: 2020 2020 2020 2020 2020 202d 2022 6c65             - "le
-0001fb40: 6674 223a 2063 6f6e 7369 6465 7220 6f6e  ft": consider on
-0001fb50: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
-0001fb60: 6e69 6e67 2073 656c 663b 0a20 2020 2020  ning self;.     
-0001fb70: 2020 2020 2020 202d 2022 7269 6768 7422         - "right"
-0001fb80: 3a20 636f 6e73 6964 6572 206f 6e6c 7920  : consider only 
-0001fb90: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
-0001fba0: 6720 6f74 6865 7220 726f 693b 0a20 2020  g other roi;.   
-0001fbb0: 2020 2020 2020 2020 202d 2022 756e 696f           - "unio
-0001fbc0: 6e22 3a20 636f 6e73 6964 6572 2073 6c69  n": consider sli
-0001fbd0: 6365 7320 636f 6e74 6169 6e69 6e67 2065  ces containing e
-0001fbe0: 6974 6865 7220 6f66 2073 656c 6620 616e  ither of self an
-0001fbf0: 6420 6f74 6865 7220 726f 693b 0a20 2020  d other roi;.   
-0001fc00: 2020 2020 2020 2020 202d 2022 696e 7465           - "inte
-0001fc10: 7273 6563 7469 6f6e 223a 2063 6f6e 7369  rsection": consi
-0001fc20: 6465 7220 736c 6963 6573 2063 6f6e 7461  der slices conta
-0001fc30: 696e 696e 6720 626f 7468 206f 6620 7365  ining both of se
-0001fc40: 6c66 2061 6e64 0a20 2020 2020 2020 2020  lf and.         
-0001fc50: 2020 2020 206f 7468 6572 2072 6f69 2e0a       other roi..
-0001fc60: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-0001fc70: 4e6f 6e65 2c20 7573 6520 736b 7274 2e63  None, use skrt.c
-0001fc80: 6f72 652e 4465 6661 756c 7473 2829 2e62  ore.Defaults().b
-0001fc90: 795f 736c 6963 650a 0a20 2020 2020 2020  y_slice..       
-0001fca0: 2076 6965 7720 3a20 7374 722c 2064 6566   view : str, def
-0001fcb0: 6175 6c74 3d22 782d 7922 0a20 2020 2020  ault="x-y".     
-0001fcc0: 2020 2020 2020 204f 7269 656e 7461 7469         Orientati
-0001fcd0: 6f6e 206f 6620 736c 6963 6573 206f 6e20  on of slices on 
-0001fce0: 7768 6963 6820 746f 2067 6574 206d 6574  which to get met
-0001fcf0: 7269 6320 7661 6c75 6573 2e0a 0a20 2020  ric values...   
-0001fd00: 2020 2020 206d 6574 686f 6420 3a20 7374       method : st
-0001fd10: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
-0001fd20: 2020 2020 2020 2020 2020 2020 4d65 7468              Meth
-0001fd30: 6f64 2074 6f20 7573 6520 666f 7220 6d65  od to use for me
-0001fd40: 7472 6963 2063 616c 6375 6c61 7469 6f6e  tric calculation
-0001fd50: 2e20 4361 6e20 6265 3a20 0a20 2020 2020  . Can be: .     
-0001fd60: 2020 2020 2020 2020 2020 202d 2022 636f             - "co
-0001fd70: 6e74 6f75 7222 3a20 6361 6c63 756c 6174  ntour": calculat
-0001fd80: 6520 6d65 7472 6963 2066 726f 6d20 7368  e metric from sh
-0001fd90: 6170 656c 7920 636f 6e74 6f75 7273 2e0a  apely contours..
-0001fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fdb0: 2d20 226d 6173 6b22 3a20 6361 6c63 756c  - "mask": calcul
-0001fdc0: 6174 6520 6d65 7472 6963 2066 726f 6d20  ate metric from 
-0001fdd0: 6269 6e61 7279 206d 6173 6b73 2e0a 2020  binary masks..  
-0001fde0: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
-0001fdf0: 4e6f 6e65 3a20 7573 6520 7468 6520 6d65  None: use the me
-0001fe00: 7468 6f64 2073 6574 2069 6e20 7365 6c66  thod set in self
-0001fe10: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
-0001fe20: 7468 6f64 2e0a 0a20 2020 2020 2020 2073  thod...        s
-0001fe30: 6570 6172 6174 655f 636f 6d70 6f6e 656e  eparate_componen
-0001fe40: 7473 3a20 626f 6f6c 2c20 6465 6661 756c  ts: bool, defaul
-0001fe50: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
-0001fe60: 2020 2020 4966 2046 616c 7365 2c20 7265      If False, re
-0001fe70: 7475 726e 2061 206d 6574 7269 6320 7265  turn a metric re
-0001fe80: 7072 6573 656e 7465 6420 6279 2061 2076  presented by a v
-0001fe90: 6563 746f 7220 6173 2061 0a20 2020 2020  ector as a.     
-0001fea0: 2020 2020 2020 206c 6973 7420 6f66 2063         list of c
-0001feb0: 6f6d 706f 6e65 6e74 2076 616c 7565 732e  omponent values.
-0001fec0: 2020 4966 2074 7275 652c 2072 6574 7572    If true, retur
-0001fed0: 6e20 6120 7365 7061 7261 7465 206d 6574  n a separate met
-0001fee0: 7269 6320 666f 720a 2020 2020 2020 2020  ric for.        
-0001fef0: 2020 2020 6561 6368 2063 6f6d 706f 6e65      each compone
-0001ff00: 6e74 2c20 6c61 6265 6c6c 696e 6720 6279  nt, labelling by
-0001ff10: 2074 6865 2063 6f6d 706f 6e65 6e74 2061   the component a
-0001ff20: 7865 7320 6465 7465 726d 696e 6564 0a20  xes determined. 
-0001ff30: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
-0001ff40: 3c76 6965 773e 2e0a 2020 2020 2020 2020  <view>..        
-0001ff50: 2222 220a 2020 2020 2020 2020 6966 206d  """.        if m
-0001ff60: 6574 7269 6373 2069 7320 4e6f 6e65 206f  etrics is None o
-0001ff70: 7220 736c 6963 655f 7374 6174 7320 6973  r slice_stats is
-0001ff80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0001ff90: 2020 2072 6574 7572 6e20 7b7d 0a0a 2020     return {}..  
-0001ffa0: 2020 2020 2020 6465 6661 756c 745f 6279        default_by
-0001ffb0: 5f73 6c69 6365 203d 2064 6566 6175 6c74  _slice = default
-0001ffc0: 5f62 795f 736c 6963 6520 6f72 2073 6b72  _by_slice or skr
-0001ffd0: 742e 636f 7265 2e44 6566 6175 6c74 7328  t.core.Defaults(
-0001ffe0: 292e 6279 5f73 6c69 6365 0a0a 2020 2020  ).by_slice..    
-0001fff0: 2020 2020 2320 456e 7375 7265 2074 6861      # Ensure tha
-00020000: 7420 6d65 7472 6963 7320 6973 2061 206e  t metrics is a n
-00020010: 6f6e 2d65 6d70 7479 206c 6973 742e 0a20  on-empty list.. 
-00020020: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00020030: 616e 6365 286d 6574 7269 6373 2c20 7374  ance(metrics, st
-00020040: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00020050: 6d65 7472 6963 7320 3d20 5b6d 6574 7269  metrics = [metri
-00020060: 6373 5d0a 2020 2020 2020 2020 656c 6966  cs].        elif
-00020070: 206e 6f74 2073 6b72 742e 636f 7265 2e69   not skrt.core.i
-00020080: 735f 6c69 7374 286d 6574 7269 6373 293a  s_list(metrics):
-00020090: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000200a0: 7572 6e20 7b7d 0a20 2020 2020 2020 206d  urn {}.        m
-000200b0: 6574 7269 6373 203d 205b 6d65 7472 6963  etrics = [metric
-000200c0: 2066 6f72 206d 6574 7269 6320 696e 206d   for metric in m
-000200d0: 6574 7269 6373 0a20 2020 2020 2020 2020  etrics.         
-000200e0: 2020 2020 2020 2069 6620 6622 7b6d 6574         if f"{met
-000200f0: 7269 637d 5f73 6c69 6365 5f73 7461 7473  ric}_slice_stats
-00020100: 2220 696e 2067 6574 5f63 6f6d 7061 7269  " in get_compari
-00020110: 736f 6e5f 6d65 7472 6963 7328 295d 0a20  son_metrics()]. 
-00020120: 2020 2020 2020 2069 6620 6e6f 7420 6d65         if not me
-00020130: 7472 6963 733a 0a20 2020 2020 2020 2020  trics:.         
-00020140: 2020 2072 6574 7572 6e20 7b7d 0a0a 2020     return {}..  
-00020150: 2020 2020 2020 736c 6963 655f 7374 6174        slice_stat
-00020160: 7320 3d20 6578 7061 6e64 5f73 6c69 6365  s = expand_slice
-00020170: 5f73 7461 7473 2873 6c69 6365 5f73 7461  _stats(slice_sta
-00020180: 7473 2c20 6465 6661 756c 745f 6279 5f73  ts, default_by_s
-00020190: 6c69 6365 290a 2020 2020 2020 2020 6966  lice).        if
-000201a0: 206e 6f74 2073 6c69 6365 5f73 7461 7473   not slice_stats
-000201b0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000201c0: 7475 726e 207b 7d0a 0a20 2020 2020 2020  turn {}..       
-000201d0: 2023 2043 616c 6375 6c61 7465 2073 7461   # Calculate sta
-000201e0: 7469 7374 6963 2873 2920 666f 7220 6d65  tistic(s) for me
-000201f0: 7472 6963 2076 616c 7565 7320 6361 6c63  tric values calc
-00020200: 756c 6174 6564 2073 6c69 6365 2062 7920  ulated slice by 
-00020210: 736c 6963 652e 0a20 2020 2020 2020 2063  slice..        c
-00020220: 616c 6375 6c61 7465 645f 736c 6963 655f  alculated_slice_
-00020230: 7374 6174 7320 3d20 7b7d 0a20 2020 2020  stats = {}.     
-00020240: 2020 2066 6f72 206d 6574 7269 6320 696e     for metric in
-00020250: 206d 6574 7269 6373 3a0a 2020 2020 2020   metrics:.      
-00020260: 2020 2020 2020 666f 7220 6279 5f73 6c69        for by_sli
-00020270: 6365 2c20 7374 6174 7320 696e 2073 6c69  ce, stats in sli
-00020280: 6365 5f73 7461 7473 2e69 7465 6d73 2829  ce_stats.items()
-00020290: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000202a0: 2020 7661 6c75 6573 203d 2073 656c 662e    values = self.
-000202b0: 6765 745f 6d65 7472 6963 5f62 795f 736c  get_metric_by_sl
-000202c0: 6963 6528 0a20 2020 2020 2020 2020 2020  ice(.           
-000202d0: 2020 2020 2020 2020 2020 2020 206f 7468               oth
-000202e0: 6572 2c20 6d65 7472 6963 2c20 6279 5f73  er, metric, by_s
-000202f0: 6c69 6365 2c20 7669 6577 2c20 6d65 7468  lice, view, meth
-00020300: 6f64 290a 2020 2020 2020 2020 2020 2020  od).            
-00020310: 2020 2020 666f 7220 7374 6174 2069 6e20      for stat in 
-00020320: 7374 6174 733a 0a20 2020 2020 2020 2020  stats:.         
-00020330: 2020 2020 2020 2020 2020 206b 6579 203d             key =
-00020340: 2066 227b 6d65 7472 6963 7d5f 736c 6963   f"{metric}_slic
-00020350: 655f 7b62 795f 736c 6963 657d 5f7b 7374  e_{by_slice}_{st
-00020360: 6174 7d22 0a20 2020 2020 2020 2020 2020  at}".           
-00020370: 2020 2020 2020 2020 2063 616c 6375 6c61           calcula
-00020380: 7465 645f 736c 6963 655f 7374 6174 735b  ted_slice_stats[
-00020390: 6b65 795d 203d 2028 0a20 2020 2020 2020  key] = (.       
-000203a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000203b0: 2020 2020 2073 6b72 742e 636f 7265 2e67       skrt.core.g
-000203c0: 6574 5f73 7461 7428 7661 6c75 6573 2c20  et_stat(values, 
-000203d0: 7374 6174 3d73 7461 7429 290a 2020 2020  stat=stat)).    
-000203e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000203f0: 6966 2028 736b 7274 2e63 6f72 652e 6973  if (skrt.core.is
-00020400: 5f6c 6973 7428 6361 6c63 756c 6174 6564  _list(calculated
-00020410: 5f73 6c69 6365 5f73 7461 7473 5b6b 6579  _slice_stats[key
-00020420: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00020430: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00020440: 6e64 2073 6570 6172 6174 655f 636f 6d70  nd separate_comp
-00020450: 6f6e 656e 7473 293a 0a20 2020 2020 2020  onents):.       
-00020460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020470: 2076 6563 746f 7220 3d20 6361 6c63 756c   vector = calcul
-00020480: 6174 6564 5f73 6c69 6365 5f73 7461 7473  ated_slice_stats
-00020490: 2e70 6f70 286b 6579 290a 2020 2020 2020  .pop(key).      
-000204a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000204b0: 2020 666f 7220 692c 2069 5f61 7820 696e    for i, i_ax in
-000204c0: 2065 6e75 6d65 7261 7465 2873 6b72 742e   enumerate(skrt.
-000204d0: 696d 6167 652e 5f70 6c6f 745f 6178 6573  image._plot_axes
-000204e0: 5b76 6965 775d 293a 0a20 2020 2020 2020  [view]):.       
-000204f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020500: 2020 2020 2061 7820 3d20 736b 7274 2e69       ax = skrt.i
-00020510: 6d61 6765 2e5f 6178 6573 5b69 5f61 785d  mage._axes[i_ax]
-00020520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020530: 2020 2020 2020 2020 2020 2020 2061 785f               ax_
-00020540: 6b65 7920 3d20 6622 7b6d 6574 7269 637d  key = f"{metric}
-00020550: 5f7b 6178 7d5f 736c 6963 655f 7b62 795f  _{ax}_slice_{by_
-00020560: 736c 6963 657d 5f7b 7374 6174 7d22 0a20  slice}_{stat}". 
+0001de70: 6172 6469 7365 3d54 7275 6529 0a20 2020  ardise=True).   
+0001de80: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0001de90: 6132 203d 206f 7468 6572 2e67 6574 5f6d  a2 = other.get_m
+0001dea0: 6173 6b28 7669 6577 2c20 666c 6174 7465  ask(view, flatte
+0001deb0: 6e2c 2073 7461 6e64 6172 6469 7365 3d54  n, standardise=T
+0001dec0: 7275 6529 0a0a 2020 2020 2020 2020 2020  rue)..          
+0001ded0: 2020 2320 4f74 6865 7277 6973 652c 2075    # Otherwise, u
+0001dee0: 7365 2073 696e 676c 6520 3244 2073 6c69  se single 2D sli
+0001def0: 6365 0a20 2020 2020 2020 2020 2020 2065  ce.            e
+0001df00: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001df10: 2020 2020 2064 6174 6131 203d 2073 656c       data1 = sel
+0001df20: 662e 6765 745f 736c 6963 6528 7669 6577  f.get_slice(view
+0001df30: 2c20 736c 2c20 6964 782c 2070 6f73 290a  , sl, idx, pos).
+0001df40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df50: 6461 7461 3220 3d20 6f74 6865 722e 6765  data2 = other.ge
+0001df60: 745f 736c 6963 6528 7669 6577 2c20 736c  t_slice(view, sl
+0001df70: 2c20 6964 782c 2070 6f73 290a 0a20 2020  , idx, pos)..   
+0001df80: 2020 2020 2020 2020 2066 6163 746f 7220           factor 
+0001df90: 3d20 766f 7865 6c5f 6172 6561 2069 6620  = voxel_area if 
+0001dfa0: 2873 696e 676c 655f 736c 6963 6520 6f72  (single_slice or
+0001dfb0: 2066 6c61 7474 656e 2920 656c 7365 2076   flatten) else v
+0001dfc0: 6f78 656c 5f76 6f6c 756d 650a 2020 2020  oxel_volume.    
+0001dfd0: 2020 2020 2020 2020 696e 7465 7273 6563          intersec
+0001dfe0: 7469 6f6e 203d 2028 6461 7461 3120 2620  tion = (data1 & 
+0001dff0: 6461 7461 3229 2e73 756d 2829 202a 2066  data2).sum() * f
+0001e000: 6163 746f 720a 2020 2020 2020 2020 2020  actor.          
+0001e010: 2020 756e 696f 6e20 3d20 2864 6174 6131    union = (data1
+0001e020: 207c 2064 6174 6132 292e 7375 6d28 2920   | data2).sum() 
+0001e030: 2a20 6661 6374 6f72 0a20 2020 2020 2020  * factor.       
+0001e040: 2020 2020 206d 6561 6e5f 7369 7a65 203d       mean_size =
+0001e050: 2030 2e35 202a 2028 6461 7461 312e 7375   0.5 * (data1.su
+0001e060: 6d28 2920 2b20 6461 7461 322e 7375 6d28  m() + data2.sum(
+0001e070: 2929 202a 2066 6163 746f 720a 0a20 2020  )) * factor..   
+0001e080: 2020 2020 2072 6574 7572 6e20 2869 6e74       return (int
+0001e090: 6572 7365 6374 696f 6e2c 2075 6e69 6f6e  ersection, union
+0001e0a0: 2c20 6d65 616e 5f73 697a 6529 0a0a 2020  , mean_size)..  
+0001e0b0: 2020 6465 6620 6765 745f 6d65 7472 6963    def get_metric
+0001e0c0: 5f62 795f 736c 6963 6528 7365 6c66 2c20  _by_slice(self, 
+0001e0d0: 6f74 6865 722c 206d 6574 7269 633d 4e6f  other, metric=No
+0001e0e0: 6e65 2c20 6279 5f73 6c69 6365 3d4e 6f6e  ne, by_slice=Non
+0001e0f0: 652c 0a20 2020 2020 2020 2020 2020 2076  e,.            v
+0001e100: 6965 773d 2278 2d79 222c 206d 6574 686f  iew="x-y", metho
+0001e110: 643d 4e6f 6e65 293a 0a20 2020 2020 2020  d=None):.       
+0001e120: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
+0001e130: 2064 6963 7469 6f6e 6172 7920 6f66 2073   dictionary of s
+0001e140: 6c69 6365 2d62 792d 736c 6963 6520 7661  lice-by-slice va
+0001e150: 6c75 6573 2066 6f72 2063 6f6d 7061 7269  lues for compari
+0001e160: 736f 6e20 6d65 7472 6963 2e0a 0a20 2020  son metric...   
+0001e170: 2020 2020 2045 6163 6820 6b65 7920 6f66       Each key of
+0001e180: 2074 6865 2072 6574 7572 6e65 6420 6469   the returned di
+0001e190: 6374 696f 6e61 7279 2069 7320 6120 736c  ctionary is a sl
+0001e1a0: 6963 6520 706f 7369 7469 6f6e 2028 6d6d  ice position (mm
+0001e1b0: 292c 2061 6e64 0a20 2020 2020 2020 2074  ), and.        t
+0001e1c0: 6865 2061 7373 6f63 6961 7465 6420 7661  he associated va
+0001e1d0: 6c75 6520 6973 2074 6865 206d 6574 7269  lue is the metri
+0001e1e0: 6320 7661 6c75 6520 666f 7220 7468 6520  c value for the 
+0001e1f0: 736c 6963 652e 0a0a 2020 2020 2020 2020  slice...        
+0001e200: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+0001e210: 0a20 2020 2020 2020 206f 7468 6572 203a  .        other :
+0001e220: 2052 4f49 0a20 2020 2020 2020 2020 2020   ROI.           
+0001e230: 204f 7468 6572 2052 4f49 2074 6f20 636f   Other ROI to co
+0001e240: 6d70 6172 6520 7769 7468 2074 6869 7320  mpare with this 
+0001e250: 524f 492e 0a0a 2020 2020 2020 2020 6d65  ROI...        me
+0001e260: 7472 6963 203a 2073 7472 2c20 6465 6661  tric : str, defa
+0001e270: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+0001e280: 2020 2020 204d 6574 7269 6320 746f 2062       Metric to b
+0001e290: 6520 6576 616c 7561 7465 642e 0a0a 2020  e evaluated...  
+0001e2a0: 2020 2020 2020 6279 5f73 6c69 6365 3a20        by_slice: 
+0001e2b0: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
+0001e2c0: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
+0001e2d0: 6963 6573 2074 6f20 6265 2063 6f6e 7369  ices to be consi
+0001e2e0: 6465 7265 642e 2020 5468 6520 7661 6c69  dered.  The vali
+0001e2f0: 6420 7370 6563 6966 6963 6174 696f 6e73  d specifications
+0001e300: 2061 7265 3a0a 0a20 2020 2020 2020 2020   are:..         
+0001e310: 2020 202d 2022 6c65 6674 223a 2063 6f6e     - "left": con
+0001e320: 7369 6465 7220 6f6e 6c79 2073 6c69 6365  sider only slice
+0001e330: 7320 636f 6e74 6169 6e69 6e67 2073 656c  s containing sel
+0001e340: 663b 0a20 2020 2020 2020 2020 2020 202d  f;.            -
+0001e350: 2022 7269 6768 7422 3a20 636f 6e73 6964   "right": consid
+0001e360: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
+0001e370: 6f6e 7461 696e 696e 6720 6f74 6865 7220  ontaining other 
+0001e380: 726f 693b 0a20 2020 2020 2020 2020 2020  roi;.           
+0001e390: 202d 2022 756e 696f 6e22 3a20 636f 6e73   - "union": cons
+0001e3a0: 6964 6572 2073 6c69 6365 7320 636f 6e74  ider slices cont
+0001e3b0: 6169 6e69 6e67 2065 6974 6865 7220 6f66  aining either of
+0001e3c0: 2073 656c 6620 616e 6420 6f74 6865 7220   self and other 
+0001e3d0: 726f 693b 0a20 2020 2020 2020 2020 2020  roi;.           
+0001e3e0: 202d 2022 696e 7465 7273 6563 7469 6f6e   - "intersection
+0001e3f0: 223a 2063 6f6e 7369 6465 7220 736c 6963  ": consider slic
+0001e400: 6573 2063 6f6e 7461 696e 696e 6720 626f  es containing bo
+0001e410: 7468 206f 6620 7365 6c66 2061 6e64 0a20  th of self and. 
+0001e420: 2020 2020 2020 2020 2020 2020 206f 7468               oth
+0001e430: 6572 2072 6f69 2e0a 0a20 2020 2020 2020  er roi...       
+0001e440: 2020 2020 2049 6620 4e6f 6e65 2c20 7573       If None, us
+0001e450: 6520 736b 7274 2e63 6f72 652e 4465 6661  e skrt.core.Defa
+0001e460: 756c 7473 2829 2e62 795f 736c 6963 650a  ults().by_slice.
+0001e470: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
+0001e480: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
+0001e490: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
+0001e4a0: 7269 656e 7461 7469 6f6e 206f 6620 736c  rientation of sl
+0001e4b0: 6963 6573 206f 6e20 7768 6963 6820 746f  ices on which to
+0001e4c0: 2067 6574 206d 6574 7269 6320 7661 6c75   get metric valu
+0001e4d0: 6573 2e0a 0a20 2020 2020 2020 206d 6574  es...        met
+0001e4e0: 686f 6420 3a20 7374 722c 2064 6566 6175  hod : str, defau
+0001e4f0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0001e500: 2020 2020 4d65 7468 6f64 2074 6f20 7573      Method to us
+0001e510: 6520 666f 7220 6d65 7472 6963 2063 616c  e for metric cal
+0001e520: 6375 6c61 7469 6f6e 2e20 4361 6e20 6265  culation. Can be
+0001e530: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+0001e540: 2020 202d 2022 636f 6e74 6f75 7222 3a20     - "contour": 
+0001e550: 6361 6c63 756c 6174 6520 6d65 7472 6963  calculate metric
+0001e560: 2066 726f 6d20 7368 6170 656c 7920 636f   from shapely co
+0001e570: 6e74 6f75 7273 2e0a 2020 2020 2020 2020  ntours..        
+0001e580: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
+0001e590: 3a20 6361 6c63 7561 6c74 6520 6d65 7472  : calcualte metr
+0001e5a0: 6963 2066 726f 6d20 6269 6e61 7279 206d  ic from binary m
+0001e5b0: 6173 6b73 2e0a 2020 2020 2020 2020 2020  asks..          
+0001e5c0: 2020 2020 2020 2d20 4e6f 6e65 3a20 7573        - None: us
+0001e5d0: 6520 7468 6520 6d65 7468 6f64 2073 6574  e the method set
+0001e5e0: 2069 6e20 7365 6c66 2e64 6566 6175 6c74   in self.default
+0001e5f0: 5f67 656f 6d5f 6d65 7468 6f64 2e0a 2020  _geom_method..  
+0001e600: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001e610: 2020 6966 206d 6574 7269 6320 6e6f 7420    if metric not 
+0001e620: 696e 2067 6574 5f63 6f6d 7061 7269 736f  in get_compariso
+0001e630: 6e5f 6d65 7472 6963 7328 293a 0a20 2020  n_metrics():.   
+0001e640: 2020 2020 2020 2020 2072 6169 7365 2052           raise R
+0001e650: 756e 7469 6d65 4572 726f 7228 6622 4d65  untimeError(f"Me
+0001e660: 7472 6963 207b 6d65 7472 6963 7d20 6e6f  tric {metric} no
+0001e670: 7420 7265 636f 676e 6973 6564 2062 7920  t recognised by 
+0001e680: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0001e690: 2020 2020 2020 2020 2020 2252 4f49 2e67            "ROI.g
+0001e6a0: 6574 5f6d 6574 7269 635f 6279 5f73 6c69  et_metric_by_sli
+0001e6b0: 6365 2829 2229 0a0a 2020 2020 2020 2020  ce()")..        
+0001e6c0: 6279 5f73 6c69 6365 203d 2062 795f 736c  by_slice = by_sl
+0001e6d0: 6963 6520 6f72 2073 6b72 742e 636f 7265  ice or skrt.core
+0001e6e0: 2e44 6566 6175 6c74 7328 292e 6279 5f73  .Defaults().by_s
+0001e6f0: 6c69 6365 0a0a 2020 2020 2020 2020 7265  lice..        re
+0001e700: 7475 726e 207b 706f 733a 2067 6574 6174  turn {pos: getat
+0001e710: 7472 2873 656c 662c 2066 2267 6574 5f7b  tr(self, f"get_{
+0001e720: 6765 745f 6d65 7472 6963 5f6d 6574 686f  get_metric_metho
+0001e730: 6428 6d65 7472 6963 297d 2229 280a 2020  d(metric)}")(.  
+0001e740: 2020 2020 2020 2020 2020 6f74 6865 722c            other,
+0001e750: 2073 696e 676c 655f 736c 6963 653d 5472   single_slice=Tr
+0001e760: 7565 2c20 7669 6577 3d76 6965 772c 2070  ue, view=view, p
+0001e770: 6f73 3d70 6f73 2c20 6d65 7468 6f64 3d6d  os=pos, method=m
+0001e780: 6574 686f 6429 0a20 2020 2020 2020 2020  ethod).         
+0001e790: 2020 2066 6f72 2070 6f73 2069 6e20 7365     for pos in se
+0001e7a0: 6c66 2e67 6574 5f73 6c69 6365 5f70 6f73  lf.get_slice_pos
+0001e7b0: 6974 696f 6e73 286f 7468 6572 2c20 7669  itions(other, vi
+0001e7c0: 6577 2c20 6d65 7468 6f64 3d62 795f 736c  ew, method=by_sl
+0001e7d0: 6963 6529 7d0a 0a20 2020 2064 6566 2067  ice)}..    def g
+0001e7e0: 6574 5f73 6c69 6365 5f73 7461 7428 7365  et_slice_stat(se
+0001e7f0: 6c66 2c20 6f74 6865 722c 206d 6574 7269  lf, other, metri
+0001e800: 633d 4e6f 6e65 2c20 736c 6963 655f 7374  c=None, slice_st
+0001e810: 6174 3d4e 6f6e 652c 2062 795f 736c 6963  at=None, by_slic
+0001e820: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+0001e830: 2020 2020 7661 6c75 655f 666f 725f 6e6f      value_for_no
+0001e840: 6e65 3d4e 6f6e 652c 2076 6965 773d 2278  ne=None, view="x
+0001e850: 2d79 222c 206d 6574 686f 643d 4e6f 6e65  -y", method=None
+0001e860: 2c20 2a2a 736c 6963 655f 7374 6174 5f6b  , **slice_stat_k
+0001e870: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+0001e880: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
+0001e890: 7374 6174 6973 7469 6320 666f 7220 736c  statistic for sl
+0001e8a0: 6963 652d 6279 2d73 6c69 6365 2063 6f6d  ice-by-slice com
+0001e8b0: 7061 7269 736f 6e20 6d65 7472 6963 2e0a  parison metric..
+0001e8c0: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
+0001e8d0: 6574 6572 733a 2a2a 0a0a 2020 2020 2020  eters:**..      
+0001e8e0: 2020 6f74 6865 7220 3a20 524f 490a 2020    other : ROI.  
+0001e8f0: 2020 2020 2020 2020 2020 4f74 6865 7220            Other 
+0001e900: 524f 4920 746f 2063 6f6d 7061 7265 2077  ROI to compare w
+0001e910: 6974 6820 7468 6973 2052 4f49 2e0a 0a20  ith this ROI... 
+0001e920: 2020 2020 2020 206d 6574 7269 6320 3a20         metric : 
+0001e930: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
+0001e940: 650a 2020 2020 2020 2020 2020 2020 4d65  e.            Me
+0001e950: 7472 6963 2066 6f72 2077 6869 6368 2073  tric for which s
+0001e960: 7461 7469 7374 6963 2066 6f72 2073 6c69  tatistic for sli
+0001e970: 6365 2d62 792d 736c 6963 6520 7661 6c75  ce-by-slice valu
+0001e980: 6573 0a20 2020 2020 2020 2020 2020 2069  es.            i
+0001e990: 7320 746f 2062 6520 7265 7475 726e 6564  s to be returned
+0001e9a0: 2e0a 0a20 2020 2020 2020 2073 6c69 6365  ...        slice
+0001e9b0: 5f73 7461 7420 3a20 7374 722c 2064 6566  _stat : str, def
+0001e9c0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0001e9d0: 2020 2020 2020 5369 6e67 6c65 2d76 6172        Single-var
+0001e9e0: 6961 626c 6520 7374 6174 6973 7469 6328  iable statistic(
+0001e9f0: 7329 2074 6f20 6265 2072 6574 7572 6e65  s) to be returne
+0001ea00: 6420 666f 7220 736c 6963 652d 6279 2d73  d for slice-by-s
+0001ea10: 6c69 6365 0a20 2020 2020 2020 2020 2020  lice.           
+0001ea20: 2044 6963 6520 7363 6f72 6573 2e20 2054   Dice scores.  T
+0001ea30: 6869 7320 7368 6f75 6c64 2062 6520 7468  his should be th
+0001ea40: 6520 6e61 6d65 206f 6620 7468 6520 6675  e name of the fu
+0001ea50: 6e63 7469 6f6e 2066 6f72 0a20 2020 2020  nction for.     
+0001ea60: 2020 2020 2020 2063 616c 6375 6c61 7469         calculati
+0001ea70: 6f6e 206f 6620 7468 6520 7374 6174 6973  on of the statis
+0001ea80: 7469 6328 7329 2069 6e20 7468 6520 5079  tic(s) in the Py
+0001ea90: 7468 6f6e 2073 7461 7469 7374 6963 7320  thon statistics 
+0001eaa0: 6d6f 6475 6c65 3a0a 0a20 2020 2020 2020  module:..       
+0001eab0: 2020 2020 2068 7474 7073 3a2f 2f64 6f63       https://doc
+0001eac0: 732e 7079 7468 6f6e 2e6f 7267 2f33 2f6c  s.python.org/3/l
+0001ead0: 6962 7261 7279 2f73 7461 7469 7374 6963  ibrary/statistic
+0001eae0: 732e 6874 6d6c 0a0a 2020 2020 2020 2020  s.html..        
+0001eaf0: 2020 2020 4176 6169 6c61 626c 6520 6f70      Available op
+0001eb00: 7469 6f6e 7320 696e 636c 7564 653a 2022  tions include: "
+0001eb10: 6d65 616e 222c 2022 6d65 6469 616e 222c  mean", "median",
+0001eb20: 2022 6d6f 6465 222c 0a20 2020 2020 2020   "mode",.       
+0001eb30: 2020 2020 2022 7374 6465 7622 2c20 2271       "stdev", "q
+0001eb40: 7561 6e74 696c 6573 222e 0a0a 2020 2020  uantiles"...    
+0001eb50: 2020 2020 6279 5f73 6c69 6365 3a20 7374      by_slice: st
+0001eb60: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+0001eb70: 2020 2020 2020 2020 2020 2020 536c 6963              Slic
+0001eb80: 6573 2074 6f20 6265 2063 6f6e 7369 6465  es to be conside
+0001eb90: 7265 642e 2020 5468 6520 7661 6c69 6420  red.  The valid 
+0001eba0: 7370 6563 6966 6963 6174 696f 6e73 2061  specifications a
+0001ebb0: 7265 3a0a 0a20 2020 2020 2020 2020 2020  re:..           
+0001ebc0: 202d 2022 6c65 6674 223a 2063 6f6e 7369   - "left": consi
+0001ebd0: 6465 7220 6f6e 6c79 2073 6c69 6365 7320  der only slices 
+0001ebe0: 636f 6e74 6169 6e69 6e67 2073 656c 663b  containing self;
+0001ebf0: 0a20 2020 2020 2020 2020 2020 202d 2022  .            - "
+0001ec00: 7269 6768 7422 3a20 636f 6e73 6964 6572  right": consider
+0001ec10: 206f 6e6c 7920 736c 6963 6573 2063 6f6e   only slices con
+0001ec20: 7461 696e 696e 6720 6f74 6865 7220 726f  taining other ro
+0001ec30: 693b 0a20 2020 2020 2020 2020 2020 202d  i;.            -
+0001ec40: 2022 756e 696f 6e22 3a20 636f 6e73 6964   "union": consid
+0001ec50: 6572 2073 6c69 6365 7320 636f 6e74 6169  er slices contai
+0001ec60: 6e69 6e67 2065 6974 6865 7220 6f66 2073  ning either of s
+0001ec70: 656c 6620 616e 6420 6f74 6865 7220 726f  elf and other ro
+0001ec80: 693b 0a20 2020 2020 2020 2020 2020 202d  i;.            -
+0001ec90: 2022 696e 7465 7273 6563 7469 6f6e 223a   "intersection":
+0001eca0: 2063 6f6e 7369 6465 7220 736c 6963 6573   consider slices
+0001ecb0: 2063 6f6e 7461 696e 696e 6720 626f 7468   containing both
+0001ecc0: 206f 6620 7365 6c66 2061 6e64 0a20 2020   of self and.   
+0001ecd0: 2020 2020 2020 2020 2020 206f 7468 6572             other
+0001ece0: 2072 6f69 2e0a 0a20 2020 2020 2020 2020   roi...         
+0001ecf0: 2020 2049 6620 4e6f 6e65 2c20 7573 6520     If None, use 
+0001ed00: 736b 7274 2e63 6f72 652e 4465 6661 756c  skrt.core.Defaul
+0001ed10: 7473 2829 2e62 795f 736c 6963 650a 0a20  ts().by_slice.. 
+0001ed20: 2020 2020 2020 2076 616c 7565 5f66 6f72         value_for
+0001ed30: 5f6e 6f6e 6520 3a20 666c 6f61 742c 2064  _none : float, d
+0001ed40: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0001ed50: 2020 2020 2020 2020 5661 6c75 6520 746f          Value to
+0001ed60: 2073 7562 7374 6974 7574 6520 666f 7220   substitute for 
+0001ed70: 616e 7920 4e6f 6e65 2076 616c 7565 7320  any None values 
+0001ed80: 616d 6f6e 6720 736c 6963 650a 2020 2020  among slice.    
+0001ed90: 2020 2020 2020 2020 6d65 7472 6963 2076          metric v
+0001eda0: 616c 7565 732e 2020 4966 204e 6f6e 652c  alues.  If None,
+0001edb0: 204e 6f6e 6520 7661 6c75 6573 2061 6d6f   None values amo
+0001edc0: 6e67 2074 6865 206d 6574 7269 6320 7661  ng the metric va
+0001edd0: 6c75 6573 0a20 2020 2020 2020 2020 2020  lues.           
+0001ede0: 2061 7265 206f 6d69 7474 6564 2e0a 0a20   are omitted... 
+0001edf0: 2020 2020 2020 2076 6965 7720 3a20 7374         view : st
+0001ee00: 722c 2064 6566 6175 6c74 3d22 782d 7922  r, default="x-y"
+0001ee10: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
+0001ee20: 656e 7461 7469 6f6e 206f 6620 736c 6963  entation of slic
+0001ee30: 6573 206f 6e20 7768 6963 6820 746f 2067  es on which to g
+0001ee40: 6574 206d 6574 7269 6320 7661 6c75 6573  et metric values
+0001ee50: 2e0a 0a20 2020 2020 2020 206d 6574 686f  ...        metho
+0001ee60: 6420 3a20 7374 722c 2064 6566 6175 6c74  d : str, default
+0001ee70: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0001ee80: 2020 4d65 7468 6f64 2074 6f20 7573 6520    Method to use 
+0001ee90: 666f 7220 6d65 7472 6963 2063 616c 6375  for metric calcu
+0001eea0: 6c61 7469 6f6e 2e20 4361 6e20 6265 3a20  lation. Can be: 
+0001eeb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001eec0: 202d 2022 636f 6e74 6f75 7222 3a20 6361   - "contour": ca
+0001eed0: 6c63 756c 6174 6520 6d65 7472 6963 2066  lculate metric f
+0001eee0: 726f 6d20 7368 6170 656c 7920 636f 6e74  rom shapely cont
+0001eef0: 6f75 7273 2e0a 2020 2020 2020 2020 2020  ours..          
+0001ef00: 2020 2020 2020 2d20 226d 6173 6b22 3a20        - "mask": 
+0001ef10: 6361 6c63 7561 6c74 6520 6d65 7472 6963  calcualte metric
+0001ef20: 2066 726f 6d20 6269 6e61 7279 206d 6173   from binary mas
+0001ef30: 6b73 2e0a 2020 2020 2020 2020 2020 2020  ks..            
+0001ef40: 2020 2020 2d20 4e6f 6e65 3a20 7573 6520      - None: use 
+0001ef50: 7468 6520 6d65 7468 6f64 2073 6574 2069  the method set i
+0001ef60: 6e20 7365 6c66 2e64 6566 6175 6c74 5f67  n self.default_g
+0001ef70: 656f 6d5f 6d65 7468 6f64 2e0a 0a20 2020  eom_method...   
+0001ef80: 2020 2020 2073 6c69 6365 5f73 7461 745f       slice_stat_
+0001ef90: 6b77 6172 6773 203a 2064 6963 742c 2064  kwargs : dict, d
+0001efa0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0001efb0: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
+0001efc0: 6172 6775 6d65 6e74 7320 746f 2062 6520  arguments to be 
+0001efd0: 7061 7373 6564 2074 6f20 6675 6e63 7469  passed to functi
+0001efe0: 6f6e 206f 6620 7374 6174 6973 7469 6373  on of statistics
+0001eff0: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
+0001f000: 756c 6520 666f 7220 6361 6c63 756c 6174  ule for calculat
+0001f010: 696f 6e20 7265 6c61 7469 7665 2074 6f20  ion relative to 
+0001f020: 736c 6963 6520 7661 6c75 6573 2e20 2046  slice values.  F
+0001f030: 6f72 2065 7861 6d70 6c65 2c0a 2020 2020  or example,.    
+0001f040: 2020 2020 2020 2020 6966 2071 7561 6e74          if quant
+0001f050: 696c 6573 2061 7265 2072 6571 7569 7265  iles are require
+0001f060: 6420 666f 7220 3130 2069 6e74 6572 7661  d for 10 interva
+0001f070: 6c73 2c20 7261 7468 6572 2074 6861 6e20  ls, rather than 
+0001f080: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+0001f090: 7468 6520 6465 6661 756c 7420 6f66 2034  the default of 4
+0001f0a0: 2c20 7468 6973 2063 616e 2062 6520 7370  , this can be sp
+0001f0b0: 6563 6966 6965 6420 7573 696e 673a 0a0a  ecified using:..
+0001f0c0: 2020 2020 2020 2020 2020 2020 736c 6963              slic
+0001f0d0: 655f 7374 6174 5f6b 7761 7267 737b 226e  e_stat_kwargs{"n
+0001f0e0: 2220 3a20 3130 7d0a 0a20 2020 2020 2020  " : 10}..       
+0001f0f0: 2020 2020 2046 6f72 2061 7661 696c 6162       For availab
+0001f100: 6c65 206b 6579 776f 7264 206f 7074 696f  le keyword optio
+0001f110: 6e73 2c20 7365 6520 646f 6375 6d65 6e74  ns, see document
+0001f120: 6174 696f 6e20 6f66 2073 7461 7469 7374  ation of statist
+0001f130: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
+0001f140: 6d6f 6475 6c65 2061 743a 0a0a 2020 2020  module at:..    
+0001f150: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
+0001f160: 646f 6373 2e70 7974 686f 6e2e 6f72 672f  docs.python.org/
+0001f170: 332f 6c69 6272 6172 792f 7374 6174 6973  3/library/statis
+0001f180: 7469 6373 2e68 746d 6c0a 2020 2020 2020  tics.html.      
+0001f190: 2020 2222 220a 2020 2020 2020 2020 6279    """.        by
+0001f1a0: 5f73 6c69 6365 203d 2062 795f 736c 6963  _slice = by_slic
+0001f1b0: 6520 6f72 2073 6b72 742e 636f 7265 2e44  e or skrt.core.D
+0001f1c0: 6566 6175 6c74 7328 292e 6279 5f73 6c69  efaults().by_sli
+0001f1d0: 6365 0a20 2020 2020 2020 2073 6c69 6365  ce.        slice
+0001f1e0: 5f73 7461 745f 6b77 6172 6773 203d 2073  _stat_kwargs = s
+0001f1f0: 6c69 6365 5f73 7461 745f 6b77 6172 6773  lice_stat_kwargs
+0001f200: 206f 7220 7b7d 0a0a 2020 2020 2020 2020   or {}..        
+0001f210: 7265 7475 726e 2073 6b72 742e 636f 7265  return skrt.core
+0001f220: 2e67 6574 5f73 7461 7428 7365 6c66 2e67  .get_stat(self.g
+0001f230: 6574 5f6d 6574 7269 635f 6279 5f73 6c69  et_metric_by_sli
+0001f240: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
+0001f250: 6f74 6865 722c 206d 6574 7269 632c 2062  other, metric, b
+0001f260: 795f 736c 6963 652c 2076 6965 772c 206d  y_slice, view, m
+0001f270: 6574 686f 6429 2c0a 2020 2020 2020 2020  ethod),.        
+0001f280: 2020 2020 7661 6c75 655f 666f 725f 6e6f      value_for_no
+0001f290: 6e65 2c20 736c 6963 655f 7374 6174 2c20  ne, slice_stat, 
+0001f2a0: 2a2a 736c 6963 655f 7374 6174 5f6b 7761  **slice_stat_kwa
+0001f2b0: 7267 7329 0a0a 2020 2020 6465 6620 6765  rgs)..    def ge
+0001f2c0: 745f 736c 6963 655f 7374 6174 7328 7365  t_slice_stats(se
+0001f2d0: 6c66 2c20 6f74 6865 722c 206d 6574 7269  lf, other, metri
+0001f2e0: 6373 3d4e 6f6e 652c 2073 6c69 6365 5f73  cs=None, slice_s
+0001f2f0: 7461 7473 3d4e 6f6e 652c 0a20 2020 2020  tats=None,.     
+0001f300: 2020 2020 2020 2064 6566 6175 6c74 5f62         default_b
+0001f310: 795f 736c 6963 653d 4e6f 6e65 2c20 6d65  y_slice=None, me
+0001f320: 7468 6f64 3d4e 6f6e 652c 2076 6965 773d  thod=None, view=
+0001f330: 2278 2d79 222c 0a20 2020 2020 2020 2020  "x-y",.         
+0001f340: 2020 2073 6570 6172 6174 655f 636f 6d70     separate_comp
+0001f350: 6f6e 656e 7473 3d46 616c 7365 293a 0a20  onents=False):. 
+0001f360: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001f370: 2020 2047 6574 2064 6963 7469 6f6e 6172     Get dictionar
+0001f380: 7920 6f66 2073 7461 7469 7374 6963 7320  y of statistics 
+0001f390: 666f 7220 736c 6963 652d 6279 2d73 6c69  for slice-by-sli
+0001f3a0: 6365 2063 6f6d 7061 7269 736f 6e20 6d65  ce comparison me
+0001f3b0: 7472 6963 732e 0a0a 2020 2020 2020 2020  trics...        
+0001f3c0: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+0001f3d0: 0a20 2020 2020 2020 206f 7468 6572 203a  .        other :
+0001f3e0: 2052 4f49 0a20 2020 2020 2020 2020 2020   ROI.           
+0001f3f0: 204f 7468 6572 2052 4f49 2074 6f20 636f   Other ROI to co
+0001f400: 6d70 6172 6520 7769 7468 2074 6869 7320  mpare with this 
+0001f410: 524f 492e 0a0a 2020 2020 2020 2020 6d65  ROI...        me
+0001f420: 7472 6963 7320 3a20 7374 722f 6c69 7374  trics : str/list
+0001f430: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+0001f440: 2020 2020 2020 2020 2020 204d 6574 7269             Metri
+0001f450: 6328 7329 2066 6f72 2077 6869 6368 2073  c(s) for which s
+0001f460: 7461 7469 7374 6963 2873 2920 666f 7220  tatistic(s) for 
+0001f470: 736c 6963 652d 6279 2d73 6c69 6365 2063  slice-by-slice c
+0001f480: 616c 6375 6c61 7469 6f6e 730a 2020 2020  alculations.    
+0001f490: 2020 2020 2020 2020 6172 6520 746f 2062          are to b
+0001f4a0: 6520 7265 7475 726e 6564 2e20 2041 2073  e returned.  A s
+0001f4b0: 696e 676c 6520 6d65 7472 6963 2063 616e  ingle metric can
+0001f4c0: 2062 7920 7370 6566 6963 6965 6420 6173   by speficied as
+0001f4d0: 2061 2073 7472 696e 672e 0a20 2020 2020   a string..     
+0001f4e0: 2020 2020 2020 204d 756c 7469 706c 6520         Multiple 
+0001f4f0: 6d65 7472 6963 7320 6361 6e20 6265 2073  metrics can be s
+0001f500: 7065 6369 6669 6564 2061 7320 6120 6c69  pecified as a li
+0001f510: 7374 206f 6620 7374 7269 6e67 732e 0a0a  st of strings...
+0001f520: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
+0001f530: 6174 7320 3a20 7374 722f 6c69 7374 2f64  ats : str/list/d
+0001f540: 6963 742c 2064 6566 6175 6c74 3d4e 6f6e  ict, default=Non
+0001f550: 650a 2020 2020 2020 2020 2020 2020 5370  e.            Sp
+0001f560: 6563 6966 6963 6174 696f 6e20 6f66 2073  ecification of s
+0001f570: 7461 7469 7374 6963 7320 746f 2062 6520  tatistics to be 
+0001f580: 6361 6c63 756c 6174 6564 2072 656c 6174  calculated relat
+0001f590: 6976 650a 2020 2020 2020 2020 2020 2020  ive.            
+0001f5a0: 746f 2073 6c69 6365 2d62 792d 736c 6963  to slice-by-slic
+0001f5b0: 6520 6d65 7472 6963 2076 616c 7565 732e  e metric values.
+0001f5c0: 2020 5573 6564 2066 6f72 2061 6c6c 206d    Used for all m
+0001f5d0: 6574 7269 6373 2077 6974 680a 2020 2020  etrics with.    
+0001f5e0: 2020 2020 2020 2020 7375 6666 6978 2022          suffix "
+0001f5f0: 5f73 6c69 6365 5f73 7461 7473 2220 696e  _slice_stats" in
+0001f600: 2074 6865 203c 6d65 7472 6963 733e 206c   the <metrics> l
+0001f610: 6973 742e 0a0a 2020 2020 2020 2020 2020  ist...          
+0001f620: 2020 4120 7374 6174 6973 7469 6320 6973    A statistic is
+0001f630: 2073 7065 6369 6669 6564 2062 7920 7468   specified by th
+0001f640: 6520 6e61 6d65 206f 6620 7468 6520 6675  e name of the fu
+0001f650: 6e63 7469 6f6e 2066 6f72 0a20 2020 2020  nction for.     
+0001f660: 2020 2020 2020 2069 7473 2063 616c 6375         its calcu
+0001f670: 6c61 7469 6f6e 2069 6e20 7468 6520 5079  lation in the Py
+0001f680: 7468 6f6e 2073 7461 7469 7374 6963 7320  thon statistics 
+0001f690: 6d6f 6475 6c65 3a0a 0a20 2020 2020 2020  module:..       
+0001f6a0: 2020 2020 2068 7474 7073 3a2f 2f64 6f63       https://doc
+0001f6b0: 732e 7079 7468 6f6e 2e6f 7267 2f33 2f6c  s.python.org/3/l
+0001f6c0: 6962 7261 7279 2f73 7461 7469 7374 6963  ibrary/statistic
+0001f6d0: 732e 6874 6d6c 0a0a 2020 2020 2020 2020  s.html..        
+0001f6e0: 2020 2020 466f 7220 6974 7320 7573 6520      For its use 
+0001f6f0: 6865 7265 2c20 7468 6520 7265 6c65 7661  here, the releva
+0001f700: 6e74 2066 756e 6374 696f 6e20 6d75 7374  nt function must
+0001f710: 2072 6571 7569 7265 0a20 2020 2020 2020   require.       
+0001f720: 2020 2020 2061 2073 696e 676c 652d 7661       a single-va
+0001f730: 7269 6162 6c65 2069 6e70 7574 2c20 6d75  riable input, mu
+0001f740: 7374 206e 6f74 2072 6571 7569 7265 2061  st not require a
+0001f750: 6e79 206b 6579 776f 7264 0a20 2020 2020  ny keyword.     
+0001f760: 2020 2020 2020 2061 7267 756d 656e 7473         arguments
+0001f770: 2c20 616e 6420 6d75 7374 2072 6574 7572  , and must retur
+0001f780: 6e20 6120 7369 6e67 6c65 206e 756d 6265  n a single numbe
+0001f790: 722e 0a0a 2020 2020 2020 2020 2020 2020  r...            
+0001f7a0: 4176 6169 6c61 626c 6520 6f70 7469 6f6e  Available option
+0001f7b0: 7320 696e 636c 7564 653a 2022 6d65 616e  s include: "mean
+0001f7c0: 222c 2022 6d65 6469 616e 222c 2022 6d6f  ", "median", "mo
+0001f7d0: 6465 222c 0a20 2020 2020 2020 2020 2020  de",.           
+0001f7e0: 2022 7374 6465 7622 2e0a 0a20 2020 2020   "stdev"...     
+0001f7f0: 2020 2020 2020 5374 6174 6973 7469 6373        Statistics
+0001f800: 2074 6f20 6265 2063 616c 6375 6c61 7465   to be calculate
+0001f810: 6420 6361 6e20 6265 2073 7065 6369 6669  d can be specifi
+0001f820: 6564 2075 7369 6e67 2061 6e79 206f 660a  ed using any of.
+0001f830: 2020 2020 2020 2020 2020 2074 6865 2066             the f
+0001f840: 6f6c 6c6f 7769 6e67 3a0a 0a20 2020 2020  ollowing:..     
+0001f850: 2020 2020 2020 2d20 5374 7269 6e67 2073        - String s
+0001f860: 7065 6369 6679 696e 6720 7369 6e67 6c65  pecifying single
+0001f870: 2073 7461 7469 7374 6963 2074 6f20 6265   statistic to be
+0001f880: 2063 616c 6375 6c61 7465 642c 0a20 2020   calculated,.   
+0001f890: 2020 2020 2020 2020 2020 7769 7468 2073            with s
+0001f8a0: 6c69 6365 7320 636f 6e73 6964 6572 6564  lices considered
+0001f8b0: 2061 7320 6769 7665 6e20 6279 2064 6566   as given by def
+0001f8c0: 6175 6c74 5f62 795f 736c 6963 652c 0a20  ault_by_slice,. 
+0001f8d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001f8e0: 6578 616d 706c 653a 2022 6d65 616e 223b  example: "mean";
+0001f8f0: 0a20 2020 2020 2020 2020 2020 2d20 4c69  .           - Li
+0001f900: 7374 2073 7065 6369 6679 696e 6720 6d75  st specifying mu
+0001f910: 6c74 6970 6c65 2073 7461 7469 7374 6963  ltiple statistic
+0001f920: 7320 746f 2062 6520 6361 6c63 756c 6174  s to be calculat
+0001f930: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+0001f940: 2077 6974 6820 736c 6963 6573 2063 6f6e   with slices con
+0001f950: 7369 6465 7265 6420 6173 2067 6976 656e  sidered as given
+0001f960: 2062 7920 6465 6661 756c 745f 6279 5f73   by default_by_s
+0001f970: 6c69 6365 2c0a 2020 2020 2020 2020 2020  lice,.          
+0001f980: 2020 2066 6f72 2065 7861 6d70 6c65 3a20     for example: 
+0001f990: 5b22 6d65 616e 222c 2022 7374 6465 7622  ["mean", "stdev"
+0001f9a0: 5d3b 0a20 2020 2020 2020 2020 2020 2d20  ];.           - 
+0001f9b0: 4469 6374 696f 6e61 7279 2077 6865 7265  Dictionary where
+0001f9c0: 206b 6579 7320 7370 6563 6966 7920 736c   keys specify sl
+0001f9d0: 6963 6573 2074 6f20 6265 2063 6f6e 7369  ices to be consi
+0001f9e0: 6465 7265 642c 0a20 2020 2020 2020 2020  dered,.         
+0001f9f0: 2020 2020 616e 6420 7661 6c75 6573 2073      and values s
+0001fa00: 7065 6369 6679 2073 7461 7469 7374 6963  pecify statistic
+0001fa10: 7320 2873 7472 696e 6720 6f72 206c 6973  s (string or lis
+0001fa20: 7429 2c20 666f 720a 2020 2020 2020 2020  t), for.        
+0001fa30: 2020 2020 2065 7861 6d70 6c65 3a20 7b22       example: {"
+0001fa40: 756e 696f 6e22 3a20 5b22 6d65 616e 222c  union": ["mean",
+0001fa50: 2022 7374 6465 7622 5d7d 2e20 2056 616c   "stdev"]}.  Val
+0001fa60: 6964 2073 6c69 6365 0a20 2020 2020 2020  id slice.       
+0001fa70: 2020 2020 2020 7370 6563 6966 6963 6174        specificat
+0001fa80: 696f 6e73 2061 7265 2061 7320 6c69 7374  ions are as list
+0001fa90: 6564 2066 6f72 2064 6566 6175 6c74 5f62  ed for default_b
+0001faa0: 795f 736c 6963 652e 0a0a 2020 2020 2020  y_slice...      
+0001fab0: 2020 6465 6661 756c 745f 6279 5f73 6c69    default_by_sli
+0001fac0: 6365 3a20 7374 722c 2064 6566 6175 6c74  ce: str, default
+0001fad0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0001fae0: 2020 4465 6661 756c 7420 7370 6563 6966    Default specif
+0001faf0: 6963 6174 696f 6e20 6f66 2073 6c69 6365  ication of slice
+0001fb00: 7320 746f 2062 6520 636f 6e73 6964 6572  s to be consider
+0001fb10: 6564 2077 6865 6e0a 2020 2020 2020 2020  ed when.        
+0001fb20: 2020 2020 6361 6c63 756c 6174 696e 6720      calculating 
+0001fb30: 736c 6963 652d 6279 2d73 6c69 6365 2073  slice-by-slice s
+0001fb40: 7461 7469 7374 6963 732e 2020 5468 6520  tatistics.  The 
+0001fb50: 7661 6c69 6420 7370 6563 6966 6963 6174  valid specificat
+0001fb60: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
+0001fb70: 2061 7265 3a0a 0a20 2020 2020 2020 2020   are:..         
+0001fb80: 2020 202d 2022 6c65 6674 223a 2063 6f6e     - "left": con
+0001fb90: 7369 6465 7220 6f6e 6c79 2073 6c69 6365  sider only slice
+0001fba0: 7320 636f 6e74 6169 6e69 6e67 2073 656c  s containing sel
+0001fbb0: 663b 0a20 2020 2020 2020 2020 2020 202d  f;.            -
+0001fbc0: 2022 7269 6768 7422 3a20 636f 6e73 6964   "right": consid
+0001fbd0: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
+0001fbe0: 6f6e 7461 696e 696e 6720 6f74 6865 7220  ontaining other 
+0001fbf0: 726f 693b 0a20 2020 2020 2020 2020 2020  roi;.           
+0001fc00: 202d 2022 756e 696f 6e22 3a20 636f 6e73   - "union": cons
+0001fc10: 6964 6572 2073 6c69 6365 7320 636f 6e74  ider slices cont
+0001fc20: 6169 6e69 6e67 2065 6974 6865 7220 6f66  aining either of
+0001fc30: 2073 656c 6620 616e 6420 6f74 6865 7220   self and other 
+0001fc40: 726f 693b 0a20 2020 2020 2020 2020 2020  roi;.           
+0001fc50: 202d 2022 696e 7465 7273 6563 7469 6f6e   - "intersection
+0001fc60: 223a 2063 6f6e 7369 6465 7220 736c 6963  ": consider slic
+0001fc70: 6573 2063 6f6e 7461 696e 696e 6720 626f  es containing bo
+0001fc80: 7468 206f 6620 7365 6c66 2061 6e64 0a20  th of self and. 
+0001fc90: 2020 2020 2020 2020 2020 2020 206f 7468               oth
+0001fca0: 6572 2072 6f69 2e0a 0a20 2020 2020 2020  er roi...       
+0001fcb0: 2020 2020 2049 6620 4e6f 6e65 2c20 7573       If None, us
+0001fcc0: 6520 736b 7274 2e63 6f72 652e 4465 6661  e skrt.core.Defa
+0001fcd0: 756c 7473 2829 2e62 795f 736c 6963 650a  ults().by_slice.
+0001fce0: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
+0001fcf0: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
+0001fd00: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
+0001fd10: 7269 656e 7461 7469 6f6e 206f 6620 736c  rientation of sl
+0001fd20: 6963 6573 206f 6e20 7768 6963 6820 746f  ices on which to
+0001fd30: 2067 6574 206d 6574 7269 6320 7661 6c75   get metric valu
+0001fd40: 6573 2e0a 0a20 2020 2020 2020 206d 6574  es...        met
+0001fd50: 686f 6420 3a20 7374 722c 2064 6566 6175  hod : str, defau
+0001fd60: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0001fd70: 2020 2020 4d65 7468 6f64 2074 6f20 7573      Method to us
+0001fd80: 6520 666f 7220 6d65 7472 6963 2063 616c  e for metric cal
+0001fd90: 6375 6c61 7469 6f6e 2e20 4361 6e20 6265  culation. Can be
+0001fda0: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+0001fdb0: 2020 202d 2022 636f 6e74 6f75 7222 3a20     - "contour": 
+0001fdc0: 6361 6c63 756c 6174 6520 6d65 7472 6963  calculate metric
+0001fdd0: 2066 726f 6d20 7368 6170 656c 7920 636f   from shapely co
+0001fde0: 6e74 6f75 7273 2e0a 2020 2020 2020 2020  ntours..        
+0001fdf0: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
+0001fe00: 3a20 6361 6c63 756c 6174 6520 6d65 7472  : calculate metr
+0001fe10: 6963 2066 726f 6d20 6269 6e61 7279 206d  ic from binary m
+0001fe20: 6173 6b73 2e0a 2020 2020 2020 2020 2020  asks..          
+0001fe30: 2020 2020 2020 2d20 4e6f 6e65 3a20 7573        - None: us
+0001fe40: 6520 7468 6520 6d65 7468 6f64 2073 6574  e the method set
+0001fe50: 2069 6e20 7365 6c66 2e64 6566 6175 6c74   in self.default
+0001fe60: 5f67 656f 6d5f 6d65 7468 6f64 2e0a 0a20  _geom_method... 
+0001fe70: 2020 2020 2020 2073 6570 6172 6174 655f         separate_
+0001fe80: 636f 6d70 6f6e 656e 7473 3a20 626f 6f6c  components: bool
+0001fe90: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
+0001fea0: 2020 2020 2020 2020 2020 2020 4966 2046              If F
+0001feb0: 616c 7365 2c20 7265 7475 726e 2061 206d  alse, return a m
+0001fec0: 6574 7269 6320 7265 7072 6573 656e 7465  etric represente
+0001fed0: 6420 6279 2061 2076 6563 746f 7220 6173  d by a vector as
+0001fee0: 2061 0a20 2020 2020 2020 2020 2020 206c   a.            l
+0001fef0: 6973 7420 6f66 2063 6f6d 706f 6e65 6e74  ist of component
+0001ff00: 2076 616c 7565 732e 2020 4966 2074 7275   values.  If tru
+0001ff10: 652c 2072 6574 7572 6e20 6120 7365 7061  e, return a sepa
+0001ff20: 7261 7465 206d 6574 7269 6320 666f 720a  rate metric for.
+0001ff30: 2020 2020 2020 2020 2020 2020 6561 6368              each
+0001ff40: 2063 6f6d 706f 6e65 6e74 2c20 6c61 6265   component, labe
+0001ff50: 6c6c 696e 6720 6279 2074 6865 2063 6f6d  lling by the com
+0001ff60: 706f 6e65 6e74 2061 7865 7320 6465 7465  ponent axes dete
+0001ff70: 726d 696e 6564 0a20 2020 2020 2020 2020  rmined.         
+0001ff80: 2020 2066 726f 6d20 3c76 6965 773e 2e0a     from <view>..
+0001ff90: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001ffa0: 2020 2020 6966 206d 6574 7269 6373 2069      if metrics i
+0001ffb0: 7320 4e6f 6e65 206f 7220 736c 6963 655f  s None or slice_
+0001ffc0: 7374 6174 7320 6973 204e 6f6e 653a 0a20  stats is None:. 
+0001ffd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001ffe0: 6e20 7b7d 0a0a 2020 2020 2020 2020 6465  n {}..        de
+0001fff0: 6661 756c 745f 6279 5f73 6c69 6365 203d  fault_by_slice =
+00020000: 2064 6566 6175 6c74 5f62 795f 736c 6963   default_by_slic
+00020010: 6520 6f72 2073 6b72 742e 636f 7265 2e44  e or skrt.core.D
+00020020: 6566 6175 6c74 7328 292e 6279 5f73 6c69  efaults().by_sli
+00020030: 6365 0a0a 2020 2020 2020 2020 2320 456e  ce..        # En
+00020040: 7375 7265 2074 6861 7420 6d65 7472 6963  sure that metric
+00020050: 7320 6973 2061 206e 6f6e 2d65 6d70 7479  s is a non-empty
+00020060: 206c 6973 742e 0a20 2020 2020 2020 2069   list..        i
+00020070: 6620 6973 696e 7374 616e 6365 286d 6574  f isinstance(met
+00020080: 7269 6373 2c20 7374 7229 3a0a 2020 2020  rics, str):.    
+00020090: 2020 2020 2020 2020 6d65 7472 6963 7320          metrics 
+000200a0: 3d20 5b6d 6574 7269 6373 5d0a 2020 2020  = [metrics].    
+000200b0: 2020 2020 656c 6966 206e 6f74 2073 6b72      elif not skr
+000200c0: 742e 636f 7265 2e69 735f 6c69 7374 286d  t.core.is_list(m
+000200d0: 6574 7269 6373 293a 0a20 2020 2020 2020  etrics):.       
+000200e0: 2020 2020 2072 6574 7572 6e20 7b7d 0a20       return {}. 
+000200f0: 2020 2020 2020 206d 6574 7269 6373 203d         metrics =
+00020100: 205b 6d65 7472 6963 2066 6f72 206d 6574   [metric for met
+00020110: 7269 6320 696e 206d 6574 7269 6373 0a20  ric in metrics. 
+00020120: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00020130: 6620 6622 7b6d 6574 7269 637d 5f73 6c69  f f"{metric}_sli
+00020140: 6365 5f73 7461 7473 2220 696e 2067 6574  ce_stats" in get
+00020150: 5f63 6f6d 7061 7269 736f 6e5f 6d65 7472  _comparison_metr
+00020160: 6963 7328 295d 0a20 2020 2020 2020 2069  ics()].        i
+00020170: 6620 6e6f 7420 6d65 7472 6963 733a 0a20  f not metrics:. 
+00020180: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00020190: 6e20 7b7d 0a0a 2020 2020 2020 2020 736c  n {}..        sl
+000201a0: 6963 655f 7374 6174 7320 3d20 6578 7061  ice_stats = expa
+000201b0: 6e64 5f73 6c69 6365 5f73 7461 7473 2873  nd_slice_stats(s
+000201c0: 6c69 6365 5f73 7461 7473 2c20 6465 6661  lice_stats, defa
+000201d0: 756c 745f 6279 5f73 6c69 6365 290a 2020  ult_by_slice).  
+000201e0: 2020 2020 2020 6966 206e 6f74 2073 6c69        if not sli
+000201f0: 6365 5f73 7461 7473 3a0a 2020 2020 2020  ce_stats:.      
+00020200: 2020 2020 2020 7265 7475 726e 207b 7d0a        return {}.
+00020210: 0a20 2020 2020 2020 2023 2043 616c 6375  .        # Calcu
+00020220: 6c61 7465 2073 7461 7469 7374 6963 2873  late statistic(s
+00020230: 2920 666f 7220 6d65 7472 6963 2076 616c  ) for metric val
+00020240: 7565 7320 6361 6c63 756c 6174 6564 2073  ues calculated s
+00020250: 6c69 6365 2062 7920 736c 6963 652e 0a20  lice by slice.. 
+00020260: 2020 2020 2020 2063 616c 6375 6c61 7465         calculate
+00020270: 645f 736c 6963 655f 7374 6174 7320 3d20  d_slice_stats = 
+00020280: 7b7d 0a20 2020 2020 2020 2066 6f72 206d  {}.        for m
+00020290: 6574 7269 6320 696e 206d 6574 7269 6373  etric in metrics
+000202a0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+000202b0: 7220 6279 5f73 6c69 6365 2c20 7374 6174  r by_slice, stat
+000202c0: 7320 696e 2073 6c69 6365 5f73 7461 7473  s in slice_stats
+000202d0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+000202e0: 2020 2020 2020 2020 2020 7661 6c75 6573            values
+000202f0: 203d 2073 656c 662e 6765 745f 6d65 7472   = self.get_metr
+00020300: 6963 5f62 795f 736c 6963 6528 0a20 2020  ic_by_slice(.   
+00020310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020320: 2020 2020 206f 7468 6572 2c20 6d65 7472       other, metr
+00020330: 6963 2c20 6279 5f73 6c69 6365 2c20 7669  ic, by_slice, vi
+00020340: 6577 2c20 6d65 7468 6f64 290a 2020 2020  ew, method).    
+00020350: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00020360: 7374 6174 2069 6e20 7374 6174 733a 0a20  stat in stats:. 
+00020370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020380: 2020 206b 6579 203d 2066 227b 6d65 7472     key = f"{metr
+00020390: 6963 7d5f 736c 6963 655f 7b62 795f 736c  ic}_slice_{by_sl
+000203a0: 6963 657d 5f7b 7374 6174 7d22 0a20 2020  ice}_{stat}".   
+000203b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000203c0: 2063 616c 6375 6c61 7465 645f 736c 6963   calculated_slic
+000203d0: 655f 7374 6174 735b 6b65 795d 203d 2028  e_stats[key] = (
+000203e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000203f0: 2020 2020 2020 2020 2020 2020 2073 6b72               skr
+00020400: 742e 636f 7265 2e67 6574 5f73 7461 7428  t.core.get_stat(
+00020410: 7661 6c75 6573 2c20 7374 6174 3d73 7461  values, stat=sta
+00020420: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
+00020430: 2020 2020 2020 2020 6966 2028 736b 7274          if (skrt
+00020440: 2e63 6f72 652e 6973 5f6c 6973 7428 6361  .core.is_list(ca
+00020450: 6c63 756c 6174 6564 5f73 6c69 6365 5f73  lculated_slice_s
+00020460: 7461 7473 5b6b 6579 5d29 0a20 2020 2020  tats[key]).     
+00020470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020480: 2020 2020 2020 2061 6e64 2073 6570 6172         and separ
+00020490: 6174 655f 636f 6d70 6f6e 656e 7473 293a  ate_components):
+000204a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000204b0: 2020 2020 2020 2020 2076 6563 746f 7220           vector 
+000204c0: 3d20 6361 6c63 756c 6174 6564 5f73 6c69  = calculated_sli
+000204d0: 6365 5f73 7461 7473 2e70 6f70 286b 6579  ce_stats.pop(key
+000204e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000204f0: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
+00020500: 2069 5f61 7820 696e 2065 6e75 6d65 7261   i_ax in enumera
+00020510: 7465 2873 6b72 742e 696d 6167 652e 5f70  te(skrt.image._p
+00020520: 6c6f 745f 6178 6573 5b76 6965 775d 293a  lot_axes[view]):
+00020530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020540: 2020 2020 2020 2020 2020 2020 2061 7820               ax 
+00020550: 3d20 736b 7274 2e69 6d61 6765 2e5f 6178  = skrt.image._ax
+00020560: 6573 5b69 5f61 785d 0a20 2020 2020 2020  es[i_ax].       
 00020570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020580: 2020 2020 2020 2020 2020 2063 616c 6375             calcu
-00020590: 6c61 7465 645f 736c 6963 655f 7374 6174  lated_slice_stat
-000205a0: 735b 6178 5f6b 6579 5d20 3d20 7665 6374  s[ax_key] = vect
-000205b0: 6f72 5b69 5d0a 0a20 2020 2020 2020 2072  or[i]..        r
-000205c0: 6574 7572 6e20 6361 6c63 756c 6174 6564  eturn calculated
-000205d0: 5f73 6c69 6365 5f73 7461 7473 0a0a 2020  _slice_stats..  
-000205e0: 2020 6465 6620 6d61 7463 685f 6d61 736b    def match_mask
-000205f0: 5f76 6f78 656c 5f73 697a 6528 7365 6c66  _voxel_size(self
-00020600: 2c20 6f74 6865 722c 2076 6f78 656c 5f73  , other, voxel_s
-00020610: 697a 653d 4e6f 6e65 2c0a 2020 2020 2020  ize=None,.      
-00020620: 2020 2020 2020 766f 7865 6c5f 6469 6d5f        voxel_dim_
-00020630: 746f 6c65 7261 6e63 653d 302e 3129 3a0a  tolerance=0.1):.
-00020640: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
-00020650: 2020 2020 456e 7375 7265 2074 6861 7420      Ensure that 
-00020660: 7468 6520 6d61 736b 2076 6f78 656c 2073  the mask voxel s
-00020670: 697a 6573 206f 6620 3c73 656c 663e 2061  izes of <self> a
-00020680: 6e64 203c 6f74 6865 723e 206d 6174 6368  nd <other> match
-00020690: 2e0a 0a20 2020 2020 2020 2054 6865 206d  ...        The m
-000206a0: 6173 6b20 766f 7865 6c5f 7369 7a65 7320  ask voxel_sizes 
-000206b0: 666f 7220 626f 7468 206d 6179 206f 7074  for both may opt
-000206c0: 696f 6e61 6c6c 7920 6265 2073 6574 2074  ionally be set t
-000206d0: 6f20 6120 6e65 770a 2020 2020 2020 2020  o a new.        
-000206e0: 636f 6d6d 6f6e 2076 616c 7565 2e0a 0a20  common value... 
-000206f0: 2020 2020 2020 202a 2a50 6172 616d 7465         **Paramte
-00020700: 7273 3a2a 2a0a 0a20 2020 2020 2020 206f  rs:**..        o
-00020710: 7468 6572 203a 2073 6b72 742e 7374 7275  ther : skrt.stru
-00020720: 6374 7572 6573 2e52 4f49 0a20 2020 2020  ctures.ROI.     
-00020730: 2020 2020 2020 2052 4f49 2077 6974 6820         ROI with 
-00020740: 7768 6963 6820 766f 7865 6c20 7369 7a65  which voxel size
-00020750: 2069 7320 746f 2062 6520 6d61 7463 6865   is to be matche
-00020760: 642e 0a0a 2020 2020 2020 2020 766f 7865  d...        voxe
-00020770: 6c5f 7369 7a65 203a 2074 7570 6c65 2c20  l_size : tuple, 
-00020780: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-00020790: 2020 2020 2020 2020 2056 6f78 656c 2073           Voxel s
-000207a0: 697a 6520 2864 782c 2064 792c 2064 7a29  ize (dx, dy, dz)
-000207b0: 2069 6e20 6d6d 2074 6f20 6265 2075 7365   in mm to be use
-000207c0: 6420 666f 7220 524f 4920 6d61 736b 730a  d for ROI masks.
-000207d0: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
-000207e0: 2077 6869 6368 2074 6f20 6361 6c63 756c   which to calcul
-000207f0: 6174 6520 7375 7266 6163 6520 6469 7374  ate surface dist
-00020800: 616e 6365 732e 2020 4966 204e 6f6e 652c  ances.  If None,
-00020810: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-00020820: 206d 6173 6b20 766f 7865 6c20 7369 7a65   mask voxel size
-00020830: 206f 6620 3c6f 7468 6572 3e20 6973 2075   of <other> is u
-00020840: 7365 6420 6966 206e 6f74 204e 6f6e 653b  sed if not None;
-00020850: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
-00020860: 6572 7769 7365 2074 6865 2064 6566 6175  erwise the defau
-00020870: 6c74 2076 6f78 656c 2073 697a 6520 666f  lt voxel size fo
-00020880: 7220 6475 6d6d 7920 696d 6167 6573 2c0a  r dummy images,.
-00020890: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-000208a0: 6c79 2028 312c 2031 2c20 3129 2c20 6973  ly (1, 1, 1), is
-000208b0: 2075 7365 642e 2020 4966 2061 6e20 656c   used.  If an el
-000208c0: 656d 656e 7420 6f66 2074 6865 0a20 2020  ement of the.   
-000208d0: 2020 2020 2020 2020 2074 7570 6c65 2073           tuple s
-000208e0: 7065 6369 6679 696e 6720 766f 7865 6c20  pecifying voxel 
-000208f0: 7369 7a65 2069 7320 4e6f 6e65 2c20 7468  size is None, th
-00020900: 6520 7661 6c75 6520 666f 720a 2020 2020  e value for.    
-00020910: 2020 2020 2020 2020 7468 6520 636f 7272          the corr
-00020920: 6573 706f 6e64 696e 6720 656c 656d 656e  esponding elemen
-00020930: 7420 6f66 2074 6865 206d 6173 6b20 766f  t of the mask vo
-00020940: 7865 6c20 7369 7a65 206f 660a 2020 2020  xel size of.    
-00020950: 2020 2020 2020 2020 3c6f 7468 6572 3e20          <other> 
-00020960: 6973 2075 7365 642e 0a0a 2020 2020 2020  is used...      
-00020970: 2020 766f 7865 6c5f 6469 6d5f 746f 6c65    voxel_dim_tole
-00020980: 7261 6e63 6520 3a20 666c 6f61 742c 2064  rance : float, d
-00020990: 6566 6175 6c74 3d30 2e31 0a20 2020 2020  efault=0.1.     
-000209a0: 2020 2020 2020 204d 6178 696d 756d 2061         Maximum a
-000209b0: 6363 6570 7465 6420 7661 6c75 6520 666f  ccepted value fo
-000209c0: 7220 7468 6520 6162 736f 6c75 7465 2064  r the absolute d
-000209d0: 6966 6665 7265 6e63 6520 696e 2076 6f78  ifference in vox
-000209e0: 656c 2073 697a 650a 2020 2020 2020 2020  el size.        
-000209f0: 2020 2020 2861 6e79 2064 696d 656e 7369      (any dimensi
-00020a00: 6f6e 2920 6f66 2074 6865 2052 4f49 206d  on) of the ROI m
-00020a10: 6173 6b73 2066 6f72 2074 6865 6d20 746f  asks for them to
-00020a20: 2062 6520 636f 6e73 6964 6572 6564 0a20   be considered. 
-00020a30: 2020 2020 2020 2020 2020 2061 7320 6861             as ha
-00020a40: 7669 6e67 2074 6865 2073 616d 6520 766f  ving the same vo
-00020a50: 7865 6c20 7369 7a65 2e20 2049 6620 6120  xel size.  If a 
-00020a60: 6e65 6761 7469 7665 2076 616c 7565 2069  negative value i
-00020a70: 7320 6769 7665 6e2c 0a20 2020 2020 2020  s given,.       
-00020a80: 2020 2020 2074 6865 2061 6273 6f6c 7574       the absolut
-00020a90: 6520 6469 6666 6572 656e 6365 2069 7320  e difference is 
-00020aa0: 6e65 7665 7220 6265 6c6f 7720 7468 6973  never below this
-00020ab0: 2c20 666f 7263 696e 6720 6372 6561 7469  , forcing creati
-00020ac0: 6f6e 0a20 2020 2020 2020 2020 2020 206f  on.            o
-00020ad0: 6620 6e65 7720 6d61 736b 7320 7769 7468  f new masks with
-00020ae0: 2074 6865 2074 6865 2073 7065 6369 6669   the the specifi
-00020af0: 6564 2076 6f78 656c 2073 697a 652e 2020  ed voxel size.  
-00020b00: 5468 6973 2063 616e 2062 650a 2020 2020  This can be.    
-00020b10: 2020 2020 2020 2020 7573 6566 756c 2066          useful f
-00020b20: 6f72 206f 6274 6169 6e69 6e67 206d 6173  or obtaining mas
-00020b30: 6b73 2074 6861 7420 6172 6520 6a75 7374  ks that are just
-00020b40: 206c 6172 6765 2065 6e6f 7567 6820 746f   large enough to
-00020b50: 2063 6f6e 7461 696e 0a20 2020 2020 2020   contain.       
-00020b60: 2020 2020 2062 6f74 6820 524f 4973 2c20       both ROIs, 
-00020b70: 706f 7465 6e74 6961 6c6c 7920 7265 6475  potentially redu
-00020b80: 6369 6e67 2074 6865 2074 696d 6520 666f  cing the time fo
-00020b90: 7220 7375 7266 6163 652d 6469 7374 616e  r surface-distan
-00020ba0: 6365 0a20 2020 2020 2020 2020 2020 2063  ce.            c
-00020bb0: 616c 6375 6c61 7469 6f6e 732e 0a20 2020  alculations..   
-00020bc0: 2020 2020 2027 2727 0a20 2020 2020 2020       '''.       
-00020bd0: 2023 2043 7265 6174 6520 524f 4920 636c   # Create ROI cl
-00020be0: 6f6e 6573 2c20 666f 7220 7768 6963 6820  ones, for which 
-00020bf0: 766f 7865 6c20 7369 7a65 7320 6d61 7920  voxel sizes may 
-00020c00: 6265 2061 6c74 6572 6564 2e0a 2020 2020  be altered..    
-00020c10: 2020 2020 726f 6931 203d 2073 656c 662e      roi1 = self.
-00020c20: 636c 6f6e 6528 290a 2020 2020 2020 2020  clone().        
-00020c30: 726f 6932 203d 206f 7468 6572 2e63 6c6f  roi2 = other.clo
-00020c40: 6e65 2829 0a0a 2020 2020 2020 2020 2320  ne()..        # 
-00020c50: 4173 736f 6369 6174 6520 6e65 7720 6475  Associate new du
-00020c60: 6d6d 7920 696d 6167 6520 7769 7468 2052  mmy image with R
-00020c70: 4f49 7320 6966 2072 6571 7565 7374 6564  OIs if requested
-00020c80: 2076 6f78 656c 2073 697a 650a 2020 2020   voxel size.    
-00020c90: 2020 2020 2320 6973 2064 6966 6665 7265      # is differe
-00020ca0: 6e74 2066 726f 6d20 766f 7865 6c20 7369  nt from voxel si
-00020cb0: 7a65 206f 6620 6569 7468 6572 2063 7572  ze of either cur
-00020cc0: 7265 6e74 2069 6d61 6765 2c0a 2020 2020  rent image,.    
-00020cd0: 2020 2020 2320 6f72 2069 6620 6162 736f      # or if abso
-00020ce0: 6c75 7465 2064 6966 6665 7265 6e63 6520  lute difference 
-00020cf0: 696e 2061 6e79 2064 696d 656e 7369 6f6e  in any dimension
-00020d00: 2062 6574 7765 656e 2076 6f78 656c 2073   between voxel s
-00020d10: 697a 6573 0a20 2020 2020 2020 2023 206f  izes.        # o
-00020d20: 6620 6375 7272 656e 7420 696d 6167 6573  f current images
-00020d30: 2064 6f6e 2774 206d 6174 6368 2069 7320   don't match is 
-00020d40: 6772 6561 7465 7220 7468 616e 2074 6f6c  greater than tol
-00020d50: 6572 616e 6365 2e0a 2020 2020 2020 2020  erance..        
-00020d60: 766f 7865 6c5f 7369 7a65 203d 2076 6f78  voxel_size = vox
-00020d70: 656c 5f73 697a 6520 6966 2076 6f78 656c  el_size if voxel
-00020d80: 5f73 697a 6520 656c 7365 2072 6f69 322e  _size else roi2.
-00020d90: 6765 745f 766f 7865 6c5f 7369 7a65 2829  get_voxel_size()
-00020da0: 0a20 2020 2020 2020 2069 6620 766f 7865  .        if voxe
-00020db0: 6c5f 7369 7a65 2061 6e64 2072 6f69 322e  l_size and roi2.
-00020dc0: 6765 745f 766f 7865 6c5f 7369 7a65 2829  get_voxel_size()
-00020dd0: 3a0a 2020 2020 2020 2020 2020 2020 766f  :.            vo
-00020de0: 7865 6c5f 7369 7a65 203d 205b 766f 7865  xel_size = [voxe
-00020df0: 6c5f 7369 7a65 5b69 6478 5d20 6966 2076  l_size[idx] if v
-00020e00: 6f78 656c 5f73 697a 655b 6964 785d 2069  oxel_size[idx] i
-00020e10: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
-00020e20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00020e30: 6c73 6520 726f 6932 2e67 6574 5f76 6f78  lse roi2.get_vox
-00020e40: 656c 5f73 697a 6528 295b 6964 785d 2066  el_size()[idx] f
-00020e50: 6f72 2069 6478 2069 6e20 7261 6e67 6528  or idx in range(
-00020e60: 3329 5d0a 2020 2020 2020 2020 7265 7369  3)].        resi
-00020e70: 7a65 203d 206e 6f74 2072 6f69 312e 6765  ze = not roi1.ge
-00020e80: 745f 766f 7865 6c5f 7369 7a65 2829 206f  t_voxel_size() o
-00020e90: 7220 6e6f 7420 726f 6932 2e67 6574 5f76  r not roi2.get_v
-00020ea0: 6f78 656c 5f73 697a 6528 290a 2020 2020  oxel_size().    
-00020eb0: 2020 2020 6966 206e 6f74 2072 6573 697a      if not resiz
-00020ec0: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
-00020ed0: 6f72 2072 6f69 2069 6e20 5b72 6f69 312c  or roi in [roi1,
-00020ee0: 2072 6f69 325d 3a0a 2020 2020 2020 2020   roi2]:.        
-00020ef0: 2020 2020 2020 2020 6d61 7463 6865 7320          matches 
-00020f00: 3d20 5b64 7879 7a31 2066 6f72 2064 7879  = [dxyz1 for dxy
-00020f10: 7a31 2c20 6478 797a 3220 696e 0a20 2020  z1, dxyz2 in.   
-00020f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f30: 2020 2020 207a 6970 2876 6f78 656c 5f73       zip(voxel_s
-00020f40: 697a 652c 2072 6f69 2e76 6f78 656c 5f73  ize, roi.voxel_s
-00020f50: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
-00020f60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00020f70: 6162 7328 6478 797a 3120 2d20 6478 797a  abs(dxyz1 - dxyz
-00020f80: 3229 203c 2076 6f78 656c 5f64 696d 5f74  2) < voxel_dim_t
-00020f90: 6f6c 6572 616e 6365 5d0a 2020 2020 2020  olerance].      
-00020fa0: 2020 2020 2020 2020 2020 6966 2033 2021            if 3 !
-00020fb0: 3d20 6c65 6e28 6d61 7463 6865 7329 3a0a  = len(matches):.
-00020fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020fd0: 2020 2020 7265 7369 7a65 203d 2054 7275      resize = Tru
-00020fe0: 650a 2020 2020 2020 2020 6966 2072 6573  e.        if res
-00020ff0: 697a 653a 0a20 2020 2020 2020 2020 2020  ize:.           
-00021000: 2069 6620 766f 7865 6c5f 7369 7a65 3a0a   if voxel_size:.
-00021010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021020: 736c 6963 655f 7468 6963 6b6e 6573 7320  slice_thickness 
-00021030: 3d20 766f 7865 6c5f 7369 7a65 5b32 5d0a  = voxel_size[2].
-00021040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021050: 766f 7865 6c5f 7369 7a65 5f32 6420 3d20  voxel_size_2d = 
-00021060: 766f 7865 6c5f 7369 7a65 5b3a 325d 0a20  voxel_size[:2]. 
-00021070: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00021080: 2045 6e73 7572 6520 7468 6174 2069 6e69   Ensure that ini
-00021090: 7469 616c 2076 6f78 656c 2073 697a 6520  tial voxel size 
-000210a0: 6973 2073 6574 2e0a 2020 2020 2020 2020  is set..        
-000210b0: 2020 2020 2020 2020 2320 5468 6973 2069          # This i
-000210c0: 7320 7573 6564 2074 6f20 6465 6669 6e65  s used to define
-000210d0: 2073 6c69 6365 2074 6869 636b 6e65 7373   slice thickness
-000210e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000210f0: 2023 2066 6f72 2061 6e20 524f 4920 7468   # for an ROI th
-00021100: 6174 2068 6173 206e 6f20 6173 736f 6369  at has no associ
-00021110: 6174 6564 2069 6d61 6765 2c0a 2020 2020  ated image,.    
-00021120: 2020 2020 2020 2020 2020 2020 2320 616e              # an
-00021130: 6420 6973 2064 6566 696e 6564 2062 7920  d is defined by 
-00021140: 6f6e 6520 6f72 206d 6f72 6520 636f 6e74  one or more cont
-00021150: 6f75 7273 206f 6e20 6120 7369 6e67 6c65  ours on a single
-00021160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021170: 2023 2069 6d61 6765 2073 6c69 6365 2e0a   # image slice..
-00021180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021190: 6966 206e 6f74 2072 6f69 312e 766f 7865  if not roi1.voxe
-000211a0: 6c5f 7369 7a65 3a0a 2020 2020 2020 2020  l_size:.        
-000211b0: 2020 2020 2020 2020 2020 2020 726f 6931              roi1
-000211c0: 2e76 6f78 656c 5f73 697a 6520 3d20 766f  .voxel_size = vo
-000211d0: 7865 6c5f 7369 7a65 0a20 2020 2020 2020  xel_size.       
-000211e0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-000211f0: 726f 6932 2e76 6f78 656c 5f73 697a 653a  roi2.voxel_size:
-00021200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021210: 2020 2020 2072 6f69 322e 766f 7865 6c5f       roi2.voxel_
-00021220: 7369 7a65 203d 2076 6f78 656c 5f73 697a  size = voxel_siz
-00021230: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
-00021240: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00021250: 2020 2020 736c 6963 655f 7468 6963 6b6e      slice_thickn
-00021260: 6573 7320 3d20 4e6f 6e65 0a20 2020 2020  ess = None.     
-00021270: 2020 2020 2020 2020 2020 2076 6f78 656c             voxel
-00021280: 5f73 697a 655f 3264 203d 204e 6f6e 650a  _size_2d = None.
-00021290: 0a20 2020 2020 2020 2020 2020 2053 7472  .            Str
-000212a0: 7563 7475 7265 5365 7428 5b72 6f69 312c  uctureSet([roi1,
-000212b0: 2072 6f69 325d 292e 7365 745f 696d 6167   roi2]).set_imag
-000212c0: 655f 746f 5f64 756d 6d79 280a 2020 2020  e_to_dummy(.    
-000212d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000212e0: 736c 6963 655f 7468 6963 6b6e 6573 733d  slice_thickness=
-000212f0: 736c 6963 655f 7468 6963 6b6e 6573 732c  slice_thickness,
-00021300: 2076 6f78 656c 5f73 697a 653d 766f 7865   voxel_size=voxe
-00021310: 6c5f 7369 7a65 5f32 6429 0a0a 2020 2020  l_size_2d)..    
-00021320: 2020 2020 7265 7475 726e 2028 726f 6931      return (roi1
-00021330: 2c20 726f 6932 290a 0a20 2020 2064 6566  , roi2)..    def
-00021340: 2067 6574 5f73 7572 6661 6365 5f64 6973   get_surface_dis
-00021350: 7461 6e63 6573 280a 2020 2020 2020 2020  tances(.        
-00021360: 7365 6c66 2c0a 2020 2020 2020 2020 6f74  self,.        ot
-00021370: 6865 722c 0a20 2020 2020 2020 2073 696e  her,.        sin
-00021380: 676c 655f 736c 6963 653d 4661 6c73 652c  gle_slice=False,
-00021390: 0a20 2020 2020 2020 2073 6967 6e65 643d  .        signed=
-000213a0: 4661 6c73 652c 0a20 2020 2020 2020 2076  False,.        v
-000213b0: 6965 773d 2278 2d79 222c 0a20 2020 2020  iew="x-y",.     
-000213c0: 2020 2073 6c3d 4e6f 6e65 2c0a 2020 2020     sl=None,.    
-000213d0: 2020 2020 6964 783d 4e6f 6e65 2c0a 2020      idx=None,.  
-000213e0: 2020 2020 2020 706f 733d 4e6f 6e65 2c0a        pos=None,.
-000213f0: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
-00021400: 7669 7479 3d32 2c0a 2020 2020 2020 2020  vity=2,.        
-00021410: 666c 6174 7465 6e3d 4661 6c73 652c 0a20  flatten=False,. 
-00021420: 2020 2020 2020 2073 796d 6d65 7472 6963         symmetric
-00021430: 3d4e 6f6e 652c 0a20 2020 2020 2020 2063  =None,.        c
-00021440: 6f6e 666f 726d 6974 793d 4661 6c73 652c  onformity=False,
-00021450: 0a20 2020 2020 2020 2069 6e5f 736c 6963  .        in_slic
-00021460: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
-00021470: 766f 7865 6c5f 7369 7a65 3d4e 6f6e 652c  voxel_size=None,
-00021480: 0a20 2020 2020 2020 2076 6f78 656c 5f64  .        voxel_d
-00021490: 696d 5f74 6f6c 6572 616e 6365 3d30 2e31  im_tolerance=0.1
-000214a0: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
-000214b0: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
-000214c0: 2076 6563 746f 7220 6f66 2073 7572 6661   vector of surfa
-000214d0: 6365 2064 6973 7461 6e63 6573 2062 6574  ce distances bet
-000214e0: 7765 656e 2074 776f 2052 4f49 732e 0a0a  ween two ROIs...
-000214f0: 2020 2020 2020 2020 5375 7266 6163 6520          Surface 
-00021500: 6469 7374 616e 6365 7320 6d61 7920 6265  distances may be
-00021510: 2073 6967 6e65 6420 6f72 2075 6e73 6967   signed or unsig
-00021520: 6e65 642c 2061 6e64 206d 6179 2062 6520  ned, and may be 
-00021530: 666f 7220 6120 7369 6e67 6c65 0a20 2020  for a single.   
-00021540: 2020 2020 2073 6c69 6365 2074 6872 6f75       slice throu
-00021550: 6768 2074 6865 2052 4f49 732c 206f 7220  gh the ROIs, or 
-00021560: 666f 7220 7468 6520 3344 2076 6f6c 756d  for the 3D volum
-00021570: 6573 2e20 200a 0a20 2020 2020 2020 2054  es.  ..        T
-00021580: 6869 7320 6675 6e63 7469 6f6e 2075 7365  his function use
-00021590: 7320 6964 6561 7320 6f75 746c 696e 6564  s ideas outlined
-000215a0: 2061 743a 0a20 2020 2020 2020 2068 7474   at:.        htt
-000215b0: 7073 3a2f 2f6d 6c6e 6f74 6562 6f6f 6b2e  ps://mlnotebook.
-000215c0: 6769 7468 7562 2e69 6f2f 706f 7374 2f73  github.io/post/s
-000215d0: 7572 6661 6365 2d64 6973 7461 6e63 652d  urface-distance-
-000215e0: 6675 6e63 7469 6f6e 2f0a 0a20 2020 2020  function/..     
-000215f0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-00021600: 2a2a 0a0a 2020 2020 2020 2020 7369 6e67  **..        sing
-00021610: 6c65 5f73 6c69 6365 203a 2062 6f6f 6c2c  le_slice : bool,
-00021620: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
-00021630: 2020 2020 2020 2020 2020 2049 6620 4661             If Fa
-00021640: 6c73 652c 2072 6574 7572 6e20 7375 7266  lse, return surf
-00021650: 6163 6520 6469 7374 616e 6365 7320 7265  ace distances re
-00021660: 6c61 7469 7665 2074 6f20 3344 2076 6f6c  lative to 3D vol
-00021670: 756d 6573 2e0a 2020 2020 2020 2020 2020  umes..          
-00021680: 2020 4f74 6865 7277 6973 652c 2072 6574    Otherwise, ret
+00020580: 2020 2020 2061 785f 6b65 7920 3d20 6622       ax_key = f"
+00020590: 7b6d 6574 7269 637d 5f7b 6178 7d5f 736c  {metric}_{ax}_sl
+000205a0: 6963 655f 7b62 795f 736c 6963 657d 5f7b  ice_{by_slice}_{
+000205b0: 7374 6174 7d22 0a20 2020 2020 2020 2020  stat}".         
+000205c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000205d0: 2020 2063 616c 6375 6c61 7465 645f 736c     calculated_sl
+000205e0: 6963 655f 7374 6174 735b 6178 5f6b 6579  ice_stats[ax_key
+000205f0: 5d20 3d20 7665 6374 6f72 5b69 5d0a 0a20  ] = vector[i].. 
+00020600: 2020 2020 2020 2072 6574 7572 6e20 6361         return ca
+00020610: 6c63 756c 6174 6564 5f73 6c69 6365 5f73  lculated_slice_s
+00020620: 7461 7473 0a0a 2020 2020 6465 6620 6d61  tats..    def ma
+00020630: 7463 685f 6d61 736b 5f76 6f78 656c 5f73  tch_mask_voxel_s
+00020640: 697a 6528 7365 6c66 2c20 6f74 6865 722c  ize(self, other,
+00020650: 2076 6f78 656c 5f73 697a 653d 4e6f 6e65   voxel_size=None
+00020660: 2c0a 2020 2020 2020 2020 2020 2020 766f  ,.            vo
+00020670: 7865 6c5f 6469 6d5f 746f 6c65 7261 6e63  xel_dim_toleranc
+00020680: 653d 302e 3129 3a0a 2020 2020 2020 2020  e=0.1):.        
+00020690: 2727 270a 2020 2020 2020 2020 456e 7375  '''.        Ensu
+000206a0: 7265 2074 6861 7420 7468 6520 6d61 736b  re that the mask
+000206b0: 2076 6f78 656c 2073 697a 6573 206f 6620   voxel sizes of 
+000206c0: 3c73 656c 663e 2061 6e64 203c 6f74 6865  <self> and <othe
+000206d0: 723e 206d 6174 6368 2e0a 0a20 2020 2020  r> match...     
+000206e0: 2020 2054 6865 206d 6173 6b20 766f 7865     The mask voxe
+000206f0: 6c5f 7369 7a65 7320 666f 7220 626f 7468  l_sizes for both
+00020700: 206d 6179 206f 7074 696f 6e61 6c6c 7920   may optionally 
+00020710: 6265 2073 6574 2074 6f20 6120 6e65 770a  be set to a new.
+00020720: 2020 2020 2020 2020 636f 6d6d 6f6e 2076          common v
+00020730: 616c 7565 2e0a 0a20 2020 2020 2020 202a  alue...        *
+00020740: 2a50 6172 616d 7465 7273 3a2a 2a0a 0a20  *Paramters:**.. 
+00020750: 2020 2020 2020 206f 7468 6572 203a 2073         other : s
+00020760: 6b72 742e 7374 7275 6374 7572 6573 2e52  krt.structures.R
+00020770: 4f49 0a20 2020 2020 2020 2020 2020 2052  OI.            R
+00020780: 4f49 2077 6974 6820 7768 6963 6820 766f  OI with which vo
+00020790: 7865 6c20 7369 7a65 2069 7320 746f 2062  xel size is to b
+000207a0: 6520 6d61 7463 6865 642e 0a0a 2020 2020  e matched...    
+000207b0: 2020 2020 766f 7865 6c5f 7369 7a65 203a      voxel_size :
+000207c0: 2074 7570 6c65 2c20 6465 6661 756c 743d   tuple, default=
+000207d0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+000207e0: 2056 6f78 656c 2073 697a 6520 2864 782c   Voxel size (dx,
+000207f0: 2064 792c 2064 7a29 2069 6e20 6d6d 2074   dy, dz) in mm t
+00020800: 6f20 6265 2075 7365 6420 666f 7220 524f  o be used for RO
+00020810: 4920 6d61 736b 730a 2020 2020 2020 2020  I masks.        
+00020820: 2020 2020 6672 6f6d 2077 6869 6368 2074      from which t
+00020830: 6f20 6361 6c63 756c 6174 6520 7375 7266  o calculate surf
+00020840: 6163 6520 6469 7374 616e 6365 732e 2020  ace distances.  
+00020850: 4966 204e 6f6e 652c 0a20 2020 2020 2020  If None,.       
+00020860: 2020 2020 2074 6865 206d 6173 6b20 766f       the mask vo
+00020870: 7865 6c20 7369 7a65 206f 6620 3c6f 7468  xel size of <oth
+00020880: 6572 3e20 6973 2075 7365 6420 6966 206e  er> is used if n
+00020890: 6f74 204e 6f6e 653b 0a20 2020 2020 2020  ot None;.       
+000208a0: 2020 2020 206f 7468 6572 7769 7365 2074       otherwise t
+000208b0: 6865 2064 6566 6175 6c74 2076 6f78 656c  he default voxel
+000208c0: 2073 697a 6520 666f 7220 6475 6d6d 7920   size for dummy 
+000208d0: 696d 6167 6573 2c0a 2020 2020 2020 2020  images,.        
+000208e0: 2020 2020 6e61 6d65 6c79 2028 312c 2031      namely (1, 1
+000208f0: 2c20 3129 2c20 6973 2075 7365 642e 2020  , 1), is used.  
+00020900: 4966 2061 6e20 656c 656d 656e 7420 6f66  If an element of
+00020910: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00020920: 2074 7570 6c65 2073 7065 6369 6679 696e   tuple specifyin
+00020930: 6720 766f 7865 6c20 7369 7a65 2069 7320  g voxel size is 
+00020940: 4e6f 6e65 2c20 7468 6520 7661 6c75 6520  None, the value 
+00020950: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+00020960: 7468 6520 636f 7272 6573 706f 6e64 696e  the correspondin
+00020970: 6720 656c 656d 656e 7420 6f66 2074 6865  g element of the
+00020980: 206d 6173 6b20 766f 7865 6c20 7369 7a65   mask voxel size
+00020990: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
+000209a0: 3c6f 7468 6572 3e20 6973 2075 7365 642e  <other> is used.
+000209b0: 0a0a 2020 2020 2020 2020 766f 7865 6c5f  ..        voxel_
+000209c0: 6469 6d5f 746f 6c65 7261 6e63 6520 3a20  dim_tolerance : 
+000209d0: 666c 6f61 742c 2064 6566 6175 6c74 3d30  float, default=0
+000209e0: 2e31 0a20 2020 2020 2020 2020 2020 204d  .1.            M
+000209f0: 6178 696d 756d 2061 6363 6570 7465 6420  aximum accepted 
+00020a00: 7661 6c75 6520 666f 7220 7468 6520 6162  value for the ab
+00020a10: 736f 6c75 7465 2064 6966 6665 7265 6e63  solute differenc
+00020a20: 6520 696e 2076 6f78 656c 2073 697a 650a  e in voxel size.
+00020a30: 2020 2020 2020 2020 2020 2020 2861 6e79              (any
+00020a40: 2064 696d 656e 7369 6f6e 2920 6f66 2074   dimension) of t
+00020a50: 6865 2052 4f49 206d 6173 6b73 2066 6f72  he ROI masks for
+00020a60: 2074 6865 6d20 746f 2062 6520 636f 6e73   them to be cons
+00020a70: 6964 6572 6564 0a20 2020 2020 2020 2020  idered.         
+00020a80: 2020 2061 7320 6861 7669 6e67 2074 6865     as having the
+00020a90: 2073 616d 6520 766f 7865 6c20 7369 7a65   same voxel size
+00020aa0: 2e20 2049 6620 6120 6e65 6761 7469 7665  .  If a negative
+00020ab0: 2076 616c 7565 2069 7320 6769 7665 6e2c   value is given,
+00020ac0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00020ad0: 2061 6273 6f6c 7574 6520 6469 6666 6572   absolute differ
+00020ae0: 656e 6365 2069 7320 6e65 7665 7220 6265  ence is never be
+00020af0: 6c6f 7720 7468 6973 2c20 666f 7263 696e  low this, forcin
+00020b00: 6720 6372 6561 7469 6f6e 0a20 2020 2020  g creation.     
+00020b10: 2020 2020 2020 206f 6620 6e65 7720 6d61         of new ma
+00020b20: 736b 7320 7769 7468 2074 6865 2074 6865  sks with the the
+00020b30: 2073 7065 6369 6669 6564 2076 6f78 656c   specified voxel
+00020b40: 2073 697a 652e 2020 5468 6973 2063 616e   size.  This can
+00020b50: 2062 650a 2020 2020 2020 2020 2020 2020   be.            
+00020b60: 7573 6566 756c 2066 6f72 206f 6274 6169  useful for obtai
+00020b70: 6e69 6e67 206d 6173 6b73 2074 6861 7420  ning masks that 
+00020b80: 6172 6520 6a75 7374 206c 6172 6765 2065  are just large e
+00020b90: 6e6f 7567 6820 746f 2063 6f6e 7461 696e  nough to contain
+00020ba0: 0a20 2020 2020 2020 2020 2020 2062 6f74  .            bot
+00020bb0: 6820 524f 4973 2c20 706f 7465 6e74 6961  h ROIs, potentia
+00020bc0: 6c6c 7920 7265 6475 6369 6e67 2074 6865  lly reducing the
+00020bd0: 2074 696d 6520 666f 7220 7375 7266 6163   time for surfac
+00020be0: 652d 6469 7374 616e 6365 0a20 2020 2020  e-distance.     
+00020bf0: 2020 2020 2020 2063 616c 6375 6c61 7469         calculati
+00020c00: 6f6e 732e 0a20 2020 2020 2020 2027 2727  ons..        '''
+00020c10: 0a20 2020 2020 2020 2023 2043 7265 6174  .        # Creat
+00020c20: 6520 524f 4920 636c 6f6e 6573 2c20 666f  e ROI clones, fo
+00020c30: 7220 7768 6963 6820 766f 7865 6c20 7369  r which voxel si
+00020c40: 7a65 7320 6d61 7920 6265 2061 6c74 6572  zes may be alter
+00020c50: 6564 2e0a 2020 2020 2020 2020 726f 6931  ed..        roi1
+00020c60: 203d 2073 656c 662e 636c 6f6e 6528 290a   = self.clone().
+00020c70: 2020 2020 2020 2020 726f 6932 203d 206f          roi2 = o
+00020c80: 7468 6572 2e63 6c6f 6e65 2829 0a0a 2020  ther.clone()..  
+00020c90: 2020 2020 2020 2320 4173 736f 6369 6174        # Associat
+00020ca0: 6520 6e65 7720 6475 6d6d 7920 696d 6167  e new dummy imag
+00020cb0: 6520 7769 7468 2052 4f49 7320 6966 2072  e with ROIs if r
+00020cc0: 6571 7565 7374 6564 2076 6f78 656c 2073  equested voxel s
+00020cd0: 697a 650a 2020 2020 2020 2020 2320 6973  ize.        # is
+00020ce0: 2064 6966 6665 7265 6e74 2066 726f 6d20   different from 
+00020cf0: 766f 7865 6c20 7369 7a65 206f 6620 6569  voxel size of ei
+00020d00: 7468 6572 2063 7572 7265 6e74 2069 6d61  ther current ima
+00020d10: 6765 2c0a 2020 2020 2020 2020 2320 6f72  ge,.        # or
+00020d20: 2069 6620 6162 736f 6c75 7465 2064 6966   if absolute dif
+00020d30: 6665 7265 6e63 6520 696e 2061 6e79 2064  ference in any d
+00020d40: 696d 656e 7369 6f6e 2062 6574 7765 656e  imension between
+00020d50: 2076 6f78 656c 2073 697a 6573 0a20 2020   voxel sizes.   
+00020d60: 2020 2020 2023 206f 6620 6375 7272 656e       # of curren
+00020d70: 7420 696d 6167 6573 2064 6f6e 2774 206d  t images don't m
+00020d80: 6174 6368 2069 7320 6772 6561 7465 7220  atch is greater 
+00020d90: 7468 616e 2074 6f6c 6572 616e 6365 2e0a  than tolerance..
+00020da0: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
+00020db0: 7a65 203d 2076 6f78 656c 5f73 697a 6520  ze = voxel_size 
+00020dc0: 6966 2076 6f78 656c 5f73 697a 6520 656c  if voxel_size el
+00020dd0: 7365 2072 6f69 322e 6765 745f 766f 7865  se roi2.get_voxe
+00020de0: 6c5f 7369 7a65 2829 0a20 2020 2020 2020  l_size().       
+00020df0: 2069 6620 766f 7865 6c5f 7369 7a65 2061   if voxel_size a
+00020e00: 6e64 2072 6f69 322e 6765 745f 766f 7865  nd roi2.get_voxe
+00020e10: 6c5f 7369 7a65 2829 3a0a 2020 2020 2020  l_size():.      
+00020e20: 2020 2020 2020 766f 7865 6c5f 7369 7a65        voxel_size
+00020e30: 203d 205b 766f 7865 6c5f 7369 7a65 5b69   = [voxel_size[i
+00020e40: 6478 5d20 6966 2076 6f78 656c 5f73 697a  dx] if voxel_siz
+00020e50: 655b 6964 785d 2069 7320 6e6f 7420 4e6f  e[idx] is not No
+00020e60: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
+00020e70: 2020 2020 2020 2065 6c73 6520 726f 6932         else roi2
+00020e80: 2e67 6574 5f76 6f78 656c 5f73 697a 6528  .get_voxel_size(
+00020e90: 295b 6964 785d 2066 6f72 2069 6478 2069  )[idx] for idx i
+00020ea0: 6e20 7261 6e67 6528 3329 5d0a 2020 2020  n range(3)].    
+00020eb0: 2020 2020 7265 7369 7a65 203d 206e 6f74      resize = not
+00020ec0: 2072 6f69 312e 6765 745f 766f 7865 6c5f   roi1.get_voxel_
+00020ed0: 7369 7a65 2829 206f 7220 6e6f 7420 726f  size() or not ro
+00020ee0: 6932 2e67 6574 5f76 6f78 656c 5f73 697a  i2.get_voxel_siz
+00020ef0: 6528 290a 2020 2020 2020 2020 6966 206e  e().        if n
+00020f00: 6f74 2072 6573 697a 653a 0a20 2020 2020  ot resize:.     
+00020f10: 2020 2020 2020 2066 6f72 2072 6f69 2069         for roi i
+00020f20: 6e20 5b72 6f69 312c 2072 6f69 325d 3a0a  n [roi1, roi2]:.
+00020f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f40: 6d61 7463 6865 7320 3d20 5b64 7879 7a31  matches = [dxyz1
+00020f50: 2066 6f72 2064 7879 7a31 2c20 6478 797a   for dxyz1, dxyz
+00020f60: 3220 696e 0a20 2020 2020 2020 2020 2020  2 in.           
+00020f70: 2020 2020 2020 2020 2020 2020 207a 6970               zip
+00020f80: 2876 6f78 656c 5f73 697a 652c 2072 6f69  (voxel_size, roi
+00020f90: 2e76 6f78 656c 5f73 697a 6529 0a20 2020  .voxel_size).   
+00020fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020fb0: 2020 2020 2069 6620 6162 7328 6478 797a       if abs(dxyz
+00020fc0: 3120 2d20 6478 797a 3229 203c 2076 6f78  1 - dxyz2) < vox
+00020fd0: 656c 5f64 696d 5f74 6f6c 6572 616e 6365  el_dim_tolerance
+00020fe0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00020ff0: 2020 6966 2033 2021 3d20 6c65 6e28 6d61    if 3 != len(ma
+00021000: 7463 6865 7329 3a0a 2020 2020 2020 2020  tches):.        
+00021010: 2020 2020 2020 2020 2020 2020 7265 7369              resi
+00021020: 7a65 203d 2054 7275 650a 2020 2020 2020  ze = True.      
+00021030: 2020 6966 2072 6573 697a 653a 0a20 2020    if resize:.   
+00021040: 2020 2020 2020 2020 2069 6620 766f 7865           if voxe
+00021050: 6c5f 7369 7a65 3a0a 2020 2020 2020 2020  l_size:.        
+00021060: 2020 2020 2020 2020 736c 6963 655f 7468          slice_th
+00021070: 6963 6b6e 6573 7320 3d20 766f 7865 6c5f  ickness = voxel_
+00021080: 7369 7a65 5b32 5d0a 2020 2020 2020 2020  size[2].        
+00021090: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
+000210a0: 7a65 5f32 6420 3d20 766f 7865 6c5f 7369  ze_2d = voxel_si
+000210b0: 7a65 5b3a 325d 0a20 2020 2020 2020 2020  ze[:2].         
+000210c0: 2020 2020 2020 2023 2045 6e73 7572 6520         # Ensure 
+000210d0: 7468 6174 2069 6e69 7469 616c 2076 6f78  that initial vox
+000210e0: 656c 2073 697a 6520 6973 2073 6574 2e0a  el size is set..
+000210f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021100: 2320 5468 6973 2069 7320 7573 6564 2074  # This is used t
+00021110: 6f20 6465 6669 6e65 2073 6c69 6365 2074  o define slice t
+00021120: 6869 636b 6e65 7373 0a20 2020 2020 2020  hickness.       
+00021130: 2020 2020 2020 2020 2023 2066 6f72 2061           # for a
+00021140: 6e20 524f 4920 7468 6174 2068 6173 206e  n ROI that has n
+00021150: 6f20 6173 736f 6369 6174 6564 2069 6d61  o associated ima
+00021160: 6765 2c0a 2020 2020 2020 2020 2020 2020  ge,.            
+00021170: 2020 2020 2320 616e 6420 6973 2064 6566      # and is def
+00021180: 696e 6564 2062 7920 6f6e 6520 6f72 206d  ined by one or m
+00021190: 6f72 6520 636f 6e74 6f75 7273 206f 6e20  ore contours on 
+000211a0: 6120 7369 6e67 6c65 0a20 2020 2020 2020  a single.       
+000211b0: 2020 2020 2020 2020 2023 2069 6d61 6765           # image
+000211c0: 2073 6c69 6365 2e0a 2020 2020 2020 2020   slice..        
+000211d0: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
+000211e0: 6f69 312e 766f 7865 6c5f 7369 7a65 3a0a  oi1.voxel_size:.
+000211f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021200: 2020 2020 726f 6931 2e76 6f78 656c 5f73      roi1.voxel_s
+00021210: 697a 6520 3d20 766f 7865 6c5f 7369 7a65  ize = voxel_size
+00021220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021230: 2069 6620 6e6f 7420 726f 6932 2e76 6f78   if not roi2.vox
+00021240: 656c 5f73 697a 653a 0a20 2020 2020 2020  el_size:.       
+00021250: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+00021260: 322e 766f 7865 6c5f 7369 7a65 203d 2076  2.voxel_size = v
+00021270: 6f78 656c 5f73 697a 650a 2020 2020 2020  oxel_size.      
+00021280: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00021290: 2020 2020 2020 2020 2020 2020 736c 6963              slic
+000212a0: 655f 7468 6963 6b6e 6573 7320 3d20 4e6f  e_thickness = No
+000212b0: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
+000212c0: 2020 2076 6f78 656c 5f73 697a 655f 3264     voxel_size_2d
+000212d0: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
+000212e0: 2020 2020 2053 7472 7563 7475 7265 5365       StructureSe
+000212f0: 7428 5b72 6f69 312c 2072 6f69 325d 292e  t([roi1, roi2]).
+00021300: 7365 745f 696d 6167 655f 746f 5f64 756d  set_image_to_dum
+00021310: 6d79 280a 2020 2020 2020 2020 2020 2020  my(.            
+00021320: 2020 2020 2020 2020 736c 6963 655f 7468          slice_th
+00021330: 6963 6b6e 6573 733d 736c 6963 655f 7468  ickness=slice_th
+00021340: 6963 6b6e 6573 732c 2076 6f78 656c 5f73  ickness, voxel_s
+00021350: 697a 653d 766f 7865 6c5f 7369 7a65 5f32  ize=voxel_size_2
+00021360: 6429 0a0a 2020 2020 2020 2020 7265 7475  d)..        retu
+00021370: 726e 2028 726f 6931 2c20 726f 6932 290a  rn (roi1, roi2).
+00021380: 0a20 2020 2064 6566 2067 6574 5f73 7572  .    def get_sur
+00021390: 6661 6365 5f64 6973 7461 6e63 6573 280a  face_distances(.
+000213a0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+000213b0: 2020 2020 2020 6f74 6865 722c 0a20 2020        other,.   
+000213c0: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
+000213d0: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
+000213e0: 2073 6967 6e65 643d 4661 6c73 652c 0a20   signed=False,. 
+000213f0: 2020 2020 2020 2076 6965 773d 2278 2d79         view="x-y
+00021400: 222c 0a20 2020 2020 2020 2073 6c3d 4e6f  ",.        sl=No
+00021410: 6e65 2c0a 2020 2020 2020 2020 6964 783d  ne,.        idx=
+00021420: 4e6f 6e65 2c0a 2020 2020 2020 2020 706f  None,.        po
+00021430: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
+00021440: 636f 6e6e 6563 7469 7669 7479 3d32 2c0a  connectivity=2,.
+00021450: 2020 2020 2020 2020 666c 6174 7465 6e3d          flatten=
+00021460: 4661 6c73 652c 0a20 2020 2020 2020 2073  False,.        s
+00021470: 796d 6d65 7472 6963 3d4e 6f6e 652c 0a20  ymmetric=None,. 
+00021480: 2020 2020 2020 2063 6f6e 666f 726d 6974         conformit
+00021490: 793d 4661 6c73 652c 0a20 2020 2020 2020  y=False,.       
+000214a0: 2069 6e5f 736c 6963 653d 5472 7565 2c0a   in_slice=True,.
+000214b0: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
+000214c0: 7a65 3d4e 6f6e 652c 0a20 2020 2020 2020  ze=None,.       
+000214d0: 2076 6f78 656c 5f64 696d 5f74 6f6c 6572   voxel_dim_toler
+000214e0: 616e 6365 3d30 2e31 2c0a 2020 2020 293a  ance=0.1,.    ):
+000214f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00021500: 2020 2020 2047 6574 2076 6563 746f 7220       Get vector 
+00021510: 6f66 2073 7572 6661 6365 2064 6973 7461  of surface dista
+00021520: 6e63 6573 2062 6574 7765 656e 2074 776f  nces between two
+00021530: 2052 4f49 732e 0a0a 2020 2020 2020 2020   ROIs...        
+00021540: 5375 7266 6163 6520 6469 7374 616e 6365  Surface distance
+00021550: 7320 6d61 7920 6265 2073 6967 6e65 6420  s may be signed 
+00021560: 6f72 2075 6e73 6967 6e65 642c 2061 6e64  or unsigned, and
+00021570: 206d 6179 2062 6520 666f 7220 6120 7369   may be for a si
+00021580: 6e67 6c65 0a20 2020 2020 2020 2073 6c69  ngle.        sli
+00021590: 6365 2074 6872 6f75 6768 2074 6865 2052  ce through the R
+000215a0: 4f49 732c 206f 7220 666f 7220 7468 6520  OIs, or for the 
+000215b0: 3344 2076 6f6c 756d 6573 2e20 200a 0a20  3D volumes.  .. 
+000215c0: 2020 2020 2020 2054 6869 7320 6675 6e63         This func
+000215d0: 7469 6f6e 2075 7365 7320 6964 6561 7320  tion uses ideas 
+000215e0: 6f75 746c 696e 6564 2061 743a 0a20 2020  outlined at:.   
+000215f0: 2020 2020 2068 7474 7073 3a2f 2f6d 6c6e       https://mln
+00021600: 6f74 6562 6f6f 6b2e 6769 7468 7562 2e69  otebook.github.i
+00021610: 6f2f 706f 7374 2f73 7572 6661 6365 2d64  o/post/surface-d
+00021620: 6973 7461 6e63 652d 6675 6e63 7469 6f6e  istance-function
+00021630: 2f0a 0a20 2020 2020 2020 202a 2a50 6172  /..        **Par
+00021640: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
+00021650: 2020 2020 7369 6e67 6c65 5f73 6c69 6365      single_slice
+00021660: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+00021670: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+00021680: 2020 2049 6620 4661 6c73 652c 2072 6574     If False, ret
 00021690: 7572 6e20 7375 7266 6163 6520 6469 7374  urn surface dist
-000216a0: 616e 6365 7320 666f 7220 6120 7369 6e67  ances for a sing
-000216b0: 6c65 2069 6d61 6765 2073 6c69 6365 2e0a  le image slice..
-000216c0: 0a20 2020 2020 2020 2073 6967 6e65 6420  .        signed 
-000216d0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-000216e0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-000216f0: 2020 4966 2046 616c 7365 2c20 7265 7475    If False, retu
-00021700: 726e 2061 6273 6f6c 7574 6520 7375 7266  rn absolute surf
-00021710: 6163 6520 6469 7374 616e 6365 732e 0a20  ace distances.. 
-00021720: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
-00021730: 7565 2c20 7265 7475 726e 2073 6967 6e65  ue, return signe
-00021740: 6420 7375 7266 6163 6520 6469 7374 616e  d surface distan
-00021750: 6365 732e 2020 4120 706f 696e 7420 6f6e  ces.  A point on
-00021760: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00021770: 2073 7572 6661 6365 206f 6620 3c6f 7468   surface of <oth
-00021780: 6572 3e20 6973 2074 616b 656e 2074 6f20  er> is taken to 
-00021790: 6265 2061 7420 6120 706f 7369 7469 7665  be at a positive
-000217a0: 2064 6973 7461 6e63 6520 6966 0a20 2020   distance if.   
-000217b0: 2020 2020 2020 2020 206f 7574 7369 6465           outside
-000217c0: 203c 7365 6c66 3e2c 2061 6e64 2061 7420   <self>, and at 
-000217d0: 6120 6e65 6761 7469 7665 2064 6973 7461  a negative dista
-000217e0: 6e63 6520 6966 2069 6e73 6964 652e 0a0a  nce if inside...
-000217f0: 2020 2020 2020 2020 7669 6577 203a 2073          view : s
-00021800: 7472 2c20 6465 6661 756c 743d 2278 2d79  tr, default="x-y
-00021810: 220a 2020 2020 2020 2020 2020 2020 4f72  ".            Or
-00021820: 6965 6e74 6174 696f 6e20 6f66 2073 6c69  ientation of sli
-00021830: 6365 2066 6f72 2077 6869 6368 2074 6f20  ce for which to 
-00021840: 6f62 7461 696e 2073 7572 6661 6365 2064  obtain surface d
-00021850: 6973 7461 6e63 6573 2e0a 2020 2020 2020  istances..      
-00021860: 2020 2020 2020 4f6e 6c79 2075 7365 6420        Only used 
-00021870: 6966 2065 6974 6865 7220 3c73 696e 676c  if either <singl
-00021880: 655f 736c 6963 653e 206f 7220 3c66 6c61  e_slice> or <fla
-00021890: 7474 656e 3e20 6973 2054 7275 652e 0a0a  tten> is True...
-000218a0: 2020 2020 2020 2020 736c 203a 2069 6e74          sl : int
-000218b0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-000218c0: 2020 2020 2020 2020 2020 2053 6c69 6365             Slice
-000218d0: 206e 756d 6265 722e 2049 6620 6e6f 6e65   number. If none
-000218e0: 206f 6620 3c73 6c3e 2c20 3c69 6478 3e20   of <sl>, <idx> 
-000218f0: 6f72 203c 706f 733e 2069 7320 7375 7070  or <pos> is supp
-00021900: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
-00021910: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
-00021920: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
-00021930: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
-00021940: 6620 7468 6520 524f 4920 7769 6c6c 2062  f the ROI will b
-00021950: 6520 7573 6564 2e0a 0a20 2020 2020 2020  e used...       
-00021960: 2069 6478 203a 2069 6e74 2c20 6465 6661   idx : int, defa
-00021970: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00021980: 2020 2020 2041 7272 6179 2069 6e64 6578       Array index
-00021990: 206f 6620 736c 6963 652e 2049 6620 6e6f   of slice. If no
-000219a0: 6e65 206f 6620 3c73 6c3e 2c20 3c69 6478  ne of <sl>, <idx
-000219b0: 3e20 6f72 203c 706f 733e 2069 7320 0a20  > or <pos> is . 
-000219c0: 2020 2020 2020 2020 2020 2073 7570 706c             suppl
-000219d0: 6965 6420 6275 7420 3c73 696e 676c 655f  ied but <single_
-000219e0: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
-000219f0: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
-00021a00: 6520 6f66 0a20 2020 2020 2020 2020 2020  e of.           
-00021a10: 2074 6865 2052 4f49 2077 696c 6c20 6265   the ROI will be
-00021a20: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
-00021a30: 706f 7320 3a20 666c 6f61 742c 2064 6566  pos : float, def
-00021a40: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00021a50: 2020 2020 2020 536c 6963 6520 706f 7369        Slice posi
-00021a60: 7469 6f6e 2069 6e20 6d6d 2e20 4966 206e  tion in mm. If n
-00021a70: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
-00021a80: 783e 206f 7220 3c70 6f73 3e20 6973 2073  x> or <pos> is s
-00021a90: 7570 706c 6965 640a 2020 2020 2020 2020  upplied.        
-00021aa0: 2020 2020 6275 7420 3c73 696e 676c 655f      but <single_
-00021ab0: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
-00021ac0: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
-00021ad0: 6520 6f66 2074 6865 2052 4f49 2077 696c  e of the ROI wil
-00021ae0: 6c0a 2020 2020 2020 2020 2020 2020 6265  l.            be
-00021af0: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
-00021b00: 636f 6e6e 6563 7469 7669 7479 3a20 696e  connectivity: in
-00021b10: 742c 2064 6566 6175 6c74 3d32 0a20 2020  t, default=2.   
-00021b20: 2020 2020 2020 2020 2049 6e74 6567 6572           Integer
-00021b30: 2064 6566 696e 696e 6720 7768 6963 6820   defining which 
-00021b40: 766f 7865 6c73 2074 6f20 636f 6e73 6964  voxels to consid
-00021b50: 6572 2061 7320 6e65 6967 6862 6f75 7273  er as neighbours
-00021b60: 0a20 2020 2020 2020 2020 2020 2077 6865  .            whe
-00021b70: 6e20 7065 7266 6f72 6d69 6e67 2065 726f  n performing ero
-00021b80: 7369 6f6e 206f 7065 7261 7469 6f6e 2074  sion operation t
-00021b90: 6f20 6964 656e 7469 6679 2052 4f49 2073  o identify ROI s
-00021ba0: 7572 6661 6365 732e 2020 5468 6973 0a20  urfaces.  This. 
-00021bb0: 2020 2020 2020 2020 2020 2069 7320 7061             is pa
-00021bc0: 7373 6564 2061 7320 3c63 6f6e 6e65 6374  ssed as <connect
-00021bd0: 6976 6974 793e 2070 6172 616d 6574 6572  ivity> parameter
-00021be0: 2074 6f3a 0a20 2020 2020 2020 2020 2020   to:.           
-00021bf0: 2073 6369 7079 2e6e 6469 6d61 6765 2e67   scipy.ndimage.g
-00021c00: 656e 6572 6174 655f 6269 6e61 7279 5f73  enerate_binary_s
-00021c10: 7472 7563 7475 7265 0a20 2020 2020 2020  tructure.       
-00021c20: 2020 2020 2046 6f72 2066 7572 7468 6572       For further
-00021c30: 2064 6574 6169 6c73 2c20 7365 653a 0a20   details, see:. 
-00021c40: 2020 2020 2020 2020 2020 2068 7474 7073             https
-00021c50: 3a2f 2f64 6f63 732e 7363 6970 792e 6f72  ://docs.scipy.or
-00021c60: 672f 646f 632f 7363 6970 792f 7265 6665  g/doc/scipy/refe
-00021c70: 7265 6e63 652f 6765 6e65 7261 7465 642f  rence/generated/
-00021c80: 7363 6970 792e 6e64 696d 6167 652e 6765  scipy.ndimage.ge
-00021c90: 6e65 7261 7465 5f62 696e 6172 795f 7374  nerate_binary_st
-00021ca0: 7275 6374 7572 652e 6874 6d6c 0a0a 2020  ructure.html..  
-00021cb0: 2020 2020 2020 666c 6174 7465 6e20 3a20        flatten : 
-00021cc0: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
-00021cd0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00021ce0: 4966 2054 7275 652c 2061 6c6c 2073 6c69  If True, all sli
-00021cf0: 6365 7320 666f 7220 6561 6368 2052 4f49  ces for each ROI
-00021d00: 2077 696c 6c20 6265 2066 6c61 7474 656e   will be flatten
-00021d10: 6564 2069 6e20 7468 6520 6769 7665 6e0a  ed in the given.
-00021d20: 2020 2020 2020 2020 2020 2020 6f72 6965              orie
-00021d30: 6e74 6174 696f 6e2c 2061 6e64 2073 7572  ntation, and sur
-00021d40: 6661 6365 2064 6973 7461 6e63 6573 2072  face distances r
-00021d50: 656c 6174 6976 6520 746f 2074 6865 2066  elative to the f
-00021d60: 6c61 7474 656e 6564 0a20 2020 2020 2020  lattened.       
-00021d70: 2020 2020 2073 6c69 6365 2077 696c 6c20       slice will 
-00021d80: 6265 2072 6574 7572 6e65 642e 0a0a 2020  be returned...  
-00021d90: 2020 2020 2020 7379 6d6d 6574 7269 6320        symmetric 
-00021da0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-00021db0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00021dc0: 2049 6620 5472 7565 2c20 7468 6520 6469   If True, the di
-00021dd0: 7374 616e 6365 7320 7265 7475 726e 6564  stances returned
-00021de0: 2061 7265 2066 726f 6d20 7468 6520 7375   are from the su
-00021df0: 7266 6163 6520 6f66 203c 6f74 6865 723e  rface of <other>
-00021e00: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
-00021e10: 7468 6520 7375 7266 6163 6520 6f66 203c  the surface of <
-00021e20: 7365 6c66 3e20 616e 6420 6672 6f6d 2074  self> and from t
-00021e30: 6865 2073 7572 6661 6365 206f 6620 3c73  he surface of <s
-00021e40: 656c 663e 2074 6f20 7468 650a 2020 2020  elf> to the.    
-00021e50: 2020 2020 2020 2020 7375 7266 6163 6520          surface 
-00021e60: 6f66 203c 6f74 6865 723e 2e20 2049 6620  of <other>.  If 
-00021e70: 4661 6c73 652c 2064 6973 7461 6e63 6573  False, distances
-00021e80: 2061 7265 2066 726f 6d20 7468 6520 7375   are from the su
-00021e90: 7266 6163 650a 2020 2020 2020 2020 2020  rface.          
-00021ea0: 2020 6f66 203c 6f74 6865 723e 2074 6f20    of <other> to 
-00021eb0: 7468 6520 7375 7266 6163 6520 6f66 203c  the surface of <
-00021ec0: 7365 6c66 3e20 6f6e 6c79 2e20 2049 6620  self> only.  If 
-00021ed0: 4e6f 6e65 2c20 7365 7420 746f 0a20 2020  None, set to.   
-00021ee0: 2020 2020 2020 2020 2074 6865 206f 7070           the opp
-00021ef0: 6f73 6973 7465 206f 6620 3c73 6967 6e65  osiste of <signe
-00021f00: 643e 2e0a 0a20 2020 2020 2020 2020 636f  d>...         co
-00021f10: 6e66 6f72 6d69 7479 203a 2062 6f6f 6c2c  nformity : bool,
-00021f20: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
-00021f30: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-00021f40: 7275 652c 2064 6973 7461 6e63 6573 2072  rue, distances r
-00021f50: 6574 7572 6e65 6420 6172 6520 7369 676e  eturned are sign
-00021f60: 6564 2064 6973 7461 6e63 6573 2074 6f20  ed distances to 
-00021f70: 636f 6e66 6f72 6d69 7479 2c0a 2020 2020  conformity,.    
-00021f80: 2020 2020 2020 2020 2061 7320 6465 6669           as defi
-00021f90: 6e65 6420 696e 3a0a 2020 2020 2020 2020  ned in:.        
-00021fa0: 2020 2020 2068 7474 7073 3a2f 2f64 6f69       https://doi
-00021fb0: 2e6f 7267 2f31 302e 3132 3539 2f62 6a72  .org/10.1259/bjr
-00021fc0: 2f32 3736 3734 3538 310a 2020 2020 2020  /27674581.      
-00021fd0: 2020 2020 2020 2049 6e20 7468 6973 2063         In this c
-00021fe0: 6173 652c 2074 6865 2076 616c 7565 7320  ase, the values 
-00021ff0: 6f66 203c 7369 676e 6564 3e20 616e 6420  of <signed> and 
-00022000: 3c73 796d 6d65 7472 6963 3e0a 2020 2020  <symmetric>.    
-00022010: 2020 2020 2020 2020 2061 7265 2064 6973           are dis
-00022020: 7265 6761 7264 6564 2e0a 0a20 2020 2020  regarded...     
-00022030: 2020 2069 6e5f 736c 6963 6520 3a20 626f     in_slice : bo
-00022040: 6f6c 2c20 6465 6661 756c 743d 5472 7565  ol, default=True
-00022050: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00022060: 5472 7565 2c20 6f6e 6c79 2069 6e74 7261  True, only intra
-00022070: 2d73 6c69 6365 2063 6f6e 6e65 6374 6976  -slice connectiv
-00022080: 6974 7920 6973 2063 6f6e 7369 6465 7265  ity is considere
-00022090: 6420 7768 656e 0a20 2020 2020 2020 2020  d when.         
-000220a0: 2020 2070 6572 666f 726d 696e 6720 6572     performing er
-000220b0: 6f73 696f 6e20 746f 2069 6465 6e74 6966  osion to identif
-000220c0: 7920 524f 4920 7375 7266 6163 6573 2e0a  y ROI surfaces..
-000220d0: 0a20 2020 2020 2020 2076 6f78 656c 5f73  .        voxel_s
-000220e0: 697a 6520 3a20 7475 706c 652c 2064 6566  ize : tuple, def
-000220f0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00022100: 2020 2020 2020 566f 7865 6c20 7369 7a65        Voxel size
-00022110: 2028 6478 2c20 6479 2c20 647a 2920 696e   (dx, dy, dz) in
-00022120: 206d 6d20 746f 2062 6520 7573 6564 2066   mm to be used f
-00022130: 6f72 2052 4f49 206d 6173 6b73 0a20 2020  or ROI masks.   
-00022140: 2020 2020 2020 2020 2066 726f 6d20 7768           from wh
-00022150: 6963 6820 746f 2063 616c 6375 6c61 7465  ich to calculate
-00022160: 2073 7572 6661 6365 2064 6973 7461 6e63   surface distanc
-00022170: 6573 2e20 2049 6620 4e6f 6e65 2c0a 2020  es.  If None,.  
-00022180: 2020 2020 2020 2020 2020 7468 6520 6d61            the ma
-00022190: 736b 2076 6f78 656c 2073 697a 6520 6f66  sk voxel size of
-000221a0: 203c 6f74 6865 723e 2069 7320 7573 6564   <other> is used
-000221b0: 2e20 2049 6620 616e 2069 6e64 6976 6964  .  If an individ
-000221c0: 7561 6c0a 2020 2020 2020 2020 2020 2020  ual.            
-000221d0: 656c 656d 656e 7420 6973 204e 6f6e 652c  element is None,
-000221e0: 2074 6865 2076 616c 7565 206f 6620 7468   the value of th
-000221f0: 6520 636f 7272 6573 706f 6e64 696e 6720  e corresponding 
-00022200: 656c 656d 656e 7420 666f 720a 2020 2020  element for.    
-00022210: 2020 2020 2020 2020 7468 6520 6d61 736b          the mask
-00022220: 2076 6f78 656c 2073 697a 6520 6f66 203c   voxel size of <
-00022230: 6f74 6865 723e 2069 7320 7573 6564 2e0a  other> is used..
-00022240: 0a20 2020 2020 2020 2076 6f78 656c 5f64  .        voxel_d
-00022250: 696d 5f74 6f6c 6572 616e 6365 203a 2066  im_tolerance : f
-00022260: 6c6f 6174 2c20 6465 6661 756c 743d 302e  loat, default=0.
-00022270: 310a 2020 2020 2020 2020 2020 2020 546f  1.            To
-00022280: 6c65 7265 6e63 6520 7573 6564 2077 6865  lerence used whe
-00022290: 6e20 6465 7465 726d 696e 696e 6720 7768  n determining wh
-000222a0: 6574 6865 7220 3c76 6f78 656c 5f73 697a  ether <voxel_siz
-000222b0: 653e 2069 730a 2020 2020 2020 2020 2020  e> is.          
-000222c0: 2020 6469 6666 6572 656e 7420 6672 6f6d    different from
-000222d0: 2074 6865 2076 6f78 656c 2073 697a 6520   the voxel size 
-000222e0: 6f66 2074 6865 2069 6d61 6765 7320 6173  of the images as
-000222f0: 736f 6369 6174 6564 2077 6974 680a 2020  sociated with.  
-00022300: 2020 2020 2020 2020 2020 6561 6368 2052            each R
-00022310: 4f49 2e0a 2020 2020 2020 2020 2222 220a  OI..        """.
-00022320: 0a20 2020 2020 2020 2023 2053 6574 2076  .        # Set v
-00022330: 6965 7720 746f 204e 6f6e 6520 6966 2063  iew to None if c
-00022340: 6f6e 7369 6465 7269 6e67 2033 4420 6d61  onsidering 3D ma
-00022350: 736b 2e0a 2020 2020 2020 2020 6966 206e  sk..        if n
-00022360: 6f74 2073 696e 676c 655f 736c 6963 6520  ot single_slice 
-00022370: 616e 6420 6e6f 7420 666c 6174 7465 6e3a  and not flatten:
-00022380: 0a20 2020 2020 2020 2020 2020 2076 6965  .            vie
-00022390: 7720 3d20 4e6f 6e65 0a0a 2020 2020 2020  w = None..      
-000223a0: 2020 2320 5365 7420 746f 2046 616c 7365    # Set to False
-000223b0: 2070 6172 616d 6574 6572 7320 7468 6174   parameters that
-000223c0: 2061 7265 2074 6f20 6265 2069 676e 6f72   are to be ignor
-000223d0: 6564 0a20 2020 2020 2020 2023 2077 6865  ed.        # whe
-000223e0: 6e20 6361 6c63 756c 6174 696e 6720 6469  n calculating di
-000223f0: 7374 616e 6365 7320 746f 2063 6f6e 666f  stances to confo
-00022400: 726d 6974 792e 0a20 2020 2020 2020 2069  rmity..        i
-00022410: 6620 636f 6e66 6f72 6d69 7479 3a0a 2020  f conformity:.  
-00022420: 2020 2020 2020 2020 2020 7379 6d6d 6574            symmet
-00022430: 7269 6320 3d20 7369 676e 6564 203d 2046  ric = signed = F
-00022440: 616c 7365 0a0a 2020 2020 2020 2020 2320  alse..        # 
-00022450: 4465 6661 756c 7420 746f 2073 796d 6d65  Default to symme
-00022460: 7472 6963 206f 7220 6f6e 652d 7761 7920  tric or one-way 
-00022470: 6469 7374 616e 6365 732c 0a20 2020 2020  distances,.     
-00022480: 2020 2023 2064 6570 656e 6469 6e67 206f     # depending o
-00022490: 6e20 7768 6574 6865 7220 6469 7374 616e  n whether distan
-000224a0: 6365 7320 6172 6520 7369 676e 6564 206f  ces are signed o
-000224b0: 7220 756e 7369 676e 6564 2e0a 2020 2020  r unsigned..    
-000224c0: 2020 2020 6966 2073 796d 6d65 7472 6963      if symmetric
-000224d0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-000224e0: 2020 2020 2020 7379 6d6d 6574 7269 6320        symmetric 
-000224f0: 3d20 4661 6c73 6520 6966 2073 6967 6e65  = False if signe
-00022500: 6420 6973 2054 7275 6520 656c 7365 2054  d is True else T
-00022510: 7275 650a 0a20 2020 2020 2020 2023 204f  rue..        # O
-00022520: 6274 6169 6e20 524f 4920 636c 6f6e 6573  btain ROI clones
-00022530: 2c20 7769 7468 206d 6173 6b20 766f 7865  , with mask voxe
-00022540: 6c20 7369 7a65 7320 6d61 7463 6865 6420  l sizes matched 
-00022550: 746f 2076 6f78 656c 5f73 697a 650a 2020  to voxel_size.  
-00022560: 2020 2020 2020 2320 6966 206e 6f6e 2d6e        # if non-n
-00022570: 756c 6c2c 206f 7220 6f74 6865 7277 6973  ull, or otherwis
-00022580: 6520 746f 2074 6865 206d 6173 6b20 766f  e to the mask vo
-00022590: 7865 6c20 7369 7a65 206f 6620 6f74 6865  xel size of othe
-000225a0: 722e 0a20 2020 2020 2020 2072 6f69 312c  r..        roi1,
-000225b0: 2072 6f69 3220 3d20 7365 6c66 2e6d 6174   roi2 = self.mat
-000225c0: 6368 5f6d 6173 6b5f 766f 7865 6c5f 7369  ch_mask_voxel_si
-000225d0: 7a65 286f 7468 6572 2c20 766f 7865 6c5f  ze(other, voxel_
-000225e0: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
-000225f0: 2020 2020 2020 766f 7865 6c5f 6469 6d5f        voxel_dim_
-00022600: 746f 6c65 7261 6e63 6529 0a0a 2020 2020  tolerance)..    
-00022610: 2020 2020 2320 4368 6563 6b20 7768 6574      # Check whet
-00022620: 6865 7220 524f 4973 2061 7265 2065 6d70  her ROIs are emp
-00022630: 7479 0a20 2020 2020 2020 2069 6620 6e6f  ty.        if no
-00022640: 7420 6e70 2e61 6e79 2872 6f69 312e 6765  t np.any(roi1.ge
-00022650: 745f 6d61 736b 2829 2920 6f72 206e 6f74  t_mask()) or not
-00022660: 206e 702e 616e 7928 726f 6932 2e67 6574   np.any(roi2.get
-00022670: 5f6d 6173 6b28 2929 3a0a 2020 2020 2020  _mask()):.      
-00022680: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-00022690: 2020 2020 2020 2320 4765 7420 766f 7865        # Get voxe
-000226a0: 6c20 7369 7a65 2072 656c 6174 6976 6520  l size relative 
-000226b0: 746f 2061 7865 7320 6f66 206e 756d 7079  to axes of numpy
-000226c0: 2061 7272 6179 2e0a 2020 2020 2020 2020   array..        
-000226d0: 766f 7865 6c5f 7369 7a65 203d 2072 6f69  voxel_size = roi
-000226e0: 312e 6765 745f 6e70 5f76 6f78 656c 5f73  1.get_np_voxel_s
-000226f0: 697a 6528 7669 6577 290a 0a20 2020 2020  ize(view)..     
-00022700: 2020 2023 2047 6574 2062 696e 6172 7920     # Get binary 
-00022710: 6d61 736b 730a 2020 2020 2020 2020 6966  masks.        if
-00022720: 2073 696e 676c 655f 736c 6963 653a 0a20   single_slice:. 
-00022730: 2020 2020 2020 2020 2020 206d 6173 6b31             mask1
-00022740: 203d 2072 6f69 312e 6765 745f 736c 6963   = roi1.get_slic
-00022750: 6528 7669 6577 2c20 736c 3d73 6c2c 2069  e(view, sl=sl, i
-00022760: 6478 3d69 6478 2c20 706f 733d 706f 7329  dx=idx, pos=pos)
-00022770: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
-00022780: 6b32 203d 2072 6f69 322e 6765 745f 736c  k2 = roi2.get_sl
-00022790: 6963 6528 7669 6577 2c20 736c 3d73 6c2c  ice(view, sl=sl,
-000227a0: 2069 6478 3d69 6478 2c20 706f 733d 706f   idx=idx, pos=po
-000227b0: 7329 0a20 2020 2020 2020 2065 6c73 653a  s).        else:
-000227c0: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
-000227d0: 6b31 203d 2072 6f69 312e 6765 745f 6d61  k1 = roi1.get_ma
-000227e0: 736b 2876 6965 772c 2066 6c61 7474 656e  sk(view, flatten
-000227f0: 3d66 6c61 7474 656e 290a 2020 2020 2020  =flatten).      
-00022800: 2020 2020 2020 6d61 736b 3220 3d20 726f        mask2 = ro
-00022810: 6932 2e67 6574 5f6d 6173 6b28 7669 6577  i2.get_mask(view
-00022820: 2c20 666c 6174 7465 6e3d 666c 6174 7465  , flatten=flatte
-00022830: 6e29 0a0a 2020 2020 2020 2020 2320 4d61  n)..        # Ma
-00022840: 6b65 2073 7472 7563 7475 7269 6e67 2065  ke structuring e
-00022850: 6c65 6d65 6e74 0a20 2020 2020 2020 2063  lement.        c
-00022860: 6f6e 6e32 203d 206e 6469 6d61 6765 2e67  onn2 = ndimage.g
-00022870: 656e 6572 6174 655f 6269 6e61 7279 5f73  enerate_binary_s
-00022880: 7472 7563 7475 7265 2832 2c20 636f 6e6e  tructure(2, conn
-00022890: 6563 7469 7669 7479 290a 2020 2020 2020  ectivity).      
-000228a0: 2020 6966 206d 6173 6b31 2e6e 6469 6d20    if mask1.ndim 
-000228b0: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
-000228c0: 2020 636f 6e6e 203d 2063 6f6e 6e32 0a20    conn = conn2. 
-000228d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000228e0: 2020 2020 2020 2020 2069 6620 696e 5f73           if in_s
-000228f0: 6c69 6365 3a0a 2020 2020 2020 2020 2020  lice:.          
-00022900: 2020 2020 2020 636f 6e6e 203d 206e 702e        conn = np.
-00022910: 7a65 726f 7328 2833 2c20 332c 2033 292c  zeros((3, 3, 3),
-00022920: 2064 7479 7065 3d62 6f6f 6c29 0a20 2020   dtype=bool).   
-00022930: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00022940: 6e5b 3a2c 203a 2c20 315d 203d 2063 6f6e  n[:, :, 1] = con
-00022950: 6e32 0a20 2020 2020 2020 2020 2020 2065  n2.            e
-00022960: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00022970: 2020 2020 2063 6f6e 6e20 3d20 6e64 696d       conn = ndim
-00022980: 6167 652e 6765 6e65 7261 7465 5f62 696e  age.generate_bin
-00022990: 6172 795f 7374 7275 6374 7572 6528 332c  ary_structure(3,
-000229a0: 2063 6f6e 6e65 6374 6976 6974 7929 0a0a   connectivity)..
-000229b0: 2020 2020 2020 2020 2320 4765 7420 6f75          # Get ou
-000229c0: 7465 7220 7069 7865 6c20 6f66 2062 696e  ter pixel of bin
-000229d0: 6172 7920 6d61 7073 0a20 2020 2020 2020  ary maps.       
-000229e0: 2073 7572 6631 203d 206d 6173 6b31 205e   surf1 = mask1 ^
-000229f0: 206e 6469 6d61 6765 2e62 696e 6172 795f   ndimage.binary_
-00022a00: 6572 6f73 696f 6e28 6d61 736b 312c 2063  erosion(mask1, c
-00022a10: 6f6e 6e29 0a20 2020 2020 2020 2073 7572  onn).        sur
-00022a20: 6632 203d 206d 6173 6b32 205e 206e 6469  f2 = mask2 ^ ndi
-00022a30: 6d61 6765 2e62 696e 6172 795f 6572 6f73  mage.binary_eros
-00022a40: 696f 6e28 6d61 736b 322c 2063 6f6e 6e29  ion(mask2, conn)
-00022a50: 0a0a 2020 2020 2020 2020 2320 4d61 6b65  ..        # Make
-00022a60: 2061 7272 6179 7320 6f66 2064 6973 7461   arrays of dista
-00022a70: 6e63 6573 2074 6f20 7375 7266 6163 6520  nces to surface 
-00022a80: 6f66 2065 6163 6820 524f 490a 2020 2020  of each ROI.    
-00022a90: 2020 2020 6469 7374 3120 3d20 6e64 696d      dist1 = ndim
-00022aa0: 6167 652e 6469 7374 616e 6365 5f74 7261  age.distance_tra
-00022ab0: 6e73 666f 726d 5f65 6474 287e 7375 7266  nsform_edt(~surf
-00022ac0: 312c 2076 6f78 656c 5f73 697a 6529 0a20  1, voxel_size). 
-00022ad0: 2020 2020 2020 2064 6973 7432 203d 206e         dist2 = n
-00022ae0: 6469 6d61 6765 2e64 6973 7461 6e63 655f  dimage.distance_
-00022af0: 7472 616e 7366 6f72 6d5f 6564 7428 7e73  transform_edt(~s
-00022b00: 7572 6632 2c20 766f 7865 6c5f 7369 7a65  urf2, voxel_size
-00022b10: 290a 0a20 2020 2020 2020 2023 2047 6574  )..        # Get
-00022b20: 2073 6967 6e65 6420 6469 7374 616e 6365   signed distance
-00022b30: 730a 2020 2020 2020 2020 6966 2073 6967  s.        if sig
-00022b40: 6e65 643a 0a20 2020 2020 2020 2020 2020  ned:.           
-00022b50: 2064 6973 7431 203d 2064 6973 7431 202a   dist1 = dist1 *
-00022b60: 207e 6d61 736b 3120 2d20 6469 7374 3120   ~mask1 - dist1 
-00022b70: 2a20 6d61 736b 310a 2020 2020 2020 2020  * mask1.        
-00022b80: 2020 2020 6469 7374 3220 3d20 6469 7374      dist2 = dist
-00022b90: 3220 2a20 7e6d 6173 6b32 202d 2064 6973  2 * ~mask2 - dis
-00022ba0: 7432 202a 206d 6173 6b32 0a0a 2020 2020  t2 * mask2..    
-00022bb0: 2020 2020 2320 4d61 6b65 2076 6563 746f      # Make vecto
-00022bc0: 7220 636f 6e74 6169 6e69 6e67 2061 6c6c  r containing all
-00022bd0: 2064 6973 7461 6e63 6573 0a20 2020 2020   distances.     
-00022be0: 2020 2069 6620 636f 6e66 6f72 6d69 7479     if conformity
-00022bf0: 3a0a 2020 2020 2020 2020 2020 2020 6469  :.            di
-00022c00: 7374 315b 6d61 736b 3120 2620 6d61 736b  st1[mask1 & mask
-00022c10: 325d 203d 2030 0a20 2020 2020 2020 2020  2] = 0.         
-00022c20: 2020 2064 6973 7431 5b6d 6173 6b31 2026     dist1[mask1 &
-00022c30: 207e 6d61 736b 325d 203d 202d 6469 7374   ~mask2] = -dist
-00022c40: 325b 6d61 736b 3120 2620 7e6d 6173 6b32  2[mask1 & ~mask2
-00022c50: 5d0a 2020 2020 2020 2020 2020 2020 7364  ].            sd
-00022c60: 7320 3d20 6e70 2e72 6176 656c 2864 6973  s = np.ravel(dis
-00022c70: 7431 5b6d 6173 6b31 207c 206d 6173 6b32  t1[mask1 | mask2
-00022c80: 5d29 0a20 2020 2020 2020 2065 6c73 653a  ]).        else:
-00022c90: 0a20 2020 2020 2020 2020 2020 2073 6473  .            sds
-00022ca0: 203d 206e 702e 7261 7665 6c28 6469 7374   = np.ravel(dist
-00022cb0: 315b 7375 7266 3220 213d 2030 5d29 0a20  1[surf2 != 0]). 
-00022cc0: 2020 2020 2020 2020 2020 2069 6620 7379             if sy
-00022cd0: 6d6d 6574 7269 633a 0a20 2020 2020 2020  mmetric:.       
-00022ce0: 2020 2020 2020 2020 2073 6473 203d 206e           sds = n
-00022cf0: 702e 636f 6e63 6174 656e 6174 6528 5b73  p.concatenate([s
-00022d00: 6473 2c20 6e70 2e72 6176 656c 2864 6973  ds, np.ravel(dis
-00022d10: 7432 5b73 7572 6631 2021 3d20 305d 295d  t2[surf1 != 0])]
-00022d20: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00022d30: 2073 6473 0a0a 2020 2020 6465 6620 6765   sds..    def ge
-00022d40: 745f 6d65 616e 5f73 7572 6661 6365 5f64  t_mean_surface_d
-00022d50: 6973 7461 6e63 6528 7365 6c66 2c20 6f74  istance(self, ot
-00022d60: 6865 722c 202a 2a6b 7761 7267 7329 3a0a  her, **kwargs):.
-00022d70: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
-00022d80: 2020 2020 4f62 7461 696e 206d 6561 6e20      Obtain mean 
-00022d90: 6469 7374 616e 6365 2062 6574 7765 656e  distance between
-00022da0: 2073 7572 6661 6365 206f 6620 3c6f 7468   surface of <oth
-00022db0: 6572 3e20 616e 6420 7375 7266 6163 6520  er> and surface 
-00022dc0: 6f66 203c 7365 6c66 3e2e 0a0a 2020 2020  of <self>...    
-00022dd0: 2020 2020 466f 7220 7061 7261 6d65 7465      For paramete
-00022de0: 7273 2074 6861 7420 6d61 7920 6265 2070  rs that may be p
-00022df0: 6173 7365 642c 2073 6565 2064 6f63 756d  assed, see docum
-00022e00: 656e 7461 7469 6f6e 2066 6f72 3a0a 2020  entation for:.  
-00022e10: 2020 2020 2020 736b 7274 2e52 4f49 2e67        skrt.ROI.g
-00022e20: 6574 5f73 7572 6661 6365 5f64 6973 7461  et_surface_dista
-00022e30: 6e63 6573 2829 2e0a 2020 2020 2020 2020  nces()..        
-00022e40: 2727 270a 0a20 2020 2020 2020 2073 6473  '''..        sds
-00022e50: 203d 2073 656c 662e 6765 745f 7375 7266   = self.get_surf
-00022e60: 6163 655f 6469 7374 616e 6365 7328 6f74  ace_distances(ot
-00022e70: 6865 722c 202a 2a6b 7761 7267 7329 0a20  her, **kwargs). 
-00022e80: 2020 2020 2020 2069 6620 7364 7320 6973         if sds is
-00022e90: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00022ea0: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
-00022eb0: 2020 7265 7475 726e 2073 6473 2e6d 6561    return sds.mea
-00022ec0: 6e28 290a 0a20 2020 2064 6566 2067 6574  n()..    def get
-00022ed0: 5f72 6d73 5f73 7572 6661 6365 5f64 6973  _rms_surface_dis
-00022ee0: 7461 6e63 6528 7365 6c66 2c20 6f74 6865  tance(self, othe
-00022ef0: 722c 202a 2a6b 7761 7267 7329 3a0a 0a20  r, **kwargs):.. 
-00022f00: 2020 2020 2020 2073 6473 203d 2073 656c         sds = sel
-00022f10: 662e 6765 745f 7375 7266 6163 655f 6469  f.get_surface_di
-00022f20: 7374 616e 6365 7328 6f74 6865 722c 202a  stances(other, *
-00022f30: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-00022f40: 2069 6620 7364 7320 6973 204e 6f6e 653a   if sds is None:
-00022f50: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00022f60: 7572 6e0a 2020 2020 2020 2020 7265 7475  urn.        retu
-00022f70: 726e 206e 702e 7371 7274 2828 7364 7320  rn np.sqrt((sds 
-00022f80: 2a2a 2032 292e 6d65 616e 2829 290a 0a20  ** 2).mean()).. 
-00022f90: 2020 2064 6566 2067 6574 5f68 6175 7364     def get_hausd
-00022fa0: 6f72 6666 5f64 6973 7461 6e63 6528 7365  orff_distance(se
-00022fb0: 6c66 2c20 6f74 6865 722c 202a 2a6b 7761  lf, other, **kwa
-00022fc0: 7267 7329 3a0a 0a20 2020 2020 2020 2073  rgs):..        s
-00022fd0: 6473 203d 2073 656c 662e 6765 745f 7375  ds = self.get_su
-00022fe0: 7266 6163 655f 6469 7374 616e 6365 7328  rface_distances(
-00022ff0: 6f74 6865 722c 202a 2a6b 7761 7267 7329  other, **kwargs)
-00023000: 0a20 2020 2020 2020 2069 6620 7364 7320  .        if sds 
-00023010: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00023020: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-00023030: 2020 2020 7265 7475 726e 2073 6473 2e6d      return sds.m
-00023040: 6178 2829 0a0a 2020 2020 6465 6620 6765  ax()..    def ge
-00023050: 745f 6d65 616e 5f64 6973 7461 6e63 655f  t_mean_distance_
-00023060: 746f 5f63 6f6e 666f 726d 6974 7928 7365  to_conformity(se
-00023070: 6c66 2c20 6f74 6865 722c 2076 6f6c 5f75  lf, other, vol_u
-00023080: 6e69 7473 3d22 6d6d 222c 202a 2a6b 7761  nits="mm", **kwa
-00023090: 7267 7329 3a0a 2020 2020 2020 2020 2727  rgs):.        ''
-000230a0: 270a 2020 2020 2020 2020 4f62 7461 696e  '.        Obtain
-000230b0: 206d 6561 6e20 6469 7374 616e 6365 2074   mean distance t
-000230c0: 6f20 636f 6e66 6f72 6d69 7479 2066 6f72  o conformity for
-000230d0: 203c 6f74 6865 723e 2072 656c 6174 6976   <other> relativ
-000230e0: 6520 746f 203c 7365 6c66 3e2e 0a0a 2020  e to <self>...  
-000230f0: 2020 2020 2020 5468 6520 6d65 616e 2064        The mean d
-00023100: 6973 7461 6e63 6520 746f 2063 6f6e 666f  istance to confo
-00023110: 726d 6974 7920 6973 2061 7320 6465 6669  rmity is as defi
-00023120: 6e65 6420 696e 3a0a 2020 2020 2020 2020  ned in:.        
-00023130: 6874 7470 733a 2f2f 646f 692e 6f72 672f  https://doi.org/
-00023140: 3130 2e31 3235 392f 626a 722f 3237 3637  10.1259/bjr/2767
-00023150: 3435 3831 0a20 2020 2020 2020 2054 6563  4581.        Tec
-00023160: 686e 6963 616c 6c79 2074 6865 206d 6561  hnically the mea
-00023170: 6e20 6469 7374 616e 6365 2074 6f20 636f  n distance to co
-00023180: 6e66 6f72 6d69 7479 2069 736e 2774 2061  nformity isn't a
-00023190: 2064 6973 7461 6e63 652c 0a20 2020 2020   distance,.     
-000231a0: 2020 2062 7574 2069 7320 6120 6469 7374     but is a dist
-000231b0: 616e 6365 2064 6976 6964 6564 2062 7920  ance divided by 
-000231c0: 6120 766f 6c75 6d65 2e0a 0a20 2020 2020  a volume...     
-000231d0: 2020 2054 6869 7320 6675 6e63 7469 6f6e     This function
-000231e0: 2072 6574 7572 6e73 2061 2073 6b72 742e   returns a skrt.
-000231f0: 636f 7265 2e44 6174 6120 6f62 6a65 6374  core.Data object
-00023200: 2c20 7769 7468 2074 6865 2066 6f6c 6c6f  , with the follo
-00023210: 7769 6e67 0a20 2020 2020 2020 2069 6e66  wing.        inf
-00023220: 6f72 6d61 7469 6f6e 3a0a 0a20 2020 2020  ormation:..     
-00023230: 2020 206e 5f76 6f78 656c 203a 206e 756d     n_voxel : num
-00023240: 6265 7220 6f66 2076 6f78 656c 7320 696e  ber of voxels in
-00023250: 2074 6865 2075 6e69 6f6e 206f 6620 7468   the union of th
-00023260: 6520 524f 4973 2063 6f6e 7369 6465 7265  e ROIs considere
-00023270: 642e 0a0a 2020 2020 2020 2020 766f 7865  d...        voxe
-00023280: 6c5f 7369 7a65 203a 2076 6f78 656c 2073  l_size : voxel s
-00023290: 697a 6520 2864 782c 2064 792c 2064 7a29  ize (dx, dy, dz)
-000232a0: 2069 6e20 6d69 6c6c 696d 6574 7265 732c   in millimetres,
-000232b0: 2069 6e20 7468 650a 2020 2020 2020 2020   in the.        
-000232c0: 524f 4920 6d61 736b 7320 7573 6564 2069  ROI masks used i
-000232d0: 6e20 6469 7374 616e 6365 2063 616c 6375  n distance calcu
-000232e0: 6c61 7469 6f6e 732e 0a0a 2020 2020 2020  lations...      
-000232f0: 2020 6d65 616e 5f75 6e64 6572 5f63 6f6e    mean_under_con
-00023300: 746f 7572 696e 6720 3a20 7375 6d20 6f66  touring : sum of
-00023310: 2061 6273 6f6c 7574 6520 7661 6c75 6573   absolute values
-00023320: 206f 6620 6e65 6761 7469 7665 2064 6973   of negative dis
-00023330: 7461 6e63 6573 0a20 2020 2020 2020 2074  tances.        t
-00023340: 6f20 636f 6e66 6f72 6d69 7479 2c20 6469  o conformity, di
-00023350: 7669 6465 6420 6279 2076 6f6c 756d 6520  vided by volume 
-00023360: 696e 2075 6e69 6f6e 206f 6620 524f 4973  in union of ROIs
-00023370: 2063 6f6e 7369 6465 7265 642e 0a0a 2020   considered...  
-00023380: 2020 2020 2020 6d65 616e 5f6f 7665 725f        mean_over_
-00023390: 636f 6e74 6f75 7269 6e67 203a 2073 756d  contouring : sum
-000233a0: 206f 6620 706f 7369 7469 7665 2064 6973   of positive dis
-000233b0: 7461 6e63 6573 2074 6f20 636f 6e66 6f72  tances to confor
-000233c0: 6d69 7479 2c0a 2020 2020 2020 2020 6469  mity,.        di
-000233d0: 7669 6465 6420 6279 2076 6f6c 756d 6520  vided by volume 
-000233e0: 696e 2075 6e69 6f6e 206f 6620 524f 4973  in union of ROIs
-000233f0: 2063 6f6e 7369 6465 7265 642e 0a0a 2020   considered...  
-00023400: 2020 2020 2020 6d65 616e 5f64 6973 7461        mean_dista
-00023410: 6e63 655f 746f 5f63 6f6e 666f 726d 6974  nce_to_conformit
-00023420: 7920 3a20 7375 6d20 6f66 206d 6561 6e5f  y : sum of mean_
-00023430: 756e 6465 725f 636f 6e74 6f75 7269 6e67  under_contouring
-00023440: 2061 6e64 0a20 2020 2020 2020 206d 6561   and.        mea
-00023450: 6e5f 6f76 6572 5f63 6f6e 746f 7572 696e  n_over_contourin
-00023460: 672e 0a0a 2020 2020 2020 2020 2a2a 5061  g...        **Pa
-00023470: 7261 6d65 7465 7273 3a2a 2a0a 2020 2020  rameters:**.    
-00023480: 2020 2020 766f 6c5f 756e 6974 7320 3a20      vol_units : 
-00023490: 7374 722c 2064 6566 6175 6c74 3d22 6d6d  str, default="mm
-000234a0: 220a 2020 2020 2020 2020 2020 2020 556e  ".            Un
-000234b0: 6974 7320 746f 2075 7365 2066 6f72 2076  its to use for v
-000234c0: 6f6c 756d 6520 696e 2064 656e 6f6d 696e  olume in denomin
-000234d0: 6174 6f72 2077 6865 6e20 6361 6c63 756c  ator when calcul
-000234e0: 6174 696e 670a 2020 2020 2020 2020 2020  ating.          
-000234f0: 2020 6d65 616e 5f75 6e64 6572 5f63 6f6e    mean_under_con
-00023500: 746f 7572 696e 6720 616e 6420 6d65 616e  touring and mean
-00023510: 5f6f 7665 7263 6f6e 746f 7572 696e 672e  _overcontouring.
-00023520: 2043 616e 2062 650a 2020 2020 2020 2020   Can be.        
-00023530: 2020 2020 226d 6d22 2028 3d6d 6d5e 3329      "mm" (=mm^3)
-00023540: 2c20 226d 6c22 2c20 6f72 2022 766f 7865  , "ml", or "voxe
-00023550: 6c73 222e 0a0a 2020 2020 2020 2020 6b77  ls"...        kw
-00023560: 6172 6773 0a20 2020 2020 2020 2020 2020  args.           
-00023570: 204b 6579 776f 7264 2061 7267 756d 656e   Keyword argumen
-00023580: 7473 2061 7265 2070 6173 7365 6420 746f  ts are passed to
-00023590: 0a20 2020 2020 2020 2020 2020 2073 6b72  .            skr
-000235a0: 742e 7374 7275 6374 7572 6573 2e52 4f49  t.structures.ROI
-000235b0: 2e67 6574 5f73 7572 6661 6365 5f64 6973  .get_surface_dis
-000235c0: 7461 6e63 6573 2829 2e0a 2020 2020 2020  tances()..      
-000235d0: 2020 2020 2020 5365 6520 646f 6375 6d65        See docume
-000235e0: 6e74 6174 696f 6e20 6f66 2074 6869 7320  ntation of this 
-000235f0: 6d65 7468 6f64 2066 6f72 2070 6172 616d  method for param
-00023600: 6574 6572 2064 6574 6169 6c73 2e0a 2020  eter details..  
-00023610: 2020 2020 2020 2727 270a 0a20 2020 2020        '''..     
-00023620: 2020 2023 204f 6274 6169 6e20 6469 7374     # Obtain dist
-00023630: 616e 6365 7320 746f 2063 6f6e 666f 726d  ances to conform
-00023640: 6974 792e 0a20 2020 2020 2020 206b 7761  ity..        kwa
-00023650: 7267 735b 2263 6f6e 666f 726d 6974 7922  rgs["conformity"
-00023660: 5d20 3d20 5472 7565 0a20 2020 2020 2020  ] = True.       
-00023670: 2073 6473 203d 2073 656c 662e 6765 745f   sds = self.get_
-00023680: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
-00023690: 7328 6f74 6865 722c 202a 2a6b 7761 7267  s(other, **kwarg
-000236a0: 7329 0a0a 2020 2020 2020 2020 2320 4f62  s)..        # Ob
-000236b0: 7461 696e 206d 6173 6b20 6172 7261 7920  tain mask array 
-000236c0: 7265 7072 6573 656e 7469 6e67 2075 6e69  representing uni
-000236d0: 6f6e 206f 6620 524f 4973 2e0a 2020 2020  on of ROIs..    
-000236e0: 2020 2020 756e 696f 6e20 3d20 5374 7275      union = Stru
-000236f0: 6374 7572 6553 6574 285b 7365 6c66 2c20  ctureSet([self, 
-00023700: 6f74 6865 725d 292e 636f 6d62 696e 655f  other]).combine_
-00023710: 726f 6973 2829 0a20 2020 2020 2020 2076  rois().        v
-00023720: 6965 7720 3d20 6b77 6172 6773 2e67 6574  iew = kwargs.get
-00023730: 2822 7669 6577 222c 2022 782d 7922 290a  ("view", "x-y").
-00023740: 2020 2020 2020 2020 6966 206b 7761 7267          if kwarg
-00023750: 732e 6765 7428 2273 696e 676c 655f 736c  s.get("single_sl
-00023760: 6963 6522 2c20 4661 6c73 6529 3a0a 2020  ice", False):.  
-00023770: 2020 2020 2020 2020 2020 736c 203d 206b            sl = k
-00023780: 7761 7267 732e 6765 7428 2273 6c22 2c20  wargs.get("sl", 
-00023790: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
-000237a0: 2020 6964 7820 3d20 6b77 6172 6773 2e67    idx = kwargs.g
-000237b0: 6574 2822 6964 7822 2c20 4e6f 6e65 290a  et("idx", None).
-000237c0: 2020 2020 2020 2020 2020 2020 706f 7320              pos 
-000237d0: 3d20 6b77 6172 6773 2e67 6574 2822 706f  = kwargs.get("po
-000237e0: 7322 2c20 4e6f 6e65 290a 2020 2020 2020  s", None).      
-000237f0: 2020 2020 2020 6d61 736b 5f64 6174 6120        mask_data 
-00023800: 3d20 756e 696f 6e2e 6765 745f 736c 6963  = union.get_slic
-00023810: 6528 7669 6577 2c20 736c 2c20 6964 782c  e(view, sl, idx,
-00023820: 2070 6f73 290a 2020 2020 2020 2020 656c   pos).        el
-00023830: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00023840: 666c 6174 7465 6e20 3d20 6b77 6172 6773  flatten = kwargs
-00023850: 2e67 6574 2822 666c 6174 7465 6e22 2c20  .get("flatten", 
-00023860: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
-00023870: 2020 206d 6173 6b5f 6461 7461 203d 2075     mask_data = u
-00023880: 6e69 6f6e 2e67 6574 5f6d 6173 6b28 7669  nion.get_mask(vi
-00023890: 6577 2c20 666c 6174 7465 6e29 0a0a 2020  ew, flatten)..  
-000238a0: 2020 2020 2020 2320 4361 6c63 756c 6174        # Calculat
-000238b0: 6520 636f 6e66 6f72 6d69 7479 2073 636f  e conformity sco
-000238c0: 7265 732e 0a20 2020 2020 2020 2063 6f6e  res..        con
-000238d0: 666f 726d 6974 7920 3d20 736b 7274 2e63  formity = skrt.c
-000238e0: 6f72 652e 4461 7461 2829 0a20 2020 2020  ore.Data().     
-000238f0: 2020 2063 6f6e 666f 726d 6974 792e 6e5f     conformity.n_
-00023900: 766f 7865 6c20 3d20 6d61 736b 5f64 6174  voxel = mask_dat
-00023910: 612e 7375 6d28 290a 2020 2020 2020 2020  a.sum().        
-00023920: 636f 6e66 6f72 6d69 7479 2e76 6f78 656c  conformity.voxel
-00023930: 5f73 697a 6520 3d20 756e 696f 6e2e 6765  _size = union.ge
-00023940: 745f 766f 7865 6c5f 7369 7a65 2829 0a20  t_voxel_size(). 
-00023950: 2020 2020 2020 2069 6620 7364 7320 6973         if sds is
-00023960: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00023970: 2020 2063 6f6e 666f 726d 6974 792e 6d65     conformity.me
-00023980: 616e 5f75 6e64 6572 5f63 6f6e 746f 7572  an_under_contour
-00023990: 696e 6720 3d20 4e6f 6e65 0a20 2020 2020  ing = None.     
-000239a0: 2020 2020 2020 2063 6f6e 666f 726d 6974         conformit
-000239b0: 792e 6d65 616e 5f6f 7665 725f 636f 6e74  y.mean_over_cont
-000239c0: 6f75 7269 6e67 203d 204e 6f6e 650a 2020  ouring = None.  
-000239d0: 2020 2020 2020 2020 2020 636f 6e66 6f72            confor
-000239e0: 6d69 7479 2e6d 6561 6e5f 6469 7374 616e  mity.mean_distan
-000239f0: 6365 5f74 6f5f 636f 6e66 6f72 6d69 7479  ce_to_conformity
-00023a00: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00023a10: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000216a0: 616e 6365 7320 7265 6c61 7469 7665 2074  ances relative t
+000216b0: 6f20 3344 2076 6f6c 756d 6573 2e0a 2020  o 3D volumes..  
+000216c0: 2020 2020 2020 2020 2020 4f74 6865 7277            Otherw
+000216d0: 6973 652c 2072 6574 7572 6e20 7375 7266  ise, return surf
+000216e0: 6163 6520 6469 7374 616e 6365 7320 666f  ace distances fo
+000216f0: 7220 6120 7369 6e67 6c65 2069 6d61 6765  r a single image
+00021700: 2073 6c69 6365 2e0a 0a20 2020 2020 2020   slice...       
+00021710: 2073 6967 6e65 6420 3a20 626f 6f6c 2c20   signed : bool, 
+00021720: 6465 6661 756c 743d 4661 6c73 650a 2020  default=False.  
+00021730: 2020 2020 2020 2020 2020 4966 2046 616c            If Fal
+00021740: 7365 2c20 7265 7475 726e 2061 6273 6f6c  se, return absol
+00021750: 7574 6520 7375 7266 6163 6520 6469 7374  ute surface dist
+00021760: 616e 6365 732e 0a20 2020 2020 2020 2020  ances..         
+00021770: 2020 2049 6620 5472 7565 2c20 7265 7475     If True, retu
+00021780: 726e 2073 6967 6e65 6420 7375 7266 6163  rn signed surfac
+00021790: 6520 6469 7374 616e 6365 732e 2020 4120  e distances.  A 
+000217a0: 706f 696e 7420 6f6e 2074 6865 0a20 2020  point on the.   
+000217b0: 2020 2020 2020 2020 2073 7572 6661 6365           surface
+000217c0: 206f 6620 3c6f 7468 6572 3e20 6973 2074   of <other> is t
+000217d0: 616b 656e 2074 6f20 6265 2061 7420 6120  aken to be at a 
+000217e0: 706f 7369 7469 7665 2064 6973 7461 6e63  positive distanc
+000217f0: 6520 6966 0a20 2020 2020 2020 2020 2020  e if.           
+00021800: 206f 7574 7369 6465 203c 7365 6c66 3e2c   outside <self>,
+00021810: 2061 6e64 2061 7420 6120 6e65 6761 7469   and at a negati
+00021820: 7665 2064 6973 7461 6e63 6520 6966 2069  ve distance if i
+00021830: 6e73 6964 652e 0a0a 2020 2020 2020 2020  nside...        
+00021840: 7669 6577 203a 2073 7472 2c20 6465 6661  view : str, defa
+00021850: 756c 743d 2278 2d79 220a 2020 2020 2020  ult="x-y".      
+00021860: 2020 2020 2020 4f72 6965 6e74 6174 696f        Orientatio
+00021870: 6e20 6f66 2073 6c69 6365 2066 6f72 2077  n of slice for w
+00021880: 6869 6368 2074 6f20 6f62 7461 696e 2073  hich to obtain s
+00021890: 7572 6661 6365 2064 6973 7461 6e63 6573  urface distances
+000218a0: 2e0a 2020 2020 2020 2020 2020 2020 4f6e  ..            On
+000218b0: 6c79 2075 7365 6420 6966 2065 6974 6865  ly used if eithe
+000218c0: 7220 3c73 696e 676c 655f 736c 6963 653e  r <single_slice>
+000218d0: 206f 7220 3c66 6c61 7474 656e 3e20 6973   or <flatten> is
+000218e0: 2054 7275 652e 0a0a 2020 2020 2020 2020   True...        
+000218f0: 736c 203a 2069 6e74 2c20 6465 6661 756c  sl : int, defaul
+00021900: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00021910: 2020 2053 6c69 6365 206e 756d 6265 722e     Slice number.
+00021920: 2049 6620 6e6f 6e65 206f 6620 3c73 6c3e   If none of <sl>
+00021930: 2c20 3c69 6478 3e20 6f72 203c 706f 733e  , <idx> or <pos>
+00021940: 2069 7320 7375 7070 6c69 6564 2062 7574   is supplied but
+00021950: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
+00021960: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
+00021970: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
+00021980: 2073 6c69 6365 206f 6620 7468 6520 524f   slice of the RO
+00021990: 4920 7769 6c6c 2062 6520 7573 6564 2e0a  I will be used..
+000219a0: 0a20 2020 2020 2020 2069 6478 203a 2069  .        idx : i
+000219b0: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
+000219c0: 0a20 2020 2020 2020 2020 2020 2041 7272  .            Arr
+000219d0: 6179 2069 6e64 6578 206f 6620 736c 6963  ay index of slic
+000219e0: 652e 2049 6620 6e6f 6e65 206f 6620 3c73  e. If none of <s
+000219f0: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
+00021a00: 733e 2069 7320 0a20 2020 2020 2020 2020  s> is .         
+00021a10: 2020 2073 7570 706c 6965 6420 6275 7420     supplied but 
+00021a20: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
+00021a30: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
+00021a40: 7261 6c20 736c 6963 6520 6f66 0a20 2020  ral slice of.   
+00021a50: 2020 2020 2020 2020 2074 6865 2052 4f49           the ROI
+00021a60: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
+00021a70: 2020 2020 2020 2020 706f 7320 3a20 666c          pos : fl
+00021a80: 6f61 742c 2064 6566 6175 6c74 3d4e 6f6e  oat, default=Non
+00021a90: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
+00021aa0: 6963 6520 706f 7369 7469 6f6e 2069 6e20  ice position in 
+00021ab0: 6d6d 2e20 4966 206e 6f6e 6520 6f66 203c  mm. If none of <
+00021ac0: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
+00021ad0: 6f73 3e20 6973 2073 7570 706c 6965 640a  os> is supplied.
+00021ae0: 2020 2020 2020 2020 2020 2020 6275 7420              but 
+00021af0: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
+00021b00: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
+00021b10: 7261 6c20 736c 6963 6520 6f66 2074 6865  ral slice of the
+00021b20: 2052 4f49 2077 696c 6c0a 2020 2020 2020   ROI will.      
+00021b30: 2020 2020 2020 6265 2075 7365 642e 0a0a        be used...
+00021b40: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
+00021b50: 7669 7479 3a20 696e 742c 2064 6566 6175  vity: int, defau
+00021b60: 6c74 3d32 0a20 2020 2020 2020 2020 2020  lt=2.           
+00021b70: 2049 6e74 6567 6572 2064 6566 696e 696e   Integer definin
+00021b80: 6720 7768 6963 6820 766f 7865 6c73 2074  g which voxels t
+00021b90: 6f20 636f 6e73 6964 6572 2061 7320 6e65  o consider as ne
+00021ba0: 6967 6862 6f75 7273 0a20 2020 2020 2020  ighbours.       
+00021bb0: 2020 2020 2077 6865 6e20 7065 7266 6f72       when perfor
+00021bc0: 6d69 6e67 2065 726f 7369 6f6e 206f 7065  ming erosion ope
+00021bd0: 7261 7469 6f6e 2074 6f20 6964 656e 7469  ration to identi
+00021be0: 6679 2052 4f49 2073 7572 6661 6365 732e  fy ROI surfaces.
+00021bf0: 2020 5468 6973 0a20 2020 2020 2020 2020    This.         
+00021c00: 2020 2069 7320 7061 7373 6564 2061 7320     is passed as 
+00021c10: 3c63 6f6e 6e65 6374 6976 6974 793e 2070  <connectivity> p
+00021c20: 6172 616d 6574 6572 2074 6f3a 0a20 2020  arameter to:.   
+00021c30: 2020 2020 2020 2020 2073 6369 7079 2e6e           scipy.n
+00021c40: 6469 6d61 6765 2e67 656e 6572 6174 655f  dimage.generate_
+00021c50: 6269 6e61 7279 5f73 7472 7563 7475 7265  binary_structure
+00021c60: 0a20 2020 2020 2020 2020 2020 2046 6f72  .            For
+00021c70: 2066 7572 7468 6572 2064 6574 6169 6c73   further details
+00021c80: 2c20 7365 653a 0a20 2020 2020 2020 2020  , see:.         
+00021c90: 2020 2068 7474 7073 3a2f 2f64 6f63 732e     https://docs.
+00021ca0: 7363 6970 792e 6f72 672f 646f 632f 7363  scipy.org/doc/sc
+00021cb0: 6970 792f 7265 6665 7265 6e63 652f 6765  ipy/reference/ge
+00021cc0: 6e65 7261 7465 642f 7363 6970 792e 6e64  nerated/scipy.nd
+00021cd0: 696d 6167 652e 6765 6e65 7261 7465 5f62  image.generate_b
+00021ce0: 696e 6172 795f 7374 7275 6374 7572 652e  inary_structure.
+00021cf0: 6874 6d6c 0a0a 2020 2020 2020 2020 666c  html..        fl
+00021d00: 6174 7465 6e20 3a20 626f 6f6c 2c20 6465  atten : bool, de
+00021d10: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+00021d20: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+00021d30: 2061 6c6c 2073 6c69 6365 7320 666f 7220   all slices for 
+00021d40: 6561 6368 2052 4f49 2077 696c 6c20 6265  each ROI will be
+00021d50: 2066 6c61 7474 656e 6564 2069 6e20 7468   flattened in th
+00021d60: 6520 6769 7665 6e0a 2020 2020 2020 2020  e given.        
+00021d70: 2020 2020 6f72 6965 6e74 6174 696f 6e2c      orientation,
+00021d80: 2061 6e64 2073 7572 6661 6365 2064 6973   and surface dis
+00021d90: 7461 6e63 6573 2072 656c 6174 6976 6520  tances relative 
+00021da0: 746f 2074 6865 2066 6c61 7474 656e 6564  to the flattened
+00021db0: 0a20 2020 2020 2020 2020 2020 2073 6c69  .            sli
+00021dc0: 6365 2077 696c 6c20 6265 2072 6574 7572  ce will be retur
+00021dd0: 6e65 642e 0a0a 2020 2020 2020 2020 7379  ned...        sy
+00021de0: 6d6d 6574 7269 6320 3a20 626f 6f6c 2c20  mmetric : bool, 
+00021df0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00021e00: 2020 2020 2020 2020 2049 6620 5472 7565           If True
+00021e10: 2c20 7468 6520 6469 7374 616e 6365 7320  , the distances 
+00021e20: 7265 7475 726e 6564 2061 7265 2066 726f  returned are fro
+00021e30: 6d20 7468 6520 7375 7266 6163 6520 6f66  m the surface of
+00021e40: 203c 6f74 6865 723e 0a20 2020 2020 2020   <other>.       
+00021e50: 2020 2020 2074 6f20 7468 6520 7375 7266       to the surf
+00021e60: 6163 6520 6f66 203c 7365 6c66 3e20 616e  ace of <self> an
+00021e70: 6420 6672 6f6d 2074 6865 2073 7572 6661  d from the surfa
+00021e80: 6365 206f 6620 3c73 656c 663e 2074 6f20  ce of <self> to 
+00021e90: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+00021ea0: 7375 7266 6163 6520 6f66 203c 6f74 6865  surface of <othe
+00021eb0: 723e 2e20 2049 6620 4661 6c73 652c 2064  r>.  If False, d
+00021ec0: 6973 7461 6e63 6573 2061 7265 2066 726f  istances are fro
+00021ed0: 6d20 7468 6520 7375 7266 6163 650a 2020  m the surface.  
+00021ee0: 2020 2020 2020 2020 2020 6f66 203c 6f74            of <ot
+00021ef0: 6865 723e 2074 6f20 7468 6520 7375 7266  her> to the surf
+00021f00: 6163 6520 6f66 203c 7365 6c66 3e20 6f6e  ace of <self> on
+00021f10: 6c79 2e20 2049 6620 4e6f 6e65 2c20 7365  ly.  If None, se
+00021f20: 7420 746f 0a20 2020 2020 2020 2020 2020  t to.           
+00021f30: 2074 6865 206f 7070 6f73 6973 7465 206f   the opposiste o
+00021f40: 6620 3c73 6967 6e65 643e 2e0a 0a20 2020  f <signed>...   
+00021f50: 2020 2020 2020 636f 6e66 6f72 6d69 7479        conformity
+00021f60: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+00021f70: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+00021f80: 2020 2020 4966 2054 7275 652c 2064 6973      If True, dis
+00021f90: 7461 6e63 6573 2072 6574 7572 6e65 6420  tances returned 
+00021fa0: 6172 6520 7369 676e 6564 2064 6973 7461  are signed dista
+00021fb0: 6e63 6573 2074 6f20 636f 6e66 6f72 6d69  nces to conformi
+00021fc0: 7479 2c0a 2020 2020 2020 2020 2020 2020  ty,.            
+00021fd0: 2061 7320 6465 6669 6e65 6420 696e 3a0a   as defined in:.
+00021fe0: 2020 2020 2020 2020 2020 2020 2068 7474               htt
+00021ff0: 7073 3a2f 2f64 6f69 2e6f 7267 2f31 302e  ps://doi.org/10.
+00022000: 3132 3539 2f62 6a72 2f32 3736 3734 3538  1259/bjr/2767458
+00022010: 310a 2020 2020 2020 2020 2020 2020 2049  1.             I
+00022020: 6e20 7468 6973 2063 6173 652c 2074 6865  n this case, the
+00022030: 2076 616c 7565 7320 6f66 203c 7369 676e   values of <sign
+00022040: 6564 3e20 616e 6420 3c73 796d 6d65 7472  ed> and <symmetr
+00022050: 6963 3e0a 2020 2020 2020 2020 2020 2020  ic>.            
+00022060: 2061 7265 2064 6973 7265 6761 7264 6564   are disregarded
+00022070: 2e0a 0a20 2020 2020 2020 2069 6e5f 736c  ...        in_sl
+00022080: 6963 6520 3a20 626f 6f6c 2c20 6465 6661  ice : bool, defa
+00022090: 756c 743d 5472 7565 0a20 2020 2020 2020  ult=True.       
+000220a0: 2020 2020 2049 6620 5472 7565 2c20 6f6e       If True, on
+000220b0: 6c79 2069 6e74 7261 2d73 6c69 6365 2063  ly intra-slice c
+000220c0: 6f6e 6e65 6374 6976 6974 7920 6973 2063  onnectivity is c
+000220d0: 6f6e 7369 6465 7265 6420 7768 656e 0a20  onsidered when. 
+000220e0: 2020 2020 2020 2020 2020 2070 6572 666f             perfo
+000220f0: 726d 696e 6720 6572 6f73 696f 6e20 746f  rming erosion to
+00022100: 2069 6465 6e74 6966 7920 524f 4920 7375   identify ROI su
+00022110: 7266 6163 6573 2e0a 0a20 2020 2020 2020  rfaces...       
+00022120: 2076 6f78 656c 5f73 697a 6520 3a20 7475   voxel_size : tu
+00022130: 706c 652c 2064 6566 6175 6c74 3d4e 6f6e  ple, default=Non
+00022140: 650a 2020 2020 2020 2020 2020 2020 566f  e.            Vo
+00022150: 7865 6c20 7369 7a65 2028 6478 2c20 6479  xel size (dx, dy
+00022160: 2c20 647a 2920 696e 206d 6d20 746f 2062  , dz) in mm to b
+00022170: 6520 7573 6564 2066 6f72 2052 4f49 206d  e used for ROI m
+00022180: 6173 6b73 0a20 2020 2020 2020 2020 2020  asks.           
+00022190: 2066 726f 6d20 7768 6963 6820 746f 2063   from which to c
+000221a0: 616c 6375 6c61 7465 2073 7572 6661 6365  alculate surface
+000221b0: 2064 6973 7461 6e63 6573 2e20 2049 6620   distances.  If 
+000221c0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+000221d0: 2020 7468 6520 6d61 736b 2076 6f78 656c    the mask voxel
+000221e0: 2073 697a 6520 6f66 203c 6f74 6865 723e   size of <other>
+000221f0: 2069 7320 7573 6564 2e20 2049 6620 616e   is used.  If an
+00022200: 2069 6e64 6976 6964 7561 6c0a 2020 2020   individual.    
+00022210: 2020 2020 2020 2020 656c 656d 656e 7420          element 
+00022220: 6973 204e 6f6e 652c 2074 6865 2076 616c  is None, the val
+00022230: 7565 206f 6620 7468 6520 636f 7272 6573  ue of the corres
+00022240: 706f 6e64 696e 6720 656c 656d 656e 7420  ponding element 
+00022250: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+00022260: 7468 6520 6d61 736b 2076 6f78 656c 2073  the mask voxel s
+00022270: 697a 6520 6f66 203c 6f74 6865 723e 2069  ize of <other> i
+00022280: 7320 7573 6564 2e0a 0a20 2020 2020 2020  s used...       
+00022290: 2076 6f78 656c 5f64 696d 5f74 6f6c 6572   voxel_dim_toler
+000222a0: 616e 6365 203a 2066 6c6f 6174 2c20 6465  ance : float, de
+000222b0: 6661 756c 743d 302e 310a 2020 2020 2020  fault=0.1.      
+000222c0: 2020 2020 2020 546f 6c65 7265 6e63 6520        Tolerence 
+000222d0: 7573 6564 2077 6865 6e20 6465 7465 726d  used when determ
+000222e0: 696e 696e 6720 7768 6574 6865 7220 3c76  ining whether <v
+000222f0: 6f78 656c 5f73 697a 653e 2069 730a 2020  oxel_size> is.  
+00022300: 2020 2020 2020 2020 2020 6469 6666 6572            differ
+00022310: 656e 7420 6672 6f6d 2074 6865 2076 6f78  ent from the vox
+00022320: 656c 2073 697a 6520 6f66 2074 6865 2069  el size of the i
+00022330: 6d61 6765 7320 6173 736f 6369 6174 6564  mages associated
+00022340: 2077 6974 680a 2020 2020 2020 2020 2020   with.          
+00022350: 2020 6561 6368 2052 4f49 2e0a 2020 2020    each ROI..    
+00022360: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00022370: 2023 2053 6574 2076 6965 7720 746f 204e   # Set view to N
+00022380: 6f6e 6520 6966 2063 6f6e 7369 6465 7269  one if consideri
+00022390: 6e67 2033 4420 6d61 736b 2e0a 2020 2020  ng 3D mask..    
+000223a0: 2020 2020 6966 206e 6f74 2073 696e 676c      if not singl
+000223b0: 655f 736c 6963 6520 616e 6420 6e6f 7420  e_slice and not 
+000223c0: 666c 6174 7465 6e3a 0a20 2020 2020 2020  flatten:.       
+000223d0: 2020 2020 2076 6965 7720 3d20 4e6f 6e65       view = None
+000223e0: 0a0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
+000223f0: 746f 2046 616c 7365 2070 6172 616d 6574  to False paramet
+00022400: 6572 7320 7468 6174 2061 7265 2074 6f20  ers that are to 
+00022410: 6265 2069 676e 6f72 6564 0a20 2020 2020  be ignored.     
+00022420: 2020 2023 2077 6865 6e20 6361 6c63 756c     # when calcul
+00022430: 6174 696e 6720 6469 7374 616e 6365 7320  ating distances 
+00022440: 746f 2063 6f6e 666f 726d 6974 792e 0a20  to conformity.. 
+00022450: 2020 2020 2020 2069 6620 636f 6e66 6f72         if confor
+00022460: 6d69 7479 3a0a 2020 2020 2020 2020 2020  mity:.          
+00022470: 2020 7379 6d6d 6574 7269 6320 3d20 7369    symmetric = si
+00022480: 676e 6564 203d 2046 616c 7365 0a0a 2020  gned = False..  
+00022490: 2020 2020 2020 2320 4465 6661 756c 7420        # Default 
+000224a0: 746f 2073 796d 6d65 7472 6963 206f 7220  to symmetric or 
+000224b0: 6f6e 652d 7761 7920 6469 7374 616e 6365  one-way distance
+000224c0: 732c 0a20 2020 2020 2020 2023 2064 6570  s,.        # dep
+000224d0: 656e 6469 6e67 206f 6e20 7768 6574 6865  ending on whethe
+000224e0: 7220 6469 7374 616e 6365 7320 6172 6520  r distances are 
+000224f0: 7369 676e 6564 206f 7220 756e 7369 676e  signed or unsign
+00022500: 6564 2e0a 2020 2020 2020 2020 6966 2073  ed..        if s
+00022510: 796d 6d65 7472 6963 2069 7320 4e6f 6e65  ymmetric is None
+00022520: 3a0a 2020 2020 2020 2020 2020 2020 7379  :.            sy
+00022530: 6d6d 6574 7269 6320 3d20 4661 6c73 6520  mmetric = False 
+00022540: 6966 2073 6967 6e65 6420 6973 2054 7275  if signed is Tru
+00022550: 6520 656c 7365 2054 7275 650a 0a20 2020  e else True..   
+00022560: 2020 2020 2023 204f 6274 6169 6e20 524f       # Obtain RO
+00022570: 4920 636c 6f6e 6573 2c20 7769 7468 206d  I clones, with m
+00022580: 6173 6b20 766f 7865 6c20 7369 7a65 7320  ask voxel sizes 
+00022590: 6d61 7463 6865 6420 746f 2076 6f78 656c  matched to voxel
+000225a0: 5f73 697a 650a 2020 2020 2020 2020 2320  _size.        # 
+000225b0: 6966 206e 6f6e 2d6e 756c 6c2c 206f 7220  if non-null, or 
+000225c0: 6f74 6865 7277 6973 6520 746f 2074 6865  otherwise to the
+000225d0: 206d 6173 6b20 766f 7865 6c20 7369 7a65   mask voxel size
+000225e0: 206f 6620 6f74 6865 722e 0a20 2020 2020   of other..     
+000225f0: 2020 2072 6f69 312c 2072 6f69 3220 3d20     roi1, roi2 = 
+00022600: 7365 6c66 2e6d 6174 6368 5f6d 6173 6b5f  self.match_mask_
+00022610: 766f 7865 6c5f 7369 7a65 286f 7468 6572  voxel_size(other
+00022620: 2c20 766f 7865 6c5f 7369 7a65 2c0a 2020  , voxel_size,.  
+00022630: 2020 2020 2020 2020 2020 2020 2020 766f                vo
+00022640: 7865 6c5f 6469 6d5f 746f 6c65 7261 6e63  xel_dim_toleranc
+00022650: 6529 0a0a 2020 2020 2020 2020 2320 4368  e)..        # Ch
+00022660: 6563 6b20 7768 6574 6865 7220 524f 4973  eck whether ROIs
+00022670: 2061 7265 2065 6d70 7479 0a20 2020 2020   are empty.     
+00022680: 2020 2069 6620 6e6f 7420 6e70 2e61 6e79     if not np.any
+00022690: 2872 6f69 312e 6765 745f 6d61 736b 2829  (roi1.get_mask()
+000226a0: 2920 6f72 206e 6f74 206e 702e 616e 7928  ) or not np.any(
+000226b0: 726f 6932 2e67 6574 5f6d 6173 6b28 2929  roi2.get_mask())
+000226c0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000226d0: 7475 726e 0a0a 2020 2020 2020 2020 2320  turn..        # 
+000226e0: 4765 7420 766f 7865 6c20 7369 7a65 2072  Get voxel size r
+000226f0: 656c 6174 6976 6520 746f 2061 7865 7320  elative to axes 
+00022700: 6f66 206e 756d 7079 2061 7272 6179 2e0a  of numpy array..
+00022710: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
+00022720: 7a65 203d 2072 6f69 312e 6765 745f 6e70  ze = roi1.get_np
+00022730: 5f76 6f78 656c 5f73 697a 6528 7669 6577  _voxel_size(view
+00022740: 290a 0a20 2020 2020 2020 2023 2047 6574  )..        # Get
+00022750: 2062 696e 6172 7920 6d61 736b 730a 2020   binary masks.  
+00022760: 2020 2020 2020 6966 2073 696e 676c 655f        if single_
+00022770: 736c 6963 653a 0a20 2020 2020 2020 2020  slice:.         
+00022780: 2020 206d 6173 6b31 203d 2072 6f69 312e     mask1 = roi1.
+00022790: 6765 745f 736c 6963 6528 7669 6577 2c20  get_slice(view, 
+000227a0: 736c 3d73 6c2c 2069 6478 3d69 6478 2c20  sl=sl, idx=idx, 
+000227b0: 706f 733d 706f 7329 0a20 2020 2020 2020  pos=pos).       
+000227c0: 2020 2020 206d 6173 6b32 203d 2072 6f69       mask2 = roi
+000227d0: 322e 6765 745f 736c 6963 6528 7669 6577  2.get_slice(view
+000227e0: 2c20 736c 3d73 6c2c 2069 6478 3d69 6478  , sl=sl, idx=idx
+000227f0: 2c20 706f 733d 706f 7329 0a20 2020 2020  , pos=pos).     
+00022800: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00022810: 2020 2020 206d 6173 6b31 203d 2072 6f69       mask1 = roi
+00022820: 312e 6765 745f 6d61 736b 2876 6965 772c  1.get_mask(view,
+00022830: 2066 6c61 7474 656e 3d66 6c61 7474 656e   flatten=flatten
+00022840: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
+00022850: 736b 3220 3d20 726f 6932 2e67 6574 5f6d  sk2 = roi2.get_m
+00022860: 6173 6b28 7669 6577 2c20 666c 6174 7465  ask(view, flatte
+00022870: 6e3d 666c 6174 7465 6e29 0a0a 2020 2020  n=flatten)..    
+00022880: 2020 2020 2320 4d61 6b65 2073 7472 7563      # Make struc
+00022890: 7475 7269 6e67 2065 6c65 6d65 6e74 0a20  turing element. 
+000228a0: 2020 2020 2020 2063 6f6e 6e32 203d 206e         conn2 = n
+000228b0: 6469 6d61 6765 2e67 656e 6572 6174 655f  dimage.generate_
+000228c0: 6269 6e61 7279 5f73 7472 7563 7475 7265  binary_structure
+000228d0: 2832 2c20 636f 6e6e 6563 7469 7669 7479  (2, connectivity
+000228e0: 290a 2020 2020 2020 2020 6966 206d 6173  ).        if mas
+000228f0: 6b31 2e6e 6469 6d20 3d3d 2032 3a0a 2020  k1.ndim == 2:.  
+00022900: 2020 2020 2020 2020 2020 636f 6e6e 203d            conn =
+00022910: 2063 6f6e 6e32 0a20 2020 2020 2020 2065   conn2.        e
+00022920: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00022930: 2069 6620 696e 5f73 6c69 6365 3a0a 2020   if in_slice:.  
+00022940: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00022950: 6e6e 203d 206e 702e 7a65 726f 7328 2833  nn = np.zeros((3
+00022960: 2c20 332c 2033 292c 2064 7479 7065 3d62  , 3, 3), dtype=b
+00022970: 6f6f 6c29 0a20 2020 2020 2020 2020 2020  ool).           
+00022980: 2020 2020 2063 6f6e 6e5b 3a2c 203a 2c20       conn[:, :, 
+00022990: 315d 203d 2063 6f6e 6e32 0a20 2020 2020  1] = conn2.     
+000229a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000229b0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+000229c0: 6e20 3d20 6e64 696d 6167 652e 6765 6e65  n = ndimage.gene
+000229d0: 7261 7465 5f62 696e 6172 795f 7374 7275  rate_binary_stru
+000229e0: 6374 7572 6528 332c 2063 6f6e 6e65 6374  cture(3, connect
+000229f0: 6976 6974 7929 0a0a 2020 2020 2020 2020  ivity)..        
+00022a00: 2320 4765 7420 6f75 7465 7220 7069 7865  # Get outer pixe
+00022a10: 6c20 6f66 2062 696e 6172 7920 6d61 7073  l of binary maps
+00022a20: 0a20 2020 2020 2020 2073 7572 6631 203d  .        surf1 =
+00022a30: 206d 6173 6b31 205e 206e 6469 6d61 6765   mask1 ^ ndimage
+00022a40: 2e62 696e 6172 795f 6572 6f73 696f 6e28  .binary_erosion(
+00022a50: 6d61 736b 312c 2063 6f6e 6e29 0a20 2020  mask1, conn).   
+00022a60: 2020 2020 2073 7572 6632 203d 206d 6173       surf2 = mas
+00022a70: 6b32 205e 206e 6469 6d61 6765 2e62 696e  k2 ^ ndimage.bin
+00022a80: 6172 795f 6572 6f73 696f 6e28 6d61 736b  ary_erosion(mask
+00022a90: 322c 2063 6f6e 6e29 0a0a 2020 2020 2020  2, conn)..      
+00022aa0: 2020 2320 4d61 6b65 2061 7272 6179 7320    # Make arrays 
+00022ab0: 6f66 2064 6973 7461 6e63 6573 2074 6f20  of distances to 
+00022ac0: 7375 7266 6163 6520 6f66 2065 6163 6820  surface of each 
+00022ad0: 524f 490a 2020 2020 2020 2020 6469 7374  ROI.        dist
+00022ae0: 3120 3d20 6e64 696d 6167 652e 6469 7374  1 = ndimage.dist
+00022af0: 616e 6365 5f74 7261 6e73 666f 726d 5f65  ance_transform_e
+00022b00: 6474 287e 7375 7266 312c 2076 6f78 656c  dt(~surf1, voxel
+00022b10: 5f73 697a 6529 0a20 2020 2020 2020 2064  _size).        d
+00022b20: 6973 7432 203d 206e 6469 6d61 6765 2e64  ist2 = ndimage.d
+00022b30: 6973 7461 6e63 655f 7472 616e 7366 6f72  istance_transfor
+00022b40: 6d5f 6564 7428 7e73 7572 6632 2c20 766f  m_edt(~surf2, vo
+00022b50: 7865 6c5f 7369 7a65 290a 0a20 2020 2020  xel_size)..     
+00022b60: 2020 2023 2047 6574 2073 6967 6e65 6420     # Get signed 
+00022b70: 6469 7374 616e 6365 730a 2020 2020 2020  distances.      
+00022b80: 2020 6966 2073 6967 6e65 643a 0a20 2020    if signed:.   
+00022b90: 2020 2020 2020 2020 2064 6973 7431 203d           dist1 =
+00022ba0: 2064 6973 7431 202a 207e 6d61 736b 3120   dist1 * ~mask1 
+00022bb0: 2d20 6469 7374 3120 2a20 6d61 736b 310a  - dist1 * mask1.
+00022bc0: 2020 2020 2020 2020 2020 2020 6469 7374              dist
+00022bd0: 3220 3d20 6469 7374 3220 2a20 7e6d 6173  2 = dist2 * ~mas
+00022be0: 6b32 202d 2064 6973 7432 202a 206d 6173  k2 - dist2 * mas
+00022bf0: 6b32 0a0a 2020 2020 2020 2020 2320 4d61  k2..        # Ma
+00022c00: 6b65 2076 6563 746f 7220 636f 6e74 6169  ke vector contai
+00022c10: 6e69 6e67 2061 6c6c 2064 6973 7461 6e63  ning all distanc
+00022c20: 6573 0a20 2020 2020 2020 2069 6620 636f  es.        if co
+00022c30: 6e66 6f72 6d69 7479 3a0a 2020 2020 2020  nformity:.      
+00022c40: 2020 2020 2020 6469 7374 315b 6d61 736b        dist1[mask
+00022c50: 3120 2620 6d61 736b 325d 203d 2030 0a20  1 & mask2] = 0. 
+00022c60: 2020 2020 2020 2020 2020 2064 6973 7431             dist1
+00022c70: 5b6d 6173 6b31 2026 207e 6d61 736b 325d  [mask1 & ~mask2]
+00022c80: 203d 202d 6469 7374 325b 6d61 736b 3120   = -dist2[mask1 
+00022c90: 2620 7e6d 6173 6b32 5d0a 2020 2020 2020  & ~mask2].      
+00022ca0: 2020 2020 2020 7364 7320 3d20 6e70 2e72        sds = np.r
+00022cb0: 6176 656c 2864 6973 7431 5b6d 6173 6b31  avel(dist1[mask1
+00022cc0: 207c 206d 6173 6b32 5d29 0a20 2020 2020   | mask2]).     
+00022cd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00022ce0: 2020 2020 2073 6473 203d 206e 702e 7261       sds = np.ra
+00022cf0: 7665 6c28 6469 7374 315b 7375 7266 3220  vel(dist1[surf2 
+00022d00: 213d 2030 5d29 0a20 2020 2020 2020 2020  != 0]).         
+00022d10: 2020 2069 6620 7379 6d6d 6574 7269 633a     if symmetric:
+00022d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022d30: 2073 6473 203d 206e 702e 636f 6e63 6174   sds = np.concat
+00022d40: 656e 6174 6528 5b73 6473 2c20 6e70 2e72  enate([sds, np.r
+00022d50: 6176 656c 2864 6973 7432 5b73 7572 6631  avel(dist2[surf1
+00022d60: 2021 3d20 305d 295d 290a 2020 2020 2020   != 0])]).      
+00022d70: 2020 7265 7475 726e 2073 6473 0a0a 2020    return sds..  
+00022d80: 2020 6465 6620 6765 745f 6d65 616e 5f73    def get_mean_s
+00022d90: 7572 6661 6365 5f64 6973 7461 6e63 6528  urface_distance(
+00022da0: 7365 6c66 2c20 6f74 6865 722c 202a 2a6b  self, other, **k
+00022db0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+00022dc0: 2727 270a 2020 2020 2020 2020 4f62 7461  '''.        Obta
+00022dd0: 696e 206d 6561 6e20 6469 7374 616e 6365  in mean distance
+00022de0: 2062 6574 7765 656e 2073 7572 6661 6365   between surface
+00022df0: 206f 6620 3c6f 7468 6572 3e20 616e 6420   of <other> and 
+00022e00: 7375 7266 6163 6520 6f66 203c 7365 6c66  surface of <self
+00022e10: 3e2e 0a0a 2020 2020 2020 2020 466f 7220  >...        For 
+00022e20: 7061 7261 6d65 7465 7273 2074 6861 7420  parameters that 
+00022e30: 6d61 7920 6265 2070 6173 7365 642c 2073  may be passed, s
+00022e40: 6565 2064 6f63 756d 656e 7461 7469 6f6e  ee documentation
+00022e50: 2066 6f72 3a0a 2020 2020 2020 2020 736b   for:.        sk
+00022e60: 7274 2e52 4f49 2e67 6574 5f73 7572 6661  rt.ROI.get_surfa
+00022e70: 6365 5f64 6973 7461 6e63 6573 2829 2e0a  ce_distances()..
+00022e80: 2020 2020 2020 2020 2727 270a 0a20 2020          '''..   
+00022e90: 2020 2020 2073 6473 203d 2073 656c 662e       sds = self.
+00022ea0: 6765 745f 7375 7266 6163 655f 6469 7374  get_surface_dist
+00022eb0: 616e 6365 7328 6f74 6865 722c 202a 2a6b  ances(other, **k
+00022ec0: 7761 7267 7329 0a20 2020 2020 2020 2069  wargs).        i
+00022ed0: 6620 7364 7320 6973 204e 6f6e 653a 0a20  f sds is None:. 
+00022ee0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00022ef0: 6e0a 2020 2020 2020 2020 7265 7475 726e  n.        return
+00022f00: 2073 6473 2e6d 6561 6e28 290a 0a20 2020   sds.mean()..   
+00022f10: 2064 6566 2067 6574 5f72 6d73 5f73 7572   def get_rms_sur
+00022f20: 6661 6365 5f64 6973 7461 6e63 6528 7365  face_distance(se
+00022f30: 6c66 2c20 6f74 6865 722c 202a 2a6b 7761  lf, other, **kwa
+00022f40: 7267 7329 3a0a 0a20 2020 2020 2020 2073  rgs):..        s
+00022f50: 6473 203d 2073 656c 662e 6765 745f 7375  ds = self.get_su
+00022f60: 7266 6163 655f 6469 7374 616e 6365 7328  rface_distances(
+00022f70: 6f74 6865 722c 202a 2a6b 7761 7267 7329  other, **kwargs)
+00022f80: 0a20 2020 2020 2020 2069 6620 7364 7320  .        if sds 
+00022f90: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00022fa0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00022fb0: 2020 2020 7265 7475 726e 206e 702e 7371      return np.sq
+00022fc0: 7274 2828 7364 7320 2a2a 2032 292e 6d65  rt((sds ** 2).me
+00022fd0: 616e 2829 290a 0a20 2020 2064 6566 2067  an())..    def g
+00022fe0: 6574 5f68 6175 7364 6f72 6666 5f64 6973  et_hausdorff_dis
+00022ff0: 7461 6e63 6528 7365 6c66 2c20 6f74 6865  tance(self, othe
+00023000: 722c 202a 2a6b 7761 7267 7329 3a0a 0a20  r, **kwargs):.. 
+00023010: 2020 2020 2020 2073 6473 203d 2073 656c         sds = sel
+00023020: 662e 6765 745f 7375 7266 6163 655f 6469  f.get_surface_di
+00023030: 7374 616e 6365 7328 6f74 6865 722c 202a  stances(other, *
+00023040: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
+00023050: 2069 6620 7364 7320 6973 204e 6f6e 653a   if sds is None:
+00023060: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00023070: 7572 6e0a 2020 2020 2020 2020 7265 7475  urn.        retu
+00023080: 726e 2073 6473 2e6d 6178 2829 0a0a 2020  rn sds.max()..  
+00023090: 2020 6465 6620 6765 745f 6d65 616e 5f64    def get_mean_d
+000230a0: 6973 7461 6e63 655f 746f 5f63 6f6e 666f  istance_to_confo
+000230b0: 726d 6974 7928 7365 6c66 2c20 6f74 6865  rmity(self, othe
+000230c0: 722c 2076 6f6c 5f75 6e69 7473 3d22 6d6d  r, vol_units="mm
+000230d0: 222c 202a 2a6b 7761 7267 7329 3a0a 2020  ", **kwargs):.  
+000230e0: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
+000230f0: 2020 4f62 7461 696e 206d 6561 6e20 6469    Obtain mean di
+00023100: 7374 616e 6365 2074 6f20 636f 6e66 6f72  stance to confor
+00023110: 6d69 7479 2066 6f72 203c 6f74 6865 723e  mity for <other>
+00023120: 2072 656c 6174 6976 6520 746f 203c 7365   relative to <se
+00023130: 6c66 3e2e 0a0a 2020 2020 2020 2020 5468  lf>...        Th
+00023140: 6520 6d65 616e 2064 6973 7461 6e63 6520  e mean distance 
+00023150: 746f 2063 6f6e 666f 726d 6974 7920 6973  to conformity is
+00023160: 2061 7320 6465 6669 6e65 6420 696e 3a0a   as defined in:.
+00023170: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
+00023180: 646f 692e 6f72 672f 3130 2e31 3235 392f  doi.org/10.1259/
+00023190: 626a 722f 3237 3637 3435 3831 0a20 2020  bjr/27674581.   
+000231a0: 2020 2020 2054 6563 686e 6963 616c 6c79       Technically
+000231b0: 2074 6865 206d 6561 6e20 6469 7374 616e   the mean distan
+000231c0: 6365 2074 6f20 636f 6e66 6f72 6d69 7479  ce to conformity
+000231d0: 2069 736e 2774 2061 2064 6973 7461 6e63   isn't a distanc
+000231e0: 652c 0a20 2020 2020 2020 2062 7574 2069  e,.        but i
+000231f0: 7320 6120 6469 7374 616e 6365 2064 6976  s a distance div
+00023200: 6964 6564 2062 7920 6120 766f 6c75 6d65  ided by a volume
+00023210: 2e0a 0a20 2020 2020 2020 2054 6869 7320  ...        This 
+00023220: 6675 6e63 7469 6f6e 2072 6574 7572 6e73  function returns
+00023230: 2061 2073 6b72 742e 636f 7265 2e44 6174   a skrt.core.Dat
+00023240: 6120 6f62 6a65 6374 2c20 7769 7468 2074  a object, with t
+00023250: 6865 2066 6f6c 6c6f 7769 6e67 0a20 2020  he following.   
+00023260: 2020 2020 2069 6e66 6f72 6d61 7469 6f6e       information
+00023270: 3a0a 0a20 2020 2020 2020 206e 5f76 6f78  :..        n_vox
+00023280: 656c 203a 206e 756d 6265 7220 6f66 2076  el : number of v
+00023290: 6f78 656c 7320 696e 2074 6865 2075 6e69  oxels in the uni
+000232a0: 6f6e 206f 6620 7468 6520 524f 4973 2063  on of the ROIs c
+000232b0: 6f6e 7369 6465 7265 642e 0a0a 2020 2020  onsidered...    
+000232c0: 2020 2020 766f 7865 6c5f 7369 7a65 203a      voxel_size :
+000232d0: 2076 6f78 656c 2073 697a 6520 2864 782c   voxel size (dx,
+000232e0: 2064 792c 2064 7a29 2069 6e20 6d69 6c6c   dy, dz) in mill
+000232f0: 696d 6574 7265 732c 2069 6e20 7468 650a  imetres, in the.
+00023300: 2020 2020 2020 2020 524f 4920 6d61 736b          ROI mask
+00023310: 7320 7573 6564 2069 6e20 6469 7374 616e  s used in distan
+00023320: 6365 2063 616c 6375 6c61 7469 6f6e 732e  ce calculations.
+00023330: 0a0a 2020 2020 2020 2020 6d65 616e 5f75  ..        mean_u
+00023340: 6e64 6572 5f63 6f6e 746f 7572 696e 6720  nder_contouring 
+00023350: 3a20 7375 6d20 6f66 2061 6273 6f6c 7574  : sum of absolut
+00023360: 6520 7661 6c75 6573 206f 6620 6e65 6761  e values of nega
+00023370: 7469 7665 2064 6973 7461 6e63 6573 0a20  tive distances. 
+00023380: 2020 2020 2020 2074 6f20 636f 6e66 6f72         to confor
+00023390: 6d69 7479 2c20 6469 7669 6465 6420 6279  mity, divided by
+000233a0: 2076 6f6c 756d 6520 696e 2075 6e69 6f6e   volume in union
+000233b0: 206f 6620 524f 4973 2063 6f6e 7369 6465   of ROIs conside
+000233c0: 7265 642e 0a0a 2020 2020 2020 2020 6d65  red...        me
+000233d0: 616e 5f6f 7665 725f 636f 6e74 6f75 7269  an_over_contouri
+000233e0: 6e67 203a 2073 756d 206f 6620 706f 7369  ng : sum of posi
+000233f0: 7469 7665 2064 6973 7461 6e63 6573 2074  tive distances t
+00023400: 6f20 636f 6e66 6f72 6d69 7479 2c0a 2020  o conformity,.  
+00023410: 2020 2020 2020 6469 7669 6465 6420 6279        divided by
+00023420: 2076 6f6c 756d 6520 696e 2075 6e69 6f6e   volume in union
+00023430: 206f 6620 524f 4973 2063 6f6e 7369 6465   of ROIs conside
+00023440: 7265 642e 0a0a 2020 2020 2020 2020 6d65  red...        me
+00023450: 616e 5f64 6973 7461 6e63 655f 746f 5f63  an_distance_to_c
+00023460: 6f6e 666f 726d 6974 7920 3a20 7375 6d20  onformity : sum 
+00023470: 6f66 206d 6561 6e5f 756e 6465 725f 636f  of mean_under_co
+00023480: 6e74 6f75 7269 6e67 2061 6e64 0a20 2020  ntouring and.   
+00023490: 2020 2020 206d 6561 6e5f 6f76 6572 5f63       mean_over_c
+000234a0: 6f6e 746f 7572 696e 672e 0a0a 2020 2020  ontouring...    
+000234b0: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+000234c0: 3a2a 2a0a 2020 2020 2020 2020 766f 6c5f  :**.        vol_
+000234d0: 756e 6974 7320 3a20 7374 722c 2064 6566  units : str, def
+000234e0: 6175 6c74 3d22 6d6d 220a 2020 2020 2020  ault="mm".      
+000234f0: 2020 2020 2020 556e 6974 7320 746f 2075        Units to u
+00023500: 7365 2066 6f72 2076 6f6c 756d 6520 696e  se for volume in
+00023510: 2064 656e 6f6d 696e 6174 6f72 2077 6865   denominator whe
+00023520: 6e20 6361 6c63 756c 6174 696e 670a 2020  n calculating.  
+00023530: 2020 2020 2020 2020 2020 6d65 616e 5f75            mean_u
+00023540: 6e64 6572 5f63 6f6e 746f 7572 696e 6720  nder_contouring 
+00023550: 616e 6420 6d65 616e 5f6f 7665 7263 6f6e  and mean_overcon
+00023560: 746f 7572 696e 672e 2043 616e 2062 650a  touring. Can be.
+00023570: 2020 2020 2020 2020 2020 2020 226d 6d22              "mm"
+00023580: 2028 3d6d 6d5e 3329 2c20 226d 6c22 2c20   (=mm^3), "ml", 
+00023590: 6f72 2022 766f 7865 6c73 222e 0a0a 2020  or "voxels"...  
+000235a0: 2020 2020 2020 6b77 6172 6773 0a20 2020        kwargs.   
+000235b0: 2020 2020 2020 2020 204b 6579 776f 7264           Keyword
+000235c0: 2061 7267 756d 656e 7473 2061 7265 2070   arguments are p
+000235d0: 6173 7365 6420 746f 0a20 2020 2020 2020  assed to.       
+000235e0: 2020 2020 2073 6b72 742e 7374 7275 6374       skrt.struct
+000235f0: 7572 6573 2e52 4f49 2e67 6574 5f73 7572  ures.ROI.get_sur
+00023600: 6661 6365 5f64 6973 7461 6e63 6573 2829  face_distances()
+00023610: 2e0a 2020 2020 2020 2020 2020 2020 5365  ..            Se
+00023620: 6520 646f 6375 6d65 6e74 6174 696f 6e20  e documentation 
+00023630: 6f66 2074 6869 7320 6d65 7468 6f64 2066  of this method f
+00023640: 6f72 2070 6172 616d 6574 6572 2064 6574  or parameter det
+00023650: 6169 6c73 2e0a 2020 2020 2020 2020 2727  ails..        ''
+00023660: 270a 0a20 2020 2020 2020 2023 204f 6274  '..        # Obt
+00023670: 6169 6e20 6469 7374 616e 6365 7320 746f  ain distances to
+00023680: 2063 6f6e 666f 726d 6974 792e 0a20 2020   conformity..   
+00023690: 2020 2020 206b 7761 7267 735b 2263 6f6e       kwargs["con
+000236a0: 666f 726d 6974 7922 5d20 3d20 5472 7565  formity"] = True
+000236b0: 0a20 2020 2020 2020 2073 6473 203d 2073  .        sds = s
+000236c0: 656c 662e 6765 745f 7375 7266 6163 655f  elf.get_surface_
+000236d0: 6469 7374 616e 6365 7328 6f74 6865 722c  distances(other,
+000236e0: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+000236f0: 2020 2020 2320 4f62 7461 696e 206d 6173      # Obtain mas
+00023700: 6b20 6172 7261 7920 7265 7072 6573 656e  k array represen
+00023710: 7469 6e67 2075 6e69 6f6e 206f 6620 524f  ting union of RO
+00023720: 4973 2e0a 2020 2020 2020 2020 756e 696f  Is..        unio
+00023730: 6e20 3d20 5374 7275 6374 7572 6553 6574  n = StructureSet
+00023740: 285b 7365 6c66 2c20 6f74 6865 725d 292e  ([self, other]).
+00023750: 636f 6d62 696e 655f 726f 6973 2829 0a20  combine_rois(). 
+00023760: 2020 2020 2020 2076 6965 7720 3d20 6b77         view = kw
+00023770: 6172 6773 2e67 6574 2822 7669 6577 222c  args.get("view",
+00023780: 2022 782d 7922 290a 2020 2020 2020 2020   "x-y").        
+00023790: 6966 206b 7761 7267 732e 6765 7428 2273  if kwargs.get("s
+000237a0: 696e 676c 655f 736c 6963 6522 2c20 4661  ingle_slice", Fa
+000237b0: 6c73 6529 3a0a 2020 2020 2020 2020 2020  lse):.          
+000237c0: 2020 736c 203d 206b 7761 7267 732e 6765    sl = kwargs.ge
+000237d0: 7428 2273 6c22 2c20 4e6f 6e65 290a 2020  t("sl", None).  
+000237e0: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
+000237f0: 6b77 6172 6773 2e67 6574 2822 6964 7822  kwargs.get("idx"
+00023800: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
+00023810: 2020 2020 706f 7320 3d20 6b77 6172 6773      pos = kwargs
+00023820: 2e67 6574 2822 706f 7322 2c20 4e6f 6e65  .get("pos", None
+00023830: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
+00023840: 736b 5f64 6174 6120 3d20 756e 696f 6e2e  sk_data = union.
+00023850: 6765 745f 736c 6963 6528 7669 6577 2c20  get_slice(view, 
+00023860: 736c 2c20 6964 782c 2070 6f73 290a 2020  sl, idx, pos).  
+00023870: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00023880: 2020 2020 2020 2020 666c 6174 7465 6e20          flatten 
+00023890: 3d20 6b77 6172 6773 2e67 6574 2822 666c  = kwargs.get("fl
+000238a0: 6174 7465 6e22 2c20 4661 6c73 6529 0a20  atten", False). 
+000238b0: 2020 2020 2020 2020 2020 206d 6173 6b5f             mask_
+000238c0: 6461 7461 203d 2075 6e69 6f6e 2e67 6574  data = union.get
+000238d0: 5f6d 6173 6b28 7669 6577 2c20 666c 6174  _mask(view, flat
+000238e0: 7465 6e29 0a0a 2020 2020 2020 2020 2320  ten)..        # 
+000238f0: 4361 6c63 756c 6174 6520 636f 6e66 6f72  Calculate confor
+00023900: 6d69 7479 2073 636f 7265 732e 0a20 2020  mity scores..   
+00023910: 2020 2020 2063 6f6e 666f 726d 6974 7920       conformity 
+00023920: 3d20 736b 7274 2e63 6f72 652e 4461 7461  = skrt.core.Data
+00023930: 2829 0a20 2020 2020 2020 2063 6f6e 666f  ().        confo
+00023940: 726d 6974 792e 6e5f 766f 7865 6c20 3d20  rmity.n_voxel = 
+00023950: 6d61 736b 5f64 6174 612e 7375 6d28 290a  mask_data.sum().
+00023960: 2020 2020 2020 2020 636f 6e66 6f72 6d69          conformi
+00023970: 7479 2e76 6f78 656c 5f73 697a 6520 3d20  ty.voxel_size = 
+00023980: 756e 696f 6e2e 6765 745f 766f 7865 6c5f  union.get_voxel_
+00023990: 7369 7a65 2829 0a20 2020 2020 2020 2069  size().        i
+000239a0: 6620 7364 7320 6973 204e 6f6e 653a 0a20  f sds is None:. 
+000239b0: 2020 2020 2020 2020 2020 2063 6f6e 666f             confo
+000239c0: 726d 6974 792e 6d65 616e 5f75 6e64 6572  rmity.mean_under
+000239d0: 5f63 6f6e 746f 7572 696e 6720 3d20 4e6f  _contouring = No
+000239e0: 6e65 0a20 2020 2020 2020 2020 2020 2063  ne.            c
+000239f0: 6f6e 666f 726d 6974 792e 6d65 616e 5f6f  onformity.mean_o
+00023a00: 7665 725f 636f 6e74 6f75 7269 6e67 203d  ver_contouring =
+00023a10: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
 00023a20: 2020 636f 6e66 6f72 6d69 7479 2e6d 6561    conformity.mea
-00023a30: 6e5f 756e 6465 725f 636f 6e74 6f75 7269  n_under_contouri
-00023a40: 6e67 203d 2028 6162 7328 7364 735b 7364  ng = (abs(sds[sd
-00023a50: 7320 3c20 305d 2e73 756d 2829 290a 2020  s < 0].sum()).  
-00023a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a70: 2020 2f20 756e 696f 6e2e 6765 745f 766f    / union.get_vo
-00023a80: 6c75 6d65 2876 6f6c 5f75 6e69 7473 2929  lume(vol_units))
-00023a90: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00023aa0: 666f 726d 6974 792e 6d65 616e 5f6f 7665  formity.mean_ove
-00023ab0: 725f 636f 6e74 6f75 7269 6e67 203d 2028  r_contouring = (
-00023ac0: 7364 735b 7364 7320 3e20 305d 2e73 756d  sds[sds > 0].sum
-00023ad0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00023ae0: 2020 2020 2020 202f 2075 6e69 6f6e 2e67         / union.g
-00023af0: 6574 5f76 6f6c 756d 6528 766f 6c5f 756e  et_volume(vol_un
-00023b00: 6974 7329 290a 2020 2020 2020 2020 2020  its)).          
-00023b10: 2020 636f 6e66 6f72 6d69 7479 2e6d 6561    conformity.mea
-00023b20: 6e5f 6469 7374 616e 6365 5f74 6f5f 636f  n_distance_to_co
-00023b30: 6e66 6f72 6d69 7479 203d 2028 0a20 2020  nformity = (.   
-00023b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023b50: 2063 6f6e 666f 726d 6974 792e 6d65 616e   conformity.mean
-00023b60: 5f75 6e64 6572 5f63 6f6e 746f 7572 696e  _under_contourin
-00023b70: 6720 2b0a 2020 2020 2020 2020 2020 2020  g +.            
-00023b80: 2020 2020 2020 2020 636f 6e66 6f72 6d69          conformi
-00023b90: 7479 2e6d 6561 6e5f 6f76 6572 5f63 6f6e  ty.mean_over_con
-00023ba0: 746f 7572 696e 6729 0a0a 2020 2020 2020  touring)..      
-00023bb0: 2020 7265 7475 726e 2063 6f6e 666f 726d    return conform
-00023bc0: 6974 790a 0a20 2020 2064 6566 2067 6574  ity..    def get
-00023bd0: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
-00023be0: 655f 6d65 7472 6963 7328 7365 6c66 2c20  e_metrics(self, 
-00023bf0: 6f74 6865 722c 202a 2a6b 7761 7267 7329  other, **kwargs)
-00023c00: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
-00023c10: 2074 6865 206d 6561 6e20 7375 7266 6163   the mean surfac
-00023c20: 6520 6469 7374 616e 6365 2c20 524d 5320  e distance, RMS 
-00023c30: 7375 7266 6163 6520 6469 7374 616e 6365  surface distance
-00023c40: 2c20 616e 6420 4861 7573 646f 7266 660a  , and Hausdorff.
-00023c50: 2020 2020 2020 2020 6469 7374 616e 6365          distance
-00023c60: 2e22 2222 0a0a 2020 2020 2020 2020 7364  ."""..        sd
-00023c70: 7320 3d20 7365 6c66 2e67 6574 5f73 7572  s = self.get_sur
-00023c80: 6661 6365 5f64 6973 7461 6e63 6573 286f  face_distances(o
-00023c90: 7468 6572 2c20 2a2a 6b77 6172 6773 290a  ther, **kwargs).
-00023ca0: 2020 2020 2020 2020 6966 2073 6473 2069          if sds i
-00023cb0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00023cc0: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-00023cd0: 2020 2072 6574 7572 6e20 7364 732e 6d65     return sds.me
-00023ce0: 616e 2829 2c20 6e70 2e73 7172 7428 2873  an(), np.sqrt((s
-00023cf0: 6473 202a 2a20 3229 2e6d 6561 6e28 2929  ds ** 2).mean())
-00023d00: 2c20 7364 732e 6d61 7828 290a 0a20 2020  , sds.max()..   
-00023d10: 2064 6566 2070 6c6f 745f 7375 7266 6163   def plot_surfac
-00023d20: 655f 6469 7374 616e 6365 7328 7365 6c66  e_distances(self
-00023d30: 2c20 6f74 6865 722c 2073 6176 655f 6173  , other, save_as
-00023d40: 3d4e 6f6e 652c 2073 6967 6e65 643d 4661  =None, signed=Fa
-00023d50: 6c73 652c 202a 2a6b 7761 7267 7329 3a0a  lse, **kwargs):.
-00023d60: 2020 2020 2020 2020 2222 2250 6c6f 7420          """Plot 
-00023d70: 6869 7374 6f67 7261 6d20 6f66 2073 7572  histogram of sur
-00023d80: 6661 6365 2064 6973 7461 6e63 6573 2e22  face distances."
-00023d90: 2222 0a0a 2020 2020 2020 2020 7364 7320  ""..        sds 
-00023da0: 3d20 7365 6c66 2e67 6574 5f73 7572 6661  = self.get_surfa
-00023db0: 6365 5f64 6973 7461 6e63 6573 286f 7468  ce_distances(oth
-00023dc0: 6572 2c20 7369 676e 6564 3d73 6967 6e65  er, signed=signe
-00023dd0: 642c 202a 2a6b 7761 7267 7329 0a20 2020  d, **kwargs).   
-00023de0: 2020 2020 2069 6620 7364 7320 6973 204e       if sds is N
-00023df0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00023e00: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
-00023e10: 6669 672c 2061 7820 3d20 706c 742e 7375  fig, ax = plt.su
-00023e20: 6270 6c6f 7473 2829 0a20 2020 2020 2020  bplots().       
-00023e30: 2061 782e 6869 7374 2873 6473 290a 2020   ax.hist(sds).  
-00023e40: 2020 2020 2020 786c 6162 656c 203d 2028        xlabel = (
-00023e50: 0a20 2020 2020 2020 2020 2020 2022 5375  .            "Su
-00023e60: 7266 6163 6520 6469 7374 616e 6365 2028  rface distance (
-00023e70: 6d6d 2922 2069 6620 6e6f 7420 7369 676e  mm)" if not sign
-00023e80: 6564 2065 6c73 6520 2253 6967 6e65 6420  ed else "Signed 
-00023e90: 7375 7266 6163 6520 6469 7374 616e 6365  surface distance
-00023ea0: 2028 6d6d 2922 0a20 2020 2020 2020 2029   (mm)".        )
-00023eb0: 0a20 2020 2020 2020 2061 782e 7365 745f  .        ax.set_
-00023ec0: 786c 6162 656c 2878 6c61 6265 6c29 0a20  xlabel(xlabel). 
-00023ed0: 2020 2020 2020 2061 782e 7365 745f 796c         ax.set_yl
-00023ee0: 6162 656c 2822 4e75 6d62 6572 206f 6620  abel("Number of 
-00023ef0: 766f 7865 6c73 2229 0a20 2020 2020 2020  voxels").       
-00023f00: 2069 6620 7361 7665 5f61 733a 0a20 2020   if save_as:.   
-00023f10: 2020 2020 2020 2020 2070 6c74 2e74 6967           plt.tig
-00023f20: 6874 5f6c 6179 6f75 7428 290a 2020 2020  ht_layout().    
-00023f30: 2020 2020 2020 2020 6669 672e 7361 7665          fig.save
-00023f40: 6669 6728 7361 7665 5f61 7329 0a0a 2020  fig(save_as)..  
-00023f50: 2020 6465 6620 6765 745f 636f 6d70 6172    def get_compar
-00023f60: 6973 6f6e 280a 2020 2020 2020 2020 7365  ison(.        se
-00023f70: 6c66 2c0a 2020 2020 2020 2020 726f 692c  lf,.        roi,
-00023f80: 0a20 2020 2020 2020 206d 6574 7269 6373  .        metrics
-00023f90: 3d4e 6f6e 652c 0a20 2020 2020 2020 2076  =None,.        v
-00023fa0: 6f6c 5f75 6e69 7473 3d22 6d6d 222c 0a20  ol_units="mm",. 
-00023fb0: 2020 2020 2020 2061 7265 615f 756e 6974         area_unit
-00023fc0: 733d 226d 6d22 2c0a 2020 2020 2020 2020  s="mm",.        
-00023fd0: 6365 6e74 726f 6964 5f75 6e69 7473 3d22  centroid_units="
-00023fe0: 6d6d 222c 0a20 2020 2020 2020 2076 6965  mm",.        vie
-00023ff0: 773d 2278 2d79 222c 0a20 2020 2020 2020  w="x-y",.       
-00024000: 2073 6c3d 4e6f 6e65 2c0a 2020 2020 2020   sl=None,.      
-00024010: 2020 706f 733d 4e6f 6e65 2c0a 2020 2020    pos=None,.    
-00024020: 2020 2020 6964 783d 4e6f 6e65 2c0a 2020      idx=None,.  
-00024030: 2020 2020 2020 6d65 7468 6f64 3d4e 6f6e        method=Non
-00024040: 652c 0a20 2020 2020 2020 2073 6c69 6365  e,.        slice
-00024050: 5f73 7461 7473 3d4e 6f6e 652c 0a20 2020  _stats=None,.   
-00024060: 2020 2020 2064 6566 6175 6c74 5f62 795f       default_by_
-00024070: 736c 6963 653d 4e6f 6e65 2c0a 2020 2020  slice=None,.    
-00024080: 2020 2020 756e 6974 735f 696e 5f68 6561      units_in_hea
-00024090: 6465 723d 4661 6c73 652c 0a20 2020 2020  der=False,.     
-000240a0: 2020 2067 6c6f 6261 6c5f 7673 5f73 6c69     global_vs_sli
-000240b0: 6365 5f68 6561 6465 723d 4661 6c73 652c  ce_header=False,
-000240c0: 0a20 2020 2020 2020 206e 616d 655f 6173  .        name_as
-000240d0: 5f69 6e64 6578 3d54 7275 652c 0a20 2020  _index=True,.   
-000240e0: 2020 2020 206e 6963 655f 636f 6c75 6d6e       nice_column
-000240f0: 733d 4661 6c73 652c 0a20 2020 2020 2020  s=False,.       
-00024100: 2064 6563 696d 616c 5f70 6c61 6365 733d   decimal_places=
-00024110: 4e6f 6e65 2c0a 2020 2020 2020 2020 666f  None,.        fo
-00024120: 7263 653d 5472 7565 2c0a 2020 2020 2020  rce=True,.      
-00024130: 2020 766f 7865 6c5f 7369 7a65 3d28 312c    voxel_size=(1,
-00024140: 2031 2c20 3129 2c0a 2020 2020 2020 2020   1, 1),.        
-00024150: 6d61 7463 685f 6c65 6e67 7468 733d 4661  match_lengths=Fa
-00024160: 6c73 652c 0a20 2020 2020 2020 206d 6174  lse,.        mat
-00024170: 6368 5f6c 656e 6774 6873 5f73 7472 6174  ch_lengths_strat
-00024180: 6567 793d 310a 2020 2020 293a 0a20 2020  egy=1.    ):.   
-00024190: 2020 2020 2022 2222 5265 7475 726e 2061       """Return a
-000241a0: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
-000241b0: 6520 6f66 2074 6865 2063 6f6d 7061 7269  e of the compari
-000241c0: 736f 6e20 6d65 7472 6963 7320 6c69 7374  son metrics list
-000241d0: 6564 2069 6e20 0a20 2020 2020 2020 203c  ed in .        <
-000241e0: 6d65 7472 6963 733e 2077 6974 6820 7265  metrics> with re
-000241f0: 7370 6563 7420 746f 2061 6e6f 7468 6572  spect to another
-00024200: 2052 4f49 2e0a 0a20 2020 2020 2020 202a   ROI...        *
-00024210: 2a50 6172 616d 6574 6572 733a 2a2a 0a20  *Parameters:**. 
-00024220: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00024230: 726f 6920 3a20 524f 490a 2020 2020 2020  roi : ROI.      
-00024240: 2020 2020 2020 4f74 6865 7220 524f 4920        Other ROI 
-00024250: 7769 7468 2077 6869 6368 2074 6f20 636f  with which to co
-00024260: 6d70 6172 6520 7468 6973 2052 4f49 2e0a  mpare this ROI..
-00024270: 0a20 2020 2020 2020 206d 6574 7269 6373  .        metrics
-00024280: 203a 206c 6973 742c 2064 6566 6175 6c74   : list, default
-00024290: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-000242a0: 2020 4c69 7374 206f 6620 6d65 7472 6963    List of metric
-000242b0: 7320 746f 2069 6e63 6c75 6465 2069 6e20  s to include in 
-000242c0: 7468 6520 7461 626c 652e 204f 7074 696f  the table. Optio
-000242d0: 6e73 3a0a 0a20 2020 2020 2020 2020 2020  ns:..           
-000242e0: 2020 2020 202a 2022 6469 6365 2220 3a20       * "dice" : 
-000242f0: 676c 6f62 616c 2044 6963 6520 7363 6f72  global Dice scor
-00024300: 652e 0a20 2020 2020 2020 2020 2020 2020  e..             
-00024310: 2020 202a 2022 6469 6365 5f66 6c61 7422     * "dice_flat"
-00024320: 3a20 4469 6365 2073 636f 7265 206f 6620  : Dice score of 
-00024330: 524f 4973 2066 6c61 7474 656e 6564 2069  ROIs flattened i
-00024340: 6e20 7468 6520 6f72 6965 6e74 6174 696f  n the orientatio
-00024350: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00024360: 2020 2020 7370 6563 6966 6965 6420 696e      specified in
-00024370: 203c 7669 6577 3e2e 0a20 2020 2020 2020   <view>..       
-00024380: 2020 2020 2020 2020 202a 2022 6469 6365           * "dice
-00024390: 5f73 6c69 6365 223a 2044 6963 6520 7363  _slice": Dice sc
-000243a0: 6f72 6520 6f6e 2061 2073 696e 676c 6520  ore on a single 
-000243b0: 736c 6963 652e 0a20 2020 2020 2020 2020  slice..         
-000243c0: 2020 2020 2020 202a 2022 6469 6365 5f73         * "dice_s
-000243d0: 6c69 6365 5f73 7461 7473 223a 2073 7461  lice_stats": sta
-000243e0: 7469 7374 6963 7320 7370 6563 6966 6965  tistics specifie
-000243f0: 6420 696e 203c 736c 6963 655f 7374 6174  d in <slice_stat
-00024400: 733e 0a20 2020 2020 2020 2020 2020 2020  s>.             
-00024410: 2020 2020 2066 6f72 2073 6c69 6365 2d62       for slice-b
-00024420: 792d 736c 6963 6520 4469 6365 2073 636f  y-slice Dice sco
-00024430: 7265 732e 0a0a 2020 2020 2020 2020 2020  res...          
-00024440: 2020 2020 2020 2a20 226a 6163 6361 7264        * "jaccard
-00024450: 2220 3a20 676c 6f62 616c 204a 6163 6361  " : global Jacca
-00024460: 7264 2069 6e64 6578 2e0a 2020 2020 2020  rd index..      
-00024470: 2020 2020 2020 2020 2020 2a20 226a 6163            * "jac
-00024480: 6361 7264 5f66 6c61 7422 3a20 4a61 6363  card_flat": Jacc
-00024490: 6172 6420 696e 6465 7820 6f66 2052 4f49  ard index of ROI
-000244a0: 7320 666c 6174 7465 6e65 6420 696e 0a20  s flattened in. 
-000244b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000244c0: 2074 6865 206f 7269 656e 7461 7469 6f6e   the orientation
-000244d0: 2073 7065 6369 6669 6564 2069 6e20 3c76   specified in <v
-000244e0: 6965 773e 2e0a 2020 2020 2020 2020 2020  iew>..          
-000244f0: 2020 2020 2020 2a20 226a 6163 6361 7264        * "jaccard
-00024500: 5f73 6c69 6365 223a 204a 6163 6361 7264  _slice": Jaccard
-00024510: 2069 6e64 6578 206f 6e20 6120 7369 6e67   index on a sing
-00024520: 6c65 2073 6c69 6365 2e0a 2020 2020 2020  le slice..      
-00024530: 2020 2020 2020 2020 2020 2a20 226a 6163            * "jac
-00024540: 6361 7264 5f73 6c69 6365 5f73 7461 7473  card_slice_stats
-00024550: 223a 2073 7461 7469 7374 6963 7320 7370  ": statistics sp
-00024560: 6563 6966 6965 6420 696e 203c 736c 6963  ecified in <slic
-00024570: 655f 7374 6174 733e 0a20 2020 2020 2020  e_stats>.       
-00024580: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-00024590: 6c69 6365 2d62 792d 736c 6963 6520 4a61  lice-by-slice Ja
-000245a0: 6363 6172 6420 696e 6469 6365 732e 0a0a  ccard indices...
-000245b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000245c0: 2a20 2263 656e 7472 6f69 6422 3a20 3344  * "centroid": 3D
-000245d0: 2063 656e 7472 6f69 6420 6469 7374 616e   centroid distan
-000245e0: 6365 2076 6563 746f 722e 0a20 2020 2020  ce vector..     
-000245f0: 2020 2020 2020 2020 2020 202a 2022 6162             * "ab
-00024600: 735f 6365 6e74 726f 6964 223a 206d 6167  s_centroid": mag
-00024610: 6e69 7475 6465 206f 6620 3344 2063 656e  nitude of 3D cen
-00024620: 7472 6f69 6420 6469 7374 616e 6365 2076  troid distance v
-00024630: 6563 746f 722e 0a20 2020 2020 2020 2020  ector..         
-00024640: 2020 2020 2020 202a 2022 6162 735f 6365         * "abs_ce
-00024650: 6e74 726f 6964 5f66 6c61 7422 3a20 6d61  ntroid_flat": ma
-00024660: 676e 6974 7564 6520 6f66 2033 4420 6365  gnitude of 3D ce
-00024670: 6e74 726f 6964 2064 6973 7461 6e63 6520  ntroid distance 
-00024680: 7665 6374 6f72 0a20 2020 2020 2020 2020  vector.         
-00024690: 2020 2020 2020 2020 2070 726f 6a65 6374           project
-000246a0: 6564 2069 6e74 6f20 7468 6520 706c 616e  ed into the plan
-000246b0: 6520 7370 6563 6966 6965 6420 696e 203c  e specified in <
-000246c0: 7669 6577 3e2e 0a20 2020 2020 2020 2020  view>..         
-000246d0: 2020 2020 2020 202a 2022 6365 6e74 726f         * "centro
-000246e0: 6964 5f73 6c69 6365 223a 2032 4420 6365  id_slice": 2D ce
-000246f0: 6e74 726f 6964 2064 6973 7461 6e63 6520  ntroid distance 
-00024700: 7665 6374 6f72 206f 6e20 6120 7369 6e67  vector on a sing
-00024710: 6c65 2073 6c69 6365 2e0a 2020 2020 2020  le slice..      
-00024720: 2020 2020 2020 2020 2020 2a20 2263 656e            * "cen
-00024730: 7472 6f69 645f 736c 6963 655f 7374 6174  troid_slice_stat
-00024740: 7322 3a20 7374 6174 6973 7469 6373 2073  s": statistics s
-00024750: 7065 6369 6669 6564 2069 6e0a 2020 2020  pecified in.    
-00024760: 2020 2020 2020 2020 2020 2020 2020 3c73                <s
-00024770: 6c69 6365 5f73 7461 7473 3e20 666f 7220  lice_stats> for 
-00024780: 736c 6963 652d 6279 2d73 6c69 6365 2032  slice-by-slice 2
-00024790: 4420 6365 6e74 726f 6964 2064 6973 7461  D centroid dista
-000247a0: 6e63 6520 7665 6374 6f72 732e 0a20 2020  nce vectors..   
-000247b0: 2020 2020 2020 2020 2020 2020 202a 2022               * "
-000247c0: 6162 735f 6365 6e74 726f 6964 5f73 6c69  abs_centroid_sli
-000247d0: 6365 223a 206d 6167 6e69 7475 6465 206f  ce": magnitude o
-000247e0: 6620 3244 2063 656e 7472 6f69 6420 6469  f 2D centroid di
-000247f0: 7374 616e 6365 200a 2020 2020 2020 2020  stance .        
-00024800: 2020 2020 2020 2020 2020 7665 6374 6f72            vector
-00024810: 206f 6e20 6120 7369 6e67 6c65 2073 6c69   on a single sli
-00024820: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
-00024830: 2020 2020 2a20 2261 6273 5f63 656e 7472      * "abs_centr
-00024840: 6f69 645f 736c 6963 655f 7374 6174 7322  oid_slice_stats"
-00024850: 3a20 7374 6174 6973 7469 6373 2073 7065  : statistics spe
-00024860: 6369 6669 6564 2069 6e0a 2020 2020 2020  cified in.      
-00024870: 2020 2020 2020 2020 2020 2020 3c73 6c69              <sli
-00024880: 6365 5f73 7461 7473 3e20 666f 7220 736c  ce_stats> for sl
-00024890: 6963 652d 6279 2d73 6c69 6365 206d 6167  ice-by-slice mag
-000248a0: 6e69 7475 6465 7320 6f66 2032 440a 2020  nitudes of 2D.  
-000248b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000248c0: 6365 6e74 726f 6964 2064 6973 7461 6e63  centroid distanc
-000248d0: 6520 7665 6374 6f72 732e 0a0a 2020 2020  e vectors...    
-000248e0: 2020 2020 2020 2020 2020 2020 2a20 2276              * "v
-000248f0: 6f6c 756d 655f 6469 6666 223a 2076 6f6c  olume_diff": vol
-00024900: 756d 6520 6469 6666 6572 656e 6365 2028  ume difference (
-00024910: 6f77 6e20 766f 6c75 6d65 202d 206f 7468  own volume - oth
-00024920: 6572 2076 6f6c 756d 6529 2e0a 2020 2020  er volume)..    
-00024930: 2020 2020 2020 2020 2020 2020 2a20 2272              * "r
-00024940: 656c 5f76 6f6c 756d 655f 6469 6666 223a  el_volume_diff":
-00024950: 2076 6f6c 756d 6520 6469 6666 6572 656e   volume differen
-00024960: 6365 2064 6976 6964 6564 2062 7920 6f77  ce divided by ow
-00024970: 6e20 766f 6c75 6d65 2e0a 2020 2020 2020  n volume..      
-00024980: 2020 2020 2020 2020 2020 2a20 2276 6f6c            * "vol
-00024990: 756d 655f 7261 7469 6f22 3a20 766f 6c75  ume_ratio": volu
-000249a0: 6d65 2072 6174 696f 2028 6f77 6e20 766f  me ratio (own vo
-000249b0: 6c75 6d65 202f 206f 7468 6572 2076 6f6c  lume / other vol
-000249c0: 756d 6529 2e0a 0a20 2020 2020 2020 2020  ume)...         
-000249d0: 2020 2020 2020 202a 2022 6172 6561 5f64         * "area_d
-000249e0: 6966 6622 3a20 6172 6561 2064 6966 6665  iff": area diffe
-000249f0: 7265 6e63 6520 286f 776e 2061 7265 6120  rence (own area 
-00024a00: 2d20 6f74 6865 7220 6172 6561 2920 6f6e  - other area) on
-00024a10: 2061 200a 2020 2020 2020 2020 2020 2020   a .            
-00024a20: 2020 2020 2020 7369 6e67 6c65 2073 6c69        single sli
-00024a30: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
-00024a40: 2020 2020 2a20 2272 656c 5f61 7265 615f      * "rel_area_
-00024a50: 6469 6666 223a 2061 7265 6120 6469 6666  diff": area diff
-00024a60: 6572 656e 6365 2064 6976 6964 6564 2062  erence divided b
-00024a70: 7920 6f77 6e20 6172 6561 206f 6e20 6120  y own area on a 
-00024a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024a90: 2020 2073 696e 676c 6520 736c 6963 652e     single slice.
-00024aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024ab0: 202a 2022 6172 6561 5f72 6174 696f 223a   * "area_ratio":
-00024ac0: 2061 7265 6120 7261 7469 6f20 286f 776e   area ratio (own
-00024ad0: 2061 7265 6120 2f20 6f74 6865 7220 6172   area / other ar
-00024ae0: 6561 292e 0a20 2020 2020 2020 2020 2020  ea)..           
-00024af0: 2020 2020 202a 2022 6172 6561 5f64 6966       * "area_dif
-00024b00: 665f 666c 6174 223a 2061 7265 6120 6469  f_flat": area di
-00024b10: 6666 6572 656e 6365 206f 6620 524f 4973  fference of ROIs
-00024b20: 2066 6c61 7474 656e 6564 2069 6e20 7468   flattened in th
-00024b30: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00024b40: 2020 2020 6f72 6965 6e74 6174 696f 6e20      orientation 
-00024b50: 7370 6563 6966 6965 6420 696e 203c 7669  specified in <vi
-00024b60: 6577 3e2e 0a20 2020 2020 2020 2020 2020  ew>..           
-00024b70: 2020 2020 202a 2022 6172 6561 5f64 6966       * "area_dif
-00024b80: 665f 736c 6963 655f 7374 6174 7322 3a20  f_slice_stats": 
-00024b90: 7374 6174 6973 7469 6373 2073 7065 6369  statistics speci
-00024ba0: 6669 6564 2069 6e0a 2020 2020 2020 2020  fied in.        
-00024bb0: 2020 2020 2020 2020 2020 3c73 6c69 6365            <slice
-00024bc0: 5f73 7461 7473 3e20 666f 7220 736c 6963  _stats> for slic
-00024bd0: 652d 6279 2d73 6c69 6365 2061 7265 6120  e-by-slice area 
-00024be0: 6469 6666 6572 656e 6365 732e 0a20 2020  differences..   
-00024bf0: 2020 2020 2020 2020 2020 2020 202a 2022               * "
-00024c00: 7265 6c5f 6172 6561 5f64 6966 665f 666c  rel_area_diff_fl
-00024c10: 6174 223a 2072 656c 6174 6976 6520 6172  at": relative ar
-00024c20: 6561 2064 6966 6665 7265 6e63 6520 6f66  ea difference of
-00024c30: 2052 4f49 730a 2020 2020 2020 2020 2020   ROIs.          
-00024c40: 2020 2020 2020 2020 666c 6174 7465 6e65          flattene
-00024c50: 6420 696e 2074 6865 206f 7269 656e 7461  d in the orienta
-00024c60: 7469 6f6e 2073 7065 6369 6669 6564 2069  tion specified i
-00024c70: 6e20 3c76 6965 773e 2e0a 2020 2020 2020  n <view>..      
-00024c80: 2020 2020 2020 2020 2020 2a20 2272 656c            * "rel
-00024c90: 5f61 7265 615f 6469 6666 5f73 6c69 6365  _area_diff_slice
-00024ca0: 5f73 7461 7473 223a 2073 7461 7469 7374  _stats": statist
-00024cb0: 6963 7320 7370 6563 6966 6965 6420 696e  ics specified in
-00024cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024cd0: 2020 203c 736c 6963 655f 7374 6174 733e     <slice_stats>
-00024ce0: 2066 6f72 2072 656c 6174 6976 6520 6172   for relative ar
-00024cf0: 6561 2064 6966 6665 7265 6e63 6573 206f  ea differences o
-00024d00: 6620 524f 4973 2e0a 2020 2020 2020 2020  f ROIs..        
-00024d10: 2020 2020 2020 2020 2a20 2261 7265 615f          * "area_
-00024d20: 7261 7469 6f5f 666c 6174 223a 2061 7265  ratio_flat": are
-00024d30: 6120 7261 7469 6f20 6f66 2052 4f49 7320  a ratio of ROIs 
-00024d40: 666c 6174 7465 6e65 6420 696e 2074 6865  flattened in the
-00024d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024d60: 2020 206f 7269 656e 7461 7469 6f6e 2073     orientation s
-00024d70: 7065 6369 6669 6564 2069 6e20 3c76 6965  pecified in <vie
-00024d80: 773e 2e0a 2020 2020 2020 2020 2020 2020  w>..            
-00024d90: 2020 2020 2a20 2261 7265 615f 7261 7469      * "area_rati
-00024da0: 6f5f 736c 6963 655f 7374 6174 7322 3a20  o_slice_stats": 
-00024db0: 7374 6174 6973 7469 6373 2073 7065 6369  statistics speci
-00024dc0: 6669 6564 2069 6e0a 2020 2020 2020 2020  fied in.        
-00024dd0: 2020 2020 2020 2020 2020 3c73 6c69 6365            <slice
-00024de0: 5f73 7461 7473 3e20 666f 7220 736c 6963  _stats> for slic
-00024df0: 652d 6279 2d73 6c69 6365 2061 7265 6120  e-by-slice area 
-00024e00: 7261 7469 6f73 2e0a 0a20 2020 2020 2020  ratios...       
-00024e10: 2020 2020 2020 2020 202a 2022 6d65 616e           * "mean
-00024e20: 5f73 6967 6e65 645f 7375 7266 6163 655f  _signed_surface_
-00024e30: 6469 7374 616e 6365 223a 206d 6561 6e20  distance": mean 
-00024e40: 7369 676e 6564 2073 7572 6661 6365 2064  signed surface d
-00024e50: 6973 7461 6e63 652e 0a20 2020 2020 2020  istance..       
-00024e60: 2020 2020 2020 2020 202a 2022 6d65 616e           * "mean
-00024e70: 5f73 6967 6e65 645f 7375 7266 6163 655f  _signed_surface_
-00024e80: 6469 7374 616e 6365 5f66 6c61 7422 3a20  distance_flat": 
-00024e90: 6d65 616e 2073 6967 6e65 6420 7375 7266  mean signed surf
-00024ea0: 6163 650a 2020 2020 2020 2020 2020 2020  ace.            
-00024eb0: 2020 2020 2020 6469 7374 616e 6365 206f        distance o
-00024ec0: 6620 524f 4973 2066 6c61 7474 656e 6564  f ROIs flattened
-00024ed0: 2069 6e20 7468 6520 6f72 6965 6e74 6174   in the orientat
-00024ee0: 696f 6e20 7370 6563 6966 6965 640a 2020  ion specified.  
-00024ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024f00: 696e 203c 7669 6577 3e2e 0a20 2020 2020  in <view>..     
-00024f10: 2020 2020 2020 2020 2020 202a 2022 6d65             * "me
-00024f20: 616e 5f73 7572 6661 6365 5f64 6973 7461  an_surface_dista
-00024f30: 6e63 6522 3a20 6d65 616e 2073 7572 6661  nce": mean surfa
-00024f40: 6365 2064 6973 7461 6e63 652e 0a20 2020  ce distance..   
-00024f50: 2020 2020 2020 2020 2020 2020 202a 2022               * "
-00024f60: 6d65 616e 5f73 7572 6661 6365 5f64 6973  mean_surface_dis
-00024f70: 7461 6e63 655f 666c 6174 223a 206d 6561  tance_flat": mea
-00024f80: 6e20 7375 7266 6163 6520 6469 7374 616e  n surface distan
-00024f90: 6365 206f 6620 524f 4973 0a20 2020 2020  ce of ROIs.     
-00024fa0: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
-00024fb0: 7474 656e 6564 2069 6e20 7468 6520 6f72  ttened in the or
-00024fc0: 6965 6e74 6174 696f 6e20 7370 6563 6966  ientation specif
-00024fd0: 6965 6420 696e 203c 7669 6577 3e2e 0a20  ied in <view>.. 
-00024fe0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00024ff0: 2022 726d 735f 7375 7266 6163 655f 6469   "rms_surface_di
-00025000: 7374 616e 6365 223a 2052 4d53 2073 7572  stance": RMS sur
-00025010: 6661 6365 2064 6973 7461 6e63 652e 0a20  face distance.. 
-00025020: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00025030: 2022 726d 735f 7375 7266 6163 655f 6469   "rms_surface_di
-00025040: 7374 616e 6365 5f66 6c61 7422 3a20 524d  stance_flat": RM
-00025050: 5320 7375 7266 6163 6520 6469 7374 616e  S surface distan
-00025060: 6365 206f 6620 524f 4973 0a20 2020 2020  ce of ROIs.     
-00025070: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
-00025080: 7474 656e 6564 2069 6e20 7468 6520 6f72  ttened in the or
-00025090: 6965 6e74 6174 696f 6e20 7370 6563 6966  ientation specif
-000250a0: 6965 6420 696e 203c 7669 6577 3e2e 0a20  ied in <view>.. 
-000250b0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-000250c0: 2022 726d 735f 7369 676e 6564 5f73 7572   "rms_signed_sur
-000250d0: 6661 6365 5f64 6973 7461 6e63 6522 3a20  face_distance": 
-000250e0: 524d 5320 7369 676e 6564 2073 7572 6661  RMS signed surfa
-000250f0: 6365 2064 6973 7461 6e63 652e 0a20 2020  ce distance..   
-00025100: 2020 2020 2020 2020 2020 2020 202a 2022               * "
-00025110: 726d 735f 7369 676e 6564 5f73 7572 6661  rms_signed_surfa
-00025120: 6365 5f64 6973 7461 6e63 655f 666c 6174  ce_distance_flat
-00025130: 223a 2052 4d53 2073 6967 6e65 6420 7375  ": RMS signed su
-00025140: 7266 6163 650a 2020 2020 2020 2020 2020  rface.          
-00025150: 2020 2020 2020 2020 6469 7374 616e 6365          distance
-00025160: 206f 6620 524f 4973 2066 6c61 7474 656e   of ROIs flatten
-00025170: 6564 2069 6e20 7468 6520 6f72 6965 6e74  ed in the orient
-00025180: 6174 696f 6e20 7370 6563 6966 6965 640a  ation specified.
+00023a30: 6e5f 6469 7374 616e 6365 5f74 6f5f 636f  n_distance_to_co
+00023a40: 6e66 6f72 6d69 7479 203d 204e 6f6e 650a  nformity = None.
+00023a50: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00023a60: 2020 2020 2020 2020 2020 636f 6e66 6f72            confor
+00023a70: 6d69 7479 2e6d 6561 6e5f 756e 6465 725f  mity.mean_under_
+00023a80: 636f 6e74 6f75 7269 6e67 203d 2028 6162  contouring = (ab
+00023a90: 7328 7364 735b 7364 7320 3c20 305d 2e73  s(sds[sds < 0].s
+00023aa0: 756d 2829 290a 2020 2020 2020 2020 2020  um()).          
+00023ab0: 2020 2020 2020 2020 2020 2f20 756e 696f            / unio
+00023ac0: 6e2e 6765 745f 766f 6c75 6d65 2876 6f6c  n.get_volume(vol
+00023ad0: 5f75 6e69 7473 2929 0a20 2020 2020 2020  _units)).       
+00023ae0: 2020 2020 2063 6f6e 666f 726d 6974 792e       conformity.
+00023af0: 6d65 616e 5f6f 7665 725f 636f 6e74 6f75  mean_over_contou
+00023b00: 7269 6e67 203d 2028 7364 735b 7364 7320  ring = (sds[sds 
+00023b10: 3e20 305d 2e73 756d 2829 0a20 2020 2020  > 0].sum().     
+00023b20: 2020 2020 2020 2020 2020 2020 2020 202f                 /
+00023b30: 2075 6e69 6f6e 2e67 6574 5f76 6f6c 756d   union.get_volum
+00023b40: 6528 766f 6c5f 756e 6974 7329 290a 2020  e(vol_units)).  
+00023b50: 2020 2020 2020 2020 2020 636f 6e66 6f72            confor
+00023b60: 6d69 7479 2e6d 6561 6e5f 6469 7374 616e  mity.mean_distan
+00023b70: 6365 5f74 6f5f 636f 6e66 6f72 6d69 7479  ce_to_conformity
+00023b80: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00023b90: 2020 2020 2020 2020 2063 6f6e 666f 726d           conform
+00023ba0: 6974 792e 6d65 616e 5f75 6e64 6572 5f63  ity.mean_under_c
+00023bb0: 6f6e 746f 7572 696e 6720 2b0a 2020 2020  ontouring +.    
+00023bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023bd0: 636f 6e66 6f72 6d69 7479 2e6d 6561 6e5f  conformity.mean_
+00023be0: 6f76 6572 5f63 6f6e 746f 7572 696e 6729  over_contouring)
+00023bf0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00023c00: 2063 6f6e 666f 726d 6974 790a 0a20 2020   conformity..   
+00023c10: 2064 6566 2067 6574 5f73 7572 6661 6365   def get_surface
+00023c20: 5f64 6973 7461 6e63 655f 6d65 7472 6963  _distance_metric
+00023c30: 7328 7365 6c66 2c20 6f74 6865 722c 202a  s(self, other, *
+00023c40: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
+00023c50: 2020 2222 2247 6574 2074 6865 206d 6561    """Get the mea
+00023c60: 6e20 7375 7266 6163 6520 6469 7374 616e  n surface distan
+00023c70: 6365 2c20 524d 5320 7375 7266 6163 6520  ce, RMS surface 
+00023c80: 6469 7374 616e 6365 2c20 616e 6420 4861  distance, and Ha
+00023c90: 7573 646f 7266 660a 2020 2020 2020 2020  usdorff.        
+00023ca0: 6469 7374 616e 6365 2e22 2222 0a0a 2020  distance."""..  
+00023cb0: 2020 2020 2020 7364 7320 3d20 7365 6c66        sds = self
+00023cc0: 2e67 6574 5f73 7572 6661 6365 5f64 6973  .get_surface_dis
+00023cd0: 7461 6e63 6573 286f 7468 6572 2c20 2a2a  tances(other, **
+00023ce0: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+00023cf0: 6966 2073 6473 2069 7320 4e6f 6e65 3a0a  if sds is None:.
+00023d00: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00023d10: 726e 0a20 2020 2020 2020 2072 6574 7572  rn.        retur
+00023d20: 6e20 7364 732e 6d65 616e 2829 2c20 6e70  n sds.mean(), np
+00023d30: 2e73 7172 7428 2873 6473 202a 2a20 3229  .sqrt((sds ** 2)
+00023d40: 2e6d 6561 6e28 2929 2c20 7364 732e 6d61  .mean()), sds.ma
+00023d50: 7828 290a 0a20 2020 2064 6566 2070 6c6f  x()..    def plo
+00023d60: 745f 7375 7266 6163 655f 6469 7374 616e  t_surface_distan
+00023d70: 6365 7328 7365 6c66 2c20 6f74 6865 722c  ces(self, other,
+00023d80: 2073 6176 655f 6173 3d4e 6f6e 652c 2073   save_as=None, s
+00023d90: 6967 6e65 643d 4661 6c73 652c 202a 2a6b  igned=False, **k
+00023da0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+00023db0: 2222 2250 6c6f 7420 6869 7374 6f67 7261  """Plot histogra
+00023dc0: 6d20 6f66 2073 7572 6661 6365 2064 6973  m of surface dis
+00023dd0: 7461 6e63 6573 2e22 2222 0a0a 2020 2020  tances."""..    
+00023de0: 2020 2020 7364 7320 3d20 7365 6c66 2e67      sds = self.g
+00023df0: 6574 5f73 7572 6661 6365 5f64 6973 7461  et_surface_dista
+00023e00: 6e63 6573 286f 7468 6572 2c20 7369 676e  nces(other, sign
+00023e10: 6564 3d73 6967 6e65 642c 202a 2a6b 7761  ed=signed, **kwa
+00023e20: 7267 7329 0a20 2020 2020 2020 2069 6620  rgs).        if 
+00023e30: 7364 7320 6973 204e 6f6e 653a 0a20 2020  sds is None:.   
+00023e40: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00023e50: 2020 2020 2020 2020 6669 672c 2061 7820          fig, ax 
+00023e60: 3d20 706c 742e 7375 6270 6c6f 7473 2829  = plt.subplots()
+00023e70: 0a20 2020 2020 2020 2061 782e 6869 7374  .        ax.hist
+00023e80: 2873 6473 290a 2020 2020 2020 2020 786c  (sds).        xl
+00023e90: 6162 656c 203d 2028 0a20 2020 2020 2020  abel = (.       
+00023ea0: 2020 2020 2022 5375 7266 6163 6520 6469       "Surface di
+00023eb0: 7374 616e 6365 2028 6d6d 2922 2069 6620  stance (mm)" if 
+00023ec0: 6e6f 7420 7369 676e 6564 2065 6c73 6520  not signed else 
+00023ed0: 2253 6967 6e65 6420 7375 7266 6163 6520  "Signed surface 
+00023ee0: 6469 7374 616e 6365 2028 6d6d 2922 0a20  distance (mm)". 
+00023ef0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00023f00: 2061 782e 7365 745f 786c 6162 656c 2878   ax.set_xlabel(x
+00023f10: 6c61 6265 6c29 0a20 2020 2020 2020 2061  label).        a
+00023f20: 782e 7365 745f 796c 6162 656c 2822 4e75  x.set_ylabel("Nu
+00023f30: 6d62 6572 206f 6620 766f 7865 6c73 2229  mber of voxels")
+00023f40: 0a20 2020 2020 2020 2069 6620 7361 7665  .        if save
+00023f50: 5f61 733a 0a20 2020 2020 2020 2020 2020  _as:.           
+00023f60: 2070 6c74 2e74 6967 6874 5f6c 6179 6f75   plt.tight_layou
+00023f70: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+00023f80: 6669 672e 7361 7665 6669 6728 7361 7665  fig.savefig(save
+00023f90: 5f61 7329 0a0a 2020 2020 6465 6620 6765  _as)..    def ge
+00023fa0: 745f 636f 6d70 6172 6973 6f6e 280a 2020  t_comparison(.  
+00023fb0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00023fc0: 2020 2020 726f 692c 0a20 2020 2020 2020      roi,.       
+00023fd0: 206d 6574 7269 6373 3d4e 6f6e 652c 0a20   metrics=None,. 
+00023fe0: 2020 2020 2020 2076 6f6c 5f75 6e69 7473         vol_units
+00023ff0: 3d22 6d6d 222c 0a20 2020 2020 2020 2061  ="mm",.        a
+00024000: 7265 615f 756e 6974 733d 226d 6d22 2c0a  rea_units="mm",.
+00024010: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+00024020: 5f75 6e69 7473 3d22 6d6d 222c 0a20 2020  _units="mm",.   
+00024030: 2020 2020 2076 6965 773d 2278 2d79 222c       view="x-y",
+00024040: 0a20 2020 2020 2020 2073 6c3d 4e6f 6e65  .        sl=None
+00024050: 2c0a 2020 2020 2020 2020 706f 733d 4e6f  ,.        pos=No
+00024060: 6e65 2c0a 2020 2020 2020 2020 6964 783d  ne,.        idx=
+00024070: 4e6f 6e65 2c0a 2020 2020 2020 2020 6d65  None,.        me
+00024080: 7468 6f64 3d4e 6f6e 652c 0a20 2020 2020  thod=None,.     
+00024090: 2020 2073 6c69 6365 5f73 7461 7473 3d4e     slice_stats=N
+000240a0: 6f6e 652c 0a20 2020 2020 2020 2064 6566  one,.        def
+000240b0: 6175 6c74 5f62 795f 736c 6963 653d 4e6f  ault_by_slice=No
+000240c0: 6e65 2c0a 2020 2020 2020 2020 756e 6974  ne,.        unit
+000240d0: 735f 696e 5f68 6561 6465 723d 4661 6c73  s_in_header=Fals
+000240e0: 652c 0a20 2020 2020 2020 2067 6c6f 6261  e,.        globa
+000240f0: 6c5f 7673 5f73 6c69 6365 5f68 6561 6465  l_vs_slice_heade
+00024100: 723d 4661 6c73 652c 0a20 2020 2020 2020  r=False,.       
+00024110: 206e 616d 655f 6173 5f69 6e64 6578 3d54   name_as_index=T
+00024120: 7275 652c 0a20 2020 2020 2020 206e 6963  rue,.        nic
+00024130: 655f 636f 6c75 6d6e 733d 4661 6c73 652c  e_columns=False,
+00024140: 0a20 2020 2020 2020 2064 6563 696d 616c  .        decimal
+00024150: 5f70 6c61 6365 733d 4e6f 6e65 2c0a 2020  _places=None,.  
+00024160: 2020 2020 2020 666f 7263 653d 5472 7565        force=True
+00024170: 2c0a 2020 2020 2020 2020 766f 7865 6c5f  ,.        voxel_
+00024180: 7369 7a65 3d28 312c 2031 2c20 3129 2c0a  size=(1, 1, 1),.
+00024190: 2020 2020 2020 2020 6d61 7463 685f 6c65          match_le
+000241a0: 6e67 7468 733d 4661 6c73 652c 0a20 2020  ngths=False,.   
+000241b0: 2020 2020 206d 6174 6368 5f6c 656e 6774       match_lengt
+000241c0: 6873 5f73 7472 6174 6567 793d 310a 2020  hs_strategy=1.  
+000241d0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+000241e0: 5265 7475 726e 2061 2070 616e 6461 7320  Return a pandas 
+000241f0: 4461 7461 4672 616d 6520 6f66 2074 6865  DataFrame of the
+00024200: 2063 6f6d 7061 7269 736f 6e20 6d65 7472   comparison metr
+00024210: 6963 7320 6c69 7374 6564 2069 6e20 0a20  ics listed in . 
+00024220: 2020 2020 2020 203c 6d65 7472 6963 733e         <metrics>
+00024230: 2077 6974 6820 7265 7370 6563 7420 746f   with respect to
+00024240: 2061 6e6f 7468 6572 2052 4f49 2e0a 0a20   another ROI... 
+00024250: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
+00024260: 6572 733a 2a2a 0a20 2020 2020 2020 200a  ers:**.        .
+00024270: 2020 2020 2020 2020 726f 6920 3a20 524f          roi : RO
+00024280: 490a 2020 2020 2020 2020 2020 2020 4f74  I.            Ot
+00024290: 6865 7220 524f 4920 7769 7468 2077 6869  her ROI with whi
+000242a0: 6368 2074 6f20 636f 6d70 6172 6520 7468  ch to compare th
+000242b0: 6973 2052 4f49 2e0a 0a20 2020 2020 2020  is ROI...       
+000242c0: 206d 6574 7269 6373 203a 206c 6973 742c   metrics : list,
+000242d0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+000242e0: 2020 2020 2020 2020 2020 4c69 7374 206f            List o
+000242f0: 6620 6d65 7472 6963 7320 746f 2069 6e63  f metrics to inc
+00024300: 6c75 6465 2069 6e20 7468 6520 7461 626c  lude in the tabl
+00024310: 652e 204f 7074 696f 6e73 3a0a 0a20 2020  e. Options:..   
+00024320: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+00024330: 6469 6365 2220 3a20 676c 6f62 616c 2044  dice" : global D
+00024340: 6963 6520 7363 6f72 652e 0a20 2020 2020  ice score..     
+00024350: 2020 2020 2020 2020 2020 202a 2022 6469             * "di
+00024360: 6365 5f66 6c61 7422 3a20 4469 6365 2073  ce_flat": Dice s
+00024370: 636f 7265 206f 6620 524f 4973 2066 6c61  core of ROIs fla
+00024380: 7474 656e 6564 2069 6e20 7468 6520 6f72  ttened in the or
+00024390: 6965 6e74 6174 696f 6e0a 2020 2020 2020  ientation.      
+000243a0: 2020 2020 2020 2020 2020 2020 7370 6563              spec
+000243b0: 6966 6965 6420 696e 203c 7669 6577 3e2e  ified in <view>.
+000243c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000243d0: 202a 2022 6469 6365 5f73 6c69 6365 223a   * "dice_slice":
+000243e0: 2044 6963 6520 7363 6f72 6520 6f6e 2061   Dice score on a
+000243f0: 2073 696e 676c 6520 736c 6963 652e 0a20   single slice.. 
+00024400: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00024410: 2022 6469 6365 5f73 6c69 6365 5f73 7461   "dice_slice_sta
+00024420: 7473 223a 2073 7461 7469 7374 6963 7320  ts": statistics 
+00024430: 7370 6563 6966 6965 6420 696e 203c 736c  specified in <sl
+00024440: 6963 655f 7374 6174 733e 0a20 2020 2020  ice_stats>.     
+00024450: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00024460: 2073 6c69 6365 2d62 792d 736c 6963 6520   slice-by-slice 
+00024470: 4469 6365 2073 636f 7265 732e 0a0a 2020  Dice scores...  
+00024480: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
+00024490: 226a 6163 6361 7264 2220 3a20 676c 6f62  "jaccard" : glob
+000244a0: 616c 204a 6163 6361 7264 2069 6e64 6578  al Jaccard index
+000244b0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000244c0: 2020 2a20 226a 6163 6361 7264 5f66 6c61    * "jaccard_fla
+000244d0: 7422 3a20 4a61 6363 6172 6420 696e 6465  t": Jaccard inde
+000244e0: 7820 6f66 2052 4f49 7320 666c 6174 7465  x of ROIs flatte
+000244f0: 6e65 6420 696e 0a20 2020 2020 2020 2020  ned in.         
+00024500: 2020 2020 2020 2020 2074 6865 206f 7269           the ori
+00024510: 656e 7461 7469 6f6e 2073 7065 6369 6669  entation specifi
+00024520: 6564 2069 6e20 3c76 6965 773e 2e0a 2020  ed in <view>..  
+00024530: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
+00024540: 226a 6163 6361 7264 5f73 6c69 6365 223a  "jaccard_slice":
+00024550: 204a 6163 6361 7264 2069 6e64 6578 206f   Jaccard index o
+00024560: 6e20 6120 7369 6e67 6c65 2073 6c69 6365  n a single slice
+00024570: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00024580: 2020 2a20 226a 6163 6361 7264 5f73 6c69    * "jaccard_sli
+00024590: 6365 5f73 7461 7473 223a 2073 7461 7469  ce_stats": stati
+000245a0: 7374 6963 7320 7370 6563 6966 6965 6420  stics specified 
+000245b0: 696e 203c 736c 6963 655f 7374 6174 733e  in <slice_stats>
+000245c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000245d0: 2020 2066 6f72 2073 6c69 6365 2d62 792d     for slice-by-
+000245e0: 736c 6963 6520 4a61 6363 6172 6420 696e  slice Jaccard in
+000245f0: 6469 6365 732e 0a0a 2020 2020 2020 2020  dices...        
+00024600: 2020 2020 2020 2020 2a20 2263 656e 7472          * "centr
+00024610: 6f69 6422 3a20 3344 2063 656e 7472 6f69  oid": 3D centroi
+00024620: 6420 6469 7374 616e 6365 2076 6563 746f  d distance vecto
+00024630: 722e 0a20 2020 2020 2020 2020 2020 2020  r..             
+00024640: 2020 202a 2022 6162 735f 6365 6e74 726f     * "abs_centro
+00024650: 6964 223a 206d 6167 6e69 7475 6465 206f  id": magnitude o
+00024660: 6620 3344 2063 656e 7472 6f69 6420 6469  f 3D centroid di
+00024670: 7374 616e 6365 2076 6563 746f 722e 0a20  stance vector.. 
+00024680: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00024690: 2022 6162 735f 6365 6e74 726f 6964 5f66   "abs_centroid_f
+000246a0: 6c61 7422 3a20 6d61 676e 6974 7564 6520  lat": magnitude 
+000246b0: 6f66 2033 4420 6365 6e74 726f 6964 2064  of 3D centroid d
+000246c0: 6973 7461 6e63 6520 7665 6374 6f72 0a20  istance vector. 
+000246d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000246e0: 2070 726f 6a65 6374 6564 2069 6e74 6f20   projected into 
+000246f0: 7468 6520 706c 616e 6520 7370 6563 6966  the plane specif
+00024700: 6965 6420 696e 203c 7669 6577 3e2e 0a20  ied in <view>.. 
+00024710: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00024720: 2022 6365 6e74 726f 6964 5f73 6c69 6365   "centroid_slice
+00024730: 223a 2032 4420 6365 6e74 726f 6964 2064  ": 2D centroid d
+00024740: 6973 7461 6e63 6520 7665 6374 6f72 206f  istance vector o
+00024750: 6e20 6120 7369 6e67 6c65 2073 6c69 6365  n a single slice
+00024760: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00024770: 2020 2a20 2263 656e 7472 6f69 645f 736c    * "centroid_sl
+00024780: 6963 655f 7374 6174 7322 3a20 7374 6174  ice_stats": stat
+00024790: 6973 7469 6373 2073 7065 6369 6669 6564  istics specified
+000247a0: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
+000247b0: 2020 2020 2020 3c73 6c69 6365 5f73 7461        <slice_sta
+000247c0: 7473 3e20 666f 7220 736c 6963 652d 6279  ts> for slice-by
+000247d0: 2d73 6c69 6365 2032 4420 6365 6e74 726f  -slice 2D centro
+000247e0: 6964 2064 6973 7461 6e63 6520 7665 6374  id distance vect
+000247f0: 6f72 732e 0a20 2020 2020 2020 2020 2020  ors..           
+00024800: 2020 2020 202a 2022 6162 735f 6365 6e74       * "abs_cent
+00024810: 726f 6964 5f73 6c69 6365 223a 206d 6167  roid_slice": mag
+00024820: 6e69 7475 6465 206f 6620 3244 2063 656e  nitude of 2D cen
+00024830: 7472 6f69 6420 6469 7374 616e 6365 200a  troid distance .
+00024840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024850: 2020 7665 6374 6f72 206f 6e20 6120 7369    vector on a si
+00024860: 6e67 6c65 2073 6c69 6365 2e0a 2020 2020  ngle slice..    
+00024870: 2020 2020 2020 2020 2020 2020 2a20 2261              * "a
+00024880: 6273 5f63 656e 7472 6f69 645f 736c 6963  bs_centroid_slic
+00024890: 655f 7374 6174 7322 3a20 7374 6174 6973  e_stats": statis
+000248a0: 7469 6373 2073 7065 6369 6669 6564 2069  tics specified i
+000248b0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+000248c0: 2020 2020 3c73 6c69 6365 5f73 7461 7473      <slice_stats
+000248d0: 3e20 666f 7220 736c 6963 652d 6279 2d73  > for slice-by-s
+000248e0: 6c69 6365 206d 6167 6e69 7475 6465 7320  lice magnitudes 
+000248f0: 6f66 2032 440a 2020 2020 2020 2020 2020  of 2D.          
+00024900: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+00024910: 2064 6973 7461 6e63 6520 7665 6374 6f72   distance vector
+00024920: 732e 0a0a 2020 2020 2020 2020 2020 2020  s...            
+00024930: 2020 2020 2a20 2276 6f6c 756d 655f 6469      * "volume_di
+00024940: 6666 223a 2076 6f6c 756d 6520 6469 6666  ff": volume diff
+00024950: 6572 656e 6365 2028 6f77 6e20 766f 6c75  erence (own volu
+00024960: 6d65 202d 206f 7468 6572 2076 6f6c 756d  me - other volum
+00024970: 6529 2e0a 2020 2020 2020 2020 2020 2020  e)..            
+00024980: 2020 2020 2a20 2272 656c 5f76 6f6c 756d      * "rel_volum
+00024990: 655f 6469 6666 223a 2076 6f6c 756d 6520  e_diff": volume 
+000249a0: 6469 6666 6572 656e 6365 2064 6976 6964  difference divid
+000249b0: 6564 2062 7920 6f77 6e20 766f 6c75 6d65  ed by own volume
+000249c0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000249d0: 2020 2a20 2276 6f6c 756d 655f 7261 7469    * "volume_rati
+000249e0: 6f22 3a20 766f 6c75 6d65 2072 6174 696f  o": volume ratio
+000249f0: 2028 6f77 6e20 766f 6c75 6d65 202f 206f   (own volume / o
+00024a00: 7468 6572 2076 6f6c 756d 6529 2e0a 0a20  ther volume)... 
+00024a10: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00024a20: 2022 6172 6561 5f64 6966 6622 3a20 6172   "area_diff": ar
+00024a30: 6561 2064 6966 6665 7265 6e63 6520 286f  ea difference (o
+00024a40: 776e 2061 7265 6120 2d20 6f74 6865 7220  wn area - other 
+00024a50: 6172 6561 2920 6f6e 2061 200a 2020 2020  area) on a .    
+00024a60: 2020 2020 2020 2020 2020 2020 2020 7369                si
+00024a70: 6e67 6c65 2073 6c69 6365 2e0a 2020 2020  ngle slice..    
+00024a80: 2020 2020 2020 2020 2020 2020 2a20 2272              * "r
+00024a90: 656c 5f61 7265 615f 6469 6666 223a 2061  el_area_diff": a
+00024aa0: 7265 6120 6469 6666 6572 656e 6365 2064  rea difference d
+00024ab0: 6976 6964 6564 2062 7920 6f77 6e20 6172  ivided by own ar
+00024ac0: 6561 206f 6e20 6120 0a20 2020 2020 2020  ea on a .       
+00024ad0: 2020 2020 2020 2020 2020 2073 696e 676c             singl
+00024ae0: 6520 736c 6963 652e 0a20 2020 2020 2020  e slice..       
+00024af0: 2020 2020 2020 2020 202a 2022 6172 6561           * "area
+00024b00: 5f72 6174 696f 223a 2061 7265 6120 7261  _ratio": area ra
+00024b10: 7469 6f20 286f 776e 2061 7265 6120 2f20  tio (own area / 
+00024b20: 6f74 6865 7220 6172 6561 292e 0a20 2020  other area)..   
+00024b30: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+00024b40: 6172 6561 5f64 6966 665f 666c 6174 223a  area_diff_flat":
+00024b50: 2061 7265 6120 6469 6666 6572 656e 6365   area difference
+00024b60: 206f 6620 524f 4973 2066 6c61 7474 656e   of ROIs flatten
+00024b70: 6564 2069 6e20 7468 650a 2020 2020 2020  ed in the.      
+00024b80: 2020 2020 2020 2020 2020 2020 6f72 6965              orie
+00024b90: 6e74 6174 696f 6e20 7370 6563 6966 6965  ntation specifie
+00024ba0: 6420 696e 203c 7669 6577 3e2e 0a20 2020  d in <view>..   
+00024bb0: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+00024bc0: 6172 6561 5f64 6966 665f 736c 6963 655f  area_diff_slice_
+00024bd0: 7374 6174 7322 3a20 7374 6174 6973 7469  stats": statisti
+00024be0: 6373 2073 7065 6369 6669 6564 2069 6e0a  cs specified in.
+00024bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024c00: 2020 3c73 6c69 6365 5f73 7461 7473 3e20    <slice_stats> 
+00024c10: 666f 7220 736c 6963 652d 6279 2d73 6c69  for slice-by-sli
+00024c20: 6365 2061 7265 6120 6469 6666 6572 656e  ce area differen
+00024c30: 6365 732e 0a20 2020 2020 2020 2020 2020  ces..           
+00024c40: 2020 2020 202a 2022 7265 6c5f 6172 6561       * "rel_area
+00024c50: 5f64 6966 665f 666c 6174 223a 2072 656c  _diff_flat": rel
+00024c60: 6174 6976 6520 6172 6561 2064 6966 6665  ative area diffe
+00024c70: 7265 6e63 6520 6f66 2052 4f49 730a 2020  rence of ROIs.  
+00024c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024c90: 666c 6174 7465 6e65 6420 696e 2074 6865  flattened in the
+00024ca0: 206f 7269 656e 7461 7469 6f6e 2073 7065   orientation spe
+00024cb0: 6369 6669 6564 2069 6e20 3c76 6965 773e  cified in <view>
+00024cc0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00024cd0: 2020 2a20 2272 656c 5f61 7265 615f 6469    * "rel_area_di
+00024ce0: 6666 5f73 6c69 6365 5f73 7461 7473 223a  ff_slice_stats":
+00024cf0: 2073 7461 7469 7374 6963 7320 7370 6563   statistics spec
+00024d00: 6966 6965 6420 696e 0a20 2020 2020 2020  ified in.       
+00024d10: 2020 2020 2020 2020 2020 203c 736c 6963             <slic
+00024d20: 655f 7374 6174 733e 2066 6f72 2072 656c  e_stats> for rel
+00024d30: 6174 6976 6520 6172 6561 2064 6966 6665  ative area diffe
+00024d40: 7265 6e63 6573 206f 6620 524f 4973 2e0a  rences of ROIs..
+00024d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024d60: 2a20 2261 7265 615f 7261 7469 6f5f 666c  * "area_ratio_fl
+00024d70: 6174 223a 2061 7265 6120 7261 7469 6f20  at": area ratio 
+00024d80: 6f66 2052 4f49 7320 666c 6174 7465 6e65  of ROIs flattene
+00024d90: 6420 696e 2074 6865 0a20 2020 2020 2020  d in the.       
+00024da0: 2020 2020 2020 2020 2020 206f 7269 656e             orien
+00024db0: 7461 7469 6f6e 2073 7065 6369 6669 6564  tation specified
+00024dc0: 2069 6e20 3c76 6965 773e 2e0a 2020 2020   in <view>..    
+00024dd0: 2020 2020 2020 2020 2020 2020 2a20 2261              * "a
+00024de0: 7265 615f 7261 7469 6f5f 736c 6963 655f  rea_ratio_slice_
+00024df0: 7374 6174 7322 3a20 7374 6174 6973 7469  stats": statisti
+00024e00: 6373 2073 7065 6369 6669 6564 2069 6e0a  cs specified in.
+00024e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024e20: 2020 3c73 6c69 6365 5f73 7461 7473 3e20    <slice_stats> 
+00024e30: 666f 7220 736c 6963 652d 6279 2d73 6c69  for slice-by-sli
+00024e40: 6365 2061 7265 6120 7261 7469 6f73 2e0a  ce area ratios..
+00024e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024e60: 202a 2022 6d65 616e 5f73 6967 6e65 645f   * "mean_signed_
+00024e70: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
+00024e80: 223a 206d 6561 6e20 7369 676e 6564 2073  ": mean signed s
+00024e90: 7572 6661 6365 2064 6973 7461 6e63 652e  urface distance.
+00024ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024eb0: 202a 2022 6d65 616e 5f73 6967 6e65 645f   * "mean_signed_
+00024ec0: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
+00024ed0: 5f66 6c61 7422 3a20 6d65 616e 2073 6967  _flat": mean sig
+00024ee0: 6e65 6420 7375 7266 6163 650a 2020 2020  ned surface.    
+00024ef0: 2020 2020 2020 2020 2020 2020 2020 6469                di
+00024f00: 7374 616e 6365 206f 6620 524f 4973 2066  stance of ROIs f
+00024f10: 6c61 7474 656e 6564 2069 6e20 7468 6520  lattened in the 
+00024f20: 6f72 6965 6e74 6174 696f 6e20 7370 6563  orientation spec
+00024f30: 6966 6965 640a 2020 2020 2020 2020 2020  ified.          
+00024f40: 2020 2020 2020 2020 696e 203c 7669 6577          in <view
+00024f50: 3e2e 0a20 2020 2020 2020 2020 2020 2020  >..             
+00024f60: 2020 202a 2022 6d65 616e 5f73 7572 6661     * "mean_surfa
+00024f70: 6365 5f64 6973 7461 6e63 6522 3a20 6d65  ce_distance": me
+00024f80: 616e 2073 7572 6661 6365 2064 6973 7461  an surface dista
+00024f90: 6e63 652e 0a20 2020 2020 2020 2020 2020  nce..           
+00024fa0: 2020 2020 202a 2022 6d65 616e 5f73 7572       * "mean_sur
+00024fb0: 6661 6365 5f64 6973 7461 6e63 655f 666c  face_distance_fl
+00024fc0: 6174 223a 206d 6561 6e20 7375 7266 6163  at": mean surfac
+00024fd0: 6520 6469 7374 616e 6365 206f 6620 524f  e distance of RO
+00024fe0: 4973 0a20 2020 2020 2020 2020 2020 2020  Is.             
+00024ff0: 2020 2020 2066 6c61 7474 656e 6564 2069       flattened i
+00025000: 6e20 7468 6520 6f72 6965 6e74 6174 696f  n the orientatio
+00025010: 6e20 7370 6563 6966 6965 6420 696e 203c  n specified in <
+00025020: 7669 6577 3e2e 0a20 2020 2020 2020 2020  view>..         
+00025030: 2020 2020 2020 202a 2022 726d 735f 7375         * "rms_su
+00025040: 7266 6163 655f 6469 7374 616e 6365 223a  rface_distance":
+00025050: 2052 4d53 2073 7572 6661 6365 2064 6973   RMS surface dis
+00025060: 7461 6e63 652e 0a20 2020 2020 2020 2020  tance..         
+00025070: 2020 2020 2020 202a 2022 726d 735f 7375         * "rms_su
+00025080: 7266 6163 655f 6469 7374 616e 6365 5f66  rface_distance_f
+00025090: 6c61 7422 3a20 524d 5320 7375 7266 6163  lat": RMS surfac
+000250a0: 6520 6469 7374 616e 6365 206f 6620 524f  e distance of RO
+000250b0: 4973 0a20 2020 2020 2020 2020 2020 2020  Is.             
+000250c0: 2020 2020 2066 6c61 7474 656e 6564 2069       flattened i
+000250d0: 6e20 7468 6520 6f72 6965 6e74 6174 696f  n the orientatio
+000250e0: 6e20 7370 6563 6966 6965 6420 696e 203c  n specified in <
+000250f0: 7669 6577 3e2e 0a20 2020 2020 2020 2020  view>..         
+00025100: 2020 2020 2020 202a 2022 726d 735f 7369         * "rms_si
+00025110: 676e 6564 5f73 7572 6661 6365 5f64 6973  gned_surface_dis
+00025120: 7461 6e63 6522 3a20 524d 5320 7369 676e  tance": RMS sign
+00025130: 6564 2073 7572 6661 6365 2064 6973 7461  ed surface dista
+00025140: 6e63 652e 0a20 2020 2020 2020 2020 2020  nce..           
+00025150: 2020 2020 202a 2022 726d 735f 7369 676e       * "rms_sign
+00025160: 6564 5f73 7572 6661 6365 5f64 6973 7461  ed_surface_dista
+00025170: 6e63 655f 666c 6174 223a 2052 4d53 2073  nce_flat": RMS s
+00025180: 6967 6e65 6420 7375 7266 6163 650a 2020  igned surface.  
 00025190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000251a0: 2020 696e 203c 7669 6577 3e2e 0a20 2020    in <view>..   
-000251b0: 2020 2020 2020 2020 2020 2020 202a 2022               * "
-000251c0: 6861 7573 646f 7266 665f 6469 7374 616e  hausdorff_distan
-000251d0: 6365 223a 2048 6175 7364 6f72 6666 2064  ce": Hausdorff d
-000251e0: 6973 7461 6e63 652e 0a20 2020 2020 2020  istance..       
-000251f0: 2020 2020 2020 2020 202a 2022 6861 7573           * "haus
-00025200: 646f 7266 665f 6469 7374 616e 6365 5f66  dorff_distance_f
-00025210: 6c61 7422 3a20 4861 7573 646f 7266 6620  lat": Hausdorff 
-00025220: 6469 7374 616e 6365 206f 6620 524f 4973  distance of ROIs
+000251a0: 6469 7374 616e 6365 206f 6620 524f 4973  distance of ROIs
+000251b0: 2066 6c61 7474 656e 6564 2069 6e20 7468   flattened in th
+000251c0: 6520 6f72 6965 6e74 6174 696f 6e20 7370  e orientation sp
+000251d0: 6563 6966 6965 640a 2020 2020 2020 2020  ecified.        
+000251e0: 2020 2020 2020 2020 2020 696e 203c 7669            in <vi
+000251f0: 6577 3e2e 0a20 2020 2020 2020 2020 2020  ew>..           
+00025200: 2020 2020 202a 2022 6861 7573 646f 7266       * "hausdorf
+00025210: 665f 6469 7374 616e 6365 223a 2048 6175  f_distance": Hau
+00025220: 7364 6f72 6666 2064 6973 7461 6e63 652e  sdorff distance.
 00025230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025240: 2020 2066 6c61 7474 656e 6564 2069 6e20     flattened in 
-00025250: 7468 6520 6f72 6965 6e74 6174 696f 6e20  the orientation 
-00025260: 7370 6563 6966 6965 6420 696e 203c 7669  specified in <vi
-00025270: 6577 3e2e 0a20 2020 2020 2020 2020 2020  ew>..           
-00025280: 2020 2020 202a 2022 6d65 616e 5f75 6e64       * "mean_und
-00025290: 6572 5f63 6f6e 746f 7572 696e 6722 3a20  er_contouring": 
-000252a0: 5375 6d20 6f66 2061 6273 6f6c 7574 6520  Sum of absolute 
-000252b0: 7661 6c75 6573 206f 660a 2020 2020 2020  values of.      
-000252c0: 2020 2020 2020 2020 2020 2020 6e65 6761              nega
-000252d0: 7469 7665 2064 6973 7461 6e63 6573 2074  tive distances t
-000252e0: 6f20 636f 6e66 6f72 6d69 7479 2c20 6469  o conformity, di
-000252f0: 7669 6465 6420 6279 2076 6f6c 756d 650a  vided by volume.
-00025300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025310: 2020 696e 2075 6e69 6f6e 206f 6620 524f    in union of RO
-00025320: 4973 2063 6f6d 7061 7265 642e 0a20 2020  Is compared..   
-00025330: 2020 2020 2020 2020 2020 2020 202a 2022               * "
-00025340: 6d65 616e 5f75 6e64 6572 5f63 6f6e 746f  mean_under_conto
-00025350: 7572 696e 675f 666c 6174 223a 2053 756d  uring_flat": Sum
-00025360: 206f 6620 6162 736f 6c75 7465 2076 616c   of absolute val
-00025370: 7565 7320 6f66 0a20 2020 2020 2020 2020  ues of.         
-00025380: 2020 2020 2020 2020 206e 6567 6174 6976           negativ
-00025390: 6520 6469 7374 616e 6365 7320 746f 2063  e distances to c
-000253a0: 6f6e 666f 726d 6974 792c 2064 6976 6964  onformity, divid
-000253b0: 6564 2062 7920 766f 6c75 6d65 2c0a 2020  ed by volume,.  
+00025240: 202a 2022 6861 7573 646f 7266 665f 6469   * "hausdorff_di
+00025250: 7374 616e 6365 5f66 6c61 7422 3a20 4861  stance_flat": Ha
+00025260: 7573 646f 7266 6620 6469 7374 616e 6365  usdorff distance
+00025270: 206f 6620 524f 4973 0a20 2020 2020 2020   of ROIs.       
+00025280: 2020 2020 2020 2020 2020 2066 6c61 7474             flatt
+00025290: 656e 6564 2069 6e20 7468 6520 6f72 6965  ened in the orie
+000252a0: 6e74 6174 696f 6e20 7370 6563 6966 6965  ntation specifie
+000252b0: 6420 696e 203c 7669 6577 3e2e 0a20 2020  d in <view>..   
+000252c0: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+000252d0: 6d65 616e 5f75 6e64 6572 5f63 6f6e 746f  mean_under_conto
+000252e0: 7572 696e 6722 3a20 5375 6d20 6f66 2061  uring": Sum of a
+000252f0: 6273 6f6c 7574 6520 7661 6c75 6573 206f  bsolute values o
+00025300: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
+00025310: 2020 2020 6e65 6761 7469 7665 2064 6973      negative dis
+00025320: 7461 6e63 6573 2074 6f20 636f 6e66 6f72  tances to confor
+00025330: 6d69 7479 2c20 6469 7669 6465 6420 6279  mity, divided by
+00025340: 2076 6f6c 756d 650a 2020 2020 2020 2020   volume.        
+00025350: 2020 2020 2020 2020 2020 696e 2075 6e69            in uni
+00025360: 6f6e 206f 6620 524f 4973 2063 6f6d 7061  on of ROIs compa
+00025370: 7265 642e 0a20 2020 2020 2020 2020 2020  red..           
+00025380: 2020 2020 202a 2022 6d65 616e 5f75 6e64       * "mean_und
+00025390: 6572 5f63 6f6e 746f 7572 696e 675f 666c  er_contouring_fl
+000253a0: 6174 223a 2053 756d 206f 6620 6162 736f  at": Sum of abso
+000253b0: 6c75 7465 2076 616c 7565 7320 6f66 0a20  lute values of. 
 000253c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000253d0: 666c 6174 7465 6e65 6420 696e 2074 6865  flattened in the
-000253e0: 206f 7269 656e 7461 7469 6f6e 2073 7065   orientation spe
-000253f0: 6369 6669 6564 2069 6e20 3c76 6965 773e  cified in <view>
-00025400: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00025410: 2020 2020 696e 2075 6e69 6f6e 206f 6620      in union of 
-00025420: 524f 4973 2063 6f6d 7061 7265 642e 0a20  ROIs compared.. 
-00025430: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00025440: 2022 6d65 616e 5f6f 7665 725f 636f 6e74   "mean_over_cont
-00025450: 6f75 7269 6e67 223a 2053 756d 206f 6620  ouring": Sum of 
-00025460: 706f 7369 7469 7665 2064 6973 7461 6e63  positive distanc
-00025470: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-00025480: 2020 2020 2074 6f20 636f 6e66 6f72 6d69       to conformi
-00025490: 7479 2c20 6469 7669 6465 6420 6279 2076  ty, divided by v
-000254a0: 6f6c 756d 6520 696e 2075 6e69 6f6e 206f  olume in union o
-000254b0: 6620 524f 4973 2063 6f6d 7061 7265 642e  f ROIs compared.
-000254c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000254d0: 202a 2022 6d65 616e 5f6f 7665 725f 636f   * "mean_over_co
-000254e0: 6e74 6f75 7269 6e67 5f66 6c61 7422 3a20  ntouring_flat": 
-000254f0: 5375 6d20 6f66 2070 6f73 6974 6976 6520  Sum of positive 
-00025500: 6469 7374 616e 6365 730a 2020 2020 2020  distances.      
-00025510: 2020 2020 2020 2020 2020 2020 746f 2063              to c
-00025520: 6f6e 666f 726d 6974 792c 2064 6976 6964  onformity, divid
-00025530: 6564 2062 7920 766f 6c75 6d65 2069 6e20  ed by volume in 
-00025540: 756e 696f 6e20 6f66 2052 4f49 7320 636f  union of ROIs co
-00025550: 6d70 6172 6564 2c0a 2020 2020 2020 2020  mpared,.        
-00025560: 2020 2020 2020 2020 2020 666c 6174 7465            flatte
-00025570: 6e65 6420 696e 2074 6865 206f 7269 656e  ned in the orien
-00025580: 7461 7469 6f6e 2073 7065 6369 6669 6564  tation specified
-00025590: 2069 6e20 3c76 6965 773e 2e0a 2020 2020   in <view>..    
-000255a0: 2020 2020 2020 2020 2020 2020 2a20 226d              * "m
-000255b0: 6561 6e5f 6469 7374 616e 6365 5f74 6f5f  ean_distance_to_
-000255c0: 636f 6e66 6f72 6d69 7479 223a 2053 756d  conformity": Sum
-000255d0: 206f 6620 6d65 616e 5f75 6e64 6572 5f63   of mean_under_c
-000255e0: 6f6e 746f 7572 696e 670a 2020 2020 2020  ontouring.      
-000255f0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-00025600: 6d65 616e 5f6f 7665 725f 636f 6e74 6f75  mean_over_contou
-00025610: 7269 6e67 2e0a 2020 2020 2020 2020 2020  ring..          
-00025620: 2020 2020 2020 2a20 226d 6561 6e5f 6469        * "mean_di
-00025630: 7374 616e 6365 5f74 6f5f 636f 6e66 6f72  stance_to_confor
-00025640: 6d69 7479 5f66 6c61 7422 3a20 5375 6d20  mity_flat": Sum 
-00025650: 6f66 0a20 2020 2020 2020 2020 2020 2020  of.             
-00025660: 2020 2020 206d 6561 6e5f 756e 6465 725f       mean_under_
-00025670: 636f 6e74 6f75 7269 6e67 5f66 6c61 7420  contouring_flat 
-00025680: 616e 6420 6d65 616e 5f6f 7665 725f 636f  and mean_over_co
-00025690: 6e74 6f75 7269 6e67 5f66 6c61 742e 0a0a  ntouring_flat...
-000256a0: 2020 2020 2020 2020 2020 2020 4966 204e              If N
-000256b0: 6f6e 652c 2064 6566 6175 6c74 7320 746f  one, defaults to
-000256c0: 205b 2264 6963 6522 2c20 2263 656e 7472   ["dice", "centr
-000256d0: 6f69 6422 5d2e 0a0a 2020 2020 2020 2020  oid"]...        
-000256e0: 766f 6c5f 756e 6974 7320 3a20 7374 722c  vol_units : str,
-000256f0: 2064 6566 6175 6c74 3d22 6d6d 220a 2020   default="mm".  
-00025700: 2020 2020 2020 2020 2020 556e 6974 7320            Units 
-00025710: 746f 2075 7365 2066 6f72 2076 6f6c 756d  to use for volum
-00025720: 652e 2043 616e 2062 6520 226d 6d22 2028  e. Can be "mm" (
-00025730: 3d6d 6d5e 3329 2c20 226d 6c22 2c0a 2020  =mm^3), "ml",.  
-00025740: 2020 2020 2020 2020 2020 6f72 2022 766f            or "vo
-00025750: 7865 6c73 222e 0a0a 2020 2020 2020 2020  xels"...        
-00025760: 6172 6561 5f75 6e69 7473 203a 2073 7472  area_units : str
-00025770: 2c20 6465 6661 756c 743d 226d 6d22 0a20  , default="mm". 
-00025780: 2020 2020 2020 2020 2020 2055 6e69 7473             Units
-00025790: 2074 6f20 7573 6520 666f 7220 6172 6561   to use for area
-000257a0: 732e 2043 616e 2062 6520 226d 6d22 2028  s. Can be "mm" (
-000257b0: 3d6d 6d5e 3229 206f 7220 2276 6f78 656c  =mm^2) or "voxel
-000257c0: 7322 2e0a 0a20 2020 2020 2020 2063 656e  s"...        cen
-000257d0: 7472 6f69 645f 756e 6974 733a 0a20 2020  troid_units:.   
-000257e0: 2020 2020 2020 2020 2055 6e69 7473 2074           Units t
-000257f0: 6f20 7573 6520 666f 7220 6365 6e74 726f  o use for centro
-00025800: 6964 732e 2043 616e 2062 6520 226d 6d22  ids. Can be "mm"
-00025810: 206f 7220 2276 6f78 656c 7322 2e0a 0a20   or "voxels"... 
-00025820: 2020 2020 2020 2076 6965 7720 3a20 7374         view : st
-00025830: 722c 2064 6566 6175 6c74 3d22 782d 7922  r, default="x-y"
-00025840: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
-00025850: 656e 7461 7469 6f6e 2069 6e20 7768 6963  entation in whic
-00025860: 6820 746f 2063 6f6d 7075 7465 206d 6574  h to compute met
-00025870: 7269 6373 2e20 4f6e 6c79 2072 656c 6576  rics. Only relev
-00025880: 616e 7420 666f 7220 0a20 2020 2020 2020  ant for .       
-00025890: 2020 2020 2073 696e 676c 652d 736c 6963       single-slic
-000258a0: 6520 6d65 7472 6963 7320 6f72 2066 6c61  e metrics or fla
-000258b0: 7474 656e 6564 206d 6574 7269 6373 2e0a  ttened metrics..
-000258c0: 0a20 2020 2020 2020 2073 6c20 3a20 696e  .        sl : in
-000258d0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-000258e0: 2020 2020 2020 2020 2020 2020 536c 6963              Slic
-000258f0: 6520 6e75 6d62 6572 206f 6e20 7768 6963  e number on whic
-00025900: 6820 746f 2063 6f6d 7075 7465 206d 6574  h to compute met
-00025910: 7269 6373 2e20 4f6e 6c79 2072 656c 6576  rics. Only relev
-00025920: 616e 7420 666f 7220 0a20 2020 2020 2020  ant for .       
-00025930: 2020 2020 2073 696e 676c 652d 736c 6963       single-slic
-00025940: 6520 6d65 7472 6963 7320 2861 7265 612c  e metrics (area,
-00025950: 2063 656e 7472 6f69 645f 736c 6963 652c   centroid_slice,
-00025960: 206c 656e 6774 685f 736c 6963 6529 2e0a   length_slice)..
-00025970: 2020 2020 2020 2020 2020 2020 4966 203c              If <
-00025980: 736c 3e2c 203c 6964 783e 2c20 616e 6420  sl>, <idx>, and 
-00025990: 3c70 6f73 3e20 6172 6520 616c 6c20 4e6f  <pos> are all No
-000259a0: 6e65 2c20 7468 6520 6365 6e74 7261 6c20  ne, the central 
-000259b0: 736c 6963 6520 6f66 2074 6865 0a20 2020  slice of the.   
-000259c0: 2020 2020 2020 2020 2052 4f49 2077 696c           ROI wil
-000259d0: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
-000259e0: 2020 2020 6964 7820 3a20 696e 742c 2064      idx : int, d
-000259f0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00025a00: 2020 2020 2020 2020 536c 6963 6520 696e          Slice in
-00025a10: 6465 7820 6172 7261 7920 6f6e 2077 6869  dex array on whi
-00025a20: 6368 2074 6f20 636f 6d70 7574 6520 6d65  ch to compute me
-00025a30: 7472 6963 732e 204f 6e6c 7920 7265 6c65  trics. Only rele
-00025a40: 7661 6e74 2066 6f72 200a 2020 2020 2020  vant for .      
-00025a50: 2020 2020 2020 7369 6e67 6c65 2d73 6c69        single-sli
-00025a60: 6365 206d 6574 7269 6373 2028 6172 6561  ce metrics (area
-00025a70: 2c20 6365 6e74 726f 6964 5f73 6c69 6365  , centroid_slice
-00025a80: 2c20 6c65 6e67 7468 5f73 6c69 6365 292e  , length_slice).
-00025a90: 0a20 2020 2020 2020 2020 2020 2055 7365  .            Use
-00025aa0: 6420 6966 203c 736c 3e20 6973 204e 6f6e  d if <sl> is Non
-00025ab0: 652e 0a0a 2020 2020 2020 2020 706f 7320  e...        pos 
-00025ac0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
-00025ad0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-00025ae0: 2020 536c 6963 6520 706f 7369 7469 6f6e    Slice position
-00025af0: 2069 6e20 6d6d 206f 6e20 7768 6963 6820   in mm on which 
-00025b00: 746f 2063 6f6d 7075 7465 206d 6574 7269  to compute metri
-00025b10: 6373 2e20 4f6e 6c79 2072 656c 6576 616e  cs. Only relevan
-00025b20: 7420 666f 7220 0a20 2020 2020 2020 2020  t for .         
-00025b30: 2020 2073 696e 676c 652d 736c 6963 6520     single-slice 
-00025b40: 6d65 7472 6963 7320 2861 7265 612c 2063  metrics (area, c
-00025b50: 656e 7472 6f69 645f 736c 6963 652c 206c  entroid_slice, l
-00025b60: 656e 6774 685f 736c 6963 6529 2e0a 2020  ength_slice)..  
-00025b70: 2020 2020 2020 2020 2020 5573 6564 2069            Used i
-00025b80: 6620 3c73 6c3e 2061 6e64 203c 6964 783e  f <sl> and <idx>
-00025b90: 2061 7265 2062 6f74 6820 4e6f 6e65 2e0a   are both None..
-00025ba0: 0a20 2020 2020 2020 206d 6574 686f 6420  .        method 
-00025bb0: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
-00025bc0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00025bd0: 4d65 7468 6f64 2074 6f20 7573 6520 666f  Method to use fo
-00025be0: 7220 6d65 7472 6963 2063 616c 6375 6c61  r metric calcula
-00025bf0: 7469 6f6e 2e20 4361 6e20 6265 2065 6974  tion. Can be eit
-00025c00: 6865 7220 2263 6f6e 746f 7572 2220 0a20  her "contour" . 
-00025c10: 2020 2020 2020 2020 2020 2028 7573 6520             (use 
-00025c20: 7368 6170 656c 7920 706f 6c79 676f 6e73  shapely polygons
-00025c30: 2920 6f72 2022 6d61 736b 2220 2875 7365  ) or "mask" (use
-00025c40: 2062 696e 6172 7920 6d61 736b 292e 2049   binary mask). I
-00025c50: 6620 4e6f 6e65 2c0a 2020 2020 2020 2020  f None,.        
-00025c60: 2020 2020 7468 6520 7661 6c75 6520 7365      the value se
-00025c70: 7420 696e 2073 656c 662e 6465 6661 756c  t in self.defaul
-00025c80: 745f 6765 6f6d 5f6d 6574 686f 6420 7769  t_geom_method wi
-00025c90: 6c6c 2062 6520 7573 6564 2e20 4e6f 7465  ll be used. Note
-00025ca0: 200a 2020 2020 2020 2020 2020 2020 7468   .            th
-00025cb0: 6174 2066 6c61 7474 656e 6564 206d 6574  at flattened met
-00025cc0: 7269 6373 2061 6e64 2073 7572 6661 6365  rics and surface
-00025cd0: 2064 6973 7461 6e63 6520 6d65 7472 6963   distance metric
-00025ce0: 7320 656e 666f 7263 6520 7573 650a 2020  s enforce use.  
-00025cf0: 2020 2020 2020 2020 2020 6f66 2074 6865            of the
-00025d00: 2022 6d61 736b 2220 6d65 7468 6f64 2e0a   "mask" method..
-00025d10: 0a20 2020 2020 2020 2073 6c69 6365 5f73  .        slice_s
-00025d20: 7461 7473 203a 2073 7472 2f6c 6973 742f  tats : str/list/
-00025d30: 6469 6374 2c20 6465 6661 756c 743d 4e6f  dict, default=No
-00025d40: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
-00025d50: 7065 6369 6669 6361 7469 6f6e 206f 6620  pecification of 
-00025d60: 7374 6174 6973 7469 6373 2074 6f20 6265  statistics to be
-00025d70: 2063 616c 6375 6c61 7465 6420 7265 6c61   calculated rela
-00025d80: 7469 7665 0a20 2020 2020 2020 2020 2020  tive.           
-00025d90: 2074 6f20 736c 6963 652d 6279 2d73 6c69   to slice-by-sli
-00025da0: 6365 206d 6574 7269 6320 7661 6c75 6573  ce metric values
-00025db0: 2e20 2055 7365 6420 666f 7220 616c 6c20  .  Used for all 
-00025dc0: 6d65 7472 6963 7320 7769 7468 0a20 2020  metrics with.   
-00025dd0: 2020 2020 2020 2020 2073 7566 6669 7820           suffix 
-00025de0: 225f 736c 6963 655f 7374 6174 7322 2069  "_slice_stats" i
-00025df0: 6e20 7468 6520 3c6d 6574 7269 6373 3e20  n the <metrics> 
-00025e00: 6c69 7374 2e0a 0a20 2020 2020 2020 2020  list...         
-00025e10: 2020 2041 2073 7461 7469 7374 6963 2069     A statistic i
-00025e20: 7320 7370 6563 6966 6965 6420 6279 2074  s specified by t
-00025e30: 6865 206e 616d 6520 6f66 2074 6865 2066  he name of the f
-00025e40: 756e 6374 696f 6e20 666f 720a 2020 2020  unction for.    
-00025e50: 2020 2020 2020 2020 6974 7320 6361 6c63          its calc
-00025e60: 756c 6174 696f 6e20 696e 2074 6865 2050  ulation in the P
-00025e70: 7974 686f 6e20 7374 6174 6973 7469 6373  ython statistics
-00025e80: 206d 6f64 756c 653a 0a0a 2020 2020 2020   module:..      
-00025e90: 2020 2020 2020 6874 7470 733a 2f2f 646f        https://do
-00025ea0: 6373 2e70 7974 686f 6e2e 6f72 672f 332f  cs.python.org/3/
-00025eb0: 6c69 6272 6172 792f 7374 6174 6973 7469  library/statisti
-00025ec0: 6373 2e68 746d 6c0a 0a20 2020 2020 2020  cs.html..       
-00025ed0: 2020 2020 2046 6f72 2069 7473 2075 7365       For its use
-00025ee0: 2068 6572 652c 2074 6865 2072 656c 6576   here, the relev
-00025ef0: 616e 7420 6675 6e63 7469 6f6e 206d 7573  ant function mus
-00025f00: 7420 7265 7175 6972 650a 2020 2020 2020  t require.      
-00025f10: 2020 2020 2020 6120 7369 6e67 6c65 2d76        a single-v
-00025f20: 6172 6961 626c 6520 696e 7075 742c 206d  ariable input, m
-00025f30: 7573 7420 6e6f 7420 7265 7175 6972 6520  ust not require 
-00025f40: 616e 7920 6b65 7977 6f72 640a 2020 2020  any keyword.    
-00025f50: 2020 2020 2020 2020 6172 6775 6d65 6e74          argument
-00025f60: 732c 2061 6e64 206d 7573 7420 7265 7475  s, and must retu
-00025f70: 726e 2061 2073 696e 676c 6520 6e75 6d62  rn a single numb
-00025f80: 6572 2e0a 0a20 2020 2020 2020 2020 2020  er...           
-00025f90: 2041 7661 696c 6162 6c65 206f 7074 696f   Available optio
-00025fa0: 6e73 2069 6e63 6c75 6465 3a20 226d 6561  ns include: "mea
-00025fb0: 6e22 2c20 226d 6564 6961 6e22 2c20 226d  n", "median", "m
-00025fc0: 6f64 6522 2c0a 2020 2020 2020 2020 2020  ode",.          
-00025fd0: 2020 2273 7464 6576 222e 0a0a 2020 2020    "stdev"...    
-00025fe0: 2020 2020 2020 2053 7461 7469 7374 6963         Statistic
-00025ff0: 7320 746f 2062 6520 6361 6c63 756c 6174  s to be calculat
-00026000: 6564 2063 616e 2062 6520 7370 6563 6966  ed can be specif
-00026010: 6965 6420 7573 696e 6720 616e 7920 6f66  ied using any of
-00026020: 0a20 2020 2020 2020 2020 2020 7468 6520  .           the 
-00026030: 666f 6c6c 6f77 696e 673a 0a0a 2020 2020  following:..    
-00026040: 2020 2020 2020 202d 2053 7472 696e 6720         - String 
-00026050: 7370 6563 6966 7969 6e67 2073 696e 676c  specifying singl
-00026060: 6520 7374 6174 6973 7469 6320 746f 2062  e statistic to b
-00026070: 6520 6361 6c63 756c 6174 6564 2c0a 2020  e calculated,.  
-00026080: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00026090: 736c 6963 6573 2063 6f6e 7369 6465 7265  slices considere
-000260a0: 6420 6173 2067 6976 656e 2062 7920 6465  d as given by de
-000260b0: 6661 756c 745f 6279 5f73 6c69 6365 2c0a  fault_by_slice,.
-000260c0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000260d0: 2065 7861 6d70 6c65 3a20 226d 6561 6e22   example: "mean"
-000260e0: 3b0a 2020 2020 2020 2020 2020 202d 204c  ;.           - L
-000260f0: 6973 7420 7370 6563 6966 7969 6e67 206d  ist specifying m
-00026100: 756c 7469 706c 6520 7374 6174 6973 7469  ultiple statisti
-00026110: 6373 2074 6f20 6265 2063 616c 6375 6c61  cs to be calcula
-00026120: 7465 642c 0a20 2020 2020 2020 2020 2020  ted,.           
-00026130: 2020 7769 7468 2073 6c69 6365 7320 636f    with slices co
-00026140: 6e73 6964 6572 6564 2061 7320 6769 7665  nsidered as give
-00026150: 6e20 6279 2064 6566 6175 6c74 5f62 795f  n by default_by_
-00026160: 736c 6963 652c 0a20 2020 2020 2020 2020  slice,.         
-00026170: 2020 2020 666f 7220 6578 616d 706c 653a      for example:
-00026180: 205b 226d 6561 6e22 2c20 2273 7464 6576   ["mean", "stdev
-00026190: 225d 3b0a 2020 2020 2020 2020 2020 202d  "];.           -
-000261a0: 2044 6963 7469 6f6e 6172 7920 7768 6572   Dictionary wher
-000261b0: 6520 6b65 7973 2073 7065 6369 6679 2073  e keys specify s
-000261c0: 6c69 6365 7320 746f 2062 6520 636f 6e73  lices to be cons
-000261d0: 6964 6572 6564 2c0a 2020 2020 2020 2020  idered,.        
-000261e0: 2020 2020 2061 6e64 2076 616c 7565 7320       and values 
-000261f0: 7370 6563 6966 7920 7374 6174 6973 7469  specify statisti
-00026200: 6373 2028 7374 7269 6e67 206f 7220 6c69  cs (string or li
-00026210: 7374 292c 2066 6f72 0a20 2020 2020 2020  st), for.       
-00026220: 2020 2020 2020 6578 616d 706c 653a 207b        example: {
-00026230: 2275 6e69 6f6e 223a 205b 226d 6561 6e22  "union": ["mean"
-00026240: 2c20 2273 7464 6576 225d 7d2e 2020 5661  , "stdev"]}.  Va
-00026250: 6c69 6420 736c 6963 650a 2020 2020 2020  lid slice.      
-00026260: 2020 2020 2020 2073 7065 6369 6669 6361         specifica
-00026270: 7469 6f6e 7320 6172 6520 6173 206c 6973  tions are as lis
-00026280: 7465 6420 666f 7220 6465 6661 756c 745f  ted for default_
-00026290: 6279 5f73 6c69 6365 2e0a 0a20 2020 2020  by_slice...     
-000262a0: 2020 2064 6566 6175 6c74 5f62 795f 736c     default_by_sl
-000262b0: 6963 653a 2073 7472 2c20 6465 6661 756c  ice: str, defaul
-000262c0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-000262d0: 2020 2044 6566 6175 6c74 2073 7065 6369     Default speci
-000262e0: 6669 6361 7469 6f6e 206f 6620 736c 6963  fication of slic
-000262f0: 6573 2074 6f20 6265 2063 6f6e 7369 6465  es to be conside
-00026300: 7265 6420 7768 656e 0a20 2020 2020 2020  red when.       
-00026310: 2020 2020 2063 616c 6375 6c61 7469 6e67       calculating
-00026320: 2073 6c69 6365 2d62 792d 736c 6963 6520   slice-by-slice 
-00026330: 7374 6174 6973 7469 6373 2e20 2054 6865  statistics.  The
-00026340: 2076 616c 6964 2073 7065 6369 6669 6361   valid specifica
-00026350: 7469 6f6e 730a 2020 2020 2020 2020 2020  tions.          
-00026360: 2020 6172 653a 0a0a 2020 2020 2020 2020    are:..        
-00026370: 2020 2020 2d20 226c 6566 7422 3a20 636f      - "left": co
-00026380: 6e73 6964 6572 206f 6e6c 7920 736c 6963  nsider only slic
-00026390: 6573 2063 6f6e 7461 696e 696e 6720 7365  es containing se
-000263a0: 6c66 3b0a 2020 2020 2020 2020 2020 2020  lf;.            
-000263b0: 2d20 2272 6967 6874 223a 2063 6f6e 7369  - "right": consi
-000263c0: 6465 7220 6f6e 6c79 2073 6c69 6365 7320  der only slices 
-000263d0: 636f 6e74 6169 6e69 6e67 206f 7468 6572  containing other
-000263e0: 2072 6f69 3b0a 2020 2020 2020 2020 2020   roi;.          
-000263f0: 2020 2d20 2275 6e69 6f6e 223a 2063 6f6e    - "union": con
-00026400: 7369 6465 7220 736c 6963 6573 2063 6f6e  sider slices con
-00026410: 7461 696e 696e 6720 6569 7468 6572 206f  taining either o
-00026420: 6620 7365 6c66 2061 6e64 206f 7468 6572  f self and other
-00026430: 2072 6f69 3b0a 2020 2020 2020 2020 2020   roi;.          
-00026440: 2020 2d20 2269 6e74 6572 7365 6374 696f    - "intersectio
-00026450: 6e22 3a20 636f 6e73 6964 6572 2073 6c69  n": consider sli
-00026460: 6365 7320 636f 6e74 6169 6e69 6e67 2062  ces containing b
-00026470: 6f74 6820 6f66 2073 656c 6620 616e 640a  oth of self and.
-00026480: 2020 2020 2020 2020 2020 2020 2020 6f74                ot
-00026490: 6865 7220 726f 692e 0a0a 2020 2020 2020  her roi...      
-000264a0: 2020 2020 2020 4966 204e 6f6e 652c 2075        If None, u
-000264b0: 7365 2073 6b72 742e 636f 7265 2e44 6566  se skrt.core.Def
-000264c0: 6175 6c74 7328 292e 6279 5f73 6c69 6365  aults().by_slice
-000264d0: 0a0a 2020 2020 2020 2020 756e 6974 735f  ..        units_
-000264e0: 696e 5f68 6561 6465 7220 3a20 626f 6f6c  in_header : bool
-000264f0: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
-00026500: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-00026510: 7275 652c 2075 6e69 7473 2077 696c 6c20  rue, units will 
-00026520: 6265 2069 6e63 6c75 6465 6420 696e 2063  be included in c
-00026530: 6f6c 756d 6e20 6865 6164 6572 732e 0a0a  olumn headers...
-00026540: 2020 2020 2020 2020 676c 6f62 616c 5f76          global_v
-00026550: 735f 736c 6963 655f 6865 6164 6572 203a  s_slice_header :
-00026560: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
-00026570: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-00026580: 2049 6620 5472 7565 2c20 7468 6520 7265   If True, the re
-00026590: 7475 726e 6564 2044 6174 6146 7261 6d65  turned DataFrame
-000265a0: 2077 696c 6c20 6861 7665 2061 6e20 6578   will have an ex
-000265b0: 7472 6120 7365 7420 6f66 2068 6561 6465  tra set of heade
-000265c0: 7273 0a20 2020 2020 2020 2020 2020 2073  rs.            s
-000265d0: 706c 6974 7469 6e67 2074 6865 2074 6162  plitting the tab
-000265e0: 6c65 2069 6e74 6f20 2267 6c6f 6261 6c22  le into "global"
-000265f0: 2061 6e64 2022 736c 6963 6522 206d 6574   and "slice" met
-00026600: 7269 6373 2e0a 0a20 2020 2020 2020 206e  rics...        n
-00026610: 616d 655f 6173 5f69 6e64 6578 203a 2062  ame_as_index : b
-00026620: 6f6f 6c2c 2064 6566 6175 6c74 3d54 7275  ool, default=Tru
-00026630: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
-00026640: 2054 7275 652c 2074 6865 2069 6e64 6578   True, the index
-00026650: 2063 6f6c 756d 6e20 6f66 2074 6865 2070   column of the p
-00026660: 616e 6461 7320 4461 7461 4672 616d 6520  andas DataFrame 
-00026670: 7769 6c6c 200a 2020 2020 2020 2020 2020  will .          
-00026680: 2020 636f 6e74 6169 6e20 7468 6520 524f    contain the RO
-00026690: 4927 7320 6e61 6d65 733b 206f 7468 6572  I's names; other
-000266a0: 7769 7365 2c20 7468 6520 6e61 6d65 2077  wise, the name w
-000266b0: 696c 6c20 6170 7065 6172 2069 6e20 6120  ill appear in a 
-000266c0: 636f 6c75 6d6e 0a20 2020 2020 2020 2020  column.         
-000266d0: 2020 206e 616d 6564 2022 524f 4922 2e0a     named "ROI"..
-000266e0: 0a20 2020 2020 2020 206e 6963 655f 636f  .        nice_co
-000266f0: 6c75 6d6e 7320 3a20 626f 6f6c 2c20 6465  lumns : bool, de
-00026700: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-00026710: 2020 2020 2020 2020 4966 2046 616c 7365          If False
-00026720: 2c20 636f 6c75 6d6e 206e 616d 6573 2077  , column names w
-00026730: 696c 6c20 6265 2074 6865 2073 616d 6520  ill be the same 
-00026740: 6173 2074 6865 2069 6e70 7574 206d 6574  as the input met
-00026750: 7269 6373 206e 616d 6573 3b0a 2020 2020  rics names;.    
-00026760: 2020 2020 2020 2020 6966 2054 7275 652c          if True,
-00026770: 2074 6865 206e 616d 6573 2077 696c 6c20   the names will 
-00026780: 6265 2063 6170 6974 616c 697a 6564 2061  be capitalized a
-00026790: 6e64 2075 6e64 6572 7363 6f72 6573 2077  nd underscores w
-000267a0: 696c 6c20 6265 200a 2020 2020 2020 2020  ill be .        
-000267b0: 2020 2020 7265 706c 6163 6564 2077 6974      replaced wit
-000267c0: 6820 7370 6163 6573 2e0a 0a20 2020 2020  h spaces...     
-000267d0: 2020 2064 6563 696d 616c 5f70 6c61 6365     decimal_place
-000267e0: 7320 3a20 696e 742c 2064 6566 6175 6c74  s : int, default
-000267f0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-00026800: 2020 4e75 6d62 6572 206f 6620 6465 6369    Number of deci
-00026810: 6d61 6c20 706c 6163 6573 2074 6f20 6b65  mal places to ke
-00026820: 6570 2066 6f72 2065 6163 6820 6d65 7472  ep for each metr
-00026830: 6963 2e20 4966 204e 6f6e 652c 2066 756c  ic. If None, ful
-00026840: 6c0a 2020 2020 2020 2020 2020 2020 7072  l.            pr
-00026850: 6563 6973 696f 6e20 7769 6c6c 2062 6520  ecision will be 
-00026860: 7573 6564 2e0a 0a20 2020 2020 2020 2066  used...        f
-00026870: 6f72 6365 203a 2062 6f6f 6c2c 2064 6566  orce : bool, def
-00026880: 6175 6c74 3d54 7275 650a 2020 2020 2020  ault=True.      
-00026890: 2020 2020 2020 4966 2046 616c 7365 2c20        If False, 
-000268a0: 676c 6f62 616c 206d 6574 7269 6373 2066  global metrics f
-000268b0: 6f72 2065 6163 6820 524f 4920 2876 6f6c  or each ROI (vol
-000268c0: 756d 652c 2033 4420 6365 6e74 726f 6964  ume, 3D centroid
-000268d0: 2c20 0a20 2020 2020 2020 2020 2020 2033  , .            3
-000268e0: 4420 6c65 6e67 7468 7329 2077 696c 6c20  D lengths) will 
-000268f0: 6f6e 6c79 2062 6520 6361 6c63 756c 6174  only be calculat
-00026900: 6564 2069 6620 7468 6579 2068 6176 6520  ed if they have 
-00026910: 6e6f 7420 6265 656e 200a 2020 2020 2020  not been .      
-00026920: 2020 2020 2020 6361 6c63 756c 6174 6564        calculated
-00026930: 2062 6566 6f72 653b 2069 6620 5472 7565   before; if True
-00026940: 2c20 616c 6c20 6d65 7472 6963 7320 7769  , all metrics wi
-00026950: 6c6c 2062 6520 7265 6361 6c63 756c 6174  ll be recalculat
-00026960: 6564 2e0a 0a20 2020 2020 2020 2076 6f78  ed...        vox
-00026970: 656c 5f73 697a 6520 3a20 7475 706c 652c  el_size : tuple,
-00026980: 2064 6566 6175 6c74 3d28 312c 2031 2c20   default=(1, 1, 
-00026990: 3129 0a20 2020 2020 2020 2020 2020 2056  1).            V
-000269a0: 6f78 656c 2073 697a 6520 2864 782c 2064  oxel size (dx, d
-000269b0: 792c 2064 7a29 2069 6e20 6d6d 2074 6f20  y, dz) in mm to 
-000269c0: 6265 2075 7365 6420 666f 7220 524f 4920  be used for ROI 
-000269d0: 6d61 736b 730a 2020 2020 2020 2020 2020  masks.          
-000269e0: 2020 6672 6f6d 2077 6869 6368 2074 6f20    from which to 
-000269f0: 6361 6c63 756c 6174 6520 7375 7266 6163  calculate surfac
-00026a00: 6520 6469 7374 616e 6365 732e 2020 4966  e distances.  If
-00026a10: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-00026a20: 2020 2074 6865 206d 6173 6b20 766f 7865     the mask voxe
-00026a30: 6c20 7369 7a65 206f 6620 3c6f 7468 6572  l size of <other
-00026a40: 3e20 6973 2075 7365 642e 2020 4966 2061  > is used.  If a
-00026a50: 6e20 696e 6469 7669 6475 616c 0a20 2020  n individual.   
-00026a60: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
-00026a70: 2069 7320 4e6f 6e65 2c20 7468 6520 7661   is None, the va
-00026a80: 6c75 6520 6f66 2074 6865 2063 6f72 7265  lue of the corre
-00026a90: 7370 6f6e 6469 6e67 2065 6c65 6d65 6e74  sponding element
-00026aa0: 2066 6f72 0a20 2020 2020 2020 2020 2020   for.           
-00026ab0: 2074 6865 206d 6173 6b20 766f 7865 6c20   the mask voxel 
-00026ac0: 7369 7a65 206f 6620 3c6f 7468 6572 3e20  size of <other> 
-00026ad0: 6973 2075 7365 642e 2020 4120 7661 6c75  is used.  A valu
-00026ae0: 650a 2020 2020 2020 2020 2020 2020 6f74  e.            ot
-00026af0: 6865 7220 7468 616e 204e 6f6e 6520 666f  her than None fo
-00026b00: 7263 6573 2063 7265 6174 696f 6e20 6f66  rces creation of
-00026b10: 206d 6173 6b73 2074 6861 7420 6a75 7374   masks that just
-00026b20: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
-00026b30: 2020 2074 6865 2076 6f6c 756d 6520 6f63     the volume oc
-00026b40: 6375 7069 6564 2062 7920 7468 6520 7477  cupied by the tw
-00026b50: 6f20 524f 4973 2062 6569 6e67 2063 6f6d  o ROIs being com
-00026b60: 7061 7265 642c 0a20 2020 2020 2020 2020  pared,.         
-00026b70: 2020 2070 6f74 656e 7469 616c 6c79 2072     potentially r
-00026b80: 6564 7563 696e 6720 7468 6520 7469 6d65  educing the time
-00026b90: 2066 6f72 2073 7572 6661 6365 2d64 6973   for surface-dis
-00026ba0: 7461 6e63 6520 6361 6c63 756c 6174 696f  tance calculatio
-00026bb0: 6e73 2e0a 0a20 2020 2020 2020 206d 6174  ns...        mat
-00026bc0: 6368 5f6c 656e 6774 6873 203a 2062 6f6f  ch_lengths : boo
-00026bd0: 6c2f 7374 722f 6c69 7374 2c20 6465 6661  l/str/list, defa
-00026be0: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
-00026bf0: 2020 2020 2020 4966 2073 6574 2074 6f20        If set to 
-00026c00: 5472 7565 2c20 746f 2074 6865 206e 616d  True, to the nam
-00026c10: 6520 6f66 2074 6865 206f 7468 6572 2052  e of the other R
-00026c20: 4f49 2c20 6f72 2074 6f20 6120 6c69 7374  OI, or to a list
-00026c30: 0a20 2020 2020 2020 2020 2020 206f 6620  .            of 
-00026c40: 6e61 6d65 7320 696e 636c 7564 696e 6720  names including 
-00026c50: 7468 6520 6e61 6d65 206f 6620 7468 6520  the name of the 
-00026c60: 6f74 6865 7220 524f 492c 206d 6174 6368  other ROI, match
-00026c70: 2052 4f49 206c 656e 6774 6873 0a20 2020   ROI lengths.   
-00026c80: 2020 2020 2020 2020 2028 7a2d 6469 6d65           (z-dime
-00026c90: 6e73 696f 6e73 2920 6265 666f 7265 2063  nsions) before c
-00026ca0: 6f6d 7061 7269 736f 6e2e 2020 5468 6520  omparison.  The 
-00026cb0: 7374 7261 7465 6779 2075 7365 6420 6973  strategy used is
-00026cc0: 2064 6566 696e 6564 0a20 2020 2020 2020   defined.       
-00026cd0: 2020 2020 2062 7920 7468 6520 7661 6c75       by the valu
-00026ce0: 6520 6f66 206d 6174 6368 5f6c 656e 6774  e of match_lengt
-00026cf0: 6873 5f73 7472 6174 6567 792e 0a0a 2020  hs_strategy...  
-00026d00: 2020 2020 2020 6d61 7463 685f 6c65 6e67        match_leng
-00026d10: 7468 735f 7374 7261 7465 6779 203a 2069  ths_strategy : i
-00026d20: 6e74 2c20 6465 6661 756c 743d 310a 2020  nt, default=1.  
-00026d30: 2020 2020 2020 2020 2020 5374 7261 7465            Strate
-00026d40: 6779 2074 6f20 7573 6520 666f 7220 6d61  gy to use for ma
-00026d50: 7463 6869 6e67 2052 4f49 206c 656e 6774  tching ROI lengt
-00026d60: 6873 2028 7a2d 6469 6d65 6e73 696f 6e73  hs (z-dimensions
-00026d70: 293a 0a0a 2020 2020 2020 2020 2020 2020  ):..            
-00026d80: 2d20 3020 3a20 4372 6f70 2074 6869 7320  - 0 : Crop this 
-00026d90: 524f 4920 746f 2074 6865 207a 2d65 7874  ROI to the z-ext
-00026da0: 656e 7473 206f 6620 7468 6520 6f74 6865  ents of the othe
-00026db0: 7220 524f 493b 0a20 2020 2020 2020 2020  r ROI;.         
-00026dc0: 2020 202d 2031 203a 2043 726f 7020 7468     - 1 : Crop th
-00026dd0: 6520 6f74 6865 7220 524f 4920 746f 2074  e other ROI to t
-00026de0: 6865 207a 2d65 7865 6e74 7320 6f66 2074  he z-exents of t
-00026df0: 6869 7320 524f 493b 0a20 2020 2020 2020  his ROI;.       
-00026e00: 2020 2020 202d 2032 203a 2043 726f 7020       - 2 : Crop 
-00026e10: 7468 6973 2052 4f49 2074 6f20 7468 6520  this ROI to the 
-00026e20: 7a2d 6578 7465 6e74 7320 6f66 2074 6865  z-extents of the
-00026e30: 206f 7468 6572 2052 4f49 2c20 7468 656e   other ROI, then
-00026e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026e50: 2020 2063 726f 7020 7468 6520 6f74 6865     crop the othe
-00026e60: 7220 524f 4920 746f 2074 6865 2063 726f  r ROI to the cro
-00026e70: 7070 6564 207a 2d65 7874 656e 7473 206f  pped z-extents o
-00026e80: 6620 7468 6973 2052 4f49 2e0a 0a20 2020  f this ROI...   
-00026e90: 2020 2020 2020 2020 2046 6f72 2061 2076           For a v
-00026ea0: 616c 7565 206f 7468 6572 2074 6861 6e20  alue other than 
-00026eb0: 302c 2031 2c20 322c 206e 6f20 6c65 6e67  0, 1, 2, no leng
-00026ec0: 7468 206d 6174 6368 696e 6720 6973 2070  th matching is p
-00026ed0: 6572 666f 726d 6564 2e0a 2020 2020 2020  erformed..      
-00026ee0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-00026ef0: 2076 6f78 656c 5f73 697a 6520 6973 206e   voxel_size is n
-00026f00: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00026f10: 2020 2020 2023 2043 7265 6174 6520 524f       # Create RO
-00026f20: 4920 6d61 736b 732c 206a 7573 7420 636f  I masks, just co
-00026f30: 7665 7269 6e67 2076 6f6c 756d 6520 6f63  vering volume oc
-00026f40: 6375 7069 6564 0a20 2020 2020 2020 2020  cupied.         
-00026f50: 2020 2023 2062 7920 524f 4973 2062 6569     # by ROIs bei
-00026f60: 6e67 2063 6f6d 7061 7265 642c 2077 6974  ng compared, wit
-00026f70: 6820 7370 6563 6966 6965 6420 766f 7865  h specified voxe
-00026f80: 6c20 7369 7a65 2e0a 2020 2020 2020 2020  l size..        
-00026f90: 2020 2020 2320 2854 6865 2072 6573 697a      # (The resiz
-00026fa0: 696e 6720 6973 2070 6572 666f 726d 6564  ing is performed
-00026fb0: 206f 6e20 636c 6f6e 6573 206f 6e20 7468   on clones on th
-00026fc0: 6520 524f 4973 2c0a 2020 2020 2020 2020  e ROIs,.        
-00026fd0: 2020 2020 2320 7769 7468 6f75 7420 6368      # without ch
-00026fe0: 616e 6769 6e67 2074 6865 206f 7269 6769  anging the origi
-00026ff0: 6e61 6c73 2e29 0a20 2020 2020 2020 2020  nals.).         
-00027000: 2020 2072 6f69 302c 2072 6f69 203d 2073     roi0, roi = s
-00027010: 656c 662e 6d61 7463 685f 6d61 736b 5f76  elf.match_mask_v
-00027020: 6f78 656c 5f73 697a 6528 726f 692c 0a20  oxel_size(roi,. 
-00027030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027040: 2020 2076 6f78 656c 5f73 697a 653d 766f     voxel_size=vo
-00027050: 7865 6c5f 7369 7a65 2c20 766f 7865 6c5f  xel_size, voxel_
-00027060: 6469 6d5f 746f 6c65 7261 6e63 653d 2d31  dim_tolerance=-1
-00027070: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00027080: 2020 2020 2020 2020 2020 2020 2320 446f              # Do
-00027090: 6e27 7420 6578 706c 6963 6974 6c79 2063  n't explicitly c
-000270a0: 7265 6174 6520 524f 4920 6d61 736b 732e  reate ROI masks.
-000270b0: 0a20 2020 2020 2020 2020 2020 2072 6f69  .            roi
-000270c0: 3020 3d20 7365 6c66 0a0a 2020 2020 2020  0 = self..      
-000270d0: 2020 2320 4f70 7469 6f6e 616c 6c79 206d    # Optionally m
-000270e0: 6174 6368 2052 4f49 206c 656e 6774 6873  atch ROI lengths
-000270f0: 2e0a 2020 2020 2020 2020 6966 2028 286d  ..        if ((m
-00027100: 6174 6368 5f6c 656e 6774 6873 2069 7320  atch_lengths is 
-00027110: 5472 7565 2920 6f72 2028 726f 692e 6e61  True) or (roi.na
-00027120: 6d65 203d 3d20 6d61 7463 685f 6c65 6e67  me == match_leng
-00027130: 7468 7329 0a20 2020 2020 2020 2020 2020  ths).           
-00027140: 2020 2020 206f 7220 2869 7369 6e73 7461       or (isinsta
-00027150: 6e63 6528 6d61 7463 685f 6c65 6e67 7468  nce(match_length
-00027160: 732c 2028 6c69 7374 2c20 7475 706c 652c  s, (list, tuple,
-00027170: 2073 6574 2929 0a20 2020 2020 2020 2020   set)).         
-00027180: 2020 2020 2020 2020 2020 2061 6e64 2072             and r
-00027190: 6f69 2e6e 616d 6520 696e 206d 6174 6368  oi.name in match
-000271a0: 5f6c 656e 6774 6873 2929 3a0a 2020 2020  _lengths)):.    
-000271b0: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
-000271c0: 2052 4f49 2063 6c6f 6e65 7320 666f 7220   ROI clones for 
-000271d0: 6372 6f70 7069 6e67 3b20 7468 6520 6f72  cropping; the or
-000271e0: 6967 696e 616c 7320 7769 6c6c 2062 6520  iginals will be 
-000271f0: 756e 6368 616e 6765 642e 0a20 2020 2020  unchanged..     
-00027200: 2020 2020 2020 2069 6620 6d61 7463 685f         if match_
-00027210: 6c65 6e67 7468 735f 7374 7261 7465 6779  lengths_strategy
-00027220: 2069 6e20 5b30 2c20 312c 2032 5d20 616e   in [0, 1, 2] an
-00027230: 6420 766f 7865 6c5f 7369 7a65 2069 7320  d voxel_size is 
-00027240: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00027250: 2020 2020 2020 726f 6930 203d 2073 656c        roi0 = sel
-00027260: 662e 636c 6f6e 6528 290a 2020 2020 2020  f.clone().      
-00027270: 2020 2020 2020 2020 2020 726f 6920 3d20            roi = 
-00027280: 726f 692e 636c 6f6e 6528 290a 2020 2020  roi.clone().    
-00027290: 2020 2020 2020 2020 2320 4372 6f70 2074          # Crop t
-000272a0: 6869 7320 524f 4920 746f 207a 2d65 7874  his ROI to z-ext
-000272b0: 656e 7473 206f 6620 6f74 6865 7220 524f  ents of other RO
-000272c0: 492e 0a20 2020 2020 2020 2020 2020 2069  I..            i
-000272d0: 6620 6d61 7463 685f 6c65 6e67 7468 735f  f match_lengths_
-000272e0: 7374 7261 7465 6779 2069 6e20 5b30 2c20  strategy in [0, 
-000272f0: 325d 3a0a 2020 2020 2020 2020 2020 2020  2]:.            
-00027300: 2020 2020 726f 6930 2e63 726f 705f 746f      roi0.crop_to
-00027310: 5f72 6f69 5f6c 656e 6774 6828 726f 6929  _roi_length(roi)
-00027320: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
-00027330: 726f 7020 6f74 6865 7220 524f 4920 746f  rop other ROI to
-00027340: 207a 2d65 7874 656e 7473 206f 6620 7468   z-extents of th
-00027350: 6973 2052 4f49 2e0a 2020 2020 2020 2020  is ROI..        
-00027360: 2020 2020 6966 206d 6174 6368 5f6c 656e      if match_len
-00027370: 6774 6873 5f73 7472 6174 6567 7920 696e  gths_strategy in
-00027380: 205b 312c 2032 5d3a 0a20 2020 2020 2020   [1, 2]:.       
-00027390: 2020 2020 2020 2020 2072 6f69 2e63 726f           roi.cro
-000273a0: 705f 746f 5f72 6f69 5f6c 656e 6774 6828  p_to_roi_length(
-000273b0: 726f 6930 290a 0a20 2020 2020 2020 2023  roi0)..        #
-000273c0: 2044 6566 6175 6c74 206d 6574 7269 6373   Default metrics
-000273d0: 0a20 2020 2020 2020 2069 6620 6d65 7472  .        if metr
-000273e0: 6963 7320 6973 204e 6f6e 653a 0a20 2020  ics is None:.   
-000273f0: 2020 2020 2020 2020 206d 6574 7269 6373           metrics
-00027400: 203d 205b 2264 6963 6522 2c20 2263 656e   = ["dice", "cen
-00027410: 7472 6f69 6422 5d0a 0a20 2020 2020 2020  troid"]..       
-00027420: 2023 2044 6566 6175 6c74 2073 6c69 6365   # Default slice
-00027430: 7320 746f 2063 6f6e 7369 6465 7220 666f  s to consider fo
-00027440: 7220 736c 6963 652d 6279 2d73 6c69 6365  r slice-by-slice
-00027450: 206d 6574 7269 6320 6361 6c63 756c 6174   metric calculat
-00027460: 696f 6e73 2e0a 2020 2020 2020 2020 6465  ions..        de
-00027470: 6661 756c 745f 6279 5f73 6c69 6365 203d  fault_by_slice =
-00027480: 2073 6b72 742e 636f 7265 2e44 6566 6175   skrt.core.Defau
-00027490: 6c74 7328 292e 6279 5f73 6c69 6365 0a0a  lts().by_slice..
-000274a0: 2020 2020 2020 2020 2320 496e 6974 6961          # Initia
-000274b0: 6c69 7365 2076 6172 6961 626c 6573 2066  lise variables f
-000274c0: 6f72 2064 6973 7461 6e63 6520 6d65 7472  or distance metr
-000274d0: 6963 732e 0a20 2020 2020 2020 2063 6f6e  ics..        con
-000274e0: 666f 726d 6974 7920 3d20 4e6f 6e65 0a20  formity = None. 
-000274f0: 2020 2020 2020 2063 6f6e 666f 726d 6974         conformit
-00027500: 795f 666c 6174 203d 204e 6f6e 650a 2020  y_flat = None.  
-00027510: 2020 2020 2020 6469 7374 616e 6365 7320        distances 
-00027520: 3d20 4e6f 6e65 0a20 2020 2020 2020 2064  = None.        d
-00027530: 6973 7461 6e63 6573 5f66 6c61 7420 3d20  istances_flat = 
-00027540: 4e6f 6e65 0a20 2020 2020 2020 2073 6967  None.        sig
-00027550: 6e65 645f 6469 7374 616e 6365 7320 3d20  ned_distances = 
-00027560: 4e6f 6e65 0a20 2020 2020 2020 2073 6967  None.        sig
-00027570: 6e65 645f 6469 7374 616e 6365 735f 666c  ned_distances_fl
-00027580: 6174 203d 204e 6f6e 650a 0a20 2020 2020  at = None..     
-00027590: 2020 2023 2049 6620 6e6f 2069 6e64 6578     # If no index
-000275a0: 2067 6976 656e 2c20 7573 6520 6365 6e74   given, use cent
-000275b0: 7261 6c20 736c 6963 650a 2020 2020 2020  ral slice.      
-000275c0: 2020 6966 2073 6c20 6973 204e 6f6e 6520    if sl is None 
-000275d0: 616e 6420 6964 7820 6973 204e 6f6e 6520  and idx is None 
-000275e0: 616e 6420 706f 7320 6973 204e 6f6e 653a  and pos is None:
-000275f0: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
-00027600: 203d 2072 6f69 302e 6765 745f 6d69 645f   = roi0.get_mid_
-00027610: 6964 7828 7669 6577 290a 0a20 2020 2020  idx(view)..     
-00027620: 2020 2023 2043 6f6d 7075 7465 206d 6574     # Compute met
-00027630: 7269 6373 0a20 2020 2020 2020 2063 6f6d  rics.        com
-00027640: 7020 3d20 7b7d 0a20 2020 2020 2020 2073  p = {}.        s
-00027650: 6c69 6365 5f6b 7761 7267 7320 3d20 7b0a  lice_kwargs = {.
-00027660: 2020 2020 2020 2020 2020 2020 2273 696e              "sin
-00027670: 676c 655f 736c 6963 6522 3a20 5472 7565  gle_slice": True
-00027680: 2c0a 2020 2020 2020 2020 2020 2020 2276  ,.            "v
-00027690: 6965 7722 3a20 7669 6577 2c0a 2020 2020  iew": view,.    
-000276a0: 2020 2020 2020 2020 2273 6c22 3a20 736c          "sl": sl
-000276b0: 2c0a 2020 2020 2020 2020 2020 2020 2269  ,.            "i
-000276c0: 6478 223a 2069 6478 2c0a 2020 2020 2020  dx": idx,.      
-000276d0: 2020 2020 2020 2270 6f73 223a 2070 6f73        "pos": pos
-000276e0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
-000276f0: 2020 2020 666f 7220 6d20 696e 206d 6574      for m in met
-00027700: 7269 6373 3a0a 2020 2020 2020 2020 2020  rics:.          
-00027710: 2020 6966 206d 206e 6f74 2069 6e20 6765    if m not in ge
-00027720: 745f 636f 6d70 6172 6973 6f6e 5f6d 6574  t_comparison_met
-00027730: 7269 6373 2829 3a0a 2020 2020 2020 2020  rics():.        
-00027740: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
-00027750: 6e74 696d 6545 7272 6f72 2866 224d 6574  ntimeError(f"Met
-00027760: 7269 6320 7b6d 7d20 6e6f 7420 7265 636f  ric {m} not reco
-00027770: 676e 6973 6564 2062 7920 220a 2020 2020  gnised by ".    
+000253d0: 206e 6567 6174 6976 6520 6469 7374 616e   negative distan
+000253e0: 6365 7320 746f 2063 6f6e 666f 726d 6974  ces to conformit
+000253f0: 792c 2064 6976 6964 6564 2062 7920 766f  y, divided by vo
+00025400: 6c75 6d65 2c0a 2020 2020 2020 2020 2020  lume,.          
+00025410: 2020 2020 2020 2020 666c 6174 7465 6e65          flattene
+00025420: 6420 696e 2074 6865 206f 7269 656e 7461  d in the orienta
+00025430: 7469 6f6e 2073 7065 6369 6669 6564 2069  tion specified i
+00025440: 6e20 3c76 6965 773e 2e0a 2020 2020 2020  n <view>..      
+00025450: 2020 2020 2020 2020 2020 2020 696e 2075              in u
+00025460: 6e69 6f6e 206f 6620 524f 4973 2063 6f6d  nion of ROIs com
+00025470: 7061 7265 642e 0a20 2020 2020 2020 2020  pared..         
+00025480: 2020 2020 2020 202a 2022 6d65 616e 5f6f         * "mean_o
+00025490: 7665 725f 636f 6e74 6f75 7269 6e67 223a  ver_contouring":
+000254a0: 2053 756d 206f 6620 706f 7369 7469 7665   Sum of positive
+000254b0: 2064 6973 7461 6e63 6573 0a20 2020 2020   distances.     
+000254c0: 2020 2020 2020 2020 2020 2020 2074 6f20               to 
+000254d0: 636f 6e66 6f72 6d69 7479 2c20 6469 7669  conformity, divi
+000254e0: 6465 6420 6279 2076 6f6c 756d 6520 696e  ded by volume in
+000254f0: 2075 6e69 6f6e 206f 6620 524f 4973 2063   union of ROIs c
+00025500: 6f6d 7061 7265 642e 0a20 2020 2020 2020  ompared..       
+00025510: 2020 2020 2020 2020 202a 2022 6d65 616e           * "mean
+00025520: 5f6f 7665 725f 636f 6e74 6f75 7269 6e67  _over_contouring
+00025530: 5f66 6c61 7422 3a20 5375 6d20 6f66 2070  _flat": Sum of p
+00025540: 6f73 6974 6976 6520 6469 7374 616e 6365  ositive distance
+00025550: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00025560: 2020 2020 746f 2063 6f6e 666f 726d 6974      to conformit
+00025570: 792c 2064 6976 6964 6564 2062 7920 766f  y, divided by vo
+00025580: 6c75 6d65 2069 6e20 756e 696f 6e20 6f66  lume in union of
+00025590: 2052 4f49 7320 636f 6d70 6172 6564 2c0a   ROIs compared,.
+000255a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000255b0: 2020 666c 6174 7465 6e65 6420 696e 2074    flattened in t
+000255c0: 6865 206f 7269 656e 7461 7469 6f6e 2073  he orientation s
+000255d0: 7065 6369 6669 6564 2069 6e20 3c76 6965  pecified in <vie
+000255e0: 773e 2e0a 2020 2020 2020 2020 2020 2020  w>..            
+000255f0: 2020 2020 2a20 226d 6561 6e5f 6469 7374      * "mean_dist
+00025600: 616e 6365 5f74 6f5f 636f 6e66 6f72 6d69  ance_to_conformi
+00025610: 7479 223a 2053 756d 206f 6620 6d65 616e  ty": Sum of mean
+00025620: 5f75 6e64 6572 5f63 6f6e 746f 7572 696e  _under_contourin
+00025630: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
+00025640: 2020 2020 616e 6420 6d65 616e 5f6f 7665      and mean_ove
+00025650: 725f 636f 6e74 6f75 7269 6e67 2e0a 2020  r_contouring..  
+00025660: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
+00025670: 226d 6561 6e5f 6469 7374 616e 6365 5f74  "mean_distance_t
+00025680: 6f5f 636f 6e66 6f72 6d69 7479 5f66 6c61  o_conformity_fla
+00025690: 7422 3a20 5375 6d20 6f66 0a20 2020 2020  t": Sum of.     
+000256a0: 2020 2020 2020 2020 2020 2020 206d 6561               mea
+000256b0: 6e5f 756e 6465 725f 636f 6e74 6f75 7269  n_under_contouri
+000256c0: 6e67 5f66 6c61 7420 616e 6420 6d65 616e  ng_flat and mean
+000256d0: 5f6f 7665 725f 636f 6e74 6f75 7269 6e67  _over_contouring
+000256e0: 5f66 6c61 742e 0a0a 2020 2020 2020 2020  _flat...        
+000256f0: 2020 2020 4966 204e 6f6e 652c 2064 6566      If None, def
+00025700: 6175 6c74 7320 746f 205b 2264 6963 6522  aults to ["dice"
+00025710: 2c20 2263 656e 7472 6f69 6422 5d2e 0a0a  , "centroid"]...
+00025720: 2020 2020 2020 2020 766f 6c5f 756e 6974          vol_unit
+00025730: 7320 3a20 7374 722c 2064 6566 6175 6c74  s : str, default
+00025740: 3d22 6d6d 220a 2020 2020 2020 2020 2020  ="mm".          
+00025750: 2020 556e 6974 7320 746f 2075 7365 2066    Units to use f
+00025760: 6f72 2076 6f6c 756d 652e 2043 616e 2062  or volume. Can b
+00025770: 6520 226d 6d22 2028 3d6d 6d5e 3329 2c20  e "mm" (=mm^3), 
+00025780: 226d 6c22 2c0a 2020 2020 2020 2020 2020  "ml",.          
+00025790: 2020 6f72 2022 766f 7865 6c73 222e 0a0a    or "voxels"...
+000257a0: 2020 2020 2020 2020 6172 6561 5f75 6e69          area_uni
+000257b0: 7473 203a 2073 7472 2c20 6465 6661 756c  ts : str, defaul
+000257c0: 743d 226d 6d22 0a20 2020 2020 2020 2020  t="mm".         
+000257d0: 2020 2055 6e69 7473 2074 6f20 7573 6520     Units to use 
+000257e0: 666f 7220 6172 6561 732e 2043 616e 2062  for areas. Can b
+000257f0: 6520 226d 6d22 2028 3d6d 6d5e 3229 206f  e "mm" (=mm^2) o
+00025800: 7220 2276 6f78 656c 7322 2e0a 0a20 2020  r "voxels"...   
+00025810: 2020 2020 2063 656e 7472 6f69 645f 756e       centroid_un
+00025820: 6974 733a 0a20 2020 2020 2020 2020 2020  its:.           
+00025830: 2055 6e69 7473 2074 6f20 7573 6520 666f   Units to use fo
+00025840: 7220 6365 6e74 726f 6964 732e 2043 616e  r centroids. Can
+00025850: 2062 6520 226d 6d22 206f 7220 2276 6f78   be "mm" or "vox
+00025860: 656c 7322 2e0a 0a20 2020 2020 2020 2076  els"...        v
+00025870: 6965 7720 3a20 7374 722c 2064 6566 6175  iew : str, defau
+00025880: 6c74 3d22 782d 7922 0a20 2020 2020 2020  lt="x-y".       
+00025890: 2020 2020 204f 7269 656e 7461 7469 6f6e       Orientation
+000258a0: 2069 6e20 7768 6963 6820 746f 2063 6f6d   in which to com
+000258b0: 7075 7465 206d 6574 7269 6373 2e20 4f6e  pute metrics. On
+000258c0: 6c79 2072 656c 6576 616e 7420 666f 7220  ly relevant for 
+000258d0: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
+000258e0: 676c 652d 736c 6963 6520 6d65 7472 6963  gle-slice metric
+000258f0: 7320 6f72 2066 6c61 7474 656e 6564 206d  s or flattened m
+00025900: 6574 7269 6373 2e0a 0a20 2020 2020 2020  etrics...       
+00025910: 2073 6c20 3a20 696e 742c 2064 6566 6175   sl : int, defau
+00025920: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00025930: 2020 2020 536c 6963 6520 6e75 6d62 6572      Slice number
+00025940: 206f 6e20 7768 6963 6820 746f 2063 6f6d   on which to com
+00025950: 7075 7465 206d 6574 7269 6373 2e20 4f6e  pute metrics. On
+00025960: 6c79 2072 656c 6576 616e 7420 666f 7220  ly relevant for 
+00025970: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
+00025980: 676c 652d 736c 6963 6520 6d65 7472 6963  gle-slice metric
+00025990: 7320 2861 7265 612c 2063 656e 7472 6f69  s (area, centroi
+000259a0: 645f 736c 6963 652c 206c 656e 6774 685f  d_slice, length_
+000259b0: 736c 6963 6529 2e0a 2020 2020 2020 2020  slice)..        
+000259c0: 2020 2020 4966 203c 736c 3e2c 203c 6964      If <sl>, <id
+000259d0: 783e 2c20 616e 6420 3c70 6f73 3e20 6172  x>, and <pos> ar
+000259e0: 6520 616c 6c20 4e6f 6e65 2c20 7468 6520  e all None, the 
+000259f0: 6365 6e74 7261 6c20 736c 6963 6520 6f66  central slice of
+00025a00: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00025a10: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
+00025a20: 642e 0a0a 2020 2020 2020 2020 6964 7820  d...        idx 
+00025a30: 3a20 696e 742c 2064 6566 6175 6c74 3d4e  : int, default=N
+00025a40: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00025a50: 536c 6963 6520 696e 6465 7820 6172 7261  Slice index arra
+00025a60: 7920 6f6e 2077 6869 6368 2074 6f20 636f  y on which to co
+00025a70: 6d70 7574 6520 6d65 7472 6963 732e 204f  mpute metrics. O
+00025a80: 6e6c 7920 7265 6c65 7661 6e74 2066 6f72  nly relevant for
+00025a90: 200a 2020 2020 2020 2020 2020 2020 7369   .            si
+00025aa0: 6e67 6c65 2d73 6c69 6365 206d 6574 7269  ngle-slice metri
+00025ab0: 6373 2028 6172 6561 2c20 6365 6e74 726f  cs (area, centro
+00025ac0: 6964 5f73 6c69 6365 2c20 6c65 6e67 7468  id_slice, length
+00025ad0: 5f73 6c69 6365 292e 0a20 2020 2020 2020  _slice)..       
+00025ae0: 2020 2020 2055 7365 6420 6966 203c 736c       Used if <sl
+00025af0: 3e20 6973 204e 6f6e 652e 0a0a 2020 2020  > is None...    
+00025b00: 2020 2020 706f 7320 3a20 666c 6f61 742c      pos : float,
+00025b10: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00025b20: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
+00025b30: 706f 7369 7469 6f6e 2069 6e20 6d6d 206f  position in mm o
+00025b40: 6e20 7768 6963 6820 746f 2063 6f6d 7075  n which to compu
+00025b50: 7465 206d 6574 7269 6373 2e20 4f6e 6c79  te metrics. Only
+00025b60: 2072 656c 6576 616e 7420 666f 7220 0a20   relevant for . 
+00025b70: 2020 2020 2020 2020 2020 2073 696e 676c             singl
+00025b80: 652d 736c 6963 6520 6d65 7472 6963 7320  e-slice metrics 
+00025b90: 2861 7265 612c 2063 656e 7472 6f69 645f  (area, centroid_
+00025ba0: 736c 6963 652c 206c 656e 6774 685f 736c  slice, length_sl
+00025bb0: 6963 6529 2e0a 2020 2020 2020 2020 2020  ice)..          
+00025bc0: 2020 5573 6564 2069 6620 3c73 6c3e 2061    Used if <sl> a
+00025bd0: 6e64 203c 6964 783e 2061 7265 2062 6f74  nd <idx> are bot
+00025be0: 6820 4e6f 6e65 2e0a 0a20 2020 2020 2020  h None...       
+00025bf0: 206d 6574 686f 6420 3a20 7374 722c 2064   method : str, d
+00025c00: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00025c10: 2020 2020 2020 2020 4d65 7468 6f64 2074          Method t
+00025c20: 6f20 7573 6520 666f 7220 6d65 7472 6963  o use for metric
+00025c30: 2063 616c 6375 6c61 7469 6f6e 2e20 4361   calculation. Ca
+00025c40: 6e20 6265 2065 6974 6865 7220 2263 6f6e  n be either "con
+00025c50: 746f 7572 2220 0a20 2020 2020 2020 2020  tour" .         
+00025c60: 2020 2028 7573 6520 7368 6170 656c 7920     (use shapely 
+00025c70: 706f 6c79 676f 6e73 2920 6f72 2022 6d61  polygons) or "ma
+00025c80: 736b 2220 2875 7365 2062 696e 6172 7920  sk" (use binary 
+00025c90: 6d61 736b 292e 2049 6620 4e6f 6e65 2c0a  mask). If None,.
+00025ca0: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+00025cb0: 7661 6c75 6520 7365 7420 696e 2073 656c  value set in sel
+00025cc0: 662e 6465 6661 756c 745f 6765 6f6d 5f6d  f.default_geom_m
+00025cd0: 6574 686f 6420 7769 6c6c 2062 6520 7573  ethod will be us
+00025ce0: 6564 2e20 4e6f 7465 200a 2020 2020 2020  ed. Note .      
+00025cf0: 2020 2020 2020 7468 6174 2066 6c61 7474        that flatt
+00025d00: 656e 6564 206d 6574 7269 6373 2061 6e64  ened metrics and
+00025d10: 2073 7572 6661 6365 2064 6973 7461 6e63   surface distanc
+00025d20: 6520 6d65 7472 6963 7320 656e 666f 7263  e metrics enforc
+00025d30: 6520 7573 650a 2020 2020 2020 2020 2020  e use.          
+00025d40: 2020 6f66 2074 6865 2022 6d61 736b 2220    of the "mask" 
+00025d50: 6d65 7468 6f64 2e0a 0a20 2020 2020 2020  method...       
+00025d60: 2073 6c69 6365 5f73 7461 7473 203a 2073   slice_stats : s
+00025d70: 7472 2f6c 6973 742f 6469 6374 2c20 6465  tr/list/dict, de
+00025d80: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00025d90: 2020 2020 2020 2053 7065 6369 6669 6361         Specifica
+00025da0: 7469 6f6e 206f 6620 7374 6174 6973 7469  tion of statisti
+00025db0: 6373 2074 6f20 6265 2063 616c 6375 6c61  cs to be calcula
+00025dc0: 7465 6420 7265 6c61 7469 7665 0a20 2020  ted relative.   
+00025dd0: 2020 2020 2020 2020 2074 6f20 736c 6963           to slic
+00025de0: 652d 6279 2d73 6c69 6365 206d 6574 7269  e-by-slice metri
+00025df0: 6320 7661 6c75 6573 2e20 2055 7365 6420  c values.  Used 
+00025e00: 666f 7220 616c 6c20 6d65 7472 6963 7320  for all metrics 
+00025e10: 7769 7468 0a20 2020 2020 2020 2020 2020  with.           
+00025e20: 2073 7566 6669 7820 225f 736c 6963 655f   suffix "_slice_
+00025e30: 7374 6174 7322 2069 6e20 7468 6520 3c6d  stats" in the <m
+00025e40: 6574 7269 6373 3e20 6c69 7374 2e0a 0a20  etrics> list... 
+00025e50: 2020 2020 2020 2020 2020 2041 2073 7461             A sta
+00025e60: 7469 7374 6963 2069 7320 7370 6563 6966  tistic is specif
+00025e70: 6965 6420 6279 2074 6865 206e 616d 6520  ied by the name 
+00025e80: 6f66 2074 6865 2066 756e 6374 696f 6e20  of the function 
+00025e90: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+00025ea0: 6974 7320 6361 6c63 756c 6174 696f 6e20  its calculation 
+00025eb0: 696e 2074 6865 2050 7974 686f 6e20 7374  in the Python st
+00025ec0: 6174 6973 7469 6373 206d 6f64 756c 653a  atistics module:
+00025ed0: 0a0a 2020 2020 2020 2020 2020 2020 6874  ..            ht
+00025ee0: 7470 733a 2f2f 646f 6373 2e70 7974 686f  tps://docs.pytho
+00025ef0: 6e2e 6f72 672f 332f 6c69 6272 6172 792f  n.org/3/library/
+00025f00: 7374 6174 6973 7469 6373 2e68 746d 6c0a  statistics.html.
+00025f10: 0a20 2020 2020 2020 2020 2020 2046 6f72  .            For
+00025f20: 2069 7473 2075 7365 2068 6572 652c 2074   its use here, t
+00025f30: 6865 2072 656c 6576 616e 7420 6675 6e63  he relevant func
+00025f40: 7469 6f6e 206d 7573 7420 7265 7175 6972  tion must requir
+00025f50: 650a 2020 2020 2020 2020 2020 2020 6120  e.            a 
+00025f60: 7369 6e67 6c65 2d76 6172 6961 626c 6520  single-variable 
+00025f70: 696e 7075 742c 206d 7573 7420 6e6f 7420  input, must not 
+00025f80: 7265 7175 6972 6520 616e 7920 6b65 7977  require any keyw
+00025f90: 6f72 640a 2020 2020 2020 2020 2020 2020  ord.            
+00025fa0: 6172 6775 6d65 6e74 732c 2061 6e64 206d  arguments, and m
+00025fb0: 7573 7420 7265 7475 726e 2061 2073 696e  ust return a sin
+00025fc0: 676c 6520 6e75 6d62 6572 2e0a 0a20 2020  gle number...   
+00025fd0: 2020 2020 2020 2020 2041 7661 696c 6162           Availab
+00025fe0: 6c65 206f 7074 696f 6e73 2069 6e63 6c75  le options inclu
+00025ff0: 6465 3a20 226d 6561 6e22 2c20 226d 6564  de: "mean", "med
+00026000: 6961 6e22 2c20 226d 6f64 6522 2c0a 2020  ian", "mode",.  
+00026010: 2020 2020 2020 2020 2020 2273 7464 6576            "stdev
+00026020: 222e 0a0a 2020 2020 2020 2020 2020 2053  "...           S
+00026030: 7461 7469 7374 6963 7320 746f 2062 6520  tatistics to be 
+00026040: 6361 6c63 756c 6174 6564 2063 616e 2062  calculated can b
+00026050: 6520 7370 6563 6966 6965 6420 7573 696e  e specified usin
+00026060: 6720 616e 7920 6f66 0a20 2020 2020 2020  g any of.       
+00026070: 2020 2020 7468 6520 666f 6c6c 6f77 696e      the followin
+00026080: 673a 0a0a 2020 2020 2020 2020 2020 202d  g:..           -
+00026090: 2053 7472 696e 6720 7370 6563 6966 7969   String specifyi
+000260a0: 6e67 2073 696e 676c 6520 7374 6174 6973  ng single statis
+000260b0: 7469 6320 746f 2062 6520 6361 6c63 756c  tic to be calcul
+000260c0: 6174 6564 2c0a 2020 2020 2020 2020 2020  ated,.          
+000260d0: 2020 2077 6974 6820 736c 6963 6573 2063     with slices c
+000260e0: 6f6e 7369 6465 7265 6420 6173 2067 6976  onsidered as giv
+000260f0: 656e 2062 7920 6465 6661 756c 745f 6279  en by default_by
+00026100: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
+00026110: 2020 2020 2066 6f72 2065 7861 6d70 6c65       for example
+00026120: 3a20 226d 6561 6e22 3b0a 2020 2020 2020  : "mean";.      
+00026130: 2020 2020 202d 204c 6973 7420 7370 6563       - List spec
+00026140: 6966 7969 6e67 206d 756c 7469 706c 6520  ifying multiple 
+00026150: 7374 6174 6973 7469 6373 2074 6f20 6265  statistics to be
+00026160: 2063 616c 6375 6c61 7465 642c 0a20 2020   calculated,.   
+00026170: 2020 2020 2020 2020 2020 7769 7468 2073            with s
+00026180: 6c69 6365 7320 636f 6e73 6964 6572 6564  lices considered
+00026190: 2061 7320 6769 7665 6e20 6279 2064 6566   as given by def
+000261a0: 6175 6c74 5f62 795f 736c 6963 652c 0a20  ault_by_slice,. 
+000261b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000261c0: 6578 616d 706c 653a 205b 226d 6561 6e22  example: ["mean"
+000261d0: 2c20 2273 7464 6576 225d 3b0a 2020 2020  , "stdev"];.    
+000261e0: 2020 2020 2020 202d 2044 6963 7469 6f6e         - Diction
+000261f0: 6172 7920 7768 6572 6520 6b65 7973 2073  ary where keys s
+00026200: 7065 6369 6679 2073 6c69 6365 7320 746f  pecify slices to
+00026210: 2062 6520 636f 6e73 6964 6572 6564 2c0a   be considered,.
+00026220: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+00026230: 2076 616c 7565 7320 7370 6563 6966 7920   values specify 
+00026240: 7374 6174 6973 7469 6373 2028 7374 7269  statistics (stri
+00026250: 6e67 206f 7220 6c69 7374 292c 2066 6f72  ng or list), for
+00026260: 0a20 2020 2020 2020 2020 2020 2020 6578  .             ex
+00026270: 616d 706c 653a 207b 2275 6e69 6f6e 223a  ample: {"union":
+00026280: 205b 226d 6561 6e22 2c20 2273 7464 6576   ["mean", "stdev
+00026290: 225d 7d2e 2020 5661 6c69 6420 736c 6963  "]}.  Valid slic
+000262a0: 650a 2020 2020 2020 2020 2020 2020 2073  e.             s
+000262b0: 7065 6369 6669 6361 7469 6f6e 7320 6172  pecifications ar
+000262c0: 6520 6173 206c 6973 7465 6420 666f 7220  e as listed for 
+000262d0: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
+000262e0: 2e0a 0a20 2020 2020 2020 2064 6566 6175  ...        defau
+000262f0: 6c74 5f62 795f 736c 6963 653a 2073 7472  lt_by_slice: str
+00026300: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+00026310: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
+00026320: 6c74 2073 7065 6369 6669 6361 7469 6f6e  lt specification
+00026330: 206f 6620 736c 6963 6573 2074 6f20 6265   of slices to be
+00026340: 2063 6f6e 7369 6465 7265 6420 7768 656e   considered when
+00026350: 0a20 2020 2020 2020 2020 2020 2063 616c  .            cal
+00026360: 6375 6c61 7469 6e67 2073 6c69 6365 2d62  culating slice-b
+00026370: 792d 736c 6963 6520 7374 6174 6973 7469  y-slice statisti
+00026380: 6373 2e20 2054 6865 2076 616c 6964 2073  cs.  The valid s
+00026390: 7065 6369 6669 6361 7469 6f6e 730a 2020  pecifications.  
+000263a0: 2020 2020 2020 2020 2020 6172 653a 0a0a            are:..
+000263b0: 2020 2020 2020 2020 2020 2020 2d20 226c              - "l
+000263c0: 6566 7422 3a20 636f 6e73 6964 6572 206f  eft": consider o
+000263d0: 6e6c 7920 736c 6963 6573 2063 6f6e 7461  nly slices conta
+000263e0: 696e 696e 6720 7365 6c66 3b0a 2020 2020  ining self;.    
+000263f0: 2020 2020 2020 2020 2d20 2272 6967 6874          - "right
+00026400: 223a 2063 6f6e 7369 6465 7220 6f6e 6c79  ": consider only
+00026410: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
+00026420: 6e67 206f 7468 6572 2072 6f69 3b0a 2020  ng other roi;.  
+00026430: 2020 2020 2020 2020 2020 2d20 2275 6e69            - "uni
+00026440: 6f6e 223a 2063 6f6e 7369 6465 7220 736c  on": consider sl
+00026450: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
+00026460: 6569 7468 6572 206f 6620 7365 6c66 2061  either of self a
+00026470: 6e64 206f 7468 6572 2072 6f69 3b0a 2020  nd other roi;.  
+00026480: 2020 2020 2020 2020 2020 2d20 2269 6e74            - "int
+00026490: 6572 7365 6374 696f 6e22 3a20 636f 6e73  ersection": cons
+000264a0: 6964 6572 2073 6c69 6365 7320 636f 6e74  ider slices cont
+000264b0: 6169 6e69 6e67 2062 6f74 6820 6f66 2073  aining both of s
+000264c0: 656c 6620 616e 640a 2020 2020 2020 2020  elf and.        
+000264d0: 2020 2020 2020 6f74 6865 7220 726f 692e        other roi.
+000264e0: 0a0a 2020 2020 2020 2020 2020 2020 4966  ..            If
+000264f0: 204e 6f6e 652c 2075 7365 2073 6b72 742e   None, use skrt.
+00026500: 636f 7265 2e44 6566 6175 6c74 7328 292e  core.Defaults().
+00026510: 6279 5f73 6c69 6365 0a0a 2020 2020 2020  by_slice..      
+00026520: 2020 756e 6974 735f 696e 5f68 6561 6465    units_in_heade
+00026530: 7220 3a20 626f 6f6c 2c20 6465 6661 756c  r : bool, defaul
+00026540: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
+00026550: 2020 2020 4966 2054 7275 652c 2075 6e69      If True, uni
+00026560: 7473 2077 696c 6c20 6265 2069 6e63 6c75  ts will be inclu
+00026570: 6465 6420 696e 2063 6f6c 756d 6e20 6865  ded in column he
+00026580: 6164 6572 732e 0a0a 2020 2020 2020 2020  aders...        
+00026590: 676c 6f62 616c 5f76 735f 736c 6963 655f  global_vs_slice_
+000265a0: 6865 6164 6572 203a 2062 6f6f 6c2c 2064  header : bool, d
+000265b0: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
+000265c0: 2020 2020 2020 2020 2049 6620 5472 7565           If True
+000265d0: 2c20 7468 6520 7265 7475 726e 6564 2044  , the returned D
+000265e0: 6174 6146 7261 6d65 2077 696c 6c20 6861  ataFrame will ha
+000265f0: 7665 2061 6e20 6578 7472 6120 7365 7420  ve an extra set 
+00026600: 6f66 2068 6561 6465 7273 0a20 2020 2020  of headers.     
+00026610: 2020 2020 2020 2073 706c 6974 7469 6e67         splitting
+00026620: 2074 6865 2074 6162 6c65 2069 6e74 6f20   the table into 
+00026630: 2267 6c6f 6261 6c22 2061 6e64 2022 736c  "global" and "sl
+00026640: 6963 6522 206d 6574 7269 6373 2e0a 0a20  ice" metrics... 
+00026650: 2020 2020 2020 206e 616d 655f 6173 5f69         name_as_i
+00026660: 6e64 6578 203a 2062 6f6f 6c2c 2064 6566  ndex : bool, def
+00026670: 6175 6c74 3d54 7275 650a 2020 2020 2020  ault=True.      
+00026680: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
+00026690: 6865 2069 6e64 6578 2063 6f6c 756d 6e20  he index column 
+000266a0: 6f66 2074 6865 2070 616e 6461 7320 4461  of the pandas Da
+000266b0: 7461 4672 616d 6520 7769 6c6c 200a 2020  taFrame will .  
+000266c0: 2020 2020 2020 2020 2020 636f 6e74 6169            contai
+000266d0: 6e20 7468 6520 524f 4927 7320 6e61 6d65  n the ROI's name
+000266e0: 733b 206f 7468 6572 7769 7365 2c20 7468  s; otherwise, th
+000266f0: 6520 6e61 6d65 2077 696c 6c20 6170 7065  e name will appe
+00026700: 6172 2069 6e20 6120 636f 6c75 6d6e 0a20  ar in a column. 
+00026710: 2020 2020 2020 2020 2020 206e 616d 6564             named
+00026720: 2022 524f 4922 2e0a 0a20 2020 2020 2020   "ROI"...       
+00026730: 206e 6963 655f 636f 6c75 6d6e 7320 3a20   nice_columns : 
+00026740: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
+00026750: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00026760: 4966 2046 616c 7365 2c20 636f 6c75 6d6e  If False, column
+00026770: 206e 616d 6573 2077 696c 6c20 6265 2074   names will be t
+00026780: 6865 2073 616d 6520 6173 2074 6865 2069  he same as the i
+00026790: 6e70 7574 206d 6574 7269 6373 206e 616d  nput metrics nam
+000267a0: 6573 3b0a 2020 2020 2020 2020 2020 2020  es;.            
+000267b0: 6966 2054 7275 652c 2074 6865 206e 616d  if True, the nam
+000267c0: 6573 2077 696c 6c20 6265 2063 6170 6974  es will be capit
+000267d0: 616c 697a 6564 2061 6e64 2075 6e64 6572  alized and under
+000267e0: 7363 6f72 6573 2077 696c 6c20 6265 200a  scores will be .
+000267f0: 2020 2020 2020 2020 2020 2020 7265 706c              repl
+00026800: 6163 6564 2077 6974 6820 7370 6163 6573  aced with spaces
+00026810: 2e0a 0a20 2020 2020 2020 2064 6563 696d  ...        decim
+00026820: 616c 5f70 6c61 6365 7320 3a20 696e 742c  al_places : int,
+00026830: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00026840: 2020 2020 2020 2020 2020 4e75 6d62 6572            Number
+00026850: 206f 6620 6465 6369 6d61 6c20 706c 6163   of decimal plac
+00026860: 6573 2074 6f20 6b65 6570 2066 6f72 2065  es to keep for e
+00026870: 6163 6820 6d65 7472 6963 2e20 4966 204e  ach metric. If N
+00026880: 6f6e 652c 2066 756c 6c0a 2020 2020 2020  one, full.      
+00026890: 2020 2020 2020 7072 6563 6973 696f 6e20        precision 
+000268a0: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
+000268b0: 2020 2020 2020 2066 6f72 6365 203a 2062         force : b
+000268c0: 6f6f 6c2c 2064 6566 6175 6c74 3d54 7275  ool, default=Tru
+000268d0: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+000268e0: 2046 616c 7365 2c20 676c 6f62 616c 206d   False, global m
+000268f0: 6574 7269 6373 2066 6f72 2065 6163 6820  etrics for each 
+00026900: 524f 4920 2876 6f6c 756d 652c 2033 4420  ROI (volume, 3D 
+00026910: 6365 6e74 726f 6964 2c20 0a20 2020 2020  centroid, .     
+00026920: 2020 2020 2020 2033 4420 6c65 6e67 7468         3D length
+00026930: 7329 2077 696c 6c20 6f6e 6c79 2062 6520  s) will only be 
+00026940: 6361 6c63 756c 6174 6564 2069 6620 7468  calculated if th
+00026950: 6579 2068 6176 6520 6e6f 7420 6265 656e  ey have not been
+00026960: 200a 2020 2020 2020 2020 2020 2020 6361   .            ca
+00026970: 6c63 756c 6174 6564 2062 6566 6f72 653b  lculated before;
+00026980: 2069 6620 5472 7565 2c20 616c 6c20 6d65   if True, all me
+00026990: 7472 6963 7320 7769 6c6c 2062 6520 7265  trics will be re
+000269a0: 6361 6c63 756c 6174 6564 2e0a 0a20 2020  calculated...   
+000269b0: 2020 2020 2076 6f78 656c 5f73 697a 6520       voxel_size 
+000269c0: 3a20 7475 706c 652c 2064 6566 6175 6c74  : tuple, default
+000269d0: 3d28 312c 2031 2c20 3129 0a20 2020 2020  =(1, 1, 1).     
+000269e0: 2020 2020 2020 2056 6f78 656c 2073 697a         Voxel siz
+000269f0: 6520 2864 782c 2064 792c 2064 7a29 2069  e (dx, dy, dz) i
+00026a00: 6e20 6d6d 2074 6f20 6265 2075 7365 6420  n mm to be used 
+00026a10: 666f 7220 524f 4920 6d61 736b 730a 2020  for ROI masks.  
+00026a20: 2020 2020 2020 2020 2020 6672 6f6d 2077            from w
+00026a30: 6869 6368 2074 6f20 6361 6c63 756c 6174  hich to calculat
+00026a40: 6520 7375 7266 6163 6520 6469 7374 616e  e surface distan
+00026a50: 6365 732e 2020 4966 204e 6f6e 652c 0a20  ces.  If None,. 
+00026a60: 2020 2020 2020 2020 2020 2074 6865 206d             the m
+00026a70: 6173 6b20 766f 7865 6c20 7369 7a65 206f  ask voxel size o
+00026a80: 6620 3c6f 7468 6572 3e20 6973 2075 7365  f <other> is use
+00026a90: 642e 2020 4966 2061 6e20 696e 6469 7669  d.  If an indivi
+00026aa0: 6475 616c 0a20 2020 2020 2020 2020 2020  dual.           
+00026ab0: 2065 6c65 6d65 6e74 2069 7320 4e6f 6e65   element is None
+00026ac0: 2c20 7468 6520 7661 6c75 6520 6f66 2074  , the value of t
+00026ad0: 6865 2063 6f72 7265 7370 6f6e 6469 6e67  he corresponding
+00026ae0: 2065 6c65 6d65 6e74 2066 6f72 0a20 2020   element for.   
+00026af0: 2020 2020 2020 2020 2074 6865 206d 6173           the mas
+00026b00: 6b20 766f 7865 6c20 7369 7a65 206f 6620  k voxel size of 
+00026b10: 3c6f 7468 6572 3e20 6973 2075 7365 642e  <other> is used.
+00026b20: 2020 4120 7661 6c75 650a 2020 2020 2020    A value.      
+00026b30: 2020 2020 2020 6f74 6865 7220 7468 616e        other than
+00026b40: 204e 6f6e 6520 666f 7263 6573 2063 7265   None forces cre
+00026b50: 6174 696f 6e20 6f66 206d 6173 6b73 2074  ation of masks t
+00026b60: 6861 7420 6a75 7374 2063 6f76 6572 0a20  hat just cover. 
+00026b70: 2020 2020 2020 2020 2020 2074 6865 2076             the v
+00026b80: 6f6c 756d 6520 6f63 6375 7069 6564 2062  olume occupied b
+00026b90: 7920 7468 6520 7477 6f20 524f 4973 2062  y the two ROIs b
+00026ba0: 6569 6e67 2063 6f6d 7061 7265 642c 0a20  eing compared,. 
+00026bb0: 2020 2020 2020 2020 2020 2070 6f74 656e             poten
+00026bc0: 7469 616c 6c79 2072 6564 7563 696e 6720  tially reducing 
+00026bd0: 7468 6520 7469 6d65 2066 6f72 2073 7572  the time for sur
+00026be0: 6661 6365 2d64 6973 7461 6e63 6520 6361  face-distance ca
+00026bf0: 6c63 756c 6174 696f 6e73 2e0a 0a20 2020  lculations...   
+00026c00: 2020 2020 206d 6174 6368 5f6c 656e 6774       match_lengt
+00026c10: 6873 203a 2062 6f6f 6c2f 7374 722f 6c69  hs : bool/str/li
+00026c20: 7374 2c20 6465 6661 756c 743d 4661 6c73  st, default=Fals
+00026c30: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+00026c40: 2073 6574 2074 6f20 5472 7565 2c20 746f   set to True, to
+00026c50: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
+00026c60: 206f 7468 6572 2052 4f49 2c20 6f72 2074   other ROI, or t
+00026c70: 6f20 6120 6c69 7374 0a20 2020 2020 2020  o a list.       
+00026c80: 2020 2020 206f 6620 6e61 6d65 7320 696e       of names in
+00026c90: 636c 7564 696e 6720 7468 6520 6e61 6d65  cluding the name
+00026ca0: 206f 6620 7468 6520 6f74 6865 7220 524f   of the other RO
+00026cb0: 492c 206d 6174 6368 2052 4f49 206c 656e  I, match ROI len
+00026cc0: 6774 6873 0a20 2020 2020 2020 2020 2020  gths.           
+00026cd0: 2028 7a2d 6469 6d65 6e73 696f 6e73 2920   (z-dimensions) 
+00026ce0: 6265 666f 7265 2063 6f6d 7061 7269 736f  before compariso
+00026cf0: 6e2e 2020 5468 6520 7374 7261 7465 6779  n.  The strategy
+00026d00: 2075 7365 6420 6973 2064 6566 696e 6564   used is defined
+00026d10: 0a20 2020 2020 2020 2020 2020 2062 7920  .            by 
+00026d20: 7468 6520 7661 6c75 6520 6f66 206d 6174  the value of mat
+00026d30: 6368 5f6c 656e 6774 6873 5f73 7472 6174  ch_lengths_strat
+00026d40: 6567 792e 0a0a 2020 2020 2020 2020 6d61  egy...        ma
+00026d50: 7463 685f 6c65 6e67 7468 735f 7374 7261  tch_lengths_stra
+00026d60: 7465 6779 203a 2069 6e74 2c20 6465 6661  tegy : int, defa
+00026d70: 756c 743d 310a 2020 2020 2020 2020 2020  ult=1.          
+00026d80: 2020 5374 7261 7465 6779 2074 6f20 7573    Strategy to us
+00026d90: 6520 666f 7220 6d61 7463 6869 6e67 2052  e for matching R
+00026da0: 4f49 206c 656e 6774 6873 2028 7a2d 6469  OI lengths (z-di
+00026db0: 6d65 6e73 696f 6e73 293a 0a0a 2020 2020  mensions):..    
+00026dc0: 2020 2020 2020 2020 2d20 3020 3a20 4372          - 0 : Cr
+00026dd0: 6f70 2074 6869 7320 524f 4920 746f 2074  op this ROI to t
+00026de0: 6865 207a 2d65 7874 656e 7473 206f 6620  he z-extents of 
+00026df0: 7468 6520 6f74 6865 7220 524f 493b 0a20  the other ROI;. 
+00026e00: 2020 2020 2020 2020 2020 202d 2031 203a             - 1 :
+00026e10: 2043 726f 7020 7468 6520 6f74 6865 7220   Crop the other 
+00026e20: 524f 4920 746f 2074 6865 207a 2d65 7865  ROI to the z-exe
+00026e30: 6e74 7320 6f66 2074 6869 7320 524f 493b  nts of this ROI;
+00026e40: 0a20 2020 2020 2020 2020 2020 202d 2032  .            - 2
+00026e50: 203a 2043 726f 7020 7468 6973 2052 4f49   : Crop this ROI
+00026e60: 2074 6f20 7468 6520 7a2d 6578 7465 6e74   to the z-extent
+00026e70: 7320 6f66 2074 6865 206f 7468 6572 2052  s of the other R
+00026e80: 4f49 2c20 7468 656e 0a20 2020 2020 2020  OI, then.       
+00026e90: 2020 2020 2020 2020 2020 2063 726f 7020             crop 
+00026ea0: 7468 6520 6f74 6865 7220 524f 4920 746f  the other ROI to
+00026eb0: 2074 6865 2063 726f 7070 6564 207a 2d65   the cropped z-e
+00026ec0: 7874 656e 7473 206f 6620 7468 6973 2052  xtents of this R
+00026ed0: 4f49 2e0a 0a20 2020 2020 2020 2020 2020  OI...           
+00026ee0: 2046 6f72 2061 2076 616c 7565 206f 7468   For a value oth
+00026ef0: 6572 2074 6861 6e20 302c 2031 2c20 322c  er than 0, 1, 2,
+00026f00: 206e 6f20 6c65 6e67 7468 206d 6174 6368   no length match
+00026f10: 696e 6720 6973 2070 6572 666f 726d 6564  ing is performed
+00026f20: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00026f30: 2020 2020 2020 6966 2076 6f78 656c 5f73        if voxel_s
+00026f40: 697a 6520 6973 206e 6f74 204e 6f6e 653a  ize is not None:
+00026f50: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+00026f60: 7265 6174 6520 524f 4920 6d61 736b 732c  reate ROI masks,
+00026f70: 206a 7573 7420 636f 7665 7269 6e67 2076   just covering v
+00026f80: 6f6c 756d 6520 6f63 6375 7069 6564 0a20  olume occupied. 
+00026f90: 2020 2020 2020 2020 2020 2023 2062 7920             # by 
+00026fa0: 524f 4973 2062 6569 6e67 2063 6f6d 7061  ROIs being compa
+00026fb0: 7265 642c 2077 6974 6820 7370 6563 6966  red, with specif
+00026fc0: 6965 6420 766f 7865 6c20 7369 7a65 2e0a  ied voxel size..
+00026fd0: 2020 2020 2020 2020 2020 2020 2320 2854              # (T
+00026fe0: 6865 2072 6573 697a 696e 6720 6973 2070  he resizing is p
+00026ff0: 6572 666f 726d 6564 206f 6e20 636c 6f6e  erformed on clon
+00027000: 6573 206f 6e20 7468 6520 524f 4973 2c0a  es on the ROIs,.
+00027010: 2020 2020 2020 2020 2020 2020 2320 7769              # wi
+00027020: 7468 6f75 7420 6368 616e 6769 6e67 2074  thout changing t
+00027030: 6865 206f 7269 6769 6e61 6c73 2e29 0a20  he originals.). 
+00027040: 2020 2020 2020 2020 2020 2072 6f69 302c             roi0,
+00027050: 2072 6f69 203d 2073 656c 662e 6d61 7463   roi = self.matc
+00027060: 685f 6d61 736b 5f76 6f78 656c 5f73 697a  h_mask_voxel_siz
+00027070: 6528 726f 692c 0a20 2020 2020 2020 2020  e(roi,.         
+00027080: 2020 2020 2020 2020 2020 2076 6f78 656c             voxel
+00027090: 5f73 697a 653d 766f 7865 6c5f 7369 7a65  _size=voxel_size
+000270a0: 2c20 766f 7865 6c5f 6469 6d5f 746f 6c65  , voxel_dim_tole
+000270b0: 7261 6e63 653d 2d31 290a 2020 2020 2020  rance=-1).      
+000270c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000270d0: 2020 2020 2320 446f 6e27 7420 6578 706c      # Don't expl
+000270e0: 6963 6974 6c79 2063 7265 6174 6520 524f  icitly create RO
+000270f0: 4920 6d61 736b 732e 0a20 2020 2020 2020  I masks..       
+00027100: 2020 2020 2072 6f69 3020 3d20 7365 6c66       roi0 = self
+00027110: 0a0a 2020 2020 2020 2020 2320 4f70 7469  ..        # Opti
+00027120: 6f6e 616c 6c79 206d 6174 6368 2052 4f49  onally match ROI
+00027130: 206c 656e 6774 6873 2e0a 2020 2020 2020   lengths..      
+00027140: 2020 6966 2028 286d 6174 6368 5f6c 656e    if ((match_len
+00027150: 6774 6873 2069 7320 5472 7565 2920 6f72  gths is True) or
+00027160: 2028 726f 692e 6e61 6d65 203d 3d20 6d61   (roi.name == ma
+00027170: 7463 685f 6c65 6e67 7468 7329 0a20 2020  tch_lengths).   
+00027180: 2020 2020 2020 2020 2020 2020 206f 7220               or 
+00027190: 2869 7369 6e73 7461 6e63 6528 6d61 7463  (isinstance(matc
+000271a0: 685f 6c65 6e67 7468 732c 2028 6c69 7374  h_lengths, (list
+000271b0: 2c20 7475 706c 652c 2073 6574 2929 0a20  , tuple, set)). 
+000271c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000271d0: 2020 2061 6e64 2072 6f69 2e6e 616d 6520     and roi.name 
+000271e0: 696e 206d 6174 6368 5f6c 656e 6774 6873  in match_lengths
+000271f0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00027200: 2320 4372 6561 7465 2052 4f49 2063 6c6f  # Create ROI clo
+00027210: 6e65 7320 666f 7220 6372 6f70 7069 6e67  nes for cropping
+00027220: 3b20 7468 6520 6f72 6967 696e 616c 7320  ; the originals 
+00027230: 7769 6c6c 2062 6520 756e 6368 616e 6765  will be unchange
+00027240: 642e 0a20 2020 2020 2020 2020 2020 2069  d..            i
+00027250: 6620 6d61 7463 685f 6c65 6e67 7468 735f  f match_lengths_
+00027260: 7374 7261 7465 6779 2069 6e20 5b30 2c20  strategy in [0, 
+00027270: 312c 2032 5d20 616e 6420 766f 7865 6c5f  1, 2] and voxel_
+00027280: 7369 7a65 2069 7320 4e6f 6e65 3a0a 2020  size is None:.  
+00027290: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+000272a0: 6930 203d 2073 656c 662e 636c 6f6e 6528  i0 = self.clone(
+000272b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000272c0: 2020 726f 6920 3d20 726f 692e 636c 6f6e    roi = roi.clon
+000272d0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+000272e0: 2320 4372 6f70 2074 6869 7320 524f 4920  # Crop this ROI 
+000272f0: 746f 207a 2d65 7874 656e 7473 206f 6620  to z-extents of 
+00027300: 6f74 6865 7220 524f 492e 0a20 2020 2020  other ROI..     
+00027310: 2020 2020 2020 2069 6620 6d61 7463 685f         if match_
+00027320: 6c65 6e67 7468 735f 7374 7261 7465 6779  lengths_strategy
+00027330: 2069 6e20 5b30 2c20 325d 3a0a 2020 2020   in [0, 2]:.    
+00027340: 2020 2020 2020 2020 2020 2020 726f 6930              roi0
+00027350: 2e63 726f 705f 746f 5f72 6f69 5f6c 656e  .crop_to_roi_len
+00027360: 6774 6828 726f 6929 0a20 2020 2020 2020  gth(roi).       
+00027370: 2020 2020 2023 2043 726f 7020 6f74 6865       # Crop othe
+00027380: 7220 524f 4920 746f 207a 2d65 7874 656e  r ROI to z-exten
+00027390: 7473 206f 6620 7468 6973 2052 4f49 2e0a  ts of this ROI..
+000273a0: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+000273b0: 6174 6368 5f6c 656e 6774 6873 5f73 7472  atch_lengths_str
+000273c0: 6174 6567 7920 696e 205b 312c 2032 5d3a  ategy in [1, 2]:
+000273d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000273e0: 2072 6f69 2e63 726f 705f 746f 5f72 6f69   roi.crop_to_roi
+000273f0: 5f6c 656e 6774 6828 726f 6930 290a 0a20  _length(roi0).. 
+00027400: 2020 2020 2020 2023 2044 6566 6175 6c74         # Default
+00027410: 206d 6574 7269 6373 0a20 2020 2020 2020   metrics.       
+00027420: 2069 6620 6d65 7472 6963 7320 6973 204e   if metrics is N
+00027430: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00027440: 206d 6574 7269 6373 203d 205b 2264 6963   metrics = ["dic
+00027450: 6522 2c20 2263 656e 7472 6f69 6422 5d0a  e", "centroid"].
+00027460: 0a20 2020 2020 2020 2023 2044 6566 6175  .        # Defau
+00027470: 6c74 2073 6c69 6365 7320 746f 2063 6f6e  lt slices to con
+00027480: 7369 6465 7220 666f 7220 736c 6963 652d  sider for slice-
+00027490: 6279 2d73 6c69 6365 206d 6574 7269 6320  by-slice metric 
+000274a0: 6361 6c63 756c 6174 696f 6e73 2e0a 2020  calculations..  
+000274b0: 2020 2020 2020 6465 6661 756c 745f 6279        default_by
+000274c0: 5f73 6c69 6365 203d 2073 6b72 742e 636f  _slice = skrt.co
+000274d0: 7265 2e44 6566 6175 6c74 7328 292e 6279  re.Defaults().by
+000274e0: 5f73 6c69 6365 0a0a 2020 2020 2020 2020  _slice..        
+000274f0: 2320 496e 6974 6961 6c69 7365 2076 6172  # Initialise var
+00027500: 6961 626c 6573 2066 6f72 2064 6973 7461  iables for dista
+00027510: 6e63 6520 6d65 7472 6963 732e 0a20 2020  nce metrics..   
+00027520: 2020 2020 2063 6f6e 666f 726d 6974 7920       conformity 
+00027530: 3d20 4e6f 6e65 0a20 2020 2020 2020 2063  = None.        c
+00027540: 6f6e 666f 726d 6974 795f 666c 6174 203d  onformity_flat =
+00027550: 204e 6f6e 650a 2020 2020 2020 2020 6469   None.        di
+00027560: 7374 616e 6365 7320 3d20 4e6f 6e65 0a20  stances = None. 
+00027570: 2020 2020 2020 2064 6973 7461 6e63 6573         distances
+00027580: 5f66 6c61 7420 3d20 4e6f 6e65 0a20 2020  _flat = None.   
+00027590: 2020 2020 2073 6967 6e65 645f 6469 7374       signed_dist
+000275a0: 616e 6365 7320 3d20 4e6f 6e65 0a20 2020  ances = None.   
+000275b0: 2020 2020 2073 6967 6e65 645f 6469 7374       signed_dist
+000275c0: 616e 6365 735f 666c 6174 203d 204e 6f6e  ances_flat = Non
+000275d0: 650a 0a20 2020 2020 2020 2023 2049 6620  e..        # If 
+000275e0: 6e6f 2069 6e64 6578 2067 6976 656e 2c20  no index given, 
+000275f0: 7573 6520 6365 6e74 7261 6c20 736c 6963  use central slic
+00027600: 650a 2020 2020 2020 2020 6966 2073 6c20  e.        if sl 
+00027610: 6973 204e 6f6e 6520 616e 6420 6964 7820  is None and idx 
+00027620: 6973 204e 6f6e 6520 616e 6420 706f 7320  is None and pos 
+00027630: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00027640: 2020 2020 2069 6478 203d 2072 6f69 302e       idx = roi0.
+00027650: 6765 745f 6d69 645f 6964 7828 7669 6577  get_mid_idx(view
+00027660: 290a 0a20 2020 2020 2020 2023 2043 6f6d  )..        # Com
+00027670: 7075 7465 206d 6574 7269 6373 0a20 2020  pute metrics.   
+00027680: 2020 2020 2063 6f6d 7020 3d20 7b7d 0a20       comp = {}. 
+00027690: 2020 2020 2020 2073 6c69 6365 5f6b 7761         slice_kwa
+000276a0: 7267 7320 3d20 7b0a 2020 2020 2020 2020  rgs = {.        
+000276b0: 2020 2020 2273 696e 676c 655f 736c 6963      "single_slic
+000276c0: 6522 3a20 5472 7565 2c0a 2020 2020 2020  e": True,.      
+000276d0: 2020 2020 2020 2276 6965 7722 3a20 7669        "view": vi
+000276e0: 6577 2c0a 2020 2020 2020 2020 2020 2020  ew,.            
+000276f0: 2273 6c22 3a20 736c 2c0a 2020 2020 2020  "sl": sl,.      
+00027700: 2020 2020 2020 2269 6478 223a 2069 6478        "idx": idx
+00027710: 2c0a 2020 2020 2020 2020 2020 2020 2270  ,.            "p
+00027720: 6f73 223a 2070 6f73 0a20 2020 2020 2020  os": pos.       
+00027730: 207d 0a0a 2020 2020 2020 2020 666f 7220   }..        for 
+00027740: 6d20 696e 206d 6574 7269 6373 3a0a 2020  m in metrics:.  
+00027750: 2020 2020 2020 2020 2020 6966 206d 206e            if m n
+00027760: 6f74 2069 6e20 6765 745f 636f 6d70 6172  ot in get_compar
+00027770: 6973 6f6e 5f6d 6574 7269 6373 2829 3a0a  ison_metrics():.
 00027780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027790: 2020 2020 2252 4f49 2e67 6574 5f63 6f6d      "ROI.get_com
-000277a0: 7061 7269 736f 6e28 2922 290a 0a20 2020  parison()")..   
-000277b0: 2020 2020 2066 6f72 206d 2069 6e20 6d65       for m in me
-000277c0: 7472 6963 733a 0a0a 2020 2020 2020 2020  trics:..        
-000277d0: 2020 2020 2320 4469 6365 2073 636f 7265      # Dice score
-000277e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000277f0: 6d20 3d3d 2022 6469 6365 223a 0a20 2020  m == "dice":.   
-00027800: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-00027810: 705b 6d5d 203d 2072 6f69 302e 6765 745f  p[m] = roi0.get_
-00027820: 6469 6365 2872 6f69 2c20 6d65 7468 6f64  dice(roi, method
-00027830: 3d6d 6574 686f 6429 0a20 2020 2020 2020  =method).       
-00027840: 2020 2020 2065 6c69 6620 6d20 3d3d 2022       elif m == "
-00027850: 6469 6365 5f66 6c61 7422 3a0a 2020 2020  dice_flat":.    
-00027860: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00027870: 5b6d 5d20 3d20 726f 6930 2e67 6574 5f64  [m] = roi0.get_d
-00027880: 6963 6528 0a20 2020 2020 2020 2020 2020  ice(.           
-00027890: 2020 2020 2020 2020 2072 6f69 2c20 0a20           roi, . 
-000278a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000278b0: 2020 2076 6965 773d 7669 6577 2c0a 2020     view=view,.  
-000278c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000278d0: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
-000278e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000278f0: 2020 2020 2066 6c61 7474 656e 3d54 7275       flatten=Tru
-00027900: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
-00027910: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00027920: 2020 656c 6966 206d 203d 3d20 2264 6963    elif m == "dic
-00027930: 655f 736c 6963 6522 3a0a 2020 2020 2020  e_slice":.      
-00027940: 2020 2020 2020 2020 2020 636f 6d70 5b6d            comp[m
-00027950: 5d20 3d20 726f 6930 2e67 6574 5f64 6963  ] = roi0.get_dic
-00027960: 6528 726f 692c 206d 6574 686f 643d 6d65  e(roi, method=me
-00027970: 7468 6f64 2c20 2a2a 736c 6963 655f 6b77  thod, **slice_kw
-00027980: 6172 6773 290a 0a20 2020 2020 2020 2020  args)..         
-00027990: 2020 2065 6c69 6620 6d20 3d3d 2022 6469     elif m == "di
-000279a0: 6365 5f73 6c69 6365 5f73 7461 7473 223a  ce_slice_stats":
-000279b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000279c0: 2063 6f6d 702e 7570 6461 7465 2872 6f69   comp.update(roi
-000279d0: 302e 6765 745f 736c 6963 655f 7374 6174  0.get_slice_stat
-000279e0: 7328 726f 692c 206d 6574 7269 6373 3d22  s(roi, metrics="
-000279f0: 6469 6365 222c 0a20 2020 2020 2020 2020  dice",.         
-00027a00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00027a10: 6c69 6365 5f73 7461 7473 3d73 6c69 6365  lice_stats=slice
-00027a20: 5f73 7461 7473 2c0a 2020 2020 2020 2020  _stats,.        
-00027a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027a40: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
-00027a50: 3d64 6566 6175 6c74 5f62 795f 736c 6963  =default_by_slic
-00027a60: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00027a70: 2020 2020 2020 2020 2020 206d 6574 686f             metho
-00027a80: 643d 6d65 7468 6f64 2c20 7669 6577 3d76  d=method, view=v
-00027a90: 6965 7729 290a 0a20 2020 2020 2020 2020  iew))..         
-00027aa0: 2020 2023 204a 6163 6361 7264 2069 6e64     # Jaccard ind
-00027ab0: 6578 0a20 2020 2020 2020 2020 2020 2065  ex.            e
-00027ac0: 6c69 6620 6d20 3d3d 2022 6a61 6363 6172  lif m == "jaccar
-00027ad0: 6422 3a0a 2020 2020 2020 2020 2020 2020  d":.            
-00027ae0: 2020 2020 636f 6d70 5b6d 5d20 3d20 726f      comp[m] = ro
-00027af0: 6930 2e67 6574 5f6a 6163 6361 7264 2872  i0.get_jaccard(r
-00027b00: 6f69 2c20 6d65 7468 6f64 3d6d 6574 686f  oi, method=metho
-00027b10: 6429 0a20 2020 2020 2020 2020 2020 2065  d).            e
-00027b20: 6c69 6620 6d20 3d3d 2022 6a61 6363 6172  lif m == "jaccar
-00027b30: 645f 666c 6174 223a 0a20 2020 2020 2020  d_flat":.       
-00027b40: 2020 2020 2020 2020 2063 6f6d 705b 6d5d           comp[m]
-00027b50: 203d 2072 6f69 302e 6765 745f 6a61 6363   = roi0.get_jacc
-00027b60: 6172 6428 0a20 2020 2020 2020 2020 2020  ard(.           
-00027b70: 2020 2020 2020 2020 2072 6f69 2c20 0a20           roi, . 
-00027b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027b90: 2020 2076 6965 773d 7669 6577 2c0a 2020     view=view,.  
-00027ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027bb0: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
-00027bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027bd0: 2020 2020 2066 6c61 7474 656e 3d54 7275       flatten=Tru
-00027be0: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
-00027bf0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00027c00: 2020 656c 6966 206d 203d 3d20 226a 6163    elif m == "jac
-00027c10: 6361 7264 5f73 6c69 6365 223a 0a20 2020  card_slice":.   
-00027c20: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-00027c30: 705b 6d5d 203d 2072 6f69 302e 6765 745f  p[m] = roi0.get_
-00027c40: 6a61 6363 6172 6428 726f 692c 206d 6574  jaccard(roi, met
-00027c50: 686f 643d 6d65 7468 6f64 2c20 2a2a 736c  hod=method, **sl
-00027c60: 6963 655f 6b77 6172 6773 290a 0a20 2020  ice_kwargs)..   
-00027c70: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
-00027c80: 3d3d 2022 6a61 6363 6172 645f 736c 6963  == "jaccard_slic
-00027c90: 655f 7374 6174 7322 3a0a 2020 2020 2020  e_stats":.      
-00027ca0: 2020 2020 2020 2020 2020 636f 6d70 2e75            comp.u
-00027cb0: 7064 6174 6528 726f 6930 2e67 6574 5f73  pdate(roi0.get_s
-00027cc0: 6c69 6365 5f73 7461 7473 2872 6f69 2c20  lice_stats(roi, 
-00027cd0: 6d65 7472 6963 733d 226a 6163 6361 7264  metrics="jaccard
-00027ce0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00027cf0: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
-00027d00: 5f73 7461 7473 3d73 6c69 6365 5f73 7461  _stats=slice_sta
-00027d10: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
-00027d20: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00027d30: 756c 745f 6279 5f73 6c69 6365 3d64 6566  ult_by_slice=def
-00027d40: 6175 6c74 5f62 795f 736c 6963 652c 0a20  ault_by_slice,. 
-00027d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d60: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
-00027d70: 7468 6f64 2c20 7669 6577 3d76 6965 7729  thod, view=view)
-00027d80: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00027d90: 2043 656e 7472 6f69 6420 6469 7374 616e   Centroid distan
-00027da0: 6365 730a 2020 2020 2020 2020 2020 2020  ces.            
-00027db0: 656c 6966 206d 203d 3d20 2263 656e 7472  elif m == "centr
-00027dc0: 6f69 6422 3a0a 2020 2020 2020 2020 2020  oid":.          
-00027dd0: 2020 2020 2020 6365 6e74 726f 6964 203d        centroid =
-00027de0: 2072 6f69 302e 6765 745f 6365 6e74 726f   roi0.get_centro
-00027df0: 6964 5f64 6973 7461 6e63 6528 0a20 2020  id_distance(.   
-00027e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027e10: 2072 6f69 2c20 0a20 2020 2020 2020 2020   roi, .         
-00027e20: 2020 2020 2020 2020 2020 2075 6e69 7473             units
-00027e30: 3d63 656e 7472 6f69 645f 756e 6974 732c  =centroid_units,
-00027e40: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00027e50: 2020 2020 2020 6d65 7468 6f64 3d6d 6574        method=met
-00027e60: 686f 642c 0a20 2020 2020 2020 2020 2020  hod,.           
-00027e70: 2020 2020 2020 2020 2066 6f72 6365 3d66           force=f
-00027e80: 6f72 6365 0a20 2020 2020 2020 2020 2020  orce.           
-00027e90: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00027ea0: 2020 2020 2020 2066 6f72 2069 2c20 6178         for i, ax
-00027eb0: 2069 6e20 656e 756d 6572 6174 6528 736b   in enumerate(sk
-00027ec0: 7274 2e69 6d61 6765 2e5f 6178 6573 293a  rt.image._axes):
-00027ed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027ee0: 2020 2020 2063 6f6d 705b 6622 6365 6e74       comp[f"cent
-00027ef0: 726f 6964 5f7b 6178 7d22 5d20 3d20 6365  roid_{ax}"] = ce
-00027f00: 6e74 726f 6964 5b69 5d0a 2020 2020 2020  ntroid[i].      
-00027f10: 2020 2020 2020 656c 6966 206d 203d 3d20        elif m == 
-00027f20: 2261 6273 5f63 656e 7472 6f69 6422 3a0a  "abs_centroid":.
-00027f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027f40: 636f 6d70 5b6d 5d20 3d20 726f 6930 2e67  comp[m] = roi0.g
-00027f50: 6574 5f61 6273 5f63 656e 7472 6f69 645f  et_abs_centroid_
-00027f60: 6469 7374 616e 6365 280a 2020 2020 2020  distance(.      
-00027f70: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-00027f80: 692c 200a 2020 2020 2020 2020 2020 2020  i, .            
-00027f90: 2020 2020 2020 2020 756e 6974 733d 6365          units=ce
-00027fa0: 6e74 726f 6964 5f75 6e69 7473 2c0a 2020  ntroid_units,.  
-00027fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027fc0: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
-00027fd0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00027fe0: 2020 2020 2020 666f 7263 653d 666f 7263        force=forc
-00027ff0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00028000: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00028010: 656c 6966 206d 203d 3d20 2261 6273 5f63  elif m == "abs_c
-00028020: 656e 7472 6f69 645f 666c 6174 223a 0a20  entroid_flat":. 
-00028030: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00028040: 6f6d 705b 6d5d 203d 2072 6f69 302e 6765  omp[m] = roi0.ge
-00028050: 745f 6162 735f 6365 6e74 726f 6964 5f64  t_abs_centroid_d
-00028060: 6973 7461 6e63 6528 0a20 2020 2020 2020  istance(.       
-00028070: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-00028080: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00028090: 2020 2020 2020 7669 6577 3d76 6965 772c        view=view,
-000280a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000280b0: 2020 2020 2075 6e69 7473 3d63 656e 7472       units=centr
-000280c0: 6f69 645f 756e 6974 732c 0a20 2020 2020  oid_units,.     
-000280d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000280e0: 6574 686f 643d 6d65 7468 6f64 2c0a 2020  ethod=method,.  
-000280f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028100: 2020 666c 6174 7465 6e3d 5472 7565 2c0a    flatten=True,.
-00028110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028120: 2020 2020 666f 7263 653d 666f 7263 650a      force=force.
-00028130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028140: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00028150: 6966 206d 203d 3d20 2263 656e 7472 6f69  if m == "centroi
-00028160: 645f 736c 6963 6522 3a0a 2020 2020 2020  d_slice":.      
-00028170: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
-00028180: 6964 203d 2072 6f69 302e 6765 745f 6365  id = roi0.get_ce
-00028190: 6e74 726f 6964 5f64 6973 7461 6e63 6528  ntroid_distance(
-000281a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000281b0: 2020 2020 2072 6f69 2c0a 2020 2020 2020       roi,.      
-000281c0: 2020 2020 2020 2020 2020 2020 2020 756e                un
-000281d0: 6974 733d 6365 6e74 726f 6964 5f75 6e69  its=centroid_uni
-000281e0: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
-000281f0: 2020 2020 2020 2020 6d65 7468 6f64 3d6d          method=m
-00028200: 6574 686f 642c 0a20 2020 2020 2020 2020  ethod,.         
-00028210: 2020 2020 2020 2020 2020 202a 2a73 6c69             **sli
-00028220: 6365 5f6b 7761 7267 730a 2020 2020 2020  ce_kwargs.      
-00028230: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00028240: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00028250: 692c 2069 5f61 7820 696e 2065 6e75 6d65  i, i_ax in enume
-00028260: 7261 7465 2873 6b72 742e 696d 6167 652e  rate(skrt.image.
-00028270: 5f70 6c6f 745f 6178 6573 5b76 6965 775d  _plot_axes[view]
-00028280: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00028290: 2020 2020 2020 2061 7820 3d20 736b 7274         ax = skrt
-000282a0: 2e69 6d61 6765 2e5f 6178 6573 5b69 5f61  .image._axes[i_a
-000282b0: 785d 0a20 2020 2020 2020 2020 2020 2020  x].             
-000282c0: 2020 2020 2020 2063 6f6d 705b 6622 6365         comp[f"ce
-000282d0: 6e74 726f 6964 5f73 6c69 6365 5f7b 6178  ntroid_slice_{ax
-000282e0: 7d22 5d20 3d20 6365 6e74 726f 6964 5b69  }"] = centroid[i
-000282f0: 5d0a 0a20 2020 2020 2020 2020 2020 2065  ]..            e
-00028300: 6c69 6620 6d20 3d3d 2022 6365 6e74 726f  lif m == "centro
-00028310: 6964 5f73 6c69 6365 5f73 7461 7473 223a  id_slice_stats":
-00028320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028330: 2063 6f6d 702e 7570 6461 7465 2872 6f69   comp.update(roi
-00028340: 302e 6765 745f 736c 6963 655f 7374 6174  0.get_slice_stat
-00028350: 7328 726f 692c 206d 6574 7269 6373 3d22  s(roi, metrics="
-00028360: 6365 6e74 726f 6964 222c 0a20 2020 2020  centroid",.     
-00028370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028380: 2020 2073 6c69 6365 5f73 7461 7473 3d73     slice_stats=s
-00028390: 6c69 6365 5f73 7461 7473 2c0a 2020 2020  lice_stats,.    
-000283a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000283b0: 2020 2020 6465 6661 756c 745f 6279 5f73      default_by_s
-000283c0: 6c69 6365 3d64 6566 6175 6c74 5f62 795f  lice=default_by_
-000283d0: 736c 6963 652c 0a20 2020 2020 2020 2020  slice,.         
-000283e0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000283f0: 6574 686f 643d 6d65 7468 6f64 2c20 7669  ethod=method, vi
-00028400: 6577 3d76 6965 772c 0a20 2020 2020 2020  ew=view,.       
-00028410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028420: 2073 6570 6172 6174 655f 636f 6d70 6f6e   separate_compon
-00028430: 656e 7473 3d54 7275 6529 290a 0a20 2020  ents=True))..   
-00028440: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
-00028450: 3d3d 2022 6162 735f 6365 6e74 726f 6964  == "abs_centroid
-00028460: 5f73 6c69 6365 223a 0a20 2020 2020 2020  _slice":.       
-00028470: 2020 2020 2020 2020 2063 6f6d 705b 6d5d           comp[m]
-00028480: 203d 2072 6f69 302e 6765 745f 6162 735f   = roi0.get_abs_
-00028490: 6365 6e74 726f 6964 5f64 6973 7461 6e63  centroid_distanc
-000284a0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-000284b0: 2020 2020 2020 2072 6f69 2c0a 2020 2020         roi,.    
-000284c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000284d0: 756e 6974 733d 6365 6e74 726f 6964 5f75  units=centroid_u
-000284e0: 6e69 7473 2c0a 2020 2020 2020 2020 2020  nits,.          
-000284f0: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-00028500: 3d6d 6574 686f 642c 0a20 2020 2020 2020  =method,.       
-00028510: 2020 2020 2020 2020 2020 2020 202a 2a73               **s
-00028520: 6c69 6365 5f6b 7761 7267 730a 2020 2020  lice_kwargs.    
-00028530: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00028540: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00028550: 6d20 3d3d 2022 6162 735f 6365 6e74 726f  m == "abs_centro
-00028560: 6964 5f73 6c69 6365 5f73 7461 7473 223a  id_slice_stats":
-00028570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028580: 2063 6f6d 702e 7570 6461 7465 2872 6f69   comp.update(roi
-00028590: 302e 6765 745f 736c 6963 655f 7374 6174  0.get_slice_stat
-000285a0: 7328 726f 692c 206d 6574 7269 6373 3d22  s(roi, metrics="
-000285b0: 6162 735f 6365 6e74 726f 6964 222c 0a20  abs_centroid",. 
-000285c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000285d0: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
-000285e0: 7473 3d73 6c69 6365 5f73 7461 7473 2c0a  ts=slice_stats,.
-000285f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028600: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00028610: 6279 5f73 6c69 6365 3d64 6566 6175 6c74  by_slice=default
-00028620: 5f62 795f 736c 6963 652c 0a20 2020 2020  _by_slice,.     
-00028630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028640: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
-00028650: 2c20 7669 6577 3d76 6965 7729 290a 0a20  , view=view)).. 
-00028660: 2020 2020 2020 2020 2020 2023 2056 6f6c             # Vol
-00028670: 756d 6520 6d65 7472 6963 730a 2020 2020  ume metrics.    
-00028680: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
-00028690: 3d20 2276 6f6c 756d 655f 6469 6666 223a  = "volume_diff":
-000286a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000286b0: 2063 6f6d 705b 6d5d 203d 2072 6f69 302e   comp[m] = roi0.
-000286c0: 6765 745f 766f 6c75 6d65 5f64 6966 6628  get_volume_diff(
-000286d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000286e0: 2020 2020 2072 6f69 2c0a 2020 2020 2020       roi,.      
-000286f0: 2020 2020 2020 2020 2020 2020 2020 756e                un
-00028700: 6974 733d 766f 6c5f 756e 6974 732c 0a20  its=vol_units,. 
-00028710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028720: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
+00027790: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
+000277a0: 6f72 2866 224d 6574 7269 6320 7b6d 7d20  or(f"Metric {m} 
+000277b0: 6e6f 7420 7265 636f 676e 6973 6564 2062  not recognised b
+000277c0: 7920 220a 2020 2020 2020 2020 2020 2020  y ".            
+000277d0: 2020 2020 2020 2020 2020 2020 2252 4f49              "ROI
+000277e0: 2e67 6574 5f63 6f6d 7061 7269 736f 6e28  .get_comparison(
+000277f0: 2922 290a 0a20 2020 2020 2020 2066 6f72  )")..        for
+00027800: 206d 2069 6e20 6d65 7472 6963 733a 0a0a   m in metrics:..
+00027810: 2020 2020 2020 2020 2020 2020 2320 4469              # Di
+00027820: 6365 2073 636f 7265 0a20 2020 2020 2020  ce score.       
+00027830: 2020 2020 2069 6620 6d20 3d3d 2022 6469       if m == "di
+00027840: 6365 223a 0a20 2020 2020 2020 2020 2020  ce":.           
+00027850: 2020 2020 2063 6f6d 705b 6d5d 203d 2072       comp[m] = r
+00027860: 6f69 302e 6765 745f 6469 6365 2872 6f69  oi0.get_dice(roi
+00027870: 2c20 6d65 7468 6f64 3d6d 6574 686f 6429  , method=method)
+00027880: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00027890: 6620 6d20 3d3d 2022 6469 6365 5f66 6c61  f m == "dice_fla
+000278a0: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
+000278b0: 2020 2020 636f 6d70 5b6d 5d20 3d20 726f      comp[m] = ro
+000278c0: 6930 2e67 6574 5f64 6963 6528 0a20 2020  i0.get_dice(.   
+000278d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000278e0: 2072 6f69 2c20 0a20 2020 2020 2020 2020   roi, .         
+000278f0: 2020 2020 2020 2020 2020 2076 6965 773d             view=
+00027900: 7669 6577 2c0a 2020 2020 2020 2020 2020  view,.          
+00027910: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+00027920: 3d6d 6574 686f 642c 0a20 2020 2020 2020  =method,.       
+00027930: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
+00027940: 7474 656e 3d54 7275 652c 200a 2020 2020  tten=True, .    
+00027950: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00027960: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+00027970: 203d 3d20 2264 6963 655f 736c 6963 6522   == "dice_slice"
+00027980: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00027990: 2020 636f 6d70 5b6d 5d20 3d20 726f 6930    comp[m] = roi0
+000279a0: 2e67 6574 5f64 6963 6528 726f 692c 206d  .get_dice(roi, m
+000279b0: 6574 686f 643d 6d65 7468 6f64 2c20 2a2a  ethod=method, **
+000279c0: 736c 6963 655f 6b77 6172 6773 290a 0a20  slice_kwargs).. 
+000279d0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+000279e0: 6d20 3d3d 2022 6469 6365 5f73 6c69 6365  m == "dice_slice
+000279f0: 5f73 7461 7473 223a 0a20 2020 2020 2020  _stats":.       
+00027a00: 2020 2020 2020 2020 2063 6f6d 702e 7570           comp.up
+00027a10: 6461 7465 2872 6f69 302e 6765 745f 736c  date(roi0.get_sl
+00027a20: 6963 655f 7374 6174 7328 726f 692c 206d  ice_stats(roi, m
+00027a30: 6574 7269 6373 3d22 6469 6365 222c 0a20  etrics="dice",. 
+00027a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027a50: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
+00027a60: 7473 3d73 6c69 6365 5f73 7461 7473 2c0a  ts=slice_stats,.
+00027a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027a80: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00027a90: 6279 5f73 6c69 6365 3d64 6566 6175 6c74  by_slice=default
+00027aa0: 5f62 795f 736c 6963 652c 0a20 2020 2020  _by_slice,.     
+00027ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ac0: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
+00027ad0: 2c20 7669 6577 3d76 6965 7729 290a 0a20  , view=view)).. 
+00027ae0: 2020 2020 2020 2020 2020 2023 204a 6163             # Jac
+00027af0: 6361 7264 2069 6e64 6578 0a20 2020 2020  card index.     
+00027b00: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
+00027b10: 2022 6a61 6363 6172 6422 3a0a 2020 2020   "jaccard":.    
+00027b20: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00027b30: 5b6d 5d20 3d20 726f 6930 2e67 6574 5f6a  [m] = roi0.get_j
+00027b40: 6163 6361 7264 2872 6f69 2c20 6d65 7468  accard(roi, meth
+00027b50: 6f64 3d6d 6574 686f 6429 0a20 2020 2020  od=method).     
+00027b60: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
+00027b70: 2022 6a61 6363 6172 645f 666c 6174 223a   "jaccard_flat":
+00027b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027b90: 2063 6f6d 705b 6d5d 203d 2072 6f69 302e   comp[m] = roi0.
+00027ba0: 6765 745f 6a61 6363 6172 6428 0a20 2020  get_jaccard(.   
+00027bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027bc0: 2072 6f69 2c20 0a20 2020 2020 2020 2020   roi, .         
+00027bd0: 2020 2020 2020 2020 2020 2076 6965 773d             view=
+00027be0: 7669 6577 2c0a 2020 2020 2020 2020 2020  view,.          
+00027bf0: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+00027c00: 3d6d 6574 686f 642c 0a20 2020 2020 2020  =method,.       
+00027c10: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
+00027c20: 7474 656e 3d54 7275 652c 200a 2020 2020  tten=True, .    
+00027c30: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00027c40: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+00027c50: 203d 3d20 226a 6163 6361 7264 5f73 6c69   == "jaccard_sli
+00027c60: 6365 223a 0a20 2020 2020 2020 2020 2020  ce":.           
+00027c70: 2020 2020 2063 6f6d 705b 6d5d 203d 2072       comp[m] = r
+00027c80: 6f69 302e 6765 745f 6a61 6363 6172 6428  oi0.get_jaccard(
+00027c90: 726f 692c 206d 6574 686f 643d 6d65 7468  roi, method=meth
+00027ca0: 6f64 2c20 2a2a 736c 6963 655f 6b77 6172  od, **slice_kwar
+00027cb0: 6773 290a 0a20 2020 2020 2020 2020 2020  gs)..           
+00027cc0: 2065 6c69 6620 6d20 3d3d 2022 6a61 6363   elif m == "jacc
+00027cd0: 6172 645f 736c 6963 655f 7374 6174 7322  ard_slice_stats"
+00027ce0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00027cf0: 2020 636f 6d70 2e75 7064 6174 6528 726f    comp.update(ro
+00027d00: 6930 2e67 6574 5f73 6c69 6365 5f73 7461  i0.get_slice_sta
+00027d10: 7473 2872 6f69 2c20 6d65 7472 6963 733d  ts(roi, metrics=
+00027d20: 226a 6163 6361 7264 222c 0a20 2020 2020  "jaccard",.     
+00027d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d40: 2020 2073 6c69 6365 5f73 7461 7473 3d73     slice_stats=s
+00027d50: 6c69 6365 5f73 7461 7473 2c0a 2020 2020  lice_stats,.    
+00027d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d70: 2020 2020 6465 6661 756c 745f 6279 5f73      default_by_s
+00027d80: 6c69 6365 3d64 6566 6175 6c74 5f62 795f  lice=default_by_
+00027d90: 736c 6963 652c 0a20 2020 2020 2020 2020  slice,.         
+00027da0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00027db0: 6574 686f 643d 6d65 7468 6f64 2c20 7669  ethod=method, vi
+00027dc0: 6577 3d76 6965 7729 290a 0a20 2020 2020  ew=view))..     
+00027dd0: 2020 2020 2020 2023 2043 656e 7472 6f69         # Centroi
+00027de0: 6420 6469 7374 616e 6365 730a 2020 2020  d distances.    
+00027df0: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
+00027e00: 3d20 2263 656e 7472 6f69 6422 3a0a 2020  = "centroid":.  
+00027e10: 2020 2020 2020 2020 2020 2020 2020 6365                ce
+00027e20: 6e74 726f 6964 203d 2072 6f69 302e 6765  ntroid = roi0.ge
+00027e30: 745f 6365 6e74 726f 6964 5f64 6973 7461  t_centroid_dista
+00027e40: 6e63 6528 0a20 2020 2020 2020 2020 2020  nce(.           
+00027e50: 2020 2020 2020 2020 2072 6f69 2c20 0a20           roi, . 
+00027e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027e70: 2020 2075 6e69 7473 3d63 656e 7472 6f69     units=centroi
+00027e80: 645f 756e 6974 732c 200a 2020 2020 2020  d_units, .      
+00027e90: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00027ea0: 7468 6f64 3d6d 6574 686f 642c 0a20 2020  thod=method,.   
+00027eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ec0: 2066 6f72 6365 3d66 6f72 6365 0a20 2020   force=force.   
+00027ed0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00027ee0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00027ef0: 6f72 2069 2c20 6178 2069 6e20 656e 756d  or i, ax in enum
+00027f00: 6572 6174 6528 736b 7274 2e69 6d61 6765  erate(skrt.image
+00027f10: 2e5f 6178 6573 293a 0a20 2020 2020 2020  ._axes):.       
+00027f20: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+00027f30: 705b 6622 6365 6e74 726f 6964 5f7b 6178  p[f"centroid_{ax
+00027f40: 7d22 5d20 3d20 6365 6e74 726f 6964 5b69  }"] = centroid[i
+00027f50: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
+00027f60: 6966 206d 203d 3d20 2261 6273 5f63 656e  if m == "abs_cen
+00027f70: 7472 6f69 6422 3a0a 2020 2020 2020 2020  troid":.        
+00027f80: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
+00027f90: 3d20 726f 6930 2e67 6574 5f61 6273 5f63  = roi0.get_abs_c
+00027fa0: 656e 7472 6f69 645f 6469 7374 616e 6365  entroid_distance
+00027fb0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00027fc0: 2020 2020 2020 726f 692c 200a 2020 2020        roi, .    
+00027fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027fe0: 756e 6974 733d 6365 6e74 726f 6964 5f75  units=centroid_u
+00027ff0: 6e69 7473 2c0a 2020 2020 2020 2020 2020  nits,.          
+00028000: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+00028010: 3d6d 6574 686f 642c 200a 2020 2020 2020  =method, .      
+00028020: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00028030: 7263 653d 666f 7263 650a 2020 2020 2020  rce=force.      
+00028040: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00028050: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
+00028060: 3d20 2261 6273 5f63 656e 7472 6f69 645f  = "abs_centroid_
+00028070: 666c 6174 223a 0a20 2020 2020 2020 2020  flat":.         
+00028080: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
+00028090: 2072 6f69 302e 6765 745f 6162 735f 6365   roi0.get_abs_ce
+000280a0: 6e74 726f 6964 5f64 6973 7461 6e63 6528  ntroid_distance(
+000280b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000280c0: 2020 2020 2072 6f69 2c0a 2020 2020 2020       roi,.      
+000280d0: 2020 2020 2020 2020 2020 2020 2020 7669                vi
+000280e0: 6577 3d76 6965 772c 0a20 2020 2020 2020  ew=view,.       
+000280f0: 2020 2020 2020 2020 2020 2020 2075 6e69               uni
+00028100: 7473 3d63 656e 7472 6f69 645f 756e 6974  ts=centroid_unit
+00028110: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00028120: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
+00028130: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
+00028140: 2020 2020 2020 2020 2020 666c 6174 7465            flatte
+00028150: 6e3d 5472 7565 2c0a 2020 2020 2020 2020  n=True,.        
+00028160: 2020 2020 2020 2020 2020 2020 666f 7263              forc
+00028170: 653d 666f 7263 650a 2020 2020 2020 2020  e=force.        
+00028180: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00028190: 2020 2020 2020 656c 6966 206d 203d 3d20        elif m == 
+000281a0: 2263 656e 7472 6f69 645f 736c 6963 6522  "centroid_slice"
+000281b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000281c0: 2020 6365 6e74 726f 6964 203d 2072 6f69    centroid = roi
+000281d0: 302e 6765 745f 6365 6e74 726f 6964 5f64  0.get_centroid_d
+000281e0: 6973 7461 6e63 6528 0a20 2020 2020 2020  istance(.       
+000281f0: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+00028200: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00028210: 2020 2020 2020 756e 6974 733d 6365 6e74        units=cent
+00028220: 726f 6964 5f75 6e69 7473 2c0a 2020 2020  roid_units,.    
+00028230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028240: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
+00028250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028260: 2020 202a 2a73 6c69 6365 5f6b 7761 7267     **slice_kwarg
+00028270: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00028280: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00028290: 2020 2020 666f 7220 692c 2069 5f61 7820      for i, i_ax 
+000282a0: 696e 2065 6e75 6d65 7261 7465 2873 6b72  in enumerate(skr
+000282b0: 742e 696d 6167 652e 5f70 6c6f 745f 6178  t.image._plot_ax
+000282c0: 6573 5b76 6965 775d 293a 0a20 2020 2020  es[view]):.     
+000282d0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000282e0: 7820 3d20 736b 7274 2e69 6d61 6765 2e5f  x = skrt.image._
+000282f0: 6178 6573 5b69 5f61 785d 0a20 2020 2020  axes[i_ax].     
+00028300: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00028310: 6f6d 705b 6622 6365 6e74 726f 6964 5f73  omp[f"centroid_s
+00028320: 6c69 6365 5f7b 6178 7d22 5d20 3d20 6365  lice_{ax}"] = ce
+00028330: 6e74 726f 6964 5b69 5d0a 0a20 2020 2020  ntroid[i]..     
+00028340: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
+00028350: 2022 6365 6e74 726f 6964 5f73 6c69 6365   "centroid_slice
+00028360: 5f73 7461 7473 223a 0a20 2020 2020 2020  _stats":.       
+00028370: 2020 2020 2020 2020 2063 6f6d 702e 7570           comp.up
+00028380: 6461 7465 2872 6f69 302e 6765 745f 736c  date(roi0.get_sl
+00028390: 6963 655f 7374 6174 7328 726f 692c 206d  ice_stats(roi, m
+000283a0: 6574 7269 6373 3d22 6365 6e74 726f 6964  etrics="centroid
+000283b0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+000283c0: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
+000283d0: 5f73 7461 7473 3d73 6c69 6365 5f73 7461  _stats=slice_sta
+000283e0: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+000283f0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00028400: 756c 745f 6279 5f73 6c69 6365 3d64 6566  ult_by_slice=def
+00028410: 6175 6c74 5f62 795f 736c 6963 652c 0a20  ault_by_slice,. 
+00028420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028430: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
+00028440: 7468 6f64 2c20 7669 6577 3d76 6965 772c  thod, view=view,
+00028450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028460: 2020 2020 2020 2020 2073 6570 6172 6174           separat
+00028470: 655f 636f 6d70 6f6e 656e 7473 3d54 7275  e_components=Tru
+00028480: 6529 290a 0a20 2020 2020 2020 2020 2020  e))..           
+00028490: 2065 6c69 6620 6d20 3d3d 2022 6162 735f   elif m == "abs_
+000284a0: 6365 6e74 726f 6964 5f73 6c69 6365 223a  centroid_slice":
+000284b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000284c0: 2063 6f6d 705b 6d5d 203d 2072 6f69 302e   comp[m] = roi0.
+000284d0: 6765 745f 6162 735f 6365 6e74 726f 6964  get_abs_centroid
+000284e0: 5f64 6973 7461 6e63 6528 0a20 2020 2020  _distance(.     
+000284f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00028500: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
+00028510: 2020 2020 2020 2020 756e 6974 733d 6365          units=ce
+00028520: 6e74 726f 6964 5f75 6e69 7473 2c0a 2020  ntroid_units,.  
+00028530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028540: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
+00028550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028560: 2020 2020 202a 2a73 6c69 6365 5f6b 7761       **slice_kwa
+00028570: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
+00028580: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+00028590: 2020 2065 6c69 6620 6d20 3d3d 2022 6162     elif m == "ab
+000285a0: 735f 6365 6e74 726f 6964 5f73 6c69 6365  s_centroid_slice
+000285b0: 5f73 7461 7473 223a 0a20 2020 2020 2020  _stats":.       
+000285c0: 2020 2020 2020 2020 2063 6f6d 702e 7570           comp.up
+000285d0: 6461 7465 2872 6f69 302e 6765 745f 736c  date(roi0.get_sl
+000285e0: 6963 655f 7374 6174 7328 726f 692c 206d  ice_stats(roi, m
+000285f0: 6574 7269 6373 3d22 6162 735f 6365 6e74  etrics="abs_cent
+00028600: 726f 6964 222c 0a20 2020 2020 2020 2020  roid",.         
+00028610: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00028620: 6c69 6365 5f73 7461 7473 3d73 6c69 6365  lice_stats=slice
+00028630: 5f73 7461 7473 2c0a 2020 2020 2020 2020  _stats,.        
+00028640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028650: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
+00028660: 3d64 6566 6175 6c74 5f62 795f 736c 6963  =default_by_slic
+00028670: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00028680: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+00028690: 643d 6d65 7468 6f64 2c20 7669 6577 3d76  d=method, view=v
+000286a0: 6965 7729 290a 0a20 2020 2020 2020 2020  iew))..         
+000286b0: 2020 2023 2056 6f6c 756d 6520 6d65 7472     # Volume metr
+000286c0: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
+000286d0: 656c 6966 206d 203d 3d20 2276 6f6c 756d  elif m == "volum
+000286e0: 655f 6469 6666 223a 0a20 2020 2020 2020  e_diff":.       
+000286f0: 2020 2020 2020 2020 2063 6f6d 705b 6d5d           comp[m]
+00028700: 203d 2072 6f69 302e 6765 745f 766f 6c75   = roi0.get_volu
+00028710: 6d65 5f64 6966 6628 0a20 2020 2020 2020  me_diff(.       
+00028720: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
 00028730: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00028740: 2020 2020 2020 666f 7263 653d 666f 7263        force=forc
-00028750: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00028760: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00028770: 656c 6966 206d 203d 3d20 2272 656c 5f76  elif m == "rel_v
-00028780: 6f6c 756d 655f 6469 6666 223a 0a20 2020  olume_diff":.   
-00028790: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-000287a0: 705b 6d5d 203d 2072 6f69 302e 6765 745f  p[m] = roi0.get_
-000287b0: 7265 6c61 7469 7665 5f76 6f6c 756d 655f  relative_volume_
-000287c0: 6469 6666 280a 2020 2020 2020 2020 2020  diff(.          
-000287d0: 2020 2020 2020 2020 2020 726f 692c 0a20            roi,. 
-000287e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000287f0: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
-00028800: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00028810: 2020 2020 2020 666f 7263 653d 666f 7263        force=forc
-00028820: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00028830: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00028840: 656c 6966 206d 203d 3d20 2276 6f6c 756d  elif m == "volum
-00028850: 655f 7261 7469 6f22 3a0a 2020 2020 2020  e_ratio":.      
-00028860: 2020 2020 2020 2020 2020 636f 6d70 5b6d            comp[m
-00028870: 5d20 3d20 726f 6930 2e67 6574 5f76 6f6c  ] = roi0.get_vol
-00028880: 756d 655f 7261 7469 6f28 0a20 2020 2020  ume_ratio(.     
-00028890: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000288a0: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
-000288b0: 2020 2020 2020 2020 6d65 7468 6f64 3d6d          method=m
-000288c0: 6574 686f 642c 0a20 2020 2020 2020 2020  ethod,.         
-000288d0: 2020 2020 2020 2020 2020 2066 6f72 6365             force
-000288e0: 3d66 6f72 6365 0a20 2020 2020 2020 2020  =force.         
-000288f0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00028900: 2020 2020 2020 2320 4172 6561 206d 6574        # Area met
-00028910: 7269 6373 0a20 2020 2020 2020 2020 2020  rics.           
-00028920: 2065 6c69 6620 6d20 3d3d 2022 6172 6561   elif m == "area
-00028930: 5f64 6966 6622 3a0a 2020 2020 2020 2020  _diff":.        
-00028940: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
-00028950: 3d20 726f 6930 2e67 6574 5f61 7265 615f  = roi0.get_area_
-00028960: 6469 6666 280a 2020 2020 2020 2020 2020  diff(.          
-00028970: 2020 2020 2020 2020 2020 726f 692c 0a20            roi,. 
+00028740: 2020 2020 2020 756e 6974 733d 766f 6c5f        units=vol_
+00028750: 756e 6974 732c 0a20 2020 2020 2020 2020  units,.         
+00028760: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+00028770: 643d 6d65 7468 6f64 2c0a 2020 2020 2020  d=method,.      
+00028780: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00028790: 7263 653d 666f 7263 650a 2020 2020 2020  rce=force.      
+000287a0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000287b0: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
+000287c0: 3d20 2272 656c 5f76 6f6c 756d 655f 6469  = "rel_volume_di
+000287d0: 6666 223a 0a20 2020 2020 2020 2020 2020  ff":.           
+000287e0: 2020 2020 2063 6f6d 705b 6d5d 203d 2072       comp[m] = r
+000287f0: 6f69 302e 6765 745f 7265 6c61 7469 7665  oi0.get_relative
+00028800: 5f76 6f6c 756d 655f 6469 6666 280a 2020  _volume_diff(.  
+00028810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028820: 2020 726f 692c 0a20 2020 2020 2020 2020    roi,.         
+00028830: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+00028840: 643d 6d65 7468 6f64 2c0a 2020 2020 2020  d=method,.      
+00028850: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00028860: 7263 653d 666f 7263 650a 2020 2020 2020  rce=force.      
+00028870: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00028880: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
+00028890: 3d20 2276 6f6c 756d 655f 7261 7469 6f22  = "volume_ratio"
+000288a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000288b0: 2020 636f 6d70 5b6d 5d20 3d20 726f 6930    comp[m] = roi0
+000288c0: 2e67 6574 5f76 6f6c 756d 655f 7261 7469  .get_volume_rati
+000288d0: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
+000288e0: 2020 2020 2020 2072 6f69 2c0a 2020 2020         roi,.    
+000288f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028900: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
+00028910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028920: 2020 2066 6f72 6365 3d66 6f72 6365 0a20     force=force. 
+00028930: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00028940: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00028950: 4172 6561 206d 6574 7269 6373 0a20 2020  Area metrics.   
+00028960: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
+00028970: 3d3d 2022 6172 6561 5f64 6966 6622 3a0a  == "area_diff":.
 00028980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028990: 2020 2075 6e69 7473 3d61 7265 615f 756e     units=area_un
-000289a0: 6974 732c 0a20 2020 2020 2020 2020 2020  its,.           
-000289b0: 2020 2020 2020 2020 206d 6574 686f 643d           method=
-000289c0: 6d65 7468 6f64 2c0a 2020 2020 2020 2020  method,.        
-000289d0: 2020 2020 2020 2020 2020 2020 2a2a 736c              **sl
-000289e0: 6963 655f 6b77 6172 6773 0a20 2020 2020  ice_kwargs.     
-000289f0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00028a00: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
-00028a10: 3d3d 2022 7265 6c5f 6172 6561 5f64 6966  == "rel_area_dif
-00028a20: 6622 3a0a 2020 2020 2020 2020 2020 2020  f":.            
-00028a30: 2020 2020 636f 6d70 5b6d 5d20 3d20 726f      comp[m] = ro
-00028a40: 6930 2e67 6574 5f72 656c 6174 6976 655f  i0.get_relative_
-00028a50: 6172 6561 5f64 6966 6628 0a20 2020 2020  area_diff(.     
-00028a60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00028a70: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
-00028a80: 2020 2020 2020 2020 6d65 7468 6f64 3d6d          method=m
-00028a90: 6574 686f 642c 0a20 2020 2020 2020 2020  ethod,.         
-00028aa0: 2020 2020 2020 2020 2020 202a 2a73 6c69             **sli
-00028ab0: 6365 5f6b 7761 7267 730a 2020 2020 2020  ce_kwargs.      
-00028ac0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00028ad0: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
-00028ae0: 3d20 2261 7265 615f 7261 7469 6f22 3a0a  = "area_ratio":.
-00028af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028b00: 636f 6d70 5b6d 5d20 3d20 726f 6930 2e67  comp[m] = roi0.g
-00028b10: 6574 5f61 7265 615f 7261 7469 6f28 0a20  et_area_ratio(. 
-00028b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028b30: 2020 2072 6f69 2c0a 2020 2020 2020 2020     roi,.        
-00028b40: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
-00028b50: 6f64 3d6d 6574 686f 642c 0a20 2020 2020  od=method,.     
-00028b60: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00028b70: 2a73 6c69 6365 5f6b 7761 7267 730a 2020  *slice_kwargs.  
-00028b80: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00028b90: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00028ba0: 206d 203d 3d20 2261 7265 615f 6469 6666   m == "area_diff
-00028bb0: 5f66 6c61 7422 3a0a 2020 2020 2020 2020  _flat":.        
-00028bc0: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
-00028bd0: 3d20 726f 6930 2e67 6574 5f61 7265 615f  = roi0.get_area_
-00028be0: 6469 6666 280a 2020 2020 2020 2020 2020  diff(.          
-00028bf0: 2020 2020 2020 2020 2020 726f 692c 0a20            roi,. 
+00028990: 636f 6d70 5b6d 5d20 3d20 726f 6930 2e67  comp[m] = roi0.g
+000289a0: 6574 5f61 7265 615f 6469 6666 280a 2020  et_area_diff(.  
+000289b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000289c0: 2020 726f 692c 0a20 2020 2020 2020 2020    roi,.         
+000289d0: 2020 2020 2020 2020 2020 2075 6e69 7473             units
+000289e0: 3d61 7265 615f 756e 6974 732c 0a20 2020  =area_units,.   
+000289f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028a00: 206d 6574 686f 643d 6d65 7468 6f64 2c0a   method=method,.
+00028a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028a20: 2020 2020 2a2a 736c 6963 655f 6b77 6172      **slice_kwar
+00028a30: 6773 0a20 2020 2020 2020 2020 2020 2020  gs.             
+00028a40: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00028a50: 2065 6c69 6620 6d20 3d3d 2022 7265 6c5f   elif m == "rel_
+00028a60: 6172 6561 5f64 6966 6622 3a0a 2020 2020  area_diff":.    
+00028a70: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00028a80: 5b6d 5d20 3d20 726f 6930 2e67 6574 5f72  [m] = roi0.get_r
+00028a90: 656c 6174 6976 655f 6172 6561 5f64 6966  elative_area_dif
+00028aa0: 6628 0a20 2020 2020 2020 2020 2020 2020  f(.             
+00028ab0: 2020 2020 2020 2072 6f69 2c0a 2020 2020         roi,.    
+00028ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028ad0: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
+00028ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028af0: 2020 202a 2a73 6c69 6365 5f6b 7761 7267     **slice_kwarg
+00028b00: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00028b10: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00028b20: 656c 6966 206d 203d 3d20 2261 7265 615f  elif m == "area_
+00028b30: 7261 7469 6f22 3a0a 2020 2020 2020 2020  ratio":.        
+00028b40: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
+00028b50: 3d20 726f 6930 2e67 6574 5f61 7265 615f  = roi0.get_area_
+00028b60: 7261 7469 6f28 0a20 2020 2020 2020 2020  ratio(.         
+00028b70: 2020 2020 2020 2020 2020 2072 6f69 2c0a             roi,.
+00028b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028b90: 2020 2020 6d65 7468 6f64 3d6d 6574 686f      method=metho
+00028ba0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+00028bb0: 2020 2020 2020 202a 2a73 6c69 6365 5f6b         **slice_k
+00028bc0: 7761 7267 730a 2020 2020 2020 2020 2020  wargs.          
+00028bd0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00028be0: 2020 2020 656c 6966 206d 203d 3d20 2261      elif m == "a
+00028bf0: 7265 615f 6469 6666 5f66 6c61 7422 3a0a  rea_diff_flat":.
 00028c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028c10: 2020 2075 6e69 7473 3d61 7265 615f 756e     units=area_un
-00028c20: 6974 732c 0a20 2020 2020 2020 2020 2020  its,.           
-00028c30: 2020 2020 2020 2020 206d 6574 686f 643d           method=
-00028c40: 6d65 7468 6f64 2c0a 2020 2020 2020 2020  method,.        
-00028c50: 2020 2020 2020 2020 2020 2020 7669 6577              view
-00028c60: 3d76 6965 772c 0a20 2020 2020 2020 2020  =view,.         
-00028c70: 2020 2020 2020 2020 2020 2066 6c61 7474             flatt
-00028c80: 656e 3d54 7275 652c 0a20 2020 2020 2020  en=True,.       
-00028c90: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00028ca0: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
-00028cb0: 3d20 2261 7265 615f 6469 6666 5f73 6c69  = "area_diff_sli
-00028cc0: 6365 5f73 7461 7473 223a 0a20 2020 2020  ce_stats":.     
-00028cd0: 2020 2020 2020 2020 2020 2063 6f6d 702e             comp.
-00028ce0: 7570 6461 7465 2872 6f69 302e 6765 745f  update(roi0.get_
-00028cf0: 736c 6963 655f 7374 6174 7328 726f 692c  slice_stats(roi,
-00028d00: 206d 6574 7269 6373 3d22 6172 6561 5f64   metrics="area_d
-00028d10: 6966 6622 2c0a 2020 2020 2020 2020 2020  iff",.          
-00028d20: 2020 2020 2020 2020 2020 2020 2020 736c                sl
-00028d30: 6963 655f 7374 6174 733d 736c 6963 655f  ice_stats=slice_
-00028d40: 7374 6174 732c 0a20 2020 2020 2020 2020  stats,.         
-00028d50: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00028d60: 6566 6175 6c74 5f62 795f 736c 6963 653d  efault_by_slice=
-00028d70: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
-00028d80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00028d90: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-00028da0: 3d6d 6574 686f 642c 2076 6965 773d 7669  =method, view=vi
-00028db0: 6577 2929 0a0a 2020 2020 2020 2020 2020  ew))..          
-00028dc0: 2020 656c 6966 206d 203d 3d20 2272 656c    elif m == "rel
-00028dd0: 5f61 7265 615f 6469 6666 5f66 6c61 7422  _area_diff_flat"
-00028de0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00028df0: 2020 636f 6d70 5b6d 5d20 3d20 726f 6930    comp[m] = roi0
-00028e00: 2e67 6574 5f72 656c 6174 6976 655f 6172  .get_relative_ar
-00028e10: 6561 5f64 6966 6628 0a20 2020 2020 2020  ea_diff(.       
-00028e20: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-00028e30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00028e40: 2020 2020 2020 7669 6577 3d76 6965 772c        view=view,
-00028e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028e60: 2020 2020 206d 6574 686f 643d 6d65 7468       method=meth
-00028e70: 6f64 2c0a 2020 2020 2020 2020 2020 2020  od,.            
-00028e80: 2020 2020 2020 2020 666c 6174 7465 6e3d          flatten=
-00028e90: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-00028ea0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00028eb0: 2020 2020 2065 6c69 6620 6d20 3d3d 2022       elif m == "
-00028ec0: 7265 6c5f 6172 6561 5f64 6966 665f 736c  rel_area_diff_sl
-00028ed0: 6963 655f 7374 6174 7322 3a0a 2020 2020  ice_stats":.    
-00028ee0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00028ef0: 2e75 7064 6174 6528 726f 6930 2e67 6574  .update(roi0.get
-00028f00: 5f73 6c69 6365 5f73 7461 7473 2872 6f69  _slice_stats(roi
-00028f10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00028f20: 2020 2020 2020 6d65 7472 6963 733d 2272        metrics="r
-00028f30: 656c 5f61 7265 615f 6469 6666 222c 0a20  el_area_diff",. 
-00028f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028f50: 2020 2073 6c69 6365 5f73 7461 7473 3d73     slice_stats=s
-00028f60: 6c69 6365 5f73 7461 7473 2c0a 2020 2020  lice_stats,.    
-00028f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028f80: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
-00028f90: 3d64 6566 6175 6c74 5f62 795f 736c 6963  =default_by_slic
-00028fa0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00028fb0: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
-00028fc0: 7468 6f64 2c20 7669 6577 3d76 6965 7729  thod, view=view)
-00028fd0: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00028fe0: 6c69 6620 6d20 3d3d 2022 6172 6561 5f72  lif m == "area_r
-00028ff0: 6174 696f 5f66 6c61 7422 3a0a 2020 2020  atio_flat":.    
-00029000: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00029010: 5b6d 5d20 3d20 726f 6930 2e67 6574 5f61  [m] = roi0.get_a
-00029020: 7265 615f 7261 7469 6f28 0a20 2020 2020  rea_ratio(.     
-00029030: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00029040: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
-00029050: 2020 2020 2020 2020 7669 6577 3d76 6965          view=vie
-00029060: 772c 0a20 2020 2020 2020 2020 2020 2020  w,.             
-00029070: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
-00029080: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
-00029090: 2020 2020 2020 2020 2020 666c 6174 7465            flatte
-000290a0: 6e3d 5472 7565 2c0a 2020 2020 2020 2020  n=True,.        
-000290b0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-000290c0: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
-000290d0: 2022 6172 6561 5f72 6174 696f 5f73 6c69   "area_ratio_sli
-000290e0: 6365 5f73 7461 7473 223a 0a20 2020 2020  ce_stats":.     
-000290f0: 2020 2020 2020 2020 2020 2063 6f6d 702e             comp.
-00029100: 7570 6461 7465 2872 6f69 302e 6765 745f  update(roi0.get_
-00029110: 736c 6963 655f 7374 6174 7328 726f 692c  slice_stats(roi,
-00029120: 206d 6574 7269 6373 3d22 6172 6561 5f72   metrics="area_r
-00029130: 6174 696f 222c 0a20 2020 2020 2020 2020  atio",.         
-00029140: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00029150: 6c69 6365 5f73 7461 7473 3d73 6c69 6365  lice_stats=slice
-00029160: 5f73 7461 7473 2c0a 2020 2020 2020 2020  _stats,.        
-00029170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029180: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
-00029190: 3d64 6566 6175 6c74 5f62 795f 736c 6963  =default_by_slic
-000291a0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-000291b0: 2020 2020 2020 2020 2020 206d 6574 686f             metho
-000291c0: 643d 6d65 7468 6f64 2c20 7669 6577 3d76  d=method, view=v
-000291d0: 6965 7729 290a 0a20 2020 2020 2020 2020  iew))..         
-000291e0: 2020 2023 2053 7572 6661 6365 2064 6973     # Surface dis
-000291f0: 7461 6e63 6520 6d65 7472 6963 730a 2020  tance metrics.  
-00029200: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-00029210: 2069 6e20 5b22 6d65 616e 5f73 7572 6661   in ["mean_surfa
-00029220: 6365 5f64 6973 7461 6e63 6522 2c0a 2020  ce_distance",.  
-00029230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029240: 2020 2272 6d73 5f73 7572 6661 6365 5f64    "rms_surface_d
-00029250: 6973 7461 6e63 6522 2c20 2268 6175 7364  istance", "hausd
-00029260: 6f72 6666 5f64 6973 7461 6e63 6522 5d3a  orff_distance"]:
-00029270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029280: 2064 6973 7461 6e63 6573 203d 2028 6469   distances = (di
-00029290: 7374 616e 6365 730a 2020 2020 2020 2020  stances.        
-000292a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000292b0: 6f72 2072 6f69 302e 6765 745f 7375 7266  or roi0.get_surf
-000292c0: 6163 655f 6469 7374 616e 6365 5f6d 6574  ace_distance_met
-000292d0: 7269 6373 2872 6f69 2929 0a20 2020 2020  rics(roi)).     
-000292e0: 2020 2020 2020 2020 2020 2069 6620 6d20             if m 
-000292f0: 3d3d 2022 6d65 616e 5f73 7572 6661 6365  == "mean_surface
-00029300: 5f64 6973 7461 6e63 6522 3a0a 2020 2020  _distance":.    
-00029310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029320: 636f 6d70 5b6d 5d20 3d20 6469 7374 616e  comp[m] = distan
-00029330: 6365 735b 305d 0a20 2020 2020 2020 2020  ces[0].         
-00029340: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
-00029350: 2022 726d 735f 7375 7266 6163 655f 6469   "rms_surface_di
-00029360: 7374 616e 6365 223a 0a20 2020 2020 2020  stance":.       
-00029370: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-00029380: 705b 6d5d 203d 2064 6973 7461 6e63 6573  p[m] = distances
-00029390: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
-000293a0: 2020 2020 656c 6966 206d 203d 3d20 2268      elif m == "h
-000293b0: 6175 7364 6f72 6666 5f64 6973 7461 6e63  ausdorff_distanc
-000293c0: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
-000293d0: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
-000293e0: 3d20 6469 7374 616e 6365 735b 325d 0a20  = distances[2]. 
-000293f0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00029400: 6d20 696e 205b 226d 6561 6e5f 7375 7266  m in ["mean_surf
-00029410: 6163 655f 6469 7374 616e 6365 5f66 6c61  ace_distance_fla
-00029420: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
-00029430: 2020 2020 2020 2020 2272 6d73 5f73 7572          "rms_sur
-00029440: 6661 6365 5f64 6973 7461 6e63 655f 666c  face_distance_fl
-00029450: 6174 222c 2022 6861 7573 646f 7266 665f  at", "hausdorff_
-00029460: 6469 7374 616e 6365 5f66 6c61 7422 5d3a  distance_flat"]:
-00029470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029480: 2064 6973 7461 6e63 6573 5f66 6c61 7420   distances_flat 
-00029490: 3d20 2864 6973 7461 6e63 6573 5f66 6c61  = (distances_fla
-000294a0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-000294b0: 2020 2020 2020 2020 2020 6f72 2072 6f69            or roi
-000294c0: 302e 6765 745f 7375 7266 6163 655f 6469  0.get_surface_di
-000294d0: 7374 616e 6365 5f6d 6574 7269 6373 2872  stance_metrics(r
-000294e0: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
-000294f0: 2020 2020 2020 2020 2020 2020 7669 6577              view
-00029500: 3d76 6965 772c 2066 6c61 7474 656e 3d54  =view, flatten=T
-00029510: 7275 6529 290a 2020 2020 2020 2020 2020  rue)).          
-00029520: 2020 2020 2020 6966 206d 203d 3d20 226d        if m == "m
-00029530: 6561 6e5f 7375 7266 6163 655f 6469 7374  ean_surface_dist
-00029540: 616e 6365 5f66 6c61 7422 3a0a 2020 2020  ance_flat":.    
-00029550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029560: 636f 6d70 5b6d 5d20 3d20 6469 7374 616e  comp[m] = distan
-00029570: 6365 735f 666c 6174 5b30 5d0a 2020 2020  ces_flat[0].    
-00029580: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00029590: 206d 203d 3d20 2272 6d73 5f73 7572 6661   m == "rms_surfa
-000295a0: 6365 5f64 6973 7461 6e63 655f 666c 6174  ce_distance_flat
-000295b0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-000295c0: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
-000295d0: 2064 6973 7461 6e63 6573 5f66 6c61 745b   distances_flat[
-000295e0: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
-000295f0: 2020 2065 6c69 6620 6d20 3d3d 2022 6861     elif m == "ha
-00029600: 7573 646f 7266 665f 6469 7374 616e 6365  usdorff_distance
-00029610: 5f66 6c61 7422 3a0a 2020 2020 2020 2020  _flat":.        
-00029620: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00029630: 5b6d 5d20 3d20 6469 7374 616e 6365 735f  [m] = distances_
-00029640: 666c 6174 5b32 5d0a 2020 2020 2020 2020  flat[2].        
-00029650: 2020 2020 656c 6966 206d 2069 6e20 5b22      elif m in ["
-00029660: 6d65 616e 5f73 6967 6e65 645f 7375 7266  mean_signed_surf
-00029670: 6163 655f 6469 7374 616e 6365 222c 0a20  ace_distance",. 
-00029680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029690: 2020 2022 726d 735f 7369 676e 6564 5f73     "rms_signed_s
-000296a0: 7572 6661 6365 5f64 6973 7461 6e63 6522  urface_distance"
-000296b0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-000296c0: 2020 2073 6967 6e65 645f 6469 7374 616e     signed_distan
-000296d0: 6365 7320 3d20 2873 6967 6e65 645f 6469  ces = (signed_di
-000296e0: 7374 616e 6365 730a 2020 2020 2020 2020  stances.        
-000296f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029700: 6f72 2072 6f69 302e 6765 745f 7375 7266  or roi0.get_surf
-00029710: 6163 655f 6469 7374 616e 6365 5f6d 6574  ace_distance_met
-00029720: 7269 6373 2872 6f69 2c20 7369 676e 6564  rics(roi, signed
-00029730: 3d54 7275 6529 290a 2020 2020 2020 2020  =True)).        
-00029740: 2020 2020 2020 2020 6966 206d 203d 3d20          if m == 
-00029750: 226d 6561 6e5f 7369 676e 6564 5f73 7572  "mean_signed_sur
-00029760: 6661 6365 5f64 6973 7461 6e63 6522 3a0a  face_distance":.
-00029770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029780: 2020 2020 636f 6d70 5b6d 5d20 3d20 7369      comp[m] = si
-00029790: 676e 6564 5f64 6973 7461 6e63 6573 5b30  gned_distances[0
-000297a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000297b0: 2020 656c 6966 206d 203d 3d20 2272 6d73    elif m == "rms
-000297c0: 5f73 6967 6e65 645f 7375 7266 6163 655f  _signed_surface_
-000297d0: 6469 7374 616e 6365 223a 0a20 2020 2020  distance":.     
-000297e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000297f0: 6f6d 705b 6d5d 203d 2073 6967 6e65 645f  omp[m] = signed_
-00029800: 6469 7374 616e 6365 735b 315d 0a20 2020  distances[1].   
-00029810: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
-00029820: 696e 205b 226d 6561 6e5f 7369 676e 6564  in ["mean_signed
-00029830: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
-00029840: 655f 666c 6174 222c 0a20 2020 2020 2020  e_flat",.       
-00029850: 2020 2020 2020 2020 2020 2020 2022 726d               "rm
-00029860: 735f 7369 676e 6564 5f73 7572 6661 6365  s_signed_surface
-00029870: 5f64 6973 7461 6e63 655f 666c 6174 225d  _distance_flat"]
-00029880: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00029890: 2020 7369 676e 6564 5f64 6973 7461 6e63    signed_distanc
-000298a0: 6573 5f66 6c61 7420 3d20 2873 6967 6e65  es_flat = (signe
-000298b0: 645f 6469 7374 616e 6365 735f 666c 6174  d_distances_flat
-000298c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000298d0: 2020 2020 2020 2020 206f 7220 726f 6930           or roi0
-000298e0: 2e67 6574 5f73 7572 6661 6365 5f64 6973  .get_surface_dis
-000298f0: 7461 6e63 655f 6d65 7472 6963 7328 726f  tance_metrics(ro
-00029900: 692c 2073 6967 6e65 643d 5472 7565 2c0a  i, signed=True,.
+00028c10: 636f 6d70 5b6d 5d20 3d20 726f 6930 2e67  comp[m] = roi0.g
+00028c20: 6574 5f61 7265 615f 6469 6666 280a 2020  et_area_diff(.  
+00028c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028c40: 2020 726f 692c 0a20 2020 2020 2020 2020    roi,.         
+00028c50: 2020 2020 2020 2020 2020 2075 6e69 7473             units
+00028c60: 3d61 7265 615f 756e 6974 732c 0a20 2020  =area_units,.   
+00028c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028c80: 206d 6574 686f 643d 6d65 7468 6f64 2c0a   method=method,.
+00028c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028ca0: 2020 2020 7669 6577 3d76 6965 772c 0a20      view=view,. 
+00028cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028cc0: 2020 2066 6c61 7474 656e 3d54 7275 652c     flatten=True,
+00028cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028ce0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+00028cf0: 656c 6966 206d 203d 3d20 2261 7265 615f  elif m == "area_
+00028d00: 6469 6666 5f73 6c69 6365 5f73 7461 7473  diff_slice_stats
+00028d10: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00028d20: 2020 2063 6f6d 702e 7570 6461 7465 2872     comp.update(r
+00028d30: 6f69 302e 6765 745f 736c 6963 655f 7374  oi0.get_slice_st
+00028d40: 6174 7328 726f 692c 206d 6574 7269 6373  ats(roi, metrics
+00028d50: 3d22 6172 6561 5f64 6966 6622 2c0a 2020  ="area_diff",.  
+00028d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028d70: 2020 2020 2020 736c 6963 655f 7374 6174        slice_stat
+00028d80: 733d 736c 6963 655f 7374 6174 732c 0a20  s=slice_stats,. 
+00028d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028da0: 2020 2020 2020 2064 6566 6175 6c74 5f62         default_b
+00028db0: 795f 736c 6963 653d 6465 6661 756c 745f  y_slice=default_
+00028dc0: 6279 5f73 6c69 6365 2c0a 2020 2020 2020  by_slice,.      
+00028dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028de0: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
+00028df0: 2076 6965 773d 7669 6577 2929 0a0a 2020   view=view))..  
+00028e00: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+00028e10: 203d 3d20 2272 656c 5f61 7265 615f 6469   == "rel_area_di
+00028e20: 6666 5f66 6c61 7422 3a0a 2020 2020 2020  ff_flat":.      
+00028e30: 2020 2020 2020 2020 2020 636f 6d70 5b6d            comp[m
+00028e40: 5d20 3d20 726f 6930 2e67 6574 5f72 656c  ] = roi0.get_rel
+00028e50: 6174 6976 655f 6172 6561 5f64 6966 6628  ative_area_diff(
+00028e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028e70: 2020 2020 2072 6f69 2c0a 2020 2020 2020       roi,.      
+00028e80: 2020 2020 2020 2020 2020 2020 2020 7669                vi
+00028e90: 6577 3d76 6965 772c 0a20 2020 2020 2020  ew=view,.       
+00028ea0: 2020 2020 2020 2020 2020 2020 206d 6574               met
+00028eb0: 686f 643d 6d65 7468 6f64 2c0a 2020 2020  hod=method,.    
+00028ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028ed0: 666c 6174 7465 6e3d 5472 7565 2c0a 2020  flatten=True,.  
+00028ee0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00028ef0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00028f00: 6620 6d20 3d3d 2022 7265 6c5f 6172 6561  f m == "rel_area
+00028f10: 5f64 6966 665f 736c 6963 655f 7374 6174  _diff_slice_stat
+00028f20: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
+00028f30: 2020 2020 636f 6d70 2e75 7064 6174 6528      comp.update(
+00028f40: 726f 6930 2e67 6574 5f73 6c69 6365 5f73  roi0.get_slice_s
+00028f50: 7461 7473 2872 6f69 2c0a 2020 2020 2020  tats(roi,.      
+00028f60: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00028f70: 7472 6963 733d 2272 656c 5f61 7265 615f  trics="rel_area_
+00028f80: 6469 6666 222c 0a20 2020 2020 2020 2020  diff",.         
+00028f90: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
+00028fa0: 5f73 7461 7473 3d73 6c69 6365 5f73 7461  _stats=slice_sta
+00028fb0: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00028fc0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00028fd0: 6279 5f73 6c69 6365 3d64 6566 6175 6c74  by_slice=default
+00028fe0: 5f62 795f 736c 6963 652c 0a20 2020 2020  _by_slice,.     
+00028ff0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00029000: 6574 686f 643d 6d65 7468 6f64 2c20 7669  ethod=method, vi
+00029010: 6577 3d76 6965 7729 290a 0a20 2020 2020  ew=view))..     
+00029020: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
+00029030: 2022 6172 6561 5f72 6174 696f 5f66 6c61   "area_ratio_fla
+00029040: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
+00029050: 2020 2020 636f 6d70 5b6d 5d20 3d20 726f      comp[m] = ro
+00029060: 6930 2e67 6574 5f61 7265 615f 7261 7469  i0.get_area_rati
+00029070: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
+00029080: 2020 2020 2020 2072 6f69 2c0a 2020 2020         roi,.    
+00029090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000290a0: 7669 6577 3d76 6965 772c 0a20 2020 2020  view=view,.     
+000290b0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000290c0: 6574 686f 643d 6d65 7468 6f64 2c0a 2020  ethod=method,.  
+000290d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000290e0: 2020 666c 6174 7465 6e3d 5472 7565 2c0a    flatten=True,.
+000290f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029100: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00029110: 6c69 6620 6d20 3d3d 2022 6172 6561 5f72  lif m == "area_r
+00029120: 6174 696f 5f73 6c69 6365 5f73 7461 7473  atio_slice_stats
+00029130: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00029140: 2020 2063 6f6d 702e 7570 6461 7465 2872     comp.update(r
+00029150: 6f69 302e 6765 745f 736c 6963 655f 7374  oi0.get_slice_st
+00029160: 6174 7328 726f 692c 206d 6574 7269 6373  ats(roi, metrics
+00029170: 3d22 6172 6561 5f72 6174 696f 222c 0a20  ="area_ratio",. 
+00029180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029190: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
+000291a0: 7473 3d73 6c69 6365 5f73 7461 7473 2c0a  ts=slice_stats,.
+000291b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000291c0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+000291d0: 6279 5f73 6c69 6365 3d64 6566 6175 6c74  by_slice=default
+000291e0: 5f62 795f 736c 6963 652c 0a20 2020 2020  _by_slice,.     
+000291f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029200: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
+00029210: 2c20 7669 6577 3d76 6965 7729 290a 0a20  , view=view)).. 
+00029220: 2020 2020 2020 2020 2020 2023 2053 7572             # Sur
+00029230: 6661 6365 2064 6973 7461 6e63 6520 6d65  face distance me
+00029240: 7472 6963 730a 2020 2020 2020 2020 2020  trics.          
+00029250: 2020 656c 6966 206d 2069 6e20 5b22 6d65    elif m in ["me
+00029260: 616e 5f73 7572 6661 6365 5f64 6973 7461  an_surface_dista
+00029270: 6e63 6522 2c0a 2020 2020 2020 2020 2020  nce",.          
+00029280: 2020 2020 2020 2020 2020 2272 6d73 5f73            "rms_s
+00029290: 7572 6661 6365 5f64 6973 7461 6e63 6522  urface_distance"
+000292a0: 2c20 2268 6175 7364 6f72 6666 5f64 6973  , "hausdorff_dis
+000292b0: 7461 6e63 6522 5d3a 0a20 2020 2020 2020  tance"]:.       
+000292c0: 2020 2020 2020 2020 2064 6973 7461 6e63           distanc
+000292d0: 6573 203d 2028 6469 7374 616e 6365 730a  es = (distances.
+000292e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000292f0: 2020 2020 2020 2020 6f72 2072 6f69 302e          or roi0.
+00029300: 6765 745f 7375 7266 6163 655f 6469 7374  get_surface_dist
+00029310: 616e 6365 5f6d 6574 7269 6373 2872 6f69  ance_metrics(roi
+00029320: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00029330: 2020 2069 6620 6d20 3d3d 2022 6d65 616e     if m == "mean
+00029340: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
+00029350: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
+00029360: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
+00029370: 3d20 6469 7374 616e 6365 735b 305d 0a20  = distances[0]. 
+00029380: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00029390: 6c69 6620 6d20 3d3d 2022 726d 735f 7375  lif m == "rms_su
+000293a0: 7266 6163 655f 6469 7374 616e 6365 223a  rface_distance":
+000293b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000293c0: 2020 2020 2063 6f6d 705b 6d5d 203d 2064       comp[m] = d
+000293d0: 6973 7461 6e63 6573 5b31 5d0a 2020 2020  istances[1].    
+000293e0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000293f0: 206d 203d 3d20 2268 6175 7364 6f72 6666   m == "hausdorff
+00029400: 5f64 6973 7461 6e63 6522 3a0a 2020 2020  _distance":.    
+00029410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029420: 636f 6d70 5b6d 5d20 3d20 6469 7374 616e  comp[m] = distan
+00029430: 6365 735b 325d 0a20 2020 2020 2020 2020  ces[2].         
+00029440: 2020 2065 6c69 6620 6d20 696e 205b 226d     elif m in ["m
+00029450: 6561 6e5f 7375 7266 6163 655f 6469 7374  ean_surface_dist
+00029460: 616e 6365 5f66 6c61 7422 2c0a 2020 2020  ance_flat",.    
+00029470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029480: 2272 6d73 5f73 7572 6661 6365 5f64 6973  "rms_surface_dis
+00029490: 7461 6e63 655f 666c 6174 222c 2022 6861  tance_flat", "ha
+000294a0: 7573 646f 7266 665f 6469 7374 616e 6365  usdorff_distance
+000294b0: 5f66 6c61 7422 5d3a 0a20 2020 2020 2020  _flat"]:.       
+000294c0: 2020 2020 2020 2020 2064 6973 7461 6e63           distanc
+000294d0: 6573 5f66 6c61 7420 3d20 2864 6973 7461  es_flat = (dista
+000294e0: 6e63 6573 5f66 6c61 740a 2020 2020 2020  nces_flat.      
+000294f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029500: 2020 6f72 2072 6f69 302e 6765 745f 7375    or roi0.get_su
+00029510: 7266 6163 655f 6469 7374 616e 6365 5f6d  rface_distance_m
+00029520: 6574 7269 6373 2872 6f69 2c0a 2020 2020  etrics(roi,.    
+00029530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029540: 2020 2020 7669 6577 3d76 6965 772c 2066      view=view, f
+00029550: 6c61 7474 656e 3d54 7275 6529 290a 2020  latten=True)).  
+00029560: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00029570: 206d 203d 3d20 226d 6561 6e5f 7375 7266   m == "mean_surf
+00029580: 6163 655f 6469 7374 616e 6365 5f66 6c61  ace_distance_fla
+00029590: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
+000295a0: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
+000295b0: 3d20 6469 7374 616e 6365 735f 666c 6174  = distances_flat
+000295c0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+000295d0: 2020 2020 656c 6966 206d 203d 3d20 2272      elif m == "r
+000295e0: 6d73 5f73 7572 6661 6365 5f64 6973 7461  ms_surface_dista
+000295f0: 6e63 655f 666c 6174 223a 0a20 2020 2020  nce_flat":.     
+00029600: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00029610: 6f6d 705b 6d5d 203d 2064 6973 7461 6e63  omp[m] = distanc
+00029620: 6573 5f66 6c61 745b 315d 0a20 2020 2020  es_flat[1].     
+00029630: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00029640: 6d20 3d3d 2022 6861 7573 646f 7266 665f  m == "hausdorff_
+00029650: 6469 7374 616e 6365 5f66 6c61 7422 3a0a  distance_flat":.
+00029660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029670: 2020 2020 636f 6d70 5b6d 5d20 3d20 6469      comp[m] = di
+00029680: 7374 616e 6365 735f 666c 6174 5b32 5d0a  stances_flat[2].
+00029690: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000296a0: 206d 2069 6e20 5b22 6d65 616e 5f73 6967   m in ["mean_sig
+000296b0: 6e65 645f 7375 7266 6163 655f 6469 7374  ned_surface_dist
+000296c0: 616e 6365 222c 0a20 2020 2020 2020 2020  ance",.         
+000296d0: 2020 2020 2020 2020 2020 2022 726d 735f             "rms_
+000296e0: 7369 676e 6564 5f73 7572 6661 6365 5f64  signed_surface_d
+000296f0: 6973 7461 6e63 6522 5d3a 0a20 2020 2020  istance"]:.     
+00029700: 2020 2020 2020 2020 2020 2073 6967 6e65             signe
+00029710: 645f 6469 7374 616e 6365 7320 3d20 2873  d_distances = (s
+00029720: 6967 6e65 645f 6469 7374 616e 6365 730a  igned_distances.
+00029730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029740: 2020 2020 2020 2020 6f72 2072 6f69 302e          or roi0.
+00029750: 6765 745f 7375 7266 6163 655f 6469 7374  get_surface_dist
+00029760: 616e 6365 5f6d 6574 7269 6373 2872 6f69  ance_metrics(roi
+00029770: 2c20 7369 676e 6564 3d54 7275 6529 290a  , signed=True)).
+00029780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029790: 6966 206d 203d 3d20 226d 6561 6e5f 7369  if m == "mean_si
+000297a0: 676e 6564 5f73 7572 6661 6365 5f64 6973  gned_surface_dis
+000297b0: 7461 6e63 6522 3a0a 2020 2020 2020 2020  tance":.        
+000297c0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+000297d0: 5b6d 5d20 3d20 7369 676e 6564 5f64 6973  [m] = signed_dis
+000297e0: 7461 6e63 6573 5b30 5d0a 2020 2020 2020  tances[0].      
+000297f0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+00029800: 203d 3d20 2272 6d73 5f73 6967 6e65 645f   == "rms_signed_
+00029810: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
+00029820: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00029830: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
+00029840: 2073 6967 6e65 645f 6469 7374 616e 6365   signed_distance
+00029850: 735b 315d 0a20 2020 2020 2020 2020 2020  s[1].           
+00029860: 2065 6c69 6620 6d20 696e 205b 226d 6561   elif m in ["mea
+00029870: 6e5f 7369 676e 6564 5f73 7572 6661 6365  n_signed_surface
+00029880: 5f64 6973 7461 6e63 655f 666c 6174 222c  _distance_flat",
+00029890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000298a0: 2020 2020 2022 726d 735f 7369 676e 6564       "rms_signed
+000298b0: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
+000298c0: 655f 666c 6174 225d 3a0a 2020 2020 2020  e_flat"]:.      
+000298d0: 2020 2020 2020 2020 2020 7369 676e 6564            signed
+000298e0: 5f64 6973 7461 6e63 6573 5f66 6c61 7420  _distances_flat 
+000298f0: 3d20 2873 6967 6e65 645f 6469 7374 616e  = (signed_distan
+00029900: 6365 735f 666c 6174 0a20 2020 2020 2020  ces_flat.       
 00029910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029920: 2020 2020 2020 2020 2020 2020 7669 6577              view
-00029930: 3d76 6965 772c 2066 6c61 7474 656e 3d54  =view, flatten=T
-00029940: 7275 6529 290a 2020 2020 2020 2020 2020  rue)).          
-00029950: 2020 2020 2020 6966 206d 203d 3d20 226d        if m == "m
-00029960: 6561 6e5f 7369 676e 6564 5f73 7572 6661  ean_signed_surfa
-00029970: 6365 5f64 6973 7461 6e63 655f 666c 6174  ce_distance_flat
-00029980: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00029990: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
-000299a0: 2073 6967 6e65 645f 6469 7374 616e 6365   signed_distance
-000299b0: 735f 666c 6174 5b30 5d0a 2020 2020 2020  s_flat[0].      
-000299c0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-000299d0: 203d 3d20 2272 6d73 5f73 6967 6e65 645f   == "rms_signed_
-000299e0: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
-000299f0: 5f66 6c61 7422 3a0a 2020 2020 2020 2020  _flat":.        
-00029a00: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00029a10: 5b6d 5d20 3d20 7369 676e 6564 5f64 6973  [m] = signed_dis
-00029a20: 7461 6e63 6573 5f66 6c61 745b 315d 0a20  tances_flat[1]. 
-00029a30: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00029a40: 6d20 696e 205b 226d 6561 6e5f 756e 6465  m in ["mean_unde
-00029a50: 725f 636f 6e74 6f75 7269 6e67 222c 2022  r_contouring", "
-00029a60: 6d65 616e 5f6f 7665 725f 636f 6e74 6f75  mean_over_contou
-00029a70: 7269 6e67 222c 0a20 2020 2020 2020 2020  ring",.         
-00029a80: 2020 2020 2020 2020 2020 2022 6d65 616e             "mean
-00029a90: 5f64 6973 7461 6e63 655f 746f 5f63 6f6e  _distance_to_con
-00029aa0: 666f 726d 6974 7922 5d3a 0a20 2020 2020  formity"]:.     
-00029ab0: 2020 2020 2020 2020 2020 2063 6f6e 666f             confo
-00029ac0: 726d 6974 7920 3d20 2863 6f6e 666f 726d  rmity = (conform
-00029ad0: 6974 790a 2020 2020 2020 2020 2020 2020  ity.            
-00029ae0: 2020 2020 2020 2020 2020 2020 6f72 2072              or r
-00029af0: 6f69 302e 6765 745f 6d65 616e 5f64 6973  oi0.get_mean_dis
-00029b00: 7461 6e63 655f 746f 5f63 6f6e 666f 726d  tance_to_conform
-00029b10: 6974 7928 0a20 2020 2020 2020 2020 2020  ity(.           
+00029920: 206f 7220 726f 6930 2e67 6574 5f73 7572   or roi0.get_sur
+00029930: 6661 6365 5f64 6973 7461 6e63 655f 6d65  face_distance_me
+00029940: 7472 6963 7328 726f 692c 2073 6967 6e65  trics(roi, signe
+00029950: 643d 5472 7565 2c0a 2020 2020 2020 2020  d=True,.        
+00029960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029970: 2020 2020 7669 6577 3d76 6965 772c 2066      view=view, f
+00029980: 6c61 7474 656e 3d54 7275 6529 290a 2020  latten=True)).  
+00029990: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000299a0: 206d 203d 3d20 226d 6561 6e5f 7369 676e   m == "mean_sign
+000299b0: 6564 5f73 7572 6661 6365 5f64 6973 7461  ed_surface_dista
+000299c0: 6e63 655f 666c 6174 223a 0a20 2020 2020  nce_flat":.     
+000299d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000299e0: 6f6d 705b 6d5d 203d 2073 6967 6e65 645f  omp[m] = signed_
+000299f0: 6469 7374 616e 6365 735f 666c 6174 5b30  distances_flat[0
+00029a00: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00029a10: 2020 656c 6966 206d 203d 3d20 2272 6d73    elif m == "rms
+00029a20: 5f73 6967 6e65 645f 7375 7266 6163 655f  _signed_surface_
+00029a30: 6469 7374 616e 6365 5f66 6c61 7422 3a0a  distance_flat":.
+00029a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029a50: 2020 2020 636f 6d70 5b6d 5d20 3d20 7369      comp[m] = si
+00029a60: 676e 6564 5f64 6973 7461 6e63 6573 5f66  gned_distances_f
+00029a70: 6c61 745b 315d 0a20 2020 2020 2020 2020  lat[1].         
+00029a80: 2020 2065 6c69 6620 6d20 696e 205b 226d     elif m in ["m
+00029a90: 6561 6e5f 756e 6465 725f 636f 6e74 6f75  ean_under_contou
+00029aa0: 7269 6e67 222c 2022 6d65 616e 5f6f 7665  ring", "mean_ove
+00029ab0: 725f 636f 6e74 6f75 7269 6e67 222c 0a20  r_contouring",. 
+00029ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029ad0: 2020 2022 6d65 616e 5f64 6973 7461 6e63     "mean_distanc
+00029ae0: 655f 746f 5f63 6f6e 666f 726d 6974 7922  e_to_conformity"
+00029af0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00029b00: 2020 2063 6f6e 666f 726d 6974 7920 3d20     conformity = 
+00029b10: 2863 6f6e 666f 726d 6974 790a 2020 2020  (conformity.    
 00029b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029b30: 2072 6f69 2c20 766f 6c5f 756e 6974 7329   roi, vol_units)
-00029b40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00029b50: 2020 6966 206d 203d 3d20 226d 6561 6e5f    if m == "mean_
-00029b60: 756e 6465 725f 636f 6e74 6f75 7269 6e67  under_contouring
-00029b70: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00029b80: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
-00029b90: 2063 6f6e 666f 726d 6974 792e 6d65 616e   conformity.mean
-00029ba0: 5f75 6e64 6572 5f63 6f6e 746f 7572 696e  _under_contourin
-00029bb0: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-00029bc0: 2020 6966 206d 203d 3d20 226d 6561 6e5f    if m == "mean_
-00029bd0: 6f76 6572 5f63 6f6e 746f 7572 696e 6722  over_contouring"
-00029be0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00029bf0: 2020 2020 2020 636f 6d70 5b6d 5d20 3d20        comp[m] = 
-00029c00: 636f 6e66 6f72 6d69 7479 2e6d 6561 6e5f  conformity.mean_
-00029c10: 6f76 6572 5f63 6f6e 746f 7572 696e 670a  over_contouring.
-00029c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029c30: 6966 206d 203d 3d20 226d 6561 6e5f 6469  if m == "mean_di
-00029c40: 7374 616e 6365 5f74 6f5f 636f 6e66 6f72  stance_to_confor
-00029c50: 6d69 7479 223a 0a20 2020 2020 2020 2020  mity":.         
-00029c60: 2020 2020 2020 2020 2020 2063 6f6d 705b             comp[
-00029c70: 6d5d 203d 2063 6f6e 666f 726d 6974 792e  m] = conformity.
-00029c80: 6d65 616e 5f64 6973 7461 6e63 655f 746f  mean_distance_to
-00029c90: 5f63 6f6e 666f 726d 6974 790a 2020 2020  _conformity.    
-00029ca0: 2020 2020 2020 2020 656c 6966 206d 2069          elif m i
-00029cb0: 6e20 5b22 6d65 616e 5f75 6e64 6572 5f63  n ["mean_under_c
-00029cc0: 6f6e 746f 7572 696e 675f 666c 6174 222c  ontouring_flat",
-00029cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029ce0: 2020 2020 2022 6d65 616e 5f6f 7665 725f       "mean_over_
-00029cf0: 636f 6e74 6f75 7269 6e67 5f66 6c61 7422  contouring_flat"
-00029d00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00029d10: 2020 2020 2020 226d 6561 6e5f 6469 7374        "mean_dist
-00029d20: 616e 6365 5f74 6f5f 636f 6e66 6f72 6d69  ance_to_conformi
-00029d30: 7479 5f66 6c61 7422 5d3a 0a20 2020 2020  ty_flat"]:.     
-00029d40: 2020 2020 2020 2020 2020 2063 6f6e 666f             confo
-00029d50: 726d 6974 795f 666c 6174 203d 2028 636f  rmity_flat = (co
-00029d60: 6e66 6f72 6d69 7479 5f66 6c61 740a 2020  nformity_flat.  
-00029d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029d80: 2020 2020 2020 6f72 2072 6f69 302e 6765        or roi0.ge
-00029d90: 745f 6d65 616e 5f64 6973 7461 6e63 655f  t_mean_distance_
-00029da0: 746f 5f63 6f6e 666f 726d 6974 7928 0a20  to_conformity(. 
-00029db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029dc0: 2020 2020 2020 2020 2020 2072 6f69 2c20             roi, 
-00029dd0: 766f 6c5f 756e 6974 732c 2076 6965 773d  vol_units, view=
-00029de0: 7669 6577 2c20 666c 6174 7465 6e3d 5472  view, flatten=Tr
-00029df0: 7565 2929 0a20 2020 2020 2020 2020 2020  ue)).           
-00029e00: 2020 2020 2069 6620 6d20 3d3d 2022 6d65       if m == "me
-00029e10: 616e 5f75 6e64 6572 5f63 6f6e 746f 7572  an_under_contour
-00029e20: 696e 675f 666c 6174 223a 0a20 2020 2020  ing_flat":.     
-00029e30: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00029e40: 6f6d 705b 6d5d 203d 2063 6f6e 666f 726d  omp[m] = conform
-00029e50: 6974 795f 666c 6174 2e6d 6561 6e5f 756e  ity_flat.mean_un
-00029e60: 6465 725f 636f 6e74 6f75 7269 6e67 0a20  der_contouring. 
-00029e70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00029e80: 6620 6d20 3d3d 2022 6d65 616e 5f6f 7665  f m == "mean_ove
-00029e90: 725f 636f 6e74 6f75 7269 6e67 5f66 6c61  r_contouring_fla
-00029ea0: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
-00029eb0: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
-00029ec0: 3d20 636f 6e66 6f72 6d69 7479 5f66 6c61  = conformity_fla
-00029ed0: 742e 6d65 616e 5f6f 7665 725f 636f 6e74  t.mean_over_cont
-00029ee0: 6f75 7269 6e67 0a20 2020 2020 2020 2020  ouring.         
-00029ef0: 2020 2020 2020 2069 6620 6d20 3d3d 2022         if m == "
-00029f00: 6d65 616e 5f64 6973 7461 6e63 655f 746f  mean_distance_to
-00029f10: 5f63 6f6e 666f 726d 6974 795f 666c 6174  _conformity_flat
-00029f20: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00029f30: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
-00029f40: 2063 6f6e 666f 726d 6974 795f 666c 6174   conformity_flat
-00029f50: 2e6d 6561 6e5f 6469 7374 616e 6365 5f74  .mean_distance_t
-00029f60: 6f5f 636f 6e66 6f72 6d69 7479 0a20 2020  o_conformity.   
-00029f70: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00029f80: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00029f90: 2054 6869 7320 636f 6465 2062 6c6f 636b   This code block
-00029fa0: 2063 616e 2062 6520 7265 6163 6865 6420   can be reached 
-00029fb0: 6966 2074 6869 7320 6d65 7468 6f64 2064  if this method d
-00029fc0: 6f65 736e 2774 2068 616e 646c 650a 2020  oesn't handle.  
-00029fd0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00029fe0: 6120 6d65 7472 6963 2074 6861 7427 7320  a metric that's 
-00029ff0: 6c69 7374 6564 2062 7920 6765 745f 636f  listed by get_co
-0002a000: 6d70 6172 6973 6f6e 5f6d 6574 7269 6373  mparison_metrics
-0002a010: 2829 2e0a 2020 2020 2020 2020 2020 2020  ()..            
-0002a020: 2020 2020 666f 756e 6420 3d20 4661 6c73      found = Fals
-0002a030: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-0002a040: 2020 2023 2041 7869 732d 7370 6563 6966     # Axis-specif
-0002a050: 6963 206d 6574 7269 6373 0a20 2020 2020  ic metrics.     
-0002a060: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-0002a070: 2c20 6178 2069 6e20 656e 756d 6572 6174  , ax in enumerat
-0002a080: 6528 736b 7274 2e69 6d61 6765 2e5f 6178  e(skrt.image._ax
-0002a090: 6573 293a 0a0a 2020 2020 2020 2020 2020  es):..          
-0002a0a0: 2020 2020 2020 2020 2020 2320 476c 6f62            # Glob
-0002a0b0: 616c 2063 656e 7472 6f69 6420 706f 7369  al centroid posi
-0002a0c0: 7469 6f6e 206f 6e20 6120 6769 7665 6e20  tion on a given 
-0002a0d0: 6178 6973 0a20 2020 2020 2020 2020 2020  axis.           
-0002a0e0: 2020 2020 2020 2020 2069 6620 6d20 3d3d           if m ==
-0002a0f0: 2066 2263 656e 7472 6f69 645f 7b61 787d   f"centroid_{ax}
-0002a100: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-0002a110: 2020 2020 2020 2020 2020 2063 6f6d 705b             comp[
-0002a120: 6d5d 203d 2072 6f69 302e 6765 745f 6162  m] = roi0.get_ab
-0002a130: 735f 6365 6e74 726f 6964 5f64 6973 7461  s_centroid_dista
-0002a140: 6e63 6528 0a20 2020 2020 2020 2020 2020  nce(.           
+00029b30: 2020 2020 6f72 2072 6f69 302e 6765 745f      or roi0.get_
+00029b40: 6d65 616e 5f64 6973 7461 6e63 655f 746f  mean_distance_to
+00029b50: 5f63 6f6e 666f 726d 6974 7928 0a20 2020  _conformity(.   
+00029b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029b70: 2020 2020 2020 2020 2072 6f69 2c20 766f           roi, vo
+00029b80: 6c5f 756e 6974 7329 290a 2020 2020 2020  l_units)).      
+00029b90: 2020 2020 2020 2020 2020 6966 206d 203d            if m =
+00029ba0: 3d20 226d 6561 6e5f 756e 6465 725f 636f  = "mean_under_co
+00029bb0: 6e74 6f75 7269 6e67 223a 0a20 2020 2020  ntouring":.     
+00029bc0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00029bd0: 6f6d 705b 6d5d 203d 2063 6f6e 666f 726d  omp[m] = conform
+00029be0: 6974 792e 6d65 616e 5f75 6e64 6572 5f63  ity.mean_under_c
+00029bf0: 6f6e 746f 7572 696e 670a 2020 2020 2020  ontouring.      
+00029c00: 2020 2020 2020 2020 2020 6966 206d 203d            if m =
+00029c10: 3d20 226d 6561 6e5f 6f76 6572 5f63 6f6e  = "mean_over_con
+00029c20: 746f 7572 696e 6722 3a0a 2020 2020 2020  touring":.      
+00029c30: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00029c40: 6d70 5b6d 5d20 3d20 636f 6e66 6f72 6d69  mp[m] = conformi
+00029c50: 7479 2e6d 6561 6e5f 6f76 6572 5f63 6f6e  ty.mean_over_con
+00029c60: 746f 7572 696e 670a 2020 2020 2020 2020  touring.        
+00029c70: 2020 2020 2020 2020 6966 206d 203d 3d20          if m == 
+00029c80: 226d 6561 6e5f 6469 7374 616e 6365 5f74  "mean_distance_t
+00029c90: 6f5f 636f 6e66 6f72 6d69 7479 223a 0a20  o_conformity":. 
+00029ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029cb0: 2020 2063 6f6d 705b 6d5d 203d 2063 6f6e     comp[m] = con
+00029cc0: 666f 726d 6974 792e 6d65 616e 5f64 6973  formity.mean_dis
+00029cd0: 7461 6e63 655f 746f 5f63 6f6e 666f 726d  tance_to_conform
+00029ce0: 6974 790a 2020 2020 2020 2020 2020 2020  ity.            
+00029cf0: 656c 6966 206d 2069 6e20 5b22 6d65 616e  elif m in ["mean
+00029d00: 5f75 6e64 6572 5f63 6f6e 746f 7572 696e  _under_contourin
+00029d10: 675f 666c 6174 222c 0a20 2020 2020 2020  g_flat",.       
+00029d20: 2020 2020 2020 2020 2020 2020 2022 6d65               "me
+00029d30: 616e 5f6f 7665 725f 636f 6e74 6f75 7269  an_over_contouri
+00029d40: 6e67 5f66 6c61 7422 2c0a 2020 2020 2020  ng_flat",.      
+00029d50: 2020 2020 2020 2020 2020 2020 2020 226d                "m
+00029d60: 6561 6e5f 6469 7374 616e 6365 5f74 6f5f  ean_distance_to_
+00029d70: 636f 6e66 6f72 6d69 7479 5f66 6c61 7422  conformity_flat"
+00029d80: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00029d90: 2020 2063 6f6e 666f 726d 6974 795f 666c     conformity_fl
+00029da0: 6174 203d 2028 636f 6e66 6f72 6d69 7479  at = (conformity
+00029db0: 5f66 6c61 740a 2020 2020 2020 2020 2020  _flat.          
+00029dc0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00029dd0: 2072 6f69 302e 6765 745f 6d65 616e 5f64   roi0.get_mean_d
+00029de0: 6973 7461 6e63 655f 746f 5f63 6f6e 666f  istance_to_confo
+00029df0: 726d 6974 7928 0a20 2020 2020 2020 2020  rmity(.         
+00029e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029e10: 2020 2072 6f69 2c20 766f 6c5f 756e 6974     roi, vol_unit
+00029e20: 732c 2076 6965 773d 7669 6577 2c20 666c  s, view=view, fl
+00029e30: 6174 7465 6e3d 5472 7565 2929 0a20 2020  atten=True)).   
+00029e40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00029e50: 6d20 3d3d 2022 6d65 616e 5f75 6e64 6572  m == "mean_under
+00029e60: 5f63 6f6e 746f 7572 696e 675f 666c 6174  _contouring_flat
+00029e70: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00029e80: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
+00029e90: 2063 6f6e 666f 726d 6974 795f 666c 6174   conformity_flat
+00029ea0: 2e6d 6561 6e5f 756e 6465 725f 636f 6e74  .mean_under_cont
+00029eb0: 6f75 7269 6e67 0a20 2020 2020 2020 2020  ouring.         
+00029ec0: 2020 2020 2020 2069 6620 6d20 3d3d 2022         if m == "
+00029ed0: 6d65 616e 5f6f 7665 725f 636f 6e74 6f75  mean_over_contou
+00029ee0: 7269 6e67 5f66 6c61 7422 3a0a 2020 2020  ring_flat":.    
+00029ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029f00: 636f 6d70 5b6d 5d20 3d20 636f 6e66 6f72  comp[m] = confor
+00029f10: 6d69 7479 5f66 6c61 742e 6d65 616e 5f6f  mity_flat.mean_o
+00029f20: 7665 725f 636f 6e74 6f75 7269 6e67 0a20  ver_contouring. 
+00029f30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00029f40: 6620 6d20 3d3d 2022 6d65 616e 5f64 6973  f m == "mean_dis
+00029f50: 7461 6e63 655f 746f 5f63 6f6e 666f 726d  tance_to_conform
+00029f60: 6974 795f 666c 6174 223a 0a20 2020 2020  ity_flat":.     
+00029f70: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00029f80: 6f6d 705b 6d5d 203d 2063 6f6e 666f 726d  omp[m] = conform
+00029f90: 6974 795f 666c 6174 2e6d 6561 6e5f 6469  ity_flat.mean_di
+00029fa0: 7374 616e 6365 5f74 6f5f 636f 6e66 6f72  stance_to_confor
+00029fb0: 6d69 7479 0a20 2020 2020 2020 2020 2020  mity.           
+00029fc0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00029fd0: 2020 2020 2020 2023 2054 6869 7320 636f         # This co
+00029fe0: 6465 2062 6c6f 636b 2063 616e 2062 6520  de block can be 
+00029ff0: 7265 6163 6865 6420 6966 2074 6869 7320  reached if this 
+0002a000: 6d65 7468 6f64 2064 6f65 736e 2774 2068  method doesn't h
+0002a010: 616e 646c 650a 2020 2020 2020 2020 2020  andle.          
+0002a020: 2020 2020 2020 2320 6120 6d65 7472 6963        # a metric
+0002a030: 2074 6861 7427 7320 6c69 7374 6564 2062   that's listed b
+0002a040: 7920 6765 745f 636f 6d70 6172 6973 6f6e  y get_comparison
+0002a050: 5f6d 6574 7269 6373 2829 2e0a 2020 2020  _metrics()..    
+0002a060: 2020 2020 2020 2020 2020 2020 666f 756e              foun
+0002a070: 6420 3d20 4661 6c73 650a 0a20 2020 2020  d = False..     
+0002a080: 2020 2020 2020 2020 2020 2023 2041 7869             # Axi
+0002a090: 732d 7370 6563 6966 6963 206d 6574 7269  s-specific metri
+0002a0a0: 6373 0a20 2020 2020 2020 2020 2020 2020  cs.             
+0002a0b0: 2020 2066 6f72 2069 2c20 6178 2069 6e20     for i, ax in 
+0002a0c0: 656e 756d 6572 6174 6528 736b 7274 2e69  enumerate(skrt.i
+0002a0d0: 6d61 6765 2e5f 6178 6573 293a 0a0a 2020  mage._axes):..  
+0002a0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a0f0: 2020 2320 476c 6f62 616c 2063 656e 7472    # Global centr
+0002a100: 6f69 6420 706f 7369 7469 6f6e 206f 6e20  oid position on 
+0002a110: 6120 6769 7665 6e20 6178 6973 0a20 2020  a given axis.   
+0002a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a130: 2069 6620 6d20 3d3d 2066 2263 656e 7472   if m == f"centr
+0002a140: 6f69 645f 7b61 787d 223a 0a20 2020 2020  oid_{ax}":.     
 0002a150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a160: 2072 6f69 2c0a 2020 2020 2020 2020 2020   roi,.          
-0002a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a180: 2020 756e 6974 733d 6365 6e74 726f 6964    units=centroid
-0002a190: 5f75 6e69 7473 2c0a 2020 2020 2020 2020  _units,.        
-0002a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a1b0: 2020 2020 6d65 7468 6f64 3d6d 6574 686f      method=metho
-0002a1c0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-0002a1d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0002a1e0: 6f72 6365 3d66 6f72 6365 0a20 2020 2020  orce=force.     
-0002a1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a200: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0002a210: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
-0002a220: 6e64 203d 2054 7275 650a 0a20 2020 2020  nd = True..     
-0002a230: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0002a240: 7420 666f 756e 643a 0a20 2020 2020 2020  t found:.       
-0002a250: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0002a260: 7365 2052 756e 7469 6d65 4572 726f 7228  se RuntimeError(
-0002a270: 6622 4d65 7472 6963 207b 6d7d 206e 6f74  f"Metric {m} not
-0002a280: 2072 6563 6f67 6e69 7365 6420 6279 2022   recognised by "
+0002a160: 2020 2063 6f6d 705b 6d5d 203d 2072 6f69     comp[m] = roi
+0002a170: 302e 6765 745f 6162 735f 6365 6e74 726f  0.get_abs_centro
+0002a180: 6964 5f64 6973 7461 6e63 6528 0a20 2020  id_distance(.   
+0002a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a1a0: 2020 2020 2020 2020 2072 6f69 2c0a 2020           roi,.  
+0002a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a1c0: 2020 2020 2020 2020 2020 756e 6974 733d            units=
+0002a1d0: 6365 6e74 726f 6964 5f75 6e69 7473 2c0a  centroid_units,.
+0002a1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a1f0: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+0002a200: 6f64 3d6d 6574 686f 642c 0a20 2020 2020  od=method,.     
+0002a210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a220: 2020 2020 2020 2066 6f72 6365 3d66 6f72         force=for
+0002a230: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
+0002a240: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0002a250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a260: 2020 2020 2066 6f75 6e64 203d 2054 7275       found = Tru
+0002a270: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
+0002a280: 2020 2069 6620 6e6f 7420 666f 756e 643a     if not found:
 0002a290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a2b0: 2020 2020 2020 2020 2252 4f49 2e67 6574          "ROI.get
-0002a2c0: 5f63 6f6d 7061 7269 736f 6e28 2922 290a  _comparison()").
-0002a2d0: 0a20 2020 2020 2020 2023 2041 6464 2075  .        # Add u
-0002a2e0: 6e69 7473 2074 6f20 6d65 7472 6963 206e  nits to metric n
-0002a2f0: 616d 6573 2069 6620 7265 7175 6573 7465  ames if requeste
-0002a300: 640a 2020 2020 2020 2020 636f 6d70 5f6e  d.        comp_n
-0002a310: 616d 6564 203d 207b 7d0a 2020 2020 2020  amed = {}.      
-0002a320: 2020 6966 206e 6f74 2075 6e69 7473 5f69    if not units_i
-0002a330: 6e5f 6865 6164 6572 3a0a 2020 2020 2020  n_header:.      
-0002a340: 2020 2020 2020 636f 6d70 5f6e 616d 6564        comp_named
-0002a350: 203d 2063 6f6d 700a 2020 2020 2020 2020   = comp.        
-0002a360: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0002a370: 2020 666f 7220 6d65 7472 6963 2c20 7661    for metric, va
-0002a380: 6c20 696e 2063 6f6d 702e 6974 656d 7328  l in comp.items(
-0002a390: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0002a3a0: 2020 206e 616d 6520 3d20 6d65 7472 6963     name = metric
-0002a3b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a3c0: 2069 6620 6d65 7472 6963 203d 3d20 2276   if metric == "v
-0002a3d0: 6f6c 756d 655f 6469 6666 223a 0a20 2020  olume_diff":.   
-0002a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a3f0: 2069 6620 766f 6c5f 756e 6974 7320 3d3d   if vol_units ==
-0002a400: 2022 6d6d 223a 0a20 2020 2020 2020 2020   "mm":.         
-0002a410: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0002a420: 616d 6520 2b3d 2022 2028 6d6d 5e33 2922  ame += " (mm^3)"
-0002a430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a440: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002a2a0: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
+0002a2b0: 6d65 4572 726f 7228 6622 4d65 7472 6963  meError(f"Metric
+0002a2c0: 207b 6d7d 206e 6f74 2072 6563 6f67 6e69   {m} not recogni
+0002a2d0: 7365 6420 6279 2022 0a20 2020 2020 2020  sed by ".       
+0002a2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a300: 2252 4f49 2e67 6574 5f63 6f6d 7061 7269  "ROI.get_compari
+0002a310: 736f 6e28 2922 290a 0a20 2020 2020 2020  son()")..       
+0002a320: 2023 2041 6464 2075 6e69 7473 2074 6f20   # Add units to 
+0002a330: 6d65 7472 6963 206e 616d 6573 2069 6620  metric names if 
+0002a340: 7265 7175 6573 7465 640a 2020 2020 2020  requested.      
+0002a350: 2020 636f 6d70 5f6e 616d 6564 203d 207b    comp_named = {
+0002a360: 7d0a 2020 2020 2020 2020 6966 206e 6f74  }.        if not
+0002a370: 2075 6e69 7473 5f69 6e5f 6865 6164 6572   units_in_header
+0002a380: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+0002a390: 6d70 5f6e 616d 6564 203d 2063 6f6d 700a  mp_named = comp.
+0002a3a0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002a3b0: 2020 2020 2020 2020 2020 666f 7220 6d65            for me
+0002a3c0: 7472 6963 2c20 7661 6c20 696e 2063 6f6d  tric, val in com
+0002a3d0: 702e 6974 656d 7328 293a 0a20 2020 2020  p.items():.     
+0002a3e0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+0002a3f0: 3d20 6d65 7472 6963 0a20 2020 2020 2020  = metric.       
+0002a400: 2020 2020 2020 2020 2069 6620 6d65 7472           if metr
+0002a410: 6963 203d 3d20 2276 6f6c 756d 655f 6469  ic == "volume_di
+0002a420: 6666 223a 0a20 2020 2020 2020 2020 2020  ff":.           
+0002a430: 2020 2020 2020 2020 2069 6620 766f 6c5f           if vol_
+0002a440: 756e 6974 7320 3d3d 2022 6d6d 223a 0a20  units == "mm":. 
 0002a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a460: 2020 206e 616d 6520 2b3d 2022 2028 2220     name += " (" 
-0002a470: 2b20 766f 6c5f 756e 6974 7320 2b20 2229  + vol_units + ")
-0002a480: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0002a490: 2020 656c 6966 206d 6574 7269 6320 3d3d    elif metric ==
-0002a4a0: 2022 6172 6561 5f64 6966 6622 3a0a 2020   "area_diff":.  
-0002a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a4c0: 2020 6966 2061 7265 615f 756e 6974 7320    if area_units 
-0002a4d0: 3d3d 2022 6d6d 223a 0a20 2020 2020 2020  == "mm":.       
-0002a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a4f0: 206e 616d 6520 2b3d 2022 2028 6d6d 5e32   name += " (mm^2
-0002a500: 2922 0a20 2020 2020 2020 2020 2020 2020  )".             
-0002a510: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0002a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a530: 2020 2020 206e 616d 6520 2b3d 2022 2028       name += " (
-0002a540: 2220 2b20 6172 6561 5f75 6e69 7473 202b  " + area_units +
-0002a550: 2022 2922 0a20 2020 2020 2020 2020 2020   ")".           
-0002a560: 2020 2020 2065 6c69 6620 2263 656e 7472       elif "centr
-0002a570: 6f69 6422 2069 6e20 6d65 7472 6963 3a0a  oid" in metric:.
-0002a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a590: 2020 2020 6e61 6d65 202b 3d20 2220 2822      name += " ("
-0002a5a0: 202b 2063 656e 7472 6f69 645f 756e 6974   + centroid_unit
-0002a5b0: 7320 2b20 2229 220a 2020 2020 2020 2020  s + ")".        
-0002a5c0: 2020 2020 2020 2020 636f 6d70 5f6e 616d          comp_nam
-0002a5d0: 6564 5b6e 616d 655d 203d 2076 616c 0a0a  ed[name] = val..
-0002a5e0: 2020 2020 2020 2020 2320 4164 6a75 7374          # Adjust
-0002a5f0: 206e 756d 6265 7220 6f66 2064 6563 696d   number of decim
-0002a600: 616c 2070 6c61 6365 730a 2020 2020 2020  al places.      
-0002a610: 2020 6966 2064 6563 696d 616c 5f70 6c61    if decimal_pla
-0002a620: 6365 7320 6973 206e 6f74 204e 6f6e 653a  ces is not None:
-0002a630: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0002a640: 206d 6574 7269 632c 2076 616c 2069 6e20   metric, val in 
-0002a650: 636f 6d70 5f6e 616d 6564 2e69 7465 6d73  comp_named.items
-0002a660: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0002a670: 2020 2020 666d 7420 3d20 6622 7b7b 7661      fmt = f"{{va
-0002a680: 6c3a 2e7b 6465 6369 6d61 6c5f 706c 6163  l:.{decimal_plac
-0002a690: 6573 7d66 7d7d 220a 2020 2020 2020 2020  es}f}}".        
-0002a6a0: 2020 2020 2020 2020 6966 2063 6f6d 705f          if comp_
-0002a6b0: 6e61 6d65 645b 6d65 7472 6963 5d20 6973  named[metric] is
-0002a6c0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0002a6d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0002a6e0: 6f6d 705f 6e61 6d65 645b 6d65 7472 6963  omp_named[metric
-0002a6f0: 5d20 3d20 666c 6f61 7428 666d 742e 666f  ] = float(fmt.fo
-0002a700: 726d 6174 2876 616c 3d76 616c 2929 0a0a  rmat(val=val))..
-0002a710: 2020 2020 2020 2020 2320 436f 6e76 6572          # Conver
-0002a720: 7420 746f 2070 616e 6461 7320 4461 7461  t to pandas Data
-0002a730: 4672 616d 650a 2020 2020 2020 2020 6466  Frame.        df
-0002a740: 203d 2070 642e 4461 7461 4672 616d 6528   = pd.DataFrame(
-0002a750: 636f 6d70 5f6e 616d 6564 2c20 696e 6465  comp_named, inde
-0002a760: 783d 5b72 6f69 302e 6e61 6d65 5d29 0a0a  x=[roi0.name])..
-0002a770: 2020 2020 2020 2020 2320 4361 7069 7461          # Capita
-0002a780: 6c69 7a65 2063 6f6c 756d 6e20 6e61 6d65  lize column name
-0002a790: 7320 616e 6420 7265 6d6f 7665 2075 6e64  s and remove und
-0002a7a0: 6572 7363 6f72 6573 2069 6620 7265 7175  erscores if requ
-0002a7b0: 6573 7465 640a 2020 2020 2020 2020 6966  ested.        if
-0002a7c0: 206e 6963 655f 636f 6c75 6d6e 7320 616e   nice_columns an
-0002a7d0: 6420 6e6f 7420 676c 6f62 616c 5f76 735f  d not global_vs_
-0002a7e0: 736c 6963 655f 6865 6164 6572 3a0a 2020  slice_header:.  
-0002a7f0: 2020 2020 2020 2020 2020 6466 2e63 6f6c            df.col
-0002a800: 756d 6e73 203d 205b 636f 6c2e 6361 7069  umns = [col.capi
-0002a810: 7461 6c69 7a65 2829 2e72 6570 6c61 6365  talize().replace
-0002a820: 2822 5f22 2c20 2220 2229 2e72 6570 6c61  ("_", " ").repla
-0002a830: 6365 2822 726d 7322 2c20 2252 4d53 2229  ce("rms", "RMS")
-0002a840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a850: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
-0002a860: 6f6c 2069 6e20 6466 2e63 6f6c 756d 6e73  ol in df.columns
-0002a870: 5d0a 0a20 2020 2020 2020 2023 2054 7572  ]..        # Tur
-0002a880: 6e20 6e61 6d65 2069 6e74 6f20 6120 7265  n name into a re
-0002a890: 6775 6c61 7220 636f 6c75 6d6e 2069 6620  gular column if 
-0002a8a0: 7265 7175 6573 7465 640a 2020 2020 2020  requested.      
-0002a8b0: 2020 6966 206e 6f74 206e 616d 655f 6173    if not name_as
-0002a8c0: 5f69 6e64 6578 3a0a 2020 2020 2020 2020  _index:.        
-0002a8d0: 2020 2020 6466 203d 2064 662e 7265 7365      df = df.rese
-0002a8e0: 745f 696e 6465 7828 292e 7265 6e61 6d65  t_index().rename
-0002a8f0: 287b 2269 6e64 6578 223a 2022 524f 4922  ({"index": "ROI"
-0002a900: 7d2c 2061 7869 733d 3129 0a0a 2020 2020  }, axis=1)..    
-0002a910: 2020 2020 2320 4164 6420 676c 6f62 616c      # Add global
-0002a920: 2f73 6c69 6365 2068 6561 6465 7273 0a20  /slice headers. 
-0002a930: 2020 2020 2020 2069 6620 676c 6f62 616c         if global
-0002a940: 5f76 735f 736c 6963 655f 6865 6164 6572  _vs_slice_header
-0002a950: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
-0002a960: 2053 6f72 7420 636f 6c75 6d6e 7320 696e   Sort columns in
-0002a970: 746f 2067 6c6f 6261 6c20 6f72 2073 6c69  to global or sli
-0002a980: 6365 0a20 2020 2020 2020 2020 2020 2068  ce.            h
-0002a990: 6561 6465 7273 203d 205b 5d0a 2020 2020  eaders = [].    
-0002a9a0: 2020 2020 2020 2020 736c 6963 655f 636f          slice_co
-0002a9b0: 6c73 203d 205b 5d0a 2020 2020 2020 2020  ls = [].        
-0002a9c0: 2020 2020 676c 6f62 616c 5f63 6f6c 7320      global_cols 
-0002a9d0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-0002a9e0: 2073 6c69 6365 5f6e 616d 6520 3d20 2273   slice_name = "s
-0002a9f0: 6c69 6365 2220 6966 206e 6f74 206e 6963  lice" if not nic
-0002aa00: 655f 636f 6c75 6d6e 7320 656c 7365 2022  e_columns else "
-0002aa10: 536c 6963 6522 0a20 2020 2020 2020 2020  Slice".         
-0002aa20: 2020 2067 6c6f 6261 6c5f 6e61 6d65 203d     global_name =
-0002aa30: 2022 676c 6f62 616c 2220 6966 206e 6f74   "global" if not
-0002aa40: 206e 6963 655f 636f 6c75 6d6e 7320 656c   nice_columns el
-0002aa50: 7365 2022 476c 6f62 616c 220a 2020 2020  se "Global".    
-0002aa60: 2020 2020 2020 2020 666f 7220 6d65 7472          for metr
-0002aa70: 6963 2069 6e20 636f 6d70 5f6e 616d 6564  ic in comp_named
-0002aa80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002aa90: 2020 6966 2022 736c 6963 6522 2069 6e20    if "slice" in 
-0002aaa0: 6d65 7472 6963 206f 7220 5c0a 2020 2020  metric or \.    
-0002aab0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0002aac0: 2261 7265 6122 2069 6e20 6d65 7472 6963  "area" in metric
-0002aad0: 2061 6e64 2022 666c 6174 2220 6e6f 7420   and "flat" not 
-0002aae0: 696e 206d 6574 7269 6329 3a0a 2020 2020  in metric):.    
-0002aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ab00: 6865 6164 6572 732e 6170 7065 6e64 2828  headers.append((
-0002ab10: 736c 6963 655f 6e61 6d65 2c20 6d65 7472  slice_name, metr
-0002ab20: 6963 2929 0a20 2020 2020 2020 2020 2020  ic)).           
-0002ab30: 2020 2020 2020 2020 2073 6c69 6365 5f63           slice_c
-0002ab40: 6f6c 732e 6170 7065 6e64 286d 6574 7269  ols.append(metri
-0002ab50: 6329 0a20 2020 2020 2020 2020 2020 2020  c).             
-0002ab60: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0002ab70: 2020 2020 2020 2020 2020 2020 2068 6561               hea
-0002ab80: 6465 7273 2e61 7070 656e 6428 2867 6c6f  ders.append((glo
-0002ab90: 6261 6c5f 6e61 6d65 2c20 6d65 7472 6963  bal_name, metric
-0002aba0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-0002abb0: 2020 2020 2020 2067 6c6f 6261 6c5f 636f         global_co
-0002abc0: 6c73 2e61 7070 656e 6428 6d65 7472 6963  ls.append(metric
-0002abd0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0002abe0: 2052 656f 7264 6572 2063 6f6c 756d 6e73   Reorder columns
-0002abf0: 0a20 2020 2020 2020 2020 2020 2064 6673  .            dfs
-0002ac00: 5f6f 7264 6572 6564 203d 205b 6466 5b67  _ordered = [df[g
-0002ac10: 6c6f 6261 6c5f 636f 6c73 5d2c 2064 665b  lobal_cols], df[
-0002ac20: 736c 6963 655f 636f 6c73 5d5d 0a20 2020  slice_cols]].   
-0002ac30: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0002ac40: 6e61 6d65 5f61 735f 696e 6465 783a 0a20  name_as_index:. 
-0002ac50: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0002ac60: 6673 5f6f 7264 6572 6564 2e69 6e73 6572  fs_ordered.inser
-0002ac70: 7428 302c 2064 665b 2252 4f49 225d 290a  t(0, df["ROI"]).
-0002ac80: 2020 2020 2020 2020 2020 2020 6466 203d              df =
-0002ac90: 2070 642e 636f 6e63 6174 2864 6673 5f6f   pd.concat(dfs_o
-0002aca0: 7264 6572 6564 2c20 6178 6973 3d31 290a  rdered, axis=1).
-0002acb0: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
-0002acc0: 6f72 7420 6865 6164 6572 7320 6279 2067  ort headers by g
-0002acd0: 6c6f 6261 6c2f 736c 6963 650a 2020 2020  lobal/slice.    
-0002ace0: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
-0002acf0: 3d20 5b68 2066 6f72 2068 2069 6e20 6865  = [h for h in he
-0002ad00: 6164 6572 7320 6966 2068 5b30 5d20 3d3d  aders if h[0] ==
-0002ad10: 2067 6c6f 6261 6c5f 6e61 6d65 5d20 5c0a   global_name] \.
-0002ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ad30: 2020 2020 2b20 5b68 2066 6f72 2068 2069      + [h for h i
-0002ad40: 6e20 6865 6164 6572 7320 6966 2068 5b30  n headers if h[0
-0002ad50: 5d20 3d3d 2073 6c69 6365 5f6e 616d 655d  ] == slice_name]
-0002ad60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002ad70: 6e6f 7420 6e61 6d65 5f61 735f 696e 6465  not name_as_inde
-0002ad80: 783a 0a20 2020 2020 2020 2020 2020 2020  x:.             
-0002ad90: 2020 2068 6561 6465 7273 2e69 6e73 6572     headers.inser
-0002ada0: 7428 302c 2028 2222 2c20 2252 4f49 2229  t(0, ("", "ROI")
-0002adb0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0002adc0: 2041 6464 204d 756c 7469 496e 6465 780a   Add MultiIndex.
-0002add0: 2020 2020 2020 2020 2020 2020 6466 2e63              df.c
-0002ade0: 6f6c 756d 6e73 203d 2070 642e 4d75 6c74  olumns = pd.Mult
-0002adf0: 6949 6e64 6578 2e66 726f 6d5f 7475 706c  iIndex.from_tupl
-0002ae00: 6573 2868 6561 6465 7273 290a 0a20 2020  es(headers)..   
-0002ae10: 2020 2020 2072 6574 7572 6e20 6466 0a0a       return df..
-0002ae20: 2020 2020 6465 6620 6765 745f 636f 6d70      def get_comp
-0002ae30: 6172 6973 6f6e 5f6e 616d 6528 7365 6c66  arison_name(self
-0002ae40: 2c20 726f 692c 2063 616d 656c 6361 7365  , roi, camelcase
-0002ae50: 3d46 616c 7365 2c20 636f 6c6f 7265 643d  =False, colored=
-0002ae60: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-0002ae70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ae80: 2020 2067 7265 793d 4661 6c73 652c 2072     grey=False, r
-0002ae90: 6f69 5f6b 7761 7267 733d 7b7d 293a 0a20  oi_kwargs={}):. 
-0002aea0: 2020 2020 2020 2022 2222 4765 7420 6e61         """Get na
-0002aeb0: 6d65 206f 6620 636f 6d70 6172 6973 6f6e  me of comparison
-0002aec0: 2062 6574 7765 656e 2074 6869 7320 524f   between this RO
-0002aed0: 4920 616e 6420 616e 6f74 6865 722e 2222  I and another.""
-0002aee0: 220a 0a20 2020 2020 2020 206f 776e 5f6e  "..        own_n
-0002aef0: 616d 6520 3d20 7365 6c66 2e6e 616d 650a  ame = self.name.
-0002af00: 2020 2020 2020 2020 6f74 6865 725f 6e61          other_na
-0002af10: 6d65 203d 2072 6f69 2e6e 616d 650a 0a20  me = roi.name.. 
-0002af20: 2020 2020 2020 2069 6620 636f 6c6f 7265         if colore
-0002af30: 643a 0a20 2020 2020 2020 2020 2020 206f  d:.            o
-0002af40: 776e 5f63 6f6c 6f72 203d 2073 656c 662e  wn_color = self.
-0002af50: 6765 745f 636f 6c6f 725f 6672 6f6d 5f6b  get_color_from_k
-0002af60: 7761 7267 7328 726f 695f 6b77 6172 6773  wargs(roi_kwargs
-0002af70: 290a 2020 2020 2020 2020 2020 2020 6f77  ).            ow
-0002af80: 6e5f 6e61 6d65 203d 2067 6574 5f63 6f6c  n_name = get_col
-0002af90: 6f72 6564 5f72 6f69 5f73 7472 696e 6728  ored_roi_string(
-0002afa0: 7365 6c66 2c20 6772 6579 2c20 6f77 6e5f  self, grey, own_
-0002afb0: 636f 6c6f 7229 0a20 2020 2020 2020 2020  color).         
-0002afc0: 2020 206f 7468 6572 5f63 6f6c 6f72 203d     other_color =
-0002afd0: 2072 6f69 2e67 6574 5f63 6f6c 6f72 5f66   roi.get_color_f
-0002afe0: 726f 6d5f 6b77 6172 6773 2872 6f69 5f6b  rom_kwargs(roi_k
-0002aff0: 7761 7267 7329 0a20 2020 2020 2020 2020  wargs).         
-0002b000: 2020 206f 7468 6572 5f6e 616d 6520 3d20     other_name = 
-0002b010: 6765 745f 636f 6c6f 7265 645f 726f 695f  get_colored_roi_
-0002b020: 7374 7269 6e67 2872 6f69 2c20 6772 6579  string(roi, grey
-0002b030: 2c20 6f74 6865 725f 636f 6c6f 7229 0a0a  , other_color)..
-0002b040: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0002b050: 6e61 6d65 203d 3d20 726f 692e 6e61 6d65  name == roi.name
-0002b060: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0002b070: 2063 616d 656c 6361 7365 3a0a 2020 2020   camelcase:.    
-0002b080: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0002b090: 726e 206f 776e 5f6e 616d 652e 7265 706c  rn own_name.repl
-0002b0a0: 6163 6528 2220 222c 2022 5f22 290a 2020  ace(" ", "_").  
-0002b0b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002b0c0: 206f 776e 5f6e 616d 650a 2020 2020 2020   own_name.      
-0002b0d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0002b0e0: 2020 2020 6966 206e 6f74 2063 6f6c 6f72      if not color
-0002b0f0: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
-0002b100: 2020 2020 6966 2063 616d 656c 6361 7365      if camelcase
-0002b110: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002b120: 2020 2020 2020 7265 7475 726e 2066 227b        return f"{
-0002b130: 6f77 6e5f 6e61 6d65 7d5f 7673 5f7b 6f74  own_name}_vs_{ot
-0002b140: 6865 725f 6e61 6d65 7d22 2e72 6570 6c61  her_name}".repla
-0002b150: 6365 2822 2022 2c20 225f 2229 0a20 2020  ce(" ", "_").   
-0002b160: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0002b170: 7572 6e20 6622 7b6f 776e 5f6e 616d 657d  urn f"{own_name}
-0002b180: 2076 732e 207b 6f74 6865 725f 6e61 6d65   vs. {other_name
-0002b190: 7d22 0a20 2020 2020 2020 2020 2020 2072  }".            r
-0002b1a0: 6574 7572 6e20 6622 7b6f 776e 5f6e 616d  eturn f"{own_nam
-0002b1b0: 657d 7b6f 7468 6572 5f6e 616d 657d 220a  e}{other_name}".
-0002b1c0: 0a20 2020 2064 6566 2073 6574 5f61 6c70  .    def set_alp
-0002b1d0: 6861 5f6f 7665 725f 6265 7461 2873 656c  ha_over_beta(sel
-0002b1e0: 662c 2061 6c70 6861 5f6f 7665 725f 6265  f, alpha_over_be
-0002b1f0: 7461 3d4e 6f6e 6529 3a0a 2020 2020 2020  ta=None):.      
-0002b200: 2020 2222 220a 2020 2020 2020 2020 5365    """.        Se
-0002b210: 7420 7261 7469 6f20 666f 7220 524f 4920  t ratio for ROI 
-0002b220: 7469 7373 7565 206f 6620 636f 6566 6669  tissue of coeffi
-0002b230: 6369 656e 7473 206f 6620 6c69 6e65 6172  cients of linear
-0002b240: 2d71 7561 6472 6174 6963 2065 7175 6174  -quadratic equat
-0002b250: 696f 6e2e 0a0a 2020 2020 2020 2020 2a2a  ion...        **
-0002b260: 5061 7261 6d65 7465 723a 2a2a 0a0a 2020  Parameter:**..  
-0002b270: 2020 2020 2020 616c 7068 615f 6f76 6572        alpha_over
-0002b280: 5f62 6574 6120 3a20 666c 6f61 742c 2064  _beta : float, d
-0002b290: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-0002b2a0: 2020 2020 2020 2020 5261 7469 6f20 666f          Ratio fo
-0002b2b0: 7220 524f 4920 7469 7373 7565 206f 6620  r ROI tissue of 
-0002b2c0: 636f 6566 6669 6369 656e 7473 2c20 616c  coefficients, al
-0002b2d0: 7068 612c 2062 6574 612c 0a20 2020 2020  pha, beta,.     
-0002b2e0: 2020 2020 2020 206f 6620 6c69 6e65 6172         of linear
-0002b2f0: 2d71 7561 6472 6174 6963 2065 7175 6174  -quadratic equat
-0002b300: 696f 6e2e 2020 5468 6973 2072 6174 696f  ion.  This ratio
-0002b310: 2069 7320 7573 6564 2069 6e0a 2020 2020   is used in.    
-0002b320: 2020 2020 2020 2020 6361 6c63 756c 6174          calculat
-0002b330: 696e 6720 6269 6f6c 6f67 6963 616c 6c79  ing biologically
-0002b340: 2065 6666 6563 7469 7665 2064 6f73 652c   effective dose,
-0002b350: 2042 4544 2c20 6672 6f6d 0a20 2020 2020   BED, from.     
-0002b360: 2020 2020 2020 2070 6879 7369 6361 6c20         physical 
-0002b370: 646f 7365 2c20 442c 2064 656c 6976 6572  dose, D, deliver
-0002b380: 6564 206f 7665 7220 6e20 6571 7561 6c20  ed over n equal 
-0002b390: 6672 6163 7469 6f6e 733a 0a20 2020 2020  fractions:.     
-0002b3a0: 2020 2020 2020 2020 2020 2042 4544 203d             BED =
-0002b3b0: 2044 202a 2028 3120 2b20 2844 2f6e 2920   D * (1 + (D/n) 
-0002b3c0: 2f20 2861 6c70 6861 2f62 6574 6129 292e  / (alpha/beta)).
-0002b3d0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-0002b3e0: 4e6f 6e65 2c20 7468 6520 6269 6f6c 6f67  None, the biolog
-0002b3f0: 6963 616c 6c79 2065 6666 6563 7469 7665  ically effective
-0002b400: 2064 6f73 6520 6973 2074 616b 656e 2074   dose is taken t
-0002b410: 6f20 6265 0a20 2020 2020 2020 2020 2020  o be.           
-0002b420: 2065 7175 616c 2074 6f20 7468 6520 7068   equal to the ph
-0002b430: 7973 6963 616c 2064 6f73 6520 2862 6574  ysical dose (bet
-0002b440: 6120 3e3e 2061 6c70 6861 292e 0a20 2020  a >> alpha)..   
-0002b450: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0002b460: 2073 656c 662e 616c 7068 615f 6f76 6572   self.alpha_over
-0002b470: 5f62 6574 6120 3d20 616c 7068 615f 6f76  _beta = alpha_ov
-0002b480: 6572 5f62 6574 610a 0a20 2020 2064 6566  er_beta..    def
-0002b490: 2067 6574 5f61 6c70 6861 5f6f 7665 725f   get_alpha_over_
-0002b4a0: 6265 7461 2873 656c 6629 3a0a 2020 2020  beta(self):.    
-0002b4b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0002b4c0: 4765 7420 7261 7469 6f20 666f 7220 524f  Get ratio for RO
-0002b4d0: 4920 7469 7373 7565 206f 6620 636f 6566  I tissue of coef
-0002b4e0: 6669 6369 656e 7473 206f 6620 6c69 6e65  ficients of line
-0002b4f0: 6172 2d71 7561 6472 6174 6963 2065 7175  ar-quadratic equ
-0002b500: 6174 696f 6e2e 0a20 2020 2020 2020 2022  ation..        "
-0002b510: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-0002b520: 6e20 7365 6c66 2e61 6c70 6861 5f6f 7665  n self.alpha_ove
-0002b530: 725f 6265 7461 0a0a 2020 2020 6465 6620  r_beta..    def 
-0002b540: 7365 745f 636f 6c6f 7228 7365 6c66 2c20  set_color(self, 
-0002b550: 636f 6c6f 7229 3a0a 2020 2020 2020 2020  color):.        
-0002b560: 2222 2253 6574 2070 6c6f 7474 696e 6720  """Set plotting 
-0002b570: 636f 6c6f 722e 2222 220a 0a20 2020 2020  color."""..     
-0002b580: 2020 2069 6620 636f 6c6f 7220 6973 206e     if color is n
-0002b590: 6f74 204e 6f6e 6520 616e 6420 6e6f 7420  ot None and not 
-0002b5a0: 6d61 7470 6c6f 746c 6962 2e63 6f6c 6f72  matplotlib.color
-0002b5b0: 732e 6973 5f63 6f6c 6f72 5f6c 696b 6528  s.is_color_like(
-0002b5c0: 636f 6c6f 7229 3a0a 2020 2020 2020 2020  color):.        
-0002b5d0: 2020 2020 7072 696e 7428 6622 5761 726e      print(f"Warn
-0002b5e0: 696e 673a 207b 636f 6c6f 727d 206e 6f74  ing: {color} not
-0002b5f0: 2061 2076 616c 6964 2063 6f6c 6f72 2122   a valid color!"
-0002b600: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-0002b610: 6c6f 7220 3d20 4e6f 6e65 0a20 2020 2020  lor = None.     
-0002b620: 2020 2069 6620 636f 6c6f 7220 6973 204e     if color is N
-0002b630: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0002b640: 2063 6f6c 6f72 203d 2052 4f49 4465 6661   color = ROIDefa
-0002b650: 756c 7473 2829 2e67 6574 5f64 6566 6175  ults().get_defau
-0002b660: 6c74 5f72 6f69 5f63 6f6c 6f72 2829 0a20  lt_roi_color(). 
-0002b670: 2020 2020 2020 2073 656c 662e 636f 6c6f         self.colo
-0002b680: 7220 3d20 6d61 7470 6c6f 746c 6962 2e63  r = matplotlib.c
-0002b690: 6f6c 6f72 732e 746f 5f72 6762 6128 636f  olors.to_rgba(co
-0002b6a0: 6c6f 7229 0a0a 2020 2020 6465 6620 706c  lor)..    def pl
-0002b6b0: 6f74 280a 2020 2020 2020 2020 7365 6c66  ot(.        self
-0002b6c0: 2c0a 2020 2020 2020 2020 7669 6577 3d22  ,.        view="
-0002b6d0: 782d 7922 2c0a 2020 2020 2020 2020 706c  x-y",.        pl
-0002b6e0: 6f74 5f74 7970 653d 2263 6f6e 746f 7572  ot_type="contour
-0002b6f0: 222c 0a20 2020 2020 2020 2073 6c3d 4e6f  ",.        sl=No
-0002b700: 6e65 2c0a 2020 2020 2020 2020 6964 783d  ne,.        idx=
-0002b710: 4e6f 6e65 2c0a 2020 2020 2020 2020 706f  None,.        po
-0002b720: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
-0002b730: 6178 3d4e 6f6e 652c 0a20 2020 2020 2020  ax=None,.       
-0002b740: 2067 733d 4e6f 6e65 2c0a 2020 2020 2020   gs=None,.      
-0002b750: 2020 6669 6773 697a 653d 736b 7274 2e69    figsize=skrt.i
-0002b760: 6d61 6765 2e5f 6465 6661 756c 745f 6669  mage._default_fi
-0002b770: 6773 697a 652c 0a20 2020 2020 2020 206f  gsize,.        o
-0002b780: 7061 6369 7479 3d4e 6f6e 652c 0a20 2020  pacity=None,.   
-0002b790: 2020 2020 206c 696e 6577 6964 7468 3d4e       linewidth=N
-0002b7a0: 6f6e 652c 0a20 2020 2020 2020 2063 6f6e  one,.        con
-0002b7b0: 746f 7572 5f6b 7761 7267 733d 4e6f 6e65  tour_kwargs=None
-0002b7c0: 2c0a 2020 2020 2020 2020 6d61 736b 5f6b  ,.        mask_k
-0002b7d0: 7761 7267 733d 4e6f 6e65 2c0a 2020 2020  wargs=None,.    
-0002b7e0: 2020 2020 7a6f 6f6d 3d4e 6f6e 652c 0a20      zoom=None,. 
-0002b7f0: 2020 2020 2020 207a 6f6f 6d5f 6365 6e74         zoom_cent
-0002b800: 7265 3d4e 6f6e 652c 0a20 2020 2020 2020  re=None,.       
-0002b810: 2063 6f6c 6f72 3d4e 6f6e 652c 0a20 2020   color=None,.   
-0002b820: 2020 2020 2073 686f 773d 5472 7565 2c0a       show=True,.
-0002b830: 2020 2020 2020 2020 7361 7665 5f61 733d          save_as=
-0002b840: 4e6f 6e65 2c0a 2020 2020 2020 2020 696e  None,.        in
-0002b850: 636c 7564 655f 696d 6167 653d 4661 6c73  clude_image=Fals
-0002b860: 652c 0a20 2020 2020 2020 206e 6f5f 696e  e,.        no_in
-0002b870: 7665 7274 3d46 616c 7365 2c0a 2020 2020  vert=False,.    
-0002b880: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
-0002b890: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-0002b8a0: 506c 6f74 2074 6869 7320 524f 4920 6173  Plot this ROI as
-0002b8b0: 2065 6974 6865 7220 6120 6d61 736b 206f   either a mask o
-0002b8c0: 7220 6120 636f 6e74 6f75 722e 0a0a 2020  r a contour...  
-0002b8d0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
-0002b8e0: 7273 3a2a 2a0a 0a20 2020 2020 2020 2076  rs:**..        v
-0002b8f0: 6965 7720 3a20 7374 722c 2064 6566 6175  iew : str, defau
-0002b900: 6c74 3d22 782d 7922 0a20 2020 2020 2020  lt="x-y".       
-0002b910: 2020 2020 204f 7269 656e 7461 7469 6f6e       Orientation
-0002b920: 2069 6e20 7768 6963 6820 746f 2070 6c6f   in which to plo
-0002b930: 742e 2043 616e 2062 6520 2278 2d79 222c  t. Can be "x-y",
-0002b940: 2022 792d 7a22 2c20 6f72 2022 782d 7a22   "y-z", or "x-z"
-0002b950: 2e0a 0a20 2020 2020 2020 2070 6c6f 745f  ...        plot_
-0002b960: 7479 7065 203a 2073 7472 2c20 6465 6661  type : str, defa
-0002b970: 756c 743d 2263 6f6e 746f 7572 220a 2020  ult="contour".  
-0002b980: 2020 2020 2020 2020 2020 506c 6f74 7469            Plotti
-0002b990: 6e67 2074 7970 652e 2049 6620 4e6f 6e65  ng type. If None
-0002b9a0: 2c20 7769 6c6c 2062 6520 6569 7468 6572  , will be either
-0002b9b0: 2022 636f 6e74 6f75 7222 206f 7220 226d   "contour" or "m
-0002b9c0: 6173 6b22 200a 2020 2020 2020 2020 2020  ask" .          
-0002b9d0: 2020 6465 7065 6e64 696e 6720 6f6e 2074    depending on t
-0002b9e0: 6865 2069 6e70 7574 2074 7970 6520 6f66  he input type of
-0002b9f0: 2074 6865 2052 4f49 2e20 4f70 7469 6f6e   the ROI. Option
-0002ba00: 733a 0a0a 2020 2020 2020 2020 2020 2020  s:..            
-0002ba10: 2020 2020 2d20 2263 6f6e 746f 7572 220a      - "contour".
-0002ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ba30: 2d20 226d 6173 6b22 0a20 2020 2020 2020  - "mask".       
-0002ba40: 2020 2020 2020 2020 202d 2022 6365 6e74           - "cent
-0002ba50: 726f 6964 2220 2863 6f6e 746f 7572 2077  roid" (contour w
-0002ba60: 6974 6820 6d61 726b 6572 2061 7420 6365  ith marker at ce
-0002ba70: 6e74 726f 6964 290a 2020 2020 2020 2020  ntroid).        
-0002ba80: 2020 2020 2020 2020 2d20 2266 696c 6c65          - "fille
-0002ba90: 6422 2028 7472 616e 7370 6172 656e 7420  d" (transparent 
-0002baa0: 6d61 736b 202b 2063 6f6e 746f 7572 290a  mask + contour).
-0002bab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bac0: 2d20 2266 696c 6c65 6420 6365 6e74 726f  - "filled centro
-0002bad0: 6964 2220 2866 696c 6c65 6420 7769 7468  id" (filled with
-0002bae0: 206d 6172 6b65 7220 6174 2063 656e 7472   marker at centr
-0002baf0: 6f69 6429 0a0a 2020 2020 2020 2020 736c  oid)..        sl
-0002bb00: 203a 2069 6e74 2c20 6465 6661 756c 743d   : int, default=
-0002bb10: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0002bb20: 2053 6c69 6365 206e 756d 6265 7220 746f   Slice number to
-0002bb30: 2070 6c6f 742e 2049 6620 6e6f 6e65 206f   plot. If none o
-0002bb40: 6620 3c73 6c3e 2c20 3c69 6478 3e20 6f72  f <sl>, <idx> or
-0002bb50: 203c 706f 733e 2061 7265 2073 7570 706c   <pos> are suppl
-0002bb60: 6965 642c 200a 2020 2020 2020 2020 2020  ied, .          
-0002bb70: 2020 7468 6520 6365 6e74 7261 6c20 736c    the central sl
-0002bb80: 6963 6520 6f66 2074 6865 2052 4f49 2077  ice of the ROI w
-0002bb90: 696c 6c20 6265 200a 2020 2020 2020 2020  ill be .        
-0002bba0: 2020 2020 7573 6564 2e0a 0a20 2020 2020      used...     
-0002bbb0: 2020 2069 6478 203a 2069 6e74 2c20 6465     idx : int, de
-0002bbc0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-0002bbd0: 2020 2020 2020 2041 7272 6179 2069 6e64         Array ind
-0002bbe0: 6578 206f 6620 736c 6963 6520 746f 2070  ex of slice to p
-0002bbf0: 6c6f 742e 2049 6620 6e6f 6e65 206f 6620  lot. If none of 
-0002bc00: 3c73 6c3e 2c20 3c69 6478 3e20 6f72 203c  <sl>, <idx> or <
-0002bc10: 706f 733e 2061 7265 200a 2020 2020 2020  pos> are .      
-0002bc20: 2020 2020 2020 7375 7070 6c69 6564 2c20        supplied, 
-0002bc30: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
-0002bc40: 6520 6f66 2074 6865 2052 4f49 2077 696c  e of the ROI wil
-0002bc50: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
-0002bc60: 2020 2020 706f 7320 3a20 666c 6f61 742c      pos : float,
-0002bc70: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0002bc80: 2020 2020 2020 2020 2020 506f 7369 7469            Positi
-0002bc90: 6f6e 2069 6e20 6d6d 206f 6620 736c 6963  on in mm of slic
-0002bca0: 6520 746f 2070 6c6f 742e 2049 6620 6e6f  e to plot. If no
-0002bcb0: 6e65 206f 6620 3c73 6c3e 2c20 3c69 6478  ne of <sl>, <idx
-0002bcc0: 3e20 6f72 203c 706f 733e 200a 2020 2020  > or <pos> .    
-0002bcd0: 2020 2020 2020 2020 6172 6520 7375 7070          are supp
-0002bce0: 6c69 6564 2c20 7468 6520 6365 6e74 7261  lied, the centra
-0002bcf0: 6c20 736c 6963 6520 6f66 2074 6865 2052  l slice of the R
-0002bd00: 4f49 2077 696c 6c20 6265 2075 7365 642e  OI will be used.
-0002bd10: 0a0a 2020 2020 2020 2020 6178 203a 206d  ..        ax : m
-0002bd20: 6174 706c 6f74 6c69 622e 7079 706c 6f74  atplotlib.pyplot
-0002bd30: 2e41 7865 732c 2064 6566 6175 6c74 3d4e  .Axes, default=N
-0002bd40: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0002bd50: 4178 6573 206f 6e20 7768 6963 6820 746f  Axes on which to
-0002bd60: 2070 6c6f 742e 2049 6620 4e6f 6e65 2c20   plot. If None, 
-0002bd70: 6e65 7720 6178 6573 2077 696c 6c20 6265  new axes will be
-0002bd80: 2063 7265 6174 6564 2e0a 0a20 2020 2020   created...     
-0002bd90: 2020 2067 7320 3a20 6d61 7470 6c6f 746c     gs : matplotl
-0002bda0: 6962 2e67 7269 6473 7065 632e 4772 6964  ib.gridspec.Grid
-0002bdb0: 5370 6563 2c20 6465 6661 756c 743d 4e6f  Spec, default=No
-0002bdc0: 6e65 0a20 2020 2020 2020 2020 2020 2049  ne.            I
-0002bdd0: 6620 6e6f 7420 4e6f 6e65 2061 6e64 203c  f not None and <
-0002bde0: 6178 3e20 6973 204e 6f6e 652c 206e 6577  ax> is None, new
-0002bdf0: 2061 7865 7320 7769 6c6c 2062 6520 6372   axes will be cr
-0002be00: 6561 7465 6420 6f6e 2074 6865 0a20 2020  eated on the.   
-0002be10: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-0002be20: 206d 6174 706c 6f74 6c69 6220 6669 6775   matplotlib figu
-0002be30: 7265 2077 6974 6820 7468 6973 2067 7269  re with this gri
-0002be40: 6473 7065 632e 0a0a 2020 2020 2020 2020  dspec...        
-0002be50: 6669 6773 697a 6520 3a20 666c 6f61 742c  figsize : float,
-0002be60: 2064 6566 6175 6c74 3d73 6b72 742e 696d   default=skrt.im
-0002be70: 6167 652e 5f64 6566 6175 6c74 5f66 6967  age._default_fig
-0002be80: 7369 7a65 0a20 2020 2020 2020 2020 2020  size.           
-0002be90: 2046 6967 7572 6520 6865 6967 6874 2069   Figure height i
-0002bea0: 6e20 696e 6368 6573 3b20 6f6e 6c79 2075  n inches; only u
-0002beb0: 7365 6420 6966 203c 6178 3e20 616e 6420  sed if <ax> and 
-0002bec0: 3c67 733e 2061 7265 204e 6f6e 652e 0a0a  <gs> are None...
-0002bed0: 2020 2020 2020 2020 6f70 6163 6974 7920          opacity 
-0002bee0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
-0002bef0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0002bf00: 2020 4f70 6163 6974 7920 746f 2075 7365    Opacity to use
-0002bf10: 2069 6620 706c 6f74 7469 6e67 206d 6173   if plotting mas
-0002bf20: 6b20 2869 2e65 2e20 706c 6f74 2074 7970  k (i.e. plot typ
-0002bf30: 6573 2022 6d61 736b 222c 2022 6669 6c6c  es "mask", "fill
-0002bf40: 6564 222c 200a 2020 2020 2020 2020 2020  ed", .          
-0002bf50: 2020 6f72 2022 6669 6c6c 6564 2063 656e    or "filled cen
-0002bf60: 7472 6f69 6422 292e 2049 6620 4e6f 6e65  troid"). If None
-0002bf70: 2c20 6f70 6163 6974 7920 7769 6c6c 2062  , opacity will b
-0002bf80: 6520 3120 6279 2064 6566 6175 6c74 2066  e 1 by default f
-0002bf90: 6f72 200a 2020 2020 2020 2020 2020 2020  or .            
-0002bfa0: 736f 6c69 6420 6d61 736b 2070 6c6f 7473  solid mask plots
-0002bfb0: 2061 6e64 2030 2e33 2062 7920 6465 6661   and 0.3 by defa
-0002bfc0: 756c 7420 666f 7220 6669 6c6c 6564 2070  ult for filled p
-0002bfd0: 6c6f 7473 2e0a 0a20 2020 2020 2020 206c  lots...        l
-0002bfe0: 696e 6577 6964 7468 203a 2066 6c6f 6174  inewidth : float
-0002bff0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0002c000: 2020 2020 2020 2020 2020 2057 6964 7468             Width
-0002c010: 206f 6620 636f 6e74 6f75 7220 6c69 6e65   of contour line
-0002c020: 732e 2049 6620 4e6f 6e65 2c20 7468 6520  s. If None, the 
-0002c030: 6d61 7470 6c6f 746c 6962 2064 6566 6175  matplotlib defau
-0002c040: 6c74 2073 6574 7469 6e67 200a 2020 2020  lt setting .    
-0002c050: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
-0002c060: 7573 6564 2e0a 0a20 2020 2020 2020 2063  used...        c
-0002c070: 6f6e 746f 7572 5f6b 7761 7267 7320 3a20  ontour_kwargs : 
-0002c080: 6469 6374 2c20 6465 6661 756c 743d 4e6f  dict, default=No
-0002c090: 6e65 0a20 2020 2020 2020 2020 2020 2045  ne.            E
-0002c0a0: 7874 7261 206b 6579 776f 7264 2061 7267  xtra keyword arg
-0002c0b0: 756d 656e 7473 2074 6f20 7061 7373 2074  uments to pass t
-0002c0c0: 6f20 6d61 7470 6c6f 746c 6962 2063 6f6e  o matplotlib con
-0002c0d0: 746f 7572 2070 6c6f 7474 696e 672e 0a0a  tour plotting...
-0002c0e0: 2020 2020 2020 2020 6d61 736b 5f6b 7761          mask_kwa
-0002c0f0: 7267 7320 3a20 6469 6374 2c20 6465 6661  rgs : dict, defa
-0002c100: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0002c110: 2020 2020 2045 7874 7261 206b 6579 776f       Extra keywo
-0002c120: 7264 2061 7267 756d 656e 7473 2074 6f20  rd arguments to 
-0002c130: 7061 7373 2074 6f20 6d61 7470 6c6f 746c  pass to matplotl
-0002c140: 6962 206d 6173 6b20 706c 6f74 7469 6e67  ib mask plotting
-0002c150: 2e0a 0a20 2020 2020 2020 207a 6f6f 6d20  ...        zoom 
-0002c160: 3a20 696e 742f 666c 6f61 742f 7475 706c  : int/float/tupl
-0002c170: 652c 2064 6566 6175 6c74 3d4e 6f6e 650a  e, default=None.
-0002c180: 2020 2020 2020 2020 2020 2020 4661 6374              Fact
-0002c190: 6f72 2062 7920 7768 6963 6820 746f 207a  or by which to z
-0002c1a0: 6f6f 6d20 696e 2e20 4966 2061 2073 696e  oom in. If a sin
-0002c1b0: 676c 6520 696e 7420 6f72 2066 6c6f 6174  gle int or float
-0002c1c0: 2069 7320 6769 7665 6e2c 0a20 2020 2020   is given,.     
-0002c1d0: 2020 2020 2020 2074 6865 2073 616d 6520         the same 
-0002c1e0: 7a6f 6f6d 2066 6163 746f 7220 7769 6c6c  zoom factor will
-0002c1f0: 2062 6520 6170 706c 6965 6420 696e 2061   be applied in a
-0002c200: 6c6c 2064 6972 6563 7469 6f6e 732e 2049  ll directions. I
-0002c210: 6620 6120 7475 706c 650a 2020 2020 2020  f a tuple.      
-0002c220: 2020 2020 2020 6f66 2074 6872 6565 2076        of three v
-0002c230: 616c 7565 7320 6973 2067 6976 656e 2c20  alues is given, 
-0002c240: 7468 6573 6520 7769 6c6c 2062 6520 7573  these will be us
-0002c250: 6564 2061 7320 7468 6520 7a6f 6f6d 2066  ed as the zoom f
-0002c260: 6163 746f 7273 0a20 2020 2020 2020 2020  actors.         
-0002c270: 2020 2069 6e20 6561 6368 2064 6972 6563     in each direc
-0002c280: 7469 6f6e 2069 6e20 7468 6520 6f72 6465  tion in the orde
-0002c290: 7220 2878 2c20 792c 207a 292e 2049 6620  r (x, y, z). If 
-0002c2a0: 4e6f 6e65 2c20 7468 6520 696d 6167 6520  None, the image 
-0002c2b0: 7769 6c6c 0a20 2020 2020 2020 2020 2020  will.           
-0002c2c0: 206e 6f74 2062 6520 7a6f 6f6d 6564 2069   not be zoomed i
-0002c2d0: 6e2e 0a0a 2020 2020 2020 2020 7a6f 6f6d  n...        zoom
-0002c2e0: 5f63 656e 7472 6520 3a20 7475 706c 652c  _centre : tuple,
-0002c2f0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0002c300: 2020 2020 2020 2020 2020 506f 7369 7469            Positi
-0002c310: 6f6e 2061 726f 756e 6420 7768 6963 6820  on around which 
-0002c320: 7a6f 6f6d 696e 6720 6973 2061 7070 6c69  zooming is appli
-0002c330: 6564 2e20 4966 204e 6f6e 652c 2074 6865  ed. If None, the
-0002c340: 2063 656e 7472 6520 6f66 0a20 2020 2020   centre of.     
-0002c350: 2020 2020 2020 2074 6865 2069 6d61 6765         the image
-0002c360: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
-0002c370: 2020 2020 2020 2020 636f 6c6f 7220 3a20          color : 
-0002c380: 6d61 7470 6c6f 746c 6962 2063 6f6c 6f72  matplotlib color
-0002c390: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0002c3a0: 2020 2020 2020 2020 2020 2043 6f6c 6f72             Color
-0002c3b0: 2077 6974 6820 7768 6963 6820 746f 2070   with which to p
-0002c3c0: 6c6f 7420 7468 6520 524f 493b 206f 7665  lot the ROI; ove
-0002c3d0: 7272 6964 6573 2074 6865 2052 4f49 2773  rrides the ROI's
-0002c3e0: 206f 776e 2063 6f6c 6f72 2e20 4966 200a   own color. If .
-0002c3f0: 2020 2020 2020 2020 2020 2020 4e6f 6e65              None
-0002c400: 2c20 7365 6c66 2e63 6f6c 6f72 2077 696c  , self.color wil
-0002c410: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
-0002c420: 2020 2020 7368 6f77 203a 2062 6f6f 6c2c      show : bool,
-0002c430: 2064 6566 6175 6c74 3d54 7275 650a 2020   default=True.  
-0002c440: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-0002c450: 652c 2074 6865 2070 6c6f 7420 7769 6c6c  e, the plot will
-0002c460: 2062 6520 6469 7370 6c61 7965 6420 696d   be displayed im
-0002c470: 6d65 6469 6174 656c 792e 0a0a 2020 2020  mediately...    
-0002c480: 2020 2020 7361 7665 5f61 7320 3a20 7374      save_as : st
-0002c490: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
-0002c4a0: 2020 2020 2020 2020 2020 2020 4966 2073              If s
-0002c4b0: 6574 2074 6f20 6120 7374 7269 6e67 2c20  et to a string, 
-0002c4c0: 7468 6520 706c 6f74 2077 696c 6c20 6265  the plot will be
-0002c4d0: 2073 6176 6564 2074 6f20 7468 6520 6669   saved to the fi
-0002c4e0: 6c65 6e61 6d65 2069 6e20 7468 6520 0a20  lename in the . 
-0002c4f0: 2020 2020 2020 2020 2020 2073 7472 696e             strin
-0002c500: 672e 0a0a 2020 2020 2020 2020 696e 636c  g...        incl
-0002c510: 7564 655f 696d 6167 6520 3a20 626f 6f6c  ude_image : bool
-0002c520: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
-0002c530: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-0002c540: 7275 6520 616e 6420 7365 6c66 2e69 6d61  rue and self.ima
-0002c550: 6765 2069 7320 6e6f 7420 4e6f 6e65 2c20  ge is not None, 
-0002c560: 7468 6520 524f 4927 7320 696d 6167 6520  the ROI's image 
-0002c570: 7769 6c6c 2062 6520 706c 6f74 7465 640a  will be plotted.
-0002c580: 2020 2020 2020 2020 2020 2020 696e 2074              in t
-0002c590: 6865 2062 6163 6b67 726f 756e 642e 0a0a  he background...
-0002c5a0: 2020 2020 2020 2020 6e6f 5f69 6e76 6572          no_inver
-0002c5b0: 7420 3a20 626f 6f6c 2c20 6465 6661 756c  t : bool, defaul
-0002c5c0: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
-0002c5d0: 2020 2020 4966 2046 616c 7365 2c20 636f      If False, co
-0002c5e0: 6e74 6f75 7220 706c 6f74 7320 7769 6c6c  ntour plots will
-0002c5f0: 2062 6520 6175 746f 6d61 7469 6361 6c6c   be automaticall
-0002c600: 7920 696e 7665 7274 6564 2077 6865 6e20  y inverted when 
-0002c610: 706c 6f74 7469 6e67 0a20 2020 2020 2020  plotting.       
-0002c620: 2020 2020 2077 6974 686f 7574 2061 6e20       without an 
-0002c630: 756e 6465 726c 7969 6e67 2069 6d61 6765  underlying image
-0002c640: 2074 6f20 6163 636f 756e 7420 666f 7220   to account for 
-0002c650: 7468 6520 7920 6178 6973 2069 6e63 7265  the y axis incre
-0002c660: 6173 696e 6720 0a20 2020 2020 2020 2020  asing .         
-0002c670: 2020 2069 6e20 7468 6520 6f70 706f 7369     in the opposi
-0002c680: 7465 2064 6972 6563 7469 6f6e 2e20 4f74  te direction. Ot
-0002c690: 6865 7277 6973 652c 2074 6865 2070 6c6f  herwise, the plo
-0002c6a0: 7420 7769 6c6c 2062 6520 6c65 6674 2061  t will be left a
-0002c6b0: 730a 2020 2020 2020 2020 2020 2020 6974  s.            it
-0002c6c0: 2061 7070 6561 7265 6420 7768 656e 2064   appeared when d
-0002c6d0: 7261 776e 2062 7920 6d61 7470 6c6f 746c  rawn by matplotl
-0002c6e0: 6962 2e0a 0a20 2020 2020 2020 2060 2a2a  ib...        `**
-0002c6f0: 606b 7761 7267 7320 3a0a 2020 2020 2020  `kwargs :.      
-0002c700: 2020 2020 2020 4578 7472 6120 6b65 7977        Extra keyw
-0002c710: 6f72 6420 6172 6775 6d65 6e74 7320 746f  ord arguments to
-0002c720: 2070 6173 7320 746f 2074 6865 2072 656c   pass to the rel
-0002c730: 6576 616e 7420 706c 6f74 2066 756e 6374  evant plot funct
-0002c740: 696f 6e2e 0a20 2020 2020 2020 2022 2222  ion..        """
-0002c750: 0a0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
-0002c760: 6f61 6428 290a 2020 2020 2020 2020 6966  oad().        if
-0002c770: 2073 656c 662e 656d 7074 793a 0a20 2020   self.empty:.   
-0002c780: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-0002c790: 0a20 2020 2020 2020 2069 6620 706c 6f74  .        if plot
-0002c7a0: 5f74 7970 6520 6973 204e 6f6e 653a 0a20  _type is None:. 
-0002c7b0: 2020 2020 2020 2020 2020 2070 6c6f 745f             plot_
-0002c7c0: 7479 7065 203d 206b 7761 7267 732e 6765  type = kwargs.ge
-0002c7d0: 7428 2272 6f69 5f70 6c6f 745f 7479 7065  t("roi_plot_type
-0002c7e0: 222c 2073 656c 662e 6465 6661 756c 745f  ", self.default_
-0002c7f0: 6765 6f6d 5f6d 6574 686f 6429 0a0a 2020  geom_method)..  
-0002c800: 2020 2020 2020 6966 2073 6c20 6973 204e        if sl is N
-0002c810: 6f6e 6520 616e 6420 6964 7820 6973 204e  one and idx is N
-0002c820: 6f6e 6520 616e 6420 706f 7320 6973 204e  one and pos is N
-0002c830: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0002c840: 2069 6478 203d 2073 656c 662e 6765 745f   idx = self.get_
-0002c850: 6d69 645f 6964 7828 7669 6577 290a 2020  mid_idx(view).  
-0002c860: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0002c870: 2020 2020 2020 2020 6964 7820 3d20 7365          idx = se
-0002c880: 6c66 2e67 6574 5f69 6478 2876 6965 772c  lf.get_idx(view,
-0002c890: 2073 6c2c 2069 6478 2c20 706f 7329 0a0a   sl, idx, pos)..
-0002c8a0: 2020 2020 2020 2020 7368 6f77 5f63 656e          show_cen
-0002c8b0: 7472 6f69 6420 3d20 2263 656e 7472 6f69  troid = "centroi
-0002c8c0: 6422 2069 6e20 706c 6f74 5f74 7970 650a  d" in plot_type.
-0002c8d0: 2020 2020 2020 2020 6966 207a 6f6f 6d20          if zoom 
-0002c8e0: 616e 6420 7a6f 6f6d 5f63 656e 7472 6520  and zoom_centre 
-0002c8f0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0002c900: 2020 2020 207a 6f6f 6d5f 6365 6e74 7265       zoom_centre
-0002c910: 203d 2073 656c 662e 6765 745f 7a6f 6f6d   = self.get_zoom
-0002c920: 5f63 656e 7472 6528 7669 6577 290a 2020  _centre(view).  
-0002c930: 2020 2020 2020 6966 2063 6f6c 6f72 2069        if color i
-0002c940: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0002c950: 2020 2020 636f 6c6f 7220 3d20 7365 6c66      color = self
-0002c960: 2e63 6f6c 6f72 0a20 2020 2020 2020 2065  .color.        e
-0002c970: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0002c980: 2063 6f6c 6f72 203d 206d 6174 706c 6f74   color = matplot
-0002c990: 6c69 622e 636f 6c6f 7273 2e74 6f5f 7267  lib.colors.to_rg
-0002c9a0: 6261 2863 6f6c 6f72 290a 0a20 2020 2020  ba(color)..     
-0002c9b0: 2020 2069 6620 6f70 6163 6974 7920 6973     if opacity is
-0002c9c0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0002c9d0: 2020 206f 7061 6369 7479 203d 206b 7761     opacity = kwa
-0002c9e0: 7267 732e 6765 7428 0a20 2020 2020 2020  rgs.get(.       
-0002c9f0: 2020 2020 2020 2020 2020 2020 2022 726f               "ro
-0002ca00: 695f 6f70 6163 6974 7922 2c20 302e 3320  i_opacity", 0.3 
-0002ca10: 6966 2022 6669 6c6c 6564 2220 696e 2070  if "filled" in p
-0002ca20: 6c6f 745f 7479 7065 2065 6c73 6520 3129  lot_type else 1)
-0002ca30: 0a0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
-0002ca40: 7570 2061 7865 730a 2020 2020 2020 2020  up axes.        
-0002ca50: 7365 6c66 2e73 6574 5f61 7828 706c 6f74  self.set_ax(plot
-0002ca60: 5f74 7970 652c 2069 6e63 6c75 6465 5f69  _type, include_i
-0002ca70: 6d61 6765 2c20 7669 6577 2c20 6178 2c20  mage, view, ax, 
-0002ca80: 6773 2c20 6669 6773 697a 6529 0a0a 2020  gs, figsize)..  
-0002ca90: 2020 2020 2020 2320 4164 6a75 7374 2063        # Adjust c
-0002caa0: 656e 7472 6f69 6420 6d61 726b 6572 2073  entroid marker s
-0002cab0: 697a 650a 2020 2020 2020 2020 6966 2063  ize.        if c
-0002cac0: 6f6e 746f 7572 5f6b 7761 7267 7320 6973  ontour_kwargs is
-0002cad0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0002cae0: 2020 2063 6f6e 746f 7572 5f6b 7761 7267     contour_kwarg
-0002caf0: 7320 3d20 7b7d 0a20 2020 2020 2020 2069  s = {}.        i
-0002cb00: 6620 2263 656e 7472 6f69 6422 2069 6e20  f "centroid" in 
-0002cb10: 706c 6f74 5f74 7970 6520 6f72 2022 636f  plot_type or "co
-0002cb20: 6e74 6f75 7222 203d 3d20 706c 6f74 5f74  ntour" == plot_t
-0002cb30: 7970 653a 0a20 2020 2020 2020 2020 2020  ype:.           
-0002cb40: 2069 6620 6c69 6e65 7769 6474 6820 6973   if linewidth is
-0002cb50: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0002cb60: 2020 2020 2020 206c 696e 6577 6964 7468         linewidth
-0002cb70: 203d 206b 7761 7267 732e 6765 7428 2272   = kwargs.get("r
-0002cb80: 6f69 5f6c 696e 6577 6964 7468 222c 0a20  oi_linewidth",. 
-0002cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cba0: 2020 2020 2020 2064 6566 6175 6c74 5061         defaultPa
-0002cbb0: 7261 6d73 5b22 6c69 6e65 732e 6c69 6e65  rams["lines.line
-0002cbc0: 7769 6474 6822 5d5b 305d 290a 2020 2020  width"][0]).    
-0002cbd0: 2020 2020 6966 2022 6365 6e74 726f 6964      if "centroid
-0002cbe0: 2220 696e 2070 6c6f 745f 7479 7065 3a0a  " in plot_type:.
-0002cbf0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0002cc00: 6f75 725f 6b77 6172 6773 2e73 6574 6465  our_kwargs.setde
-0002cc10: 6661 756c 7428 226d 6172 6b65 7273 697a  fault("markersiz
-0002cc20: 6522 2c20 3720 2a20 6e70 2e73 7172 7428  e", 7 * np.sqrt(
-0002cc30: 6c69 6e65 7769 6474 6829 290a 2020 2020  linewidth)).    
-0002cc40: 2020 2020 2020 2020 636f 6e74 6f75 725f          contour_
-0002cc50: 6b77 6172 6773 2e73 6574 6465 6661 756c  kwargs.setdefaul
-0002cc60: 7428 226d 6172 6b65 7265 6467 6577 6964  t("markeredgewid
-0002cc70: 7468 222c 206e 702e 7371 7274 286c 696e  th", np.sqrt(lin
-0002cc80: 6577 6964 7468 2929 0a0a 2020 2020 2020  ewidth))..      
-0002cc90: 2020 2320 506c 6f74 2061 206d 6173 6b0a    # Plot a mask.
-0002cca0: 2020 2020 2020 2020 6966 2070 6c6f 745f          if plot_
-0002ccb0: 7479 7065 203d 3d20 226d 6173 6b22 3a0a  type == "mask":.
-0002ccc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0002ccd0: 2e5f 706c 6f74 5f6d 6173 6b28 0a20 2020  ._plot_mask(.   
-0002cce0: 2020 2020 2020 2020 2020 2020 2076 6965               vie
-0002ccf0: 772c 0a20 2020 2020 2020 2020 2020 2020  w,.             
-0002cd00: 2020 2069 6478 2c0a 2020 2020 2020 2020     idx,.        
-0002cd10: 2020 2020 2020 2020 6d61 736b 5f6b 7761          mask_kwa
-0002cd20: 7267 732c 0a20 2020 2020 2020 2020 2020  rgs,.           
-0002cd30: 2020 2020 206f 7061 6369 7479 2c0a 2020       opacity,.  
-0002cd40: 2020 2020 2020 2020 2020 2020 2020 7a6f                zo
-0002cd50: 6f6d 3d7a 6f6f 6d2c 0a20 2020 2020 2020  om=zoom,.       
-0002cd60: 2020 2020 2020 2020 207a 6f6f 6d5f 6365           zoom_ce
-0002cd70: 6e74 7265 3d7a 6f6f 6d5f 6365 6e74 7265  ntre=zoom_centre
-0002cd80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002cd90: 2020 7368 6f77 3d46 616c 7365 2c0a 2020    show=False,.  
-0002cda0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0002cdb0: 636c 7564 655f 696d 6167 653d 696e 636c  clude_image=incl
-0002cdc0: 7564 655f 696d 6167 652c 0a20 2020 2020  ude_image,.     
-0002cdd0: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
-0002cde0: 3d63 6f6c 6f72 2c0a 2020 2020 2020 2020  =color,.        
-0002cdf0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-0002ce00: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0002ce10: 0a20 2020 2020 2020 2023 2050 6c6f 7420  .        # Plot 
-0002ce20: 6120 636f 6e74 6f75 720a 2020 2020 2020  a contour.      
-0002ce30: 2020 656c 6966 2070 6c6f 745f 7479 7065    elif plot_type
-0002ce40: 2069 6e20 5b22 636f 6e74 6f75 7222 2c20   in ["contour", 
-0002ce50: 2263 656e 7472 6f69 6422 5d3a 0a20 2020  "centroid"]:.   
-0002ce60: 2020 2020 2020 2020 2073 656c 662e 5f70           self._p
-0002ce70: 6c6f 745f 636f 6e74 6f75 7228 0a20 2020  lot_contour(.   
-0002ce80: 2020 2020 2020 2020 2020 2020 2076 6965               vie
-0002ce90: 772c 0a20 2020 2020 2020 2020 2020 2020  w,.             
-0002cea0: 2020 2069 6478 2c0a 2020 2020 2020 2020     idx,.        
-0002ceb0: 2020 2020 2020 2020 636f 6e74 6f75 725f          contour_
-0002cec0: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
-0002ced0: 2020 2020 2020 2020 6c69 6e65 7769 6474          linewidt
-0002cee0: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
-0002cef0: 2020 2063 656e 7472 6f69 643d 7368 6f77     centroid=show
-0002cf00: 5f63 656e 7472 6f69 642c 0a20 2020 2020  _centroid,.     
-0002cf10: 2020 2020 2020 2020 2020 207a 6f6f 6d3d             zoom=
-0002cf20: 7a6f 6f6d 2c0a 2020 2020 2020 2020 2020  zoom,.          
-0002cf30: 2020 2020 2020 7a6f 6f6d 5f63 656e 7472        zoom_centr
-0002cf40: 653d 7a6f 6f6d 5f63 656e 7472 652c 0a20  e=zoom_centre,. 
-0002cf50: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0002cf60: 6f6c 6f72 3d63 6f6c 6f72 2c0a 2020 2020  olor=color,.    
-0002cf70: 2020 2020 2020 2020 2020 2020 7368 6f77              show
-0002cf80: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-0002cf90: 2020 2020 2020 2020 696e 636c 7564 655f          include_
-0002cfa0: 696d 6167 653d 696e 636c 7564 655f 696d  image=include_im
-0002cfb0: 6167 652c 0a20 2020 2020 2020 2020 2020  age,.           
-0002cfc0: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
-0002cfd0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0002cfe0: 2020 2020 2020 2320 506c 6f74 2074 7261        # Plot tra
-0002cff0: 6e73 7061 7265 6e74 206d 6173 6b20 2b20  nsparent mask + 
-0002d000: 636f 6e74 6f75 720a 2020 2020 2020 2020  contour.        
-0002d010: 656c 6966 2022 6669 6c6c 6564 2220 696e  elif "filled" in
-0002d020: 2070 6c6f 745f 7479 7065 3a0a 2020 2020   plot_type:.    
-0002d030: 2020 2020 2020 2020 6966 206f 7061 6369          if opaci
-0002d040: 7479 2069 7320 4e6f 6e65 3a0a 2020 2020  ty is None:.    
-0002d050: 2020 2020 2020 2020 2020 2020 6f70 6163              opac
-0002d060: 6974 7920 3d20 302e 330a 2020 2020 2020  ity = 0.3.      
-0002d070: 2020 2020 2020 7365 6c66 2e5f 706c 6f74        self._plot
-0002d080: 5f6d 6173 6b28 7669 6577 2c20 6964 782c  _mask(view, idx,
-0002d090: 206d 6173 6b5f 6b77 6172 6773 2c20 6f70   mask_kwargs, op
-0002d0a0: 6163 6974 792c 2063 6f6c 6f72 3d63 6f6c  acity, color=col
-0002d0b0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-0002d0c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0002d0d0: 686f 773d 4661 6c73 652c 2069 6e63 6c75  how=False, inclu
-0002d0e0: 6465 5f69 6d61 6765 3d69 6e63 6c75 6465  de_image=include
-0002d0f0: 5f69 6d61 6765 2c20 2a2a 6b77 6172 6773  _image, **kwargs
-0002d100: 290a 2020 2020 2020 2020 2020 2020 6b77  ).            kw
-0002d110: 6172 6773 5b22 6178 225d 203d 2073 656c  args["ax"] = sel
-0002d120: 662e 6178 0a20 2020 2020 2020 2020 2020  f.ax.           
-0002d130: 2073 656c 662e 5f70 6c6f 745f 636f 6e74   self._plot_cont
-0002d140: 6f75 7228 0a20 2020 2020 2020 2020 2020  our(.           
-0002d150: 2020 2020 2076 6965 772c 0a20 2020 2020       view,.     
-0002d160: 2020 2020 2020 2020 2020 2069 6478 2c0a             idx,.
-0002d170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d180: 636f 6e74 6f75 725f 6b77 6172 6773 2c0a  contour_kwargs,.
-0002d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d1a0: 6c69 6e65 7769 6474 682c 0a20 2020 2020  linewidth,.     
-0002d1b0: 2020 2020 2020 2020 2020 2063 656e 7472             centr
-0002d1c0: 6f69 643d 7368 6f77 5f63 656e 7472 6f69  oid=show_centroi
-0002d1d0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-0002d1e0: 2020 207a 6f6f 6d3d 7a6f 6f6d 2c0a 2020     zoom=zoom,.  
-0002d1f0: 2020 2020 2020 2020 2020 2020 2020 7a6f                zo
-0002d200: 6f6d 5f63 656e 7472 653d 7a6f 6f6d 5f63  om_centre=zoom_c
-0002d210: 656e 7472 652c 0a20 2020 2020 2020 2020  entre,.         
-0002d220: 2020 2020 2020 2063 6f6c 6f72 3d63 6f6c         color=col
-0002d230: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-0002d240: 2020 2020 7368 6f77 3d46 616c 7365 2c0a      show=False,.
-0002d250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d260: 696e 636c 7564 655f 696d 6167 653d 4661  include_image=Fa
-0002d270: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-0002d280: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
-0002d290: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0002d2a0: 2020 2020 2020 2320 4368 6563 6b20 7768        # Check wh
-0002d2b0: 6574 6865 7220 7920 6178 6973 206e 6565  ether y axis nee
-0002d2c0: 6473 2074 6f20 6265 2069 6e76 6572 7465  ds to be inverte
-0002d2d0: 640a 2020 2020 2020 2020 6966 2076 6965  d.        if vie
-0002d2e0: 7720 3d3d 2022 782d 7922 2061 6e64 2073  w == "x-y" and s
-0002d2f0: 656c 662e 6178 2e67 6574 5f79 6c69 6d28  elf.ax.get_ylim(
-0002d300: 295b 315d 203e 2073 656c 662e 6178 2e67  )[1] > self.ax.g
-0002d310: 6574 5f79 6c69 6d28 295b 305d 3a0a 2020  et_ylim()[0]:.  
-0002d320: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0002d330: 782e 696e 7665 7274 5f79 6178 6973 2829  x.invert_yaxis()
-0002d340: 0a0a 2020 2020 2020 2020 2320 4472 6177  ..        # Draw
-0002d350: 206c 6567 656e 640a 2020 2020 2020 2020   legend.        
-0002d360: 6c65 6765 6e64 203d 206b 7761 7267 732e  legend = kwargs.
-0002d370: 6765 7428 226c 6567 656e 6422 2c20 4661  get("legend", Fa
-0002d380: 6c73 6529 0a20 2020 2020 2020 2069 6620  lse).        if 
-0002d390: 6c65 6765 6e64 3a0a 2020 2020 2020 2020  legend:.        
-0002d3a0: 2020 2020 6e61 6d65 203d 206b 7761 7267      name = kwarg
-0002d3b0: 732e 6765 7428 226e 616d 6522 2c20 7365  s.get("name", se
-0002d3c0: 6c66 2e6e 616d 6529 0a20 2020 2020 2020  lf.name).       
-0002d3d0: 2020 2020 2072 6f69 5f68 616e 646c 6520       roi_handle 
-0002d3e0: 3d20 7365 6c66 2e67 6574 5f70 6174 6368  = self.get_patch
-0002d3f0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0002d400: 2020 2020 2020 706c 6f74 5f74 7970 652c        plot_type,
-0002d410: 2063 6f6c 6f72 2c20 6f70 6163 6974 792c   color, opacity,
-0002d420: 206c 696e 6577 6964 7468 2c20 6e61 6d65   linewidth, name
-0002d430: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0002d440: 2072 6f69 5f68 616e 646c 653a 0a20 2020   roi_handle:.   
-0002d450: 2020 2020 2020 2020 2020 2020 2062 626f               bbo
-0002d460: 785f 746f 5f61 6e63 686f 7220 3d20 6b77  x_to_anchor = kw
-0002d470: 6172 6773 2e67 6574 2822 6c65 6765 6e64  args.get("legend
-0002d480: 5f62 626f 785f 746f 5f61 6e63 686f 7222  _bbox_to_anchor"
-0002d490: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-0002d4a0: 2020 2020 2020 2020 6c6f 6320 3d20 6b77          loc = kw
-0002d4b0: 6172 6773 2e67 6574 2822 6c65 6765 6e64  args.get("legend
-0002d4c0: 5f6c 6f63 222c 2022 6c6f 7765 7220 6c65  _loc", "lower le
-0002d4d0: 6674 2229 0a0a 2020 2020 2020 2020 2020  ft")..          
-0002d4e0: 2020 2020 2020 7365 6c66 2e61 782e 6c65        self.ax.le
-0002d4f0: 6765 6e64 2868 616e 646c 6573 3d5b 726f  gend(handles=[ro
-0002d500: 695f 6861 6e64 6c65 5d2c 0a20 2020 2020  i_handle],.     
-0002d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d520: 2020 2062 626f 785f 746f 5f61 6e63 686f     bbox_to_ancho
-0002d530: 723d 6262 6f78 5f74 6f5f 616e 6368 6f72  r=bbox_to_anchor
-0002d540: 2c20 6c6f 633d 6c6f 632c 0a20 2020 2020  , loc=loc,.     
-0002d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d560: 2020 2066 6163 6563 6f6c 6f72 3d22 7768     facecolor="wh
-0002d570: 6974 6522 2c20 6672 616d 6561 6c70 6861  ite", framealpha
-0002d580: 3d31 0a20 2020 2020 2020 2020 2020 2020  =1.             
-0002d590: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0002d5a0: 2020 2020 2020 2320 4469 7370 6c61 7920        # Display 
-0002d5b0: 696d 6167 650a 0a20 2020 2020 2020 2070  image..        p
-0002d5c0: 6c74 2e74 6967 6874 5f6c 6179 6f75 7428  lt.tight_layout(
-0002d5d0: 290a 2020 2020 2020 2020 6966 2073 686f  ).        if sho
-0002d5e0: 773a 0a20 2020 2020 2020 2020 2020 2070  w:.            p
-0002d5f0: 6c74 2e73 686f 7728 290a 0a20 2020 2020  lt.show()..     
-0002d600: 2020 2023 2053 6176 6520 746f 2066 696c     # Save to fil
-0002d610: 650a 2020 2020 2020 2020 6966 2073 6176  e.        if sav
-0002d620: 655f 6173 3a0a 2020 2020 2020 2020 2020  e_as:.          
-0002d630: 2020 7365 6c66 2e66 6967 2e73 6176 6566    self.fig.savef
-0002d640: 6967 2873 6176 655f 6173 290a 2020 2020  ig(save_as).    
-0002d650: 2020 2020 2020 2020 706c 742e 636c 6f73          plt.clos
-0002d660: 6528 290a 0a20 2020 2064 6566 2067 6574  e()..    def get
-0002d670: 5f64 756d 6d79 5f69 6d61 6765 2873 656c  _dummy_image(sel
-0002d680: 662c 202a 2a6b 7761 7267 7329 3a0a 2020  f, **kwargs):.  
-0002d690: 2020 2020 2020 2222 224d 616b 6520 6120        """Make a 
-0002d6a0: 6475 6d6d 7920 696d 6167 6520 7468 6174  dummy image that
-0002d6b0: 2063 6f76 6572 7320 7468 6520 6172 6561   covers the area
-0002d6c0: 2073 7061 6e6e 6564 2062 7920 7468 6973   spanned by this
-0002d6d0: 2052 4f49 2e20 0a20 2020 2020 2020 2052   ROI. .        R
-0002d6e0: 6574 7572 6e73 2061 6e20 496d 6167 6520  eturns an Image 
-0002d6f0: 6f62 6a65 6374 2e0a 0a20 2020 2020 2020  object...       
-0002d700: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-0002d710: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0002d720: 2020 766f 7865 6c5f 7369 7a65 203a 206c    voxel_size : l
-0002d730: 6973 742c 2064 6566 6175 6c74 3d4e 6f6e  ist, default=Non
-0002d740: 650a 2020 2020 2020 2020 2020 2020 566f  e.            Vo
-0002d750: 7865 6c20 7369 7a65 2069 6e20 6d6d 2069  xel size in mm i
-0002d760: 6e20 7468 6520 6475 6d6d 7920 696d 6167  n the dummy imag
-0002d770: 6520 696e 2074 6865 2078 2d79 2070 6c61  e in the x-y pla
-0002d780: 6e65 2c20 6769 7665 6e20 6173 200a 2020  ne, given as .  
-0002d790: 2020 2020 2020 2020 2020 5b76 782c 2076            [vx, v
-0002d7a0: 795d 2e20 4966 203c 7368 6170 653e 2061  y]. If <shape> a
-0002d7b0: 6e64 203c 766f 7865 6c5f 7369 7a65 3e20  nd <voxel_size> 
-0002d7c0: 6172 6520 626f 7468 204e 6f6e 652c 2076  are both None, v
-0002d7d0: 6f78 656c 2073 697a 6573 206f 660a 2020  oxel sizes of.  
-0002d7e0: 2020 2020 2020 2020 2020 5b31 2c20 315d            [1, 1]
-0002d7f0: 2077 696c 6c20 6265 2075 7365 6420 6279   will be used by
-0002d800: 2064 6566 6175 6c74 2e20 5468 6520 766f   default. The vo
-0002d810: 7865 6c20 7369 7a65 2069 6e20 7468 6520  xel size in the 
-0002d820: 7a20 6469 7265 6374 696f 6e20 0a20 2020  z direction .   
-0002d830: 2020 2020 2020 2020 2069 7320 6465 6669           is defi
-0002d840: 6e65 6420 6279 203c 736c 6963 655f 7468  ned by <slice_th
-0002d850: 6963 6b6e 6573 733e 2e0a 0a20 2020 2020  ickness>...     
-0002d860: 2020 2073 6861 7065 203a 206c 6973 742c     shape : list,
-0002d870: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0002d880: 2020 2020 2020 2020 2020 4e75 6d62 6572            Number
-0002d890: 206f 6620 766f 7865 6c73 2069 6e20 7468   of voxels in th
-0002d8a0: 6520 6475 6d6d 7920 696d 6167 6520 696e  e dummy image in
-0002d8b0: 2074 6865 2078 2d79 2070 6c61 6e65 2c20   the x-y plane, 
-0002d8c0: 6769 7665 6e20 6173 0a20 2020 2020 2020  given as.       
-0002d8d0: 2020 2020 205b 6e78 2c20 6e79 5d2e 204f       [nx, ny]. O
-0002d8e0: 6e6c 7920 7573 6564 2069 6620 3c76 6f78  nly used if <vox
-0002d8f0: 656c 5f73 697a 653e 2069 7320 4e6f 6e65  el_size> is None
-0002d900: 2e20 0a20 2020 2020 2020 2020 2020 2054  . .            T
-0002d910: 6865 206e 756d 6265 7220 6f66 2076 6f78  he number of vox
-0002d920: 656c 7320 696e 2074 6865 207a 2064 6972  els in the z dir
-0002d930: 6563 7469 6f6e 2077 696c 6c20 6265 2074  ection will be t
-0002d940: 616b 656e 2066 726f 6d20 7468 6520 0a20  aken from the . 
-0002d950: 2020 2020 2020 2020 2020 206e 756d 6265             numbe
-0002d960: 7220 6f66 2073 6c69 6365 7320 696e 2074  r of slices in t
-0002d970: 6865 2078 2d79 2063 6f6e 746f 7572 7320  he x-y contours 
-0002d980: 6469 6374 696f 6e61 7279 2e0a 0a20 2020  dictionary...   
-0002d990: 2020 2020 2066 696c 6c5f 7661 6c20 3a20       fill_val : 
-0002d9a0: 696e 742f 666c 6f61 742c 2064 6566 6175  int/float, defau
-0002d9b0: 6c74 3d31 6534 0a20 2020 2020 2020 2020  lt=1e4.         
-0002d9c0: 2020 2056 616c 7565 2077 6974 6820 7768     Value with wh
-0002d9d0: 6963 6820 7468 6520 766f 7865 6c73 2069  ich the voxels i
-0002d9e0: 6e20 7468 6520 6475 6d6d 7920 696d 6167  n the dummy imag
-0002d9f0: 6520 7368 6f75 6c64 2062 6520 6669 6c6c  e should be fill
-0002da00: 6564 2e20 0a0a 2020 2020 2020 2020 6275  ed. ..        bu
-0002da10: 6666 6572 203a 2069 6e74 2c20 6465 6661  ffer : int, defa
-0002da20: 756c 743d 310a 2020 2020 2020 2020 2020  ult=1.          
-0002da30: 2020 4e75 6d62 6572 206f 6620 656d 7074    Number of empt
-0002da40: 7920 6275 6666 6572 2076 6f78 656c 7320  y buffer voxels 
-0002da50: 746f 2061 6464 206f 7574 7369 6465 2074  to add outside t
-0002da60: 6865 2052 4f49 2069 6e20 6561 6368 0a20  he ROI in each. 
-0002da70: 2020 2020 2020 2020 2020 2064 6972 6563             direc
-0002da80: 7469 6f6e 2e0a 0a20 2020 2020 2020 2073  tion...        s
-0002da90: 6c69 6365 5f74 6869 636b 6e65 7373 203a  lice_thickness :
-0002daa0: 2066 6c6f 6174 2c20 6465 6661 756c 743d   float, default=
-0002dab0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0002dac0: 2056 6f78 656c 2073 697a 6520 696e 206d   Voxel size in m
-0002dad0: 6d20 696e 2074 6865 2064 756d 6d79 2069  m in the dummy i
-0002dae0: 6d61 6765 2069 6e20 7468 6520 7a20 6469  mage in the z di
-0002daf0: 7265 6374 696f 6e2e 2020 4966 204e 6f6e  rection.  If Non
-0002db00: 652c 0a20 2020 2020 2020 2020 2020 2074  e,.            t
-0002db10: 6865 2076 616c 7565 2075 7365 6420 6973  he value used is
-0002db20: 2074 6865 206d 696e 696d 756d 2064 6973   the minimum dis
-0002db30: 7461 6e63 6520 6265 7477 6565 6e20 736c  tance between sl
-0002db40: 6963 6520 706f 7369 7469 6f6e 730a 2020  ice positions.  
-0002db50: 2020 2020 2020 2020 2020 696e 2074 6865            in the
-0002db60: 2078 2d79 2063 6f6e 746f 7572 7320 6469   x-y contours di
-0002db70: 6374 696f 6e61 7279 2e0a 2020 2020 2020  ctionary..      
-0002db80: 2020 2222 220a 0a20 2020 2020 2020 2065    """..        e
-0002db90: 7874 656e 7473 203d 205b 7365 6c66 2e67  xtents = [self.g
-0002dba0: 6574 5f65 7874 656e 7428 6178 3d61 7829  et_extent(ax=ax)
-0002dbb0: 2066 6f72 2061 7820 696e 2073 6b72 742e   for ax in skrt.
-0002dbc0: 696d 6167 652e 5f61 7865 735d 0a20 2020  image._axes].   
-0002dbd0: 2020 2020 2073 6c69 6365 5f74 6869 636b       slice_thick
-0002dbe0: 6e65 7373 203d 206b 7761 7267 732e 706f  ness = kwargs.po
-0002dbf0: 7028 2273 6c69 6365 5f74 6869 636b 6e65  p("slice_thickne
-0002dc00: 7373 222c 204e 6f6e 6529 0a20 2020 2020  ss", None).     
-0002dc10: 2020 2073 6c69 6365 5f74 6869 636b 6e65     slice_thickne
-0002dc20: 7373 203d 2028 736c 6963 655f 7468 6963  ss = (slice_thic
-0002dc30: 6b6e 6573 7320 6f72 0a20 2020 2020 2020  kness or.       
-0002dc40: 2020 2020 2020 2020 2073 656c 662e 6765           self.ge
-0002dc50: 745f 736c 6963 655f 7468 6963 6b6e 6573  t_slice_thicknes
-0002dc60: 735f 636f 6e74 6f75 7273 2829 290a 2020  s_contours()).  
-0002dc70: 2020 2020 2020 7265 7475 726e 2063 7265        return cre
-0002dc80: 6174 655f 6475 6d6d 795f 696d 6167 6528  ate_dummy_image(
-0002dc90: 6578 7465 6e74 732c 2073 6c69 6365 5f74  extents, slice_t
-0002dca0: 6869 636b 6e65 7373 2c20 2a2a 6b77 6172  hickness, **kwar
-0002dcb0: 6773 290a 0a20 2020 2064 6566 2073 6574  gs)..    def set
-0002dcc0: 5f69 6d61 6765 5f74 6f5f 6475 6d6d 7928  _image_to_dummy(
-0002dcd0: 7365 6c66 2c20 2a2a 6b77 6172 6773 293a  self, **kwargs):
-0002dce0: 0a20 2020 2020 2020 2022 2222 4173 7369  .        """Assi
-0002dcf0: 676e 2073 656c 662e 696d 6167 6520 7072  gn self.image pr
-0002dd00: 6f70 6572 7479 2074 6f20 6120 6475 6d6d  operty to a dumm
-0002dd10: 7920 696d 6167 6520 636f 7665 7269 6e67  y image covering
-0002dd20: 2074 6865 2061 7265 6120 0a20 2020 2020   the area .     
-0002dd30: 2020 2073 7061 6e6e 6564 2062 7920 7468     spanned by th
-0002dd40: 6973 2052 4f49 2e20 5468 6520 524f 4927  is ROI. The ROI'
-0002dd50: 7320 6d61 736b 2061 6e64 2078 2d7a 2f79  s mask and x-z/y
-0002dd60: 2d7a 2063 6f6e 746f 7572 7320 7769 6c6c  -z contours will
-0002dd70: 2062 6520 0a20 2020 2020 2020 2063 6c65   be .        cle
-0002dd80: 6172 6564 2073 6f20 7468 6174 2074 6865  ared so that the
-0002dd90: 7920 7769 6c6c 2062 6520 7265 6372 6561  y will be recrea
-0002dda0: 7465 6420 7768 656e 2067 6574 5f6d 6173  ted when get_mas
-0002ddb0: 6b28 2920 6f72 2067 6574 5f63 6f6e 746f  k() or get_conto
-0002ddc0: 7572 7328 290a 2020 2020 2020 2020 6172  urs().        ar
-0002ddd0: 6520 6e65 7874 2063 616c 6c65 642e 0a0a  e next called...
-0002dde0: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
-0002ddf0: 7465 7273 3a2a 2a0a 2020 2020 2020 2020  ters:**.        
-0002de00: 0a20 2020 2020 2020 206b 7761 7267 7320  .        kwargs 
-0002de10: 3a20 0a20 2020 2020 2020 2020 2020 204b  : .            K
-0002de20: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
-0002de30: 2074 6f20 7061 7373 2074 6f20 7365 6c66   to pass to self
-0002de40: 2e67 6574 5f64 756d 6d79 5f69 6d61 6765  .get_dummy_image
-0002de50: 2829 2077 6865 6e20 6372 6561 7469 6e67  () when creating
-0002de60: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-0002de70: 2064 756d 6d79 2069 6d61 6765 2e20 5365   dummy image. Se
-0002de80: 6520 646f 6375 6d65 6e74 6174 696f 6e20  e documentation 
-0002de90: 6f66 2052 4f49 2e67 6574 5f64 756d 6d79  of ROI.get_dummy
-0002dea0: 5f69 6d61 6765 2829 2e0a 2020 2020 2020  _image()..      
-0002deb0: 2020 2222 220a 0a20 2020 2020 2020 2023    """..        #
-0002dec0: 204d 616b 6520 696d 6167 650a 2020 2020   Make image.    
-0002ded0: 2020 2020 696d 203d 2073 656c 662e 6765      im = self.ge
-0002dee0: 745f 6475 6d6d 795f 696d 6167 6528 2a2a  t_dummy_image(**
-0002def0: 6b77 6172 6773 290a 0a20 2020 2020 2020  kwargs)..       
-0002df00: 2023 2043 6c65 6172 206d 6173 6b20 616e   # Clear mask an
-0002df10: 6420 636f 6e74 6f75 7273 0a20 2020 2020  d contours.     
-0002df20: 2020 2073 656c 662e 696e 7075 745f 636f     self.input_co
-0002df30: 6e74 6f75 7273 203d 2073 656c 662e 636f  ntours = self.co
-0002df40: 6e74 6f75 7273 5b22 782d 7922 5d0a 2020  ntours["x-y"].  
-0002df50: 2020 2020 2020 7365 6c66 2e63 6f6e 746f        self.conto
-0002df60: 7572 7320 3d20 7b22 782d 7922 3a20 7365  urs = {"x-y": se
-0002df70: 6c66 2e69 6e70 7574 5f63 6f6e 746f 7572  lf.input_contour
-0002df80: 737d 0a20 2020 2020 2020 2073 656c 662e  s}.        self.
-0002df90: 6c6f 6164 6564 5f6d 6173 6b20 3d20 4661  loaded_mask = Fa
-0002dfa0: 6c73 650a 2020 2020 2020 2020 7365 6c66  lse.        self
-0002dfb0: 2e6d 6173 6b20 3d20 4e6f 6e65 0a0a 2020  .mask = None..  
-0002dfc0: 2020 2020 2020 2320 4173 7369 676e 2069        # Assign i
-0002dfd0: 6d61 6765 0a20 2020 2020 2020 2073 656c  mage.        sel
-0002dfe0: 662e 7365 745f 696d 6167 6528 696d 290a  f.set_image(im).
-0002dff0: 0a20 2020 2064 6566 2073 6574 5f69 6d61  .    def set_ima
-0002e000: 6765 2873 656c 662c 2069 6d29 3a0a 2020  ge(self, im):.  
-0002e010: 2020 2020 2020 2222 2253 6574 2073 656c        """Set sel
-0002e020: 662e 696d 6167 6520 746f 2061 2067 6976  f.image to a giv
-0002e030: 656e 2069 6d61 6765 2061 6e64 2061 646a  en image and adj
-0002e040: 7573 7420 6765 6f6d 6574 7269 6320 7072  ust geometric pr
-0002e050: 6f70 6572 7469 6573 0a20 2020 2020 2020  operties.       
-0002e060: 2061 6363 6f72 6469 6e67 6c79 2e20 4e6f   accordingly. No
-0002e070: 7465 2074 6861 7420 7365 6c66 2e6d 6173  te that self.mas
-0002e080: 6b20 7769 6c6c 2062 6520 7265 6d6f 7665  k will be remove
-0002e090: 6420 6966 2074 6865 2063 7572 7265 6e74  d if the current
-0002e0a0: 206d 6173 6b27 7320 0a20 2020 2020 2020   mask's .       
-0002e0b0: 2073 6861 7065 2064 6f65 736e 2774 206d   shape doesn't m
-0002e0c0: 6174 6368 2074 6865 2069 6d61 6765 2e20  atch the image. 
-0002e0d0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0002e0e0: 2020 2020 2020 7365 6c66 2e6c 6f61 6428        self.load(
-0002e0f0: 290a 2020 2020 2020 2020 7365 6c66 2e69  ).        self.i
-0002e100: 6d61 6765 203d 2069 6d0a 2020 2020 2020  mage = im.      
-0002e110: 2020 7365 6c66 2e63 6f6e 746f 7572 735f    self.contours_
-0002e120: 6f6e 6c79 203d 2046 616c 7365 0a20 2020  only = False.   
-0002e130: 2020 2020 2069 6620 696d 2069 7320 4e6f       if im is No
-0002e140: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0002e150: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
-0002e160: 2320 5365 7420 524f 4920 766f 7865 6c20  # Set ROI voxel 
-0002e170: 7369 7a65 2074 6f20 7468 6174 206f 6620  size to that of 
-0002e180: 6e65 7720 696d 6167 652e 0a20 2020 2020  new image..     
-0002e190: 2020 2023 2049 7420 7769 6c6c 2062 6520     # It will be 
-0002e1a0: 6e65 6564 6564 2074 6f20 6465 6669 6e65  needed to define
-0002e1b0: 2073 6c69 6365 2074 6869 636b 6e65 7373   slice thickness
-0002e1c0: 0a20 2020 2020 2020 2023 2069 6e20 7468  .        # in th
-0002e1d0: 6520 6361 7365 206f 6620 616e 2052 4f49  e case of an ROI
-0002e1e0: 2077 6974 6820 636f 6e74 6f75 7228 7329   with contour(s)
-0002e1f0: 2061 7420 6120 7369 6e67 6c65 207a 2d70   at a single z-p
-0002e200: 6f73 6974 696f 6e2e 0a20 2020 2020 2020  osition..       
-0002e210: 2073 656c 662e 766f 7865 6c5f 7369 7a65   self.voxel_size
-0002e220: 203d 2069 6d2e 6765 745f 766f 7865 6c5f   = im.get_voxel_
-0002e230: 7369 7a65 2829 0a0a 2020 2020 2020 2020  size()..        
-0002e240: 2320 4966 2074 6865 207a 2d64 6973 7461  # If the z-dista
-0002e250: 6e63 6520 6265 7477 6565 6e20 636f 6e74  nce between cont
-0002e260: 6f75 7273 2069 7320 6772 6561 7465 7220  ours is greater 
-0002e270: 7468 616e 2074 6865 2076 6f78 656c 0a20  than the voxel. 
-0002e280: 2020 2020 2020 2023 207a 2d64 696d 656e         # z-dimen
-0002e290: 7369 6f6e 2066 6f72 2074 6865 206e 6577  sion for the new
-0002e2a0: 2069 6d61 6765 2c20 6669 7273 7420 656e   image, first en
-0002e2b0: 7375 7265 2074 6861 7420 7468 6520 524f  sure that the RO
-0002e2c0: 490a 2020 2020 2020 2020 2320 6d61 736b  I.        # mask
-0002e2d0: 2069 7320 6372 6561 7465 6420 7769 7468   is created with
-0002e2e0: 2074 6865 2069 6e74 6572 2d63 6f6e 746f   the inter-conto
-0002e2f0: 7572 207a 2d64 6973 7461 6e63 652c 2074  ur z-distance, t
-0002e300: 6865 6e20 7265 7369 7a65 0a20 2020 2020  hen resize.     
-0002e310: 2020 2023 2074 6f20 7468 6520 696d 6167     # to the imag
-0002e320: 6520 766f 7865 6c20 7369 7a65 2e0a 2020  e voxel size..  
-0002e330: 2020 2020 2020 6966 2073 656c 662e 6765        if self.ge
-0002e340: 745f 736c 6963 655f 7468 6963 6b6e 6573  t_slice_thicknes
-0002e350: 735f 636f 6e74 6f75 7273 2829 203e 2073  s_contours() > s
-0002e360: 656c 662e 696d 6167 652e 6765 745f 766f  elf.image.get_vo
-0002e370: 7865 6c5f 7369 7a65 2829 5b32 5d3a 0a20  xel_size()[2]:. 
-0002e380: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0002e390: 7420 2873 656c 662e 6d61 736b 2061 6e64  t (self.mask and
-0002e3a0: 2028 7365 6c66 2e76 6f78 656c 5f73 697a   (self.voxel_siz
-0002e3b0: 6520 3d3d 2073 656c 662e 6d61 736b 2e76  e == self.mask.v
-0002e3c0: 6f78 656c 5f73 697a 6529 293a 0a20 2020  oxel_size)):.   
-0002e3d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0002e3e0: 662e 6372 6561 7465 5f6d 6173 6b28 766f  f.create_mask(vo
-0002e3f0: 7865 6c5f 7369 7a65 3d73 656c 662e 766f  xel_size=self.vo
-0002e400: 7865 6c5f 7369 7a65 5b30 3a32 5d2c 2066  xel_size[0:2], f
-0002e410: 6f72 6365 3d54 7275 6529 0a20 2020 2020  orce=True).     
-0002e420: 2020 2020 2020 2020 2020 2023 2054 6865             # The
-0002e430: 206d 6173 6b20 6372 6561 7469 6f6e 2077   mask creation w
-0002e440: 696c 6c20 6861 7665 2072 6564 6566 696e  ill have redefin
-0002e450: 6564 2074 6865 2069 6d61 6765 2061 7373  ed the image ass
-0002e460: 6f63 6961 7469 6f6e 2c0a 2020 2020 2020  ociation,.      
-0002e470: 2020 2020 2020 2020 2020 2320 736f 2072            # so r
-0002e480: 6561 7373 6967 6e20 7468 6520 6e65 7720  eassign the new 
-0002e490: 696d 6167 652e 0a20 2020 2020 2020 2020  image..         
-0002e4a0: 2020 2020 2020 2073 656c 662e 696d 6167         self.imag
-0002e4b0: 6520 3d20 696d 0a20 2020 2020 2020 2020  e = im.         
-0002e4c0: 2020 2073 656c 662e 6d61 736b 2e6d 6174     self.mask.mat
-0002e4d0: 6368 5f73 697a 6528 7365 6c66 2e69 6d61  ch_size(self.ima
-0002e4e0: 6765 2c20 6d65 7468 6f64 3d22 6e65 6172  ge, method="near
-0002e4f0: 6573 7422 290a 2020 2020 2020 2020 2020  est").          
-0002e500: 2020 6966 2068 6173 6174 7472 2873 656c    if hasattr(sel
-0002e510: 662e 6d61 736b 2c20 2264 6174 6122 293a  f.mask, "data"):
-0002e520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002e530: 2069 6620 6e6f 7420 7365 6c66 2e6d 6173   if not self.mas
-0002e540: 6b2e 6461 7461 2e64 7479 7065 203d 3d20  k.data.dtype == 
-0002e550: 626f 6f6c 3a0a 2020 2020 2020 2020 2020  bool:.          
-0002e560: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-0002e570: 6173 6b2e 6461 7461 203d 2073 656c 662e  ask.data = self.
-0002e580: 6d61 736b 2e64 6174 612e 6173 7479 7065  mask.data.astype
-0002e590: 2862 6f6f 6c29 0a0a 2020 2020 2020 2020  (bool)..        
-0002e5a0: 2320 4966 2061 206d 6173 6b20 6861 7320  # If a mask has 
-0002e5b0: 6265 656e 206c 6f61 6465 642c 2062 7574  been loaded, but
-0002e5c0: 2064 6f65 736e 2774 206d 6174 6368 2074   doesn't match t
-0002e5d0: 6865 2069 6d61 6765 2067 656f 6d65 7472  he image geometr
-0002e5e0: 792c 0a20 2020 2020 2020 2023 2064 656c  y,.        # del
-0002e5f0: 6574 6520 7468 6520 6d61 736b 2064 6174  ete the mask dat
-0002e600: 612e 2020 2854 6869 7320 7368 6f75 6c64  a.  (This should
-0002e610: 206d 6561 6e20 7468 6174 2074 6865 207a   mean that the z
-0002e620: 2d64 6973 7461 6e63 650a 2020 2020 2020  -distance.      
-0002e630: 2020 2320 6265 7477 6565 6e20 636f 6e74    # between cont
-0002e640: 6f75 7273 2069 7320 6c65 7373 2074 6861  ours is less tha
-0002e650: 7420 7468 6520 766f 7865 6c20 7a2d 6469  t the voxel z-di
-0002e660: 6d65 6e73 696f 6e20 666f 7220 7468 650a  mension for the.
-0002e670: 2020 2020 2020 2020 2320 6e65 7720 696d          # new im
-0002e680: 6167 652e 2920 2041 206e 6577 206d 6173  age.)  A new mas
-0002e690: 6b20 7769 6c6c 2062 6520 6372 6561 7465  k will be create
-0002e6a0: 6420 6174 2074 6865 206e 6578 7420 6361  d at the next ca
-0002e6b0: 6c6c 0a20 2020 2020 2020 2023 2074 6f20  ll.        # to 
-0002e6c0: 6163 6365 7373 2074 6865 206d 6173 6b20  access the mask 
-0002e6d0: 6461 7461 2e0a 2020 2020 2020 2020 6966  data..        if
-0002e6e0: 2073 656c 662e 6d61 736b 2061 6e64 206e   self.mask and n
-0002e6f0: 6f74 2069 6d2e 6861 735f 7361 6d65 5f67  ot im.has_same_g
-0002e700: 656f 6d65 7472 7928 7365 6c66 2e6d 6173  eometry(self.mas
-0002e710: 6b29 3a0a 2020 2020 2020 2020 2020 2020  k):.            
-0002e720: 6966 2067 6574 6174 7472 2873 656c 662c  if getattr(self,
-0002e730: 2022 696e 7075 745f 636f 6e74 6f75 7273   "input_contours
-0002e740: 222c 204e 6f6e 6529 2069 7320 4e6f 6e65  ", None) is None
-0002e750: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002e760: 2020 7365 6c66 2e69 6e70 7574 5f63 6f6e    self.input_con
-0002e770: 746f 7572 7320 3d20 7365 6c66 2e67 6574  tours = self.get
-0002e780: 5f63 6f6e 746f 7572 7328 2278 2d79 2229  _contours("x-y")
-0002e790: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0002e7a0: 662e 6d61 736b 203d 204e 6f6e 650a 2020  f.mask = None.  
-0002e7b0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-0002e7c0: 6f61 6465 645f 6d61 736b 203d 2046 616c  oaded_mask = Fal
-0002e7d0: 7365 0a0a 2020 2020 2020 2020 2320 5365  se..        # Se
-0002e7e0: 7420 6765 6f65 6d74 7269 6320 696e 666f  t geoemtric info
-0002e7f0: 0a20 2020 2020 2020 2064 6174 615f 7368  .        data_sh
-0002e800: 6170 6520 3d20 696d 2e67 6574 5f64 6174  ape = im.get_dat
-0002e810: 6128 292e 7368 6170 650a 2020 2020 2020  a().shape.      
-0002e820: 2020 7365 6c66 2e73 6861 7065 203d 205b    self.shape = [
-0002e830: 6461 7461 5f73 6861 7065 5b31 5d2c 2064  data_shape[1], d
-0002e840: 6174 615f 7368 6170 655b 305d 2c20 6461  ata_shape[0], da
-0002e850: 7461 5f73 6861 7065 5b32 5d5d 0a20 2020  ta_shape[2]].   
-0002e860: 2020 2020 2073 656c 662e 766f 7865 6c5f       self.voxel_
-0002e870: 7369 7a65 203d 2069 6d2e 6765 745f 766f  size = im.get_vo
-0002e880: 7865 6c5f 7369 7a65 2829 0a20 2020 2020  xel_size().     
-0002e890: 2020 2073 656c 662e 6f72 6967 696e 203d     self.origin =
-0002e8a0: 2069 6d2e 6765 745f 6f72 6967 696e 2829   im.get_origin()
-0002e8b0: 0a20 2020 2020 2020 2073 656c 662e 6166  .        self.af
-0002e8c0: 6669 6e65 203d 2069 6d2e 6765 745f 6166  fine = im.get_af
-0002e8d0: 6669 6e65 2829 0a0a 2020 2020 6465 6620  fine()..    def 
-0002e8e0: 7669 6577 2873 656c 662c 2069 6e63 6c75  view(self, inclu
-0002e8f0: 6465 5f69 6d61 6765 3d46 616c 7365 2c20  de_image=False, 
-0002e900: 766f 7865 6c5f 7369 7a65 3d5b 312c 2031  voxel_size=[1, 1
-0002e910: 5d2c 2062 7566 6665 723d 352c 202a 2a6b  ], buffer=5, **k
-0002e920: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-0002e930: 2222 2256 6965 7720 7468 6520 524f 492e  """View the ROI.
-0002e940: 0a0a 2020 2020 2020 2020 2a2a 5061 7261  ..        **Para
-0002e950: 6d65 7465 7273 3a2a 2a0a 2020 2020 2020  meters:**.      
-0002e960: 2020 0a20 2020 2020 2020 2069 6e63 6c75    .        inclu
-0002e970: 6465 5f69 6d61 6765 203a 2062 6f6f 6c2c  de_image : bool,
-0002e980: 2064 6566 6175 6c74 3d54 7275 650a 2020   default=True.  
-0002e990: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-0002e9a0: 6520 616e 6420 7468 6973 2052 4f49 2068  e and this ROI h
-0002e9b0: 6173 2061 6e20 6173 736f 6369 6174 6564  as an associated
-0002e9c0: 2069 6d61 6765 2028 696e 2073 656c 662e   image (in self.
-0002e9d0: 696d 6167 6529 2c0a 2020 2020 2020 2020  image),.        
-0002e9e0: 2020 2020 7468 6520 696d 6167 6520 7769      the image wi
-0002e9f0: 6c6c 2062 6520 6469 7370 6c61 7965 6420  ll be displayed 
-0002ea00: 6265 6869 6e64 2074 6865 2052 4f49 2e0a  behind the ROI..
-0002ea10: 0a20 2020 2020 2020 2076 6f78 656c 5f73  .        voxel_s
-0002ea20: 697a 6520 3a20 6c69 7374 2c20 6465 6661  ize : list, defa
-0002ea30: 756c 743d 5b31 2c20 315d 0a20 2020 2020  ult=[1, 1].     
-0002ea40: 2020 2020 2020 2049 6620 7468 6520 524f         If the RO
-0002ea50: 4920 646f 6573 206e 6f74 2068 6176 6520  I does not have 
-0002ea60: 616e 2061 7373 6f63 6961 7465 6420 696d  an associated im
-0002ea70: 6167 6520 616e 6420 6973 2064 6573 6372  age and is descr
-0002ea80: 6962 6564 206f 6e6c 790a 2020 2020 2020  ibed only.      
-0002ea90: 2020 2020 2020 6279 2063 6f6e 746f 7572        by contour
-0002eaa0: 732c 2074 6869 7320 7769 6c6c 2062 6520  s, this will be 
-0002eab0: 7468 6520 766f 7865 6c20 7369 7a65 7320  the voxel sizes 
-0002eac0: 7573 6564 2069 6e20 7468 6520 782d 7920  used in the x-y 
-0002ead0: 6469 7265 6374 696f 6e0a 2020 2020 2020  direction.      
-0002eae0: 2020 2020 2020 7768 656e 2063 6f6e 7665        when conve
-0002eaf0: 7274 696e 6720 7468 6520 524f 4920 746f  rting the ROI to
-0002eb00: 2061 206d 6173 6b20 6966 2061 206d 6173   a mask if a mas
-0002eb10: 6b20 706c 6f74 2074 7970 6520 6973 2073  k plot type is s
-0002eb20: 656c 6563 7465 642e 0a0a 2020 2020 2020  elected...      
-0002eb30: 2020 6275 6666 6572 203a 2069 6e74 2c20    buffer : int, 
-0002eb40: 6465 6661 756c 743d 350a 2020 2020 2020  default=5.      
-0002eb50: 2020 2020 2020 4966 2074 6865 2052 4f49        If the ROI
-0002eb60: 2064 6f65 7320 6e6f 7420 6861 7665 2061   does not have a
-0002eb70: 6e20 6173 736f 6369 6174 6564 2069 6d61  n associated ima
-0002eb80: 6765 2061 6e64 2069 7320 6465 7363 7269  ge and is descri
-0002eb90: 6265 6420 6f6e 6c79 0a20 2020 2020 2020  bed only.       
-0002eba0: 2020 2020 2062 7920 636f 6e74 6f75 7273       by contours
-0002ebb0: 2c20 7468 6973 2077 696c 6c20 6265 2074  , this will be t
-0002ebc0: 6865 206e 756d 6265 7220 6f66 2062 7566  he number of buf
-0002ebd0: 6665 7220 766f 7865 6c73 200a 2020 2020  fer voxels .    
-0002ebe0: 2020 2020 2020 2020 2869 2e65 2e20 7768          (i.e. wh
-0002ebf0: 6974 6573 7061 6365 2920 6469 7370 6c61  itespace) displa
-0002ec00: 7965 6420 6172 6f75 6e64 2074 6865 2052  yed around the R
-0002ec10: 4f49 2e0a 2020 2020 2020 2020 2222 220a  OI..        """.
-0002ec20: 0a20 2020 2020 2020 2066 726f 6d20 736b  .        from sk
-0002ec30: 7274 2e62 6574 7465 725f 7669 6577 6572  rt.better_viewer
-0002ec40: 2069 6d70 6f72 7420 4265 7474 6572 5669   import BetterVi
-0002ec50: 6577 6572 0a20 2020 2020 2020 2073 656c  ewer.        sel
-0002ec60: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
-0002ec70: 200a 2020 2020 2020 2020 2320 5365 7420   .        # Set 
-0002ec80: 696e 6974 6961 6c20 7a6f 6f6d 2061 6d6f  initial zoom amo
-0002ec90: 756e 7420 616e 6420 6365 6e74 7265 0a20  unt and centre. 
-0002eca0: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
-0002ecb0: 6d61 6765 2069 7320 6e6f 7420 4e6f 6e65  mage is not None
-0002ecc0: 2061 6e64 206e 6f74 2073 656c 662e 636f   and not self.co
-0002ecd0: 6e74 6f75 7273 5f6f 6e6c 793a 0a20 2020  ntours_only:.   
-0002ece0: 2020 2020 2020 2020 2076 6965 7720 3d20           view = 
-0002ecf0: 6b77 6172 6773 2e67 6574 2822 696e 6974  kwargs.get("init
-0002ed00: 5f76 6965 7722 2c20 2278 2d79 2229 0a20  _view", "x-y"). 
-0002ed10: 2020 2020 2020 2020 2020 2061 7865 7320             axes 
-0002ed20: 3d20 736b 7274 2e69 6d61 6765 2e5f 706c  = skrt.image._pl
-0002ed30: 6f74 5f61 7865 735b 7669 6577 5d0a 2020  ot_axes[view].  
-0002ed40: 2020 2020 2020 2020 2020 6578 7465 6e74            extent
-0002ed50: 7320 3d20 5b73 656c 662e 6765 745f 6c65  s = [self.get_le
-0002ed60: 6e67 7468 2861 783d 6178 2920 666f 7220  ngth(ax=ax) for 
-0002ed70: 6178 2069 6e20 6178 6573 5d0a 2020 2020  ax in axes].    
-0002ed80: 2020 2020 2020 2020 696d 5f6c 696d 7320          im_lims 
-0002ed90: 3d20 5b73 656c 662e 696d 6167 652e 6765  = [self.image.ge
-0002eda0: 745f 6c65 6e67 7468 2861 783d 6178 2920  t_length(ax=ax) 
-0002edb0: 666f 7220 6178 2069 6e20 6178 6573 5d0a  for ax in axes].
-0002edc0: 2020 2020 2020 2020 2020 2020 7a6f 6f6d              zoom
-0002edd0: 203d 206d 696e 285b 696d 5f6c 696d 735b   = min([im_lims[
-0002ede0: 695d 202f 2065 7874 656e 7473 5b69 5d20  i] / extents[i] 
-0002edf0: 666f 7220 6920 696e 2072 616e 6765 2832  for i in range(2
-0002ee00: 295d 2920 2a20 302e 380a 2020 2020 2020  )]) * 0.8.      
-0002ee10: 2020 2020 2020 7a6f 6f6d 5f63 656e 7472        zoom_centr
-0002ee20: 6520 3d20 7365 6c66 2e67 6574 5f63 656e  e = self.get_cen
-0002ee30: 7472 6528 290a 2020 2020 2020 2020 2020  tre().          
-0002ee40: 2020 6966 207a 6f6f 6d20 3e20 313a 0a20    if zoom > 1:. 
-0002ee50: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-0002ee60: 7761 7267 732e 7365 7464 6566 6175 6c74  wargs.setdefault
-0002ee70: 2822 7a6f 6f6d 222c 207a 6f6f 6d29 0a20  ("zoom", zoom). 
-0002ee80: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-0002ee90: 7761 7267 732e 7365 7464 6566 6175 6c74  wargs.setdefault
-0002eea0: 2822 7a6f 6f6d 5f63 656e 7472 6522 2c20  ("zoom_centre", 
-0002eeb0: 7a6f 6f6d 5f63 656e 7472 6529 0a20 2020  zoom_centre).   
-0002eec0: 2020 2020 2020 2020 2069 6620 2269 6e69           if "ini
-0002eed0: 745f 706f 7322 206e 6f74 2069 6e20 6b77  t_pos" not in kw
-0002eee0: 6172 6773 2061 6e64 2022 696e 6974 5f73  args and "init_s
-0002eef0: 6c69 6365 2220 6e6f 7420 696e 206b 7761  lice" not in kwa
-0002ef00: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-0002ef10: 2020 2020 206b 7761 7267 735b 2269 6e69       kwargs["ini
-0002ef20: 745f 706f 7322 5d20 3d20 5c0a 2020 2020  t_pos"] = \.    
-0002ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ef40: 2020 2020 7365 6c66 2e67 6574 5f63 656e      self.get_cen
-0002ef50: 7472 6528 295b 736b 7274 2e69 6d61 6765  tre()[skrt.image
-0002ef60: 2e5f 736c 6963 655f 6178 6573 5b76 6965  ._slice_axes[vie
-0002ef70: 775d 5d0a 0a20 2020 2020 2020 206b 7761  w]]..        kwa
-0002ef80: 7267 735b 2273 686f 7722 5d20 3d20 4661  rgs["show"] = Fa
-0002ef90: 6c73 650a 2020 2020 2020 2020 6966 2022  lse.        if "
-0002efa0: 706c 6f74 5f74 7970 6522 2069 6e20 6b77  plot_type" in kw
-0002efb0: 6172 6773 3a0a 2020 2020 2020 2020 2020  args:.          
-0002efc0: 2020 6b77 6172 6773 5b22 726f 695f 706c    kwargs["roi_pl
-0002efd0: 6f74 5f74 7970 6522 5d20 3d20 6b77 6172  ot_type"] = kwar
-0002efe0: 6773 2e70 6f70 2822 706c 6f74 5f74 7970  gs.pop("plot_typ
-0002eff0: 6522 290a 0a20 2020 2020 2020 2023 2056  e")..        # V
-0002f000: 6965 7720 7769 7468 2069 6d61 6765 0a20  iew with image. 
-0002f010: 2020 2020 2020 2069 6620 696e 636c 7564         if includ
-0002f020: 655f 696d 6167 6520 616e 6420 7365 6c66  e_image and self
-0002f030: 2e69 6d61 6765 2069 7320 6e6f 7420 4e6f  .image is not No
-0002f040: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0002f050: 6276 203d 2042 6574 7465 7256 6965 7765  bv = BetterViewe
-0002f060: 7228 7365 6c66 2e69 6d61 6765 2c20 726f  r(self.image, ro
-0002f070: 6973 3d73 656c 662c 202a 2a6b 7761 7267  is=self, **kwarg
-0002f080: 7329 0a0a 2020 2020 2020 2020 2320 5669  s)..        # Vi
-0002f090: 6577 2077 6974 686f 7574 2069 6d61 6765  ew without image
-0002f0a0: 0a20 2020 2020 2020 2065 6c73 653a 0a0a  .        else:..
-0002f0b0: 2020 2020 2020 2020 2020 2020 2320 4d61              # Ma
-0002f0c0: 6b65 2064 756d 6d79 2069 6d61 6765 2066  ke dummy image f
-0002f0d0: 6f72 2062 6163 6b67 726f 756e 640a 2020  or background.  
-0002f0e0: 2020 2020 2020 2020 2020 726f 695f 746d            roi_tm
-0002f0f0: 7020 3d20 7365 6c66 2e63 6c6f 6e65 2863  p = self.clone(c
-0002f100: 6f70 795f 6461 7461 3d46 616c 7365 290a  opy_data=False).
-0002f110: 2020 2020 2020 2020 2020 2020 696d 203d              im =
-0002f120: 2073 656c 662e 6765 745f 6475 6d6d 795f   self.get_dummy_
-0002f130: 696d 6167 6528 0a20 2020 2020 2020 2020  image(.         
-0002f140: 2020 2020 2020 2076 6f78 656c 5f73 697a         voxel_siz
-0002f150: 653d 766f 7865 6c5f 7369 7a65 2c0a 2020  e=voxel_size,.  
-0002f160: 2020 2020 2020 2020 2020 2020 2020 6275                bu
-0002f170: 6666 6572 3d62 7566 6665 720a 2020 2020  ffer=buffer.    
-0002f180: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0002f190: 2020 2020 2020 696d 2e74 6974 6c65 203d        im.title =
-0002f1a0: 2073 656c 662e 6e61 6d65 0a20 2020 2020   self.name.     
-0002f1b0: 2020 2020 2020 2072 6f69 5f74 6d70 2e73         roi_tmp.s
-0002f1c0: 6574 5f69 6d61 6765 2869 6d29 0a0a 2020  et_image(im)..  
-0002f1d0: 2020 2020 2020 2020 2020 2222 220a 2020            """.  
-0002f1e0: 2020 2020 2020 2020 2020 726f 695f 746d            roi_tm
-0002f1f0: 7020 3d20 7365 6c66 0a0a 2020 2020 2020  p = self..      
-0002f200: 2020 2020 2020 2320 4d61 6b65 2064 756d        # Make dum
-0002f210: 6d79 2069 6d61 6765 2066 6f72 2062 6163  my image for bac
-0002f220: 6b67 726f 756e 640a 2020 2020 2020 2020  kground.        
-0002f230: 2020 2020 6966 2073 656c 662e 636f 6e74      if self.cont
-0002f240: 6f75 7273 5f6f 6e6c 793a 0a20 2020 2020  ours_only:.     
-0002f250: 2020 2020 2020 2020 2020 2069 6d20 3d20             im = 
-0002f260: 7365 6c66 2e67 6574 5f64 756d 6d79 5f69  self.get_dummy_i
-0002f270: 6d61 6765 280a 2020 2020 2020 2020 2020  mage(.          
-0002f280: 2020 2020 2020 2020 2020 766f 7865 6c5f            voxel_
-0002f290: 7369 7a65 3d76 6f78 656c 5f73 697a 652c  size=voxel_size,
-0002f2a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f2b0: 2020 2020 2062 7566 6665 723d 6275 6666       buffer=buff
-0002f2c0: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
-0002f2d0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0002f2e0: 2020 2020 2069 6d2e 7469 746c 6520 3d20       im.title = 
-0002f2f0: 7365 6c66 2e6e 616d 650a 2020 2020 2020  self.name.      
-0002f300: 2020 2020 2020 2020 2020 726f 695f 746d            roi_tm
-0002f310: 7020 3d20 7365 6c66 2e63 6c6f 6e65 2863  p = self.clone(c
-0002f320: 6f70 795f 6461 7461 3d46 616c 7365 290a  opy_data=False).
+0002a460: 2020 2020 2020 206e 616d 6520 2b3d 2022         name += "
+0002a470: 2028 6d6d 5e33 2922 0a20 2020 2020 2020   (mm^3)".       
+0002a480: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0002a490: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002a4a0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+0002a4b0: 2b3d 2022 2028 2220 2b20 766f 6c5f 756e  += " (" + vol_un
+0002a4c0: 6974 7320 2b20 2229 220a 2020 2020 2020  its + ")".      
+0002a4d0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+0002a4e0: 6574 7269 6320 3d3d 2022 6172 6561 5f64  etric == "area_d
+0002a4f0: 6966 6622 3a0a 2020 2020 2020 2020 2020  iff":.          
+0002a500: 2020 2020 2020 2020 2020 6966 2061 7265            if are
+0002a510: 615f 756e 6974 7320 3d3d 2022 6d6d 223a  a_units == "mm":
+0002a520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a530: 2020 2020 2020 2020 206e 616d 6520 2b3d           name +=
+0002a540: 2022 2028 6d6d 5e32 2922 0a20 2020 2020   " (mm^2)".     
+0002a550: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0002a560: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0002a570: 2020 2020 2020 2020 2020 2020 206e 616d               nam
+0002a580: 6520 2b3d 2022 2028 2220 2b20 6172 6561  e += " (" + area
+0002a590: 5f75 6e69 7473 202b 2022 2922 0a20 2020  _units + ")".   
+0002a5a0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+0002a5b0: 6620 2263 656e 7472 6f69 6422 2069 6e20  f "centroid" in 
+0002a5c0: 6d65 7472 6963 3a0a 2020 2020 2020 2020  metric:.        
+0002a5d0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0002a5e0: 202b 3d20 2220 2822 202b 2063 656e 7472   += " (" + centr
+0002a5f0: 6f69 645f 756e 6974 7320 2b20 2229 220a  oid_units + ")".
+0002a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a610: 636f 6d70 5f6e 616d 6564 5b6e 616d 655d  comp_named[name]
+0002a620: 203d 2076 616c 0a0a 2020 2020 2020 2020   = val..        
+0002a630: 2320 4164 6a75 7374 206e 756d 6265 7220  # Adjust number 
+0002a640: 6f66 2064 6563 696d 616c 2070 6c61 6365  of decimal place
+0002a650: 730a 2020 2020 2020 2020 6966 2064 6563  s.        if dec
+0002a660: 696d 616c 5f70 6c61 6365 7320 6973 206e  imal_places is n
+0002a670: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0002a680: 2020 2020 2066 6f72 206d 6574 7269 632c       for metric,
+0002a690: 2076 616c 2069 6e20 636f 6d70 5f6e 616d   val in comp_nam
+0002a6a0: 6564 2e69 7465 6d73 2829 3a0a 2020 2020  ed.items():.    
+0002a6b0: 2020 2020 2020 2020 2020 2020 666d 7420              fmt 
+0002a6c0: 3d20 6622 7b7b 7661 6c3a 2e7b 6465 6369  = f"{{val:.{deci
+0002a6d0: 6d61 6c5f 706c 6163 6573 7d66 7d7d 220a  mal_places}f}}".
+0002a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a6f0: 6966 2063 6f6d 705f 6e61 6d65 645b 6d65  if comp_named[me
+0002a700: 7472 6963 5d20 6973 206e 6f74 204e 6f6e  tric] is not Non
+0002a710: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002a720: 2020 2020 2020 2063 6f6d 705f 6e61 6d65         comp_name
+0002a730: 645b 6d65 7472 6963 5d20 3d20 666c 6f61  d[metric] = floa
+0002a740: 7428 666d 742e 666f 726d 6174 2876 616c  t(fmt.format(val
+0002a750: 3d76 616c 2929 0a0a 2020 2020 2020 2020  =val))..        
+0002a760: 2320 436f 6e76 6572 7420 746f 2070 616e  # Convert to pan
+0002a770: 6461 7320 4461 7461 4672 616d 650a 2020  das DataFrame.  
+0002a780: 2020 2020 2020 6466 203d 2070 642e 4461        df = pd.Da
+0002a790: 7461 4672 616d 6528 636f 6d70 5f6e 616d  taFrame(comp_nam
+0002a7a0: 6564 2c20 696e 6465 783d 5b72 6f69 302e  ed, index=[roi0.
+0002a7b0: 6e61 6d65 5d29 0a0a 2020 2020 2020 2020  name])..        
+0002a7c0: 2320 4361 7069 7461 6c69 7a65 2063 6f6c  # Capitalize col
+0002a7d0: 756d 6e20 6e61 6d65 7320 616e 6420 7265  umn names and re
+0002a7e0: 6d6f 7665 2075 6e64 6572 7363 6f72 6573  move underscores
+0002a7f0: 2069 6620 7265 7175 6573 7465 640a 2020   if requested.  
+0002a800: 2020 2020 2020 6966 206e 6963 655f 636f        if nice_co
+0002a810: 6c75 6d6e 7320 616e 6420 6e6f 7420 676c  lumns and not gl
+0002a820: 6f62 616c 5f76 735f 736c 6963 655f 6865  obal_vs_slice_he
+0002a830: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
+0002a840: 2020 6466 2e63 6f6c 756d 6e73 203d 205b    df.columns = [
+0002a850: 636f 6c2e 6361 7069 7461 6c69 7a65 2829  col.capitalize()
+0002a860: 2e72 6570 6c61 6365 2822 5f22 2c20 2220  .replace("_", " 
+0002a870: 2229 2e72 6570 6c61 6365 2822 726d 7322  ").replace("rms"
+0002a880: 2c20 2252 4d53 2229 0a20 2020 2020 2020  , "RMS").       
+0002a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a8a0: 2020 2066 6f72 2063 6f6c 2069 6e20 6466     for col in df
+0002a8b0: 2e63 6f6c 756d 6e73 5d0a 0a20 2020 2020  .columns]..     
+0002a8c0: 2020 2023 2054 7572 6e20 6e61 6d65 2069     # Turn name i
+0002a8d0: 6e74 6f20 6120 7265 6775 6c61 7220 636f  nto a regular co
+0002a8e0: 6c75 6d6e 2069 6620 7265 7175 6573 7465  lumn if requeste
+0002a8f0: 640a 2020 2020 2020 2020 6966 206e 6f74  d.        if not
+0002a900: 206e 616d 655f 6173 5f69 6e64 6578 3a0a   name_as_index:.
+0002a910: 2020 2020 2020 2020 2020 2020 6466 203d              df =
+0002a920: 2064 662e 7265 7365 745f 696e 6465 7828   df.reset_index(
+0002a930: 292e 7265 6e61 6d65 287b 2269 6e64 6578  ).rename({"index
+0002a940: 223a 2022 524f 4922 7d2c 2061 7869 733d  ": "ROI"}, axis=
+0002a950: 3129 0a0a 2020 2020 2020 2020 2320 4164  1)..        # Ad
+0002a960: 6420 676c 6f62 616c 2f73 6c69 6365 2068  d global/slice h
+0002a970: 6561 6465 7273 0a20 2020 2020 2020 2069  eaders.        i
+0002a980: 6620 676c 6f62 616c 5f76 735f 736c 6963  f global_vs_slic
+0002a990: 655f 6865 6164 6572 3a0a 0a20 2020 2020  e_header:..     
+0002a9a0: 2020 2020 2020 2023 2053 6f72 7420 636f         # Sort co
+0002a9b0: 6c75 6d6e 7320 696e 746f 2067 6c6f 6261  lumns into globa
+0002a9c0: 6c20 6f72 2073 6c69 6365 0a20 2020 2020  l or slice.     
+0002a9d0: 2020 2020 2020 2068 6561 6465 7273 203d         headers =
+0002a9e0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+0002a9f0: 736c 6963 655f 636f 6c73 203d 205b 5d0a  slice_cols = [].
+0002aa00: 2020 2020 2020 2020 2020 2020 676c 6f62              glob
+0002aa10: 616c 5f63 6f6c 7320 3d20 5b5d 0a20 2020  al_cols = [].   
+0002aa20: 2020 2020 2020 2020 2073 6c69 6365 5f6e           slice_n
+0002aa30: 616d 6520 3d20 2273 6c69 6365 2220 6966  ame = "slice" if
+0002aa40: 206e 6f74 206e 6963 655f 636f 6c75 6d6e   not nice_column
+0002aa50: 7320 656c 7365 2022 536c 6963 6522 0a20  s else "Slice". 
+0002aa60: 2020 2020 2020 2020 2020 2067 6c6f 6261             globa
+0002aa70: 6c5f 6e61 6d65 203d 2022 676c 6f62 616c  l_name = "global
+0002aa80: 2220 6966 206e 6f74 206e 6963 655f 636f  " if not nice_co
+0002aa90: 6c75 6d6e 7320 656c 7365 2022 476c 6f62  lumns else "Glob
+0002aaa0: 616c 220a 2020 2020 2020 2020 2020 2020  al".            
+0002aab0: 666f 7220 6d65 7472 6963 2069 6e20 636f  for metric in co
+0002aac0: 6d70 5f6e 616d 6564 3a0a 2020 2020 2020  mp_named:.      
+0002aad0: 2020 2020 2020 2020 2020 6966 2022 736c            if "sl
+0002aae0: 6963 6522 2069 6e20 6d65 7472 6963 206f  ice" in metric o
+0002aaf0: 7220 5c0a 2020 2020 2020 2020 2020 2020  r \.            
+0002ab00: 2020 2020 2020 2028 2261 7265 6122 2069         ("area" i
+0002ab10: 6e20 6d65 7472 6963 2061 6e64 2022 666c  n metric and "fl
+0002ab20: 6174 2220 6e6f 7420 696e 206d 6574 7269  at" not in metri
+0002ab30: 6329 3a0a 2020 2020 2020 2020 2020 2020  c):.            
+0002ab40: 2020 2020 2020 2020 6865 6164 6572 732e          headers.
+0002ab50: 6170 7065 6e64 2828 736c 6963 655f 6e61  append((slice_na
+0002ab60: 6d65 2c20 6d65 7472 6963 2929 0a20 2020  me, metric)).   
+0002ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ab80: 2073 6c69 6365 5f63 6f6c 732e 6170 7065   slice_cols.appe
+0002ab90: 6e64 286d 6574 7269 6329 0a20 2020 2020  nd(metric).     
+0002aba0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0002abb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002abc0: 2020 2020 2068 6561 6465 7273 2e61 7070       headers.app
+0002abd0: 656e 6428 2867 6c6f 6261 6c5f 6e61 6d65  end((global_name
+0002abe0: 2c20 6d65 7472 6963 2929 0a20 2020 2020  , metric)).     
+0002abf0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0002ac00: 6c6f 6261 6c5f 636f 6c73 2e61 7070 656e  lobal_cols.appen
+0002ac10: 6428 6d65 7472 6963 290a 0a20 2020 2020  d(metric)..     
+0002ac20: 2020 2020 2020 2023 2052 656f 7264 6572         # Reorder
+0002ac30: 2063 6f6c 756d 6e73 0a20 2020 2020 2020   columns.       
+0002ac40: 2020 2020 2064 6673 5f6f 7264 6572 6564       dfs_ordered
+0002ac50: 203d 205b 6466 5b67 6c6f 6261 6c5f 636f   = [df[global_co
+0002ac60: 6c73 5d2c 2064 665b 736c 6963 655f 636f  ls], df[slice_co
+0002ac70: 6c73 5d5d 0a20 2020 2020 2020 2020 2020  ls]].           
+0002ac80: 2069 6620 6e6f 7420 6e61 6d65 5f61 735f   if not name_as_
+0002ac90: 696e 6465 783a 0a20 2020 2020 2020 2020  index:.         
+0002aca0: 2020 2020 2020 2064 6673 5f6f 7264 6572         dfs_order
+0002acb0: 6564 2e69 6e73 6572 7428 302c 2064 665b  ed.insert(0, df[
+0002acc0: 2252 4f49 225d 290a 2020 2020 2020 2020  "ROI"]).        
+0002acd0: 2020 2020 6466 203d 2070 642e 636f 6e63      df = pd.conc
+0002ace0: 6174 2864 6673 5f6f 7264 6572 6564 2c20  at(dfs_ordered, 
+0002acf0: 6178 6973 3d31 290a 0a20 2020 2020 2020  axis=1)..       
+0002ad00: 2020 2020 2023 2053 6f72 7420 6865 6164       # Sort head
+0002ad10: 6572 7320 6279 2067 6c6f 6261 6c2f 736c  ers by global/sl
+0002ad20: 6963 650a 2020 2020 2020 2020 2020 2020  ice.            
+0002ad30: 6865 6164 6572 7320 3d20 5b68 2066 6f72  headers = [h for
+0002ad40: 2068 2069 6e20 6865 6164 6572 7320 6966   h in headers if
+0002ad50: 2068 5b30 5d20 3d3d 2067 6c6f 6261 6c5f   h[0] == global_
+0002ad60: 6e61 6d65 5d20 5c0a 2020 2020 2020 2020  name] \.        
+0002ad70: 2020 2020 2020 2020 2020 2020 2b20 5b68              + [h
+0002ad80: 2066 6f72 2068 2069 6e20 6865 6164 6572   for h in header
+0002ad90: 7320 6966 2068 5b30 5d20 3d3d 2073 6c69  s if h[0] == sli
+0002ada0: 6365 5f6e 616d 655d 0a20 2020 2020 2020  ce_name].       
+0002adb0: 2020 2020 2069 6620 6e6f 7420 6e61 6d65       if not name
+0002adc0: 5f61 735f 696e 6465 783a 0a20 2020 2020  _as_index:.     
+0002add0: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+0002ade0: 7273 2e69 6e73 6572 7428 302c 2028 2222  rs.insert(0, (""
+0002adf0: 2c20 2252 4f49 2229 290a 0a20 2020 2020  , "ROI"))..     
+0002ae00: 2020 2020 2020 2023 2041 6464 204d 756c         # Add Mul
+0002ae10: 7469 496e 6465 780a 2020 2020 2020 2020  tiIndex.        
+0002ae20: 2020 2020 6466 2e63 6f6c 756d 6e73 203d      df.columns =
+0002ae30: 2070 642e 4d75 6c74 6949 6e64 6578 2e66   pd.MultiIndex.f
+0002ae40: 726f 6d5f 7475 706c 6573 2868 6561 6465  rom_tuples(heade
+0002ae50: 7273 290a 0a20 2020 2020 2020 2072 6574  rs)..        ret
+0002ae60: 7572 6e20 6466 0a0a 2020 2020 6465 6620  urn df..    def 
+0002ae70: 6765 745f 636f 6d70 6172 6973 6f6e 5f6e  get_comparison_n
+0002ae80: 616d 6528 7365 6c66 2c20 726f 692c 2063  ame(self, roi, c
+0002ae90: 616d 656c 6361 7365 3d46 616c 7365 2c20  amelcase=False, 
+0002aea0: 636f 6c6f 7265 643d 4661 6c73 652c 0a20  colored=False,. 
+0002aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aec0: 2020 2020 2020 2020 2020 2067 7265 793d             grey=
+0002aed0: 4661 6c73 652c 2072 6f69 5f6b 7761 7267  False, roi_kwarg
+0002aee0: 733d 7b7d 293a 0a20 2020 2020 2020 2022  s={}):.        "
+0002aef0: 2222 4765 7420 6e61 6d65 206f 6620 636f  ""Get name of co
+0002af00: 6d70 6172 6973 6f6e 2062 6574 7765 656e  mparison between
+0002af10: 2074 6869 7320 524f 4920 616e 6420 616e   this ROI and an
+0002af20: 6f74 6865 722e 2222 220a 0a20 2020 2020  other."""..     
+0002af30: 2020 206f 776e 5f6e 616d 6520 3d20 7365     own_name = se
+0002af40: 6c66 2e6e 616d 650a 2020 2020 2020 2020  lf.name.        
+0002af50: 6f74 6865 725f 6e61 6d65 203d 2072 6f69  other_name = roi
+0002af60: 2e6e 616d 650a 0a20 2020 2020 2020 2069  .name..        i
+0002af70: 6620 636f 6c6f 7265 643a 0a20 2020 2020  f colored:.     
+0002af80: 2020 2020 2020 206f 776e 5f63 6f6c 6f72         own_color
+0002af90: 203d 2073 656c 662e 6765 745f 636f 6c6f   = self.get_colo
+0002afa0: 725f 6672 6f6d 5f6b 7761 7267 7328 726f  r_from_kwargs(ro
+0002afb0: 695f 6b77 6172 6773 290a 2020 2020 2020  i_kwargs).      
+0002afc0: 2020 2020 2020 6f77 6e5f 6e61 6d65 203d        own_name =
+0002afd0: 2067 6574 5f63 6f6c 6f72 6564 5f72 6f69   get_colored_roi
+0002afe0: 5f73 7472 696e 6728 7365 6c66 2c20 6772  _string(self, gr
+0002aff0: 6579 2c20 6f77 6e5f 636f 6c6f 7229 0a20  ey, own_color). 
+0002b000: 2020 2020 2020 2020 2020 206f 7468 6572             other
+0002b010: 5f63 6f6c 6f72 203d 2072 6f69 2e67 6574  _color = roi.get
+0002b020: 5f63 6f6c 6f72 5f66 726f 6d5f 6b77 6172  _color_from_kwar
+0002b030: 6773 2872 6f69 5f6b 7761 7267 7329 0a20  gs(roi_kwargs). 
+0002b040: 2020 2020 2020 2020 2020 206f 7468 6572             other
+0002b050: 5f6e 616d 6520 3d20 6765 745f 636f 6c6f  _name = get_colo
+0002b060: 7265 645f 726f 695f 7374 7269 6e67 2872  red_roi_string(r
+0002b070: 6f69 2c20 6772 6579 2c20 6f74 6865 725f  oi, grey, other_
+0002b080: 636f 6c6f 7229 0a0a 2020 2020 2020 2020  color)..        
+0002b090: 6966 2073 656c 662e 6e61 6d65 203d 3d20  if self.name == 
+0002b0a0: 726f 692e 6e61 6d65 3a0a 2020 2020 2020  roi.name:.      
+0002b0b0: 2020 2020 2020 6966 2063 616d 656c 6361        if camelca
+0002b0c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0002b0d0: 2020 2020 7265 7475 726e 206f 776e 5f6e      return own_n
+0002b0e0: 616d 652e 7265 706c 6163 6528 2220 222c  ame.replace(" ",
+0002b0f0: 2022 5f22 290a 2020 2020 2020 2020 2020   "_").          
+0002b100: 2020 7265 7475 726e 206f 776e 5f6e 616d    return own_nam
+0002b110: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
+0002b120: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0002b130: 6f74 2063 6f6c 6f72 6564 3a0a 2020 2020  ot colored:.    
+0002b140: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0002b150: 616d 656c 6361 7365 3a0a 2020 2020 2020  amelcase:.      
+0002b160: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0002b170: 7475 726e 2066 227b 6f77 6e5f 6e61 6d65  turn f"{own_name
+0002b180: 7d5f 7673 5f7b 6f74 6865 725f 6e61 6d65  }_vs_{other_name
+0002b190: 7d22 2e72 6570 6c61 6365 2822 2022 2c20  }".replace(" ", 
+0002b1a0: 225f 2229 0a20 2020 2020 2020 2020 2020  "_").           
+0002b1b0: 2020 2020 2072 6574 7572 6e20 6622 7b6f       return f"{o
+0002b1c0: 776e 5f6e 616d 657d 2076 732e 207b 6f74  wn_name} vs. {ot
+0002b1d0: 6865 725f 6e61 6d65 7d22 0a20 2020 2020  her_name}".     
+0002b1e0: 2020 2020 2020 2072 6574 7572 6e20 6622         return f"
+0002b1f0: 7b6f 776e 5f6e 616d 657d 7b6f 7468 6572  {own_name}{other
+0002b200: 5f6e 616d 657d 220a 0a20 2020 2064 6566  _name}"..    def
+0002b210: 2073 6574 5f61 6c70 6861 5f6f 7665 725f   set_alpha_over_
+0002b220: 6265 7461 2873 656c 662c 2061 6c70 6861  beta(self, alpha
+0002b230: 5f6f 7665 725f 6265 7461 3d4e 6f6e 6529  _over_beta=None)
+0002b240: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0002b250: 2020 2020 2020 5365 7420 7261 7469 6f20        Set ratio 
+0002b260: 666f 7220 524f 4920 7469 7373 7565 206f  for ROI tissue o
+0002b270: 6620 636f 6566 6669 6369 656e 7473 206f  f coefficients o
+0002b280: 6620 6c69 6e65 6172 2d71 7561 6472 6174  f linear-quadrat
+0002b290: 6963 2065 7175 6174 696f 6e2e 0a0a 2020  ic equation...  
+0002b2a0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+0002b2b0: 723a 2a2a 0a0a 2020 2020 2020 2020 616c  r:**..        al
+0002b2c0: 7068 615f 6f76 6572 5f62 6574 6120 3a20  pha_over_beta : 
+0002b2d0: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+0002b2e0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0002b2f0: 5261 7469 6f20 666f 7220 524f 4920 7469  Ratio for ROI ti
+0002b300: 7373 7565 206f 6620 636f 6566 6669 6369  ssue of coeffici
+0002b310: 656e 7473 2c20 616c 7068 612c 2062 6574  ents, alpha, bet
+0002b320: 612c 0a20 2020 2020 2020 2020 2020 206f  a,.            o
+0002b330: 6620 6c69 6e65 6172 2d71 7561 6472 6174  f linear-quadrat
+0002b340: 6963 2065 7175 6174 696f 6e2e 2020 5468  ic equation.  Th
+0002b350: 6973 2072 6174 696f 2069 7320 7573 6564  is ratio is used
+0002b360: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
+0002b370: 6361 6c63 756c 6174 696e 6720 6269 6f6c  calculating biol
+0002b380: 6f67 6963 616c 6c79 2065 6666 6563 7469  ogically effecti
+0002b390: 7665 2064 6f73 652c 2042 4544 2c20 6672  ve dose, BED, fr
+0002b3a0: 6f6d 0a20 2020 2020 2020 2020 2020 2070  om.            p
+0002b3b0: 6879 7369 6361 6c20 646f 7365 2c20 442c  hysical dose, D,
+0002b3c0: 2064 656c 6976 6572 6564 206f 7665 7220   delivered over 
+0002b3d0: 6e20 6571 7561 6c20 6672 6163 7469 6f6e  n equal fraction
+0002b3e0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0002b3f0: 2020 2042 4544 203d 2044 202a 2028 3120     BED = D * (1 
+0002b400: 2b20 2844 2f6e 2920 2f20 2861 6c70 6861  + (D/n) / (alpha
+0002b410: 2f62 6574 6129 292e 0a20 2020 2020 2020  /beta))..       
+0002b420: 2020 2020 2049 6620 4e6f 6e65 2c20 7468       If None, th
+0002b430: 6520 6269 6f6c 6f67 6963 616c 6c79 2065  e biologically e
+0002b440: 6666 6563 7469 7665 2064 6f73 6520 6973  ffective dose is
+0002b450: 2074 616b 656e 2074 6f20 6265 0a20 2020   taken to be.   
+0002b460: 2020 2020 2020 2020 2065 7175 616c 2074           equal t
+0002b470: 6f20 7468 6520 7068 7973 6963 616c 2064  o the physical d
+0002b480: 6f73 6520 2862 6574 6120 3e3e 2061 6c70  ose (beta >> alp
+0002b490: 6861 292e 0a20 2020 2020 2020 2022 2222  ha)..        """
+0002b4a0: 0a20 2020 2020 2020 2073 656c 662e 616c  .        self.al
+0002b4b0: 7068 615f 6f76 6572 5f62 6574 6120 3d20  pha_over_beta = 
+0002b4c0: 616c 7068 615f 6f76 6572 5f62 6574 610a  alpha_over_beta.
+0002b4d0: 0a20 2020 2064 6566 2067 6574 5f61 6c70  .    def get_alp
+0002b4e0: 6861 5f6f 7665 725f 6265 7461 2873 656c  ha_over_beta(sel
+0002b4f0: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+0002b500: 2020 2020 2020 2020 4765 7420 7261 7469          Get rati
+0002b510: 6f20 666f 7220 524f 4920 7469 7373 7565  o for ROI tissue
+0002b520: 206f 6620 636f 6566 6669 6369 656e 7473   of coefficients
+0002b530: 206f 6620 6c69 6e65 6172 2d71 7561 6472   of linear-quadr
+0002b540: 6174 6963 2065 7175 6174 696f 6e2e 0a20  atic equation.. 
+0002b550: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0002b560: 2020 2072 6574 7572 6e20 7365 6c66 2e61     return self.a
+0002b570: 6c70 6861 5f6f 7665 725f 6265 7461 0a0a  lpha_over_beta..
+0002b580: 2020 2020 6465 6620 7365 745f 636f 6c6f      def set_colo
+0002b590: 7228 7365 6c66 2c20 636f 6c6f 7229 3a0a  r(self, color):.
+0002b5a0: 2020 2020 2020 2020 2222 2253 6574 2070          """Set p
+0002b5b0: 6c6f 7474 696e 6720 636f 6c6f 722e 2222  lotting color.""
+0002b5c0: 220a 0a20 2020 2020 2020 2069 6620 636f  "..        if co
+0002b5d0: 6c6f 7220 6973 206e 6f74 204e 6f6e 6520  lor is not None 
+0002b5e0: 616e 6420 6e6f 7420 6d61 7470 6c6f 746c  and not matplotl
+0002b5f0: 6962 2e63 6f6c 6f72 732e 6973 5f63 6f6c  ib.colors.is_col
+0002b600: 6f72 5f6c 696b 6528 636f 6c6f 7229 3a0a  or_like(color):.
+0002b610: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0002b620: 7428 6622 5761 726e 696e 673a 207b 636f  t(f"Warning: {co
+0002b630: 6c6f 727d 206e 6f74 2061 2076 616c 6964  lor} not a valid
+0002b640: 2063 6f6c 6f72 2122 290a 2020 2020 2020   color!").      
+0002b650: 2020 2020 2020 636f 6c6f 7220 3d20 4e6f        color = No
+0002b660: 6e65 0a20 2020 2020 2020 2069 6620 636f  ne.        if co
+0002b670: 6c6f 7220 6973 204e 6f6e 653a 0a20 2020  lor is None:.   
+0002b680: 2020 2020 2020 2020 2063 6f6c 6f72 203d           color =
+0002b690: 2052 4f49 4465 6661 756c 7473 2829 2e67   ROIDefaults().g
+0002b6a0: 6574 5f64 6566 6175 6c74 5f72 6f69 5f63  et_default_roi_c
+0002b6b0: 6f6c 6f72 2829 0a20 2020 2020 2020 2073  olor().        s
+0002b6c0: 656c 662e 636f 6c6f 7220 3d20 6d61 7470  elf.color = matp
+0002b6d0: 6c6f 746c 6962 2e63 6f6c 6f72 732e 746f  lotlib.colors.to
+0002b6e0: 5f72 6762 6128 636f 6c6f 7229 0a0a 2020  _rgba(color)..  
+0002b6f0: 2020 6465 6620 706c 6f74 280a 2020 2020    def plot(.    
+0002b700: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0002b710: 2020 7669 6577 3d22 782d 7922 2c0a 2020    view="x-y",.  
+0002b720: 2020 2020 2020 706c 6f74 5f74 7970 653d        plot_type=
+0002b730: 2263 6f6e 746f 7572 222c 0a20 2020 2020  "contour",.     
+0002b740: 2020 2073 6c3d 4e6f 6e65 2c0a 2020 2020     sl=None,.    
+0002b750: 2020 2020 6964 783d 4e6f 6e65 2c0a 2020      idx=None,.  
+0002b760: 2020 2020 2020 706f 733d 4e6f 6e65 2c0a        pos=None,.
+0002b770: 2020 2020 2020 2020 6178 3d4e 6f6e 652c          ax=None,
+0002b780: 0a20 2020 2020 2020 2067 733d 4e6f 6e65  .        gs=None
+0002b790: 2c0a 2020 2020 2020 2020 6669 6773 697a  ,.        figsiz
+0002b7a0: 653d 736b 7274 2e69 6d61 6765 2e5f 6465  e=skrt.image._de
+0002b7b0: 6661 756c 745f 6669 6773 697a 652c 0a20  fault_figsize,. 
+0002b7c0: 2020 2020 2020 206f 7061 6369 7479 3d4e         opacity=N
+0002b7d0: 6f6e 652c 0a20 2020 2020 2020 206c 696e  one,.        lin
+0002b7e0: 6577 6964 7468 3d4e 6f6e 652c 0a20 2020  ewidth=None,.   
+0002b7f0: 2020 2020 2063 6f6e 746f 7572 5f6b 7761       contour_kwa
+0002b800: 7267 733d 4e6f 6e65 2c0a 2020 2020 2020  rgs=None,.      
+0002b810: 2020 6d61 736b 5f6b 7761 7267 733d 4e6f    mask_kwargs=No
+0002b820: 6e65 2c0a 2020 2020 2020 2020 7a6f 6f6d  ne,.        zoom
+0002b830: 3d4e 6f6e 652c 0a20 2020 2020 2020 207a  =None,.        z
+0002b840: 6f6f 6d5f 6365 6e74 7265 3d4e 6f6e 652c  oom_centre=None,
+0002b850: 0a20 2020 2020 2020 2063 6f6c 6f72 3d4e  .        color=N
+0002b860: 6f6e 652c 0a20 2020 2020 2020 2073 686f  one,.        sho
+0002b870: 773d 5472 7565 2c0a 2020 2020 2020 2020  w=True,.        
+0002b880: 7361 7665 5f61 733d 4e6f 6e65 2c0a 2020  save_as=None,.  
+0002b890: 2020 2020 2020 696e 636c 7564 655f 696d        include_im
+0002b8a0: 6167 653d 4661 6c73 652c 0a20 2020 2020  age=False,.     
+0002b8b0: 2020 206e 6f5f 696e 7665 7274 3d46 616c     no_invert=Fal
+0002b8c0: 7365 2c0a 2020 2020 2020 2020 2a2a 6b77  se,.        **kw
+0002b8d0: 6172 6773 2c0a 2020 2020 293a 0a20 2020  args,.    ):.   
+0002b8e0: 2020 2020 2022 2222 506c 6f74 2074 6869       """Plot thi
+0002b8f0: 7320 524f 4920 6173 2065 6974 6865 7220  s ROI as either 
+0002b900: 6120 6d61 736b 206f 7220 6120 636f 6e74  a mask or a cont
+0002b910: 6f75 722e 0a0a 2020 2020 2020 2020 2a2a  our...        **
+0002b920: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
+0002b930: 2020 2020 2020 2076 6965 7720 3a20 7374         view : st
+0002b940: 722c 2064 6566 6175 6c74 3d22 782d 7922  r, default="x-y"
+0002b950: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
+0002b960: 656e 7461 7469 6f6e 2069 6e20 7768 6963  entation in whic
+0002b970: 6820 746f 2070 6c6f 742e 2043 616e 2062  h to plot. Can b
+0002b980: 6520 2278 2d79 222c 2022 792d 7a22 2c20  e "x-y", "y-z", 
+0002b990: 6f72 2022 782d 7a22 2e0a 0a20 2020 2020  or "x-z"...     
+0002b9a0: 2020 2070 6c6f 745f 7479 7065 203a 2073     plot_type : s
+0002b9b0: 7472 2c20 6465 6661 756c 743d 2263 6f6e  tr, default="con
+0002b9c0: 746f 7572 220a 2020 2020 2020 2020 2020  tour".          
+0002b9d0: 2020 506c 6f74 7469 6e67 2074 7970 652e    Plotting type.
+0002b9e0: 2049 6620 4e6f 6e65 2c20 7769 6c6c 2062   If None, will b
+0002b9f0: 6520 6569 7468 6572 2022 636f 6e74 6f75  e either "contou
+0002ba00: 7222 206f 7220 226d 6173 6b22 200a 2020  r" or "mask" .  
+0002ba10: 2020 2020 2020 2020 2020 6465 7065 6e64            depend
+0002ba20: 696e 6720 6f6e 2074 6865 2069 6e70 7574  ing on the input
+0002ba30: 2074 7970 6520 6f66 2074 6865 2052 4f49   type of the ROI
+0002ba40: 2e20 4f70 7469 6f6e 733a 0a0a 2020 2020  . Options:..    
+0002ba50: 2020 2020 2020 2020 2020 2020 2d20 2263              - "c
+0002ba60: 6f6e 746f 7572 220a 2020 2020 2020 2020  ontour".        
+0002ba70: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
+0002ba80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002ba90: 202d 2022 6365 6e74 726f 6964 2220 2863   - "centroid" (c
+0002baa0: 6f6e 746f 7572 2077 6974 6820 6d61 726b  ontour with mark
+0002bab0: 6572 2061 7420 6365 6e74 726f 6964 290a  er at centroid).
+0002bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bad0: 2d20 2266 696c 6c65 6422 2028 7472 616e  - "filled" (tran
+0002bae0: 7370 6172 656e 7420 6d61 736b 202b 2063  sparent mask + c
+0002baf0: 6f6e 746f 7572 290a 2020 2020 2020 2020  ontour).        
+0002bb00: 2020 2020 2020 2020 2d20 2266 696c 6c65          - "fille
+0002bb10: 6420 6365 6e74 726f 6964 2220 2866 696c  d centroid" (fil
+0002bb20: 6c65 6420 7769 7468 206d 6172 6b65 7220  led with marker 
+0002bb30: 6174 2063 656e 7472 6f69 6429 0a0a 2020  at centroid)..  
+0002bb40: 2020 2020 2020 736c 203a 2069 6e74 2c20        sl : int, 
+0002bb50: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+0002bb60: 2020 2020 2020 2020 2053 6c69 6365 206e           Slice n
+0002bb70: 756d 6265 7220 746f 2070 6c6f 742e 2049  umber to plot. I
+0002bb80: 6620 6e6f 6e65 206f 6620 3c73 6c3e 2c20  f none of <sl>, 
+0002bb90: 3c69 6478 3e20 6f72 203c 706f 733e 2061  <idx> or <pos> a
+0002bba0: 7265 2073 7570 706c 6965 642c 200a 2020  re supplied, .  
+0002bbb0: 2020 2020 2020 2020 2020 7468 6520 6365            the ce
+0002bbc0: 6e74 7261 6c20 736c 6963 6520 6f66 2074  ntral slice of t
+0002bbd0: 6865 2052 4f49 2077 696c 6c20 6265 200a  he ROI will be .
+0002bbe0: 2020 2020 2020 2020 2020 2020 7573 6564              used
+0002bbf0: 2e0a 0a20 2020 2020 2020 2069 6478 203a  ...        idx :
+0002bc00: 2069 6e74 2c20 6465 6661 756c 743d 4e6f   int, default=No
+0002bc10: 6e65 0a20 2020 2020 2020 2020 2020 2041  ne.            A
+0002bc20: 7272 6179 2069 6e64 6578 206f 6620 736c  rray index of sl
+0002bc30: 6963 6520 746f 2070 6c6f 742e 2049 6620  ice to plot. If 
+0002bc40: 6e6f 6e65 206f 6620 3c73 6c3e 2c20 3c69  none of <sl>, <i
+0002bc50: 6478 3e20 6f72 203c 706f 733e 2061 7265  dx> or <pos> are
+0002bc60: 200a 2020 2020 2020 2020 2020 2020 7375   .            su
+0002bc70: 7070 6c69 6564 2c20 7468 6520 6365 6e74  pplied, the cent
+0002bc80: 7261 6c20 736c 6963 6520 6f66 2074 6865  ral slice of the
+0002bc90: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
+0002bca0: 642e 0a0a 2020 2020 2020 2020 706f 7320  d...        pos 
+0002bcb0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+0002bcc0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0002bcd0: 2020 506f 7369 7469 6f6e 2069 6e20 6d6d    Position in mm
+0002bce0: 206f 6620 736c 6963 6520 746f 2070 6c6f   of slice to plo
+0002bcf0: 742e 2049 6620 6e6f 6e65 206f 6620 3c73  t. If none of <s
+0002bd00: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
+0002bd10: 733e 200a 2020 2020 2020 2020 2020 2020  s> .            
+0002bd20: 6172 6520 7375 7070 6c69 6564 2c20 7468  are supplied, th
+0002bd30: 6520 6365 6e74 7261 6c20 736c 6963 6520  e central slice 
+0002bd40: 6f66 2074 6865 2052 4f49 2077 696c 6c20  of the ROI will 
+0002bd50: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
+0002bd60: 2020 6178 203a 206d 6174 706c 6f74 6c69    ax : matplotli
+0002bd70: 622e 7079 706c 6f74 2e41 7865 732c 2064  b.pyplot.Axes, d
+0002bd80: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0002bd90: 2020 2020 2020 2020 4178 6573 206f 6e20          Axes on 
+0002bda0: 7768 6963 6820 746f 2070 6c6f 742e 2049  which to plot. I
+0002bdb0: 6620 4e6f 6e65 2c20 6e65 7720 6178 6573  f None, new axes
+0002bdc0: 2077 696c 6c20 6265 2063 7265 6174 6564   will be created
+0002bdd0: 2e0a 0a20 2020 2020 2020 2067 7320 3a20  ...        gs : 
+0002bde0: 6d61 7470 6c6f 746c 6962 2e67 7269 6473  matplotlib.grids
+0002bdf0: 7065 632e 4772 6964 5370 6563 2c20 6465  pec.GridSpec, de
+0002be00: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+0002be10: 2020 2020 2020 2049 6620 6e6f 7420 4e6f         If not No
+0002be20: 6e65 2061 6e64 203c 6178 3e20 6973 204e  ne and <ax> is N
+0002be30: 6f6e 652c 206e 6577 2061 7865 7320 7769  one, new axes wi
+0002be40: 6c6c 2062 6520 6372 6561 7465 6420 6f6e  ll be created on
+0002be50: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+0002be60: 2063 7572 7265 6e74 206d 6174 706c 6f74   current matplot
+0002be70: 6c69 6220 6669 6775 7265 2077 6974 6820  lib figure with 
+0002be80: 7468 6973 2067 7269 6473 7065 632e 0a0a  this gridspec...
+0002be90: 2020 2020 2020 2020 6669 6773 697a 6520          figsize 
+0002bea0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+0002beb0: 3d73 6b72 742e 696d 6167 652e 5f64 6566  =skrt.image._def
+0002bec0: 6175 6c74 5f66 6967 7369 7a65 0a20 2020  ault_figsize.   
+0002bed0: 2020 2020 2020 2020 2046 6967 7572 6520           Figure 
+0002bee0: 6865 6967 6874 2069 6e20 696e 6368 6573  height in inches
+0002bef0: 3b20 6f6e 6c79 2075 7365 6420 6966 203c  ; only used if <
+0002bf00: 6178 3e20 616e 6420 3c67 733e 2061 7265  ax> and <gs> are
+0002bf10: 204e 6f6e 652e 0a0a 2020 2020 2020 2020   None...        
+0002bf20: 6f70 6163 6974 7920 3a20 666c 6f61 742c  opacity : float,
+0002bf30: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0002bf40: 2020 2020 2020 2020 2020 4f70 6163 6974            Opacit
+0002bf50: 7920 746f 2075 7365 2069 6620 706c 6f74  y to use if plot
+0002bf60: 7469 6e67 206d 6173 6b20 2869 2e65 2e20  ting mask (i.e. 
+0002bf70: 706c 6f74 2074 7970 6573 2022 6d61 736b  plot types "mask
+0002bf80: 222c 2022 6669 6c6c 6564 222c 200a 2020  ", "filled", .  
+0002bf90: 2020 2020 2020 2020 2020 6f72 2022 6669            or "fi
+0002bfa0: 6c6c 6564 2063 656e 7472 6f69 6422 292e  lled centroid").
+0002bfb0: 2049 6620 4e6f 6e65 2c20 6f70 6163 6974   If None, opacit
+0002bfc0: 7920 7769 6c6c 2062 6520 3120 6279 2064  y will be 1 by d
+0002bfd0: 6566 6175 6c74 2066 6f72 200a 2020 2020  efault for .    
+0002bfe0: 2020 2020 2020 2020 736f 6c69 6420 6d61          solid ma
+0002bff0: 736b 2070 6c6f 7473 2061 6e64 2030 2e33  sk plots and 0.3
+0002c000: 2062 7920 6465 6661 756c 7420 666f 7220   by default for 
+0002c010: 6669 6c6c 6564 2070 6c6f 7473 2e0a 0a20  filled plots... 
+0002c020: 2020 2020 2020 206c 696e 6577 6964 7468         linewidth
+0002c030: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
+0002c040: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+0002c050: 2020 2057 6964 7468 206f 6620 636f 6e74     Width of cont
+0002c060: 6f75 7220 6c69 6e65 732e 2049 6620 4e6f  our lines. If No
+0002c070: 6e65 2c20 7468 6520 6d61 7470 6c6f 746c  ne, the matplotl
+0002c080: 6962 2064 6566 6175 6c74 2073 6574 7469  ib default setti
+0002c090: 6e67 200a 2020 2020 2020 2020 2020 2020  ng .            
+0002c0a0: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
+0002c0b0: 2020 2020 2020 2063 6f6e 746f 7572 5f6b         contour_k
+0002c0c0: 7761 7267 7320 3a20 6469 6374 2c20 6465  wargs : dict, de
+0002c0d0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+0002c0e0: 2020 2020 2020 2045 7874 7261 206b 6579         Extra key
+0002c0f0: 776f 7264 2061 7267 756d 656e 7473 2074  word arguments t
+0002c100: 6f20 7061 7373 2074 6f20 6d61 7470 6c6f  o pass to matplo
+0002c110: 746c 6962 2063 6f6e 746f 7572 2070 6c6f  tlib contour plo
+0002c120: 7474 696e 672e 0a0a 2020 2020 2020 2020  tting...        
+0002c130: 6d61 736b 5f6b 7761 7267 7320 3a20 6469  mask_kwargs : di
+0002c140: 6374 2c20 6465 6661 756c 743d 4e6f 6e65  ct, default=None
+0002c150: 0a20 2020 2020 2020 2020 2020 2045 7874  .            Ext
+0002c160: 7261 206b 6579 776f 7264 2061 7267 756d  ra keyword argum
+0002c170: 656e 7473 2074 6f20 7061 7373 2074 6f20  ents to pass to 
+0002c180: 6d61 7470 6c6f 746c 6962 206d 6173 6b20  matplotlib mask 
+0002c190: 706c 6f74 7469 6e67 2e0a 0a20 2020 2020  plotting...     
+0002c1a0: 2020 207a 6f6f 6d20 3a20 696e 742f 666c     zoom : int/fl
+0002c1b0: 6f61 742f 7475 706c 652c 2064 6566 6175  oat/tuple, defau
+0002c1c0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0002c1d0: 2020 2020 4661 6374 6f72 2062 7920 7768      Factor by wh
+0002c1e0: 6963 6820 746f 207a 6f6f 6d20 696e 2e20  ich to zoom in. 
+0002c1f0: 4966 2061 2073 696e 676c 6520 696e 7420  If a single int 
+0002c200: 6f72 2066 6c6f 6174 2069 7320 6769 7665  or float is give
+0002c210: 6e2c 0a20 2020 2020 2020 2020 2020 2074  n,.            t
+0002c220: 6865 2073 616d 6520 7a6f 6f6d 2066 6163  he same zoom fac
+0002c230: 746f 7220 7769 6c6c 2062 6520 6170 706c  tor will be appl
+0002c240: 6965 6420 696e 2061 6c6c 2064 6972 6563  ied in all direc
+0002c250: 7469 6f6e 732e 2049 6620 6120 7475 706c  tions. If a tupl
+0002c260: 650a 2020 2020 2020 2020 2020 2020 6f66  e.            of
+0002c270: 2074 6872 6565 2076 616c 7565 7320 6973   three values is
+0002c280: 2067 6976 656e 2c20 7468 6573 6520 7769   given, these wi
+0002c290: 6c6c 2062 6520 7573 6564 2061 7320 7468  ll be used as th
+0002c2a0: 6520 7a6f 6f6d 2066 6163 746f 7273 0a20  e zoom factors. 
+0002c2b0: 2020 2020 2020 2020 2020 2069 6e20 6561             in ea
+0002c2c0: 6368 2064 6972 6563 7469 6f6e 2069 6e20  ch direction in 
+0002c2d0: 7468 6520 6f72 6465 7220 2878 2c20 792c  the order (x, y,
+0002c2e0: 207a 292e 2049 6620 4e6f 6e65 2c20 7468   z). If None, th
+0002c2f0: 6520 696d 6167 6520 7769 6c6c 0a20 2020  e image will.   
+0002c300: 2020 2020 2020 2020 206e 6f74 2062 6520           not be 
+0002c310: 7a6f 6f6d 6564 2069 6e2e 0a0a 2020 2020  zoomed in...    
+0002c320: 2020 2020 7a6f 6f6d 5f63 656e 7472 6520      zoom_centre 
+0002c330: 3a20 7475 706c 652c 2064 6566 6175 6c74  : tuple, default
+0002c340: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0002c350: 2020 506f 7369 7469 6f6e 2061 726f 756e    Position aroun
+0002c360: 6420 7768 6963 6820 7a6f 6f6d 696e 6720  d which zooming 
+0002c370: 6973 2061 7070 6c69 6564 2e20 4966 204e  is applied. If N
+0002c380: 6f6e 652c 2074 6865 2063 656e 7472 6520  one, the centre 
+0002c390: 6f66 0a20 2020 2020 2020 2020 2020 2074  of.            t
+0002c3a0: 6865 2069 6d61 6765 2077 696c 6c20 6265  he image will be
+0002c3b0: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
+0002c3c0: 636f 6c6f 7220 3a20 6d61 7470 6c6f 746c  color : matplotl
+0002c3d0: 6962 2063 6f6c 6f72 2c20 6465 6661 756c  ib color, defaul
+0002c3e0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+0002c3f0: 2020 2043 6f6c 6f72 2077 6974 6820 7768     Color with wh
+0002c400: 6963 6820 746f 2070 6c6f 7420 7468 6520  ich to plot the 
+0002c410: 524f 493b 206f 7665 7272 6964 6573 2074  ROI; overrides t
+0002c420: 6865 2052 4f49 2773 206f 776e 2063 6f6c  he ROI's own col
+0002c430: 6f72 2e20 4966 200a 2020 2020 2020 2020  or. If .        
+0002c440: 2020 2020 4e6f 6e65 2c20 7365 6c66 2e63      None, self.c
+0002c450: 6f6c 6f72 2077 696c 6c20 6265 2075 7365  olor will be use
+0002c460: 642e 0a0a 2020 2020 2020 2020 7368 6f77  d...        show
+0002c470: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+0002c480: 3d54 7275 650a 2020 2020 2020 2020 2020  =True.          
+0002c490: 2020 4966 2054 7275 652c 2074 6865 2070    If True, the p
+0002c4a0: 6c6f 7420 7769 6c6c 2062 6520 6469 7370  lot will be disp
+0002c4b0: 6c61 7965 6420 696d 6d65 6469 6174 656c  layed immediatel
+0002c4c0: 792e 0a0a 2020 2020 2020 2020 7361 7665  y...        save
+0002c4d0: 5f61 7320 3a20 7374 722c 2064 6566 6175  _as : str, defau
+0002c4e0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0002c4f0: 2020 2020 4966 2073 6574 2074 6f20 6120      If set to a 
+0002c500: 7374 7269 6e67 2c20 7468 6520 706c 6f74  string, the plot
+0002c510: 2077 696c 6c20 6265 2073 6176 6564 2074   will be saved t
+0002c520: 6f20 7468 6520 6669 6c65 6e61 6d65 2069  o the filename i
+0002c530: 6e20 7468 6520 0a20 2020 2020 2020 2020  n the .         
+0002c540: 2020 2073 7472 696e 672e 0a0a 2020 2020     string...    
+0002c550: 2020 2020 696e 636c 7564 655f 696d 6167      include_imag
+0002c560: 6520 3a20 626f 6f6c 2c20 6465 6661 756c  e : bool, defaul
+0002c570: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
+0002c580: 2020 2020 4966 2054 7275 6520 616e 6420      If True and 
+0002c590: 7365 6c66 2e69 6d61 6765 2069 7320 6e6f  self.image is no
+0002c5a0: 7420 4e6f 6e65 2c20 7468 6520 524f 4927  t None, the ROI'
+0002c5b0: 7320 696d 6167 6520 7769 6c6c 2062 6520  s image will be 
+0002c5c0: 706c 6f74 7465 640a 2020 2020 2020 2020  plotted.        
+0002c5d0: 2020 2020 696e 2074 6865 2062 6163 6b67      in the backg
+0002c5e0: 726f 756e 642e 0a0a 2020 2020 2020 2020  round...        
+0002c5f0: 6e6f 5f69 6e76 6572 7420 3a20 626f 6f6c  no_invert : bool
+0002c600: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
+0002c610: 2020 2020 2020 2020 2020 2020 4966 2046              If F
+0002c620: 616c 7365 2c20 636f 6e74 6f75 7220 706c  alse, contour pl
+0002c630: 6f74 7320 7769 6c6c 2062 6520 6175 746f  ots will be auto
+0002c640: 6d61 7469 6361 6c6c 7920 696e 7665 7274  matically invert
+0002c650: 6564 2077 6865 6e20 706c 6f74 7469 6e67  ed when plotting
+0002c660: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+0002c670: 686f 7574 2061 6e20 756e 6465 726c 7969  hout an underlyi
+0002c680: 6e67 2069 6d61 6765 2074 6f20 6163 636f  ng image to acco
+0002c690: 756e 7420 666f 7220 7468 6520 7920 6178  unt for the y ax
+0002c6a0: 6973 2069 6e63 7265 6173 696e 6720 0a20  is increasing . 
+0002c6b0: 2020 2020 2020 2020 2020 2069 6e20 7468             in th
+0002c6c0: 6520 6f70 706f 7369 7465 2064 6972 6563  e opposite direc
+0002c6d0: 7469 6f6e 2e20 4f74 6865 7277 6973 652c  tion. Otherwise,
+0002c6e0: 2074 6865 2070 6c6f 7420 7769 6c6c 2062   the plot will b
+0002c6f0: 6520 6c65 6674 2061 730a 2020 2020 2020  e left as.      
+0002c700: 2020 2020 2020 6974 2061 7070 6561 7265        it appeare
+0002c710: 6420 7768 656e 2064 7261 776e 2062 7920  d when drawn by 
+0002c720: 6d61 7470 6c6f 746c 6962 2e0a 0a20 2020  matplotlib...   
+0002c730: 2020 2020 2060 2a2a 606b 7761 7267 7320       `**`kwargs 
+0002c740: 3a0a 2020 2020 2020 2020 2020 2020 4578  :.            Ex
+0002c750: 7472 6120 6b65 7977 6f72 6420 6172 6775  tra keyword argu
+0002c760: 6d65 6e74 7320 746f 2070 6173 7320 746f  ments to pass to
+0002c770: 2074 6865 2072 656c 6576 616e 7420 706c   the relevant pl
+0002c780: 6f74 2066 756e 6374 696f 6e2e 0a20 2020  ot function..   
+0002c790: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0002c7a0: 2073 656c 662e 6c6f 6164 2829 0a20 2020   self.load().   
+0002c7b0: 2020 2020 2069 6620 7365 6c66 2e65 6d70       if self.emp
+0002c7c0: 7479 3a0a 2020 2020 2020 2020 2020 2020  ty:.            
+0002c7d0: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
+0002c7e0: 6966 2070 6c6f 745f 7479 7065 2069 7320  if plot_type is 
+0002c7f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0002c800: 2020 706c 6f74 5f74 7970 6520 3d20 6b77    plot_type = kw
+0002c810: 6172 6773 2e67 6574 2822 726f 695f 706c  args.get("roi_pl
+0002c820: 6f74 5f74 7970 6522 2c20 7365 6c66 2e64  ot_type", self.d
+0002c830: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
+0002c840: 6f64 290a 0a20 2020 2020 2020 2069 6620  od)..        if 
+0002c850: 736c 2069 7320 4e6f 6e65 2061 6e64 2069  sl is None and i
+0002c860: 6478 2069 7320 4e6f 6e65 2061 6e64 2070  dx is None and p
+0002c870: 6f73 2069 7320 4e6f 6e65 3a0a 2020 2020  os is None:.    
+0002c880: 2020 2020 2020 2020 6964 7820 3d20 7365          idx = se
+0002c890: 6c66 2e67 6574 5f6d 6964 5f69 6478 2876  lf.get_mid_idx(v
+0002c8a0: 6965 7729 0a20 2020 2020 2020 2065 6c73  iew).        els
+0002c8b0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+0002c8c0: 6478 203d 2073 656c 662e 6765 745f 6964  dx = self.get_id
+0002c8d0: 7828 7669 6577 2c20 736c 2c20 6964 782c  x(view, sl, idx,
+0002c8e0: 2070 6f73 290a 0a20 2020 2020 2020 2073   pos)..        s
+0002c8f0: 686f 775f 6365 6e74 726f 6964 203d 2022  how_centroid = "
+0002c900: 6365 6e74 726f 6964 2220 696e 2070 6c6f  centroid" in plo
+0002c910: 745f 7479 7065 0a20 2020 2020 2020 2069  t_type.        i
+0002c920: 6620 7a6f 6f6d 2061 6e64 207a 6f6f 6d5f  f zoom and zoom_
+0002c930: 6365 6e74 7265 2069 7320 4e6f 6e65 3a0a  centre is None:.
+0002c940: 2020 2020 2020 2020 2020 2020 7a6f 6f6d              zoom
+0002c950: 5f63 656e 7472 6520 3d20 7365 6c66 2e67  _centre = self.g
+0002c960: 6574 5f7a 6f6f 6d5f 6365 6e74 7265 2876  et_zoom_centre(v
+0002c970: 6965 7729 0a20 2020 2020 2020 2069 6620  iew).        if 
+0002c980: 636f 6c6f 7220 6973 204e 6f6e 653a 0a20  color is None:. 
+0002c990: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
+0002c9a0: 203d 2073 656c 662e 636f 6c6f 720a 2020   = self.color.  
+0002c9b0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0002c9c0: 2020 2020 2020 2020 636f 6c6f 7220 3d20          color = 
+0002c9d0: 6d61 7470 6c6f 746c 6962 2e63 6f6c 6f72  matplotlib.color
+0002c9e0: 732e 746f 5f72 6762 6128 636f 6c6f 7229  s.to_rgba(color)
+0002c9f0: 0a0a 2020 2020 2020 2020 6966 206f 7061  ..        if opa
+0002ca00: 6369 7479 2069 7320 4e6f 6e65 3a0a 2020  city is None:.  
+0002ca10: 2020 2020 2020 2020 2020 6f70 6163 6974            opacit
+0002ca20: 7920 3d20 6b77 6172 6773 2e67 6574 280a  y = kwargs.get(.
+0002ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ca40: 2020 2020 2272 6f69 5f6f 7061 6369 7479      "roi_opacity
+0002ca50: 222c 2030 2e33 2069 6620 2266 696c 6c65  ", 0.3 if "fille
+0002ca60: 6422 2069 6e20 706c 6f74 5f74 7970 6520  d" in plot_type 
+0002ca70: 656c 7365 2031 290a 0a20 2020 2020 2020  else 1)..       
+0002ca80: 2023 2053 6574 2075 7020 6178 6573 0a20   # Set up axes. 
+0002ca90: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
+0002caa0: 6178 2870 6c6f 745f 7479 7065 2c20 696e  ax(plot_type, in
+0002cab0: 636c 7564 655f 696d 6167 652c 2076 6965  clude_image, vie
+0002cac0: 772c 2061 782c 2067 732c 2066 6967 7369  w, ax, gs, figsi
+0002cad0: 7a65 290a 0a20 2020 2020 2020 2023 2041  ze)..        # A
+0002cae0: 646a 7573 7420 6365 6e74 726f 6964 206d  djust centroid m
+0002caf0: 6172 6b65 7220 7369 7a65 0a20 2020 2020  arker size.     
+0002cb00: 2020 2069 6620 636f 6e74 6f75 725f 6b77     if contour_kw
+0002cb10: 6172 6773 2069 7320 4e6f 6e65 3a0a 2020  args is None:.  
+0002cb20: 2020 2020 2020 2020 2020 636f 6e74 6f75            contou
+0002cb30: 725f 6b77 6172 6773 203d 207b 7d0a 2020  r_kwargs = {}.  
+0002cb40: 2020 2020 2020 6966 2022 6365 6e74 726f        if "centro
+0002cb50: 6964 2220 696e 2070 6c6f 745f 7479 7065  id" in plot_type
+0002cb60: 206f 7220 2263 6f6e 746f 7572 2220 3d3d   or "contour" ==
+0002cb70: 2070 6c6f 745f 7479 7065 3a0a 2020 2020   plot_type:.    
+0002cb80: 2020 2020 2020 2020 6966 206c 696e 6577          if linew
+0002cb90: 6964 7468 2069 7320 4e6f 6e65 3a0a 2020  idth is None:.  
+0002cba0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+0002cbb0: 6e65 7769 6474 6820 3d20 6b77 6172 6773  newidth = kwargs
+0002cbc0: 2e67 6574 2822 726f 695f 6c69 6e65 7769  .get("roi_linewi
+0002cbd0: 6474 6822 2c0a 2020 2020 2020 2020 2020  dth",.          
+0002cbe0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0002cbf0: 6661 756c 7450 6172 616d 735b 226c 696e  faultParams["lin
+0002cc00: 6573 2e6c 696e 6577 6964 7468 225d 5b30  es.linewidth"][0
+0002cc10: 5d29 0a20 2020 2020 2020 2069 6620 2263  ]).        if "c
+0002cc20: 656e 7472 6f69 6422 2069 6e20 706c 6f74  entroid" in plot
+0002cc30: 5f74 7970 653a 0a20 2020 2020 2020 2020  _type:.         
+0002cc40: 2020 2063 6f6e 746f 7572 5f6b 7761 7267     contour_kwarg
+0002cc50: 732e 7365 7464 6566 6175 6c74 2822 6d61  s.setdefault("ma
+0002cc60: 726b 6572 7369 7a65 222c 2037 202a 206e  rkersize", 7 * n
+0002cc70: 702e 7371 7274 286c 696e 6577 6964 7468  p.sqrt(linewidth
+0002cc80: 2929 0a20 2020 2020 2020 2020 2020 2063  )).            c
+0002cc90: 6f6e 746f 7572 5f6b 7761 7267 732e 7365  ontour_kwargs.se
+0002cca0: 7464 6566 6175 6c74 2822 6d61 726b 6572  tdefault("marker
+0002ccb0: 6564 6765 7769 6474 6822 2c20 6e70 2e73  edgewidth", np.s
+0002ccc0: 7172 7428 6c69 6e65 7769 6474 6829 290a  qrt(linewidth)).
+0002ccd0: 0a20 2020 2020 2020 2023 2050 6c6f 7420  .        # Plot 
+0002cce0: 6120 6d61 736b 0a20 2020 2020 2020 2069  a mask.        i
+0002ccf0: 6620 706c 6f74 5f74 7970 6520 3d3d 2022  f plot_type == "
+0002cd00: 6d61 736b 223a 0a20 2020 2020 2020 2020  mask":.         
+0002cd10: 2020 2073 656c 662e 5f70 6c6f 745f 6d61     self._plot_ma
+0002cd20: 736b 280a 2020 2020 2020 2020 2020 2020  sk(.            
+0002cd30: 2020 2020 7669 6577 2c0a 2020 2020 2020      view,.      
+0002cd40: 2020 2020 2020 2020 2020 6964 782c 0a20            idx,. 
+0002cd50: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0002cd60: 6173 6b5f 6b77 6172 6773 2c0a 2020 2020  ask_kwargs,.    
+0002cd70: 2020 2020 2020 2020 2020 2020 6f70 6163              opac
+0002cd80: 6974 792c 0a20 2020 2020 2020 2020 2020  ity,.           
+0002cd90: 2020 2020 207a 6f6f 6d3d 7a6f 6f6d 2c0a       zoom=zoom,.
+0002cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cdb0: 7a6f 6f6d 5f63 656e 7472 653d 7a6f 6f6d  zoom_centre=zoom
+0002cdc0: 5f63 656e 7472 652c 0a20 2020 2020 2020  _centre,.       
+0002cdd0: 2020 2020 2020 2020 2073 686f 773d 4661           show=Fa
+0002cde0: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+0002cdf0: 2020 2020 2069 6e63 6c75 6465 5f69 6d61       include_ima
+0002ce00: 6765 3d69 6e63 6c75 6465 5f69 6d61 6765  ge=include_image
+0002ce10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002ce20: 2020 636f 6c6f 723d 636f 6c6f 722c 0a20    color=color,. 
+0002ce30: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+0002ce40: 2a6b 7761 7267 732c 0a20 2020 2020 2020  *kwargs,.       
+0002ce50: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0002ce60: 2320 506c 6f74 2061 2063 6f6e 746f 7572  # Plot a contour
+0002ce70: 0a20 2020 2020 2020 2065 6c69 6620 706c  .        elif pl
+0002ce80: 6f74 5f74 7970 6520 696e 205b 2263 6f6e  ot_type in ["con
+0002ce90: 746f 7572 222c 2022 6365 6e74 726f 6964  tour", "centroid
+0002cea0: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
+0002ceb0: 7365 6c66 2e5f 706c 6f74 5f63 6f6e 746f  self._plot_conto
+0002cec0: 7572 280a 2020 2020 2020 2020 2020 2020  ur(.            
+0002ced0: 2020 2020 7669 6577 2c0a 2020 2020 2020      view,.      
+0002cee0: 2020 2020 2020 2020 2020 6964 782c 0a20            idx,. 
+0002cef0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0002cf00: 6f6e 746f 7572 5f6b 7761 7267 732c 0a20  ontour_kwargs,. 
+0002cf10: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0002cf20: 696e 6577 6964 7468 2c0a 2020 2020 2020  inewidth,.      
+0002cf30: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
+0002cf40: 6964 3d73 686f 775f 6365 6e74 726f 6964  id=show_centroid
+0002cf50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002cf60: 2020 7a6f 6f6d 3d7a 6f6f 6d2c 0a20 2020    zoom=zoom,.   
+0002cf70: 2020 2020 2020 2020 2020 2020 207a 6f6f               zoo
+0002cf80: 6d5f 6365 6e74 7265 3d7a 6f6f 6d5f 6365  m_centre=zoom_ce
+0002cf90: 6e74 7265 2c0a 2020 2020 2020 2020 2020  ntre,.          
+0002cfa0: 2020 2020 2020 636f 6c6f 723d 636f 6c6f        color=colo
+0002cfb0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+0002cfc0: 2020 2073 686f 773d 4661 6c73 652c 0a20     show=False,. 
+0002cfd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002cfe0: 6e63 6c75 6465 5f69 6d61 6765 3d69 6e63  nclude_image=inc
+0002cff0: 6c75 6465 5f69 6d61 6765 2c0a 2020 2020  lude_image,.    
+0002d000: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
+0002d010: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
+0002d020: 2020 290a 0a20 2020 2020 2020 2023 2050    )..        # P
+0002d030: 6c6f 7420 7472 616e 7370 6172 656e 7420  lot transparent 
+0002d040: 6d61 736b 202b 2063 6f6e 746f 7572 0a20  mask + contour. 
+0002d050: 2020 2020 2020 2065 6c69 6620 2266 696c         elif "fil
+0002d060: 6c65 6422 2069 6e20 706c 6f74 5f74 7970  led" in plot_typ
+0002d070: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+0002d080: 6620 6f70 6163 6974 7920 6973 204e 6f6e  f opacity is Non
+0002d090: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002d0a0: 2020 206f 7061 6369 7479 203d 2030 2e33     opacity = 0.3
+0002d0b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0002d0c0: 662e 5f70 6c6f 745f 6d61 736b 2876 6965  f._plot_mask(vie
+0002d0d0: 772c 2069 6478 2c20 6d61 736b 5f6b 7761  w, idx, mask_kwa
+0002d0e0: 7267 732c 206f 7061 6369 7479 2c20 636f  rgs, opacity, co
+0002d0f0: 6c6f 723d 636f 6c6f 722c 0a20 2020 2020  lor=color,.     
+0002d100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d110: 2020 2020 2020 7368 6f77 3d46 616c 7365        show=False
+0002d120: 2c20 696e 636c 7564 655f 696d 6167 653d  , include_image=
+0002d130: 696e 636c 7564 655f 696d 6167 652c 202a  include_image, *
+0002d140: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
+0002d150: 2020 2020 206b 7761 7267 735b 2261 7822       kwargs["ax"
+0002d160: 5d20 3d20 7365 6c66 2e61 780a 2020 2020  ] = self.ax.    
+0002d170: 2020 2020 2020 2020 7365 6c66 2e5f 706c          self._pl
+0002d180: 6f74 5f63 6f6e 746f 7572 280a 2020 2020  ot_contour(.    
+0002d190: 2020 2020 2020 2020 2020 2020 7669 6577              view
+0002d1a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002d1b0: 2020 6964 782c 0a20 2020 2020 2020 2020    idx,.         
+0002d1c0: 2020 2020 2020 2063 6f6e 746f 7572 5f6b         contour_k
+0002d1d0: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
+0002d1e0: 2020 2020 2020 206c 696e 6577 6964 7468         linewidth
+0002d1f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002d200: 2020 6365 6e74 726f 6964 3d73 686f 775f    centroid=show_
+0002d210: 6365 6e74 726f 6964 2c0a 2020 2020 2020  centroid,.      
+0002d220: 2020 2020 2020 2020 2020 7a6f 6f6d 3d7a            zoom=z
+0002d230: 6f6f 6d2c 0a20 2020 2020 2020 2020 2020  oom,.           
+0002d240: 2020 2020 207a 6f6f 6d5f 6365 6e74 7265       zoom_centre
+0002d250: 3d7a 6f6f 6d5f 6365 6e74 7265 2c0a 2020  =zoom_centre,.  
+0002d260: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0002d270: 6c6f 723d 636f 6c6f 722c 0a20 2020 2020  lor=color,.     
+0002d280: 2020 2020 2020 2020 2020 2073 686f 773d             show=
+0002d290: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
+0002d2a0: 2020 2020 2020 2069 6e63 6c75 6465 5f69         include_i
+0002d2b0: 6d61 6765 3d46 616c 7365 2c0a 2020 2020  mage=False,.    
+0002d2c0: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
+0002d2d0: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
+0002d2e0: 2020 290a 0a20 2020 2020 2020 2023 2043    )..        # C
+0002d2f0: 6865 636b 2077 6865 7468 6572 2079 2061  heck whether y a
+0002d300: 7869 7320 6e65 6564 7320 746f 2062 6520  xis needs to be 
+0002d310: 696e 7665 7274 6564 0a20 2020 2020 2020  inverted.       
+0002d320: 2069 6620 7669 6577 203d 3d20 2278 2d79   if view == "x-y
+0002d330: 2220 616e 6420 7365 6c66 2e61 782e 6765  " and self.ax.ge
+0002d340: 745f 796c 696d 2829 5b31 5d20 3e20 7365  t_ylim()[1] > se
+0002d350: 6c66 2e61 782e 6765 745f 796c 696d 2829  lf.ax.get_ylim()
+0002d360: 5b30 5d3a 0a20 2020 2020 2020 2020 2020  [0]:.           
+0002d370: 2073 656c 662e 6178 2e69 6e76 6572 745f   self.ax.invert_
+0002d380: 7961 7869 7328 290a 0a20 2020 2020 2020  yaxis()..       
+0002d390: 2023 2044 7261 7720 6c65 6765 6e64 0a20   # Draw legend. 
+0002d3a0: 2020 2020 2020 206c 6567 656e 6420 3d20         legend = 
+0002d3b0: 6b77 6172 6773 2e67 6574 2822 6c65 6765  kwargs.get("lege
+0002d3c0: 6e64 222c 2046 616c 7365 290a 2020 2020  nd", False).    
+0002d3d0: 2020 2020 6966 206c 6567 656e 643a 0a20      if legend:. 
+0002d3e0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+0002d3f0: 3d20 6b77 6172 6773 2e67 6574 2822 6e61  = kwargs.get("na
+0002d400: 6d65 222c 2073 656c 662e 6e61 6d65 290a  me", self.name).
+0002d410: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
+0002d420: 6861 6e64 6c65 203d 2073 656c 662e 6765  handle = self.ge
+0002d430: 745f 7061 7463 6828 0a20 2020 2020 2020  t_patch(.       
+0002d440: 2020 2020 2020 2020 2020 2020 2070 6c6f               plo
+0002d450: 745f 7479 7065 2c20 636f 6c6f 722c 206f  t_type, color, o
+0002d460: 7061 6369 7479 2c20 6c69 6e65 7769 6474  pacity, linewidt
+0002d470: 682c 206e 616d 6529 0a20 2020 2020 2020  h, name).       
+0002d480: 2020 2020 2069 6620 726f 695f 6861 6e64       if roi_hand
+0002d490: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+0002d4a0: 2020 2020 6262 6f78 5f74 6f5f 616e 6368      bbox_to_anch
+0002d4b0: 6f72 203d 206b 7761 7267 732e 6765 7428  or = kwargs.get(
+0002d4c0: 226c 6567 656e 645f 6262 6f78 5f74 6f5f  "legend_bbox_to_
+0002d4d0: 616e 6368 6f72 222c 204e 6f6e 6529 0a20  anchor", None). 
+0002d4e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0002d4f0: 6f63 203d 206b 7761 7267 732e 6765 7428  oc = kwargs.get(
+0002d500: 226c 6567 656e 645f 6c6f 6322 2c20 226c  "legend_loc", "l
+0002d510: 6f77 6572 206c 6566 7422 290a 0a20 2020  ower left")..   
+0002d520: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0002d530: 662e 6178 2e6c 6567 656e 6428 6861 6e64  f.ax.legend(hand
+0002d540: 6c65 733d 5b72 6f69 5f68 616e 646c 655d  les=[roi_handle]
+0002d550: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002d560: 2020 2020 2020 2020 2020 6262 6f78 5f74            bbox_t
+0002d570: 6f5f 616e 6368 6f72 3d62 626f 785f 746f  o_anchor=bbox_to
+0002d580: 5f61 6e63 686f 722c 206c 6f63 3d6c 6f63  _anchor, loc=loc
+0002d590: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002d5a0: 2020 2020 2020 2020 2020 6661 6365 636f            faceco
+0002d5b0: 6c6f 723d 2277 6869 7465 222c 2066 7261  lor="white", fra
+0002d5c0: 6d65 616c 7068 613d 310a 2020 2020 2020  mealpha=1.      
+0002d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d5e0: 2020 290a 0a20 2020 2020 2020 2023 2044    )..        # D
+0002d5f0: 6973 706c 6179 2069 6d61 6765 0a0a 2020  isplay image..  
+0002d600: 2020 2020 2020 706c 742e 7469 6768 745f        plt.tight_
+0002d610: 6c61 796f 7574 2829 0a20 2020 2020 2020  layout().       
+0002d620: 2069 6620 7368 6f77 3a0a 2020 2020 2020   if show:.      
+0002d630: 2020 2020 2020 706c 742e 7368 6f77 2829        plt.show()
+0002d640: 0a0a 2020 2020 2020 2020 2320 5361 7665  ..        # Save
+0002d650: 2074 6f20 6669 6c65 0a20 2020 2020 2020   to file.       
+0002d660: 2069 6620 7361 7665 5f61 733a 0a20 2020   if save_as:.   
+0002d670: 2020 2020 2020 2020 2073 656c 662e 6669           self.fi
+0002d680: 672e 7361 7665 6669 6728 7361 7665 5f61  g.savefig(save_a
+0002d690: 7329 0a20 2020 2020 2020 2020 2020 2070  s).            p
+0002d6a0: 6c74 2e63 6c6f 7365 2829 0a0a 2020 2020  lt.close()..    
+0002d6b0: 6465 6620 6765 745f 6475 6d6d 795f 696d  def get_dummy_im
+0002d6c0: 6167 6528 7365 6c66 2c20 2a2a 6b77 6172  age(self, **kwar
+0002d6d0: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
+0002d6e0: 4d61 6b65 2061 2064 756d 6d79 2069 6d61  Make a dummy ima
+0002d6f0: 6765 2074 6861 7420 636f 7665 7273 2074  ge that covers t
+0002d700: 6865 2061 7265 6120 7370 616e 6e65 6420  he area spanned 
+0002d710: 6279 2074 6869 7320 524f 492e 200a 2020  by this ROI. .  
+0002d720: 2020 2020 2020 5265 7475 726e 7320 616e        Returns an
+0002d730: 2049 6d61 6765 206f 626a 6563 742e 0a0a   Image object...
+0002d740: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
+0002d750: 7465 7273 3a2a 2a0a 2020 2020 2020 2020  ters:**.        
+0002d760: 0a20 2020 2020 2020 2076 6f78 656c 5f73  .        voxel_s
+0002d770: 697a 6520 3a20 6c69 7374 2c20 6465 6661  ize : list, defa
+0002d780: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+0002d790: 2020 2020 2056 6f78 656c 2073 697a 6520       Voxel size 
+0002d7a0: 696e 206d 6d20 696e 2074 6865 2064 756d  in mm in the dum
+0002d7b0: 6d79 2069 6d61 6765 2069 6e20 7468 6520  my image in the 
+0002d7c0: 782d 7920 706c 616e 652c 2067 6976 656e  x-y plane, given
+0002d7d0: 2061 7320 0a20 2020 2020 2020 2020 2020   as .           
+0002d7e0: 205b 7678 2c20 7679 5d2e 2049 6620 3c73   [vx, vy]. If <s
+0002d7f0: 6861 7065 3e20 616e 6420 3c76 6f78 656c  hape> and <voxel
+0002d800: 5f73 697a 653e 2061 7265 2062 6f74 6820  _size> are both 
+0002d810: 4e6f 6e65 2c20 766f 7865 6c20 7369 7a65  None, voxel size
+0002d820: 7320 6f66 0a20 2020 2020 2020 2020 2020  s of.           
+0002d830: 205b 312c 2031 5d20 7769 6c6c 2062 6520   [1, 1] will be 
+0002d840: 7573 6564 2062 7920 6465 6661 756c 742e  used by default.
+0002d850: 2054 6865 2076 6f78 656c 2073 697a 6520   The voxel size 
+0002d860: 696e 2074 6865 207a 2064 6972 6563 7469  in the z directi
+0002d870: 6f6e 200a 2020 2020 2020 2020 2020 2020  on .            
+0002d880: 6973 2064 6566 696e 6564 2062 7920 3c73  is defined by <s
+0002d890: 6c69 6365 5f74 6869 636b 6e65 7373 3e2e  lice_thickness>.
+0002d8a0: 0a0a 2020 2020 2020 2020 7368 6170 6520  ..        shape 
+0002d8b0: 3a20 6c69 7374 2c20 6465 6661 756c 743d  : list, default=
+0002d8c0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0002d8d0: 204e 756d 6265 7220 6f66 2076 6f78 656c   Number of voxel
+0002d8e0: 7320 696e 2074 6865 2064 756d 6d79 2069  s in the dummy i
+0002d8f0: 6d61 6765 2069 6e20 7468 6520 782d 7920  mage in the x-y 
+0002d900: 706c 616e 652c 2067 6976 656e 2061 730a  plane, given as.
+0002d910: 2020 2020 2020 2020 2020 2020 5b6e 782c              [nx,
+0002d920: 206e 795d 2e20 4f6e 6c79 2075 7365 6420   ny]. Only used 
+0002d930: 6966 203c 766f 7865 6c5f 7369 7a65 3e20  if <voxel_size> 
+0002d940: 6973 204e 6f6e 652e 200a 2020 2020 2020  is None. .      
+0002d950: 2020 2020 2020 5468 6520 6e75 6d62 6572        The number
+0002d960: 206f 6620 766f 7865 6c73 2069 6e20 7468   of voxels in th
+0002d970: 6520 7a20 6469 7265 6374 696f 6e20 7769  e z direction wi
+0002d980: 6c6c 2062 6520 7461 6b65 6e20 6672 6f6d  ll be taken from
+0002d990: 2074 6865 200a 2020 2020 2020 2020 2020   the .          
+0002d9a0: 2020 6e75 6d62 6572 206f 6620 736c 6963    number of slic
+0002d9b0: 6573 2069 6e20 7468 6520 782d 7920 636f  es in the x-y co
+0002d9c0: 6e74 6f75 7273 2064 6963 7469 6f6e 6172  ntours dictionar
+0002d9d0: 792e 0a0a 2020 2020 2020 2020 6669 6c6c  y...        fill
+0002d9e0: 5f76 616c 203a 2069 6e74 2f66 6c6f 6174  _val : int/float
+0002d9f0: 2c20 6465 6661 756c 743d 3165 340a 2020  , default=1e4.  
+0002da00: 2020 2020 2020 2020 2020 5661 6c75 6520            Value 
+0002da10: 7769 7468 2077 6869 6368 2074 6865 2076  with which the v
+0002da20: 6f78 656c 7320 696e 2074 6865 2064 756d  oxels in the dum
+0002da30: 6d79 2069 6d61 6765 2073 686f 756c 6420  my image should 
+0002da40: 6265 2066 696c 6c65 642e 200a 0a20 2020  be filled. ..   
+0002da50: 2020 2020 2062 7566 6665 7220 3a20 696e       buffer : in
+0002da60: 742c 2064 6566 6175 6c74 3d31 0a20 2020  t, default=1.   
+0002da70: 2020 2020 2020 2020 204e 756d 6265 7220           Number 
+0002da80: 6f66 2065 6d70 7479 2062 7566 6665 7220  of empty buffer 
+0002da90: 766f 7865 6c73 2074 6f20 6164 6420 6f75  voxels to add ou
+0002daa0: 7473 6964 6520 7468 6520 524f 4920 696e  tside the ROI in
+0002dab0: 2065 6163 680a 2020 2020 2020 2020 2020   each.          
+0002dac0: 2020 6469 7265 6374 696f 6e2e 0a0a 2020    direction...  
+0002dad0: 2020 2020 2020 736c 6963 655f 7468 6963        slice_thic
+0002dae0: 6b6e 6573 7320 3a20 666c 6f61 742c 2064  kness : float, d
+0002daf0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0002db00: 2020 2020 2020 2020 566f 7865 6c20 7369          Voxel si
+0002db10: 7a65 2069 6e20 6d6d 2069 6e20 7468 6520  ze in mm in the 
+0002db20: 6475 6d6d 7920 696d 6167 6520 696e 2074  dummy image in t
+0002db30: 6865 207a 2064 6972 6563 7469 6f6e 2e20  he z direction. 
+0002db40: 2049 6620 4e6f 6e65 2c0a 2020 2020 2020   If None,.      
+0002db50: 2020 2020 2020 7468 6520 7661 6c75 6520        the value 
+0002db60: 7573 6564 2069 7320 7468 6520 6d69 6e69  used is the mini
+0002db70: 6d75 6d20 6469 7374 616e 6365 2062 6574  mum distance bet
+0002db80: 7765 656e 2073 6c69 6365 2070 6f73 6974  ween slice posit
+0002db90: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
+0002dba0: 2069 6e20 7468 6520 782d 7920 636f 6e74   in the x-y cont
+0002dbb0: 6f75 7273 2064 6963 7469 6f6e 6172 792e  ours dictionary.
+0002dbc0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0002dbd0: 2020 2020 2020 6578 7465 6e74 7320 3d20        extents = 
+0002dbe0: 5b73 656c 662e 6765 745f 6578 7465 6e74  [self.get_extent
+0002dbf0: 2861 783d 6178 2920 666f 7220 6178 2069  (ax=ax) for ax i
+0002dc00: 6e20 736b 7274 2e69 6d61 6765 2e5f 6178  n skrt.image._ax
+0002dc10: 6573 5d0a 2020 2020 2020 2020 736c 6963  es].        slic
+0002dc20: 655f 7468 6963 6b6e 6573 7320 3d20 6b77  e_thickness = kw
+0002dc30: 6172 6773 2e70 6f70 2822 736c 6963 655f  args.pop("slice_
+0002dc40: 7468 6963 6b6e 6573 7322 2c20 4e6f 6e65  thickness", None
+0002dc50: 290a 2020 2020 2020 2020 736c 6963 655f  ).        slice_
+0002dc60: 7468 6963 6b6e 6573 7320 3d20 2873 6c69  thickness = (sli
+0002dc70: 6365 5f74 6869 636b 6e65 7373 206f 720a  ce_thickness or.
+0002dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dc90: 7365 6c66 2e67 6574 5f73 6c69 6365 5f74  self.get_slice_t
+0002dca0: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
+0002dcb0: 7328 2929 0a20 2020 2020 2020 2072 6574  s()).        ret
+0002dcc0: 7572 6e20 6372 6561 7465 5f64 756d 6d79  urn create_dummy
+0002dcd0: 5f69 6d61 6765 2865 7874 656e 7473 2c20  _image(extents, 
+0002dce0: 736c 6963 655f 7468 6963 6b6e 6573 732c  slice_thickness,
+0002dcf0: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+0002dd00: 6465 6620 7365 745f 696d 6167 655f 746f  def set_image_to
+0002dd10: 5f64 756d 6d79 2873 656c 662c 202a 2a6b  _dummy(self, **k
+0002dd20: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+0002dd30: 2222 2241 7373 6967 6e20 7365 6c66 2e69  """Assign self.i
+0002dd40: 6d61 6765 2070 726f 7065 7274 7920 746f  mage property to
+0002dd50: 2061 2064 756d 6d79 2069 6d61 6765 2063   a dummy image c
+0002dd60: 6f76 6572 696e 6720 7468 6520 6172 6561  overing the area
+0002dd70: 200a 2020 2020 2020 2020 7370 616e 6e65   .        spanne
+0002dd80: 6420 6279 2074 6869 7320 524f 492e 2054  d by this ROI. T
+0002dd90: 6865 2052 4f49 2773 206d 6173 6b20 616e  he ROI's mask an
+0002dda0: 6420 782d 7a2f 792d 7a20 636f 6e74 6f75  d x-z/y-z contou
+0002ddb0: 7273 2077 696c 6c20 6265 200a 2020 2020  rs will be .    
+0002ddc0: 2020 2020 636c 6561 7265 6420 736f 2074      cleared so t
+0002ddd0: 6861 7420 7468 6579 2077 696c 6c20 6265  hat they will be
+0002dde0: 2072 6563 7265 6174 6564 2077 6865 6e20   recreated when 
+0002ddf0: 6765 745f 6d61 736b 2829 206f 7220 6765  get_mask() or ge
+0002de00: 745f 636f 6e74 6f75 7273 2829 0a20 2020  t_contours().   
+0002de10: 2020 2020 2061 7265 206e 6578 7420 6361       are next ca
+0002de20: 6c6c 6564 2e0a 0a20 2020 2020 2020 202a  lled...        *
+0002de30: 2a50 6172 616d 6574 6572 733a 2a2a 0a20  *Parameters:**. 
+0002de40: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0002de50: 6b77 6172 6773 203a 200a 2020 2020 2020  kwargs : .      
+0002de60: 2020 2020 2020 4b65 7977 6f72 6420 6172        Keyword ar
+0002de70: 6775 6d65 6e74 7320 746f 2070 6173 7320  guments to pass 
+0002de80: 746f 2073 656c 662e 6765 745f 6475 6d6d  to self.get_dumm
+0002de90: 795f 696d 6167 6528 2920 7768 656e 2063  y_image() when c
+0002dea0: 7265 6174 696e 670a 2020 2020 2020 2020  reating.        
+0002deb0: 2020 2020 7468 6520 6475 6d6d 7920 696d      the dummy im
+0002dec0: 6167 652e 2053 6565 2064 6f63 756d 656e  age. See documen
+0002ded0: 7461 7469 6f6e 206f 6620 524f 492e 6765  tation of ROI.ge
+0002dee0: 745f 6475 6d6d 795f 696d 6167 6528 292e  t_dummy_image().
+0002def0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0002df00: 2020 2020 2020 2320 4d61 6b65 2069 6d61        # Make ima
+0002df10: 6765 0a20 2020 2020 2020 2069 6d20 3d20  ge.        im = 
+0002df20: 7365 6c66 2e67 6574 5f64 756d 6d79 5f69  self.get_dummy_i
+0002df30: 6d61 6765 282a 2a6b 7761 7267 7329 0a0a  mage(**kwargs)..
+0002df40: 2020 2020 2020 2020 2320 436c 6561 7220          # Clear 
+0002df50: 6d61 736b 2061 6e64 2063 6f6e 746f 7572  mask and contour
+0002df60: 730a 2020 2020 2020 2020 7365 6c66 2e69  s.        self.i
+0002df70: 6e70 7574 5f63 6f6e 746f 7572 7320 3d20  nput_contours = 
+0002df80: 7365 6c66 2e63 6f6e 746f 7572 735b 2278  self.contours["x
+0002df90: 2d79 225d 0a20 2020 2020 2020 2073 656c  -y"].        sel
+0002dfa0: 662e 636f 6e74 6f75 7273 203d 207b 2278  f.contours = {"x
+0002dfb0: 2d79 223a 2073 656c 662e 696e 7075 745f  -y": self.input_
+0002dfc0: 636f 6e74 6f75 7273 7d0a 2020 2020 2020  contours}.      
+0002dfd0: 2020 7365 6c66 2e6c 6f61 6465 645f 6d61    self.loaded_ma
+0002dfe0: 736b 203d 2046 616c 7365 0a20 2020 2020  sk = False.     
+0002dff0: 2020 2073 656c 662e 6d61 736b 203d 204e     self.mask = N
+0002e000: 6f6e 650a 0a20 2020 2020 2020 2023 2041  one..        # A
+0002e010: 7373 6967 6e20 696d 6167 650a 2020 2020  ssign image.    
+0002e020: 2020 2020 7365 6c66 2e73 6574 5f69 6d61      self.set_ima
+0002e030: 6765 2869 6d29 0a0a 2020 2020 6465 6620  ge(im)..    def 
+0002e040: 7365 745f 696d 6167 6528 7365 6c66 2c20  set_image(self, 
+0002e050: 696d 293a 0a20 2020 2020 2020 2022 2222  im):.        """
+0002e060: 5365 7420 7365 6c66 2e69 6d61 6765 2074  Set self.image t
+0002e070: 6f20 6120 6769 7665 6e20 696d 6167 6520  o a given image 
+0002e080: 616e 6420 6164 6a75 7374 2067 656f 6d65  and adjust geome
+0002e090: 7472 6963 2070 726f 7065 7274 6965 730a  tric properties.
+0002e0a0: 2020 2020 2020 2020 6163 636f 7264 696e          accordin
+0002e0b0: 676c 792e 204e 6f74 6520 7468 6174 2073  gly. Note that s
+0002e0c0: 656c 662e 6d61 736b 2077 696c 6c20 6265  elf.mask will be
+0002e0d0: 2072 656d 6f76 6564 2069 6620 7468 6520   removed if the 
+0002e0e0: 6375 7272 656e 7420 6d61 736b 2773 200a  current mask's .
+0002e0f0: 2020 2020 2020 2020 7368 6170 6520 646f          shape do
+0002e100: 6573 6e27 7420 6d61 7463 6820 7468 6520  esn't match the 
+0002e110: 696d 6167 652e 200a 2020 2020 2020 2020  image. .        
+0002e120: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
+0002e130: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
+0002e140: 2073 656c 662e 696d 6167 6520 3d20 696d   self.image = im
+0002e150: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
+0002e160: 6e74 6f75 7273 5f6f 6e6c 7920 3d20 4661  ntours_only = Fa
+0002e170: 6c73 650a 2020 2020 2020 2020 6966 2069  lse.        if i
+0002e180: 6d20 6973 204e 6f6e 653a 0a20 2020 2020  m is None:.     
+0002e190: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
+0002e1a0: 2020 2020 2020 2023 2053 6574 2052 4f49         # Set ROI
+0002e1b0: 2076 6f78 656c 2073 697a 6520 746f 2074   voxel size to t
+0002e1c0: 6861 7420 6f66 206e 6577 2069 6d61 6765  hat of new image
+0002e1d0: 2e0a 2020 2020 2020 2020 2320 4974 2077  ..        # It w
+0002e1e0: 696c 6c20 6265 206e 6565 6465 6420 746f  ill be needed to
+0002e1f0: 2064 6566 696e 6520 736c 6963 6520 7468   define slice th
+0002e200: 6963 6b6e 6573 730a 2020 2020 2020 2020  ickness.        
+0002e210: 2320 696e 2074 6865 2063 6173 6520 6f66  # in the case of
+0002e220: 2061 6e20 524f 4920 7769 7468 2063 6f6e   an ROI with con
+0002e230: 746f 7572 2873 2920 6174 2061 2073 696e  tour(s) at a sin
+0002e240: 676c 6520 7a2d 706f 7369 7469 6f6e 2e0a  gle z-position..
+0002e250: 2020 2020 2020 2020 7365 6c66 2e76 6f78          self.vox
+0002e260: 656c 5f73 697a 6520 3d20 696d 2e67 6574  el_size = im.get
+0002e270: 5f76 6f78 656c 5f73 697a 6528 290a 0a20  _voxel_size().. 
+0002e280: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+0002e290: 7a2d 6469 7374 616e 6365 2062 6574 7765  z-distance betwe
+0002e2a0: 656e 2063 6f6e 746f 7572 7320 6973 2067  en contours is g
+0002e2b0: 7265 6174 6572 2074 6861 6e20 7468 6520  reater than the 
+0002e2c0: 766f 7865 6c0a 2020 2020 2020 2020 2320  voxel.        # 
+0002e2d0: 7a2d 6469 6d65 6e73 696f 6e20 666f 7220  z-dimension for 
+0002e2e0: 7468 6520 6e65 7720 696d 6167 652c 2066  the new image, f
+0002e2f0: 6972 7374 2065 6e73 7572 6520 7468 6174  irst ensure that
+0002e300: 2074 6865 2052 4f49 0a20 2020 2020 2020   the ROI.       
+0002e310: 2023 206d 6173 6b20 6973 2063 7265 6174   # mask is creat
+0002e320: 6564 2077 6974 6820 7468 6520 696e 7465  ed with the inte
+0002e330: 722d 636f 6e74 6f75 7220 7a2d 6469 7374  r-contour z-dist
+0002e340: 616e 6365 2c20 7468 656e 2072 6573 697a  ance, then resiz
+0002e350: 650a 2020 2020 2020 2020 2320 746f 2074  e.        # to t
+0002e360: 6865 2069 6d61 6765 2076 6f78 656c 2073  he image voxel s
+0002e370: 697a 652e 0a20 2020 2020 2020 2069 6620  ize..        if 
+0002e380: 7365 6c66 2e67 6574 5f73 6c69 6365 5f74  self.get_slice_t
+0002e390: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
+0002e3a0: 7328 2920 3e20 7365 6c66 2e69 6d61 6765  s() > self.image
+0002e3b0: 2e67 6574 5f76 6f78 656c 5f73 697a 6528  .get_voxel_size(
+0002e3c0: 295b 325d 3a0a 2020 2020 2020 2020 2020  )[2]:.          
+0002e3d0: 2020 6966 206e 6f74 2028 7365 6c66 2e6d    if not (self.m
+0002e3e0: 6173 6b20 616e 6420 2873 656c 662e 766f  ask and (self.vo
+0002e3f0: 7865 6c5f 7369 7a65 203d 3d20 7365 6c66  xel_size == self
+0002e400: 2e6d 6173 6b2e 766f 7865 6c5f 7369 7a65  .mask.voxel_size
+0002e410: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0002e420: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
+0002e430: 6d61 736b 2876 6f78 656c 5f73 697a 653d  mask(voxel_size=
+0002e440: 7365 6c66 2e76 6f78 656c 5f73 697a 655b  self.voxel_size[
+0002e450: 303a 325d 2c20 666f 7263 653d 5472 7565  0:2], force=True
+0002e460: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002e470: 2020 2320 5468 6520 6d61 736b 2063 7265    # The mask cre
+0002e480: 6174 696f 6e20 7769 6c6c 2068 6176 6520  ation will have 
+0002e490: 7265 6465 6669 6e65 6420 7468 6520 696d  redefined the im
+0002e4a0: 6167 6520 6173 736f 6369 6174 696f 6e2c  age association,
+0002e4b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002e4c0: 2023 2073 6f20 7265 6173 7369 676e 2074   # so reassign t
+0002e4d0: 6865 206e 6577 2069 6d61 6765 2e0a 2020  he new image..  
+0002e4e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0002e4f0: 6c66 2e69 6d61 6765 203d 2069 6d0a 2020  lf.image = im.  
+0002e500: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+0002e510: 6173 6b2e 6d61 7463 685f 7369 7a65 2873  ask.match_size(s
+0002e520: 656c 662e 696d 6167 652c 206d 6574 686f  elf.image, metho
+0002e530: 643d 226e 6561 7265 7374 2229 0a20 2020  d="nearest").   
+0002e540: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
+0002e550: 7474 7228 7365 6c66 2e6d 6173 6b2c 2022  ttr(self.mask, "
+0002e560: 6461 7461 2229 3a0a 2020 2020 2020 2020  data"):.        
+0002e570: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0002e580: 656c 662e 6d61 736b 2e64 6174 612e 6474  elf.mask.data.dt
+0002e590: 7970 6520 3d3d 2062 6f6f 6c3a 0a20 2020  ype == bool:.   
+0002e5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e5b0: 2073 656c 662e 6d61 736b 2e64 6174 6120   self.mask.data 
+0002e5c0: 3d20 7365 6c66 2e6d 6173 6b2e 6461 7461  = self.mask.data
+0002e5d0: 2e61 7374 7970 6528 626f 6f6c 290a 0a20  .astype(bool).. 
+0002e5e0: 2020 2020 2020 2023 2049 6620 6120 6d61         # If a ma
+0002e5f0: 736b 2068 6173 2062 6565 6e20 6c6f 6164  sk has been load
+0002e600: 6564 2c20 6275 7420 646f 6573 6e27 7420  ed, but doesn't 
+0002e610: 6d61 7463 6820 7468 6520 696d 6167 6520  match the image 
+0002e620: 6765 6f6d 6574 7279 2c0a 2020 2020 2020  geometry,.      
+0002e630: 2020 2320 6465 6c65 7465 2074 6865 206d    # delete the m
+0002e640: 6173 6b20 6461 7461 2e20 2028 5468 6973  ask data.  (This
+0002e650: 2073 686f 756c 6420 6d65 616e 2074 6861   should mean tha
+0002e660: 7420 7468 6520 7a2d 6469 7374 616e 6365  t the z-distance
+0002e670: 0a20 2020 2020 2020 2023 2062 6574 7765  .        # betwe
+0002e680: 656e 2063 6f6e 746f 7572 7320 6973 206c  en contours is l
+0002e690: 6573 7320 7468 6174 2074 6865 2076 6f78  ess that the vox
+0002e6a0: 656c 207a 2d64 696d 656e 7369 6f6e 2066  el z-dimension f
+0002e6b0: 6f72 2074 6865 0a20 2020 2020 2020 2023  or the.        #
+0002e6c0: 206e 6577 2069 6d61 6765 2e29 2020 4120   new image.)  A 
+0002e6d0: 6e65 7720 6d61 736b 2077 696c 6c20 6265  new mask will be
+0002e6e0: 2063 7265 6174 6564 2061 7420 7468 6520   created at the 
+0002e6f0: 6e65 7874 2063 616c 6c0a 2020 2020 2020  next call.      
+0002e700: 2020 2320 746f 2061 6363 6573 7320 7468    # to access th
+0002e710: 6520 6d61 736b 2064 6174 612e 0a20 2020  e mask data..   
+0002e720: 2020 2020 2069 6620 7365 6c66 2e6d 6173       if self.mas
+0002e730: 6b20 616e 6420 6e6f 7420 696d 2e68 6173  k and not im.has
+0002e740: 5f73 616d 655f 6765 6f6d 6574 7279 2873  _same_geometry(s
+0002e750: 656c 662e 6d61 736b 293a 0a20 2020 2020  elf.mask):.     
+0002e760: 2020 2020 2020 2069 6620 6765 7461 7474         if getatt
+0002e770: 7228 7365 6c66 2c20 2269 6e70 7574 5f63  r(self, "input_c
+0002e780: 6f6e 746f 7572 7322 2c20 4e6f 6e65 2920  ontours", None) 
+0002e790: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0002e7a0: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
+0002e7b0: 7075 745f 636f 6e74 6f75 7273 203d 2073  put_contours = s
+0002e7c0: 656c 662e 6765 745f 636f 6e74 6f75 7273  elf.get_contours
+0002e7d0: 2822 782d 7922 290a 2020 2020 2020 2020  ("x-y").        
+0002e7e0: 2020 2020 7365 6c66 2e6d 6173 6b20 3d20      self.mask = 
+0002e7f0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0002e800: 2073 656c 662e 6c6f 6164 6564 5f6d 6173   self.loaded_mas
+0002e810: 6b20 3d20 4661 6c73 650a 0a20 2020 2020  k = False..     
+0002e820: 2020 2023 2053 6574 2067 656f 656d 7472     # Set geoemtr
+0002e830: 6963 2069 6e66 6f0a 2020 2020 2020 2020  ic info.        
+0002e840: 6461 7461 5f73 6861 7065 203d 2069 6d2e  data_shape = im.
+0002e850: 6765 745f 6461 7461 2829 2e73 6861 7065  get_data().shape
+0002e860: 0a20 2020 2020 2020 2073 656c 662e 7368  .        self.sh
+0002e870: 6170 6520 3d20 5b64 6174 615f 7368 6170  ape = [data_shap
+0002e880: 655b 315d 2c20 6461 7461 5f73 6861 7065  e[1], data_shape
+0002e890: 5b30 5d2c 2064 6174 615f 7368 6170 655b  [0], data_shape[
+0002e8a0: 325d 5d0a 2020 2020 2020 2020 7365 6c66  2]].        self
+0002e8b0: 2e76 6f78 656c 5f73 697a 6520 3d20 696d  .voxel_size = im
+0002e8c0: 2e67 6574 5f76 6f78 656c 5f73 697a 6528  .get_voxel_size(
+0002e8d0: 290a 2020 2020 2020 2020 7365 6c66 2e6f  ).        self.o
+0002e8e0: 7269 6769 6e20 3d20 696d 2e67 6574 5f6f  rigin = im.get_o
+0002e8f0: 7269 6769 6e28 290a 2020 2020 2020 2020  rigin().        
+0002e900: 7365 6c66 2e61 6666 696e 6520 3d20 696d  self.affine = im
+0002e910: 2e67 6574 5f61 6666 696e 6528 290a 0a20  .get_affine().. 
+0002e920: 2020 2064 6566 2067 6574 5f69 6d61 6765     def get_image
+0002e930: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0002e940: 2222 2252 6574 7572 6e20 496d 6167 6520  """Return Image 
+0002e950: 6f62 6a65 6374 2061 7373 6f63 6961 7465  object associate
+0002e960: 6420 7769 7468 2074 6869 7320 524f 492e  d with this ROI.
+0002e970: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+0002e980: 726e 2073 656c 662e 696d 6167 650a 0a20  rn self.image.. 
+0002e990: 2020 2064 6566 2076 6965 7728 7365 6c66     def view(self
+0002e9a0: 2c20 696e 636c 7564 655f 696d 6167 653d  , include_image=
+0002e9b0: 4661 6c73 652c 2076 6f78 656c 5f73 697a  False, voxel_siz
+0002e9c0: 653d 5b31 2c20 315d 2c20 6275 6666 6572  e=[1, 1], buffer
+0002e9d0: 3d35 2c20 2a2a 6b77 6172 6773 293a 0a20  =5, **kwargs):. 
+0002e9e0: 2020 2020 2020 2022 2222 5669 6577 2074         """View t
+0002e9f0: 6865 2052 4f49 2e0a 0a20 2020 2020 2020  he ROI...       
+0002ea00: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+0002ea10: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0002ea20: 2020 696e 636c 7564 655f 696d 6167 6520    include_image 
+0002ea30: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
+0002ea40: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+0002ea50: 2049 6620 5472 7565 2061 6e64 2074 6869   If True and thi
+0002ea60: 7320 524f 4920 6861 7320 616e 2061 7373  s ROI has an ass
+0002ea70: 6f63 6961 7465 6420 696d 6167 6520 2869  ociated image (i
+0002ea80: 6e20 7365 6c66 2e69 6d61 6765 292c 0a20  n self.image),. 
+0002ea90: 2020 2020 2020 2020 2020 2074 6865 2069             the i
+0002eaa0: 6d61 6765 2077 696c 6c20 6265 2064 6973  mage will be dis
+0002eab0: 706c 6179 6564 2062 6568 696e 6420 7468  played behind th
+0002eac0: 6520 524f 492e 0a0a 2020 2020 2020 2020  e ROI...        
+0002ead0: 766f 7865 6c5f 7369 7a65 203a 206c 6973  voxel_size : lis
+0002eae0: 742c 2064 6566 6175 6c74 3d5b 312c 2031  t, default=[1, 1
+0002eaf0: 5d0a 2020 2020 2020 2020 2020 2020 4966  ].            If
+0002eb00: 2074 6865 2052 4f49 2064 6f65 7320 6e6f   the ROI does no
+0002eb10: 7420 6861 7665 2061 6e20 6173 736f 6369  t have an associ
+0002eb20: 6174 6564 2069 6d61 6765 2061 6e64 2069  ated image and i
+0002eb30: 7320 6465 7363 7269 6265 6420 6f6e 6c79  s described only
+0002eb40: 0a20 2020 2020 2020 2020 2020 2062 7920  .            by 
+0002eb50: 636f 6e74 6f75 7273 2c20 7468 6973 2077  contours, this w
+0002eb60: 696c 6c20 6265 2074 6865 2076 6f78 656c  ill be the voxel
+0002eb70: 2073 697a 6573 2075 7365 6420 696e 2074   sizes used in t
+0002eb80: 6865 2078 2d79 2064 6972 6563 7469 6f6e  he x-y direction
+0002eb90: 0a20 2020 2020 2020 2020 2020 2077 6865  .            whe
+0002eba0: 6e20 636f 6e76 6572 7469 6e67 2074 6865  n converting the
+0002ebb0: 2052 4f49 2074 6f20 6120 6d61 736b 2069   ROI to a mask i
+0002ebc0: 6620 6120 6d61 736b 2070 6c6f 7420 7479  f a mask plot ty
+0002ebd0: 7065 2069 7320 7365 6c65 6374 6564 2e0a  pe is selected..
+0002ebe0: 0a20 2020 2020 2020 2062 7566 6665 7220  .        buffer 
+0002ebf0: 3a20 696e 742c 2064 6566 6175 6c74 3d35  : int, default=5
+0002ec00: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+0002ec10: 7468 6520 524f 4920 646f 6573 206e 6f74  the ROI does not
+0002ec20: 2068 6176 6520 616e 2061 7373 6f63 6961   have an associa
+0002ec30: 7465 6420 696d 6167 6520 616e 6420 6973  ted image and is
+0002ec40: 2064 6573 6372 6962 6564 206f 6e6c 790a   described only.
+0002ec50: 2020 2020 2020 2020 2020 2020 6279 2063              by c
+0002ec60: 6f6e 746f 7572 732c 2074 6869 7320 7769  ontours, this wi
+0002ec70: 6c6c 2062 6520 7468 6520 6e75 6d62 6572  ll be the number
+0002ec80: 206f 6620 6275 6666 6572 2076 6f78 656c   of buffer voxel
+0002ec90: 7320 0a20 2020 2020 2020 2020 2020 2028  s .            (
+0002eca0: 692e 652e 2077 6869 7465 7370 6163 6529  i.e. whitespace)
+0002ecb0: 2064 6973 706c 6179 6564 2061 726f 756e   displayed aroun
+0002ecc0: 6420 7468 6520 524f 492e 0a20 2020 2020  d the ROI..     
+0002ecd0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+0002ece0: 6672 6f6d 2073 6b72 742e 6265 7474 6572  from skrt.better
+0002ecf0: 5f76 6965 7765 7220 696d 706f 7274 2042  _viewer import B
+0002ed00: 6574 7465 7256 6965 7765 720a 2020 2020  etterViewer.    
+0002ed10: 2020 2020 7365 6c66 2e6c 6f61 6428 290a      self.load().
+0002ed20: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0002ed30: 2023 2053 6574 2069 6e69 7469 616c 207a   # Set initial z
+0002ed40: 6f6f 6d20 616d 6f75 6e74 2061 6e64 2063  oom amount and c
+0002ed50: 656e 7472 650a 2020 2020 2020 2020 6966  entre.        if
+0002ed60: 2073 656c 662e 696d 6167 6520 6973 206e   self.image is n
+0002ed70: 6f74 204e 6f6e 6520 616e 6420 6e6f 7420  ot None and not 
+0002ed80: 7365 6c66 2e63 6f6e 746f 7572 735f 6f6e  self.contours_on
+0002ed90: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
+0002eda0: 7669 6577 203d 206b 7761 7267 732e 6765  view = kwargs.ge
+0002edb0: 7428 2269 6e69 745f 7669 6577 222c 2022  t("init_view", "
+0002edc0: 782d 7922 290a 2020 2020 2020 2020 2020  x-y").          
+0002edd0: 2020 6178 6573 203d 2073 6b72 742e 696d    axes = skrt.im
+0002ede0: 6167 652e 5f70 6c6f 745f 6178 6573 5b76  age._plot_axes[v
+0002edf0: 6965 775d 0a20 2020 2020 2020 2020 2020  iew].           
+0002ee00: 2065 7874 656e 7473 203d 205b 7365 6c66   extents = [self
+0002ee10: 2e67 6574 5f6c 656e 6774 6828 6178 3d61  .get_length(ax=a
+0002ee20: 7829 2066 6f72 2061 7820 696e 2061 7865  x) for ax in axe
+0002ee30: 735d 0a20 2020 2020 2020 2020 2020 2069  s].            i
+0002ee40: 6d5f 6c69 6d73 203d 205b 7365 6c66 2e69  m_lims = [self.i
+0002ee50: 6d61 6765 2e67 6574 5f6c 656e 6774 6828  mage.get_length(
+0002ee60: 6178 3d61 7829 2066 6f72 2061 7820 696e  ax=ax) for ax in
+0002ee70: 2061 7865 735d 0a20 2020 2020 2020 2020   axes].         
+0002ee80: 2020 207a 6f6f 6d20 3d20 6d69 6e28 5b69     zoom = min([i
+0002ee90: 6d5f 6c69 6d73 5b69 5d20 2f20 6578 7465  m_lims[i] / exte
+0002eea0: 6e74 735b 695d 2066 6f72 2069 2069 6e20  nts[i] for i in 
+0002eeb0: 7261 6e67 6528 3229 5d29 202a 2030 2e38  range(2)]) * 0.8
+0002eec0: 0a20 2020 2020 2020 2020 2020 207a 6f6f  .            zoo
+0002eed0: 6d5f 6365 6e74 7265 203d 2073 656c 662e  m_centre = self.
+0002eee0: 6765 745f 6365 6e74 7265 2829 0a20 2020  get_centre().   
+0002eef0: 2020 2020 2020 2020 2069 6620 7a6f 6f6d           if zoom
+0002ef00: 203e 2031 3a0a 2020 2020 2020 2020 2020   > 1:.          
+0002ef10: 2020 2020 2020 6b77 6172 6773 2e73 6574        kwargs.set
+0002ef20: 6465 6661 756c 7428 227a 6f6f 6d22 2c20  default("zoom", 
+0002ef30: 7a6f 6f6d 290a 2020 2020 2020 2020 2020  zoom).          
+0002ef40: 2020 2020 2020 6b77 6172 6773 2e73 6574        kwargs.set
+0002ef50: 6465 6661 756c 7428 227a 6f6f 6d5f 6365  default("zoom_ce
+0002ef60: 6e74 7265 222c 207a 6f6f 6d5f 6365 6e74  ntre", zoom_cent
+0002ef70: 7265 290a 2020 2020 2020 2020 2020 2020  re).            
+0002ef80: 6966 2022 696e 6974 5f70 6f73 2220 6e6f  if "init_pos" no
+0002ef90: 7420 696e 206b 7761 7267 7320 616e 6420  t in kwargs and 
+0002efa0: 2269 6e69 745f 736c 6963 6522 206e 6f74  "init_slice" not
+0002efb0: 2069 6e20 6b77 6172 6773 3a0a 2020 2020   in kwargs:.    
+0002efc0: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+0002efd0: 6773 5b22 696e 6974 5f70 6f73 225d 203d  gs["init_pos"] =
+0002efe0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0002eff0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0002f000: 6765 745f 6365 6e74 7265 2829 5b73 6b72  get_centre()[skr
+0002f010: 742e 696d 6167 652e 5f73 6c69 6365 5f61  t.image._slice_a
+0002f020: 7865 735b 7669 6577 5d5d 0a0a 2020 2020  xes[view]]..    
+0002f030: 2020 2020 6b77 6172 6773 5b22 7368 6f77      kwargs["show
+0002f040: 225d 203d 2046 616c 7365 0a20 2020 2020  "] = False.     
+0002f050: 2020 2069 6620 2270 6c6f 745f 7479 7065     if "plot_type
+0002f060: 2220 696e 206b 7761 7267 733a 0a20 2020  " in kwargs:.   
+0002f070: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
+0002f080: 2272 6f69 5f70 6c6f 745f 7479 7065 225d  "roi_plot_type"]
+0002f090: 203d 206b 7761 7267 732e 706f 7028 2270   = kwargs.pop("p
+0002f0a0: 6c6f 745f 7479 7065 2229 0a0a 2020 2020  lot_type")..    
+0002f0b0: 2020 2020 2320 5669 6577 2077 6974 6820      # View with 
+0002f0c0: 696d 6167 650a 2020 2020 2020 2020 6966  image.        if
+0002f0d0: 2069 6e63 6c75 6465 5f69 6d61 6765 2061   include_image a
+0002f0e0: 6e64 2073 656c 662e 696d 6167 6520 6973  nd self.image is
+0002f0f0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0002f100: 2020 2020 2020 2062 7620 3d20 4265 7474         bv = Bett
+0002f110: 6572 5669 6577 6572 2873 656c 662e 696d  erViewer(self.im
+0002f120: 6167 652c 2072 6f69 733d 7365 6c66 2c20  age, rois=self, 
+0002f130: 2a2a 6b77 6172 6773 290a 0a20 2020 2020  **kwargs)..     
+0002f140: 2020 2023 2056 6965 7720 7769 7468 6f75     # View withou
+0002f150: 7420 696d 6167 650a 2020 2020 2020 2020  t image.        
+0002f160: 656c 7365 3a0a 0a20 2020 2020 2020 2020  else:..         
+0002f170: 2020 2023 204d 616b 6520 6475 6d6d 7920     # Make dummy 
+0002f180: 696d 6167 6520 666f 7220 6261 636b 6772  image for backgr
+0002f190: 6f75 6e64 0a20 2020 2020 2020 2020 2020  ound.           
+0002f1a0: 2072 6f69 5f74 6d70 203d 2073 656c 662e   roi_tmp = self.
+0002f1b0: 636c 6f6e 6528 636f 7079 5f64 6174 613d  clone(copy_data=
+0002f1c0: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+0002f1d0: 2020 2069 6d20 3d20 7365 6c66 2e67 6574     im = self.get
+0002f1e0: 5f64 756d 6d79 5f69 6d61 6765 280a 2020  _dummy_image(.  
+0002f1f0: 2020 2020 2020 2020 2020 2020 2020 766f                vo
+0002f200: 7865 6c5f 7369 7a65 3d76 6f78 656c 5f73  xel_size=voxel_s
+0002f210: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
+0002f220: 2020 2020 2062 7566 6665 723d 6275 6666       buffer=buff
+0002f230: 6572 0a20 2020 2020 2020 2020 2020 2029  er.            )
+0002f240: 0a20 2020 2020 2020 2020 2020 2069 6d2e  .            im.
+0002f250: 7469 746c 6520 3d20 7365 6c66 2e6e 616d  title = self.nam
+0002f260: 650a 2020 2020 2020 2020 2020 2020 726f  e.            ro
+0002f270: 695f 746d 702e 7365 745f 696d 6167 6528  i_tmp.set_image(
+0002f280: 696d 290a 0a20 2020 2020 2020 2020 2020  im)..           
+0002f290: 2022 2222 0a20 2020 2020 2020 2020 2020   """.           
+0002f2a0: 2072 6f69 5f74 6d70 203d 2073 656c 660a   roi_tmp = self.
+0002f2b0: 0a20 2020 2020 2020 2020 2020 2023 204d  .            # M
+0002f2c0: 616b 6520 6475 6d6d 7920 696d 6167 6520  ake dummy image 
+0002f2d0: 666f 7220 6261 636b 6772 6f75 6e64 0a20  for background. 
+0002f2e0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0002f2f0: 6c66 2e63 6f6e 746f 7572 735f 6f6e 6c79  lf.contours_only
+0002f300: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002f310: 2020 696d 203d 2073 656c 662e 6765 745f    im = self.get_
+0002f320: 6475 6d6d 795f 696d 6167 6528 0a20 2020  dummy_image(.   
 0002f330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f340: 726f 695f 746d 702e 7365 745f 696d 6167  roi_tmp.set_imag
-0002f350: 6528 696d 290a 2020 2020 2020 2020 2020  e(im).          
-0002f360: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0002f370: 2020 2020 2020 2020 696d 203d 2073 6b72          im = skr
-0002f380: 742e 696d 6167 652e 496d 6167 6528 0a20  t.image.Image(. 
-0002f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f3a0: 2020 206e 702e 6f6e 6573 2873 656c 662e     np.ones(self.
-0002f3b0: 7368 6170 6529 202a 2031 6534 2c0a 2020  shape) * 1e4,.  
-0002f3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f3d0: 2020 6166 6669 6e65 3d73 656c 662e 6166    affine=self.af
-0002f3e0: 6669 6e65 2c0a 2020 2020 2020 2020 2020  fine,.          
-0002f3f0: 2020 2020 2020 2020 2020 7469 746c 653d            title=
-0002f400: 7365 6c66 2e6e 616d 650a 2020 2020 2020  self.name.      
-0002f410: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0002f420: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0002f430: 2020 2020 2020 2020 2023 2043 7265 6174           # Creat
-0002f440: 6520 7669 6577 6572 0a20 2020 2020 2020  e viewer.       
-0002f450: 2020 2020 2062 7620 3d20 4265 7474 6572       bv = Better
-0002f460: 5669 6577 6572 2869 6d2c 2072 6f69 733d  Viewer(im, rois=
-0002f470: 726f 695f 746d 702c 202a 2a6b 7761 7267  roi_tmp, **kwarg
-0002f480: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
-0002f490: 2320 4164 6a75 7374 2055 490a 2020 2020  # Adjust UI.    
-0002f4a0: 2020 2020 2020 2020 6e6f 5f75 6920 3d20          no_ui = 
-0002f4b0: 6b77 6172 6773 2e67 6574 2822 6e6f 5f75  kwargs.get("no_u
-0002f4c0: 6922 2c20 736b 7274 2e63 6f72 652e 4465  i", skrt.core.De
-0002f4d0: 6661 756c 7473 2829 2e6e 6f5f 7569 290a  faults().no_ui).
-0002f4e0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0002f4f0: 6f74 206e 6f5f 7569 3a0a 2020 2020 2020  ot no_ui:.      
-0002f500: 2020 2020 2020 2020 2020 6276 2e6d 616b            bv.mak
-0002f510: 655f 7569 286e 6f5f 726f 693d 5472 7565  e_ui(no_roi=True
-0002f520: 2c20 6e6f 5f69 6e74 656e 7369 7479 3d54  , no_intensity=T
-0002f530: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0002f540: 2020 2020 2062 762e 7368 6f77 2829 0a20       bv.show(). 
-0002f550: 2020 2020 2020 2072 6574 7572 6e20 6276         return bv
-0002f560: 0a0a 2020 2020 6465 6620 5f70 6c6f 745f  ..    def _plot_
-0002f570: 6d61 736b 280a 2020 2020 2020 2020 7365  mask(.        se
-0002f580: 6c66 2c0a 2020 2020 2020 2020 7669 6577  lf,.        view
-0002f590: 2c0a 2020 2020 2020 2020 6964 782c 0a20  ,.        idx,. 
-0002f5a0: 2020 2020 2020 206d 6173 6b5f 6b77 6172         mask_kwar
-0002f5b0: 6773 3d4e 6f6e 652c 0a20 2020 2020 2020  gs=None,.       
-0002f5c0: 206f 7061 6369 7479 3d4e 6f6e 652c 0a20   opacity=None,. 
-0002f5d0: 2020 2020 2020 2069 6e63 6c75 6465 5f69         include_i
-0002f5e0: 6d61 6765 3d46 616c 7365 2c0a 2020 2020  mage=False,.    
-0002f5f0: 2020 2020 7a6f 6f6d 3d4e 6f6e 652c 0a20      zoom=None,. 
-0002f600: 2020 2020 2020 207a 6f6f 6d5f 6365 6e74         zoom_cent
-0002f610: 7265 3d4e 6f6e 652c 0a20 2020 2020 2020  re=None,.       
-0002f620: 2063 6f6c 6f72 3d4e 6f6e 652c 0a20 2020   color=None,.   
-0002f630: 2020 2020 2066 6c61 7474 656e 3d46 616c       flatten=Fal
-0002f640: 7365 2c0a 2020 2020 2020 2020 7368 6f77  se,.        show
-0002f650: 3d54 7275 652c 0a20 2020 2020 2020 202a  =True,.        *
-0002f660: 2a6b 7761 7267 732c 0a20 2020 2029 3a0a  *kwargs,.    ):.
-0002f670: 2020 2020 2020 2020 2222 2250 6c6f 7420          """Plot 
-0002f680: 7468 6520 524f 4920 6173 2061 206d 6173  the ROI as a mas
-0002f690: 6b2e 2222 220a 0a20 2020 2020 2020 2073  k."""..        s
-0002f6a0: 656c 662e 6372 6561 7465 5f6d 6173 6b28  elf.create_mask(
-0002f6b0: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
-0002f6c0: 662e 656d 7074 793a 0a20 2020 2020 2020  f.empty:.       
-0002f6d0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-0002f6e0: 2020 2020 6d61 736b 5f73 6c69 6365 203d      mask_slice =
-0002f6f0: 2073 656c 662e 6765 745f 736c 6963 6528   self.get_slice(
-0002f700: 7669 6577 2c20 6964 783d 6964 782c 2066  view, idx=idx, f
-0002f710: 6c61 7474 656e 3d66 6c61 7474 656e 290a  latten=flatten).
-0002f720: 0a20 2020 2020 2020 2023 204d 616b 6520  .        # Make 
-0002f730: 636f 6c6f 726d 6170 0a20 2020 2020 2020  colormap.       
-0002f740: 206e 6f72 6d20 3d20 6d61 7470 6c6f 746c   norm = matplotl
-0002f750: 6962 2e63 6f6c 6f72 732e 4e6f 726d 616c  ib.colors.Normal
-0002f760: 697a 6528 290a 2020 2020 2020 2020 636d  ize().        cm
-0002f770: 6170 203d 206d 6174 706c 6f74 6c69 622e  ap = matplotlib.
-0002f780: 636d 2e68 7376 0a20 2020 2020 2020 2073  cm.hsv.        s
-0002f790: 5f63 6f6c 6f72 7320 3d20 636d 6170 286e  _colors = cmap(n
-0002f7a0: 6f72 6d28 6d61 736b 5f73 6c69 6365 2929  orm(mask_slice))
-0002f7b0: 0a20 2020 2020 2020 2069 6620 636f 6c6f  .        if colo
-0002f7c0: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
-0002f7d0: 2020 2020 2020 2063 6f6c 6f72 203d 2073         color = s
-0002f7e0: 656c 662e 636f 6c6f 720a 2020 2020 2020  elf.color.      
-0002f7f0: 2020 735f 636f 6c6f 7273 5b6d 6173 6b5f    s_colors[mask_
-0002f800: 736c 6963 6520 3e20 302c 203a 5d20 3d20  slice > 0, :] = 
-0002f810: 636f 6c6f 720a 2020 2020 2020 2020 735f  color.        s_
-0002f820: 636f 6c6f 7273 5b6d 6173 6b5f 736c 6963  colors[mask_slic
-0002f830: 6520 3d3d 2030 2c20 3a5d 203d 2028 302c  e == 0, :] = (0,
-0002f840: 2030 2c20 302c 2030 290a 0a20 2020 2020   0, 0, 0)..     
-0002f850: 2020 2023 2047 6574 2070 6c6f 7474 696e     # Get plottin
-0002f860: 6720 6172 6775 6d65 6e74 730a 2020 2020  g arguments.    
-0002f870: 2020 2020 6966 206d 6173 6b5f 6b77 6172      if mask_kwar
-0002f880: 6773 2069 7320 4e6f 6e65 3a0a 2020 2020  gs is None:.    
-0002f890: 2020 2020 2020 2020 6d61 736b 5f6b 7761          mask_kwa
-0002f8a0: 7267 7320 3d20 7b7d 0a20 2020 2020 2020  rgs = {}.       
-0002f8b0: 206d 6173 6b5f 6b77 6172 6773 2e73 6574   mask_kwargs.set
-0002f8c0: 6465 6661 756c 7428 2261 6c70 6861 222c  default("alpha",
-0002f8d0: 206f 7061 6369 7479 290a 2020 2020 2020   opacity).      
-0002f8e0: 2020 6d61 736b 5f6b 7761 7267 732e 7365    mask_kwargs.se
-0002f8f0: 7464 6566 6175 6c74 2822 696e 7465 7270  tdefault("interp
-0002f900: 6f6c 6174 696f 6e22 2c20 226e 6f6e 6522  olation", "none"
-0002f910: 290a 0a20 2020 2020 2020 2023 204d 616b  )..        # Mak
-0002f920: 6520 706c 6f74 0a20 2020 2020 2020 2069  e plot.        i
-0002f930: 6620 696e 636c 7564 655f 696d 6167 6520  f include_image 
-0002f940: 616e 6420 7365 6c66 2e69 6d61 6765 2069  and self.image i
-0002f950: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0002f960: 2020 2020 2020 2020 696d 5f6d 6173 6b20          im_mask 
-0002f970: 3d20 6b77 6172 6773 2e67 6574 2822 6d61  = kwargs.get("ma
-0002f980: 736b 222c 204e 6f6e 6529 0a20 2020 2020  sk", None).     
-0002f990: 2020 2020 2020 2069 6d5f 6d61 736b 6564         im_masked
-0002f9a0: 203d 206b 7761 7267 732e 6765 7428 226d   = kwargs.get("m
-0002f9b0: 6173 6b65 6422 2c20 5472 7565 290a 2020  asked", True).  
-0002f9c0: 2020 2020 2020 2020 2020 696d 5f69 6e76            im_inv
-0002f9d0: 6572 745f 6d61 736b 203d 206b 7761 7267  ert_mask = kwarg
-0002f9e0: 732e 6765 7428 2269 6e76 6572 745f 6d61  s.get("invert_ma
-0002f9f0: 736b 222c 2046 616c 7365 290a 2020 2020  sk", False).    
-0002fa00: 2020 2020 2020 2020 696d 5f6d 6173 6b5f          im_mask_
-0002fa10: 636f 6c6f 7220 3d20 6b77 6172 6773 2e67  color = kwargs.g
-0002fa20: 6574 2822 6d61 736b 5f63 6f6c 6f72 222c  et("mask_color",
-0002fa30: 2022 626c 6163 6b22 290a 2020 2020 2020   "black").      
-0002fa40: 2020 2020 2020 7365 6c66 2e69 6d61 6765        self.image
-0002fa50: 2e70 6c6f 7428 7669 6577 2c20 6964 783d  .plot(view, idx=
-0002fa60: 6964 782c 2061 783d 7365 6c66 2e61 782c  idx, ax=self.ax,
-0002fa70: 2073 686f 773d 4661 6c73 652c 0a20 2020   show=False,.   
-0002fa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fa90: 206d 6173 6b3d 696d 5f6d 6173 6b2c 206d   mask=im_mask, m
-0002faa0: 6173 6b65 643d 696d 5f6d 6173 6b65 642c  asked=im_masked,
-0002fab0: 2069 6e76 6572 745f 6d61 736b 3d69 6d5f   invert_mask=im_
-0002fac0: 696e 7665 7274 5f6d 6173 6b2c 0a20 2020  invert_mask,.   
-0002fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fae0: 206d 6173 6b5f 636f 6c6f 723d 696d 5f6d   mask_color=im_m
-0002faf0: 6173 6b5f 636f 6c6f 7229 0a20 2020 2020  ask_color).     
-0002fb00: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0002fb10: 2020 2020 2069 6620 6b77 6172 6773 2e67       if kwargs.g
-0002fb20: 6574 2822 7469 746c 6522 2c20 4e6f 6e65  et("title", None
-0002fb30: 2920 6973 204e 6f6e 653a 0a20 2020 2020  ) is None:.     
-0002fb40: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
-0002fb50: 735b 2274 6974 6c65 225d 203d 2073 656c  s["title"] = sel
-0002fb60: 662e 6e61 6d65 0a0a 2020 2020 2020 2020  f.name..        
-0002fb70: 7365 6c66 2e61 782e 696d 7368 6f77 2873  self.ax.imshow(s
-0002fb80: 5f63 6f6c 6f72 732c 2065 7874 656e 743d  _colors, extent=
-0002fb90: 7365 6c66 2e6d 6173 6b2e 706c 6f74 5f65  self.mask.plot_e
-0002fba0: 7874 656e 745b 7669 6577 5d2c 200a 2020  xtent[view], .  
-0002fbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fbc0: 2020 2020 202a 2a6d 6173 6b5f 6b77 6172       **mask_kwar
-0002fbd0: 6773 290a 0a20 2020 2020 2020 2023 2041  gs)..        # A
-0002fbe0: 646a 7573 7420 6178 6573 0a20 2020 2020  djust axes.     
-0002fbf0: 2020 2073 6b72 742e 696d 6167 652e 496d     skrt.image.Im
-0002fc00: 6167 652e 6c61 6265 6c5f 6178 2873 656c  age.label_ax(sel
-0002fc10: 662c 2076 6965 772c 2069 6478 2c20 2a2a  f, view, idx, **
-0002fc20: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-0002fc30: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
-0002fc40: 2e7a 6f6f 6d5f 6178 2873 656c 662c 2076  .zoom_ax(self, v
-0002fc50: 6965 772c 207a 6f6f 6d2c 207a 6f6f 6d5f  iew, zoom, zoom_
-0002fc60: 6365 6e74 7265 290a 2020 2020 2020 2020  centre).        
-0002fc70: 6966 2073 686f 773a 0a20 2020 2020 2020  if show:.       
-0002fc80: 2020 2020 2070 6c74 2e73 686f 7728 290a       plt.show().
-0002fc90: 0a20 2020 2064 6566 205f 706c 6f74 5f63  .    def _plot_c
-0002fca0: 6f6e 746f 7572 280a 2020 2020 2020 2020  ontour(.        
-0002fcb0: 7365 6c66 2c0a 2020 2020 2020 2020 7669  self,.        vi
-0002fcc0: 6577 2c0a 2020 2020 2020 2020 6964 782c  ew,.        idx,
-0002fcd0: 0a20 2020 2020 2020 2063 6f6e 746f 7572  .        contour
-0002fce0: 5f6b 7761 7267 733d 4e6f 6e65 2c0a 2020  _kwargs=None,.  
-0002fcf0: 2020 2020 2020 6c69 6e65 7769 6474 683d        linewidth=
-0002fd00: 4e6f 6e65 2c0a 2020 2020 2020 2020 6365  None,.        ce
-0002fd10: 6e74 726f 6964 3d46 616c 7365 2c0a 2020  ntroid=False,.  
-0002fd20: 2020 2020 2020 696e 636c 7564 655f 696d        include_im
-0002fd30: 6167 653d 4661 6c73 652c 0a20 2020 2020  age=False,.     
-0002fd40: 2020 207a 6f6f 6d3d 4e6f 6e65 2c0a 2020     zoom=None,.  
-0002fd50: 2020 2020 2020 7a6f 6f6d 5f63 656e 7472        zoom_centr
-0002fd60: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
-0002fd70: 636f 6c6f 723d 4e6f 6e65 2c0a 2020 2020  color=None,.    
-0002fd80: 2020 2020 666c 6174 7465 6e3d 4661 6c73      flatten=Fals
-0002fd90: 652c 0a20 2020 2020 2020 2073 686f 773d  e,.        show=
-0002fda0: 5472 7565 2c0a 2020 2020 2020 2020 2a2a  True,.        **
-0002fdb0: 6b77 6172 6773 2c0a 2020 2020 293a 0a20  kwargs,.    ):. 
-0002fdc0: 2020 2020 2020 2022 2222 506c 6f74 2074         """Plot t
-0002fdd0: 6865 2052 4f49 2061 7320 6120 636f 6e74  he ROI as a cont
-0002fde0: 6f75 722e 2222 220a 0a20 2020 2020 2020  our."""..       
-0002fdf0: 2073 656c 662e 6c6f 6164 2829 0a20 2020   self.load().   
-0002fe00: 2020 2020 2069 6620 286e 6f74 2073 656c       if (not sel
-0002fe10: 662e 6f6e 5f73 6c69 6365 2876 6965 772c  f.on_slice(view,
-0002fe20: 2069 6478 3d69 6478 2920 616e 6420 6e6f   idx=idx) and no
-0002fe30: 7420 666c 6174 7465 6e29 206f 7220 7365  t flatten) or se
-0002fe40: 6c66 2e65 6d70 7479 3a0a 2020 2020 2020  lf.empty:.      
-0002fe50: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-0002fe60: 2020 2020 2020 636f 6e74 6f75 725f 6b77        contour_kw
-0002fe70: 6172 6773 203d 207b 7d20 6966 2063 6f6e  args = {} if con
-0002fe80: 746f 7572 5f6b 7761 7267 7320 6973 204e  tour_kwargs is N
-0002fe90: 6f6e 6520 656c 7365 2063 6f6e 746f 7572  one else contour
-0002fea0: 5f6b 7761 7267 730a 2020 2020 2020 2020  _kwargs.        
-0002feb0: 636f 6e74 6f75 725f 6b77 6172 6773 2e73  contour_kwargs.s
-0002fec0: 6574 6465 6661 756c 7428 2263 6f6c 6f72  etdefault("color
-0002fed0: 222c 2063 6f6c 6f72 290a 2020 2020 2020  ", color).      
-0002fee0: 2020 636f 6e74 6f75 725f 6b77 6172 6773    contour_kwargs
-0002fef0: 2e73 6574 6465 6661 756c 7428 226c 696e  .setdefault("lin
-0002ff00: 6577 6964 7468 222c 206c 696e 6577 6964  ewidth", linewid
-0002ff10: 7468 290a 0a20 2020 2020 2020 2023 2050  th)..        # P
-0002ff20: 6c6f 7420 756e 6465 726c 7969 6e67 2069  lot underlying i
-0002ff30: 6d61 6765 0a20 2020 2020 2020 2069 6620  mage.        if 
-0002ff40: 696e 636c 7564 655f 696d 6167 6520 616e  include_image an
-0002ff50: 6420 7365 6c66 2e69 6d61 6765 2069 7320  d self.image is 
-0002ff60: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0002ff70: 2020 2020 2020 696d 5f6d 6173 6b20 3d20        im_mask = 
-0002ff80: 6b77 6172 6773 2e67 6574 2822 6d61 736b  kwargs.get("mask
-0002ff90: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
-0002ffa0: 2020 2020 2069 6d5f 6d61 736b 6564 203d       im_masked =
-0002ffb0: 206b 7761 7267 732e 6765 7428 226d 6173   kwargs.get("mas
-0002ffc0: 6b65 6422 2c20 5472 7565 290a 2020 2020  ked", True).    
-0002ffd0: 2020 2020 2020 2020 696d 5f69 6e76 6572          im_inver
-0002ffe0: 745f 6d61 736b 203d 206b 7761 7267 732e  t_mask = kwargs.
-0002fff0: 6765 7428 2269 6e76 6572 745f 6d61 736b  get("invert_mask
-00030000: 222c 2046 616c 7365 290a 2020 2020 2020  ", False).      
-00030010: 2020 2020 2020 696d 5f6d 6173 6b5f 636f        im_mask_co
-00030020: 6c6f 7220 3d20 6b77 6172 6773 2e67 6574  lor = kwargs.get
-00030030: 2822 6d61 736b 5f63 6f6c 6f72 222c 2022  ("mask_color", "
-00030040: 626c 6163 6b22 290a 2020 2020 2020 2020  black").        
-00030050: 2020 2020 7365 6c66 2e69 6d61 6765 2e70      self.image.p
-00030060: 6c6f 7428 7669 6577 2c20 6964 783d 6964  lot(view, idx=id
-00030070: 782c 2061 783d 7365 6c66 2e61 782c 2073  x, ax=self.ax, s
-00030080: 686f 773d 4661 6c73 652c 0a20 2020 2020  how=False,.     
-00030090: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000300a0: 6173 6b3d 696d 5f6d 6173 6b2c 206d 6173  ask=im_mask, mas
-000300b0: 6b65 643d 696d 5f6d 6173 6b65 642c 2069  ked=im_masked, i
-000300c0: 6e76 6572 745f 6d61 736b 3d69 6d5f 696e  nvert_mask=im_in
-000300d0: 7665 7274 5f6d 6173 6b2c 0a20 2020 2020  vert_mask,.     
-000300e0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000300f0: 6173 6b5f 636f 6c6f 723d 696d 5f6d 6173  ask_color=im_mas
-00030100: 6b5f 636f 6c6f 7229 0a20 2020 2020 2020  k_color).       
-00030110: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00030120: 2020 2069 6620 6b77 6172 6773 2e67 6574     if kwargs.get
-00030130: 2822 7469 746c 6522 2c20 4e6f 6e65 2920  ("title", None) 
-00030140: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00030150: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
-00030160: 2274 6974 6c65 225d 203d 2073 656c 662e  "title"] = self.
-00030170: 6e61 6d65 0a0a 2020 2020 2020 2020 2320  name..        # 
-00030180: 4765 7420 636f 6e74 6f75 7220 706f 696e  Get contour poin
-00030190: 7473 0a20 2020 2020 2020 2069 6620 666c  ts.        if fl
-000301a0: 6174 7465 6e3a 0a20 2020 2020 2020 2020  atten:.         
-000301b0: 2020 206d 6173 6b20 3d20 7365 6c66 2e67     mask = self.g
-000301c0: 6574 5f73 6c69 6365 2876 6965 772c 2069  et_slice(view, i
-000301d0: 6478 3d69 6478 2c20 666c 6174 7465 6e3d  dx=idx, flatten=
-000301e0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-000301f0: 2020 636f 6e74 6f75 7273 203d 2073 656c    contours = sel
-00030200: 662e 6d61 736b 5f74 6f5f 636f 6e74 6f75  f.mask_to_contou
-00030210: 7273 286d 6173 6b2c 2076 6965 772c 2069  rs(mask, view, i
-00030220: 6e76 6572 743d 5472 7565 290a 2020 2020  nvert=True).    
-00030230: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00030240: 2020 2020 2020 636f 6e74 6f75 7273 203d        contours =
-00030250: 2073 656c 662e 6765 745f 636f 6e74 6f75   self.get_contou
-00030260: 7273 2876 6965 772c 2069 6478 5f61 735f  rs(view, idx_as_
-00030270: 6b65 793d 5472 7565 295b 6964 785d 0a0a  key=True)[idx]..
-00030280: 2020 2020 2020 2020 2320 506c 6f74 2063          # Plot c
-00030290: 6f6e 746f 7572 0a20 2020 2020 2020 2066  ontour.        f
-000302a0: 6f72 2070 6f69 6e74 7320 696e 2063 6f6e  or points in con
-000302b0: 746f 7572 733a 0a20 2020 2020 2020 2020  tours:.         
-000302c0: 2020 2070 6f69 6e74 735f 7820 3d20 5b70     points_x = [p
-000302d0: 5b30 5d20 666f 7220 7020 696e 2070 6f69  [0] for p in poi
-000302e0: 6e74 735d 0a20 2020 2020 2020 2020 2020  nts].           
-000302f0: 2070 6f69 6e74 735f 7920 3d20 5b70 5b31   points_y = [p[1
-00030300: 5d20 666f 7220 7020 696e 2070 6f69 6e74  ] for p in point
-00030310: 735d 0a20 2020 2020 2020 2020 2020 2070  s].            p
-00030320: 6f69 6e74 735f 782e 6170 7065 6e64 2870  oints_x.append(p
-00030330: 6f69 6e74 735f 785b 305d 290a 2020 2020  oints_x[0]).    
-00030340: 2020 2020 2020 2020 706f 696e 7473 5f79          points_y
-00030350: 2e61 7070 656e 6428 706f 696e 7473 5f79  .append(points_y
-00030360: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
-00030370: 2073 656c 662e 6178 2e70 6c6f 7428 706f   self.ax.plot(po
-00030380: 696e 7473 5f78 2c20 706f 696e 7473 5f79  ints_x, points_y
-00030390: 2c20 2a2a 636f 6e74 6f75 725f 6b77 6172  , **contour_kwar
-000303a0: 6773 290a 0a20 2020 2020 2020 2023 2050  gs)..        # P
-000303b0: 6c6f 7420 6365 6e74 726f 6964 2070 6f69  lot centroid poi
-000303c0: 6e74 0a20 2020 2020 2020 2069 6620 6365  nt.        if ce
-000303d0: 6e74 726f 6964 3a0a 2020 2020 2020 2020  ntroid:.        
-000303e0: 2020 2020 6966 206e 6f74 2066 6c61 7474      if not flatt
-000303f0: 656e 3a0a 2020 2020 2020 2020 2020 2020  en:.            
-00030400: 2020 2020 6365 6e74 726f 6964 5f70 6f69      centroid_poi
-00030410: 6e74 7320 3d20 7365 6c66 2e67 6574 5f63  nts = self.get_c
-00030420: 656e 7472 6f69 6428 0a20 2020 2020 2020  entroid(.       
-00030430: 2020 2020 2020 2020 2020 2020 2076 6965               vie
-00030440: 772c 2073 696e 676c 655f 736c 6963 653d  w, single_slice=
-00030450: 5472 7565 2c20 6964 783d 6964 7829 0a20  True, idx=idx). 
-00030460: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00030470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00030480: 2063 656e 7472 6f69 645f 3364 203d 2073   centroid_3d = s
-00030490: 656c 662e 6765 745f 6365 6e74 726f 6964  elf.get_centroid
-000304a0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-000304b0: 2020 2078 5f61 782c 2079 5f61 7820 3d20     x_ax, y_ax = 
-000304c0: 736b 7274 2e69 6d61 6765 2e5f 706c 6f74  skrt.image._plot
-000304d0: 5f61 7865 735b 7669 6577 5d0a 2020 2020  _axes[view].    
-000304e0: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
-000304f0: 726f 6964 5f70 6f69 6e74 7320 3d20 5b63  roid_points = [c
-00030500: 656e 7472 6f69 645f 3364 5b78 5f61 785d  entroid_3d[x_ax]
-00030510: 2c20 6365 6e74 726f 6964 5f33 645b 795f  , centroid_3d[y_
-00030520: 6178 5d5d 0a20 2020 2020 2020 2020 2020  ax]].           
-00030530: 2073 656c 662e 6178 2e70 6c6f 7428 0a20   self.ax.plot(. 
-00030540: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00030550: 6365 6e74 726f 6964 5f70 6f69 6e74 732c  centroid_points,
-00030560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00030570: 2022 2b22 2c0a 2020 2020 2020 2020 2020   "+",.          
-00030580: 2020 2020 2020 2a2a 636f 6e74 6f75 725f        **contour_
-00030590: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
-000305a0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-000305b0: 2041 646a 7573 7420 6178 6573 0a20 2020   Adjust axes.   
-000305c0: 2020 2020 2073 656c 662e 6178 2e73 6574       self.ax.set
-000305d0: 5f61 7370 6563 7428 2265 7175 616c 2229  _aspect("equal")
-000305e0: 0a20 2020 2020 2020 2073 6b72 742e 696d  .        skrt.im
-000305f0: 6167 652e 496d 6167 652e 6c61 6265 6c5f  age.Image.label_
-00030600: 6178 2873 656c 662c 2076 6965 772c 2069  ax(self, view, i
-00030610: 6478 2c20 2a2a 6b77 6172 6773 290a 2020  dx, **kwargs).  
-00030620: 2020 2020 2020 736b 7274 2e69 6d61 6765        skrt.image
-00030630: 2e49 6d61 6765 2e7a 6f6f 6d5f 6178 2873  .Image.zoom_ax(s
-00030640: 656c 662c 2076 6965 772c 207a 6f6f 6d2c  elf, view, zoom,
-00030650: 207a 6f6f 6d5f 6365 6e74 7265 290a 2020   zoom_centre).  
-00030660: 2020 2020 2020 6966 2073 686f 773a 0a20        if show:. 
-00030670: 2020 2020 2020 2020 2020 2070 6c74 2e73             plt.s
-00030680: 686f 7728 290a 0a20 2020 2064 6566 2070  how()..    def p
-00030690: 6c6f 745f 636f 6d70 6172 6973 6f6e 280a  lot_comparison(.
-000306a0: 2020 2020 2020 2020 7365 6c66 2c20 0a20          self, . 
-000306b0: 2020 2020 2020 206f 7468 6572 2c20 0a20         other, . 
-000306c0: 2020 2020 2020 2076 6965 773d 2278 2d79         view="x-y
-000306d0: 222c 0a20 2020 2020 2020 2073 6c3d 4e6f  ",.        sl=No
-000306e0: 6e65 2c0a 2020 2020 2020 2020 6964 783d  ne,.        idx=
-000306f0: 4e6f 6e65 2c0a 2020 2020 2020 2020 706f  None,.        po
-00030700: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
-00030710: 6d69 645f 736c 6963 655f 666f 725f 626f  mid_slice_for_bo
-00030720: 7468 3d46 616c 7365 2c0a 2020 2020 2020  th=False,.      
-00030730: 2020 6c65 6765 6e64 3d54 7275 652c 200a    legend=True, .
-00030740: 2020 2020 2020 2020 7361 7665 5f61 733d          save_as=
-00030750: 4e6f 6e65 2c20 0a20 2020 2020 2020 206e  None, .        n
-00030760: 616d 6573 3d4e 6f6e 652c 200a 2020 2020  ames=None, .    
-00030770: 2020 2020 7368 6f77 3d54 7275 652c 200a      show=True, .
-00030780: 2020 2020 2020 2020 696e 636c 7564 655f          include_
-00030790: 696d 6167 653d 4661 6c73 652c 0a20 2020  image=False,.   
-000307a0: 2020 2020 206c 6567 656e 645f 6262 6f78       legend_bbox
-000307b0: 5f74 6f5f 616e 6368 6f72 3d4e 6f6e 652c  _to_anchor=None,
-000307c0: 0a20 2020 2020 2020 206c 6567 656e 645f  .        legend_
-000307d0: 6c6f 633d 226c 6f77 6572 206c 6566 7422  loc="lower left"
-000307e0: 2c0a 2020 2020 2020 2020 2a2a 6b77 6172  ,.        **kwar
-000307f0: 6773 0a20 2020 2029 3a0a 2020 2020 2020  gs.    ):.      
-00030800: 2020 2222 2250 6c6f 7420 636f 6d70 6172    """Plot compar
-00030810: 6973 6f6e 2077 6974 6820 616e 6f74 6865  ison with anothe
-00030820: 7220 524f 492e 2049 6620 6e6f 2073 6c2f  r ROI. If no sl/
-00030830: 6964 782f 706f 7320 6172 6520 6769 7665  idx/pos are give
-00030840: 6e2c 0a20 2020 2020 2020 2074 6865 2063  n,.        the c
-00030850: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
-00030860: 7468 6973 2052 4f49 2077 696c 6c20 6265  this ROI will be
-00030870: 2070 6c6f 7474 6564 2c20 756e 6c65 7373   plotted, unless
-00030880: 200a 2020 2020 2020 2020 6d69 645f 736c   .        mid_sl
-00030890: 6963 655f 666f 725f 626f 7468 3d54 7275  ice_for_both=Tru
-000308a0: 652c 2069 6e20 7768 6963 6820 6361 7365  e, in which case
-000308b0: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
-000308c0: 6365 206f 6620 626f 7468 2052 4f49 730a  ce of both ROIs.
-000308d0: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
-000308e0: 706c 6f74 7465 6420 2865 7665 6e20 7468  plotted (even th
-000308f0: 6f75 6768 2074 6869 7320 6d61 7920 6e6f  ough this may no
-00030900: 7420 636f 7272 6573 706f 6e64 2074 6f20  t correspond to 
-00030910: 7468 6520 7361 6d65 200a 2020 2020 2020  the same .      
-00030920: 2020 706f 696e 7420 696e 2073 7061 6365    point in space
-00030930: 292e 0a0a 2020 2020 2020 2020 2a2a 5061  )...        **Pa
-00030940: 7261 6d65 7465 7273 3a2a 2a0a 2020 2020  rameters:**.    
-00030950: 2020 2020 0a20 2020 2020 2020 206f 7468      .        oth
-00030960: 6572 203a 2052 4f49 0a20 2020 2020 2020  er : ROI.       
-00030970: 2020 2020 204f 7468 6572 2052 4f49 2077       Other ROI w
-00030980: 6974 6820 7768 6963 6820 746f 2070 6c6f  ith which to plo
-00030990: 7420 636f 6d70 6172 6973 6f6e 2e0a 0a20  t comparison... 
-000309a0: 2020 2020 2020 2076 6965 7720 3a20 7374         view : st
-000309b0: 722c 2064 6566 6175 6c74 3d22 782d 7922  r, default="x-y"
-000309c0: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
-000309d0: 656e 7461 7469 6f6e 2069 6e20 7768 6963  entation in whic
-000309e0: 6820 746f 2070 6c6f 7420 524f 4973 2e20  h to plot ROIs. 
-000309f0: 0a0a 2020 2020 2020 2020 736c 203a 2069  ..        sl : i
-00030a00: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
-00030a10: 0a20 2020 2020 2020 2020 2020 2053 6c69  .            Sli
-00030a20: 6365 206e 756d 6265 722e 2049 6620 6e6f  ce number. If no
-00030a30: 6e65 206f 6620 3c73 6c3e 2c20 3c69 6478  ne of <sl>, <idx
-00030a40: 3e20 6f72 203c 706f 733e 2061 7265 2073  > or <pos> are s
-00030a50: 7570 706c 6965 6420 6275 740a 2020 2020  upplied but.    
-00030a60: 2020 2020 2020 2020 3c73 696e 676c 655f          <single_
-00030a70: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
-00030a80: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
-00030a90: 6520 6f66 2074 6865 2052 4f49 2077 696c  e of the ROI wil
-00030aa0: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
-00030ab0: 2020 2020 6964 7820 3a20 696e 742c 2064      idx : int, d
-00030ac0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00030ad0: 2020 2020 2020 2020 4172 7261 7920 696e          Array in
-00030ae0: 6465 7820 6f66 2073 6c69 6365 2e20 4966  dex of slice. If
-00030af0: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
-00030b00: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
-00030b10: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
-00030b20: 2020 2020 2020 2020 2020 203c 7369 6e67             <sing
-00030b30: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
-00030b40: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
-00030b50: 6c69 6365 206f 6620 7468 6520 524f 4920  lice of the ROI 
-00030b60: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
-00030b70: 2020 2020 2020 2070 6f73 203a 2066 6c6f         pos : flo
-00030b80: 6174 2c20 6465 6661 756c 743d 4e6f 6e65  at, default=None
-00030b90: 0a20 2020 2020 2020 2020 2020 2053 6c69  .            Sli
-00030ba0: 6365 2070 6f73 6974 696f 6e20 696e 206d  ce position in m
-00030bb0: 6d2e 2049 6620 6e6f 6e65 206f 6620 3c73  m. If none of <s
-00030bc0: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
-00030bd0: 733e 2061 7265 2073 7570 706c 6965 6420  s> are supplied 
-00030be0: 6275 740a 2020 2020 2020 2020 2020 2020  but.            
-00030bf0: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
-00030c00: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
-00030c10: 7261 6c20 736c 6963 6520 6f66 2074 6865  ral slice of the
-00030c20: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
-00030c30: 642e 0a0a 2020 2020 2020 2020 6d69 645f  d...        mid_
-00030c40: 736c 6963 655f 666f 725f 626f 7468 203a  slice_for_both :
-00030c50: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
-00030c60: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-00030c70: 2049 6620 5472 7565 2061 6e64 206e 6f20   If True and no 
-00030c80: 736c 2f69 6478 2f70 6f73 2061 7265 2067  sl/idx/pos are g
-00030c90: 6976 656e 2c20 7468 6520 6365 6e74 7261  iven, the centra
-00030ca0: 6c20 736c 6963 6573 206f 6620 626f 7468  l slices of both
-00030cb0: 0a20 2020 2020 2020 2020 2020 2052 4f49  .            ROI
-00030cc0: 7320 7769 6c6c 2062 6520 706c 6f74 7465  s will be plotte
-00030cd0: 642c 2065 7665 6e20 6966 2074 6869 7320  d, even if this 
-00030ce0: 646f 6573 206e 6f74 2063 6f72 7265 7370  does not corresp
-00030cf0: 6f6e 6420 746f 2074 6865 2073 616d 650a  ond to the same.
-00030d00: 2020 2020 2020 2020 2020 2020 706f 696e              poin
-00030d10: 7420 696e 2073 7061 6365 3b20 6f74 6865  t in space; othe
-00030d20: 7277 6973 652c 2074 6865 2070 6f73 6974  rwise, the posit
-00030d30: 696f 6e20 6f66 2074 6865 2063 656e 7472  ion of the centr
-00030d40: 616c 2073 6c69 6365 206f 660a 2020 2020  al slice of.    
-00030d50: 2020 2020 2020 2020 7468 6973 2052 4f49          this ROI
-00030d60: 2077 696c 6c20 6265 2070 6c6f 7474 6564   will be plotted
-00030d70: 2066 6f72 2062 6f74 682e 0a0a 2020 2020   for both...    
-00030d80: 2020 2020 6c65 6765 6e64 203a 2062 6f6f      legend : boo
-00030d90: 6c2c 2064 6566 6175 6c74 3d54 7275 650a  l, default=True.
-00030da0: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-00030db0: 7275 652c 2061 206c 6567 656e 6420 7769  rue, a legend wi
-00030dc0: 6c6c 2062 6520 6164 6465 6420 746f 2074  ll be added to t
-00030dd0: 6865 2070 6c6f 7420 636f 6e74 6169 6e69  he plot containi
-00030de0: 6e67 2074 6865 206e 616d 6573 200a 2020  ng the names .  
-00030df0: 2020 2020 2020 2020 2020 6f66 2074 6865            of the
-00030e00: 2074 776f 2052 4f49 732e 0a0a 2020 2020   two ROIs...    
-00030e10: 2020 2020 7361 7665 5f61 7320 3a20 7374      save_as : st
-00030e20: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
-00030e30: 2020 2020 2020 2020 2020 2020 5061 7468              Path
-00030e40: 2074 6f20 6120 6669 6c65 2061 7420 7768   to a file at wh
-00030e50: 6963 6820 7468 6520 706c 6f74 2077 696c  ich the plot wil
-00030e60: 6c20 6265 2073 6176 6564 2e20 4966 204e  l be saved. If N
-00030e70: 6f6e 652c 2074 6865 2070 6c6f 740a 2020  one, the plot.  
-00030e80: 2020 2020 2020 2020 2020 7769 6c6c 206e            will n
-00030e90: 6f74 2062 6520 7361 7665 642e 0a0a 2020  ot be saved...  
-00030ea0: 2020 2020 2020 6e61 6d65 7320 3a20 6c69        names : li
-00030eb0: 7374 2c20 6465 6661 756c 743d 4e6f 6e65  st, default=None
-00030ec0: 0a20 2020 2020 2020 2020 2020 2043 7573  .            Cus
-00030ed0: 746f 6d20 6e61 6d65 7320 746f 2075 7365  tom names to use
-00030ee0: 2066 6f72 2074 6865 2052 4f49 206c 6567   for the ROI leg
-00030ef0: 656e 6420 696e 206f 7264 6572 205b 7468  end in order [th
-00030f00: 6973 2052 4f49 2c20 6f74 6865 7220 524f  is ROI, other RO
-00030f10: 495d 2e0a 2020 2020 2020 2020 2020 2020  I]..            
-00030f20: 4966 204e 6f6e 652c 2074 6865 206e 616d  If None, the nam
-00030f30: 6573 2069 6e20 7365 6c66 2e6e 616d 6520  es in self.name 
-00030f40: 616e 6420 726f 692e 6e61 6d65 2077 696c  and roi.name wil
-00030f50: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
-00030f60: 2020 2020 7368 6f77 203a 2062 6f6f 6c2c      show : bool,
-00030f70: 2064 6566 6175 6c74 3d54 7275 650a 2020   default=True.  
-00030f80: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-00030f90: 652c 2074 6865 2070 6c6f 7420 7769 6c6c  e, the plot will
-00030fa0: 2062 6520 6469 7370 6c61 7965 642e 0a20   be displayed.. 
-00030fb0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-00030fc0: 2020 2020 2320 456e 7375 7265 2052 4f49      # Ensure ROI
-00030fd0: 7320 6172 6520 706c 6f74 7465 6420 696e  s are plotted in
-00030fe0: 2064 6966 6665 7265 6e74 2063 6f6c 6f75   different colou
-00030ff0: 7273 0a20 2020 2020 2020 2069 6620 7365  rs.        if se
-00031000: 6c66 2e63 6f6c 6f72 203d 3d20 6f74 6865  lf.color == othe
-00031010: 722e 636f 6c6f 723a 0a20 2020 2020 2020  r.color:.       
-00031020: 2020 2020 2072 6f69 325f 636f 6c6f 7220       roi2_color 
-00031030: 3d20 524f 4944 6566 6175 6c74 7328 292e  = ROIDefaults().
-00031040: 6765 745f 6465 6661 756c 745f 726f 695f  get_default_roi_
-00031050: 636f 6c6f 7228 290a 2020 2020 2020 2020  color().        
-00031060: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00031070: 2020 726f 6932 5f63 6f6c 6f72 203d 206f    roi2_color = o
-00031080: 7468 6572 2e63 6f6c 6f72 0a0a 2020 2020  ther.color..    
-00031090: 2020 2020 2320 4765 7420 696e 6465 7820      # Get index 
-000310a0: 746f 2070 6c6f 740a 2020 2020 2020 2020  to plot.        
-000310b0: 7a5f 6178 203d 2073 6b72 742e 696d 6167  z_ax = skrt.imag
-000310c0: 652e 5f73 6c69 6365 5f61 7865 735b 7669  e._slice_axes[vi
-000310d0: 6577 5d0a 0a20 2020 2020 2020 2023 2043  ew]..        # C
-000310e0: 6f6d 7075 7465 2070 6f73 6974 696f 6e20  ompute position 
-000310f0: 696e 206d 6d20 746f 2070 6c6f 740a 2020  in mm to plot.  
-00031100: 2020 2020 2020 6966 2073 6c20 6973 204e        if sl is N
-00031110: 6f6e 6520 616e 6420 706f 7320 6973 204e  one and pos is N
-00031120: 6f6e 6520 616e 6420 6964 7820 6973 204e  one and idx is N
-00031130: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00031140: 2070 6f73 3120 3d20 7365 6c66 2e69 6478   pos1 = self.idx
-00031150: 5f74 6f5f 706f 7328 7365 6c66 2e67 6574  _to_pos(self.get
-00031160: 5f6d 6964 5f69 6478 2876 6965 7729 2c20  _mid_idx(view), 
-00031170: 7a5f 6178 290a 2020 2020 2020 2020 656c  z_ax).        el
-00031180: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00031190: 706f 7331 203d 2073 656c 662e 6964 785f  pos1 = self.idx_
-000311a0: 746f 5f70 6f73 280a 2020 2020 2020 2020  to_pos(.        
-000311b0: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
-000311c0: 5f69 6478 2876 6965 772c 2073 6c3d 736c  _idx(view, sl=sl
-000311d0: 2c20 6964 783d 6964 782c 2070 6f73 3d70  , idx=idx, pos=p
-000311e0: 6f73 292c 200a 2020 2020 2020 2020 2020  os), .          
-000311f0: 2020 2020 2020 7a5f 6178 0a20 2020 2020        z_ax.     
-00031200: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00031210: 2020 2320 506c 6f74 2074 6865 2073 616d    # Plot the sam
-00031220: 6520 706f 7369 7469 6f6e 2066 6f72 206f  e position for o
-00031230: 7468 6572 2052 4f49 2c20 756e 6c65 7373  ther ROI, unless
-00031240: 206d 6964 5f73 6c69 6365 5f66 6f72 5f62   mid_slice_for_b
-00031250: 6f74 683d 5472 7565 0a20 2020 2020 2020  oth=True.       
-00031260: 2069 6620 6e6f 7420 6d69 645f 736c 6963   if not mid_slic
-00031270: 655f 666f 725f 626f 7468 3a0a 2020 2020  e_for_both:.    
-00031280: 2020 2020 2020 2020 706f 7332 203d 2070          pos2 = p
-00031290: 6f73 310a 2020 2020 2020 2020 656c 7365  os1.        else
-000312a0: 3a0a 2020 2020 2020 2020 2020 2020 706f  :.            po
-000312b0: 7332 203d 206f 7468 6572 2e69 6478 5f74  s2 = other.idx_t
-000312c0: 6f5f 706f 7328 6f74 6865 722e 6765 745f  o_pos(other.get_
-000312d0: 6d69 645f 6964 7828 7669 6577 292c 207a  mid_idx(view), z
-000312e0: 5f61 7829 0a0a 2020 2020 2020 2020 2320  _ax)..        # 
-000312f0: 506c 6f74 2073 656c 660a 2020 2020 2020  Plot self.      
-00031300: 2020 7365 6c66 2e70 6c6f 7428 7368 6f77    self.plot(show
-00031310: 3d46 616c 7365 2c20 7669 6577 3d76 6965  =False, view=vie
-00031320: 772c 2070 6f73 3d70 6f73 312c 2069 6e63  w, pos=pos1, inc
-00031330: 6c75 6465 5f69 6d61 6765 3d69 6e63 6c75  lude_image=inclu
-00031340: 6465 5f69 6d61 6765 2c20 0a20 2020 2020  de_image, .     
-00031350: 2020 2020 2020 2020 2020 2020 202a 2a6b               **k
-00031360: 7761 7267 7329 0a0a 2020 2020 2020 2020  wargs)..        
-00031370: 2320 4164 6a75 7374 206b 7761 7267 7320  # Adjust kwargs 
-00031380: 666f 7220 706c 6f74 7469 6e67 2073 6563  for plotting sec
-00031390: 6f6e 6420 524f 490a 2020 2020 2020 2020  ond ROI.        
-000313a0: 6b77 6172 6773 5b22 6178 225d 203d 2073  kwargs["ax"] = s
-000313b0: 656c 662e 6178 0a20 2020 2020 2020 206b  elf.ax.        k
-000313c0: 7761 7267 735b 2263 6f6c 6f72 225d 203d  wargs["color"] =
-000313d0: 2072 6f69 325f 636f 6c6f 720a 2020 2020   roi2_color.    
-000313e0: 2020 2020 6f74 6865 722e 706c 6f74 2873      other.plot(s
-000313f0: 686f 773d 4661 6c73 652c 2076 6965 773d  how=False, view=
-00031400: 7669 6577 2c20 706f 733d 706f 7332 2c20  view, pos=pos2, 
-00031410: 696e 636c 7564 655f 696d 6167 653d 4661  include_image=Fa
-00031420: 6c73 652c 200a 2020 2020 2020 2020 2020  lse, .          
-00031430: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
-00031440: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
-00031450: 6178 2e73 6574 5f74 6974 6c65 2873 656c  ax.set_title(sel
-00031460: 662e 6765 745f 636f 6d70 6172 6973 6f6e  f.get_comparison
-00031470: 5f6e 616d 6528 6f74 6865 7229 290a 0a20  _name(other)).. 
-00031480: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
-00031490: 6c65 6765 6e64 0a20 2020 2020 2020 2069  legend.        i
-000314a0: 6620 6c65 6765 6e64 3a0a 2020 2020 2020  f legend:.      
-000314b0: 2020 2020 2020 706c 6f74 5f74 7970 6520        plot_type 
-000314c0: 3d20 6b77 6172 6773 2e67 6574 2822 706c  = kwargs.get("pl
-000314d0: 6f74 5f74 7970 6522 2c20 4e6f 6e65 290a  ot_type", None).
-000314e0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-000314f0: 6c6f 745f 7479 7065 2069 7320 4e6f 6e65  lot_type is None
-00031500: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00031510: 2020 706c 6f74 5f74 7970 6520 3d20 6b77    plot_type = kw
-00031520: 6172 6773 2e67 6574 2822 726f 695f 706c  args.get("roi_pl
-00031530: 6f74 5f74 7970 6522 2c20 4e6f 6e65 290a  ot_type", None).
-00031540: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-00031550: 7769 6474 6820 3d20 6b77 6172 6773 2e67  width = kwargs.g
-00031560: 6574 2822 6c69 6e65 7769 6474 6822 2c20  et("linewidth", 
-00031570: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
-00031580: 2020 6f70 6163 6974 7920 3d20 6b77 6172    opacity = kwar
-00031590: 6773 2e67 6574 2822 6f70 6163 6974 7922  gs.get("opacity"
-000315a0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-000315b0: 2020 2020 6966 206e 616d 6573 3a0a 2020      if names:.  
-000315c0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-000315d0: 6931 5f6e 616d 6520 3d20 6e61 6d65 735b  i1_name = names[
-000315e0: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
-000315f0: 2020 2072 6f69 325f 6e61 6d65 203d 206e     roi2_name = n
-00031600: 616d 6573 5b31 5d0a 2020 2020 2020 2020  ames[1].        
-00031610: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00031620: 2020 2020 2020 2020 2020 726f 6931 5f6e            roi1_n
-00031630: 616d 6520 3d20 7365 6c66 2e6e 616d 650a  ame = self.name.
-00031640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031650: 726f 6932 5f6e 616d 6520 3d20 6f74 6865  roi2_name = othe
-00031660: 722e 6e61 6d65 0a20 2020 2020 2020 2020  r.name.         
-00031670: 2020 2068 616e 646c 6573 203d 205b 0a20     handles = [. 
-00031680: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00031690: 656c 662e 6765 745f 7061 7463 6828 0a20  elf.get_patch(. 
-000316a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000316b0: 2020 2070 6c6f 745f 7479 7065 2c20 7365     plot_type, se
-000316c0: 6c66 2e63 6f6c 6f72 2c20 6f70 6163 6974  lf.color, opacit
-000316d0: 792c 206c 696e 6577 6964 7468 2c20 726f  y, linewidth, ro
-000316e0: 6931 5f6e 616d 6529 2c0a 2020 2020 2020  i1_name),.      
-000316f0: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
-00031700: 6574 5f70 6174 6368 280a 2020 2020 2020  et_patch(.      
-00031710: 2020 2020 2020 2020 2020 2020 2020 706c                pl
-00031720: 6f74 5f74 7970 652c 2072 6f69 325f 636f  ot_type, roi2_co
-00031730: 6c6f 722c 206f 7061 6369 7479 2c20 6c69  lor, opacity, li
-00031740: 6e65 7769 6474 682c 2072 6f69 325f 6e61  newidth, roi2_na
-00031750: 6d65 292c 0a20 2020 2020 2020 2020 2020  me),.           
-00031760: 205d 0a20 2020 2020 2020 2020 2020 2073   ].            s
-00031770: 656c 662e 6178 2e6c 6567 656e 6428 0a20  elf.ax.legend(. 
-00031780: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00031790: 616e 646c 6573 3d68 616e 646c 6573 2c20  andles=handles, 
-000317a0: 6672 616d 6561 6c70 6861 3d31 2c20 6661  framealpha=1, fa
-000317b0: 6365 636f 6c6f 723d 2277 6869 7465 222c  cecolor="white",
-000317c0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-000317d0: 2020 6262 6f78 5f74 6f5f 616e 6368 6f72    bbox_to_anchor
-000317e0: 3d6c 6567 656e 645f 6262 6f78 5f74 6f5f  =legend_bbox_to_
-000317f0: 616e 6368 6f72 2c20 6c6f 633d 6c65 6765  anchor, loc=lege
-00031800: 6e64 5f6c 6f63 0a20 2020 2020 2020 2020  nd_loc.         
-00031810: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-00031820: 5368 6f77 2f73 6176 650a 2020 2020 2020  Show/save.      
-00031830: 2020 6966 2073 686f 773a 0a20 2020 2020    if show:.     
-00031840: 2020 2020 2020 2070 6c74 2e73 686f 7728         plt.show(
-00031850: 290a 2020 2020 2020 2020 6966 2073 6176  ).        if sav
-00031860: 655f 6173 3a0a 2020 2020 2020 2020 2020  e_as:.          
-00031870: 2020 706c 742e 7469 6768 745f 6c61 796f    plt.tight_layo
-00031880: 7574 2829 0a20 2020 2020 2020 2020 2020  ut().           
-00031890: 2073 656c 662e 6669 672e 7361 7665 6669   self.fig.savefi
-000318a0: 6728 7361 7665 5f61 7329 0a0a 2020 2020  g(save_as)..    
-000318b0: 6465 6620 6765 745f 6173 7065 6374 5f72  def get_aspect_r
-000318c0: 6174 696f 280a 2020 2020 2020 2020 7365  atio(.        se
-000318d0: 6c66 2c20 7669 6577 2c20 2a61 7267 732c  lf, view, *args,
-000318e0: 202a 2a6b 7761 7267 730a 2020 2020 293a   **kwargs.    ):
-000318f0: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
-00031900: 6173 7065 6374 2072 6174 696f 2066 6f72  aspect ratio for
-00031910: 2074 6869 7320 7374 7275 6374 7572 6520   this structure 
-00031920: 696e 2061 2067 6976 656e 206f 7269 656e  in a given orien
-00031930: 7461 7469 6f6e 2e22 2222 0a0a 2020 2020  tation."""..    
-00031940: 2020 2020 785f 6178 2c20 795f 6178 203d      x_ax, y_ax =
-00031950: 2073 6b72 742e 696d 6167 652e 5f70 6c6f   skrt.image._plo
-00031960: 745f 6178 6573 5b76 6965 775d 0a20 2020  t_axes[view].   
-00031970: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00031980: 2e67 6574 5f6c 656e 6774 6828 6178 3d73  .get_length(ax=s
-00031990: 6b72 742e 696d 6167 652e 5f61 7865 735b  krt.image._axes[
-000319a0: 785f 6178 5d29 205c 0a20 2020 2020 2020  x_ax]) \.       
-000319b0: 2020 2020 2020 2020 202f 2073 656c 662e           / self.
-000319c0: 6765 745f 6c65 6e67 7468 2861 783d 736b  get_length(ax=sk
-000319d0: 7274 2e69 6d61 6765 2e5f 6178 6573 5b79  rt.image._axes[y
-000319e0: 5f61 785d 290a 0a20 2020 2064 6566 2073  _ax])..    def s
-000319f0: 6574 5f61 7828 7365 6c66 2c20 706c 6f74  et_ax(self, plot
-00031a00: 5f74 7970 652c 2069 6e63 6c75 6465 5f69  _type, include_i
-00031a10: 6d61 6765 2c20 2a61 7267 732c 202a 2a6b  mage, *args, **k
-00031a20: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-00031a30: 2222 2253 6574 2075 7020 6178 6573 2e22  """Set up axes."
-00031a40: 2222 0a0a 2020 2020 2020 2020 6966 2070  ""..        if p
-00031a50: 6c6f 745f 7479 7065 2069 6e20 5b22 636f  lot_type in ["co
-00031a60: 6e74 6f75 7222 2c20 2263 656e 7472 6f69  ntour", "centroi
-00031a70: 6422 5d20 616e 6420 6e6f 7420 696e 636c  d"] and not incl
-00031a80: 7564 655f 696d 6167 653a 0a20 2020 2020  ude_image:.     
-00031a90: 2020 2020 2020 2061 7370 6563 745f 6765         aspect_ge
-00031aa0: 7474 6572 203d 2073 656c 662e 6765 745f  tter = self.get_
-00031ab0: 6173 7065 6374 5f72 6174 696f 0a20 2020  aspect_ratio.   
-00031ac0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00031ad0: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
-00031ae0: 6d61 6765 2069 7320 6e6f 7420 4e6f 6e65  mage is not None
-00031af0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00031b00: 2020 6173 7065 6374 5f67 6574 7465 7220    aspect_getter 
-00031b10: 3d20 7365 6c66 2e69 6d61 6765 2e67 6574  = self.image.get
-00031b20: 5f70 6c6f 745f 6173 7065 6374 5f72 6174  _plot_aspect_rat
-00031b30: 696f 0a20 2020 2020 2020 2020 2020 2065  io.            e
-00031b40: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00031b50: 2020 2020 2073 656c 662e 6372 6561 7465       self.create
-00031b60: 5f6d 6173 6b28 290a 2020 2020 2020 2020  _mask().        
-00031b70: 2020 2020 2020 2020 6173 7065 6374 5f67          aspect_g
-00031b80: 6574 7465 7220 3d20 7365 6c66 2e6d 6173  etter = self.mas
-00031b90: 6b2e 6765 745f 706c 6f74 5f61 7370 6563  k.get_plot_aspec
-00031ba0: 745f 7261 7469 6f0a 2020 2020 2020 2020  t_ratio.        
-00031bb0: 736b 7274 2e69 6d61 6765 2e73 6574 5f61  skrt.image.set_a
-00031bc0: 7828 7365 6c66 2c20 2a61 7267 732c 2061  x(self, *args, a
-00031bd0: 7370 6563 745f 6765 7474 6572 3d61 7370  spect_getter=asp
-00031be0: 6563 745f 6765 7474 6572 2c20 2a2a 6b77  ect_getter, **kw
-00031bf0: 6172 6773 290a 0a20 2020 2064 6566 2067  args)..    def g
-00031c00: 6574 5f7a 6f6f 6d5f 6365 6e74 7265 2873  et_zoom_centre(s
-00031c10: 656c 662c 2076 6965 7729 3a0a 2020 2020  elf, view):.    
-00031c20: 2020 2020 2222 2247 6574 2063 6f6f 7264      """Get coord
-00031c30: 696e 6174 6573 2074 6f20 7a6f 6f6d 2069  inates to zoom i
-00031c40: 6e20 6f6e 2074 6869 7320 524f 492e 2222  n on this ROI.""
-00031c50: 220a 0a20 2020 2020 2020 207a 6f6f 6d5f  "..        zoom_
-00031c60: 6365 6e74 7265 203d 205b 4e6f 6e65 2c20  centre = [None, 
-00031c70: 4e6f 6e65 2c20 4e6f 6e65 5d0a 2020 2020  None, None].    
-00031c80: 2020 2020 785f 6178 2c20 795f 6178 203d      x_ax, y_ax =
-00031c90: 2073 6b72 742e 696d 6167 652e 5f70 6c6f   skrt.image._plo
-00031ca0: 745f 6178 6573 5b76 6965 775d 0a20 2020  t_axes[view].   
-00031cb0: 2020 2020 2078 2c20 7920 3d20 7365 6c66       x, y = self
-00031cc0: 2e67 6574 5f63 656e 7472 6528 7669 6577  .get_centre(view
-00031cd0: 3d76 6965 772c 2073 696e 676c 655f 736c  =view, single_sl
-00031ce0: 6963 653d 5472 7565 290a 2020 2020 2020  ice=True).      
-00031cf0: 2020 7a6f 6f6d 5f63 656e 7472 655b 785f    zoom_centre[x_
-00031d00: 6178 5d20 3d20 780a 2020 2020 2020 2020  ax] = x.        
-00031d10: 7a6f 6f6d 5f63 656e 7472 655b 795f 6178  zoom_centre[y_ax
-00031d20: 5d20 3d20 790a 2020 2020 2020 2020 7265  ] = y.        re
-00031d30: 7475 726e 207a 6f6f 6d5f 6365 6e74 7265  turn zoom_centre
-00031d40: 0a0a 2020 2020 6465 6620 7772 6974 6528  ..    def write(
-00031d50: 7365 6c66 2c20 6f75 746e 616d 653d 4e6f  self, outname=No
-00031d60: 6e65 2c20 6f75 7464 6972 3d22 2e22 2c20  ne, outdir=".", 
-00031d70: 6578 743d 4e6f 6e65 2c20 6f76 6572 7772  ext=None, overwr
-00031d80: 6974 653d 4661 6c73 652c 0a20 2020 2020  ite=False,.     
-00031d90: 2020 2020 2020 2068 6561 6465 725f 736f         header_so
-00031da0: 7572 6365 3d4e 6f6e 652c 2070 6174 6965  urce=None, patie
-00031db0: 6e74 5f69 643d 4e6f 6e65 2c20 726f 6f74  nt_id=None, root
-00031dc0: 5f75 6964 3d4e 6f6e 652c 0a20 2020 2020  _uid=None,.     
-00031dd0: 2020 2020 2020 2076 6572 626f 7365 3d54         verbose=T
-00031de0: 7275 652c 2068 6561 6465 725f 6578 7472  rue, header_extr
-00031df0: 6173 3d7b 7d2c 206b 6565 705f 736f 7572  as={}, keep_sour
-00031e00: 6365 5f72 6f69 733d 5472 7565 2c20 2a2a  ce_rois=True, **
-00031e10: 6b77 6172 6773 293a 0a0a 2020 2020 2020  kwargs):..      
-00031e20: 2020 7365 6c66 2e6c 6f61 6428 290a 0a20    self.load().. 
-00031e30: 2020 2020 2020 2023 2047 656e 6572 6174         # Generat
-00031e40: 6520 6f75 7470 7574 206e 616d 6520 6966  e output name if
-00031e50: 206e 6f74 2067 6976 656e 0a20 2020 2020   not given.     
-00031e60: 2020 2070 6f73 7369 626c 655f 6578 7420     possible_ext 
-00031e70: 3d20 5b22 2e64 636d 222c 2022 2e6e 6969  = [".dcm", ".nii
-00031e80: 2e67 7a22 2c20 222e 6e69 6922 2c20 222e  .gz", ".nii", ".
-00031e90: 6e70 7922 2c20 222e 7478 7422 5d0a 2020  npy", ".txt"].  
-00031ea0: 2020 2020 2020 6966 2065 7874 2069 7320        if ext is 
-00031eb0: 6e6f 7420 4e6f 6e65 2061 6e64 206e 6f74  not None and not
-00031ec0: 2065 7874 2e73 7461 7274 7377 6974 6828   ext.startswith(
-00031ed0: 222e 2229 3a0a 2020 2020 2020 2020 2020  "."):.          
-00031ee0: 2020 6578 7420 3d20 6622 2e7b 6578 747d    ext = f".{ext}
-00031ef0: 220a 2020 2020 2020 2020 6966 206f 7574  ".        if out
-00031f00: 6e61 6d65 2069 7320 4e6f 6e65 3a0a 2020  name is None:.  
-00031f10: 2020 2020 2020 2020 2020 6966 2065 7874            if ext
-00031f20: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00031f30: 2020 2020 2020 2020 2020 6578 7420 3d20            ext = 
-00031f40: 222e 6e69 6922 0a20 2020 2020 2020 2020  ".nii".         
-00031f50: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00031f60: 2020 2020 2020 2020 2069 6620 6578 7420           if ext 
-00031f70: 6e6f 7420 696e 2070 6f73 7369 626c 655f  not in possible_
-00031f80: 6578 743a 0a20 2020 2020 2020 2020 2020  ext:.           
-00031f90: 2020 2020 2020 2020 2072 6169 7365 2052           raise R
-00031fa0: 756e 7469 6d65 4572 726f 7228 6622 556e  untimeError(f"Un
-00031fb0: 7265 636f 676e 6973 6564 2066 696c 6520  recognised file 
-00031fc0: 6578 7465 6e73 696f 6e3a 207b 6578 747d  extension: {ext}
-00031fd0: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-00031fe0: 6620 6e6f 7420 6578 742e 7374 6172 7473  f not ext.starts
-00031ff0: 7769 7468 2822 2e22 293a 0a20 2020 2020  with("."):.     
-00032000: 2020 2020 2020 2020 2020 2065 7874 203d             ext =
-00032010: 2066 222e 7b65 7874 7d22 0a20 2020 2020   f".{ext}".     
-00032020: 2020 2020 2020 206f 7574 6e61 6d65 203d         outname =
-00032030: 2066 227b 6f75 7464 6972 7d2f 7b73 656c   f"{outdir}/{sel
-00032040: 662e 6e61 6d65 7d7b 6578 747d 220a 0a20  f.name}{ext}".. 
-00032050: 2020 2020 2020 2023 204f 7468 6572 7769         # Otherwi
-00032060: 7365 2c20 696e 6665 7220 6578 7465 6e73  se, infer extens
-00032070: 696f 6e20 6672 6f6d 2066 696c 656e 616d  ion from filenam
-00032080: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
-00032090: 0a20 2020 2020 2020 2020 2020 2023 2046  .            # F
-000320a0: 696e 6420 616e 7920 6f66 2074 6865 2076  ind any of the v
-000320b0: 616c 6964 2066 696c 6520 6578 7465 6e73  alid file extens
-000320c0: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
-000320d0: 2066 6f72 2070 6f73 2069 6e20 706f 7373   for pos in poss
-000320e0: 6962 6c65 5f65 7874 3a0a 2020 2020 2020  ible_ext:.      
-000320f0: 2020 2020 2020 2020 2020 6966 206f 7574            if out
-00032100: 6e61 6d65 2e65 6e64 7377 6974 6828 706f  name.endswith(po
-00032110: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00032120: 2020 2020 2020 2020 6578 7420 3d20 706f          ext = po
-00032130: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
-00032140: 2065 7874 206e 6f74 2069 6e20 706f 7373   ext not in poss
-00032150: 6962 6c65 5f65 7874 3a0a 2020 2020 2020  ible_ext:.      
-00032160: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00032170: 5275 6e74 696d 6545 7272 6f72 2866 2255  RuntimeError(f"U
-00032180: 6e72 6563 6f67 6e69 7365 6420 6f75 7470  nrecognised outp
-00032190: 7574 2066 696c 6520 7479 7065 3a20 7b6f  ut file type: {o
-000321a0: 7574 6e61 6d65 7d22 290a 0a20 2020 2020  utname}")..     
-000321b0: 2020 2020 2020 206f 7574 6e61 6d65 203d         outname =
-000321c0: 206f 732e 7061 7468 2e6a 6f69 6e28 6f75   os.path.join(ou
-000321d0: 7464 6972 2c20 6f75 746e 616d 6529 0a0a  tdir, outname)..
-000321e0: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
-000321f0: 706f 696e 7473 2074 6f20 7465 7874 2066  points to text f
-00032200: 696c 652c 2069 6e20 666f 726d 6174 2074  ile, in format t
-00032210: 6861 7420 6361 6e20 6265 2072 6561 6420  hat can be read 
-00032220: 6279 2074 7261 6e73 666f 726d 6978 0a20  by transformix. 
-00032230: 2020 2020 2020 2069 6620 6578 7420 3d3d         if ext ==
-00032240: 2022 2e74 7874 223a 0a20 2020 2020 2020   ".txt":.       
-00032250: 2020 2020 2073 656c 662e 6765 745f 636f       self.get_co
-00032260: 6e74 6f75 7273 2829 0a0a 2020 2020 2020  ntours()..      
-00032270: 2020 2020 2020 706f 696e 7473 203d 205b        points = [
-00032280: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
-00032290: 7220 7a2c 2063 6f6e 746f 7572 7320 696e  r z, contours in
-000322a0: 2073 656c 662e 636f 6e74 6f75 7273 5b22   self.contours["
-000322b0: 782d 7922 5d2e 6974 656d 7328 293a 0a20  x-y"].items():. 
-000322c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000322d0: 6f72 2069 6478 2c20 636f 6e74 6f75 7220  or idx, contour 
-000322e0: 696e 2065 6e75 6d65 7261 7465 2863 6f6e  in enumerate(con
-000322f0: 746f 7572 7329 3a0a 2020 2020 2020 2020  tours):.        
-00032300: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00032310: 706f 696e 7420 696e 2063 6f6e 746f 7572  point in contour
-00032320: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00032330: 2020 2020 2020 2020 2020 2320 4164 6420            # Add 
-00032340: 7468 7265 6520 6469 6769 7473 2074 6f20  three digits to 
-00032350: 7374 6f72 6520 7468 6520 636f 6e74 6f75  store the contou
-00032360: 7220 696e 6465 782c 0a20 2020 2020 2020  r index,.       
-00032370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032380: 2023 2077 6869 6368 2069 7320 756e 6c69   # which is unli
-00032390: 6b65 6c79 2074 6f20 6e65 6564 206d 6f72  kely to need mor
-000323a0: 6520 7468 616e 2061 2073 696e 676c 6520  e than a single 
-000323b0: 6469 6769 742e 0a20 2020 2020 2020 2020  digit..         
-000323c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000323d0: 2054 6869 7320 6861 7320 6e65 676c 6967   This has neglig
-000323e0: 6962 6c65 2065 6666 6563 7420 6f6e 2070  ible effect on p
-000323f0: 7265 6369 7369 6f6e 2c0a 2020 2020 2020  recision,.      
-00032400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032410: 2020 2320 616e 6420 616c 6c6f 7773 2063    # and allows c
-00032420: 6f6e 746f 7572 2d70 6f69 6e74 2061 7373  ontour-point ass
-00032430: 6f63 6961 7469 6f6e 730a 2020 2020 2020  ociations.      
-00032440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032450: 2020 2320 746f 2062 6520 6964 656e 7469    # to be identi
-00032460: 6669 6564 2069 6e20 5472 616e 7366 6f72  fied in Transfor
-00032470: 6d69 7820 6f75 7470 7574 2e0a 2020 2020  mix output..    
-00032480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032490: 2020 2020 7a5f 6f75 7420 3d20 6622 7b7a      z_out = f"{z
-000324a0: 3a2e 3366 7d7b 6964 783a 3033 7d22 0a20  :.3f}{idx:03}". 
-000324b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000324c0: 2020 2020 2020 2070 6f69 6e74 732e 6170         points.ap
-000324d0: 7065 6e64 2866 227b 706f 696e 745b 305d  pend(f"{point[0]
-000324e0: 3a2e 3366 7d20 7b70 6f69 6e74 5b31 5d3a  :.3f} {point[1]:
-000324f0: 2e33 667d 207b 7a5f 6f75 747d 2229 0a0a  .3f} {z_out}")..
-00032500: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00032510: 206f 7065 6e28 6f75 746e 616d 652c 2022   open(outname, "
-00032520: 7722 2920 6173 2066 696c 653a 0a20 2020  w") as file:.   
-00032530: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00032540: 652e 7772 6974 6528 2270 6f69 6e74 5c6e  e.write("point\n
-00032550: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00032560: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
-00032570: 7b6c 656e 2870 6f69 6e74 7329 7d5c 6e22  {len(points)}\n"
-00032580: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00032590: 2020 6669 6c65 2e77 7269 7465 2822 5c6e    file.write("\n
-000325a0: 222e 6a6f 696e 2870 6f69 6e74 7329 290a  ".join(points)).
-000325b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000325c0: 7572 6e0a 0a20 2020 2020 2020 2023 2057  urn..        # W
-000325d0: 7269 7465 2061 7272 6179 2074 6f20 6e69  rite array to ni
-000325e0: 6674 6920 6f72 206e 7079 0a20 2020 2020  fti or npy.     
-000325f0: 2020 2065 6c69 6620 6578 7420 213d 2022     elif ext != "
-00032600: 2e64 636d 223a 0a20 2020 2020 2020 2020  .dcm":.         
-00032610: 2020 2073 656c 662e 6372 6561 7465 5f6d     self.create_m
-00032620: 6173 6b28 290a 2020 2020 2020 2020 2020  ask().          
-00032630: 2020 7365 6c66 2e6d 6173 6b2e 7772 6974    self.mask.writ
-00032640: 6528 6f75 746e 616d 652c 2076 6572 626f  e(outname, verbo
-00032650: 7365 3d76 6572 626f 7365 2c20 2a2a 6b77  se=verbose, **kw
-00032660: 6172 6773 290a 2020 2020 2020 2020 656c  args).        el
-00032670: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00032680: 6966 2068 6561 6465 725f 736f 7572 6365  if header_source
-00032690: 2061 6e64 206b 6565 705f 736f 7572 6365   and keep_source
-000326a0: 5f72 6f69 733a 0a20 2020 2020 2020 2020  _rois:.         
-000326b0: 2020 2020 2020 2073 7472 7563 7475 7265         structure
-000326c0: 5f73 6574 203d 2053 7472 7563 7475 7265  _set = Structure
-000326d0: 5365 7428 6865 6164 6572 5f73 6f75 7263  Set(header_sourc
-000326e0: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
-000326f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00032700: 2020 2020 2073 7472 7563 7475 7265 5f73       structure_s
-00032710: 6574 203d 2053 7472 7563 7475 7265 5365  et = StructureSe
-00032720: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00032730: 7374 7275 6374 7572 655f 7365 742e 6164  structure_set.ad
-00032740: 645f 726f 6928 7365 6c66 290a 2020 2020  d_roi(self).    
-00032750: 2020 2020 2020 2020 7374 7275 6374 7572          structur
-00032760: 655f 7365 742e 7772 6974 6528 6f75 7464  e_set.write(outd
-00032770: 6972 3d6f 7574 6469 722c 2065 7874 3d65  ir=outdir, ext=e
-00032780: 7874 2c20 6f76 6572 7772 6974 653d 6f76  xt, overwrite=ov
-00032790: 6572 7772 6974 652c 0a20 2020 2020 2020  erwrite,.       
-000327a0: 2020 2020 2020 2020 2020 2020 2068 6561               hea
-000327b0: 6465 725f 736f 7572 6365 3d68 6561 6465  der_source=heade
-000327c0: 725f 736f 7572 6365 2c20 7061 7469 656e  r_source, patien
-000327d0: 745f 6964 3d70 6174 6965 6e74 5f69 642c  t_id=patient_id,
-000327e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000327f0: 2020 2020 2072 6f6f 745f 7569 643d 726f       root_uid=ro
-00032800: 6f74 5f75 6964 2c20 7665 7262 6f73 653d  ot_uid, verbose=
-00032810: 7665 7262 6f73 652c 0a20 2020 2020 2020  verbose,.       
-00032820: 2020 2020 2020 2020 2020 2020 2068 6561               hea
-00032830: 6465 725f 6578 7472 6173 3d68 6561 6465  der_extras=heade
-00032840: 725f 6578 7472 6173 290a 0a20 2020 2064  r_extras)..    d
-00032850: 6566 2074 7261 6e73 666f 726d 2873 656c  ef transform(sel
-00032860: 662c 2073 6361 6c65 3d31 2c20 7472 616e  f, scale=1, tran
-00032870: 736c 6174 696f 6e3d 5b30 2c20 302c 2030  slation=[0, 0, 0
-00032880: 5d2c 2072 6f74 6174 696f 6e3d 5b30 2c20  ], rotation=[0, 
-00032890: 302c 2030 5d2c 0a20 2020 2020 2020 2020  0, 0],.         
-000328a0: 2020 2063 656e 7472 653d 5b30 2c20 302c     centre=[0, 0,
-000328b0: 2030 5d2c 2072 6573 616d 706c 653d 2266   0], resample="f
-000328c0: 696e 6522 2c20 7265 7374 6f72 653d 5472  ine", restore=Tr
-000328d0: 7565 2c20 0a20 2020 2020 2020 2020 2020  ue, .           
-000328e0: 2066 696c 6c5f 7661 6c75 653d 4e6f 6e65   fill_value=None
-000328f0: 2c20 666f 7263 655f 636f 6e74 6f75 7273  , force_contours
-00032900: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-00032910: 2022 2222 0a20 2020 2020 2020 2041 7070   """.        App
-00032920: 6c79 2074 6872 6565 2d64 696d 656e 7369  ly three-dimensi
-00032930: 6f6e 616c 2073 696d 696c 6172 6974 7920  onal similarity 
-00032940: 7472 616e 7366 6f72 6d20 746f 2052 4f49  transform to ROI
-00032950: 2e0a 0a20 2020 2020 2020 2049 6620 7468  ...        If th
-00032960: 6520 7472 616e 7366 6f72 6d20 636f 7272  e transform corr
-00032970: 6573 706f 6e64 7320 746f 2061 2074 7261  esponds to a tra
-00032980: 6e73 6c61 7469 6f6e 2061 6e64 2f6f 7220  nslation and/or 
-00032990: 726f 7461 7469 6f6e 0a20 2020 2020 2020  rotation.       
-000329a0: 2061 626f 7574 2074 6865 207a 2d61 7869   about the z-axi
-000329b0: 732c 2061 6e64 2065 6974 6865 7220 7468  s, and either th
-000329c0: 6520 726f 6920 736f 7572 6365 2074 7970  e roi source typ
-000329d0: 6520 6973 2022 6469 636f 6d22 0a20 2020  e is "dicom".   
-000329e0: 2020 2020 206f 7220 666f 7263 652d 636f       or force-co
-000329f0: 6e74 6f75 7273 2069 7320 5472 7565 2c20  ntours is True, 
-00032a00: 7468 6520 7472 616e 7366 6f72 6d20 6973  the transform is
-00032a10: 2061 7070 6c69 6564 2074 6f20 636f 6e74   applied to cont
-00032a20: 6f75 720a 2020 2020 2020 2020 706f 696e  our.        poin
-00032a30: 7473 2061 6e64 2074 6865 2072 6f69 206d  ts and the roi m
-00032a40: 6173 6b20 6973 2073 6574 2061 7320 756e  ask is set as un
-00032a50: 6c6f 6164 6564 2e20 204f 7468 6572 7769  loaded.  Otherwi
-00032a60: 7365 2074 6865 2074 7261 6e73 666f 726d  se the transform
-00032a70: 0a20 2020 2020 2020 2069 7320 6170 706c  .        is appl
-00032a80: 6965 6420 746f 2074 6865 206d 6173 6b20  ied to the mask 
-00032a90: 616e 6420 636f 6e74 6f75 7273 2061 7265  and contours are
-00032aa0: 2073 6574 2061 7320 756e 6c6f 6164 6564   set as unloaded
-00032ab0: 2e0a 0a20 2020 2020 2020 2054 6865 2074  ...        The t
-00032ac0: 7261 6e73 666f 726d 2069 7320 6170 706c  ransform is appl
-00032ad0: 6965 6420 696e 2074 6865 206f 7264 6572  ied in the order
-00032ae0: 3a20 7472 616e 736c 6174 696f 6e2c 2073  : translation, s
-00032af0: 6361 6c69 6e67 2c0a 2020 2020 2020 2020  caling,.        
-00032b00: 726f 7461 7469 6f6e 2e20 2054 6865 206c  rotation.  The l
-00032b10: 6174 7465 7220 7477 6f20 6172 6520 6162  atter two are ab
-00032b20: 6f75 7420 7468 6520 6365 6e74 7265 2063  out the centre c
-00032b30: 6f6f 7264 696e 6174 6573 2e0a 0a20 2020  oordinates...   
-00032b40: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
-00032b50: 733a 2a2a 0a20 2020 2020 2020 200a 2020  s:**.        .  
-00032b60: 2020 2020 2020 666f 7263 655f 636f 6e74        force_cont
-00032b70: 6f75 7273 203a 2062 6f6f 6c2c 2064 6566  ours : bool, def
-00032b80: 6175 6c74 3d46 616c 7365 0a20 2020 2020  ault=False.     
-00032b90: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-00032ba0: 616e 6420 7468 6520 7472 616e 7366 6f72  and the transfor
-00032bb0: 6d20 636f 7272 6573 706f 6e64 7320 746f  m corresponds to
-00032bc0: 2061 2074 7261 6e73 6c61 7469 6f6e 0a20   a translation. 
-00032bd0: 2020 2020 2020 2020 2020 2061 6e64 2f6f             and/o
-00032be0: 7220 726f 7461 7469 6f6e 2061 626f 7574  r rotation about
-00032bf0: 2074 6865 207a 2d61 7869 732c 2061 7070   the z-axis, app
-00032c00: 6c79 2074 7261 6e73 666f 726d 2074 6f20  ly transform to 
-00032c10: 636f 6e74 6f75 720a 2020 2020 2020 2020  contour.        
-00032c20: 2020 2020 706f 696e 7473 2069 6e64 6570      points indep
-00032c30: 656e 6465 6e74 6c79 206f 6620 7468 6520  endently of the 
-00032c40: 6f72 6967 696e 616c 2064 6174 6120 736f  original data so
-00032c50: 7572 6365 2e0a 0a20 2020 2020 2020 2046  urce...        F
-00032c60: 6f72 206f 7468 6572 2070 6172 616d 6574  or other paramet
-00032c70: 6572 732c 2073 6565 2064 6f63 756d 656e  ers, see documen
-00032c80: 7461 7469 6f6e 2066 6f72 0a20 2020 2020  tation for.     
-00032c90: 2020 2073 6b72 742e 696d 6167 652e 496d     skrt.image.Im
-00032ca0: 6167 652e 7472 616e 7366 6f72 6d28 292e  age.transform().
-00032cb0: 2020 4e6f 7465 2074 6861 7420 7468 6520    Note that the 
-00032cc0: 6060 6f72 6465 7260 600a 2020 2020 2020  ``order``.      
-00032cd0: 2020 7061 7261 6d65 7465 7220 6973 6e27    parameter isn'
-00032ce0: 7420 6176 6169 6c61 626c 6520 666f 7220  t available for 
-00032cf0: 726f 6920 7472 616e 7366 6f72 6d73 202d  roi transforms -
-00032d00: 2061 2076 616c 7565 206f 6620 300a 2020   a value of 0.  
-00032d10: 2020 2020 2020 6973 2075 7365 6420 616c        is used al
-00032d20: 7761 7973 2e0a 2020 2020 2020 2020 2222  ways..        ""
-00032d30: 220a 0a20 2020 2020 2020 2023 2043 6865  "..        # Che
-00032d40: 636b 2077 6865 7468 6572 2074 7261 6e73  ck whether trans
-00032d50: 666f 726d 2069 7320 746f 2062 6520 6170  form is to be ap
-00032d60: 706c 6965 6420 746f 2063 6f6e 746f 7572  plied to contour
-00032d70: 730a 2020 2020 2020 2020 736d 616c 6c5f  s.        small_
-00032d80: 6e75 6d62 6572 203d 2031 2e65 2d36 0a20  number = 1.e-6. 
-00032d90: 2020 2020 2020 2074 7261 6e73 666f 726d         transform
-00032da0: 5f63 6f6e 746f 7572 7320 3d20 4661 6c73  _contours = Fals
-00032db0: 650a 2020 2020 2020 2020 6966 2073 656c  e.        if sel
-00032dc0: 662e 736f 7572 6365 5f74 7970 6520 3d3d  f.source_type ==
-00032dd0: 2027 636f 6e74 6f75 7227 206f 7220 666f   'contour' or fo
-00032de0: 7263 655f 636f 6e74 6f75 7273 3a0a 2020  rce_contours:.  
-00032df0: 2020 2020 2020 2020 2020 6966 2061 6273            if abs
-00032e00: 2873 6361 6c65 202d 2031 2920 3c20 736d  (scale - 1) < sm
-00032e10: 616c 6c5f 6e75 6d62 6572 3a0a 2020 2020  all_number:.    
-00032e20: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00032e30: 6273 2872 6f74 6174 696f 6e5b 305d 2920  bs(rotation[0]) 
-00032e40: 3c20 736d 616c 6c5f 6e75 6d62 6572 205c  < small_number \
-00032e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00032e60: 2020 2020 2020 2020 2061 6e64 2061 6273           and abs
-00032e70: 2872 6f74 6174 696f 6e5b 315d 2920 3c20  (rotation[1]) < 
-00032e80: 736d 616c 6c5f 6e75 6d62 6572 3a0a 2020  small_number:.  
-00032e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032ea0: 2020 7472 616e 7366 6f72 6d5f 636f 6e74    transform_cont
-00032eb0: 6f75 7273 203d 2054 7275 650a 0a20 2020  ours = True..   
-00032ec0: 2020 2020 2069 6620 7472 616e 7366 6f72       if transfor
-00032ed0: 6d5f 636f 6e74 6f75 7273 3a0a 0a20 2020  m_contours:..   
-00032ee0: 2020 2020 2020 2020 2023 2041 7070 6c79           # Apply
-00032ef0: 2074 7261 6e73 666f 726d 2074 6f20 726f   transform to ro
-00032f00: 6920 636f 6e74 6f75 7273 0a20 2020 2020  i contours.     
-00032f10: 2020 2020 2020 2074 7261 6e73 6c61 7469         translati
-00032f20: 6f6e 5f32 6420 3d20 2874 7261 6e73 6c61  on_2d = (transla
-00032f30: 7469 6f6e 5b30 5d2c 2074 7261 6e73 6c61  tion[0], transla
-00032f40: 7469 6f6e 5b31 5d29 0a20 2020 2020 2020  tion[1]).       
-00032f50: 2020 2020 2063 656e 7472 655f 3264 203d       centre_2d =
-00032f60: 2028 6365 6e74 7265 5b30 5d2c 2063 656e   (centre[0], cen
-00032f70: 7472 655b 315d 290a 2020 2020 2020 2020  tre[1]).        
-00032f80: 2020 2020 616e 676c 6520 3d20 726f 7461      angle = rota
-00032f90: 7469 6f6e 5b32 5d0a 2020 2020 2020 2020  tion[2].        
-00032fa0: 2020 2020 6e65 775f 636f 6e74 6f75 7273      new_contours
-00032fb0: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
-00032fc0: 2020 666f 7220 6b65 792c 2063 6f6e 746f    for key, conto
-00032fd0: 7572 7320 696e 2073 656c 662e 6765 745f  urs in self.get_
-00032fe0: 636f 6e74 6f75 7273 2829 2e69 7465 6d73  contours().items
-00032ff0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00033000: 2020 2020 6e65 775f 6b65 7920 3d20 6b65      new_key = ke
-00033010: 7920 2b20 7472 616e 736c 6174 696f 6e5b  y + translation[
-00033020: 325d 0a20 2020 2020 2020 2020 2020 2020  2].             
-00033030: 2020 206e 6577 5f63 6f6e 746f 7572 735b     new_contours[
-00033040: 6e65 775f 6b65 795d 203d 205b 5d0a 2020  new_key] = [].  
-00033050: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00033060: 7220 636f 6e74 6f75 7220 696e 2063 6f6e  r contour in con
-00033070: 746f 7572 733a 0a20 2020 2020 2020 2020  tours:.         
-00033080: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-00033090: 6f6e 203d 2063 6f6e 746f 7572 5f74 6f5f  on = contour_to_
-000330a0: 706f 6c79 676f 6e28 636f 6e74 6f75 7229  polygon(contour)
-000330b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000330c0: 2020 2020 2070 6f6c 7967 6f6e 203d 2061       polygon = a
-000330d0: 6666 696e 6974 792e 7472 616e 736c 6174  ffinity.translat
-000330e0: 6528 706f 6c79 676f 6e2c 202a 7472 616e  e(polygon, *tran
-000330f0: 736c 6174 696f 6e5f 3264 290a 2020 2020  slation_2d).    
-00033100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033110: 706f 6c79 676f 6e20 3d20 6166 6669 6e69  polygon = affini
-00033120: 7479 2e72 6f74 6174 6528 706f 6c79 676f  ty.rotate(polygo
-00033130: 6e2c 2061 6e67 6c65 2c20 6365 6e74 7265  n, angle, centre
-00033140: 5f32 6429 0a20 2020 2020 2020 2020 2020  _2d).           
-00033150: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
-00033160: 203d 2061 6666 696e 6974 792e 7363 616c   = affinity.scal
-00033170: 6528 706f 6c79 676f 6e2c 2073 6361 6c65  e(polygon, scale
-00033180: 2c20 7363 616c 652c 2073 6361 6c65 2c0a  , scale, scale,.
-00033190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000331a0: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
-000331b0: 7265 5f32 6429 0a20 2020 2020 2020 2020  re_2d).         
-000331c0: 2020 2020 2020 2020 2020 206e 6577 5f63             new_c
-000331d0: 6f6e 746f 7572 735b 6e65 775f 6b65 795d  ontours[new_key]
-000331e0: 2e61 7070 656e 6428 706f 6c79 676f 6e5f  .append(polygon_
-000331f0: 746f 5f63 6f6e 746f 7572 2870 6f6c 7967  to_contour(polyg
-00033200: 6f6e 2929 0a0a 2020 2020 2020 2020 2020  on))..          
-00033210: 2020 7365 6c66 2e72 6573 6574 5f63 6f6e    self.reset_con
-00033220: 746f 7572 7328 6e65 775f 636f 6e74 6f75  tours(new_contou
-00033230: 7273 290a 0a20 2020 2020 2020 2065 6c73  rs)..        els
-00033240: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
-00033250: 2041 7070 6c79 2074 7261 6e73 666f 726d   Apply transform
-00033260: 2074 6f20 726f 6920 6d61 736b 0a20 2020   to roi mask.   
-00033270: 2020 2020 2020 2020 2073 656c 662e 6372           self.cr
-00033280: 6561 7465 5f6d 6173 6b28 290a 2020 2020  eate_mask().    
-00033290: 2020 2020 2020 2020 7365 6c66 2e6d 6173          self.mas
-000332a0: 6b2e 7472 616e 7366 6f72 6d28 7363 616c  k.transform(scal
-000332b0: 652c 2074 7261 6e73 6c61 7469 6f6e 2c20  e, translation, 
-000332c0: 726f 7461 7469 6f6e 2c0a 2020 2020 2020  rotation,.      
-000332d0: 2020 2020 2020 2020 2020 2020 2020 6365                ce
-000332e0: 6e74 7265 2c20 7265 7361 6d70 6c65 2c20  ntre, resample, 
-000332f0: 7265 7374 6f72 652c 2030 2c20 6669 6c6c  restore, 0, fill
-00033300: 5f76 616c 7565 290a 2020 2020 2020 2020  _value).        
-00033310: 2020 2020 7365 6c66 2e72 6573 6574 5f6d      self.reset_m
-00033320: 6173 6b28 290a 0a20 2020 2064 6566 2063  ask()..    def c
-00033330: 726f 7028 7365 6c66 2c20 786c 696d 3d4e  rop(self, xlim=N
-00033340: 6f6e 652c 2079 6c69 6d3d 4e6f 6e65 2c20  one, ylim=None, 
-00033350: 7a6c 696d 3d4e 6f6e 6529 3a0a 2020 2020  zlim=None):.    
-00033360: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00033370: 4372 6f70 2052 4f49 2074 6f20 7370 6563  Crop ROI to spec
-00033380: 6966 6965 6420 7261 6e67 6520 696e 2078  ified range in x
-00033390: 2c20 792c 207a 2e0a 0a20 2020 2020 2020  , y, z...       
-000333a0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-000333b0: 0a0a 2020 2020 2020 2020 786c 696d 203a  ..        xlim :
-000333c0: 2074 7570 6c65 2c20 6465 6661 756c 743d   tuple, default=
-000333d0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-000333e0: 204c 6f77 6572 2061 6e64 2075 7070 6572   Lower and upper
-000333f0: 2062 6f75 6e64 7320 696e 206d 6d20 666f   bounds in mm fo
-00033400: 7220 6372 6f70 7069 6e67 2061 6c6f 6e67  r cropping along
-00033410: 2078 2d61 7869 732e 0a20 2020 2020 2020   x-axis..       
-00033420: 2020 2020 2049 6620 7365 7420 746f 204e       If set to N
-00033430: 6f6e 652c 206e 6f20 6372 6f70 7069 6e67  one, no cropping
-00033440: 2069 7320 7065 7266 6f72 6d65 642e 2020   is performed.  
-00033450: 4966 2061 2062 6f75 6e64 0a20 2020 2020  If a bound.     
-00033460: 2020 2020 2020 2069 7320 7365 7420 746f         is set to
-00033470: 204e 6f6e 652c 2074 6861 7420 626f 756e   None, that boun
-00033480: 6420 6973 2064 6973 7265 6761 7264 6564  d is disregarded
-00033490: 2e0a 0a20 2020 2020 2020 2079 6c69 6d20  ...        ylim 
-000334a0: 3a20 7475 706c 652c 2064 6566 6175 6c74  : tuple, default
-000334b0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-000334c0: 2020 4c6f 7765 7220 616e 6420 7570 7065    Lower and uppe
-000334d0: 7220 626f 756e 6473 2069 6e20 6d6d 2066  r bounds in mm f
-000334e0: 6f72 2063 726f 7070 696e 6720 616c 6f6e  or cropping alon
-000334f0: 6720 792d 6178 6973 2e0a 2020 2020 2020  g y-axis..      
-00033500: 2020 2020 2020 4966 2073 6574 2074 6f20        If set to 
-00033510: 4e6f 6e65 2c20 6e6f 2063 726f 7070 696e  None, no croppin
-00033520: 6720 6973 2070 6572 666f 726d 6564 2e20  g is performed. 
-00033530: 2049 6620 6120 626f 756e 640a 2020 2020   If a bound.    
-00033540: 2020 2020 2020 2020 6973 2073 6574 2074          is set t
-00033550: 6f20 4e6f 6e65 2c20 7468 6174 2062 6f75  o None, that bou
-00033560: 6e64 2069 7320 6469 7372 6567 6172 6465  nd is disregarde
-00033570: 642e 0a0a 2020 2020 2020 2020 7a6c 696d  d...        zlim
-00033580: 203a 2074 7570 6c65 2c20 6465 6661 756c   : tuple, defaul
-00033590: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-000335a0: 2020 204c 6f77 6572 2061 6e64 2075 7070     Lower and upp
-000335b0: 6572 2062 6f75 6e64 7320 696e 206d 6d20  er bounds in mm 
-000335c0: 666f 7220 6372 6f70 7069 6e67 2061 6c6f  for cropping alo
-000335d0: 6e67 207a 2d61 7869 732e 0a20 2020 2020  ng z-axis..     
-000335e0: 2020 2020 2020 2049 6620 7365 7420 746f         If set to
-000335f0: 204e 6f6e 652c 206e 6f20 6372 6f70 7069   None, no croppi
-00033600: 6e67 2069 7320 7065 7266 6f72 6d65 642e  ng is performed.
-00033610: 2020 4966 2061 2062 6f75 6e64 0a20 2020    If a bound.   
-00033620: 2020 2020 2020 2020 2069 7320 7365 7420           is set 
-00033630: 746f 204e 6f6e 652c 2074 6861 7420 626f  to None, that bo
-00033640: 756e 6420 6973 2064 6973 7265 6761 7264  und is disregard
-00033650: 6564 2e0a 0a20 2020 2020 2020 2049 6620  ed...        If 
-00033660: 6f6e 6c79 207a 6c69 6d20 6973 206e 6f74  only zlim is not
-00033670: 2073 6574 2074 6f20 4e6f 6e65 2061 6e64   set to None and
-00033680: 2074 6865 2052 4f49 2073 6f75 7263 6520   the ROI source 
-00033690: 7479 7065 2069 7320 2263 6f6e 746f 7572  type is "contour
-000336a0: 222c 0a20 2020 2020 2020 2063 726f 7070  ",.        cropp
-000336b0: 696e 6720 6973 2070 6572 666f 726d 6564  ing is performed
-000336c0: 2062 7920 6469 7363 6172 6469 6e67 2063   by discarding c
-000336d0: 6f6e 746f 7572 7320 6f75 7473 6964 6520  ontours outside 
-000336e0: 7468 6520 7265 7175 6972 6564 0a20 2020  the required.   
-000336f0: 2020 2020 2072 616e 6765 2e20 204f 7468       range.  Oth
-00033700: 7769 7365 2063 726f 7070 696e 6720 6973  wise cropping is
-00033710: 2070 6572 666f 726d 6564 206f 6e20 7468   performed on th
-00033720: 6520 524f 4920 6d61 736b 2e0a 2020 2020  e ROI mask..    
-00033730: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00033740: 2320 466f 7220 6372 6f70 7069 6e67 2061  # For cropping a
-00033750: 6c6f 6e67 207a 2c20 616e 6420 7768 6572  long z, and wher
-00033760: 6520 524f 4920 6973 2064 6566 696e 6564  e ROI is defined
-00033770: 2066 726f 6d20 636f 6e74 6f75 7273 2c0a   from contours,.
-00033780: 2020 2020 2020 2020 2320 6469 7363 6172          # discar
-00033790: 6420 636f 6e74 6f75 7273 206f 7574 7369  d contours outsi
-000337a0: 6465 2063 726f 7020 7261 6e67 652e 0a20  de crop range.. 
-000337b0: 2020 2020 2020 2069 6620 7365 6c66 2e73         if self.s
-000337c0: 6f75 7263 655f 7479 7065 203d 3d20 2263  ource_type == "c
-000337d0: 6f6e 746f 7572 2220 616e 6420 7a6c 696d  ontour" and zlim
-000337e0: 2061 6e64 206e 6f74 2078 6c69 6d20 616e   and not xlim an
-000337f0: 6420 6e6f 7420 796c 696d 3a0a 2020 2020  d not ylim:.    
-00033800: 2020 2020 2020 2020 636f 6e74 6f75 7273          contours
-00033810: 203d 2073 656c 662e 6765 745f 636f 6e74   = self.get_cont
-00033820: 6f75 7273 2829 0a20 2020 2020 2020 2020  ours().         
-00033830: 2020 2069 6620 7a6c 696d 5b30 5d20 6973     if zlim[0] is
-00033840: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00033850: 2020 2020 2020 207a 6c69 6d5b 305d 203d         zlim[0] =
-00033860: 206d 696e 2863 6f6e 746f 7572 7329 202d   min(contours) -
-00033870: 2031 0a20 2020 2020 2020 2020 2020 2069   1.            i
-00033880: 6620 7a6c 696d 5b31 5d20 6973 204e 6f6e  f zlim[1] is Non
-00033890: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000338a0: 2020 207a 6c69 6d5b 315d 203d 206d 6178     zlim[1] = max
-000338b0: 2863 6f6e 746f 7572 7329 202b 2031 0a20  (contours) + 1. 
-000338c0: 2020 2020 2020 2020 2020 2063 6f6e 746f             conto
-000338d0: 7572 7320 3d20 7b7a 3a20 7a5f 636f 6e74  urs = {z: z_cont
-000338e0: 6f75 7273 2066 6f72 207a 2c20 7a5f 636f  ours for z, z_co
-000338f0: 6e74 6f75 7273 2069 6e20 636f 6e74 6f75  ntours in contou
-00033900: 7273 2e69 7465 6d73 2829 0a20 2020 2020  rs.items().     
-00033910: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00033920: 6620 287a 203e 207a 6c69 6d5b 305d 2061  f (z > zlim[0] a
-00033930: 6e64 207a 203c 207a 6c69 6d5b 315d 297d  nd z < zlim[1])}
-00033940: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00033950: 5265 7365 7420 636f 6e74 6f75 7273 2e0a  Reset contours..
-00033960: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00033970: 2e72 6573 6574 5f63 6f6e 746f 7572 7328  .reset_contours(
-00033980: 636f 6e74 6f75 7273 290a 0a20 2020 2020  contours)..     
-00033990: 2020 2023 2046 6f72 2061 6c6c 206f 7468     # For all oth
-000339a0: 6572 2063 6173 6573 2c20 6672 6f70 2052  er cases, frop R
-000339b0: 4f49 206d 6173 6b2e 0a20 2020 2020 2020  OI mask..       
-000339c0: 2065 6c69 6620 786c 696d 206f 7220 796c   elif xlim or yl
-000339d0: 696d 206f 7220 7a6c 696d 3a0a 2020 2020  im or zlim:.    
-000339e0: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
-000339f0: 6174 655f 6d61 736b 2829 0a20 2020 2020  ate_mask().     
-00033a00: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00033a10: 2020 2020 2320 456e 7375 7265 2074 6861      # Ensure tha
-00033a20: 7420 6372 6f70 2072 616e 6765 2061 6c6f  t crop range alo
-00033a30: 6e67 2065 6163 6820 6178 6973 2069 7320  ng each axis is 
-00033a40: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00033a50: 2023 206f 7220 6120 7477 6f2d 656c 656d   # or a two-elem
-00033a60: 656e 7420 7475 706c 6520 6f66 2066 6c6f  ent tuple of flo
-00033a70: 6174 732e 0a20 2020 2020 2020 2020 2020  ats..           
-00033a80: 206c 696d 7320 3d20 5b78 6c69 6d2c 2079   lims = [xlim, y
-00033a90: 6c69 6d2c 207a 6c69 6d5d 0a20 2020 2020  lim, zlim].     
-00033aa0: 2020 2020 2020 206d 6173 6b5f 6578 7465         mask_exte
-00033ab0: 6e74 7320 3d20 7365 6c66 2e6d 6173 6b2e  nts = self.mask.
-00033ac0: 6765 745f 6578 7465 6e74 7328 290a 2020  get_extents().  
-00033ad0: 2020 2020 2020 2020 2020 666f 7220 695f            for i_
-00033ae0: 6178 2c20 6c69 6d20 696e 2065 6e75 6d65  ax, lim in enume
-00033af0: 7261 7465 286c 696d 7329 3a0a 2020 2020  rate(lims):.    
-00033b00: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00033b10: 696d 3a0a 2020 2020 2020 2020 2020 2020  im:.            
-00033b20: 2020 2020 2020 2020 666f 7220 6964 7820          for idx 
-00033b30: 696e 205b 302c 2031 5d3a 0a20 2020 2020  in [0, 1]:.     
-00033b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033b50: 2020 2069 6620 6c69 6d5b 6964 785d 2069     if lim[idx] i
-00033b60: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00033b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033b80: 2020 2020 6c69 6d73 5b69 5f61 785d 5b69      lims[i_ax][i
-00033b90: 6478 5d20 3d20 6d61 736b 5f65 7874 656e  dx] = mask_exten
-00033ba0: 7473 5b69 5f61 785d 5b69 6478 5d0a 2020  ts[i_ax][idx].  
-00033bb0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00033bc0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00033bd0: 2020 2020 2020 2020 6c69 6d73 5b69 5f61          lims[i_a
-00033be0: 785d 203d 204e 6f6e 650a 0a20 2020 2020  x] = None..     
-00033bf0: 2020 2020 2020 2023 204c 6f6f 7020 6f76         # Loop ov
-00033c00: 6572 2061 7865 732e 0a20 2020 2020 2020  er axes..       
-00033c10: 2020 2020 2066 6f72 2069 5f61 782c 206c       for i_ax, l
-00033c20: 696d 2069 6e20 656e 756d 6572 6174 6528  im in enumerate(
-00033c30: 6c69 6d73 293a 0a0a 2020 2020 2020 2020  lims):..        
-00033c40: 2020 2020 2020 2020 6966 206c 696d 2069          if lim i
-00033c50: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00033c60: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00033c70: 696e 7565 0a0a 2020 2020 2020 2020 2020  inue..          
-00033c80: 2020 2020 2020 2320 4669 6e64 2061 7272        # Find arr
-00033c90: 6179 2069 6e64 6963 6573 2061 7420 7768  ay indices at wh
-00033ca0: 6963 6820 746f 2063 726f 702e 0a20 2020  ich to crop..   
-00033cb0: 2020 2020 2020 2020 2020 2020 2069 3120               i1 
-00033cc0: 3d20 7365 6c66 2e6d 6173 6b2e 706f 735f  = self.mask.pos_
-00033cd0: 746f 5f69 6478 280a 2020 2020 2020 2020  to_idx(.        
-00033ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033cf0: 6c69 6d73 5b69 5f61 785d 5b30 5d2c 2061  lims[i_ax][0], a
-00033d00: 783d 695f 6178 2c20 7265 7475 726e 5f69  x=i_ax, return_i
-00033d10: 6e74 3d46 616c 7365 290a 2020 2020 2020  nt=False).      
-00033d20: 2020 2020 2020 2020 2020 6932 203d 2073            i2 = s
-00033d30: 656c 662e 6d61 736b 2e70 6f73 5f74 6f5f  elf.mask.pos_to_
-00033d40: 6964 7828 6c69 6d73 5b69 5f61 785d 5b31  idx(lims[i_ax][1
-00033d50: 5d2c 2061 783d 695f 6178 2c0a 2020 2020  ], ax=i_ax,.    
-00033d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033d70: 2020 2020 7265 7475 726e 5f69 6e74 3d46      return_int=F
-00033d80: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
-00033d90: 2020 2020 2020 695f 6269 672c 2069 5f73        i_big, i_s
-00033da0: 6d61 6c6c 203d 2069 322c 2069 310a 2020  mall = i2, i1.  
-00033db0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00033dc0: 2069 3120 3e20 6932 3a0a 2020 2020 2020   i1 > i2:.      
-00033dd0: 2020 2020 2020 2020 2020 2020 2020 695f                i_
-00033de0: 6269 672c 2069 5f73 6d61 6c6c 203d 2069  big, i_small = i
-00033df0: 5f73 6d61 6c6c 2c20 695f 6269 670a 2020  _small, i_big.  
-00033e00: 2020 2020 2020 2020 2020 2020 2020 695f                i_
-00033e10: 736d 616c 6c20 3d20 696e 7428 6e70 2e66  small = int(np.f
-00033e20: 6c6f 6f72 2869 5f73 6d61 6c6c 202b 2030  loor(i_small + 0
-00033e30: 2e35 2929 0a20 2020 2020 2020 2020 2020  .5)).           
-00033e40: 2020 2020 2069 5f62 6967 203d 2069 6e74       i_big = int
-00033e50: 286e 702e 666c 6f6f 7228 695f 6269 6720  (np.floor(i_big 
-00033e60: 2b20 302e 3529 290a 0a20 2020 2020 2020  + 0.5))..       
-00033e70: 2020 2020 2020 2020 2023 2043 726f 7020           # Crop 
-00033e80: 7468 6520 6d61 736b 2e0a 2020 2020 2020  the mask..      
-00033e90: 2020 2020 2020 2020 2020 6178 5f74 6f5f            ax_to_
-00033ea0: 736c 6963 6520 3d20 7365 6c66 2e6d 6173  slice = self.mas
-00033eb0: 6b2e 6765 745f 6178 6573 2829 2e69 6e64  k.get_axes().ind
-00033ec0: 6578 2869 5f61 7829 0a20 2020 2020 2020  ex(i_ax).       
-00033ed0: 2020 2020 2020 2020 2069 6620 695f 736d           if i_sm
-00033ee0: 616c 6c20 3e20 3020 616e 6420 695f 736d  all > 0 and i_sm
-00033ef0: 616c 6c20 3c20 7365 6c66 2e6d 6173 6b2e  all < self.mask.
-00033f00: 6e5f 766f 7865 6c73 5b69 5f61 785d 3a0a  n_voxels[i_ax]:.
-00033f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033f20: 2020 2020 7365 6c66 2e6d 6173 6b2e 6461      self.mask.da
-00033f30: 7461 2e73 7761 7061 7865 7328 302c 2061  ta.swapaxes(0, a
-00033f40: 785f 746f 5f73 6c69 6365 295b 3a69 5f73  x_to_slice)[:i_s
-00033f50: 6d61 6c6c 2c20 3a2c 203a 5d20 3d20 300a  mall, :, :] = 0.
-00033f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033f70: 6966 2069 5f62 6967 203e 2030 2061 6e64  if i_big > 0 and
-00033f80: 2069 5f62 6967 203c 2073 656c 662e 6d61   i_big < self.ma
-00033f90: 736b 2e6e 5f76 6f78 656c 735b 695f 6178  sk.n_voxels[i_ax
-00033fa0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00033fb0: 2020 2020 2020 2073 656c 662e 6d61 736b         self.mask
-00033fc0: 2e64 6174 612e 7377 6170 6178 6573 2830  .data.swapaxes(0
-00033fd0: 2c20 6178 5f74 6f5f 736c 6963 6529 5b69  , ax_to_slice)[i
-00033fe0: 5f62 6967 3a2c 203a 2c20 3a5d 203d 2030  _big:, :, :] = 0
-00033ff0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00034000: 5265 7365 7420 6d61 736b 2e0a 2020 2020  Reset mask..    
-00034010: 2020 2020 2020 2020 7365 6c66 2e72 6573          self.res
-00034020: 6574 5f6d 6173 6b28 7365 6c66 2e6d 6173  et_mask(self.mas
-00034030: 6b29 0a0a 2020 2020 6465 6620 6372 6f70  k)..    def crop
-00034040: 5f62 795f 616d 6f75 6e74 7328 7365 6c66  _by_amounts(self
-00034050: 2c20 6478 3d4e 6f6e 652c 2064 793d 4e6f  , dx=None, dy=No
-00034060: 6e65 2c20 647a 3d4e 6f6e 6529 3a0a 2020  ne, dz=None):.  
-00034070: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00034080: 2020 4372 6f70 2052 4f49 2062 7920 7468    Crop ROI by th
-00034090: 6520 616d 6f75 6e74 7320 6478 2c20 6479  e amounts dx, dy
-000340a0: 2c20 647a 2069 6e20 6d6d 2e0a 0a20 2020  , dz in mm...   
-000340b0: 2020 2020 2054 6869 7320 6d65 7468 6f64       This method
-000340c0: 2063 616c 6c73 2074 6865 2066 756e 6374   calls the funct
-000340d0: 696f 6e20 736b 7274 2e69 6d61 6765 2e63  ion skrt.image.c
-000340e0: 726f 705f 6279 5f61 6d6f 756e 7473 2829  rop_by_amounts()
-000340f0: 2c20 7769 7468 0a20 2020 2020 2020 2073  , with.        s
-00034100: 656c 6620 7061 7373 6564 2061 7320 6f62  elf passed as ob
-00034110: 6a65 6374 2066 6f72 2063 726f 7070 696e  ject for croppin
-00034120: 672e 0a0a 2020 2020 2020 2020 5468 6520  g...        The 
-00034130: 616d 6f75 6e74 206f 6620 6372 6f70 7069  amount of croppi
-00034140: 6e67 2061 6c6f 6e67 2065 6163 6820 6469  ng along each di
-00034150: 7265 6374 696f 6e20 7368 6f75 6c64 2062  rection should b
-00034160: 6520 6f6e 6520 6f66 3a0a 2020 2020 2020  e one of:.      
-00034170: 2020 2d20 666c 6f61 7420 3a20 7468 6520    - float : the 
-00034180: 524f 4920 6973 2063 726f 7070 6564 2062  ROI is cropped b
-00034190: 7920 7468 6973 2061 6d6f 756e 7420 6f6e  y this amount on
-000341a0: 2062 6f74 6820 7369 6465 733b 0a20 2020   both sides;.   
-000341b0: 2020 2020 202d 2074 776f 2d65 6c65 6d65       - two-eleme
-000341c0: 6e74 2074 7570 6c65 3a20 7468 6520 524f  nt tuple: the RO
-000341d0: 4920 6973 2063 726f 7070 6564 206f 6e20  I is cropped on 
-000341e0: 7468 6520 7369 6465 7320 6f66 206c 6f77  the sides of low
-000341f0: 6572 0a20 2020 2020 2020 2020 2061 6e64  er.          and
-00034200: 2068 6967 6865 7220 7661 6c75 6573 2062   higher values b
-00034210: 7920 7468 6520 616d 6f75 6e74 7320 7370  y the amounts sp
-00034220: 6563 6966 6965 643b 0a20 2020 2020 2020  ecified;.       
-00034230: 202d 204e 6f6e 6520 3a20 6e6f 2063 726f   - None : no cro
-00034240: 7070 696e 6720 6973 2070 6572 666f 726d  pping is perform
-00034250: 6564 2e0a 0a20 2020 2020 2020 2046 6f72  ed...        For
-00034260: 206d 6f72 6520 6465 7461 696c 732c 2073   more details, s
-00034270: 6565 2064 6f63 756d 656e 7461 7469 6f6e  ee documentation
-00034280: 206f 6620 736b 7274 2e69 6d61 6765 2e63   of skrt.image.c
-00034290: 726f 705f 6279 5f61 6d6f 756e 7473 2829  rop_by_amounts()
-000342a0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000342b0: 2020 2020 2020 736b 7274 2e69 6d61 6765        skrt.image
-000342c0: 2e63 726f 705f 6279 5f61 6d6f 756e 7473  .crop_by_amounts
-000342d0: 2873 656c 662c 2064 782c 2064 792c 2064  (self, dx, dy, d
-000342e0: 7a29 0a0a 2020 2020 6465 6620 6372 6f70  z)..    def crop
-000342f0: 5f74 6f5f 726f 695f 6c65 6e67 7468 2873  _to_roi_length(s
-00034300: 656c 662c 206f 7468 6572 2c20 6178 3d22  elf, other, ax="
-00034310: 7a22 293a 0a20 2020 2020 2020 2022 2222  z"):.        """
-00034320: 0a20 2020 2020 2020 2043 726f 7020 746f  .        Crop to
-00034330: 206c 656e 6774 6820 6f66 206f 7468 6572   length of other
-00034340: 2052 4f49 2061 6c6f 6e67 2061 2067 6976   ROI along a giv
-00034350: 656e 2061 7869 732e 0a0a 2020 2020 2020  en axis...      
-00034360: 2020 2a2a 5061 7261 6d65 7465 7273 3a2a    **Parameters:*
-00034370: 2a0a 2020 2020 2020 2020 6f74 6865 7220  *.        other 
-00034380: 3a20 736b 7274 2e73 7472 7563 7475 7265  : skrt.structure
-00034390: 732e 524f 490a 2020 2020 2020 2020 2020  s.ROI.          
-000343a0: 2020 524f 4920 6f62 6a65 6374 2074 6f20    ROI object to 
-000343b0: 7768 6963 6820 746f 2063 726f 702e 0a20  which to crop.. 
-000343c0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-000343d0: 2020 2061 7820 3a20 7374 722f 696e 742c     ax : str/int,
-000343e0: 2064 6566 6175 6c74 3d22 7a22 0a20 2020   default="z".   
-000343f0: 2020 2020 2020 2020 2041 7869 7320 616c           Axis al
-00034400: 6f6e 6720 7768 6963 6820 746f 2070 6572  ong which to per
-00034410: 666f 726d 2063 726f 7070 696e 672e 2053  form cropping. S
-00034420: 686f 756c 6420 6265 206f 6e65 206f 660a  hould be one of.
-00034430: 2020 2020 2020 2020 2020 2020 5b22 7822              ["x"
-00034440: 2c20 2279 222c 2022 7a22 5d20 6f72 205b  , "y", "z"] or [
-00034450: 302c 2031 2c20 325d 2e0a 2020 2020 2020  0, 1, 2]..      
-00034460: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
-00034470: 4465 7465 726d 696e 6520 6372 6f70 2072  Determine crop r
-00034480: 616e 6765 2e0a 2020 2020 2020 2020 6c69  ange..        li
-00034490: 6d73 203d 2033 202a 205b 4e6f 6e65 5d0a  ms = 3 * [None].
-000344a0: 2020 2020 2020 2020 695f 6178 203d 2073          i_ax = s
-000344b0: 6b72 742e 696d 6167 652e 5f61 7865 732e  krt.image._axes.
-000344c0: 696e 6465 7828 6178 2920 6966 2069 7369  index(ax) if isi
-000344d0: 6e73 7461 6e63 6528 6178 2c20 7374 7229  nstance(ax, str)
-000344e0: 2065 6c73 6520 6178 0a20 2020 2020 2020   else ax.       
-000344f0: 206c 696d 735b 695f 6178 5d20 3d20 6f74   lims[i_ax] = ot
-00034500: 6865 722e 6765 745f 6578 7465 6e74 2861  her.get_extent(a
-00034510: 783d 6178 290a 0a20 2020 2020 2020 2023  x=ax)..        #
-00034520: 2050 6572 666f 726d 2063 726f 7070 696e   Perform croppin
-00034530: 672e 0a20 2020 2020 2020 2073 656c 662e  g..        self.
-00034540: 6372 6f70 282a 6c69 6d73 290a 0a20 2020  crop(*lims)..   
-00034550: 2064 6566 2063 726f 705f 746f 5f72 6f69   def crop_to_roi
-00034560: 2873 656c 662c 2072 6f69 2c20 2a2a 6b77  (self, roi, **kw
-00034570: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
-00034580: 2222 0a20 2020 2020 2020 2043 726f 7020  "".        Crop 
-00034590: 524f 4920 6d61 736b 2074 6f20 7265 6769  ROI mask to regi
-000345a0: 6f6e 2063 6f76 6572 6564 2062 7920 616e  on covered by an
-000345b0: 2052 4f49 2e0a 2020 2020 2020 2020 2222   ROI..        ""
-000345c0: 220a 2020 2020 2020 2020 7365 6c66 2e63  ".        self.c
-000345d0: 7265 6174 655f 6d61 736b 2829 0a20 2020  reate_mask().   
-000345e0: 2020 2020 2073 656c 662e 6d61 736b 2e63       self.mask.c
-000345f0: 726f 705f 746f 5f72 6f69 2872 6f69 2c20  rop_to_roi(roi, 
-00034600: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
-00034610: 2020 7365 6c66 2e73 6861 7065 203d 2073    self.shape = s
-00034620: 656c 662e 6765 745f 6d61 736b 2829 2e73  elf.get_mask().s
-00034630: 6861 7065 0a0a 2020 2020 6465 6620 6164  hape..    def ad
-00034640: 645f 706c 616e 2873 656c 662c 2070 6c61  d_plan(self, pla
-00034650: 6e29 3a0a 2020 2020 2020 2020 2222 2241  n):.        """A
-00034660: 6464 2061 2050 6c61 6e20 6f62 6a65 6374  dd a Plan object
-00034670: 2074 6f20 6265 2061 7373 6f63 6961 7465   to be associate
-00034680: 6420 7769 7468 2074 6869 7320 524f 492e  d with this ROI.
-00034690: 2054 6869 730a 2020 2020 2020 2020 646f   This.        do
-000346a0: 6573 206e 6f74 2061 6666 6563 7420 7468  es not affect th
-000346b0: 6520 7374 7275 6374 7572 6520 7365 7420  e structure set 
-000346c0: 6173 736f 6369 6174 6564 2077 6974 6820  associated with 
-000346d0: 7468 6520 506c 616e 206f 626a 6563 742e  the Plan object.
-000346e0: 0a0a 2020 2020 2020 2020 2a2a 5061 7261  ..        **Para
-000346f0: 6d65 7465 7273 3a2a 2a0a 0a20 2020 2020  meters:**..     
-00034700: 2020 2070 6c61 6e20 3a20 736b 7274 2e64     plan : skrt.d
-00034710: 6f73 652e 506c 616e 0a20 2020 2020 2020  ose.Plan.       
-00034720: 2020 2020 2041 2050 6c61 6e20 6f62 6a65       A Plan obje
-00034730: 6374 2074 6f20 6173 7369 676e 2074 6f20  ct to assign to 
-00034740: 7468 6973 2073 7472 7563 7475 7265 2073  this structure s
-00034750: 6574 2e0a 2020 2020 2020 2020 2222 220a  et..        """.
-00034760: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00034770: 706c 616e 2069 6e20 7365 6c66 2e70 6c61  plan in self.pla
-00034780: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-00034790: 7365 6c66 2e70 6c61 6e73 2e61 7070 656e  self.plans.appen
-000347a0: 6428 706c 616e 290a 2020 2020 2020 2020  d(plan).        
-000347b0: 2020 2020 7365 6c66 2e70 6c61 6e73 2e73      self.plans.s
-000347c0: 6f72 7428 290a 0a20 2020 2064 6566 2063  ort()..    def c
-000347d0: 6c65 6172 5f70 6c61 6e73 2873 656c 6629  lear_plans(self)
-000347e0: 3a0a 2020 2020 2020 2020 2222 2243 6c65  :.        """Cle
-000347f0: 6172 2061 6c6c 2070 6c61 6e20 6d61 7073  ar all plan maps
-00034800: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
-00034810: 2074 6869 7320 524f 492e 2222 220a 0a20   this ROI.""".. 
-00034820: 2020 2020 2020 2073 656c 662e 706c 616e         self.plan
-00034830: 7320 3d20 5b5d 0a0a 2020 2020 6465 6620  s = []..    def 
-00034840: 6765 745f 706c 616e 7328 7365 6c66 293a  get_plans(self):
-00034850: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-00034860: 726e 206c 6973 7420 6f66 2050 6c61 6e20  rn list of Plan 
-00034870: 6f62 6a65 6374 7320 6173 736f 6369 6174  objects associat
-00034880: 6564 2077 6974 6820 7468 6973 2052 4f49  ed with this ROI
-00034890: 2e22 2222 0a0a 2020 2020 2020 2020 7265  ."""..        re
-000348a0: 7475 726e 2073 656c 662e 706c 616e 730a  turn self.plans.
-000348b0: 0a20 2020 2064 6566 2067 6574 5f63 6f6c  .    def get_col
-000348c0: 6f72 5f66 726f 6d5f 6b77 6172 6773 2873  or_from_kwargs(s
-000348d0: 656c 662c 206b 7761 7267 733d 7b7d 2c20  elf, kwargs={}, 
-000348e0: 6b65 793d 2772 6f69 5f63 6f6c 6f72 7327  key='roi_colors'
-000348f0: 293a 0a20 2020 2020 2020 2027 2727 0a20  ):.        '''. 
-00034900: 2020 2020 2020 2052 6574 7572 6e20 524f         Return RO
-00034910: 4920 636f 6c6f 7572 2070 6173 7365 6420  I colour passed 
-00034920: 7669 6120 6469 6374 696f 6e61 7279 206f  via dictionary o
-00034930: 6620 6b65 7977 6f72 6420 6172 6775 6d65  f keyword argume
-00034940: 6e74 732e 0a0a 2020 2020 2020 2020 2a2a  nts...        **
-00034950: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
-00034960: 2020 2020 2020 206b 7761 7267 7320 3a20         kwargs : 
-00034970: 6469 6374 2c20 6465 6661 756c 743d 7b7d  dict, default={}
-00034980: 0a20 2020 2020 2020 2020 2020 2044 6963  .            Dic
-00034990: 7469 6f6e 6172 7920 6f66 206b 6579 776f  tionary of keywo
-000349a0: 7264 2061 7267 756d 656e 7473 2c20 7768  rd arguments, wh
-000349b0: 6963 6820 6d61 7920 696e 636c 7564 650a  ich may include.
-000349c0: 2020 2020 2020 2020 2020 2020 7061 7261              para
-000349d0: 6d65 7465 7220 7072 6f76 6964 696e 6720  meter providing 
-000349e0: 6469 6374 696f 6e61 7279 206f 6620 524f  dictionary of RO
-000349f0: 4920 636f 6c6f 7572 7320 666f 7220 706c  I colours for pl
-00034a00: 6f74 7469 6e67 2e0a 0a20 2020 2020 2020  otting...       
-00034a10: 206b 6579 203a 2073 7472 2c20 6465 6661   key : str, defa
-00034a20: 756c 743d 2772 6f69 5f63 6f6c 6f72 7327  ult='roi_colors'
-00034a30: 0a20 2020 2020 2020 2020 2020 204b 6579  .            Key
-00034a40: 2069 6e20 6b77 6172 6773 2064 6963 7469   in kwargs dicti
-00034a50: 6f6e 6172 7920 7370 6563 6966 7969 6e67  onary specifying
-00034a60: 2070 6172 616d 6574 6572 2074 6861 742c   parameter that,
-00034a70: 2069 660a 2020 2020 2020 2020 2020 2020   if.            
-00034a80: 7072 6573 656e 742c 2070 726f 7669 6465  present, provide
-00034a90: 7320 6469 6374 696f 6e61 7279 206f 6620  s dictionary of 
-00034aa0: 524f 4920 636f 6c6f 7572 732e 0a20 2020  ROI colours..   
-00034ab0: 2020 2020 2027 2727 0a20 2020 2020 2020       '''.       
-00034ac0: 2072 6f69 5f63 6f6c 6f72 7320 3d20 6b77   roi_colors = kw
-00034ad0: 6172 6773 2e67 6574 286b 6579 2c20 7b7d  args.get(key, {}
-00034ae0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00034af0: 2072 6f69 5f63 6f6c 6f72 732e 6765 7428   roi_colors.get(
-00034b00: 7365 6c66 2e6e 616d 652c 2073 656c 662e  self.name, self.
-00034b10: 636f 6c6f 7229 0a0a 2020 2020 6465 6620  color)..    def 
-00034b20: 7370 6c69 7428 7365 6c66 2c20 766f 7865  split(self, voxe
-00034b30: 6c5f 7369 7a65 3d4e 6f6e 652c 206e 616d  l_size=None, nam
-00034b40: 6573 3d4e 6f6e 652c 206f 7264 6572 3d27  es=None, order='
-00034b50: 782b 2729 3a0a 2020 2020 2020 2020 2727  x+'):.        ''
-00034b60: 270a 2020 2020 2020 2020 5370 6c69 7420  '.        Split 
-00034b70: 6120 636f 6d70 6f73 6974 6520 524f 4920  a composite ROI 
-00034b80: 696e 746f 2069 7473 2063 6f6d 706f 6e65  into its compone
-00034b90: 6e74 732e 0a0a 2020 2020 2020 2020 4120  nts...        A 
-00034ba0: 636f 6d70 6f73 6974 6520 524f 4920 6d61  composite ROI ma
-00034bb0: 7920 7265 7375 6c74 2062 6563 6175 7365  y result because
-00034bc0: 2070 6879 6963 616c 6c79 2073 6570 6172   phyically separ
-00034bd0: 6174 6520 524f 4973 2061 7265 0a20 2020  ate ROIs are.   
-00034be0: 2020 2020 2067 6976 656e 2074 6865 2073       given the s
-00034bf0: 616d 6520 6c61 6265 6c20 6475 7269 6e67  ame label during
-00034c00: 206d 616e 7561 6c20 636f 6e74 6f75 7269   manual contouri
-00034c10: 6e67 2c20 6f72 2062 6563 6175 7365 0a20  ng, or because. 
-00034c20: 2020 2020 2020 206d 756c 7469 706c 6520         multiple 
-00034c30: 524f 4973 2061 7265 2072 6574 7572 6e65  ROIs are returne
-00034c40: 6420 6279 2061 6e20 6175 746f 2d73 6567  d by an auto-seg
-00034c50: 6d65 6e74 6174 696f 6e20 616c 676f 7269  mentation algori
-00034c60: 7468 6d2e 0a0a 2020 2020 2020 2020 5468  thm...        Th
-00034c70: 6520 636f 6d70 6f6e 656e 7420 524f 4973  e component ROIs
-00034c80: 2061 7265 2069 6465 6e74 6966 6965 6420   are identified 
-00034c90: 6279 206c 6162 656c 6c69 6e67 2061 206d  by labelling a m
-00034ca0: 6173 6b20 6f66 2074 6865 0a20 2020 2020  ask of the.     
-00034cb0: 2020 2063 6f6d 706f 7369 7465 2c20 7573     composite, us
-00034cc0: 696e 6720 7363 6970 792e 6e64 696d 6167  ing scipy.ndimag
-00034cd0: 652e 6c61 6265 6c28 292e 0a0a 2020 2020  e.label()...    
-00034ce0: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
-00034cf0: 3a2a 2a0a 0a20 2020 2020 2020 2076 6f78  :**..        vox
-00034d00: 656c 5f73 697a 6520 3a20 7475 706c 652c  el_size : tuple,
-00034d10: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00034d20: 2020 2020 2020 2020 2020 566f 7865 6c20            Voxel 
-00034d30: 7369 7a65 2028 782c 2079 2920 6469 6d65  size (x, y) dime
-00034d40: 6e73 696f 6e73 2074 6f20 7573 6520 696e  nsions to use in
-00034d50: 2063 7265 6174 696e 6720 6d61 736b 2066   creating mask f
-00034d60: 6f72 0a20 2020 2020 2020 2020 2020 206c  or.            l
-00034d70: 6162 656c 6c69 6e67 2e20 2054 6869 7320  abelling.  This 
-00034d80: 6361 6e20 6265 2075 7365 6675 6c20 6966  can be useful if
-00034d90: 2074 6865 2052 4f49 2073 6f75 7263 6520   the ROI source 
-00034da0: 6973 2063 6f6e 746f 7572 0a20 2020 2020  is contour.     
-00034db0: 2020 2020 2020 2070 6f69 6e74 732c 2061         points, a
-00034dc0: 6e64 2074 6865 2072 6573 6f6c 7574 696f  nd the resolutio
-00034dd0: 6e20 7761 6e74 6564 2069 7320 6772 6561  n wanted is grea
-00034de0: 7465 7220 7468 616e 2069 7320 616c 6c6f  ter than is allo
-00034df0: 7765 640a 2020 2020 2020 2020 2020 2020  wed.            
-00034e00: 6279 2074 6865 2076 6f78 656c 2073 697a  by the voxel siz
-00034e10: 6520 6f66 2074 6865 2052 4f49 2069 6d61  e of the ROI ima
-00034e20: 6765 2e0a 0a20 2020 2020 2020 206e 616d  ge...        nam
-00034e30: 6573 3a20 6c69 7374 2c20 6465 6661 756c  es: list, defaul
-00034e40: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-00034e50: 2020 204c 6973 7420 6f66 206e 616d 6573     List of names
-00034e60: 2074 6f20 6265 2061 7070 6c69 6564 2074   to be applied t
-00034e70: 6f20 7468 6520 636f 6d70 6f6e 656e 7420  o the component 
-00034e80: 524f 4973 2e20 204e 616d 6573 0a20 2020  ROIs.  Names.   
-00034e90: 2020 2020 2020 2020 2061 7265 2061 7070           are app
-00034ea0: 6c69 6564 2061 6674 6572 2061 6e79 2052  lied after any R
-00034eb0: 4f49 206f 7264 6572 696e 672e 0a0a 2020  OI ordering...  
-00034ec0: 2020 2020 2020 6f72 6465 7220 3a20 7374        order : st
-00034ed0: 722c 2064 6566 6175 6c74 3d27 782b 270a  r, default='x+'.
-00034ee0: 2020 2020 2020 2020 2020 2020 5370 6563              Spec
-00034ef0: 6966 6963 6174 696f 6e20 6f66 2077 6179  ification of way
-00034f00: 2069 7420 7768 6963 6820 524f 4973 2061   it which ROIs a
-00034f10: 7265 2074 6f20 6265 206f 7264 6572 643a  re to be orderd:
-00034f20: 0a20 2020 2020 2020 2020 2020 202d 2027  .            - '
-00034f30: 782b 2720 3a20 696e 206f 7264 6572 206f  x+' : in order o
-00034f40: 6620 696e 6372 6561 7369 6e67 2078 2076  f increasing x v
-00034f50: 616c 7565 2e0a 2020 2020 2020 2020 2020  alue..          
-00034f60: 2020 2d20 2778 2d27 203a 2069 6e20 6f72    - 'x-' : in or
-00034f70: 6465 7220 6f66 2064 6563 7265 6173 696e  der of decreasin
-00034f80: 6720 7820 7661 6c75 652e 0a20 2020 2020  g x value..     
-00034f90: 2020 2020 2020 202d 2027 792b 2720 3a20         - 'y+' : 
-00034fa0: 696e 206f 7264 6572 206f 6620 696e 6372  in order of incr
-00034fb0: 6561 7369 6e67 2079 2076 616c 7565 2e0a  easing y value..
-00034fc0: 2020 2020 2020 2020 2020 2020 2d20 2779              - 'y
-00034fd0: 2d27 203a 2069 6e20 6f72 6465 7220 6f66  -' : in order of
-00034fe0: 2064 6563 7265 6173 696e 6720 7920 7661   decreasing y va
-00034ff0: 6c75 652e 0a20 2020 2020 2020 2020 2020  lue..           
-00035000: 202d 2027 7a2b 2720 3a20 696e 206f 7264   - 'z+' : in ord
-00035010: 6572 206f 6620 696e 6372 6561 7369 6e67  er of increasing
-00035020: 207a 2076 616c 7565 2e0a 2020 2020 2020   z value..      
-00035030: 2020 2020 2020 2d20 277a 2d27 203a 2069        - 'z-' : i
-00035040: 6e20 6f72 6465 7220 6f66 2064 6563 7265  n order of decre
-00035050: 6173 696e 6720 7a20 7661 6c75 652e 0a20  asing z value.. 
-00035060: 2020 2020 2020 2020 2020 2049 6620 616e             If an
-00035070: 7920 6f74 6865 7220 7661 6c75 6573 2069  y other values i
-00035080: 7320 6769 7665 6e2c 206e 6f20 6f72 6465  s given, no orde
-00035090: 7269 6e67 2069 7320 7065 7266 6f72 6d65  ring is performe
-000350a0: 642e 0a20 2020 2020 2020 2027 2727 0a0a  d..        '''..
-000350b0: 2020 2020 2020 2020 2320 4966 206e 616d          # If nam
-000350c0: 6573 206e 6f74 2073 7065 6369 6669 6564  es not specified
-000350d0: 2c20 6d61 6b65 2069 7420 616e 2065 6d70  , make it an emp
-000350e0: 7479 206c 6973 742e 0a20 2020 2020 2020  ty list..       
-000350f0: 2069 6620 6e61 6d65 7320 6973 204e 6f6e   if names is Non
-00035100: 653a 0a20 2020 2020 2020 2020 2020 206e  e:.            n
-00035110: 616d 6573 203d 205b 5d0a 0a20 2020 2020  ames = []..     
-00035120: 2020 2023 2052 6573 697a 6520 524f 4920     # Resize ROI 
-00035130: 6d61 736b 2069 6620 766f 7865 6c20 7369  mask if voxel si
-00035140: 7a65 2069 7320 746f 2062 6520 6368 616e  ze is to be chan
-00035150: 6765 642e 0a20 2020 2020 2020 2069 6620  ged..        if 
-00035160: 766f 7865 6c5f 7369 7a65 3a0a 2020 2020  voxel_size:.    
-00035170: 2020 2020 2020 2020 726f 6920 3d20 524f          roi = RO
-00035180: 4928 7365 6c66 290a 2020 2020 2020 2020  I(self).        
-00035190: 2020 2020 766f 7865 6c5f 7369 7a65 5f33      voxel_size_3
-000351a0: 6420 3d20 2876 6f78 656c 5f73 697a 655b  d = (voxel_size[
-000351b0: 305d 2c20 766f 7865 6c5f 7369 7a65 5b31  0], voxel_size[1
-000351c0: 5d2c 204e 6f6e 6529 0a20 2020 2020 2020  ], None).       
-000351d0: 2020 2020 2072 6f69 2e63 7265 6174 655f       roi.create_
-000351e0: 6d61 736b 2829 0a20 2020 2020 2020 2020  mask().         
-000351f0: 2020 2072 6f69 2e6d 6173 6b2e 7265 7369     roi.mask.resi
-00035200: 7a65 2876 6f78 656c 5f73 697a 653d 766f  ze(voxel_size=vo
-00035210: 7865 6c5f 7369 7a65 5f33 642c 206d 6574  xel_size_3d, met
-00035220: 686f 643d 276e 6561 7265 7374 272c 0a20  hod='nearest',. 
-00035230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035240: 2020 2069 6d61 6765 5f73 697a 655f 756e     image_size_un
-00035250: 6974 3d27 6d6d 2729 0a20 2020 2020 2020  it='mm').       
-00035260: 2020 2020 2072 6f69 2e73 6574 5f69 6d61       roi.set_ima
-00035270: 6765 2873 6b72 742e 696d 6167 652e 496d  ge(skrt.image.Im
-00035280: 6167 6528 726f 692e 6d61 736b 2929 0a20  age(roi.mask)). 
-00035290: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000352a0: 2020 2020 2020 2020 2072 6f69 203d 2073           roi = s
-000352b0: 656c 660a 200a 2020 2020 2020 2020 2320  elf. .        # 
-000352c0: 4c61 6265 6c20 524f 4920 636f 6d70 6f6e  Label ROI compon
-000352d0: 656e 7473 2e0a 2020 2020 2020 2020 6c61  ents..        la
-000352e0: 6265 6c5f 6d61 736b 2c20 6e5f 6c61 6265  bel_mask, n_labe
-000352f0: 6c20 3d20 6e64 696d 6167 652e 6c61 6265  l = ndimage.labe
-00035300: 6c28 726f 692e 6765 745f 6d61 736b 2829  l(roi.get_mask()
-00035310: 290a 0a20 2020 2020 2020 2069 6620 766f  )..        if vo
-00035320: 7865 6c5f 7369 7a65 2061 6e64 2027 636f  xel_size and 'co
-00035330: 6e74 6f75 7227 203d 3d20 7365 6c66 2e73  ntour' == self.s
-00035340: 6f75 7263 655f 7479 7065 3a0a 2020 2020  ource_type:.    
-00035350: 2020 2020 2020 2020 2320 4861 6e64 6c65          # Handle
-00035360: 2063 6173 6573 2077 6865 7265 2063 6f6d   cases where com
-00035370: 706f 7369 7465 2052 4f49 2069 7320 6672  posite ROI is fr
-00035380: 6f6d 2063 6f6e 746f 7572 2070 6f69 6e74  om contour point
-00035390: 732c 0a20 2020 2020 2020 2020 2020 2023  s,.            #
-000353a0: 2061 6e64 206d 6173 6b20 766f 7865 6c20   and mask voxel 
-000353b0: 7369 7a65 2068 6173 2062 6565 6e20 7061  size has been pa
-000353c0: 7373 6564 2061 7320 616e 2061 7267 756d  ssed as an argum
-000353d0: 656e 742e 0a20 2020 2020 2020 2020 2020  ent..           
-000353e0: 2023 2049 6e20 7468 6973 2063 6173 6520   # In this case 
-000353f0: 636f 6d70 6f6e 656e 7420 524f 4973 2061  component ROIs a
-00035400: 7265 2069 6e69 7469 616c 6973 6564 2066  re initialised f
-00035410: 726f 6d20 636f 6e74 6f75 7273 0a20 2020  rom contours.   
-00035420: 2020 2020 2020 2020 2023 2072 6563 7265           # recre
-00035430: 6174 6564 2066 726f 6d20 7468 6520 6d61  ated from the ma
-00035440: 736b 2c20 7768 6963 6820 6d61 7920 6265  sk, which may be
-00035450: 2068 6967 6865 722d 7265 736f 6c75 7469   higher-resoluti
-00035460: 6f6e 0a20 2020 2020 2020 2020 2020 2023  on.            #
-00035470: 2074 6861 6e20 7468 6520 6465 6661 756c   than the defaul
-00035480: 742e 0a20 2020 2020 2020 2020 2020 2073  t..            s
-00035490: 7330 203d 2053 7472 7563 7475 7265 5365  s0 = StructureSe
-000354a0: 7428 6c61 6265 6c5f 6d61 736b 2c20 6d75  t(label_mask, mu
-000354b0: 6c74 695f 6c61 6265 6c3d 5472 7565 2c20  lti_label=True, 
-000354c0: 696d 6167 653d 726f 692e 6d61 736b 290a  image=roi.mask).
-000354d0: 2020 2020 2020 2020 2020 2020 7373 203d              ss =
-000354e0: 2053 7472 7563 7475 7265 5365 7428 290a   StructureSet().
-000354f0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00035500: 726f 6920 696e 2073 7330 2e67 6574 5f72  roi in ss0.get_r
-00035510: 6f69 7328 293a 0a20 2020 2020 2020 2020  ois():.         
-00035520: 2020 2020 2020 2073 732e 6164 645f 726f         ss.add_ro
-00035530: 6928 524f 4928 736f 7572 6365 3d72 6f69  i(ROI(source=roi
-00035540: 2e67 6574 5f63 6f6e 746f 7572 7328 292c  .get_contours(),
-00035550: 206e 616d 653d 726f 692e 6e61 6d65 2929   name=roi.name))
-00035560: 0a20 2020 2020 2020 2020 2020 2073 732e  .            ss.
-00035570: 7365 745f 696d 6167 6528 7365 6c66 2e69  set_image(self.i
-00035580: 6d61 6765 290a 2020 2020 2020 2020 656c  mage).        el
-00035590: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000355a0: 2320 4861 6e64 6c65 2063 6173 6573 2077  # Handle cases w
-000355b0: 6865 7265 2063 6f6d 706f 6e65 6e74 2052  here component R
-000355c0: 4f49 7320 6172 6520 696e 6974 6961 6c69  OIs are initiali
-000355d0: 7365 6420 6672 6f6d 206d 6173 6b2e 0a20  sed from mask.. 
-000355e0: 2020 2020 2020 2020 2020 2069 6620 766f             if vo
-000355f0: 7865 6c5f 7369 7a65 3a0a 2020 2020 2020  xel_size:.      
-00035600: 2020 2020 2020 2020 2020 2320 4966 2076            # If v
-00035610: 6f78 656c 2073 697a 6520 6368 616e 6765  oxel size change
-00035620: 6420 666f 7220 6c61 6265 6c6c 696e 672c  d for labelling,
-00035630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00035640: 2023 2072 6563 7265 6174 6520 6c61 6265   # recreate labe
-00035650: 6c20 6d61 736b 2077 6974 6820 6f72 6967  l mask with orig
-00035660: 696e 616c 2076 6f78 656c 2073 697a 652e  inal voxel size.
-00035670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00035680: 2072 6f69 2e6d 6173 6b2e 6461 7461 203d   roi.mask.data =
-00035690: 206c 6162 656c 5f6d 6173 6b0a 2020 2020   label_mask.    
-000356a0: 2020 2020 2020 2020 2020 2020 726f 692e              roi.
-000356b0: 6d61 736b 2e6d 6174 6368 5f73 697a 6528  mask.match_size(
-000356c0: 7365 6c66 2e69 6d61 6765 2c20 6d65 7468  self.image, meth
-000356d0: 6f64 3d27 6e65 6172 6573 7427 290a 2020  od='nearest').  
-000356e0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-000356f0: 6265 6c5f 6d61 736b 203d 2072 6f69 2e6d  bel_mask = roi.m
-00035700: 6173 6b2e 6461 7461 0a0a 2020 2020 2020  ask.data..      
-00035710: 2020 2020 2020 2320 4372 6561 7465 2073        # Create s
-00035720: 7472 7563 7475 7265 2073 6574 2066 726f  tructure set fro
-00035730: 6d20 6c61 6265 6c20 6d61 736b 2e0a 2020  m label mask..  
-00035740: 2020 2020 2020 2020 2020 7373 203d 2053            ss = S
-00035750: 7472 7563 7475 7265 5365 7428 6c61 6265  tructureSet(labe
-00035760: 6c5f 6d61 736b 2c20 6d75 6c74 695f 6c61  l_mask, multi_la
-00035770: 6265 6c3d 5472 7565 2c20 696d 6167 653d  bel=True, image=
-00035780: 7365 6c66 2e69 6d61 6765 290a 0a20 2020  self.image)..   
-00035790: 2020 2020 2023 2053 746f 7265 2052 4f49       # Store ROI
-000357a0: 7320 696e 2073 7065 6369 6669 6564 206f  s in specified o
-000357b0: 7264 6572 2e0a 2020 2020 2020 2020 7373  rder..        ss
-000357c0: 2e6f 7264 6572 5f72 6f69 7328 6f72 6465  .order_rois(orde
-000357d0: 7229 0a0a 2020 2020 2020 2020 2320 4170  r)..        # Ap
-000357e0: 706c 7920 6e61 6d65 732e 0a20 2020 2020  ply names..     
-000357f0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00035800: 6528 6d69 6e28 6c65 6e28 6e61 6d65 7329  e(min(len(names)
-00035810: 2c20 6c65 6e28 7373 2e72 6f69 7329 2929  , len(ss.rois)))
-00035820: 3a0a 2020 2020 2020 2020 2020 2020 7373  :.            ss
-00035830: 2e72 6f69 735b 695d 2e6e 616d 6520 3d20  .rois[i].name = 
-00035840: 6e61 6d65 735b 695d 0a0a 2020 2020 2020  names[i]..      
-00035850: 2020 7265 7475 726e 2073 730a 0a20 2020    return ss..   
-00035860: 2064 6566 2073 706c 6974 5f69 6e5f 7477   def split_in_tw
-00035870: 6f28 7365 6c66 2c20 6178 6973 3d27 7827  o(self, axis='x'
-00035880: 2c20 7630 3d30 2c20 6e61 6d65 733d 4e6f  , v0=0, names=No
-00035890: 6e65 2c29 3a0a 2020 2020 2020 2020 2727  ne,):.        ''
-000358a0: 270a 2020 2020 2020 2020 5370 6c69 7420  '.        Split 
-000358b0: 6120 636f 6d70 6f73 6974 6520 524f 4920  a composite ROI 
-000358c0: 696e 746f 2074 776f 2063 6f6d 706f 6e65  into two compone
-000358d0: 6e74 2070 6172 7473 2e0a 0a20 2020 2020  nt parts...     
-000358e0: 2020 2053 706c 6974 2061 6e20 524f 4920     Split an ROI 
-000358f0: 696e 746f 2074 776f 2063 6f6d 706f 6e65  into two compone
-00035900: 6e74 732c 2065 6974 6865 7220 7369 6465  nts, either side
-00035910: 206f 6620 6120 7370 6563 6966 6965 640a   of a specified.
-00035920: 2020 2020 2020 2020 706c 616e 652e 2020          plane.  
-00035930: 5468 6973 206d 6179 2062 6520 7573 6566  This may be usef
-00035940: 756c 2c20 666f 7220 6578 616d 706c 652c  ul, for example,
-00035950: 2077 6865 6e20 6c65 6674 2061 6e64 2072   when left and r
-00035960: 6967 6874 0a20 2020 2020 2020 2052 4f49  ight.        ROI
-00035970: 7320 6861 7665 2062 6565 6e20 6173 7369  s have been assi
-00035980: 676e 6564 2061 2063 6f6d 6d6f 6e20 6c61  gned a common la
-00035990: 6265 6c2e 0a0a 2020 2020 2020 2020 466f  bel...        Fo
-000359a0: 7220 6d6f 7265 2067 656e 6572 616c 2052  r more general R
-000359b0: 4f49 2073 706c 6974 7469 6e67 2c20 7365  OI splitting, se
-000359c0: 6520 736b 7274 2e73 7472 7563 7475 7265  e skrt.structure
-000359d0: 2e52 4f49 2e73 706c 6974 2829 2e0a 2020  .ROI.split()..  
-000359e0: 2020 2020 2020 4e6f 7465 2074 6861 7420        Note that 
-000359f0: 7370 6c69 7428 2920 6163 7473 206f 6e20  split() acts on 
-00035a00: 6269 6e61 7279 206d 6173 6b73 2c20 7768  binary masks, wh
-00035a10: 6572 6561 7320 7370 6c69 745f 696e 5f74  ereas split_in_t
-00035a20: 776f 2829 0a20 2020 2020 2020 2061 6374  wo().        act
-00035a30: 7320 6f6e 2063 6f6e 746f 7572 732e 0a0a  s on contours...
-00035a40: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
-00035a50: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
-00035a60: 2061 7869 7320 3a20 2773 7472 272c 2064   axis : 'str', d
-00035a70: 6566 6175 6c74 3d27 7827 0a20 2020 2020  efault='x'.     
-00035a80: 2020 2020 2020 2041 7869 7320 2827 7827         Axis ('x'
-00035a90: 2c20 2779 2720 6f72 2027 7a27 2920 7065  , 'y' or 'z') pe
-00035aa0: 7270 656e 6469 6375 6c61 7220 746f 2070  rpendicular to p
-00035ab0: 6c61 6e65 2061 626f 7574 2077 6869 6368  lane about which
-00035ac0: 0a20 2020 2020 2020 2020 2020 2052 4f49  .            ROI
-00035ad0: 2069 7320 746f 2062 6520 7370 6c69 742e   is to be split.
-00035ae0: 0a0a 2020 2020 2020 2020 7630 203a 2066  ..        v0 : f
-00035af0: 6c6f 6174 2c20 6465 6661 756c 743d 300a  loat, default=0.
-00035b00: 2020 2020 2020 2020 2020 2020 436f 6f72              Coor
-00035b10: 6469 6e61 7465 2061 6c6f 6e67 2073 656c  dinate along sel
-00035b20: 6563 7465 6420 6178 6973 2c20 7370 6563  ected axis, spec
-00035b30: 6966 7969 6e67 2070 6c61 6e65 2061 626f  ifying plane abo
-00035b40: 7574 2077 6869 6368 0a20 2020 2020 2020  ut which.       
-00035b50: 2020 2020 2052 4f49 2069 7320 746f 2062       ROI is to b
-00035b60: 6520 7370 6c69 742e 0a0a 2020 2020 2020  e split...      
-00035b70: 2020 6e61 6d65 733a 206c 6973 742c 2064    names: list, d
-00035b80: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00035b90: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
-00035ba0: 6e61 6d65 7320 746f 2062 6520 6170 706c  names to be appl
-00035bb0: 6965 6420 746f 2074 6865 2063 6f6d 706f  ied to the compo
-00035bc0: 6e65 6e74 2052 4f49 732e 0a20 2020 2020  nent ROIs..     
-00035bd0: 2020 2027 2727 0a0a 2020 2020 2020 2020     '''..        
-00035be0: 2320 4966 206e 616d 6573 206e 6f74 2073  # If names not s
-00035bf0: 7065 6369 6669 6564 2c20 696e 6974 6961  pecified, initia
-00035c00: 6c69 7365 2074 6f20 656d 7074 7920 6c69  lise to empty li
-00035c10: 7374 2e0a 2020 2020 2020 2020 6966 206e  st..        if n
-00035c20: 616d 6573 2069 7320 4e6f 6e65 3a0a 2020  ames is None:.  
-00035c30: 2020 2020 2020 2020 2020 6e61 6d65 7320            names 
-00035c40: 3d20 5b5d 0a0a 2020 2020 2020 2020 2320  = []..        # 
-00035c50: 4261 7365 6420 6f6e 2073 656c 6563 7465  Based on selecte
-00035c60: 6420 6178 6973 2c20 6465 6669 6e65 2076  d axis, define v
-00035c70: 6965 7720 616e 6420 6465 6661 756c 7420  iew and default 
-00035c80: 6e61 6d65 2073 7566 6669 7865 732e 0a20  name suffixes.. 
-00035c90: 2020 2020 2020 2069 6620 2778 2720 3d3d         if 'x' ==
-00035ca0: 2061 7869 732e 6c6f 7765 7228 293a 0a20   axis.lower():. 
-00035cb0: 2020 2020 2020 2020 2020 2076 6965 7720             view 
-00035cc0: 3d20 2778 2d79 270a 2020 2020 2020 2020  = 'x-y'.        
-00035cd0: 2020 2020 7375 6666 6978 6573 203d 2028      suffixes = (
-00035ce0: 2772 6967 6874 272c 2027 6c65 6674 2729  'right', 'left')
-00035cf0: 0a20 2020 2020 2020 2065 6c69 6620 2779  .        elif 'y
-00035d00: 2720 3d3d 2061 7869 732e 6c6f 7765 7228  ' == axis.lower(
-00035d10: 293a 0a20 2020 2020 2020 2020 2020 2076  ):.            v
-00035d20: 6965 7720 3d20 2778 2d79 270a 2020 2020  iew = 'x-y'.    
-00035d30: 2020 2020 2020 2020 7375 6666 6978 6573          suffixes
-00035d40: 203d 2028 2761 6e74 6572 696f 7227 2c20   = ('anterior', 
-00035d50: 2770 6f73 7465 7269 6f72 2729 0a20 2020  'posterior').   
-00035d60: 2020 2020 2065 6c69 6620 277a 2720 3d3d       elif 'z' ==
-00035d70: 2061 7869 732e 6c6f 7765 7228 293a 0a20   axis.lower():. 
-00035d80: 2020 2020 2020 2020 2020 2076 6965 7720             view 
-00035d90: 3d20 2779 2d7a 270a 2020 2020 2020 2020  = 'y-z'.        
-00035da0: 2020 2020 7375 6666 6978 6573 203d 2028      suffixes = (
-00035db0: 2769 6e66 6572 696f 7227 2c20 2773 7570  'inferior', 'sup
-00035dc0: 6572 696f 7227 290a 2020 2020 2020 2020  erior').        
-00035dd0: 2020 2020 2320 496e 2074 6865 2027 792d      # In the 'y-
-00035de0: 7a27 2076 6965 772c 2079 2061 6e64 207a  z' view, y and z
-00035df0: 2061 7865 7320 6d61 7020 746f 2073 6861   axes map to sha
-00035e00: 7065 6c79 2078 2061 6e64 2079 2061 7865  pely x and y axe
-00035e10: 732e 0a20 2020 2020 2020 2020 2020 2061  s..            a
-00035e20: 7869 7320 3d20 2779 270a 0a20 2020 2020  xis = 'y'..     
-00035e30: 2020 2023 2044 6566 696e 6520 706f 6c79     # Define poly
-00035e40: 676f 6e20 7265 7072 6573 656e 7469 6e67  gon representing
-00035e50: 2052 4f49 2063 6f6e 746f 7572 2061 7320   ROI contour as 
-00035e60: 6c6f 7720 6f72 2068 6967 682c 0a20 2020  low or high,.   
-00035e70: 2020 2020 2023 2064 6570 656e 6469 6e67       # depending
-00035e80: 206f 6e20 7768 6574 6865 7220 7468 6520   on whether the 
-00035e90: 706f 6c79 676f 6e20 6365 6e74 726f 6964  polygon centroid
-00035ea0: 2069 7320 6c6f 7765 7220 6f72 2068 6967   is lower or hig
-00035eb0: 6865 720a 2020 2020 2020 2020 2320 7468  her.        # th
-00035ec0: 616e 2074 6865 2063 6f6f 7264 696e 6174  an the coordinat
-00035ed0: 6520 6f66 2074 6865 2073 706c 6974 7469  e of the splitti
-00035ee0: 6e67 2070 6c61 6e65 2e0a 2020 2020 2020  ng plane..      
-00035ef0: 2020 706f 6c79 676f 6e73 5f6c 6f77 203d    polygons_low =
-00035f00: 207b 7d0a 2020 2020 2020 2020 706f 6c79   {}.        poly
-00035f10: 676f 6e73 5f68 6967 6820 3d20 7b7d 0a20  gons_high = {}. 
-00035f20: 2020 2020 2020 2066 6f72 207a 2c20 706f         for z, po
-00035f30: 6c79 676f 6e73 2069 6e20 7365 6c66 2e67  lygons in self.g
-00035f40: 6574 5f70 6f6c 7967 6f6e 7328 7669 6577  et_polygons(view
-00035f50: 292e 6974 656d 7328 293a 0a20 2020 2020  ).items():.     
-00035f60: 2020 2020 2020 2066 6f72 2070 6f6c 7967         for polyg
-00035f70: 6f6e 2069 6e20 706f 6c79 676f 6e73 3a0a  on in polygons:.
-00035f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035f90: 7620 3d20 6765 7461 7474 7228 706f 6c79  v = getattr(poly
-00035fa0: 676f 6e2e 6365 6e74 726f 6964 2c20 6178  gon.centroid, ax
-00035fb0: 6973 290a 2020 2020 2020 2020 2020 2020  is).            
-00035fc0: 2020 2020 6966 2076 203c 2076 303a 0a20      if v < v0:. 
-00035fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035fe0: 2020 2069 6620 6e6f 7420 7a20 696e 2070     if not z in p
-00035ff0: 6f6c 7967 6f6e 735f 6c6f 773a 0a20 2020  olygons_low:.   
-00036000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036010: 2020 2020 2070 6f6c 7967 6f6e 735f 6c6f       polygons_lo
-00036020: 775b 7a5d 203d 205b 5d0a 2020 2020 2020  w[z] = [].      
-00036030: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00036040: 6c79 676f 6e73 5f6c 6f77 5b7a 5d2e 6170  lygons_low[z].ap
-00036050: 7065 6e64 2870 6f6c 7967 6f6e 290a 2020  pend(polygon).  
-00036060: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00036070: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00036080: 2020 2020 2020 2020 6966 206e 6f74 207a          if not z
-00036090: 2069 6e20 706f 6c79 676f 6e73 5f68 6967   in polygons_hig
-000360a0: 683a 0a20 2020 2020 2020 2020 2020 2020  h:.             
-000360b0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-000360c0: 6f6e 735f 6869 6768 5b7a 5d20 3d20 5b5d  ons_high[z] = []
-000360d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000360e0: 2020 2020 2070 6f6c 7967 6f6e 735f 6869       polygons_hi
-000360f0: 6768 5b7a 5d2e 6170 7065 6e64 2870 6f6c  gh[z].append(pol
-00036100: 7967 6f6e 290a 0a0a 2020 2020 2020 2020  ygon)...        
-00036110: 2320 4372 6561 7465 2052 4f49 2066 726f  # Create ROI fro
-00036120: 6d20 706f 6c79 676f 6e73 2062 656c 6f77  m polygons below
-00036130: 2074 6865 2073 706c 6974 7469 6e67 2070   the splitting p
-00036140: 6c61 6e65 2e0a 2020 2020 2020 2020 6966  lane..        if
-00036150: 2070 6f6c 7967 6f6e 735f 6c6f 773a 0a20   polygons_low:. 
-00036160: 2020 2020 2020 2020 2020 2072 6f69 5f6c             roi_l
-00036170: 6f77 203d 2052 4f49 2873 6f75 7263 653d  ow = ROI(source=
-00036180: 706f 6c79 676f 6e73 5f6c 6f77 2c20 696d  polygons_low, im
-00036190: 6167 653d 7365 6c66 2e69 6d61 6765 290a  age=self.image).
-000361a0: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
-000361b0: 6c6f 772e 6e61 6d65 203d 2028 6e61 6d65  low.name = (name
-000361c0: 735b 305d 2069 6620 6c65 6e28 6e61 6d65  s[0] if len(name
-000361d0: 7329 203e 2030 0a20 2020 2020 2020 2020  s) > 0.         
-000361e0: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
-000361f0: 6627 7b73 656c 662e 6e61 6d65 7d5f 7b73  f'{self.name}_{s
-00036200: 7566 6669 7865 735b 305d 7d27 290a 2020  uffixes[0]}').  
-00036210: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00036220: 2020 2020 2020 2020 726f 695f 6c6f 7720          roi_low 
-00036230: 3d20 4e6f 6e65 0a0a 2020 2020 2020 2020  = None..        
-00036240: 2320 4372 6561 7465 2052 4f49 2066 726f  # Create ROI fro
-00036250: 6d20 706f 6c79 676f 6e73 2061 626f 7665  m polygons above
-00036260: 2074 6865 2073 706c 6974 7469 6e67 2070   the splitting p
-00036270: 6c61 6e65 2e0a 2020 2020 2020 2020 6966  lane..        if
-00036280: 2070 6f6c 7967 6f6e 735f 6869 6768 3a0a   polygons_high:.
-00036290: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
-000362a0: 6869 6768 203d 2052 4f49 2873 6f75 7263  high = ROI(sourc
-000362b0: 653d 706f 6c79 676f 6e73 5f68 6967 682c  e=polygons_high,
-000362c0: 2069 6d61 6765 3d73 656c 662e 696d 6167   image=self.imag
-000362d0: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
-000362e0: 6f69 5f68 6967 682e 6e61 6d65 203d 2028  oi_high.name = (
-000362f0: 6e61 6d65 735b 315d 2069 6620 6c65 6e28  names[1] if len(
-00036300: 6e61 6d65 7329 203e 2031 0a20 2020 2020  names) > 1.     
-00036310: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00036320: 6c73 6520 6627 7b73 656c 662e 6e61 6d65  lse f'{self.name
-00036330: 7d5f 7b73 7566 6669 7865 735b 315d 7d27  }_{suffixes[1]}'
-00036340: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00036350: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
-00036360: 6869 6768 203d 204e 6f6e 650a 0a20 2020  high = None..   
-00036370: 2020 2020 2023 2043 7265 6174 6520 7374       # Create st
-00036380: 7275 6374 7572 6520 7365 7420 666f 7220  ructure set for 
-00036390: 636f 6d70 6f6e 656e 7420 524f 4928 7329  component ROI(s)
-000363a0: 2e0a 2020 2020 2020 2020 726f 6973 203d  ..        rois =
-000363b0: 206c 6973 7428 6669 6c74 6572 284e 6f6e   list(filter(Non
-000363c0: 652c 205b 726f 695f 6c6f 772c 2072 6f69  e, [roi_low, roi
-000363d0: 5f68 6967 685d 2929 0a20 2020 2020 2020  _high])).       
-000363e0: 2069 6620 726f 6973 3a0a 2020 2020 2020   if rois:.      
-000363f0: 2020 2020 2020 7373 203d 2053 7472 7563        ss = Struc
-00036400: 7475 7265 5365 7428 7061 7468 3d72 6f69  tureSet(path=roi
-00036410: 732c 206e 616d 653d 7365 6c66 2e6e 616d  s, name=self.nam
-00036420: 652c 2069 6d61 6765 3d73 656c 662e 696d  e, image=self.im
-00036430: 6167 6529 0a20 2020 2020 2020 2065 6c73  age).        els
-00036440: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00036450: 7320 3d20 4e6f 6e65 0a0a 2020 2020 2020  s = None..      
-00036460: 2020 7265 7475 726e 2073 730a 0a20 2020    return ss..   
-00036470: 2064 6566 2067 6574 5f70 6174 6368 2873   def get_patch(s
-00036480: 656c 662c 2070 6c6f 745f 7479 7065 3d4e  elf, plot_type=N
-00036490: 6f6e 652c 2063 6f6c 6f72 3d4e 6f6e 652c  one, color=None,
-000364a0: 206f 7061 6369 7479 3d4e 6f6e 652c 0a20   opacity=None,. 
-000364b0: 2020 2020 2020 2020 2020 206c 696e 6577             linew
-000364c0: 6964 7468 3d4e 6f6e 652c 206e 616d 653d  idth=None, name=
-000364d0: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
-000364e0: 2222 0a20 2020 2020 2020 204f 6274 6169  "".        Obtai
-000364f0: 6e20 7061 7463 6820 7265 666c 6563 7469  n patch reflecti
-00036500: 6e67 2052 4f49 2063 6861 7261 6374 6572  ng ROI character
-00036510: 6973 7469 6373 2066 6f72 2070 6c6f 7474  istics for plott
-00036520: 696e 672e 0a0a 2020 2020 2020 2020 5468  ing...        Th
-00036530: 6520 7061 7463 6820 6f62 7461 696e 6564  e patch obtained
-00036540: 2063 616e 2062 6520 7573 6564 2061 7320   can be used as 
-00036550: 6120 6861 6e64 6c65 2069 6e20 6c65 6765  a handle in lege
-00036560: 6e64 2063 7265 6174 696f 6e2e 0a0a 2020  nd creation...  
-00036570: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
-00036580: 7273 3a2a 2a0a 0a20 2020 2020 2020 2070  rs:**..        p
-00036590: 6c6f 745f 7479 7065 203a 2073 7472 2c20  lot_type : str, 
-000365a0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-000365b0: 2020 2020 2020 2020 2050 6c6f 7474 696e           Plottin
-000365c0: 6720 7479 7065 2e20 4966 204e 6f6e 652c  g type. If None,
-000365d0: 2077 696c 6c20 6265 2065 6974 6865 7220   will be either 
-000365e0: 2263 6f6e 746f 7572 2220 6f72 2022 6d61  "contour" or "ma
-000365f0: 736b 2220 0a20 2020 2020 2020 2020 2020  sk" .           
-00036600: 2064 6570 656e 6469 6e67 206f 6e20 7468   depending on th
-00036610: 6520 696e 7075 7420 7479 7065 206f 6620  e input type of 
-00036620: 7468 6520 524f 492e 204f 7074 696f 6e73  the ROI. Options
-00036630: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
-00036640: 2020 202d 2022 636f 6e74 6f75 7222 0a20     - "contour". 
-00036650: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-00036660: 2022 6d61 736b 220a 2020 2020 2020 2020   "mask".        
-00036670: 2020 2020 2020 2020 2d20 2263 656e 7472          - "centr
-00036680: 6f69 6422 2028 636f 6e74 6f75 7220 7769  oid" (contour wi
-00036690: 7468 206d 6172 6b65 7220 6174 2063 656e  th marker at cen
-000366a0: 7472 6f69 6429 0a20 2020 2020 2020 2020  troid).         
-000366b0: 2020 2020 2020 202d 2022 6669 6c6c 6564         - "filled
-000366c0: 2220 2874 7261 6e73 7061 7265 6e74 206d  " (transparent m
-000366d0: 6173 6b20 2b20 636f 6e74 6f75 7229 0a20  ask + contour). 
-000366e0: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-000366f0: 2022 6669 6c6c 6564 2063 656e 7472 6f69   "filled centroi
-00036700: 6422 2028 6669 6c6c 6564 2077 6974 6820  d" (filled with 
-00036710: 6d61 726b 6572 2061 7420 6365 6e74 726f  marker at centro
-00036720: 6964 290a 0a20 2020 2020 2020 2063 6f6c  id)..        col
-00036730: 6f72 203a 206d 6174 706c 6f74 6c69 6220  or : matplotlib 
-00036740: 636f 6c6f 722c 2064 6566 6175 6c74 3d4e  color, default=N
-00036750: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00036760: 436f 6c6f 7220 7769 7468 2077 6869 6368  Color with which
-00036770: 2074 6f20 706c 6f74 2074 6865 2052 4f49   to plot the ROI
-00036780: 3b20 6f76 6572 7269 6465 7320 7468 6520  ; overrides the 
-00036790: 524f 4927 7320 6f77 6e20 636f 6c6f 722e  ROI's own color.
-000367a0: 2049 6620 0a20 2020 2020 2020 2020 2020   If .           
-000367b0: 204e 6f6e 652c 2073 656c 662e 636f 6c6f   None, self.colo
-000367c0: 7220 7769 6c6c 2062 6520 7573 6564 2e0a  r will be used..
-000367d0: 0a20 2020 2020 2020 206f 7061 6369 7479  .        opacity
-000367e0: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
-000367f0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-00036800: 2020 204f 7061 6369 7479 2074 6f20 7573     Opacity to us
-00036810: 6520 6966 2070 6c6f 7474 696e 6720 6d61  e if plotting ma
-00036820: 736b 2028 692e 652e 2070 6c6f 7420 7479  sk (i.e. plot ty
-00036830: 7065 7320 226d 6173 6b22 2c20 2266 696c  pes "mask", "fil
-00036840: 6c65 6422 2c20 0a20 2020 2020 2020 2020  led", .         
-00036850: 2020 206f 7220 2266 696c 6c65 6420 6365     or "filled ce
-00036860: 6e74 726f 6964 2229 2e20 4966 204e 6f6e  ntroid"). If Non
-00036870: 652c 206f 7061 6369 7479 2077 696c 6c20  e, opacity will 
-00036880: 6265 2031 2062 7920 6465 6661 756c 7420  be 1 by default 
-00036890: 666f 7220 0a20 2020 2020 2020 2020 2020  for .           
-000368a0: 2073 6f6c 6964 206d 6173 6b20 706c 6f74   solid mask plot
-000368b0: 7320 616e 6420 302e 3320 6279 2064 6566  s and 0.3 by def
-000368c0: 6175 6c74 2066 6f72 2066 696c 6c65 6420  ault for filled 
-000368d0: 706c 6f74 732e 0a0a 2020 2020 2020 2020  plots...        
-000368e0: 6c69 6e65 7769 6474 6820 3a20 666c 6f61  linewidth : floa
-000368f0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-00036900: 2020 2020 2020 2020 2020 2020 5769 6474              Widt
-00036910: 6820 6f66 2063 6f6e 746f 7572 206c 696e  h of contour lin
-00036920: 6573 2e20 4966 204e 6f6e 652c 2074 6865  es. If None, the
-00036930: 206d 6174 706c 6f74 6c69 6220 6465 6661   matplotlib defa
-00036940: 756c 7420 7365 7474 696e 6720 0a20 2020  ult setting .   
-00036950: 2020 2020 2020 2020 2077 696c 6c20 6265           will be
-00036960: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
-00036970: 6e61 6d65 203a 2073 7472 2c20 6465 6661  name : str, defa
-00036980: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00036990: 2020 2020 204e 616d 6520 6964 656e 7469       Name identi
-000369a0: 6679 696e 6720 524f 492e 2020 4966 204e  fying ROI.  If N
-000369b0: 6f6e 652c 2073 656c 662e 6e61 6d65 2077  one, self.name w
-000369c0: 696c 6c20 6265 2075 7365 642e 0a20 2020  ill be used..   
-000369d0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-000369e0: 2020 2320 456e 7375 7265 2074 6861 7420    # Ensure that 
-000369f0: 706c 6f74 7469 6e67 2063 6861 7261 6374  plotting charact
-00036a00: 6572 6973 7469 6373 2061 7265 2064 6566  eristics are def
-00036a10: 696e 6564 2e0a 2020 2020 2020 2020 6966  ined..        if
-00036a20: 2070 6c6f 745f 7479 7065 2069 7320 4e6f   plot_type is No
-00036a30: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00036a40: 706c 6f74 5f74 7970 6520 3d20 7365 6c66  plot_type = self
-00036a50: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
-00036a60: 7468 6f64 0a0a 2020 2020 2020 2020 6966  thod..        if
-00036a70: 2063 6f6c 6f72 2069 7320 4e6f 6e65 3a0a   color is None:.
-00036a80: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
-00036a90: 7220 3d20 7365 6c66 2e63 6f6c 6f72 0a0a  r = self.color..
-00036aa0: 2020 2020 2020 2020 6966 206f 7061 6369          if opaci
-00036ab0: 7479 2069 7320 4e6f 6e65 3a0a 2020 2020  ty is None:.    
-00036ac0: 2020 2020 2020 2020 6f70 6163 6974 7920          opacity 
-00036ad0: 3d20 302e 3320 6966 2022 6669 6c6c 6564  = 0.3 if "filled
-00036ae0: 2220 696e 2070 6c6f 745f 7479 7065 2065  " in plot_type e
-00036af0: 6c73 6520 310a 0a20 2020 2020 2020 2069  lse 1..        i
-00036b00: 6620 6c69 6e65 7769 6474 6820 6973 204e  f linewidth is N
-00036b10: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00036b20: 206c 696e 6577 6964 7468 203d 2064 6566   linewidth = def
-00036b30: 6175 6c74 5061 7261 6d73 5b22 6c69 6e65  aultParams["line
-00036b40: 732e 6c69 6e65 7769 6474 6822 5d5b 305d  s.linewidth"][0]
-00036b50: 0a0a 2020 2020 2020 2020 6966 206e 616d  ..        if nam
-00036b60: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-00036b70: 2020 2020 2020 206e 616d 6520 3d20 7365         name = se
-00036b80: 6c66 2e6e 616d 650a 0a20 2020 2020 2020  lf.name..       
-00036b90: 2023 2053 6574 2070 6f74 656e 7469 616c   # Set potential
-00036ba0: 6c79 2064 6966 6665 7265 6e74 206f 7061  ly different opa
-00036bb0: 6369 7469 6573 2066 6f72 2066 6163 6563  cities for facec
-00036bc0: 6f6c 6f72 2061 6e64 2065 6467 6563 6f6c  olor and edgecol
-00036bd0: 6f72 0a20 2020 2020 2020 2066 6163 6563  or.        facec
-00036be0: 6f6c 6f72 203d 206d 6174 706c 6f74 6c69  olor = matplotli
-00036bf0: 622e 636f 6c6f 7273 2e74 6f5f 7267 6261  b.colors.to_rgba
-00036c00: 2863 6f6c 6f72 2c20 616c 7068 613d 6f70  (color, alpha=op
-00036c10: 6163 6974 7929 0a20 2020 2020 2020 2065  acity).        e
-00036c20: 6467 6563 6f6c 6f72 203d 206d 6174 706c  dgecolor = matpl
-00036c30: 6f74 6c69 622e 636f 6c6f 7273 2e74 6f5f  otlib.colors.to_
-00036c40: 7267 6261 2863 6f6c 6f72 2c20 616c 7068  rgba(color, alph
-00036c50: 613d 3129 0a0a 2020 2020 2020 2020 2320  a=1)..        # 
-00036c60: 4465 6669 6e65 2070 6174 6368 2061 6363  Define patch acc
-00036c70: 6f72 6469 6e67 2074 6f20 706c 6f74 5f74  ording to plot_t
-00036c80: 7970 652e 0a20 2020 2020 2020 2070 6174  ype..        pat
-00036c90: 6368 203d 204e 6f6e 650a 2020 2020 2020  ch = None.      
-00036ca0: 2020 6966 2070 6c6f 745f 7479 7065 2069    if plot_type i
-00036cb0: 6e20 5b22 636f 6e74 6f75 7222 2c20 2263  n ["contour", "c
-00036cc0: 656e 7472 6f69 6422 5d3a 0a20 2020 2020  entroid"]:.     
-00036cd0: 2020 2020 2020 2070 6174 6368 203d 206d         patch = m
-00036ce0: 7061 7463 6865 732e 5061 7463 6828 6564  patches.Patch(ed
-00036cf0: 6765 636f 6c6f 723d 6564 6765 636f 6c6f  gecolor=edgecolo
-00036d00: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00036d10: 2020 2020 2020 206c 696e 6577 6964 7468         linewidth
-00036d20: 3d6c 696e 6577 6964 7468 2c20 6669 6c6c  =linewidth, fill
-00036d30: 3d46 616c 7365 2c20 6c61 6265 6c3d 6e61  =False, label=na
-00036d40: 6d65 290a 2020 2020 2020 2020 656c 6966  me).        elif
-00036d50: 2070 6c6f 745f 7479 7065 2069 6e20 5b22   plot_type in ["
-00036d60: 6669 6c6c 6564 222c 2022 6669 6c6c 6564  filled", "filled
-00036d70: 2063 656e 7472 6f69 6422 5d3a 0a20 2020   centroid"]:.   
-00036d80: 2020 2020 2020 2020 2070 6174 6368 203d           patch =
-00036d90: 206d 7061 7463 6865 732e 5061 7463 6828   mpatches.Patch(
-00036da0: 6564 6765 636f 6c6f 723d 6564 6765 636f  edgecolor=edgeco
-00036db0: 6c6f 722c 0a20 2020 2020 2020 2020 2020  lor,.           
-00036dc0: 2020 2020 2020 2020 2066 6163 6563 6f6c           facecol
-00036dd0: 6f72 3d66 6163 6563 6f6c 6f72 2c20 6c69  or=facecolor, li
-00036de0: 6e65 7769 6474 683d 6c69 6e65 7769 6474  newidth=linewidt
-00036df0: 682c 206c 6162 656c 3d6e 616d 6529 0a20  h, label=name). 
-00036e00: 2020 2020 2020 2065 6c69 6620 706c 6f74         elif plot
-00036e10: 5f74 7970 6520 696e 205b 226d 6173 6b22  _type in ["mask"
-00036e20: 5d3a 0a20 2020 2020 2020 2020 2020 2070  ]:.            p
-00036e30: 6174 6368 203d 206d 7061 7463 6865 732e  atch = mpatches.
-00036e40: 5061 7463 6828 6661 6365 636f 6c6f 723d  Patch(facecolor=
-00036e50: 6661 6365 636f 6c6f 722c 206c 6162 656c  facecolor, label
-00036e60: 3d6e 616d 6529 0a0a 2020 2020 2020 2020  =name)..        
-00036e70: 6966 2070 6174 6368 3a0a 2020 2020 2020  if patch:.      
-00036e80: 2020 2020 2020 7061 7463 682e 7365 745f        patch.set_
-00036e90: 616c 7068 6128 4e6f 6e65 290a 0a20 2020  alpha(None)..   
-00036ea0: 2020 2020 2072 6574 7572 6e20 7061 7463       return patc
-00036eb0: 680a 0a20 2020 2064 6566 2067 6574 5f69  h..    def get_i
-00036ec0: 6e74 656e 7369 7469 6573 5f33 6428 7365  ntensities_3d(se
-00036ed0: 6c66 2c20 696d 6167 653d 4e6f 6e65 2c20  lf, image=None, 
-00036ee0: 7374 616e 6461 7264 6973 653d 5472 7565  standardise=True
-00036ef0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00036f00: 2020 2020 2020 2052 6574 7572 6e20 636f         Return co
-00036f10: 7079 206f 6620 616e 2069 6d61 6765 2061  py of an image a
-00036f20: 7272 6179 2074 6861 7420 6861 7320 7661  rray that has va
-00036f30: 6c75 6573 2072 6574 6169 6e65 640a 2020  lues retained.  
-00036f40: 2020 2020 2020 696e 7369 6465 2073 656c        inside sel
-00036f50: 662c 2061 6e64 2069 7320 7365 7420 746f  f, and is set to
-00036f60: 207a 6572 6f20 656c 7365 7768 6572 652e   zero elsewhere.
-00036f70: 0a0a 2020 2020 2020 2020 2a2a 5061 7261  ..        **Para
-00036f80: 6d65 7465 723a 2a2a 0a0a 2020 2020 2020  meter:**..      
-00036f90: 2020 696d 6167 6520 3a20 736b 7274 2e69    image : skrt.i
-00036fa0: 6d61 6765 2e49 6d61 6765 2c20 6465 6661  mage.Image, defa
-00036fb0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00036fc0: 2020 2020 2049 6d61 6765 206f 626a 6563       Image objec
-00036fd0: 7420 666f 7220 7768 6963 6820 3344 2061  t for which 3D a
-00036fe0: 7272 6179 2077 6974 6820 696e 7465 6e73  rray with intens
-00036ff0: 6974 7920 7661 6c75 6573 0a20 2020 2020  ity values.     
-00037000: 2020 2020 2020 2072 6574 6169 6e65 6420         retained 
-00037010: 696e 7369 6465 2052 4f49 2c20 616e 6420  inside ROI, and 
-00037020: 4e61 4e20 656c 7365 7768 6572 652c 2069  NaN elsewhere, i
-00037030: 7320 746f 2062 6520 6f62 7461 696e 6564  s to be obtained
-00037040: 2e0a 2020 2020 2020 2020 2020 2020 4966  ..            If
-00037050: 204e 6f6e 652c 2074 6865 2069 6d61 6765   None, the image
-00037060: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
-00037070: 2074 6865 2052 4f49 2069 7320 7573 6564   the ROI is used
-00037080: 2e0a 0a20 2020 2020 2020 2073 7461 6e64  ...        stand
-00037090: 6172 6469 7365 203a 2062 6f6f 6c2c 2064  ardise : bool, d
-000370a0: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
-000370b0: 2020 2020 2020 2020 2049 6620 4661 6c73           If Fals
-000370c0: 652c 2074 6865 2064 6174 6120 6172 7261  e, the data arra
-000370d0: 7920 7769 6c6c 2062 6520 7265 7475 726e  y will be return
-000370e0: 6564 2069 6e20 7468 6520 6f72 6965 6e74  ed in the orient
-000370f0: 6174 696f 6e20 696e 200a 2020 2020 2020  ation in .      
-00037100: 2020 2020 2020 7768 6963 6820 6974 2077        which it w
-00037110: 6173 206c 6f61 6465 643b 206f 7468 6572  as loaded; other
-00037120: 7769 7365 2c20 6974 2077 696c 6c20 6265  wise, it will be
-00037130: 2072 6574 7572 6e65 6420 696e 2073 7461   returned in sta
-00037140: 6e64 6172 640a 2020 2020 2020 2020 2020  ndard.          
-00037150: 2020 6469 636f 6d2d 7374 796c 6520 6f72    dicom-style or
-00037160: 6965 6e74 6174 696f 6e20 7375 6368 2074  ientation such t
-00037170: 6861 7420 5b63 6f6c 756d 6e2c 2072 6f77  hat [column, row
-00037180: 2c20 736c 6963 655d 2063 6f72 7265 7370  , slice] corresp
-00037190: 6f6e 6473 0a20 2020 2020 2020 2020 2020  onds.           
-000371a0: 2074 6f20 7468 6520 5b78 2c20 792c 207a   to the [x, y, z
-000371b0: 5d20 6178 6573 2e0a 2020 2020 2020 2020  ] axes..        
-000371c0: 2222 220a 2020 2020 2020 2020 6966 2069  """.        if i
-000371d0: 6d61 6765 2069 7320 4e6f 6e65 3a0a 2020  mage is None:.  
-000371e0: 2020 2020 2020 2020 2020 2320 436f 6e73            # Cons
-000371f0: 6964 6572 2069 6d61 6765 2061 7373 6f63  ider image assoc
-00037200: 6961 7465 6420 7769 7468 2073 656c 662e  iated with self.
-00037210: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00037220: 662e 6372 6561 7465 5f6d 6173 6b28 290a  f.create_mask().
-00037230: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-00037240: 6520 3d20 7365 6c66 2e69 6d61 6765 0a20  e = self.image. 
-00037250: 2020 2020 2020 2020 2020 2072 6f69 203d             roi =
-00037260: 2073 656c 660a 2020 2020 2020 2020 656c   self.        el
-00037270: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00037280: 2320 436c 6f6e 6520 7365 6c66 2c20 616e  # Clone self, an
-00037290: 6420 6173 736f 6369 6174 6520 7769 7468  d associate with
-000372a0: 2063 6c6f 6e65 2074 6865 2069 6d61 6765   clone the image
-000372b0: 2073 7065 6369 6669 6564 2069 6e20 696e   specified in in
-000372c0: 7075 742e 0a20 2020 2020 2020 2020 2020  put..           
-000372d0: 2072 6f69 203d 2073 656c 662e 636c 6f6e   roi = self.clon
-000372e0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-000372f0: 726f 692e 7365 745f 696d 6167 6528 696d  roi.set_image(im
-00037300: 6167 6529 0a0a 2020 2020 2020 2020 2320  age)..        # 
-00037310: 4f62 7461 696e 2069 6e74 656e 7369 7479  Obtain intensity
-00037320: 2076 616c 7565 732e 0a20 2020 2020 2020   values..       
-00037330: 2069 6d5f 6461 7461 203d 2069 6d61 6765   im_data = image
-00037340: 2e67 6574 5f64 6174 6128 7374 616e 6461  .get_data(standa
-00037350: 7264 6973 653d 7374 616e 6461 7264 6973  rdise=standardis
-00037360: 6529 0a20 2020 2020 2020 206d 6173 6b20  e).        mask 
-00037370: 3d20 726f 692e 6765 745f 6d61 736b 2873  = roi.get_mask(s
-00037380: 7461 6e64 6172 6469 7365 3d73 7461 6e64  tandardise=stand
-00037390: 6172 6469 7365 290a 2020 2020 2020 2020  ardise).        
-000373a0: 696e 7465 6e73 6974 6965 735f 696e 5f72  intensities_in_r
-000373b0: 6f69 203d 206e 702e 6675 6c6c 2869 6d5f  oi = np.full(im_
-000373c0: 6461 7461 2e73 6861 7065 2c20 6e70 2e6e  data.shape, np.n
-000373d0: 616e 290a 2020 2020 2020 2020 696e 7465  an).        inte
-000373e0: 6e73 6974 6965 735f 696e 5f72 6f69 5b6d  nsities_in_roi[m
-000373f0: 6173 6b20 3e20 305d 203d 2069 6d5f 6461  ask > 0] = im_da
-00037400: 7461 5b6d 6173 6b20 3e20 305d 0a20 2020  ta[mask > 0].   
-00037410: 2020 2020 2072 6574 7572 6e20 696e 7465       return inte
-00037420: 6e73 6974 6965 735f 696e 5f72 6f69 0a0a  nsities_in_roi..
-00037430: 2020 2020 6465 6620 6765 745f 696e 7465      def get_inte
-00037440: 6e73 6974 6965 7328 7365 6c66 2c20 696d  nsities(self, im
-00037450: 6167 653d 4e6f 6e65 2c20 7374 616e 6461  age=None, standa
-00037460: 7264 6973 653d 5472 7565 293a 0a20 2020  rdise=True):.   
-00037470: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00037480: 2052 6574 7572 6e20 3144 206e 756d 7079   Return 1D numpy
-00037490: 2061 7272 6179 2063 6f6e 7461 696e 696e   array containin
-000374a0: 6720 616c 6c20 6f66 2074 6865 2069 6e74  g all of the int
-000374b0: 656e 7369 7479 2076 616c 7565 7320 666f  ensity values fo
-000374c0: 7220 7468 6520 0a20 2020 2020 2020 2076  r the .        v
-000374d0: 6f78 656c 7320 696e 7369 6465 2073 656c  oxels inside sel
-000374e0: 662e 0a0a 2020 2020 2020 2020 2a2a 5061  f...        **Pa
-000374f0: 7261 6d65 7465 7273 3a2a 2a0a 0a20 2020  rameters:**..   
-00037500: 2020 2020 2069 6d61 6765 203a 2073 6b72       image : skr
-00037510: 742e 696d 6167 652e 496d 6167 652c 2064  t.image.Image, d
-00037520: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00037530: 2020 2020 2020 2020 496d 6167 6520 6f62          Image ob
-00037540: 6a65 6374 2066 6f72 2077 6869 6368 2031  ject for which 1
-00037550: 4420 6172 7261 7920 6f66 2069 6e74 656e  D array of inten
-00037560: 7369 7479 2076 616c 7565 7320 6973 0a20  sity values is. 
-00037570: 2020 2020 2020 2020 2020 2074 6f20 6265             to be
-00037580: 206f 6274 6169 6e65 642e 2020 4966 204e   obtained.  If N
-00037590: 6f6e 652c 2074 6865 2069 6d61 6765 2061  one, the image a
-000375a0: 7373 6f63 6961 7465 6420 7769 7468 2074  ssociated with t
-000375b0: 6865 0a20 2020 2020 2020 2020 2020 2052  he.            R
-000375c0: 4f49 2069 7320 7573 6564 2e0a 0a20 2020  OI is used...   
-000375d0: 2020 2020 2073 7461 6e64 6172 6469 7365       standardise
-000375e0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-000375f0: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
-00037600: 2020 2049 6620 4661 6c73 652c 2074 6865     If False, the
-00037610: 2069 6d61 6765 2773 2064 6174 6120 6172   image's data ar
-00037620: 7261 7920 7769 6c6c 2062 6520 7573 6564  ray will be used
-00037630: 2069 6e20 7468 6520 6f72 6965 6e74 6174   in the orientat
-00037640: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-00037650: 696e 2077 6869 6368 2069 7420 7761 7320  in which it was 
-00037660: 6c6f 6164 6564 3b20 6f74 6865 7277 6973  loaded; otherwis
-00037670: 652c 2069 7420 7769 6c6c 2062 6520 7573  e, it will be us
-00037680: 6564 2069 6e20 7374 616e 6461 7264 0a20  ed in standard. 
-00037690: 2020 2020 2020 2020 2020 2064 6963 6f6d             dicom
-000376a0: 2d73 7479 6c65 206f 7269 656e 7461 7469  -style orientati
-000376b0: 6f6e 2073 7563 6820 7468 6174 205b 636f  on such that [co
-000376c0: 6c75 6d6e 2c20 726f 772c 2073 6c69 6365  lumn, row, slice
-000376d0: 5d20 636f 7272 6573 706f 6e64 730a 2020  ] corresponds.  
-000376e0: 2020 2020 2020 2020 2020 746f 2074 6865            to the
-000376f0: 205b 782c 2079 2c20 7a5d 2061 7865 732e   [x, y, z] axes.
-00037700: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00037710: 2020 2020 2069 6e74 656e 7369 7469 6573       intensities
-00037720: 203d 2073 656c 662e 6765 745f 696e 7465   = self.get_inte
-00037730: 6e73 6974 6965 735f 3364 2869 6d61 6765  nsities_3d(image
-00037740: 2c20 7374 616e 6461 7264 6973 6529 0a20  , standardise). 
-00037750: 2020 2020 2020 2072 6574 7572 6e20 696e         return in
-00037760: 7465 6e73 6974 6965 735b 7e6e 702e 6973  tensities[~np.is
-00037770: 6e61 6e28 696e 7465 6e73 6974 6965 7329  nan(intensities)
-00037780: 5d0a 2020 2020 2020 2020 0a63 6c61 7373  ].        .class
-00037790: 2053 7472 7563 7475 7265 5365 7428 736b   StructureSet(sk
-000377a0: 7274 2e63 6f72 652e 4172 6368 6976 6529  rt.core.Archive)
-000377b0: 3a0a 2020 2020 2222 220a 2020 2020 436c  :.    """.    Cl
-000377c0: 6173 7320 7265 7072 6573 656e 7469 6e67  ass representing
-000377d0: 2061 2072 6164 696f 7468 6572 6170 7920   a radiotherapy 
-000377e0: 7374 7275 6374 7572 6520 7365 740a 2020  structure set.  
-000377f0: 2020 6173 2061 2063 6f6c 6c65 6374 696f    as a collectio
-00037800: 6e20 6f66 2072 6567 696f 6e73 206f 6620  n of regions of 
-00037810: 696e 7465 7265 7374 2028 524f 4973 292e  interest (ROIs).
-00037820: 0a0a 2020 2020 4174 7472 6962 7574 6573  ..    Attributes
-00037830: 206f 6620 6120 5374 7275 6374 7572 6553   of a StructureS
-00037840: 6574 206f 626a 6563 7420 7368 6f75 6c64  et object should
-00037850: 2075 7375 616c 6c79 2062 6520 6163 6365   usually be acce
-00037860: 7373 6564 2076 6961 0a20 2020 2074 6865  ssed via.    the
-00037870: 6972 2067 6574 7465 7220 6d65 7468 6f64  ir getter method
-00037880: 732c 2072 6174 6865 7220 7468 616e 2064  s, rather than d
-00037890: 6972 6563 746c 792c 2074 6f20 656e 7375  irectly, to ensu
-000378a0: 7265 2074 6861 740a 2020 2020 6174 7472  re that.    attr
-000378b0: 6962 7574 6520 7661 6c75 6573 2068 6176  ibute values hav
-000378c0: 6520 6265 656e 206c 6f61 6465 642e 0a20  e been loaded.. 
-000378d0: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
-000378e0: 5f5f 696e 6974 5f5f 280a 2020 2020 2020  __init__(.      
-000378f0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00037900: 7061 7468 3d4e 6f6e 652c 0a20 2020 2020  path=None,.     
-00037910: 2020 206e 616d 653d 4e6f 6e65 2c0a 2020     name=None,.  
-00037920: 2020 2020 2020 696d 6167 653d 4e6f 6e65        image=None
-00037930: 2c0a 2020 2020 2020 2020 6c6f 6164 3d54  ,.        load=T
-00037940: 7275 652c 0a20 2020 2020 2020 206e 616d  rue,.        nam
-00037950: 6573 3d4e 6f6e 652c 0a20 2020 2020 2020  es=None,.       
-00037960: 206b 6565 705f 7265 6e61 6d65 645f 6f6e   keep_renamed_on
-00037970: 6c79 3d46 616c 7365 2c0a 2020 2020 2020  ly=False,.      
-00037980: 2020 746f 5f6b 6565 703d 4e6f 6e65 2c0a    to_keep=None,.
-00037990: 2020 2020 2020 2020 746f 5f72 656d 6f76          to_remov
-000379a0: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
-000379b0: 6d75 6c74 695f 6c61 6265 6c3d 4661 6c73  multi_label=Fals
-000379c0: 652c 0a20 2020 2020 2020 2063 6f6c 6f72  e,.        color
-000379d0: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
-000379e0: 6967 6e6f 7265 5f64 6963 6f6d 5f63 6f6c  ignore_dicom_col
-000379f0: 6f72 733d 4661 6c73 652c 0a20 2020 2020  ors=False,.     
-00037a00: 2020 2061 7574 6f5f 7469 6d65 7374 616d     auto_timestam
-00037a10: 703d 4661 6c73 652c 0a20 2020 2020 2020  p=False,.       
-00037a20: 2061 6c70 6861 5f62 6574 615f 7261 7469   alpha_beta_rati
-00037a30: 6f73 3d4e 6f6e 652c 0a20 2020 2020 2020  os=None,.       
-00037a40: 202a 2a6b 7761 7267 730a 2020 2020 293a   **kwargs.    ):
-00037a50: 0a20 2020 2020 2020 2022 2222 4c6f 6164  .        """Load
-00037a60: 2073 7472 7563 7475 7265 2073 6574 2066   structure set f
-00037a70: 726f 6d20 7468 6520 736f 7572 6365 2873  rom the source(s
-00037a80: 2920 6769 7665 6e20 696e 203c 7061 7468  ) given in <path
-00037a90: 3e2e 0a0a 2020 2020 2020 2020 2a2a 5061  >...        **Pa
-00037aa0: 7261 6d65 7465 7273 2a2a 3a0a 0a20 2020  rameters**:..   
-00037ab0: 2020 2020 2070 6174 6820 3a20 7374 722f       path : str/
-00037ac0: 6c69 7374 2c20 6465 6661 756c 743d 4e6f  list, default=No
-00037ad0: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
-00037ae0: 6f75 7263 6528 7329 206f 6620 524f 4973  ource(s) of ROIs
-00037af0: 2074 6f20 6c6f 6164 2069 6e74 6f20 7468   to load into th
-00037b00: 6973 2073 7472 7563 7475 7265 2073 6574  is structure set
-00037b10: 2e20 4361 6e20 6265 3a0a 0a20 2020 2020  . Can be:..     
-00037b20: 2020 2020 2020 202d 2054 6865 2070 6174         - The pat
-00037b30: 6820 746f 2061 2073 696e 676c 6520 6469  h to a single di
-00037b40: 636f 6d20 7374 7275 6374 7572 6520 7365  com structure se
-00037b50: 7420 6669 6c65 3b0a 2020 2020 2020 2020  t file;.        
-00037b60: 2020 2020 2d20 5468 6520 7061 7468 2074      - The path t
-00037b70: 6f20 6120 7369 6e67 6c65 206e 6966 7469  o a single nifti
-00037b80: 2066 696c 6520 636f 6e74 6169 6e69 6e67   file containing
-00037b90: 2061 6e20 524f 4920 6d61 736b 3b0a 2020   an ROI mask;.  
-00037ba0: 2020 2020 2020 2020 2020 2d20 4120 6c69            - A li
-00037bb0: 7374 206f 6620 7061 7468 7320 746f 206e  st of paths to n
-00037bc0: 6966 7469 2066 696c 6573 2063 6f6e 7461  ifti files conta
-00037bd0: 696e 696e 6720 524f 4920 6d61 736b 733b  ining ROI masks;
-00037be0: 0a20 2020 2020 2020 2020 2020 202d 2054  .            - T
-00037bf0: 6865 2070 6174 6820 746f 2061 2064 6972  he path to a dir
-00037c00: 6563 746f 7279 2063 6f6e 7461 696e 696e  ectory containin
-00037c10: 6720 6d75 6c74 6970 6c65 206e 6966 7469  g multiple nifti
-00037c20: 2066 696c 6573 200a 2020 2020 2020 2020   files .        
-00037c30: 2020 2020 636f 6e74 6169 6e69 6e67 2052      containing R
-00037c40: 4f49 206d 6173 6b73 3b0a 2020 2020 2020  OI masks;.      
-00037c50: 2020 2020 2020 2d20 4120 6c69 7374 206f        - A list o
-00037c60: 6620 524f 4920 6f62 6a65 6374 733b 0a20  f ROI objects;. 
-00037c70: 2020 2020 2020 2020 2020 202d 2041 206c             - A l
-00037c80: 6973 7420 6f66 206f 626a 6563 7473 2074  ist of objects t
-00037c90: 6861 7420 636f 756c 6420 6265 2075 7365  hat could be use
-00037ca0: 6420 746f 2069 6e69 7469 616c 6973 6520  d to initialise 
-00037cb0: 616e 2052 4f49 206f 626a 6563 740a 2020  an ROI object.  
-00037cc0: 2020 2020 2020 2020 2020 2865 2e67 2e20            (e.g. 
-00037cd0: 6120 6e75 6d70 7920 6172 7261 7929 2e0a  a numpy array)..
-00037ce0: 0a20 2020 2020 2020 206e 616d 6520 3a20  .        name : 
-00037cf0: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
-00037d00: 650a 2020 2020 2020 2020 2020 2020 4f70  e.            Op
-00037d10: 7469 6f6e 616c 206e 616d 6520 746f 2061  tional name to a
-00037d20: 7373 6967 6e20 746f 2074 6869 7320 7374  ssign to this st
-00037d30: 7275 6374 7572 6520 7365 742e 2049 6620  ructure set. If 
-00037d40: 4e6f 6e65 2c20 7769 6c6c 200a 2020 2020  None, will .    
-00037d50: 2020 2020 2020 2020 6174 7465 6d70 7420          attempt 
-00037d60: 746f 2069 6e66 6572 2066 726f 6d20 696e  to infer from in
-00037d70: 7075 7420 6669 6c65 6e61 6d65 2e0a 0a20  put filename... 
-00037d80: 2020 2020 2020 2069 6d61 6765 203a 2073         image : s
-00037d90: 6b72 742e 696d 6167 652e 496d 6167 652c  krt.image.Image,
-00037da0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00037db0: 2020 2020 2020 2020 2020 496d 6167 6520            Image 
-00037dc0: 6173 736f 6369 6174 6564 2077 6974 6820  associated with 
-00037dd0: 7468 6973 2073 7472 7563 7475 7265 2073  this structure s
-00037de0: 6574 2e20 4966 2074 6865 2069 6e70 7574  et. If the input
-00037df0: 2073 6f75 7263 6520 6973 2061 0a20 2020   source is a.   
-00037e00: 2020 2020 2020 2020 2064 6963 6f6d 2066           dicom f
-00037e10: 696c 6520 636f 6e74 6169 6e69 6e67 2052  ile containing R
-00037e20: 4f49 2063 6f6e 746f 7572 732c 2074 6869  OI contours, thi
-00037e30: 7320 696d 6167 6520 7769 6c6c 2062 6520  s image will be 
-00037e40: 7573 6564 2077 6865 6e0a 2020 2020 2020  used when.      
-00037e50: 2020 2020 2020 6372 6561 7469 6e67 2052        creating R
-00037e60: 4f49 2062 696e 6172 7920 6d61 736b 732e  OI binary masks.
-00037e70: 0a0a 2020 2020 2020 2020 6c6f 6164 203a  ..        load :
-00037e80: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d54   bool, default=T
-00037e90: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00037ea0: 4966 2054 7275 652c 2052 4f49 7320 7769  If True, ROIs wi
-00037eb0: 6c6c 2069 6d6d 6564 6961 7465 6c79 2062  ll immediately b
-00037ec0: 6520 6c6f 6164 6564 2066 726f 6d20 736f  e loaded from so
-00037ed0: 7572 6365 732e 204f 7468 6572 7769 7365  urces. Otherwise
-00037ee0: 2c0a 2020 2020 2020 2020 2020 2020 6c6f  ,.            lo
-00037ef0: 6164 696e 6720 7769 6c6c 206e 6f74 206f  ading will not o
-00037f00: 6363 7572 2075 6e74 696c 2053 7472 7563  ccur until Struc
-00037f10: 7475 7265 5365 742e 6c6f 6164 2829 2069  tureSet.load() i
-00037f20: 7320 6361 6c6c 6564 2e0a 2020 2020 2020  s called..      
-00037f30: 2020 0a20 2020 2020 2020 206e 616d 6573    .        names
-00037f40: 203a 2064 6963 742f 6c69 7374 2c20 6465   : dict/list, de
-00037f50: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00037f60: 2020 2020 2020 204f 7074 696f 6e61 6c20         Optional 
-00037f70: 6469 6374 206f 6620 524f 4920 6e61 6d65  dict of ROI name
-00037f80: 7320 746f 2075 7365 2077 6865 6e20 7265  s to use when re
-00037f90: 6e61 6d69 6e67 206c 6f61 6465 6420 524f  naming loaded RO
-00037fa0: 4973 2e20 4b65 7973 200a 2020 2020 2020  Is. Keys .      
-00037fb0: 2020 2020 2020 7368 6f75 6c64 2062 6520        should be 
-00037fc0: 6465 7369 7265 6420 6e61 6d65 732c 2061  desired names, a
-00037fd0: 6e64 2076 616c 7565 7320 7368 6f75 6c64  nd values should
-00037fe0: 2062 6520 6c69 7374 7320 6f66 2070 6f73   be lists of pos
-00037ff0: 7369 626c 650a 2020 2020 2020 2020 2020  sible.          
-00038000: 2020 696e 7075 7420 6e61 6d65 7320 6f72    input names or
-00038010: 2077 696c 6463 6172 6473 206d 6174 6368   wildcards match
-00038020: 696e 6720 696e 7075 7420 6e61 6d65 732e  ing input names.
-00038030: 0a0a 2020 2020 2020 2020 2020 2020 4966  ..            If
-00038040: 206d 756c 7469 5f6c 6162 656c 3d54 7275   multi_label=Tru
-00038050: 652c 206e 616d 6573 2063 616e 2061 6c73  e, names can als
-00038060: 6f20 6265 2061 206c 6973 7420 6f66 206e  o be a list of n
-00038070: 616d 6573 2074 6f20 6173 7369 676e 0a20  ames to assign. 
-00038080: 2020 2020 2020 2020 2020 2074 6f20 6561             to ea
-00038090: 6368 206c 6162 656c 2066 6f75 6e64 2069  ch label found i
-000380a0: 6e20 6f72 6465 722c 2066 726f 6d20 736d  n order, from sm
-000380b0: 616c 6c65 7374 2074 6f20 6c61 7267 6573  allest to larges
-000380c0: 742e 0a0a 2020 2020 2020 2020 746f 5f6b  t...        to_k
-000380d0: 6565 7020 3a20 6c69 7374 2c20 6465 6661  eep : list, defa
-000380e0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-000380f0: 2020 2020 204f 7074 696f 6e61 6c20 6c69       Optional li
-00038100: 7374 206f 6620 524f 4920 6e61 6d65 7320  st of ROI names 
-00038110: 6f72 2077 696c 6463 6172 6473 206d 6174  or wildcards mat
-00038120: 6368 696e 6720 524f 4920 6e61 6d65 7320  ching ROI names 
-00038130: 6f66 2052 4f49 730a 2020 2020 2020 2020  of ROIs.        
-00038140: 2020 2020 746f 206b 6565 7020 696e 2074      to keep in t
-00038150: 6869 7320 5374 7275 6374 7572 6553 6574  his StructureSet
-00038160: 2064 7572 696e 6720 6c6f 6164 696e 672e   during loading.
-00038170: 2052 4f49 7320 6e6f 7420 6d61 7463 6869   ROIs not matchi
-00038180: 6e67 2077 696c 6c0a 2020 2020 2020 2020  ng will.        
-00038190: 2020 2020 6265 2064 6973 6361 7264 6564      be discarded
-000381a0: 2e20 4e6f 7465 2074 6861 7420 7468 6520  . Note that the 
-000381b0: 6e61 6d65 7320 7368 6f75 6c64 2072 6566  names should ref
-000381c0: 6c65 6374 2074 686f 7365 2061 6674 6572  lect those after
-000381d0: 200a 2020 2020 2020 2020 2020 2020 7265   .            re
-000381e0: 6e61 6d69 6e67 2076 6961 2074 6865 203c  naming via the <
-000381f0: 6e61 6d65 733e 2064 6963 742e 2049 6620  names> dict. If 
-00038200: 4e6f 6e65 2c20 616c 6c20 524f 4973 2077  None, all ROIs w
-00038210: 696c 6c20 6265 206b 6570 742e 0a0a 2020  ill be kept...  
-00038220: 2020 2020 2020 746f 5f72 656d 6f76 6520        to_remove 
-00038230: 3a20 6c69 7374 2c20 6465 6661 756c 743d  : list, default=
-00038240: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00038250: 204f 7074 696f 6e61 6c20 6c69 7374 206f   Optional list o
-00038260: 6620 524f 4920 6e61 6d65 7320 6f72 2077  f ROI names or w
-00038270: 696c 6463 6172 6473 206d 6174 6368 696e  ildcards matchin
-00038280: 6720 524f 4920 6e61 6d65 7320 6f66 2052  g ROI names of R
-00038290: 4f49 730a 2020 2020 2020 2020 2020 2020  OIs.            
-000382a0: 746f 2072 656d 6f76 6520 6672 6f6d 2074  to remove from t
-000382b0: 6869 7320 5374 7275 6374 7572 6553 6574  his StructureSet
-000382c0: 2064 7572 696e 6720 6c6f 6164 696e 672e   during loading.
-000382d0: 2052 4f49 7320 6d61 7463 6869 6e67 2077   ROIs matching w
-000382e0: 696c 6c0a 2020 2020 2020 2020 2020 2020  ill.            
-000382f0: 6265 2064 6973 6361 7264 6564 2e20 4e6f  be discarded. No
-00038300: 7465 2074 6861 7420 7468 6520 6e61 6d65  te that the name
-00038310: 7320 7368 6f75 6c64 2072 6566 6c65 6374  s should reflect
-00038320: 2074 686f 7365 2061 6674 6572 200a 2020   those after .  
-00038330: 2020 2020 2020 2020 2020 7265 6e61 6d69            renami
-00038340: 6e67 2076 6961 2074 6865 203c 6e61 6d65  ng via the <name
-00038350: 733e 2064 6963 742c 2061 6e64 2072 656d  s> dict, and rem
-00038360: 6f76 616c 206f 6363 7572 7320 6166 7465  oval occurs afte
-00038370: 7220 6669 6c74 6572 696e 670a 2020 2020  r filtering.    
-00038380: 2020 2020 2020 2020 7769 7468 2074 6865          with the
-00038390: 203c 746f 5f6b 6565 703e 206c 6973 742e   <to_keep> list.
-000383a0: 2049 6620 4e6f 6e65 2c20 6e6f 2052 4f49   If None, no ROI
-000383b0: 7320 7769 6c6c 2062 6520 7265 6d6f 7665  s will be remove
-000383c0: 642e 0a0a 2020 2020 2020 2020 6d75 6c74  d...        mult
-000383d0: 695f 6c61 6265 6c20 3a20 626f 6f6c 2c20  i_label : bool, 
-000383e0: 6465 6661 756c 743d 4661 6c73 650a 2020  default=False.  
-000383f0: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-00038400: 652c 2077 696c 6c20 6c6f 6f6b 2066 6f72  e, will look for
-00038410: 206d 756c 7469 706c 6520 524f 4920 6d61   multiple ROI ma
-00038420: 736b 7320 7769 7468 2064 6966 6665 7265  sks with differe
-00038430: 6e74 206c 6162 656c 7320 0a20 2020 2020  nt labels .     
-00038440: 2020 2020 2020 2069 6e73 6964 6520 7468         inside th
-00038450: 6520 6172 7261 7920 616e 6420 6372 6561  e array and crea
-00038460: 7465 2061 2073 6570 6172 6174 6520 524f  te a separate RO
-00038470: 4920 6672 6f6d 2065 6163 682e 0a0a 2020  I from each...  
-00038480: 2020 2020 2020 636f 6c6f 7273 203a 206c        colors : l
-00038490: 6973 742f 6469 6374 0a20 2020 2020 2020  ist/dict.       
-000384a0: 2020 2020 204c 6973 7420 6f72 2064 6963       List or dic
-000384b0: 7420 6f66 2063 6f6c 6f72 732e 2049 6620  t of colors. If 
-000384c0: 6120 6469 6374 2c20 7468 6520 6b65 7973  a dict, the keys
-000384d0: 2073 686f 756c 6420 6265 2052 4f49 206e   should be ROI n
-000384e0: 616d 6573 206f 720a 2020 2020 2020 2020  ames or.        
-000384f0: 2020 2020 7769 6c64 6361 7264 7320 6d61      wildcards ma
-00038500: 7463 6869 6e67 2052 4f49 206e 616d 6573  tching ROI names
-00038510: 2c20 616e 6420 7468 6520 7661 6c75 6573  , and the values
-00038520: 2073 686f 756c 6420 6265 2064 6573 6972   should be desir
-00038530: 6564 200a 2020 2020 2020 2020 2020 2020  ed .            
-00038540: 636f 6c6f 7273 2066 6f72 2052 4f49 7320  colors for ROIs 
-00038550: 6d61 7463 6869 6e67 2074 6861 7420 6e61  matching that na
-00038560: 6d65 2e20 4966 2061 206c 6973 742c 2073  me. If a list, s
-00038570: 686f 756c 6420 636f 6e74 6169 6e0a 2020  hould contain.  
-00038580: 2020 2020 2020 2020 2020 636f 6c6f 7273            colors
-00038590: 2077 6869 6368 2077 696c 6c20 6265 2061   which will be a
-000385a0: 7070 6c69 6564 2074 6f20 6c6f 6164 6564  pplied to loaded
-000385b0: 2052 4f49 7320 696e 206f 7264 6572 2e0a   ROIs in order..
-000385c0: 0a20 2020 2020 2020 2061 7574 6f5f 7469  .        auto_ti
-000385d0: 6d65 7374 616d 7020 3a20 626f 6f6c 2064  mestamp : bool d
-000385e0: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
-000385f0: 2020 2020 2020 2020 2049 6620 7472 7565           If true
-00038600: 2061 6e64 206e 6f20 7661 6c69 6420 7469   and no valid ti
-00038610: 6d65 7374 616d 7020 6973 2066 6f75 6e64  mestamp is found
-00038620: 2077 6974 6869 6e20 7468 6520 7061 7468   within the path
-00038630: 2073 7472 696e 672c 0a20 2020 2020 2020   string,.       
-00038640: 2020 2020 2074 696d 6573 7461 6d70 2067       timestamp g
-00038650: 656e 6572 6174 6564 2066 726f 6d20 6375  enerated from cu
-00038660: 7272 656e 7420 6461 7465 2061 6e64 2074  rrent date and t
-00038670: 696d 652e 0a0a 2020 2020 2020 2020 616c  ime...        al
-00038680: 7068 615f 6265 7461 5f72 6174 696f 7320  pha_beta_ratios 
-00038690: 3a20 6469 6374 2c20 6465 6661 756c 743d  : dict, default=
-000386a0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-000386b0: 2044 6963 7469 6f6e 6172 7920 7768 6572   Dictionary wher
-000386c0: 6520 6b65 7973 2061 7265 2052 4f49 206e  e keys are ROI n
-000386d0: 616d 6573 2061 6e64 2076 616c 7565 7320  ames and values 
-000386e0: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
-000386f0: 7261 7469 6f73 2066 6f72 2052 4f49 2074  ratios for ROI t
-00038700: 6973 7375 6573 206f 6620 636f 6566 6669  issues of coeffi
-00038710: 6369 656e 7473 2c20 616c 7068 612c 2062  cients, alpha, b
-00038720: 6574 612c 0a20 2020 2020 2020 2020 2020  eta,.           
-00038730: 2069 6e20 7468 6520 6c69 6e65 6172 2d71   in the linear-q
-00038740: 7561 6472 6174 6963 2065 7175 6174 696f  uadratic equatio
-00038750: 6e2e 2020 5468 6573 6520 7261 7469 6f73  n.  These ratios
-00038760: 2061 7265 0a20 2020 2020 2020 2020 2020   are.           
-00038770: 2075 7365 6420 696e 2063 616c 6375 6c61   used in calcula
-00038780: 7469 6e67 2062 696f 6c6f 6769 6361 6c6c  ting biologicall
-00038790: 7920 6566 6665 6374 6976 6520 646f 7365  y effective dose
-000387a0: 2c20 4245 442c 2066 726f 6d0a 2020 2020  , BED, from.    
-000387b0: 2020 2020 2020 2020 7068 7973 6963 616c          physical
-000387c0: 2064 6f73 652c 2044 2c20 6465 6c69 7665   dose, D, delive
-000387d0: 7265 6420 6f76 6572 206e 2065 7175 616c  red over n equal
-000387e0: 2066 7261 6374 696f 6e73 3a0a 2020 2020   fractions:.    
-000387f0: 2020 2020 2020 2020 2020 2020 4245 4420              BED 
-00038800: 3d20 4420 2a20 2831 202b 2028 442f 6e29  = D * (1 + (D/n)
-00038810: 202f 2028 616c 7068 612f 6265 7461 2929   / (alpha/beta))
-00038820: 2e0a 2020 2020 2020 2020 2020 2020 5468  ..            Th
-00038830: 6520 6174 7472 6962 7574 6520 616c 7068  e attribute alph
-00038840: 615f 6f76 6572 5f76 616c 7565 2069 7320  a_over_value is 
-00038850: 7365 7420 746f 2074 6865 2064 6963 7469  set to the dicti
-00038860: 6f6e 6172 7920 7661 6c75 650a 2020 2020  onary value.    
-00038870: 2020 2020 2020 2020 666f 7220 616e 2052          for an R
-00038880: 4f49 2069 6465 6e74 6966 6965 6420 6279  OI identified by
-00038890: 2061 206b 6579 2c20 6f72 2069 7320 7365   a key, or is se
-000388a0: 7420 746f 204e 6f6e 6520 666f 7220 616e  t to None for an
-000388b0: 790a 2020 2020 2020 2020 2020 2020 6f74  y.            ot
-000388c0: 6865 7220 524f 4973 2e0a 0a20 2020 2020  her ROIs...     
-000388d0: 2020 2060 2a2a 606b 7761 7267 7320 3a0a     `**`kwargs :.
-000388e0: 2020 2020 2020 2020 2020 2020 4164 6469              Addi
-000388f0: 7469 6f6e 616c 206b 6579 776f 7264 2061  tional keyword a
-00038900: 7267 7320 746f 2075 7365 2077 6865 6e20  rgs to use when 
-00038910: 696e 6974 6961 6c69 7369 6e67 206e 6577  initialising new
-00038920: 2052 4f49 206f 626a 6563 7473 2e0a 2020   ROI objects..  
-00038930: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-00038940: 2020 2023 2043 6c6f 6e65 2066 726f 6d20     # Clone from 
-00038950: 616e 6f74 6865 7220 5374 7275 6374 7572  another Structur
-00038960: 6553 6574 206f 626a 6563 740a 2020 2020  eSet object.    
-00038970: 2020 2020 6966 2069 7373 7562 636c 6173      if issubclas
-00038980: 7328 7479 7065 2870 6174 6829 2c20 5374  s(type(path), St
-00038990: 7275 6374 7572 6553 6574 293a 0a20 2020  ructureSet):.   
-000389a0: 2020 2020 2020 2020 2070 6174 682e 636c           path.cl
-000389b0: 6f6e 655f 6174 7472 7328 7365 6c66 290a  one_attrs(self).
-000389c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000389d0: 726e 0a0a 2020 2020 2020 2020 7365 6c66  rn..        self
-000389e0: 2e6e 616d 6520 3d20 6e61 6d65 0a20 2020  .name = name.   
-000389f0: 2020 2020 2070 6174 6820 3d20 2873 6b72       path = (skr
-00038a00: 742e 636f 7265 2e66 756c 6c70 6174 6828  t.core.fullpath(
-00038a10: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
-00038a20: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00038a30: 6e63 6528 7061 7468 2c20 2873 7472 2c20  nce(path, (str, 
-00038a40: 5061 7468 2929 2065 6c73 6520 7061 7468  Path)) else path
-00038a50: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
-00038a60: 6f75 7263 6573 203d 2070 6174 680a 2020  ources = path.  
-00038a70: 2020 2020 2020 6966 2073 656c 662e 736f        if self.so
-00038a80: 7572 6365 7320 6973 204e 6f6e 653a 0a20  urces is None:. 
-00038a90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00038aa0: 736f 7572 6365 7320 3d20 5b5d 0a20 2020  sources = [].   
-00038ab0: 2020 2020 2065 6c69 6620 6e6f 7420 736b       elif not sk
-00038ac0: 7274 2e63 6f72 652e 6973 5f6c 6973 7428  rt.core.is_list(
-00038ad0: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
-00038ae0: 2020 2073 656c 662e 736f 7572 6365 7320     self.sources 
-00038af0: 3d20 5b70 6174 685d 0a20 2020 2020 2020  = [path].       
-00038b00: 2073 656c 662e 726f 6973 203d 205b 5d0a   self.rois = [].
-00038b10: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-00038b20: 5f69 6d61 6765 2869 6d61 6765 290a 2020  _image(image).  
-00038b30: 2020 2020 2020 7365 6c66 2e74 6f5f 6b65        self.to_ke
-00038b40: 6570 203d 2074 6f5f 6b65 6570 0a20 2020  ep = to_keep.   
-00038b50: 2020 2020 2073 656c 662e 746f 5f72 656d       self.to_rem
-00038b60: 6f76 6520 3d20 746f 5f72 656d 6f76 650a  ove = to_remove.
-00038b70: 2020 2020 2020 2020 7365 6c66 2e6e 616d          self.nam
-00038b80: 6573 203d 206e 616d 6573 0a20 2020 2020  es = names.     
-00038b90: 2020 2073 656c 662e 6b65 6570 5f72 656e     self.keep_ren
-00038ba0: 616d 6564 5f6f 6e6c 7920 3d20 6b65 6570  amed_only = keep
-00038bb0: 5f72 656e 616d 6564 5f6f 6e6c 790a 2020  _renamed_only.  
-00038bc0: 2020 2020 2020 7365 6c66 2e6d 756c 7469        self.multi
-00038bd0: 5f6c 6162 656c 203d 206d 756c 7469 5f6c  _label = multi_l
-00038be0: 6162 656c 0a20 2020 2020 2020 2073 656c  abel.        sel
-00038bf0: 662e 636f 6c6f 7273 203d 2063 6f6c 6f72  f.colors = color
-00038c00: 730a 2020 2020 2020 2020 7365 6c66 2e69  s.        self.i
-00038c10: 676e 6f72 655f 6469 636f 6d5f 636f 6c6f  gnore_dicom_colo
-00038c20: 7273 203d 2069 676e 6f72 655f 6469 636f  rs = ignore_dico
-00038c30: 6d5f 636f 6c6f 7273 0a20 2020 2020 2020  m_colors.       
-00038c40: 2073 656c 662e 6469 636f 6d5f 6461 7461   self.dicom_data
-00038c50: 7365 7420 3d20 4e6f 6e65 0a20 2020 2020  set = None.     
-00038c60: 2020 2073 656c 662e 616c 7068 615f 6265     self.alpha_be
-00038c70: 7461 5f72 6174 696f 7320 3d20 616c 7068  ta_ratios = alph
-00038c80: 615f 6265 7461 5f72 6174 696f 7320 6f72  a_beta_ratios or
-00038c90: 207b 7d0a 2020 2020 2020 2020 7365 6c66   {}.        self
-00038ca0: 2e72 6f69 5f6b 7761 7267 7320 3d20 6b77  .roi_kwargs = kw
-00038cb0: 6172 6773 0a20 2020 2020 2020 2073 656c  args.        sel
-00038cc0: 662e 706c 616e 7320 3d20 5b5d 0a20 2020  f.plans = [].   
-00038cd0: 2020 2020 2070 6174 6820 3d20 7061 7468       path = path
-00038ce0: 2069 6620 6973 696e 7374 616e 6365 2870   if isinstance(p
-00038cf0: 6174 682c 2073 7472 2920 656c 7365 2022  ath, str) else "
-00038d00: 220a 2020 2020 2020 2020 736b 7274 2e63  ".        skrt.c
-00038d10: 6f72 652e 4172 6368 6976 652e 5f5f 696e  ore.Archive.__in
-00038d20: 6974 5f5f 2873 656c 662c 2070 6174 682c  it__(self, path,
-00038d30: 2061 7574 6f5f 7469 6d65 7374 616d 7029   auto_timestamp)
-00038d40: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00038d50: 2e70 6174 6820 616e 6420 6e6f 7420 7365  .path and not se
-00038d60: 6c66 2e6e 616d 653a 0a20 2020 2020 2020  lf.name:.       
-00038d70: 2020 2020 206e 616d 6520 3d20 5061 7468       name = Path
-00038d80: 2873 656c 662e 7061 7468 292e 6e61 6d65  (self.path).name
-00038d90: 2e73 706c 6974 2827 5f27 295b 305d 2e6c  .split('_')[0].l
-00038da0: 6f77 6572 2829 0a20 2020 2020 2020 2020  ower().         
-00038db0: 2020 2069 6620 6e61 6d65 5b30 5d2e 6973     if name[0].is
-00038dc0: 616c 7068 6128 293a 0a20 2020 2020 2020  alpha():.       
-00038dd0: 2020 2020 2020 2020 2073 656c 662e 6e61           self.na
-00038de0: 6d65 203d 206e 616d 650a 2020 2020 2020  me = name.      
-00038df0: 2020 7365 6c66 2e73 756d 6d65 645f 6e61    self.summed_na
-00038e00: 6d65 7320 3d20 5b5d 0a0a 2020 2020 2020  mes = []..      
-00038e10: 2020 7365 6c66 2e6c 6f61 6465 6420 3d20    self.loaded = 
-00038e20: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
-00038e30: 206c 6f61 643a 0a20 2020 2020 2020 2020   load:.         
-00038e40: 2020 2073 656c 662e 6c6f 6164 2829 0a0a     self.load()..
-00038e50: 2020 2020 6465 6620 5f5f 6765 7469 7465      def __getite
-00038e60: 6d5f 5f28 7365 6c66 2c20 726f 6929 3a0a  m__(self, roi):.
-00038e70: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00038e80: 7461 6e63 6528 726f 692c 2069 6e74 293a  tance(roi, int):
-00038e90: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00038ea0: 7572 6e20 7365 6c66 2e67 6574 5f72 6f69  urn self.get_roi
-00038eb0: 7328 295b 726f 695d 200a 2020 2020 2020  s()[roi] .      
-00038ec0: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-00038ed0: 6528 726f 692c 2073 7472 293a 0a20 2020  e(roi, str):.   
-00038ee0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00038ef0: 7365 6c66 2e67 6574 5f72 6f69 5f64 6963  self.get_roi_dic
-00038f00: 7428 295b 726f 695d 0a0a 2020 2020 6465  t()[roi]..    de
-00038f10: 6620 5f5f 6974 6572 5f5f 2873 656c 6629  f __iter__(self)
-00038f20: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00038f30: 2053 7472 7563 7475 7265 5365 7449 7465   StructureSetIte
-00038f40: 7261 746f 7228 7365 6c66 290a 0a20 2020  rator(self)..   
-00038f50: 2064 6566 205f 5f61 6464 5f5f 2873 656c   def __add__(sel
-00038f60: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
-00038f70: 2020 2027 2727 0a20 2020 2020 2020 2044     '''.        D
-00038f80: 6566 696e 6520 6164 6469 7469 6f6e 206f  efine addition o
-00038f90: 6620 5374 7275 6374 7572 6553 6574 2069  f StructureSet i
-00038fa0: 6e73 7461 6e63 6573 2e0a 0a20 2020 2020  nstances...     
-00038fb0: 2020 2054 6865 2072 6573 756c 7420 6f66     The result of
-00038fc0: 2074 6865 2061 6464 6974 696f 6e20 6f66   the addition of
-00038fd0: 2073 656c 6620 616e 6420 6f74 6865 7220   self and other 
-00038fe0: 6973 2061 2053 7472 7563 7475 7265 5365  is a StructureSe
-00038ff0: 740a 2020 2020 2020 2020 6f62 6a65 6374  t.        object
-00039000: 2074 6861 7420 636f 6e74 6169 6e73 2074   that contains t
-00039010: 6865 2028 636c 6f6e 6564 2920 524f 4973  he (cloned) ROIs
-00039020: 206f 6620 626f 7468 2e20 2041 2072 6573   of both.  A res
-00039030: 756c 7420 524f 490a 2020 2020 2020 2020  ult ROI.        
-00039040: 7769 6c6c 2062 6520 7072 6566 6978 6564  will be prefixed
-00039050: 2062 7920 7468 6520 6e61 6d65 206f 6620   by the name of 
-00039060: 7468 6520 5374 7275 6374 7572 6553 6574  the StructureSet
-00039070: 2066 726f 6d20 7768 6963 6820 6974 0a20   from which it. 
-00039080: 2020 2020 2020 206f 7269 6769 6e61 7465         originate
-00039090: 732e 2020 4966 2074 6865 2052 4f49 206e  s.  If the ROI n
-000390a0: 616d 6520 6265 666f 7265 2074 6865 2061  ame before the a
-000390b0: 6464 6974 696f 6e20 6861 7320 7468 6520  ddition has the 
-000390c0: 5374 7275 6374 7572 6553 6574 0a20 2020  StructureSet.   
-000390d0: 2020 2020 206e 616d 6520 6173 2070 7265       name as pre
-000390e0: 6669 782c 206e 6f20 6e65 7720 7072 6566  fix, no new pref
-000390f0: 6978 2069 7320 6164 6465 642e 2020 5468  ix is added.  Th
-00039100: 6572 6520 6973 206e 6f20 7265 7175 6972  ere is no requir
-00039110: 656d 656e 740a 2020 2020 2020 2020 7468  ement.        th
-00039120: 6174 2052 4f49 7320 6f72 2074 6865 6972  at ROIs or their
-00039130: 206e 616d 6573 2062 6520 756e 6971 7565   names be unique
-00039140: 2077 6974 6869 6e20 6120 5374 7275 6374   within a Struct
-00039150: 7572 6553 6574 2e20 2041 6464 696e 670a  ureSet.  Adding.
-00039160: 2020 2020 2020 2020 6120 5374 7275 6374          a Struct
-00039170: 7572 6553 6574 2074 6f20 6974 7365 6c66  ureSet to itself
-00039180: 2077 696c 6c20 6769 7665 2061 2072 6573   will give a res
-00039190: 756c 7420 696e 636c 7564 696e 6720 6475  ult including du
-000391a0: 706c 6963 6174 650a 2020 2020 2020 2020  plicate.        
-000391b0: 524f 4973 2077 6974 6820 6475 706c 6963  ROIs with duplic
-000391c0: 6174 6520 6e61 6d65 732e 0a20 2020 2020  ate names..     
-000391d0: 2020 2027 2727 0a20 2020 2020 2020 2023     '''.        #
-000391e0: 2045 6e73 7572 6520 7468 6174 2053 7472   Ensure that Str
-000391f0: 7563 7475 7265 5365 7420 6461 7461 2061  uctureSet data a
-00039200: 7265 206c 6f61 6465 642e 0a20 2020 2020  re loaded..     
-00039210: 2020 2073 656c 662e 6c6f 6164 2829 0a20     self.load(). 
-00039220: 2020 2020 2020 206f 7468 6572 2e6c 6f61         other.loa
-00039230: 6428 290a 0a20 2020 2020 2020 2023 2043  d()..        # C
-00039240: 7265 6174 6520 6e65 7720 5374 7275 6374  reate new Struct
-00039250: 7572 6553 6574 2069 6e73 7461 6e63 6520  ureSet instance 
-00039260: 666f 7220 7375 6d2c 0a20 2020 2020 2020  for sum,.       
-00039270: 2023 2061 6e64 2073 746f 7265 206e 616d   # and store nam
-00039280: 6573 206f 6620 636f 6e74 7269 6275 746f  es of contributo
-00039290: 7273 2e0a 2020 2020 2020 2020 7265 7375  rs..        resu
-000392a0: 6c74 203d 2053 7472 7563 7475 7265 5365  lt = StructureSe
-000392b0: 7428 290a 2020 2020 2020 2020 7265 7375  t().        resu
-000392c0: 6c74 2e73 756d 6d65 645f 6e61 6d65 7320  lt.summed_names 
-000392d0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-000392e0: 206e 616d 6573 2069 6e20 5b73 656c 662e   names in [self.
-000392f0: 7375 6d6d 6564 5f6e 616d 6573 2c20 6f74  summed_names, ot
-00039300: 6865 722e 7375 6d6d 6564 5f6e 616d 6573  her.summed_names
-00039310: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00039320: 2020 5b73 656c 662e 6e61 6d65 5d2c 205b    [self.name], [
-00039330: 6f74 6865 722e 6e61 6d65 5d5d 3a0a 2020  other.name]]:.  
-00039340: 2020 2020 2020 2020 2020 666f 7220 6e61            for na
-00039350: 6d65 2069 6e20 6e61 6d65 733a 0a20 2020  me in names:.   
-00039360: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00039370: 6973 696e 7374 616e 6365 286e 616d 652c  isinstance(name,
-00039380: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
-00039390: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-000393a0: 7562 5f6e 616d 6520 696e 206e 616d 652e  ub_name in name.
-000393b0: 7370 6c69 7428 225f 2229 3a0a 2020 2020  split("_"):.    
-000393c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000393d0: 2020 2020 6966 2073 7562 5f6e 616d 6520      if sub_name 
-000393e0: 6e6f 7420 696e 2072 6573 756c 742e 7375  not in result.su
-000393f0: 6d6d 6564 5f6e 616d 6573 3a0a 2020 2020  mmed_names:.    
-00039400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039410: 2020 2020 2020 2020 7265 7375 6c74 2e73          result.s
-00039420: 756d 6d65 645f 6e61 6d65 732e 6170 7065  ummed_names.appe
-00039430: 6e64 2873 7562 5f6e 616d 6529 0a20 2020  nd(sub_name).   
-00039440: 2020 2020 2072 6573 756c 742e 7375 6d6d       result.summ
-00039450: 6564 5f6e 616d 6573 2e73 6f72 7428 290a  ed_names.sort().
-00039460: 0a20 2020 2020 2020 2023 204c 6f6f 7020  .        # Loop 
-00039470: 6f76 6572 2053 7472 7563 7475 7265 5365  over StructureSe
-00039480: 7473 2061 6e64 2074 6865 6972 2052 4f49  ts and their ROI
-00039490: 732e 0a20 2020 2020 2020 2066 6f72 2073  s..        for s
-000394a0: 7320 696e 205b 7365 6c66 2c20 6f74 6865  s in [self, othe
-000394b0: 725d 3a0a 2020 2020 2020 2020 2020 2020  r]:.            
-000394c0: 666f 7220 726f 6920 696e 2073 732e 6765  for roi in ss.ge
-000394d0: 745f 726f 6973 2829 3a0a 2020 2020 2020  t_rois():.      
-000394e0: 2020 2020 2020 2020 2020 726f 695f 636c            roi_cl
-000394f0: 6f6e 6520 3d20 726f 692e 636c 6f6e 6528  one = roi.clone(
-00039500: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00039510: 2020 2320 5472 7920 746f 2070 7265 6669    # Try to prefi
-00039520: 7820 524f 4920 6e61 6d65 2077 6974 6820  x ROI name with 
-00039530: 7468 6520 6e61 6d65 206f 6620 7468 6520  the name of the 
-00039540: 5374 7275 6374 7572 6553 6574 0a20 2020  StructureSet.   
-00039550: 2020 2020 2020 2020 2020 2020 2023 2066               # f
-00039560: 726f 6d20 7768 6963 6820 6974 206f 7269  rom which it ori
-00039570: 6769 6e61 7465 732e 0a20 2020 2020 2020  ginates..       
-00039580: 2020 2020 2020 2020 2069 6620 2872 6f69           if (roi
-00039590: 2e6e 616d 652e 7370 6c69 7428 225f 2229  .name.split("_")
-000395a0: 5b30 5d20 696e 2072 6573 756c 742e 7375  [0] in result.su
-000395b0: 6d6d 6564 5f6e 616d 6573 0a20 2020 2020  mmed_names.     
-000395c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000395d0: 2020 206f 7220 7373 2e6e 616d 6520 6973     or ss.name is
-000395e0: 204e 6f6e 6529 3a0a 2020 2020 2020 2020   None):.        
-000395f0: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
-00039600: 636c 6f6e 652e 6e61 6d65 203d 2072 6f69  clone.name = roi
-00039610: 2e6e 616d 650a 2020 2020 2020 2020 2020  .name.          
-00039620: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00039630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039640: 726f 695f 636c 6f6e 652e 6e61 6d65 203d  roi_clone.name =
-00039650: 2022 5f22 2e6a 6f69 6e28 5b73 732e 6e61   "_".join([ss.na
-00039660: 6d65 2c20 726f 692e 6e61 6d65 5d29 0a20  me, roi.name]). 
-00039670: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00039680: 2041 6464 2052 4f49 2074 6f20 7468 6520   Add ROI to the 
-00039690: 7265 7375 6c74 2e0a 2020 2020 2020 2020  result..        
-000396a0: 2020 2020 2020 2020 7265 7375 6c74 2e61          result.a
-000396b0: 6464 5f72 6f69 2872 6f69 5f63 6c6f 6e65  dd_roi(roi_clone
-000396c0: 290a 0a20 2020 2020 2020 2023 2041 7320  )..        # As 
-000396d0: 7265 7375 6c74 2069 6d61 6765 2073 6574  result image set
-000396e0: 2074 6865 2069 6d61 6765 206f 6620 7365   the image of se
-000396f0: 6c66 2069 6620 6e6f 6e2d 6e75 6c6c 2c0a  lf if non-null,.
-00039700: 2020 2020 2020 2020 2320 6f72 206f 7468          # or oth
-00039710: 7769 7365 2074 6865 2069 6d61 6765 206f  wise the image o
-00039720: 6620 6f74 6865 722e 0a20 2020 2020 2020  f other..       
-00039730: 2069 6d61 6765 203d 2073 656c 662e 696d   image = self.im
-00039740: 6167 6520 6966 2073 656c 662e 696d 6167  age if self.imag
-00039750: 6520 656c 7365 206f 7468 6572 2e69 6d61  e else other.ima
-00039760: 6765 0a20 2020 2020 2020 2072 6573 756c  ge.        resul
-00039770: 742e 7365 745f 696d 6167 6528 696d 6167  t.set_image(imag
-00039780: 6529 0a0a 2020 2020 2020 2020 2320 5365  e)..        # Se
-00039790: 7420 7468 6520 7265 7375 6c74 206e 616d  t the result nam
-000397a0: 6520 746f 2062 6520 7468 6520 636f 6e63  e to be the conc
-000397b0: 6174 656e 6174 696f 6e20 6f66 2074 6865  atenation of the
-000397c0: 206e 616d 6573 0a20 2020 2020 2020 2023   names.        #
-000397d0: 206f 6620 7468 6520 636f 6e74 7269 6275   of the contribu
-000397e0: 746f 7273 2e0a 2020 2020 2020 2020 6966  tors..        if
-000397f0: 2072 6573 756c 742e 7375 6d6d 6564 5f6e   result.summed_n
-00039800: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
-00039810: 2020 7265 7375 6c74 2e6e 616d 6520 3d20    result.name = 
-00039820: 225f 222e 6a6f 696e 2872 6573 756c 742e  "_".join(result.
-00039830: 7375 6d6d 6564 5f6e 616d 6573 290a 0a20  summed_names).. 
-00039840: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00039850: 7375 6c74 0a0a 2020 2020 6465 6620 5f5f  sult..    def __
-00039860: 6961 6464 5f5f 2873 656c 662c 206f 7468  iadd__(self, oth
-00039870: 6572 293a 0a20 2020 2020 2020 2027 2727  er):.        '''
-00039880: 0a20 2020 2020 2020 2044 6566 696e 6520  .        Define 
-00039890: 696e 2d70 6c61 6365 206f 6620 5374 7275  in-place of Stru
-000398a0: 6374 7572 6553 6574 2069 6e73 7461 6e63  ctureSet instanc
-000398b0: 6573 2e0a 0a20 2020 2020 2020 2054 6865  es...        The
-000398c0: 2072 6573 756c 7420 6f66 2074 6865 2061   result of the a
-000398d0: 6464 6974 696f 6e20 6f66 2073 656c 6620  ddition of self 
-000398e0: 616e 6420 6f74 6865 7220 6973 2061 2053  and other is a S
-000398f0: 7472 7563 7475 7265 5365 740a 2020 2020  tructureSet.    
-00039900: 2020 2020 6f62 6a65 6374 2074 6861 7420      object that 
-00039910: 636f 6e74 6169 6e73 2074 6865 2028 636c  contains the (cl
-00039920: 6f6e 6564 2920 524f 4973 206f 6620 626f  oned) ROIs of bo
-00039930: 7468 2e20 2041 2072 6573 756c 7420 524f  th.  A result RO
-00039940: 490a 2020 2020 2020 2020 7769 6c6c 2062  I.        will b
-00039950: 6520 7072 6566 6978 6564 2062 7920 7468  e prefixed by th
-00039960: 6520 6e61 6d65 206f 6620 7468 6520 5374  e name of the St
-00039970: 7275 6374 7572 6553 6574 2066 726f 6d20  ructureSet from 
-00039980: 7768 6963 6820 6974 0a20 2020 2020 2020  which it.       
-00039990: 206f 7269 6769 6e61 7465 732e 2020 4966   originates.  If
-000399a0: 2074 6865 2052 4f49 206e 616d 6520 6265   the ROI name be
-000399b0: 666f 7265 2074 6865 2061 6464 6974 696f  fore the additio
-000399c0: 6e20 6861 7320 7468 6520 5374 7275 6374  n has the Struct
-000399d0: 7572 6553 6574 0a20 2020 2020 2020 206e  ureSet.        n
-000399e0: 616d 6520 6173 2070 7265 6669 782c 206e  ame as prefix, n
-000399f0: 6f20 6e65 7720 7072 6566 6978 2069 7320  o new prefix is 
-00039a00: 6164 6465 642e 2020 5468 6572 6520 6973  added.  There is
-00039a10: 206e 6f20 7265 7175 6972 656d 656e 740a   no requirement.
-00039a20: 2020 2020 2020 2020 7468 6174 2052 4f49          that ROI
-00039a30: 7320 6f72 2074 6865 6972 206e 616d 6573  s or their names
-00039a40: 2062 6520 756e 6971 7565 2077 6974 6869   be unique withi
-00039a50: 6e20 6120 5374 7275 6374 7572 6553 6574  n a StructureSet
-00039a60: 2e20 2041 6464 696e 670a 2020 2020 2020  .  Adding.      
-00039a70: 2020 6120 5374 7275 6374 7572 6553 6574    a StructureSet
-00039a80: 2074 6f20 6974 7365 6c66 2077 696c 6c20   to itself will 
-00039a90: 6769 7665 2061 2072 6573 756c 7420 696e  give a result in
-00039aa0: 636c 7564 696e 6720 6475 706c 6963 6174  cluding duplicat
-00039ab0: 650a 2020 2020 2020 2020 524f 4973 2077  e.        ROIs w
-00039ac0: 6974 6820 6475 706c 6963 6174 6520 6e61  ith duplicate na
-00039ad0: 6d65 732e 0a20 2020 2020 2020 2027 2727  mes..        '''
-00039ae0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00039af0: 7365 6c66 202b 206f 7468 6572 0a0a 2020  self + other..  
-00039b00: 2020 6465 6620 6c6f 6164 2873 656c 662c    def load(self,
-00039b10: 2073 6f75 7263 6573 3d4e 6f6e 652c 2066   sources=None, f
-00039b20: 6f72 6365 3d46 616c 7365 293a 0a20 2020  orce=False):.   
-00039b30: 2020 2020 2022 2222 4c6f 6164 2073 7472       """Load str
-00039b40: 7563 7475 7265 2073 6574 2066 726f 6d20  ucture set from 
-00039b50: 736f 7572 6365 2873 292e 2049 6620 4e6f  source(s). If No
-00039b60: 6e65 2c20 7769 6c6c 206c 6f61 6420 6672  ne, will load fr
-00039b70: 6f6d 206f 776e 0a20 2020 2020 2020 2073  om own.        s
-00039b80: 656c 662e 736f 7572 6365 732e 2222 220a  elf.sources.""".
-00039b90: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00039ba0: 2e6c 6f61 6465 6420 616e 6420 6e6f 7420  .loaded and not 
-00039bb0: 666f 7263 6520 616e 6420 736f 7572 6365  force and source
-00039bc0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00039bd0: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
-00039be0: 2020 2020 2020 2069 6620 736f 7572 6365         if source
-00039bf0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00039c00: 2020 2020 2020 2073 6f75 7263 6573 203d         sources =
-00039c10: 2073 656c 662e 736f 7572 6365 730a 0a20   self.sources.. 
-00039c20: 2020 2020 2020 2023 204c 616f 6420 6672         # Laod fr
-00039c30: 6f6d 206d 756c 7469 2d6c 6162 656c 2061  om multi-label a
-00039c40: 7272 6179 0a20 2020 2020 2020 2069 6620  rray.        if 
-00039c50: 7365 6c66 2e6d 756c 7469 5f6c 6162 656c  self.multi_label
-00039c60: 3a0a 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00039c70: 6620 6973 696e 7374 616e 6365 2873 6f75  f isinstance(sou
-00039c80: 7263 6573 2c20 6c69 7374 2920 616e 6420  rces, list) and 
-00039c90: 6c65 6e28 736f 7572 6365 7329 203d 3d20  len(sources) == 
-00039ca0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-00039cb0: 2020 2073 6f75 7263 6573 203d 2073 6f75     sources = sou
-00039cc0: 7263 6573 5b30 5d0a 2020 2020 2020 2020  rces[0].        
-00039cd0: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
-00039ce0: 7461 6e63 6528 736f 7572 6365 732c 2073  tance(sources, s
-00039cf0: 7472 2920 616e 6420 6e6f 7420 6973 696e  tr) and not isin
-00039d00: 7374 616e 6365 2873 6f75 7263 6573 2c20  stance(sources, 
-00039d10: 6e70 2e6e 6461 7272 6179 293a 0a20 2020  np.ndarray):.   
-00039d20: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00039d30: 7365 2054 7970 6545 7272 6f72 2822 496e  se TypeError("In
-00039d40: 7075 7420 666f 7220 6120 6d75 6c74 692d  put for a multi-
-00039d50: 6c61 6265 6c20 696d 6167 6520 6d75 7374  label image must
-00039d60: 2062 6520 6669 6c65 7061 7468 2022 0a20   be filepath ". 
-00039d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039d80: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00039d90: 226f 7220 6e75 6d70 7920 6172 7261 792e  "or numpy array.
-00039da0: 2054 7970 6520 666f 756e 643a 207b 7479   Type found: {ty
-00039db0: 7065 2873 6f75 7263 6573 297d 2e22 290a  pe(sources)}.").
-00039dc0: 2020 2020 2020 2020 2020 2020 7369 6e67              sing
-00039dd0: 6c65 5f73 6f75 7263 6520 3d20 5472 7565  le_source = True
-00039de0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00039df0: 4c6f 6164 2069 6e70 7574 2061 7272 6179  Load input array
-00039e00: 2069 6e74 6f20 696d 6167 650a 2020 2020   into image.    
-00039e10: 2020 2020 2020 2020 6172 7261 7920 3d20          array = 
-00039e20: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
-00039e30: 2873 6f75 7263 6573 292e 6765 745f 6461  (sources).get_da
-00039e40: 7461 2873 7461 6e64 6172 6469 7365 3d54  ta(standardise=T
-00039e50: 7275 6529 2e61 7374 7970 6528 696e 7429  rue).astype(int)
-00039e60: 0a20 2020 2020 2020 2020 2020 206e 203d  .            n =
-00039e70: 2061 7272 6179 2e6d 6178 2829 0a0a 2020   array.max()..  
-00039e80: 2020 2020 2020 2020 2020 2320 456e 666f            # Enfo
-00039e90: 7263 6520 4469 636f 6d20 636f 6e76 656e  rce Dicom conven
-00039ea0: 7469 6f6e 2066 6f72 2064 6174 6120 6172  tion for data ar
-00039eb0: 7261 7920 6f66 2069 6d61 6765 206f 626a  ray of image obj
-00039ec0: 6563 742c 0a20 2020 2020 2020 2020 2020  ect,.           
-00039ed0: 2023 2073 6f20 7468 6174 2061 6666 696e   # so that affin
-00039ee0: 6520 6d61 7472 6978 2077 696c 6c20 6265  e matrix will be
-00039ef0: 2063 6f72 7265 6374 6c79 2064 6566 696e   correctly defin
-00039f00: 6564 2066 6f72 206d 6173 6b20 6372 6561  ed for mask crea
-00039f10: 7469 6f6e 2e0a 2020 2020 2020 2020 2020  tion..          
-00039f20: 2020 696d 203d 2073 6b72 742e 696d 6167    im = skrt.imag
-00039f30: 652e 496d 6167 6528 736f 7572 6365 7329  e.Image(sources)
-00039f40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00039f50: 276e 6966 7469 2720 696e 2069 6d2e 736f  'nifti' in im.so
-00039f60: 7572 6365 5f74 7970 653a 0a20 2020 2020  urce_type:.     
-00039f70: 2020 2020 2020 2020 2020 2069 6d20 3d20             im = 
-00039f80: 696d 2e61 7374 7970 6528 2764 636d 2729  im.astype('dcm')
-00039f90: 0a20 2020 2020 2020 2020 2020 2069 5f6e  .            i_n
-00039fa0: 616d 6520 3d20 300a 2020 2020 2020 2020  ame = 0.        
-00039fb0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-00039fc0: 6765 2830 2c20 6e29 3a0a 2020 2020 2020  ge(0, n):.      
-00039fd0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00039fe0: 662e 6e61 6d65 7320 6973 206e 6f74 204e  f.names is not N
-00039ff0: 6f6e 6520 616e 6420 695f 6e61 6d65 203c  one and i_name <
-0003a000: 206c 656e 2873 656c 662e 6e61 6d65 7329   len(self.names)
-0003a010: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003a020: 2020 2020 2020 6e61 6d65 203d 2073 656c        name = sel
-0003a030: 662e 6e61 6d65 735b 695f 6e61 6d65 5d0a  f.names[i_name].
-0003a040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a050: 2020 2020 695f 6e61 6d65 202b 3d20 310a      i_name += 1.
-0003a060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a070: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0003a080: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
-0003a090: 2066 2252 4f49 207b 697d 220a 0a20 2020   f"ROI {i}"..   
-0003a0a0: 2020 2020 2020 2020 2020 2020 2023 696d               #im
-0003a0b0: 322e 6461 7461 203d 2028 696d 312e 6461  2.data = (im1.da
-0003a0c0: 7461 203d 3d20 6920 2b20 3129 0a20 2020  ta == i + 1).   
-0003a0d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0003a0e0: 662e 726f 6973 2e61 7070 656e 6428 524f  f.rois.append(RO
-0003a0f0: 4928 0a20 2020 2020 2020 2020 2020 2020  I(.             
-0003a100: 2020 2020 2020 2061 7272 6179 203d 3d20         array == 
-0003a110: 6920 2b20 312c 200a 2020 2020 2020 2020  i + 1, .        
-0003a120: 2020 2020 2020 2020 2020 2020 6166 6669              affi
-0003a130: 6e65 203d 2069 6d2e 6765 745f 6166 6669  ne = im.get_affi
-0003a140: 6e65 2829 2c0a 2020 2020 2020 2020 2020  ne(),.          
-0003a150: 2020 2020 2020 2020 2020 766f 7865 6c5f            voxel_
-0003a160: 7369 7a65 203d 204e 6f6e 652c 0a20 2020  size = None,.   
+0002f340: 2076 6f78 656c 5f73 697a 653d 766f 7865   voxel_size=voxe
+0002f350: 6c5f 7369 7a65 2c0a 2020 2020 2020 2020  l_size,.        
+0002f360: 2020 2020 2020 2020 2020 2020 6275 6666              buff
+0002f370: 6572 3d62 7566 6665 720a 2020 2020 2020  er=buffer.      
+0002f380: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0002f390: 2020 2020 2020 2020 2020 2020 696d 2e74              im.t
+0002f3a0: 6974 6c65 203d 2073 656c 662e 6e61 6d65  itle = self.name
+0002f3b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f3c0: 2072 6f69 5f74 6d70 203d 2073 656c 662e   roi_tmp = self.
+0002f3d0: 636c 6f6e 6528 636f 7079 5f64 6174 613d  clone(copy_data=
+0002f3e0: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+0002f3f0: 2020 2020 2020 2072 6f69 5f74 6d70 2e73         roi_tmp.s
+0002f400: 6574 5f69 6d61 6765 2869 6d29 0a20 2020  et_image(im).   
+0002f410: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0002f420: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002f430: 6d20 3d20 736b 7274 2e69 6d61 6765 2e49  m = skrt.image.I
+0002f440: 6d61 6765 280a 2020 2020 2020 2020 2020  mage(.          
+0002f450: 2020 2020 2020 2020 2020 6e70 2e6f 6e65            np.one
+0002f460: 7328 7365 6c66 2e73 6861 7065 2920 2a20  s(self.shape) * 
+0002f470: 3165 342c 0a20 2020 2020 2020 2020 2020  1e4,.           
+0002f480: 2020 2020 2020 2020 2061 6666 696e 653d           affine=
+0002f490: 7365 6c66 2e61 6666 696e 652c 0a20 2020  self.affine,.   
+0002f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f4b0: 2074 6974 6c65 3d73 656c 662e 6e61 6d65   title=self.name
+0002f4c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f4d0: 2029 0a20 2020 2020 2020 2020 2020 2022   ).            "
+0002f4e0: 2222 0a0a 2020 2020 2020 2020 2020 2020  ""..            
+0002f4f0: 2320 4372 6561 7465 2076 6965 7765 720a  # Create viewer.
+0002f500: 2020 2020 2020 2020 2020 2020 6276 203d              bv =
+0002f510: 2042 6574 7465 7256 6965 7765 7228 696d   BetterViewer(im
+0002f520: 2c20 726f 6973 3d72 6f69 5f74 6d70 2c20  , rois=roi_tmp, 
+0002f530: 2a2a 6b77 6172 6773 290a 0a20 2020 2020  **kwargs)..     
+0002f540: 2020 2020 2020 2023 2041 646a 7573 7420         # Adjust 
+0002f550: 5549 0a20 2020 2020 2020 2020 2020 206e  UI.            n
+0002f560: 6f5f 7569 203d 206b 7761 7267 732e 6765  o_ui = kwargs.ge
+0002f570: 7428 226e 6f5f 7569 222c 2073 6b72 742e  t("no_ui", skrt.
+0002f580: 636f 7265 2e44 6566 6175 6c74 7328 292e  core.Defaults().
+0002f590: 6e6f 5f75 6929 0a20 2020 2020 2020 2020  no_ui).         
+0002f5a0: 2020 2069 6620 6e6f 7420 6e6f 5f75 693a     if not no_ui:
+0002f5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f5c0: 2062 762e 6d61 6b65 5f75 6928 6e6f 5f72   bv.make_ui(no_r
+0002f5d0: 6f69 3d54 7275 652c 206e 6f5f 696e 7465  oi=True, no_inte
+0002f5e0: 6e73 6974 793d 5472 7565 290a 2020 2020  nsity=True).    
+0002f5f0: 2020 2020 2020 2020 2020 2020 6276 2e73              bv.s
+0002f600: 686f 7728 290a 2020 2020 2020 2020 7265  how().        re
+0002f610: 7475 726e 2062 760a 0a20 2020 2064 6566  turn bv..    def
+0002f620: 205f 706c 6f74 5f6d 6173 6b28 0a20 2020   _plot_mask(.   
+0002f630: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0002f640: 2020 2076 6965 772c 0a20 2020 2020 2020     view,.       
+0002f650: 2069 6478 2c0a 2020 2020 2020 2020 6d61   idx,.        ma
+0002f660: 736b 5f6b 7761 7267 733d 4e6f 6e65 2c0a  sk_kwargs=None,.
+0002f670: 2020 2020 2020 2020 6f70 6163 6974 793d          opacity=
+0002f680: 4e6f 6e65 2c0a 2020 2020 2020 2020 696e  None,.        in
+0002f690: 636c 7564 655f 696d 6167 653d 4661 6c73  clude_image=Fals
+0002f6a0: 652c 0a20 2020 2020 2020 207a 6f6f 6d3d  e,.        zoom=
+0002f6b0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7a6f  None,.        zo
+0002f6c0: 6f6d 5f63 656e 7472 653d 4e6f 6e65 2c0a  om_centre=None,.
+0002f6d0: 2020 2020 2020 2020 636f 6c6f 723d 4e6f          color=No
+0002f6e0: 6e65 2c0a 2020 2020 2020 2020 666c 6174  ne,.        flat
+0002f6f0: 7465 6e3d 4661 6c73 652c 0a20 2020 2020  ten=False,.     
+0002f700: 2020 2073 686f 773d 5472 7565 2c0a 2020     show=True,.  
+0002f710: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
+0002f720: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+0002f730: 2222 506c 6f74 2074 6865 2052 4f49 2061  ""Plot the ROI a
+0002f740: 7320 6120 6d61 736b 2e22 2222 0a0a 2020  s a mask."""..  
+0002f750: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
+0002f760: 655f 6d61 736b 2829 0a20 2020 2020 2020  e_mask().       
+0002f770: 2069 6620 7365 6c66 2e65 6d70 7479 3a0a   if self.empty:.
+0002f780: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0002f790: 726e 0a20 2020 2020 2020 206d 6173 6b5f  rn.        mask_
+0002f7a0: 736c 6963 6520 3d20 7365 6c66 2e67 6574  slice = self.get
+0002f7b0: 5f73 6c69 6365 2876 6965 772c 2069 6478  _slice(view, idx
+0002f7c0: 3d69 6478 2c20 666c 6174 7465 6e3d 666c  =idx, flatten=fl
+0002f7d0: 6174 7465 6e29 0a0a 2020 2020 2020 2020  atten)..        
+0002f7e0: 2320 4d61 6b65 2063 6f6c 6f72 6d61 700a  # Make colormap.
+0002f7f0: 2020 2020 2020 2020 6e6f 726d 203d 206d          norm = m
+0002f800: 6174 706c 6f74 6c69 622e 636f 6c6f 7273  atplotlib.colors
+0002f810: 2e4e 6f72 6d61 6c69 7a65 2829 0a20 2020  .Normalize().   
+0002f820: 2020 2020 2063 6d61 7020 3d20 6d61 7470       cmap = matp
+0002f830: 6c6f 746c 6962 2e63 6d2e 6873 760a 2020  lotlib.cm.hsv.  
+0002f840: 2020 2020 2020 735f 636f 6c6f 7273 203d        s_colors =
+0002f850: 2063 6d61 7028 6e6f 726d 286d 6173 6b5f   cmap(norm(mask_
+0002f860: 736c 6963 6529 290a 2020 2020 2020 2020  slice)).        
+0002f870: 6966 2063 6f6c 6f72 2069 7320 4e6f 6e65  if color is None
+0002f880: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+0002f890: 6c6f 7220 3d20 7365 6c66 2e63 6f6c 6f72  lor = self.color
+0002f8a0: 0a20 2020 2020 2020 2073 5f63 6f6c 6f72  .        s_color
+0002f8b0: 735b 6d61 736b 5f73 6c69 6365 203e 2030  s[mask_slice > 0
+0002f8c0: 2c20 3a5d 203d 2063 6f6c 6f72 0a20 2020  , :] = color.   
+0002f8d0: 2020 2020 2073 5f63 6f6c 6f72 735b 6d61       s_colors[ma
+0002f8e0: 736b 5f73 6c69 6365 203d 3d20 302c 203a  sk_slice == 0, :
+0002f8f0: 5d20 3d20 2830 2c20 302c 2030 2c20 3029  ] = (0, 0, 0, 0)
+0002f900: 0a0a 2020 2020 2020 2020 2320 4765 7420  ..        # Get 
+0002f910: 706c 6f74 7469 6e67 2061 7267 756d 656e  plotting argumen
+0002f920: 7473 0a20 2020 2020 2020 2069 6620 6d61  ts.        if ma
+0002f930: 736b 5f6b 7761 7267 7320 6973 204e 6f6e  sk_kwargs is Non
+0002f940: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
+0002f950: 6173 6b5f 6b77 6172 6773 203d 207b 7d0a  ask_kwargs = {}.
+0002f960: 2020 2020 2020 2020 6d61 736b 5f6b 7761          mask_kwa
+0002f970: 7267 732e 7365 7464 6566 6175 6c74 2822  rgs.setdefault("
+0002f980: 616c 7068 6122 2c20 6f70 6163 6974 7929  alpha", opacity)
+0002f990: 0a20 2020 2020 2020 206d 6173 6b5f 6b77  .        mask_kw
+0002f9a0: 6172 6773 2e73 6574 6465 6661 756c 7428  args.setdefault(
+0002f9b0: 2269 6e74 6572 706f 6c61 7469 6f6e 222c  "interpolation",
+0002f9c0: 2022 6e6f 6e65 2229 0a0a 2020 2020 2020   "none")..      
+0002f9d0: 2020 2320 4d61 6b65 2070 6c6f 740a 2020    # Make plot.  
+0002f9e0: 2020 2020 2020 6966 2069 6e63 6c75 6465        if include
+0002f9f0: 5f69 6d61 6765 2061 6e64 2073 656c 662e  _image and self.
+0002fa00: 696d 6167 6520 6973 206e 6f74 204e 6f6e  image is not Non
+0002fa10: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+0002fa20: 6d5f 6d61 736b 203d 206b 7761 7267 732e  m_mask = kwargs.
+0002fa30: 6765 7428 226d 6173 6b22 2c20 4e6f 6e65  get("mask", None
+0002fa40: 290a 2020 2020 2020 2020 2020 2020 696d  ).            im
+0002fa50: 5f6d 6173 6b65 6420 3d20 6b77 6172 6773  _masked = kwargs
+0002fa60: 2e67 6574 2822 6d61 736b 6564 222c 2054  .get("masked", T
+0002fa70: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0002fa80: 2069 6d5f 696e 7665 7274 5f6d 6173 6b20   im_invert_mask 
+0002fa90: 3d20 6b77 6172 6773 2e67 6574 2822 696e  = kwargs.get("in
+0002faa0: 7665 7274 5f6d 6173 6b22 2c20 4661 6c73  vert_mask", Fals
+0002fab0: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
+0002fac0: 6d5f 6d61 736b 5f63 6f6c 6f72 203d 206b  m_mask_color = k
+0002fad0: 7761 7267 732e 6765 7428 226d 6173 6b5f  wargs.get("mask_
+0002fae0: 636f 6c6f 7222 2c20 2262 6c61 636b 2229  color", "black")
+0002faf0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0002fb00: 662e 696d 6167 652e 706c 6f74 2876 6965  f.image.plot(vie
+0002fb10: 772c 2069 6478 3d69 6478 2c20 6178 3d73  w, idx=idx, ax=s
+0002fb20: 656c 662e 6178 2c20 7368 6f77 3d46 616c  elf.ax, show=Fal
+0002fb30: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+0002fb40: 2020 2020 2020 2020 6d61 736b 3d69 6d5f          mask=im_
+0002fb50: 6d61 736b 2c20 6d61 736b 6564 3d69 6d5f  mask, masked=im_
+0002fb60: 6d61 736b 6564 2c20 696e 7665 7274 5f6d  masked, invert_m
+0002fb70: 6173 6b3d 696d 5f69 6e76 6572 745f 6d61  ask=im_invert_ma
+0002fb80: 736b 2c0a 2020 2020 2020 2020 2020 2020  sk,.            
+0002fb90: 2020 2020 2020 2020 6d61 736b 5f63 6f6c          mask_col
+0002fba0: 6f72 3d69 6d5f 6d61 736b 5f63 6f6c 6f72  or=im_mask_color
+0002fbb0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0002fbc0: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+0002fbd0: 7761 7267 732e 6765 7428 2274 6974 6c65  wargs.get("title
+0002fbe0: 222c 204e 6f6e 6529 2069 7320 4e6f 6e65  ", None) is None
+0002fbf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002fc00: 2020 6b77 6172 6773 5b22 7469 746c 6522    kwargs["title"
+0002fc10: 5d20 3d20 7365 6c66 2e6e 616d 650a 0a20  ] = self.name.. 
+0002fc20: 2020 2020 2020 2073 656c 662e 6178 2e69         self.ax.i
+0002fc30: 6d73 686f 7728 735f 636f 6c6f 7273 2c20  mshow(s_colors, 
+0002fc40: 6578 7465 6e74 3d73 656c 662e 6d61 736b  extent=self.mask
+0002fc50: 2e70 6c6f 745f 6578 7465 6e74 5b76 6965  .plot_extent[vie
+0002fc60: 775d 2c20 0a20 2020 2020 2020 2020 2020  w], .           
+0002fc70: 2020 2020 2020 2020 2020 2020 2a2a 6d61              **ma
+0002fc80: 736b 5f6b 7761 7267 7329 0a0a 2020 2020  sk_kwargs)..    
+0002fc90: 2020 2020 2320 4164 6a75 7374 2061 7865      # Adjust axe
+0002fca0: 730a 2020 2020 2020 2020 736b 7274 2e69  s.        skrt.i
+0002fcb0: 6d61 6765 2e49 6d61 6765 2e6c 6162 656c  mage.Image.label
+0002fcc0: 5f61 7828 7365 6c66 2c20 7669 6577 2c20  _ax(self, view, 
+0002fcd0: 6964 782c 202a 2a6b 7761 7267 7329 0a20  idx, **kwargs). 
+0002fce0: 2020 2020 2020 2073 6b72 742e 696d 6167         skrt.imag
+0002fcf0: 652e 496d 6167 652e 7a6f 6f6d 5f61 7828  e.Image.zoom_ax(
+0002fd00: 7365 6c66 2c20 7669 6577 2c20 7a6f 6f6d  self, view, zoom
+0002fd10: 2c20 7a6f 6f6d 5f63 656e 7472 6529 0a20  , zoom_centre). 
+0002fd20: 2020 2020 2020 2069 6620 7368 6f77 3a0a         if show:.
+0002fd30: 2020 2020 2020 2020 2020 2020 706c 742e              plt.
+0002fd40: 7368 6f77 2829 0a0a 2020 2020 6465 6620  show()..    def 
+0002fd50: 5f70 6c6f 745f 636f 6e74 6f75 7228 0a20  _plot_contour(. 
+0002fd60: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0002fd70: 2020 2020 2076 6965 772c 0a20 2020 2020       view,.     
+0002fd80: 2020 2069 6478 2c0a 2020 2020 2020 2020     idx,.        
+0002fd90: 636f 6e74 6f75 725f 6b77 6172 6773 3d4e  contour_kwargs=N
+0002fda0: 6f6e 652c 0a20 2020 2020 2020 206c 696e  one,.        lin
+0002fdb0: 6577 6964 7468 3d4e 6f6e 652c 0a20 2020  ewidth=None,.   
+0002fdc0: 2020 2020 2063 656e 7472 6f69 643d 4661       centroid=Fa
+0002fdd0: 6c73 652c 0a20 2020 2020 2020 2069 6e63  lse,.        inc
+0002fde0: 6c75 6465 5f69 6d61 6765 3d46 616c 7365  lude_image=False
+0002fdf0: 2c0a 2020 2020 2020 2020 7a6f 6f6d 3d4e  ,.        zoom=N
+0002fe00: 6f6e 652c 0a20 2020 2020 2020 207a 6f6f  one,.        zoo
+0002fe10: 6d5f 6365 6e74 7265 3d4e 6f6e 652c 0a20  m_centre=None,. 
+0002fe20: 2020 2020 2020 2063 6f6c 6f72 3d4e 6f6e         color=Non
+0002fe30: 652c 0a20 2020 2020 2020 2066 6c61 7474  e,.        flatt
+0002fe40: 656e 3d46 616c 7365 2c0a 2020 2020 2020  en=False,.      
+0002fe50: 2020 7368 6f77 3d54 7275 652c 0a20 2020    show=True,.   
+0002fe60: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
+0002fe70: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+0002fe80: 2250 6c6f 7420 7468 6520 524f 4920 6173  "Plot the ROI as
+0002fe90: 2061 2063 6f6e 746f 7572 2e22 2222 0a0a   a contour."""..
+0002fea0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+0002feb0: 6428 290a 2020 2020 2020 2020 6966 2028  d().        if (
+0002fec0: 6e6f 7420 7365 6c66 2e6f 6e5f 736c 6963  not self.on_slic
+0002fed0: 6528 7669 6577 2c20 6964 783d 6964 7829  e(view, idx=idx)
+0002fee0: 2061 6e64 206e 6f74 2066 6c61 7474 656e   and not flatten
+0002fef0: 2920 6f72 2073 656c 662e 656d 7074 793a  ) or self.empty:
+0002ff00: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0002ff10: 7572 6e0a 0a20 2020 2020 2020 2063 6f6e  urn..        con
+0002ff20: 746f 7572 5f6b 7761 7267 7320 3d20 7b7d  tour_kwargs = {}
+0002ff30: 2069 6620 636f 6e74 6f75 725f 6b77 6172   if contour_kwar
+0002ff40: 6773 2069 7320 4e6f 6e65 2065 6c73 6520  gs is None else 
+0002ff50: 636f 6e74 6f75 725f 6b77 6172 6773 0a20  contour_kwargs. 
+0002ff60: 2020 2020 2020 2063 6f6e 746f 7572 5f6b         contour_k
+0002ff70: 7761 7267 732e 7365 7464 6566 6175 6c74  wargs.setdefault
+0002ff80: 2822 636f 6c6f 7222 2c20 636f 6c6f 7229  ("color", color)
+0002ff90: 0a20 2020 2020 2020 2063 6f6e 746f 7572  .        contour
+0002ffa0: 5f6b 7761 7267 732e 7365 7464 6566 6175  _kwargs.setdefau
+0002ffb0: 6c74 2822 6c69 6e65 7769 6474 6822 2c20  lt("linewidth", 
+0002ffc0: 6c69 6e65 7769 6474 6829 0a0a 2020 2020  linewidth)..    
+0002ffd0: 2020 2020 2320 506c 6f74 2075 6e64 6572      # Plot under
+0002ffe0: 6c79 696e 6720 696d 6167 650a 2020 2020  lying image.    
+0002fff0: 2020 2020 6966 2069 6e63 6c75 6465 5f69      if include_i
+00030000: 6d61 6765 2061 6e64 2073 656c 662e 696d  mage and self.im
+00030010: 6167 6520 6973 206e 6f74 204e 6f6e 653a  age is not None:
+00030020: 0a20 2020 2020 2020 2020 2020 2069 6d5f  .            im_
+00030030: 6d61 736b 203d 206b 7761 7267 732e 6765  mask = kwargs.ge
+00030040: 7428 226d 6173 6b22 2c20 4e6f 6e65 290a  t("mask", None).
+00030050: 2020 2020 2020 2020 2020 2020 696d 5f6d              im_m
+00030060: 6173 6b65 6420 3d20 6b77 6172 6773 2e67  asked = kwargs.g
+00030070: 6574 2822 6d61 736b 6564 222c 2054 7275  et("masked", Tru
+00030080: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
+00030090: 6d5f 696e 7665 7274 5f6d 6173 6b20 3d20  m_invert_mask = 
+000300a0: 6b77 6172 6773 2e67 6574 2822 696e 7665  kwargs.get("inve
+000300b0: 7274 5f6d 6173 6b22 2c20 4661 6c73 6529  rt_mask", False)
+000300c0: 0a20 2020 2020 2020 2020 2020 2069 6d5f  .            im_
+000300d0: 6d61 736b 5f63 6f6c 6f72 203d 206b 7761  mask_color = kwa
+000300e0: 7267 732e 6765 7428 226d 6173 6b5f 636f  rgs.get("mask_co
+000300f0: 6c6f 7222 2c20 2262 6c61 636b 2229 0a20  lor", "black"). 
+00030100: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00030110: 696d 6167 652e 706c 6f74 2876 6965 772c  image.plot(view,
+00030120: 2069 6478 3d69 6478 2c20 6178 3d73 656c   idx=idx, ax=sel
+00030130: 662e 6178 2c20 7368 6f77 3d46 616c 7365  f.ax, show=False
+00030140: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00030150: 2020 2020 2020 6d61 736b 3d69 6d5f 6d61        mask=im_ma
+00030160: 736b 2c20 6d61 736b 6564 3d69 6d5f 6d61  sk, masked=im_ma
+00030170: 736b 6564 2c20 696e 7665 7274 5f6d 6173  sked, invert_mas
+00030180: 6b3d 696d 5f69 6e76 6572 745f 6d61 736b  k=im_invert_mask
+00030190: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000301a0: 2020 2020 2020 6d61 736b 5f63 6f6c 6f72        mask_color
+000301b0: 3d69 6d5f 6d61 736b 5f63 6f6c 6f72 290a  =im_mask_color).
+000301c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000301d0: 2020 2020 2020 2020 2020 6966 206b 7761            if kwa
+000301e0: 7267 732e 6765 7428 2274 6974 6c65 222c  rgs.get("title",
+000301f0: 204e 6f6e 6529 2069 7320 4e6f 6e65 3a0a   None) is None:.
+00030200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030210: 6b77 6172 6773 5b22 7469 746c 6522 5d20  kwargs["title"] 
+00030220: 3d20 7365 6c66 2e6e 616d 650a 0a20 2020  = self.name..   
+00030230: 2020 2020 2023 2047 6574 2063 6f6e 746f       # Get conto
+00030240: 7572 2070 6f69 6e74 730a 2020 2020 2020  ur points.      
+00030250: 2020 6966 2066 6c61 7474 656e 3a0a 2020    if flatten:.  
+00030260: 2020 2020 2020 2020 2020 6d61 736b 203d            mask =
+00030270: 2073 656c 662e 6765 745f 736c 6963 6528   self.get_slice(
+00030280: 7669 6577 2c20 6964 783d 6964 782c 2066  view, idx=idx, f
+00030290: 6c61 7474 656e 3d54 7275 6529 0a20 2020  latten=True).   
+000302a0: 2020 2020 2020 2020 2063 6f6e 746f 7572           contour
+000302b0: 7320 3d20 7365 6c66 2e6d 6173 6b5f 746f  s = self.mask_to
+000302c0: 5f63 6f6e 746f 7572 7328 6d61 736b 2c20  _contours(mask, 
+000302d0: 7669 6577 2c20 696e 7665 7274 3d54 7275  view, invert=Tru
+000302e0: 6529 0a20 2020 2020 2020 2065 6c73 653a  e).        else:
+000302f0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00030300: 746f 7572 7320 3d20 7365 6c66 2e67 6574  tours = self.get
+00030310: 5f63 6f6e 746f 7572 7328 7669 6577 2c20  _contours(view, 
+00030320: 6964 785f 6173 5f6b 6579 3d54 7275 6529  idx_as_key=True)
+00030330: 5b69 6478 5d0a 0a20 2020 2020 2020 2023  [idx]..        #
+00030340: 2050 6c6f 7420 636f 6e74 6f75 720a 2020   Plot contour.  
+00030350: 2020 2020 2020 666f 7220 706f 696e 7473        for points
+00030360: 2069 6e20 636f 6e74 6f75 7273 3a0a 2020   in contours:.  
+00030370: 2020 2020 2020 2020 2020 706f 696e 7473            points
+00030380: 5f78 203d 205b 705b 305d 2066 6f72 2070  _x = [p[0] for p
+00030390: 2069 6e20 706f 696e 7473 5d0a 2020 2020   in points].    
+000303a0: 2020 2020 2020 2020 706f 696e 7473 5f79          points_y
+000303b0: 203d 205b 705b 315d 2066 6f72 2070 2069   = [p[1] for p i
+000303c0: 6e20 706f 696e 7473 5d0a 2020 2020 2020  n points].      
+000303d0: 2020 2020 2020 706f 696e 7473 5f78 2e61        points_x.a
+000303e0: 7070 656e 6428 706f 696e 7473 5f78 5b30  ppend(points_x[0
+000303f0: 5d29 0a20 2020 2020 2020 2020 2020 2070  ]).            p
+00030400: 6f69 6e74 735f 792e 6170 7065 6e64 2870  oints_y.append(p
+00030410: 6f69 6e74 735f 795b 305d 290a 2020 2020  oints_y[0]).    
+00030420: 2020 2020 2020 2020 7365 6c66 2e61 782e          self.ax.
+00030430: 706c 6f74 2870 6f69 6e74 735f 782c 2070  plot(points_x, p
+00030440: 6f69 6e74 735f 792c 202a 2a63 6f6e 746f  oints_y, **conto
+00030450: 7572 5f6b 7761 7267 7329 0a0a 2020 2020  ur_kwargs)..    
+00030460: 2020 2020 2320 506c 6f74 2063 656e 7472      # Plot centr
+00030470: 6f69 6420 706f 696e 740a 2020 2020 2020  oid point.      
+00030480: 2020 6966 2063 656e 7472 6f69 643a 0a20    if centroid:. 
+00030490: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+000304a0: 7420 666c 6174 7465 6e3a 0a20 2020 2020  t flatten:.     
+000304b0: 2020 2020 2020 2020 2020 2063 656e 7472             centr
+000304c0: 6f69 645f 706f 696e 7473 203d 2073 656c  oid_points = sel
+000304d0: 662e 6765 745f 6365 6e74 726f 6964 280a  f.get_centroid(.
+000304e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000304f0: 2020 2020 7669 6577 2c20 7369 6e67 6c65      view, single
+00030500: 5f73 6c69 6365 3d54 7275 652c 2069 6478  _slice=True, idx
+00030510: 3d69 6478 290a 2020 2020 2020 2020 2020  =idx).          
+00030520: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00030530: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+00030540: 5f33 6420 3d20 7365 6c66 2e67 6574 5f63  _3d = self.get_c
+00030550: 656e 7472 6f69 6428 290a 2020 2020 2020  entroid().      
+00030560: 2020 2020 2020 2020 2020 785f 6178 2c20            x_ax, 
+00030570: 795f 6178 203d 2073 6b72 742e 696d 6167  y_ax = skrt.imag
+00030580: 652e 5f70 6c6f 745f 6178 6573 5b76 6965  e._plot_axes[vie
+00030590: 775d 0a20 2020 2020 2020 2020 2020 2020  w].             
+000305a0: 2020 2063 656e 7472 6f69 645f 706f 696e     centroid_poin
+000305b0: 7473 203d 205b 6365 6e74 726f 6964 5f33  ts = [centroid_3
+000305c0: 645b 785f 6178 5d2c 2063 656e 7472 6f69  d[x_ax], centroi
+000305d0: 645f 3364 5b79 5f61 785d 5d0a 2020 2020  d_3d[y_ax]].    
+000305e0: 2020 2020 2020 2020 7365 6c66 2e61 782e          self.ax.
+000305f0: 706c 6f74 280a 2020 2020 2020 2020 2020  plot(.          
+00030600: 2020 2020 2020 2a63 656e 7472 6f69 645f        *centroid_
+00030610: 706f 696e 7473 2c0a 2020 2020 2020 2020  points,.        
+00030620: 2020 2020 2020 2020 222b 222c 0a20 2020          "+",.   
+00030630: 2020 2020 2020 2020 2020 2020 202a 2a63               **c
+00030640: 6f6e 746f 7572 5f6b 7761 7267 732c 0a20  ontour_kwargs,. 
+00030650: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00030660: 2020 2020 2020 2320 4164 6a75 7374 2061        # Adjust a
+00030670: 7865 730a 2020 2020 2020 2020 7365 6c66  xes.        self
+00030680: 2e61 782e 7365 745f 6173 7065 6374 2822  .ax.set_aspect("
+00030690: 6571 7561 6c22 290a 2020 2020 2020 2020  equal").        
+000306a0: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
+000306b0: 2e6c 6162 656c 5f61 7828 7365 6c66 2c20  .label_ax(self, 
+000306c0: 7669 6577 2c20 6964 782c 202a 2a6b 7761  view, idx, **kwa
+000306d0: 7267 7329 0a20 2020 2020 2020 2073 6b72  rgs).        skr
+000306e0: 742e 696d 6167 652e 496d 6167 652e 7a6f  t.image.Image.zo
+000306f0: 6f6d 5f61 7828 7365 6c66 2c20 7669 6577  om_ax(self, view
+00030700: 2c20 7a6f 6f6d 2c20 7a6f 6f6d 5f63 656e  , zoom, zoom_cen
+00030710: 7472 6529 0a20 2020 2020 2020 2069 6620  tre).        if 
+00030720: 7368 6f77 3a0a 2020 2020 2020 2020 2020  show:.          
+00030730: 2020 706c 742e 7368 6f77 2829 0a0a 2020    plt.show()..  
+00030740: 2020 6465 6620 706c 6f74 5f63 6f6d 7061    def plot_compa
+00030750: 7269 736f 6e28 0a20 2020 2020 2020 2073  rison(.        s
+00030760: 656c 662c 200a 2020 2020 2020 2020 6f74  elf, .        ot
+00030770: 6865 722c 200a 2020 2020 2020 2020 7669  her, .        vi
+00030780: 6577 3d22 782d 7922 2c0a 2020 2020 2020  ew="x-y",.      
+00030790: 2020 736c 3d4e 6f6e 652c 0a20 2020 2020    sl=None,.     
+000307a0: 2020 2069 6478 3d4e 6f6e 652c 0a20 2020     idx=None,.   
+000307b0: 2020 2020 2070 6f73 3d4e 6f6e 652c 0a20       pos=None,. 
+000307c0: 2020 2020 2020 206d 6964 5f73 6c69 6365         mid_slice
+000307d0: 5f66 6f72 5f62 6f74 683d 4661 6c73 652c  _for_both=False,
+000307e0: 0a20 2020 2020 2020 206c 6567 656e 643d  .        legend=
+000307f0: 5472 7565 2c20 0a20 2020 2020 2020 2073  True, .        s
+00030800: 6176 655f 6173 3d4e 6f6e 652c 200a 2020  ave_as=None, .  
+00030810: 2020 2020 2020 6e61 6d65 733d 4e6f 6e65        names=None
+00030820: 2c20 0a20 2020 2020 2020 2073 686f 773d  , .        show=
+00030830: 5472 7565 2c20 0a20 2020 2020 2020 2069  True, .        i
+00030840: 6e63 6c75 6465 5f69 6d61 6765 3d46 616c  nclude_image=Fal
+00030850: 7365 2c0a 2020 2020 2020 2020 6c65 6765  se,.        lege
+00030860: 6e64 5f62 626f 785f 746f 5f61 6e63 686f  nd_bbox_to_ancho
+00030870: 723d 4e6f 6e65 2c0a 2020 2020 2020 2020  r=None,.        
+00030880: 6c65 6765 6e64 5f6c 6f63 3d22 6c6f 7765  legend_loc="lowe
+00030890: 7220 6c65 6674 222c 0a20 2020 2020 2020  r left",.       
+000308a0: 202a 2a6b 7761 7267 730a 2020 2020 293a   **kwargs.    ):
+000308b0: 0a20 2020 2020 2020 2022 2222 506c 6f74  .        """Plot
+000308c0: 2063 6f6d 7061 7269 736f 6e20 7769 7468   comparison with
+000308d0: 2061 6e6f 7468 6572 2052 4f49 2e20 4966   another ROI. If
+000308e0: 206e 6f20 736c 2f69 6478 2f70 6f73 2061   no sl/idx/pos a
+000308f0: 7265 2067 6976 656e 2c0a 2020 2020 2020  re given,.      
+00030900: 2020 7468 6520 6365 6e74 7261 6c20 736c    the central sl
+00030910: 6963 6520 6f66 2074 6869 7320 524f 4920  ice of this ROI 
+00030920: 7769 6c6c 2062 6520 706c 6f74 7465 642c  will be plotted,
+00030930: 2075 6e6c 6573 7320 0a20 2020 2020 2020   unless .       
+00030940: 206d 6964 5f73 6c69 6365 5f66 6f72 5f62   mid_slice_for_b
+00030950: 6f74 683d 5472 7565 2c20 696e 2077 6869  oth=True, in whi
+00030960: 6368 2063 6173 6520 7468 6520 6365 6e74  ch case the cent
+00030970: 7261 6c20 736c 6963 6520 6f66 2062 6f74  ral slice of bot
+00030980: 6820 524f 4973 0a20 2020 2020 2020 2077  h ROIs.        w
+00030990: 696c 6c20 6265 2070 6c6f 7474 6564 2028  ill be plotted (
+000309a0: 6576 656e 2074 686f 7567 6820 7468 6973  even though this
+000309b0: 206d 6179 206e 6f74 2063 6f72 7265 7370   may not corresp
+000309c0: 6f6e 6420 746f 2074 6865 2073 616d 6520  ond to the same 
+000309d0: 0a20 2020 2020 2020 2070 6f69 6e74 2069  .        point i
+000309e0: 6e20 7370 6163 6529 2e0a 0a20 2020 2020  n space)...     
+000309f0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+00030a00: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
+00030a10: 2020 2020 6f74 6865 7220 3a20 524f 490a      other : ROI.
+00030a20: 2020 2020 2020 2020 2020 2020 4f74 6865              Othe
+00030a30: 7220 524f 4920 7769 7468 2077 6869 6368  r ROI with which
+00030a40: 2074 6f20 706c 6f74 2063 6f6d 7061 7269   to plot compari
+00030a50: 736f 6e2e 0a0a 2020 2020 2020 2020 7669  son...        vi
+00030a60: 6577 203a 2073 7472 2c20 6465 6661 756c  ew : str, defaul
+00030a70: 743d 2278 2d79 220a 2020 2020 2020 2020  t="x-y".        
+00030a80: 2020 2020 4f72 6965 6e74 6174 696f 6e20      Orientation 
+00030a90: 696e 2077 6869 6368 2074 6f20 706c 6f74  in which to plot
+00030aa0: 2052 4f49 732e 200a 0a20 2020 2020 2020   ROIs. ..       
+00030ab0: 2073 6c20 3a20 696e 742c 2064 6566 6175   sl : int, defau
+00030ac0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00030ad0: 2020 2020 536c 6963 6520 6e75 6d62 6572      Slice number
+00030ae0: 2e20 4966 206e 6f6e 6520 6f66 203c 736c  . If none of <sl
+00030af0: 3e2c 203c 6964 783e 206f 7220 3c70 6f73  >, <idx> or <pos
+00030b00: 3e20 6172 6520 7375 7070 6c69 6564 2062  > are supplied b
+00030b10: 7574 0a20 2020 2020 2020 2020 2020 203c  ut.            <
+00030b20: 7369 6e67 6c65 5f73 6c69 6365 3e20 6973  single_slice> is
+00030b30: 2054 7275 652c 2074 6865 2063 656e 7472   True, the centr
+00030b40: 616c 2073 6c69 6365 206f 6620 7468 6520  al slice of the 
+00030b50: 524f 4920 7769 6c6c 2062 6520 7573 6564  ROI will be used
+00030b60: 2e0a 0a20 2020 2020 2020 2069 6478 203a  ...        idx :
+00030b70: 2069 6e74 2c20 6465 6661 756c 743d 4e6f   int, default=No
+00030b80: 6e65 0a20 2020 2020 2020 2020 2020 2041  ne.            A
+00030b90: 7272 6179 2069 6e64 6578 206f 6620 736c  rray index of sl
+00030ba0: 6963 652e 2049 6620 6e6f 6e65 206f 6620  ice. If none of 
+00030bb0: 3c73 6c3e 2c20 3c69 6478 3e20 6f72 203c  <sl>, <idx> or <
+00030bc0: 706f 733e 2061 7265 2073 7570 706c 6965  pos> are supplie
+00030bd0: 6420 6275 740a 2020 2020 2020 2020 2020  d but.          
+00030be0: 2020 3c73 696e 676c 655f 736c 6963 653e    <single_slice>
+00030bf0: 2069 7320 5472 7565 2c20 7468 6520 6365   is True, the ce
+00030c00: 6e74 7261 6c20 736c 6963 6520 6f66 2074  ntral slice of t
+00030c10: 6865 2052 4f49 2077 696c 6c20 6265 2075  he ROI will be u
+00030c20: 7365 642e 0a0a 2020 2020 2020 2020 706f  sed...        po
+00030c30: 7320 3a20 666c 6f61 742c 2064 6566 6175  s : float, defau
+00030c40: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00030c50: 2020 2020 536c 6963 6520 706f 7369 7469      Slice positi
+00030c60: 6f6e 2069 6e20 6d6d 2e20 4966 206e 6f6e  on in mm. If non
+00030c70: 6520 6f66 203c 736c 3e2c 203c 6964 783e  e of <sl>, <idx>
+00030c80: 206f 7220 3c70 6f73 3e20 6172 6520 7375   or <pos> are su
+00030c90: 7070 6c69 6564 2062 7574 0a20 2020 2020  pplied but.     
+00030ca0: 2020 2020 2020 203c 7369 6e67 6c65 5f73         <single_s
+00030cb0: 6c69 6365 3e20 6973 2054 7275 652c 2074  lice> is True, t
+00030cc0: 6865 2063 656e 7472 616c 2073 6c69 6365  he central slice
+00030cd0: 206f 6620 7468 6520 524f 4920 7769 6c6c   of the ROI will
+00030ce0: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
+00030cf0: 2020 206d 6964 5f73 6c69 6365 5f66 6f72     mid_slice_for
+00030d00: 5f62 6f74 6820 3a20 626f 6f6c 2c20 6465  _both : bool, de
+00030d10: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+00030d20: 2020 2020 2020 2020 4966 2054 7275 6520          If True 
+00030d30: 616e 6420 6e6f 2073 6c2f 6964 782f 706f  and no sl/idx/po
+00030d40: 7320 6172 6520 6769 7665 6e2c 2074 6865  s are given, the
+00030d50: 2063 656e 7472 616c 2073 6c69 6365 7320   central slices 
+00030d60: 6f66 2062 6f74 680a 2020 2020 2020 2020  of both.        
+00030d70: 2020 2020 524f 4973 2077 696c 6c20 6265      ROIs will be
+00030d80: 2070 6c6f 7474 6564 2c20 6576 656e 2069   plotted, even i
+00030d90: 6620 7468 6973 2064 6f65 7320 6e6f 7420  f this does not 
+00030da0: 636f 7272 6573 706f 6e64 2074 6f20 7468  correspond to th
+00030db0: 6520 7361 6d65 0a20 2020 2020 2020 2020  e same.         
+00030dc0: 2020 2070 6f69 6e74 2069 6e20 7370 6163     point in spac
+00030dd0: 653b 206f 7468 6572 7769 7365 2c20 7468  e; otherwise, th
+00030de0: 6520 706f 7369 7469 6f6e 206f 6620 7468  e position of th
+00030df0: 6520 6365 6e74 7261 6c20 736c 6963 6520  e central slice 
+00030e00: 6f66 0a20 2020 2020 2020 2020 2020 2074  of.            t
+00030e10: 6869 7320 524f 4920 7769 6c6c 2062 6520  his ROI will be 
+00030e20: 706c 6f74 7465 6420 666f 7220 626f 7468  plotted for both
+00030e30: 2e0a 0a20 2020 2020 2020 206c 6567 656e  ...        legen
+00030e40: 6420 3a20 626f 6f6c 2c20 6465 6661 756c  d : bool, defaul
+00030e50: 743d 5472 7565 0a20 2020 2020 2020 2020  t=True.         
+00030e60: 2020 2049 6620 5472 7565 2c20 6120 6c65     If True, a le
+00030e70: 6765 6e64 2077 696c 6c20 6265 2061 6464  gend will be add
+00030e80: 6564 2074 6f20 7468 6520 706c 6f74 2063  ed to the plot c
+00030e90: 6f6e 7461 696e 696e 6720 7468 6520 6e61  ontaining the na
+00030ea0: 6d65 7320 0a20 2020 2020 2020 2020 2020  mes .           
+00030eb0: 206f 6620 7468 6520 7477 6f20 524f 4973   of the two ROIs
+00030ec0: 2e0a 0a20 2020 2020 2020 2073 6176 655f  ...        save_
+00030ed0: 6173 203a 2073 7472 2c20 6465 6661 756c  as : str, defaul
+00030ee0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00030ef0: 2020 2050 6174 6820 746f 2061 2066 696c     Path to a fil
+00030f00: 6520 6174 2077 6869 6368 2074 6865 2070  e at which the p
+00030f10: 6c6f 7420 7769 6c6c 2062 6520 7361 7665  lot will be save
+00030f20: 642e 2049 6620 4e6f 6e65 2c20 7468 6520  d. If None, the 
+00030f30: 706c 6f74 0a20 2020 2020 2020 2020 2020  plot.           
+00030f40: 2077 696c 6c20 6e6f 7420 6265 2073 6176   will not be sav
+00030f50: 6564 2e0a 0a20 2020 2020 2020 206e 616d  ed...        nam
+00030f60: 6573 203a 206c 6973 742c 2064 6566 6175  es : list, defau
+00030f70: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00030f80: 2020 2020 4375 7374 6f6d 206e 616d 6573      Custom names
+00030f90: 2074 6f20 7573 6520 666f 7220 7468 6520   to use for the 
+00030fa0: 524f 4920 6c65 6765 6e64 2069 6e20 6f72  ROI legend in or
+00030fb0: 6465 7220 5b74 6869 7320 524f 492c 206f  der [this ROI, o
+00030fc0: 7468 6572 2052 4f49 5d2e 0a20 2020 2020  ther ROI]..     
+00030fd0: 2020 2020 2020 2049 6620 4e6f 6e65 2c20         If None, 
+00030fe0: 7468 6520 6e61 6d65 7320 696e 2073 656c  the names in sel
+00030ff0: 662e 6e61 6d65 2061 6e64 2072 6f69 2e6e  f.name and roi.n
+00031000: 616d 6520 7769 6c6c 2062 6520 7573 6564  ame will be used
+00031010: 2e0a 0a20 2020 2020 2020 2073 686f 7720  ...        show 
+00031020: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
+00031030: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00031040: 2049 6620 5472 7565 2c20 7468 6520 706c   If True, the pl
+00031050: 6f74 2077 696c 6c20 6265 2064 6973 706c  ot will be displ
+00031060: 6179 6564 2e0a 2020 2020 2020 2020 2222  ayed..        ""
+00031070: 220a 0a20 2020 2020 2020 2023 2045 6e73  "..        # Ens
+00031080: 7572 6520 524f 4973 2061 7265 2070 6c6f  ure ROIs are plo
+00031090: 7474 6564 2069 6e20 6469 6666 6572 656e  tted in differen
+000310a0: 7420 636f 6c6f 7572 730a 2020 2020 2020  t colours.      
+000310b0: 2020 6966 2073 656c 662e 636f 6c6f 7220    if self.color 
+000310c0: 3d3d 206f 7468 6572 2e63 6f6c 6f72 3a0a  == other.color:.
+000310d0: 2020 2020 2020 2020 2020 2020 726f 6932              roi2
+000310e0: 5f63 6f6c 6f72 203d 2052 4f49 4465 6661  _color = ROIDefa
+000310f0: 756c 7473 2829 2e67 6574 5f64 6566 6175  ults().get_defau
+00031100: 6c74 5f72 6f69 5f63 6f6c 6f72 2829 0a20  lt_roi_color(). 
+00031110: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00031120: 2020 2020 2020 2020 2072 6f69 325f 636f           roi2_co
+00031130: 6c6f 7220 3d20 6f74 6865 722e 636f 6c6f  lor = other.colo
+00031140: 720a 0a20 2020 2020 2020 2023 2047 6574  r..        # Get
+00031150: 2069 6e64 6578 2074 6f20 706c 6f74 0a20   index to plot. 
+00031160: 2020 2020 2020 207a 5f61 7820 3d20 736b         z_ax = sk
+00031170: 7274 2e69 6d61 6765 2e5f 736c 6963 655f  rt.image._slice_
+00031180: 6178 6573 5b76 6965 775d 0a0a 2020 2020  axes[view]..    
+00031190: 2020 2020 2320 436f 6d70 7574 6520 706f      # Compute po
+000311a0: 7369 7469 6f6e 2069 6e20 6d6d 2074 6f20  sition in mm to 
+000311b0: 706c 6f74 0a20 2020 2020 2020 2069 6620  plot.        if 
+000311c0: 736c 2069 7320 4e6f 6e65 2061 6e64 2070  sl is None and p
+000311d0: 6f73 2069 7320 4e6f 6e65 2061 6e64 2069  os is None and i
+000311e0: 6478 2069 7320 4e6f 6e65 3a0a 2020 2020  dx is None:.    
+000311f0: 2020 2020 2020 2020 706f 7331 203d 2073          pos1 = s
+00031200: 656c 662e 6964 785f 746f 5f70 6f73 2873  elf.idx_to_pos(s
+00031210: 656c 662e 6765 745f 6d69 645f 6964 7828  elf.get_mid_idx(
+00031220: 7669 6577 292c 207a 5f61 7829 0a20 2020  view), z_ax).   
+00031230: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00031240: 2020 2020 2020 2070 6f73 3120 3d20 7365         pos1 = se
+00031250: 6c66 2e69 6478 5f74 6f5f 706f 7328 0a20  lf.idx_to_pos(. 
+00031260: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00031270: 656c 662e 6765 745f 6964 7828 7669 6577  elf.get_idx(view
+00031280: 2c20 736c 3d73 6c2c 2069 6478 3d69 6478  , sl=sl, idx=idx
+00031290: 2c20 706f 733d 706f 7329 2c20 0a20 2020  , pos=pos), .   
+000312a0: 2020 2020 2020 2020 2020 2020 207a 5f61               z_a
+000312b0: 780a 2020 2020 2020 2020 2020 2020 290a  x.            ).
+000312c0: 0a20 2020 2020 2020 2023 2050 6c6f 7420  .        # Plot 
+000312d0: 7468 6520 7361 6d65 2070 6f73 6974 696f  the same positio
+000312e0: 6e20 666f 7220 6f74 6865 7220 524f 492c  n for other ROI,
+000312f0: 2075 6e6c 6573 7320 6d69 645f 736c 6963   unless mid_slic
+00031300: 655f 666f 725f 626f 7468 3d54 7275 650a  e_for_both=True.
+00031310: 2020 2020 2020 2020 6966 206e 6f74 206d          if not m
+00031320: 6964 5f73 6c69 6365 5f66 6f72 5f62 6f74  id_slice_for_bot
+00031330: 683a 0a20 2020 2020 2020 2020 2020 2070  h:.            p
+00031340: 6f73 3220 3d20 706f 7331 0a20 2020 2020  os2 = pos1.     
+00031350: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00031360: 2020 2020 2070 6f73 3220 3d20 6f74 6865       pos2 = othe
+00031370: 722e 6964 785f 746f 5f70 6f73 286f 7468  r.idx_to_pos(oth
+00031380: 6572 2e67 6574 5f6d 6964 5f69 6478 2876  er.get_mid_idx(v
+00031390: 6965 7729 2c20 7a5f 6178 290a 0a20 2020  iew), z_ax)..   
+000313a0: 2020 2020 2023 2050 6c6f 7420 7365 6c66       # Plot self
+000313b0: 0a20 2020 2020 2020 2073 656c 662e 706c  .        self.pl
+000313c0: 6f74 2873 686f 773d 4661 6c73 652c 2076  ot(show=False, v
+000313d0: 6965 773d 7669 6577 2c20 706f 733d 706f  iew=view, pos=po
+000313e0: 7331 2c20 696e 636c 7564 655f 696d 6167  s1, include_imag
+000313f0: 653d 696e 636c 7564 655f 696d 6167 652c  e=include_image,
+00031400: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00031410: 2020 2020 2a2a 6b77 6172 6773 290a 0a20      **kwargs).. 
+00031420: 2020 2020 2020 2023 2041 646a 7573 7420         # Adjust 
+00031430: 6b77 6172 6773 2066 6f72 2070 6c6f 7474  kwargs for plott
+00031440: 696e 6720 7365 636f 6e64 2052 4f49 0a20  ing second ROI. 
+00031450: 2020 2020 2020 206b 7761 7267 735b 2261         kwargs["a
+00031460: 7822 5d20 3d20 7365 6c66 2e61 780a 2020  x"] = self.ax.  
+00031470: 2020 2020 2020 6b77 6172 6773 5b22 636f        kwargs["co
+00031480: 6c6f 7222 5d20 3d20 726f 6932 5f63 6f6c  lor"] = roi2_col
+00031490: 6f72 0a20 2020 2020 2020 206f 7468 6572  or.        other
+000314a0: 2e70 6c6f 7428 7368 6f77 3d46 616c 7365  .plot(show=False
+000314b0: 2c20 7669 6577 3d76 6965 772c 2070 6f73  , view=view, pos
+000314c0: 3d70 6f73 322c 2069 6e63 6c75 6465 5f69  =pos2, include_i
+000314d0: 6d61 6765 3d46 616c 7365 2c20 0a20 2020  mage=False, .   
+000314e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000314f0: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+00031500: 2020 7365 6c66 2e61 782e 7365 745f 7469    self.ax.set_ti
+00031510: 746c 6528 7365 6c66 2e67 6574 5f63 6f6d  tle(self.get_com
+00031520: 7061 7269 736f 6e5f 6e61 6d65 286f 7468  parison_name(oth
+00031530: 6572 2929 0a0a 2020 2020 2020 2020 2320  er))..        # 
+00031540: 4372 6561 7465 206c 6567 656e 640a 2020  Create legend.  
+00031550: 2020 2020 2020 6966 206c 6567 656e 643a        if legend:
+00031560: 0a20 2020 2020 2020 2020 2020 2070 6c6f  .            plo
+00031570: 745f 7479 7065 203d 206b 7761 7267 732e  t_type = kwargs.
+00031580: 6765 7428 2270 6c6f 745f 7479 7065 222c  get("plot_type",
+00031590: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
+000315a0: 2020 2069 6620 706c 6f74 5f74 7970 6520     if plot_type 
+000315b0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+000315c0: 2020 2020 2020 2020 2070 6c6f 745f 7479           plot_ty
+000315d0: 7065 203d 206b 7761 7267 732e 6765 7428  pe = kwargs.get(
+000315e0: 2272 6f69 5f70 6c6f 745f 7479 7065 222c  "roi_plot_type",
+000315f0: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
+00031600: 2020 206c 696e 6577 6964 7468 203d 206b     linewidth = k
+00031610: 7761 7267 732e 6765 7428 226c 696e 6577  wargs.get("linew
+00031620: 6964 7468 222c 204e 6f6e 6529 0a20 2020  idth", None).   
+00031630: 2020 2020 2020 2020 206f 7061 6369 7479           opacity
+00031640: 203d 206b 7761 7267 732e 6765 7428 226f   = kwargs.get("o
+00031650: 7061 6369 7479 222c 204e 6f6e 6529 0a20  pacity", None). 
+00031660: 2020 2020 2020 2020 2020 2069 6620 6e61             if na
+00031670: 6d65 733a 0a20 2020 2020 2020 2020 2020  mes:.           
+00031680: 2020 2020 2072 6f69 315f 6e61 6d65 203d       roi1_name =
+00031690: 206e 616d 6573 5b30 5d0a 2020 2020 2020   names[0].      
+000316a0: 2020 2020 2020 2020 2020 726f 6932 5f6e            roi2_n
+000316b0: 616d 6520 3d20 6e61 6d65 735b 315d 0a20  ame = names[1]. 
+000316c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000316d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000316e0: 2072 6f69 315f 6e61 6d65 203d 2073 656c   roi1_name = sel
+000316f0: 662e 6e61 6d65 0a20 2020 2020 2020 2020  f.name.         
+00031700: 2020 2020 2020 2072 6f69 325f 6e61 6d65         roi2_name
+00031710: 203d 206f 7468 6572 2e6e 616d 650a 2020   = other.name.  
+00031720: 2020 2020 2020 2020 2020 6861 6e64 6c65            handle
+00031730: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
+00031740: 2020 2020 2020 7365 6c66 2e67 6574 5f70        self.get_p
+00031750: 6174 6368 280a 2020 2020 2020 2020 2020  atch(.          
+00031760: 2020 2020 2020 2020 2020 706c 6f74 5f74            plot_t
+00031770: 7970 652c 2073 656c 662e 636f 6c6f 722c  ype, self.color,
+00031780: 206f 7061 6369 7479 2c20 6c69 6e65 7769   opacity, linewi
+00031790: 6474 682c 2072 6f69 315f 6e61 6d65 292c  dth, roi1_name),
+000317a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000317b0: 2073 656c 662e 6765 745f 7061 7463 6828   self.get_patch(
+000317c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000317d0: 2020 2020 2070 6c6f 745f 7479 7065 2c20       plot_type, 
+000317e0: 726f 6932 5f63 6f6c 6f72 2c20 6f70 6163  roi2_color, opac
+000317f0: 6974 792c 206c 696e 6577 6964 7468 2c20  ity, linewidth, 
+00031800: 726f 6932 5f6e 616d 6529 2c0a 2020 2020  roi2_name),.    
+00031810: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+00031820: 2020 2020 2020 7365 6c66 2e61 782e 6c65        self.ax.le
+00031830: 6765 6e64 280a 2020 2020 2020 2020 2020  gend(.          
+00031840: 2020 2020 2020 6861 6e64 6c65 733d 6861        handles=ha
+00031850: 6e64 6c65 732c 2066 7261 6d65 616c 7068  ndles, framealph
+00031860: 613d 312c 2066 6163 6563 6f6c 6f72 3d22  a=1, facecolor="
+00031870: 7768 6974 6522 2c20 0a20 2020 2020 2020  white", .       
+00031880: 2020 2020 2020 2020 2062 626f 785f 746f           bbox_to
+00031890: 5f61 6e63 686f 723d 6c65 6765 6e64 5f62  _anchor=legend_b
+000318a0: 626f 785f 746f 5f61 6e63 686f 722c 206c  box_to_anchor, l
+000318b0: 6f63 3d6c 6567 656e 645f 6c6f 630a 2020  oc=legend_loc.  
+000318c0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+000318d0: 2020 2020 2023 2053 686f 772f 7361 7665       # Show/save
+000318e0: 0a20 2020 2020 2020 2069 6620 7368 6f77  .        if show
+000318f0: 3a0a 2020 2020 2020 2020 2020 2020 706c  :.            pl
+00031900: 742e 7368 6f77 2829 0a20 2020 2020 2020  t.show().       
+00031910: 2069 6620 7361 7665 5f61 733a 0a20 2020   if save_as:.   
+00031920: 2020 2020 2020 2020 2070 6c74 2e74 6967           plt.tig
+00031930: 6874 5f6c 6179 6f75 7428 290a 2020 2020  ht_layout().    
+00031940: 2020 2020 2020 2020 7365 6c66 2e66 6967          self.fig
+00031950: 2e73 6176 6566 6967 2873 6176 655f 6173  .savefig(save_as
+00031960: 290a 0a20 2020 2064 6566 2067 6574 5f61  )..    def get_a
+00031970: 7370 6563 745f 7261 7469 6f28 0a20 2020  spect_ratio(.   
+00031980: 2020 2020 2073 656c 662c 2076 6965 772c       self, view,
+00031990: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
+000319a0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+000319b0: 2222 2247 6574 2061 7370 6563 7420 7261  """Get aspect ra
+000319c0: 7469 6f20 666f 7220 7468 6973 2073 7472  tio for this str
+000319d0: 7563 7475 7265 2069 6e20 6120 6769 7665  ucture in a give
+000319e0: 6e20 6f72 6965 6e74 6174 696f 6e2e 2222  n orientation.""
+000319f0: 220a 0a20 2020 2020 2020 2078 5f61 782c  "..        x_ax,
+00031a00: 2079 5f61 7820 3d20 736b 7274 2e69 6d61   y_ax = skrt.ima
+00031a10: 6765 2e5f 706c 6f74 5f61 7865 735b 7669  ge._plot_axes[vi
+00031a20: 6577 5d0a 2020 2020 2020 2020 7265 7475  ew].        retu
+00031a30: 726e 2073 656c 662e 6765 745f 6c65 6e67  rn self.get_leng
+00031a40: 7468 2861 783d 736b 7274 2e69 6d61 6765  th(ax=skrt.image
+00031a50: 2e5f 6178 6573 5b78 5f61 785d 2920 5c0a  ._axes[x_ax]) \.
+00031a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031a70: 2f20 7365 6c66 2e67 6574 5f6c 656e 6774  / self.get_lengt
+00031a80: 6828 6178 3d73 6b72 742e 696d 6167 652e  h(ax=skrt.image.
+00031a90: 5f61 7865 735b 795f 6178 5d29 0a0a 2020  _axes[y_ax])..  
+00031aa0: 2020 6465 6620 7365 745f 6178 2873 656c    def set_ax(sel
+00031ab0: 662c 2070 6c6f 745f 7479 7065 2c20 696e  f, plot_type, in
+00031ac0: 636c 7564 655f 696d 6167 652c 202a 6172  clude_image, *ar
+00031ad0: 6773 2c20 2a2a 6b77 6172 6773 293a 0a20  gs, **kwargs):. 
+00031ae0: 2020 2020 2020 2022 2222 5365 7420 7570         """Set up
+00031af0: 2061 7865 732e 2222 220a 0a20 2020 2020   axes."""..     
+00031b00: 2020 2069 6620 706c 6f74 5f74 7970 6520     if plot_type 
+00031b10: 696e 205b 2263 6f6e 746f 7572 222c 2022  in ["contour", "
+00031b20: 6365 6e74 726f 6964 225d 2061 6e64 206e  centroid"] and n
+00031b30: 6f74 2069 6e63 6c75 6465 5f69 6d61 6765  ot include_image
+00031b40: 3a0a 2020 2020 2020 2020 2020 2020 6173  :.            as
+00031b50: 7065 6374 5f67 6574 7465 7220 3d20 7365  pect_getter = se
+00031b60: 6c66 2e67 6574 5f61 7370 6563 745f 7261  lf.get_aspect_ra
+00031b70: 7469 6f0a 2020 2020 2020 2020 656c 7365  tio.        else
+00031b80: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00031b90: 2073 656c 662e 696d 6167 6520 6973 206e   self.image is n
+00031ba0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00031bb0: 2020 2020 2020 2020 2061 7370 6563 745f           aspect_
+00031bc0: 6765 7474 6572 203d 2073 656c 662e 696d  getter = self.im
+00031bd0: 6167 652e 6765 745f 706c 6f74 5f61 7370  age.get_plot_asp
+00031be0: 6563 745f 7261 7469 6f0a 2020 2020 2020  ect_ratio.      
+00031bf0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00031c00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00031c10: 2e63 7265 6174 655f 6d61 736b 2829 0a20  .create_mask(). 
+00031c20: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00031c30: 7370 6563 745f 6765 7474 6572 203d 2073  spect_getter = s
+00031c40: 656c 662e 6d61 736b 2e67 6574 5f70 6c6f  elf.mask.get_plo
+00031c50: 745f 6173 7065 6374 5f72 6174 696f 0a20  t_aspect_ratio. 
+00031c60: 2020 2020 2020 2073 6b72 742e 696d 6167         skrt.imag
+00031c70: 652e 7365 745f 6178 2873 656c 662c 202a  e.set_ax(self, *
+00031c80: 6172 6773 2c20 6173 7065 6374 5f67 6574  args, aspect_get
+00031c90: 7465 723d 6173 7065 6374 5f67 6574 7465  ter=aspect_gette
+00031ca0: 722c 202a 2a6b 7761 7267 7329 0a0a 2020  r, **kwargs)..  
+00031cb0: 2020 6465 6620 6765 745f 7a6f 6f6d 5f63    def get_zoom_c
+00031cc0: 656e 7472 6528 7365 6c66 2c20 7669 6577  entre(self, view
+00031cd0: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+00031ce0: 7420 636f 6f72 6469 6e61 7465 7320 746f  t coordinates to
+00031cf0: 207a 6f6f 6d20 696e 206f 6e20 7468 6973   zoom in on this
+00031d00: 2052 4f49 2e22 2222 0a0a 2020 2020 2020   ROI."""..      
+00031d10: 2020 7a6f 6f6d 5f63 656e 7472 6520 3d20    zoom_centre = 
+00031d20: 5b4e 6f6e 652c 204e 6f6e 652c 204e 6f6e  [None, None, Non
+00031d30: 655d 0a20 2020 2020 2020 2078 5f61 782c  e].        x_ax,
+00031d40: 2079 5f61 7820 3d20 736b 7274 2e69 6d61   y_ax = skrt.ima
+00031d50: 6765 2e5f 706c 6f74 5f61 7865 735b 7669  ge._plot_axes[vi
+00031d60: 6577 5d0a 2020 2020 2020 2020 782c 2079  ew].        x, y
+00031d70: 203d 2073 656c 662e 6765 745f 6365 6e74   = self.get_cent
+00031d80: 7265 2876 6965 773d 7669 6577 2c20 7369  re(view=view, si
+00031d90: 6e67 6c65 5f73 6c69 6365 3d54 7275 6529  ngle_slice=True)
+00031da0: 0a20 2020 2020 2020 207a 6f6f 6d5f 6365  .        zoom_ce
+00031db0: 6e74 7265 5b78 5f61 785d 203d 2078 0a20  ntre[x_ax] = x. 
+00031dc0: 2020 2020 2020 207a 6f6f 6d5f 6365 6e74         zoom_cent
+00031dd0: 7265 5b79 5f61 785d 203d 2079 0a20 2020  re[y_ax] = y.   
+00031de0: 2020 2020 2072 6574 7572 6e20 7a6f 6f6d       return zoom
+00031df0: 5f63 656e 7472 650a 0a20 2020 2064 6566  _centre..    def
+00031e00: 2077 7269 7465 2873 656c 662c 206f 7574   write(self, out
+00031e10: 6e61 6d65 3d4e 6f6e 652c 206f 7574 6469  name=None, outdi
+00031e20: 723d 222e 222c 2065 7874 3d4e 6f6e 652c  r=".", ext=None,
+00031e30: 206f 7665 7277 7269 7465 3d46 616c 7365   overwrite=False
+00031e40: 2c0a 2020 2020 2020 2020 2020 2020 6865  ,.            he
+00031e50: 6164 6572 5f73 6f75 7263 653d 4e6f 6e65  ader_source=None
+00031e60: 2c20 7061 7469 656e 745f 6964 3d4e 6f6e  , patient_id=Non
+00031e70: 652c 2072 6f6f 745f 7569 643d 4e6f 6e65  e, root_uid=None
+00031e80: 2c0a 2020 2020 2020 2020 2020 2020 7665  ,.            ve
+00031e90: 7262 6f73 653d 5472 7565 2c20 6865 6164  rbose=True, head
+00031ea0: 6572 5f65 7874 7261 733d 7b7d 2c20 6b65  er_extras={}, ke
+00031eb0: 6570 5f73 6f75 7263 655f 726f 6973 3d54  ep_source_rois=T
+00031ec0: 7275 652c 202a 2a6b 7761 7267 7329 3a0a  rue, **kwargs):.
+00031ed0: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
+00031ee0: 6164 2829 0a0a 2020 2020 2020 2020 2320  ad()..        # 
+00031ef0: 4765 6e65 7261 7465 206f 7574 7075 7420  Generate output 
+00031f00: 6e61 6d65 2069 6620 6e6f 7420 6769 7665  name if not give
+00031f10: 6e0a 2020 2020 2020 2020 706f 7373 6962  n.        possib
+00031f20: 6c65 5f65 7874 203d 205b 222e 6463 6d22  le_ext = [".dcm"
+00031f30: 2c20 222e 6e69 692e 677a 222c 2022 2e6e  , ".nii.gz", ".n
+00031f40: 6969 222c 2022 2e6e 7079 222c 2022 2e74  ii", ".npy", ".t
+00031f50: 7874 225d 0a20 2020 2020 2020 2069 6620  xt"].        if 
+00031f60: 6578 7420 6973 206e 6f74 204e 6f6e 6520  ext is not None 
+00031f70: 616e 6420 6e6f 7420 6578 742e 7374 6172  and not ext.star
+00031f80: 7473 7769 7468 2822 2e22 293a 0a20 2020  tswith("."):.   
+00031f90: 2020 2020 2020 2020 2065 7874 203d 2066           ext = f
+00031fa0: 222e 7b65 7874 7d22 0a20 2020 2020 2020  ".{ext}".       
+00031fb0: 2069 6620 6f75 746e 616d 6520 6973 204e   if outname is N
+00031fc0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00031fd0: 2069 6620 6578 7420 6973 204e 6f6e 653a   if ext is None:
+00031fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031ff0: 2065 7874 203d 2022 2e6e 6969 220a 2020   ext = ".nii".  
+00032000: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00032010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032020: 6966 2065 7874 206e 6f74 2069 6e20 706f  if ext not in po
+00032030: 7373 6962 6c65 5f65 7874 3a0a 2020 2020  ssible_ext:.    
+00032040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032050: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
+00032060: 6f72 2866 2255 6e72 6563 6f67 6e69 7365  or(f"Unrecognise
+00032070: 6420 6669 6c65 2065 7874 656e 7369 6f6e  d file extension
+00032080: 3a20 7b65 7874 7d22 290a 2020 2020 2020  : {ext}").      
+00032090: 2020 2020 2020 6966 206e 6f74 2065 7874        if not ext
+000320a0: 2e73 7461 7274 7377 6974 6828 222e 2229  .startswith(".")
+000320b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000320c0: 2020 6578 7420 3d20 6622 2e7b 6578 747d    ext = f".{ext}
+000320d0: 220a 2020 2020 2020 2020 2020 2020 6f75  ".            ou
+000320e0: 746e 616d 6520 3d20 6622 7b6f 7574 6469  tname = f"{outdi
+000320f0: 727d 2f7b 7365 6c66 2e6e 616d 657d 7b65  r}/{self.name}{e
+00032100: 7874 7d22 0a0a 2020 2020 2020 2020 2320  xt}"..        # 
+00032110: 4f74 6865 7277 6973 652c 2069 6e66 6572  Otherwise, infer
+00032120: 2065 7874 656e 7369 6f6e 2066 726f 6d20   extension from 
+00032130: 6669 6c65 6e61 6d65 0a20 2020 2020 2020  filename.       
+00032140: 2065 6c73 653a 0a0a 2020 2020 2020 2020   else:..        
+00032150: 2020 2020 2320 4669 6e64 2061 6e79 206f      # Find any o
+00032160: 6620 7468 6520 7661 6c69 6420 6669 6c65  f the valid file
+00032170: 2065 7874 656e 7369 6f6e 730a 2020 2020   extensions.    
+00032180: 2020 2020 2020 2020 666f 7220 706f 7320          for pos 
+00032190: 696e 2070 6f73 7369 626c 655f 6578 743a  in possible_ext:
+000321a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000321b0: 2069 6620 6f75 746e 616d 652e 656e 6473   if outname.ends
+000321c0: 7769 7468 2870 6f73 293a 0a20 2020 2020  with(pos):.     
+000321d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000321e0: 7874 203d 2070 6f73 0a20 2020 2020 2020  xt = pos.       
+000321f0: 2020 2020 2069 6620 6578 7420 6e6f 7420       if ext not 
+00032200: 696e 2070 6f73 7369 626c 655f 6578 743a  in possible_ext:
+00032210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00032220: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
+00032230: 726f 7228 6622 556e 7265 636f 676e 6973  ror(f"Unrecognis
+00032240: 6564 206f 7574 7075 7420 6669 6c65 2074  ed output file t
+00032250: 7970 653a 207b 6f75 746e 616d 657d 2229  ype: {outname}")
+00032260: 0a0a 2020 2020 2020 2020 2020 2020 6f75  ..            ou
+00032270: 746e 616d 6520 3d20 6f73 2e70 6174 682e  tname = os.path.
+00032280: 6a6f 696e 286f 7574 6469 722c 206f 7574  join(outdir, out
+00032290: 6e61 6d65 290a 0a20 2020 2020 2020 2023  name)..        #
+000322a0: 2057 7269 7465 2070 6f69 6e74 7320 746f   Write points to
+000322b0: 2074 6578 7420 6669 6c65 2c20 696e 2066   text file, in f
+000322c0: 6f72 6d61 7420 7468 6174 2063 616e 2062  ormat that can b
+000322d0: 6520 7265 6164 2062 7920 7472 616e 7366  e read by transf
+000322e0: 6f72 6d69 780a 2020 2020 2020 2020 6966  ormix.        if
+000322f0: 2065 7874 203d 3d20 222e 7478 7422 3a0a   ext == ".txt":.
+00032300: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00032310: 2e67 6574 5f63 6f6e 746f 7572 7328 290a  .get_contours().
+00032320: 0a20 2020 2020 2020 2020 2020 2070 6f69  .            poi
+00032330: 6e74 7320 3d20 5b5d 0a20 2020 2020 2020  nts = [].       
+00032340: 2020 2020 2066 6f72 207a 2c20 636f 6e74       for z, cont
+00032350: 6f75 7273 2069 6e20 7365 6c66 2e63 6f6e  ours in self.con
+00032360: 746f 7572 735b 2278 2d79 225d 2e69 7465  tours["x-y"].ite
+00032370: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+00032380: 2020 2020 2020 666f 7220 6964 782c 2063        for idx, c
+00032390: 6f6e 746f 7572 2069 6e20 656e 756d 6572  ontour in enumer
+000323a0: 6174 6528 636f 6e74 6f75 7273 293a 0a20  ate(contours):. 
+000323b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000323c0: 2020 2066 6f72 2070 6f69 6e74 2069 6e20     for point in 
+000323d0: 636f 6e74 6f75 723a 0a20 2020 2020 2020  contour:.       
+000323e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000323f0: 2023 2041 6464 2074 6872 6565 2064 6967   # Add three dig
+00032400: 6974 7320 746f 2073 746f 7265 2074 6865  its to store the
+00032410: 2063 6f6e 746f 7572 2069 6e64 6578 2c0a   contour index,.
+00032420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032430: 2020 2020 2020 2020 2320 7768 6963 6820          # which 
+00032440: 6973 2075 6e6c 696b 656c 7920 746f 206e  is unlikely to n
+00032450: 6565 6420 6d6f 7265 2074 6861 6e20 6120  eed more than a 
+00032460: 7369 6e67 6c65 2064 6967 6974 2e0a 2020  single digit..  
+00032470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032480: 2020 2020 2020 2320 5468 6973 2068 6173        # This has
+00032490: 206e 6567 6c69 6769 626c 6520 6566 6665   negligible effe
+000324a0: 6374 206f 6e20 7072 6563 6973 696f 6e2c  ct on precision,
+000324b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000324c0: 2020 2020 2020 2020 2023 2061 6e64 2061           # and a
+000324d0: 6c6c 6f77 7320 636f 6e74 6f75 722d 706f  llows contour-po
+000324e0: 696e 7420 6173 736f 6369 6174 696f 6e73  int associations
+000324f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00032500: 2020 2020 2020 2020 2023 2074 6f20 6265           # to be
+00032510: 2069 6465 6e74 6966 6965 6420 696e 2054   identified in T
+00032520: 7261 6e73 666f 726d 6978 206f 7574 7075  ransformix outpu
+00032530: 742e 0a20 2020 2020 2020 2020 2020 2020  t..             
+00032540: 2020 2020 2020 2020 2020 207a 5f6f 7574             z_out
+00032550: 203d 2066 227b 7a3a 2e33 667d 7b69 6478   = f"{z:.3f}{idx
+00032560: 3a30 337d 220a 2020 2020 2020 2020 2020  :03}".          
+00032570: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00032580: 696e 7473 2e61 7070 656e 6428 6622 7b70  ints.append(f"{p
+00032590: 6f69 6e74 5b30 5d3a 2e33 667d 207b 706f  oint[0]:.3f} {po
+000325a0: 696e 745b 315d 3a2e 3366 7d20 7b7a 5f6f  int[1]:.3f} {z_o
+000325b0: 7574 7d22 290a 0a20 2020 2020 2020 2020  ut}")..         
+000325c0: 2020 2077 6974 6820 6f70 656e 286f 7574     with open(out
+000325d0: 6e61 6d65 2c20 2277 2229 2061 7320 6669  name, "w") as fi
+000325e0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+000325f0: 2020 2020 6669 6c65 2e77 7269 7465 2822      file.write("
+00032600: 706f 696e 745c 6e22 290a 2020 2020 2020  point\n").      
+00032610: 2020 2020 2020 2020 2020 6669 6c65 2e77            file.w
+00032620: 7269 7465 2866 227b 6c65 6e28 706f 696e  rite(f"{len(poin
+00032630: 7473 297d 5c6e 2229 0a20 2020 2020 2020  ts)}\n").       
+00032640: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
+00032650: 6974 6528 225c 6e22 2e6a 6f69 6e28 706f  ite("\n".join(po
+00032660: 696e 7473 2929 0a0a 2020 2020 2020 2020  ints))..        
+00032670: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+00032680: 2020 2020 2320 5772 6974 6520 6172 7261      # Write arra
+00032690: 7920 746f 206e 6966 7469 206f 7220 6e70  y to nifti or np
+000326a0: 790a 2020 2020 2020 2020 656c 6966 2065  y.        elif e
+000326b0: 7874 2021 3d20 222e 6463 6d22 3a0a 2020  xt != ".dcm":.  
+000326c0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+000326d0: 7265 6174 655f 6d61 736b 2829 0a20 2020  reate_mask().   
+000326e0: 2020 2020 2020 2020 2073 656c 662e 6d61           self.ma
+000326f0: 736b 2e77 7269 7465 286f 7574 6e61 6d65  sk.write(outname
+00032700: 2c20 7665 7262 6f73 653d 7665 7262 6f73  , verbose=verbos
+00032710: 652c 202a 2a6b 7761 7267 7329 0a20 2020  e, **kwargs).   
+00032720: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00032730: 2020 2020 2020 2069 6620 6865 6164 6572         if header
+00032740: 5f73 6f75 7263 6520 616e 6420 6b65 6570  _source and keep
+00032750: 5f73 6f75 7263 655f 726f 6973 3a0a 2020  _source_rois:.  
+00032760: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00032770: 7275 6374 7572 655f 7365 7420 3d20 5374  ructure_set = St
+00032780: 7275 6374 7572 6553 6574 2868 6561 6465  ructureSet(heade
+00032790: 725f 736f 7572 6365 290a 2020 2020 2020  r_source).      
+000327a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000327b0: 2020 2020 2020 2020 2020 2020 7374 7275              stru
+000327c0: 6374 7572 655f 7365 7420 3d20 5374 7275  cture_set = Stru
+000327d0: 6374 7572 6553 6574 2829 0a20 2020 2020  ctureSet().     
+000327e0: 2020 2020 2020 2073 7472 7563 7475 7265         structure
+000327f0: 5f73 6574 2e61 6464 5f72 6f69 2873 656c  _set.add_roi(sel
+00032800: 6629 0a20 2020 2020 2020 2020 2020 2073  f).            s
+00032810: 7472 7563 7475 7265 5f73 6574 2e77 7269  tructure_set.wri
+00032820: 7465 286f 7574 6469 723d 6f75 7464 6972  te(outdir=outdir
+00032830: 2c20 6578 743d 6578 742c 206f 7665 7277  , ext=ext, overw
+00032840: 7269 7465 3d6f 7665 7277 7269 7465 2c0a  rite=overwrite,.
+00032850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032860: 2020 2020 6865 6164 6572 5f73 6f75 7263      header_sourc
+00032870: 653d 6865 6164 6572 5f73 6f75 7263 652c  e=header_source,
+00032880: 2070 6174 6965 6e74 5f69 643d 7061 7469   patient_id=pati
+00032890: 656e 745f 6964 2c0a 2020 2020 2020 2020  ent_id,.        
+000328a0: 2020 2020 2020 2020 2020 2020 726f 6f74              root
+000328b0: 5f75 6964 3d72 6f6f 745f 7569 642c 2076  _uid=root_uid, v
+000328c0: 6572 626f 7365 3d76 6572 626f 7365 2c0a  erbose=verbose,.
+000328d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000328e0: 2020 2020 6865 6164 6572 5f65 7874 7261      header_extra
+000328f0: 733d 6865 6164 6572 5f65 7874 7261 7329  s=header_extras)
+00032900: 0a0a 2020 2020 6465 6620 7472 616e 7366  ..    def transf
+00032910: 6f72 6d28 7365 6c66 2c20 7363 616c 653d  orm(self, scale=
+00032920: 312c 2074 7261 6e73 6c61 7469 6f6e 3d5b  1, translation=[
+00032930: 302c 2030 2c20 305d 2c20 726f 7461 7469  0, 0, 0], rotati
+00032940: 6f6e 3d5b 302c 2030 2c20 305d 2c0a 2020  on=[0, 0, 0],.  
+00032950: 2020 2020 2020 2020 2020 6365 6e74 7265            centre
+00032960: 3d5b 302c 2030 2c20 305d 2c20 7265 7361  =[0, 0, 0], resa
+00032970: 6d70 6c65 3d22 6669 6e65 222c 2072 6573  mple="fine", res
+00032980: 746f 7265 3d54 7275 652c 200a 2020 2020  tore=True, .    
+00032990: 2020 2020 2020 2020 6669 6c6c 5f76 616c          fill_val
+000329a0: 7565 3d4e 6f6e 652c 2066 6f72 6365 5f63  ue=None, force_c
+000329b0: 6f6e 746f 7572 733d 4661 6c73 6529 3a0a  ontours=False):.
+000329c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000329d0: 2020 2020 4170 706c 7920 7468 7265 652d      Apply three-
+000329e0: 6469 6d65 6e73 696f 6e61 6c20 7369 6d69  dimensional simi
+000329f0: 6c61 7269 7479 2074 7261 6e73 666f 726d  larity transform
+00032a00: 2074 6f20 524f 492e 0a0a 2020 2020 2020   to ROI...      
+00032a10: 2020 4966 2074 6865 2074 7261 6e73 666f    If the transfo
+00032a20: 726d 2063 6f72 7265 7370 6f6e 6473 2074  rm corresponds t
+00032a30: 6f20 6120 7472 616e 736c 6174 696f 6e20  o a translation 
+00032a40: 616e 642f 6f72 2072 6f74 6174 696f 6e0a  and/or rotation.
+00032a50: 2020 2020 2020 2020 6162 6f75 7420 7468          about th
+00032a60: 6520 7a2d 6178 6973 2c20 616e 6420 6569  e z-axis, and ei
+00032a70: 7468 6572 2074 6865 2072 6f69 2073 6f75  ther the roi sou
+00032a80: 7263 6520 7479 7065 2069 7320 2264 6963  rce type is "dic
+00032a90: 6f6d 220a 2020 2020 2020 2020 6f72 2066  om".        or f
+00032aa0: 6f72 6365 2d63 6f6e 746f 7572 7320 6973  orce-contours is
+00032ab0: 2054 7275 652c 2074 6865 2074 7261 6e73   True, the trans
+00032ac0: 666f 726d 2069 7320 6170 706c 6965 6420  form is applied 
+00032ad0: 746f 2063 6f6e 746f 7572 0a20 2020 2020  to contour.     
+00032ae0: 2020 2070 6f69 6e74 7320 616e 6420 7468     points and th
+00032af0: 6520 726f 6920 6d61 736b 2069 7320 7365  e roi mask is se
+00032b00: 7420 6173 2075 6e6c 6f61 6465 642e 2020  t as unloaded.  
+00032b10: 4f74 6865 7277 6973 6520 7468 6520 7472  Otherwise the tr
+00032b20: 616e 7366 6f72 6d0a 2020 2020 2020 2020  ansform.        
+00032b30: 6973 2061 7070 6c69 6564 2074 6f20 7468  is applied to th
+00032b40: 6520 6d61 736b 2061 6e64 2063 6f6e 746f  e mask and conto
+00032b50: 7572 7320 6172 6520 7365 7420 6173 2075  urs are set as u
+00032b60: 6e6c 6f61 6465 642e 0a0a 2020 2020 2020  nloaded...      
+00032b70: 2020 5468 6520 7472 616e 7366 6f72 6d20    The transform 
+00032b80: 6973 2061 7070 6c69 6564 2069 6e20 7468  is applied in th
+00032b90: 6520 6f72 6465 723a 2074 7261 6e73 6c61  e order: transla
+00032ba0: 7469 6f6e 2c20 7363 616c 696e 672c 0a20  tion, scaling,. 
+00032bb0: 2020 2020 2020 2072 6f74 6174 696f 6e2e         rotation.
+00032bc0: 2020 5468 6520 6c61 7474 6572 2074 776f    The latter two
+00032bd0: 2061 7265 2061 626f 7574 2074 6865 2063   are about the c
+00032be0: 656e 7472 6520 636f 6f72 6469 6e61 7465  entre coordinate
+00032bf0: 732e 0a0a 2020 2020 2020 2020 2a2a 5061  s...        **Pa
+00032c00: 7261 6d65 7465 7273 3a2a 2a0a 2020 2020  rameters:**.    
+00032c10: 2020 2020 0a20 2020 2020 2020 2066 6f72      .        for
+00032c20: 6365 5f63 6f6e 746f 7572 7320 3a20 626f  ce_contours : bo
+00032c30: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
+00032c40: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+00032c50: 2054 7275 652c 2061 6e64 2074 6865 2074   True, and the t
+00032c60: 7261 6e73 666f 726d 2063 6f72 7265 7370  ransform corresp
+00032c70: 6f6e 6473 2074 6f20 6120 7472 616e 736c  onds to a transl
+00032c80: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
+00032c90: 2020 616e 642f 6f72 2072 6f74 6174 696f    and/or rotatio
+00032ca0: 6e20 6162 6f75 7420 7468 6520 7a2d 6178  n about the z-ax
+00032cb0: 6973 2c20 6170 706c 7920 7472 616e 7366  is, apply transf
+00032cc0: 6f72 6d20 746f 2063 6f6e 746f 7572 0a20  orm to contour. 
+00032cd0: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
+00032ce0: 7320 696e 6465 7065 6e64 656e 746c 7920  s independently 
+00032cf0: 6f66 2074 6865 206f 7269 6769 6e61 6c20  of the original 
+00032d00: 6461 7461 2073 6f75 7263 652e 0a0a 2020  data source...  
+00032d10: 2020 2020 2020 466f 7220 6f74 6865 7220        For other 
+00032d20: 7061 7261 6d65 7465 7273 2c20 7365 6520  parameters, see 
+00032d30: 646f 6375 6d65 6e74 6174 696f 6e20 666f  documentation fo
+00032d40: 720a 2020 2020 2020 2020 736b 7274 2e69  r.        skrt.i
+00032d50: 6d61 6765 2e49 6d61 6765 2e74 7261 6e73  mage.Image.trans
+00032d60: 666f 726d 2829 2e20 204e 6f74 6520 7468  form().  Note th
+00032d70: 6174 2074 6865 2060 606f 7264 6572 6060  at the ``order``
+00032d80: 0a20 2020 2020 2020 2070 6172 616d 6574  .        paramet
+00032d90: 6572 2069 736e 2774 2061 7661 696c 6162  er isn't availab
+00032da0: 6c65 2066 6f72 2072 6f69 2074 7261 6e73  le for roi trans
+00032db0: 666f 726d 7320 2d20 6120 7661 6c75 6520  forms - a value 
+00032dc0: 6f66 2030 0a20 2020 2020 2020 2069 7320  of 0.        is 
+00032dd0: 7573 6564 2061 6c77 6179 732e 0a20 2020  used always..   
+00032de0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00032df0: 2020 2320 4368 6563 6b20 7768 6574 6865    # Check whethe
+00032e00: 7220 7472 616e 7366 6f72 6d20 6973 2074  r transform is t
+00032e10: 6f20 6265 2061 7070 6c69 6564 2074 6f20  o be applied to 
+00032e20: 636f 6e74 6f75 7273 0a20 2020 2020 2020  contours.       
+00032e30: 2073 6d61 6c6c 5f6e 756d 6265 7220 3d20   small_number = 
+00032e40: 312e 652d 360a 2020 2020 2020 2020 7472  1.e-6.        tr
+00032e50: 616e 7366 6f72 6d5f 636f 6e74 6f75 7273  ansform_contours
+00032e60: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00032e70: 2069 6620 7365 6c66 2e73 6f75 7263 655f   if self.source_
+00032e80: 7479 7065 203d 3d20 2763 6f6e 746f 7572  type == 'contour
+00032e90: 2720 6f72 2066 6f72 6365 5f63 6f6e 746f  ' or force_conto
+00032ea0: 7572 733a 0a20 2020 2020 2020 2020 2020  urs:.           
+00032eb0: 2069 6620 6162 7328 7363 616c 6520 2d20   if abs(scale - 
+00032ec0: 3129 203c 2073 6d61 6c6c 5f6e 756d 6265  1) < small_numbe
+00032ed0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00032ee0: 2020 2069 6620 6162 7328 726f 7461 7469     if abs(rotati
+00032ef0: 6f6e 5b30 5d29 203c 2073 6d61 6c6c 5f6e  on[0]) < small_n
+00032f00: 756d 6265 7220 5c0a 2020 2020 2020 2020  umber \.        
+00032f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032f20: 616e 6420 6162 7328 726f 7461 7469 6f6e  and abs(rotation
+00032f30: 5b31 5d29 203c 2073 6d61 6c6c 5f6e 756d  [1]) < small_num
+00032f40: 6265 723a 0a20 2020 2020 2020 2020 2020  ber:.           
+00032f50: 2020 2020 2020 2020 2074 7261 6e73 666f           transfo
+00032f60: 726d 5f63 6f6e 746f 7572 7320 3d20 5472  rm_contours = Tr
+00032f70: 7565 0a0a 2020 2020 2020 2020 6966 2074  ue..        if t
+00032f80: 7261 6e73 666f 726d 5f63 6f6e 746f 7572  ransform_contour
+00032f90: 733a 0a0a 2020 2020 2020 2020 2020 2020  s:..            
+00032fa0: 2320 4170 706c 7920 7472 616e 7366 6f72  # Apply transfor
+00032fb0: 6d20 746f 2072 6f69 2063 6f6e 746f 7572  m to roi contour
+00032fc0: 730a 2020 2020 2020 2020 2020 2020 7472  s.            tr
+00032fd0: 616e 736c 6174 696f 6e5f 3264 203d 2028  anslation_2d = (
+00032fe0: 7472 616e 736c 6174 696f 6e5b 305d 2c20  translation[0], 
+00032ff0: 7472 616e 736c 6174 696f 6e5b 315d 290a  translation[1]).
+00033000: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
+00033010: 7265 5f32 6420 3d20 2863 656e 7472 655b  re_2d = (centre[
+00033020: 305d 2c20 6365 6e74 7265 5b31 5d29 0a20  0], centre[1]). 
+00033030: 2020 2020 2020 2020 2020 2061 6e67 6c65             angle
+00033040: 203d 2072 6f74 6174 696f 6e5b 325d 0a20   = rotation[2]. 
+00033050: 2020 2020 2020 2020 2020 206e 6577 5f63             new_c
+00033060: 6f6e 746f 7572 7320 3d20 7b7d 0a20 2020  ontours = {}.   
+00033070: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
+00033080: 2c20 636f 6e74 6f75 7273 2069 6e20 7365  , contours in se
+00033090: 6c66 2e67 6574 5f63 6f6e 746f 7572 7328  lf.get_contours(
+000330a0: 292e 6974 656d 7328 293a 0a20 2020 2020  ).items():.     
+000330b0: 2020 2020 2020 2020 2020 206e 6577 5f6b             new_k
+000330c0: 6579 203d 206b 6579 202b 2074 7261 6e73  ey = key + trans
+000330d0: 6c61 7469 6f6e 5b32 5d0a 2020 2020 2020  lation[2].      
+000330e0: 2020 2020 2020 2020 2020 6e65 775f 636f            new_co
+000330f0: 6e74 6f75 7273 5b6e 6577 5f6b 6579 5d20  ntours[new_key] 
+00033100: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+00033110: 2020 2020 2066 6f72 2063 6f6e 746f 7572       for contour
+00033120: 2069 6e20 636f 6e74 6f75 7273 3a0a 2020   in contours:.  
+00033130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033140: 2020 6966 206c 656e 2863 6f6e 746f 7572    if len(contour
+00033150: 2920 3c20 333a 0a20 2020 2020 2020 2020  ) < 3:.         
+00033160: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00033170: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+00033180: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
+00033190: 676f 6e20 3d20 636f 6e74 6f75 725f 746f  gon = contour_to
+000331a0: 5f70 6f6c 7967 6f6e 2863 6f6e 746f 7572  _polygon(contour
+000331b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000331c0: 2020 2020 2020 706f 6c79 676f 6e20 3d20        polygon = 
+000331d0: 6166 6669 6e69 7479 2e74 7261 6e73 6c61  affinity.transla
+000331e0: 7465 2870 6f6c 7967 6f6e 2c20 2a74 7261  te(polygon, *tra
+000331f0: 6e73 6c61 7469 6f6e 5f32 6429 0a20 2020  nslation_2d).   
+00033200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033210: 2070 6f6c 7967 6f6e 203d 2061 6666 696e   polygon = affin
+00033220: 6974 792e 726f 7461 7465 2870 6f6c 7967  ity.rotate(polyg
+00033230: 6f6e 2c20 616e 676c 652c 2063 656e 7472  on, angle, centr
+00033240: 655f 3264 290a 2020 2020 2020 2020 2020  e_2d).          
+00033250: 2020 2020 2020 2020 2020 706f 6c79 676f            polygo
+00033260: 6e20 3d20 6166 6669 6e69 7479 2e73 6361  n = affinity.sca
+00033270: 6c65 2870 6f6c 7967 6f6e 2c20 7363 616c  le(polygon, scal
+00033280: 652c 2073 6361 6c65 2c20 7363 616c 652c  e, scale, scale,
+00033290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000332a0: 2020 2020 2020 2020 2020 2020 2063 656e               cen
+000332b0: 7472 655f 3264 290a 2020 2020 2020 2020  tre_2d).        
+000332c0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+000332d0: 636f 6e74 6f75 7273 5b6e 6577 5f6b 6579  contours[new_key
+000332e0: 5d2e 6170 7065 6e64 2870 6f6c 7967 6f6e  ].append(polygon
+000332f0: 5f74 6f5f 636f 6e74 6f75 7228 706f 6c79  _to_contour(poly
+00033300: 676f 6e29 290a 2020 2020 2020 2020 2020  gon)).          
+00033310: 2020 2020 2020 6966 206e 6f74 206e 6577        if not new
+00033320: 5f63 6f6e 746f 7572 735b 6e65 775f 6b65  _contours[new_ke
+00033330: 795d 3a0a 2020 2020 2020 2020 2020 2020  y]:.            
+00033340: 2020 2020 2020 2020 6e65 775f 636f 6e74          new_cont
+00033350: 6f75 7273 2e70 6f70 286e 6577 5f6b 6579  ours.pop(new_key
+00033360: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00033370: 656c 662e 7265 7365 745f 636f 6e74 6f75  elf.reset_contou
+00033380: 7273 286e 6577 5f63 6f6e 746f 7572 7329  rs(new_contours)
+00033390: 0a0a 2020 2020 2020 2020 656c 7365 3a0a  ..        else:.
+000333a0: 2020 2020 2020 2020 2020 2020 2320 4170              # Ap
+000333b0: 706c 7920 7472 616e 7366 6f72 6d20 746f  ply transform to
+000333c0: 2072 6f69 206d 6173 6b0a 2020 2020 2020   roi mask.      
+000333d0: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
+000333e0: 655f 6d61 736b 2829 0a20 2020 2020 2020  e_mask().       
+000333f0: 2020 2020 2073 656c 662e 6d61 736b 2e74       self.mask.t
+00033400: 7261 6e73 666f 726d 2873 6361 6c65 2c20  ransform(scale, 
+00033410: 7472 616e 736c 6174 696f 6e2c 2072 6f74  translation, rot
+00033420: 6174 696f 6e2c 0a20 2020 2020 2020 2020  ation,.         
+00033430: 2020 2020 2020 2020 2020 2063 656e 7472             centr
+00033440: 652c 2072 6573 616d 706c 652c 2072 6573  e, resample, res
+00033450: 746f 7265 2c20 302c 2066 696c 6c5f 7661  tore, 0, fill_va
+00033460: 6c75 6529 0a20 2020 2020 2020 2020 2020  lue).           
+00033470: 2073 656c 662e 7265 7365 745f 6d61 736b   self.reset_mask
+00033480: 2829 0a0a 2020 2020 6465 6620 6372 6f70  ()..    def crop
+00033490: 2873 656c 662c 2078 6c69 6d3d 4e6f 6e65  (self, xlim=None
+000334a0: 2c20 796c 696d 3d4e 6f6e 652c 207a 6c69  , ylim=None, zli
+000334b0: 6d3d 4e6f 6e65 293a 0a20 2020 2020 2020  m=None):.       
+000334c0: 2022 2222 0a20 2020 2020 2020 2043 726f   """.        Cro
+000334d0: 7020 524f 4920 746f 2073 7065 6369 6669  p ROI to specifi
+000334e0: 6564 2072 616e 6765 2069 6e20 782c 2079  ed range in x, y
+000334f0: 2c20 7a2e 0a0a 2020 2020 2020 2020 2a2a  , z...        **
+00033500: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
+00033510: 2020 2020 2020 2078 6c69 6d20 3a20 7475         xlim : tu
+00033520: 706c 652c 2064 6566 6175 6c74 3d4e 6f6e  ple, default=Non
+00033530: 650a 2020 2020 2020 2020 2020 2020 4c6f  e.            Lo
+00033540: 7765 7220 616e 6420 7570 7065 7220 626f  wer and upper bo
+00033550: 756e 6473 2069 6e20 6d6d 2066 6f72 2063  unds in mm for c
+00033560: 726f 7070 696e 6720 616c 6f6e 6720 782d  ropping along x-
+00033570: 6178 6973 2e0a 2020 2020 2020 2020 2020  axis..          
+00033580: 2020 4966 2073 6574 2074 6f20 4e6f 6e65    If set to None
+00033590: 2c20 6e6f 2063 726f 7070 696e 6720 6973  , no cropping is
+000335a0: 2070 6572 666f 726d 6564 2e20 2049 6620   performed.  If 
+000335b0: 6120 626f 756e 640a 2020 2020 2020 2020  a bound.        
+000335c0: 2020 2020 6973 2073 6574 2074 6f20 4e6f      is set to No
+000335d0: 6e65 2c20 7468 6174 2062 6f75 6e64 2069  ne, that bound i
+000335e0: 7320 6469 7372 6567 6172 6465 642e 0a0a  s disregarded...
+000335f0: 2020 2020 2020 2020 796c 696d 203a 2074          ylim : t
+00033600: 7570 6c65 2c20 6465 6661 756c 743d 4e6f  uple, default=No
+00033610: 6e65 0a20 2020 2020 2020 2020 2020 204c  ne.            L
+00033620: 6f77 6572 2061 6e64 2075 7070 6572 2062  ower and upper b
+00033630: 6f75 6e64 7320 696e 206d 6d20 666f 7220  ounds in mm for 
+00033640: 6372 6f70 7069 6e67 2061 6c6f 6e67 2079  cropping along y
+00033650: 2d61 7869 732e 0a20 2020 2020 2020 2020  -axis..         
+00033660: 2020 2049 6620 7365 7420 746f 204e 6f6e     If set to Non
+00033670: 652c 206e 6f20 6372 6f70 7069 6e67 2069  e, no cropping i
+00033680: 7320 7065 7266 6f72 6d65 642e 2020 4966  s performed.  If
+00033690: 2061 2062 6f75 6e64 0a20 2020 2020 2020   a bound.       
+000336a0: 2020 2020 2069 7320 7365 7420 746f 204e       is set to N
+000336b0: 6f6e 652c 2074 6861 7420 626f 756e 6420  one, that bound 
+000336c0: 6973 2064 6973 7265 6761 7264 6564 2e0a  is disregarded..
+000336d0: 0a20 2020 2020 2020 207a 6c69 6d20 3a20  .        zlim : 
+000336e0: 7475 706c 652c 2064 6566 6175 6c74 3d4e  tuple, default=N
+000336f0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00033700: 4c6f 7765 7220 616e 6420 7570 7065 7220  Lower and upper 
+00033710: 626f 756e 6473 2069 6e20 6d6d 2066 6f72  bounds in mm for
+00033720: 2063 726f 7070 696e 6720 616c 6f6e 6720   cropping along 
+00033730: 7a2d 6178 6973 2e0a 2020 2020 2020 2020  z-axis..        
+00033740: 2020 2020 4966 2073 6574 2074 6f20 4e6f      If set to No
+00033750: 6e65 2c20 6e6f 2063 726f 7070 696e 6720  ne, no cropping 
+00033760: 6973 2070 6572 666f 726d 6564 2e20 2049  is performed.  I
+00033770: 6620 6120 626f 756e 640a 2020 2020 2020  f a bound.      
+00033780: 2020 2020 2020 6973 2073 6574 2074 6f20        is set to 
+00033790: 4e6f 6e65 2c20 7468 6174 2062 6f75 6e64  None, that bound
+000337a0: 2069 7320 6469 7372 6567 6172 6465 642e   is disregarded.
+000337b0: 0a0a 2020 2020 2020 2020 4966 206f 6e6c  ..        If onl
+000337c0: 7920 7a6c 696d 2069 7320 6e6f 7420 7365  y zlim is not se
+000337d0: 7420 746f 204e 6f6e 6520 616e 6420 7468  t to None and th
+000337e0: 6520 524f 4920 736f 7572 6365 2074 7970  e ROI source typ
+000337f0: 6520 6973 2022 636f 6e74 6f75 7222 2c0a  e is "contour",.
+00033800: 2020 2020 2020 2020 6372 6f70 7069 6e67          cropping
+00033810: 2069 7320 7065 7266 6f72 6d65 6420 6279   is performed by
+00033820: 2064 6973 6361 7264 696e 6720 636f 6e74   discarding cont
+00033830: 6f75 7273 206f 7574 7369 6465 2074 6865  ours outside the
+00033840: 2072 6571 7569 7265 640a 2020 2020 2020   required.      
+00033850: 2020 7261 6e67 652e 2020 4f74 6877 6973    range.  Othwis
+00033860: 6520 6372 6f70 7069 6e67 2069 7320 7065  e cropping is pe
+00033870: 7266 6f72 6d65 6420 6f6e 2074 6865 2052  rformed on the R
+00033880: 4f49 206d 6173 6b2e 0a20 2020 2020 2020  OI mask..       
+00033890: 2022 2222 0a20 2020 2020 2020 2023 2046   """.        # F
+000338a0: 6f72 2063 726f 7070 696e 6720 616c 6f6e  or cropping alon
+000338b0: 6720 7a2c 2061 6e64 2077 6865 7265 2052  g z, and where R
+000338c0: 4f49 2069 7320 6465 6669 6e65 6420 6672  OI is defined fr
+000338d0: 6f6d 2063 6f6e 746f 7572 732c 0a20 2020  om contours,.   
+000338e0: 2020 2020 2023 2064 6973 6361 7264 2063       # discard c
+000338f0: 6f6e 746f 7572 7320 6f75 7473 6964 6520  ontours outside 
+00033900: 6372 6f70 2072 616e 6765 2e0a 2020 2020  crop range..    
+00033910: 2020 2020 6966 2073 656c 662e 736f 7572      if self.sour
+00033920: 6365 5f74 7970 6520 3d3d 2022 636f 6e74  ce_type == "cont
+00033930: 6f75 7222 2061 6e64 207a 6c69 6d20 616e  our" and zlim an
+00033940: 6420 6e6f 7420 786c 696d 2061 6e64 206e  d not xlim and n
+00033950: 6f74 2079 6c69 6d3a 0a20 2020 2020 2020  ot ylim:.       
+00033960: 2020 2020 2063 6f6e 746f 7572 7320 3d20       contours = 
+00033970: 7365 6c66 2e67 6574 5f63 6f6e 746f 7572  self.get_contour
+00033980: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+00033990: 6966 207a 6c69 6d5b 305d 2069 7320 4e6f  if zlim[0] is No
+000339a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000339b0: 2020 2020 7a6c 696d 5b30 5d20 3d20 6d69      zlim[0] = mi
+000339c0: 6e28 636f 6e74 6f75 7273 2920 2d20 310a  n(contours) - 1.
+000339d0: 2020 2020 2020 2020 2020 2020 6966 207a              if z
+000339e0: 6c69 6d5b 315d 2069 7320 4e6f 6e65 3a0a  lim[1] is None:.
+000339f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033a00: 7a6c 696d 5b31 5d20 3d20 6d61 7828 636f  zlim[1] = max(co
+00033a10: 6e74 6f75 7273 2920 2b20 310a 2020 2020  ntours) + 1.    
+00033a20: 2020 2020 2020 2020 636f 6e74 6f75 7273          contours
+00033a30: 203d 207b 7a3a 207a 5f63 6f6e 746f 7572   = {z: z_contour
+00033a40: 7320 666f 7220 7a2c 207a 5f63 6f6e 746f  s for z, z_conto
+00033a50: 7572 7320 696e 2063 6f6e 746f 7572 732e  urs in contours.
+00033a60: 6974 656d 7328 290a 2020 2020 2020 2020  items().        
+00033a70: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00033a80: 7a20 3e20 7a6c 696d 5b30 5d20 616e 6420  z > zlim[0] and 
+00033a90: 7a20 3c20 7a6c 696d 5b31 5d29 7d0a 0a20  z < zlim[1])}.. 
+00033aa0: 2020 2020 2020 2020 2020 2023 2052 6573             # Res
+00033ab0: 6574 2063 6f6e 746f 7572 732e 0a20 2020  et contours..   
+00033ac0: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
+00033ad0: 7365 745f 636f 6e74 6f75 7273 2863 6f6e  set_contours(con
+00033ae0: 746f 7572 7329 0a0a 2020 2020 2020 2020  tours)..        
+00033af0: 2320 466f 7220 616c 6c20 6f74 6865 7220  # For all other 
+00033b00: 6361 7365 732c 2066 726f 7020 524f 4920  cases, frop ROI 
+00033b10: 6d61 736b 2e0a 2020 2020 2020 2020 656c  mask..        el
+00033b20: 6966 2078 6c69 6d20 6f72 2079 6c69 6d20  if xlim or ylim 
+00033b30: 6f72 207a 6c69 6d3a 0a20 2020 2020 2020  or zlim:.       
+00033b40: 2020 2020 2073 656c 662e 6372 6561 7465       self.create
+00033b50: 5f6d 6173 6b28 290a 2020 2020 2020 2020  _mask().        
+00033b60: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00033b70: 2023 2045 6e73 7572 6520 7468 6174 2063   # Ensure that c
+00033b80: 726f 7020 7261 6e67 6520 616c 6f6e 6720  rop range along 
+00033b90: 6561 6368 2061 7869 7320 6973 204e 6f6e  each axis is Non
+00033ba0: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
+00033bb0: 6f72 2061 2074 776f 2d65 6c65 6d65 6e74  or a two-element
+00033bc0: 2074 7570 6c65 206f 6620 666c 6f61 7473   tuple of floats
+00033bd0: 2e0a 2020 2020 2020 2020 2020 2020 6c69  ..            li
+00033be0: 6d73 203d 205b 786c 696d 2c20 796c 696d  ms = [xlim, ylim
+00033bf0: 2c20 7a6c 696d 5d0a 2020 2020 2020 2020  , zlim].        
+00033c00: 2020 2020 6d61 736b 5f65 7874 656e 7473      mask_extents
+00033c10: 203d 2073 656c 662e 6d61 736b 2e67 6574   = self.mask.get
+00033c20: 5f65 7874 656e 7473 2829 0a20 2020 2020  _extents().     
+00033c30: 2020 2020 2020 2066 6f72 2069 5f61 782c         for i_ax,
+00033c40: 206c 696d 2069 6e20 656e 756d 6572 6174   lim in enumerat
+00033c50: 6528 6c69 6d73 293a 0a20 2020 2020 2020  e(lims):.       
+00033c60: 2020 2020 2020 2020 2069 6620 6c69 6d3a           if lim:
+00033c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00033c80: 2020 2020 2066 6f72 2069 6478 2069 6e20       for idx in 
+00033c90: 5b30 2c20 315d 3a0a 2020 2020 2020 2020  [0, 1]:.        
+00033ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033cb0: 6966 206c 696d 5b69 6478 5d20 6973 204e  if lim[idx] is N
+00033cc0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00033cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033ce0: 206c 696d 735b 695f 6178 5d5b 6964 785d   lims[i_ax][idx]
+00033cf0: 203d 206d 6173 6b5f 6578 7465 6e74 735b   = mask_extents[
+00033d00: 695f 6178 5d5b 6964 785d 0a20 2020 2020  i_ax][idx].     
+00033d10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00033d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00033d30: 2020 2020 206c 696d 735b 695f 6178 5d20       lims[i_ax] 
+00033d40: 3d20 4e6f 6e65 0a0a 2020 2020 2020 2020  = None..        
+00033d50: 2020 2020 2320 4c6f 6f70 206f 7665 7220      # Loop over 
+00033d60: 6178 6573 2e0a 2020 2020 2020 2020 2020  axes..          
+00033d70: 2020 666f 7220 695f 6178 2c20 6c69 6d20    for i_ax, lim 
+00033d80: 696e 2065 6e75 6d65 7261 7465 286c 696d  in enumerate(lim
+00033d90: 7329 3a0a 0a20 2020 2020 2020 2020 2020  s):..           
+00033da0: 2020 2020 2069 6620 6c69 6d20 6973 204e       if lim is N
+00033db0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00033dc0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00033dd0: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
+00033de0: 2020 2023 2046 696e 6420 6172 7261 7920     # Find array 
+00033df0: 696e 6469 6365 7320 6174 2077 6869 6368  indices at which
+00033e00: 2074 6f20 6372 6f70 2e0a 2020 2020 2020   to crop..      
+00033e10: 2020 2020 2020 2020 2020 6931 203d 2073            i1 = s
+00033e20: 656c 662e 6d61 736b 2e70 6f73 5f74 6f5f  elf.mask.pos_to_
+00033e30: 6964 7828 0a20 2020 2020 2020 2020 2020  idx(.           
+00033e40: 2020 2020 2020 2020 2020 2020 206c 696d               lim
+00033e50: 735b 695f 6178 5d5b 305d 2c20 6178 3d69  s[i_ax][0], ax=i
+00033e60: 5f61 782c 2072 6574 7572 6e5f 696e 743d  _ax, return_int=
+00033e70: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+00033e80: 2020 2020 2020 2069 3220 3d20 7365 6c66         i2 = self
+00033e90: 2e6d 6173 6b2e 706f 735f 746f 5f69 6478  .mask.pos_to_idx
+00033ea0: 286c 696d 735b 695f 6178 5d5b 315d 2c20  (lims[i_ax][1], 
+00033eb0: 6178 3d69 5f61 782c 0a20 2020 2020 2020  ax=i_ax,.       
+00033ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033ed0: 2072 6574 7572 6e5f 696e 743d 4661 6c73   return_int=Fals
+00033ee0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00033ef0: 2020 2069 5f62 6967 2c20 695f 736d 616c     i_big, i_smal
+00033f00: 6c20 3d20 6932 2c20 6931 0a20 2020 2020  l = i2, i1.     
+00033f10: 2020 2020 2020 2020 2020 2069 6620 6931             if i1
+00033f20: 203e 2069 323a 0a20 2020 2020 2020 2020   > i2:.         
+00033f30: 2020 2020 2020 2020 2020 2069 5f62 6967             i_big
+00033f40: 2c20 695f 736d 616c 6c20 3d20 695f 736d  , i_small = i_sm
+00033f50: 616c 6c2c 2069 5f62 6967 0a20 2020 2020  all, i_big.     
+00033f60: 2020 2020 2020 2020 2020 2069 5f73 6d61             i_sma
+00033f70: 6c6c 203d 2069 6e74 286e 702e 666c 6f6f  ll = int(np.floo
+00033f80: 7228 695f 736d 616c 6c20 2b20 302e 3529  r(i_small + 0.5)
+00033f90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00033fa0: 2020 695f 6269 6720 3d20 696e 7428 6e70    i_big = int(np
+00033fb0: 2e66 6c6f 6f72 2869 5f62 6967 202b 2030  .floor(i_big + 0
+00033fc0: 2e35 2929 0a0a 2020 2020 2020 2020 2020  .5))..          
+00033fd0: 2020 2020 2020 2320 4372 6f70 2074 6865        # Crop the
+00033fe0: 206d 6173 6b2e 0a20 2020 2020 2020 2020   mask..         
+00033ff0: 2020 2020 2020 2061 785f 746f 5f73 6c69         ax_to_sli
+00034000: 6365 203d 2073 656c 662e 6d61 736b 2e67  ce = self.mask.g
+00034010: 6574 5f61 7865 7328 292e 696e 6465 7828  et_axes().index(
+00034020: 695f 6178 290a 2020 2020 2020 2020 2020  i_ax).          
+00034030: 2020 2020 2020 6966 2069 5f73 6d61 6c6c        if i_small
+00034040: 203e 2030 2061 6e64 2069 5f73 6d61 6c6c   > 0 and i_small
+00034050: 203c 2073 656c 662e 6d61 736b 2e6e 5f76   < self.mask.n_v
+00034060: 6f78 656c 735b 695f 6178 5d3a 0a20 2020  oxels[i_ax]:.   
+00034070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034080: 2073 656c 662e 6d61 736b 2e64 6174 612e   self.mask.data.
+00034090: 7377 6170 6178 6573 2830 2c20 6178 5f74  swapaxes(0, ax_t
+000340a0: 6f5f 736c 6963 6529 5b3a 695f 736d 616c  o_slice)[:i_smal
+000340b0: 6c2c 203a 2c20 3a5d 203d 2030 0a20 2020  l, :, :] = 0.   
+000340c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000340d0: 695f 6269 6720 3e20 3020 616e 6420 695f  i_big > 0 and i_
+000340e0: 6269 6720 3c20 7365 6c66 2e6d 6173 6b2e  big < self.mask.
+000340f0: 6e5f 766f 7865 6c73 5b69 5f61 785d 3a0a  n_voxels[i_ax]:.
+00034100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034110: 2020 2020 7365 6c66 2e6d 6173 6b2e 6461      self.mask.da
+00034120: 7461 2e73 7761 7061 7865 7328 302c 2061  ta.swapaxes(0, a
+00034130: 785f 746f 5f73 6c69 6365 295b 695f 6269  x_to_slice)[i_bi
+00034140: 673a 2c20 3a2c 203a 5d20 3d20 300a 0a20  g:, :, :] = 0.. 
+00034150: 2020 2020 2020 2020 2020 2023 2052 6573             # Res
+00034160: 6574 206d 6173 6b2e 0a20 2020 2020 2020  et mask..       
+00034170: 2020 2020 2073 656c 662e 7265 7365 745f       self.reset_
+00034180: 6d61 736b 2873 656c 662e 6d61 736b 290a  mask(self.mask).
+00034190: 0a20 2020 2064 6566 2063 726f 705f 6279  .    def crop_by
+000341a0: 5f61 6d6f 756e 7473 2873 656c 662c 2064  _amounts(self, d
+000341b0: 783d 4e6f 6e65 2c20 6479 3d4e 6f6e 652c  x=None, dy=None,
+000341c0: 2064 7a3d 4e6f 6e65 293a 0a20 2020 2020   dz=None):.     
+000341d0: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
+000341e0: 726f 7020 524f 4920 6279 2074 6865 2061  rop ROI by the a
+000341f0: 6d6f 756e 7473 2064 782c 2064 792c 2064  mounts dx, dy, d
+00034200: 7a20 696e 206d 6d2e 0a0a 2020 2020 2020  z in mm...      
+00034210: 2020 5468 6973 206d 6574 686f 6420 6361    This method ca
+00034220: 6c6c 7320 7468 6520 6675 6e63 7469 6f6e  lls the function
+00034230: 2073 6b72 742e 696d 6167 652e 6372 6f70   skrt.image.crop
+00034240: 5f62 795f 616d 6f75 6e74 7328 292c 2077  _by_amounts(), w
+00034250: 6974 680a 2020 2020 2020 2020 7365 6c66  ith.        self
+00034260: 2070 6173 7365 6420 6173 206f 626a 6563   passed as objec
+00034270: 7420 666f 7220 6372 6f70 7069 6e67 2e0a  t for cropping..
+00034280: 0a20 2020 2020 2020 2054 6865 2061 6d6f  .        The amo
+00034290: 756e 7420 6f66 2063 726f 7070 696e 6720  unt of cropping 
+000342a0: 616c 6f6e 6720 6561 6368 2064 6972 6563  along each direc
+000342b0: 7469 6f6e 2073 686f 756c 6420 6265 206f  tion should be o
+000342c0: 6e65 206f 663a 0a20 2020 2020 2020 202d  ne of:.        -
+000342d0: 2066 6c6f 6174 203a 2074 6865 2052 4f49   float : the ROI
+000342e0: 2069 7320 6372 6f70 7065 6420 6279 2074   is cropped by t
+000342f0: 6869 7320 616d 6f75 6e74 206f 6e20 626f  his amount on bo
+00034300: 7468 2073 6964 6573 3b0a 2020 2020 2020  th sides;.      
+00034310: 2020 2d20 7477 6f2d 656c 656d 656e 7420    - two-element 
+00034320: 7475 706c 653a 2074 6865 2052 4f49 2069  tuple: the ROI i
+00034330: 7320 6372 6f70 7065 6420 6f6e 2074 6865  s cropped on the
+00034340: 2073 6964 6573 206f 6620 6c6f 7765 720a   sides of lower.
+00034350: 2020 2020 2020 2020 2020 616e 6420 6869            and hi
+00034360: 6768 6572 2076 616c 7565 7320 6279 2074  gher values by t
+00034370: 6865 2061 6d6f 756e 7473 2073 7065 6369  he amounts speci
+00034380: 6669 6564 3b0a 2020 2020 2020 2020 2d20  fied;.        - 
+00034390: 4e6f 6e65 203a 206e 6f20 6372 6f70 7069  None : no croppi
+000343a0: 6e67 2069 7320 7065 7266 6f72 6d65 642e  ng is performed.
+000343b0: 0a0a 2020 2020 2020 2020 466f 7220 6d6f  ..        For mo
+000343c0: 7265 2064 6574 6169 6c73 2c20 7365 6520  re details, see 
+000343d0: 646f 6375 6d65 6e74 6174 696f 6e20 6f66  documentation of
+000343e0: 2073 6b72 742e 696d 6167 652e 6372 6f70   skrt.image.crop
+000343f0: 5f62 795f 616d 6f75 6e74 7328 292e 0a20  _by_amounts().. 
+00034400: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00034410: 2020 2073 6b72 742e 696d 6167 652e 6372     skrt.image.cr
+00034420: 6f70 5f62 795f 616d 6f75 6e74 7328 7365  op_by_amounts(se
+00034430: 6c66 2c20 6478 2c20 6479 2c20 647a 290a  lf, dx, dy, dz).
+00034440: 0a20 2020 2064 6566 2063 726f 705f 746f  .    def crop_to
+00034450: 5f72 6f69 5f6c 656e 6774 6828 7365 6c66  _roi_length(self
+00034460: 2c20 6f74 6865 722c 2061 783d 227a 2229  , other, ax="z")
+00034470: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00034480: 2020 2020 2020 4372 6f70 2074 6f20 6c65        Crop to le
+00034490: 6e67 7468 206f 6620 6f74 6865 7220 524f  ngth of other RO
+000344a0: 4920 616c 6f6e 6720 6120 6769 7665 6e20  I along a given 
+000344b0: 6178 6973 2e0a 0a20 2020 2020 2020 202a  axis...        *
+000344c0: 2a50 6172 616d 6574 6572 733a 2a2a 0a20  *Parameters:**. 
+000344d0: 2020 2020 2020 206f 7468 6572 203a 2073         other : s
+000344e0: 6b72 742e 7374 7275 6374 7572 6573 2e52  krt.structures.R
+000344f0: 4f49 0a20 2020 2020 2020 2020 2020 2052  OI.            R
+00034500: 4f49 206f 626a 6563 7420 746f 2077 6869  OI object to whi
+00034510: 6368 2074 6f20 6372 6f70 2e0a 2020 2020  ch to crop..    
+00034520: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00034530: 6178 203a 2073 7472 2f69 6e74 2c20 6465  ax : str/int, de
+00034540: 6661 756c 743d 227a 220a 2020 2020 2020  fault="z".      
+00034550: 2020 2020 2020 4178 6973 2061 6c6f 6e67        Axis along
+00034560: 2077 6869 6368 2074 6f20 7065 7266 6f72   which to perfor
+00034570: 6d20 6372 6f70 7069 6e67 2e20 5368 6f75  m cropping. Shou
+00034580: 6c64 2062 6520 6f6e 6520 6f66 0a20 2020  ld be one of.   
+00034590: 2020 2020 2020 2020 205b 2278 222c 2022           ["x", "
+000345a0: 7922 2c20 227a 225d 206f 7220 5b30 2c20  y", "z"] or [0, 
+000345b0: 312c 2032 5d2e 0a20 2020 2020 2020 2022  1, 2]..        "
+000345c0: 2222 0a20 2020 2020 2020 2023 2044 6574  "".        # Det
+000345d0: 6572 6d69 6e65 2063 726f 7020 7261 6e67  ermine crop rang
+000345e0: 652e 0a20 2020 2020 2020 206c 696d 7320  e..        lims 
+000345f0: 3d20 3320 2a20 5b4e 6f6e 655d 0a20 2020  = 3 * [None].   
+00034600: 2020 2020 2069 5f61 7820 3d20 736b 7274       i_ax = skrt
+00034610: 2e69 6d61 6765 2e5f 6178 6573 2e69 6e64  .image._axes.ind
+00034620: 6578 2861 7829 2069 6620 6973 696e 7374  ex(ax) if isinst
+00034630: 616e 6365 2861 782c 2073 7472 2920 656c  ance(ax, str) el
+00034640: 7365 2061 780a 2020 2020 2020 2020 6c69  se ax.        li
+00034650: 6d73 5b69 5f61 785d 203d 206f 7468 6572  ms[i_ax] = other
+00034660: 2e67 6574 5f65 7874 656e 7428 6178 3d61  .get_extent(ax=a
+00034670: 7829 0a0a 2020 2020 2020 2020 2320 5065  x)..        # Pe
+00034680: 7266 6f72 6d20 6372 6f70 7069 6e67 2e0a  rform cropping..
+00034690: 2020 2020 2020 2020 7365 6c66 2e63 726f          self.cro
+000346a0: 7028 2a6c 696d 7329 0a0a 2020 2020 6465  p(*lims)..    de
+000346b0: 6620 6372 6f70 5f74 6f5f 726f 6928 7365  f crop_to_roi(se
+000346c0: 6c66 2c20 726f 692c 202a 2a6b 7761 7267  lf, roi, **kwarg
+000346d0: 7329 3a0a 2020 2020 2020 2020 2222 220a  s):.        """.
+000346e0: 2020 2020 2020 2020 4372 6f70 2052 4f49          Crop ROI
+000346f0: 206d 6173 6b20 746f 2072 6567 696f 6e20   mask to region 
+00034700: 636f 7665 7265 6420 6279 2061 6e20 524f  covered by an RO
+00034710: 492e 0a20 2020 2020 2020 2022 2222 0a20  I..        """. 
+00034720: 2020 2020 2020 2073 656c 662e 6372 6561         self.crea
+00034730: 7465 5f6d 6173 6b28 290a 2020 2020 2020  te_mask().      
+00034740: 2020 7365 6c66 2e6d 6173 6b2e 6372 6f70    self.mask.crop
+00034750: 5f74 6f5f 726f 6928 726f 692c 202a 2a6b  _to_roi(roi, **k
+00034760: 7761 7267 7329 0a20 2020 2020 2020 2073  wargs).        s
+00034770: 656c 662e 7368 6170 6520 3d20 7365 6c66  elf.shape = self
+00034780: 2e67 6574 5f6d 6173 6b28 292e 7368 6170  .get_mask().shap
+00034790: 650a 0a20 2020 2064 6566 2061 6464 5f70  e..    def add_p
+000347a0: 6c61 6e28 7365 6c66 2c20 706c 616e 293a  lan(self, plan):
+000347b0: 0a20 2020 2020 2020 2022 2222 4164 6420  .        """Add 
+000347c0: 6120 506c 616e 206f 626a 6563 7420 746f  a Plan object to
+000347d0: 2062 6520 6173 736f 6369 6174 6564 2077   be associated w
+000347e0: 6974 6820 7468 6973 2052 4f49 2e20 5468  ith this ROI. Th
+000347f0: 6973 0a20 2020 2020 2020 2064 6f65 7320  is.        does 
+00034800: 6e6f 7420 6166 6665 6374 2074 6865 2073  not affect the s
+00034810: 7472 7563 7475 7265 2073 6574 2061 7373  tructure set ass
+00034820: 6f63 6961 7465 6420 7769 7468 2074 6865  ociated with the
+00034830: 2050 6c61 6e20 6f62 6a65 6374 2e0a 0a20   Plan object... 
+00034840: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
+00034850: 6572 733a 2a2a 0a0a 2020 2020 2020 2020  ers:**..        
+00034860: 706c 616e 203a 2073 6b72 742e 646f 7365  plan : skrt.dose
+00034870: 2e50 6c61 6e0a 2020 2020 2020 2020 2020  .Plan.          
+00034880: 2020 4120 506c 616e 206f 626a 6563 7420    A Plan object 
+00034890: 746f 2061 7373 6967 6e20 746f 2074 6869  to assign to thi
+000348a0: 7320 7374 7275 6374 7572 6520 7365 742e  s structure set.
+000348b0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+000348c0: 2020 2020 2020 6966 206e 6f74 2070 6c61        if not pla
+000348d0: 6e20 696e 2073 656c 662e 706c 616e 733a  n in self.plans:
+000348e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000348f0: 662e 706c 616e 732e 6170 7065 6e64 2870  f.plans.append(p
+00034900: 6c61 6e29 0a20 2020 2020 2020 2020 2020  lan).           
+00034910: 2073 656c 662e 706c 616e 732e 736f 7274   self.plans.sort
+00034920: 2829 0a0a 2020 2020 6465 6620 636c 6561  ()..    def clea
+00034930: 725f 706c 616e 7328 7365 6c66 293a 0a20  r_plans(self):. 
+00034940: 2020 2020 2020 2022 2222 436c 6561 7220         """Clear 
+00034950: 616c 6c20 706c 616e 206d 6170 7320 6173  all plan maps as
+00034960: 736f 6369 6174 6564 2077 6974 6820 7468  sociated with th
+00034970: 6973 2052 4f49 2e22 2222 0a0a 2020 2020  is ROI."""..    
+00034980: 2020 2020 7365 6c66 2e70 6c61 6e73 203d      self.plans =
+00034990: 205b 5d0a 0a20 2020 2064 6566 2067 6574   []..    def get
+000349a0: 5f70 6c61 6e73 2873 656c 6629 3a0a 2020  _plans(self):.  
+000349b0: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
+000349c0: 6c69 7374 206f 6620 506c 616e 206f 626a  list of Plan obj
+000349d0: 6563 7473 2061 7373 6f63 6961 7465 6420  ects associated 
+000349e0: 7769 7468 2074 6869 7320 524f 492e 2222  with this ROI.""
+000349f0: 220a 0a20 2020 2020 2020 2072 6574 7572  "..        retur
+00034a00: 6e20 7365 6c66 2e70 6c61 6e73 0a0a 2020  n self.plans..  
+00034a10: 2020 6465 6620 6765 745f 636f 6c6f 725f    def get_color_
+00034a20: 6672 6f6d 5f6b 7761 7267 7328 7365 6c66  from_kwargs(self
+00034a30: 2c20 6b77 6172 6773 3d7b 7d2c 206b 6579  , kwargs={}, key
+00034a40: 3d27 726f 695f 636f 6c6f 7273 2729 3a0a  ='roi_colors'):.
+00034a50: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
+00034a60: 2020 2020 5265 7475 726e 2052 4f49 2063      Return ROI c
+00034a70: 6f6c 6f75 7220 7061 7373 6564 2076 6961  olour passed via
+00034a80: 2064 6963 7469 6f6e 6172 7920 6f66 206b   dictionary of k
+00034a90: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+00034aa0: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
+00034ab0: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
+00034ac0: 2020 2020 6b77 6172 6773 203a 2064 6963      kwargs : dic
+00034ad0: 742c 2064 6566 6175 6c74 3d7b 7d0a 2020  t, default={}.  
+00034ae0: 2020 2020 2020 2020 2020 4469 6374 696f            Dictio
+00034af0: 6e61 7279 206f 6620 6b65 7977 6f72 6420  nary of keyword 
+00034b00: 6172 6775 6d65 6e74 732c 2077 6869 6368  arguments, which
+00034b10: 206d 6179 2069 6e63 6c75 6465 0a20 2020   may include.   
+00034b20: 2020 2020 2020 2020 2070 6172 616d 6574           paramet
+00034b30: 6572 2070 726f 7669 6469 6e67 2064 6963  er providing dic
+00034b40: 7469 6f6e 6172 7920 6f66 2052 4f49 2063  tionary of ROI c
+00034b50: 6f6c 6f75 7273 2066 6f72 2070 6c6f 7474  olours for plott
+00034b60: 696e 672e 0a0a 2020 2020 2020 2020 6b65  ing...        ke
+00034b70: 7920 3a20 7374 722c 2064 6566 6175 6c74  y : str, default
+00034b80: 3d27 726f 695f 636f 6c6f 7273 270a 2020  ='roi_colors'.  
+00034b90: 2020 2020 2020 2020 2020 4b65 7920 696e            Key in
+00034ba0: 206b 7761 7267 7320 6469 6374 696f 6e61   kwargs dictiona
+00034bb0: 7279 2073 7065 6369 6679 696e 6720 7061  ry specifying pa
+00034bc0: 7261 6d65 7465 7220 7468 6174 2c20 6966  rameter that, if
+00034bd0: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
+00034be0: 7365 6e74 2c20 7072 6f76 6964 6573 2064  sent, provides d
+00034bf0: 6963 7469 6f6e 6172 7920 6f66 2052 4f49  ictionary of ROI
+00034c00: 2063 6f6c 6f75 7273 2e0a 2020 2020 2020   colours..      
+00034c10: 2020 2727 270a 2020 2020 2020 2020 726f    '''.        ro
+00034c20: 695f 636f 6c6f 7273 203d 206b 7761 7267  i_colors = kwarg
+00034c30: 732e 6765 7428 6b65 792c 207b 7d29 0a20  s.get(key, {}). 
+00034c40: 2020 2020 2020 2072 6574 7572 6e20 726f         return ro
+00034c50: 695f 636f 6c6f 7273 2e67 6574 2873 656c  i_colors.get(sel
+00034c60: 662e 6e61 6d65 2c20 7365 6c66 2e63 6f6c  f.name, self.col
+00034c70: 6f72 290a 0a20 2020 2064 6566 2073 706c  or)..    def spl
+00034c80: 6974 2873 656c 662c 2076 6f78 656c 5f73  it(self, voxel_s
+00034c90: 697a 653d 4e6f 6e65 2c20 6e61 6d65 733d  ize=None, names=
+00034ca0: 4e6f 6e65 2c20 6f72 6465 723d 2778 2b27  None, order='x+'
+00034cb0: 293a 0a20 2020 2020 2020 2027 2727 0a20  ):.        '''. 
+00034cc0: 2020 2020 2020 2053 706c 6974 2061 2063         Split a c
+00034cd0: 6f6d 706f 7369 7465 2052 4f49 2069 6e74  omposite ROI int
+00034ce0: 6f20 6974 7320 636f 6d70 6f6e 656e 7473  o its components
+00034cf0: 2e0a 0a20 2020 2020 2020 2041 2063 6f6d  ...        A com
+00034d00: 706f 7369 7465 2052 4f49 206d 6179 2072  posite ROI may r
+00034d10: 6573 756c 7420 6265 6361 7573 6520 7068  esult because ph
+00034d20: 7969 6361 6c6c 7920 7365 7061 7261 7465  yically separate
+00034d30: 2052 4f49 7320 6172 650a 2020 2020 2020   ROIs are.      
+00034d40: 2020 6769 7665 6e20 7468 6520 7361 6d65    given the same
+00034d50: 206c 6162 656c 2064 7572 696e 6720 6d61   label during ma
+00034d60: 6e75 616c 2063 6f6e 746f 7572 696e 672c  nual contouring,
+00034d70: 206f 7220 6265 6361 7573 650a 2020 2020   or because.    
+00034d80: 2020 2020 6d75 6c74 6970 6c65 2052 4f49      multiple ROI
+00034d90: 7320 6172 6520 7265 7475 726e 6564 2062  s are returned b
+00034da0: 7920 616e 2061 7574 6f2d 7365 676d 656e  y an auto-segmen
+00034db0: 7461 7469 6f6e 2061 6c67 6f72 6974 686d  tation algorithm
+00034dc0: 2e0a 0a20 2020 2020 2020 2054 6865 2063  ...        The c
+00034dd0: 6f6d 706f 6e65 6e74 2052 4f49 7320 6172  omponent ROIs ar
+00034de0: 6520 6964 656e 7469 6669 6564 2062 7920  e identified by 
+00034df0: 6c61 6265 6c6c 696e 6720 6120 6d61 736b  labelling a mask
+00034e00: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
+00034e10: 636f 6d70 6f73 6974 652c 2075 7369 6e67  composite, using
+00034e20: 2073 6369 7079 2e6e 6469 6d61 6765 2e6c   scipy.ndimage.l
+00034e30: 6162 656c 2829 2e0a 0a20 2020 2020 2020  abel()...       
+00034e40: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+00034e50: 0a0a 2020 2020 2020 2020 766f 7865 6c5f  ..        voxel_
+00034e60: 7369 7a65 203a 2074 7570 6c65 2c20 6465  size : tuple, de
+00034e70: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00034e80: 2020 2020 2020 2056 6f78 656c 2073 697a         Voxel siz
+00034e90: 6520 2878 2c20 7929 2064 696d 656e 7369  e (x, y) dimensi
+00034ea0: 6f6e 7320 746f 2075 7365 2069 6e20 6372  ons to use in cr
+00034eb0: 6561 7469 6e67 206d 6173 6b20 666f 720a  eating mask for.
+00034ec0: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
+00034ed0: 6c6c 696e 672e 2020 5468 6973 2063 616e  lling.  This can
+00034ee0: 2062 6520 7573 6566 756c 2069 6620 7468   be useful if th
+00034ef0: 6520 524f 4920 736f 7572 6365 2069 7320  e ROI source is 
+00034f00: 636f 6e74 6f75 720a 2020 2020 2020 2020  contour.        
+00034f10: 2020 2020 706f 696e 7473 2c20 616e 6420      points, and 
+00034f20: 7468 6520 7265 736f 6c75 7469 6f6e 2077  the resolution w
+00034f30: 616e 7465 6420 6973 2067 7265 6174 6572  anted is greater
+00034f40: 2074 6861 6e20 6973 2061 6c6c 6f77 6564   than is allowed
+00034f50: 0a20 2020 2020 2020 2020 2020 2062 7920  .            by 
+00034f60: 7468 6520 766f 7865 6c20 7369 7a65 206f  the voxel size o
+00034f70: 6620 7468 6520 524f 4920 696d 6167 652e  f the ROI image.
+00034f80: 0a0a 2020 2020 2020 2020 6e61 6d65 733a  ..        names:
+00034f90: 206c 6973 742c 2064 6566 6175 6c74 3d4e   list, default=N
+00034fa0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00034fb0: 4c69 7374 206f 6620 6e61 6d65 7320 746f  List of names to
+00034fc0: 2062 6520 6170 706c 6965 6420 746f 2074   be applied to t
+00034fd0: 6865 2063 6f6d 706f 6e65 6e74 2052 4f49  he component ROI
+00034fe0: 732e 2020 4e61 6d65 730a 2020 2020 2020  s.  Names.      
+00034ff0: 2020 2020 2020 6172 6520 6170 706c 6965        are applie
+00035000: 6420 6166 7465 7220 616e 7920 524f 4920  d after any ROI 
+00035010: 6f72 6465 7269 6e67 2e0a 0a20 2020 2020  ordering...     
+00035020: 2020 206f 7264 6572 203a 2073 7472 2c20     order : str, 
+00035030: 6465 6661 756c 743d 2778 2b27 0a20 2020  default='x+'.   
+00035040: 2020 2020 2020 2020 2053 7065 6369 6669           Specifi
+00035050: 6361 7469 6f6e 206f 6620 7761 7920 6974  cation of way it
+00035060: 2077 6869 6368 2052 4f49 7320 6172 6520   which ROIs are 
+00035070: 746f 2062 6520 6f72 6465 7264 3a0a 2020  to be orderd:.  
+00035080: 2020 2020 2020 2020 2020 2d20 2778 2b27            - 'x+'
+00035090: 203a 2069 6e20 6f72 6465 7220 6f66 2069   : in order of i
+000350a0: 6e63 7265 6173 696e 6720 7820 7661 6c75  ncreasing x valu
+000350b0: 652e 0a20 2020 2020 2020 2020 2020 202d  e..            -
+000350c0: 2027 782d 2720 3a20 696e 206f 7264 6572   'x-' : in order
+000350d0: 206f 6620 6465 6372 6561 7369 6e67 2078   of decreasing x
+000350e0: 2076 616c 7565 2e0a 2020 2020 2020 2020   value..        
+000350f0: 2020 2020 2d20 2779 2b27 203a 2069 6e20      - 'y+' : in 
+00035100: 6f72 6465 7220 6f66 2069 6e63 7265 6173  order of increas
+00035110: 696e 6720 7920 7661 6c75 652e 0a20 2020  ing y value..   
+00035120: 2020 2020 2020 2020 202d 2027 792d 2720           - 'y-' 
+00035130: 3a20 696e 206f 7264 6572 206f 6620 6465  : in order of de
+00035140: 6372 6561 7369 6e67 2079 2076 616c 7565  creasing y value
+00035150: 2e0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
+00035160: 277a 2b27 203a 2069 6e20 6f72 6465 7220  'z+' : in order 
+00035170: 6f66 2069 6e63 7265 6173 696e 6720 7a20  of increasing z 
+00035180: 7661 6c75 652e 0a20 2020 2020 2020 2020  value..         
+00035190: 2020 202d 2027 7a2d 2720 3a20 696e 206f     - 'z-' : in o
+000351a0: 7264 6572 206f 6620 6465 6372 6561 7369  rder of decreasi
+000351b0: 6e67 207a 2076 616c 7565 2e0a 2020 2020  ng z value..    
+000351c0: 2020 2020 2020 2020 4966 2061 6e79 206f          If any o
+000351d0: 7468 6572 2076 616c 7565 7320 6973 2067  ther values is g
+000351e0: 6976 656e 2c20 6e6f 206f 7264 6572 696e  iven, no orderin
+000351f0: 6720 6973 2070 6572 666f 726d 6564 2e0a  g is performed..
+00035200: 2020 2020 2020 2020 2727 270a 0a20 2020          '''..   
+00035210: 2020 2020 2023 2049 6620 6e61 6d65 7320       # If names 
+00035220: 6e6f 7420 7370 6563 6966 6965 642c 206d  not specified, m
+00035230: 616b 6520 6974 2061 6e20 656d 7074 7920  ake it an empty 
+00035240: 6c69 7374 2e0a 2020 2020 2020 2020 6966  list..        if
+00035250: 206e 616d 6573 2069 7320 4e6f 6e65 3a0a   names is None:.
+00035260: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00035270: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
+00035280: 2320 5265 7369 7a65 2052 4f49 206d 6173  # Resize ROI mas
+00035290: 6b20 6966 2076 6f78 656c 2073 697a 6520  k if voxel size 
+000352a0: 6973 2074 6f20 6265 2063 6861 6e67 6564  is to be changed
+000352b0: 2e0a 2020 2020 2020 2020 6966 2076 6f78  ..        if vox
+000352c0: 656c 5f73 697a 653a 0a20 2020 2020 2020  el_size:.       
+000352d0: 2020 2020 2072 6f69 203d 2052 4f49 2873       roi = ROI(s
+000352e0: 656c 6629 0a20 2020 2020 2020 2020 2020  elf).           
+000352f0: 2076 6f78 656c 5f73 697a 655f 3364 203d   voxel_size_3d =
+00035300: 2028 766f 7865 6c5f 7369 7a65 5b30 5d2c   (voxel_size[0],
+00035310: 2076 6f78 656c 5f73 697a 655b 315d 2c20   voxel_size[1], 
+00035320: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
+00035330: 2020 726f 692e 6372 6561 7465 5f6d 6173    roi.create_mas
+00035340: 6b28 290a 2020 2020 2020 2020 2020 2020  k().            
+00035350: 726f 692e 6d61 736b 2e72 6573 697a 6528  roi.mask.resize(
+00035360: 766f 7865 6c5f 7369 7a65 3d76 6f78 656c  voxel_size=voxel
+00035370: 5f73 697a 655f 3364 2c20 6d65 7468 6f64  _size_3d, method
+00035380: 3d27 6e65 6172 6573 7427 2c0a 2020 2020  ='nearest',.    
+00035390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000353a0: 696d 6167 655f 7369 7a65 5f75 6e69 743d  image_size_unit=
+000353b0: 276d 6d27 290a 2020 2020 2020 2020 2020  'mm').          
+000353c0: 2020 726f 692e 7365 745f 696d 6167 6528    roi.set_image(
+000353d0: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
+000353e0: 2872 6f69 2e6d 6173 6b29 290a 2020 2020  (roi.mask)).    
+000353f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00035400: 2020 2020 2020 726f 6920 3d20 7365 6c66        roi = self
+00035410: 0a20 0a20 2020 2020 2020 2023 204c 6162  . .        # Lab
+00035420: 656c 2052 4f49 2063 6f6d 706f 6e65 6e74  el ROI component
+00035430: 732e 0a20 2020 2020 2020 206c 6162 656c  s..        label
+00035440: 5f6d 6173 6b2c 206e 5f6c 6162 656c 203d  _mask, n_label =
+00035450: 206e 6469 6d61 6765 2e6c 6162 656c 2872   ndimage.label(r
+00035460: 6f69 2e67 6574 5f6d 6173 6b28 2929 0a0a  oi.get_mask())..
+00035470: 2020 2020 2020 2020 6966 2076 6f78 656c          if voxel
+00035480: 5f73 697a 6520 616e 6420 2763 6f6e 746f  _size and 'conto
+00035490: 7572 2720 3d3d 2073 656c 662e 736f 7572  ur' == self.sour
+000354a0: 6365 5f74 7970 653a 0a20 2020 2020 2020  ce_type:.       
+000354b0: 2020 2020 2023 2048 616e 646c 6520 6361       # Handle ca
+000354c0: 7365 7320 7768 6572 6520 636f 6d70 6f73  ses where compos
+000354d0: 6974 6520 524f 4920 6973 2066 726f 6d20  ite ROI is from 
+000354e0: 636f 6e74 6f75 7220 706f 696e 7473 2c0a  contour points,.
+000354f0: 2020 2020 2020 2020 2020 2020 2320 616e              # an
+00035500: 6420 6d61 736b 2076 6f78 656c 2073 697a  d mask voxel siz
+00035510: 6520 6861 7320 6265 656e 2070 6173 7365  e has been passe
+00035520: 6420 6173 2061 6e20 6172 6775 6d65 6e74  d as an argument
+00035530: 2e0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00035540: 496e 2074 6869 7320 6361 7365 2063 6f6d  In this case com
+00035550: 706f 6e65 6e74 2052 4f49 7320 6172 6520  ponent ROIs are 
+00035560: 696e 6974 6961 6c69 7365 6420 6672 6f6d  initialised from
+00035570: 2063 6f6e 746f 7572 730a 2020 2020 2020   contours.      
+00035580: 2020 2020 2020 2320 7265 6372 6561 7465        # recreate
+00035590: 6420 6672 6f6d 2074 6865 206d 6173 6b2c  d from the mask,
+000355a0: 2077 6869 6368 206d 6179 2062 6520 6869   which may be hi
+000355b0: 6768 6572 2d72 6573 6f6c 7574 696f 6e0a  gher-resolution.
+000355c0: 2020 2020 2020 2020 2020 2020 2320 7468              # th
+000355d0: 616e 2074 6865 2064 6566 6175 6c74 2e0a  an the default..
+000355e0: 2020 2020 2020 2020 2020 2020 7373 3020              ss0 
+000355f0: 3d20 5374 7275 6374 7572 6553 6574 286c  = StructureSet(l
+00035600: 6162 656c 5f6d 6173 6b2c 206d 756c 7469  abel_mask, multi
+00035610: 5f6c 6162 656c 3d54 7275 652c 2069 6d61  _label=True, ima
+00035620: 6765 3d72 6f69 2e6d 6173 6b29 0a20 2020  ge=roi.mask).   
+00035630: 2020 2020 2020 2020 2073 7320 3d20 5374           ss = St
+00035640: 7275 6374 7572 6553 6574 2829 0a20 2020  ructureSet().   
+00035650: 2020 2020 2020 2020 2066 6f72 2072 6f69           for roi
+00035660: 2069 6e20 7373 302e 6765 745f 726f 6973   in ss0.get_rois
+00035670: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00035680: 2020 2020 7373 2e61 6464 5f72 6f69 2852      ss.add_roi(R
+00035690: 4f49 2873 6f75 7263 653d 726f 692e 6765  OI(source=roi.ge
+000356a0: 745f 636f 6e74 6f75 7273 2829 2c20 6e61  t_contours(), na
+000356b0: 6d65 3d72 6f69 2e6e 616d 6529 290a 2020  me=roi.name)).  
+000356c0: 2020 2020 2020 2020 2020 7373 2e73 6574            ss.set
+000356d0: 5f69 6d61 6765 2873 656c 662e 696d 6167  _image(self.imag
+000356e0: 6529 0a20 2020 2020 2020 2065 6c73 653a  e).        else:
+000356f0: 0a20 2020 2020 2020 2020 2020 2023 2048  .            # H
+00035700: 616e 646c 6520 6361 7365 7320 7768 6572  andle cases wher
+00035710: 6520 636f 6d70 6f6e 656e 7420 524f 4973  e component ROIs
+00035720: 2061 7265 2069 6e69 7469 616c 6973 6564   are initialised
+00035730: 2066 726f 6d20 6d61 736b 2e0a 2020 2020   from mask..    
+00035740: 2020 2020 2020 2020 6966 2076 6f78 656c          if voxel
+00035750: 5f73 697a 653a 0a20 2020 2020 2020 2020  _size:.         
+00035760: 2020 2020 2020 2023 2049 6620 766f 7865         # If voxe
+00035770: 6c20 7369 7a65 2063 6861 6e67 6564 2066  l size changed f
+00035780: 6f72 206c 6162 656c 6c69 6e67 2c0a 2020  or labelling,.  
+00035790: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000357a0: 7265 6372 6561 7465 206c 6162 656c 206d  recreate label m
+000357b0: 6173 6b20 7769 7468 206f 7269 6769 6e61  ask with origina
+000357c0: 6c20 766f 7865 6c20 7369 7a65 2e0a 2020  l voxel size..  
+000357d0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+000357e0: 692e 6d61 736b 2e64 6174 6120 3d20 6c61  i.mask.data = la
+000357f0: 6265 6c5f 6d61 736b 0a20 2020 2020 2020  bel_mask.       
+00035800: 2020 2020 2020 2020 2072 6f69 2e6d 6173           roi.mas
+00035810: 6b2e 6d61 7463 685f 7369 7a65 2873 656c  k.match_size(sel
+00035820: 662e 696d 6167 652c 206d 6574 686f 643d  f.image, method=
+00035830: 276e 6561 7265 7374 2729 0a20 2020 2020  'nearest').     
+00035840: 2020 2020 2020 2020 2020 206c 6162 656c             label
+00035850: 5f6d 6173 6b20 3d20 726f 692e 6d61 736b  _mask = roi.mask
+00035860: 2e64 6174 610a 0a20 2020 2020 2020 2020  .data..         
+00035870: 2020 2023 2043 7265 6174 6520 7374 7275     # Create stru
+00035880: 6374 7572 6520 7365 7420 6672 6f6d 206c  cture set from l
+00035890: 6162 656c 206d 6173 6b2e 0a20 2020 2020  abel mask..     
+000358a0: 2020 2020 2020 2073 7320 3d20 5374 7275         ss = Stru
+000358b0: 6374 7572 6553 6574 286c 6162 656c 5f6d  ctureSet(label_m
+000358c0: 6173 6b2c 206d 756c 7469 5f6c 6162 656c  ask, multi_label
+000358d0: 3d54 7275 652c 2069 6d61 6765 3d73 656c  =True, image=sel
+000358e0: 662e 696d 6167 6529 0a0a 2020 2020 2020  f.image)..      
+000358f0: 2020 2320 5374 6f72 6520 524f 4973 2069    # Store ROIs i
+00035900: 6e20 7370 6563 6966 6965 6420 6f72 6465  n specified orde
+00035910: 722e 0a20 2020 2020 2020 2073 732e 6f72  r..        ss.or
+00035920: 6465 725f 726f 6973 286f 7264 6572 290a  der_rois(order).
+00035930: 0a20 2020 2020 2020 2023 2041 7070 6c79  .        # Apply
+00035940: 206e 616d 6573 2e0a 2020 2020 2020 2020   names..        
+00035950: 666f 7220 6920 696e 2072 616e 6765 286d  for i in range(m
+00035960: 696e 286c 656e 286e 616d 6573 292c 206c  in(len(names), l
+00035970: 656e 2873 732e 726f 6973 2929 293a 0a20  en(ss.rois))):. 
+00035980: 2020 2020 2020 2020 2020 2073 732e 726f             ss.ro
+00035990: 6973 5b69 5d2e 6e61 6d65 203d 206e 616d  is[i].name = nam
+000359a0: 6573 5b69 5d0a 0a20 2020 2020 2020 2072  es[i]..        r
+000359b0: 6574 7572 6e20 7373 0a0a 2020 2020 6465  eturn ss..    de
+000359c0: 6620 7370 6c69 745f 696e 5f74 776f 2873  f split_in_two(s
+000359d0: 656c 662c 2061 7869 733d 2778 272c 2076  elf, axis='x', v
+000359e0: 303d 302c 206e 616d 6573 3d4e 6f6e 652c  0=0, names=None,
+000359f0: 293a 0a20 2020 2020 2020 2027 2727 0a20  ):.        '''. 
+00035a00: 2020 2020 2020 2053 706c 6974 2061 2063         Split a c
+00035a10: 6f6d 706f 7369 7465 2052 4f49 2069 6e74  omposite ROI int
+00035a20: 6f20 7477 6f20 636f 6d70 6f6e 656e 7420  o two component 
+00035a30: 7061 7274 732e 0a0a 2020 2020 2020 2020  parts...        
+00035a40: 5370 6c69 7420 616e 2052 4f49 2069 6e74  Split an ROI int
+00035a50: 6f20 7477 6f20 636f 6d70 6f6e 656e 7473  o two components
+00035a60: 2c20 6569 7468 6572 2073 6964 6520 6f66  , either side of
+00035a70: 2061 2073 7065 6369 6669 6564 0a20 2020   a specified.   
+00035a80: 2020 2020 2070 6c61 6e65 2e20 2054 6869       plane.  Thi
+00035a90: 7320 6d61 7920 6265 2075 7365 6675 6c2c  s may be useful,
+00035aa0: 2066 6f72 2065 7861 6d70 6c65 2c20 7768   for example, wh
+00035ab0: 656e 206c 6566 7420 616e 6420 7269 6768  en left and righ
+00035ac0: 740a 2020 2020 2020 2020 524f 4973 2068  t.        ROIs h
+00035ad0: 6176 6520 6265 656e 2061 7373 6967 6e65  ave been assigne
+00035ae0: 6420 6120 636f 6d6d 6f6e 206c 6162 656c  d a common label
+00035af0: 2e0a 0a20 2020 2020 2020 2046 6f72 206d  ...        For m
+00035b00: 6f72 6520 6765 6e65 7261 6c20 524f 4920  ore general ROI 
+00035b10: 7370 6c69 7474 696e 672c 2073 6565 2073  splitting, see s
+00035b20: 6b72 742e 7374 7275 6374 7572 652e 524f  krt.structure.RO
+00035b30: 492e 7370 6c69 7428 292e 0a20 2020 2020  I.split()..     
+00035b40: 2020 204e 6f74 6520 7468 6174 2073 706c     Note that spl
+00035b50: 6974 2829 2061 6374 7320 6f6e 2062 696e  it() acts on bin
+00035b60: 6172 7920 6d61 736b 732c 2077 6865 7265  ary masks, where
+00035b70: 6173 2073 706c 6974 5f69 6e5f 7477 6f28  as split_in_two(
+00035b80: 290a 2020 2020 2020 2020 6163 7473 206f  ).        acts o
+00035b90: 6e20 636f 6e74 6f75 7273 2e0a 0a20 2020  n contours...   
+00035ba0: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
+00035bb0: 733a 2a2a 0a0a 2020 2020 2020 2020 6178  s:**..        ax
+00035bc0: 6973 203a 2027 7374 7227 2c20 6465 6661  is : 'str', defa
+00035bd0: 756c 743d 2778 270a 2020 2020 2020 2020  ult='x'.        
+00035be0: 2020 2020 4178 6973 2028 2778 272c 2027      Axis ('x', '
+00035bf0: 7927 206f 7220 277a 2729 2070 6572 7065  y' or 'z') perpe
+00035c00: 6e64 6963 756c 6172 2074 6f20 706c 616e  ndicular to plan
+00035c10: 6520 6162 6f75 7420 7768 6963 680a 2020  e about which.  
+00035c20: 2020 2020 2020 2020 2020 524f 4920 6973            ROI is
+00035c30: 2074 6f20 6265 2073 706c 6974 2e0a 0a20   to be split... 
+00035c40: 2020 2020 2020 2076 3020 3a20 666c 6f61         v0 : floa
+00035c50: 742c 2064 6566 6175 6c74 3d30 0a20 2020  t, default=0.   
+00035c60: 2020 2020 2020 2020 2043 6f6f 7264 696e           Coordin
+00035c70: 6174 6520 616c 6f6e 6720 7365 6c65 6374  ate along select
+00035c80: 6564 2061 7869 732c 2073 7065 6369 6679  ed axis, specify
+00035c90: 696e 6720 706c 616e 6520 6162 6f75 7420  ing plane about 
+00035ca0: 7768 6963 680a 2020 2020 2020 2020 2020  which.          
+00035cb0: 2020 524f 4920 6973 2074 6f20 6265 2073    ROI is to be s
+00035cc0: 706c 6974 2e0a 0a20 2020 2020 2020 206e  plit...        n
+00035cd0: 616d 6573 3a20 6c69 7374 2c20 6465 6661  ames: list, defa
+00035ce0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+00035cf0: 2020 2020 204c 6973 7420 6f66 206e 616d       List of nam
+00035d00: 6573 2074 6f20 6265 2061 7070 6c69 6564  es to be applied
+00035d10: 2074 6f20 7468 6520 636f 6d70 6f6e 656e   to the componen
+00035d20: 7420 524f 4973 2e0a 2020 2020 2020 2020  t ROIs..        
+00035d30: 2727 270a 0a20 2020 2020 2020 2023 2049  '''..        # I
+00035d40: 6620 6e61 6d65 7320 6e6f 7420 7370 6563  f names not spec
+00035d50: 6966 6965 642c 2069 6e69 7469 616c 6973  ified, initialis
+00035d60: 6520 746f 2065 6d70 7479 206c 6973 742e  e to empty list.
+00035d70: 0a20 2020 2020 2020 2069 6620 6e61 6d65  .        if name
+00035d80: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+00035d90: 2020 2020 2020 206e 616d 6573 203d 205b         names = [
+00035da0: 5d0a 0a20 2020 2020 2020 2023 2042 6173  ]..        # Bas
+00035db0: 6564 206f 6e20 7365 6c65 6374 6564 2061  ed on selected a
+00035dc0: 7869 732c 2064 6566 696e 6520 7669 6577  xis, define view
+00035dd0: 2061 6e64 2064 6566 6175 6c74 206e 616d   and default nam
+00035de0: 6520 7375 6666 6978 6573 2e0a 2020 2020  e suffixes..    
+00035df0: 2020 2020 6966 2027 7827 203d 3d20 6178      if 'x' == ax
+00035e00: 6973 2e6c 6f77 6572 2829 3a0a 2020 2020  is.lower():.    
+00035e10: 2020 2020 2020 2020 7669 6577 203d 2027          view = '
+00035e20: 782d 7927 0a20 2020 2020 2020 2020 2020  x-y'.           
+00035e30: 2073 7566 6669 7865 7320 3d20 2827 7269   suffixes = ('ri
+00035e40: 6768 7427 2c20 276c 6566 7427 290a 2020  ght', 'left').  
+00035e50: 2020 2020 2020 656c 6966 2027 7927 203d        elif 'y' =
+00035e60: 3d20 6178 6973 2e6c 6f77 6572 2829 3a0a  = axis.lower():.
+00035e70: 2020 2020 2020 2020 2020 2020 7669 6577              view
+00035e80: 203d 2027 782d 7927 0a20 2020 2020 2020   = 'x-y'.       
+00035e90: 2020 2020 2073 7566 6669 7865 7320 3d20       suffixes = 
+00035ea0: 2827 616e 7465 7269 6f72 272c 2027 706f  ('anterior', 'po
+00035eb0: 7374 6572 696f 7227 290a 2020 2020 2020  sterior').      
+00035ec0: 2020 656c 6966 2027 7a27 203d 3d20 6178    elif 'z' == ax
+00035ed0: 6973 2e6c 6f77 6572 2829 3a0a 2020 2020  is.lower():.    
+00035ee0: 2020 2020 2020 2020 7669 6577 203d 2027          view = '
+00035ef0: 792d 7a27 0a20 2020 2020 2020 2020 2020  y-z'.           
+00035f00: 2073 7566 6669 7865 7320 3d20 2827 696e   suffixes = ('in
+00035f10: 6665 7269 6f72 272c 2027 7375 7065 7269  ferior', 'superi
+00035f20: 6f72 2729 0a20 2020 2020 2020 2020 2020  or').           
+00035f30: 2023 2049 6e20 7468 6520 2779 2d7a 2720   # In the 'y-z' 
+00035f40: 7669 6577 2c20 7920 616e 6420 7a20 6178  view, y and z ax
+00035f50: 6573 206d 6170 2074 6f20 7368 6170 656c  es map to shapel
+00035f60: 7920 7820 616e 6420 7920 6178 6573 2e0a  y x and y axes..
+00035f70: 2020 2020 2020 2020 2020 2020 6178 6973              axis
+00035f80: 203d 2027 7927 0a0a 2020 2020 2020 2020   = 'y'..        
+00035f90: 2320 4465 6669 6e65 2070 6f6c 7967 6f6e  # Define polygon
+00035fa0: 2072 6570 7265 7365 6e74 696e 6720 524f   representing RO
+00035fb0: 4920 636f 6e74 6f75 7220 6173 206c 6f77  I contour as low
+00035fc0: 206f 7220 6869 6768 2c0a 2020 2020 2020   or high,.      
+00035fd0: 2020 2320 6465 7065 6e64 696e 6720 6f6e    # depending on
+00035fe0: 2077 6865 7468 6572 2074 6865 2070 6f6c   whether the pol
+00035ff0: 7967 6f6e 2063 656e 7472 6f69 6420 6973  ygon centroid is
+00036000: 206c 6f77 6572 206f 7220 6869 6768 6572   lower or higher
+00036010: 0a20 2020 2020 2020 2023 2074 6861 6e20  .        # than 
+00036020: 7468 6520 636f 6f72 6469 6e61 7465 206f  the coordinate o
+00036030: 6620 7468 6520 7370 6c69 7474 696e 6720  f the splitting 
+00036040: 706c 616e 652e 0a20 2020 2020 2020 2070  plane..        p
+00036050: 6f6c 7967 6f6e 735f 6c6f 7720 3d20 7b7d  olygons_low = {}
+00036060: 0a20 2020 2020 2020 2070 6f6c 7967 6f6e  .        polygon
+00036070: 735f 6869 6768 203d 207b 7d0a 2020 2020  s_high = {}.    
+00036080: 2020 2020 666f 7220 7a2c 2070 6f6c 7967      for z, polyg
+00036090: 6f6e 7320 696e 2073 656c 662e 6765 745f  ons in self.get_
+000360a0: 706f 6c79 676f 6e73 2876 6965 7729 2e69  polygons(view).i
+000360b0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+000360c0: 2020 2020 666f 7220 706f 6c79 676f 6e20      for polygon 
+000360d0: 696e 2070 6f6c 7967 6f6e 733a 0a20 2020  in polygons:.   
+000360e0: 2020 2020 2020 2020 2020 2020 2076 203d               v =
+000360f0: 2067 6574 6174 7472 2870 6f6c 7967 6f6e   getattr(polygon
+00036100: 2e63 656e 7472 6f69 642c 2061 7869 7329  .centroid, axis)
+00036110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036120: 2069 6620 7620 3c20 7630 3a0a 2020 2020   if v < v0:.    
+00036130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036140: 6966 206e 6f74 207a 2069 6e20 706f 6c79  if not z in poly
+00036150: 676f 6e73 5f6c 6f77 3a0a 2020 2020 2020  gons_low:.      
+00036160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036170: 2020 706f 6c79 676f 6e73 5f6c 6f77 5b7a    polygons_low[z
+00036180: 5d20 3d20 5b5d 0a20 2020 2020 2020 2020  ] = [].         
+00036190: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+000361a0: 6f6e 735f 6c6f 775b 7a5d 2e61 7070 656e  ons_low[z].appen
+000361b0: 6428 706f 6c79 676f 6e29 0a20 2020 2020  d(polygon).     
+000361c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000361d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000361e0: 2020 2020 2069 6620 6e6f 7420 7a20 696e       if not z in
+000361f0: 2070 6f6c 7967 6f6e 735f 6869 6768 3a0a   polygons_high:.
+00036200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036210: 2020 2020 2020 2020 706f 6c79 676f 6e73          polygons
+00036220: 5f68 6967 685b 7a5d 203d 205b 5d0a 2020  _high[z] = [].  
+00036230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036240: 2020 706f 6c79 676f 6e73 5f68 6967 685b    polygons_high[
+00036250: 7a5d 2e61 7070 656e 6428 706f 6c79 676f  z].append(polygo
+00036260: 6e29 0a0a 0a20 2020 2020 2020 2023 2043  n)...        # C
+00036270: 7265 6174 6520 524f 4920 6672 6f6d 2070  reate ROI from p
+00036280: 6f6c 7967 6f6e 7320 6265 6c6f 7720 7468  olygons below th
+00036290: 6520 7370 6c69 7474 696e 6720 706c 616e  e splitting plan
+000362a0: 652e 0a20 2020 2020 2020 2069 6620 706f  e..        if po
+000362b0: 6c79 676f 6e73 5f6c 6f77 3a0a 2020 2020  lygons_low:.    
+000362c0: 2020 2020 2020 2020 726f 695f 6c6f 7720          roi_low 
+000362d0: 3d20 524f 4928 736f 7572 6365 3d70 6f6c  = ROI(source=pol
+000362e0: 7967 6f6e 735f 6c6f 772c 2069 6d61 6765  ygons_low, image
+000362f0: 3d73 656c 662e 696d 6167 6529 0a20 2020  =self.image).   
+00036300: 2020 2020 2020 2020 2072 6f69 5f6c 6f77           roi_low
+00036310: 2e6e 616d 6520 3d20 286e 616d 6573 5b30  .name = (names[0
+00036320: 5d20 6966 206c 656e 286e 616d 6573 2920  ] if len(names) 
+00036330: 3e20 300a 2020 2020 2020 2020 2020 2020  > 0.            
+00036340: 2020 2020 2020 2020 656c 7365 2066 277b          else f'{
+00036350: 7365 6c66 2e6e 616d 657d 5f7b 7375 6666  self.name}_{suff
+00036360: 6978 6573 5b30 5d7d 2729 0a20 2020 2020  ixes[0]}').     
+00036370: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00036380: 2020 2020 2072 6f69 5f6c 6f77 203d 204e       roi_low = N
+00036390: 6f6e 650a 0a20 2020 2020 2020 2023 2043  one..        # C
+000363a0: 7265 6174 6520 524f 4920 6672 6f6d 2070  reate ROI from p
+000363b0: 6f6c 7967 6f6e 7320 6162 6f76 6520 7468  olygons above th
+000363c0: 6520 7370 6c69 7474 696e 6720 706c 616e  e splitting plan
+000363d0: 652e 0a20 2020 2020 2020 2069 6620 706f  e..        if po
+000363e0: 6c79 676f 6e73 5f68 6967 683a 0a20 2020  lygons_high:.   
+000363f0: 2020 2020 2020 2020 2072 6f69 5f68 6967           roi_hig
+00036400: 6820 3d20 524f 4928 736f 7572 6365 3d70  h = ROI(source=p
+00036410: 6f6c 7967 6f6e 735f 6869 6768 2c20 696d  olygons_high, im
+00036420: 6167 653d 7365 6c66 2e69 6d61 6765 290a  age=self.image).
+00036430: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
+00036440: 6869 6768 2e6e 616d 6520 3d20 286e 616d  high.name = (nam
+00036450: 6573 5b31 5d20 6966 206c 656e 286e 616d  es[1] if len(nam
+00036460: 6573 2920 3e20 310a 2020 2020 2020 2020  es) > 1.        
+00036470: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00036480: 2066 277b 7365 6c66 2e6e 616d 657d 5f7b   f'{self.name}_{
+00036490: 7375 6666 6978 6573 5b31 5d7d 2729 0a20  suffixes[1]}'). 
+000364a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000364b0: 2020 2020 2020 2020 2072 6f69 5f68 6967           roi_hig
+000364c0: 6820 3d20 4e6f 6e65 0a0a 2020 2020 2020  h = None..      
+000364d0: 2020 2320 4372 6561 7465 2073 7472 7563    # Create struc
+000364e0: 7475 7265 2073 6574 2066 6f72 2063 6f6d  ture set for com
+000364f0: 706f 6e65 6e74 2052 4f49 2873 292e 0a20  ponent ROI(s).. 
+00036500: 2020 2020 2020 2072 6f69 7320 3d20 6c69         rois = li
+00036510: 7374 2866 696c 7465 7228 4e6f 6e65 2c20  st(filter(None, 
+00036520: 5b72 6f69 5f6c 6f77 2c20 726f 695f 6869  [roi_low, roi_hi
+00036530: 6768 5d29 290a 2020 2020 2020 2020 6966  gh])).        if
+00036540: 2072 6f69 733a 0a20 2020 2020 2020 2020   rois:.         
+00036550: 2020 2073 7320 3d20 5374 7275 6374 7572     ss = Structur
+00036560: 6553 6574 2870 6174 683d 726f 6973 2c20  eSet(path=rois, 
+00036570: 6e61 6d65 3d73 656c 662e 6e61 6d65 2c20  name=self.name, 
+00036580: 696d 6167 653d 7365 6c66 2e69 6d61 6765  image=self.image
+00036590: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+000365a0: 2020 2020 2020 2020 2020 2020 7373 203d              ss =
+000365b0: 204e 6f6e 650a 0a20 2020 2020 2020 2072   None..        r
+000365c0: 6574 7572 6e20 7373 0a0a 2020 2020 6465  eturn ss..    de
+000365d0: 6620 6765 745f 7061 7463 6828 7365 6c66  f get_patch(self
+000365e0: 2c20 706c 6f74 5f74 7970 653d 4e6f 6e65  , plot_type=None
+000365f0: 2c20 636f 6c6f 723d 4e6f 6e65 2c20 6f70  , color=None, op
+00036600: 6163 6974 793d 4e6f 6e65 2c0a 2020 2020  acity=None,.    
+00036610: 2020 2020 2020 2020 6c69 6e65 7769 6474          linewidt
+00036620: 683d 4e6f 6e65 2c20 6e61 6d65 3d4e 6f6e  h=None, name=Non
+00036630: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
+00036640: 2020 2020 2020 2020 4f62 7461 696e 2070          Obtain p
+00036650: 6174 6368 2072 6566 6c65 6374 696e 6720  atch reflecting 
+00036660: 524f 4920 6368 6172 6163 7465 7269 7374  ROI characterist
+00036670: 6963 7320 666f 7220 706c 6f74 7469 6e67  ics for plotting
+00036680: 2e0a 0a20 2020 2020 2020 2054 6865 2070  ...        The p
+00036690: 6174 6368 206f 6274 6169 6e65 6420 6361  atch obtained ca
+000366a0: 6e20 6265 2075 7365 6420 6173 2061 2068  n be used as a h
+000366b0: 616e 646c 6520 696e 206c 6567 656e 6420  andle in legend 
+000366c0: 6372 6561 7469 6f6e 2e0a 0a20 2020 2020  creation...     
+000366d0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+000366e0: 2a2a 0a0a 2020 2020 2020 2020 706c 6f74  **..        plot
+000366f0: 5f74 7970 6520 3a20 7374 722c 2064 6566  _type : str, def
+00036700: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+00036710: 2020 2020 2020 506c 6f74 7469 6e67 2074        Plotting t
+00036720: 7970 652e 2049 6620 4e6f 6e65 2c20 7769  ype. If None, wi
+00036730: 6c6c 2062 6520 6569 7468 6572 2022 636f  ll be either "co
+00036740: 6e74 6f75 7222 206f 7220 226d 6173 6b22  ntour" or "mask"
+00036750: 200a 2020 2020 2020 2020 2020 2020 6465   .            de
+00036760: 7065 6e64 696e 6720 6f6e 2074 6865 2069  pending on the i
+00036770: 6e70 7574 2074 7970 6520 6f66 2074 6865  nput type of the
+00036780: 2052 4f49 2e20 4f70 7469 6f6e 733a 0a0a   ROI. Options:..
+00036790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000367a0: 2d20 2263 6f6e 746f 7572 220a 2020 2020  - "contour".    
+000367b0: 2020 2020 2020 2020 2020 2020 2d20 226d              - "m
+000367c0: 6173 6b22 0a20 2020 2020 2020 2020 2020  ask".           
+000367d0: 2020 2020 202d 2022 6365 6e74 726f 6964       - "centroid
+000367e0: 2220 2863 6f6e 746f 7572 2077 6974 6820  " (contour with 
+000367f0: 6d61 726b 6572 2061 7420 6365 6e74 726f  marker at centro
+00036800: 6964 290a 2020 2020 2020 2020 2020 2020  id).            
+00036810: 2020 2020 2d20 2266 696c 6c65 6422 2028      - "filled" (
+00036820: 7472 616e 7370 6172 656e 7420 6d61 736b  transparent mask
+00036830: 202b 2063 6f6e 746f 7572 290a 2020 2020   + contour).    
+00036840: 2020 2020 2020 2020 2020 2020 2d20 2266              - "f
+00036850: 696c 6c65 6420 6365 6e74 726f 6964 2220  illed centroid" 
+00036860: 2866 696c 6c65 6420 7769 7468 206d 6172  (filled with mar
+00036870: 6b65 7220 6174 2063 656e 7472 6f69 6429  ker at centroid)
+00036880: 0a0a 2020 2020 2020 2020 636f 6c6f 7220  ..        color 
+00036890: 3a20 6d61 7470 6c6f 746c 6962 2063 6f6c  : matplotlib col
+000368a0: 6f72 2c20 6465 6661 756c 743d 4e6f 6e65  or, default=None
+000368b0: 0a20 2020 2020 2020 2020 2020 2043 6f6c  .            Col
+000368c0: 6f72 2077 6974 6820 7768 6963 6820 746f  or with which to
+000368d0: 2070 6c6f 7420 7468 6520 524f 493b 206f   plot the ROI; o
+000368e0: 7665 7272 6964 6573 2074 6865 2052 4f49  verrides the ROI
+000368f0: 2773 206f 776e 2063 6f6c 6f72 2e20 4966  's own color. If
+00036900: 200a 2020 2020 2020 2020 2020 2020 4e6f   .            No
+00036910: 6e65 2c20 7365 6c66 2e63 6f6c 6f72 2077  ne, self.color w
+00036920: 696c 6c20 6265 2075 7365 642e 0a0a 2020  ill be used...  
+00036930: 2020 2020 2020 6f70 6163 6974 7920 3a20        opacity : 
+00036940: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+00036950: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00036960: 4f70 6163 6974 7920 746f 2075 7365 2069  Opacity to use i
+00036970: 6620 706c 6f74 7469 6e67 206d 6173 6b20  f plotting mask 
+00036980: 2869 2e65 2e20 706c 6f74 2074 7970 6573  (i.e. plot types
+00036990: 2022 6d61 736b 222c 2022 6669 6c6c 6564   "mask", "filled
+000369a0: 222c 200a 2020 2020 2020 2020 2020 2020  ", .            
+000369b0: 6f72 2022 6669 6c6c 6564 2063 656e 7472  or "filled centr
+000369c0: 6f69 6422 292e 2049 6620 4e6f 6e65 2c20  oid"). If None, 
+000369d0: 6f70 6163 6974 7920 7769 6c6c 2062 6520  opacity will be 
+000369e0: 3120 6279 2064 6566 6175 6c74 2066 6f72  1 by default for
+000369f0: 200a 2020 2020 2020 2020 2020 2020 736f   .            so
+00036a00: 6c69 6420 6d61 736b 2070 6c6f 7473 2061  lid mask plots a
+00036a10: 6e64 2030 2e33 2062 7920 6465 6661 756c  nd 0.3 by defaul
+00036a20: 7420 666f 7220 6669 6c6c 6564 2070 6c6f  t for filled plo
+00036a30: 7473 2e0a 0a20 2020 2020 2020 206c 696e  ts...        lin
+00036a40: 6577 6964 7468 203a 2066 6c6f 6174 2c20  ewidth : float, 
+00036a50: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00036a60: 2020 2020 2020 2020 2057 6964 7468 206f           Width o
+00036a70: 6620 636f 6e74 6f75 7220 6c69 6e65 732e  f contour lines.
+00036a80: 2049 6620 4e6f 6e65 2c20 7468 6520 6d61   If None, the ma
+00036a90: 7470 6c6f 746c 6962 2064 6566 6175 6c74  tplotlib default
+00036aa0: 2073 6574 7469 6e67 200a 2020 2020 2020   setting .      
+00036ab0: 2020 2020 2020 7769 6c6c 2062 6520 7573        will be us
+00036ac0: 6564 2e0a 0a20 2020 2020 2020 206e 616d  ed...        nam
+00036ad0: 6520 3a20 7374 722c 2064 6566 6175 6c74  e : str, default
+00036ae0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+00036af0: 2020 4e61 6d65 2069 6465 6e74 6966 7969    Name identifyi
+00036b00: 6e67 2052 4f49 2e20 2049 6620 4e6f 6e65  ng ROI.  If None
+00036b10: 2c20 7365 6c66 2e6e 616d 6520 7769 6c6c  , self.name will
+00036b20: 2062 6520 7573 6564 2e0a 2020 2020 2020   be used..      
+00036b30: 2020 2222 220a 0a20 2020 2020 2020 2023    """..        #
+00036b40: 2045 6e73 7572 6520 7468 6174 2070 6c6f   Ensure that plo
+00036b50: 7474 696e 6720 6368 6172 6163 7465 7269  tting characteri
+00036b60: 7374 6963 7320 6172 6520 6465 6669 6e65  stics are define
+00036b70: 642e 0a20 2020 2020 2020 2069 6620 706c  d..        if pl
+00036b80: 6f74 5f74 7970 6520 6973 204e 6f6e 653a  ot_type is None:
+00036b90: 0a20 2020 2020 2020 2020 2020 2070 6c6f  .            plo
+00036ba0: 745f 7479 7065 203d 2073 656c 662e 6465  t_type = self.de
+00036bb0: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
+00036bc0: 640a 0a20 2020 2020 2020 2069 6620 636f  d..        if co
+00036bd0: 6c6f 7220 6973 204e 6f6e 653a 0a20 2020  lor is None:.   
+00036be0: 2020 2020 2020 2020 2063 6f6c 6f72 203d           color =
+00036bf0: 2073 656c 662e 636f 6c6f 720a 0a20 2020   self.color..   
+00036c00: 2020 2020 2069 6620 6f70 6163 6974 7920       if opacity 
+00036c10: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00036c20: 2020 2020 206f 7061 6369 7479 203d 2030       opacity = 0
+00036c30: 2e33 2069 6620 2266 696c 6c65 6422 2069  .3 if "filled" i
+00036c40: 6e20 706c 6f74 5f74 7970 6520 656c 7365  n plot_type else
+00036c50: 2031 0a0a 2020 2020 2020 2020 6966 206c   1..        if l
+00036c60: 696e 6577 6964 7468 2069 7320 4e6f 6e65  inewidth is None
+00036c70: 3a0a 2020 2020 2020 2020 2020 2020 6c69  :.            li
+00036c80: 6e65 7769 6474 6820 3d20 6465 6661 756c  newidth = defaul
+00036c90: 7450 6172 616d 735b 226c 696e 6573 2e6c  tParams["lines.l
+00036ca0: 696e 6577 6964 7468 225d 5b30 5d0a 0a20  inewidth"][0].. 
+00036cb0: 2020 2020 2020 2069 6620 6e61 6d65 2069         if name i
+00036cc0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00036cd0: 2020 2020 6e61 6d65 203d 2073 656c 662e      name = self.
+00036ce0: 6e61 6d65 0a0a 2020 2020 2020 2020 2320  name..        # 
+00036cf0: 5365 7420 706f 7465 6e74 6961 6c6c 7920  Set potentially 
+00036d00: 6469 6666 6572 656e 7420 6f70 6163 6974  different opacit
+00036d10: 6965 7320 666f 7220 6661 6365 636f 6c6f  ies for facecolo
+00036d20: 7220 616e 6420 6564 6765 636f 6c6f 720a  r and edgecolor.
+00036d30: 2020 2020 2020 2020 6661 6365 636f 6c6f          facecolo
+00036d40: 7220 3d20 6d61 7470 6c6f 746c 6962 2e63  r = matplotlib.c
+00036d50: 6f6c 6f72 732e 746f 5f72 6762 6128 636f  olors.to_rgba(co
+00036d60: 6c6f 722c 2061 6c70 6861 3d6f 7061 6369  lor, alpha=opaci
+00036d70: 7479 290a 2020 2020 2020 2020 6564 6765  ty).        edge
+00036d80: 636f 6c6f 7220 3d20 6d61 7470 6c6f 746c  color = matplotl
+00036d90: 6962 2e63 6f6c 6f72 732e 746f 5f72 6762  ib.colors.to_rgb
+00036da0: 6128 636f 6c6f 722c 2061 6c70 6861 3d31  a(color, alpha=1
+00036db0: 290a 0a20 2020 2020 2020 2023 2044 6566  )..        # Def
+00036dc0: 696e 6520 7061 7463 6820 6163 636f 7264  ine patch accord
+00036dd0: 696e 6720 746f 2070 6c6f 745f 7479 7065  ing to plot_type
+00036de0: 2e0a 2020 2020 2020 2020 7061 7463 6820  ..        patch 
+00036df0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2069  = None.        i
+00036e00: 6620 706c 6f74 5f74 7970 6520 696e 205b  f plot_type in [
+00036e10: 2263 6f6e 746f 7572 222c 2022 6365 6e74  "contour", "cent
+00036e20: 726f 6964 225d 3a0a 2020 2020 2020 2020  roid"]:.        
+00036e30: 2020 2020 7061 7463 6820 3d20 6d70 6174      patch = mpat
+00036e40: 6368 6573 2e50 6174 6368 2865 6467 6563  ches.Patch(edgec
+00036e50: 6f6c 6f72 3d65 6467 6563 6f6c 6f72 2c0a  olor=edgecolor,.
+00036e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036e70: 2020 2020 6c69 6e65 7769 6474 683d 6c69      linewidth=li
+00036e80: 6e65 7769 6474 682c 2066 696c 6c3d 4661  newidth, fill=Fa
+00036e90: 6c73 652c 206c 6162 656c 3d6e 616d 6529  lse, label=name)
+00036ea0: 0a20 2020 2020 2020 2065 6c69 6620 706c  .        elif pl
+00036eb0: 6f74 5f74 7970 6520 696e 205b 2266 696c  ot_type in ["fil
+00036ec0: 6c65 6422 2c20 2266 696c 6c65 6420 6365  led", "filled ce
+00036ed0: 6e74 726f 6964 225d 3a0a 2020 2020 2020  ntroid"]:.      
+00036ee0: 2020 2020 2020 7061 7463 6820 3d20 6d70        patch = mp
+00036ef0: 6174 6368 6573 2e50 6174 6368 2865 6467  atches.Patch(edg
+00036f00: 6563 6f6c 6f72 3d65 6467 6563 6f6c 6f72  ecolor=edgecolor
+00036f10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00036f20: 2020 2020 2020 6661 6365 636f 6c6f 723d        facecolor=
+00036f30: 6661 6365 636f 6c6f 722c 206c 696e 6577  facecolor, linew
+00036f40: 6964 7468 3d6c 696e 6577 6964 7468 2c20  idth=linewidth, 
+00036f50: 6c61 6265 6c3d 6e61 6d65 290a 2020 2020  label=name).    
+00036f60: 2020 2020 656c 6966 2070 6c6f 745f 7479      elif plot_ty
+00036f70: 7065 2069 6e20 5b22 6d61 736b 225d 3a0a  pe in ["mask"]:.
+00036f80: 2020 2020 2020 2020 2020 2020 7061 7463              patc
+00036f90: 6820 3d20 6d70 6174 6368 6573 2e50 6174  h = mpatches.Pat
+00036fa0: 6368 2866 6163 6563 6f6c 6f72 3d66 6163  ch(facecolor=fac
+00036fb0: 6563 6f6c 6f72 2c20 6c61 6265 6c3d 6e61  ecolor, label=na
+00036fc0: 6d65 290a 0a20 2020 2020 2020 2069 6620  me)..        if 
+00036fd0: 7061 7463 683a 0a20 2020 2020 2020 2020  patch:.         
+00036fe0: 2020 2070 6174 6368 2e73 6574 5f61 6c70     patch.set_alp
+00036ff0: 6861 284e 6f6e 6529 0a0a 2020 2020 2020  ha(None)..      
+00037000: 2020 7265 7475 726e 2070 6174 6368 0a0a    return patch..
+00037010: 2020 2020 6465 6620 6765 745f 696e 7465      def get_inte
+00037020: 6e73 6974 6965 735f 3364 2873 656c 662c  nsities_3d(self,
+00037030: 2069 6d61 6765 3d4e 6f6e 652c 2073 7461   image=None, sta
+00037040: 6e64 6172 6469 7365 3d54 7275 6529 3a0a  ndardise=True):.
+00037050: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00037060: 2020 2020 5265 7475 726e 2063 6f70 7920      Return copy 
+00037070: 6f66 2061 6e20 696d 6167 6520 6172 7261  of an image arra
+00037080: 7920 7468 6174 2068 6173 2076 616c 7565  y that has value
+00037090: 7320 7265 7461 696e 6564 0a20 2020 2020  s retained.     
+000370a0: 2020 2069 6e73 6964 6520 7365 6c66 2c20     inside self, 
+000370b0: 616e 6420 6973 2073 6574 2074 6f20 7a65  and is set to ze
+000370c0: 726f 2065 6c73 6577 6865 7265 2e0a 0a20  ro elsewhere... 
+000370d0: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
+000370e0: 6572 3a2a 2a0a 0a20 2020 2020 2020 2069  er:**..        i
+000370f0: 6d61 6765 203a 2073 6b72 742e 696d 6167  mage : skrt.imag
+00037100: 652e 496d 6167 652c 2064 6566 6175 6c74  e.Image, default
+00037110: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+00037120: 2020 496d 6167 6520 6f62 6a65 6374 2066    Image object f
+00037130: 6f72 2077 6869 6368 2033 4420 6172 7261  or which 3D arra
+00037140: 7920 7769 7468 2069 6e74 656e 7369 7479  y with intensity
+00037150: 2076 616c 7565 730a 2020 2020 2020 2020   values.        
+00037160: 2020 2020 7265 7461 696e 6564 2069 6e73      retained ins
+00037170: 6964 6520 524f 492c 2061 6e64 204e 614e  ide ROI, and NaN
+00037180: 2065 6c73 6577 6865 7265 2c20 6973 2074   elsewhere, is t
+00037190: 6f20 6265 206f 6274 6169 6e65 642e 0a20  o be obtained.. 
+000371a0: 2020 2020 2020 2020 2020 2049 6620 4e6f             If No
+000371b0: 6e65 2c20 7468 6520 696d 6167 6520 6173  ne, the image as
+000371c0: 736f 6369 6174 6564 2077 6974 6820 7468  sociated with th
+000371d0: 6520 524f 4920 6973 2075 7365 642e 0a0a  e ROI is used...
+000371e0: 2020 2020 2020 2020 7374 616e 6461 7264          standard
+000371f0: 6973 6520 3a20 626f 6f6c 2c20 6465 6661  ise : bool, defa
+00037200: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
+00037210: 2020 2020 2020 4966 2046 616c 7365 2c20        If False, 
+00037220: 7468 6520 6461 7461 2061 7272 6179 2077  the data array w
+00037230: 696c 6c20 6265 2072 6574 7572 6e65 6420  ill be returned 
+00037240: 696e 2074 6865 206f 7269 656e 7461 7469  in the orientati
+00037250: 6f6e 2069 6e20 0a20 2020 2020 2020 2020  on in .         
+00037260: 2020 2077 6869 6368 2069 7420 7761 7320     which it was 
+00037270: 6c6f 6164 6564 3b20 6f74 6865 7277 6973  loaded; otherwis
+00037280: 652c 2069 7420 7769 6c6c 2062 6520 7265  e, it will be re
+00037290: 7475 726e 6564 2069 6e20 7374 616e 6461  turned in standa
+000372a0: 7264 0a20 2020 2020 2020 2020 2020 2064  rd.            d
+000372b0: 6963 6f6d 2d73 7479 6c65 206f 7269 656e  icom-style orien
+000372c0: 7461 7469 6f6e 2073 7563 6820 7468 6174  tation such that
+000372d0: 205b 636f 6c75 6d6e 2c20 726f 772c 2073   [column, row, s
+000372e0: 6c69 6365 5d20 636f 7272 6573 706f 6e64  lice] correspond
+000372f0: 730a 2020 2020 2020 2020 2020 2020 746f  s.            to
+00037300: 2074 6865 205b 782c 2079 2c20 7a5d 2061   the [x, y, z] a
+00037310: 7865 732e 0a20 2020 2020 2020 2022 2222  xes..        """
+00037320: 0a20 2020 2020 2020 2069 6620 696d 6167  .        if imag
+00037330: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+00037340: 2020 2020 2020 2023 2043 6f6e 7369 6465         # Conside
+00037350: 7220 696d 6167 6520 6173 736f 6369 6174  r image associat
+00037360: 6564 2077 6974 6820 7365 6c66 2e0a 2020  ed with self..  
+00037370: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+00037380: 7265 6174 655f 6d61 736b 2829 0a20 2020  reate_mask().   
+00037390: 2020 2020 2020 2020 2069 6d61 6765 203d           image =
+000373a0: 2073 656c 662e 696d 6167 650a 2020 2020   self.image.    
+000373b0: 2020 2020 2020 2020 726f 6920 3d20 7365          roi = se
+000373c0: 6c66 0a20 2020 2020 2020 2065 6c73 653a  lf.        else:
+000373d0: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+000373e0: 6c6f 6e65 2073 656c 662c 2061 6e64 2061  lone self, and a
+000373f0: 7373 6f63 6961 7465 2077 6974 6820 636c  ssociate with cl
+00037400: 6f6e 6520 7468 6520 696d 6167 6520 7370  one the image sp
+00037410: 6563 6966 6965 6420 696e 2069 6e70 7574  ecified in input
+00037420: 2e0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
+00037430: 6920 3d20 7365 6c66 2e63 6c6f 6e65 2829  i = self.clone()
+00037440: 0a20 2020 2020 2020 2020 2020 2072 6f69  .            roi
+00037450: 2e73 6574 5f69 6d61 6765 2869 6d61 6765  .set_image(image
+00037460: 290a 0a20 2020 2020 2020 2023 204f 6274  )..        # Obt
+00037470: 6169 6e20 696e 7465 6e73 6974 7920 7661  ain intensity va
+00037480: 6c75 6573 2e0a 2020 2020 2020 2020 696d  lues..        im
+00037490: 5f64 6174 6120 3d20 696d 6167 652e 6765  _data = image.ge
+000374a0: 745f 6461 7461 2873 7461 6e64 6172 6469  t_data(standardi
+000374b0: 7365 3d73 7461 6e64 6172 6469 7365 290a  se=standardise).
+000374c0: 2020 2020 2020 2020 6d61 736b 203d 2072          mask = r
+000374d0: 6f69 2e67 6574 5f6d 6173 6b28 7374 616e  oi.get_mask(stan
+000374e0: 6461 7264 6973 653d 7374 616e 6461 7264  dardise=standard
+000374f0: 6973 6529 0a20 2020 2020 2020 2069 6e74  ise).        int
+00037500: 656e 7369 7469 6573 5f69 6e5f 726f 6920  ensities_in_roi 
+00037510: 3d20 6e70 2e66 756c 6c28 696d 5f64 6174  = np.full(im_dat
+00037520: 612e 7368 6170 652c 206e 702e 6e61 6e29  a.shape, np.nan)
+00037530: 0a20 2020 2020 2020 2069 6e74 656e 7369  .        intensi
+00037540: 7469 6573 5f69 6e5f 726f 695b 6d61 736b  ties_in_roi[mask
+00037550: 203e 2030 5d20 3d20 696d 5f64 6174 615b   > 0] = im_data[
+00037560: 6d61 736b 203e 2030 5d0a 2020 2020 2020  mask > 0].      
+00037570: 2020 7265 7475 726e 2069 6e74 656e 7369    return intensi
+00037580: 7469 6573 5f69 6e5f 726f 690a 0a20 2020  ties_in_roi..   
+00037590: 2064 6566 2067 6574 5f69 6e74 656e 7369   def get_intensi
+000375a0: 7469 6573 2873 656c 662c 2069 6d61 6765  ties(self, image
+000375b0: 3d4e 6f6e 652c 2073 7461 6e64 6172 6469  =None, standardi
+000375c0: 7365 3d54 7275 6529 3a0a 2020 2020 2020  se=True):.      
+000375d0: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
+000375e0: 7475 726e 2031 4420 6e75 6d70 7920 6172  turn 1D numpy ar
+000375f0: 7261 7920 636f 6e74 6169 6e69 6e67 2061  ray containing a
+00037600: 6c6c 206f 6620 7468 6520 696e 7465 6e73  ll of the intens
+00037610: 6974 7920 7661 6c75 6573 2066 6f72 2074  ity values for t
+00037620: 6865 200a 2020 2020 2020 2020 766f 7865  he .        voxe
+00037630: 6c73 2069 6e73 6964 6520 7365 6c66 2e0a  ls inside self..
+00037640: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
+00037650: 6574 6572 733a 2a2a 0a0a 2020 2020 2020  eters:**..      
+00037660: 2020 696d 6167 6520 3a20 736b 7274 2e69    image : skrt.i
+00037670: 6d61 6765 2e49 6d61 6765 2c20 6465 6661  mage.Image, defa
+00037680: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+00037690: 2020 2020 2049 6d61 6765 206f 626a 6563       Image objec
+000376a0: 7420 666f 7220 7768 6963 6820 3144 2061  t for which 1D a
+000376b0: 7272 6179 206f 6620 696e 7465 6e73 6974  rray of intensit
+000376c0: 7920 7661 6c75 6573 2069 730a 2020 2020  y values is.    
+000376d0: 2020 2020 2020 2020 746f 2062 6520 6f62          to be ob
+000376e0: 7461 696e 6564 2e20 2049 6620 4e6f 6e65  tained.  If None
+000376f0: 2c20 7468 6520 696d 6167 6520 6173 736f  , the image asso
+00037700: 6369 6174 6564 2077 6974 6820 7468 650a  ciated with the.
+00037710: 2020 2020 2020 2020 2020 2020 524f 4920              ROI 
+00037720: 6973 2075 7365 642e 0a0a 2020 2020 2020  is used...      
+00037730: 2020 7374 616e 6461 7264 6973 6520 3a20    standardise : 
+00037740: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
+00037750: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00037760: 4966 2046 616c 7365 2c20 7468 6520 696d  If False, the im
+00037770: 6167 6527 7320 6461 7461 2061 7272 6179  age's data array
+00037780: 2077 696c 6c20 6265 2075 7365 6420 696e   will be used in
+00037790: 2074 6865 206f 7269 656e 7461 7469 6f6e   the orientation
+000377a0: 0a20 2020 2020 2020 2020 2020 2069 6e20  .            in 
+000377b0: 7768 6963 6820 6974 2077 6173 206c 6f61  which it was loa
+000377c0: 6465 643b 206f 7468 6572 7769 7365 2c20  ded; otherwise, 
+000377d0: 6974 2077 696c 6c20 6265 2075 7365 6420  it will be used 
+000377e0: 696e 2073 7461 6e64 6172 640a 2020 2020  in standard.    
+000377f0: 2020 2020 2020 2020 6469 636f 6d2d 7374          dicom-st
+00037800: 796c 6520 6f72 6965 6e74 6174 696f 6e20  yle orientation 
+00037810: 7375 6368 2074 6861 7420 5b63 6f6c 756d  such that [colum
+00037820: 6e2c 2072 6f77 2c20 736c 6963 655d 2063  n, row, slice] c
+00037830: 6f72 7265 7370 6f6e 6473 0a20 2020 2020  orresponds.     
+00037840: 2020 2020 2020 2074 6f20 7468 6520 5b78         to the [x
+00037850: 2c20 792c 207a 5d20 6178 6573 2e0a 2020  , y, z] axes..  
+00037860: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00037870: 2020 696e 7465 6e73 6974 6965 7320 3d20    intensities = 
+00037880: 7365 6c66 2e67 6574 5f69 6e74 656e 7369  self.get_intensi
+00037890: 7469 6573 5f33 6428 696d 6167 652c 2073  ties_3d(image, s
+000378a0: 7461 6e64 6172 6469 7365 290a 2020 2020  tandardise).    
+000378b0: 2020 2020 7265 7475 726e 2069 6e74 656e      return inten
+000378c0: 7369 7469 6573 5b7e 6e70 2e69 736e 616e  sities[~np.isnan
+000378d0: 2869 6e74 656e 7369 7469 6573 295d 0a20  (intensities)]. 
+000378e0: 2020 2020 2020 200a 636c 6173 7320 5374         .class St
+000378f0: 7275 6374 7572 6553 6574 2873 6b72 742e  ructureSet(skrt.
+00037900: 636f 7265 2e41 7263 6869 7665 293a 0a20  core.Archive):. 
+00037910: 2020 2022 2222 0a20 2020 2043 6c61 7373     """.    Class
+00037920: 2072 6570 7265 7365 6e74 696e 6720 6120   representing a 
+00037930: 7261 6469 6f74 6865 7261 7079 2073 7472  radiotherapy str
+00037940: 7563 7475 7265 2073 6574 0a20 2020 2061  ucture set.    a
+00037950: 7320 6120 636f 6c6c 6563 7469 6f6e 206f  s a collection o
+00037960: 6620 7265 6769 6f6e 7320 6f66 2069 6e74  f regions of int
+00037970: 6572 6573 7420 2852 4f49 7329 2e0a 0a20  erest (ROIs)... 
+00037980: 2020 2041 7474 7269 6275 7465 7320 6f66     Attributes of
+00037990: 2061 2053 7472 7563 7475 7265 5365 7420   a StructureSet 
+000379a0: 6f62 6a65 6374 2073 686f 756c 6420 7573  object should us
+000379b0: 7561 6c6c 7920 6265 2061 6363 6573 7365  ually be accesse
+000379c0: 6420 7669 610a 2020 2020 7468 6569 7220  d via.    their 
+000379d0: 6765 7474 6572 206d 6574 686f 6473 2c20  getter methods, 
+000379e0: 7261 7468 6572 2074 6861 6e20 6469 7265  rather than dire
+000379f0: 6374 6c79 2c20 746f 2065 6e73 7572 6520  ctly, to ensure 
+00037a00: 7468 6174 0a20 2020 2061 7474 7269 6275  that.    attribu
+00037a10: 7465 2076 616c 7565 7320 6861 7665 2062  te values have b
+00037a20: 6565 6e20 6c6f 6164 6564 2e0a 2020 2020  een loaded..    
+00037a30: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
+00037a40: 6e69 745f 5f28 0a20 2020 2020 2020 2073  nit__(.        s
+00037a50: 656c 662c 0a20 2020 2020 2020 2070 6174  elf,.        pat
+00037a60: 683d 4e6f 6e65 2c0a 2020 2020 2020 2020  h=None,.        
+00037a70: 6e61 6d65 3d4e 6f6e 652c 0a20 2020 2020  name=None,.     
+00037a80: 2020 2069 6d61 6765 3d4e 6f6e 652c 0a20     image=None,. 
+00037a90: 2020 2020 2020 206c 6f61 643d 5472 7565         load=True
+00037aa0: 2c0a 2020 2020 2020 2020 6e61 6d65 733d  ,.        names=
+00037ab0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6b65  None,.        ke
+00037ac0: 6570 5f72 656e 616d 6564 5f6f 6e6c 793d  ep_renamed_only=
+00037ad0: 4661 6c73 652c 0a20 2020 2020 2020 2074  False,.        t
+00037ae0: 6f5f 6b65 6570 3d4e 6f6e 652c 0a20 2020  o_keep=None,.   
+00037af0: 2020 2020 2074 6f5f 7265 6d6f 7665 3d4e       to_remove=N
+00037b00: 6f6e 652c 0a20 2020 2020 2020 206d 756c  one,.        mul
+00037b10: 7469 5f6c 6162 656c 3d46 616c 7365 2c0a  ti_label=False,.
+00037b20: 2020 2020 2020 2020 636f 6c6f 7273 3d4e          colors=N
+00037b30: 6f6e 652c 0a20 2020 2020 2020 2069 676e  one,.        ign
+00037b40: 6f72 655f 6469 636f 6d5f 636f 6c6f 7273  ore_dicom_colors
+00037b50: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+00037b60: 6175 746f 5f74 696d 6573 7461 6d70 3d46  auto_timestamp=F
+00037b70: 616c 7365 2c0a 2020 2020 2020 2020 616c  alse,.        al
+00037b80: 7068 615f 6265 7461 5f72 6174 696f 733d  pha_beta_ratios=
+00037b90: 4e6f 6e65 2c0a 2020 2020 2020 2020 2a2a  None,.        **
+00037ba0: 6b77 6172 6773 0a20 2020 2029 3a0a 2020  kwargs.    ):.  
+00037bb0: 2020 2020 2020 2222 224c 6f61 6420 7374        """Load st
+00037bc0: 7275 6374 7572 6520 7365 7420 6672 6f6d  ructure set from
+00037bd0: 2074 6865 2073 6f75 7263 6528 7329 2067   the source(s) g
+00037be0: 6976 656e 2069 6e20 3c70 6174 683e 2e0a  iven in <path>..
+00037bf0: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
+00037c00: 6574 6572 732a 2a3a 0a0a 2020 2020 2020  eters**:..      
+00037c10: 2020 7061 7468 203a 2073 7472 2f6c 6973    path : str/lis
+00037c20: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+00037c30: 2020 2020 2020 2020 2020 2020 536f 7572              Sour
+00037c40: 6365 2873 2920 6f66 2052 4f49 7320 746f  ce(s) of ROIs to
+00037c50: 206c 6f61 6420 696e 746f 2074 6869 7320   load into this 
+00037c60: 7374 7275 6374 7572 6520 7365 742e 2043  structure set. C
+00037c70: 616e 2062 653a 0a0a 2020 2020 2020 2020  an be:..        
+00037c80: 2020 2020 2d20 5468 6520 7061 7468 2074      - The path t
+00037c90: 6f20 6120 7369 6e67 6c65 2064 6963 6f6d  o a single dicom
+00037ca0: 2073 7472 7563 7475 7265 2073 6574 2066   structure set f
+00037cb0: 696c 653b 0a20 2020 2020 2020 2020 2020  ile;.           
+00037cc0: 202d 2054 6865 2070 6174 6820 746f 2061   - The path to a
+00037cd0: 2073 696e 676c 6520 6e69 6674 6920 6669   single nifti fi
+00037ce0: 6c65 2063 6f6e 7461 696e 696e 6720 616e  le containing an
+00037cf0: 2052 4f49 206d 6173 6b3b 0a20 2020 2020   ROI mask;.     
+00037d00: 2020 2020 2020 202d 2041 206c 6973 7420         - A list 
+00037d10: 6f66 2070 6174 6873 2074 6f20 6e69 6674  of paths to nift
+00037d20: 6920 6669 6c65 7320 636f 6e74 6169 6e69  i files containi
+00037d30: 6e67 2052 4f49 206d 6173 6b73 3b0a 2020  ng ROI masks;.  
+00037d40: 2020 2020 2020 2020 2020 2d20 5468 6520            - The 
+00037d50: 7061 7468 2074 6f20 6120 6469 7265 6374  path to a direct
+00037d60: 6f72 7920 636f 6e74 6169 6e69 6e67 206d  ory containing m
+00037d70: 756c 7469 706c 6520 6e69 6674 6920 6669  ultiple nifti fi
+00037d80: 6c65 7320 0a20 2020 2020 2020 2020 2020  les .           
+00037d90: 2063 6f6e 7461 696e 696e 6720 524f 4920   containing ROI 
+00037da0: 6d61 736b 733b 0a20 2020 2020 2020 2020  masks;.         
+00037db0: 2020 202d 2041 206c 6973 7420 6f66 2052     - A list of R
+00037dc0: 4f49 206f 626a 6563 7473 3b0a 2020 2020  OI objects;.    
+00037dd0: 2020 2020 2020 2020 2d20 4120 6c69 7374          - A list
+00037de0: 206f 6620 6f62 6a65 6374 7320 7468 6174   of objects that
+00037df0: 2063 6f75 6c64 2062 6520 7573 6564 2074   could be used t
+00037e00: 6f20 696e 6974 6961 6c69 7365 2061 6e20  o initialise an 
+00037e10: 524f 4920 6f62 6a65 6374 0a20 2020 2020  ROI object.     
+00037e20: 2020 2020 2020 2028 652e 672e 2061 206e         (e.g. a n
+00037e30: 756d 7079 2061 7272 6179 292e 0a0a 2020  umpy array)...  
+00037e40: 2020 2020 2020 6e61 6d65 203a 2073 7472        name : str
+00037e50: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+00037e60: 2020 2020 2020 2020 2020 204f 7074 696f             Optio
+00037e70: 6e61 6c20 6e61 6d65 2074 6f20 6173 7369  nal name to assi
+00037e80: 676e 2074 6f20 7468 6973 2073 7472 7563  gn to this struc
+00037e90: 7475 7265 2073 6574 2e20 4966 204e 6f6e  ture set. If Non
+00037ea0: 652c 2077 696c 6c20 0a20 2020 2020 2020  e, will .       
+00037eb0: 2020 2020 2061 7474 656d 7074 2074 6f20       attempt to 
+00037ec0: 696e 6665 7220 6672 6f6d 2069 6e70 7574  infer from input
+00037ed0: 2066 696c 656e 616d 652e 0a0a 2020 2020   filename...    
+00037ee0: 2020 2020 696d 6167 6520 3a20 736b 7274      image : skrt
+00037ef0: 2e69 6d61 6765 2e49 6d61 6765 2c20 6465  .image.Image, de
+00037f00: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00037f10: 2020 2020 2020 2049 6d61 6765 2061 7373         Image ass
+00037f20: 6f63 6961 7465 6420 7769 7468 2074 6869  ociated with thi
+00037f30: 7320 7374 7275 6374 7572 6520 7365 742e  s structure set.
+00037f40: 2049 6620 7468 6520 696e 7075 7420 736f   If the input so
+00037f50: 7572 6365 2069 7320 610a 2020 2020 2020  urce is a.      
+00037f60: 2020 2020 2020 6469 636f 6d20 6669 6c65        dicom file
+00037f70: 2063 6f6e 7461 696e 696e 6720 524f 4920   containing ROI 
+00037f80: 636f 6e74 6f75 7273 2c20 7468 6973 2069  contours, this i
+00037f90: 6d61 6765 2077 696c 6c20 6265 2075 7365  mage will be use
+00037fa0: 6420 7768 656e 0a20 2020 2020 2020 2020  d when.         
+00037fb0: 2020 2063 7265 6174 696e 6720 524f 4920     creating ROI 
+00037fc0: 6269 6e61 7279 206d 6173 6b73 2e0a 0a20  binary masks... 
+00037fd0: 2020 2020 2020 206c 6f61 6420 3a20 626f         load : bo
+00037fe0: 6f6c 2c20 6465 6661 756c 743d 5472 7565  ol, default=True
+00037ff0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00038000: 5472 7565 2c20 524f 4973 2077 696c 6c20  True, ROIs will 
+00038010: 696d 6d65 6469 6174 656c 7920 6265 206c  immediately be l
+00038020: 6f61 6465 6420 6672 6f6d 2073 6f75 7263  oaded from sourc
+00038030: 6573 2e20 4f74 6865 7277 6973 652c 0a20  es. Otherwise,. 
+00038040: 2020 2020 2020 2020 2020 206c 6f61 6469             loadi
+00038050: 6e67 2077 696c 6c20 6e6f 7420 6f63 6375  ng will not occu
+00038060: 7220 756e 7469 6c20 5374 7275 6374 7572  r until Structur
+00038070: 6553 6574 2e6c 6f61 6428 2920 6973 2063  eSet.load() is c
+00038080: 616c 6c65 642e 0a20 2020 2020 2020 200a  alled..        .
+00038090: 2020 2020 2020 2020 6e61 6d65 7320 3a20          names : 
+000380a0: 6469 6374 2f6c 6973 742c 2064 6566 6175  dict/list, defau
+000380b0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+000380c0: 2020 2020 4f70 7469 6f6e 616c 2064 6963      Optional dic
+000380d0: 7420 6f66 2052 4f49 206e 616d 6573 2074  t of ROI names t
+000380e0: 6f20 7573 6520 7768 656e 2072 656e 616d  o use when renam
+000380f0: 696e 6720 6c6f 6164 6564 2052 4f49 732e  ing loaded ROIs.
+00038100: 204b 6579 7320 0a20 2020 2020 2020 2020   Keys .         
+00038110: 2020 2073 686f 756c 6420 6265 2064 6573     should be des
+00038120: 6972 6564 206e 616d 6573 2c20 616e 6420  ired names, and 
+00038130: 7661 6c75 6573 2073 686f 756c 6420 6265  values should be
+00038140: 206c 6973 7473 206f 6620 706f 7373 6962   lists of possib
+00038150: 6c65 0a20 2020 2020 2020 2020 2020 2069  le.            i
+00038160: 6e70 7574 206e 616d 6573 206f 7220 7769  nput names or wi
+00038170: 6c64 6361 7264 7320 6d61 7463 6869 6e67  ldcards matching
+00038180: 2069 6e70 7574 206e 616d 6573 2e0a 0a20   input names... 
+00038190: 2020 2020 2020 2020 2020 2049 6620 6d75             If mu
+000381a0: 6c74 695f 6c61 6265 6c3d 5472 7565 2c20  lti_label=True, 
+000381b0: 6e61 6d65 7320 6361 6e20 616c 736f 2062  names can also b
+000381c0: 6520 6120 6c69 7374 206f 6620 6e61 6d65  e a list of name
+000381d0: 7320 746f 2061 7373 6967 6e0a 2020 2020  s to assign.    
+000381e0: 2020 2020 2020 2020 746f 2065 6163 6820          to each 
+000381f0: 6c61 6265 6c20 666f 756e 6420 696e 206f  label found in o
+00038200: 7264 6572 2c20 6672 6f6d 2073 6d61 6c6c  rder, from small
+00038210: 6573 7420 746f 206c 6172 6765 7374 2e0a  est to largest..
+00038220: 0a20 2020 2020 2020 2074 6f5f 6b65 6570  .        to_keep
+00038230: 203a 206c 6973 742c 2064 6566 6175 6c74   : list, default
+00038240: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+00038250: 2020 4f70 7469 6f6e 616c 206c 6973 7420    Optional list 
+00038260: 6f66 2052 4f49 206e 616d 6573 206f 7220  of ROI names or 
+00038270: 7769 6c64 6361 7264 7320 6d61 7463 6869  wildcards matchi
+00038280: 6e67 2052 4f49 206e 616d 6573 206f 6620  ng ROI names of 
+00038290: 524f 4973 0a20 2020 2020 2020 2020 2020  ROIs.           
+000382a0: 2074 6f20 6b65 6570 2069 6e20 7468 6973   to keep in this
+000382b0: 2053 7472 7563 7475 7265 5365 7420 6475   StructureSet du
+000382c0: 7269 6e67 206c 6f61 6469 6e67 2e20 524f  ring loading. RO
+000382d0: 4973 206e 6f74 206d 6174 6368 696e 6720  Is not matching 
+000382e0: 7769 6c6c 0a20 2020 2020 2020 2020 2020  will.           
+000382f0: 2062 6520 6469 7363 6172 6465 642e 204e   be discarded. N
+00038300: 6f74 6520 7468 6174 2074 6865 206e 616d  ote that the nam
+00038310: 6573 2073 686f 756c 6420 7265 666c 6563  es should reflec
+00038320: 7420 7468 6f73 6520 6166 7465 7220 0a20  t those after . 
+00038330: 2020 2020 2020 2020 2020 2072 656e 616d             renam
+00038340: 696e 6720 7669 6120 7468 6520 3c6e 616d  ing via the <nam
+00038350: 6573 3e20 6469 6374 2e20 4966 204e 6f6e  es> dict. If Non
+00038360: 652c 2061 6c6c 2052 4f49 7320 7769 6c6c  e, all ROIs will
+00038370: 2062 6520 6b65 7074 2e0a 0a20 2020 2020   be kept...     
+00038380: 2020 2074 6f5f 7265 6d6f 7665 203a 206c     to_remove : l
+00038390: 6973 742c 2064 6566 6175 6c74 3d4e 6f6e  ist, default=Non
+000383a0: 650a 2020 2020 2020 2020 2020 2020 4f70  e.            Op
+000383b0: 7469 6f6e 616c 206c 6973 7420 6f66 2052  tional list of R
+000383c0: 4f49 206e 616d 6573 206f 7220 7769 6c64  OI names or wild
+000383d0: 6361 7264 7320 6d61 7463 6869 6e67 2052  cards matching R
+000383e0: 4f49 206e 616d 6573 206f 6620 524f 4973  OI names of ROIs
+000383f0: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
+00038400: 7265 6d6f 7665 2066 726f 6d20 7468 6973  remove from this
+00038410: 2053 7472 7563 7475 7265 5365 7420 6475   StructureSet du
+00038420: 7269 6e67 206c 6f61 6469 6e67 2e20 524f  ring loading. RO
+00038430: 4973 206d 6174 6368 696e 6720 7769 6c6c  Is matching will
+00038440: 0a20 2020 2020 2020 2020 2020 2062 6520  .            be 
+00038450: 6469 7363 6172 6465 642e 204e 6f74 6520  discarded. Note 
+00038460: 7468 6174 2074 6865 206e 616d 6573 2073  that the names s
+00038470: 686f 756c 6420 7265 666c 6563 7420 7468  hould reflect th
+00038480: 6f73 6520 6166 7465 7220 0a20 2020 2020  ose after .     
+00038490: 2020 2020 2020 2072 656e 616d 696e 6720         renaming 
+000384a0: 7669 6120 7468 6520 3c6e 616d 6573 3e20  via the <names> 
+000384b0: 6469 6374 2c20 616e 6420 7265 6d6f 7661  dict, and remova
+000384c0: 6c20 6f63 6375 7273 2061 6674 6572 2066  l occurs after f
+000384d0: 696c 7465 7269 6e67 0a20 2020 2020 2020  iltering.       
+000384e0: 2020 2020 2077 6974 6820 7468 6520 3c74       with the <t
+000384f0: 6f5f 6b65 6570 3e20 6c69 7374 2e20 4966  o_keep> list. If
+00038500: 204e 6f6e 652c 206e 6f20 524f 4973 2077   None, no ROIs w
+00038510: 696c 6c20 6265 2072 656d 6f76 6564 2e0a  ill be removed..
+00038520: 0a20 2020 2020 2020 206d 756c 7469 5f6c  .        multi_l
+00038530: 6162 656c 203a 2062 6f6f 6c2c 2064 6566  abel : bool, def
+00038540: 6175 6c74 3d46 616c 7365 0a20 2020 2020  ault=False.     
+00038550: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+00038560: 7769 6c6c 206c 6f6f 6b20 666f 7220 6d75  will look for mu
+00038570: 6c74 6970 6c65 2052 4f49 206d 6173 6b73  ltiple ROI masks
+00038580: 2077 6974 6820 6469 6666 6572 656e 7420   with different 
+00038590: 6c61 6265 6c73 200a 2020 2020 2020 2020  labels .        
+000385a0: 2020 2020 696e 7369 6465 2074 6865 2061      inside the a
+000385b0: 7272 6179 2061 6e64 2063 7265 6174 6520  rray and create 
+000385c0: 6120 7365 7061 7261 7465 2052 4f49 2066  a separate ROI f
+000385d0: 726f 6d20 6561 6368 2e0a 0a20 2020 2020  rom each...     
+000385e0: 2020 2063 6f6c 6f72 7320 3a20 6c69 7374     colors : list
+000385f0: 2f64 6963 740a 2020 2020 2020 2020 2020  /dict.          
+00038600: 2020 4c69 7374 206f 7220 6469 6374 206f    List or dict o
+00038610: 6620 636f 6c6f 7273 2e20 4966 2061 2064  f colors. If a d
+00038620: 6963 742c 2074 6865 206b 6579 7320 7368  ict, the keys sh
+00038630: 6f75 6c64 2062 6520 524f 4920 6e61 6d65  ould be ROI name
+00038640: 7320 6f72 0a20 2020 2020 2020 2020 2020  s or.           
+00038650: 2077 696c 6463 6172 6473 206d 6174 6368   wildcards match
+00038660: 696e 6720 524f 4920 6e61 6d65 732c 2061  ing ROI names, a
+00038670: 6e64 2074 6865 2076 616c 7565 7320 7368  nd the values sh
+00038680: 6f75 6c64 2062 6520 6465 7369 7265 6420  ould be desired 
+00038690: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
+000386a0: 6f72 7320 666f 7220 524f 4973 206d 6174  ors for ROIs mat
+000386b0: 6368 696e 6720 7468 6174 206e 616d 652e  ching that name.
+000386c0: 2049 6620 6120 6c69 7374 2c20 7368 6f75   If a list, shou
+000386d0: 6c64 2063 6f6e 7461 696e 0a20 2020 2020  ld contain.     
+000386e0: 2020 2020 2020 2063 6f6c 6f72 7320 7768         colors wh
+000386f0: 6963 6820 7769 6c6c 2062 6520 6170 706c  ich will be appl
+00038700: 6965 6420 746f 206c 6f61 6465 6420 524f  ied to loaded RO
+00038710: 4973 2069 6e20 6f72 6465 722e 0a0a 2020  Is in order...  
+00038720: 2020 2020 2020 6175 746f 5f74 696d 6573        auto_times
+00038730: 7461 6d70 203a 2062 6f6f 6c20 6465 6661  tamp : bool defa
+00038740: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
+00038750: 2020 2020 2020 4966 2074 7275 6520 616e        If true an
+00038760: 6420 6e6f 2076 616c 6964 2074 696d 6573  d no valid times
+00038770: 7461 6d70 2069 7320 666f 756e 6420 7769  tamp is found wi
+00038780: 7468 696e 2074 6865 2070 6174 6820 7374  thin the path st
+00038790: 7269 6e67 2c0a 2020 2020 2020 2020 2020  ring,.          
+000387a0: 2020 7469 6d65 7374 616d 7020 6765 6e65    timestamp gene
+000387b0: 7261 7465 6420 6672 6f6d 2063 7572 7265  rated from curre
+000387c0: 6e74 2064 6174 6520 616e 6420 7469 6d65  nt date and time
+000387d0: 2e0a 0a20 2020 2020 2020 2061 6c70 6861  ...        alpha
+000387e0: 5f62 6574 615f 7261 7469 6f73 203a 2064  _beta_ratios : d
+000387f0: 6963 742c 2064 6566 6175 6c74 3d4e 6f6e  ict, default=Non
+00038800: 650a 2020 2020 2020 2020 2020 2020 4469  e.            Di
+00038810: 6374 696f 6e61 7279 2077 6865 7265 206b  ctionary where k
+00038820: 6579 7320 6172 6520 524f 4920 6e61 6d65  eys are ROI name
+00038830: 7320 616e 6420 7661 6c75 6573 2061 7265  s and values are
+00038840: 0a20 2020 2020 2020 2020 2020 2072 6174  .            rat
+00038850: 696f 7320 666f 7220 524f 4920 7469 7373  ios for ROI tiss
+00038860: 7565 7320 6f66 2063 6f65 6666 6963 6965  ues of coefficie
+00038870: 6e74 732c 2061 6c70 6861 2c20 6265 7461  nts, alpha, beta
+00038880: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
+00038890: 2074 6865 206c 696e 6561 722d 7175 6164   the linear-quad
+000388a0: 7261 7469 6320 6571 7561 7469 6f6e 2e20  ratic equation. 
+000388b0: 2054 6865 7365 2072 6174 696f 7320 6172   These ratios ar
+000388c0: 650a 2020 2020 2020 2020 2020 2020 7573  e.            us
+000388d0: 6564 2069 6e20 6361 6c63 756c 6174 696e  ed in calculatin
+000388e0: 6720 6269 6f6c 6f67 6963 616c 6c79 2065  g biologically e
+000388f0: 6666 6563 7469 7665 2064 6f73 652c 2042  ffective dose, B
+00038900: 4544 2c20 6672 6f6d 0a20 2020 2020 2020  ED, from.       
+00038910: 2020 2020 2070 6879 7369 6361 6c20 646f       physical do
+00038920: 7365 2c20 442c 2064 656c 6976 6572 6564  se, D, delivered
+00038930: 206f 7665 7220 6e20 6571 7561 6c20 6672   over n equal fr
+00038940: 6163 7469 6f6e 733a 0a20 2020 2020 2020  actions:.       
+00038950: 2020 2020 2020 2020 2042 4544 203d 2044           BED = D
+00038960: 202a 2028 3120 2b20 2844 2f6e 2920 2f20   * (1 + (D/n) / 
+00038970: 2861 6c70 6861 2f62 6574 6129 292e 0a20  (alpha/beta)).. 
+00038980: 2020 2020 2020 2020 2020 2054 6865 2061             The a
+00038990: 7474 7269 6275 7465 2061 6c70 6861 5f6f  ttribute alpha_o
+000389a0: 7665 725f 7661 6c75 6520 6973 2073 6574  ver_value is set
+000389b0: 2074 6f20 7468 6520 6469 6374 696f 6e61   to the dictiona
+000389c0: 7279 2076 616c 7565 0a20 2020 2020 2020  ry value.       
+000389d0: 2020 2020 2066 6f72 2061 6e20 524f 4920       for an ROI 
+000389e0: 6964 656e 7469 6669 6564 2062 7920 6120  identified by a 
+000389f0: 6b65 792c 206f 7220 6973 2073 6574 2074  key, or is set t
+00038a00: 6f20 4e6f 6e65 2066 6f72 2061 6e79 0a20  o None for any. 
+00038a10: 2020 2020 2020 2020 2020 206f 7468 6572             other
+00038a20: 2052 4f49 732e 0a0a 2020 2020 2020 2020   ROIs...        
+00038a30: 602a 2a60 6b77 6172 6773 203a 0a20 2020  `**`kwargs :.   
+00038a40: 2020 2020 2020 2020 2041 6464 6974 696f           Additio
+00038a50: 6e61 6c20 6b65 7977 6f72 6420 6172 6773  nal keyword args
+00038a60: 2074 6f20 7573 6520 7768 656e 2069 6e69   to use when ini
+00038a70: 7469 616c 6973 696e 6720 6e65 7720 524f  tialising new RO
+00038a80: 4920 6f62 6a65 6374 732e 0a20 2020 2020  I objects..     
+00038a90: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00038aa0: 2320 436c 6f6e 6520 6672 6f6d 2061 6e6f  # Clone from ano
+00038ab0: 7468 6572 2053 7472 7563 7475 7265 5365  ther StructureSe
+00038ac0: 7420 6f62 6a65 6374 0a20 2020 2020 2020  t object.       
+00038ad0: 2069 6620 6973 7375 6263 6c61 7373 2874   if issubclass(t
+00038ae0: 7970 6528 7061 7468 292c 2053 7472 7563  ype(path), Struc
+00038af0: 7475 7265 5365 7429 3a0a 2020 2020 2020  tureSet):.      
+00038b00: 2020 2020 2020 7061 7468 2e63 6c6f 6e65        path.clone
+00038b10: 5f61 7474 7273 2873 656c 6629 0a20 2020  _attrs(self).   
+00038b20: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00038b30: 0a20 2020 2020 2020 2073 656c 662e 6e61  .        self.na
+00038b40: 6d65 203d 206e 616d 650a 2020 2020 2020  me = name.      
+00038b50: 2020 7061 7468 203d 2028 736b 7274 2e63    path = (skrt.c
+00038b60: 6f72 652e 6675 6c6c 7061 7468 2870 6174  ore.fullpath(pat
+00038b70: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
+00038b80: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00038b90: 2870 6174 682c 2028 7374 722c 2050 6174  (path, (str, Pat
+00038ba0: 6829 2920 656c 7365 2070 6174 6829 0a20  h)) else path). 
+00038bb0: 2020 2020 2020 2073 656c 662e 736f 7572         self.sour
+00038bc0: 6365 7320 3d20 7061 7468 0a20 2020 2020  ces = path.     
+00038bd0: 2020 2069 6620 7365 6c66 2e73 6f75 7263     if self.sourc
+00038be0: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
+00038bf0: 2020 2020 2020 2020 7365 6c66 2e73 6f75          self.sou
+00038c00: 7263 6573 203d 205b 5d0a 2020 2020 2020  rces = [].      
+00038c10: 2020 656c 6966 206e 6f74 2073 6b72 742e    elif not skrt.
+00038c20: 636f 7265 2e69 735f 6c69 7374 2870 6174  core.is_list(pat
+00038c30: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
+00038c40: 7365 6c66 2e73 6f75 7263 6573 203d 205b  self.sources = [
+00038c50: 7061 7468 5d0a 2020 2020 2020 2020 7365  path].        se
+00038c60: 6c66 2e72 6f69 7320 3d20 5b5d 0a20 2020  lf.rois = [].   
+00038c70: 2020 2020 2073 656c 662e 7365 745f 696d       self.set_im
+00038c80: 6167 6528 696d 6167 6529 0a20 2020 2020  age(image).     
+00038c90: 2020 2073 656c 662e 746f 5f6b 6565 7020     self.to_keep 
+00038ca0: 3d20 746f 5f6b 6565 700a 2020 2020 2020  = to_keep.      
+00038cb0: 2020 7365 6c66 2e74 6f5f 7265 6d6f 7665    self.to_remove
+00038cc0: 203d 2074 6f5f 7265 6d6f 7665 0a20 2020   = to_remove.   
+00038cd0: 2020 2020 2073 656c 662e 6e61 6d65 7320       self.names 
+00038ce0: 3d20 6e61 6d65 730a 2020 2020 2020 2020  = names.        
+00038cf0: 7365 6c66 2e6b 6565 705f 7265 6e61 6d65  self.keep_rename
+00038d00: 645f 6f6e 6c79 203d 206b 6565 705f 7265  d_only = keep_re
+00038d10: 6e61 6d65 645f 6f6e 6c79 0a20 2020 2020  named_only.     
+00038d20: 2020 2073 656c 662e 6d75 6c74 695f 6c61     self.multi_la
+00038d30: 6265 6c20 3d20 6d75 6c74 695f 6c61 6265  bel = multi_labe
+00038d40: 6c0a 2020 2020 2020 2020 7365 6c66 2e63  l.        self.c
+00038d50: 6f6c 6f72 7320 3d20 636f 6c6f 7273 0a20  olors = colors. 
+00038d60: 2020 2020 2020 2073 656c 662e 6967 6e6f         self.igno
+00038d70: 7265 5f64 6963 6f6d 5f63 6f6c 6f72 7320  re_dicom_colors 
+00038d80: 3d20 6967 6e6f 7265 5f64 6963 6f6d 5f63  = ignore_dicom_c
+00038d90: 6f6c 6f72 730a 2020 2020 2020 2020 7365  olors.        se
+00038da0: 6c66 2e64 6963 6f6d 5f64 6174 6173 6574  lf.dicom_dataset
+00038db0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00038dc0: 7365 6c66 2e61 6c70 6861 5f62 6574 615f  self.alpha_beta_
+00038dd0: 7261 7469 6f73 203d 2061 6c70 6861 5f62  ratios = alpha_b
+00038de0: 6574 615f 7261 7469 6f73 206f 7220 7b7d  eta_ratios or {}
+00038df0: 0a20 2020 2020 2020 2073 656c 662e 726f  .        self.ro
+00038e00: 695f 6b77 6172 6773 203d 206b 7761 7267  i_kwargs = kwarg
+00038e10: 730a 2020 2020 2020 2020 7365 6c66 2e70  s.        self.p
+00038e20: 6c61 6e73 203d 205b 5d0a 2020 2020 2020  lans = [].      
+00038e30: 2020 7061 7468 203d 2070 6174 6820 6966    path = path if
+00038e40: 2069 7369 6e73 7461 6e63 6528 7061 7468   isinstance(path
+00038e50: 2c20 7374 7229 2065 6c73 6520 2222 0a20  , str) else "". 
+00038e60: 2020 2020 2020 2073 6b72 742e 636f 7265         skrt.core
+00038e70: 2e41 7263 6869 7665 2e5f 5f69 6e69 745f  .Archive.__init_
+00038e80: 5f28 7365 6c66 2c20 7061 7468 2c20 6175  _(self, path, au
+00038e90: 746f 5f74 696d 6573 7461 6d70 290a 2020  to_timestamp).  
+00038ea0: 2020 2020 2020 6966 2073 656c 662e 7061        if self.pa
+00038eb0: 7468 2061 6e64 206e 6f74 2073 656c 662e  th and not self.
+00038ec0: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
+00038ed0: 2020 6e61 6d65 203d 2050 6174 6828 7365    name = Path(se
+00038ee0: 6c66 2e70 6174 6829 2e6e 616d 652e 7370  lf.path).name.sp
+00038ef0: 6c69 7428 275f 2729 5b30 5d2e 6c6f 7765  lit('_')[0].lowe
+00038f00: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
+00038f10: 6966 206e 616d 655b 305d 2e69 7361 6c70  if name[0].isalp
+00038f20: 6861 2829 3a0a 2020 2020 2020 2020 2020  ha():.          
+00038f30: 2020 2020 2020 7365 6c66 2e6e 616d 6520        self.name 
+00038f40: 3d20 6e61 6d65 0a20 2020 2020 2020 2073  = name.        s
+00038f50: 656c 662e 7375 6d6d 6564 5f6e 616d 6573  elf.summed_names
+00038f60: 203d 205b 5d0a 0a20 2020 2020 2020 2073   = []..        s
+00038f70: 656c 662e 6c6f 6164 6564 203d 2046 616c  elf.loaded = Fal
+00038f80: 7365 0a20 2020 2020 2020 2069 6620 6c6f  se.        if lo
+00038f90: 6164 3a0a 2020 2020 2020 2020 2020 2020  ad:.            
+00038fa0: 7365 6c66 2e6c 6f61 6428 290a 0a20 2020  self.load()..   
+00038fb0: 2064 6566 205f 5f67 6574 6974 656d 5f5f   def __getitem__
+00038fc0: 2873 656c 662c 2072 6f69 293a 0a20 2020  (self, roi):.   
+00038fd0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00038fe0: 6365 2872 6f69 2c20 696e 7429 3a0a 2020  ce(roi, int):.  
+00038ff0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00039000: 2073 656c 662e 6765 745f 726f 6973 2829   self.get_rois()
+00039010: 5b72 6f69 5d20 0a20 2020 2020 2020 2065  [roi] .        e
+00039020: 6c69 6620 6973 696e 7374 616e 6365 2872  lif isinstance(r
+00039030: 6f69 2c20 7374 7229 3a0a 2020 2020 2020  oi, str):.      
+00039040: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00039050: 662e 6765 745f 726f 695f 6469 6374 2829  f.get_roi_dict()
+00039060: 5b72 6f69 5d0a 0a20 2020 2064 6566 205f  [roi]..    def _
+00039070: 5f69 7465 725f 5f28 7365 6c66 293a 0a20  _iter__(self):. 
+00039080: 2020 2020 2020 2072 6574 7572 6e20 5374         return St
+00039090: 7275 6374 7572 6553 6574 4974 6572 6174  ructureSetIterat
+000390a0: 6f72 2873 656c 6629 0a0a 2020 2020 6465  or(self)..    de
+000390b0: 6620 5f5f 6164 645f 5f28 7365 6c66 2c20  f __add__(self, 
+000390c0: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
+000390d0: 2727 270a 2020 2020 2020 2020 4465 6669  '''.        Defi
+000390e0: 6e65 2061 6464 6974 696f 6e20 6f66 2053  ne addition of S
+000390f0: 7472 7563 7475 7265 5365 7420 696e 7374  tructureSet inst
+00039100: 616e 6365 732e 0a0a 2020 2020 2020 2020  ances...        
+00039110: 5468 6520 7265 7375 6c74 206f 6620 7468  The result of th
+00039120: 6520 6164 6469 7469 6f6e 206f 6620 7365  e addition of se
+00039130: 6c66 2061 6e64 206f 7468 6572 2069 7320  lf and other is 
+00039140: 6120 5374 7275 6374 7572 6553 6574 0a20  a StructureSet. 
+00039150: 2020 2020 2020 206f 626a 6563 7420 7468         object th
+00039160: 6174 2063 6f6e 7461 696e 7320 7468 6520  at contains the 
+00039170: 2863 6c6f 6e65 6429 2052 4f49 7320 6f66  (cloned) ROIs of
+00039180: 2062 6f74 682e 2020 4120 7265 7375 6c74   both.  A result
+00039190: 2052 4f49 0a20 2020 2020 2020 2077 696c   ROI.        wil
+000391a0: 6c20 6265 2070 7265 6669 7865 6420 6279  l be prefixed by
+000391b0: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
+000391c0: 2053 7472 7563 7475 7265 5365 7420 6672   StructureSet fr
+000391d0: 6f6d 2077 6869 6368 2069 740a 2020 2020  om which it.    
+000391e0: 2020 2020 6f72 6967 696e 6174 6573 2e20      originates. 
+000391f0: 2049 6620 7468 6520 524f 4920 6e61 6d65   If the ROI name
+00039200: 2062 6566 6f72 6520 7468 6520 6164 6469   before the addi
+00039210: 7469 6f6e 2068 6173 2074 6865 2053 7472  tion has the Str
+00039220: 7563 7475 7265 5365 740a 2020 2020 2020  uctureSet.      
+00039230: 2020 6e61 6d65 2061 7320 7072 6566 6978    name as prefix
+00039240: 2c20 6e6f 206e 6577 2070 7265 6669 7820  , no new prefix 
+00039250: 6973 2061 6464 6564 2e20 2054 6865 7265  is added.  There
+00039260: 2069 7320 6e6f 2072 6571 7569 7265 6d65   is no requireme
+00039270: 6e74 0a20 2020 2020 2020 2074 6861 7420  nt.        that 
+00039280: 524f 4973 206f 7220 7468 6569 7220 6e61  ROIs or their na
+00039290: 6d65 7320 6265 2075 6e69 7175 6520 7769  mes be unique wi
+000392a0: 7468 696e 2061 2053 7472 7563 7475 7265  thin a Structure
+000392b0: 5365 742e 2020 4164 6469 6e67 0a20 2020  Set.  Adding.   
+000392c0: 2020 2020 2061 2053 7472 7563 7475 7265       a Structure
+000392d0: 5365 7420 746f 2069 7473 656c 6620 7769  Set to itself wi
+000392e0: 6c6c 2067 6976 6520 6120 7265 7375 6c74  ll give a result
+000392f0: 2069 6e63 6c75 6469 6e67 2064 7570 6c69   including dupli
+00039300: 6361 7465 0a20 2020 2020 2020 2052 4f49  cate.        ROI
+00039310: 7320 7769 7468 2064 7570 6c69 6361 7465  s with duplicate
+00039320: 206e 616d 6573 2e0a 2020 2020 2020 2020   names..        
+00039330: 2727 270a 2020 2020 2020 2020 2320 456e  '''.        # En
+00039340: 7375 7265 2074 6861 7420 5374 7275 6374  sure that Struct
+00039350: 7572 6553 6574 2064 6174 6120 6172 6520  ureSet data are 
+00039360: 6c6f 6164 6564 2e0a 2020 2020 2020 2020  loaded..        
+00039370: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
+00039380: 2020 2020 6f74 6865 722e 6c6f 6164 2829      other.load()
+00039390: 0a0a 2020 2020 2020 2020 2320 4372 6561  ..        # Crea
+000393a0: 7465 206e 6577 2053 7472 7563 7475 7265  te new Structure
+000393b0: 5365 7420 696e 7374 616e 6365 2066 6f72  Set instance for
+000393c0: 2073 756d 2c0a 2020 2020 2020 2020 2320   sum,.        # 
+000393d0: 616e 6420 7374 6f72 6520 6e61 6d65 7320  and store names 
+000393e0: 6f66 2063 6f6e 7472 6962 7574 6f72 732e  of contributors.
+000393f0: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
+00039400: 3d20 5374 7275 6374 7572 6553 6574 2829  = StructureSet()
+00039410: 0a20 2020 2020 2020 2072 6573 756c 742e  .        result.
+00039420: 7375 6d6d 6564 5f6e 616d 6573 203d 205b  summed_names = [
+00039430: 5d0a 2020 2020 2020 2020 666f 7220 6e61  ].        for na
+00039440: 6d65 7320 696e 205b 7365 6c66 2e73 756d  mes in [self.sum
+00039450: 6d65 645f 6e61 6d65 732c 206f 7468 6572  med_names, other
+00039460: 2e73 756d 6d65 645f 6e61 6d65 732c 0a20  .summed_names,. 
+00039470: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00039480: 7365 6c66 2e6e 616d 655d 2c20 5b6f 7468  self.name], [oth
+00039490: 6572 2e6e 616d 655d 5d3a 0a20 2020 2020  er.name]]:.     
+000394a0: 2020 2020 2020 2066 6f72 206e 616d 6520         for name 
+000394b0: 696e 206e 616d 6573 3a0a 2020 2020 2020  in names:.      
+000394c0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+000394d0: 6e73 7461 6e63 6528 6e61 6d65 2c20 7374  nstance(name, st
+000394e0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+000394f0: 2020 2020 2020 2020 666f 7220 7375 625f          for sub_
+00039500: 6e61 6d65 2069 6e20 6e61 6d65 2e73 706c  name in name.spl
+00039510: 6974 2822 5f22 293a 0a20 2020 2020 2020  it("_"):.       
+00039520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039530: 2069 6620 7375 625f 6e61 6d65 206e 6f74   if sub_name not
+00039540: 2069 6e20 7265 7375 6c74 2e73 756d 6d65   in result.summe
+00039550: 645f 6e61 6d65 733a 0a20 2020 2020 2020  d_names:.       
+00039560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039570: 2020 2020 2072 6573 756c 742e 7375 6d6d       result.summ
+00039580: 6564 5f6e 616d 6573 2e61 7070 656e 6428  ed_names.append(
+00039590: 7375 625f 6e61 6d65 290a 2020 2020 2020  sub_name).      
+000395a0: 2020 7265 7375 6c74 2e73 756d 6d65 645f    result.summed_
+000395b0: 6e61 6d65 732e 736f 7274 2829 0a0a 2020  names.sort()..  
+000395c0: 2020 2020 2020 2320 4c6f 6f70 206f 7665        # Loop ove
+000395d0: 7220 5374 7275 6374 7572 6553 6574 7320  r StructureSets 
+000395e0: 616e 6420 7468 6569 7220 524f 4973 2e0a  and their ROIs..
+000395f0: 2020 2020 2020 2020 666f 7220 7373 2069          for ss i
+00039600: 6e20 5b73 656c 662c 206f 7468 6572 5d3a  n [self, other]:
+00039610: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00039620: 2072 6f69 2069 6e20 7373 2e67 6574 5f72   roi in ss.get_r
+00039630: 6f69 7328 293a 0a20 2020 2020 2020 2020  ois():.         
+00039640: 2020 2020 2020 2072 6f69 5f63 6c6f 6e65         roi_clone
+00039650: 203d 2072 6f69 2e63 6c6f 6e65 2829 0a20   = roi.clone(). 
+00039660: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00039670: 2054 7279 2074 6f20 7072 6566 6978 2052   Try to prefix R
+00039680: 4f49 206e 616d 6520 7769 7468 2074 6865  OI name with the
+00039690: 206e 616d 6520 6f66 2074 6865 2053 7472   name of the Str
+000396a0: 7563 7475 7265 5365 740a 2020 2020 2020  uctureSet.      
+000396b0: 2020 2020 2020 2020 2020 2320 6672 6f6d            # from
+000396c0: 2077 6869 6368 2069 7420 6f72 6967 696e   which it origin
+000396d0: 6174 6573 2e0a 2020 2020 2020 2020 2020  ates..          
+000396e0: 2020 2020 2020 6966 2028 726f 692e 6e61        if (roi.na
+000396f0: 6d65 2e73 706c 6974 2822 5f22 295b 305d  me.split("_")[0]
+00039700: 2069 6e20 7265 7375 6c74 2e73 756d 6d65   in result.summe
+00039710: 645f 6e61 6d65 730a 2020 2020 2020 2020  d_names.        
+00039720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039730: 6f72 2073 732e 6e61 6d65 2069 7320 4e6f  or ss.name is No
+00039740: 6e65 293a 0a20 2020 2020 2020 2020 2020  ne):.           
+00039750: 2020 2020 2020 2020 2072 6f69 5f63 6c6f           roi_clo
+00039760: 6e65 2e6e 616d 6520 3d20 726f 692e 6e61  ne.name = roi.na
+00039770: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
+00039780: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00039790: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+000397a0: 5f63 6c6f 6e65 2e6e 616d 6520 3d20 225f  _clone.name = "_
+000397b0: 222e 6a6f 696e 285b 7373 2e6e 616d 652c  ".join([ss.name,
+000397c0: 2072 6f69 2e6e 616d 655d 290a 2020 2020   roi.name]).    
+000397d0: 2020 2020 2020 2020 2020 2020 2320 4164              # Ad
+000397e0: 6420 524f 4920 746f 2074 6865 2072 6573  d ROI to the res
+000397f0: 756c 742e 0a20 2020 2020 2020 2020 2020  ult..           
+00039800: 2020 2020 2072 6573 756c 742e 6164 645f       result.add_
+00039810: 726f 6928 726f 695f 636c 6f6e 6529 0a0a  roi(roi_clone)..
+00039820: 2020 2020 2020 2020 2320 4173 2072 6573          # As res
+00039830: 756c 7420 696d 6167 6520 7365 7420 7468  ult image set th
+00039840: 6520 696d 6167 6520 6f66 2073 656c 6620  e image of self 
+00039850: 6966 206e 6f6e 2d6e 756c 6c2c 0a20 2020  if non-null,.   
+00039860: 2020 2020 2023 206f 7220 6f74 6877 6973       # or othwis
+00039870: 6520 7468 6520 696d 6167 6520 6f66 206f  e the image of o
+00039880: 7468 6572 2e0a 2020 2020 2020 2020 696d  ther..        im
+00039890: 6167 6520 3d20 7365 6c66 2e69 6d61 6765  age = self.image
+000398a0: 2069 6620 7365 6c66 2e69 6d61 6765 2065   if self.image e
+000398b0: 6c73 6520 6f74 6865 722e 696d 6167 650a  lse other.image.
+000398c0: 2020 2020 2020 2020 7265 7375 6c74 2e73          result.s
+000398d0: 6574 5f69 6d61 6765 2869 6d61 6765 290a  et_image(image).
+000398e0: 0a20 2020 2020 2020 2023 2053 6574 2074  .        # Set t
+000398f0: 6865 2072 6573 756c 7420 6e61 6d65 2074  he result name t
+00039900: 6f20 6265 2074 6865 2063 6f6e 6361 7465  o be the concate
+00039910: 6e61 7469 6f6e 206f 6620 7468 6520 6e61  nation of the na
+00039920: 6d65 730a 2020 2020 2020 2020 2320 6f66  mes.        # of
+00039930: 2074 6865 2063 6f6e 7472 6962 7574 6f72   the contributor
+00039940: 732e 0a20 2020 2020 2020 2069 6620 7265  s..        if re
+00039950: 7375 6c74 2e73 756d 6d65 645f 6e61 6d65  sult.summed_name
+00039960: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+00039970: 6573 756c 742e 6e61 6d65 203d 2022 5f22  esult.name = "_"
+00039980: 2e6a 6f69 6e28 7265 7375 6c74 2e73 756d  .join(result.sum
+00039990: 6d65 645f 6e61 6d65 7329 0a0a 2020 2020  med_names)..    
+000399a0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
+000399b0: 740a 0a20 2020 2064 6566 205f 5f69 6164  t..    def __iad
+000399c0: 645f 5f28 7365 6c66 2c20 6f74 6865 7229  d__(self, other)
+000399d0: 3a0a 2020 2020 2020 2020 2727 270a 2020  :.        '''.  
+000399e0: 2020 2020 2020 4465 6669 6e65 2069 6e2d        Define in-
+000399f0: 706c 6163 6520 6f66 2053 7472 7563 7475  place of Structu
+00039a00: 7265 5365 7420 696e 7374 616e 6365 732e  reSet instances.
+00039a10: 0a0a 2020 2020 2020 2020 5468 6520 7265  ..        The re
+00039a20: 7375 6c74 206f 6620 7468 6520 6164 6469  sult of the addi
+00039a30: 7469 6f6e 206f 6620 7365 6c66 2061 6e64  tion of self and
+00039a40: 206f 7468 6572 2069 7320 6120 5374 7275   other is a Stru
+00039a50: 6374 7572 6553 6574 0a20 2020 2020 2020  ctureSet.       
+00039a60: 206f 626a 6563 7420 7468 6174 2063 6f6e   object that con
+00039a70: 7461 696e 7320 7468 6520 2863 6c6f 6e65  tains the (clone
+00039a80: 6429 2052 4f49 7320 6f66 2062 6f74 682e  d) ROIs of both.
+00039a90: 2020 4120 7265 7375 6c74 2052 4f49 0a20    A result ROI. 
+00039aa0: 2020 2020 2020 2077 696c 6c20 6265 2070         will be p
+00039ab0: 7265 6669 7865 6420 6279 2074 6865 206e  refixed by the n
+00039ac0: 616d 6520 6f66 2074 6865 2053 7472 7563  ame of the Struc
+00039ad0: 7475 7265 5365 7420 6672 6f6d 2077 6869  tureSet from whi
+00039ae0: 6368 2069 740a 2020 2020 2020 2020 6f72  ch it.        or
+00039af0: 6967 696e 6174 6573 2e20 2049 6620 7468  iginates.  If th
+00039b00: 6520 524f 4920 6e61 6d65 2062 6566 6f72  e ROI name befor
+00039b10: 6520 7468 6520 6164 6469 7469 6f6e 2068  e the addition h
+00039b20: 6173 2074 6865 2053 7472 7563 7475 7265  as the Structure
+00039b30: 5365 740a 2020 2020 2020 2020 6e61 6d65  Set.        name
+00039b40: 2061 7320 7072 6566 6978 2c20 6e6f 206e   as prefix, no n
+00039b50: 6577 2070 7265 6669 7820 6973 2061 6464  ew prefix is add
+00039b60: 6564 2e20 2054 6865 7265 2069 7320 6e6f  ed.  There is no
+00039b70: 2072 6571 7569 7265 6d65 6e74 0a20 2020   requirement.   
+00039b80: 2020 2020 2074 6861 7420 524f 4973 206f       that ROIs o
+00039b90: 7220 7468 6569 7220 6e61 6d65 7320 6265  r their names be
+00039ba0: 2075 6e69 7175 6520 7769 7468 696e 2061   unique within a
+00039bb0: 2053 7472 7563 7475 7265 5365 742e 2020   StructureSet.  
+00039bc0: 4164 6469 6e67 0a20 2020 2020 2020 2061  Adding.        a
+00039bd0: 2053 7472 7563 7475 7265 5365 7420 746f   StructureSet to
+00039be0: 2069 7473 656c 6620 7769 6c6c 2067 6976   itself will giv
+00039bf0: 6520 6120 7265 7375 6c74 2069 6e63 6c75  e a result inclu
+00039c00: 6469 6e67 2064 7570 6c69 6361 7465 0a20  ding duplicate. 
+00039c10: 2020 2020 2020 2052 4f49 7320 7769 7468         ROIs with
+00039c20: 2064 7570 6c69 6361 7465 206e 616d 6573   duplicate names
+00039c30: 2e0a 2020 2020 2020 2020 2727 270a 2020  ..        '''.  
+00039c40: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00039c50: 6620 2b20 6f74 6865 720a 0a20 2020 2064  f + other..    d
+00039c60: 6566 206c 6f61 6428 7365 6c66 2c20 736f  ef load(self, so
+00039c70: 7572 6365 733d 4e6f 6e65 2c20 666f 7263  urces=None, forc
+00039c80: 653d 4661 6c73 6529 3a0a 2020 2020 2020  e=False):.      
+00039c90: 2020 2222 224c 6f61 6420 7374 7275 6374    """Load struct
+00039ca0: 7572 6520 7365 7420 6672 6f6d 2073 6f75  ure set from sou
+00039cb0: 7263 6528 7329 2e20 4966 204e 6f6e 652c  rce(s). If None,
+00039cc0: 2077 696c 6c20 6c6f 6164 2066 726f 6d20   will load from 
+00039cd0: 6f77 6e0a 2020 2020 2020 2020 7365 6c66  own.        self
+00039ce0: 2e73 6f75 7263 6573 2e22 2222 0a0a 2020  .sources."""..  
+00039cf0: 2020 2020 2020 6966 2073 656c 662e 6c6f        if self.lo
+00039d00: 6164 6564 2061 6e64 206e 6f74 2066 6f72  aded and not for
+00039d10: 6365 2061 6e64 2073 6f75 7263 6573 2069  ce and sources i
+00039d20: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00039d30: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+00039d40: 2020 2020 6966 2073 6f75 7263 6573 2069      if sources i
+00039d50: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00039d60: 2020 2020 736f 7572 6365 7320 3d20 7365      sources = se
+00039d70: 6c66 2e73 6f75 7263 6573 0a0a 2020 2020  lf.sources..    
+00039d80: 2020 2020 2320 4c61 6f64 2066 726f 6d20      # Laod from 
+00039d90: 6d75 6c74 692d 6c61 6265 6c20 6172 7261  multi-label arra
+00039da0: 790a 2020 2020 2020 2020 6966 2073 656c  y.        if sel
+00039db0: 662e 6d75 6c74 695f 6c61 6265 6c3a 0a0a  f.multi_label:..
+00039dc0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00039dd0: 7369 6e73 7461 6e63 6528 736f 7572 6365  sinstance(source
+00039de0: 732c 206c 6973 7429 2061 6e64 206c 656e  s, list) and len
+00039df0: 2873 6f75 7263 6573 2920 3d3d 2031 3a0a  (sources) == 1:.
+00039e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039e10: 736f 7572 6365 7320 3d20 736f 7572 6365  sources = source
+00039e20: 735b 305d 0a20 2020 2020 2020 2020 2020  s[0].           
+00039e30: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+00039e40: 6365 2873 6f75 7263 6573 2c20 7374 7229  ce(sources, str)
+00039e50: 2061 6e64 206e 6f74 2069 7369 6e73 7461   and not isinsta
+00039e60: 6e63 6528 736f 7572 6365 732c 206e 702e  nce(sources, np.
+00039e70: 6e64 6172 7261 7929 3a0a 2020 2020 2020  ndarray):.      
+00039e80: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00039e90: 5479 7065 4572 726f 7228 2249 6e70 7574  TypeError("Input
+00039ea0: 2066 6f72 2061 206d 756c 7469 2d6c 6162   for a multi-lab
+00039eb0: 656c 2069 6d61 6765 206d 7573 7420 6265  el image must be
+00039ec0: 2066 696c 6570 6174 6820 220a 2020 2020   filepath ".    
+00039ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039ee0: 2020 2020 2020 2020 2020 2020 6622 6f72              f"or
+00039ef0: 206e 756d 7079 2061 7272 6179 2e20 5479   numpy array. Ty
+00039f00: 7065 2066 6f75 6e64 3a20 7b74 7970 6528  pe found: {type(
+00039f10: 736f 7572 6365 7329 7d2e 2229 0a20 2020  sources)}.").   
+00039f20: 2020 2020 2020 2020 2073 696e 676c 655f           single_
+00039f30: 736f 7572 6365 203d 2054 7275 650a 0a20  source = True.. 
+00039f40: 2020 2020 2020 2020 2020 2023 204c 6f61             # Loa
+00039f50: 6420 696e 7075 7420 6172 7261 7920 696e  d input array in
+00039f60: 746f 2069 6d61 6765 0a20 2020 2020 2020  to image.       
+00039f70: 2020 2020 2061 7272 6179 203d 2073 6b72       array = skr
+00039f80: 742e 696d 6167 652e 496d 6167 6528 736f  t.image.Image(so
+00039f90: 7572 6365 7329 2e67 6574 5f64 6174 6128  urces).get_data(
+00039fa0: 7374 616e 6461 7264 6973 653d 5472 7565  standardise=True
+00039fb0: 292e 6173 7479 7065 2869 6e74 290a 2020  ).astype(int).  
+00039fc0: 2020 2020 2020 2020 2020 6e20 3d20 6172            n = ar
+00039fd0: 7261 792e 6d61 7828 290a 0a20 2020 2020  ray.max()..     
+00039fe0: 2020 2020 2020 2023 2045 6e66 6f72 6365         # Enforce
+00039ff0: 2044 6963 6f6d 2063 6f6e 7665 6e74 696f   Dicom conventio
+0003a000: 6e20 666f 7220 6461 7461 2061 7272 6179  n for data array
+0003a010: 206f 6620 696d 6167 6520 6f62 6a65 6374   of image object
+0003a020: 2c0a 2020 2020 2020 2020 2020 2020 2320  ,.            # 
+0003a030: 736f 2074 6861 7420 6166 6669 6e65 206d  so that affine m
+0003a040: 6174 7269 7820 7769 6c6c 2062 6520 636f  atrix will be co
+0003a050: 7272 6563 746c 7920 6465 6669 6e65 6420  rrectly defined 
+0003a060: 666f 7220 6d61 736b 2063 7265 6174 696f  for mask creatio
+0003a070: 6e2e 0a20 2020 2020 2020 2020 2020 2069  n..            i
+0003a080: 6d20 3d20 736b 7274 2e69 6d61 6765 2e49  m = skrt.image.I
+0003a090: 6d61 6765 2873 6f75 7263 6573 290a 2020  mage(sources).  
+0003a0a0: 2020 2020 2020 2020 2020 6966 2027 6e69            if 'ni
+0003a0b0: 6674 6927 2069 6e20 696d 2e73 6f75 7263  fti' in im.sourc
+0003a0c0: 655f 7479 7065 3a0a 2020 2020 2020 2020  e_type:.        
+0003a0d0: 2020 2020 2020 2020 696d 203d 2069 6d2e          im = im.
+0003a0e0: 6173 7479 7065 2827 6463 6d27 290a 2020  astype('dcm').  
+0003a0f0: 2020 2020 2020 2020 2020 695f 6e61 6d65            i_name
+0003a100: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+0003a110: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+0003a120: 302c 206e 293a 0a20 2020 2020 2020 2020  0, n):.         
+0003a130: 2020 2020 2020 2069 6620 7365 6c66 2e6e         if self.n
+0003a140: 616d 6573 2069 7320 6e6f 7420 4e6f 6e65  ames is not None
+0003a150: 2061 6e64 2069 5f6e 616d 6520 3c20 6c65   and i_name < le
+0003a160: 6e28 7365 6c66 2e6e 616d 6573 293a 0a20  n(self.names):. 
 0003a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a180: 206f 7269 6769 6e20 3d20 4e6f 6e65 2c0a   origin = None,.
-0003a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a1a0: 2020 2020 696d 6167 653d 7365 6c66 2e69      image=self.i
-0003a1b0: 6d61 6765 2c0a 2020 2020 2020 2020 2020  mage,.          
-0003a1c0: 2020 2020 2020 2020 2020 6e61 6d65 3d6e            name=n
-0003a1d0: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-0003a1e0: 2020 2020 2020 2020 202a 2a73 656c 662e           **self.
-0003a1f0: 726f 695f 6b77 6172 6773 0a20 2020 2020  roi_kwargs.     
-0003a200: 2020 2020 2020 2020 2020 2029 290a 2020             )).  
-0003a210: 2020 2020 2020 2020 2020 736f 7572 6365            source
-0003a220: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
-0003a230: 2020 2020 2320 466f 7220 4e49 6654 4920      # For NIfTI 
-0003a240: 736f 7572 6365 2c20 7265 7665 7274 2074  source, revert t
-0003a250: 6f20 4e49 6654 4920 636f 6e76 656e 7469  o NIfTI conventi
-0003a260: 6f6e 2066 6f72 2064 6174 6120 6172 7261  on for data arra
-0003a270: 790a 2020 2020 2020 2020 2020 2020 2320  y.            # 
-0003a280: 6f66 206d 6173 6b2c 2073 6f20 7468 6174  of mask, so that
-0003a290: 2069 7420 6361 6e20 6265 2077 7269 7474   it can be writt
-0003a2a0: 656e 2063 6f72 7265 6374 6c79 2074 6f20  en correctly to 
-0003a2b0: 6669 6c65 2e0a 2020 2020 2020 2020 2020  file..          
-0003a2c0: 2020 6966 2027 6e69 6674 6927 2069 6e20    if 'nifti' in 
-0003a2d0: 696d 2e73 6f75 7263 655f 7479 7065 3a0a  im.source_type:.
-0003a2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a2f0: 666f 7220 6964 7820 696e 2072 616e 6765  for idx in range
-0003a300: 286c 656e 2873 656c 662e 726f 6973 2929  (len(self.rois))
-0003a310: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003a320: 2020 2020 2020 7365 6c66 2e72 6f69 735b        self.rois[
-0003a330: 6964 785d 2e6d 6173 6b20 3d20 7365 6c66  idx].mask = self
-0003a340: 2e72 6f69 735b 6964 785d 2e6d 6173 6b2e  .rois[idx].mask.
-0003a350: 6173 7479 7065 2827 6e69 6927 290a 0a20  astype('nii').. 
-0003a360: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0003a370: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0003a380: 736b 7274 2e63 6f72 652e 6973 5f6c 6973  skrt.core.is_lis
-0003a390: 7428 736f 7572 6365 7329 206f 7220 6973  t(sources) or is
-0003a3a0: 696e 7374 616e 6365 2873 6f75 7263 6573  instance(sources
-0003a3b0: 2c20 6e70 2e6e 6461 7272 6179 293a 0a20  , np.ndarray):. 
-0003a3c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0003a3d0: 6f75 7263 6573 203d 205b 736f 7572 6365  ources = [source
-0003a3e0: 735d 0a20 2020 2020 2020 2020 2020 2020  s].             
-0003a3f0: 2020 2073 696e 676c 655f 736f 7572 6365     single_source
-0003a400: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0003a410: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0003a420: 2020 2020 2020 2020 2020 7369 6e67 6c65            single
-0003a430: 5f73 6f75 7263 6520 3d20 4661 6c73 650a  _source = False.
-0003a440: 0a20 2020 2020 2020 2023 2045 7870 616e  .        # Expan
-0003a450: 6420 616e 7920 6469 7265 6374 6f72 6965  d any directorie
-0003a460: 730a 2020 2020 2020 2020 736f 7572 6365  s.        source
-0003a470: 735f 6578 7061 6e64 6564 203d 205b 5d0a  s_expanded = [].
-0003a480: 2020 2020 2020 2020 666f 7220 736f 7572          for sour
-0003a490: 6365 2069 6e20 736f 7572 6365 733a 0a20  ce in sources:. 
-0003a4a0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-0003a4b0: 696e 7374 616e 6365 2873 6f75 7263 652c  instance(source,
-0003a4c0: 2073 7472 2920 616e 6420 6f73 2e70 6174   str) and os.pat
-0003a4d0: 682e 6973 6469 7228 736f 7572 6365 293a  h.isdir(source):
-0003a4e0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003a4f0: 2020 736f 7572 6365 735f 6578 7061 6e64    sources_expand
-0003a500: 6564 2e65 7874 656e 6428 0a20 2020 2020  ed.extend(.     
-0003a510: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-0003a520: 6f73 2e70 6174 682e 6a6f 696e 2873 6f75  os.path.join(sou
-0003a530: 7263 652c 2066 696c 6529 2066 6f72 2066  rce, file) for f
-0003a540: 696c 6520 696e 206f 732e 6c69 7374 6469  ile in os.listdi
-0003a550: 7228 736f 7572 6365 295d 0a20 2020 2020  r(source)].     
-0003a560: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0003a570: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0003a580: 4175 746f 2d61 7373 6967 6e20 6e61 6d65  Auto-assign name
-0003a590: 2074 6f20 6469 7265 6374 6f72 7920 6e61   to directory na
-0003a5a0: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
-0003a5b0: 2020 2069 6620 7369 6e67 6c65 5f73 6f75     if single_sou
-0003a5c0: 7263 6520 616e 6420 7365 6c66 2e6e 616d  rce and self.nam
-0003a5d0: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-0003a5e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0003a5f0: 656c 662e 6e61 6d65 203d 2073 6f75 7263  elf.name = sourc
-0003a600: 650a 0a20 2020 2020 2020 2020 2020 2065  e..            e
-0003a610: 6c69 6620 6e6f 7420 7365 6c66 2e6c 6f61  lif not self.loa
-0003a620: 6465 643a 0a20 2020 2020 2020 2020 2020  ded:.           
-0003a630: 2020 2020 2073 6f75 7263 6573 5f65 7870       sources_exp
-0003a640: 616e 6465 642e 6170 7065 6e64 2873 6f75  anded.append(sou
-0003a650: 7263 6529 0a0a 2020 2020 2020 2020 666f  rce)..        fo
-0003a660: 7220 736f 7572 6365 2069 6e20 736f 7274  r source in sort
-0003a670: 6564 2873 6f75 7263 6573 5f65 7870 616e  ed(sources_expan
-0003a680: 6465 6429 3a0a 0a20 2020 2020 2020 2020  ded):..         
-0003a690: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0003a6a0: 2873 6f75 7263 652c 2052 4f49 293a 0a20  (source, ROI):. 
-0003a6b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0003a6c0: 656c 662e 726f 6973 2e61 7070 656e 6428  elf.rois.append(
-0003a6d0: 736f 7572 6365 290a 2020 2020 2020 2020  source).        
-0003a6e0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-0003a6f0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0003a700: 2069 7369 6e73 7461 6e63 6528 736f 7572   isinstance(sour
-0003a710: 6365 2c20 7374 7229 3a0a 2020 2020 2020  ce, str):.      
-0003a720: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
-0003a730: 7061 7468 2e62 6173 656e 616d 6528 736f  path.basename(so
-0003a740: 7572 6365 292e 7374 6172 7473 7769 7468  urce).startswith
-0003a750: 2822 2e22 2920 6f72 2073 6f75 7263 652e  (".") or source.
-0003a760: 656e 6473 7769 7468 2822 2e74 7874 2229  endswith(".txt")
-0003a770: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003a780: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-0003a790: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0003a7a0: 6620 6f73 2e70 6174 682e 6973 6469 7228  f os.path.isdir(
-0003a7b0: 736f 7572 6365 293a 0a20 2020 2020 2020  source):.       
-0003a7c0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0003a7d0: 7469 6e75 650a 0a20 2020 2020 2020 2020  tinue..         
-0003a7e0: 2020 2023 2041 7474 656d 7074 2074 6f20     # Attempt to 
-0003a7f0: 6c6f 6164 2066 726f 6d20 6469 636f 6d0a  load from dicom.
-0003a800: 2020 2020 2020 2020 2020 2020 726f 6973              rois
-0003a810: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-0003a820: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0003a830: 736f 7572 6365 2c20 7374 7229 3a0a 2020  source, str):.  
-0003a840: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0003a850: 206f 732e 7061 7468 2e73 706c 6974 6578   os.path.splitex
-0003a860: 7428 736f 7572 6365 295b 315d 2021 3d20  t(source)[1] != 
-0003a870: 272e 6e69 6927 3a0a 2020 2020 2020 2020  '.nii':.        
-0003a880: 2020 2020 2020 2020 2020 2020 726f 6973              rois
-0003a890: 2c20 6473 203d 206c 6f61 645f 726f 6973  , ds = load_rois
-0003a8a0: 5f64 6963 6f6d 2873 6f75 7263 6529 0a20  _dicom(source). 
-0003a8b0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-0003a8c0: 6e28 726f 6973 293a 0a20 2020 2020 2020  n(rois):.       
-0003a8d0: 2020 2020 2020 2020 2066 6f72 206e 756d           for num
-0003a8e0: 6265 722c 2072 6f69 2069 6e20 726f 6973  ber, roi in rois
-0003a8f0: 2e69 7465 6d73 2829 3a0a 0a20 2020 2020  .items():..     
-0003a900: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0003a910: 2049 676e 6f72 6520 656e 7472 6965 7320   Ignore entries 
-0003a920: 7769 7468 206e 6f20 636f 6e74 6f75 7273  with no contours
-0003a930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a940: 2020 2020 2069 6620 2263 6f6e 746f 7572       if "contour
-0003a950: 7322 206e 6f74 2069 6e20 726f 693a 0a20  s" not in roi:. 
-0003a960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a970: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-0003a980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a990: 2020 2020 2023 2049 676e 6f72 6520 656e       # Ignore en
-0003a9a0: 7472 6965 7320 636f 6e74 6169 6e69 6e67  tries containing
-0003a9b0: 206f 6e6c 7920 6120 7369 6e67 6c65 2070   only a single p
-0003a9c0: 6f69 6e74 0a20 2020 2020 2020 2020 2020  oint.           
-0003a9d0: 2020 2020 2020 2020 2063 6f6e 746f 7572           contour
-0003a9e0: 7320 3d20 726f 695b 2263 6f6e 746f 7572  s = roi["contour
-0003a9f0: 7322 5d0a 2020 2020 2020 2020 2020 2020  s"].            
-0003aa00: 2020 2020 2020 2020 6966 206c 656e 2863          if len(c
-0003aa10: 6f6e 746f 7572 7329 203d 3d20 313a 0a20  ontours) == 1:. 
-0003aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aa30: 2020 2020 2020 2073 696e 676c 655f 636f         single_co
-0003aa40: 6e74 6f75 7220 3d20 636f 6e74 6f75 7273  ntour = contours
-0003aa50: 5b6c 6973 7428 636f 6e74 6f75 7273 2e6b  [list(contours.k
-0003aa60: 6579 7328 2929 5b30 5d5d 5b30 5d0a 2020  eys())[0]][0].  
-0003aa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aa80: 2020 2020 2020 6966 2073 696e 676c 655f        if single_
-0003aa90: 636f 6e74 6f75 722e 7368 6170 655b 305d  contour.shape[0]
-0003aaa0: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-0003aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aac0: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
-0003aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aae0: 2063 6f6c 6f72 203d 2072 6f69 5b22 636f   color = roi["co
-0003aaf0: 6c6f 7222 5d20 6966 206e 6f74 2073 656c  lor"] if not sel
-0003ab00: 662e 6967 6e6f 7265 5f64 6963 6f6d 5f63  f.ignore_dicom_c
-0003ab10: 6f6c 6f72 7320 656c 7365 204e 6f6e 650a  olors else None.
-0003ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ab30: 2020 2020 7365 6c66 2e72 6f69 732e 6170      self.rois.ap
-0003ab40: 7065 6e64 280a 2020 2020 2020 2020 2020  pend(.          
-0003ab50: 2020 2020 2020 2020 2020 2020 2020 524f                RO
-0003ab60: 4928 0a20 2020 2020 2020 2020 2020 2020  I(.             
-0003ab70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0003ab80: 6f69 5b22 636f 6e74 6f75 7273 225d 2c0a  oi["contours"],.
-0003ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aba0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-0003abb0: 3d72 6f69 5b22 6e61 6d65 225d 2c0a 2020  =roi["name"],.  
-0003abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003abd0: 2020 2020 2020 2020 2020 636f 6c6f 723d            color=
-0003abe0: 636f 6c6f 722c 0a20 2020 2020 2020 2020  color,.         
-0003abf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ac00: 2020 2069 6d61 6765 3d73 656c 662e 696d     image=self.im
-0003ac10: 6167 652c 0a20 2020 2020 2020 2020 2020  age,.           
-0003ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ac30: 202a 2a73 656c 662e 726f 695f 6b77 6172   **self.roi_kwar
-0003ac40: 6773 0a20 2020 2020 2020 2020 2020 2020  gs.             
-0003ac50: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0003ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ac70: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0003ac80: 2020 2020 2020 2073 656c 662e 726f 6973         self.rois
-0003ac90: 5b2d 315d 2e64 6963 6f6d 5f64 6174 6173  [-1].dicom_datas
-0003aca0: 6574 203d 2064 730a 2020 2020 2020 2020  et = ds.        
-0003acb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0003acc0: 2e72 6f69 735b 2d31 5d2e 6e75 6d62 6572  .rois[-1].number
-0003acd0: 203d 206e 756d 6265 720a 2020 2020 2020   = number.      
-0003ace0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-0003acf0: 6963 6f6d 5f64 6174 6173 6574 203d 2064  icom_dataset = d
-0003ad00: 730a 0a20 2020 2020 2020 2020 2020 2020  s..             
-0003ad10: 2020 2023 2041 7574 6f2d 6173 7369 676e     # Auto-assign
-0003ad20: 206e 616d 6520 6672 6f6d 2064 6963 6f6d   name from dicom
-0003ad30: 2066 696c 656e 616d 650a 2020 2020 2020   filename.      
-0003ad40: 2020 2020 2020 2020 2020 6966 2073 696e            if sin
-0003ad50: 676c 655f 736f 7572 6365 2061 6e64 2073  gle_source and s
-0003ad60: 656c 662e 6e61 6d65 2069 7320 4e6f 6e65  elf.name is None
-0003ad70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003ad80: 2020 2020 2020 7365 6c66 2e6e 616d 6520        self.name 
-0003ad90: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
-0003ada0: 6d65 2873 6f75 7263 6529 2e72 6570 6c61  me(source).repla
-0003adb0: 6365 2822 2e64 636d 222c 2022 2229 0a0a  ce(".dcm", "")..
-0003adc0: 2020 2020 2020 2020 2020 2020 2320 4c6f              # Lo
-0003add0: 6164 2066 726f 6d20 524f 4920 6d61 736b  ad from ROI mask
-0003ade0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0003adf0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0003ae00: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0003ae10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0003ae20: 2e72 6f69 732e 6170 7065 6e64 2852 4f49  .rois.append(ROI
-0003ae30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0003ae40: 2020 2020 2020 2020 2020 736f 7572 6365            source
-0003ae50: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-0003ae60: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-0003ae70: 3d73 656c 662e 696d 6167 652c 0a20 2020  =self.image,.   
-0003ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ae90: 2020 2020 202a 2a73 656c 662e 726f 695f       **self.roi_
-0003aea0: 6b77 6172 6773 0a20 2020 2020 2020 2020  kwargs.         
-0003aeb0: 2020 2020 2020 2020 2020 2029 290a 2020             )).  
-0003aec0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0003aed0: 6365 7074 2052 756e 7469 6d65 4572 726f  cept RuntimeErro
-0003aee0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-0003aef0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-0003af00: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-0003af10: 6164 6564 203d 2054 7275 650a 0a20 2020  aded = True..   
-0003af20: 2020 2020 2073 656c 662e 7265 6e61 6d65       self.rename
-0003af30: 5f72 6f69 7328 6b65 6570 5f72 656e 616d  _rois(keep_renam
-0003af40: 6564 5f6f 6e6c 793d 7365 6c66 2e6b 6565  ed_only=self.kee
-0003af50: 705f 7265 6e61 6d65 645f 6f6e 6c79 290a  p_renamed_only).
-0003af60: 2020 2020 2020 2020 7365 6c66 2e66 696c          self.fil
-0003af70: 7465 725f 726f 6973 2829 0a20 2020 2020  ter_rois().     
-0003af80: 2020 2073 656c 662e 7265 636f 6c6f 725f     self.recolor_
-0003af90: 726f 6973 2873 656c 662e 636f 6c6f 7273  rois(self.colors
-0003afa0: 290a 2020 2020 2020 2020 736c 6963 655f  ).        slice_
-0003afb0: 7468 6963 6b6e 6573 7365 7320 3d20 5b5d  thicknesses = []
-0003afc0: 0a20 2020 2020 2020 2072 6f69 7320 3d20  .        rois = 
-0003afd0: 5b5d 0a20 2020 2020 2020 2066 6f72 2072  [].        for r
-0003afe0: 6f69 2069 6e20 7365 6c66 2e72 6f69 733a  oi in self.rois:
-0003aff0: 0a20 2020 2020 2020 2020 2020 2072 6f69  .            roi
-0003b000: 2e73 7472 7563 7475 7265 5f73 6574 203d  .structure_set =
-0003b010: 2073 656c 660a 2020 2020 2020 2020 2020   self.          
-0003b020: 2020 726f 692e 7365 745f 616c 7068 615f    roi.set_alpha_
-0003b030: 6f76 6572 5f62 6574 6128 7365 6c66 2e61  over_beta(self.a
-0003b040: 6c70 6861 5f62 6574 615f 7261 7469 6f73  lpha_beta_ratios
-0003b050: 2e67 6574 2872 6f69 2e6e 616d 652c 204e  .get(roi.name, N
-0003b060: 6f6e 6529 290a 2020 2020 2020 2020 2020  one)).          
-0003b070: 2020 666f 7220 706c 616e 2069 6e20 7365    for plan in se
-0003b080: 6c66 2e70 6c61 6e73 3a0a 2020 2020 2020  lf.plans:.      
-0003b090: 2020 2020 2020 2020 2020 726f 692e 6164            roi.ad
-0003b0a0: 645f 706c 616e 2870 6c61 6e29 0a0a 2020  d_plan(plan)..  
-0003b0b0: 2020 2020 2020 2020 2020 6966 2072 6f69            if roi
-0003b0c0: 2e73 6f75 7263 655f 7479 7065 203d 3d20  .source_type == 
-0003b0d0: 2263 6f6e 746f 7572 223a 0a20 2020 2020  "contour":.     
-0003b0e0: 2020 2020 2020 2020 2020 2069 6620 726f             if ro
-0003b0f0: 692e 736c 6963 655f 7468 6963 6b6e 6573  i.slice_thicknes
-0003b100: 735f 636f 6e74 6f75 7273 2069 7320 6e6f  s_contours is no
-0003b110: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0003b120: 2020 2020 2020 2020 2020 2020 736c 6963              slic
-0003b130: 655f 7468 6963 6b6e 6573 7365 732e 6170  e_thicknesses.ap
-0003b140: 7065 6e64 2872 6f69 2e73 6c69 6365 5f74  pend(roi.slice_t
-0003b150: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
-0003b160: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-0003b170: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0003b180: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-0003b190: 732e 6170 7065 6e64 2872 6f69 290a 0a20  s.append(roi).. 
-0003b1a0: 2020 2020 2020 2023 2049 6620 736c 6963         # If slic
-0003b1b0: 6520 7468 6963 6b6e 6573 7320 6973 6e27  e thickness isn'
-0003b1c0: 7420 7365 7420 666f 7220 616e 2052 4f49  t set for an ROI
-0003b1d0: 2066 726f 6d20 636f 6e74 6f75 7273 2c0a   from contours,.
-0003b1e0: 2020 2020 2020 2020 2320 7365 7420 6974          # set it
-0003b1f0: 7320 7468 6963 6b6e 6573 7320 746f 2074  s thickness to t
-0003b200: 6865 206d 696e 696d 756d 2066 6f72 2061  he minimum for a
-0003b210: 6c6c 206f 7468 6572 2052 4f49 730a 2020  ll other ROIs.  
-0003b220: 2020 2020 2020 2320 696e 2074 6865 2073        # in the s
-0003b230: 7472 7563 7475 7265 2073 6574 2e0a 2020  tructure set..  
-0003b240: 2020 2020 2020 6966 2072 6f69 7320 616e        if rois an
-0003b250: 6420 736c 6963 655f 7468 6963 6b6e 6573  d slice_thicknes
-0003b260: 7365 733a 0a20 2020 2020 2020 2020 2020  ses:.           
-0003b270: 2073 6c69 6365 5f74 6869 636b 6e65 7373   slice_thickness
-0003b280: 203d 206d 696e 2873 6c69 6365 5f74 6869   = min(slice_thi
-0003b290: 636b 6e65 7373 6573 290a 2020 2020 2020  cknesses).      
-0003b2a0: 2020 2020 2020 666f 7220 726f 6920 696e        for roi in
-0003b2b0: 2072 6f69 733a 0a20 2020 2020 2020 2020   rois:.         
-0003b2c0: 2020 2020 2020 2072 6f69 2e73 6c69 6365         roi.slice
-0003b2d0: 5f74 6869 636b 6e65 7373 5f63 6f6e 746f  _thickness_conto
-0003b2e0: 7572 7320 3d20 736c 6963 655f 7468 6963  urs = slice_thic
-0003b2f0: 6b6e 6573 730a 0a20 2020 2064 6566 2067  kness..    def g
-0003b300: 6574 5f64 6963 6f6d 5f64 6174 6173 6574  et_dicom_dataset
-0003b310: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0003b320: 2222 2252 6574 7572 6e20 7079 6469 636f  """Return pydico
-0003b330: 6d2e 6461 7461 7365 742e 4669 6c65 4461  m.dataset.FileDa
-0003b340: 7461 7365 7420 6f62 6a65 6374 2061 7373  taset object ass
-0003b350: 6f63 6961 7465 6420 7769 7468 2074 6869  ociated with thi
-0003b360: 7320 496d 6167 652c 0a20 2020 2020 2020  s Image,.       
-0003b370: 2069 6620 6c6f 6164 6564 2066 726f 6d20   if loaded from 
-0003b380: 6469 636f 6d3b 206f 7468 6572 7769 7365  dicom; otherwise
-0003b390: 2c20 7265 7475 726e 204e 6f6e 652e 2222  , return None.""
-0003b3a0: 220a 0a20 2020 2020 2020 2073 656c 662e  "..        self.
-0003b3b0: 6c6f 6164 2829 0a20 2020 2020 2020 2072  load().        r
-0003b3c0: 6574 7572 6e20 7365 6c66 2e64 6963 6f6d  eturn self.dicom
-0003b3d0: 5f64 6174 6173 6574 0a0a 2020 2020 6465  _dataset..    de
-0003b3e0: 6620 7265 7365 7428 7365 6c66 293a 0a20  f reset(self):. 
-0003b3f0: 2020 2020 2020 2022 2222 5265 6c6f 6164         """Reload
-0003b400: 2073 7472 7563 7475 7265 2073 6574 2066   structure set f
-0003b410: 726f 6d20 6f72 6967 696e 616c 2073 6f75  rom original sou
-0003b420: 7263 6528 7329 2e22 2222 0a0a 2020 2020  rce(s)."""..    
-0003b430: 2020 2020 7365 6c66 2e72 6f69 7320 3d20      self.rois = 
-0003b440: 5b5d 0a20 2020 2020 2020 2073 656c 662e  [].        self.
-0003b450: 6c6f 6164 6564 203d 2046 616c 7365 0a20  loaded = False. 
-0003b460: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
-0003b470: 2866 6f72 6365 3d54 7275 6529 0a0a 2020  (force=True)..  
-0003b480: 2020 6465 6620 7265 7365 745f 636f 6e74    def reset_cont
-0003b490: 6f75 7273 2873 656c 662c 2063 6f6e 746f  ours(self, conto
-0003b4a0: 7572 733d 4e6f 6e65 2c20 6d6f 7374 5f70  urs=None, most_p
-0003b4b0: 6f69 6e74 733d 4661 6c73 6529 3a0a 2020  oints=False):.  
-0003b4c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0003b4d0: 2020 5265 7365 7420 782d 7920 636f 6e74    Reset x-y cont
-0003b4e0: 6f75 7273 2066 6f72 2052 4f49 7320 6f66  ours for ROIs of
-0003b4f0: 2073 7472 7563 7475 7265 2073 6574 2e0a   structure set..
-0003b500: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
-0003b510: 6574 6572 733a 2a2a 0a20 2020 2020 2020  eters:**.       
-0003b520: 200a 2020 2020 2020 2020 636f 6e74 6f75   .        contou
-0003b530: 7273 203a 2064 6963 742c 2064 6566 6175  rs : dict, defau
-0003b540: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-0003b550: 2020 2020 4469 6374 696f 6e61 7279 2077      Dictionary w
-0003b560: 6865 7265 206b 6579 7320 6172 6520 524f  here keys are RO
-0003b570: 4920 6e61 6d65 7320 616e 6420 7661 6c75  I names and valu
-0003b580: 6573 2061 7265 2064 6963 7469 6f6e 6172  es are dictionar
-0003b590: 6965 730a 2020 2020 2020 2020 2020 2020  ies.            
-0003b5a0: 6f66 2073 6c69 6365 2061 6e64 2063 6f6e  of slice and con
-0003b5b0: 746f 7572 206c 6973 7473 2e20 2049 6620  tour lists.  If 
-0003b5c0: 4e6f 6e65 2c20 616e 2065 6d70 7479 2064  None, an empty d
-0003b5d0: 6963 7469 6f6e 6172 7920 6973 0a20 2020  ictionary is.   
-0003b5e0: 2020 2020 2020 2020 2075 7365 642e 2020           used.  
-0003b5f0: 4966 2061 6e20 524f 4920 6861 7320 6120  If an ROI has a 
-0003b600: 6e61 6d65 206e 6f74 2069 6e63 6c75 6465  name not include
-0003b610: 6420 696e 2074 6865 2074 6f70 2d6c 6576  d in the top-lev
-0003b620: 656c 0a20 2020 2020 2020 2020 2020 2064  el.            d
-0003b630: 6963 7469 6f6e 6172 792c 206f 7220 6861  ictionary, or ha
-0003b640: 7320 6120 6e61 6d65 2077 6974 6820 6173  s a name with as
-0003b650: 736f 6369 6174 6564 2076 616c 7565 204e  sociated value N
-0003b660: 6f6e 652c 2074 6865 0a20 2020 2020 2020  one, the.       
-0003b670: 2020 2020 2052 4f49 2063 6f6e 746f 7572       ROI contour
-0003b680: 7320 7769 6c6c 2062 6520 7265 7365 7420  s will be reset 
-0003b690: 7573 696e 6720 7468 6520 524f 4927 7320  using the ROI's 
-0003b6a0: 6f77 6e20 782d 7920 636f 6e74 6f75 7273  own x-y contours
-0003b6b0: 2e0a 0a20 2020 2020 2020 206d 6f73 745f  ...        most_
-0003b6c0: 706f 696e 7473 203a 2062 6f6f 6c2c 2064  points : bool, d
-0003b6d0: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
-0003b6e0: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-0003b6f0: 2c20 6f6e 6c79 2074 6865 2063 6f6e 746f  , only the conto
-0003b700: 7572 2077 6974 6820 6d6f 7374 2070 6f69  ur with most poi
-0003b710: 6e74 7320 666f 7220 6561 6368 2073 6c69  nts for each sli
-0003b720: 6365 0a20 2020 2020 2020 2020 2020 2069  ce.            i
-0003b730: 7320 7265 7461 696e 6564 2061 6674 6572  s retained after
-0003b740: 2072 6573 6574 7469 6e67 2e20 2049 6620   resetting.  If 
-0003b750: 4661 6c73 652c 2061 6c6c 2063 6f6e 746f  False, all conto
-0003b760: 7572 7320 666f 7220 6561 6368 0a20 2020  urs for each.   
-0003b770: 2020 2020 2020 2020 2073 6c69 6365 2061           slice a
-0003b780: 7265 2072 6574 6169 6e65 642e 0a20 2020  re retained..   
-0003b790: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0003b7a0: 2063 6f6e 746f 7572 7320 3d20 636f 6e74   contours = cont
-0003b7b0: 6f75 7273 206f 7220 7b7d 0a20 2020 2020  ours or {}.     
-0003b7c0: 2020 2066 6f72 2072 6f69 2069 6e20 7365     for roi in se
-0003b7d0: 6c66 2e67 6574 5f72 6f69 7328 293a 0a20  lf.get_rois():. 
-0003b7e0: 2020 2020 2020 2020 2020 2072 6f69 2e72             roi.r
-0003b7f0: 6573 6574 5f63 6f6e 746f 7572 7328 636f  eset_contours(co
-0003b800: 6e74 6f75 7273 2e67 6574 2872 6f69 2e6e  ntours.get(roi.n
-0003b810: 616d 652c 204e 6f6e 6529 2c20 6d6f 7374  ame, None), most
-0003b820: 5f70 6f69 6e74 7329 0a0a 2020 2020 6465  _points)..    de
-0003b830: 6620 7365 745f 696d 6167 655f 746f 5f64  f set_image_to_d
-0003b840: 756d 6d79 2873 656c 662c 202a 2a6b 7761  ummy(self, **kwa
-0003b850: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
-0003b860: 220a 2020 2020 2020 2020 5365 7420 696d  ".        Set im
-0003b870: 6167 6520 666f 7220 7365 6c66 2061 6e64  age for self and
-0003b880: 2061 6c6c 2052 4f49 7320 746f 2062 6520   all ROIs to be 
-0003b890: 6120 6475 6d6d 7920 696d 6167 6520 636f  a dummy image co
-0003b8a0: 7665 7269 6e67 0a20 2020 2020 2020 2074  vering.        t
-0003b8b0: 6865 2072 6567 696f 6e20 636f 6e74 6169  he region contai
-0003b8c0: 6e69 6e67 2061 6c6c 2052 4f49 7320 696e  ning all ROIs in
-0003b8d0: 2074 6865 2073 7472 7563 7475 7265 2073   the structure s
-0003b8e0: 6574 2e20 2054 6865 206d 6173 6b0a 2020  et.  The mask.  
-0003b8f0: 2020 2020 2020 616e 6420 782d 7a2f 792d        and x-z/y-
-0003b900: 7a20 636f 6e74 6f75 7273 206f 6620 6561  z contours of ea
-0003b910: 6368 2052 4f49 2077 696c 6c20 6265 2063  ch ROI will be c
-0003b920: 6c65 6172 6564 2c20 736f 2074 6861 7420  leared, so that 
-0003b930: 7468 6579 0a20 2020 2020 2020 2077 696c  they.        wil
-0003b940: 6c20 6265 2072 6563 7265 6174 6564 2077  l be recreated w
-0003b950: 6865 6e20 6765 745f 6d61 736b 2829 206f  hen get_mask() o
-0003b960: 7220 6765 745f 636f 6e74 6f75 7273 2829  r get_contours()
-0003b970: 2061 7265 206e 6578 7420 6361 6c6c 6564   are next called
-0003b980: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
-0003b990: 616d 6574 6572 733a 2a2a 0a20 2020 2020  ameters:**.     
-0003b9a0: 2020 200a 2020 2020 2020 2020 6b77 6172     .        kwar
-0003b9b0: 6773 203a 200a 2020 2020 2020 2020 2020  gs : .          
-0003b9c0: 2020 4b65 7977 6f72 6420 6172 6775 6d65    Keyword argume
-0003b9d0: 6e74 7320 746f 2070 6173 7320 746f 2073  nts to pass to s
-0003b9e0: 656c 662e 6765 745f 6475 6d6d 795f 696d  elf.get_dummy_im
-0003b9f0: 6167 6528 2920 7768 656e 0a20 2020 2020  age() when.     
-0003ba00: 2020 2020 2020 2063 7265 6174 696e 6720         creating 
-0003ba10: 7468 6520 6475 6d6d 7920 696d 6167 652e  the dummy image.
-0003ba20: 2053 6565 2064 6f63 756d 656e 7461 7469   See documentati
-0003ba30: 6f6e 206f 660a 2020 2020 2020 2020 2020  on of.          
-0003ba40: 2020 5374 7275 6374 7572 6553 6574 2e67    StructureSet.g
-0003ba50: 6574 5f64 756d 6d79 5f69 6d61 6765 2829  et_dummy_image()
-0003ba60: 2e0a 2020 2020 2022 2222 0a20 2020 2020  ..     """.     
-0003ba70: 2020 2023 204d 616b 6520 696d 6167 650a     # Make image.
-0003ba80: 2020 2020 2020 2020 696d 203d 2073 656c          im = sel
-0003ba90: 662e 6765 745f 6475 6d6d 795f 696d 6167  f.get_dummy_imag
-0003baa0: 6528 2a2a 6b77 6172 6773 290a 0a20 2020  e(**kwargs)..   
-0003bab0: 2020 2020 2023 2043 6c65 6172 206d 6173       # Clear mas
-0003bac0: 6b20 616e 6420 636f 6e74 6f75 7273 0a20  k and contours. 
-0003bad0: 2020 2020 2020 2066 6f72 2072 6f69 2069         for roi i
-0003bae0: 6e20 7365 6c66 2e72 6f69 733a 0a20 2020  n self.rois:.   
-0003baf0: 2020 2020 2020 2020 2072 6f69 2e69 6e70           roi.inp
-0003bb00: 7574 5f63 6f6e 746f 7572 7320 3d20 726f  ut_contours = ro
-0003bb10: 692e 6765 745f 636f 6e74 6f75 7273 2822  i.get_contours("
-0003bb20: 782d 7922 290a 2020 2020 2020 2020 2020  x-y").          
-0003bb30: 2020 726f 692e 636f 6e74 6f75 7273 203d    roi.contours =
-0003bb40: 207b 2278 2d79 223a 2072 6f69 2e69 6e70   {"x-y": roi.inp
-0003bb50: 7574 5f63 6f6e 746f 7572 737d 0a20 2020  ut_contours}.   
-0003bb60: 2020 2020 2020 2020 2072 6f69 2e6c 6f61           roi.loa
-0003bb70: 6465 645f 6d61 736b 203d 2046 616c 7365  ded_mask = False
-0003bb80: 0a20 2020 2020 2020 2020 2020 2072 6f69  .            roi
-0003bb90: 2e6d 6173 6b20 3d20 4e6f 6e65 0a0a 2020  .mask = None..  
-0003bba0: 2020 2020 2020 2320 4173 7369 676e 2069        # Assign i
-0003bbb0: 6d61 6765 0a20 2020 2020 2020 2073 656c  mage.        sel
-0003bbc0: 662e 7365 745f 696d 6167 6528 696d 290a  f.set_image(im).
-0003bbd0: 0a20 2020 2064 6566 2073 6574 5f69 6d61  .    def set_ima
-0003bbe0: 6765 2873 656c 662c 2069 6d61 6765 2c20  ge(self, image, 
-0003bbf0: 6164 645f 746f 5f69 6d61 6765 3d54 7275  add_to_image=Tru
-0003bc00: 6529 3a0a 2020 2020 2020 2020 2222 2253  e):.        """S
-0003bc10: 6574 2069 6d61 6765 2066 6f72 2073 656c  et image for sel
-0003bc20: 6620 616e 6420 616c 6c20 524f 4973 2e0a  f and all ROIs..
-0003bc30: 2020 2020 2020 2020 4966 2061 6464 5f74          If add_t
-0003bc40: 6f5f 696d 6167 6520 6973 2054 7275 652c  o_image is True,
-0003bc50: 2069 6d61 6765 2e61 6464 5f73 7472 7563   image.add_struc
-0003bc60: 7475 7265 5f73 6574 2873 656c 6629 0a20  ture_set(self). 
-0003bc70: 2020 2020 2020 2077 696c 6c20 616c 736f         will also
-0003bc80: 2062 6520 6361 6c6c 6564 2e22 2222 0a0a   be called."""..
-0003bc90: 2020 2020 2020 2020 2320 436f 6e76 6572          # Conver
-0003bca0: 7420 746f 2049 6d61 6765 206f 626a 6563  t to Image objec
-0003bcb0: 7420 6966 206e 6565 6465 640a 2020 2020  t if needed.    
-0003bcc0: 2020 2020 6966 2069 6d61 6765 2061 6e64      if image and
-0003bcd0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-0003bce0: 696d 6167 652c 2073 6b72 742e 696d 6167  image, skrt.imag
-0003bcf0: 652e 496d 6167 6529 3a0a 2020 2020 2020  e.Image):.      
-0003bd00: 2020 2020 2020 696d 6167 6520 3d20 736b        image = sk
-0003bd10: 7274 2e69 6d61 6765 2e49 6d61 6765 2869  rt.image.Image(i
-0003bd20: 6d61 6765 290a 0a20 2020 2020 2020 2023  mage)..        #
-0003bd30: 2041 7373 6967 6e20 746f 2073 656c 6620   Assign to self 
-0003bd40: 616e 6420 616c 6c20 524f 4973 0a20 2020  and all ROIs.   
-0003bd50: 2020 2020 2073 656c 662e 696d 6167 6520       self.image 
-0003bd60: 3d20 696d 6167 650a 2020 2020 2020 2020  = image.        
-0003bd70: 666f 7220 726f 6920 696e 2073 656c 662e  for roi in self.
-0003bd80: 726f 6973 3a0a 2020 2020 2020 2020 2020  rois:.          
-0003bd90: 2020 726f 692e 7365 745f 696d 6167 6528    roi.set_image(
-0003bda0: 696d 6167 6529 0a0a 2020 2020 2020 2020  image)..        
-0003bdb0: 2320 4173 7369 676e 2073 656c 6620 746f  # Assign self to
-0003bdc0: 2074 6865 2069 6d61 6765 0a20 2020 2020   the image.     
-0003bdd0: 2020 2069 6620 696d 6167 6520 6973 206e     if image is n
-0003bde0: 6f74 204e 6f6e 6520 616e 6420 6164 645f  ot None and add_
-0003bdf0: 746f 5f69 6d61 6765 3a0a 2020 2020 2020  to_image:.      
-0003be00: 2020 2020 2020 696d 6167 652e 6164 645f        image.add_
-0003be10: 7374 7275 6374 7572 655f 7365 7428 7365  structure_set(se
-0003be20: 6c66 290a 0a20 2020 2064 6566 2063 6f6e  lf)..    def con
-0003be30: 7461 696e 7328 7365 6c66 2c20 726f 695f  tains(self, roi_
-0003be40: 6e61 6d65 732c 2069 6e5f 696d 6167 653d  names, in_image=
-0003be50: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-0003be60: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
-0003be70: 726e 2077 6865 7468 6572 2073 7472 7563  rn whether struc
-0003be80: 7475 7265 2073 6574 2063 6f6e 7461 696e  ture set contain
-0003be90: 7320 6e61 6d65 6420 524f 4973 2c0a 2020  s named ROIs,.  
-0003bea0: 2020 2020 2020 6f70 7469 6f6e 616c 6c79        optionally
-0003beb0: 2074 6573 7469 6e67 2077 6865 7468 6572   testing whether
-0003bec0: 2074 6865 2052 4f49 7320 6265 2066 756c   the ROIs be ful
-0003bed0: 6c79 2063 6f6e 7461 696e 6564 2069 6e20  ly contained in 
-0003bee0: 616e 2069 6d61 6765 2e0a 0a20 2020 2020  an image...     
-0003bef0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-0003bf00: 2a2a 0a0a 2020 2020 2020 2020 726f 695f  **..        roi_
-0003bf10: 6e61 6d65 7320 3a20 6c69 7374 2f73 7472  names : list/str
-0003bf20: 0a20 2020 2020 2020 2020 2020 2053 696e  .            Sin
-0003bf30: 676c 6520 7374 7269 6e67 2c20 6f72 206c  gle string, or l
-0003bf40: 6973 7420 6f66 2073 7472 696e 6773 2c20  ist of strings, 
-0003bf50: 696e 6469 6361 7469 6e67 206e 616d 6528  indicating name(
-0003bf60: 7329 206f 6620 524f 4928 7329 0a20 2020  s) of ROI(s).   
-0003bf70: 2020 2020 2020 2020 2074 6f20 6265 2063           to be c
-0003bf80: 6f6e 7369 6465 7265 642e 0a0a 2020 2020  onsidered...    
-0003bf90: 2020 2020 696e 5f69 6d61 6765 203a 2062      in_image : b
-0003bfa0: 6f6f 6c2f 736b 7274 2e69 6d61 6765 2e49  ool/skrt.image.I
-0003bfb0: 6d61 6765 2c20 6465 6661 756c 743d 4661  mage, default=Fa
-0003bfc0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-0003bfd0: 5370 6563 6966 6963 6174 696f 6e20 6f66  Specification of
-0003bfe0: 2077 6865 7468 6572 2074 6f20 7465 7374   whether to test
-0003bff0: 2074 6861 7420 524f 4973 2061 7265 2066   that ROIs are f
-0003c000: 756c 6c79 2063 6f6e 7461 696e 6564 0a20  ully contained. 
-0003c010: 2020 2020 2020 2020 2020 2069 6e20 616e             in an
-0003c020: 2069 6d61 6765 2e20 2049 6620 696e 5f69   image.  If in_i
-0003c030: 6d61 6765 2069 7320 696e 2049 6d61 6765  mage is in Image
-0003c040: 206f 626a 6563 742c 2074 6865 2062 6f6f   object, the boo
-0003c050: 6c65 616e 2072 6574 7572 6e65 640a 2020  lean returned.  
-0003c060: 2020 2020 2020 2020 2020 696e 6469 6361            indica
-0003c070: 7465 7320 7768 6574 6865 7220 616c 6c20  tes whether all 
-0003c080: 6e61 6d65 6420 524f 4973 2061 7265 2063  named ROIs are c
-0003c090: 6f6e 7461 696e 6564 2077 6974 6869 6e20  ontained within 
-0003c0a0: 7468 6973 2069 6d61 6765 2e0a 2020 2020  this image..    
-0003c0b0: 2020 2020 2020 2020 4966 2069 6e5f 696d          If in_im
-0003c0c0: 6167 6520 6973 2054 7275 652c 2074 6865  age is True, the
-0003c0d0: 2062 6f6f 6c65 616e 2072 6574 7572 6e65   boolean returne
-0003c0e0: 6420 696e 6469 6361 7465 7320 7768 6574  d indicates whet
-0003c0f0: 6865 720a 2020 2020 2020 2020 2020 2020  her.            
-0003c100: 616c 6c20 6e61 6d65 6420 524f 4973 2061  all named ROIs a
-0003c110: 7265 2063 6f6e 7461 696e 6564 2077 6974  re contained wit
-0003c120: 6869 6e20 7468 6520 696d 6167 6520 6173  hin the image as
-0003c130: 736f 6369 6174 6564 2077 6974 680a 2020  sociated with.  
-0003c140: 2020 2020 2020 2020 2020 7365 6c66 2e0a            self..
-0003c150: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0003c160: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0003c170: 6528 726f 695f 6e61 6d65 732c 2073 7472  e(roi_names, str
-0003c180: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0003c190: 6f69 5f6e 616d 6573 203d 205b 726f 695f  oi_names = [roi_
-0003c1a0: 6e61 6d65 735d 0a0a 2020 2020 2020 2020  names]..        
-0003c1b0: 2320 4368 6563 6b20 7768 6574 6865 7220  # Check whether 
-0003c1c0: 7374 7275 6374 7572 6520 7365 7420 636f  structure set co
-0003c1d0: 6e74 6169 6e73 2061 6c6c 206e 616d 6564  ntains all named
-0003c1e0: 2052 4f49 732e 0a20 2020 2020 2020 2073   ROIs..        s
-0003c1f0: 735f 726f 695f 6e61 6d65 7320 3d20 7365  s_roi_names = se
-0003c200: 6c66 2e67 6574 5f72 6f69 5f6e 616d 6573  lf.get_roi_names
-0003c210: 2829 0a20 2020 2020 2020 2066 6f72 2072  ().        for r
-0003c220: 6f69 5f6e 616d 6520 696e 2072 6f69 5f6e  oi_name in roi_n
-0003c230: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
-0003c240: 2020 6966 2072 6f69 5f6e 616d 6520 6e6f    if roi_name no
-0003c250: 7420 696e 2073 735f 726f 695f 6e61 6d65  t in ss_roi_name
-0003c260: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0003c270: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0003c280: 0a20 2020 2020 2020 2023 2044 6574 6572  .        # Deter
-0003c290: 6d69 6e65 2077 6865 7468 6572 2074 6f20  mine whether to 
-0003c2a0: 6368 6563 6b20 7468 6174 206e 616d 6564  check that named
-0003c2b0: 2052 4f49 7320 6172 6520 636f 6e74 6169   ROIs are contai
-0003c2c0: 6e65 6420 696e 2061 6e20 696d 6167 652e  ned in an image.
-0003c2d0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0003c2e0: 696e 5f69 6d61 6765 3a0a 2020 2020 2020  in_image:.      
-0003c2f0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-0003c300: 650a 0a20 2020 2020 2020 2023 2043 6865  e..        # Che
-0003c310: 636b 2074 6861 7420 696d 6167 6520 6973  ck that image is
-0003c320: 2073 7065 6369 6669 6564 2e0a 2020 2020   specified..    
-0003c330: 2020 2020 2320 4966 2079 6573 2c20 2065      # If yes,  e
-0003c340: 6e73 7572 6520 7468 6174 2052 4f49 206d  nsure that ROI m
-0003c350: 6173 6b73 2068 6176 6520 7468 6520 7361  asks have the sa
-0003c360: 6d65 2076 6f78 656c 2073 697a 6520 6173  me voxel size as
-0003c370: 2074 6869 7320 696d 6167 652e 0a20 2020   this image..   
-0003c380: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0003c390: 6365 2869 6e5f 696d 6167 652c 2073 6b72  ce(in_image, skr
-0003c3a0: 742e 696d 6167 652e 496d 6167 6529 3a0a  t.image.Image):.
-0003c3b0: 2020 2020 2020 2020 2020 2020 696d 203d              im =
-0003c3c0: 2069 6e5f 696d 6167 650a 2020 2020 2020   in_image.      
-0003c3d0: 2020 2020 2020 7373 203d 2073 656c 662e        ss = self.
-0003c3e0: 636c 6f6e 6528 290a 2020 2020 2020 2020  clone().        
-0003c3f0: 2020 2020 7373 2e73 6574 5f69 6d61 6765      ss.set_image
-0003c400: 2869 6d2c 2061 6464 5f74 6f5f 696d 6167  (im, add_to_imag
-0003c410: 653d 4661 6c73 6529 0a20 2020 2020 2020  e=False).       
-0003c420: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0003c430: 2020 2069 6d20 3d20 7365 6c66 2e69 6d61     im = self.ima
-0003c440: 6765 0a20 2020 2020 2020 2020 2020 2073  ge.            s
-0003c450: 7320 3d20 7365 6c66 0a20 2020 2020 2020  s = self.       
-0003c460: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-0003c470: 6365 2869 6d2c 2073 6b72 742e 696d 6167  ce(im, skrt.imag
-0003c480: 652e 496d 6167 6529 3a0a 2020 2020 2020  e.Image):.      
-0003c490: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0003c4a0: 7365 0a0a 2020 2020 2020 2020 2320 4368  se..        # Ch
-0003c4b0: 6563 6b20 7768 6574 6865 7220 524f 4973  eck whether ROIs
-0003c4c0: 2061 7265 2063 6f6e 7461 696e 6564 2069   are contained i
-0003c4d0: 6e20 696d 6167 652e 0a20 2020 2020 2020  n image..       
-0003c4e0: 2069 6d5f 6578 7465 6e74 7320 3d20 696d   im_extents = im
-0003c4f0: 2e67 6574 5f65 7874 656e 7473 2829 0a20  .get_extents(). 
-0003c500: 2020 2020 2020 2066 6f72 2072 6f69 5f6e         for roi_n
-0003c510: 616d 6520 696e 2072 6f69 5f6e 616d 6573  ame in roi_names
-0003c520: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
-0003c530: 695f 6578 7465 6e74 7320 3d20 7373 5b72  i_extents = ss[r
-0003c540: 6f69 5f6e 616d 655d 2e67 6574 5f65 7874  oi_name].get_ext
-0003c550: 656e 7473 2830 2e35 2c20 2276 6f78 656c  ents(0.5, "voxel
-0003c560: 7322 290a 2020 2020 2020 2020 2020 2020  s").            
-0003c570: 666f 7220 6964 7820 696e 2072 616e 6765  for idx in range
-0003c580: 2833 293a 0a20 2020 2020 2020 2020 2020  (3):.           
-0003c590: 2020 2020 2069 6620 726f 695f 6578 7465       if roi_exte
-0003c5a0: 6e74 735b 6964 785d 5b30 5d20 3c20 696d  nts[idx][0] < im
-0003c5b0: 5f65 7874 656e 7473 5b69 6478 5d5b 305d  _extents[idx][0]
-0003c5c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003c5d0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0003c5e0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
-0003c5f0: 2020 2069 6620 726f 695f 6578 7465 6e74     if roi_extent
-0003c600: 735b 6964 785d 5b31 5d20 3e20 696d 5f65  s[idx][1] > im_e
-0003c610: 7874 656e 7473 5b69 6478 5d5b 315d 3a0a  xtents[idx][1]:.
-0003c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c630: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0003c640: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0003c650: 2054 7275 650a 0a20 2020 2064 6566 206d   True..    def m
-0003c660: 6973 7369 6e67 2873 656c 662c 2072 6f69  issing(self, roi
-0003c670: 5f6e 616d 6573 2c20 696e 5f69 6d61 6765  _names, in_image
-0003c680: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-0003c690: 2022 2222 0a20 2020 2020 2020 2049 6465   """.        Ide
-0003c6a0: 6e74 6966 7920 616d 6f6e 6720 6e61 6d65  ntify among name
-0003c6b0: 6420 524f 4973 2074 686f 7365 2074 6861  d ROIs those tha
-0003c6c0: 7420 6172 6520 6d69 7373 696e 6720 6672  t are missing fr
-0003c6d0: 6f6d 2073 7472 7563 7475 7265 2073 6574  om structure set
-0003c6e0: 2c0a 2020 2020 2020 2020 6f72 2061 7265  ,.        or are
-0003c6f0: 206e 6f74 2066 756c 6c79 2063 6f6e 7461   not fully conta
-0003c700: 696e 6564 2069 6e20 616e 2069 6d61 6765  ined in an image
-0003c710: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
-0003c720: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
-0003c730: 2020 2020 726f 695f 6e61 6d65 7320 3a20      roi_names : 
-0003c740: 6c69 7374 2f73 7472 0a20 2020 2020 2020  list/str.       
-0003c750: 2020 2020 2053 696e 676c 6520 7374 7269       Single stri
-0003c760: 6e67 2c20 6f72 206c 6973 7420 6f66 2073  ng, or list of s
-0003c770: 7472 696e 6773 2c20 696e 6469 6361 7469  trings, indicati
-0003c780: 6e67 206e 616d 6528 7329 206f 6620 524f  ng name(s) of RO
-0003c790: 4928 7329 0a20 2020 2020 2020 2020 2020  I(s).           
-0003c7a0: 2074 6f20 6265 2063 6f6e 7369 6465 7265   to be considere
-0003c7b0: 642e 0a0a 2020 2020 2020 2020 696e 5f69  d...        in_i
-0003c7c0: 6d61 6765 203a 2062 6f6f 6c2f 736b 7274  mage : bool/skrt
-0003c7d0: 2e69 6d61 6765 2e49 6d61 6765 2c20 6465  .image.Image, de
-0003c7e0: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-0003c7f0: 2020 2020 2020 2020 5370 6563 6966 6963          Specific
-0003c800: 6174 696f 6e20 6f66 2077 6865 7468 6572  ation of whether
-0003c810: 2074 6f20 7465 7374 2074 6861 7420 524f   to test that RO
-0003c820: 4973 2061 7265 2066 756c 6c79 2063 6f6e  Is are fully con
-0003c830: 7461 696e 6564 0a20 2020 2020 2020 2020  tained.         
-0003c840: 2020 2069 6e20 616e 2069 6d61 6765 2e20     in an image. 
-0003c850: 2049 6620 696e 5f69 6d61 6765 2069 7320   If in_image is 
-0003c860: 696e 2049 6d61 6765 206f 626a 6563 742c  in Image object,
-0003c870: 2061 6e20 524f 4920 6973 0a20 2020 2020   an ROI is.     
-0003c880: 2020 2020 2020 2069 6465 6e74 6966 6965         identifie
-0003c890: 6420 6173 206d 6973 7369 6e67 2069 6620  d as missing if 
-0003c8a0: 6e6f 7420 636f 6e74 6169 6e65 6420 7769  not contained wi
-0003c8b0: 7468 696e 2074 6869 7320 696d 6167 652e  thin this image.
-0003c8c0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-0003c8d0: 696e 5f69 6d61 6765 2069 7320 5472 7565  in_image is True
-0003c8e0: 2c20 616e 2052 4f49 2069 7320 6964 656e  , an ROI is iden
-0003c8f0: 7469 6669 6564 2061 7320 6d69 7373 696e  tified as missin
-0003c900: 6720 6966 206e 6f74 0a20 2020 2020 2020  g if not.       
-0003c910: 2020 2020 2063 6f6e 7461 696e 6564 2077       contained w
-0003c920: 6974 6869 6e20 7468 6520 696d 6167 6520  ithin the image 
-0003c930: 6173 736f 6369 6174 6564 2077 6974 6820  associated with 
-0003c940: 7365 6c66 2e0a 2020 2020 2020 2020 2222  self..        ""
-0003c950: 220a 2020 2020 2020 2020 6966 2069 7369  ".        if isi
-0003c960: 6e73 7461 6e63 6528 726f 695f 6e61 6d65  nstance(roi_name
-0003c970: 732c 2073 7472 293a 0a20 2020 2020 2020  s, str):.       
-0003c980: 2020 2020 2072 6f69 5f6e 616d 6573 203d       roi_names =
-0003c990: 205b 726f 695f 6e61 6d65 735d 0a20 2020   [roi_names].   
-0003c9a0: 2020 2020 206d 6973 7369 6e67 5f72 6f69       missing_roi
-0003c9b0: 7320 3d20 7365 7428 290a 0a20 2020 2020  s = set()..     
-0003c9c0: 2020 2023 2043 6865 636b 2066 6f72 2052     # Check for R
-0003c9d0: 4f49 7320 6e6f 7420 636f 6e74 6169 6e65  OIs not containe
-0003c9e0: 6420 696e 2073 7472 7563 7475 7265 2073  d in structure s
-0003c9f0: 6574 2e0a 2020 2020 2020 2020 7373 5f72  et..        ss_r
-0003ca00: 6f69 5f6e 616d 6573 203d 2073 656c 662e  oi_names = self.
-0003ca10: 6765 745f 726f 695f 6e61 6d65 7328 290a  get_roi_names().
-0003ca20: 2020 2020 2020 2020 666f 7220 726f 695f          for roi_
-0003ca30: 6e61 6d65 2069 6e20 726f 695f 6e61 6d65  name in roi_name
-0003ca40: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-0003ca50: 6620 726f 695f 6e61 6d65 206e 6f74 2069  f roi_name not i
-0003ca60: 6e20 7373 5f72 6f69 5f6e 616d 6573 3a0a  n ss_roi_names:.
-0003ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ca80: 6d69 7373 696e 675f 726f 6973 2e61 6464  missing_rois.add
-0003ca90: 2872 6f69 5f6e 616d 6529 0a0a 2020 2020  (roi_name)..    
-0003caa0: 2020 2020 2320 4465 7465 726d 696e 6520      # Determine 
-0003cab0: 7768 6574 6865 7220 746f 2063 6865 636b  whether to check
-0003cac0: 2074 6861 7420 6e61 6d65 6420 524f 4973   that named ROIs
-0003cad0: 2061 7265 2063 6f6e 7461 696e 6564 2069   are contained i
-0003cae0: 6e20 616e 2069 6d61 6765 2e0a 2020 2020  n an image..    
-0003caf0: 2020 2020 6966 206e 6f74 2069 6e5f 696d      if not in_im
-0003cb00: 6167 653a 0a20 2020 2020 2020 2020 2020  age:.           
-0003cb10: 2072 6574 7572 6e20 736f 7274 6564 286c   return sorted(l
-0003cb20: 6973 7428 6d69 7373 696e 675f 726f 6973  ist(missing_rois
-0003cb30: 2929 0a0a 2020 2020 2020 2020 2320 4368  ))..        # Ch
-0003cb40: 6563 6b20 7468 6174 2069 6d61 6765 2069  eck that image i
-0003cb50: 7320 7370 6563 6966 6965 642e 0a20 2020  s specified..   
-0003cb60: 2020 2020 2023 2049 6620 7965 732c 2020       # If yes,  
-0003cb70: 656e 7375 7265 2074 6861 7420 524f 4920  ensure that ROI 
-0003cb80: 6d61 736b 7320 6861 7665 2074 6865 2073  masks have the s
-0003cb90: 616d 6520 766f 7865 6c20 7369 7a65 2061  ame voxel size a
-0003cba0: 7320 7468 6973 2069 6d61 6765 2e0a 2020  s this image..  
-0003cbb0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0003cbc0: 6e63 6528 696e 5f69 6d61 6765 2c20 736b  nce(in_image, sk
-0003cbd0: 7274 2e69 6d61 6765 2e49 6d61 6765 293a  rt.image.Image):
-0003cbe0: 0a20 2020 2020 2020 2020 2020 2069 6d20  .            im 
-0003cbf0: 3d20 696e 5f69 6d61 6765 0a20 2020 2020  = in_image.     
-0003cc00: 2020 2020 2020 2073 7320 3d20 7365 6c66         ss = self
-0003cc10: 2e63 6c6f 6e65 2829 0a20 2020 2020 2020  .clone().       
-0003cc20: 2020 2020 2073 732e 7365 745f 696d 6167       ss.set_imag
-0003cc30: 6528 696d 2c20 6164 645f 746f 5f69 6d61  e(im, add_to_ima
-0003cc40: 6765 3d46 616c 7365 290a 2020 2020 2020  ge=False).      
-0003cc50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0003cc60: 2020 2020 696d 203d 2073 656c 662e 696d      im = self.im
-0003cc70: 6167 650a 2020 2020 2020 2020 2020 2020  age.            
-0003cc80: 7373 203d 2073 656c 660a 2020 2020 2020  ss = self.      
-0003cc90: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-0003cca0: 6e63 6528 696d 2c20 736b 7274 2e69 6d61  nce(im, skrt.ima
-0003ccb0: 6765 2e49 6d61 6765 293a 0a20 2020 2020  ge.Image):.     
-0003ccc0: 2020 2020 2020 2072 6169 7365 2052 756e         raise Run
-0003ccd0: 7469 6d65 4572 726f 7228 6622 496e 7661  timeError(f"Inva
-0003cce0: 6c69 6420 696d 6167 6520 7370 6563 6966  lid image specif
-0003ccf0: 6963 6174 696f 6e22 290a 0a20 2020 2020  ication")..     
-0003cd00: 2020 2023 2043 6865 636b 2077 6865 7468     # Check wheth
-0003cd10: 6572 2052 4f49 7320 6172 6520 636f 6e74  er ROIs are cont
-0003cd20: 6169 6e65 6420 696e 2069 6d61 6765 2e0a  ained in image..
-0003cd30: 2020 2020 2020 2020 696d 5f65 7874 656e          im_exten
-0003cd40: 7473 203d 2069 6d2e 6765 745f 6578 7465  ts = im.get_exte
-0003cd50: 6e74 7328 290a 2020 2020 2020 2020 6163  nts().        ac
-0003cd60: 7469 7665 5f72 6f69 7320 3d20 7365 7428  tive_rois = set(
-0003cd70: 726f 695f 6e61 6d65 7329 202d 206d 6973  roi_names) - mis
-0003cd80: 7369 6e67 5f72 6f69 730a 2020 2020 2020  sing_rois.      
-0003cd90: 2020 666f 7220 726f 695f 6e61 6d65 2069    for roi_name i
-0003cda0: 6e20 6163 7469 7665 5f72 6f69 733a 0a20  n active_rois:. 
-0003cdb0: 2020 2020 2020 2020 2020 2072 6f69 5f65             roi_e
-0003cdc0: 7874 656e 7473 203d 2073 735b 726f 695f  xtents = ss[roi_
-0003cdd0: 6e61 6d65 5d2e 6765 745f 6578 7465 6e74  name].get_extent
-0003cde0: 7328 302e 352c 2022 766f 7865 6c73 2229  s(0.5, "voxels")
-0003cdf0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0003ce00: 2069 6478 2069 6e20 7261 6e67 6528 3329   idx in range(3)
-0003ce10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003ce20: 2020 6966 2028 726f 695f 6578 7465 6e74    if (roi_extent
-0003ce30: 735b 6964 785d 5b30 5d20 3c20 696d 5f65  s[idx][0] < im_e
-0003ce40: 7874 656e 7473 5b69 6478 5d5b 305d 0a20  xtents[idx][0]. 
-0003ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ce60: 2020 206f 7220 726f 695f 6578 7465 6e74     or roi_extent
-0003ce70: 735b 6964 785d 5b31 5d20 3e20 696d 5f65  s[idx][1] > im_e
-0003ce80: 7874 656e 7473 5b69 6478 5d5b 315d 293a  xtents[idx][1]):
-0003ce90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003cea0: 2020 2020 206d 6973 7369 6e67 5f72 6f69       missing_roi
-0003ceb0: 732e 6164 6428 726f 695f 6e61 6d65 290a  s.add(roi_name).
-0003cec0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0003ced0: 736f 7274 6564 286c 6973 7428 6d69 7373  sorted(list(miss
-0003cee0: 696e 675f 726f 6973 2929 0a0a 2020 2020  ing_rois))..    
-0003cef0: 6465 6620 6861 735f 726f 6973 2873 656c  def has_rois(sel
-0003cf00: 662c 206e 616d 6573 3d4e 6f6e 652c 2069  f, names=None, i
-0003cf10: 6e63 6c75 6465 5f6b 6579 733d 4661 6c73  nclude_keys=Fals
-0003cf20: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
-0003cf30: 2020 2020 2020 2020 4465 7465 726d 696e          Determin
-0003cf40: 6520 7768 6574 6865 7220 7374 7275 6374  e whether struct
-0003cf50: 7572 6520 7365 7420 636f 6e74 6169 6e73  ure set contains
-0003cf60: 2073 7065 6369 6669 6564 2052 4f49 732c   specified ROIs,
-0003cf70: 0a20 2020 2020 2020 2069 6465 6e74 6966  .        identif
-0003cf80: 6965 6420 6279 2061 206e 6f6d 696e 616c  ied by a nominal
-0003cf90: 206e 616d 6520 6f72 2062 7920 616e 2061   name or by an a
-0003cfa0: 6c69 6173 2e0a 0a20 2020 2020 2020 2054  lias...        T
-0003cfb0: 6869 7320 6d65 7468 6f64 2072 6574 7572  his method retur
-0003cfc0: 6e73 2054 7275 6520 6966 2061 6c6c 2073  ns True if all s
-0003cfd0: 7065 6369 6669 6564 2052 4f49 206e 616d  pecified ROI nam
-0003cfe0: 6573 2061 7265 206d 6174 6368 6564 0a20  es are matched. 
-0003cff0: 2020 2020 2020 2077 6974 6820 7468 6520         with the 
-0003d000: 6e61 6d65 206f 6620 616e 2052 4f49 2069  name of an ROI i
-0003d010: 6e20 7468 6520 7374 7275 6374 7572 6520  n the structure 
-0003d020: 7365 742c 2061 6e64 2072 6574 7572 6e73  set, and returns
-0003d030: 2046 616c 7365 0a20 2020 2020 2020 206f   False.        o
-0003d040: 7468 6572 7769 7365 2e20 204d 6174 6368  therwise.  Match
-0003d050: 696e 6720 6973 2063 6173 6520 696e 7365  ing is case inse
-0003d060: 6e73 6974 6976 652e 0a0a 2020 2020 2020  nsitive...      
-0003d070: 2020 6e61 6d65 7320 3a20 7374 722f 6c69    names : str/li
-0003d080: 7374 2f64 6963 740a 2020 2020 2020 2020  st/dict.        
-0003d090: 2020 2020 5370 6563 6966 6963 6174 696f      Specificatio
-0003d0a0: 6e20 6f66 2052 4f49 733a 0a20 2020 2020  n of ROIs:.     
-0003d0b0: 2020 2020 2020 202d 2061 2073 696e 676c         - a singl
-0003d0c0: 6520 524f 4920 6e61 6d65 2c20 6f70 7469  e ROI name, opti
-0003d0d0: 6f6e 616c 6c79 2069 6e63 6c75 6469 6e67  onally including
-0003d0e0: 2077 696c 6463 6172 6473 3b0a 2020 2020   wildcards;.    
-0003d0f0: 2020 2020 2020 2020 2d20 6120 6c69 7374          - a list
-0003d100: 206f 6620 524f 4920 6e61 6d65 732c 2065   of ROI names, e
-0003d110: 6163 6820 6f70 7469 6f6e 616c 6c79 2069  ach optionally i
-0003d120: 6e63 6c75 6469 6e67 2077 696c 6463 6172  ncluding wildcar
-0003d130: 6473 3b0a 2020 2020 2020 2020 2020 2020  ds;.            
-0003d140: 2d20 6120 6469 6374 696f 6e61 7279 2c20  - a dictionary, 
-0003d150: 7768 6572 6520 6b65 7973 2061 7265 206e  where keys are n
-0003d160: 6f6d 696e 616c 2052 4f49 206e 616d 6573  ominal ROI names
-0003d170: 2c0a 2020 2020 2020 2020 2020 2020 616e  ,.            an
-0003d180: 6420 7661 6c75 6573 2061 7265 206c 6973  d values are lis
-0003d190: 7473 206f 6620 706f 7373 6962 6c65 206e  ts of possible n
-0003d1a0: 616d 6573 2c20 6f70 7469 6f6e 616c 6c79  ames, optionally
-0003d1b0: 2069 6e63 6c75 6469 6e67 0a20 2020 2020   including.     
-0003d1c0: 2020 2020 2020 2077 696c 6463 6172 6473         wildcards
-0003d1d0: 2e0a 0a20 2020 2020 2020 2069 6e63 6c75  ...        inclu
-0003d1e0: 6465 5f6b 6579 7320 3a20 626f 6f6c 2c20  de_keys : bool, 
-0003d1f0: 6465 6661 756c 743d 5472 7565 0a20 2020  default=True.   
-0003d200: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-0003d210: 2c20 636f 6e73 6964 6572 2062 6f74 6820  , consider both 
-0003d220: 6b65 7973 2061 6e64 2076 616c 7565 7320  keys and values 
-0003d230: 666f 7220 6d61 7463 6869 6e67 2069 6620  for matching if 
-0003d240: 524f 4920 6e61 6d65 730a 2020 2020 2020  ROI names.      
-0003d250: 2020 2020 2020 6172 6520 7370 6563 6966        are specif
-0003d260: 6965 6420 6173 2061 2064 6963 7469 6f6e  ied as a diction
-0003d270: 6172 792e 2020 4966 2046 616c 7365 2c20  ary.  If False, 
-0003d280: 636f 6e73 6964 6572 2076 616c 7565 7320  consider values 
-0003d290: 6f6e 6c79 2e0a 2020 2020 2020 2020 2222  only..        ""
-0003d2a0: 220a 2020 2020 2020 2020 2320 436f 6e76  ".        # Conv
-0003d2b0: 6572 7420 6e61 6d65 7320 746f 2061 2064  ert names to a d
-0003d2c0: 6963 7469 6f6e 6172 792c 2077 6865 7265  ictionary, where
-0003d2d0: 2065 6163 6820 7661 6c75 6520 6973 2061   each value is a
-0003d2e0: 206c 6973 742e 0a20 2020 2020 2020 2069   list..        i
-0003d2f0: 6620 6973 696e 7374 616e 6365 286e 616d  f isinstance(nam
-0003d300: 6573 2c20 7374 7229 3a0a 2020 2020 2020  es, str):.      
-0003d310: 2020 2020 2020 6e61 6d65 7320 3d20 7b6e        names = {n
-0003d320: 616d 6573 3a20 5b6e 616d 6573 5d7d 0a20  ames: [names]}. 
-0003d330: 2020 2020 2020 2065 6c69 6620 736b 7274         elif skrt
-0003d340: 2e63 6f72 652e 6973 5f6c 6973 7428 6e61  .core.is_list(na
-0003d350: 6d65 7329 3a0a 2020 2020 2020 2020 2020  mes):.          
-0003d360: 2020 6e61 6d65 7320 3d20 7b6e 616d 653a    names = {name:
-0003d370: 205b 6e61 6d65 5d20 666f 7220 6e61 6d65   [name] for name
-0003d380: 2069 6e20 6e61 6d65 737d 0a20 2020 2020   in names}.     
-0003d390: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-0003d3a0: 6365 286e 616d 6573 2c20 6469 6374 293a  ce(names, dict):
-0003d3b0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0003d3c0: 206e 616d 6520 696e 206e 616d 6573 3a0a   name in names:.
-0003d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d3e0: 6966 2069 7369 6e73 7461 6e63 6528 6e61  if isinstance(na
-0003d3f0: 6d65 735b 6e61 6d65 5d2c 2073 7472 293a  mes[name], str):
-0003d400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003d410: 2020 2020 206e 616d 6573 5b6e 616d 655d       names[name]
-0003d420: 203d 205b 6e61 6d65 735b 6e61 6d65 5d5d   = [names[name]]
-0003d430: 0a0a 2020 2020 2020 2020 2320 4578 6974  ..        # Exit
-0003d440: 2069 7320 6e61 6d65 7320 6973 6e27 7420   is names isn't 
-0003d450: 6120 6469 6374 696f 6e61 7279 2e0a 2020  a dictionary..  
-0003d460: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-0003d470: 6e73 7461 6e63 6528 6e61 6d65 732c 2064  nstance(names, d
-0003d480: 6963 7429 3a0a 2020 2020 2020 2020 2020  ict):.          
-0003d490: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
-0003d4a0: 2020 2020 2020 2020 2320 5472 7920 746f          # Try to
-0003d4b0: 206d 6174 6368 2065 6163 6820 524f 4920   match each ROI 
-0003d4c0: 6e61 6d65 2077 6974 6820 6e6f 6d69 6e61  name with nomina
-0003d4d0: 6c20 6e61 6d65 206f 7220 616e 7920 616c  l name or any al
-0003d4e0: 6961 7365 732e 0a20 2020 2020 2020 2066  iases..        f
-0003d4f0: 6f72 206e 616d 652c 2061 6c69 6173 6573  or name, aliases
-0003d500: 2069 6e20 6e61 6d65 732e 6974 656d 7328   in names.items(
-0003d510: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0003d520: 6620 696e 636c 7564 655f 6b65 7973 3a0a  f include_keys:.
-0003d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d540: 6e61 6d65 735f 746f 5f6d 6174 6368 203d  names_to_match =
-0003d550: 205b 6e61 6d65 5d20 2b20 616c 6961 7365   [name] + aliase
-0003d560: 730a 2020 2020 2020 2020 2020 2020 656c  s.            el
-0003d570: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0003d580: 2020 2020 6e61 6d65 735f 746f 5f6d 6174      names_to_mat
-0003d590: 6368 203d 2061 6c69 6173 6573 0a20 2020  ch = aliases.   
-0003d5a0: 2020 2020 2020 2020 2066 6f72 206e 616d           for nam
-0003d5b0: 655f 746f 5f6d 6174 6368 2069 6e20 6e61  e_to_match in na
-0003d5c0: 6d65 735f 746f 5f6d 6174 6368 3a0a 2020  mes_to_match:.  
-0003d5d0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0003d5e0: 7220 726f 695f 6e61 6d65 2069 6e20 7365  r roi_name in se
-0003d5f0: 6c66 2e67 6574 5f72 6f69 5f6e 616d 6573  lf.get_roi_names
-0003d600: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0003d610: 2020 2020 2020 2020 6d61 7463 6820 3d20          match = 
-0003d620: 666e 6d61 7463 682e 666e 6d61 7463 6828  fnmatch.fnmatch(
-0003d630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003d640: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-0003d650: 5f6e 616d 652e 6c6f 7765 7228 292c 206e  _name.lower(), n
-0003d660: 616d 655f 746f 5f6d 6174 6368 2e6c 6f77  ame_to_match.low
-0003d670: 6572 2829 290a 2020 2020 2020 2020 2020  er()).          
-0003d680: 2020 2020 2020 2020 2020 6966 206d 6174            if mat
-0003d690: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
-0003d6a0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0003d6b0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-0003d6c0: 2020 6966 206d 6174 6368 3a0a 2020 2020    if match:.    
-0003d6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d6e0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-0003d6f0: 2020 6966 206e 6f74 206d 6174 6368 3a0a    if not match:.
-0003d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d710: 7265 7475 726e 2046 616c 7365 0a0a 2020  return False..  
-0003d720: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-0003d730: 650a 0a20 2020 2064 6566 2072 656e 616d  e..    def renam
-0003d740: 655f 726f 6973 280a 2020 2020 2020 2020  e_rois(.        
-0003d750: 7365 6c66 2c20 6e61 6d65 733d 4e6f 6e65  self, names=None
-0003d760: 2c20 6669 7273 745f 6d61 7463 685f 6f6e  , first_match_on
-0003d770: 6c79 3d54 7275 652c 206b 6565 705f 7265  ly=True, keep_re
-0003d780: 6e61 6d65 645f 6f6e 6c79 3d46 616c 7365  named_only=False
-0003d790: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-0003d7a0: 2222 2252 656e 616d 6520 524f 4973 2069  """Rename ROIs i
-0003d7b0: 6e20 7468 6973 2053 7472 7563 7475 7265  n this Structure
-0003d7c0: 5365 742e 0a20 2020 2020 2020 203c 6669  Set..        <fi
-0003d7d0: 7273 745f 6d61 7463 685f 6f6e 6c79 3e20  rst_match_only> 
-0003d7e0: 6973 2054 7275 652c 206f 6e6c 7920 7468  is True, only th
-0003d7f0: 6520 6669 7273 7420 524f 4920 6d61 7463  e first ROI matc
-0003d800: 6869 6e67 2074 6865 0a20 2020 2020 2020  hing the.       
-0003d810: 2070 6f73 7369 626c 6520 6d61 7463 6865   possible matche
-0003d820: 7320 7769 6c6c 2062 6520 7265 6e61 6d65  s will be rename
-0003d830: 642e 0a0a 2020 2020 2020 2020 2a2a 5061  d...        **Pa
-0003d840: 7261 6d65 7465 7273 3a2a 2a0a 2020 2020  rameters:**.    
-0003d850: 2020 2020 0a20 2020 2020 2020 206e 616d      .        nam
-0003d860: 6573 203a 2064 6963 742c 2064 6566 6175  es : dict, defau
-0003d870: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-0003d880: 2020 2020 4469 6374 696f 6e61 7279 206f      Dictionary o
-0003d890: 6620 6e61 6d65 7320 666f 7220 7265 6e61  f names for rena
-0003d8a0: 6d69 6e67 2052 4f49 732c 2077 6865 7265  ming ROIs, where
-0003d8b0: 2074 6865 206b 6579 7320 6172 6520 6e65   the keys are ne
-0003d8c0: 7720 0a20 2020 2020 2020 2020 2020 206e  w .            n
-0003d8d0: 616d 6573 2061 6e64 2076 616c 7565 7320  ames and values 
-0003d8e0: 6172 6520 6c69 7374 7320 6f66 2070 6f73  are lists of pos
-0003d8f0: 7369 626c 6520 6e61 6d65 7320 6f66 2052  sible names of R
-0003d900: 4f49 7320 7468 6174 2073 686f 756c 640a  OIs that should.
-0003d910: 2020 2020 2020 2020 2020 2020 6265 2061              be a
-0003d920: 7373 6967 6e65 6420 7468 6520 6e65 7720  ssigned the new 
-0003d930: 6e61 6d65 2e20 5468 6573 6520 6e61 6d65  name. These name
-0003d940: 7320 6361 6e20 616c 736f 2063 6f6e 7461  s can also conta
-0003d950: 696e 2077 696c 6463 6172 6473 0a20 2020  in wildcards.   
-0003d960: 2020 2020 2020 2020 2077 6974 6820 7468           with th
-0003d970: 6520 272a 2720 7379 6d62 6f6c 2e0a 0a20  e '*' symbol... 
-0003d980: 2020 2020 2020 2066 6972 7374 5f6d 6174         first_mat
-0003d990: 6368 5f6f 6e6c 7920 3a20 626f 6f6c 2c20  ch_only : bool, 
-0003d9a0: 6465 6661 756c 743d 5472 7565 0a20 2020  default=True.   
-0003d9b0: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-0003d9c0: 2c20 6f6e 6c79 2074 6865 2066 6972 7374  , only the first
-0003d9d0: 2052 4f49 206d 6174 6368 696e 6720 7468   ROI matching th
-0003d9e0: 6520 706f 7373 6962 6c65 206e 616d 6573  e possible names
-0003d9f0: 2069 6e20 7468 6520 0a20 2020 2020 2020   in the .       
-0003da00: 2020 2020 2076 616c 7565 7320 6f66 203c       values of <
-0003da10: 6e61 6d65 733e 2077 696c 6c20 6265 2072  names> will be r
-0003da20: 656e 616d 6564 3b20 7468 6973 2070 7265  enamed; this pre
-0003da30: 7665 6e74 7320 6e61 6d65 2064 7570 6c69  vents name dupli
-0003da40: 6361 7469 6f6e 0a20 2020 2020 2020 2020  cation.         
-0003da50: 2020 2069 6620 6d75 6c74 6970 6c65 2052     if multiple R
-0003da60: 4f49 7320 696e 2074 6865 2053 7472 7563  OIs in the Struc
-0003da70: 7475 7265 5365 7420 6172 6520 6120 6d61  tureSet are a ma
-0003da80: 7463 682e 0a0a 2020 2020 2020 2020 6b65  tch...        ke
-0003da90: 6570 5f72 656e 616d 6564 5f6f 6e6c 7920  ep_renamed_only 
-0003daa0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-0003dab0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0003dac0: 2020 4966 2054 7275 652c 2061 6e79 2052    If True, any R
-0003dad0: 4f49 7320 7468 6174 2064 6f20 6e6f 7420  OIs that do not 
-0003dae0: 6765 7420 7265 6e61 6d65 6420 7769 6c6c  get renamed will
-0003daf0: 2062 6520 7265 6d6f 7665 6420 6672 6f6d   be removed from
-0003db00: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-0003db10: 2053 7472 7563 7475 7265 5365 742e 0a20   StructureSet.. 
-0003db20: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0003db30: 2020 2020 6966 206e 616d 6573 2069 7320      if names is 
-0003db40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0003db50: 2020 6e61 6d65 7320 3d20 7365 6c66 2e6e    names = self.n
-0003db60: 616d 6573 0a20 2020 2020 2020 2069 6620  ames.        if 
-0003db70: 6e6f 7420 6e61 6d65 7320 6f72 206e 6f74  not names or not
-0003db80: 2069 7369 6e73 7461 6e63 6528 6e61 6d65   isinstance(name
-0003db90: 732c 2064 6963 7429 3a0a 2020 2020 2020  s, dict):.      
-0003dba0: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-0003dbb0: 2020 2020 2020 2320 4c6f 6f70 2074 6872        # Loop thr
-0003dbc0: 6f75 6768 2065 6163 6820 6e65 7720 6e61  ough each new na
-0003dbd0: 6d65 0a20 2020 2020 2020 2061 6c72 6561  me.        alrea
-0003dbe0: 6479 5f72 656e 616d 6564 203d 205b 5d0a  dy_renamed = [].
-0003dbf0: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
-0003dc00: 2c20 6d61 7463 6865 7320 696e 206e 616d  , matches in nam
-0003dc10: 6573 2e69 7465 6d73 2829 3a0a 0a20 2020  es.items():..   
-0003dc20: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0003dc30: 736b 7274 2e63 6f72 652e 6973 5f6c 6973  skrt.core.is_lis
-0003dc40: 7428 6d61 7463 6865 7329 3a0a 2020 2020  t(matches):.    
-0003dc50: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
-0003dc60: 6865 7320 3d20 5b6d 6174 6368 6573 5d0a  hes = [matches].
-0003dc70: 0a20 2020 2020 2020 2020 2020 2023 204c  .            # L
-0003dc80: 6f6f 7020 7468 726f 7567 6820 616c 6c20  oop through all 
-0003dc90: 706f 7373 6962 6c65 206f 7269 6769 6e61  possible origina
-0003dca0: 6c20 6e61 6d65 730a 2020 2020 2020 2020  l names.        
-0003dcb0: 2020 2020 6e61 6d65 5f6d 6174 6368 6564      name_matched
-0003dcc0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-0003dcd0: 2020 2020 2066 6f72 206d 2069 6e20 6d61       for m in ma
-0003dce0: 7463 6865 733a 0a0a 2020 2020 2020 2020  tches:..        
-0003dcf0: 2020 2020 2020 2020 2320 4c6f 6f70 2074          # Loop t
-0003dd00: 6872 6f75 6768 2052 4f49 7320 616e 6420  hrough ROIs and 
-0003dd10: 7365 6520 6966 2074 6865 7265 2773 2061  see if there's a
-0003dd20: 206d 6174 6368 0a20 2020 2020 2020 2020   match.         
-0003dd30: 2020 2020 2020 2066 6f72 2069 2c20 7320         for i, s 
-0003dd40: 696e 2065 6e75 6d65 7261 7465 2873 656c  in enumerate(sel
-0003dd50: 662e 6765 745f 726f 6973 2829 293a 0a0a  f.get_rois()):..
-0003dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dd70: 2020 2020 2320 446f 6e27 7420 7265 6e61      # Don't rena
-0003dd80: 6d65 2061 6e20 524f 4920 6d6f 7265 2074  me an ROI more t
-0003dd90: 6861 6e20 6f6e 6365 0a20 2020 2020 2020  han once.       
-0003dda0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0003ddb0: 6920 696e 2061 6c72 6561 6479 5f72 656e  i in already_ren
-0003ddc0: 616d 6564 3a0a 2020 2020 2020 2020 2020  amed:.          
-0003ddd0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0003dde0: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
-0003ddf0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-0003de00: 6e6d 6174 6368 2e66 6e6d 6174 6368 2873  nmatch.fnmatch(s
-0003de10: 2e6e 616d 652e 6c6f 7765 7228 292c 206d  .name.lower(), m
-0003de20: 2e6c 6f77 6572 2829 293a 0a20 2020 2020  .lower()):.     
-0003de30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003de40: 2020 2073 2e6e 616d 6520 3d20 6e61 6d65     s.name = name
-0003de50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003de60: 2020 2020 2020 2020 206e 616d 655f 6d61           name_ma
-0003de70: 7463 6865 6420 3d20 5472 7565 0a20 2020  tched = True.   
-0003de80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003de90: 2020 2020 2061 6c72 6561 6479 5f72 656e       already_ren
-0003dea0: 616d 6564 2e61 7070 656e 6428 6929 0a20  amed.append(i). 
-0003deb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dec0: 2020 2020 2020 2069 6620 6669 7273 745f         if first_
-0003ded0: 6d61 7463 685f 6f6e 6c79 3a0a 2020 2020  match_only:.    
-0003dee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003def0: 2020 2020 2020 2020 6272 6561 6b0a 0a20          break.. 
-0003df00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0003df10: 2049 6620 6669 7273 745f 6d61 7463 685f   If first_match_
-0003df20: 6f6e 6c79 2c20 646f 6e27 7420 7265 6e61  only, don't rena
-0003df30: 6d65 206d 6f72 6520 7468 616e 206f 6e65  me more than one
-0003df40: 2052 4f49 0a20 2020 2020 2020 2020 2020   ROI.           
-0003df50: 2020 2020 2023 2077 6974 6820 7468 6973       # with this
-0003df60: 206e 6577 206e 616d 650a 2020 2020 2020   new name.      
-0003df70: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
-0003df80: 655f 6d61 7463 6865 6420 616e 6420 6669  e_matched and fi
-0003df90: 7273 745f 6d61 7463 685f 6f6e 6c79 3a0a  rst_match_only:.
+0003a180: 2020 206e 616d 6520 3d20 7365 6c66 2e6e     name = self.n
+0003a190: 616d 6573 5b69 5f6e 616d 655d 0a20 2020  ames[i_name].   
+0003a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a1b0: 2069 5f6e 616d 6520 2b3d 2031 0a20 2020   i_name += 1.   
+0003a1c0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0003a1d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0003a1e0: 2020 2020 2020 206e 616d 6520 3d20 6622         name = f"
+0003a1f0: 524f 4920 7b69 7d22 0a0a 2020 2020 2020  ROI {i}"..      
+0003a200: 2020 2020 2020 2020 2020 2369 6d32 2e64            #im2.d
+0003a210: 6174 6120 3d20 2869 6d31 2e64 6174 6120  ata = (im1.data 
+0003a220: 3d3d 2069 202b 2031 290a 2020 2020 2020  == i + 1).      
+0003a230: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
+0003a240: 6f69 732e 6170 7065 6e64 2852 4f49 280a  ois.append(ROI(.
+0003a250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a260: 2020 2020 6172 7261 7920 3d3d 2069 202b      array == i +
+0003a270: 2031 2c20 0a20 2020 2020 2020 2020 2020   1, .           
+0003a280: 2020 2020 2020 2020 2061 6666 696e 6520           affine 
+0003a290: 3d20 696d 2e67 6574 5f61 6666 696e 6528  = im.get_affine(
+0003a2a0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0003a2b0: 2020 2020 2020 2076 6f78 656c 5f73 697a         voxel_siz
+0003a2c0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+0003a2d0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+0003a2e0: 6967 696e 203d 204e 6f6e 652c 0a20 2020  igin = None,.   
+0003a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a300: 2069 6d61 6765 3d73 656c 662e 696d 6167   image=self.imag
+0003a310: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0003a320: 2020 2020 2020 206e 616d 653d 6e61 6d65         name=name
+0003a330: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0003a340: 2020 2020 2020 2a2a 7365 6c66 2e72 6f69        **self.roi
+0003a350: 5f6b 7761 7267 730a 2020 2020 2020 2020  _kwargs.        
+0003a360: 2020 2020 2020 2020 2929 0a20 2020 2020          )).     
+0003a370: 2020 2020 2020 2073 6f75 7263 6573 203d         sources =
+0003a380: 205b 5d0a 0a20 2020 2020 2020 2020 2020   []..           
+0003a390: 2023 2046 6f72 204e 4966 5449 2073 6f75   # For NIfTI sou
+0003a3a0: 7263 652c 2072 6576 6572 7420 746f 204e  rce, revert to N
+0003a3b0: 4966 5449 2063 6f6e 7665 6e74 696f 6e20  IfTI convention 
+0003a3c0: 666f 7220 6461 7461 2061 7272 6179 0a20  for data array. 
+0003a3d0: 2020 2020 2020 2020 2020 2023 206f 6620             # of 
+0003a3e0: 6d61 736b 2c20 736f 2074 6861 7420 6974  mask, so that it
+0003a3f0: 2063 616e 2062 6520 7772 6974 7465 6e20   can be written 
+0003a400: 636f 7272 6563 746c 7920 746f 2066 696c  correctly to fil
+0003a410: 652e 0a20 2020 2020 2020 2020 2020 2069  e..            i
+0003a420: 6620 276e 6966 7469 2720 696e 2069 6d2e  f 'nifti' in im.
+0003a430: 736f 7572 6365 5f74 7970 653a 0a20 2020  source_type:.   
+0003a440: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0003a450: 2069 6478 2069 6e20 7261 6e67 6528 6c65   idx in range(le
+0003a460: 6e28 7365 6c66 2e72 6f69 7329 293a 0a20  n(self.rois)):. 
+0003a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a480: 2020 2073 656c 662e 726f 6973 5b69 6478     self.rois[idx
+0003a490: 5d2e 6d61 736b 203d 2073 656c 662e 726f  ].mask = self.ro
+0003a4a0: 6973 5b69 6478 5d2e 6d61 736b 2e61 7374  is[idx].mask.ast
+0003a4b0: 7970 6528 276e 6969 2729 0a0a 2020 2020  ype('nii')..    
+0003a4c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0003a4d0: 2020 2020 2020 6966 206e 6f74 2073 6b72        if not skr
+0003a4e0: 742e 636f 7265 2e69 735f 6c69 7374 2873  t.core.is_list(s
+0003a4f0: 6f75 7263 6573 2920 6f72 2069 7369 6e73  ources) or isins
+0003a500: 7461 6e63 6528 736f 7572 6365 732c 206e  tance(sources, n
+0003a510: 702e 6e64 6172 7261 7929 3a0a 2020 2020  p.ndarray):.    
+0003a520: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+0003a530: 6365 7320 3d20 5b73 6f75 7263 6573 5d0a  ces = [sources].
+0003a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a550: 7369 6e67 6c65 5f73 6f75 7263 6520 3d20  single_source = 
+0003a560: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+0003a570: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0003a580: 2020 2020 2020 2073 696e 676c 655f 736f         single_so
+0003a590: 7572 6365 203d 2046 616c 7365 0a0a 2020  urce = False..  
+0003a5a0: 2020 2020 2020 2320 4578 7061 6e64 2061        # Expand a
+0003a5b0: 6e79 2064 6972 6563 746f 7269 6573 0a20  ny directories. 
+0003a5c0: 2020 2020 2020 2073 6f75 7263 6573 5f65         sources_e
+0003a5d0: 7870 616e 6465 6420 3d20 5b5d 0a20 2020  xpanded = [].   
+0003a5e0: 2020 2020 2066 6f72 2073 6f75 7263 6520       for source 
+0003a5f0: 696e 2073 6f75 7263 6573 3a0a 2020 2020  in sources:.    
+0003a600: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0003a610: 7461 6e63 6528 736f 7572 6365 2c20 7374  tance(source, st
+0003a620: 7229 2061 6e64 206f 732e 7061 7468 2e69  r) and os.path.i
+0003a630: 7364 6972 2873 6f75 7263 6529 3a0a 0a20  sdir(source):.. 
+0003a640: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0003a650: 6f75 7263 6573 5f65 7870 616e 6465 642e  ources_expanded.
+0003a660: 6578 7465 6e64 280a 2020 2020 2020 2020  extend(.        
+0003a670: 2020 2020 2020 2020 2020 2020 5b6f 732e              [os.
+0003a680: 7061 7468 2e6a 6f69 6e28 736f 7572 6365  path.join(source
+0003a690: 2c20 6669 6c65 2920 666f 7220 6669 6c65  , file) for file
+0003a6a0: 2069 6e20 6f73 2e6c 6973 7464 6972 2873   in os.listdir(s
+0003a6b0: 6f75 7263 6529 5d0a 2020 2020 2020 2020  ource)].        
+0003a6c0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0003a6d0: 2020 2020 2020 2020 2020 2023 2041 7574             # Aut
+0003a6e0: 6f2d 6173 7369 676e 206e 616d 6520 746f  o-assign name to
+0003a6f0: 2064 6972 6563 746f 7279 206e 616d 650a   directory name.
+0003a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a710: 6966 2073 696e 676c 655f 736f 7572 6365  if single_source
+0003a720: 2061 6e64 2073 656c 662e 6e61 6d65 2069   and self.name i
+0003a730: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0003a740: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0003a750: 2e6e 616d 6520 3d20 736f 7572 6365 0a0a  .name = source..
+0003a760: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0003a770: 206e 6f74 2073 656c 662e 6c6f 6164 6564   not self.loaded
+0003a780: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003a790: 2020 736f 7572 6365 735f 6578 7061 6e64    sources_expand
+0003a7a0: 6564 2e61 7070 656e 6428 736f 7572 6365  ed.append(source
+0003a7b0: 290a 0a20 2020 2020 2020 2066 6f72 2073  )..        for s
+0003a7c0: 6f75 7263 6520 696e 2073 6f72 7465 6428  ource in sorted(
+0003a7d0: 736f 7572 6365 735f 6578 7061 6e64 6564  sources_expanded
+0003a7e0: 293a 0a0a 2020 2020 2020 2020 2020 2020  ):..            
+0003a7f0: 6966 2069 7369 6e73 7461 6e63 6528 736f  if isinstance(so
+0003a800: 7572 6365 2c20 524f 4929 3a0a 2020 2020  urce, ROI):.    
+0003a810: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0003a820: 2e72 6f69 732e 6170 7065 6e64 2873 6f75  .rois.append(sou
+0003a830: 7263 6529 0a20 2020 2020 2020 2020 2020  rce).           
+0003a840: 2020 2020 2063 6f6e 7469 6e75 650a 0a20       continue.. 
+0003a850: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0003a860: 696e 7374 616e 6365 2873 6f75 7263 652c  instance(source,
+0003a870: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
+0003a880: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+0003a890: 682e 6261 7365 6e61 6d65 2873 6f75 7263  h.basename(sourc
+0003a8a0: 6529 2e73 7461 7274 7377 6974 6828 222e  e).startswith(".
+0003a8b0: 2229 206f 7220 736f 7572 6365 2e65 6e64  ") or source.end
+0003a8c0: 7377 6974 6828 222e 7478 7422 293a 0a20  swith(".txt"):. 
+0003a8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a8e0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+0003a8f0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+0003a900: 732e 7061 7468 2e69 7364 6972 2873 6f75  s.path.isdir(sou
+0003a910: 7263 6529 3a0a 2020 2020 2020 2020 2020  rce):.          
+0003a920: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+0003a930: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
+0003a940: 2320 4174 7465 6d70 7420 746f 206c 6f61  # Attempt to loa
+0003a950: 6420 6672 6f6d 2064 6963 6f6d 0a20 2020  d from dicom.   
+0003a960: 2020 2020 2020 2020 2072 6f69 7320 3d20           rois = 
+0003a970: 5b5d 0a20 2020 2020 2020 2020 2020 2069  [].            i
+0003a980: 6620 6973 696e 7374 616e 6365 2873 6f75  f isinstance(sou
+0003a990: 7263 652c 2073 7472 293a 0a20 2020 2020  rce, str):.     
+0003a9a0: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
+0003a9b0: 2e70 6174 682e 7370 6c69 7465 7874 2873  .path.splitext(s
+0003a9c0: 6f75 7263 6529 5b31 5d20 213d 2027 2e6e  ource)[1] != '.n
+0003a9d0: 6969 273a 0a20 2020 2020 2020 2020 2020  ii':.           
+0003a9e0: 2020 2020 2020 2020 2072 6f69 732c 2064           rois, d
+0003a9f0: 7320 3d20 6c6f 6164 5f72 6f69 735f 6469  s = load_rois_di
+0003aa00: 636f 6d28 736f 7572 6365 290a 2020 2020  com(source).    
+0003aa10: 2020 2020 2020 2020 6966 206c 656e 2872          if len(r
+0003aa20: 6f69 7329 3a0a 2020 2020 2020 2020 2020  ois):.          
+0003aa30: 2020 2020 2020 666f 7220 6e75 6d62 6572        for number
+0003aa40: 2c20 726f 6920 696e 2072 6f69 732e 6974  , roi in rois.it
+0003aa50: 656d 7328 293a 0a0a 2020 2020 2020 2020  ems():..        
+0003aa60: 2020 2020 2020 2020 2020 2020 2320 4967              # Ig
+0003aa70: 6e6f 7265 2065 6e74 7269 6573 2077 6974  nore entries wit
+0003aa80: 6820 6e6f 2063 6f6e 746f 7572 730a 2020  h no contours.  
+0003aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aaa0: 2020 6966 2022 636f 6e74 6f75 7273 2220    if "contours" 
+0003aab0: 6e6f 7420 696e 2072 6f69 3a0a 2020 2020  not in roi:.    
+0003aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aad0: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
+0003aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aaf0: 2020 2320 4967 6e6f 7265 2065 6e74 7269    # Ignore entri
+0003ab00: 6573 2063 6f6e 7461 696e 696e 6720 6f6e  es containing on
+0003ab10: 6c79 2061 2073 696e 676c 6520 706f 696e  ly a single poin
+0003ab20: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0003ab30: 2020 2020 2020 636f 6e74 6f75 7273 203d        contours =
+0003ab40: 2072 6f69 5b22 636f 6e74 6f75 7273 225d   roi["contours"]
+0003ab50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003ab60: 2020 2020 2069 6620 6c65 6e28 636f 6e74       if len(cont
+0003ab70: 6f75 7273 2920 3d3d 2031 3a0a 2020 2020  ours) == 1:.    
+0003ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ab90: 2020 2020 7369 6e67 6c65 5f63 6f6e 746f      single_conto
+0003aba0: 7572 203d 2063 6f6e 746f 7572 735b 6c69  ur = contours[li
+0003abb0: 7374 2863 6f6e 746f 7572 732e 6b65 7973  st(contours.keys
+0003abc0: 2829 295b 305d 5d5b 305d 0a20 2020 2020  ())[0]][0].     
+0003abd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003abe0: 2020 2069 6620 7369 6e67 6c65 5f63 6f6e     if single_con
+0003abf0: 746f 7572 2e73 6861 7065 5b30 5d20 3d3d  tour.shape[0] ==
+0003ac00: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0003ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ac20: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
+0003ac30: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0003ac40: 6c6f 7220 3d20 726f 695b 2263 6f6c 6f72  lor = roi["color
+0003ac50: 225d 2069 6620 6e6f 7420 7365 6c66 2e69  "] if not self.i
+0003ac60: 676e 6f72 655f 6469 636f 6d5f 636f 6c6f  gnore_dicom_colo
+0003ac70: 7273 2065 6c73 6520 4e6f 6e65 0a20 2020  rs else None.   
+0003ac80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ac90: 2073 656c 662e 726f 6973 2e61 7070 656e   self.rois.appen
+0003aca0: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
+0003acb0: 2020 2020 2020 2020 2020 2052 4f49 280a             ROI(.
+0003acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003acd0: 2020 2020 2020 2020 2020 2020 726f 695b              roi[
+0003ace0: 2263 6f6e 746f 7572 7322 5d2c 0a20 2020  "contours"],.   
+0003acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ad00: 2020 2020 2020 2020 206e 616d 653d 726f           name=ro
+0003ad10: 695b 226e 616d 6522 5d2c 0a20 2020 2020  i["name"],.     
+0003ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ad30: 2020 2020 2020 2063 6f6c 6f72 3d63 6f6c         color=col
+0003ad40: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+0003ad50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ad60: 696d 6167 653d 7365 6c66 2e69 6d61 6765  image=self.image
+0003ad70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0003ad80: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
+0003ad90: 7365 6c66 2e72 6f69 5f6b 7761 7267 730a  self.roi_kwargs.
+0003ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003adb0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0003adc0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0003add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ade0: 2020 2020 7365 6c66 2e72 6f69 735b 2d31      self.rois[-1
+0003adf0: 5d2e 6469 636f 6d5f 6461 7461 7365 7420  ].dicom_dataset 
+0003ae00: 3d20 6473 0a20 2020 2020 2020 2020 2020  = ds.           
+0003ae10: 2020 2020 2020 2020 2073 656c 662e 726f           self.ro
+0003ae20: 6973 5b2d 315d 2e6e 756d 6265 7220 3d20  is[-1].number = 
+0003ae30: 6e75 6d62 6572 0a20 2020 2020 2020 2020  number.         
+0003ae40: 2020 2020 2020 2073 656c 662e 6469 636f         self.dico
+0003ae50: 6d5f 6461 7461 7365 7420 3d20 6473 0a0a  m_dataset = ds..
+0003ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ae70: 2320 4175 746f 2d61 7373 6967 6e20 6e61  # Auto-assign na
+0003ae80: 6d65 2066 726f 6d20 6469 636f 6d20 6669  me from dicom fi
+0003ae90: 6c65 6e61 6d65 0a20 2020 2020 2020 2020  lename.         
+0003aea0: 2020 2020 2020 2069 6620 7369 6e67 6c65         if single
+0003aeb0: 5f73 6f75 7263 6520 616e 6420 7365 6c66  _source and self
+0003aec0: 2e6e 616d 6520 6973 204e 6f6e 653a 0a20  .name is None:. 
+0003aed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aee0: 2020 2073 656c 662e 6e61 6d65 203d 206f     self.name = o
+0003aef0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+0003af00: 736f 7572 6365 292e 7265 706c 6163 6528  source).replace(
+0003af10: 222e 6463 6d22 2c20 2222 290a 0a20 2020  ".dcm", "")..   
+0003af20: 2020 2020 2020 2020 2023 204c 6f61 6420           # Load 
+0003af30: 6672 6f6d 2052 4f49 206d 6173 6b0a 2020  from ROI mask.  
+0003af40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0003af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003af60: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0003af70: 2020 2020 2020 2020 2073 656c 662e 726f           self.ro
+0003af80: 6973 2e61 7070 656e 6428 524f 4928 0a20  is.append(ROI(. 
+0003af90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003afa0: 2020 2020 2020 2073 6f75 7263 652c 200a         source, .
+0003afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003afc0: 2020 2020 2020 2020 696d 6167 653d 7365          image=se
+0003afd0: 6c66 2e69 6d61 6765 2c0a 2020 2020 2020  lf.image,.      
+0003afe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aff0: 2020 2a2a 7365 6c66 2e72 6f69 5f6b 7761    **self.roi_kwa
+0003b000: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
+0003b010: 2020 2020 2020 2020 2929 0a20 2020 2020          )).     
+0003b020: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0003b030: 7420 5275 6e74 696d 6545 7272 6f72 3a0a  t RuntimeError:.
+0003b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b050: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
+0003b060: 2020 2020 2020 7365 6c66 2e6c 6f61 6465        self.loade
+0003b070: 6420 3d20 5472 7565 0a0a 2020 2020 2020  d = True..      
+0003b080: 2020 7365 6c66 2e72 656e 616d 655f 726f    self.rename_ro
+0003b090: 6973 286b 6565 705f 7265 6e61 6d65 645f  is(keep_renamed_
+0003b0a0: 6f6e 6c79 3d73 656c 662e 6b65 6570 5f72  only=self.keep_r
+0003b0b0: 656e 616d 6564 5f6f 6e6c 7929 0a20 2020  enamed_only).   
+0003b0c0: 2020 2020 2073 656c 662e 6669 6c74 6572       self.filter
+0003b0d0: 5f72 6f69 7328 290a 2020 2020 2020 2020  _rois().        
+0003b0e0: 7365 6c66 2e72 6563 6f6c 6f72 5f72 6f69  self.recolor_roi
+0003b0f0: 7328 7365 6c66 2e63 6f6c 6f72 7329 0a20  s(self.colors). 
+0003b100: 2020 2020 2020 2073 6c69 6365 5f74 6869         slice_thi
+0003b110: 636b 6e65 7373 6573 203d 205b 5d0a 2020  cknesses = [].  
+0003b120: 2020 2020 2020 726f 6973 203d 205b 5d0a        rois = [].
+0003b130: 2020 2020 2020 2020 666f 7220 726f 6920          for roi 
+0003b140: 696e 2073 656c 662e 726f 6973 3a0a 2020  in self.rois:.  
+0003b150: 2020 2020 2020 2020 2020 726f 692e 7374            roi.st
+0003b160: 7275 6374 7572 655f 7365 7420 3d20 7365  ructure_set = se
+0003b170: 6c66 0a20 2020 2020 2020 2020 2020 2072  lf.            r
+0003b180: 6f69 2e73 6574 5f61 6c70 6861 5f6f 7665  oi.set_alpha_ove
+0003b190: 725f 6265 7461 2873 656c 662e 616c 7068  r_beta(self.alph
+0003b1a0: 615f 6265 7461 5f72 6174 696f 732e 6765  a_beta_ratios.ge
+0003b1b0: 7428 726f 692e 6e61 6d65 2c20 4e6f 6e65  t(roi.name, None
+0003b1c0: 2929 0a20 2020 2020 2020 2020 2020 2066  )).            f
+0003b1d0: 6f72 2070 6c61 6e20 696e 2073 656c 662e  or plan in self.
+0003b1e0: 706c 616e 733a 0a20 2020 2020 2020 2020  plans:.         
+0003b1f0: 2020 2020 2020 2072 6f69 2e61 6464 5f70         roi.add_p
+0003b200: 6c61 6e28 706c 616e 290a 0a20 2020 2020  lan(plan)..     
+0003b210: 2020 2020 2020 2069 6620 726f 692e 736f         if roi.so
+0003b220: 7572 6365 5f74 7970 6520 3d3d 2022 636f  urce_type == "co
+0003b230: 6e74 6f75 7222 3a0a 2020 2020 2020 2020  ntour":.        
+0003b240: 2020 2020 2020 2020 6966 2072 6f69 2e73          if roi.s
+0003b250: 6c69 6365 5f74 6869 636b 6e65 7373 5f63  lice_thickness_c
+0003b260: 6f6e 746f 7572 7320 6973 206e 6f74 204e  ontours is not N
+0003b270: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0003b280: 2020 2020 2020 2020 2073 6c69 6365 5f74           slice_t
+0003b290: 6869 636b 6e65 7373 6573 2e61 7070 656e  hicknesses.appen
+0003b2a0: 6428 726f 692e 736c 6963 655f 7468 6963  d(roi.slice_thic
+0003b2b0: 6b6e 6573 735f 636f 6e74 6f75 7273 290a  kness_contours).
+0003b2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b2d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0003b2e0: 2020 2020 2020 2020 2020 726f 6973 2e61            rois.a
+0003b2f0: 7070 656e 6428 726f 6929 0a0a 2020 2020  ppend(roi)..    
+0003b300: 2020 2020 2320 4966 2073 6c69 6365 2074      # If slice t
+0003b310: 6869 636b 6e65 7373 2069 736e 2774 2073  hickness isn't s
+0003b320: 6574 2066 6f72 2061 6e20 524f 4920 6672  et for an ROI fr
+0003b330: 6f6d 2063 6f6e 746f 7572 732c 0a20 2020  om contours,.   
+0003b340: 2020 2020 2023 2073 6574 2069 7473 2074       # set its t
+0003b350: 6869 636b 6e65 7373 2074 6f20 7468 6520  hickness to the 
+0003b360: 6d69 6e69 6d75 6d20 666f 7220 616c 6c20  minimum for all 
+0003b370: 6f74 6865 7220 524f 4973 0a20 2020 2020  other ROIs.     
+0003b380: 2020 2023 2069 6e20 7468 6520 7374 7275     # in the stru
+0003b390: 6374 7572 6520 7365 742e 0a20 2020 2020  cture set..     
+0003b3a0: 2020 2069 6620 726f 6973 2061 6e64 2073     if rois and s
+0003b3b0: 6c69 6365 5f74 6869 636b 6e65 7373 6573  lice_thicknesses
+0003b3c0: 3a0a 2020 2020 2020 2020 2020 2020 736c  :.            sl
+0003b3d0: 6963 655f 7468 6963 6b6e 6573 7320 3d20  ice_thickness = 
+0003b3e0: 6d69 6e28 736c 6963 655f 7468 6963 6b6e  min(slice_thickn
+0003b3f0: 6573 7365 7329 0a20 2020 2020 2020 2020  esses).         
+0003b400: 2020 2066 6f72 2072 6f69 2069 6e20 726f     for roi in ro
+0003b410: 6973 3a0a 2020 2020 2020 2020 2020 2020  is:.            
+0003b420: 2020 2020 726f 692e 736c 6963 655f 7468      roi.slice_th
+0003b430: 6963 6b6e 6573 735f 636f 6e74 6f75 7273  ickness_contours
+0003b440: 203d 2073 6c69 6365 5f74 6869 636b 6e65   = slice_thickne
+0003b450: 7373 0a0a 2020 2020 6465 6620 6765 745f  ss..    def get_
+0003b460: 6469 636f 6d5f 6461 7461 7365 7428 7365  dicom_dataset(se
+0003b470: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0003b480: 5265 7475 726e 2070 7964 6963 6f6d 2e64  Return pydicom.d
+0003b490: 6174 6173 6574 2e46 696c 6544 6174 6173  ataset.FileDatas
+0003b4a0: 6574 206f 626a 6563 7420 6173 736f 6369  et object associ
+0003b4b0: 6174 6564 2077 6974 6820 7468 6973 2049  ated with this I
+0003b4c0: 6d61 6765 2c0a 2020 2020 2020 2020 6966  mage,.        if
+0003b4d0: 206c 6f61 6465 6420 6672 6f6d 2064 6963   loaded from dic
+0003b4e0: 6f6d 3b20 6f74 6865 7277 6973 652c 2072  om; otherwise, r
+0003b4f0: 6574 7572 6e20 4e6f 6e65 2e22 2222 0a0a  eturn None."""..
+0003b500: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+0003b510: 6428 290a 2020 2020 2020 2020 7265 7475  d().        retu
+0003b520: 726e 2073 656c 662e 6469 636f 6d5f 6461  rn self.dicom_da
+0003b530: 7461 7365 740a 0a20 2020 2064 6566 2072  taset..    def r
+0003b540: 6573 6574 2873 656c 6629 3a0a 2020 2020  eset(self):.    
+0003b550: 2020 2020 2222 2252 656c 6f61 6420 7374      """Reload st
+0003b560: 7275 6374 7572 6520 7365 7420 6672 6f6d  ructure set from
+0003b570: 206f 7269 6769 6e61 6c20 736f 7572 6365   original source
+0003b580: 2873 292e 2222 220a 0a20 2020 2020 2020  (s)."""..       
+0003b590: 2073 656c 662e 726f 6973 203d 205b 5d0a   self.rois = [].
+0003b5a0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+0003b5b0: 6465 6420 3d20 4661 6c73 650a 2020 2020  ded = False.    
+0003b5c0: 2020 2020 7365 6c66 2e6c 6f61 6428 666f      self.load(fo
+0003b5d0: 7263 653d 5472 7565 290a 0a20 2020 2064  rce=True)..    d
+0003b5e0: 6566 2072 6573 6574 5f63 6f6e 746f 7572  ef reset_contour
+0003b5f0: 7328 7365 6c66 2c20 636f 6e74 6f75 7273  s(self, contours
+0003b600: 3d4e 6f6e 652c 206d 6f73 745f 706f 696e  =None, most_poin
+0003b610: 7473 3d46 616c 7365 293a 0a20 2020 2020  ts=False):.     
+0003b620: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
+0003b630: 6573 6574 2078 2d79 2063 6f6e 746f 7572  eset x-y contour
+0003b640: 7320 666f 7220 524f 4973 206f 6620 7374  s for ROIs of st
+0003b650: 7275 6374 7572 6520 7365 742e 0a0a 2020  ructure set...  
+0003b660: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+0003b670: 7273 3a2a 2a0a 2020 2020 2020 2020 0a20  rs:**.        . 
+0003b680: 2020 2020 2020 2063 6f6e 746f 7572 7320         contours 
+0003b690: 3a20 6469 6374 2c20 6465 6661 756c 743d  : dict, default=
+0003b6a0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0003b6b0: 2044 6963 7469 6f6e 6172 7920 7768 6572   Dictionary wher
+0003b6c0: 6520 6b65 7973 2061 7265 2052 4f49 206e  e keys are ROI n
+0003b6d0: 616d 6573 2061 6e64 2076 616c 7565 7320  ames and values 
+0003b6e0: 6172 6520 6469 6374 696f 6e61 7269 6573  are dictionaries
+0003b6f0: 0a20 2020 2020 2020 2020 2020 206f 6620  .            of 
+0003b700: 736c 6963 6520 616e 6420 636f 6e74 6f75  slice and contou
+0003b710: 7220 6c69 7374 732e 2020 4966 204e 6f6e  r lists.  If Non
+0003b720: 652c 2061 6e20 656d 7074 7920 6469 6374  e, an empty dict
+0003b730: 696f 6e61 7279 2069 730a 2020 2020 2020  ionary is.      
+0003b740: 2020 2020 2020 7573 6564 2e20 2049 6620        used.  If 
+0003b750: 616e 2052 4f49 2068 6173 2061 206e 616d  an ROI has a nam
+0003b760: 6520 6e6f 7420 696e 636c 7564 6564 2069  e not included i
+0003b770: 6e20 7468 6520 746f 702d 6c65 7665 6c0a  n the top-level.
+0003b780: 2020 2020 2020 2020 2020 2020 6469 6374              dict
+0003b790: 696f 6e61 7279 2c20 6f72 2068 6173 2061  ionary, or has a
+0003b7a0: 206e 616d 6520 7769 7468 2061 7373 6f63   name with assoc
+0003b7b0: 6961 7465 6420 7661 6c75 6520 4e6f 6e65  iated value None
+0003b7c0: 2c20 7468 650a 2020 2020 2020 2020 2020  , the.          
+0003b7d0: 2020 524f 4920 636f 6e74 6f75 7273 2077    ROI contours w
+0003b7e0: 696c 6c20 6265 2072 6573 6574 2075 7369  ill be reset usi
+0003b7f0: 6e67 2074 6865 2052 4f49 2773 206f 776e  ng the ROI's own
+0003b800: 2078 2d79 2063 6f6e 746f 7572 732e 0a0a   x-y contours...
+0003b810: 2020 2020 2020 2020 6d6f 7374 5f70 6f69          most_poi
+0003b820: 6e74 7320 3a20 626f 6f6c 2c20 6465 6661  nts : bool, defa
+0003b830: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
+0003b840: 2020 2020 2020 4966 2054 7275 652c 206f        If True, o
+0003b850: 6e6c 7920 7468 6520 636f 6e74 6f75 7220  nly the contour 
+0003b860: 7769 7468 206d 6f73 7420 706f 696e 7473  with most points
+0003b870: 2066 6f72 2065 6163 6820 736c 6963 650a   for each slice.
+0003b880: 2020 2020 2020 2020 2020 2020 6973 2072              is r
+0003b890: 6574 6169 6e65 6420 6166 7465 7220 7265  etained after re
+0003b8a0: 7365 7474 696e 672e 2020 4966 2046 616c  setting.  If Fal
+0003b8b0: 7365 2c20 616c 6c20 636f 6e74 6f75 7273  se, all contours
+0003b8c0: 2066 6f72 2065 6163 680a 2020 2020 2020   for each.      
+0003b8d0: 2020 2020 2020 736c 6963 6520 6172 6520        slice are 
+0003b8e0: 7265 7461 696e 6564 2e0a 2020 2020 2020  retained..      
+0003b8f0: 2020 2222 220a 2020 2020 2020 2020 636f    """.        co
+0003b900: 6e74 6f75 7273 203d 2063 6f6e 746f 7572  ntours = contour
+0003b910: 7320 6f72 207b 7d0a 2020 2020 2020 2020  s or {}.        
+0003b920: 666f 7220 726f 6920 696e 2073 656c 662e  for roi in self.
+0003b930: 6765 745f 726f 6973 2829 3a0a 2020 2020  get_rois():.    
+0003b940: 2020 2020 2020 2020 726f 692e 7265 7365          roi.rese
+0003b950: 745f 636f 6e74 6f75 7273 2863 6f6e 746f  t_contours(conto
+0003b960: 7572 732e 6765 7428 726f 692e 6e61 6d65  urs.get(roi.name
+0003b970: 2c20 4e6f 6e65 292c 206d 6f73 745f 706f  , None), most_po
+0003b980: 696e 7473 290a 0a20 2020 2064 6566 2073  ints)..    def s
+0003b990: 6574 5f69 6d61 6765 5f74 6f5f 6475 6d6d  et_image_to_dumm
+0003b9a0: 7928 7365 6c66 2c20 2a2a 6b77 6172 6773  y(self, **kwargs
+0003b9b0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0003b9c0: 2020 2020 2020 2053 6574 2069 6d61 6765         Set image
+0003b9d0: 2066 6f72 2073 656c 6620 616e 6420 616c   for self and al
+0003b9e0: 6c20 524f 4973 2074 6f20 6265 2061 2064  l ROIs to be a d
+0003b9f0: 756d 6d79 2069 6d61 6765 2063 6f76 6572  ummy image cover
+0003ba00: 696e 670a 2020 2020 2020 2020 7468 6520  ing.        the 
+0003ba10: 7265 6769 6f6e 2063 6f6e 7461 696e 696e  region containin
+0003ba20: 6720 616c 6c20 524f 4973 2069 6e20 7468  g all ROIs in th
+0003ba30: 6520 7374 7275 6374 7572 6520 7365 742e  e structure set.
+0003ba40: 2020 5468 6520 6d61 736b 0a20 2020 2020    The mask.     
+0003ba50: 2020 2061 6e64 2078 2d7a 2f79 2d7a 2063     and x-z/y-z c
+0003ba60: 6f6e 746f 7572 7320 6f66 2065 6163 6820  ontours of each 
+0003ba70: 524f 4920 7769 6c6c 2062 6520 636c 6561  ROI will be clea
+0003ba80: 7265 642c 2073 6f20 7468 6174 2074 6865  red, so that the
+0003ba90: 790a 2020 2020 2020 2020 7769 6c6c 2062  y.        will b
+0003baa0: 6520 7265 6372 6561 7465 6420 7768 656e  e recreated when
+0003bab0: 2067 6574 5f6d 6173 6b28 2920 6f72 2067   get_mask() or g
+0003bac0: 6574 5f63 6f6e 746f 7572 7328 2920 6172  et_contours() ar
+0003bad0: 6520 6e65 7874 2063 616c 6c65 642e 0a0a  e next called...
+0003bae0: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
+0003baf0: 7465 7273 3a2a 2a0a 2020 2020 2020 2020  ters:**.        
+0003bb00: 0a20 2020 2020 2020 206b 7761 7267 7320  .        kwargs 
+0003bb10: 3a20 0a20 2020 2020 2020 2020 2020 204b  : .            K
+0003bb20: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+0003bb30: 2074 6f20 7061 7373 2074 6f20 7365 6c66   to pass to self
+0003bb40: 2e67 6574 5f64 756d 6d79 5f69 6d61 6765  .get_dummy_image
+0003bb50: 2829 2077 6865 6e0a 2020 2020 2020 2020  () when.        
+0003bb60: 2020 2020 6372 6561 7469 6e67 2074 6865      creating the
+0003bb70: 2064 756d 6d79 2069 6d61 6765 2e20 5365   dummy image. Se
+0003bb80: 6520 646f 6375 6d65 6e74 6174 696f 6e20  e documentation 
+0003bb90: 6f66 0a20 2020 2020 2020 2020 2020 2053  of.            S
+0003bba0: 7472 7563 7475 7265 5365 742e 6765 745f  tructureSet.get_
+0003bbb0: 6475 6d6d 795f 696d 6167 6528 292e 0a20  dummy_image().. 
+0003bbc0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0003bbd0: 2320 4d61 6b65 2069 6d61 6765 0a20 2020  # Make image.   
+0003bbe0: 2020 2020 2069 6d20 3d20 7365 6c66 2e67       im = self.g
+0003bbf0: 6574 5f64 756d 6d79 5f69 6d61 6765 282a  et_dummy_image(*
+0003bc00: 2a6b 7761 7267 7329 0a0a 2020 2020 2020  *kwargs)..      
+0003bc10: 2020 2320 436c 6561 7220 6d61 736b 2061    # Clear mask a
+0003bc20: 6e64 2063 6f6e 746f 7572 730a 2020 2020  nd contours.    
+0003bc30: 2020 2020 666f 7220 726f 6920 696e 2073      for roi in s
+0003bc40: 656c 662e 726f 6973 3a0a 2020 2020 2020  elf.rois:.      
+0003bc50: 2020 2020 2020 726f 692e 696e 7075 745f        roi.input_
+0003bc60: 636f 6e74 6f75 7273 203d 2072 6f69 2e67  contours = roi.g
+0003bc70: 6574 5f63 6f6e 746f 7572 7328 2278 2d79  et_contours("x-y
+0003bc80: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+0003bc90: 6f69 2e63 6f6e 746f 7572 7320 3d20 7b22  oi.contours = {"
+0003bca0: 782d 7922 3a20 726f 692e 696e 7075 745f  x-y": roi.input_
+0003bcb0: 636f 6e74 6f75 7273 7d0a 2020 2020 2020  contours}.      
+0003bcc0: 2020 2020 2020 726f 692e 6c6f 6164 6564        roi.loaded
+0003bcd0: 5f6d 6173 6b20 3d20 4661 6c73 650a 2020  _mask = False.  
+0003bce0: 2020 2020 2020 2020 2020 726f 692e 6d61            roi.ma
+0003bcf0: 736b 203d 204e 6f6e 650a 0a20 2020 2020  sk = None..     
+0003bd00: 2020 2023 2041 7373 6967 6e20 696d 6167     # Assign imag
+0003bd10: 650a 2020 2020 2020 2020 7365 6c66 2e73  e.        self.s
+0003bd20: 6574 5f69 6d61 6765 2869 6d29 0a0a 2020  et_image(im)..  
+0003bd30: 2020 6465 6620 7365 745f 696d 6167 6528    def set_image(
+0003bd40: 7365 6c66 2c20 696d 6167 652c 2061 6464  self, image, add
+0003bd50: 5f74 6f5f 696d 6167 653d 5472 7565 293a  _to_image=True):
+0003bd60: 0a20 2020 2020 2020 2022 2222 5365 7420  .        """Set 
+0003bd70: 696d 6167 6520 666f 7220 7365 6c66 2061  image for self a
+0003bd80: 6e64 2061 6c6c 2052 4f49 732e 0a20 2020  nd all ROIs..   
+0003bd90: 2020 2020 2049 6620 6164 645f 746f 5f69       If add_to_i
+0003bda0: 6d61 6765 2069 7320 5472 7565 2c20 696d  mage is True, im
+0003bdb0: 6167 652e 6164 645f 7374 7275 6374 7572  age.add_structur
+0003bdc0: 655f 7365 7428 7365 6c66 290a 2020 2020  e_set(self).    
+0003bdd0: 2020 2020 7769 6c6c 2061 6c73 6f20 6265      will also be
+0003bde0: 2063 616c 6c65 642e 2222 220a 0a20 2020   called."""..   
+0003bdf0: 2020 2020 2023 2043 6f6e 7665 7274 2074       # Convert t
+0003be00: 6f20 496d 6167 6520 6f62 6a65 6374 2069  o Image object i
+0003be10: 6620 6e65 6564 6564 0a20 2020 2020 2020  f needed.       
+0003be20: 2069 6620 696d 6167 6520 616e 6420 6e6f   if image and no
+0003be30: 7420 6973 696e 7374 616e 6365 2869 6d61  t isinstance(ima
+0003be40: 6765 2c20 736b 7274 2e69 6d61 6765 2e49  ge, skrt.image.I
+0003be50: 6d61 6765 293a 0a20 2020 2020 2020 2020  mage):.         
+0003be60: 2020 2069 6d61 6765 203d 2073 6b72 742e     image = skrt.
+0003be70: 696d 6167 652e 496d 6167 6528 696d 6167  image.Image(imag
+0003be80: 6529 0a0a 2020 2020 2020 2020 2320 4173  e)..        # As
+0003be90: 7369 676e 2074 6f20 7365 6c66 2061 6e64  sign to self and
+0003bea0: 2061 6c6c 2052 4f49 730a 2020 2020 2020   all ROIs.      
+0003beb0: 2020 7365 6c66 2e69 6d61 6765 203d 2069    self.image = i
+0003bec0: 6d61 6765 0a20 2020 2020 2020 2066 6f72  mage.        for
+0003bed0: 2072 6f69 2069 6e20 7365 6c66 2e72 6f69   roi in self.roi
+0003bee0: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+0003bef0: 6f69 2e73 6574 5f69 6d61 6765 2869 6d61  oi.set_image(ima
+0003bf00: 6765 290a 0a20 2020 2020 2020 2023 2041  ge)..        # A
+0003bf10: 7373 6967 6e20 7365 6c66 2074 6f20 7468  ssign self to th
+0003bf20: 6520 696d 6167 650a 2020 2020 2020 2020  e image.        
+0003bf30: 6966 2069 6d61 6765 2069 7320 6e6f 7420  if image is not 
+0003bf40: 4e6f 6e65 2061 6e64 2061 6464 5f74 6f5f  None and add_to_
+0003bf50: 696d 6167 653a 0a20 2020 2020 2020 2020  image:.         
+0003bf60: 2020 2069 6d61 6765 2e61 6464 5f73 7472     image.add_str
+0003bf70: 7563 7475 7265 5f73 6574 2873 656c 6629  ucture_set(self)
+0003bf80: 0a0a 2020 2020 6465 6620 6765 745f 696d  ..    def get_im
+0003bf90: 6167 6528 7365 6c66 293a 0a20 2020 2020  age(self):.     
+0003bfa0: 2020 2022 2222 5265 7475 726e 2049 6d61     """Return Ima
+0003bfb0: 6765 206f 626a 6563 7420 6173 736f 6369  ge object associ
+0003bfc0: 6174 6564 2077 6974 6820 7468 6973 2053  ated with this S
+0003bfd0: 7472 7563 7475 7265 5365 742e 2222 220a  tructureSet.""".
+0003bfe0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0003bff0: 656c 662e 696d 6167 650a 0a20 2020 2064  elf.image..    d
+0003c000: 6566 2063 6f6e 7461 696e 7328 7365 6c66  ef contains(self
+0003c010: 2c20 726f 695f 6e61 6d65 732c 2069 6e5f  , roi_names, in_
+0003c020: 696d 6167 653d 4661 6c73 6529 3a0a 2020  image=False):.  
+0003c030: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0003c040: 2020 5265 7475 726e 2077 6865 7468 6572    Return whether
+0003c050: 2073 7472 7563 7475 7265 2073 6574 2063   structure set c
+0003c060: 6f6e 7461 696e 7320 6e61 6d65 6420 524f  ontains named RO
+0003c070: 4973 2c0a 2020 2020 2020 2020 6f70 7469  Is,.        opti
+0003c080: 6f6e 616c 6c79 2074 6573 7469 6e67 2077  onally testing w
+0003c090: 6865 7468 6572 2074 6865 2052 4f49 7320  hether the ROIs 
+0003c0a0: 6265 2066 756c 6c79 2063 6f6e 7461 696e  be fully contain
+0003c0b0: 6564 2069 6e20 616e 2069 6d61 6765 2e0a  ed in an image..
+0003c0c0: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
+0003c0d0: 6574 6572 733a 2a2a 0a0a 2020 2020 2020  eters:**..      
+0003c0e0: 2020 726f 695f 6e61 6d65 7320 3a20 6c69    roi_names : li
+0003c0f0: 7374 2f73 7472 0a20 2020 2020 2020 2020  st/str.         
+0003c100: 2020 2053 696e 676c 6520 7374 7269 6e67     Single string
+0003c110: 2c20 6f72 206c 6973 7420 6f66 2073 7472  , or list of str
+0003c120: 696e 6773 2c20 696e 6469 6361 7469 6e67  ings, indicating
+0003c130: 206e 616d 6528 7329 206f 6620 524f 4928   name(s) of ROI(
+0003c140: 7329 0a20 2020 2020 2020 2020 2020 2074  s).            t
+0003c150: 6f20 6265 2063 6f6e 7369 6465 7265 642e  o be considered.
+0003c160: 0a0a 2020 2020 2020 2020 696e 5f69 6d61  ..        in_ima
+0003c170: 6765 203a 2062 6f6f 6c2f 736b 7274 2e69  ge : bool/skrt.i
+0003c180: 6d61 6765 2e49 6d61 6765 2c20 6465 6661  mage.Image, defa
+0003c190: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
+0003c1a0: 2020 2020 2020 5370 6563 6966 6963 6174        Specificat
+0003c1b0: 696f 6e20 6f66 2077 6865 7468 6572 2074  ion of whether t
+0003c1c0: 6f20 7465 7374 2074 6861 7420 524f 4973  o test that ROIs
+0003c1d0: 2061 7265 2066 756c 6c79 2063 6f6e 7461   are fully conta
+0003c1e0: 696e 6564 0a20 2020 2020 2020 2020 2020  ined.           
+0003c1f0: 2069 6e20 616e 2069 6d61 6765 2e20 2049   in an image.  I
+0003c200: 6620 696e 5f69 6d61 6765 2069 7320 696e  f in_image is in
+0003c210: 2049 6d61 6765 206f 626a 6563 742c 2074   Image object, t
+0003c220: 6865 2062 6f6f 6c65 616e 2072 6574 7572  he boolean retur
+0003c230: 6e65 640a 2020 2020 2020 2020 2020 2020  ned.            
+0003c240: 696e 6469 6361 7465 7320 7768 6574 6865  indicates whethe
+0003c250: 7220 616c 6c20 6e61 6d65 6420 524f 4973  r all named ROIs
+0003c260: 2061 7265 2063 6f6e 7461 696e 6564 2077   are contained w
+0003c270: 6974 6869 6e20 7468 6973 2069 6d61 6765  ithin this image
+0003c280: 2e0a 2020 2020 2020 2020 2020 2020 4966  ..            If
+0003c290: 2069 6e5f 696d 6167 6520 6973 2054 7275   in_image is Tru
+0003c2a0: 652c 2074 6865 2062 6f6f 6c65 616e 2072  e, the boolean r
+0003c2b0: 6574 7572 6e65 6420 696e 6469 6361 7465  eturned indicate
+0003c2c0: 7320 7768 6574 6865 720a 2020 2020 2020  s whether.      
+0003c2d0: 2020 2020 2020 616c 6c20 6e61 6d65 6420        all named 
+0003c2e0: 524f 4973 2061 7265 2063 6f6e 7461 696e  ROIs are contain
+0003c2f0: 6564 2077 6974 6869 6e20 7468 6520 696d  ed within the im
+0003c300: 6167 6520 6173 736f 6369 6174 6564 2077  age associated w
+0003c310: 6974 680a 2020 2020 2020 2020 2020 2020  ith.            
+0003c320: 7365 6c66 2e0a 2020 2020 2020 2020 2222  self..        ""
+0003c330: 220a 2020 2020 2020 2020 6966 2069 7369  ".        if isi
+0003c340: 6e73 7461 6e63 6528 726f 695f 6e61 6d65  nstance(roi_name
+0003c350: 732c 2073 7472 293a 0a20 2020 2020 2020  s, str):.       
+0003c360: 2020 2020 2072 6f69 5f6e 616d 6573 203d       roi_names =
+0003c370: 205b 726f 695f 6e61 6d65 735d 0a0a 2020   [roi_names]..  
+0003c380: 2020 2020 2020 2320 4368 6563 6b20 7768        # Check wh
+0003c390: 6574 6865 7220 7374 7275 6374 7572 6520  ether structure 
+0003c3a0: 7365 7420 636f 6e74 6169 6e73 2061 6c6c  set contains all
+0003c3b0: 206e 616d 6564 2052 4f49 732e 0a20 2020   named ROIs..   
+0003c3c0: 2020 2020 2073 735f 726f 695f 6e61 6d65       ss_roi_name
+0003c3d0: 7320 3d20 7365 6c66 2e67 6574 5f72 6f69  s = self.get_roi
+0003c3e0: 5f6e 616d 6573 2829 0a20 2020 2020 2020  _names().       
+0003c3f0: 2066 6f72 2072 6f69 5f6e 616d 6520 696e   for roi_name in
+0003c400: 2072 6f69 5f6e 616d 6573 3a0a 2020 2020   roi_names:.    
+0003c410: 2020 2020 2020 2020 6966 2072 6f69 5f6e          if roi_n
+0003c420: 616d 6520 6e6f 7420 696e 2073 735f 726f  ame not in ss_ro
+0003c430: 695f 6e61 6d65 733a 0a20 2020 2020 2020  i_names:.       
+0003c440: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0003c450: 4661 6c73 650a 0a20 2020 2020 2020 2023  False..        #
+0003c460: 2044 6574 6572 6d69 6e65 2077 6865 7468   Determine wheth
+0003c470: 6572 2074 6f20 6368 6563 6b20 7468 6174  er to check that
+0003c480: 206e 616d 6564 2052 4f49 7320 6172 6520   named ROIs are 
+0003c490: 636f 6e74 6169 6e65 6420 696e 2061 6e20  contained in an 
+0003c4a0: 696d 6167 652e 0a20 2020 2020 2020 2069  image..        i
+0003c4b0: 6620 6e6f 7420 696e 5f69 6d61 6765 3a0a  f not in_image:.
+0003c4c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0003c4d0: 726e 2054 7275 650a 0a20 2020 2020 2020  rn True..       
+0003c4e0: 2023 2043 6865 636b 2074 6861 7420 696d   # Check that im
+0003c4f0: 6167 6520 6973 2073 7065 6369 6669 6564  age is specified
+0003c500: 2e0a 2020 2020 2020 2020 2320 4966 2079  ..        # If y
+0003c510: 6573 2c20 2065 6e73 7572 6520 7468 6174  es,  ensure that
+0003c520: 2052 4f49 206d 6173 6b73 2068 6176 6520   ROI masks have 
+0003c530: 7468 6520 7361 6d65 2076 6f78 656c 2073  the same voxel s
+0003c540: 697a 6520 6173 2074 6869 7320 696d 6167  ize as this imag
+0003c550: 652e 0a20 2020 2020 2020 2069 6620 6973  e..        if is
+0003c560: 696e 7374 616e 6365 2869 6e5f 696d 6167  instance(in_imag
+0003c570: 652c 2073 6b72 742e 696d 6167 652e 496d  e, skrt.image.Im
+0003c580: 6167 6529 3a0a 2020 2020 2020 2020 2020  age):.          
+0003c590: 2020 696d 203d 2069 6e5f 696d 6167 650a    im = in_image.
+0003c5a0: 2020 2020 2020 2020 2020 2020 7373 203d              ss =
+0003c5b0: 2073 656c 662e 636c 6f6e 6528 290a 2020   self.clone().  
+0003c5c0: 2020 2020 2020 2020 2020 7373 2e73 6574            ss.set
+0003c5d0: 5f69 6d61 6765 2869 6d2c 2061 6464 5f74  _image(im, add_t
+0003c5e0: 6f5f 696d 6167 653d 4661 6c73 6529 0a20  o_image=False). 
+0003c5f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0003c600: 2020 2020 2020 2020 2069 6d20 3d20 7365           im = se
+0003c610: 6c66 2e69 6d61 6765 0a20 2020 2020 2020  lf.image.       
+0003c620: 2020 2020 2073 7320 3d20 7365 6c66 0a20       ss = self. 
+0003c630: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+0003c640: 696e 7374 616e 6365 2869 6d2c 2073 6b72  instance(im, skr
+0003c650: 742e 696d 6167 652e 496d 6167 6529 3a0a  t.image.Image):.
+0003c660: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0003c670: 726e 2046 616c 7365 0a0a 2020 2020 2020  rn False..      
+0003c680: 2020 2320 4368 6563 6b20 7768 6574 6865    # Check whethe
+0003c690: 7220 524f 4973 2061 7265 2063 6f6e 7461  r ROIs are conta
+0003c6a0: 696e 6564 2069 6e20 696d 6167 652e 0a20  ined in image.. 
+0003c6b0: 2020 2020 2020 2069 6d5f 6578 7465 6e74         im_extent
+0003c6c0: 7320 3d20 696d 2e67 6574 5f65 7874 656e  s = im.get_exten
+0003c6d0: 7473 2829 0a20 2020 2020 2020 2066 6f72  ts().        for
+0003c6e0: 2072 6f69 5f6e 616d 6520 696e 2072 6f69   roi_name in roi
+0003c6f0: 5f6e 616d 6573 3a0a 2020 2020 2020 2020  _names:.        
+0003c700: 2020 2020 726f 695f 6578 7465 6e74 7320      roi_extents 
+0003c710: 3d20 7373 5b72 6f69 5f6e 616d 655d 2e67  = ss[roi_name].g
+0003c720: 6574 5f65 7874 656e 7473 2830 2e35 2c20  et_extents(0.5, 
+0003c730: 2276 6f78 656c 7322 290a 2020 2020 2020  "voxels").      
+0003c740: 2020 2020 2020 666f 7220 6964 7820 696e        for idx in
+0003c750: 2072 616e 6765 2833 293a 0a20 2020 2020   range(3):.     
+0003c760: 2020 2020 2020 2020 2020 2069 6620 726f             if ro
+0003c770: 695f 6578 7465 6e74 735b 6964 785d 5b30  i_extents[idx][0
+0003c780: 5d20 3c20 696d 5f65 7874 656e 7473 5b69  ] < im_extents[i
+0003c790: 6478 5d5b 305d 3a0a 2020 2020 2020 2020  dx][0]:.        
+0003c7a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0003c7b0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+0003c7c0: 2020 2020 2020 2020 2069 6620 726f 695f           if roi_
+0003c7d0: 6578 7465 6e74 735b 6964 785d 5b31 5d20  extents[idx][1] 
+0003c7e0: 3e20 696d 5f65 7874 656e 7473 5b69 6478  > im_extents[idx
+0003c7f0: 5d5b 315d 3a0a 2020 2020 2020 2020 2020  ][1]:.          
+0003c800: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0003c810: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
+0003c820: 7265 7475 726e 2054 7275 650a 0a20 2020  return True..   
+0003c830: 2064 6566 206d 6973 7369 6e67 2873 656c   def missing(sel
+0003c840: 662c 2072 6f69 5f6e 616d 6573 2c20 696e  f, roi_names, in
+0003c850: 5f69 6d61 6765 3d46 616c 7365 293a 0a20  _image=False):. 
+0003c860: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0003c870: 2020 2049 6465 6e74 6966 7920 616d 6f6e     Identify amon
+0003c880: 6720 6e61 6d65 6420 524f 4973 2074 686f  g named ROIs tho
+0003c890: 7365 2074 6861 7420 6172 6520 6d69 7373  se that are miss
+0003c8a0: 696e 6720 6672 6f6d 2073 7472 7563 7475  ing from structu
+0003c8b0: 7265 2073 6574 2c0a 2020 2020 2020 2020  re set,.        
+0003c8c0: 6f72 2061 7265 206e 6f74 2066 756c 6c79  or are not fully
+0003c8d0: 2063 6f6e 7461 696e 6564 2069 6e20 616e   contained in an
+0003c8e0: 2069 6d61 6765 2e0a 0a20 2020 2020 2020   image...       
+0003c8f0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+0003c900: 0a0a 2020 2020 2020 2020 726f 695f 6e61  ..        roi_na
+0003c910: 6d65 7320 3a20 6c69 7374 2f73 7472 0a20  mes : list/str. 
+0003c920: 2020 2020 2020 2020 2020 2053 696e 676c             Singl
+0003c930: 6520 7374 7269 6e67 2c20 6f72 206c 6973  e string, or lis
+0003c940: 7420 6f66 2073 7472 696e 6773 2c20 696e  t of strings, in
+0003c950: 6469 6361 7469 6e67 206e 616d 6528 7329  dicating name(s)
+0003c960: 206f 6620 524f 4928 7329 0a20 2020 2020   of ROI(s).     
+0003c970: 2020 2020 2020 2074 6f20 6265 2063 6f6e         to be con
+0003c980: 7369 6465 7265 642e 0a0a 2020 2020 2020  sidered...      
+0003c990: 2020 696e 5f69 6d61 6765 203a 2062 6f6f    in_image : boo
+0003c9a0: 6c2f 736b 7274 2e69 6d61 6765 2e49 6d61  l/skrt.image.Ima
+0003c9b0: 6765 2c20 6465 6661 756c 743d 4661 6c73  ge, default=Fals
+0003c9c0: 650a 2020 2020 2020 2020 2020 2020 5370  e.            Sp
+0003c9d0: 6563 6966 6963 6174 696f 6e20 6f66 2077  ecification of w
+0003c9e0: 6865 7468 6572 2074 6f20 7465 7374 2074  hether to test t
+0003c9f0: 6861 7420 524f 4973 2061 7265 2066 756c  hat ROIs are ful
+0003ca00: 6c79 2063 6f6e 7461 696e 6564 0a20 2020  ly contained.   
+0003ca10: 2020 2020 2020 2020 2069 6e20 616e 2069           in an i
+0003ca20: 6d61 6765 2e20 2049 6620 696e 5f69 6d61  mage.  If in_ima
+0003ca30: 6765 2069 7320 696e 2049 6d61 6765 206f  ge is in Image o
+0003ca40: 626a 6563 742c 2061 6e20 524f 4920 6973  bject, an ROI is
+0003ca50: 0a20 2020 2020 2020 2020 2020 2069 6465  .            ide
+0003ca60: 6e74 6966 6965 6420 6173 206d 6973 7369  ntified as missi
+0003ca70: 6e67 2069 6620 6e6f 7420 636f 6e74 6169  ng if not contai
+0003ca80: 6e65 6420 7769 7468 696e 2074 6869 7320  ned within this 
+0003ca90: 696d 6167 652e 0a20 2020 2020 2020 2020  image..         
+0003caa0: 2020 2049 6620 696e 5f69 6d61 6765 2069     If in_image i
+0003cab0: 7320 5472 7565 2c20 616e 2052 4f49 2069  s True, an ROI i
+0003cac0: 7320 6964 656e 7469 6669 6564 2061 7320  s identified as 
+0003cad0: 6d69 7373 696e 6720 6966 206e 6f74 0a20  missing if not. 
+0003cae0: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
+0003caf0: 696e 6564 2077 6974 6869 6e20 7468 6520  ined within the 
+0003cb00: 696d 6167 6520 6173 736f 6369 6174 6564  image associated
+0003cb10: 2077 6974 6820 7365 6c66 2e0a 2020 2020   with self..    
+0003cb20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0003cb30: 6966 2069 7369 6e73 7461 6e63 6528 726f  if isinstance(ro
+0003cb40: 695f 6e61 6d65 732c 2073 7472 293a 0a20  i_names, str):. 
+0003cb50: 2020 2020 2020 2020 2020 2072 6f69 5f6e             roi_n
+0003cb60: 616d 6573 203d 205b 726f 695f 6e61 6d65  ames = [roi_name
+0003cb70: 735d 0a20 2020 2020 2020 206d 6973 7369  s].        missi
+0003cb80: 6e67 5f72 6f69 7320 3d20 7365 7428 290a  ng_rois = set().
+0003cb90: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
+0003cba0: 2066 6f72 2052 4f49 7320 6e6f 7420 636f   for ROIs not co
+0003cbb0: 6e74 6169 6e65 6420 696e 2073 7472 7563  ntained in struc
+0003cbc0: 7475 7265 2073 6574 2e0a 2020 2020 2020  ture set..      
+0003cbd0: 2020 7373 5f72 6f69 5f6e 616d 6573 203d    ss_roi_names =
+0003cbe0: 2073 656c 662e 6765 745f 726f 695f 6e61   self.get_roi_na
+0003cbf0: 6d65 7328 290a 2020 2020 2020 2020 666f  mes().        fo
+0003cc00: 7220 726f 695f 6e61 6d65 2069 6e20 726f  r roi_name in ro
+0003cc10: 695f 6e61 6d65 733a 0a20 2020 2020 2020  i_names:.       
+0003cc20: 2020 2020 2069 6620 726f 695f 6e61 6d65       if roi_name
+0003cc30: 206e 6f74 2069 6e20 7373 5f72 6f69 5f6e   not in ss_roi_n
+0003cc40: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
+0003cc50: 2020 2020 2020 6d69 7373 696e 675f 726f        missing_ro
+0003cc60: 6973 2e61 6464 2872 6f69 5f6e 616d 6529  is.add(roi_name)
+0003cc70: 0a0a 2020 2020 2020 2020 2320 4465 7465  ..        # Dete
+0003cc80: 726d 696e 6520 7768 6574 6865 7220 746f  rmine whether to
+0003cc90: 2063 6865 636b 2074 6861 7420 6e61 6d65   check that name
+0003cca0: 6420 524f 4973 2061 7265 2063 6f6e 7461  d ROIs are conta
+0003ccb0: 696e 6564 2069 6e20 616e 2069 6d61 6765  ined in an image
+0003ccc0: 2e0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+0003ccd0: 2069 6e5f 696d 6167 653a 0a20 2020 2020   in_image:.     
+0003cce0: 2020 2020 2020 2072 6574 7572 6e20 736f         return so
+0003ccf0: 7274 6564 286c 6973 7428 6d69 7373 696e  rted(list(missin
+0003cd00: 675f 726f 6973 2929 0a0a 2020 2020 2020  g_rois))..      
+0003cd10: 2020 2320 4368 6563 6b20 7468 6174 2069    # Check that i
+0003cd20: 6d61 6765 2069 7320 7370 6563 6966 6965  mage is specifie
+0003cd30: 642e 0a20 2020 2020 2020 2023 2049 6620  d..        # If 
+0003cd40: 7965 732c 2020 656e 7375 7265 2074 6861  yes,  ensure tha
+0003cd50: 7420 524f 4920 6d61 736b 7320 6861 7665  t ROI masks have
+0003cd60: 2074 6865 2073 616d 6520 766f 7865 6c20   the same voxel 
+0003cd70: 7369 7a65 2061 7320 7468 6973 2069 6d61  size as this ima
+0003cd80: 6765 2e0a 2020 2020 2020 2020 6966 2069  ge..        if i
+0003cd90: 7369 6e73 7461 6e63 6528 696e 5f69 6d61  sinstance(in_ima
+0003cda0: 6765 2c20 736b 7274 2e69 6d61 6765 2e49  ge, skrt.image.I
+0003cdb0: 6d61 6765 293a 0a20 2020 2020 2020 2020  mage):.         
+0003cdc0: 2020 2069 6d20 3d20 696e 5f69 6d61 6765     im = in_image
+0003cdd0: 0a20 2020 2020 2020 2020 2020 2073 7320  .            ss 
+0003cde0: 3d20 7365 6c66 2e63 6c6f 6e65 2829 0a20  = self.clone(). 
+0003cdf0: 2020 2020 2020 2020 2020 2073 732e 7365             ss.se
+0003ce00: 745f 696d 6167 6528 696d 2c20 6164 645f  t_image(im, add_
+0003ce10: 746f 5f69 6d61 6765 3d46 616c 7365 290a  to_image=False).
+0003ce20: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0003ce30: 2020 2020 2020 2020 2020 696d 203d 2073            im = s
+0003ce40: 656c 662e 696d 6167 650a 2020 2020 2020  elf.image.      
+0003ce50: 2020 2020 2020 7373 203d 2073 656c 660a        ss = self.
+0003ce60: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+0003ce70: 7369 6e73 7461 6e63 6528 696d 2c20 736b  sinstance(im, sk
+0003ce80: 7274 2e69 6d61 6765 2e49 6d61 6765 293a  rt.image.Image):
+0003ce90: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0003cea0: 7365 2052 756e 7469 6d65 4572 726f 7228  se RuntimeError(
+0003ceb0: 6622 496e 7661 6c69 6420 696d 6167 6520  f"Invalid image 
+0003cec0: 7370 6563 6966 6963 6174 696f 6e22 290a  specification").
+0003ced0: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
+0003cee0: 2077 6865 7468 6572 2052 4f49 7320 6172   whether ROIs ar
+0003cef0: 6520 636f 6e74 6169 6e65 6420 696e 2069  e contained in i
+0003cf00: 6d61 6765 2e0a 2020 2020 2020 2020 696d  mage..        im
+0003cf10: 5f65 7874 656e 7473 203d 2069 6d2e 6765  _extents = im.ge
+0003cf20: 745f 6578 7465 6e74 7328 290a 2020 2020  t_extents().    
+0003cf30: 2020 2020 6163 7469 7665 5f72 6f69 7320      active_rois 
+0003cf40: 3d20 7365 7428 726f 695f 6e61 6d65 7329  = set(roi_names)
+0003cf50: 202d 206d 6973 7369 6e67 5f72 6f69 730a   - missing_rois.
+0003cf60: 2020 2020 2020 2020 666f 7220 726f 695f          for roi_
+0003cf70: 6e61 6d65 2069 6e20 6163 7469 7665 5f72  name in active_r
+0003cf80: 6f69 733a 0a20 2020 2020 2020 2020 2020  ois:.           
+0003cf90: 2072 6f69 5f65 7874 656e 7473 203d 2073   roi_extents = s
+0003cfa0: 735b 726f 695f 6e61 6d65 5d2e 6765 745f  s[roi_name].get_
+0003cfb0: 6578 7465 6e74 7328 302e 352c 2022 766f  extents(0.5, "vo
+0003cfc0: 7865 6c73 2229 0a20 2020 2020 2020 2020  xels").         
+0003cfd0: 2020 2066 6f72 2069 6478 2069 6e20 7261     for idx in ra
+0003cfe0: 6e67 6528 3329 3a0a 2020 2020 2020 2020  nge(3):.        
+0003cff0: 2020 2020 2020 2020 6966 2028 726f 695f          if (roi_
+0003d000: 6578 7465 6e74 735b 6964 785d 5b30 5d20  extents[idx][0] 
+0003d010: 3c20 696d 5f65 7874 656e 7473 5b69 6478  < im_extents[idx
+0003d020: 5d5b 305d 0a20 2020 2020 2020 2020 2020  ][0].           
+0003d030: 2020 2020 2020 2020 206f 7220 726f 695f           or roi_
+0003d040: 6578 7465 6e74 735b 6964 785d 5b31 5d20  extents[idx][1] 
+0003d050: 3e20 696d 5f65 7874 656e 7473 5b69 6478  > im_extents[idx
+0003d060: 5d5b 315d 293a 0a20 2020 2020 2020 2020  ][1]):.         
+0003d070: 2020 2020 2020 2020 2020 206d 6973 7369             missi
+0003d080: 6e67 5f72 6f69 732e 6164 6428 726f 695f  ng_rois.add(roi_
+0003d090: 6e61 6d65 290a 0a20 2020 2020 2020 2072  name)..        r
+0003d0a0: 6574 7572 6e20 736f 7274 6564 286c 6973  eturn sorted(lis
+0003d0b0: 7428 6d69 7373 696e 675f 726f 6973 2929  t(missing_rois))
+0003d0c0: 0a0a 2020 2020 6465 6620 6861 735f 726f  ..    def has_ro
+0003d0d0: 6973 2873 656c 662c 206e 616d 6573 3d4e  is(self, names=N
+0003d0e0: 6f6e 652c 2069 6e63 6c75 6465 5f6b 6579  one, include_key
+0003d0f0: 733d 4661 6c73 6529 3a0a 2020 2020 2020  s=False):.      
+0003d100: 2020 2222 220a 2020 2020 2020 2020 4465    """.        De
+0003d110: 7465 726d 696e 6520 7768 6574 6865 7220  termine whether 
+0003d120: 7374 7275 6374 7572 6520 7365 7420 636f  structure set co
+0003d130: 6e74 6169 6e73 2073 7065 6369 6669 6564  ntains specified
+0003d140: 2052 4f49 732c 0a20 2020 2020 2020 2069   ROIs,.        i
+0003d150: 6465 6e74 6966 6965 6420 6279 2061 206e  dentified by a n
+0003d160: 6f6d 696e 616c 206e 616d 6520 6f72 2062  ominal name or b
+0003d170: 7920 616e 2061 6c69 6173 2e0a 0a20 2020  y an alias...   
+0003d180: 2020 2020 2054 6869 7320 6d65 7468 6f64       This method
+0003d190: 2072 6574 7572 6e73 2054 7275 6520 6966   returns True if
+0003d1a0: 2061 6c6c 2073 7065 6369 6669 6564 2052   all specified R
+0003d1b0: 4f49 206e 616d 6573 2061 7265 206d 6174  OI names are mat
+0003d1c0: 6368 6564 0a20 2020 2020 2020 2077 6974  ched.        wit
+0003d1d0: 6820 7468 6520 6e61 6d65 206f 6620 616e  h the name of an
+0003d1e0: 2052 4f49 2069 6e20 7468 6520 7374 7275   ROI in the stru
+0003d1f0: 6374 7572 6520 7365 742c 2061 6e64 2072  cture set, and r
+0003d200: 6574 7572 6e73 2046 616c 7365 0a20 2020  eturns False.   
+0003d210: 2020 2020 206f 7468 6572 7769 7365 2e20       otherwise. 
+0003d220: 204d 6174 6368 696e 6720 6973 2063 6173   Matching is cas
+0003d230: 6520 696e 7365 6e73 6974 6976 652e 0a0a  e insensitive...
+0003d240: 2020 2020 2020 2020 6e61 6d65 7320 3a20          names : 
+0003d250: 7374 722f 6c69 7374 2f64 6963 740a 2020  str/list/dict.  
+0003d260: 2020 2020 2020 2020 2020 5370 6563 6966            Specif
+0003d270: 6963 6174 696f 6e20 6f66 2052 4f49 733a  ication of ROIs:
+0003d280: 0a20 2020 2020 2020 2020 2020 202d 2061  .            - a
+0003d290: 2073 696e 676c 6520 524f 4920 6e61 6d65   single ROI name
+0003d2a0: 2c20 6f70 7469 6f6e 616c 6c79 2069 6e63  , optionally inc
+0003d2b0: 6c75 6469 6e67 2077 696c 6463 6172 6473  luding wildcards
+0003d2c0: 3b0a 2020 2020 2020 2020 2020 2020 2d20  ;.            - 
+0003d2d0: 6120 6c69 7374 206f 6620 524f 4920 6e61  a list of ROI na
+0003d2e0: 6d65 732c 2065 6163 6820 6f70 7469 6f6e  mes, each option
+0003d2f0: 616c 6c79 2069 6e63 6c75 6469 6e67 2077  ally including w
+0003d300: 696c 6463 6172 6473 3b0a 2020 2020 2020  ildcards;.      
+0003d310: 2020 2020 2020 2d20 6120 6469 6374 696f        - a dictio
+0003d320: 6e61 7279 2c20 7768 6572 6520 6b65 7973  nary, where keys
+0003d330: 2061 7265 206e 6f6d 696e 616c 2052 4f49   are nominal ROI
+0003d340: 206e 616d 6573 2c0a 2020 2020 2020 2020   names,.        
+0003d350: 2020 2020 616e 6420 7661 6c75 6573 2061      and values a
+0003d360: 7265 206c 6973 7473 206f 6620 706f 7373  re lists of poss
+0003d370: 6962 6c65 206e 616d 6573 2c20 6f70 7469  ible names, opti
+0003d380: 6f6e 616c 6c79 2069 6e63 6c75 6469 6e67  onally including
+0003d390: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
+0003d3a0: 6463 6172 6473 2e0a 0a20 2020 2020 2020  dcards...       
+0003d3b0: 2069 6e63 6c75 6465 5f6b 6579 7320 3a20   include_keys : 
+0003d3c0: 626f 6f6c 2c20 6465 6661 756c 743d 5472  bool, default=Tr
+0003d3d0: 7565 0a20 2020 2020 2020 2020 2020 2049  ue.            I
+0003d3e0: 6620 5472 7565 2c20 636f 6e73 6964 6572  f True, consider
+0003d3f0: 2062 6f74 6820 6b65 7973 2061 6e64 2076   both keys and v
+0003d400: 616c 7565 7320 666f 7220 6d61 7463 6869  alues for matchi
+0003d410: 6e67 2069 6620 524f 4920 6e61 6d65 730a  ng if ROI names.
+0003d420: 2020 2020 2020 2020 2020 2020 6172 6520              are 
+0003d430: 7370 6563 6966 6965 6420 6173 2061 2064  specified as a d
+0003d440: 6963 7469 6f6e 6172 792e 2020 4966 2046  ictionary.  If F
+0003d450: 616c 7365 2c20 636f 6e73 6964 6572 2076  alse, consider v
+0003d460: 616c 7565 7320 6f6e 6c79 2e0a 2020 2020  alues only..    
+0003d470: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0003d480: 2320 436f 6e76 6572 7420 6e61 6d65 7320  # Convert names 
+0003d490: 746f 2061 2064 6963 7469 6f6e 6172 792c  to a dictionary,
+0003d4a0: 2077 6865 7265 2065 6163 6820 7661 6c75   where each valu
+0003d4b0: 6520 6973 2061 206c 6973 742e 0a20 2020  e is a list..   
+0003d4c0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0003d4d0: 6365 286e 616d 6573 2c20 7374 7229 3a0a  ce(names, str):.
+0003d4e0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0003d4f0: 7320 3d20 7b6e 616d 6573 3a20 5b6e 616d  s = {names: [nam
+0003d500: 6573 5d7d 0a20 2020 2020 2020 2065 6c69  es]}.        eli
+0003d510: 6620 736b 7274 2e63 6f72 652e 6973 5f6c  f skrt.core.is_l
+0003d520: 6973 7428 6e61 6d65 7329 3a0a 2020 2020  ist(names):.    
+0003d530: 2020 2020 2020 2020 6e61 6d65 7320 3d20          names = 
+0003d540: 7b6e 616d 653a 205b 6e61 6d65 5d20 666f  {name: [name] fo
+0003d550: 7220 6e61 6d65 2069 6e20 6e61 6d65 737d  r name in names}
+0003d560: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
+0003d570: 696e 7374 616e 6365 286e 616d 6573 2c20  instance(names, 
+0003d580: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
+0003d590: 2020 2066 6f72 206e 616d 6520 696e 206e     for name in n
+0003d5a0: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
+0003d5b0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0003d5c0: 6e63 6528 6e61 6d65 735b 6e61 6d65 5d2c  nce(names[name],
+0003d5d0: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
+0003d5e0: 2020 2020 2020 2020 2020 206e 616d 6573             names
+0003d5f0: 5b6e 616d 655d 203d 205b 6e61 6d65 735b  [name] = [names[
+0003d600: 6e61 6d65 5d5d 0a0a 2020 2020 2020 2020  name]]..        
+0003d610: 2320 4578 6974 2069 7320 6e61 6d65 7320  # Exit is names 
+0003d620: 6973 6e27 7420 6120 6469 6374 696f 6e61  isn't a dictiona
+0003d630: 7279 2e0a 2020 2020 2020 2020 6966 206e  ry..        if n
+0003d640: 6f74 2069 7369 6e73 7461 6e63 6528 6e61  ot isinstance(na
+0003d650: 6d65 732c 2064 6963 7429 3a0a 2020 2020  mes, dict):.    
+0003d660: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0003d670: 616c 7365 0a0a 2020 2020 2020 2020 2320  alse..        # 
+0003d680: 5472 7920 746f 206d 6174 6368 2065 6163  Try to match eac
+0003d690: 6820 524f 4920 6e61 6d65 2077 6974 6820  h ROI name with 
+0003d6a0: 6e6f 6d69 6e61 6c20 6e61 6d65 206f 7220  nominal name or 
+0003d6b0: 616e 7920 616c 6961 7365 732e 0a20 2020  any aliases..   
+0003d6c0: 2020 2020 2066 6f72 206e 616d 652c 2061       for name, a
+0003d6d0: 6c69 6173 6573 2069 6e20 6e61 6d65 732e  liases in names.
+0003d6e0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0003d6f0: 2020 2020 2069 6620 696e 636c 7564 655f       if include_
+0003d700: 6b65 7973 3a0a 2020 2020 2020 2020 2020  keys:.          
+0003d710: 2020 2020 2020 6e61 6d65 735f 746f 5f6d        names_to_m
+0003d720: 6174 6368 203d 205b 6e61 6d65 5d20 2b20  atch = [name] + 
+0003d730: 616c 6961 7365 730a 2020 2020 2020 2020  aliases.        
+0003d740: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0003d750: 2020 2020 2020 2020 2020 6e61 6d65 735f            names_
+0003d760: 746f 5f6d 6174 6368 203d 2061 6c69 6173  to_match = alias
+0003d770: 6573 0a20 2020 2020 2020 2020 2020 2066  es.            f
+0003d780: 6f72 206e 616d 655f 746f 5f6d 6174 6368  or name_to_match
+0003d790: 2069 6e20 6e61 6d65 735f 746f 5f6d 6174   in names_to_mat
+0003d7a0: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
+0003d7b0: 2020 2020 666f 7220 726f 695f 6e61 6d65      for roi_name
+0003d7c0: 2069 6e20 7365 6c66 2e67 6574 5f72 6f69   in self.get_roi
+0003d7d0: 5f6e 616d 6573 2829 3a0a 2020 2020 2020  _names():.      
+0003d7e0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+0003d7f0: 7463 6820 3d20 666e 6d61 7463 682e 666e  tch = fnmatch.fn
+0003d800: 6d61 7463 6828 0a20 2020 2020 2020 2020  match(.         
+0003d810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d820: 2020 2072 6f69 5f6e 616d 652e 6c6f 7765     roi_name.lowe
+0003d830: 7228 292c 206e 616d 655f 746f 5f6d 6174  r(), name_to_mat
+0003d840: 6368 2e6c 6f77 6572 2829 290a 2020 2020  ch.lower()).    
+0003d850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d860: 6966 206d 6174 6368 3a0a 2020 2020 2020  if match:.      
+0003d870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d880: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
+0003d890: 2020 2020 2020 2020 6966 206d 6174 6368          if match
+0003d8a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003d8b0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+0003d8c0: 2020 2020 2020 2020 6966 206e 6f74 206d          if not m
+0003d8d0: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
+0003d8e0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0003d8f0: 7365 0a0a 2020 2020 2020 2020 7265 7475  se..        retu
+0003d900: 726e 2054 7275 650a 0a20 2020 2064 6566  rn True..    def
+0003d910: 2072 656e 616d 655f 726f 6973 280a 2020   rename_rois(.  
+0003d920: 2020 2020 2020 7365 6c66 2c20 6e61 6d65        self, name
+0003d930: 733d 4e6f 6e65 2c20 6669 7273 745f 6d61  s=None, first_ma
+0003d940: 7463 685f 6f6e 6c79 3d54 7275 652c 206b  tch_only=True, k
+0003d950: 6565 705f 7265 6e61 6d65 645f 6f6e 6c79  eep_renamed_only
+0003d960: 3d46 616c 7365 0a20 2020 2029 3a0a 2020  =False.    ):.  
+0003d970: 2020 2020 2020 2222 2252 656e 616d 6520        """Rename 
+0003d980: 524f 4973 2069 6e20 7468 6973 2053 7472  ROIs in this Str
+0003d990: 7563 7475 7265 5365 742e 0a20 2020 2020  uctureSet..     
+0003d9a0: 2020 203c 6669 7273 745f 6d61 7463 685f     <first_match_
+0003d9b0: 6f6e 6c79 3e20 6973 2054 7275 652c 206f  only> is True, o
+0003d9c0: 6e6c 7920 7468 6520 6669 7273 7420 524f  nly the first RO
+0003d9d0: 4920 6d61 7463 6869 6e67 2074 6865 0a20  I matching the. 
+0003d9e0: 2020 2020 2020 2070 6f73 7369 626c 6520         possible 
+0003d9f0: 6d61 7463 6865 7320 7769 6c6c 2062 6520  matches will be 
+0003da00: 7265 6e61 6d65 642e 0a0a 2020 2020 2020  renamed...      
+0003da10: 2020 2a2a 5061 7261 6d65 7465 7273 3a2a    **Parameters:*
+0003da20: 2a0a 2020 2020 2020 2020 0a20 2020 2020  *.        .     
+0003da30: 2020 206e 616d 6573 203a 2064 6963 742c     names : dict,
+0003da40: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0003da50: 2020 2020 2020 2020 2020 4469 6374 696f            Dictio
+0003da60: 6e61 7279 206f 6620 6e61 6d65 7320 666f  nary of names fo
+0003da70: 7220 7265 6e61 6d69 6e67 2052 4f49 732c  r renaming ROIs,
+0003da80: 2077 6865 7265 2074 6865 206b 6579 7320   where the keys 
+0003da90: 6172 6520 6e65 7720 0a20 2020 2020 2020  are new .       
+0003daa0: 2020 2020 206e 616d 6573 2061 6e64 2076       names and v
+0003dab0: 616c 7565 7320 6172 6520 6c69 7374 7320  alues are lists 
+0003dac0: 6f66 2070 6f73 7369 626c 6520 6e61 6d65  of possible name
+0003dad0: 7320 6f66 2052 4f49 7320 7468 6174 2073  s of ROIs that s
+0003dae0: 686f 756c 640a 2020 2020 2020 2020 2020  hould.          
+0003daf0: 2020 6265 2061 7373 6967 6e65 6420 7468    be assigned th
+0003db00: 6520 6e65 7720 6e61 6d65 2e20 5468 6573  e new name. Thes
+0003db10: 6520 6e61 6d65 7320 6361 6e20 616c 736f  e names can also
+0003db20: 2063 6f6e 7461 696e 2077 696c 6463 6172   contain wildcar
+0003db30: 6473 0a20 2020 2020 2020 2020 2020 2077  ds.            w
+0003db40: 6974 6820 7468 6520 272a 2720 7379 6d62  ith the '*' symb
+0003db50: 6f6c 2e0a 0a20 2020 2020 2020 2066 6972  ol...        fir
+0003db60: 7374 5f6d 6174 6368 5f6f 6e6c 7920 3a20  st_match_only : 
+0003db70: 626f 6f6c 2c20 6465 6661 756c 743d 5472  bool, default=Tr
+0003db80: 7565 0a20 2020 2020 2020 2020 2020 2049  ue.            I
+0003db90: 6620 5472 7565 2c20 6f6e 6c79 2074 6865  f True, only the
+0003dba0: 2066 6972 7374 2052 4f49 206d 6174 6368   first ROI match
+0003dbb0: 696e 6720 7468 6520 706f 7373 6962 6c65  ing the possible
+0003dbc0: 206e 616d 6573 2069 6e20 7468 6520 0a20   names in the . 
+0003dbd0: 2020 2020 2020 2020 2020 2076 616c 7565             value
+0003dbe0: 7320 6f66 203c 6e61 6d65 733e 2077 696c  s of <names> wil
+0003dbf0: 6c20 6265 2072 656e 616d 6564 3b20 7468  l be renamed; th
+0003dc00: 6973 2070 7265 7665 6e74 7320 6e61 6d65  is prevents name
+0003dc10: 2064 7570 6c69 6361 7469 6f6e 0a20 2020   duplication.   
+0003dc20: 2020 2020 2020 2020 2069 6620 6d75 6c74           if mult
+0003dc30: 6970 6c65 2052 4f49 7320 696e 2074 6865  iple ROIs in the
+0003dc40: 2053 7472 7563 7475 7265 5365 7420 6172   StructureSet ar
+0003dc50: 6520 6120 6d61 7463 682e 0a0a 2020 2020  e a match...    
+0003dc60: 2020 2020 6b65 6570 5f72 656e 616d 6564      keep_renamed
+0003dc70: 5f6f 6e6c 7920 3a20 626f 6f6c 2c20 6465  _only : bool, de
+0003dc80: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+0003dc90: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+0003dca0: 2061 6e79 2052 4f49 7320 7468 6174 2064   any ROIs that d
+0003dcb0: 6f20 6e6f 7420 6765 7420 7265 6e61 6d65  o not get rename
+0003dcc0: 6420 7769 6c6c 2062 6520 7265 6d6f 7665  d will be remove
+0003dcd0: 6420 6672 6f6d 0a20 2020 2020 2020 2020  d from.         
+0003dce0: 2020 2074 6865 2053 7472 7563 7475 7265     the Structure
+0003dcf0: 5365 742e 0a20 2020 2020 2020 2022 2222  Set..        """
+0003dd00: 0a0a 2020 2020 2020 2020 6966 206e 616d  ..        if nam
+0003dd10: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
+0003dd20: 2020 2020 2020 2020 6e61 6d65 7320 3d20          names = 
+0003dd30: 7365 6c66 2e6e 616d 6573 0a20 2020 2020  self.names.     
+0003dd40: 2020 2069 6620 6e6f 7420 6e61 6d65 7320     if not names 
+0003dd50: 6f72 206e 6f74 2069 7369 6e73 7461 6e63  or not isinstanc
+0003dd60: 6528 6e61 6d65 732c 2064 6963 7429 3a0a  e(names, dict):.
+0003dd70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0003dd80: 726e 0a0a 2020 2020 2020 2020 2320 4c6f  rn..        # Lo
+0003dd90: 6f70 2074 6872 6f75 6768 2065 6163 6820  op through each 
+0003dda0: 6e65 7720 6e61 6d65 0a20 2020 2020 2020  new name.       
+0003ddb0: 2061 6c72 6561 6479 5f72 656e 616d 6564   already_renamed
+0003ddc0: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
+0003ddd0: 7220 6e61 6d65 2c20 6d61 7463 6865 7320  r name, matches 
+0003dde0: 696e 206e 616d 6573 2e69 7465 6d73 2829  in names.items()
+0003ddf0: 3a0a 0a20 2020 2020 2020 2020 2020 2069  :..            i
+0003de00: 6620 6e6f 7420 736b 7274 2e63 6f72 652e  f not skrt.core.
+0003de10: 6973 5f6c 6973 7428 6d61 7463 6865 7329  is_list(matches)
+0003de20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003de30: 2020 6d61 7463 6865 7320 3d20 5b6d 6174    matches = [mat
+0003de40: 6368 6573 5d0a 0a20 2020 2020 2020 2020  ches]..         
+0003de50: 2020 2023 204c 6f6f 7020 7468 726f 7567     # Loop throug
+0003de60: 6820 616c 6c20 706f 7373 6962 6c65 206f  h all possible o
+0003de70: 7269 6769 6e61 6c20 6e61 6d65 730a 2020  riginal names.  
+0003de80: 2020 2020 2020 2020 2020 6e61 6d65 5f6d            name_m
+0003de90: 6174 6368 6564 203d 2046 616c 7365 0a20  atched = False. 
+0003dea0: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
+0003deb0: 2069 6e20 6d61 7463 6865 733a 0a0a 2020   in matches:..  
+0003dec0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0003ded0: 4c6f 6f70 2074 6872 6f75 6768 2052 4f49  Loop through ROI
+0003dee0: 7320 616e 6420 7365 6520 6966 2074 6865  s and see if the
+0003def0: 7265 2773 2061 206d 6174 6368 0a20 2020  re's a match.   
+0003df00: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0003df10: 2069 2c20 7320 696e 2065 6e75 6d65 7261   i, s in enumera
+0003df20: 7465 2873 656c 662e 6765 745f 726f 6973  te(self.get_rois
+0003df30: 2829 293a 0a0a 2020 2020 2020 2020 2020  ()):..          
+0003df40: 2020 2020 2020 2020 2020 2320 446f 6e27            # Don'
+0003df50: 7420 7265 6e61 6d65 2061 6e20 524f 4920  t rename an ROI 
+0003df60: 6d6f 7265 2074 6861 6e20 6f6e 6365 0a20  more than once. 
+0003df70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003df80: 2020 2069 6620 6920 696e 2061 6c72 6561     if i in alrea
+0003df90: 6479 5f72 656e 616d 6564 3a0a 2020 2020  dy_renamed:.    
 0003dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dfb0: 2020 2020 6272 6561 6b0a 0a20 2020 2020      break..     
-0003dfc0: 2020 2023 204b 6565 7020 6f6e 6c79 2074     # Keep only t
-0003dfd0: 6865 2072 656e 616d 6564 2052 4f49 7320  he renamed ROIs 
-0003dfe0: 6966 2072 6571 7565 7374 6564 0a20 2020  if requested.   
-0003dff0: 2020 2020 2069 6620 6b65 6570 5f72 656e       if keep_ren
-0003e000: 616d 6564 5f6f 6e6c 793a 0a20 2020 2020  amed_only:.     
-0003e010: 2020 2020 2020 2072 656e 616d 6564 5f72         renamed_r
-0003e020: 6f69 7320 3d20 5b73 656c 662e 726f 6973  ois = [self.rois
-0003e030: 5b69 5d20 666f 7220 6920 696e 2061 6c72  [i] for i in alr
-0003e040: 6561 6479 5f72 656e 616d 6564 5d0a 2020  eady_renamed].  
-0003e050: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
-0003e060: 6f69 7320 3d20 7265 6e61 6d65 645f 726f  ois = renamed_ro
-0003e070: 6973 0a0a 2020 2020 6465 6620 6669 6c74  is..    def filt
-0003e080: 6572 5f72 6f69 7328 7365 6c66 2c20 746f  er_rois(self, to
-0003e090: 5f6b 6565 703d 4e6f 6e65 2c20 746f 5f72  _keep=None, to_r
-0003e0a0: 656d 6f76 653d 4e6f 6e65 293a 0a20 2020  emove=None):.   
-0003e0b0: 2020 2020 2022 2222 4b65 6570 206f 6e6c       """Keep onl
-0003e0c0: 7920 7468 6520 524f 4973 2069 6e20 7468  y the ROIs in th
-0003e0d0: 6520 746f 5f6b 6565 7020 6c69 7374 2061  e to_keep list a
-0003e0e0: 6e64 2072 656d 6f76 6520 616e 7920 696e  nd remove any in
-0003e0f0: 2074 6865 0a20 2020 2020 2020 2074 6f5f   the.        to_
-0003e100: 7265 6d6f 7665 206c 6973 742e 0a0a 2020  remove list...  
-0003e110: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
-0003e120: 7273 3a2a 2a0a 2020 2020 2020 2020 0a0a  rs:**.        ..
-0003e130: 2020 2020 2020 2020 746f 5f6b 6565 7020          to_keep 
-0003e140: 3a20 6c69 7374 2c20 6465 6661 756c 743d  : list, default=
-0003e150: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0003e160: 204c 6973 7420 6f66 206e 616d 6573 206f   List of names o
-0003e170: 6620 524f 4973 2074 6f20 6b65 6570 2069  f ROIs to keep i
-0003e180: 6e20 7468 6520 636f 7069 6564 2053 7472  n the copied Str
-0003e190: 7563 7475 7265 5365 743b 2061 6c6c 200a  uctureSet; all .
-0003e1a0: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
-0003e1b0: 7273 2077 696c 6c20 6265 2072 656d 6f76  rs will be remov
-0003e1c0: 6564 2e20 5468 6573 6520 6e61 6d65 7320  ed. These names 
-0003e1d0: 6361 6e20 616c 736f 2063 6f6e 7461 696e  can also contain
-0003e1e0: 2077 696c 6463 6172 6473 0a20 2020 2020   wildcards.     
-0003e1f0: 2020 2020 2020 2077 6974 6820 7468 6520         with the 
-0003e200: 272a 2720 7379 6d62 6f6c 2e20 0a0a 2020  '*' symbol. ..  
-0003e210: 2020 2020 2020 746f 5f72 656d 6f76 6520        to_remove 
-0003e220: 3a20 6c69 7374 2c20 6465 6661 756c 743d  : list, default=
-0003e230: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0003e240: 204c 6973 7420 6f66 206e 616d 6573 206f   List of names o
-0003e250: 6620 524f 4973 2074 6f20 7265 6d6f 7665  f ROIs to remove
-0003e260: 2066 726f 6d20 7468 6520 636f 7069 6564   from the copied
-0003e270: 2053 7472 7563 7475 7265 5365 743b 2061   StructureSet; a
-0003e280: 6c6c 200a 2020 2020 2020 2020 2020 2020  ll .            
-0003e290: 6f74 6865 7273 2077 696c 6c20 6265 2072  others will be r
-0003e2a0: 656d 6f76 6564 2e20 5468 6573 6520 6e61  emoved. These na
-0003e2b0: 6d65 7320 6361 6e20 616c 736f 2063 6f6e  mes can also con
-0003e2c0: 7461 696e 2077 696c 6463 6172 6473 0a20  tain wildcards. 
-0003e2d0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0003e2e0: 7468 6520 272a 2720 7379 6d62 6f6c 2e20  the '*' symbol. 
-0003e2f0: 4170 706c 6965 6420 6166 7465 7220 6669  Applied after fi
-0003e300: 6c74 6572 696e 6720 7769 7468 203c 746f  ltering with <to
-0003e310: 5f6b 6565 703e 2e0a 2020 2020 2020 2020  _keep>..        
-0003e320: 2222 220a 0a20 2020 2020 2020 2023 2045  """..        # E
-0003e330: 6e73 7572 6520 746f 5f6b 6565 7020 616e  nsure to_keep an
-0003e340: 6420 746f 5f72 656d 6f76 6520 6172 6520  d to_remove are 
-0003e350: 6c69 7374 730a 2020 2020 2020 2020 6966  lists.        if
-0003e360: 2074 6f5f 6b65 6570 2069 7320 4e6f 6e65   to_keep is None
-0003e370: 3a0a 2020 2020 2020 2020 2020 2020 746f  :.            to
-0003e380: 5f6b 6565 7020 3d20 7365 6c66 2e74 6f5f  _keep = self.to_
-0003e390: 6b65 6570 0a20 2020 2020 2020 2065 6c69  keep.        eli
-0003e3a0: 6620 6e6f 7420 736b 7274 2e63 6f72 652e  f not skrt.core.
-0003e3b0: 6973 5f6c 6973 7428 746f 5f6b 6565 7029  is_list(to_keep)
-0003e3c0: 3a0a 2020 2020 2020 2020 2020 2020 746f  :.            to
-0003e3d0: 5f6b 6565 7020 3d20 5b74 6f5f 6b65 6570  _keep = [to_keep
-0003e3e0: 5d0a 2020 2020 2020 2020 6966 2074 6f5f  ].        if to_
-0003e3f0: 7265 6d6f 7665 2069 7320 4e6f 6e65 3a0a  remove is None:.
-0003e400: 2020 2020 2020 2020 2020 2020 746f 5f72              to_r
-0003e410: 656d 6f76 6520 3d20 7365 6c66 2e74 6f5f  emove = self.to_
-0003e420: 7265 6d6f 7665 0a20 2020 2020 2020 2065  remove.        e
-0003e430: 6c69 6620 6e6f 7420 736b 7274 2e63 6f72  lif not skrt.cor
-0003e440: 652e 6973 5f6c 6973 7428 746f 5f72 656d  e.is_list(to_rem
-0003e450: 6f76 6529 3a0a 2020 2020 2020 2020 2020  ove):.          
-0003e460: 2020 746f 5f72 656d 6f76 6520 3d20 5b74    to_remove = [t
-0003e470: 6f5f 7265 6d6f 7665 5d0a 0a20 2020 2020  o_remove]..     
-0003e480: 2020 2023 204b 6565 7020 6f6e 6c79 2074     # Keep only t
-0003e490: 6865 2052 4f49 7320 696e 2074 6f5f 6b65  he ROIs in to_ke
-0003e4a0: 6570 0a20 2020 2020 2020 2073 656c 662e  ep.        self.
-0003e4b0: 6c6f 6164 2829 0a20 2020 2020 2020 2069  load().        i
-0003e4c0: 6620 746f 5f6b 6565 7020 6973 206e 6f74  f to_keep is not
-0003e4d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0003e4e0: 2020 206b 6565 7020 3d20 5b5d 0a20 2020     keep = [].   
-0003e4f0: 2020 2020 2020 2020 2066 6f72 2072 6f69           for roi
-0003e500: 2069 6e20 7365 6c66 2e72 6f69 733a 0a20   in self.rois:. 
-0003e510: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0003e520: 6620 616e 7928 5b66 6e6d 6174 6368 2e66  f any([fnmatch.f
-0003e530: 6e6d 6174 6368 2872 6f69 2e6e 616d 652e  nmatch(roi.name.
-0003e540: 6c6f 7765 7228 292c 206b 2e6c 6f77 6572  lower(), k.lower
-0003e550: 2829 2920 0a20 2020 2020 2020 2020 2020  ()) .           
-0003e560: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0003e570: 206b 2069 6e20 746f 5f6b 6565 705d 293a   k in to_keep]):
-0003e580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003e590: 2020 2020 206b 6565 702e 6170 7065 6e64       keep.append
-0003e5a0: 2872 6f69 290a 2020 2020 2020 2020 2020  (roi).          
-0003e5b0: 2020 7365 6c66 2e72 6f69 7320 3d20 6b65    self.rois = ke
-0003e5c0: 6570 0a0a 2020 2020 2020 2020 2320 5265  ep..        # Re
-0003e5d0: 6d6f 7665 2074 6865 2052 4f49 7320 696e  move the ROIs in
-0003e5e0: 2074 6f5f 7265 6d6f 7665 0a20 2020 2020   to_remove.     
-0003e5f0: 2020 2069 6620 746f 5f72 656d 6f76 6520     if to_remove 
-0003e600: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0003e610: 2020 2020 2020 2020 206b 6565 7020 3d20           keep = 
-0003e620: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
-0003e630: 6f72 2072 6f69 2069 6e20 7365 6c66 2e72  or roi in self.r
-0003e640: 6f69 733a 0a20 2020 2020 2020 2020 2020  ois:.           
-0003e650: 2020 2020 2069 6620 6e6f 7420 616e 7928       if not any(
-0003e660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003e670: 2020 2020 205b 666e 6d61 7463 682e 666e       [fnmatch.fn
-0003e680: 6d61 7463 6828 726f 692e 6e61 6d65 2e6c  match(roi.name.l
-0003e690: 6f77 6572 2829 2c20 722e 6c6f 7765 7228  ower(), r.lower(
-0003e6a0: 2929 200a 2020 2020 2020 2020 2020 2020  )) .            
-0003e6b0: 2020 2020 2020 2020 2066 6f72 2072 2069           for r i
-0003e6c0: 6e20 746f 5f72 656d 6f76 655d 0a20 2020  n to_remove].   
-0003e6d0: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
-0003e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e6f0: 2020 2020 6b65 6570 2e61 7070 656e 6428      keep.append(
-0003e700: 726f 6929 0a20 2020 2020 2020 2020 2020  roi).           
-0003e710: 2073 656c 662e 726f 6973 203d 206b 6565   self.rois = kee
-0003e720: 700a 0a20 2020 2064 6566 2073 6574 5f61  p..    def set_a
-0003e730: 6c70 6861 5f62 6574 615f 7261 7469 6f73  lpha_beta_ratios
-0003e740: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-0003e750: 6c66 2c20 616c 7068 615f 6265 7461 5f72  lf, alpha_beta_r
-0003e760: 6174 696f 733d 4e6f 6e65 2c20 7365 745f  atios=None, set_
-0003e770: 6173 5f64 6566 6175 6c74 3d54 7275 6529  as_default=True)
-0003e780: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0003e790: 2020 2020 2020 5365 7420 7261 7469 6f73        Set ratios
-0003e7a0: 2066 6f72 2052 4f49 2074 6973 7375 6573   for ROI tissues
-0003e7b0: 206f 6620 636f 6566 6669 6369 656e 7473   of coefficients
-0003e7c0: 206f 6620 6c69 6e65 6172 2d71 7561 6472   of linear-quadr
-0003e7d0: 6174 6963 2065 7175 6174 696f 6e2e 0a0a  atic equation...
-0003e7e0: 2020 2020 2020 2020 4f70 7469 6f6e 616c          Optional
-0003e7f0: 6c79 2069 6e70 7574 2076 616c 7565 7320  ly input values 
-0003e800: 666f 7220 7261 7469 6f73 2061 7320 7374  for ratios as st
-0003e810: 7275 6374 7572 652d 7365 7420 6465 6661  ructure-set defa
-0003e820: 756c 742e 0a0a 2020 2020 2020 2020 2a2a  ult...        **
-0003e830: 5061 7261 6d65 7465 723a 2a2a 0a0a 2020  Parameter:**..  
-0003e840: 2020 2020 2020 616c 7068 615f 6265 7461        alpha_beta
-0003e850: 5f72 6174 696f 7320 3a20 6469 6374 2c20  _ratios : dict, 
-0003e860: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-0003e870: 2020 2020 2020 2020 2044 6963 7469 6f6e           Diction
-0003e880: 6172 7920 7768 6572 6520 6b65 7973 2061  ary where keys a
-0003e890: 7265 2052 4f49 206e 616d 6573 2061 6e64  re ROI names and
-0003e8a0: 2076 616c 7565 7320 6172 650a 2020 2020   values are.    
-0003e8b0: 2020 2020 2020 2020 7261 7469 6f73 2066          ratios f
-0003e8c0: 6f72 2052 4f49 2074 6973 7375 6573 206f  or ROI tissues o
-0003e8d0: 6620 636f 6566 6669 6369 656e 7473 2c20  f coefficients, 
-0003e8e0: 616c 7068 612c 2062 6574 612c 0a20 2020  alpha, beta,.   
-0003e8f0: 2020 2020 2020 2020 2069 6e20 7468 6520           in the 
-0003e900: 6c69 6e65 6172 2d71 7561 6472 6174 6963  linear-quadratic
-0003e910: 2065 7175 6174 696f 6e2e 2020 5468 6573   equation.  Thes
-0003e920: 6520 7261 7469 6f73 2061 7265 0a20 2020  e ratios are.   
-0003e930: 2020 2020 2020 2020 2075 7365 6420 696e           used in
-0003e940: 2063 616c 6375 6c61 7469 6e67 2062 696f   calculating bio
-0003e950: 6c6f 6769 6361 6c6c 7920 6566 6665 6374  logically effect
-0003e960: 6976 6520 646f 7365 2c20 4245 442c 2066  ive dose, BED, f
-0003e970: 726f 6d0a 2020 2020 2020 2020 2020 2020  rom.            
-0003e980: 7068 7973 6963 616c 2064 6f73 652c 2044  physical dose, D
-0003e990: 2c20 6465 6c69 7665 7265 6420 6f76 6572  , delivered over
-0003e9a0: 206e 2065 7175 616c 2066 7261 6374 696f   n equal fractio
-0003e9b0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-0003e9c0: 2020 2020 4245 4420 3d20 4420 2a20 2831      BED = D * (1
-0003e9d0: 202b 2028 442f 6e29 202f 2028 616c 7068   + (D/n) / (alph
-0003e9e0: 612f 6265 7461 2929 2e0a 2020 2020 2020  a/beta))..      
-0003e9f0: 2020 2020 2020 5468 6520 6174 7472 6962        The attrib
-0003ea00: 7574 6520 616c 7068 615f 6f76 6572 5f76  ute alpha_over_v
-0003ea10: 616c 7565 2069 7320 7365 7420 746f 2074  alue is set to t
-0003ea20: 6865 2064 6963 7469 6f6e 6172 7920 7661  he dictionary va
-0003ea30: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
-0003ea40: 666f 7220 616e 2052 4f49 2069 6465 6e74  for an ROI ident
-0003ea50: 6966 6965 6420 6279 2061 206b 6579 2c20  ified by a key, 
-0003ea60: 6f72 2069 7320 7365 7420 746f 204e 6f6e  or is set to Non
-0003ea70: 6520 666f 7220 616e 790a 2020 2020 2020  e for any.      
-0003ea80: 2020 2020 2020 6f74 6865 7220 524f 4973        other ROIs
-0003ea90: 2e20 2049 6620 7468 6973 2070 6172 616d  .  If this param
-0003eaa0: 6574 6572 2069 7320 7365 7420 746f 204e  eter is set to N
-0003eab0: 6f6e 652c 2076 616c 7565 7320 6172 6520  one, values are 
-0003eac0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
-0003ead0: 6672 6f6d 2073 656c 662e 616c 7068 615f  from self.alpha_
-0003eae0: 6265 7461 5f72 6174 696f 732e 0a0a 2020  beta_ratios...  
-0003eaf0: 2020 2020 2020 7365 745f 6173 5f64 6566        set_as_def
-0003eb00: 6175 6c74 203a 2062 6f6f 6c2c 2064 6566  ault : bool, def
-0003eb10: 6175 6c74 3d54 7275 650a 2020 2020 2020  ault=True.      
-0003eb20: 2020 2020 2020 4966 2054 7275 652c 2061        If True, a
-0003eb30: 6e64 2061 6c70 6861 5f62 6574 615f 7261  nd alpha_beta_ra
-0003eb40: 7469 6f73 2069 736e 2774 204e 6f6e 652c  tios isn't None,
-0003eb50: 2073 6574 0a20 2020 2020 2020 2020 2020   set.           
-0003eb60: 2073 656c 662e 616c 7068 615f 6265 7461   self.alpha_beta
-0003eb70: 5f72 6174 696f 7320 746f 2074 6865 2076  _ratios to the v
-0003eb80: 616c 7565 206f 6620 616c 7068 615f 6265  alue of alpha_be
-0003eb90: 7461 5f72 6174 696f 732e 0a20 2020 2020  ta_ratios..     
-0003eba0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0003ebb0: 6620 616c 7068 615f 6265 7461 5f72 6174  f alpha_beta_rat
-0003ebc0: 696f 7320 6973 204e 6f6e 653a 0a20 2020  ios is None:.   
-0003ebd0: 2020 2020 2020 2020 2061 6c70 6861 5f62           alpha_b
-0003ebe0: 6574 615f 7261 7469 6f73 203d 2073 656c  eta_ratios = sel
-0003ebf0: 662e 616c 7068 615f 6265 7461 5f72 6174  f.alpha_beta_rat
-0003ec00: 696f 730a 2020 2020 2020 2020 656c 6966  ios.        elif
-0003ec10: 2073 6574 5f61 735f 6465 6661 756c 743a   set_as_default:
-0003ec20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0003ec30: 662e 616c 7068 615f 6265 7461 5f72 6174  f.alpha_beta_rat
-0003ec40: 696f 7320 3d20 616c 7068 615f 6265 7461  ios = alpha_beta
-0003ec50: 5f72 6174 696f 730a 0a20 2020 2020 2020  _ratios..       
-0003ec60: 2066 6f72 2072 6f69 2069 6e20 7365 6c66   for roi in self
-0003ec70: 2e67 6574 5f72 6f69 7328 293a 0a20 2020  .get_rois():.   
-0003ec80: 2020 2020 2020 2020 2072 6f69 2e73 6574           roi.set
-0003ec90: 5f61 6c70 6861 5f6f 7665 725f 6265 7461  _alpha_over_beta
-0003eca0: 2861 6c70 6861 5f62 6574 615f 7261 7469  (alpha_beta_rati
-0003ecb0: 6f73 2e67 6574 2872 6f69 2e6e 616d 652c  os.get(roi.name,
-0003ecc0: 204e 6f6e 6529 290a 0a20 2020 2064 6566   None))..    def
-0003ecd0: 2067 6574 5f61 6c70 6861 5f62 6574 615f   get_alpha_beta_
-0003ece0: 7261 7469 6f73 2873 656c 6629 3a0a 2020  ratios(self):.  
-0003ecf0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0003ed00: 2020 4765 7420 6469 6374 696f 6e61 7279    Get dictionary
-0003ed10: 206f 6620 7261 7469 6f20 6f66 2063 6f65   of ratio of coe
-0003ed20: 6666 6963 6965 6e74 7320 6f66 206c 696e  fficients of lin
-0003ed30: 6561 722d 7175 6164 7261 7469 6320 6571  ear-quadratic eq
-0003ed40: 7561 7469 6f6e 2e0a 2020 2020 2020 2020  uation..        
-0003ed50: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0003ed60: 726e 207b 726f 695f 6e61 6d65 203a 2073  rn {roi_name : s
-0003ed70: 656c 665b 726f 695f 6e61 6d65 5d2e 6765  elf[roi_name].ge
-0003ed80: 745f 616c 7068 615f 6f76 6572 5f62 6574  t_alpha_over_bet
-0003ed90: 6128 290a 2020 2020 2020 2020 2020 2020  a().            
-0003eda0: 2020 2020 666f 7220 726f 695f 6e61 6d65      for roi_name
-0003edb0: 2069 6e20 736f 7274 6564 2873 656c 662e   in sorted(self.
-0003edc0: 6765 745f 726f 695f 6e61 6d65 7328 2929  get_roi_names())
-0003edd0: 7d0a 0a20 2020 2064 6566 2067 6574 5f63  }..    def get_c
-0003ede0: 6f6c 6f72 7328 7365 6c66 293a 0a20 2020  olors(self):.   
-0003edf0: 2020 2020 2022 2222 4765 7420 6469 6374       """Get dict
-0003ee00: 206f 6620 524f 4920 636f 6c6f 7273 2066   of ROI colors f
-0003ee10: 6f72 2065 6163 6820 6e61 6d65 2e22 2222  or each name."""
-0003ee20: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0003ee30: 207b 726f 692e 6e61 6d65 3a20 726f 692e   {roi.name: roi.
-0003ee40: 636f 6c6f 7220 666f 7220 726f 6920 696e  color for roi in
-0003ee50: 2073 656c 662e 6765 745f 726f 6973 2829   self.get_rois()
-0003ee60: 7d0a 0a20 2020 2064 6566 2072 6563 6f6c  }..    def recol
-0003ee70: 6f72 5f72 6f69 7328 7365 6c66 2c20 636f  or_rois(self, co
-0003ee80: 6c6f 7273 293a 0a20 2020 2020 2020 2022  lors):.        "
-0003ee90: 2222 5365 7420 636f 6c6f 7273 206f 6620  ""Set colors of 
-0003eea0: 524f 4973 2075 7369 6e67 2061 206c 6973  ROIs using a lis
-0003eeb0: 7420 6f72 2064 6963 7420 6769 7665 6e20  t or dict given 
-0003eec0: 696e 203c 636f 6c6f 7273 3e2e 0a0a 2020  in <colors>...  
-0003eed0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
-0003eee0: 7273 2a2a 3a0a 0a20 2020 2020 2020 2063  rs**:..        c
-0003eef0: 6f6c 6f72 7320 3a20 6c69 7374 2f64 6963  olors : list/dic
-0003ef00: 740a 2020 2020 2020 2020 2020 2020 4c69  t.            Li
-0003ef10: 7374 206f 7220 6469 6374 206f 6620 636f  st or dict of co
-0003ef20: 6c6f 7273 2e20 4966 2061 2064 6963 742c  lors. If a dict,
-0003ef30: 2074 6865 206b 6579 7320 7368 6f75 6c64   the keys should
-0003ef40: 2062 6520 524f 4920 6e61 6d65 7320 6f72   be ROI names or
-0003ef50: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
-0003ef60: 6463 6172 6473 206d 6174 6368 696e 6720  dcards matching 
-0003ef70: 524f 4920 6e61 6d65 732c 2061 6e64 2074  ROI names, and t
-0003ef80: 6865 2076 616c 7565 7320 7368 6f75 6c64  he values should
-0003ef90: 2062 6520 6465 7369 7265 6420 0a20 2020   be desired .   
-0003efa0: 2020 2020 2020 2020 2063 6f6c 6f72 7320           colors 
-0003efb0: 666f 7220 524f 4973 206d 6174 6368 696e  for ROIs matchin
-0003efc0: 6720 7468 6174 206e 616d 652e 2049 6620  g that name. If 
-0003efd0: 6120 6c69 7374 2c20 7368 6f75 6c64 2063  a list, should c
-0003efe0: 6f6e 7461 696e 0a20 2020 2020 2020 2020  ontain.         
-0003eff0: 2020 2063 6f6c 6f72 7320 7768 6963 6820     colors which 
-0003f000: 7769 6c6c 2062 6520 6170 706c 6965 6420  will be applied 
-0003f010: 746f 206c 6f61 6465 6420 524f 4973 2069  to loaded ROIs i
-0003f020: 6e20 6f72 6465 722e 0a20 2020 2020 2020  n order..       
-0003f030: 2022 2222 0a0a 2020 2020 2020 2020 6966   """..        if
-0003f040: 2063 6f6c 6f72 7320 6973 204e 6f6e 653a   colors is None:
-0003f050: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0003f060: 7572 6e0a 0a20 2020 2020 2020 2069 6620  urn..        if 
-0003f070: 6973 696e 7374 616e 6365 2863 6f6c 6f72  isinstance(color
-0003f080: 732c 2064 6963 7429 3a0a 2020 2020 2020  s, dict):.      
-0003f090: 2020 2020 2020 666f 7220 6e61 6d65 2c20        for name, 
-0003f0a0: 636f 6c6f 7220 696e 2063 6f6c 6f72 732e  color in colors.
-0003f0b0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-0003f0c0: 2020 2020 2020 2020 2066 6f72 2072 6f69           for roi
-0003f0d0: 2069 6e20 7365 6c66 2e72 6f69 733a 0a20   in self.rois:. 
-0003f0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f0f0: 2020 2069 6620 666e 6d61 7463 682e 666e     if fnmatch.fn
-0003f100: 6d61 7463 6828 726f 692e 6e61 6d65 2e6c  match(roi.name.l
-0003f110: 6f77 6572 2829 2c20 6e61 6d65 2e6c 6f77  ower(), name.low
-0003f120: 6572 2829 293a 0a20 2020 2020 2020 2020  er()):.         
-0003f130: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0003f140: 6f69 2e73 6574 5f63 6f6c 6f72 2863 6f6c  oi.set_color(col
-0003f150: 6f72 290a 2020 2020 2020 2020 656c 6966  or).        elif
-0003f160: 2069 7369 6e73 7461 6e63 6528 636f 6c6f   isinstance(colo
-0003f170: 7273 2c20 6c69 7374 293a 0a20 2020 2020  rs, list):.     
-0003f180: 2020 2020 2020 2066 6f72 2069 2c20 636f         for i, co
-0003f190: 6c6f 7220 696e 2065 6e75 6d65 7261 7465  lor in enumerate
-0003f1a0: 2863 6f6c 6f72 7329 3a0a 2020 2020 2020  (colors):.      
-0003f1b0: 2020 2020 2020 2020 2020 6966 2069 203e            if i >
-0003f1c0: 3d20 6c65 6e28 7365 6c66 2e72 6f69 7329  = len(self.rois)
-0003f1d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003f1e0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-0003f1f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0003f200: 662e 726f 6973 5b69 5d2e 7365 745f 636f  f.rois[i].set_co
-0003f210: 6c6f 7228 636f 6c6f 7229 0a20 2020 2020  lor(color).     
-0003f220: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0003f230: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
-0003f240: 7272 6f72 2822 3c63 6f6c 6f72 733e 206d  rror("<colors> m
-0003f250: 7573 7420 6265 206c 6973 7420 6f72 2064  ust be list or d
-0003f260: 6963 742e 2229 0a0a 2020 2020 6465 6620  ict.")..    def 
-0003f270: 6164 645f 726f 6973 2873 656c 662c 2073  add_rois(self, s
-0003f280: 6f75 7263 6573 293a 0a20 2020 2020 2020  ources):.       
-0003f290: 2022 2222 4164 6420 6164 6469 7469 6f6e   """Add addition
-0003f2a0: 616c 2052 4f49 7320 6672 6f6d 2073 6f75  al ROIs from sou
-0003f2b0: 7263 6528 7329 2e22 2222 0a0a 2020 2020  rce(s)."""..    
-0003f2c0: 2020 2020 6966 206e 6f74 2073 6b72 742e      if not skrt.
-0003f2d0: 636f 7265 2e69 735f 6c69 7374 2873 6f75  core.is_list(sou
-0003f2e0: 7263 6573 293a 0a20 2020 2020 2020 2020  rces):.         
-0003f2f0: 2020 2073 6f75 7263 6573 203d 205b 736f     sources = [so
-0003f300: 7572 6365 735d 0a20 2020 2020 2020 2073  urces].        s
-0003f310: 656c 662e 736f 7572 6365 732e 6578 7465  elf.sources.exte
-0003f320: 6e64 2873 6f75 7263 6573 290a 2020 2020  nd(sources).    
-0003f330: 2020 2020 7365 6c66 2e6c 6f61 6428 736f      self.load(so
-0003f340: 7572 6365 7329 0a0a 2020 2020 6465 6620  urces)..    def 
-0003f350: 6164 645f 726f 6928 7365 6c66 2c20 736f  add_roi(self, so
-0003f360: 7572 6365 2c20 2a2a 6b77 6172 6773 293a  urce, **kwargs):
-0003f370: 0a20 2020 2020 2020 2022 2222 4164 6420  .        """Add 
-0003f380: 6120 7369 6e67 6c65 2052 4f49 2077 6974  a single ROI wit
-0003f390: 6820 206f 7074 696f 6e61 6c20 6b77 6172  h  optional kwar
-0003f3a0: 6773 2e22 2222 0a0a 2020 2020 2020 2020  gs."""..        
-0003f3b0: 7365 6c66 2e73 6f75 7263 6573 2e61 7070  self.sources.app
-0003f3c0: 656e 6428 736f 7572 6365 290a 2020 2020  end(source).    
-0003f3d0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0003f3e0: 6528 736f 7572 6365 2c20 524f 4929 3a0a  e(source, ROI):.
-0003f3f0: 2020 2020 2020 2020 2020 2020 726f 6920              roi 
-0003f400: 3d20 736f 7572 6365 0a20 2020 2020 2020  = source.       
-0003f410: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0003f420: 2020 2072 6f69 5f6b 7761 7267 7320 3d20     roi_kwargs = 
-0003f430: 7365 6c66 2e72 6f69 5f6b 7761 7267 732e  self.roi_kwargs.
-0003f440: 636f 7079 2829 0a20 2020 2020 2020 2020  copy().         
-0003f450: 2020 2072 6f69 5f6b 7761 7267 732e 7570     roi_kwargs.up
-0003f460: 6461 7465 286b 7761 7267 7329 0a20 2020  date(kwargs).   
-0003f470: 2020 2020 2020 2020 2072 6f69 203d 2052           roi = R
-0003f480: 4f49 2873 6f75 7263 652c 202a 2a72 6f69  OI(source, **roi
-0003f490: 5f6b 7761 7267 7329 0a20 2020 2020 2020  _kwargs).       
-0003f4a0: 2072 6f69 2e73 7472 7563 7475 7265 5f73   roi.structure_s
-0003f4b0: 6574 203d 2073 656c 660a 2020 2020 2020  et = self.      
-0003f4c0: 2020 7365 6c66 2e72 6f69 732e 6170 7065    self.rois.appe
-0003f4d0: 6e64 2872 6f69 290a 0a20 2020 2064 6566  nd(roi)..    def
-0003f4e0: 2063 6c6f 6e65 5f61 7474 7273 2873 656c   clone_attrs(sel
-0003f4f0: 662c 206f 626a 2c20 636f 7079 5f72 6f69  f, obj, copy_roi
-0003f500: 733d 5472 7565 2c20 636f 7079 5f72 6f69  s=True, copy_roi
-0003f510: 5f64 6174 613d 5472 7565 293a 0a20 2020  _data=True):.   
-0003f520: 2020 2020 2022 2222 4173 7369 676e 2061       """Assign a
-0003f530: 6c6c 2061 7474 7269 6275 7465 7320 6f66  ll attributes of
-0003f540: 203c 7365 6c66 3e20 746f 2061 6e6f 7468   <self> to anoth
-0003f550: 6572 206f 626a 6563 742c 203c 6f62 6a3e  er object, <obj>
-0003f560: 2c20 656e 7375 7269 6e67 0a20 2020 2020  , ensuring.     
-0003f570: 2020 2074 6861 7420 524f 4973 2061 7265     that ROIs are
-0003f580: 2063 6f70 6965 6420 6966 2063 6f70 795f   copied if copy_
-0003f590: 726f 6973 3d54 7275 652e 2222 220a 0a20  rois=True.""".. 
-0003f5a0: 2020 2020 2020 2073 6b72 742e 636f 7265         skrt.core
-0003f5b0: 2e44 6174 612e 636c 6f6e 655f 6174 7472  .Data.clone_attr
-0003f5c0: 7328 7365 6c66 2c20 6f62 6a29 0a20 2020  s(self, obj).   
-0003f5d0: 2020 2020 2069 6620 636f 7079 5f72 6f69       if copy_roi
-0003f5e0: 733a 0a20 2020 2020 2020 2020 2020 206f  s:.            o
-0003f5f0: 626a 2e72 6f69 7320 3d20 5b5d 0a20 2020  bj.rois = [].   
-0003f600: 2020 2020 2020 2020 2066 6f72 2072 6f69           for roi
-0003f610: 2069 6e20 7365 6c66 2e72 6f69 733a 0a20   in self.rois:. 
-0003f620: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0003f630: 626a 2e72 6f69 732e 6170 7065 6e64 2872  bj.rois.append(r
-0003f640: 6f69 2e63 6c6f 6e65 2863 6f70 795f 6461  oi.clone(copy_da
-0003f650: 7461 3d63 6f70 795f 726f 695f 6461 7461  ta=copy_roi_data
-0003f660: 2929 0a0a 2020 2020 6465 6620 6669 6c74  ))..    def filt
-0003f670: 6572 6564 5f63 6f70 7928 0a20 2020 2020  ered_copy(.     
-0003f680: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0003f690: 206e 616d 6573 3d4e 6f6e 652c 0a20 2020   names=None,.   
-0003f6a0: 2020 2020 206e 616d 653d 4e6f 6e65 2c0a       name=None,.
-0003f6b0: 2020 2020 2020 2020 746f 5f6b 6565 703d          to_keep=
-0003f6c0: 4e6f 6e65 2c0a 2020 2020 2020 2020 746f  None,.        to
-0003f6d0: 5f72 656d 6f76 653d 4e6f 6e65 2c0a 2020  _remove=None,.  
-0003f6e0: 2020 2020 2020 6b65 6570 5f72 656e 616d        keep_renam
-0003f6f0: 6564 5f6f 6e6c 793d 4661 6c73 652c 0a20  ed_only=False,. 
-0003f700: 2020 2020 2020 2063 6f70 795f 726f 695f         copy_roi_
-0003f710: 6461 7461 3d54 7275 650a 2020 2020 293a  data=True.    ):
-0003f720: 0a20 2020 2020 2020 2022 2222 4372 6561  .        """Crea
-0003f730: 7465 2061 2063 6f70 7920 6f66 2074 6869  te a copy of thi
-0003f740: 7320 7374 7275 6374 7572 6520 7365 7420  s structure set 
-0003f750: 7769 7468 2052 4f49 7320 6f70 7469 6f6e  with ROIs option
-0003f760: 616c 6c79 0a20 2020 2020 2020 2072 656e  ally.        ren
-0003f770: 616d 6564 206f 7220 6669 6c74 6572 6564  amed or filtered
-0003f780: 2e20 5265 7475 726e 7320 6120 6e65 7720  . Returns a new 
-0003f790: 5374 7275 6374 7572 6553 6574 206f 626a  StructureSet obj
-0003f7a0: 6563 742e 0a0a 2020 2020 2020 2020 2a2a  ect...        **
-0003f7b0: 5061 7261 6d65 7465 7273 3a2a 2a0a 2020  Parameters:**.  
-0003f7c0: 2020 2020 2020 0a20 2020 2020 2020 206e        .        n
-0003f7d0: 616d 6573 203a 2064 6963 742c 2064 6566  ames : dict, def
-0003f7e0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-0003f7f0: 2020 2020 2020 4469 6374 696f 6e61 7279        Dictionary
-0003f800: 206f 6620 6e61 6d65 7320 666f 7220 7265   of names for re
-0003f810: 6e61 6d69 6e67 2052 4f49 732c 2077 6865  naming ROIs, whe
-0003f820: 7265 2074 6865 206b 6579 7320 6172 6520  re the keys are 
-0003f830: 6e65 7720 0a20 2020 2020 2020 2020 2020  new .           
-0003f840: 206e 616d 6573 2061 6e64 2076 616c 7565   names and value
-0003f850: 7320 6172 6520 6c69 7374 7320 6f66 2070  s are lists of p
-0003f860: 6f73 7369 626c 6520 6e61 6d65 7320 6f66  ossible names of
-0003f870: 2052 4f49 7320 7468 6174 2073 686f 756c   ROIs that shoul
-0003f880: 640a 2020 2020 2020 2020 2020 2020 6265  d.            be
-0003f890: 2061 7373 6967 6e65 6420 7468 6520 6e65   assigned the ne
-0003f8a0: 7720 6e61 6d65 2e20 5468 6573 6520 6e61  w name. These na
-0003f8b0: 6d65 7320 6361 6e20 616c 736f 2063 6f6e  mes can also con
-0003f8c0: 7461 696e 2077 696c 6463 6172 6473 0a20  tain wildcards. 
-0003f8d0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0003f8e0: 7468 6520 272a 2720 7379 6d62 6f6c 2e0a  the '*' symbol..
-0003f8f0: 0a20 2020 2020 2020 206e 616d 6520 3a20  .        name : 
-0003f900: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
-0003f910: 650a 2020 2020 2020 2020 2020 2020 4e61  e.            Na
-0003f920: 6d65 2066 6f72 2074 6865 2072 6574 7572  me for the retur
-0003f930: 6e65 6420 5374 7275 6374 7572 6553 6574  ned StructureSet
-0003f940: 2e0a 0a20 2020 2020 2020 2074 6f5f 6b65  ...        to_ke
-0003f950: 6570 203a 206c 6973 742c 2064 6566 6175  ep : list, defau
-0003f960: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-0003f970: 2020 2020 4c69 7374 206f 6620 6e61 6d65      List of name
-0003f980: 7320 6f66 2052 4f49 7320 746f 206b 6565  s of ROIs to kee
-0003f990: 7020 696e 2074 6865 2063 6f70 6965 6420  p in the copied 
-0003f9a0: 5374 7275 6374 7572 6553 6574 3b20 616c  StructureSet; al
-0003f9b0: 6c20 0a20 2020 2020 2020 2020 2020 206f  l .            o
-0003f9c0: 7468 6572 7320 7769 6c6c 2062 6520 7265  thers will be re
-0003f9d0: 6d6f 7665 642e 2054 6865 7365 206e 616d  moved. These nam
-0003f9e0: 6573 2063 616e 2061 6c73 6f20 636f 6e74  es can also cont
-0003f9f0: 6169 6e20 7769 6c64 6361 7264 730a 2020  ain wildcards.  
-0003fa00: 2020 2020 2020 2020 2020 7769 7468 2074            with t
-0003fa10: 6865 2027 2a27 2073 796d 626f 6c2e 2041  he '*' symbol. A
-0003fa20: 7070 6c69 6564 2061 6674 6572 2072 656e  pplied after ren
-0003fa30: 616d 696e 6720 7769 7468 203c 6e61 6d65  aming with <name
-0003fa40: 733e 2e0a 0a20 2020 2020 2020 2074 6f5f  s>...        to_
-0003fa50: 7265 6d6f 7665 203a 206c 6973 742c 2064  remove : list, d
-0003fa60: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-0003fa70: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
-0003fa80: 6e61 6d65 7320 6f66 2052 4f49 7320 746f  names of ROIs to
-0003fa90: 2072 656d 6f76 6520 6672 6f6d 2074 6865   remove from the
-0003faa0: 2063 6f70 6965 6420 5374 7275 6374 7572   copied Structur
-0003fab0: 6553 6574 3b20 616c 6c20 0a20 2020 2020  eSet; all .     
-0003fac0: 2020 2020 2020 206f 7468 6572 7320 7769         others wi
-0003fad0: 6c6c 2062 6520 7265 6d6f 7665 642e 2054  ll be removed. T
-0003fae0: 6865 7365 206e 616d 6573 2063 616e 2061  hese names can a
-0003faf0: 6c73 6f20 636f 6e74 6169 6e20 7769 6c64  lso contain wild
-0003fb00: 6361 7264 730a 2020 2020 2020 2020 2020  cards.          
-0003fb10: 2020 7769 7468 2074 6865 2027 2a27 2073    with the '*' s
-0003fb20: 796d 626f 6c2e 2041 7070 6c69 6564 2061  ymbol. Applied a
-0003fb30: 6674 6572 2072 656e 616d 696e 6720 7769  fter renaming wi
-0003fb40: 7468 203c 6e61 6d65 733e 2061 6e64 200a  th <names> and .
-0003fb50: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
-0003fb60: 6572 696e 6720 7769 7468 203c 746f 5f6b  ering with <to_k
-0003fb70: 6565 703e 2e0a 0a20 2020 2020 2020 206b  eep>...        k
-0003fb80: 6565 705f 7265 6e61 6d65 645f 6f6e 6c79  eep_renamed_only
-0003fb90: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-0003fba0: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
-0003fbb0: 2020 2049 6620 5472 7565 2c20 616e 7920     If True, any 
-0003fbc0: 524f 4973 2074 6861 7420 646f 206e 6f74  ROIs that do not
-0003fbd0: 2067 6574 2072 656e 616d 6564 2077 696c   get renamed wil
-0003fbe0: 6c20 6265 2072 656d 6f76 6564 2066 726f  l be removed fro
-0003fbf0: 6d0a 2020 2020 2020 2020 2020 2020 7468  m.            th
-0003fc00: 6520 5374 7275 6374 7572 6553 6574 2e0a  e StructureSet..
-0003fc10: 0a20 2020 2020 2020 2063 6f70 795f 726f  .        copy_ro
-0003fc20: 695f 6461 7461 203a 2062 6f6f 6c2c 2064  i_data : bool, d
-0003fc30: 6566 6175 6c74 3d54 7275 650a 2020 2020  efault=True.    
-0003fc40: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-0003fc50: 2074 6865 2052 4f49 7320 696e 2074 6865   the ROIs in the
-0003fc60: 2072 6574 7572 6e65 6420 5374 7275 6374   returned Struct
-0003fc70: 7572 6553 6574 2077 696c 6c20 636f 6e74  ureSet will cont
-0003fc80: 6169 6e0a 2020 2020 2020 2020 2020 2020  ain.            
-0003fc90: 636f 7069 6573 206f 6620 7468 6520 6461  copies of the da
-0003fca0: 7461 2066 726f 6d20 7468 6520 6f72 6967  ta from the orig
-0003fcb0: 696e 616c 2053 7472 7563 7475 7265 5365  inal StructureSe
-0003fcc0: 742e 204f 7468 6572 7769 7365 2c0a 2020  t. Otherwise,.  
-0003fcd0: 2020 2020 2020 2020 2020 7468 6520 6e65            the ne
-0003fce0: 7720 524f 4973 2077 696c 6c20 636f 6e74  w ROIs will cont
-0003fcf0: 6169 6e20 7265 6665 7265 6e63 6573 2074  ain references t
-0003fd00: 6f20 7468 6520 7361 6d65 2064 6174 612c  o the same data,
-0003fd10: 2065 2e67 2e20 7468 6520 0a20 2020 2020   e.g. the .     
-0003fd20: 2020 2020 2020 2073 616d 6520 6e75 6d70         same nump
-0003fd30: 7920 6e64 6172 7261 7920 6f62 6a65 6374  y ndarray object
-0003fd40: 2066 6f72 2074 6865 206d 6173 6b2f 7361   for the mask/sa
-0003fd50: 6d65 2064 6963 7420 666f 7220 7468 6520  me dict for the 
-0003fd60: 636f 6e74 6f75 7273 2e0a 2020 2020 2020  contours..      
-0003fd70: 2020 2020 2020 4f6e 6c79 2075 7365 6420        Only used 
-0003fd80: 6966 203c 636f 7079 5f72 6f69 733e 2069  if <copy_rois> i
-0003fd90: 7320 5472 7565 0a20 2020 2020 2020 2022  s True.        "
-0003fda0: 2222 0a0a 2020 2020 2020 2020 7365 6c66  ""..        self
-0003fdb0: 2e6c 6f61 6428 290a 2020 2020 2020 2020  .load().        
-0003fdc0: 7373 203d 2073 656c 662e 636c 6f6e 6528  ss = self.clone(
-0003fdd0: 636f 7079 5f72 6f69 5f64 6174 613d 636f  copy_roi_data=co
-0003fde0: 7079 5f72 6f69 5f64 6174 6129 0a20 2020  py_roi_data).   
-0003fdf0: 2020 2020 2069 6620 6e61 6d65 2069 7320       if name is 
-0003fe00: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0003fe10: 2020 2020 2020 7373 2e6e 616d 6520 3d20        ss.name = 
-0003fe20: 6e61 6d65 0a20 2020 2020 2020 2073 732e  name.        ss.
-0003fe30: 7265 6e61 6d65 5f72 6f69 7328 6e61 6d65  rename_rois(name
-0003fe40: 732c 206b 6565 705f 7265 6e61 6d65 645f  s, keep_renamed_
-0003fe50: 6f6e 6c79 3d6b 6565 705f 7265 6e61 6d65  only=keep_rename
-0003fe60: 645f 6f6e 6c79 290a 2020 2020 2020 2020  d_only).        
-0003fe70: 7373 2e66 696c 7465 725f 726f 6973 2874  ss.filter_rois(t
-0003fe80: 6f5f 6b65 6570 2c20 746f 5f72 656d 6f76  o_keep, to_remov
-0003fe90: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-0003fea0: 6e20 7373 0a0a 2020 2020 6465 6620 6765  n ss..    def ge
-0003feb0: 745f 726f 6973 2873 656c 662c 206e 616d  t_rois(self, nam
-0003fec0: 6573 3d4e 6f6e 652c 2069 676e 6f72 655f  es=None, ignore_
-0003fed0: 656d 7074 793d 4661 6c73 6529 3a0a 2020  empty=False):.  
-0003fee0: 2020 2020 2020 2222 2247 6574 206c 6973        """Get lis
-0003fef0: 7420 6f66 2052 4f49 206f 626a 6563 7473  t of ROI objects
-0003ff00: 2049 6620 3c6e 616d 6573 3e20 6973 2067   If <names> is g
-0003ff10: 6976 656e 2c20 6f6e 6c79 2074 6865 2052  iven, only the R
-0003ff20: 4f49 7320 7769 7468 0a20 2020 2020 2020  OIs with.       
-0003ff30: 2074 686f 7365 206e 616d 6573 2077 696c   those names wil
-0003ff40: 6c20 6265 2072 6574 7572 6e65 642e 2222  l be returned.""
-0003ff50: 220a 0a20 2020 2020 2020 2073 656c 662e  "..        self.
-0003ff60: 6c6f 6164 2829 0a20 2020 2020 2020 2069  load().        i
-0003ff70: 6620 6e61 6d65 7320 6973 204e 6f6e 653a  f names is None:
-0003ff80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0003ff90: 6967 6e6f 7265 5f65 6d70 7479 3a0a 2020  ignore_empty:.  
-0003ffa0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0003ffb0: 7475 726e 205b 726f 6920 666f 7220 726f  turn [roi for ro
-0003ffc0: 6920 696e 2073 656c 662e 726f 6973 2069  i in self.rois i
-0003ffd0: 6620 6e6f 7420 726f 692e 656d 7074 795d  f not roi.empty]
-0003ffe0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0003fff0: 7572 6e20 7365 6c66 2e72 6f69 730a 0a20  urn self.rois.. 
-00040000: 2020 2020 2020 2072 6f69 7320 3d20 5b5d         rois = []
-00040010: 0a20 2020 2020 2020 2066 6f72 206e 616d  .        for nam
-00040020: 6520 696e 206e 616d 6573 3a0a 2020 2020  e in names:.    
-00040030: 2020 2020 2020 2020 726f 6920 3d20 7365          roi = se
-00040040: 6c66 2e67 6574 5f72 6f69 286e 616d 6529  lf.get_roi(name)
-00040050: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00040060: 726f 6920 6973 206e 6f74 204e 6f6e 653a  roi is not None:
-00040070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00040080: 2069 6620 6e6f 7420 6967 6e6f 7265 5f65   if not ignore_e
-00040090: 6d70 7479 206f 7220 6e6f 7420 726f 692e  mpty or not roi.
-000400a0: 656d 7074 793a 0a20 2020 2020 2020 2020  empty:.         
-000400b0: 2020 2020 2020 2020 2020 2072 6f69 732e             rois.
-000400c0: 6170 7065 6e64 2872 6f69 290a 2020 2020  append(roi).    
-000400d0: 2020 2020 7265 7475 726e 2072 6f69 730a      return rois.
-000400e0: 0a20 2020 2064 6566 2067 6574 5f72 6f69  .    def get_roi
-000400f0: 735f 7769 6c64 6361 7264 2873 656c 662c  s_wildcard(self,
-00040100: 2077 696c 6463 6172 6429 3a0a 2020 2020   wildcard):.    
-00040110: 2020 2020 2222 2252 6574 7572 6e20 6c69      """Return li
-00040120: 7374 206f 6620 524f 4973 206d 6174 6368  st of ROIs match
-00040130: 696e 6720 6120 7769 6c64 6361 7264 2065  ing a wildcard e
-00040140: 7870 7265 7373 696f 6e2e 2222 220a 0a20  xpression.""".. 
-00040150: 2020 2020 2020 2072 6f69 7320 3d20 5b5d         rois = []
-00040160: 0a20 2020 2020 2020 2066 6f72 2072 6f69  .        for roi
-00040170: 2069 6e20 7365 6c66 2e67 6574 5f72 6f69   in self.get_roi
-00040180: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00040190: 2069 6620 666e 6d61 7463 682e 666e 6d61   if fnmatch.fnma
-000401a0: 7463 6828 726f 692e 6e61 6d65 2e6c 6f77  tch(roi.name.low
-000401b0: 6572 2829 2c20 7769 6c64 6361 7264 2e6c  er(), wildcard.l
-000401c0: 6f77 6572 2829 293a 0a20 2020 2020 2020  ower()):.       
-000401d0: 2020 2020 2020 2020 2072 6f69 732e 6170           rois.ap
-000401e0: 7065 6e64 2872 6f69 290a 2020 2020 2020  pend(roi).      
-000401f0: 2020 7265 7475 726e 2072 6f69 730a 0a20    return rois.. 
-00040200: 2020 2064 6566 2067 6574 5f72 6f69 5f6e     def get_roi_n
-00040210: 616d 6573 2873 656c 662c 206f 7269 6769  ames(self, origi
-00040220: 6e61 6c3d 4661 6c73 652c 2069 676e 6f72  nal=False, ignor
-00040230: 655f 656d 7074 793d 4661 6c73 6529 3a0a  e_empty=False):.
-00040240: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00040250: 2020 2020 4765 7420 6c69 7374 206f 6620      Get list of 
-00040260: 6e61 6d65 7320 6f66 2052 4f49 7320 696e  names of ROIs in
-00040270: 2074 6869 7320 7374 7275 6374 7572 6520   this structure 
-00040280: 7365 742e 2049 6620 3c6f 7269 6769 6e61  set. If <origina
-00040290: 6c3e 2069 7320 5472 7565 2c0a 2020 2020  l> is True,.    
-000402a0: 2020 2020 6765 7420 7468 6520 6f72 6967      get the orig
-000402b0: 696e 616c 206e 616d 6573 206f 6620 7468  inal names of th
-000402c0: 6520 524f 4973 2e20 2049 6620 3c69 676e  e ROIs.  If <ign
-000402d0: 6f72 655f 656d 7074 793e 2069 7320 5472  ore_empty> is Tr
-000402e0: 7565 2c0a 2020 2020 2020 2020 6f6d 6974  ue,.        omit
-000402f0: 206e 616d 6573 206f 6620 656d 7074 7920   names of empty 
-00040300: 524f 4973 2e0a 2020 2020 2020 2020 2222  ROIs..        ""
-00040310: 220a 0a20 2020 2020 2020 2072 6574 7572  "..        retur
-00040320: 6e20 5b73 2e67 6574 5f6e 616d 6528 6f72  n [s.get_name(or
-00040330: 6967 696e 616c 2920 666f 7220 7320 696e  iginal) for s in
-00040340: 2073 656c 662e 6765 745f 726f 6973 2829   self.get_rois()
-00040350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00040360: 2069 6620 6e6f 7420 2869 676e 6f72 655f   if not (ignore_
-00040370: 656d 7074 7920 616e 6420 732e 656d 7074  empty and s.empt
-00040380: 7929 5d0a 0a0a 2020 2020 6465 6620 6765  y)]...    def ge
-00040390: 745f 726f 695f 6469 6374 2873 656c 6629  t_roi_dict(self)
-000403a0: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
-000403b0: 2064 6963 7420 6f66 2052 4f49 206e 616d   dict of ROI nam
-000403c0: 6573 2061 6e64 206f 626a 6563 7473 2e22  es and objects."
-000403d0: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
-000403e0: 726e 207b 732e 6e61 6d65 3a20 7320 666f  rn {s.name: s fo
-000403f0: 7220 7320 696e 2073 656c 662e 6765 745f  r s in self.get_
-00040400: 726f 6973 2829 7d0a 0a20 2020 2064 6566  rois()}..    def
-00040410: 2067 6574 5f72 6f69 2873 656c 662c 206e   get_roi(self, n
-00040420: 616d 6529 3a0a 2020 2020 2020 2020 2222  ame):.        ""
-00040430: 2247 6574 2061 6e20 524f 4920 7769 7468  "Get an ROI with
-00040440: 2061 2073 7065 6369 6669 6320 6e61 6d65   a specific name
-00040450: 2e22 2222 0a0a 2020 2020 2020 2020 726f  ."""..        ro
-00040460: 6973 203d 2073 656c 662e 6765 745f 726f  is = self.get_ro
-00040470: 695f 6469 6374 2829 0a20 2020 2020 2020  i_dict().       
-00040480: 2069 6620 6e61 6d65 206e 6f74 2069 6e20   if name not in 
-00040490: 726f 6973 3a0a 2020 2020 2020 2020 2020  rois:.          
-000404a0: 2020 7072 696e 7428 6622 524f 4920 7b6e    print(f"ROI {n
-000404b0: 616d 657d 206e 6f74 2066 6f75 6e64 2122  ame} not found!"
-000404c0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-000404d0: 7475 726e 0a20 2020 2020 2020 2072 6574  turn.        ret
-000404e0: 7572 6e20 726f 6973 5b6e 616d 655d 0a0a  urn rois[name]..
-000404f0: 2020 2020 6465 6620 7072 696e 745f 726f      def print_ro
-00040500: 6973 2873 656c 6629 3a0a 0a20 2020 2020  is(self):..     
-00040510: 2020 2073 656c 662e 6c6f 6164 2829 0a20     self.load(). 
-00040520: 2020 2020 2020 2070 7269 6e74 2822 5c6e         print("\n
-00040530: 222e 6a6f 696e 2873 656c 662e 6765 745f  ".join(self.get_
-00040540: 726f 695f 6e61 6d65 7328 2929 290a 0a20  roi_names())).. 
-00040550: 2020 2064 6566 2067 6574 5f6e 616d 6528     def get_name(
-00040560: 7365 6c66 293a 0a20 2020 2020 2020 2027  self):.        '
-00040570: 2727 0a20 2020 2020 2020 204c 6f61 6420  ''.        Load 
-00040580: 7365 6c66 2061 6e64 2067 6574 206e 616d  self and get nam
-00040590: 652e 0a20 2020 2020 2020 2027 2727 0a0a  e..        '''..
-000405a0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-000405b0: 6428 290a 2020 2020 2020 2020 7265 7475  d().        retu
-000405c0: 726e 2028 7365 6c66 2e6e 616d 6529 0a0a  rn (self.name)..
-000405d0: 2020 2020 6465 6620 6765 745f 7472 616e      def get_tran
-000405e0: 736c 6174 696f 6e5f 746f 5f61 6c69 676e  slation_to_align
-000405f0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-00040600: 6c66 2c20 6f74 6865 722c 207a 5f66 7261  lf, other, z_fra
-00040610: 6374 696f 6e31 3d4e 6f6e 652c 207a 5f66  ction1=None, z_f
-00040620: 7261 6374 696f 6e32 3d4e 6f6e 6529 3a0a  raction2=None):.
-00040630: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00040640: 2020 2020 4465 7465 726d 696e 6520 7472      Determine tr
-00040650: 616e 736c 6174 696f 6e20 666f 7220 616c  anslation for al
-00040660: 6967 6e69 6e67 203c 7365 6c66 3e20 746f  igning <self> to
-00040670: 203c 6f74 6865 723e 2e0a 0a20 2020 2020   <other>...     
-00040680: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-00040690: 2a2a 0a0a 2020 2020 2020 2020 6f74 6865  **..        othe
-000406a0: 7220 3a20 524f 492f 5374 7275 6374 7572  r : ROI/Structur
-000406b0: 6553 6574 2f6c 6973 740a 2020 2020 2020  eSet/list.      
-000406c0: 2020 2020 2020 524f 4920 7769 7468 2077        ROI with w
-000406d0: 6869 6368 2061 6c69 676e 6d65 6e74 2069  hich alignment i
-000406e0: 7320 746f 2062 6520 7065 7266 6f72 6d65  s to be performe
-000406f0: 642e 2020 5468 6973 2063 616e 2062 650a  d.  This can be.
-00040700: 2020 2020 2020 2020 2020 2020 7370 6563              spec
-00040710: 6966 6965 6420 6469 7265 6374 6c79 2061  ified directly a
-00040720: 7320 6120 7369 6e67 6c65 2052 4f49 2e20  s a single ROI. 
-00040730: 2041 6c74 6572 6e61 7469 7665 6c79 2c20   Alternatively, 
-00040740: 6974 2063 616e 0a20 2020 2020 2020 2020  it can.         
-00040750: 2020 2062 6520 6120 5374 7275 6374 7572     be a Structur
-00040760: 6553 6574 2c20 6f72 2061 206c 6973 7420  eSet, or a list 
-00040770: 6f72 2052 4f49 2f53 7472 7563 7475 7265  or ROI/Structure
-00040780: 5365 7420 6f62 6a65 6374 732c 0a20 2020  Set objects,.   
-00040790: 2020 2020 2020 2020 2069 6e20 7768 6963           in whic
-000407a0: 6820 6361 7365 2074 6865 2069 6e64 6976  h case the indiv
-000407b0: 6964 7561 6c20 524f 4973 2077 696c 6c20  idual ROIs will 
-000407c0: 6265 2063 6f6d 6269 6e65 642e 0a0a 2020  be combined...  
-000407d0: 2020 2020 2020 7a5f 6672 6163 7469 6f6e        z_fraction
-000407e0: 3120 3a20 666c 6f61 742c 2064 6566 6175  1 : float, defau
-000407f0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00040800: 2020 2020 506f 7369 7469 6f6e 2061 6c6f      Position alo
-00040810: 6e67 207a 2061 7869 7320 6f66 2073 6c69  ng z axis of sli
-00040820: 6365 2074 6872 6f75 6768 203c 7365 6c66  ce through <self
-00040830: 3e20 6f6e 2077 6869 6368 0a20 2020 2020  > on which.     
-00040840: 2020 2020 2020 2074 6f20 616c 6967 6e2e         to align.
-00040850: 2020 4966 204e 6f6e 652c 2061 6c69 676e    If None, align
-00040860: 6d65 6e74 2069 7320 746f 2074 6865 2063  ment is to the c
-00040870: 656e 7472 6f69 6420 6f66 2074 6865 0a20  entroid of the. 
-00040880: 2020 2020 2020 2020 2020 2077 686f 6c65             whole
-00040890: 2052 4f49 2076 6f6c 756d 652e 2020 4f74   ROI volume.  Ot
-000408a0: 6865 7277 6973 652c 2061 6c69 676e 6d65  herwise, alignme
-000408b0: 6e74 2069 7320 746f 2074 6865 0a20 2020  nt is to the.   
-000408c0: 2020 2020 2020 2020 2063 656e 7472 6f69           centroi
-000408d0: 6420 6f66 2074 6865 2073 6c69 6365 2061  d of the slice a
-000408e0: 7420 7468 6520 7370 6563 6966 6965 6420  t the specified 
-000408f0: 6469 7374 616e 6365 0a20 2020 2020 2020  distance.       
-00040900: 2020 2020 2066 726f 6d20 7468 6520 524f       from the RO
-00040910: 4927 7320 6d6f 7374 2d69 6e66 6572 696f  I's most-inferio
-00040920: 7220 706f 696e 743a 2030 2063 6f72 7265  r point: 0 corre
-00040930: 7370 6f6e 6473 2074 6f0a 2020 2020 2020  sponds to.      
-00040940: 2020 2020 2020 7468 6520 6d6f 7374 2d69        the most-i
-00040950: 6e66 6572 696f 7220 706f 696e 7420 286c  nferior point (l
-00040960: 6f77 6573 7420 7a29 3b20 3120 636f 7272  owest z); 1 corr
-00040970: 6573 706f 6e64 7320 746f 2074 6865 0a20  esponds to the. 
-00040980: 2020 2020 2020 2020 2020 206d 6f73 742d             most-
-00040990: 7375 7065 7269 6f72 2070 6f69 6e74 2028  superior point (
-000409a0: 6869 6768 6573 7420 7a29 2e20 2056 616c  highest z).  Val
-000409b0: 7565 7320 666f 7220 7a5f 6672 6163 7469  ues for z_fracti
-000409c0: 6f6e 0a20 2020 2020 2020 2020 2020 206f  on.            o
-000409d0: 7574 7369 6465 2074 6865 2069 6e74 6572  utside the inter
-000409e0: 7661 6c20 5b30 2c20 315d 2072 6573 756c  val [0, 1] resul
-000409f0: 7420 696e 2061 2052 756e 7469 6d65 4572  t in a RuntimeEr
-00040a00: 726f 722e 0a0a 2020 2020 2020 2020 7a5f  ror...        z_
-00040a10: 6672 6163 7469 6f6e 3220 3a20 666c 6f61  fraction2 : floa
-00040a20: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-00040a30: 2020 2020 2020 2020 2020 2020 506f 7369              Posi
-00040a40: 7469 6f6e 2061 6c6f 6e67 207a 2061 7869  tion along z axi
-00040a50: 7320 6f66 2073 6c69 6365 2074 6872 6f75  s of slice throu
-00040a60: 6768 203c 6f74 6865 723e 206f 6e20 7768  gh <other> on wh
-00040a70: 6963 680a 2020 2020 2020 2020 2020 2020  ich.            
-00040a80: 746f 2061 6c69 676e 2e20 2049 6620 4e6f  to align.  If No
-00040a90: 6e65 2c20 616c 6967 6e6d 656e 7420 6973  ne, alignment is
-00040aa0: 2074 6f20 7468 6520 6365 6e74 726f 6964   to the centroid
-00040ab0: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
-00040ac0: 2020 2020 7768 6f6c 6520 524f 4920 766f      whole ROI vo
-00040ad0: 6c75 6d65 2e20 204f 7468 6572 7769 7365  lume.  Otherwise
-00040ae0: 2c20 616c 6967 6e6d 656e 7420 6973 2074  , alignment is t
-00040af0: 6f20 7468 650a 2020 2020 2020 2020 2020  o the.          
-00040b00: 2020 6365 6e74 726f 6964 206f 6620 7468    centroid of th
-00040b10: 6520 736c 6963 6520 6174 2074 6865 2073  e slice at the s
-00040b20: 7065 6369 6669 6564 2064 6973 7461 6e63  pecified distanc
-00040b30: 650a 2020 2020 2020 2020 2020 2020 6672  e.            fr
-00040b40: 6f6d 2074 6865 2052 4f49 2773 206d 6f73  om the ROI's mos
-00040b50: 742d 696e 6665 7269 6f72 2070 6f69 6e74  t-inferior point
-00040b60: 3a20 3020 636f 7272 6573 706f 6e64 7320  : 0 corresponds 
-00040b70: 746f 0a20 2020 2020 2020 2020 2020 2074  to.            t
-00040b80: 6865 206d 6f73 742d 696e 6665 7269 6f72  he most-inferior
-00040b90: 2070 6f69 6e74 2028 6c6f 7765 7374 207a   point (lowest z
-00040ba0: 293b 2031 2063 6f72 7265 7370 6f6e 6473  ); 1 corresponds
-00040bb0: 2074 6f20 7468 650a 2020 2020 2020 2020   to the.        
-00040bc0: 2020 2020 6d6f 7374 2d73 7570 6572 696f      most-superio
-00040bd0: 7220 706f 696e 7420 2868 6967 6865 7374  r point (highest
-00040be0: 207a 292e 2020 5661 6c75 6573 2066 6f72   z).  Values for
-00040bf0: 207a 5f66 7261 6374 696f 6e0a 2020 2020   z_fraction.    
-00040c00: 2020 2020 2020 2020 6f75 7473 6964 6520          outside 
-00040c10: 7468 6520 696e 7465 7276 616c 205b 302c  the interval [0,
-00040c20: 2031 5d20 7265 7375 6c74 2069 6e20 6120   1] result in a 
-00040c30: 5275 6e74 696d 6545 7272 6f72 2e0a 2020  RuntimeError..  
-00040c40: 2020 2020 2020 2020 2020 2222 220a 2020            """.  
-00040c50: 2020 2020 2020 7265 7475 726e 2067 6574        return get
-00040c60: 5f74 7261 6e73 6c61 7469 6f6e 5f74 6f5f  _translation_to_
-00040c70: 616c 6967 6e28 0a20 2020 2020 2020 2020  align(.         
-00040c80: 2020 2020 2020 2073 656c 662c 206f 7468         self, oth
-00040c90: 6572 2c20 7a5f 6672 6163 7469 6f6e 312c  er, z_fraction1,
-00040ca0: 207a 5f66 7261 6374 696f 6e32 290a 0a20   z_fraction2).. 
-00040cb0: 2020 2064 6566 2067 6574 5f63 6f6e 666f     def get_confo
-00040cc0: 726d 6974 795f 696e 6465 7828 7365 6c66  rmity_index(self
-00040cd0: 2c20 6e61 6d65 733d 4e6f 6e65 2c20 2a2a  , names=None, **
-00040ce0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-00040cf0: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
-00040d00: 2063 6f6e 666f 726d 6974 7920 696e 6465   conformity inde
-00040d10: 7820 666f 7220 524f 4973 206f 6620 7468  x for ROIs of th
-00040d20: 6520 5374 7275 6374 7572 6553 6574 2e0a  e StructureSet..
-00040d30: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
-00040d40: 6574 6572 733a 2a2a 0a0a 2020 2020 2020  eters:**..      
-00040d50: 2020 6e61 6d65 7320 3a20 6c69 7374 2c20    names : list, 
-00040d60: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-00040d70: 2020 2020 2020 2020 204c 6973 7420 6f66           List of
-00040d80: 2073 7472 696e 6773 2063 6f72 7265 7370   strings corresp
-00040d90: 6f6e 6469 6e67 2074 6f20 524f 4920 6e61  onding to ROI na
-00040da0: 6d65 732e 2020 4966 206e 6f6e 2d6e 756c  mes.  If non-nul
-00040db0: 6c2c 0a20 2020 2020 2020 2020 2020 2054  l,.            T
-00040dc0: 6865 2063 6f6e 666f 726d 6974 7920 696e  he conformity in
-00040dd0: 6465 7820 6973 2063 616c 6375 6c61 7465  dex is calculate
-00040de0: 6420 7265 6c61 7469 7665 2066 6f72 2074  d relative for t
-00040df0: 6865 2052 4f49 730a 2020 2020 2020 2020  he ROIs.        
-00040e00: 2020 2020 7769 7468 2074 6865 206c 6973      with the lis
-00040e10: 7465 6420 6e61 6d65 7320 6f6e 6c79 2e20  ted names only. 
-00040e20: 204f 7468 6572 7769 7365 2c20 7468 6520   Otherwise, the 
-00040e30: 636f 6e66 6f72 6d69 7479 0a20 2020 2020  conformity.     
-00040e40: 2020 2020 2020 2069 6e64 6578 2069 7320         index is 
-00040e50: 6361 6c63 756c 6174 6564 2072 656c 6174  calculated relat
-00040e60: 6976 6520 746f 2061 6c6c 2052 4f49 7320  ive to all ROIs 
-00040e70: 696e 2074 6865 2073 7472 7563 7475 7265  in the structure
-00040e80: 0a20 2020 2020 2020 2020 2020 2073 6574  .            set
-00040e90: 2e0a 0a20 2020 2020 2020 206b 7761 7267  ...        kwarg
-00040ea0: 730a 2020 2020 2020 2020 2020 2020 4b65  s.            Ke
-00040eb0: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
-00040ec0: 6172 6520 7061 7373 6564 2074 6f0a 2020  are passed to.  
-00040ed0: 2020 2020 2020 2020 2020 736b 7274 2e73            skrt.s
-00040ee0: 7472 7563 7475 7265 732e 6765 745f 636f  tructures.get_co
-00040ef0: 6e66 6f72 6d69 7479 5f69 6e64 6578 2829  nformity_index()
-00040f00: 2e2e 6765 745f 7375 7266 6163 655f 6469  ..get_surface_di
-00040f10: 7374 616e 6365 7328 292e 0a20 2020 2020  stances()..     
-00040f20: 2020 2020 2020 2053 6565 2064 6f63 756d         See docum
-00040f30: 656e 7461 7469 6f6e 206f 6620 7468 6973  entation of this
-00040f40: 2066 756e 6374 696f 6e20 666f 7220 7061   function for pa
-00040f50: 7261 6d65 7465 7220 6465 7461 696c 732e  rameter details.
-00040f60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00040f70: 2020 2020 2072 6574 7572 6e20 6765 745f       return get_
-00040f80: 636f 6e66 6f72 6d69 7479 5f69 6e64 6578  conformity_index
-00040f90: 2873 656c 662e 6765 745f 726f 6973 286e  (self.get_rois(n
-00040fa0: 616d 6573 292c 202a 2a6b 7761 7267 7329  ames), **kwargs)
-00040fb0: 0a0a 2020 2020 6465 6620 6765 745f 6765  ..    def get_ge
-00040fc0: 6f6d 6574 7279 280a 2020 2020 2020 2020  ometry(.        
-00040fd0: 7365 6c66 2c20 0a20 2020 2020 2020 206e  self, .        n
-00040fe0: 616d 655f 6173 5f69 6e64 6578 3d54 7275  ame_as_index=Tru
-00040ff0: 652c 200a 2020 2020 2020 2020 6874 6d6c  e, .        html
-00041000: 3d46 616c 7365 2c20 0a20 2020 2020 2020  =False, .       
-00041010: 2063 6f6c 6f72 6564 3d46 616c 7365 2c0a   colored=False,.
-00041020: 2020 2020 2020 2020 6772 6579 6564 5f6f          greyed_o
-00041030: 7574 3d4e 6f6e 652c 0a20 2020 2020 2020  ut=None,.       
-00041040: 2072 6f69 5f6b 7761 7267 733d 7b7d 2c0a   roi_kwargs={},.
-00041050: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-00041060: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
-00041070: 7420 7061 6e64 6173 2044 6174 6146 7261  t pandas DataFra
-00041080: 6d65 206f 6620 6765 6f6d 6574 7269 6320  me of geometric 
-00041090: 7072 6f70 6572 7469 6573 2066 6f72 2061  properties for a
-000410a0: 6c6c 2052 4f49 732e 0a20 2020 2020 2020  ll ROIs..       
-000410b0: 2049 6620 6e6f 2073 6c2f 6964 782f 706f   If no sl/idx/po
-000410c0: 7320 6973 2067 6976 656e 2c20 7468 6520  s is given, the 
-000410d0: 6365 6e74 7261 6c20 736c 6963 6520 6f66  central slice of
-000410e0: 2065 6163 6820 524f 4920 7769 6c6c 2062   each ROI will b
-000410f0: 6520 7573 6564 2e0a 0a20 2020 2020 2020  e used...       
-00041100: 202a 2a50 6172 616d 6574 6572 732a 2a3a   **Parameters**:
-00041110: 0a0a 2020 2020 2020 2020 6e61 6d65 5f61  ..        name_a
-00041120: 735f 696e 6465 7820 3a20 626f 6f6c 2c20  s_index : bool, 
-00041130: 6465 6661 756c 743d 5472 7565 0a20 2020  default=True.   
-00041140: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-00041150: 2c20 7468 6520 524f 4920 6e61 6d65 7320  , the ROI names 
-00041160: 7769 6c6c 2062 6520 7573 6564 2061 7320  will be used as 
-00041170: 726f 7720 696e 6469 6365 733b 206f 7468  row indices; oth
-00041180: 6572 7769 7365 2c20 7468 6579 0a20 2020  erwise, they.   
-00041190: 2020 2020 2020 2020 2077 696c 6c20 6265           will be
-000411a0: 2067 6976 656e 2074 6865 6972 206f 776e   given their own
-000411b0: 2063 6f6c 756d 6e2e 0a0a 2020 2020 2020   column...      
-000411c0: 2020 6874 6d6c 203a 2062 6f6f 6c2c 2064    html : bool, d
-000411d0: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
-000411e0: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-000411f0: 2c20 7468 6520 7461 626c 6520 7769 6c6c  , the table will
-00041200: 2062 6520 636f 6e76 6572 7465 6420 746f   be converted to
-00041210: 2048 544d 4c20 7465 7874 2063 6f6c 6f72   HTML text color
-00041220: 2d63 6f64 6564 2062 6173 6564 0a20 2020  -coded based.   
-00041230: 2020 2020 2020 2020 206f 6e20 524f 4920           on ROI 
-00041240: 636f 6c6f 7273 2e0a 2020 2020 2020 2020  colors..        
-00041250: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
-00041260: 6874 6d6c 3a0a 2020 2020 2020 2020 2020  html:.          
-00041270: 2020 6e61 6d65 5f61 735f 696e 6465 7820    name_as_index 
-00041280: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00041290: 6966 2067 7265 7965 645f 6f75 7420 6973  if greyed_out is
-000412a0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000412b0: 2020 2067 7265 7965 645f 6f75 7420 3d20     greyed_out = 
-000412c0: 5b5d 0a0a 2020 2020 2020 2020 726f 7773  []..        rows
-000412d0: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-000412e0: 7220 726f 6920 696e 2073 656c 662e 6765  r roi in self.ge
-000412f0: 745f 726f 6973 2869 676e 6f72 655f 656d  t_rois(ignore_em
-00041300: 7074 793d 5472 7565 293a 0a0a 2020 2020  pty=True):..    
-00041310: 2020 2020 2020 2020 2320 4765 7420 4461          # Get Da
-00041320: 7461 4672 616d 6520 666f 7220 7468 6973  taFrame for this
-00041330: 2052 4f49 0a20 2020 2020 2020 2020 2020   ROI.           
-00041340: 2064 665f 726f 7720 3d20 726f 692e 6765   df_row = roi.ge
-00041350: 745f 6765 6f6d 6574 7279 286e 616d 655f  t_geometry(name_
-00041360: 6173 5f69 6e64 6578 3d6e 616d 655f 6173  as_index=name_as
-00041370: 5f69 6e64 6578 2c20 2a2a 6b77 6172 6773  _index, **kwargs
-00041380: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00041390: 2052 6570 6c61 6365 2061 6c6c 2076 616c   Replace all val
-000413a0: 7565 7320 7769 7468 2022 2d2d 2220 6966  ues with "--" if
-000413b0: 2067 7265 7969 6e67 206f 7574 2074 6869   greying out thi
-000413c0: 7320 524f 490a 2020 2020 2020 2020 2020  s ROI.          
-000413d0: 2020 6966 2072 6f69 2069 6e20 6772 6579    if roi in grey
-000413e0: 6564 5f6f 7574 3a0a 2020 2020 2020 2020  ed_out:.        
-000413f0: 2020 2020 2020 2020 666f 7220 636f 6c20          for col 
-00041400: 696e 2064 665f 726f 772e 636f 6c75 6d6e  in df_row.column
-00041410: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00041420: 2020 2020 2020 2069 6620 636f 6c20 3d3d         if col ==
-00041430: 2022 524f 4922 3a20 0a20 2020 2020 2020   "ROI": .       
-00041440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041450: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-00041460: 2020 2020 2020 2020 2020 2020 2020 6466                df
-00041470: 5f72 6f77 5b63 6f6c 5d20 3d20 222d 2d22  _row[col] = "--"
-00041480: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00041490: 5365 7420 524f 4920 6e61 6d65 2074 6f20  Set ROI name to 
-000414a0: 6861 7665 2063 6f6c 6f72 6564 2062 6163  have colored bac
-000414b0: 6b67 726f 756e 6420 6966 2072 6571 7565  kground if reque
-000414c0: 7374 6564 0a20 2020 2020 2020 2020 2020  sted.           
-000414d0: 2069 6620 636f 6c6f 7265 643a 0a20 2020   if colored:.   
-000414e0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-000414f0: 6f72 203d 2072 6f69 2e67 6574 5f63 6f6c  or = roi.get_col
-00041500: 6f72 5f66 726f 6d5f 6b77 6172 6773 2872  or_from_kwargs(r
-00041510: 6f69 5f6b 7761 7267 7329 0a20 2020 2020  oi_kwargs).     
-00041520: 2020 2020 2020 2020 2020 2063 6f6c 5f73             col_s
-00041530: 7472 203d 2067 6574 5f63 6f6c 6f72 6564  tr = get_colored
-00041540: 5f72 6f69 5f73 7472 696e 6728 0a20 2020  _roi_string(.   
-00041550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041560: 2020 2020 2072 6f69 2c20 6772 6579 3d28       roi, grey=(
-00041570: 726f 6920 696e 2067 7265 7965 645f 6f75  roi in greyed_ou
-00041580: 7429 2c20 636f 6c6f 723d 636f 6c6f 7229  t), color=color)
-00041590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000415a0: 2069 6620 6e61 6d65 5f61 735f 696e 6465   if name_as_inde
-000415b0: 783a 0a20 2020 2020 2020 2020 2020 2020  x:.             
-000415c0: 2020 2020 2020 2064 665f 726f 772e 7265         df_row.re
-000415d0: 6e61 6d65 287b 6466 5f72 6f77 2e69 6e64  name({df_row.ind
-000415e0: 6578 5b30 5d3a 2063 6f6c 5f73 7472 7d2c  ex[0]: col_str},
-000415f0: 2069 6e70 6c61 6365 3d54 7275 6529 0a20   inplace=True). 
-00041600: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00041610: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00041620: 2020 2020 2020 2020 2064 665f 726f 772e           df_row.
-00041630: 696c 6f63 5b30 2c20 305d 203d 2063 6f6c  iloc[0, 0] = col
-00041640: 5f73 7472 0a0a 2020 2020 2020 2020 2020  _str..          
-00041650: 2020 726f 7773 2e61 7070 656e 6428 6466    rows.append(df
-00041660: 5f72 6f77 290a 0a20 2020 2020 2020 2064  _row)..        d
-00041670: 6620 3d20 7064 2e63 6f6e 6361 7428 726f  f = pd.concat(ro
-00041680: 7773 290a 0a20 2020 2020 2020 2023 2052  ws)..        # R
-00041690: 6573 6574 2069 6e64 6578 2069 6620 6e6f  eset index if no
-000416a0: 7420 7573 696e 6720 524f 4920 6e61 6d65  t using ROI name
-000416b0: 7320 6173 2069 6e64 6578 0a20 2020 2020  s as index.     
-000416c0: 2020 2069 6620 6e6f 7420 6e61 6d65 5f61     if not name_a
-000416d0: 735f 696e 6465 783a 0a20 2020 2020 2020  s_index:.       
-000416e0: 2020 2020 2064 6620 3d20 6466 2e72 6573       df = df.res
-000416f0: 6574 5f69 6e64 6578 2864 726f 703d 5472  et_index(drop=Tr
-00041700: 7565 290a 0a20 2020 2020 2020 2023 2043  ue)..        # C
-00041710: 6f6e 7665 7274 2074 6f20 4854 4d4c 2069  onvert to HTML i
-00041720: 6620 6e65 6564 6564 0a20 2020 2020 2020  f needed.       
-00041730: 2069 6620 6874 6d6c 3a0a 2020 2020 2020   if html:.      
-00041740: 2020 2020 2020 7265 7475 726e 2064 665f        return df_
-00041750: 746f 5f68 746d 6c28 6466 290a 2020 2020  to_html(df).    
-00041760: 2020 2020 7265 7475 726e 2064 660a 0a20      return df.. 
-00041770: 2020 2064 6566 2067 6574 5f63 6f6d 7061     def get_compa
-00041780: 7269 736f 6e28 0a20 2020 2020 2020 2073  rison(.        s
-00041790: 656c 662c 200a 2020 2020 2020 2020 6f74  elf, .        ot
-000417a0: 6865 723d 4e6f 6e65 2c20 0a20 2020 2020  her=None, .     
-000417b0: 2020 2063 6f6d 705f 7479 7065 3d22 6175     comp_type="au
-000417c0: 746f 222c 200a 2020 2020 2020 2020 636f  to", .        co
-000417d0: 6e73 656e 7375 735f 7479 7065 3d22 6d61  nsensus_type="ma
-000417e0: 6a6f 7269 7479 222c 200a 2020 2020 2020  jority", .      
-000417f0: 2020 2a2a 6b77 6172 6773 0a20 2020 2029    **kwargs.    )
-00041800: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
-00041810: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
-00041820: 6520 6f66 2063 6f6d 7061 7269 736f 6e20  e of comparison 
-00041830: 6d65 7472 6963 7320 7673 2061 2073 696e  metrics vs a sin
-00041840: 676c 6520 524f 4920 6f72 0a20 2020 2020  gle ROI or.     
-00041850: 2020 2061 6e6f 7468 6572 2053 7472 7563     another Struc
-00041860: 7475 7265 5365 742e 0a0a 2020 2020 2020  tureSet...      
-00041870: 2020 2a2a 5061 7261 6d65 7465 7273 2a2a    **Parameters**
-00041880: 3a0a 0a20 2020 2020 2020 206f 7468 6572  :..        other
-00041890: 203a 2052 4f49 2f53 7472 7563 7475 7265   : ROI/Structure
-000418a0: 5365 742c 2064 6566 6175 6c74 3d4e 6f6e  Set, default=Non
-000418b0: 650a 2020 2020 2020 2020 2020 2020 4f62  e.            Ob
-000418c0: 6a65 6374 2074 6f20 636f 6d70 6172 6520  ject to compare 
-000418d0: 6f77 6e20 524f 4973 2077 6974 682e 2043  own ROIs with. C
-000418e0: 616e 2065 6974 6865 7220 6265 2061 2073  an either be a s
-000418f0: 696e 676c 6520 524f 492c 2077 6869 6368  ingle ROI, which
-00041900: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
-00041910: 6c20 6265 2063 6f6d 7061 7265 6420 746f  l be compared to
-00041920: 2065 7665 7279 2052 4f49 2069 6e20 7468   every ROI in th
-00041930: 6973 2073 7472 7563 7475 7265 2073 6574  is structure set
-00041940: 2c20 6f72 2061 6e6f 7468 6572 0a20 2020  , or another.   
-00041950: 2020 2020 2020 2020 2073 7472 7563 7475           structu
-00041960: 7265 2073 6574 2e20 4966 204e 6f6e 652c  re set. If None,
-00041970: 2061 2063 6f6d 7061 7269 736f 6e20 7769   a comparison wi
-00041980: 6c6c 2062 6520 7065 7266 6f72 6d65 6420  ll be performed 
-00041990: 6265 7477 6565 6e20 7468 6520 0a20 2020  between the .   
-000419a0: 2020 2020 2020 2020 2052 4f49 7320 6f66           ROIs of
-000419b0: 2074 6869 7320 7374 7275 6374 7572 6520   this structure 
-000419c0: 7365 742e 0a0a 2020 2020 2020 2020 636f  set...        co
-000419d0: 6d70 5f74 7970 6520 3a20 7374 722c 2064  mp_type : str, d
-000419e0: 6566 6175 6c74 3d22 6175 746f 220a 2020  efault="auto".  
-000419f0: 2020 2020 2020 2020 2020 4d65 7468 6f64            Method
-00041a00: 2066 6f72 2073 656c 6563 7469 6e67 2077   for selecting w
-00041a10: 6869 6368 2052 4f49 7320 7368 6f75 6c64  hich ROIs should
-00041a20: 2062 6520 636f 6d70 6172 6564 2069 6620   be compared if 
-00041a30: 6f74 6865 723d 4e6f 6e65 0a20 2020 2020  other=None.     
-00041a40: 2020 2020 2020 206f 7220 6f74 6865 7220         or other 
-00041a50: 6973 2061 2053 7472 7563 7475 7265 5365  is a StructureSe
-00041a60: 742e 204f 7074 696f 6e73 2061 7265 3a0a  t. Options are:.
-00041a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00041a80: 202d 2022 616c 6c22 203a 2063 6f6d 7061   - "all" : compa
-00041a90: 7265 2065 7665 7279 2052 4f49 2069 6e20  re every ROI in 
-00041aa0: 6f6e 6520 7374 7275 6374 7572 6520 7365  one structure se
-00041ab0: 7420 746f 2065 7665 7279 2052 4f49 0a20  t to every ROI. 
-00041ac0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00041ad0: 6e20 7468 6520 6f74 6865 7220 2872 656d  n the other (rem
-00041ae0: 6f76 696e 6720 636f 6d70 6172 6973 6f6e  oving comparison
-00041af0: 7320 6f66 2061 6e20 524f 4920 746f 2069  s of an ROI to i
-00041b00: 7473 656c 6629 2e0a 2020 2020 2020 2020  tself)..        
-00041b10: 2020 2020 2020 2020 2d20 2262 795f 6e61          - "by_na
-00041b20: 6d65 2220 3a20 636f 6d70 6172 6520 6576  me" : compare ev
-00041b30: 6572 7920 524f 4920 696e 206f 6e65 2073  ery ROI in one s
-00041b40: 7472 7563 7475 7265 2073 6574 0a20 2020  tructure set.   
-00041b50: 2020 2020 2020 2020 2020 2020 2074 6f20               to 
-00041b60: 6576 6572 7920 524f 4920 696e 2074 6865  every ROI in the
-00041b70: 206f 7468 6572 2077 6974 6820 7468 6520   other with the 
-00041b80: 7361 6d65 206e 616d 652e 2055 7365 6675  same name. Usefu
-00041b90: 6c20 7768 656e 0a20 2020 2020 2020 2020  l when.         
-00041ba0: 2020 2020 2020 2063 6f6d 7061 7269 6e67         comparing
-00041bb0: 2074 776f 2073 7472 7563 7475 7265 2073   two structure s
-00041bc0: 6574 7320 636f 6e74 6169 6e69 6e67 2052  ets containing R
-00041bd0: 4f49 7320 7769 7468 2074 6865 2073 616d  OIs with the sam
-00041be0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00041bf0: 2020 6e61 6d65 732e 0a20 2020 2020 2020    names..       
-00041c00: 2020 2020 2020 2020 202d 2022 636f 6e73           - "cons
-00041c10: 656e 7375 7322 203a 2069 6620 6f74 6865  ensus" : if othe
-00041c20: 723d 4e6f 6e65 2c20 636f 6d70 6172 6520  r=None, compare 
-00041c30: 6561 6368 2052 4f49 2069 6e20 7468 6973  each ROI in this
-00041c40: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00041c50: 2020 7374 7275 6374 7572 6520 7365 7420    structure set 
-00041c60: 746f 2074 6865 2063 6f6e 7365 6e73 7573  to the consensus
-00041c70: 206f 6620 616c 6c20 6f74 6865 7220 524f   of all other RO
-00041c80: 4973 3b20 6f74 6865 7277 6973 652c 0a20  Is; otherwise,. 
-00041c90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00041ca0: 6f6d 7061 7265 2065 6163 6820 524f 4920  ompare each ROI 
-00041cb0: 696e 2074 6869 7320 7374 7275 6374 7572  in this structur
-00041cc0: 6520 7365 7420 746f 2074 6865 2063 6f6e  e set to the con
-00041cd0: 7365 6e73 7573 206f 660a 2020 2020 2020  sensus of.      
-00041ce0: 2020 2020 2020 2020 2020 616c 6c20 524f            all RO
-00041cf0: 4973 2069 6e20 7468 6520 6f74 6865 7220  Is in the other 
-00041d00: 7374 7275 6374 7572 6520 7365 742e 2043  structure set. C
-00041d10: 6f6e 7365 6e73 7573 2074 7970 6520 6973  onsensus type is
-00041d20: 2073 6574 2076 6961 0a20 2020 2020 2020   set via.       
-00041d30: 2020 2020 2020 2020 2074 6865 2063 6f6e           the con
-00041d40: 7365 6e73 7573 5f74 7970 6520 6172 6775  sensus_type argu
-00041d50: 6d65 6e74 2e0a 2020 2020 2020 2020 2020  ment..          
-00041d60: 2020 2020 2020 2d20 2261 7574 6f22 203a        - "auto" :
-00041d70: 2069 6620 6f74 6865 723d 4e6f 6e65 2c20   if other=None, 
-00041d80: 7573 6520 2261 6c6c 2220 636f 6d70 6172  use "all" compar
-00041d90: 6973 6f6e 2e20 4f74 6865 7277 6973 652c  ison. Otherwise,
-00041da0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00041db0: 2020 6669 7273 7420 6c6f 6f6b 2066 6f72    first look for
-00041dc0: 2061 6e79 2052 4f49 7320 7769 7468 206d   any ROIs with m
-00041dd0: 6174 6368 696e 6720 6e61 6d65 733b 2069  atching names; i
-00041de0: 6620 6174 206c 6561 7374 206f 6e65 200a  f at least one .
-00041df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041e00: 6d61 7463 6869 6e67 2070 6169 7220 6973  matching pair is
-00041e10: 2066 6f75 6e64 2c20 636f 6d70 6172 6520   found, compare 
-00041e20: 7669 6120 7468 6520 2262 795f 6e61 6d65  via the "by_name
-00041e30: 2220 636f 6d70 6172 6973 6f6e 200a 2020  " comparison .  
-00041e40: 2020 2020 2020 2020 2020 2020 2020 7479                ty
-00041e50: 7065 2e20 4966 206e 6f20 6d61 7463 6865  pe. If no matche
-00041e60: 7320 6172 6520 666f 756e 642c 2063 6f6d  s are found, com
-00041e70: 7061 7265 2076 6961 2074 6865 2022 616c  pare via the "al
-00041e80: 6c22 2063 6f6d 7061 7269 736f 6e20 0a20  l" comparison . 
-00041e90: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00041ea0: 7970 652e 0a0a 2020 2020 2020 2020 636f  ype...        co
-00041eb0: 6e73 656e 7375 735f 7479 7065 203a 2073  nsensus_type : s
-00041ec0: 7472 2c20 6465 6661 756c 743d 226d 616a  tr, default="maj
-00041ed0: 6f72 6974 7920 766f 7465 220a 2020 2020  ority vote".    
-00041ee0: 2020 2020 2020 2020 4d65 7468 6f64 2066          Method f
-00041ef0: 6f72 2063 616c 6375 6c61 7469 6e67 2063  or calculating c
-00041f00: 6f6e 7365 6e73 7573 206f 6620 524f 4973  onsensus of ROIs
-00041f10: 2069 6620 7573 696e 6720 7468 6520 2263   if using the "c
-00041f20: 6f6e 7365 6e73 7573 220a 2020 2020 2020  onsensus".      
-00041f30: 2020 2020 2020 636f 6d70 6172 6973 6f6e        comparison
-00041f40: 2074 7970 652e 204f 7074 696f 6e73 2061   type. Options a
-00041f50: 7265 3a0a 0a20 2020 2020 2020 2020 2020  re:..           
-00041f60: 2020 2020 202d 2022 6d61 6a6f 7269 7479       - "majority
-00041f70: 2220 3a20 7573 6520 6d61 6a6f 7269 7479  " : use majority
-00041f80: 2076 6f74 6520 6f66 2052 4f49 7320 2869   vote of ROIs (i
-00041f90: 2e65 2e20 766f 7865 6c73 2077 6865 7265  .e. voxels where
-00041fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00041fb0: 2061 7420 6c65 6173 7420 6861 6c66 206f   at least half o
-00041fc0: 6620 7468 6520 524f 4973 2065 7869 7374  f the ROIs exist
-00041fd0: 292e 0a20 2020 2020 2020 2020 2020 2020  )..             
-00041fe0: 2020 202d 2022 6f76 6572 6c61 7022 203a     - "overlap" :
-00041ff0: 2075 7365 206f 7665 726c 6170 206f 6620   use overlap of 
-00042000: 524f 4973 2e0a 2020 2020 2020 2020 2020  ROIs..          
-00042010: 2020 2020 2020 2d20 2273 756d 2220 3a20        - "sum" : 
-00042020: 7573 6520 7375 6d20 6f66 2052 4f49 732e  use sum of ROIs.
-00042030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00042040: 202d 2022 7374 6170 6c65 2220 3a20 7573   - "staple" : us
-00042050: 6520 7468 6520 5354 4150 4c45 2061 6c67  e the STAPLE alg
-00042060: 6f72 6974 686d 2074 6f20 6361 6c63 756c  orithm to calcul
-00042070: 6174 6520 636f 6e73 656e 7375 732e 0a0a  ate consensus...
-00042080: 2020 2020 2020 2020 6874 6d6c 203a 2062          html : b
-00042090: 6f6f 6c2c 2064 6566 6175 6c74 3d46 616c  ool, default=Fal
-000420a0: 7365 0a20 2020 2020 2020 2020 2020 2049  se.            I
-000420b0: 6620 5472 7565 2c20 7468 6520 7461 626c  f True, the tabl
-000420c0: 6520 7769 6c6c 2062 6520 636f 6e76 6572  e will be conver
-000420d0: 7465 6420 746f 2048 544d 4c20 7465 7874  ted to HTML text
-000420e0: 2063 6f6c 6f72 2d63 6f64 6564 2062 6173   color-coded bas
-000420f0: 6564 0a20 2020 2020 2020 2020 2020 206f  ed.            o
-00042100: 6e20 524f 4920 636f 6c6f 7273 2e0a 0a20  n ROI colors... 
-00042110: 2020 2020 2020 2067 7265 7965 645f 6f75         greyed_ou
-00042120: 7420 3a20 626f 6f6c 2c20 6465 6661 756c  t : bool, defaul
-00042130: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-00042140: 2020 204c 6973 7420 6f66 2052 4f49 7320     List of ROIs 
-00042150: 7468 6174 2073 686f 756c 6420 6265 2067  that should be g
-00042160: 7265 7965 6420 6f75 7420 2867 6976 656e  reyed out (given
-00042170: 2061 2067 7265 7920 6261 636b 6772 6f75   a grey backgrou
-00042180: 6e64 0a20 2020 2020 2020 2020 2020 2074  nd.            t
-00042190: 6f20 7468 6569 7220 7465 7874 2920 6966  o their text) if
-000421a0: 2072 6574 7572 6e69 6e67 2061 6e20 4854   returning an HT
-000421b0: 4d4c 2073 7472 696e 672e 0a0a 2020 2020  ML string...    
-000421c0: 2020 2020 602a 2a60 6b77 6172 6773 203a      `**`kwargs :
-000421d0: 200a 2020 2020 2020 2020 2020 2020 4b65   .            Ke
-000421e0: 7977 6f72 6420 6172 6773 2074 6f20 7061  yword args to pa
-000421f0: 7373 2074 6f20 524f 492e 6765 745f 636f  ss to ROI.get_co
-00042200: 6d70 6172 6973 6f6e 2829 2e20 5365 6520  mparison(). See 
-00042210: 0a20 2020 2020 2020 2020 2020 2052 4f49  .            ROI
-00042220: 2e67 6574 5f63 6f6d 7061 7269 736f 6e28  .get_comparison(
-00042230: 2920 646f 6375 6d65 6e74 6174 696f 6e20  ) documentation 
-00042240: 666f 7220 6465 7461 696c 732e 0a20 2020  for details..   
-00042250: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00042260: 2020 6466 7320 3d20 5b5d 0a0a 2020 2020    dfs = []..    
-00042270: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00042280: 6528 6f74 6865 722c 2052 4f49 293a 0a20  e(other, ROI):. 
-00042290: 2020 2020 2020 2020 2020 2070 6169 7273             pairs
-000422a0: 203d 205b 2872 6f69 2c20 6f74 6865 7229   = [(roi, other)
-000422b0: 2066 6f72 2072 6f69 2069 6e20 7365 6c66   for roi in self
-000422c0: 2e67 6574 5f72 6f69 7328 6967 6e6f 7265  .get_rois(ignore
-000422d0: 5f65 6d70 7479 3d54 7275 6529 5d0a 2020  _empty=True)].  
-000422e0: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-000422f0: 7461 6e63 6528 6f74 6865 722c 2053 7472  tance(other, Str
-00042300: 7563 7475 7265 5365 7429 206f 7220 6f74  uctureSet) or ot
-00042310: 6865 7220 6973 204e 6f6e 653a 0a20 2020  her is None:.   
-00042320: 2020 2020 2020 2020 2070 6169 7273 203d           pairs =
-00042330: 2073 656c 662e 6765 745f 636f 6d70 6172   self.get_compar
-00042340: 6973 6f6e 5f70 6169 7273 286f 7468 6572  ison_pairs(other
-00042350: 2c20 636f 6d70 5f74 7970 652c 2063 6f6e  , comp_type, con
-00042360: 7365 6e73 7573 5f74 7970 6529 0a20 2020  sensus_type).   
-00042370: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00042380: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-00042390: 6545 7272 6f72 2822 3c6f 7468 6572 3e20  eError("<other> 
-000423a0: 6d75 7374 2062 6520 524f 4920 6f72 2053  must be ROI or S
-000423b0: 7472 7563 7475 7265 5365 7421 2229 0a0a  tructureSet!")..
-000423c0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-000423d0: 6f6d 7061 7265 5f72 6f69 5f70 6169 7273  ompare_roi_pairs
-000423e0: 2870 6169 7273 2c20 2a2a 6b77 6172 6773  (pairs, **kwargs
-000423f0: 290a 0a20 2020 2064 6566 2067 6574 5f63  )..    def get_c
-00042400: 6f6d 7061 7269 736f 6e5f 7061 6972 7328  omparison_pairs(
-00042410: 7365 6c66 2c20 6f74 6865 723d 4e6f 6e65  self, other=None
-00042420: 2c20 636f 6d70 5f74 7970 653d 2261 7574  , comp_type="aut
-00042430: 6f22 2c20 0a20 2020 2020 2020 2020 2020  o", .           
-00042440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042450: 2020 636f 6e73 656e 7375 735f 7479 7065    consensus_type
-00042460: 3d22 6d61 6a6f 7269 7479 222c 200a 2020  ="majority", .  
-00042470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042480: 2020 2020 2020 2020 2020 2063 6f6e 7365             conse
-00042490: 6e73 7573 5f63 6f6c 6f72 3d22 626c 7565  nsus_color="blue
-000424a0: 2229 3a0a 2020 2020 2020 2020 2222 2247  "):.        """G
-000424b0: 6574 206c 6973 7420 6f66 2052 4f49 7320  et list of ROIs 
-000424c0: 746f 2063 6f6d 7061 7265 2077 6974 6820  to compare with 
-000424d0: 6f6e 6520 616e 6f74 6865 722e 2222 220a  one another.""".
-000424e0: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
-000424f0: 2063 6f6d 705f 7479 7065 2069 7320 7661   comp_type is va
-00042500: 6c69 640a 2020 2020 2020 2020 7661 6c69  lid.        vali
-00042510: 645f 636f 6d70 5f74 7970 6573 203d 205b  d_comp_types = [
-00042520: 2261 6c6c 222c 2022 6279 5f6e 616d 6522  "all", "by_name"
-00042530: 2c20 2263 6f6e 7365 6e73 7573 222c 2022  , "consensus", "
-00042540: 6175 746f 225d 0a20 2020 2020 2020 2069  auto"].        i
-00042550: 6620 636f 6d70 5f74 7970 6520 6e6f 7420  f comp_type not 
-00042560: 696e 2076 616c 6964 5f63 6f6d 705f 7479  in valid_comp_ty
-00042570: 7065 733a 0a20 2020 2020 2020 2020 2020  pes:.           
-00042580: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00042590: 7228 6622 556e 7265 636f 676e 6973 6564  r(f"Unrecognised
-000425a0: 2063 6f6d 7061 7269 736f 6e20 7479 7065   comparison type
-000425b0: 207b 636f 6d70 5f74 7970 657d 2229 0a0a   {comp_type}")..
-000425c0: 2020 2020 2020 2020 2320 436f 6e73 656e          # Consen
-000425d0: 7375 7320 636f 6d70 6172 6973 6f6e 0a20  sus comparison. 
-000425e0: 2020 2020 2020 2069 6620 636f 6d70 5f74         if comp_t
-000425f0: 7970 6520 3d3d 2022 636f 6e73 656e 7375  ype == "consensu
-00042600: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
-00042610: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-00042620: 6620 636f 6d70 6172 696e 6720 746f 2061  f comparing to a
-00042630: 6e6f 7468 6572 2053 7472 7563 7475 7265  nother Structure
-00042640: 5365 742c 2074 616b 6520 636f 6e73 656e  Set, take consen
-00042650: 7375 7320 6f66 2074 6861 7420 0a20 2020  sus of that .   
-00042660: 2020 2020 2020 2020 2023 2065 6e74 6972           # entir
-00042670: 6520 5374 7275 6374 7572 6553 6574 0a20  e StructureSet. 
-00042680: 2020 2020 2020 2020 2020 2069 6620 6f74             if ot
-00042690: 6865 7220 6973 206e 6f74 204e 6f6e 653a  her is not None:
-000426a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000426b0: 2063 6f6e 7365 6e73 7573 203d 206f 7468   consensus = oth
-000426c0: 6572 2e67 6574 5f63 6f6e 7365 6e73 7573  er.get_consensus
-000426d0: 2863 6f6e 7365 6e73 7573 5f74 7970 652c  (consensus_type,
-000426e0: 2063 6f6c 6f72 3d63 6f6e 7365 6e73 7573   color=consensus
-000426f0: 5f63 6f6c 6f72 290a 2020 2020 2020 2020  _color).        
-00042700: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00042710: 2872 6f69 2c20 636f 6e73 656e 7375 7329  (roi, consensus)
-00042720: 2066 6f72 2072 6f69 2069 6e20 7365 6c66   for roi in self
-00042730: 2e67 6574 5f72 6f69 7328 6967 6e6f 7265  .get_rois(ignore
-00042740: 5f65 6d70 7479 3d54 7275 6529 5d0a 0a20  _empty=True)].. 
-00042750: 2020 2020 2020 2020 2020 2023 204f 7468             # Oth
-00042760: 6572 7769 7365 2c20 636f 6d70 6172 6520  erwise, compare 
-00042770: 6561 6368 2052 4f49 2074 6f20 636f 6e73  each ROI to cons
-00042780: 656e 7375 7320 6f66 206f 7468 6572 730a  ensus of others.
-00042790: 2020 2020 2020 2020 2020 2020 7061 6972              pair
-000427a0: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
-000427b0: 2020 2066 6f72 2072 6f69 2069 6e20 7365     for roi in se
-000427c0: 6c66 2e67 6574 5f72 6f69 7328 6967 6e6f  lf.get_rois(igno
-000427d0: 7265 5f65 6d70 7479 3d54 7275 6529 3a0a  re_empty=True):.
-000427e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000427f0: 7061 6972 732e 6170 7065 6e64 2828 726f  pairs.append((ro
-00042800: 692c 2073 656c 662e 6765 745f 636f 6e73  i, self.get_cons
-00042810: 656e 7375 7328 636f 6e73 656e 7375 735f  ensus(consensus_
-00042820: 7479 7065 2c20 0a20 2020 2020 2020 2020  type, .         
-00042830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042850: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-00042860: 6f72 3d63 6f6e 7365 6e73 7573 5f63 6f6c  or=consensus_col
-00042870: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-00042880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000428a0: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
-000428b0: 653d 726f 692e 6e61 6d65 2929 290a 2020  e=roi.name))).  
-000428c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000428d0: 2070 6169 7273 0a0a 2020 2020 2020 2020   pairs..        
-000428e0: 2320 5365 7420 6465 6661 756c 7420 6265  # Set default be
-000428f0: 6861 7669 6f75 7220 746f 2022 616c 6c22  haviour to "all"
-00042900: 2069 6620 6f74 6865 7220 6973 204e 6f6e   if other is Non
-00042910: 650a 2020 2020 2020 2020 6966 206f 7468  e.        if oth
-00042920: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
-00042930: 2020 2020 2020 2020 6f74 6865 7220 3d20          other = 
-00042940: 7365 6c66 0a20 2020 2020 2020 2020 2020  self.           
-00042950: 2069 6620 636f 6d70 5f74 7970 6520 3d3d   if comp_type ==
-00042960: 2022 6175 746f 223a 0a20 2020 2020 2020   "auto":.       
-00042970: 2020 2020 2020 2020 2063 6f6d 705f 7479           comp_ty
-00042980: 7065 203d 2022 616c 6c22 0a0a 2020 2020  pe = "all"..    
-00042990: 2020 2020 2320 4368 6563 6b20 666f 7220      # Check for 
-000429a0: 524f 4973 2077 6974 6820 6d61 7463 6869  ROIs with matchi
-000429b0: 6e67 206e 616d 6573 2069 6620 7573 696e  ng names if usin
-000429c0: 6720 2261 7574 6f22 206f 7220 2262 795f  g "auto" or "by_
-000429d0: 6e61 6d65 220a 2020 2020 2020 2020 6d61  name".        ma
-000429e0: 7463 6865 7320 3d20 5b5d 0a20 2020 2020  tches = [].     
-000429f0: 2020 2069 6620 636f 6d70 5f74 7970 6520     if comp_type 
-00042a00: 696e 205b 2261 7574 6f22 2c20 2262 795f  in ["auto", "by_
-00042a10: 6e61 6d65 225d 3a0a 2020 2020 2020 2020  name"]:.        
-00042a20: 2020 2020 6d61 7463 6865 7320 3d20 5b0a      matches = [.
-00042a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042a40: 7320 666f 7220 7320 696e 2073 656c 662e  s for s in self.
-00042a50: 6765 745f 726f 695f 6e61 6d65 7328 6967  get_roi_names(ig
-00042a60: 6e6f 7265 5f65 6d70 7479 3d54 7275 6529  nore_empty=True)
-00042a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00042a80: 2069 6620 7320 696e 206f 7468 6572 2e67   if s in other.g
-00042a90: 6574 5f72 6f69 5f6e 616d 6573 2869 676e  et_roi_names(ign
-00042aa0: 6f72 655f 656d 7074 793d 5472 7565 290a  ore_empty=True).
-00042ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042ac0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
-00042ad0: 206c 656e 286d 6174 6368 6573 2920 6f72   len(matches) or
-00042ae0: 2063 6f6d 705f 7479 7065 203d 3d20 2262   comp_type == "b
-00042af0: 795f 6e61 6d65 223a 0a20 2020 2020 2020  y_name":.       
-00042b00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00042b10: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-00042b20: 2020 2020 2020 2873 656c 662e 6765 745f        (self.get_
-00042b30: 726f 6928 6e61 6d65 292c 206f 7468 6572  roi(name), other
-00042b40: 2e67 6574 5f72 6f69 286e 616d 6529 2920  .get_roi(name)) 
-00042b50: 666f 7220 6e61 6d65 2069 6e20 6d61 7463  for name in matc
-00042b60: 6865 730a 2020 2020 2020 2020 2020 2020  hes.            
-00042b70: 2020 2020 5d0a 0a20 2020 2020 2020 2023      ]..        #
-00042b80: 204f 7468 6572 7769 7365 2c20 7061 6972   Otherwise, pair
-00042b90: 2065 6163 6820 524f 4920 7769 7468 2065   each ROI with e
-00042ba0: 7665 7279 206f 7468 6572 2028 6578 6c63  very other (exlc
-00042bb0: 7564 696e 6720 7061 6972 7320 6f66 2074  uding pairs of t
-00042bc0: 6865 2073 616d 650a 2020 2020 2020 2020  he same.        
-00042bd0: 2320 524f 4929 0a20 2020 2020 2020 2070  # ROI).        p
-00042be0: 6169 7273 203d 205b 5d0a 2020 2020 2020  airs = [].      
-00042bf0: 2020 666f 7220 726f 6931 2069 6e20 7365    for roi1 in se
-00042c00: 6c66 2e67 6574 5f72 6f69 7328 6967 6e6f  lf.get_rois(igno
-00042c10: 7265 5f65 6d70 7479 3d54 7275 6529 3a0a  re_empty=True):.
-00042c20: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00042c30: 726f 6932 2069 6e20 6f74 6865 722e 6765  roi2 in other.ge
-00042c40: 745f 726f 6973 2869 676e 6f72 655f 656d  t_rois(ignore_em
-00042c50: 7074 793d 5472 7565 293a 0a20 2020 2020  pty=True):.     
-00042c60: 2020 2020 2020 2020 2020 2069 6620 726f             if ro
-00042c70: 6931 2069 7320 6e6f 7420 726f 6932 2061  i1 is not roi2 a
-00042c80: 6e64 2028 726f 6932 2c20 726f 6931 2920  nd (roi2, roi1) 
-00042c90: 6e6f 7420 696e 2070 6169 7273 3a0a 2020  not in pairs:.  
-00042ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042cb0: 2020 7061 6972 732e 6170 7065 6e64 2828    pairs.append((
-00042cc0: 726f 6931 2c20 726f 6932 2929 0a0a 2020  roi1, roi2))..  
-00042cd0: 2020 2020 2020 7265 7475 726e 2070 6169        return pai
-00042ce0: 7273 0a0a 2020 2020 6465 6620 6765 745f  rs..    def get_
-00042cf0: 6d69 645f 6964 7828 7365 6c66 2c20 7669  mid_idx(self, vi
-00042d00: 6577 3d22 782d 7922 293a 0a20 2020 2020  ew="x-y"):.     
-00042d10: 2020 2022 2222 5265 7475 726e 2074 6865     """Return the
-00042d20: 2061 7272 6179 2069 6e64 6578 206f 6620   array index of 
-00042d30: 7468 6520 736c 6963 6520 7468 6174 2063  the slice that c
-00042d40: 6f6e 7461 696e 7320 7468 6520 6d6f 7374  ontains the most
-00042d50: 2052 4f49 732e 2222 220a 0a20 2020 2020   ROIs."""..     
-00042d60: 2020 2069 6e64 6963 6573 203d 205b 5d0a     indices = [].
-00042d70: 2020 2020 2020 2020 666f 7220 726f 6920          for roi 
-00042d80: 696e 2073 656c 662e 6765 745f 726f 6973  in self.get_rois
-00042d90: 2869 676e 6f72 655f 656d 7074 793d 5472  (ignore_empty=Tr
-00042da0: 7565 293a 0a20 2020 2020 2020 2020 2020  ue):.           
-00042db0: 2069 6e64 6963 6573 2e65 7874 656e 6428   indices.extend(
-00042dc0: 726f 692e 6765 745f 696e 6469 6365 7328  roi.get_indices(
-00042dd0: 7669 6577 2929 0a20 2020 2020 2020 2072  view)).        r
-00042de0: 6574 7572 6e20 6e70 2e62 696e 636f 756e  eturn np.bincoun
-00042df0: 7428 696e 6469 6365 7329 2e61 7267 6d61  t(indices).argma
-00042e00: 7828 290a 0a20 2020 2064 6566 2070 6c6f  x()..    def plo
-00042e10: 745f 636f 6d70 6172 6973 6f6e 7328 0a20  t_comparisons(. 
-00042e20: 2020 2020 2020 2073 656c 662c 206f 7468         self, oth
-00042e30: 6572 3d4e 6f6e 652c 2063 6f6d 705f 7479  er=None, comp_ty
-00042e40: 7065 3d22 6175 746f 222c 206f 7574 6469  pe="auto", outdi
-00042e50: 723d 4e6f 6e65 2c20 6c65 6765 6e64 3d54  r=None, legend=T
-00042e60: 7275 652c 200a 2020 2020 2020 2020 6e61  rue, .        na
-00042e70: 6d65 733d 4e6f 6e65 2c20 6c65 6765 6e64  mes=None, legend
-00042e80: 5f62 626f 785f 746f 5f61 6e63 686f 723d  _bbox_to_anchor=
-00042e90: 4e6f 6e65 2c20 6c65 6765 6e64 5f6c 6f63  None, legend_loc
-00042ea0: 3d22 6c6f 7765 7220 6c65 6674 222c 0a20  ="lower left",. 
-00042eb0: 2020 2020 2020 202a 2a6b 7761 7267 730a         **kwargs.
-00042ec0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-00042ed0: 2222 506c 6f74 2063 6f6d 7061 7269 736f  ""Plot compariso
-00042ee0: 6e20 7061 6972 732e 2222 220a 0a20 2020  n pairs."""..   
-00042ef0: 2020 2020 2069 6620 6f75 7464 6972 2061       if outdir a
-00042f00: 6e64 206e 6f74 206f 732e 7061 7468 2e65  nd not os.path.e
-00042f10: 7869 7374 7328 6f75 7464 6972 293a 0a20  xists(outdir):. 
-00042f20: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
-00042f30: 6b65 6469 7273 286f 7574 6469 7229 0a0a  kedirs(outdir)..
-00042f40: 2020 2020 2020 2020 666f 7220 726f 6931          for roi1
-00042f50: 2c20 726f 6932 2069 6e20 7365 6c66 2e67  , roi2 in self.g
-00042f60: 6574 5f63 6f6d 7061 7269 736f 6e5f 7061  et_comparison_pa
-00042f70: 6972 7328 6f74 6865 722c 2063 6f6d 705f  irs(other, comp_
-00042f80: 7479 7065 293a 0a0a 2020 2020 2020 2020  type):..        
-00042f90: 2020 2020 6f75 746e 616d 6520 3d20 4e6f      outname = No
-00042fa0: 6e65 0a20 2020 2020 2020 2020 2020 2069  ne.            i
-00042fb0: 6620 6f75 7464 6972 3a0a 2020 2020 2020  f outdir:.      
-00042fc0: 2020 2020 2020 2020 2020 636f 6d70 5f6e            comp_n
-00042fd0: 616d 6520 3d20 726f 6931 2e67 6574 5f63  ame = roi1.get_c
-00042fe0: 6f6d 7061 7269 736f 6e5f 6e61 6d65 2872  omparison_name(r
-00042ff0: 6f69 322c 2054 7275 6529 0a20 2020 2020  oi2, True).     
-00043000: 2020 2020 2020 2020 2020 206f 7574 6e61             outna
-00043010: 6d65 203d 206f 732e 7061 7468 2e6a 6f69  me = os.path.joi
-00043020: 6e28 6f75 7464 6972 2c20 6622 7b63 6f6d  n(outdir, f"{com
-00043030: 705f 6e61 6d65 7d2e 706e 6722 290a 0a20  p_name}.png").. 
-00043040: 2020 2020 2020 2020 2020 2069 6620 6e61             if na
-00043050: 6d65 7320 6973 204e 6f6e 6520 616e 6420  mes is None and 
-00043060: 726f 6931 2e6e 616d 6520 3d3d 2072 6f69  roi1.name == roi
-00043070: 322e 6e61 6d65 3a0a 2020 2020 2020 2020  2.name:.        
-00043080: 2020 2020 2020 2020 6e61 6d65 7320 3d20          names = 
-00043090: 5b73 656c 662e 6e61 6d65 2c20 6f74 6865  [self.name, othe
-000430a0: 722e 6e61 6d65 5d0a 0a20 2020 2020 2020  r.name]..       
-000430b0: 2020 2020 2072 6f69 312e 706c 6f74 5f63       roi1.plot_c
-000430c0: 6f6d 7061 7269 736f 6e28 0a20 2020 2020  omparison(.     
-000430d0: 2020 2020 2020 2020 2020 2072 6f69 322c             roi2,
-000430e0: 206c 6567 656e 643d 6c65 6765 6e64 2c20   legend=legend, 
-000430f0: 7361 7665 5f61 733d 6f75 746e 616d 652c  save_as=outname,
-00043100: 206e 616d 6573 3d6e 616d 6573 2c0a 2020   names=names,.  
-00043110: 2020 2020 2020 2020 2020 2020 2020 6c65                le
-00043120: 6765 6e64 5f62 626f 785f 746f 5f61 6e63  gend_bbox_to_anc
-00043130: 686f 723d 6c65 6765 6e64 5f62 626f 785f  hor=legend_bbox_
-00043140: 746f 5f61 6e63 686f 722c 0a20 2020 2020  to_anchor,.     
-00043150: 2020 2020 2020 2020 2020 206c 6567 656e             legen
-00043160: 645f 6c6f 633d 6c65 6765 6e64 5f6c 6f63  d_loc=legend_loc
-00043170: 2c20 2a2a 6b77 6172 6773 0a20 2020 2020  , **kwargs.     
-00043180: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00043190: 6620 706c 6f74 5f73 7572 6661 6365 5f64  f plot_surface_d
-000431a0: 6973 7461 6e63 6573 280a 2020 2020 2020  istances(.      
-000431b0: 2020 7365 6c66 2c20 6f74 6865 722c 206f    self, other, o
-000431c0: 7574 6469 723d 4e6f 6e65 2c20 7369 676e  utdir=None, sign
-000431d0: 6564 3d46 616c 7365 2c20 636f 6d70 5f74  ed=False, comp_t
-000431e0: 7970 653d 2261 7574 6f22 2c20 2a2a 6b77  ype="auto", **kw
-000431f0: 6172 6773 0a20 2020 2029 3a0a 2020 2020  args.    ):.    
-00043200: 2020 2020 2222 2250 6c6f 7420 7375 7266      """Plot surf
-00043210: 6163 6520 6469 7374 616e 6365 7320 666f  ace distances fo
-00043220: 7220 616c 6c20 524f 4920 7061 6972 732e  r all ROI pairs.
-00043230: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
-00043240: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
-00043250: 7473 286f 7574 6469 7229 3a0a 2020 2020  ts(outdir):.    
-00043260: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
-00043270: 6972 7328 6f75 7464 6972 290a 0a20 2020  irs(outdir)..   
-00043280: 2020 2020 2066 6f72 2072 6f69 312c 2072       for roi1, r
-00043290: 6f69 3220 696e 2073 656c 662e 6765 745f  oi2 in self.get_
-000432a0: 636f 6d70 6172 6973 6f6e 5f70 6169 7273  comparison_pairs
-000432b0: 286f 7468 6572 2c20 636f 6d70 5f74 7970  (other, comp_typ
-000432c0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-000432d0: 636f 6d70 5f6e 616d 6520 3d20 726f 6931  comp_name = roi1
-000432e0: 2e67 6574 5f63 6f6d 7061 7269 736f 6e5f  .get_comparison_
-000432f0: 6e61 6d65 2872 6f69 322c 2054 7275 6529  name(roi2, True)
-00043300: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00043310: 6f75 7464 6972 3a0a 2020 2020 2020 2020  outdir:.        
-00043320: 2020 2020 2020 2020 6f75 746e 616d 6520          outname 
-00043330: 3d20 6f73 2e70 6174 682e 6a6f 696e 286f  = os.path.join(o
-00043340: 7574 6469 722c 2066 227b 636f 6d70 5f6e  utdir, f"{comp_n
-00043350: 616d 657d 2e70 6e67 2229 0a20 2020 2020  ame}.png").     
-00043360: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00043370: 2020 2020 2020 2020 2020 2020 206f 7574               out
-00043380: 6e61 6d65 203d 204e 6f6e 650a 2020 2020  name = None.    
-00043390: 2020 2020 2020 2020 726f 6931 2e70 6c6f          roi1.plo
-000433a0: 745f 7375 7266 6163 655f 6469 7374 616e  t_surface_distan
-000433b0: 6365 7328 726f 6932 2c20 7369 676e 6564  ces(roi2, signed
-000433c0: 3d73 6967 6e65 642c 2073 6176 655f 6173  =signed, save_as
-000433d0: 3d6f 7574 6e61 6d65 2c20 2a2a 6b77 6172  =outname, **kwar
-000433e0: 6773 290a 0a20 2020 2064 6566 2077 7269  gs)..    def wri
-000433f0: 7465 2873 656c 662c 206f 7574 6e61 6d65  te(self, outname
-00043400: 3d4e 6f6e 652c 206f 7574 6469 723d 222e  =None, outdir=".
-00043410: 222c 2065 7874 3d4e 6f6e 652c 206f 7665  ", ext=None, ove
-00043420: 7277 7269 7465 3d46 616c 7365 2c0a 2020  rwrite=False,.  
-00043430: 2020 2020 2020 2020 2020 6865 6164 6572            header
-00043440: 5f73 6f75 7263 653d 4e6f 6e65 2c20 7061  _source=None, pa
-00043450: 7469 656e 745f 6964 3d4e 6f6e 652c 206d  tient_id=None, m
-00043460: 6f64 616c 6974 793d 4e6f 6e65 2c0a 2020  odality=None,.  
-00043470: 2020 2020 2020 2020 2020 726f 6f74 5f75            root_u
-00043480: 6964 3d4e 6f6e 652c 2076 6572 626f 7365  id=None, verbose
-00043490: 3d54 7275 652c 2068 6561 6465 725f 6578  =True, header_ex
-000434a0: 7472 6173 3d7b 7d2c 202a 2a6b 7761 7267  tras={}, **kwarg
-000434b0: 7329 3a0a 2020 2020 2020 2020 2222 2257  s):.        """W
-000434c0: 7269 7465 2074 6f20 6120 6469 636f 6d20  rite to a dicom 
-000434d0: 5374 7275 6374 7572 6553 6574 2066 696c  StructureSet fil
-000434e0: 6520 6f72 2064 6972 6563 746f 7279 206f  e or directory o
-000434f0: 6620 6e69 6674 6920 6669 6c65 732e 2222  f nifti files.""
-00043500: 220a 0a20 2020 2020 2020 2069 6620 6578  "..        if ex
-00043510: 7420 6973 206e 6f74 204e 6f6e 6520 616e  t is not None an
-00043520: 6420 6e6f 7420 6578 742e 7374 6172 7473  d not ext.starts
-00043530: 7769 7468 2822 2e22 293a 0a20 2020 2020  with("."):.     
-00043540: 2020 2020 2020 2065 7874 203d 2066 222e         ext = f".
-00043550: 7b65 7874 7d22 0a0a 2020 2020 2020 2020  {ext}"..        
-00043560: 2320 4368 6563 6b20 7768 6574 6865 7220  # Check whether 
-00043570: 746f 2077 7269 7465 2074 6f20 6469 636f  to write to dico
-00043580: 6d20 6669 6c65 0a20 2020 2020 2020 2069  m file.        i
-00043590: 6620 6973 696e 7374 616e 6365 286f 7574  f isinstance(out
-000435a0: 6e61 6d65 2c20 7374 7229 2061 6e64 206f  name, str) and o
-000435b0: 7574 6e61 6d65 2e65 6e64 7377 6974 6828  utname.endswith(
-000435c0: 222e 6463 6d22 293a 0a20 2020 2020 2020  ".dcm"):.       
-000435d0: 2020 2020 2065 7874 203d 2022 2e64 636d       ext = ".dcm
-000435e0: 220a 0a20 2020 2020 2020 2069 6620 6578  "..        if ex
-000435f0: 7420 3d3d 2022 2e64 636d 223a 0a20 2020  t == ".dcm":.   
-00043600: 2020 2020 2020 2020 2064 6963 6f6d 5f77           dicom_w
-00043610: 7269 7465 7220 3d20 4469 636f 6d57 7269  riter = DicomWri
-00043620: 7465 7228 0a20 2020 2020 2020 2020 2020  ter(.           
-00043630: 2020 2020 206f 7574 6469 723d 6f75 7464       outdir=outd
-00043640: 6972 2c0a 2020 2020 2020 2020 2020 2020  ir,.            
-00043650: 2020 2020 6461 7461 3d73 656c 662c 0a20      data=self,. 
-00043660: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00043670: 6666 696e 653d 4e6f 6e65 2c0a 2020 2020  ffine=None,.    
-00043680: 2020 2020 2020 2020 2020 2020 6f76 6572              over
-00043690: 7772 6974 653d 6f76 6572 7772 6974 652c  write=overwrite,
-000436a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000436b0: 2068 6561 6465 725f 736f 7572 6365 3d68   header_source=h
-000436c0: 6561 6465 725f 736f 7572 6365 2c0a 2020  eader_source,.  
-000436d0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-000436e0: 6965 6e74 6174 696f 6e3d 4e6f 6e65 2c0a  ientation=None,.
-000436f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043700: 7061 7469 656e 745f 6964 3d70 6174 6965  patient_id=patie
-00043710: 6e74 5f69 642c 0a20 2020 2020 2020 2020  nt_id,.         
-00043720: 2020 2020 2020 206d 6f64 616c 6974 793d         modality=
-00043730: 2752 5453 5452 5543 5427 2c0a 2020 2020  'RTSTRUCT',.    
-00043740: 2020 2020 2020 2020 2020 2020 726f 6f74              root
-00043750: 5f75 6964 3d72 6f6f 745f 7569 642c 0a20  _uid=root_uid,. 
-00043760: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00043770: 6561 6465 725f 6578 7472 6173 3d68 6561  eader_extras=hea
-00043780: 6465 725f 6578 7472 6173 2c0a 2020 2020  der_extras,.    
-00043790: 2020 2020 2020 2020 2020 2020 736f 7572              sour
-000437a0: 6365 5f74 7970 653d 7479 7065 2873 656c  ce_type=type(sel
-000437b0: 6629 2e5f 5f6e 616d 655f 5f2c 0a20 2020  f).__name__,.   
-000437c0: 2020 2020 2020 2020 2020 2020 206f 7574               out
-000437d0: 6e61 6d65 203d 206f 7574 6e61 6d65 2c0a  name = outname,.
-000437e0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-000437f0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00043800: 6963 6f6d 5f64 6174 6173 6574 203d 2064  icom_dataset = d
-00043810: 6963 6f6d 5f77 7269 7465 722e 7772 6974  icom_writer.writ
-00043820: 6528 290a 0a20 2020 2020 2020 2020 2020  e()..           
-00043830: 2069 6620 7665 7262 6f73 653a 0a20 2020   if verbose:.   
-00043840: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00043850: 6e74 2822 5772 6f74 6520 6469 636f 6d20  nt("Wrote dicom 
-00043860: 6669 6c65 2074 6f20 6469 7265 6374 6f72  file to director
-00043870: 793a 222c 206f 7574 6469 7229 0a20 2020  y:", outdir).   
-00043880: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00043890: 0a20 2020 2020 2020 2023 204f 7468 6572  .        # Other
-000438a0: 7769 7365 2c20 7772 6974 6520 746f 2069  wise, write to i
-000438b0: 6e64 6976 6964 7561 6c20 524f 4920 6669  ndividual ROI fi
-000438c0: 6c65 730a 2020 2020 2020 2020 6966 206e  les.        if n
-000438d0: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
-000438e0: 7328 6f75 7464 6972 293a 0a20 2020 2020  s(outdir):.     
-000438f0: 2020 2020 2020 206f 732e 6d61 6b65 6469         os.makedi
-00043900: 7273 286f 7574 6469 7229 0a20 2020 2020  rs(outdir).     
-00043910: 2020 2065 6c69 6620 6f76 6572 7772 6974     elif overwrit
-00043920: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00043930: 6875 7469 6c2e 726d 7472 6565 286f 7574  hutil.rmtree(out
-00043940: 6469 7229 0a20 2020 2020 2020 2020 2020  dir).           
-00043950: 206f 732e 6d6b 6469 7228 6f75 7464 6972   os.mkdir(outdir
-00043960: 290a 2020 2020 2020 2020 666f 7220 7320  ).        for s 
-00043970: 696e 2073 656c 662e 6765 745f 726f 6973  in self.get_rois
-00043980: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00043990: 732e 7772 6974 6528 6f75 7464 6972 3d6f  s.write(outdir=o
-000439a0: 7574 6469 722c 2065 7874 3d65 7874 2c20  utdir, ext=ext, 
-000439b0: 7665 7262 6f73 653d 7665 7262 6f73 652c  verbose=verbose,
-000439c0: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
-000439d0: 2020 2020 2020 200a 2020 2020 6465 6620         .    def 
-000439e0: 706c 6f74 280a 2020 2020 2020 2020 7365  plot(.        se
-000439f0: 6c66 2c0a 2020 2020 2020 2020 7669 6577  lf,.        view
-00043a00: 3d22 782d 7922 2c0a 2020 2020 2020 2020  ="x-y",.        
-00043a10: 706c 6f74 5f74 7970 653d 2263 6f6e 746f  plot_type="conto
-00043a20: 7572 222c 0a20 2020 2020 2020 2073 6c3d  ur",.        sl=
-00043a30: 4e6f 6e65 2c0a 2020 2020 2020 2020 6964  None,.        id
-00043a40: 783d 4e6f 6e65 2c0a 2020 2020 2020 2020  x=None,.        
-00043a50: 706f 733d 4e6f 6e65 2c0a 2020 2020 2020  pos=None,.      
-00043a60: 2020 6178 3d4e 6f6e 652c 0a20 2020 2020    ax=None,.     
-00043a70: 2020 206f 7061 6369 7479 3d4e 6f6e 652c     opacity=None,
-00043a80: 0a20 2020 2020 2020 206c 696e 6577 6964  .        linewid
-00043a90: 7468 3d4e 6f6e 652c 0a20 2020 2020 2020  th=None,.       
-00043aa0: 2069 6e63 6c75 6465 5f69 6d61 6765 3d54   include_image=T
-00043ab0: 7275 652c 0a20 2020 2020 2020 2063 656e  rue,.        cen
-00043ac0: 7472 655f 6f6e 5f72 6f69 3d4e 6f6e 652c  tre_on_roi=None,
-00043ad0: 0a20 2020 2020 2020 2073 686f 773d 5472  .        show=Tr
-00043ae0: 7565 2c0a 2020 2020 2020 2020 7361 7665  ue,.        save
-00043af0: 5f61 733d 4e6f 6e65 2c0a 2020 2020 2020  _as=None,.      
-00043b00: 2020 6c65 6765 6e64 3d46 616c 7365 2c0a    legend=False,.
-00043b10: 2020 2020 2020 2020 6c65 6765 6e64 5f62          legend_b
-00043b20: 626f 785f 746f 5f61 6e63 686f 723d 4e6f  box_to_anchor=No
-00043b30: 6e65 2c0a 2020 2020 2020 2020 6c65 6765  ne,.        lege
-00043b40: 6e64 5f6c 6f63 3d22 6c6f 7765 7220 6c65  nd_loc="lower le
-00043b50: 6674 222c 0a20 2020 2020 2020 2063 6f6e  ft",.        con
-00043b60: 7365 6e73 7573 5f74 7970 653d 4e6f 6e65  sensus_type=None
-00043b70: 2c0a 2020 2020 2020 2020 6578 636c 7564  ,.        exclud
-00043b80: 655f 6672 6f6d 5f63 6f6e 7365 6e73 7573  e_from_consensus
-00043b90: 3d4e 6f6e 652c 0a20 2020 2020 2020 2063  =None,.        c
-00043ba0: 6f6e 7365 6e73 7573 5f63 6f6c 6f72 3d22  onsensus_color="
-00043bb0: 626c 7565 222c 0a20 2020 2020 2020 2063  blue",.        c
-00043bc0: 6f6e 7365 6e73 7573 5f6c 696e 6577 6964  onsensus_linewid
-00043bd0: 7468 3d4e 6f6e 652c 0a20 2020 2020 2020  th=None,.       
-00043be0: 202a 2a6b 7761 7267 732c 0a20 2020 2029   **kwargs,.    )
-00043bf0: 3a0a 2020 2020 2020 2020 2222 2250 6c6f  :.        """Plo
-00043c00: 7420 7468 6520 524f 4973 2069 6e20 7468  t the ROIs in th
-00043c10: 6973 2073 7472 7563 7475 7265 2073 6574  is structure set
-00043c20: 2e0a 2020 2020 2020 200a 2020 2020 2020  ..       .      
-00043c30: 2020 4966 2063 6f6e 7365 6e73 7573 5f74    If consensus_t
-00043c40: 7970 6520 6973 2073 6574 2074 6f20 616e  ype is set to an
-00043c50: 7920 6f66 2027 6d61 6a6f 7269 7479 272c  y of 'majority',
-00043c60: 2027 7375 6d27 2c20 276f 7665 726c 6170   'sum', 'overlap
-00043c70: 272c 206f 7220 2773 7461 706c 6527 2c0a  ', or 'staple',.
-00043c80: 2020 2020 2020 2020 7468 6520 636f 6e65          the cone
-00043c90: 6e73 7573 2063 6f6e 746f 7572 2077 696c  nsus contour wil
-00043ca0: 6c20 6265 2070 6c6f 7474 6564 2072 6174  l be plotted rat
-00043cb0: 6865 7220 7468 616e 2069 6e64 6976 6964  her than individ
-00043cc0: 7561 6c20 524f 4973 2e20 4966 0a20 2020  ual ROIs. If.   
-00043cd0: 2020 2020 2027 6578 636c 7564 655f 6672       'exclude_fr
-00043ce0: 6f6d 5f63 6f6e 7365 6e73 7573 2720 6973  om_consensus' is
-00043cf0: 2073 6574 2074 6f20 7468 6520 6e61 6d65   set to the name
-00043d00: 206f 6620 616e 2052 4f49 2c20 7468 6174   of an ROI, that
-00043d10: 2052 4f49 2077 696c 6c0a 2020 2020 2020   ROI will.      
-00043d20: 2020 6265 2065 7863 6c75 6465 6420 6672    be excluded fr
-00043d30: 6f6d 2074 6865 2063 6f6e 7365 6e73 7573  om the consensus
-00043d40: 2063 616c 6375 6c61 7469 6f6e 2061 6e64   calculation and
-00043d50: 2070 6c6f 7474 6564 2069 6e64 6976 6964   plotted individ
-00043d60: 7561 6c6c 792e 0a20 2020 2020 2020 2022  ually..        "
-00043d70: 2222 0a0a 2020 2020 2020 2020 2320 4966  ""..        # If
-00043d80: 206e 6f20 736c 2f69 6478 2f70 6f73 2067   no sl/idx/pos g
-00043d90: 6976 656e 2c20 7573 6520 7468 6520 736c  iven, use the sl
-00043da0: 6963 6520 7769 7468 2074 6865 206d 6f73  ice with the mos
-00043db0: 7420 524f 4973 0a20 2020 2020 2020 2069  t ROIs.        i
-00043dc0: 6620 736c 2069 7320 4e6f 6e65 2061 6e64  f sl is None and
-00043dd0: 2069 6478 2069 7320 4e6f 6e65 2061 6e64   idx is None and
-00043de0: 2070 6f73 2069 7320 4e6f 6e65 3a0a 2020   pos is None:.  
-00043df0: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
-00043e00: 7365 6c66 2e67 6574 5f6d 6964 5f69 6478  self.get_mid_idx
-00043e10: 2876 6965 7729 0a0a 2020 2020 2020 2020  (view)..        
-00043e20: 6966 2070 6c6f 745f 7479 7065 2069 7320  if plot_type is 
-00043e30: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00043e40: 2020 706c 6f74 5f74 7970 6520 3d20 6b77    plot_type = kw
-00043e50: 6172 6773 2e67 6574 2822 726f 695f 706c  args.get("roi_pl
-00043e60: 6f74 5f74 7970 6522 2c20 7365 6c66 2e64  ot_type", self.d
-00043e70: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
-00043e80: 6f64 290a 2020 2020 2020 2020 6b77 6172  od).        kwar
-00043e90: 6773 5b22 726f 695f 706c 6f74 5f74 7970  gs["roi_plot_typ
-00043ea0: 6522 5d20 3d20 706c 6f74 5f74 7970 650a  e"] = plot_type.
-00043eb0: 0a20 2020 2020 2020 2023 2045 6e73 7572  .        # Ensur
-00043ec0: 6520 7468 6174 206c 696e 6577 6964 7468  e that linewidth
-00043ed0: 2061 6e64 206f 7061 6369 7479 2066 6f72   and opacity for
-00043ee0: 2052 4f49 2070 6c6f 7474 696e 6720 6172   ROI plotting ar
-00043ef0: 6520 6465 6669 6e65 642e 0a20 2020 2020  e defined..     
-00043f00: 2020 2072 6f69 5f6b 7761 7267 7320 3d20     roi_kwargs = 
-00043f10: 7b7d 0a20 2020 2020 2020 2069 6620 6f70  {}.        if op
-00043f20: 6163 6974 7920 6973 204e 6f6e 653a 0a20  acity is None:. 
-00043f30: 2020 2020 2020 2020 2020 206f 7061 6369             opaci
-00043f40: 7479 203d 2030 2e33 2069 6620 2266 696c  ty = 0.3 if "fil
-00043f50: 6c65 6422 2069 6e20 706c 6f74 5f74 7970  led" in plot_typ
-00043f60: 6520 656c 7365 2031 0a20 2020 2020 2020  e else 1.       
-00043f70: 2072 6f69 5f6b 7761 7267 735b 226f 7061   roi_kwargs["opa
-00043f80: 6369 7479 225d 203d 206f 7061 6369 7479  city"] = opacity
-00043f90: 0a20 2020 2020 2020 2069 6620 6c69 6e65  .        if line
-00043fa0: 7769 6474 6820 6973 204e 6f6e 653a 0a20  width is None:. 
-00043fb0: 2020 2020 2020 2020 2020 206c 696e 6577             linew
-00043fc0: 6964 7468 203d 2064 6566 6175 6c74 5061  idth = defaultPa
-00043fd0: 7261 6d73 5b22 6c69 6e65 732e 6c69 6e65  rams["lines.line
-00043fe0: 7769 6474 6822 5d5b 305d 0a20 2020 2020  width"][0].     
-00043ff0: 2020 2072 6f69 5f6b 7761 7267 735b 226c     roi_kwargs["l
-00044000: 696e 6577 6964 7468 225d 203d 206c 696e  inewidth"] = lin
-00044010: 6577 6964 7468 0a0a 2020 2020 2020 2020  ewidth..        
-00044020: 2320 506c 6f74 2077 6974 6820 696d 6167  # Plot with imag
-00044030: 650a 2020 2020 2020 2020 6966 2069 6e63  e.        if inc
-00044040: 6c75 6465 5f69 6d61 6765 2061 6e64 2073  lude_image and s
-00044050: 656c 662e 696d 6167 6520 6973 206e 6f74  elf.image is not
-00044060: 204e 6f6e 653a 0a0a 2020 2020 2020 2020   None:..        
-00044070: 2020 2020 7365 6c66 2e69 6d61 6765 2e70      self.image.p
-00044080: 6c6f 7428 0a20 2020 2020 2020 2020 2020  lot(.           
-00044090: 2020 2020 2076 6965 772c 0a20 2020 2020       view,.     
-000440a0: 2020 2020 2020 2020 2020 2073 6c3d 736c             sl=sl
-000440b0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-000440c0: 2020 2069 6478 3d69 6478 2c0a 2020 2020     idx=idx,.    
-000440d0: 2020 2020 2020 2020 2020 2020 706f 733d              pos=
-000440e0: 706f 732c 0a20 2020 2020 2020 2020 2020  pos,.           
-000440f0: 2020 2020 2072 6f69 733d 7365 6c66 2c0a       rois=self,.
-00044100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044110: 726f 695f 6b77 6172 6773 3d72 6f69 5f6b  roi_kwargs=roi_k
-00044120: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
-00044130: 2020 2020 2020 2063 656e 7472 655f 6f6e         centre_on
-00044140: 5f72 6f69 3d63 656e 7472 655f 6f6e 5f72  _roi=centre_on_r
-00044150: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
-00044160: 2020 2020 7368 6f77 3d73 686f 772c 0a20      show=show,. 
-00044170: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00044180: 6176 655f 6173 3d73 6176 655f 6173 2c0a  ave_as=save_as,.
-00044190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000441a0: 6c65 6765 6e64 3d6c 6567 656e 642c 0a20  legend=legend,. 
-000441b0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000441c0: 6567 656e 645f 6262 6f78 5f74 6f5f 616e  egend_bbox_to_an
-000441d0: 6368 6f72 3d6c 6567 656e 645f 6262 6f78  chor=legend_bbox
-000441e0: 5f74 6f5f 616e 6368 6f72 2c0a 2020 2020  _to_anchor,.    
-000441f0: 2020 2020 2020 2020 2020 2020 6c65 6765              lege
-00044200: 6e64 5f6c 6f63 3d6c 6567 656e 645f 6c6f  nd_loc=legend_lo
-00044210: 632c 0a20 2020 2020 2020 2020 2020 2020  c,.             
-00044220: 2020 2063 6f6e 7365 6e73 7573 5f74 7970     consensus_typ
-00044230: 653d 636f 6e73 656e 7375 735f 7479 7065  e=consensus_type
-00044240: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00044250: 2020 6578 636c 7564 655f 6672 6f6d 5f63    exclude_from_c
-00044260: 6f6e 7365 6e73 7573 3d65 7863 6c75 6465  onsensus=exclude
-00044270: 5f66 726f 6d5f 636f 6e73 656e 7375 732c  _from_consensus,
-00044280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00044290: 2061 783d 6178 2c0a 2020 2020 2020 2020   ax=ax,.        
-000442a0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-000442b0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-000442c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000442d0: 6e0a 0a20 2020 2020 2020 2069 6620 6b77  n..        if kw
-000442e0: 6172 6773 2e67 6574 2822 7469 746c 6522  args.get("title"
-000442f0: 2c20 4e6f 6e65 2920 6973 204e 6f6e 653a  , None) is None:
-00044300: 0a20 2020 2020 2020 2020 2020 206b 7761  .            kwa
-00044310: 7267 735b 2274 6974 6c65 225d 203d 2073  rgs["title"] = s
-00044320: 656c 662e 6e61 6d65 0a0a 2020 2020 2020  elf.name..      
-00044330: 2020 2320 506c 6f74 2063 6f6e 7365 6e73    # Plot consens
-00044340: 7573 0a20 2020 2020 2020 2072 6f69 5f68  us.        roi_h
-00044350: 616e 646c 6573 203d 205b 5d0a 2020 2020  andles = [].    
-00044360: 2020 2020 6966 2063 6f6e 7365 6e73 7573      if consensus
-00044370: 5f74 7970 6520 6973 206e 6f74 204e 6f6e  _type is not Non
-00044380: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
-00044390: 2320 506c 6f74 2063 6f6e 7365 6e73 7573  # Plot consensus
-000443a0: 2063 6f6e 746f 7572 0a20 2020 2020 2020   contour.       
-000443b0: 2020 2020 2063 6f6e 7365 6e73 7573 203d       consensus =
-000443c0: 2073 656c 662e 6765 745f 636f 6e73 656e   self.get_consen
-000443d0: 7375 7328 636f 6e73 656e 7375 735f 7479  sus(consensus_ty
-000443e0: 7065 2c20 0a20 2020 2020 2020 2020 2020  pe, .           
-000443f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044410: 636f 6c6f 723d 636f 6e73 656e 7375 735f  color=consensus_
-00044420: 636f 6c6f 722c 0a20 2020 2020 2020 2020  color,.         
-00044430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044450: 2020 6578 636c 7564 653d 6578 636c 7564    exclude=exclud
-00044460: 655f 6672 6f6d 5f63 6f6e 7365 6e73 7573  e_from_consensus
-00044470: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-00044480: 6e73 656e 7375 735f 6b77 6172 6773 203d  nsensus_kwargs =
-00044490: 207b 7d20 6966 2065 7863 6c75 6465 5f66   {} if exclude_f
-000444a0: 726f 6d5f 636f 6e73 656e 7375 7320 6973  rom_consensus is
-000444b0: 206e 6f74 204e 6f6e 6520 5c0a 2020 2020   not None \.    
-000444c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000444d0: 656c 7365 206b 7761 7267 730a 2020 2020  else kwargs.    
-000444e0: 2020 2020 2020 2020 6966 2063 6f6e 7365          if conse
-000444f0: 6e73 7573 5f6c 696e 6577 6964 7468 2069  nsus_linewidth i
-00044500: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00044510: 2020 2020 2020 2020 636f 6e73 656e 7375          consensu
-00044520: 735f 6c69 6e65 7769 6474 6820 3d20 6465  s_linewidth = de
-00044530: 6661 756c 7450 6172 616d 735b 226c 696e  faultParams["lin
-00044540: 6573 2e6c 696e 6577 6964 7468 225d 5b30  es.linewidth"][0
-00044550: 5d20 2b20 310a 0a20 2020 2020 2020 2020  ] + 1..         
-00044560: 2020 2063 6f6e 7365 6e73 7573 2e70 6c6f     consensus.plo
-00044570: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00044580: 2020 2076 6965 772c 2073 6c3d 736c 2c20     view, sl=sl, 
-00044590: 6964 783d 6964 782c 2070 6f73 3d70 6f73  idx=idx, pos=pos
-000445a0: 2c20 706c 6f74 5f74 7970 653d 706c 6f74  , plot_type=plot
-000445b0: 5f74 7970 652c 200a 2020 2020 2020 2020  _type, .        
-000445c0: 2020 2020 2020 2020 636f 6c6f 723d 636f          color=co
-000445d0: 6e73 656e 7375 735f 636f 6c6f 722c 206c  nsensus_color, l
-000445e0: 696e 6577 6964 7468 3d63 6f6e 7365 6e73  inewidth=consens
-000445f0: 7573 5f6c 696e 6577 6964 7468 2c20 0a20  us_linewidth, . 
-00044600: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00044610: 7061 6369 7479 3d6f 7061 6369 7479 2c20  pacity=opacity, 
-00044620: 7368 6f77 3d46 616c 7365 2c20 6178 3d61  show=False, ax=a
-00044630: 782c 202a 2a63 6f6e 7365 6e73 7573 5f6b  x, **consensus_k
-00044640: 7761 7267 7329 0a0a 2020 2020 2020 2020  wargs)..        
-00044650: 2020 2020 7365 6c66 2e61 7820 3d20 636f      self.ax = co
-00044660: 6e73 656e 7375 732e 6178 0a20 2020 2020  nsensus.ax.     
-00044670: 2020 2020 2020 2073 656c 662e 6669 6720         self.fig 
-00044680: 3d20 636f 6e73 656e 7375 732e 6669 670a  = consensus.fig.
-00044690: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000446a0: 6c65 6765 6e64 3a0a 2020 2020 2020 2020  legend:.        
-000446b0: 2020 2020 2020 2020 726f 695f 6861 6e64          roi_hand
-000446c0: 6c65 732e 6170 7065 6e64 280a 2020 2020  les.append(.    
-000446d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000446e0: 2020 2020 636f 6e73 656e 7375 732e 6765      consensus.ge
-000446f0: 745f 7061 7463 6828 706c 6f74 5f74 7970  t_patch(plot_typ
-00044700: 652c 2063 6f6e 7365 6e73 7573 5f63 6f6c  e, consensus_col
-00044710: 6f72 2c20 6f70 6163 6974 792c 0a20 2020  or, opacity,.   
-00044720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044730: 2020 2020 2020 2020 206c 696e 6577 6964           linewid
-00044740: 7468 2c20 636f 6e73 656e 7375 732e 6e61  th, consensus.na
-00044750: 6d65 2929 0a0a 2020 2020 2020 2020 2020  me))..          
-00044760: 2020 2320 506c 6f74 2065 7863 6c75 6465    # Plot exclude
-00044770: 6420 524f 4920 6f6e 2074 6f70 0a20 2020  d ROI on top.   
-00044780: 2020 2020 2020 2020 2069 6620 6578 636c           if excl
-00044790: 7564 655f 6672 6f6d 5f63 6f6e 7365 6e73  ude_from_consens
-000447a0: 7573 2069 7320 6e6f 7420 4e6f 6e65 3a0a  us is not None:.
-000447b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000447c0: 6b77 6172 6773 5b22 696e 636c 7564 655f  kwargs["include_
-000447d0: 696d 6167 6522 5d20 3d20 4661 6c73 650a  image"] = False.
+0003dfb0: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
+0003dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dfd0: 2020 6966 2066 6e6d 6174 6368 2e66 6e6d    if fnmatch.fnm
+0003dfe0: 6174 6368 2873 2e6e 616d 652e 6c6f 7765  atch(s.name.lowe
+0003dff0: 7228 292c 206d 2e6c 6f77 6572 2829 293a  r(), m.lower()):
+0003e000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003e010: 2020 2020 2020 2020 2073 2e6e 616d 6520           s.name 
+0003e020: 3d20 6e61 6d65 0a20 2020 2020 2020 2020  = name.         
+0003e030: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0003e040: 616d 655f 6d61 7463 6865 6420 3d20 5472  ame_matched = Tr
+0003e050: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0003e060: 2020 2020 2020 2020 2020 2061 6c72 6561             alrea
+0003e070: 6479 5f72 656e 616d 6564 2e61 7070 656e  dy_renamed.appen
+0003e080: 6428 6929 0a20 2020 2020 2020 2020 2020  d(i).           
+0003e090: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0003e0a0: 6669 7273 745f 6d61 7463 685f 6f6e 6c79  first_match_only
+0003e0b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003e0c0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0003e0d0: 6561 6b0a 0a20 2020 2020 2020 2020 2020  eak..           
+0003e0e0: 2020 2020 2023 2049 6620 6669 7273 745f       # If first_
+0003e0f0: 6d61 7463 685f 6f6e 6c79 2c20 646f 6e27  match_only, don'
+0003e100: 7420 7265 6e61 6d65 206d 6f72 6520 7468  t rename more th
+0003e110: 616e 206f 6e65 2052 4f49 0a20 2020 2020  an one ROI.     
+0003e120: 2020 2020 2020 2020 2020 2023 2077 6974             # wit
+0003e130: 6820 7468 6973 206e 6577 206e 616d 650a  h this new name.
+0003e140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e150: 6966 206e 616d 655f 6d61 7463 6865 6420  if name_matched 
+0003e160: 616e 6420 6669 7273 745f 6d61 7463 685f  and first_match_
+0003e170: 6f6e 6c79 3a0a 2020 2020 2020 2020 2020  only:.          
+0003e180: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+0003e190: 0a20 2020 2020 2020 2023 204b 6565 7020  .        # Keep 
+0003e1a0: 6f6e 6c79 2074 6865 2072 656e 616d 6564  only the renamed
+0003e1b0: 2052 4f49 7320 6966 2072 6571 7565 7374   ROIs if request
+0003e1c0: 6564 0a20 2020 2020 2020 2069 6620 6b65  ed.        if ke
+0003e1d0: 6570 5f72 656e 616d 6564 5f6f 6e6c 793a  ep_renamed_only:
+0003e1e0: 0a20 2020 2020 2020 2020 2020 2072 656e  .            ren
+0003e1f0: 616d 6564 5f72 6f69 7320 3d20 5b73 656c  amed_rois = [sel
+0003e200: 662e 726f 6973 5b69 5d20 666f 7220 6920  f.rois[i] for i 
+0003e210: 696e 2061 6c72 6561 6479 5f72 656e 616d  in already_renam
+0003e220: 6564 5d0a 2020 2020 2020 2020 2020 2020  ed].            
+0003e230: 7365 6c66 2e72 6f69 7320 3d20 7265 6e61  self.rois = rena
+0003e240: 6d65 645f 726f 6973 0a0a 2020 2020 6465  med_rois..    de
+0003e250: 6620 6669 6c74 6572 5f72 6f69 7328 7365  f filter_rois(se
+0003e260: 6c66 2c20 746f 5f6b 6565 703d 4e6f 6e65  lf, to_keep=None
+0003e270: 2c20 746f 5f72 656d 6f76 653d 4e6f 6e65  , to_remove=None
+0003e280: 293a 0a20 2020 2020 2020 2022 2222 4b65  ):.        """Ke
+0003e290: 6570 206f 6e6c 7920 7468 6520 524f 4973  ep only the ROIs
+0003e2a0: 2069 6e20 7468 6520 746f 5f6b 6565 7020   in the to_keep 
+0003e2b0: 6c69 7374 2061 6e64 2072 656d 6f76 6520  list and remove 
+0003e2c0: 616e 7920 696e 2074 6865 0a20 2020 2020  any in the.     
+0003e2d0: 2020 2074 6f5f 7265 6d6f 7665 206c 6973     to_remove lis
+0003e2e0: 742e 0a0a 2020 2020 2020 2020 2a2a 5061  t...        **Pa
+0003e2f0: 7261 6d65 7465 7273 3a2a 2a0a 2020 2020  rameters:**.    
+0003e300: 2020 2020 0a0a 2020 2020 2020 2020 746f      ..        to
+0003e310: 5f6b 6565 7020 3a20 6c69 7374 2c20 6465  _keep : list, de
+0003e320: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+0003e330: 2020 2020 2020 204c 6973 7420 6f66 206e         List of n
+0003e340: 616d 6573 206f 6620 524f 4973 2074 6f20  ames of ROIs to 
+0003e350: 6b65 6570 2069 6e20 7468 6520 636f 7069  keep in the copi
+0003e360: 6564 2053 7472 7563 7475 7265 5365 743b  ed StructureSet;
+0003e370: 2061 6c6c 200a 2020 2020 2020 2020 2020   all .          
+0003e380: 2020 6f74 6865 7273 2077 696c 6c20 6265    others will be
+0003e390: 2072 656d 6f76 6564 2e20 5468 6573 6520   removed. These 
+0003e3a0: 6e61 6d65 7320 6361 6e20 616c 736f 2063  names can also c
+0003e3b0: 6f6e 7461 696e 2077 696c 6463 6172 6473  ontain wildcards
+0003e3c0: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+0003e3d0: 6820 7468 6520 272a 2720 7379 6d62 6f6c  h the '*' symbol
+0003e3e0: 2e20 0a0a 2020 2020 2020 2020 746f 5f72  . ..        to_r
+0003e3f0: 656d 6f76 6520 3a20 6c69 7374 2c20 6465  emove : list, de
+0003e400: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+0003e410: 2020 2020 2020 204c 6973 7420 6f66 206e         List of n
+0003e420: 616d 6573 206f 6620 524f 4973 2074 6f20  ames of ROIs to 
+0003e430: 7265 6d6f 7665 2066 726f 6d20 7468 6520  remove from the 
+0003e440: 636f 7069 6564 2053 7472 7563 7475 7265  copied Structure
+0003e450: 5365 743b 2061 6c6c 200a 2020 2020 2020  Set; all .      
+0003e460: 2020 2020 2020 6f74 6865 7273 2077 696c        others wil
+0003e470: 6c20 6265 2072 656d 6f76 6564 2e20 5468  l be removed. Th
+0003e480: 6573 6520 6e61 6d65 7320 6361 6e20 616c  ese names can al
+0003e490: 736f 2063 6f6e 7461 696e 2077 696c 6463  so contain wildc
+0003e4a0: 6172 6473 0a20 2020 2020 2020 2020 2020  ards.           
+0003e4b0: 2077 6974 6820 7468 6520 272a 2720 7379   with the '*' sy
+0003e4c0: 6d62 6f6c 2e20 4170 706c 6965 6420 6166  mbol. Applied af
+0003e4d0: 7465 7220 6669 6c74 6572 696e 6720 7769  ter filtering wi
+0003e4e0: 7468 203c 746f 5f6b 6565 703e 2e0a 2020  th <to_keep>..  
+0003e4f0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+0003e500: 2020 2023 2045 6e73 7572 6520 746f 5f6b     # Ensure to_k
+0003e510: 6565 7020 616e 6420 746f 5f72 656d 6f76  eep and to_remov
+0003e520: 6520 6172 6520 6c69 7374 730a 2020 2020  e are lists.    
+0003e530: 2020 2020 6966 2074 6f5f 6b65 6570 2069      if to_keep i
+0003e540: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0003e550: 2020 2020 746f 5f6b 6565 7020 3d20 7365      to_keep = se
+0003e560: 6c66 2e74 6f5f 6b65 6570 0a20 2020 2020  lf.to_keep.     
+0003e570: 2020 2065 6c69 6620 6e6f 7420 736b 7274     elif not skrt
+0003e580: 2e63 6f72 652e 6973 5f6c 6973 7428 746f  .core.is_list(to
+0003e590: 5f6b 6565 7029 3a0a 2020 2020 2020 2020  _keep):.        
+0003e5a0: 2020 2020 746f 5f6b 6565 7020 3d20 5b74      to_keep = [t
+0003e5b0: 6f5f 6b65 6570 5d0a 2020 2020 2020 2020  o_keep].        
+0003e5c0: 6966 2074 6f5f 7265 6d6f 7665 2069 7320  if to_remove is 
+0003e5d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0003e5e0: 2020 746f 5f72 656d 6f76 6520 3d20 7365    to_remove = se
+0003e5f0: 6c66 2e74 6f5f 7265 6d6f 7665 0a20 2020  lf.to_remove.   
+0003e600: 2020 2020 2065 6c69 6620 6e6f 7420 736b       elif not sk
+0003e610: 7274 2e63 6f72 652e 6973 5f6c 6973 7428  rt.core.is_list(
+0003e620: 746f 5f72 656d 6f76 6529 3a0a 2020 2020  to_remove):.    
+0003e630: 2020 2020 2020 2020 746f 5f72 656d 6f76          to_remov
+0003e640: 6520 3d20 5b74 6f5f 7265 6d6f 7665 5d0a  e = [to_remove].
+0003e650: 0a20 2020 2020 2020 2023 204b 6565 7020  .        # Keep 
+0003e660: 6f6e 6c79 2074 6865 2052 4f49 7320 696e  only the ROIs in
+0003e670: 2074 6f5f 6b65 6570 0a20 2020 2020 2020   to_keep.       
+0003e680: 2073 656c 662e 6c6f 6164 2829 0a20 2020   self.load().   
+0003e690: 2020 2020 2069 6620 746f 5f6b 6565 7020       if to_keep 
+0003e6a0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0003e6b0: 2020 2020 2020 2020 206b 6565 7020 3d20           keep = 
+0003e6c0: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
+0003e6d0: 6f72 2072 6f69 2069 6e20 7365 6c66 2e72  or roi in self.r
+0003e6e0: 6f69 733a 0a20 2020 2020 2020 2020 2020  ois:.           
+0003e6f0: 2020 2020 2069 6620 616e 7928 5b66 6e6d       if any([fnm
+0003e700: 6174 6368 2e66 6e6d 6174 6368 2872 6f69  atch.fnmatch(roi
+0003e710: 2e6e 616d 652e 6c6f 7765 7228 292c 206b  .name.lower(), k
+0003e720: 2e6c 6f77 6572 2829 2920 0a20 2020 2020  .lower()) .     
+0003e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e740: 2020 2066 6f72 206b 2069 6e20 746f 5f6b     for k in to_k
+0003e750: 6565 705d 293a 0a20 2020 2020 2020 2020  eep]):.         
+0003e760: 2020 2020 2020 2020 2020 206b 6565 702e             keep.
+0003e770: 6170 7065 6e64 2872 6f69 290a 2020 2020  append(roi).    
+0003e780: 2020 2020 2020 2020 7365 6c66 2e72 6f69          self.roi
+0003e790: 7320 3d20 6b65 6570 0a0a 2020 2020 2020  s = keep..      
+0003e7a0: 2020 2320 5265 6d6f 7665 2074 6865 2052    # Remove the R
+0003e7b0: 4f49 7320 696e 2074 6f5f 7265 6d6f 7665  OIs in to_remove
+0003e7c0: 0a20 2020 2020 2020 2069 6620 746f 5f72  .        if to_r
+0003e7d0: 656d 6f76 6520 6973 206e 6f74 204e 6f6e  emove is not Non
+0003e7e0: 653a 0a20 2020 2020 2020 2020 2020 206b  e:.            k
+0003e7f0: 6565 7020 3d20 5b5d 0a20 2020 2020 2020  eep = [].       
+0003e800: 2020 2020 2066 6f72 2072 6f69 2069 6e20       for roi in 
+0003e810: 7365 6c66 2e72 6f69 733a 0a20 2020 2020  self.rois:.     
+0003e820: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0003e830: 7420 616e 7928 0a20 2020 2020 2020 2020  t any(.         
+0003e840: 2020 2020 2020 2020 2020 205b 666e 6d61             [fnma
+0003e850: 7463 682e 666e 6d61 7463 6828 726f 692e  tch.fnmatch(roi.
+0003e860: 6e61 6d65 2e6c 6f77 6572 2829 2c20 722e  name.lower(), r.
+0003e870: 6c6f 7765 7228 2929 200a 2020 2020 2020  lower()) .      
+0003e880: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0003e890: 6f72 2072 2069 6e20 746f 5f72 656d 6f76  or r in to_remov
+0003e8a0: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
+0003e8b0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+0003e8c0: 2020 2020 2020 2020 2020 6b65 6570 2e61            keep.a
+0003e8d0: 7070 656e 6428 726f 6929 0a20 2020 2020  ppend(roi).     
+0003e8e0: 2020 2020 2020 2073 656c 662e 726f 6973         self.rois
+0003e8f0: 203d 206b 6565 700a 0a20 2020 2064 6566   = keep..    def
+0003e900: 2073 6574 5f61 6c70 6861 5f62 6574 615f   set_alpha_beta_
+0003e910: 7261 7469 6f73 280a 2020 2020 2020 2020  ratios(.        
+0003e920: 2020 2020 7365 6c66 2c20 616c 7068 615f      self, alpha_
+0003e930: 6265 7461 5f72 6174 696f 733d 4e6f 6e65  beta_ratios=None
+0003e940: 2c20 7365 745f 6173 5f64 6566 6175 6c74  , set_as_default
+0003e950: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
+0003e960: 2222 220a 2020 2020 2020 2020 5365 7420  """.        Set 
+0003e970: 7261 7469 6f73 2066 6f72 2052 4f49 2074  ratios for ROI t
+0003e980: 6973 7375 6573 206f 6620 636f 6566 6669  issues of coeffi
+0003e990: 6369 656e 7473 206f 6620 6c69 6e65 6172  cients of linear
+0003e9a0: 2d71 7561 6472 6174 6963 2065 7175 6174  -quadratic equat
+0003e9b0: 696f 6e2e 0a0a 2020 2020 2020 2020 4f70  ion...        Op
+0003e9c0: 7469 6f6e 616c 6c79 2069 6e70 7574 2076  tionally input v
+0003e9d0: 616c 7565 7320 666f 7220 7261 7469 6f73  alues for ratios
+0003e9e0: 2061 7320 7374 7275 6374 7572 652d 7365   as structure-se
+0003e9f0: 7420 6465 6661 756c 742e 0a0a 2020 2020  t default...    
+0003ea00: 2020 2020 2a2a 5061 7261 6d65 7465 723a      **Parameter:
+0003ea10: 2a2a 0a0a 2020 2020 2020 2020 616c 7068  **..        alph
+0003ea20: 615f 6265 7461 5f72 6174 696f 7320 3a20  a_beta_ratios : 
+0003ea30: 6469 6374 2c20 6465 6661 756c 743d 4e6f  dict, default=No
+0003ea40: 6e65 0a20 2020 2020 2020 2020 2020 2044  ne.            D
+0003ea50: 6963 7469 6f6e 6172 7920 7768 6572 6520  ictionary where 
+0003ea60: 6b65 7973 2061 7265 2052 4f49 206e 616d  keys are ROI nam
+0003ea70: 6573 2061 6e64 2076 616c 7565 7320 6172  es and values ar
+0003ea80: 650a 2020 2020 2020 2020 2020 2020 7261  e.            ra
+0003ea90: 7469 6f73 2066 6f72 2052 4f49 2074 6973  tios for ROI tis
+0003eaa0: 7375 6573 206f 6620 636f 6566 6669 6369  sues of coeffici
+0003eab0: 656e 7473 2c20 616c 7068 612c 2062 6574  ents, alpha, bet
+0003eac0: 612c 0a20 2020 2020 2020 2020 2020 2069  a,.            i
+0003ead0: 6e20 7468 6520 6c69 6e65 6172 2d71 7561  n the linear-qua
+0003eae0: 6472 6174 6963 2065 7175 6174 696f 6e2e  dratic equation.
+0003eaf0: 2020 5468 6573 6520 7261 7469 6f73 2061    These ratios a
+0003eb00: 7265 0a20 2020 2020 2020 2020 2020 2075  re.            u
+0003eb10: 7365 6420 696e 2063 616c 6375 6c61 7469  sed in calculati
+0003eb20: 6e67 2062 696f 6c6f 6769 6361 6c6c 7920  ng biologically 
+0003eb30: 6566 6665 6374 6976 6520 646f 7365 2c20  effective dose, 
+0003eb40: 4245 442c 2066 726f 6d0a 2020 2020 2020  BED, from.      
+0003eb50: 2020 2020 2020 7068 7973 6963 616c 2064        physical d
+0003eb60: 6f73 652c 2044 2c20 6465 6c69 7665 7265  ose, D, delivere
+0003eb70: 6420 6f76 6572 206e 2065 7175 616c 2066  d over n equal f
+0003eb80: 7261 6374 696f 6e73 3a0a 2020 2020 2020  ractions:.      
+0003eb90: 2020 2020 2020 2020 2020 4245 4420 3d20            BED = 
+0003eba0: 4420 2a20 2831 202b 2028 442f 6e29 202f  D * (1 + (D/n) /
+0003ebb0: 2028 616c 7068 612f 6265 7461 2929 2e0a   (alpha/beta))..
+0003ebc0: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0003ebd0: 6174 7472 6962 7574 6520 616c 7068 615f  attribute alpha_
+0003ebe0: 6f76 6572 5f76 616c 7565 2069 7320 7365  over_value is se
+0003ebf0: 7420 746f 2074 6865 2064 6963 7469 6f6e  t to the diction
+0003ec00: 6172 7920 7661 6c75 650a 2020 2020 2020  ary value.      
+0003ec10: 2020 2020 2020 666f 7220 616e 2052 4f49        for an ROI
+0003ec20: 2069 6465 6e74 6966 6965 6420 6279 2061   identified by a
+0003ec30: 206b 6579 2c20 6f72 2069 7320 7365 7420   key, or is set 
+0003ec40: 746f 204e 6f6e 6520 666f 7220 616e 790a  to None for any.
+0003ec50: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
+0003ec60: 7220 524f 4973 2e20 2049 6620 7468 6973  r ROIs.  If this
+0003ec70: 2070 6172 616d 6574 6572 2069 7320 7365   parameter is se
+0003ec80: 7420 746f 204e 6f6e 652c 2076 616c 7565  t to None, value
+0003ec90: 7320 6172 6520 7365 740a 2020 2020 2020  s are set.      
+0003eca0: 2020 2020 2020 6672 6f6d 2073 656c 662e        from self.
+0003ecb0: 616c 7068 615f 6265 7461 5f72 6174 696f  alpha_beta_ratio
+0003ecc0: 732e 0a0a 2020 2020 2020 2020 7365 745f  s...        set_
+0003ecd0: 6173 5f64 6566 6175 6c74 203a 2062 6f6f  as_default : boo
+0003ece0: 6c2c 2064 6566 6175 6c74 3d54 7275 650a  l, default=True.
+0003ecf0: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+0003ed00: 7275 652c 2061 6e64 2061 6c70 6861 5f62  rue, and alpha_b
+0003ed10: 6574 615f 7261 7469 6f73 2069 736e 2774  eta_ratios isn't
+0003ed20: 204e 6f6e 652c 2073 6574 0a20 2020 2020   None, set.     
+0003ed30: 2020 2020 2020 2073 656c 662e 616c 7068         self.alph
+0003ed40: 615f 6265 7461 5f72 6174 696f 7320 746f  a_beta_ratios to
+0003ed50: 2074 6865 2076 616c 7565 206f 6620 616c   the value of al
+0003ed60: 7068 615f 6265 7461 5f72 6174 696f 732e  pha_beta_ratios.
+0003ed70: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0003ed80: 2020 2020 2069 6620 616c 7068 615f 6265       if alpha_be
+0003ed90: 7461 5f72 6174 696f 7320 6973 204e 6f6e  ta_ratios is Non
+0003eda0: 653a 0a20 2020 2020 2020 2020 2020 2061  e:.            a
+0003edb0: 6c70 6861 5f62 6574 615f 7261 7469 6f73  lpha_beta_ratios
+0003edc0: 203d 2073 656c 662e 616c 7068 615f 6265   = self.alpha_be
+0003edd0: 7461 5f72 6174 696f 730a 2020 2020 2020  ta_ratios.      
+0003ede0: 2020 656c 6966 2073 6574 5f61 735f 6465    elif set_as_de
+0003edf0: 6661 756c 743a 0a20 2020 2020 2020 2020  fault:.         
+0003ee00: 2020 2073 656c 662e 616c 7068 615f 6265     self.alpha_be
+0003ee10: 7461 5f72 6174 696f 7320 3d20 616c 7068  ta_ratios = alph
+0003ee20: 615f 6265 7461 5f72 6174 696f 730a 0a20  a_beta_ratios.. 
+0003ee30: 2020 2020 2020 2066 6f72 2072 6f69 2069         for roi i
+0003ee40: 6e20 7365 6c66 2e67 6574 5f72 6f69 7328  n self.get_rois(
+0003ee50: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+0003ee60: 6f69 2e73 6574 5f61 6c70 6861 5f6f 7665  oi.set_alpha_ove
+0003ee70: 725f 6265 7461 2861 6c70 6861 5f62 6574  r_beta(alpha_bet
+0003ee80: 615f 7261 7469 6f73 2e67 6574 2872 6f69  a_ratios.get(roi
+0003ee90: 2e6e 616d 652c 204e 6f6e 6529 290a 0a20  .name, None)).. 
+0003eea0: 2020 2064 6566 2067 6574 5f61 6c70 6861     def get_alpha
+0003eeb0: 5f62 6574 615f 7261 7469 6f73 2873 656c  _beta_ratios(sel
+0003eec0: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+0003eed0: 2020 2020 2020 2020 4765 7420 6469 6374          Get dict
+0003eee0: 696f 6e61 7279 206f 6620 7261 7469 6f20  ionary of ratio 
+0003eef0: 6f66 2063 6f65 6666 6963 6965 6e74 7320  of coefficients 
+0003ef00: 6f66 206c 696e 6561 722d 7175 6164 7261  of linear-quadra
+0003ef10: 7469 6320 6571 7561 7469 6f6e 2e0a 2020  tic equation..  
+0003ef20: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0003ef30: 2020 7265 7475 726e 207b 726f 695f 6e61    return {roi_na
+0003ef40: 6d65 203a 2073 656c 665b 726f 695f 6e61  me : self[roi_na
+0003ef50: 6d65 5d2e 6765 745f 616c 7068 615f 6f76  me].get_alpha_ov
+0003ef60: 6572 5f62 6574 6128 290a 2020 2020 2020  er_beta().      
+0003ef70: 2020 2020 2020 2020 2020 666f 7220 726f            for ro
+0003ef80: 695f 6e61 6d65 2069 6e20 736f 7274 6564  i_name in sorted
+0003ef90: 2873 656c 662e 6765 745f 726f 695f 6e61  (self.get_roi_na
+0003efa0: 6d65 7328 2929 7d0a 0a20 2020 2064 6566  mes())}..    def
+0003efb0: 2067 6574 5f63 6f6c 6f72 7328 7365 6c66   get_colors(self
+0003efc0: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+0003efd0: 7420 6469 6374 206f 6620 524f 4920 636f  t dict of ROI co
+0003efe0: 6c6f 7273 2066 6f72 2065 6163 6820 6e61  lors for each na
+0003eff0: 6d65 2e22 2222 0a0a 2020 2020 2020 2020  me."""..        
+0003f000: 7265 7475 726e 207b 726f 692e 6e61 6d65  return {roi.name
+0003f010: 3a20 726f 692e 636f 6c6f 7220 666f 7220  : roi.color for 
+0003f020: 726f 6920 696e 2073 656c 662e 6765 745f  roi in self.get_
+0003f030: 726f 6973 2829 7d0a 0a20 2020 2064 6566  rois()}..    def
+0003f040: 2072 6563 6f6c 6f72 5f72 6f69 7328 7365   recolor_rois(se
+0003f050: 6c66 2c20 636f 6c6f 7273 293a 0a20 2020  lf, colors):.   
+0003f060: 2020 2020 2022 2222 5365 7420 636f 6c6f       """Set colo
+0003f070: 7273 206f 6620 524f 4973 2075 7369 6e67  rs of ROIs using
+0003f080: 2061 206c 6973 7420 6f72 2064 6963 7420   a list or dict 
+0003f090: 6769 7665 6e20 696e 203c 636f 6c6f 7273  given in <colors
+0003f0a0: 3e2e 0a0a 2020 2020 2020 2020 2a2a 5061  >...        **Pa
+0003f0b0: 7261 6d65 7465 7273 2a2a 3a0a 0a20 2020  rameters**:..   
+0003f0c0: 2020 2020 2063 6f6c 6f72 7320 3a20 6c69       colors : li
+0003f0d0: 7374 2f64 6963 740a 2020 2020 2020 2020  st/dict.        
+0003f0e0: 2020 2020 4c69 7374 206f 7220 6469 6374      List or dict
+0003f0f0: 206f 6620 636f 6c6f 7273 2e20 4966 2061   of colors. If a
+0003f100: 2064 6963 742c 2074 6865 206b 6579 7320   dict, the keys 
+0003f110: 7368 6f75 6c64 2062 6520 524f 4920 6e61  should be ROI na
+0003f120: 6d65 7320 6f72 0a20 2020 2020 2020 2020  mes or.         
+0003f130: 2020 2077 696c 6463 6172 6473 206d 6174     wildcards mat
+0003f140: 6368 696e 6720 524f 4920 6e61 6d65 732c  ching ROI names,
+0003f150: 2061 6e64 2074 6865 2076 616c 7565 7320   and the values 
+0003f160: 7368 6f75 6c64 2062 6520 6465 7369 7265  should be desire
+0003f170: 6420 0a20 2020 2020 2020 2020 2020 2063  d .            c
+0003f180: 6f6c 6f72 7320 666f 7220 524f 4973 206d  olors for ROIs m
+0003f190: 6174 6368 696e 6720 7468 6174 206e 616d  atching that nam
+0003f1a0: 652e 2049 6620 6120 6c69 7374 2c20 7368  e. If a list, sh
+0003f1b0: 6f75 6c64 2063 6f6e 7461 696e 0a20 2020  ould contain.   
+0003f1c0: 2020 2020 2020 2020 2063 6f6c 6f72 7320           colors 
+0003f1d0: 7768 6963 6820 7769 6c6c 2062 6520 6170  which will be ap
+0003f1e0: 706c 6965 6420 746f 206c 6f61 6465 6420  plied to loaded 
+0003f1f0: 524f 4973 2069 6e20 6f72 6465 722e 0a20  ROIs in order.. 
+0003f200: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0003f210: 2020 2020 6966 2063 6f6c 6f72 7320 6973      if colors is
+0003f220: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0003f230: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+0003f240: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0003f250: 2863 6f6c 6f72 732c 2064 6963 7429 3a0a  (colors, dict):.
+0003f260: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0003f270: 6e61 6d65 2c20 636f 6c6f 7220 696e 2063  name, color in c
+0003f280: 6f6c 6f72 732e 6974 656d 7328 293a 0a20  olors.items():. 
+0003f290: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0003f2a0: 6f72 2072 6f69 2069 6e20 7365 6c66 2e72  or roi in self.r
+0003f2b0: 6f69 733a 0a20 2020 2020 2020 2020 2020  ois:.           
+0003f2c0: 2020 2020 2020 2020 2069 6620 666e 6d61           if fnma
+0003f2d0: 7463 682e 666e 6d61 7463 6828 726f 692e  tch.fnmatch(roi.
+0003f2e0: 6e61 6d65 2e6c 6f77 6572 2829 2c20 6e61  name.lower(), na
+0003f2f0: 6d65 2e6c 6f77 6572 2829 293a 0a20 2020  me.lower()):.   
+0003f300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f310: 2020 2020 2072 6f69 2e73 6574 5f63 6f6c       roi.set_col
+0003f320: 6f72 2863 6f6c 6f72 290a 2020 2020 2020  or(color).      
+0003f330: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+0003f340: 6528 636f 6c6f 7273 2c20 6c69 7374 293a  e(colors, list):
+0003f350: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0003f360: 2069 2c20 636f 6c6f 7220 696e 2065 6e75   i, color in enu
+0003f370: 6d65 7261 7465 2863 6f6c 6f72 7329 3a0a  merate(colors):.
+0003f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f390: 6966 2069 203e 3d20 6c65 6e28 7365 6c66  if i >= len(self
+0003f3a0: 2e72 6f69 7329 3a0a 2020 2020 2020 2020  .rois):.        
+0003f3b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0003f3c0: 726e 0a20 2020 2020 2020 2020 2020 2020  rn.             
+0003f3d0: 2020 2073 656c 662e 726f 6973 5b69 5d2e     self.rois[i].
+0003f3e0: 7365 745f 636f 6c6f 7228 636f 6c6f 7229  set_color(color)
+0003f3f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0003f400: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0003f410: 2054 7970 6545 7272 6f72 2822 3c63 6f6c   TypeError("<col
+0003f420: 6f72 733e 206d 7573 7420 6265 206c 6973  ors> must be lis
+0003f430: 7420 6f72 2064 6963 742e 2229 0a0a 2020  t or dict.")..  
+0003f440: 2020 6465 6620 6164 645f 726f 6973 2873    def add_rois(s
+0003f450: 656c 662c 2073 6f75 7263 6573 293a 0a20  elf, sources):. 
+0003f460: 2020 2020 2020 2022 2222 4164 6420 6164         """Add ad
+0003f470: 6469 7469 6f6e 616c 2052 4f49 7320 6672  ditional ROIs fr
+0003f480: 6f6d 2073 6f75 7263 6528 7329 2e22 2222  om source(s)."""
+0003f490: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+0003f4a0: 2073 6b72 742e 636f 7265 2e69 735f 6c69   skrt.core.is_li
+0003f4b0: 7374 2873 6f75 7263 6573 293a 0a20 2020  st(sources):.   
+0003f4c0: 2020 2020 2020 2020 2073 6f75 7263 6573           sources
+0003f4d0: 203d 205b 736f 7572 6365 735d 0a20 2020   = [sources].   
+0003f4e0: 2020 2020 2073 656c 662e 736f 7572 6365       self.source
+0003f4f0: 732e 6578 7465 6e64 2873 6f75 7263 6573  s.extend(sources
+0003f500: 290a 2020 2020 2020 2020 7365 6c66 2e6c  ).        self.l
+0003f510: 6f61 6428 736f 7572 6365 7329 0a0a 2020  oad(sources)..  
+0003f520: 2020 6465 6620 6164 645f 726f 6928 7365    def add_roi(se
+0003f530: 6c66 2c20 736f 7572 6365 2c20 2a2a 6b77  lf, source, **kw
+0003f540: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
+0003f550: 2222 4164 6420 6120 7369 6e67 6c65 2052  ""Add a single R
+0003f560: 4f49 2077 6974 6820 206f 7074 696f 6e61  OI with  optiona
+0003f570: 6c20 6b77 6172 6773 2e22 2222 0a0a 2020  l kwargs."""..  
+0003f580: 2020 2020 2020 7365 6c66 2e73 6f75 7263        self.sourc
+0003f590: 6573 2e61 7070 656e 6428 736f 7572 6365  es.append(source
+0003f5a0: 290a 2020 2020 2020 2020 6966 2069 7369  ).        if isi
+0003f5b0: 6e73 7461 6e63 6528 736f 7572 6365 2c20  nstance(source, 
+0003f5c0: 524f 4929 3a0a 2020 2020 2020 2020 2020  ROI):.          
+0003f5d0: 2020 726f 6920 3d20 736f 7572 6365 0a20    roi = source. 
+0003f5e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0003f5f0: 2020 2020 2020 2020 2072 6f69 5f6b 7761           roi_kwa
+0003f600: 7267 7320 3d20 7365 6c66 2e72 6f69 5f6b  rgs = self.roi_k
+0003f610: 7761 7267 732e 636f 7079 2829 0a20 2020  wargs.copy().   
+0003f620: 2020 2020 2020 2020 2072 6f69 5f6b 7761           roi_kwa
+0003f630: 7267 732e 7570 6461 7465 286b 7761 7267  rgs.update(kwarg
+0003f640: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
+0003f650: 6f69 203d 2052 4f49 2873 6f75 7263 652c  oi = ROI(source,
+0003f660: 202a 2a72 6f69 5f6b 7761 7267 7329 0a20   **roi_kwargs). 
+0003f670: 2020 2020 2020 2072 6f69 2e73 7472 7563         roi.struc
+0003f680: 7475 7265 5f73 6574 203d 2073 656c 660a  ture_set = self.
+0003f690: 2020 2020 2020 2020 7365 6c66 2e72 6f69          self.roi
+0003f6a0: 732e 6170 7065 6e64 2872 6f69 290a 0a20  s.append(roi).. 
+0003f6b0: 2020 2064 6566 2063 6c6f 6e65 5f61 7474     def clone_att
+0003f6c0: 7273 2873 656c 662c 206f 626a 2c20 636f  rs(self, obj, co
+0003f6d0: 7079 5f72 6f69 733d 5472 7565 2c20 636f  py_rois=True, co
+0003f6e0: 7079 5f72 6f69 5f64 6174 613d 5472 7565  py_roi_data=True
+0003f6f0: 293a 0a20 2020 2020 2020 2022 2222 4173  ):.        """As
+0003f700: 7369 676e 2061 6c6c 2061 7474 7269 6275  sign all attribu
+0003f710: 7465 7320 6f66 203c 7365 6c66 3e20 746f  tes of <self> to
+0003f720: 2061 6e6f 7468 6572 206f 626a 6563 742c   another object,
+0003f730: 203c 6f62 6a3e 2c20 656e 7375 7269 6e67   <obj>, ensuring
+0003f740: 0a20 2020 2020 2020 2074 6861 7420 524f  .        that RO
+0003f750: 4973 2061 7265 2063 6f70 6965 6420 6966  Is are copied if
+0003f760: 2063 6f70 795f 726f 6973 3d54 7275 652e   copy_rois=True.
+0003f770: 2222 220a 0a20 2020 2020 2020 2073 6b72  """..        skr
+0003f780: 742e 636f 7265 2e44 6174 612e 636c 6f6e  t.core.Data.clon
+0003f790: 655f 6174 7472 7328 7365 6c66 2c20 6f62  e_attrs(self, ob
+0003f7a0: 6a29 0a20 2020 2020 2020 2069 6620 636f  j).        if co
+0003f7b0: 7079 5f72 6f69 733a 0a20 2020 2020 2020  py_rois:.       
+0003f7c0: 2020 2020 206f 626a 2e72 6f69 7320 3d20       obj.rois = 
+0003f7d0: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
+0003f7e0: 6f72 2072 6f69 2069 6e20 7365 6c66 2e72  or roi in self.r
+0003f7f0: 6f69 733a 0a20 2020 2020 2020 2020 2020  ois:.           
+0003f800: 2020 2020 206f 626a 2e72 6f69 732e 6170       obj.rois.ap
+0003f810: 7065 6e64 2872 6f69 2e63 6c6f 6e65 2863  pend(roi.clone(c
+0003f820: 6f70 795f 6461 7461 3d63 6f70 795f 726f  opy_data=copy_ro
+0003f830: 695f 6461 7461 2929 0a0a 2020 2020 6465  i_data))..    de
+0003f840: 6620 6669 6c74 6572 6564 5f63 6f70 7928  f filtered_copy(
+0003f850: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+0003f860: 2020 2020 2020 206e 616d 6573 3d4e 6f6e         names=Non
+0003f870: 652c 0a20 2020 2020 2020 206e 616d 653d  e,.        name=
+0003f880: 4e6f 6e65 2c0a 2020 2020 2020 2020 746f  None,.        to
+0003f890: 5f6b 6565 703d 4e6f 6e65 2c0a 2020 2020  _keep=None,.    
+0003f8a0: 2020 2020 746f 5f72 656d 6f76 653d 4e6f      to_remove=No
+0003f8b0: 6e65 2c0a 2020 2020 2020 2020 6b65 6570  ne,.        keep
+0003f8c0: 5f72 656e 616d 6564 5f6f 6e6c 793d 4661  _renamed_only=Fa
+0003f8d0: 6c73 652c 0a20 2020 2020 2020 2063 6f70  lse,.        cop
+0003f8e0: 795f 726f 695f 6461 7461 3d54 7275 650a  y_roi_data=True.
+0003f8f0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+0003f900: 2222 4372 6561 7465 2061 2063 6f70 7920  ""Create a copy 
+0003f910: 6f66 2074 6869 7320 7374 7275 6374 7572  of this structur
+0003f920: 6520 7365 7420 7769 7468 2052 4f49 7320  e set with ROIs 
+0003f930: 6f70 7469 6f6e 616c 6c79 0a20 2020 2020  optionally.     
+0003f940: 2020 2072 656e 616d 6564 206f 7220 6669     renamed or fi
+0003f950: 6c74 6572 6564 2e20 5265 7475 726e 7320  ltered. Returns 
+0003f960: 6120 6e65 7720 5374 7275 6374 7572 6553  a new StructureS
+0003f970: 6574 206f 626a 6563 742e 0a0a 2020 2020  et object...    
+0003f980: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+0003f990: 3a2a 2a0a 2020 2020 2020 2020 0a20 2020  :**.        .   
+0003f9a0: 2020 2020 206e 616d 6573 203a 2064 6963       names : dic
+0003f9b0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+0003f9c0: 2020 2020 2020 2020 2020 2020 4469 6374              Dict
+0003f9d0: 696f 6e61 7279 206f 6620 6e61 6d65 7320  ionary of names 
+0003f9e0: 666f 7220 7265 6e61 6d69 6e67 2052 4f49  for renaming ROI
+0003f9f0: 732c 2077 6865 7265 2074 6865 206b 6579  s, where the key
+0003fa00: 7320 6172 6520 6e65 7720 0a20 2020 2020  s are new .     
+0003fa10: 2020 2020 2020 206e 616d 6573 2061 6e64         names and
+0003fa20: 2076 616c 7565 7320 6172 6520 6c69 7374   values are list
+0003fa30: 7320 6f66 2070 6f73 7369 626c 6520 6e61  s of possible na
+0003fa40: 6d65 7320 6f66 2052 4f49 7320 7468 6174  mes of ROIs that
+0003fa50: 2073 686f 756c 640a 2020 2020 2020 2020   should.        
+0003fa60: 2020 2020 6265 2061 7373 6967 6e65 6420      be assigned 
+0003fa70: 7468 6520 6e65 7720 6e61 6d65 2e20 5468  the new name. Th
+0003fa80: 6573 6520 6e61 6d65 7320 6361 6e20 616c  ese names can al
+0003fa90: 736f 2063 6f6e 7461 696e 2077 696c 6463  so contain wildc
+0003faa0: 6172 6473 0a20 2020 2020 2020 2020 2020  ards.           
+0003fab0: 2077 6974 6820 7468 6520 272a 2720 7379   with the '*' sy
+0003fac0: 6d62 6f6c 2e0a 0a20 2020 2020 2020 206e  mbol...        n
+0003fad0: 616d 6520 3a20 7374 722c 2064 6566 6175  ame : str, defau
+0003fae0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0003faf0: 2020 2020 4e61 6d65 2066 6f72 2074 6865      Name for the
+0003fb00: 2072 6574 7572 6e65 6420 5374 7275 6374   returned Struct
+0003fb10: 7572 6553 6574 2e0a 0a20 2020 2020 2020  ureSet...       
+0003fb20: 2074 6f5f 6b65 6570 203a 206c 6973 742c   to_keep : list,
+0003fb30: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0003fb40: 2020 2020 2020 2020 2020 4c69 7374 206f            List o
+0003fb50: 6620 6e61 6d65 7320 6f66 2052 4f49 7320  f names of ROIs 
+0003fb60: 746f 206b 6565 7020 696e 2074 6865 2063  to keep in the c
+0003fb70: 6f70 6965 6420 5374 7275 6374 7572 6553  opied StructureS
+0003fb80: 6574 3b20 616c 6c20 0a20 2020 2020 2020  et; all .       
+0003fb90: 2020 2020 206f 7468 6572 7320 7769 6c6c       others will
+0003fba0: 2062 6520 7265 6d6f 7665 642e 2054 6865   be removed. The
+0003fbb0: 7365 206e 616d 6573 2063 616e 2061 6c73  se names can als
+0003fbc0: 6f20 636f 6e74 6169 6e20 7769 6c64 6361  o contain wildca
+0003fbd0: 7264 730a 2020 2020 2020 2020 2020 2020  rds.            
+0003fbe0: 7769 7468 2074 6865 2027 2a27 2073 796d  with the '*' sym
+0003fbf0: 626f 6c2e 2041 7070 6c69 6564 2061 6674  bol. Applied aft
+0003fc00: 6572 2072 656e 616d 696e 6720 7769 7468  er renaming with
+0003fc10: 203c 6e61 6d65 733e 2e0a 0a20 2020 2020   <names>...     
+0003fc20: 2020 2074 6f5f 7265 6d6f 7665 203a 206c     to_remove : l
+0003fc30: 6973 742c 2064 6566 6175 6c74 3d4e 6f6e  ist, default=Non
+0003fc40: 650a 2020 2020 2020 2020 2020 2020 4c69  e.            Li
+0003fc50: 7374 206f 6620 6e61 6d65 7320 6f66 2052  st of names of R
+0003fc60: 4f49 7320 746f 2072 656d 6f76 6520 6672  OIs to remove fr
+0003fc70: 6f6d 2074 6865 2063 6f70 6965 6420 5374  om the copied St
+0003fc80: 7275 6374 7572 6553 6574 3b20 616c 6c20  ructureSet; all 
+0003fc90: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
+0003fca0: 6572 7320 7769 6c6c 2062 6520 7265 6d6f  ers will be remo
+0003fcb0: 7665 642e 2054 6865 7365 206e 616d 6573  ved. These names
+0003fcc0: 2063 616e 2061 6c73 6f20 636f 6e74 6169   can also contai
+0003fcd0: 6e20 7769 6c64 6361 7264 730a 2020 2020  n wildcards.    
+0003fce0: 2020 2020 2020 2020 7769 7468 2074 6865          with the
+0003fcf0: 2027 2a27 2073 796d 626f 6c2e 2041 7070   '*' symbol. App
+0003fd00: 6c69 6564 2061 6674 6572 2072 656e 616d  lied after renam
+0003fd10: 696e 6720 7769 7468 203c 6e61 6d65 733e  ing with <names>
+0003fd20: 2061 6e64 200a 2020 2020 2020 2020 2020   and .          
+0003fd30: 2020 6669 6c74 6572 696e 6720 7769 7468    filtering with
+0003fd40: 203c 746f 5f6b 6565 703e 2e0a 0a20 2020   <to_keep>...   
+0003fd50: 2020 2020 206b 6565 705f 7265 6e61 6d65       keep_rename
+0003fd60: 645f 6f6e 6c79 203a 2062 6f6f 6c2c 2064  d_only : bool, d
+0003fd70: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
+0003fd80: 2020 2020 2020 2020 2049 6620 5472 7565           If True
+0003fd90: 2c20 616e 7920 524f 4973 2074 6861 7420  , any ROIs that 
+0003fda0: 646f 206e 6f74 2067 6574 2072 656e 616d  do not get renam
+0003fdb0: 6564 2077 696c 6c20 6265 2072 656d 6f76  ed will be remov
+0003fdc0: 6564 2066 726f 6d0a 2020 2020 2020 2020  ed from.        
+0003fdd0: 2020 2020 7468 6520 5374 7275 6374 7572      the Structur
+0003fde0: 6553 6574 2e0a 0a20 2020 2020 2020 2063  eSet...        c
+0003fdf0: 6f70 795f 726f 695f 6461 7461 203a 2062  opy_roi_data : b
+0003fe00: 6f6f 6c2c 2064 6566 6175 6c74 3d54 7275  ool, default=Tru
+0003fe10: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+0003fe20: 2054 7275 652c 2074 6865 2052 4f49 7320   True, the ROIs 
+0003fe30: 696e 2074 6865 2072 6574 7572 6e65 6420  in the returned 
+0003fe40: 5374 7275 6374 7572 6553 6574 2077 696c  StructureSet wil
+0003fe50: 6c20 636f 6e74 6169 6e0a 2020 2020 2020  l contain.      
+0003fe60: 2020 2020 2020 636f 7069 6573 206f 6620        copies of 
+0003fe70: 7468 6520 6461 7461 2066 726f 6d20 7468  the data from th
+0003fe80: 6520 6f72 6967 696e 616c 2053 7472 7563  e original Struc
+0003fe90: 7475 7265 5365 742e 204f 7468 6572 7769  tureSet. Otherwi
+0003fea0: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+0003feb0: 7468 6520 6e65 7720 524f 4973 2077 696c  the new ROIs wil
+0003fec0: 6c20 636f 6e74 6169 6e20 7265 6665 7265  l contain refere
+0003fed0: 6e63 6573 2074 6f20 7468 6520 7361 6d65  nces to the same
+0003fee0: 2064 6174 612c 2065 2e67 2e20 7468 6520   data, e.g. the 
+0003fef0: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
+0003ff00: 6520 6e75 6d70 7920 6e64 6172 7261 7920  e numpy ndarray 
+0003ff10: 6f62 6a65 6374 2066 6f72 2074 6865 206d  object for the m
+0003ff20: 6173 6b2f 7361 6d65 2064 6963 7420 666f  ask/same dict fo
+0003ff30: 7220 7468 6520 636f 6e74 6f75 7273 2e0a  r the contours..
+0003ff40: 2020 2020 2020 2020 2020 2020 4f6e 6c79              Only
+0003ff50: 2075 7365 6420 6966 203c 636f 7079 5f72   used if <copy_r
+0003ff60: 6f69 733e 2069 7320 5472 7565 0a20 2020  ois> is True.   
+0003ff70: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0003ff80: 2020 2320 4c6f 6164 2053 7472 7563 7475    # Load Structu
+0003ff90: 7265 5365 742c 2062 7574 2070 7265 7665  reSet, but preve
+0003ffa0: 6e74 206c 6f61 6469 6e67 206f 6620 524f  nt loading of RO
+0003ffb0: 4973 2e0a 2020 2020 2020 2020 2320 4c6f  Is..        # Lo
+0003ffc0: 6164 696e 6720 524f 4973 2068 6572 6520  ading ROIs here 
+0003ffd0: 636f 6e73 756d 6573 2074 696d 6520 616e  consumes time an
+0003ffe0: 6420 6d65 6d6f 7279 2063 7265 6174 696e  d memory creatin
+0003fff0: 6720 6d61 736b 730a 2020 2020 2020 2020  g masks.        
+00040000: 2320 666f 7220 524f 4973 2074 6861 7420  # for ROIs that 
+00040010: 6d61 7920 6265 2064 6973 6361 7264 6564  may be discarded
+00040020: 2061 6674 6572 2066 696c 7465 7269 6e67   after filtering
+00040030: 2e0a 2020 2020 2020 2020 726f 695f 6c6f  ..        roi_lo
+00040040: 6164 203d 2073 656c 662e 726f 695f 6b77  ad = self.roi_kw
+00040050: 6172 6773 2e67 6574 2822 6c6f 6164 222c  args.get("load",
+00040060: 204e 6f6e 6529 0a20 2020 2020 2020 2073   None).        s
+00040070: 656c 662e 726f 695f 6b77 6172 6773 5b22  elf.roi_kwargs["
+00040080: 6c6f 6164 225d 203d 2046 616c 7365 0a20  load"] = False. 
+00040090: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
+000400a0: 2829 0a0a 2020 2020 2020 2020 7373 203d  ()..        ss =
+000400b0: 2073 656c 662e 636c 6f6e 6528 636f 7079   self.clone(copy
+000400c0: 5f72 6f69 5f64 6174 613d 636f 7079 5f72  _roi_data=copy_r
+000400d0: 6f69 5f64 6174 6129 0a20 2020 2020 2020  oi_data).       
+000400e0: 2069 6620 6e61 6d65 2069 7320 6e6f 7420   if name is not 
+000400f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00040100: 2020 7373 2e6e 616d 6520 3d20 6e61 6d65    ss.name = name
+00040110: 0a20 2020 2020 2020 2073 732e 7265 6e61  .        ss.rena
+00040120: 6d65 5f72 6f69 7328 6e61 6d65 732c 206b  me_rois(names, k
+00040130: 6565 705f 7265 6e61 6d65 645f 6f6e 6c79  eep_renamed_only
+00040140: 3d6b 6565 705f 7265 6e61 6d65 645f 6f6e  =keep_renamed_on
+00040150: 6c79 290a 2020 2020 2020 2020 7373 2e66  ly).        ss.f
+00040160: 696c 7465 725f 726f 6973 2874 6f5f 6b65  ilter_rois(to_ke
+00040170: 6570 2c20 746f 5f72 656d 6f76 6529 0a0a  ep, to_remove)..
+00040180: 2020 2020 2020 2020 2320 456e 7375 7265          # Ensure
+00040190: 2074 6861 7420 7365 6c66 2e72 6f69 5f6b   that self.roi_k
+000401a0: 7761 7267 7320 6973 2074 6865 2073 616d  wargs is the sam
+000401b0: 6520 6173 2061 7420 696e 7075 742e 0a20  e as at input.. 
+000401c0: 2020 2020 2020 2069 6620 726f 695f 6c6f         if roi_lo
+000401d0: 6164 2069 7320 4e6f 6e65 3a0a 2020 2020  ad is None:.    
+000401e0: 2020 2020 2020 2020 7365 6c66 2e72 6f69          self.roi
+000401f0: 5f6b 7761 7267 732e 706f 7028 226c 6f61  _kwargs.pop("loa
+00040200: 6422 290a 2020 2020 2020 2020 656c 7365  d").        else
+00040210: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00040220: 6c66 2e72 6f69 5f6b 7761 7267 735b 226c  lf.roi_kwargs["l
+00040230: 6f61 6422 5d20 3d20 726f 695f 6c6f 6164  oad"] = roi_load
+00040240: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00040250: 2073 730a 0a20 2020 2064 6566 2067 6574   ss..    def get
+00040260: 5f72 6f69 7328 7365 6c66 2c20 6e61 6d65  _rois(self, name
+00040270: 733d 4e6f 6e65 2c20 6967 6e6f 7265 5f65  s=None, ignore_e
+00040280: 6d70 7479 3d46 616c 7365 293a 0a20 2020  mpty=False):.   
+00040290: 2020 2020 2022 2222 4765 7420 6c69 7374       """Get list
+000402a0: 206f 6620 524f 4920 6f62 6a65 6374 7320   of ROI objects 
+000402b0: 4966 203c 6e61 6d65 733e 2069 7320 6769  If <names> is gi
+000402c0: 7665 6e2c 206f 6e6c 7920 7468 6520 524f  ven, only the RO
+000402d0: 4973 2077 6974 680a 2020 2020 2020 2020  Is with.        
+000402e0: 7468 6f73 6520 6e61 6d65 7320 7769 6c6c  those names will
+000402f0: 2062 6520 7265 7475 726e 6564 2e22 2222   be returned."""
+00040300: 0a0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+00040310: 6f61 6428 290a 2020 2020 2020 2020 6966  oad().        if
+00040320: 206e 616d 6573 2069 7320 4e6f 6e65 3a0a   names is None:.
+00040330: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00040340: 676e 6f72 655f 656d 7074 793a 0a20 2020  gnore_empty:.   
+00040350: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00040360: 7572 6e20 5b72 6f69 2066 6f72 2072 6f69  urn [roi for roi
+00040370: 2069 6e20 7365 6c66 2e72 6f69 7320 6966   in self.rois if
+00040380: 206e 6f74 2072 6f69 2e65 6d70 7479 5d0a   not roi.empty].
+00040390: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000403a0: 726e 2073 656c 662e 726f 6973 0a0a 2020  rn self.rois..  
+000403b0: 2020 2020 2020 726f 6973 203d 205b 5d0a        rois = [].
+000403c0: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
+000403d0: 2069 6e20 6e61 6d65 733a 0a20 2020 2020   in names:.     
+000403e0: 2020 2020 2020 2072 6f69 203d 2073 656c         roi = sel
+000403f0: 662e 6765 745f 726f 6928 6e61 6d65 290a  f.get_roi(name).
+00040400: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00040410: 6f69 2069 7320 6e6f 7420 4e6f 6e65 3a0a  oi is not None:.
+00040420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040430: 6966 206e 6f74 2069 676e 6f72 655f 656d  if not ignore_em
+00040440: 7074 7920 6f72 206e 6f74 2072 6f69 2e65  pty or not roi.e
+00040450: 6d70 7479 3a0a 2020 2020 2020 2020 2020  mpty:.          
+00040460: 2020 2020 2020 2020 2020 726f 6973 2e61            rois.a
+00040470: 7070 656e 6428 726f 6929 0a20 2020 2020  ppend(roi).     
+00040480: 2020 2072 6574 7572 6e20 726f 6973 0a0a     return rois..
+00040490: 2020 2020 6465 6620 6765 745f 726f 6973      def get_rois
+000404a0: 5f77 696c 6463 6172 6428 7365 6c66 2c20  _wildcard(self, 
+000404b0: 7769 6c64 6361 7264 293a 0a20 2020 2020  wildcard):.     
+000404c0: 2020 2022 2222 5265 7475 726e 206c 6973     """Return lis
+000404d0: 7420 6f66 2052 4f49 7320 6d61 7463 6869  t of ROIs matchi
+000404e0: 6e67 2061 2077 696c 6463 6172 6420 6578  ng a wildcard ex
+000404f0: 7072 6573 7369 6f6e 2e22 2222 0a0a 2020  pression."""..  
+00040500: 2020 2020 2020 726f 6973 203d 205b 5d0a        rois = [].
+00040510: 2020 2020 2020 2020 666f 7220 726f 6920          for roi 
+00040520: 696e 2073 656c 662e 6765 745f 726f 6973  in self.get_rois
+00040530: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00040540: 6966 2066 6e6d 6174 6368 2e66 6e6d 6174  if fnmatch.fnmat
+00040550: 6368 2872 6f69 2e6e 616d 652e 6c6f 7765  ch(roi.name.lowe
+00040560: 7228 292c 2077 696c 6463 6172 642e 6c6f  r(), wildcard.lo
+00040570: 7765 7228 2929 3a0a 2020 2020 2020 2020  wer()):.        
+00040580: 2020 2020 2020 2020 726f 6973 2e61 7070          rois.app
+00040590: 656e 6428 726f 6929 0a20 2020 2020 2020  end(roi).       
+000405a0: 2072 6574 7572 6e20 726f 6973 0a0a 2020   return rois..  
+000405b0: 2020 6465 6620 6765 745f 726f 695f 6e61    def get_roi_na
+000405c0: 6d65 7328 7365 6c66 2c20 6f72 6967 696e  mes(self, origin
+000405d0: 616c 3d46 616c 7365 2c20 6967 6e6f 7265  al=False, ignore
+000405e0: 5f65 6d70 7479 3d46 616c 7365 293a 0a20  _empty=False):. 
+000405f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00040600: 2020 2047 6574 206c 6973 7420 6f66 206e     Get list of n
+00040610: 616d 6573 206f 6620 524f 4973 2069 6e20  ames of ROIs in 
+00040620: 7468 6973 2073 7472 7563 7475 7265 2073  this structure s
+00040630: 6574 2e20 4966 203c 6f72 6967 696e 616c  et. If <original
+00040640: 3e20 6973 2054 7275 652c 0a20 2020 2020  > is True,.     
+00040650: 2020 2067 6574 2074 6865 206f 7269 6769     get the origi
+00040660: 6e61 6c20 6e61 6d65 7320 6f66 2074 6865  nal names of the
+00040670: 2052 4f49 732e 2020 4966 203c 6967 6e6f   ROIs.  If <igno
+00040680: 7265 5f65 6d70 7479 3e20 6973 2054 7275  re_empty> is Tru
+00040690: 652c 0a20 2020 2020 2020 206f 6d69 7420  e,.        omit 
+000406a0: 6e61 6d65 7320 6f66 2065 6d70 7479 2052  names of empty R
+000406b0: 4f49 732e 0a20 2020 2020 2020 2022 2222  OIs..        """
+000406c0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000406d0: 205b 732e 6765 745f 6e61 6d65 286f 7269   [s.get_name(ori
+000406e0: 6769 6e61 6c29 2066 6f72 2073 2069 6e20  ginal) for s in 
+000406f0: 7365 6c66 2e67 6574 5f72 6f69 7328 290a  self.get_rois().
+00040700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040710: 6966 206e 6f74 2028 6967 6e6f 7265 5f65  if not (ignore_e
+00040720: 6d70 7479 2061 6e64 2073 2e65 6d70 7479  mpty and s.empty
+00040730: 295d 0a0a 0a20 2020 2064 6566 2067 6574  )]...    def get
+00040740: 5f72 6f69 5f64 6963 7428 7365 6c66 293a  _roi_dict(self):
+00040750: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
+00040760: 6469 6374 206f 6620 524f 4920 6e61 6d65  dict of ROI name
+00040770: 7320 616e 6420 6f62 6a65 6374 732e 2222  s and objects.""
+00040780: 220a 0a20 2020 2020 2020 2072 6574 7572  "..        retur
+00040790: 6e20 7b73 2e6e 616d 653a 2073 2066 6f72  n {s.name: s for
+000407a0: 2073 2069 6e20 7365 6c66 2e67 6574 5f72   s in self.get_r
+000407b0: 6f69 7328 297d 0a0a 2020 2020 6465 6620  ois()}..    def 
+000407c0: 6765 745f 726f 6928 7365 6c66 2c20 6e61  get_roi(self, na
+000407d0: 6d65 293a 0a20 2020 2020 2020 2022 2222  me):.        """
+000407e0: 4765 7420 616e 2052 4f49 2077 6974 6820  Get an ROI with 
+000407f0: 6120 7370 6563 6966 6963 206e 616d 652e  a specific name.
+00040800: 2222 220a 0a20 2020 2020 2020 2072 6f69  """..        roi
+00040810: 7320 3d20 7365 6c66 2e67 6574 5f72 6f69  s = self.get_roi
+00040820: 5f64 6963 7428 290a 2020 2020 2020 2020  _dict().        
+00040830: 6966 206e 616d 6520 6e6f 7420 696e 2072  if name not in r
+00040840: 6f69 733a 0a20 2020 2020 2020 2020 2020  ois:.           
+00040850: 2070 7269 6e74 2866 2252 4f49 207b 6e61   print(f"ROI {na
+00040860: 6d65 7d20 6e6f 7420 666f 756e 6421 2229  me} not found!")
+00040870: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00040880: 7572 6e0a 2020 2020 2020 2020 7265 7475  urn.        retu
+00040890: 726e 2072 6f69 735b 6e61 6d65 5d0a 0a20  rn rois[name].. 
+000408a0: 2020 2064 6566 2070 7269 6e74 5f72 6f69     def print_roi
+000408b0: 7328 7365 6c66 293a 0a0a 2020 2020 2020  s(self):..      
+000408c0: 2020 7365 6c66 2e6c 6f61 6428 290a 2020    self.load().  
+000408d0: 2020 2020 2020 7072 696e 7428 225c 6e22        print("\n"
+000408e0: 2e6a 6f69 6e28 7365 6c66 2e67 6574 5f72  .join(self.get_r
+000408f0: 6f69 5f6e 616d 6573 2829 2929 0a0a 2020  oi_names()))..  
+00040900: 2020 6465 6620 6765 745f 6e61 6d65 2873    def get_name(s
+00040910: 656c 6629 3a0a 2020 2020 2020 2020 2727  elf):.        ''
+00040920: 270a 2020 2020 2020 2020 4c6f 6164 2073  '.        Load s
+00040930: 656c 6620 616e 6420 6765 7420 6e61 6d65  elf and get name
+00040940: 2e0a 2020 2020 2020 2020 2727 270a 0a20  ..        '''.. 
+00040950: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
+00040960: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
+00040970: 6e20 2873 656c 662e 6e61 6d65 290a 0a20  n (self.name).. 
+00040980: 2020 2064 6566 2067 6574 5f74 7261 6e73     def get_trans
+00040990: 6c61 7469 6f6e 5f74 6f5f 616c 6967 6e28  lation_to_align(
+000409a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000409b0: 662c 206f 7468 6572 2c20 7a5f 6672 6163  f, other, z_frac
+000409c0: 7469 6f6e 313d 4e6f 6e65 2c20 7a5f 6672  tion1=None, z_fr
+000409d0: 6163 7469 6f6e 323d 4e6f 6e65 293a 0a20  action2=None):. 
+000409e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000409f0: 2020 2044 6574 6572 6d69 6e65 2074 7261     Determine tra
+00040a00: 6e73 6c61 7469 6f6e 2066 6f72 2061 6c69  nslation for ali
+00040a10: 676e 696e 6720 3c73 656c 663e 2074 6f20  gning <self> to 
+00040a20: 3c6f 7468 6572 3e2e 0a0a 2020 2020 2020  <other>...      
+00040a30: 2020 2a2a 5061 7261 6d65 7465 7273 3a2a    **Parameters:*
+00040a40: 2a0a 0a20 2020 2020 2020 206f 7468 6572  *..        other
+00040a50: 203a 2052 4f49 2f53 7472 7563 7475 7265   : ROI/Structure
+00040a60: 5365 742f 6c69 7374 0a20 2020 2020 2020  Set/list.       
+00040a70: 2020 2020 2052 4f49 2077 6974 6820 7768       ROI with wh
+00040a80: 6963 6820 616c 6967 6e6d 656e 7420 6973  ich alignment is
+00040a90: 2074 6f20 6265 2070 6572 666f 726d 6564   to be performed
+00040aa0: 2e20 2054 6869 7320 6361 6e20 6265 0a20  .  This can be. 
+00040ab0: 2020 2020 2020 2020 2020 2073 7065 6369             speci
+00040ac0: 6669 6564 2064 6972 6563 746c 7920 6173  fied directly as
+00040ad0: 2061 2073 696e 676c 6520 524f 492e 2020   a single ROI.  
+00040ae0: 416c 7465 726e 6174 6976 656c 792c 2069  Alternatively, i
+00040af0: 7420 6361 6e0a 2020 2020 2020 2020 2020  t can.          
+00040b00: 2020 6265 2061 2053 7472 7563 7475 7265    be a Structure
+00040b10: 5365 742c 206f 7220 6120 6c69 7374 206f  Set, or a list o
+00040b20: 7220 524f 492f 5374 7275 6374 7572 6553  r ROI/StructureS
+00040b30: 6574 206f 626a 6563 7473 2c0a 2020 2020  et objects,.    
+00040b40: 2020 2020 2020 2020 696e 2077 6869 6368          in which
+00040b50: 2063 6173 6520 7468 6520 696e 6469 7669   case the indivi
+00040b60: 6475 616c 2052 4f49 7320 7769 6c6c 2062  dual ROIs will b
+00040b70: 6520 636f 6d62 696e 6564 2e0a 0a20 2020  e combined...   
+00040b80: 2020 2020 207a 5f66 7261 6374 696f 6e31       z_fraction1
+00040b90: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
+00040ba0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00040bb0: 2020 2050 6f73 6974 696f 6e20 616c 6f6e     Position alon
+00040bc0: 6720 7a20 6178 6973 206f 6620 736c 6963  g z axis of slic
+00040bd0: 6520 7468 726f 7567 6820 3c73 656c 663e  e through <self>
+00040be0: 206f 6e20 7768 6963 680a 2020 2020 2020   on which.      
+00040bf0: 2020 2020 2020 746f 2061 6c69 676e 2e20        to align. 
+00040c00: 2049 6620 4e6f 6e65 2c20 616c 6967 6e6d   If None, alignm
+00040c10: 656e 7420 6973 2074 6f20 7468 6520 6365  ent is to the ce
+00040c20: 6e74 726f 6964 206f 6620 7468 650a 2020  ntroid of the.  
+00040c30: 2020 2020 2020 2020 2020 7768 6f6c 6520            whole 
+00040c40: 524f 4920 766f 6c75 6d65 2e20 204f 7468  ROI volume.  Oth
+00040c50: 6572 7769 7365 2c20 616c 6967 6e6d 656e  erwise, alignmen
+00040c60: 7420 6973 2074 6f20 7468 650a 2020 2020  t is to the.    
+00040c70: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+00040c80: 206f 6620 7468 6520 736c 6963 6520 6174   of the slice at
+00040c90: 2074 6865 2073 7065 6369 6669 6564 2064   the specified d
+00040ca0: 6973 7461 6e63 650a 2020 2020 2020 2020  istance.        
+00040cb0: 2020 2020 6672 6f6d 2074 6865 2052 4f49      from the ROI
+00040cc0: 2773 206d 6f73 742d 696e 6665 7269 6f72  's most-inferior
+00040cd0: 2070 6f69 6e74 3a20 3020 636f 7272 6573   point: 0 corres
+00040ce0: 706f 6e64 7320 746f 0a20 2020 2020 2020  ponds to.       
+00040cf0: 2020 2020 2074 6865 206d 6f73 742d 696e       the most-in
+00040d00: 6665 7269 6f72 2070 6f69 6e74 2028 6c6f  ferior point (lo
+00040d10: 7765 7374 207a 293b 2031 2063 6f72 7265  west z); 1 corre
+00040d20: 7370 6f6e 6473 2074 6f20 7468 650a 2020  sponds to the.  
+00040d30: 2020 2020 2020 2020 2020 6d6f 7374 2d73            most-s
+00040d40: 7570 6572 696f 7220 706f 696e 7420 2868  uperior point (h
+00040d50: 6967 6865 7374 207a 292e 2020 5661 6c75  ighest z).  Valu
+00040d60: 6573 2066 6f72 207a 5f66 7261 6374 696f  es for z_fractio
+00040d70: 6e0a 2020 2020 2020 2020 2020 2020 6f75  n.            ou
+00040d80: 7473 6964 6520 7468 6520 696e 7465 7276  tside the interv
+00040d90: 616c 205b 302c 2031 5d20 7265 7375 6c74  al [0, 1] result
+00040da0: 2069 6e20 6120 5275 6e74 696d 6545 7272   in a RuntimeErr
+00040db0: 6f72 2e0a 0a20 2020 2020 2020 207a 5f66  or...        z_f
+00040dc0: 7261 6374 696f 6e32 203a 2066 6c6f 6174  raction2 : float
+00040dd0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+00040de0: 2020 2020 2020 2020 2020 2050 6f73 6974             Posit
+00040df0: 696f 6e20 616c 6f6e 6720 7a20 6178 6973  ion along z axis
+00040e00: 206f 6620 736c 6963 6520 7468 726f 7567   of slice throug
+00040e10: 6820 3c6f 7468 6572 3e20 6f6e 2077 6869  h <other> on whi
+00040e20: 6368 0a20 2020 2020 2020 2020 2020 2074  ch.            t
+00040e30: 6f20 616c 6967 6e2e 2020 4966 204e 6f6e  o align.  If Non
+00040e40: 652c 2061 6c69 676e 6d65 6e74 2069 7320  e, alignment is 
+00040e50: 746f 2074 6865 2063 656e 7472 6f69 6420  to the centroid 
+00040e60: 6f66 2074 6865 0a20 2020 2020 2020 2020  of the.         
+00040e70: 2020 2077 686f 6c65 2052 4f49 2076 6f6c     whole ROI vol
+00040e80: 756d 652e 2020 4f74 6865 7277 6973 652c  ume.  Otherwise,
+00040e90: 2061 6c69 676e 6d65 6e74 2069 7320 746f   alignment is to
+00040ea0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00040eb0: 2063 656e 7472 6f69 6420 6f66 2074 6865   centroid of the
+00040ec0: 2073 6c69 6365 2061 7420 7468 6520 7370   slice at the sp
+00040ed0: 6563 6966 6965 6420 6469 7374 616e 6365  ecified distance
+00040ee0: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
+00040ef0: 6d20 7468 6520 524f 4927 7320 6d6f 7374  m the ROI's most
+00040f00: 2d69 6e66 6572 696f 7220 706f 696e 743a  -inferior point:
+00040f10: 2030 2063 6f72 7265 7370 6f6e 6473 2074   0 corresponds t
+00040f20: 6f0a 2020 2020 2020 2020 2020 2020 7468  o.            th
+00040f30: 6520 6d6f 7374 2d69 6e66 6572 696f 7220  e most-inferior 
+00040f40: 706f 696e 7420 286c 6f77 6573 7420 7a29  point (lowest z)
+00040f50: 3b20 3120 636f 7272 6573 706f 6e64 7320  ; 1 corresponds 
+00040f60: 746f 2074 6865 0a20 2020 2020 2020 2020  to the.         
+00040f70: 2020 206d 6f73 742d 7375 7065 7269 6f72     most-superior
+00040f80: 2070 6f69 6e74 2028 6869 6768 6573 7420   point (highest 
+00040f90: 7a29 2e20 2056 616c 7565 7320 666f 7220  z).  Values for 
+00040fa0: 7a5f 6672 6163 7469 6f6e 0a20 2020 2020  z_fraction.     
+00040fb0: 2020 2020 2020 206f 7574 7369 6465 2074         outside t
+00040fc0: 6865 2069 6e74 6572 7661 6c20 5b30 2c20  he interval [0, 
+00040fd0: 315d 2072 6573 756c 7420 696e 2061 2052  1] result in a R
+00040fe0: 756e 7469 6d65 4572 726f 722e 0a20 2020  untimeError..   
+00040ff0: 2020 2020 2020 2020 2022 2222 0a20 2020           """.   
+00041000: 2020 2020 2072 6574 7572 6e20 6765 745f       return get_
+00041010: 7472 616e 736c 6174 696f 6e5f 746f 5f61  translation_to_a
+00041020: 6c69 676e 280a 2020 2020 2020 2020 2020  lign(.          
+00041030: 2020 2020 2020 7365 6c66 2c20 6f74 6865        self, othe
+00041040: 722c 207a 5f66 7261 6374 696f 6e31 2c20  r, z_fraction1, 
+00041050: 7a5f 6672 6163 7469 6f6e 3229 0a0a 2020  z_fraction2)..  
+00041060: 2020 6465 6620 6765 745f 636f 6e66 6f72    def get_confor
+00041070: 6d69 7479 5f69 6e64 6578 2873 656c 662c  mity_index(self,
+00041080: 206e 616d 6573 3d4e 6f6e 652c 202a 2a6b   names=None, **k
+00041090: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+000410a0: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
+000410b0: 636f 6e66 6f72 6d69 7479 2069 6e64 6578  conformity index
+000410c0: 2066 6f72 2052 4f49 7320 6f66 2074 6865   for ROIs of the
+000410d0: 2053 7472 7563 7475 7265 5365 742e 0a0a   StructureSet...
+000410e0: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
+000410f0: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
+00041100: 206e 616d 6573 203a 206c 6973 742c 2064   names : list, d
+00041110: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00041120: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
+00041130: 7374 7269 6e67 7320 636f 7272 6573 706f  strings correspo
+00041140: 6e64 696e 6720 746f 2052 4f49 206e 616d  nding to ROI nam
+00041150: 6573 2e20 2049 6620 6e6f 6e2d 6e75 6c6c  es.  If non-null
+00041160: 2c0a 2020 2020 2020 2020 2020 2020 5468  ,.            Th
+00041170: 6520 636f 6e66 6f72 6d69 7479 2069 6e64  e conformity ind
+00041180: 6578 2069 7320 6361 6c63 756c 6174 6564  ex is calculated
+00041190: 2072 656c 6174 6976 6520 666f 7220 7468   relative for th
+000411a0: 6520 524f 4973 0a20 2020 2020 2020 2020  e ROIs.         
+000411b0: 2020 2077 6974 6820 7468 6520 6c69 7374     with the list
+000411c0: 6564 206e 616d 6573 206f 6e6c 792e 2020  ed names only.  
+000411d0: 4f74 6865 7277 6973 652c 2074 6865 2063  Otherwise, the c
+000411e0: 6f6e 666f 726d 6974 790a 2020 2020 2020  onformity.      
+000411f0: 2020 2020 2020 696e 6465 7820 6973 2063        index is c
+00041200: 616c 6375 6c61 7465 6420 7265 6c61 7469  alculated relati
+00041210: 7665 2074 6f20 616c 6c20 524f 4973 2069  ve to all ROIs i
+00041220: 6e20 7468 6520 7374 7275 6374 7572 650a  n the structure.
+00041230: 2020 2020 2020 2020 2020 2020 7365 742e              set.
+00041240: 0a0a 2020 2020 2020 2020 6b77 6172 6773  ..        kwargs
+00041250: 0a20 2020 2020 2020 2020 2020 204b 6579  .            Key
+00041260: 776f 7264 2061 7267 756d 656e 7473 2061  word arguments a
+00041270: 7265 2070 6173 7365 6420 746f 0a20 2020  re passed to.   
+00041280: 2020 2020 2020 2020 2073 6b72 742e 7374           skrt.st
+00041290: 7275 6374 7572 6573 2e67 6574 5f63 6f6e  ructures.get_con
+000412a0: 666f 726d 6974 795f 696e 6465 7828 292e  formity_index().
+000412b0: 2e67 6574 5f73 7572 6661 6365 5f64 6973  .get_surface_dis
+000412c0: 7461 6e63 6573 2829 2e0a 2020 2020 2020  tances()..      
+000412d0: 2020 2020 2020 5365 6520 646f 6375 6d65        See docume
+000412e0: 6e74 6174 696f 6e20 6f66 2074 6869 7320  ntation of this 
+000412f0: 6675 6e63 7469 6f6e 2066 6f72 2070 6172  function for par
+00041300: 616d 6574 6572 2064 6574 6169 6c73 2e0a  ameter details..
+00041310: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00041320: 2020 2020 7265 7475 726e 2067 6574 5f63      return get_c
+00041330: 6f6e 666f 726d 6974 795f 696e 6465 7828  onformity_index(
+00041340: 7365 6c66 2e67 6574 5f72 6f69 7328 6e61  self.get_rois(na
+00041350: 6d65 7329 2c20 2a2a 6b77 6172 6773 290a  mes), **kwargs).
+00041360: 0a20 2020 2064 6566 2067 6574 5f67 656f  .    def get_geo
+00041370: 6d65 7472 7928 0a20 2020 2020 2020 2073  metry(.        s
+00041380: 656c 662c 200a 2020 2020 2020 2020 6e61  elf, .        na
+00041390: 6d65 5f61 735f 696e 6465 783d 5472 7565  me_as_index=True
+000413a0: 2c20 0a20 2020 2020 2020 2068 746d 6c3d  , .        html=
+000413b0: 4661 6c73 652c 200a 2020 2020 2020 2020  False, .        
+000413c0: 636f 6c6f 7265 643d 4661 6c73 652c 0a20  colored=False,. 
+000413d0: 2020 2020 2020 2067 7265 7965 645f 6f75         greyed_ou
+000413e0: 743d 4e6f 6e65 2c0a 2020 2020 2020 2020  t=None,.        
+000413f0: 726f 695f 6b77 6172 6773 3d7b 7d2c 0a20  roi_kwargs={},. 
+00041400: 2020 2020 2020 202a 2a6b 7761 7267 7329         **kwargs)
+00041410: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
+00041420: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
+00041430: 6520 6f66 2067 656f 6d65 7472 6963 2070  e of geometric p
+00041440: 726f 7065 7274 6965 7320 666f 7220 616c  roperties for al
+00041450: 6c20 524f 4973 2e0a 2020 2020 2020 2020  l ROIs..        
+00041460: 4966 206e 6f20 736c 2f69 6478 2f70 6f73  If no sl/idx/pos
+00041470: 2069 7320 6769 7665 6e2c 2074 6865 2063   is given, the c
+00041480: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
+00041490: 6561 6368 2052 4f49 2077 696c 6c20 6265  each ROI will be
+000414a0: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
+000414b0: 2a2a 5061 7261 6d65 7465 7273 2a2a 3a0a  **Parameters**:.
+000414c0: 0a20 2020 2020 2020 206e 616d 655f 6173  .        name_as
+000414d0: 5f69 6e64 6578 203a 2062 6f6f 6c2c 2064  _index : bool, d
+000414e0: 6566 6175 6c74 3d54 7275 650a 2020 2020  efault=True.    
+000414f0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+00041500: 2074 6865 2052 4f49 206e 616d 6573 2077   the ROI names w
+00041510: 696c 6c20 6265 2075 7365 6420 6173 2072  ill be used as r
+00041520: 6f77 2069 6e64 6963 6573 3b20 6f74 6865  ow indices; othe
+00041530: 7277 6973 652c 2074 6865 790a 2020 2020  rwise, they.    
+00041540: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
+00041550: 6769 7665 6e20 7468 6569 7220 6f77 6e20  given their own 
+00041560: 636f 6c75 6d6e 2e0a 0a20 2020 2020 2020  column...       
+00041570: 2068 746d 6c20 3a20 626f 6f6c 2c20 6465   html : bool, de
+00041580: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+00041590: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+000415a0: 2074 6865 2074 6162 6c65 2077 696c 6c20   the table will 
+000415b0: 6265 2063 6f6e 7665 7274 6564 2074 6f20  be converted to 
+000415c0: 4854 4d4c 2074 6578 7420 636f 6c6f 722d  HTML text color-
+000415d0: 636f 6465 6420 6261 7365 640a 2020 2020  coded based.    
+000415e0: 2020 2020 2020 2020 6f6e 2052 4f49 2063          on ROI c
+000415f0: 6f6c 6f72 732e 0a20 2020 2020 2020 2022  olors..        "
+00041600: 2222 0a0a 2020 2020 2020 2020 6966 2068  ""..        if h
+00041610: 746d 6c3a 0a20 2020 2020 2020 2020 2020  tml:.           
+00041620: 206e 616d 655f 6173 5f69 6e64 6578 203d   name_as_index =
+00041630: 2046 616c 7365 0a20 2020 2020 2020 2069   False.        i
+00041640: 6620 6772 6579 6564 5f6f 7574 2069 7320  f greyed_out is 
+00041650: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00041660: 2020 6772 6579 6564 5f6f 7574 203d 205b    greyed_out = [
+00041670: 5d0a 0a20 2020 2020 2020 2072 6f77 7320  ]..        rows 
+00041680: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+00041690: 2072 6f69 2069 6e20 7365 6c66 2e67 6574   roi in self.get
+000416a0: 5f72 6f69 7328 6967 6e6f 7265 5f65 6d70  _rois(ignore_emp
+000416b0: 7479 3d54 7275 6529 3a0a 0a20 2020 2020  ty=True):..     
+000416c0: 2020 2020 2020 2023 2047 6574 2044 6174         # Get Dat
+000416d0: 6146 7261 6d65 2066 6f72 2074 6869 7320  aFrame for this 
+000416e0: 524f 490a 2020 2020 2020 2020 2020 2020  ROI.            
+000416f0: 6466 5f72 6f77 203d 2072 6f69 2e67 6574  df_row = roi.get
+00041700: 5f67 656f 6d65 7472 7928 6e61 6d65 5f61  _geometry(name_a
+00041710: 735f 696e 6465 783d 6e61 6d65 5f61 735f  s_index=name_as_
+00041720: 696e 6465 782c 202a 2a6b 7761 7267 7329  index, **kwargs)
+00041730: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00041740: 5265 706c 6163 6520 616c 6c20 7661 6c75  Replace all valu
+00041750: 6573 2077 6974 6820 222d 2d22 2069 6620  es with "--" if 
+00041760: 6772 6579 696e 6720 6f75 7420 7468 6973  greying out this
+00041770: 2052 4f49 0a20 2020 2020 2020 2020 2020   ROI.           
+00041780: 2069 6620 726f 6920 696e 2067 7265 7965   if roi in greye
+00041790: 645f 6f75 743a 0a20 2020 2020 2020 2020  d_out:.         
+000417a0: 2020 2020 2020 2066 6f72 2063 6f6c 2069         for col i
+000417b0: 6e20 6466 5f72 6f77 2e63 6f6c 756d 6e73  n df_row.columns
+000417c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000417d0: 2020 2020 2020 6966 2063 6f6c 203d 3d20        if col == 
+000417e0: 2252 4f49 223a 200a 2020 2020 2020 2020  "ROI": .        
+000417f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041800: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+00041810: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+00041820: 726f 775b 636f 6c5d 203d 2022 2d2d 220a  row[col] = "--".
+00041830: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+00041840: 6574 2052 4f49 206e 616d 6520 746f 2068  et ROI name to h
+00041850: 6176 6520 636f 6c6f 7265 6420 6261 636b  ave colored back
+00041860: 6772 6f75 6e64 2069 6620 7265 7175 6573  ground if reques
+00041870: 7465 640a 2020 2020 2020 2020 2020 2020  ted.            
+00041880: 6966 2063 6f6c 6f72 6564 3a0a 2020 2020  if colored:.    
+00041890: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
+000418a0: 7220 3d20 726f 692e 6765 745f 636f 6c6f  r = roi.get_colo
+000418b0: 725f 6672 6f6d 5f6b 7761 7267 7328 726f  r_from_kwargs(ro
+000418c0: 695f 6b77 6172 6773 290a 2020 2020 2020  i_kwargs).      
+000418d0: 2020 2020 2020 2020 2020 636f 6c5f 7374            col_st
+000418e0: 7220 3d20 6765 745f 636f 6c6f 7265 645f  r = get_colored_
+000418f0: 726f 695f 7374 7269 6e67 280a 2020 2020  roi_string(.    
+00041900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041910: 2020 2020 726f 692c 2067 7265 793d 2872      roi, grey=(r
+00041920: 6f69 2069 6e20 6772 6579 6564 5f6f 7574  oi in greyed_out
+00041930: 292c 2063 6f6c 6f72 3d63 6f6c 6f72 290a  ), color=color).
+00041940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041950: 6966 206e 616d 655f 6173 5f69 6e64 6578  if name_as_index
+00041960: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00041970: 2020 2020 2020 6466 5f72 6f77 2e72 656e        df_row.ren
+00041980: 616d 6528 7b64 665f 726f 772e 696e 6465  ame({df_row.inde
+00041990: 785b 305d 3a20 636f 6c5f 7374 727d 2c20  x[0]: col_str}, 
+000419a0: 696e 706c 6163 653d 5472 7565 290a 2020  inplace=True).  
+000419b0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000419c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000419d0: 2020 2020 2020 2020 6466 5f72 6f77 2e69          df_row.i
+000419e0: 6c6f 635b 302c 2030 5d20 3d20 636f 6c5f  loc[0, 0] = col_
+000419f0: 7374 720a 0a20 2020 2020 2020 2020 2020  str..           
+00041a00: 2072 6f77 732e 6170 7065 6e64 2864 665f   rows.append(df_
+00041a10: 726f 7729 0a0a 2020 2020 2020 2020 6466  row)..        df
+00041a20: 203d 2070 642e 636f 6e63 6174 2872 6f77   = pd.concat(row
+00041a30: 7329 0a0a 2020 2020 2020 2020 2320 5265  s)..        # Re
+00041a40: 7365 7420 696e 6465 7820 6966 206e 6f74  set index if not
+00041a50: 2075 7369 6e67 2052 4f49 206e 616d 6573   using ROI names
+00041a60: 2061 7320 696e 6465 780a 2020 2020 2020   as index.      
+00041a70: 2020 6966 206e 6f74 206e 616d 655f 6173    if not name_as
+00041a80: 5f69 6e64 6578 3a0a 2020 2020 2020 2020  _index:.        
+00041a90: 2020 2020 6466 203d 2064 662e 7265 7365      df = df.rese
+00041aa0: 745f 696e 6465 7828 6472 6f70 3d54 7275  t_index(drop=Tru
+00041ab0: 6529 0a0a 2020 2020 2020 2020 2320 436f  e)..        # Co
+00041ac0: 6e76 6572 7420 746f 2048 544d 4c20 6966  nvert to HTML if
+00041ad0: 206e 6565 6465 640a 2020 2020 2020 2020   needed.        
+00041ae0: 6966 2068 746d 6c3a 0a20 2020 2020 2020  if html:.       
+00041af0: 2020 2020 2072 6574 7572 6e20 6466 5f74       return df_t
+00041b00: 6f5f 6874 6d6c 2864 6629 0a20 2020 2020  o_html(df).     
+00041b10: 2020 2072 6574 7572 6e20 6466 0a0a 2020     return df..  
+00041b20: 2020 6465 6620 6765 745f 636f 6d70 6172    def get_compar
+00041b30: 6973 6f6e 280a 2020 2020 2020 2020 7365  ison(.        se
+00041b40: 6c66 2c20 0a20 2020 2020 2020 206f 7468  lf, .        oth
+00041b50: 6572 3d4e 6f6e 652c 200a 2020 2020 2020  er=None, .      
+00041b60: 2020 636f 6d70 5f74 7970 653d 2261 7574    comp_type="aut
+00041b70: 6f22 2c20 0a20 2020 2020 2020 2063 6f6e  o", .        con
+00041b80: 7365 6e73 7573 5f74 7970 653d 226d 616a  sensus_type="maj
+00041b90: 6f72 6974 7922 2c20 0a20 2020 2020 2020  ority", .       
+00041ba0: 202a 2a6b 7761 7267 730a 2020 2020 293a   **kwargs.    ):
+00041bb0: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
+00041bc0: 7061 6e64 6173 2044 6174 6146 7261 6d65  pandas DataFrame
+00041bd0: 206f 6620 636f 6d70 6172 6973 6f6e 206d   of comparison m
+00041be0: 6574 7269 6373 2076 7320 6120 7369 6e67  etrics vs a sing
+00041bf0: 6c65 2052 4f49 206f 720a 2020 2020 2020  le ROI or.      
+00041c00: 2020 616e 6f74 6865 7220 5374 7275 6374    another Struct
+00041c10: 7572 6553 6574 2e0a 0a20 2020 2020 2020  ureSet...       
+00041c20: 202a 2a50 6172 616d 6574 6572 732a 2a3a   **Parameters**:
+00041c30: 0a0a 2020 2020 2020 2020 6f74 6865 7220  ..        other 
+00041c40: 3a20 524f 492f 5374 7275 6374 7572 6553  : ROI/StructureS
+00041c50: 6574 2c20 6465 6661 756c 743d 4e6f 6e65  et, default=None
+00041c60: 0a20 2020 2020 2020 2020 2020 204f 626a  .            Obj
+00041c70: 6563 7420 746f 2063 6f6d 7061 7265 206f  ect to compare o
+00041c80: 776e 2052 4f49 7320 7769 7468 2e20 4361  wn ROIs with. Ca
+00041c90: 6e20 6569 7468 6572 2062 6520 6120 7369  n either be a si
+00041ca0: 6e67 6c65 2052 4f49 2c20 7768 6963 680a  ngle ROI, which.
+00041cb0: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
+00041cc0: 2062 6520 636f 6d70 6172 6564 2074 6f20   be compared to 
+00041cd0: 6576 6572 7920 524f 4920 696e 2074 6869  every ROI in thi
+00041ce0: 7320 7374 7275 6374 7572 6520 7365 742c  s structure set,
+00041cf0: 206f 7220 616e 6f74 6865 720a 2020 2020   or another.    
+00041d00: 2020 2020 2020 2020 7374 7275 6374 7572          structur
+00041d10: 6520 7365 742e 2049 6620 4e6f 6e65 2c20  e set. If None, 
+00041d20: 6120 636f 6d70 6172 6973 6f6e 2077 696c  a comparison wil
+00041d30: 6c20 6265 2070 6572 666f 726d 6564 2062  l be performed b
+00041d40: 6574 7765 656e 2074 6865 200a 2020 2020  etween the .    
+00041d50: 2020 2020 2020 2020 524f 4973 206f 6620          ROIs of 
+00041d60: 7468 6973 2073 7472 7563 7475 7265 2073  this structure s
+00041d70: 6574 2e0a 0a20 2020 2020 2020 2063 6f6d  et...        com
+00041d80: 705f 7479 7065 203a 2073 7472 2c20 6465  p_type : str, de
+00041d90: 6661 756c 743d 2261 7574 6f22 0a20 2020  fault="auto".   
+00041da0: 2020 2020 2020 2020 204d 6574 686f 6420           Method 
+00041db0: 666f 7220 7365 6c65 6374 696e 6720 7768  for selecting wh
+00041dc0: 6963 6820 524f 4973 2073 686f 756c 6420  ich ROIs should 
+00041dd0: 6265 2063 6f6d 7061 7265 6420 6966 206f  be compared if o
+00041de0: 7468 6572 3d4e 6f6e 650a 2020 2020 2020  ther=None.      
+00041df0: 2020 2020 2020 6f72 206f 7468 6572 2069        or other i
+00041e00: 7320 6120 5374 7275 6374 7572 6553 6574  s a StructureSet
+00041e10: 2e20 4f70 7469 6f6e 7320 6172 653a 0a0a  . Options are:..
+00041e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041e30: 2d20 2261 6c6c 2220 3a20 636f 6d70 6172  - "all" : compar
+00041e40: 6520 6576 6572 7920 524f 4920 696e 206f  e every ROI in o
+00041e50: 6e65 2073 7472 7563 7475 7265 2073 6574  ne structure set
+00041e60: 2074 6f20 6576 6572 7920 524f 490a 2020   to every ROI.  
+00041e70: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00041e80: 2074 6865 206f 7468 6572 2028 7265 6d6f   the other (remo
+00041e90: 7669 6e67 2063 6f6d 7061 7269 736f 6e73  ving comparisons
+00041ea0: 206f 6620 616e 2052 4f49 2074 6f20 6974   of an ROI to it
+00041eb0: 7365 6c66 292e 0a20 2020 2020 2020 2020  self)..         
+00041ec0: 2020 2020 2020 202d 2022 6279 5f6e 616d         - "by_nam
+00041ed0: 6522 203a 2063 6f6d 7061 7265 2065 7665  e" : compare eve
+00041ee0: 7279 2052 4f49 2069 6e20 6f6e 6520 7374  ry ROI in one st
+00041ef0: 7275 6374 7572 6520 7365 740a 2020 2020  ructure set.    
+00041f00: 2020 2020 2020 2020 2020 2020 746f 2065              to e
+00041f10: 7665 7279 2052 4f49 2069 6e20 7468 6520  very ROI in the 
+00041f20: 6f74 6865 7220 7769 7468 2074 6865 2073  other with the s
+00041f30: 616d 6520 6e61 6d65 2e20 5573 6566 756c  ame name. Useful
+00041f40: 2077 6865 6e0a 2020 2020 2020 2020 2020   when.          
+00041f50: 2020 2020 2020 636f 6d70 6172 696e 6720        comparing 
+00041f60: 7477 6f20 7374 7275 6374 7572 6520 7365  two structure se
+00041f70: 7473 2063 6f6e 7461 696e 696e 6720 524f  ts containing RO
+00041f80: 4973 2077 6974 6820 7468 6520 7361 6d65  Is with the same
+00041f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00041fa0: 206e 616d 6573 2e0a 2020 2020 2020 2020   names..        
+00041fb0: 2020 2020 2020 2020 2d20 2263 6f6e 7365          - "conse
+00041fc0: 6e73 7573 2220 3a20 6966 206f 7468 6572  nsus" : if other
+00041fd0: 3d4e 6f6e 652c 2063 6f6d 7061 7265 2065  =None, compare e
+00041fe0: 6163 6820 524f 4920 696e 2074 6869 7320  ach ROI in this 
+00041ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00042000: 2073 7472 7563 7475 7265 2073 6574 2074   structure set t
+00042010: 6f20 7468 6520 636f 6e73 656e 7375 7320  o the consensus 
+00042020: 6f66 2061 6c6c 206f 7468 6572 2052 4f49  of all other ROI
+00042030: 733b 206f 7468 6572 7769 7365 2c0a 2020  s; otherwise,.  
+00042040: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00042050: 6d70 6172 6520 6561 6368 2052 4f49 2069  mpare each ROI i
+00042060: 6e20 7468 6973 2073 7472 7563 7475 7265  n this structure
+00042070: 2073 6574 2074 6f20 7468 6520 636f 6e73   set to the cons
+00042080: 656e 7375 7320 6f66 0a20 2020 2020 2020  ensus of.       
+00042090: 2020 2020 2020 2020 2061 6c6c 2052 4f49           all ROI
+000420a0: 7320 696e 2074 6865 206f 7468 6572 2073  s in the other s
+000420b0: 7472 7563 7475 7265 2073 6574 2e20 436f  tructure set. Co
+000420c0: 6e73 656e 7375 7320 7479 7065 2069 7320  nsensus type is 
+000420d0: 7365 7420 7669 610a 2020 2020 2020 2020  set via.        
+000420e0: 2020 2020 2020 2020 7468 6520 636f 6e73          the cons
+000420f0: 656e 7375 735f 7479 7065 2061 7267 756d  ensus_type argum
+00042100: 656e 742e 0a20 2020 2020 2020 2020 2020  ent..           
+00042110: 2020 2020 202d 2022 6175 746f 2220 3a20       - "auto" : 
+00042120: 6966 206f 7468 6572 3d4e 6f6e 652c 2075  if other=None, u
+00042130: 7365 2022 616c 6c22 2063 6f6d 7061 7269  se "all" compari
+00042140: 736f 6e2e 204f 7468 6572 7769 7365 2c20  son. Otherwise, 
+00042150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00042160: 2066 6972 7374 206c 6f6f 6b20 666f 7220   first look for 
+00042170: 616e 7920 524f 4973 2077 6974 6820 6d61  any ROIs with ma
+00042180: 7463 6869 6e67 206e 616d 6573 3b20 6966  tching names; if
+00042190: 2061 7420 6c65 6173 7420 6f6e 6520 0a20   at least one . 
+000421a0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000421b0: 6174 6368 696e 6720 7061 6972 2069 7320  atching pair is 
+000421c0: 666f 756e 642c 2063 6f6d 7061 7265 2076  found, compare v
+000421d0: 6961 2074 6865 2022 6279 5f6e 616d 6522  ia the "by_name"
+000421e0: 2063 6f6d 7061 7269 736f 6e20 0a20 2020   comparison .   
+000421f0: 2020 2020 2020 2020 2020 2020 2074 7970               typ
+00042200: 652e 2049 6620 6e6f 206d 6174 6368 6573  e. If no matches
+00042210: 2061 7265 2066 6f75 6e64 2c20 636f 6d70   are found, comp
+00042220: 6172 6520 7669 6120 7468 6520 2261 6c6c  are via the "all
+00042230: 2220 636f 6d70 6172 6973 6f6e 200a 2020  " comparison .  
+00042240: 2020 2020 2020 2020 2020 2020 2020 7479                ty
+00042250: 7065 2e0a 0a20 2020 2020 2020 2063 6f6e  pe...        con
+00042260: 7365 6e73 7573 5f74 7970 6520 3a20 7374  sensus_type : st
+00042270: 722c 2064 6566 6175 6c74 3d22 6d61 6a6f  r, default="majo
+00042280: 7269 7479 2076 6f74 6522 0a20 2020 2020  rity vote".     
+00042290: 2020 2020 2020 204d 6574 686f 6420 666f         Method fo
+000422a0: 7220 6361 6c63 756c 6174 696e 6720 636f  r calculating co
+000422b0: 6e73 656e 7375 7320 6f66 2052 4f49 7320  nsensus of ROIs 
+000422c0: 6966 2075 7369 6e67 2074 6865 2022 636f  if using the "co
+000422d0: 6e73 656e 7375 7322 0a20 2020 2020 2020  nsensus".       
+000422e0: 2020 2020 2063 6f6d 7061 7269 736f 6e20       comparison 
+000422f0: 7479 7065 2e20 4f70 7469 6f6e 7320 6172  type. Options ar
+00042300: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
+00042310: 2020 2020 2d20 226d 616a 6f72 6974 7922      - "majority"
+00042320: 203a 2075 7365 206d 616a 6f72 6974 7920   : use majority 
+00042330: 766f 7465 206f 6620 524f 4973 2028 692e  vote of ROIs (i.
+00042340: 652e 2076 6f78 656c 7320 7768 6572 650a  e. voxels where.
+00042350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042360: 6174 206c 6561 7374 2068 616c 6620 6f66  at least half of
+00042370: 2074 6865 2052 4f49 7320 6578 6973 7429   the ROIs exist)
+00042380: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00042390: 2020 2d20 226f 7665 726c 6170 2220 3a20    - "overlap" : 
+000423a0: 7573 6520 6f76 6572 6c61 7020 6f66 2052  use overlap of R
+000423b0: 4f49 732e 0a20 2020 2020 2020 2020 2020  OIs..           
+000423c0: 2020 2020 202d 2022 7375 6d22 203a 2075       - "sum" : u
+000423d0: 7365 2073 756d 206f 6620 524f 4973 2e0a  se sum of ROIs..
+000423e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000423f0: 2d20 2273 7461 706c 6522 203a 2075 7365  - "staple" : use
+00042400: 2074 6865 2053 5441 504c 4520 616c 676f   the STAPLE algo
+00042410: 7269 7468 6d20 746f 2063 616c 6375 6c61  rithm to calcula
+00042420: 7465 2063 6f6e 7365 6e73 7573 2e0a 0a20  te consensus... 
+00042430: 2020 2020 2020 2068 746d 6c20 3a20 626f         html : bo
+00042440: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
+00042450: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+00042460: 2054 7275 652c 2074 6865 2074 6162 6c65   True, the table
+00042470: 2077 696c 6c20 6265 2063 6f6e 7665 7274   will be convert
+00042480: 6564 2074 6f20 4854 4d4c 2074 6578 7420  ed to HTML text 
+00042490: 636f 6c6f 722d 636f 6465 6420 6261 7365  color-coded base
+000424a0: 640a 2020 2020 2020 2020 2020 2020 6f6e  d.            on
+000424b0: 2052 4f49 2063 6f6c 6f72 732e 0a0a 2020   ROI colors...  
+000424c0: 2020 2020 2020 6772 6579 6564 5f6f 7574        greyed_out
+000424d0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+000424e0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+000424f0: 2020 4c69 7374 206f 6620 524f 4973 2074    List of ROIs t
+00042500: 6861 7420 7368 6f75 6c64 2062 6520 6772  hat should be gr
+00042510: 6579 6564 206f 7574 2028 6769 7665 6e20  eyed out (given 
+00042520: 6120 6772 6579 2062 6163 6b67 726f 756e  a grey backgroun
+00042530: 640a 2020 2020 2020 2020 2020 2020 746f  d.            to
+00042540: 2074 6865 6972 2074 6578 7429 2069 6620   their text) if 
+00042550: 7265 7475 726e 696e 6720 616e 2048 544d  returning an HTM
+00042560: 4c20 7374 7269 6e67 2e0a 0a20 2020 2020  L string...     
+00042570: 2020 2060 2a2a 606b 7761 7267 7320 3a20     `**`kwargs : 
+00042580: 0a20 2020 2020 2020 2020 2020 204b 6579  .            Key
+00042590: 776f 7264 2061 7267 7320 746f 2070 6173  word args to pas
+000425a0: 7320 746f 2052 4f49 2e67 6574 5f63 6f6d  s to ROI.get_com
+000425b0: 7061 7269 736f 6e28 292e 2053 6565 200a  parison(). See .
+000425c0: 2020 2020 2020 2020 2020 2020 524f 492e              ROI.
+000425d0: 6765 745f 636f 6d70 6172 6973 6f6e 2829  get_comparison()
+000425e0: 2064 6f63 756d 656e 7461 7469 6f6e 2066   documentation f
+000425f0: 6f72 2064 6574 6169 6c73 2e0a 2020 2020  or details..    
+00042600: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00042610: 2064 6673 203d 205b 5d0a 0a20 2020 2020   dfs = []..     
+00042620: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00042630: 286f 7468 6572 2c20 524f 4929 3a0a 2020  (other, ROI):.  
+00042640: 2020 2020 2020 2020 2020 7061 6972 7320            pairs 
+00042650: 3d20 5b28 726f 692c 206f 7468 6572 2920  = [(roi, other) 
+00042660: 666f 7220 726f 6920 696e 2073 656c 662e  for roi in self.
+00042670: 6765 745f 726f 6973 2869 676e 6f72 655f  get_rois(ignore_
+00042680: 656d 7074 793d 5472 7565 295d 0a20 2020  empty=True)].   
+00042690: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+000426a0: 616e 6365 286f 7468 6572 2c20 5374 7275  ance(other, Stru
+000426b0: 6374 7572 6553 6574 2920 6f72 206f 7468  ctureSet) or oth
+000426c0: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
+000426d0: 2020 2020 2020 2020 7061 6972 7320 3d20          pairs = 
+000426e0: 7365 6c66 2e67 6574 5f63 6f6d 7061 7269  self.get_compari
+000426f0: 736f 6e5f 7061 6972 7328 6f74 6865 722c  son_pairs(other,
+00042700: 2063 6f6d 705f 7479 7065 2c20 636f 6e73   comp_type, cons
+00042710: 656e 7375 735f 7479 7065 290a 2020 2020  ensus_type).    
+00042720: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00042730: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
+00042740: 4572 726f 7228 223c 6f74 6865 723e 206d  Error("<other> m
+00042750: 7573 7420 6265 2052 4f49 206f 7220 5374  ust be ROI or St
+00042760: 7275 6374 7572 6553 6574 2122 290a 0a20  ructureSet!").. 
+00042770: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+00042780: 6d70 6172 655f 726f 695f 7061 6972 7328  mpare_roi_pairs(
+00042790: 7061 6972 732c 202a 2a6b 7761 7267 7329  pairs, **kwargs)
+000427a0: 0a0a 2020 2020 6465 6620 6765 745f 636f  ..    def get_co
+000427b0: 6d70 6172 6973 6f6e 5f70 6169 7273 2873  mparison_pairs(s
+000427c0: 656c 662c 206f 7468 6572 3d4e 6f6e 652c  elf, other=None,
+000427d0: 2063 6f6d 705f 7479 7065 3d22 6175 746f   comp_type="auto
+000427e0: 222c 200a 2020 2020 2020 2020 2020 2020  ", .            
+000427f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042800: 2063 6f6e 7365 6e73 7573 5f74 7970 653d   consensus_type=
+00042810: 226d 616a 6f72 6974 7922 2c20 0a20 2020  "majority", .   
+00042820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042830: 2020 2020 2020 2020 2020 636f 6e73 656e            consen
+00042840: 7375 735f 636f 6c6f 723d 2262 6c75 6522  sus_color="blue"
+00042850: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+00042860: 7420 6c69 7374 206f 6620 524f 4973 2074  t list of ROIs t
+00042870: 6f20 636f 6d70 6172 6520 7769 7468 206f  o compare with o
+00042880: 6e65 2061 6e6f 7468 6572 2e22 2222 0a0a  ne another."""..
+00042890: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+000428a0: 636f 6d70 5f74 7970 6520 6973 2076 616c  comp_type is val
+000428b0: 6964 0a20 2020 2020 2020 2076 616c 6964  id.        valid
+000428c0: 5f63 6f6d 705f 7479 7065 7320 3d20 5b22  _comp_types = ["
+000428d0: 616c 6c22 2c20 2262 795f 6e61 6d65 222c  all", "by_name",
+000428e0: 2022 636f 6e73 656e 7375 7322 2c20 2261   "consensus", "a
+000428f0: 7574 6f22 5d0a 2020 2020 2020 2020 6966  uto"].        if
+00042900: 2063 6f6d 705f 7479 7065 206e 6f74 2069   comp_type not i
+00042910: 6e20 7661 6c69 645f 636f 6d70 5f74 7970  n valid_comp_typ
+00042920: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00042930: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00042940: 2866 2255 6e72 6563 6f67 6e69 7365 6420  (f"Unrecognised 
+00042950: 636f 6d70 6172 6973 6f6e 2074 7970 6520  comparison type 
+00042960: 7b63 6f6d 705f 7479 7065 7d22 290a 0a20  {comp_type}").. 
+00042970: 2020 2020 2020 2023 2043 6f6e 7365 6e73         # Consens
+00042980: 7573 2063 6f6d 7061 7269 736f 6e0a 2020  us comparison.  
+00042990: 2020 2020 2020 6966 2063 6f6d 705f 7479        if comp_ty
+000429a0: 7065 203d 3d20 2263 6f6e 7365 6e73 7573  pe == "consensus
+000429b0: 223a 0a20 2020 2020 2020 2020 2020 200a  ":.            .
+000429c0: 2020 2020 2020 2020 2020 2020 2320 4966              # If
+000429d0: 2063 6f6d 7061 7269 6e67 2074 6f20 616e   comparing to an
+000429e0: 6f74 6865 7220 5374 7275 6374 7572 6553  other StructureS
+000429f0: 6574 2c20 7461 6b65 2063 6f6e 7365 6e73  et, take consens
+00042a00: 7573 206f 6620 7468 6174 200a 2020 2020  us of that .    
+00042a10: 2020 2020 2020 2020 2320 656e 7469 7265          # entire
+00042a20: 2053 7472 7563 7475 7265 5365 740a 2020   StructureSet.  
+00042a30: 2020 2020 2020 2020 2020 6966 206f 7468            if oth
+00042a40: 6572 2069 7320 6e6f 7420 4e6f 6e65 3a0a  er is not None:.
+00042a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042a60: 636f 6e73 656e 7375 7320 3d20 6f74 6865  consensus = othe
+00042a70: 722e 6765 745f 636f 6e73 656e 7375 7328  r.get_consensus(
+00042a80: 636f 6e73 656e 7375 735f 7479 7065 2c20  consensus_type, 
+00042a90: 636f 6c6f 723d 636f 6e73 656e 7375 735f  color=consensus_
+00042aa0: 636f 6c6f 7229 0a20 2020 2020 2020 2020  color).         
+00042ab0: 2020 2020 2020 2072 6574 7572 6e20 5b28         return [(
+00042ac0: 726f 692c 2063 6f6e 7365 6e73 7573 2920  roi, consensus) 
+00042ad0: 666f 7220 726f 6920 696e 2073 656c 662e  for roi in self.
+00042ae0: 6765 745f 726f 6973 2869 676e 6f72 655f  get_rois(ignore_
+00042af0: 656d 7074 793d 5472 7565 295d 0a0a 2020  empty=True)]..  
+00042b00: 2020 2020 2020 2020 2020 2320 4f74 6865            # Othe
+00042b10: 7277 6973 652c 2063 6f6d 7061 7265 2065  rwise, compare e
+00042b20: 6163 6820 524f 4920 746f 2063 6f6e 7365  ach ROI to conse
+00042b30: 6e73 7573 206f 6620 6f74 6865 7273 0a20  nsus of others. 
+00042b40: 2020 2020 2020 2020 2020 2070 6169 7273             pairs
+00042b50: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+00042b60: 2020 666f 7220 726f 6920 696e 2073 656c    for roi in sel
+00042b70: 662e 6765 745f 726f 6973 2869 676e 6f72  f.get_rois(ignor
+00042b80: 655f 656d 7074 793d 5472 7565 293a 0a20  e_empty=True):. 
+00042b90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00042ba0: 6169 7273 2e61 7070 656e 6428 2872 6f69  airs.append((roi
+00042bb0: 2c20 7365 6c66 2e67 6574 5f63 6f6e 7365  , self.get_conse
+00042bc0: 6e73 7573 2863 6f6e 7365 6e73 7573 5f74  nsus(consensus_t
+00042bd0: 7970 652c 200a 2020 2020 2020 2020 2020  ype, .          
+00042be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042c00: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
+00042c10: 723d 636f 6e73 656e 7375 735f 636f 6c6f  r=consensus_colo
+00042c20: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00042c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042c50: 2020 2020 2020 2020 2065 7863 6c75 6465           exclude
+00042c60: 3d72 6f69 2e6e 616d 6529 2929 0a20 2020  =roi.name))).   
+00042c70: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00042c80: 7061 6972 730a 0a20 2020 2020 2020 2023  pairs..        #
+00042c90: 2053 6574 2064 6566 6175 6c74 2062 6568   Set default beh
+00042ca0: 6176 696f 7572 2074 6f20 2261 6c6c 2220  aviour to "all" 
+00042cb0: 6966 206f 7468 6572 2069 7320 4e6f 6e65  if other is None
+00042cc0: 0a20 2020 2020 2020 2069 6620 6f74 6865  .        if othe
+00042cd0: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
+00042ce0: 2020 2020 2020 206f 7468 6572 203d 2073         other = s
+00042cf0: 656c 660a 2020 2020 2020 2020 2020 2020  elf.            
+00042d00: 6966 2063 6f6d 705f 7479 7065 203d 3d20  if comp_type == 
+00042d10: 2261 7574 6f22 3a0a 2020 2020 2020 2020  "auto":.        
+00042d20: 2020 2020 2020 2020 636f 6d70 5f74 7970          comp_typ
+00042d30: 6520 3d20 2261 6c6c 220a 0a20 2020 2020  e = "all"..     
+00042d40: 2020 2023 2043 6865 636b 2066 6f72 2052     # Check for R
+00042d50: 4f49 7320 7769 7468 206d 6174 6368 696e  OIs with matchin
+00042d60: 6720 6e61 6d65 7320 6966 2075 7369 6e67  g names if using
+00042d70: 2022 6175 746f 2220 6f72 2022 6279 5f6e   "auto" or "by_n
+00042d80: 616d 6522 0a20 2020 2020 2020 206d 6174  ame".        mat
+00042d90: 6368 6573 203d 205b 5d0a 2020 2020 2020  ches = [].      
+00042da0: 2020 6966 2063 6f6d 705f 7479 7065 2069    if comp_type i
+00042db0: 6e20 5b22 6175 746f 222c 2022 6279 5f6e  n ["auto", "by_n
+00042dc0: 616d 6522 5d3a 0a20 2020 2020 2020 2020  ame"]:.         
+00042dd0: 2020 206d 6174 6368 6573 203d 205b 0a20     matches = [. 
+00042de0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00042df0: 2066 6f72 2073 2069 6e20 7365 6c66 2e67   for s in self.g
+00042e00: 6574 5f72 6f69 5f6e 616d 6573 2869 676e  et_roi_names(ign
+00042e10: 6f72 655f 656d 7074 793d 5472 7565 290a  ore_empty=True).
+00042e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042e30: 6966 2073 2069 6e20 6f74 6865 722e 6765  if s in other.ge
+00042e40: 745f 726f 695f 6e61 6d65 7328 6967 6e6f  t_roi_names(igno
+00042e50: 7265 5f65 6d70 7479 3d54 7275 6529 0a20  re_empty=True). 
+00042e60: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+00042e70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00042e80: 6c65 6e28 6d61 7463 6865 7329 206f 7220  len(matches) or 
+00042e90: 636f 6d70 5f74 7970 6520 3d3d 2022 6279  comp_type == "by
+00042ea0: 5f6e 616d 6522 3a0a 2020 2020 2020 2020  _name":.        
+00042eb0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+00042ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00042ed0: 2020 2020 2028 7365 6c66 2e67 6574 5f72       (self.get_r
+00042ee0: 6f69 286e 616d 6529 2c20 6f74 6865 722e  oi(name), other.
+00042ef0: 6765 745f 726f 6928 6e61 6d65 2929 2066  get_roi(name)) f
+00042f00: 6f72 206e 616d 6520 696e 206d 6174 6368  or name in match
+00042f10: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+00042f20: 2020 205d 0a0a 2020 2020 2020 2020 2320     ]..        # 
+00042f30: 4f74 6865 7277 6973 652c 2070 6169 7220  Otherwise, pair 
+00042f40: 6561 6368 2052 4f49 2077 6974 6820 6576  each ROI with ev
+00042f50: 6572 7920 6f74 6865 7220 2865 786c 6375  ery other (exlcu
+00042f60: 6469 6e67 2070 6169 7273 206f 6620 7468  ding pairs of th
+00042f70: 6520 7361 6d65 0a20 2020 2020 2020 2023  e same.        #
+00042f80: 2052 4f49 290a 2020 2020 2020 2020 7061   ROI).        pa
+00042f90: 6972 7320 3d20 5b5d 0a20 2020 2020 2020  irs = [].       
+00042fa0: 2066 6f72 2072 6f69 3120 696e 2073 656c   for roi1 in sel
+00042fb0: 662e 6765 745f 726f 6973 2869 676e 6f72  f.get_rois(ignor
+00042fc0: 655f 656d 7074 793d 5472 7565 293a 0a20  e_empty=True):. 
+00042fd0: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
+00042fe0: 6f69 3220 696e 206f 7468 6572 2e67 6574  oi2 in other.get
+00042ff0: 5f72 6f69 7328 6967 6e6f 7265 5f65 6d70  _rois(ignore_emp
+00043000: 7479 3d54 7275 6529 3a0a 2020 2020 2020  ty=True):.      
+00043010: 2020 2020 2020 2020 2020 6966 2072 6f69            if roi
+00043020: 3120 6973 206e 6f74 2072 6f69 3220 616e  1 is not roi2 an
+00043030: 6420 2872 6f69 322c 2072 6f69 3129 206e  d (roi2, roi1) n
+00043040: 6f74 2069 6e20 7061 6972 733a 0a20 2020  ot in pairs:.   
+00043050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043060: 2070 6169 7273 2e61 7070 656e 6428 2872   pairs.append((r
+00043070: 6f69 312c 2072 6f69 3229 290a 0a20 2020  oi1, roi2))..   
+00043080: 2020 2020 2072 6574 7572 6e20 7061 6972       return pair
+00043090: 730a 0a20 2020 2064 6566 2067 6574 5f6d  s..    def get_m
+000430a0: 6964 5f69 6478 2873 656c 662c 2076 6965  id_idx(self, vie
+000430b0: 773d 2278 2d79 2229 3a0a 2020 2020 2020  w="x-y"):.      
+000430c0: 2020 2222 2252 6574 7572 6e20 7468 6520    """Return the 
+000430d0: 6172 7261 7920 696e 6465 7820 6f66 2074  array index of t
+000430e0: 6865 2073 6c69 6365 2074 6861 7420 636f  he slice that co
+000430f0: 6e74 6169 6e73 2074 6865 206d 6f73 7420  ntains the most 
+00043100: 524f 4973 2e22 2222 0a0a 2020 2020 2020  ROIs."""..      
+00043110: 2020 696e 6469 6365 7320 3d20 5b5d 0a20    indices = []. 
+00043120: 2020 2020 2020 2066 6f72 2072 6f69 2069         for roi i
+00043130: 6e20 7365 6c66 2e67 6574 5f72 6f69 7328  n self.get_rois(
+00043140: 6967 6e6f 7265 5f65 6d70 7479 3d54 7275  ignore_empty=Tru
+00043150: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00043160: 696e 6469 6365 732e 6578 7465 6e64 2872  indices.extend(r
+00043170: 6f69 2e67 6574 5f69 6e64 6963 6573 2876  oi.get_indices(v
+00043180: 6965 7729 290a 2020 2020 2020 2020 7265  iew)).        re
+00043190: 7475 726e 206e 702e 6269 6e63 6f75 6e74  turn np.bincount
+000431a0: 2869 6e64 6963 6573 292e 6172 676d 6178  (indices).argmax
+000431b0: 2829 0a0a 2020 2020 6465 6620 706c 6f74  ()..    def plot
+000431c0: 5f63 6f6d 7061 7269 736f 6e73 280a 2020  _comparisons(.  
+000431d0: 2020 2020 2020 7365 6c66 2c20 6f74 6865        self, othe
+000431e0: 723d 4e6f 6e65 2c20 636f 6d70 5f74 7970  r=None, comp_typ
+000431f0: 653d 2261 7574 6f22 2c20 6f75 7464 6972  e="auto", outdir
+00043200: 3d4e 6f6e 652c 206c 6567 656e 643d 5472  =None, legend=Tr
+00043210: 7565 2c20 0a20 2020 2020 2020 206e 616d  ue, .        nam
+00043220: 6573 3d4e 6f6e 652c 206c 6567 656e 645f  es=None, legend_
+00043230: 6262 6f78 5f74 6f5f 616e 6368 6f72 3d4e  bbox_to_anchor=N
+00043240: 6f6e 652c 206c 6567 656e 645f 6c6f 633d  one, legend_loc=
+00043250: 226c 6f77 6572 206c 6566 7422 2c0a 2020  "lower left",.  
+00043260: 2020 2020 2020 2a2a 6b77 6172 6773 0a20        **kwargs. 
+00043270: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+00043280: 2250 6c6f 7420 636f 6d70 6172 6973 6f6e  "Plot comparison
+00043290: 2070 6169 7273 2e22 2222 0a0a 2020 2020   pairs."""..    
+000432a0: 2020 2020 6966 206f 7574 6469 7220 616e      if outdir an
+000432b0: 6420 6e6f 7420 6f73 2e70 6174 682e 6578  d not os.path.ex
+000432c0: 6973 7473 286f 7574 6469 7229 3a0a 2020  ists(outdir):.  
+000432d0: 2020 2020 2020 2020 2020 6f73 2e6d 616b            os.mak
+000432e0: 6564 6972 7328 6f75 7464 6972 290a 0a20  edirs(outdir).. 
+000432f0: 2020 2020 2020 2066 6f72 2072 6f69 312c         for roi1,
+00043300: 2072 6f69 3220 696e 2073 656c 662e 6765   roi2 in self.ge
+00043310: 745f 636f 6d70 6172 6973 6f6e 5f70 6169  t_comparison_pai
+00043320: 7273 286f 7468 6572 2c20 636f 6d70 5f74  rs(other, comp_t
+00043330: 7970 6529 3a0a 0a20 2020 2020 2020 2020  ype):..         
+00043340: 2020 206f 7574 6e61 6d65 203d 204e 6f6e     outname = Non
+00043350: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+00043360: 206f 7574 6469 723a 0a20 2020 2020 2020   outdir:.       
+00043370: 2020 2020 2020 2020 2063 6f6d 705f 6e61           comp_na
+00043380: 6d65 203d 2072 6f69 312e 6765 745f 636f  me = roi1.get_co
+00043390: 6d70 6172 6973 6f6e 5f6e 616d 6528 726f  mparison_name(ro
+000433a0: 6932 2c20 5472 7565 290a 2020 2020 2020  i2, True).      
+000433b0: 2020 2020 2020 2020 2020 6f75 746e 616d            outnam
+000433c0: 6520 3d20 6f73 2e70 6174 682e 6a6f 696e  e = os.path.join
+000433d0: 286f 7574 6469 722c 2066 227b 636f 6d70  (outdir, f"{comp
+000433e0: 5f6e 616d 657d 2e70 6e67 2229 0a0a 2020  _name}.png")..  
+000433f0: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
+00043400: 6573 2069 7320 4e6f 6e65 2061 6e64 2072  es is None and r
+00043410: 6f69 312e 6e61 6d65 203d 3d20 726f 6932  oi1.name == roi2
+00043420: 2e6e 616d 653a 0a20 2020 2020 2020 2020  .name:.         
+00043430: 2020 2020 2020 206e 616d 6573 203d 205b         names = [
+00043440: 7365 6c66 2e6e 616d 652c 206f 7468 6572  self.name, other
+00043450: 2e6e 616d 655d 0a0a 2020 2020 2020 2020  .name]..        
+00043460: 2020 2020 726f 6931 2e70 6c6f 745f 636f      roi1.plot_co
+00043470: 6d70 6172 6973 6f6e 280a 2020 2020 2020  mparison(.      
+00043480: 2020 2020 2020 2020 2020 726f 6932 2c20            roi2, 
+00043490: 6c65 6765 6e64 3d6c 6567 656e 642c 2073  legend=legend, s
+000434a0: 6176 655f 6173 3d6f 7574 6e61 6d65 2c20  ave_as=outname, 
+000434b0: 6e61 6d65 733d 6e61 6d65 732c 0a20 2020  names=names,.   
+000434c0: 2020 2020 2020 2020 2020 2020 206c 6567               leg
+000434d0: 656e 645f 6262 6f78 5f74 6f5f 616e 6368  end_bbox_to_anch
+000434e0: 6f72 3d6c 6567 656e 645f 6262 6f78 5f74  or=legend_bbox_t
+000434f0: 6f5f 616e 6368 6f72 2c0a 2020 2020 2020  o_anchor,.      
+00043500: 2020 2020 2020 2020 2020 6c65 6765 6e64            legend
+00043510: 5f6c 6f63 3d6c 6567 656e 645f 6c6f 632c  _loc=legend_loc,
+00043520: 202a 2a6b 7761 7267 730a 2020 2020 2020   **kwargs.      
+00043530: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00043540: 2070 6c6f 745f 7375 7266 6163 655f 6469   plot_surface_di
+00043550: 7374 616e 6365 7328 0a20 2020 2020 2020  stances(.       
+00043560: 2073 656c 662c 206f 7468 6572 2c20 6f75   self, other, ou
+00043570: 7464 6972 3d4e 6f6e 652c 2073 6967 6e65  tdir=None, signe
+00043580: 643d 4661 6c73 652c 2063 6f6d 705f 7479  d=False, comp_ty
+00043590: 7065 3d22 6175 746f 222c 202a 2a6b 7761  pe="auto", **kwa
+000435a0: 7267 730a 2020 2020 293a 0a20 2020 2020  rgs.    ):.     
+000435b0: 2020 2022 2222 506c 6f74 2073 7572 6661     """Plot surfa
+000435c0: 6365 2064 6973 7461 6e63 6573 2066 6f72  ce distances for
+000435d0: 2061 6c6c 2052 4f49 2070 6169 7273 2e22   all ROI pairs."
+000435e0: 2222 0a0a 2020 2020 2020 2020 6966 206e  ""..        if n
+000435f0: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
+00043600: 7328 6f75 7464 6972 293a 0a20 2020 2020  s(outdir):.     
+00043610: 2020 2020 2020 206f 732e 6d61 6b65 6469         os.makedi
+00043620: 7273 286f 7574 6469 7229 0a0a 2020 2020  rs(outdir)..    
+00043630: 2020 2020 666f 7220 726f 6931 2c20 726f      for roi1, ro
+00043640: 6932 2069 6e20 7365 6c66 2e67 6574 5f63  i2 in self.get_c
+00043650: 6f6d 7061 7269 736f 6e5f 7061 6972 7328  omparison_pairs(
+00043660: 6f74 6865 722c 2063 6f6d 705f 7479 7065  other, comp_type
+00043670: 293a 0a20 2020 2020 2020 2020 2020 2063  ):.            c
+00043680: 6f6d 705f 6e61 6d65 203d 2072 6f69 312e  omp_name = roi1.
+00043690: 6765 745f 636f 6d70 6172 6973 6f6e 5f6e  get_comparison_n
+000436a0: 616d 6528 726f 6932 2c20 5472 7565 290a  ame(roi2, True).
+000436b0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+000436c0: 7574 6469 723a 0a20 2020 2020 2020 2020  utdir:.         
+000436d0: 2020 2020 2020 206f 7574 6e61 6d65 203d         outname =
+000436e0: 206f 732e 7061 7468 2e6a 6f69 6e28 6f75   os.path.join(ou
+000436f0: 7464 6972 2c20 6622 7b63 6f6d 705f 6e61  tdir, f"{comp_na
+00043700: 6d65 7d2e 706e 6722 290a 2020 2020 2020  me}.png").      
+00043710: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00043720: 2020 2020 2020 2020 2020 2020 6f75 746e              outn
+00043730: 616d 6520 3d20 4e6f 6e65 0a20 2020 2020  ame = None.     
+00043740: 2020 2020 2020 2072 6f69 312e 706c 6f74         roi1.plot
+00043750: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
+00043760: 6573 2872 6f69 322c 2073 6967 6e65 643d  es(roi2, signed=
+00043770: 7369 676e 6564 2c20 7361 7665 5f61 733d  signed, save_as=
+00043780: 6f75 746e 616d 652c 202a 2a6b 7761 7267  outname, **kwarg
+00043790: 7329 0a0a 2020 2020 6465 6620 7772 6974  s)..    def writ
+000437a0: 6528 7365 6c66 2c20 6f75 746e 616d 653d  e(self, outname=
+000437b0: 4e6f 6e65 2c20 6f75 7464 6972 3d22 2e22  None, outdir="."
+000437c0: 2c20 6578 743d 4e6f 6e65 2c20 6f76 6572  , ext=None, over
+000437d0: 7772 6974 653d 4661 6c73 652c 0a20 2020  write=False,.   
+000437e0: 2020 2020 2020 2020 2068 6561 6465 725f           header_
+000437f0: 736f 7572 6365 3d4e 6f6e 652c 2070 6174  source=None, pat
+00043800: 6965 6e74 5f69 643d 4e6f 6e65 2c20 6d6f  ient_id=None, mo
+00043810: 6461 6c69 7479 3d4e 6f6e 652c 0a20 2020  dality=None,.   
+00043820: 2020 2020 2020 2020 2072 6f6f 745f 7569           root_ui
+00043830: 643d 4e6f 6e65 2c20 7665 7262 6f73 653d  d=None, verbose=
+00043840: 5472 7565 2c20 6865 6164 6572 5f65 7874  True, header_ext
+00043850: 7261 733d 7b7d 2c20 2a2a 6b77 6172 6773  ras={}, **kwargs
+00043860: 293a 0a20 2020 2020 2020 2022 2222 5772  ):.        """Wr
+00043870: 6974 6520 746f 2061 2064 6963 6f6d 2053  ite to a dicom S
+00043880: 7472 7563 7475 7265 5365 7420 6669 6c65  tructureSet file
+00043890: 206f 7220 6469 7265 6374 6f72 7920 6f66   or directory of
+000438a0: 206e 6966 7469 2066 696c 6573 2e22 2222   nifti files."""
+000438b0: 0a0a 2020 2020 2020 2020 6966 2065 7874  ..        if ext
+000438c0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+000438d0: 206e 6f74 2065 7874 2e73 7461 7274 7377   not ext.startsw
+000438e0: 6974 6828 222e 2229 3a0a 2020 2020 2020  ith("."):.      
+000438f0: 2020 2020 2020 6578 7420 3d20 6622 2e7b        ext = f".{
+00043900: 6578 747d 220a 0a20 2020 2020 2020 2023  ext}"..        #
+00043910: 2043 6865 636b 2077 6865 7468 6572 2074   Check whether t
+00043920: 6f20 7772 6974 6520 746f 2064 6963 6f6d  o write to dicom
+00043930: 2066 696c 650a 2020 2020 2020 2020 6966   file.        if
+00043940: 2069 7369 6e73 7461 6e63 6528 6f75 746e   isinstance(outn
+00043950: 616d 652c 2073 7472 2920 616e 6420 6f75  ame, str) and ou
+00043960: 746e 616d 652e 656e 6473 7769 7468 2822  tname.endswith("
+00043970: 2e64 636d 2229 3a0a 2020 2020 2020 2020  .dcm"):.        
+00043980: 2020 2020 6578 7420 3d20 222e 6463 6d22      ext = ".dcm"
+00043990: 0a0a 2020 2020 2020 2020 6966 2065 7874  ..        if ext
+000439a0: 203d 3d20 222e 6463 6d22 3a0a 2020 2020   == ".dcm":.    
+000439b0: 2020 2020 2020 2020 6469 636f 6d5f 7772          dicom_wr
+000439c0: 6974 6572 203d 2044 6963 6f6d 5772 6974  iter = DicomWrit
+000439d0: 6572 280a 2020 2020 2020 2020 2020 2020  er(.            
+000439e0: 2020 2020 6f75 7464 6972 3d6f 7574 6469      outdir=outdi
+000439f0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00043a00: 2020 2064 6174 613d 7365 6c66 2c0a 2020     data=self,.  
+00043a10: 2020 2020 2020 2020 2020 2020 2020 6166                af
+00043a20: 6669 6e65 3d4e 6f6e 652c 0a20 2020 2020  fine=None,.     
+00043a30: 2020 2020 2020 2020 2020 206f 7665 7277             overw
+00043a40: 7269 7465 3d6f 7665 7277 7269 7465 2c0a  rite=overwrite,.
+00043a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043a60: 6865 6164 6572 5f73 6f75 7263 653d 6865  header_source=he
+00043a70: 6164 6572 5f73 6f75 7263 652c 0a20 2020  ader_source,.   
+00043a80: 2020 2020 2020 2020 2020 2020 206f 7269               ori
+00043a90: 656e 7461 7469 6f6e 3d4e 6f6e 652c 0a20  entation=None,. 
+00043aa0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00043ab0: 6174 6965 6e74 5f69 643d 7061 7469 656e  atient_id=patien
+00043ac0: 745f 6964 2c0a 2020 2020 2020 2020 2020  t_id,.          
+00043ad0: 2020 2020 2020 6d6f 6461 6c69 7479 3d27        modality='
+00043ae0: 5254 5354 5255 4354 272c 0a20 2020 2020  RTSTRUCT',.     
+00043af0: 2020 2020 2020 2020 2020 2072 6f6f 745f             root_
+00043b00: 7569 643d 726f 6f74 5f75 6964 2c0a 2020  uid=root_uid,.  
+00043b10: 2020 2020 2020 2020 2020 2020 2020 6865                he
+00043b20: 6164 6572 5f65 7874 7261 733d 6865 6164  ader_extras=head
+00043b30: 6572 5f65 7874 7261 732c 0a20 2020 2020  er_extras,.     
+00043b40: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
+00043b50: 655f 7479 7065 3d74 7970 6528 7365 6c66  e_type=type(self
+00043b60: 292e 5f5f 6e61 6d65 5f5f 2c0a 2020 2020  ).__name__,.    
+00043b70: 2020 2020 2020 2020 2020 2020 6f75 746e              outn
+00043b80: 616d 6520 3d20 6f75 746e 616d 652c 0a20  ame = outname,. 
+00043b90: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00043ba0: 2020 2020 2020 2020 2073 656c 662e 6469           self.di
+00043bb0: 636f 6d5f 6461 7461 7365 7420 3d20 6469  com_dataset = di
+00043bc0: 636f 6d5f 7772 6974 6572 2e77 7269 7465  com_writer.write
+00043bd0: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+00043be0: 6966 2076 6572 626f 7365 3a0a 2020 2020  if verbose:.    
+00043bf0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00043c00: 7428 2257 726f 7465 2064 6963 6f6d 2066  t("Wrote dicom f
+00043c10: 696c 6520 746f 2064 6972 6563 746f 7279  ile to directory
+00043c20: 3a22 2c20 6f75 7464 6972 290a 2020 2020  :", outdir).    
+00043c30: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+00043c40: 2020 2020 2020 2020 2320 4f74 6865 7277          # Otherw
+00043c50: 6973 652c 2077 7269 7465 2074 6f20 696e  ise, write to in
+00043c60: 6469 7669 6475 616c 2052 4f49 2066 696c  dividual ROI fil
+00043c70: 6573 0a20 2020 2020 2020 2069 6620 6e6f  es.        if no
+00043c80: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
+00043c90: 286f 7574 6469 7229 3a0a 2020 2020 2020  (outdir):.      
+00043ca0: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
+00043cb0: 7328 6f75 7464 6972 290a 2020 2020 2020  s(outdir).      
+00043cc0: 2020 656c 6966 206f 7665 7277 7269 7465    elif overwrite
+00043cd0: 3a0a 2020 2020 2020 2020 2020 2020 7368  :.            sh
+00043ce0: 7574 696c 2e72 6d74 7265 6528 6f75 7464  util.rmtree(outd
+00043cf0: 6972 290a 2020 2020 2020 2020 2020 2020  ir).            
+00043d00: 6f73 2e6d 6b64 6972 286f 7574 6469 7229  os.mkdir(outdir)
+00043d10: 0a20 2020 2020 2020 2066 6f72 2073 2069  .        for s i
+00043d20: 6e20 7365 6c66 2e67 6574 5f72 6f69 7328  n self.get_rois(
+00043d30: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+00043d40: 2e77 7269 7465 286f 7574 6469 723d 6f75  .write(outdir=ou
+00043d50: 7464 6972 2c20 6578 743d 6578 742c 2076  tdir, ext=ext, v
+00043d60: 6572 626f 7365 3d76 6572 626f 7365 2c20  erbose=verbose, 
+00043d70: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+00043d80: 2020 2020 2020 0a20 2020 2064 6566 2070        .    def p
+00043d90: 6c6f 7428 0a20 2020 2020 2020 2073 656c  lot(.        sel
+00043da0: 662c 0a20 2020 2020 2020 2076 6965 773d  f,.        view=
+00043db0: 2278 2d79 222c 0a20 2020 2020 2020 2070  "x-y",.        p
+00043dc0: 6c6f 745f 7479 7065 3d22 636f 6e74 6f75  lot_type="contou
+00043dd0: 7222 2c0a 2020 2020 2020 2020 736c 3d4e  r",.        sl=N
+00043de0: 6f6e 652c 0a20 2020 2020 2020 2069 6478  one,.        idx
+00043df0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2070  =None,.        p
+00043e00: 6f73 3d4e 6f6e 652c 0a20 2020 2020 2020  os=None,.       
+00043e10: 2061 783d 4e6f 6e65 2c0a 2020 2020 2020   ax=None,.      
+00043e20: 2020 6f70 6163 6974 793d 4e6f 6e65 2c0a    opacity=None,.
+00043e30: 2020 2020 2020 2020 6c69 6e65 7769 6474          linewidt
+00043e40: 683d 4e6f 6e65 2c0a 2020 2020 2020 2020  h=None,.        
+00043e50: 696e 636c 7564 655f 696d 6167 653d 5472  include_image=Tr
+00043e60: 7565 2c0a 2020 2020 2020 2020 6365 6e74  ue,.        cent
+00043e70: 7265 5f6f 6e5f 726f 693d 4e6f 6e65 2c0a  re_on_roi=None,.
+00043e80: 2020 2020 2020 2020 7368 6f77 3d54 7275          show=Tru
+00043e90: 652c 0a20 2020 2020 2020 2073 6176 655f  e,.        save_
+00043ea0: 6173 3d4e 6f6e 652c 0a20 2020 2020 2020  as=None,.       
+00043eb0: 206c 6567 656e 643d 4661 6c73 652c 0a20   legend=False,. 
+00043ec0: 2020 2020 2020 206c 6567 656e 645f 6262         legend_bb
+00043ed0: 6f78 5f74 6f5f 616e 6368 6f72 3d4e 6f6e  ox_to_anchor=Non
+00043ee0: 652c 0a20 2020 2020 2020 206c 6567 656e  e,.        legen
+00043ef0: 645f 6c6f 633d 226c 6f77 6572 206c 6566  d_loc="lower lef
+00043f00: 7422 2c0a 2020 2020 2020 2020 636f 6e73  t",.        cons
+00043f10: 656e 7375 735f 7479 7065 3d4e 6f6e 652c  ensus_type=None,
+00043f20: 0a20 2020 2020 2020 2065 7863 6c75 6465  .        exclude
+00043f30: 5f66 726f 6d5f 636f 6e73 656e 7375 733d  _from_consensus=
+00043f40: 4e6f 6e65 2c0a 2020 2020 2020 2020 636f  None,.        co
+00043f50: 6e73 656e 7375 735f 636f 6c6f 723d 2262  nsensus_color="b
+00043f60: 6c75 6522 2c0a 2020 2020 2020 2020 636f  lue",.        co
+00043f70: 6e73 656e 7375 735f 6c69 6e65 7769 6474  nsensus_linewidt
+00043f80: 683d 4e6f 6e65 2c0a 2020 2020 2020 2020  h=None,.        
+00043f90: 2a2a 6b77 6172 6773 2c0a 2020 2020 293a  **kwargs,.    ):
+00043fa0: 0a20 2020 2020 2020 2022 2222 506c 6f74  .        """Plot
+00043fb0: 2074 6865 2052 4f49 7320 696e 2074 6869   the ROIs in thi
+00043fc0: 7320 7374 7275 6374 7572 6520 7365 742e  s structure set.
+00043fd0: 0a20 2020 2020 2020 0a20 2020 2020 2020  .       .       
+00043fe0: 2049 6620 636f 6e73 656e 7375 735f 7479   If consensus_ty
+00043ff0: 7065 2069 7320 7365 7420 746f 2061 6e79  pe is set to any
+00044000: 206f 6620 276d 616a 6f72 6974 7927 2c20   of 'majority', 
+00044010: 2773 756d 272c 2027 6f76 6572 6c61 7027  'sum', 'overlap'
+00044020: 2c20 6f72 2027 7374 6170 6c65 272c 0a20  , or 'staple',. 
+00044030: 2020 2020 2020 2074 6865 2063 6f6e 656e         the conen
+00044040: 7375 7320 636f 6e74 6f75 7220 7769 6c6c  sus contour will
+00044050: 2062 6520 706c 6f74 7465 6420 7261 7468   be plotted rath
+00044060: 6572 2074 6861 6e20 696e 6469 7669 6475  er than individu
+00044070: 616c 2052 4f49 732e 2049 660a 2020 2020  al ROIs. If.    
+00044080: 2020 2020 2765 7863 6c75 6465 5f66 726f      'exclude_fro
+00044090: 6d5f 636f 6e73 656e 7375 7327 2069 7320  m_consensus' is 
+000440a0: 7365 7420 746f 2074 6865 206e 616d 6520  set to the name 
+000440b0: 6f66 2061 6e20 524f 492c 2074 6861 7420  of an ROI, that 
+000440c0: 524f 4920 7769 6c6c 0a20 2020 2020 2020  ROI will.       
+000440d0: 2062 6520 6578 636c 7564 6564 2066 726f   be excluded fro
+000440e0: 6d20 7468 6520 636f 6e73 656e 7375 7320  m the consensus 
+000440f0: 6361 6c63 756c 6174 696f 6e20 616e 6420  calculation and 
+00044100: 706c 6f74 7465 6420 696e 6469 7669 6475  plotted individu
+00044110: 616c 6c79 2e0a 2020 2020 2020 2020 2222  ally..        ""
+00044120: 220a 0a20 2020 2020 2020 2023 2049 6620  "..        # If 
+00044130: 6e6f 2073 6c2f 6964 782f 706f 7320 6769  no sl/idx/pos gi
+00044140: 7665 6e2c 2075 7365 2074 6865 2073 6c69  ven, use the sli
+00044150: 6365 2077 6974 6820 7468 6520 6d6f 7374  ce with the most
+00044160: 2052 4f49 730a 2020 2020 2020 2020 6966   ROIs.        if
+00044170: 2073 6c20 6973 204e 6f6e 6520 616e 6420   sl is None and 
+00044180: 6964 7820 6973 204e 6f6e 6520 616e 6420  idx is None and 
+00044190: 706f 7320 6973 204e 6f6e 653a 0a20 2020  pos is None:.   
+000441a0: 2020 2020 2020 2020 2069 6478 203d 2073           idx = s
+000441b0: 656c 662e 6765 745f 6d69 645f 6964 7828  elf.get_mid_idx(
+000441c0: 7669 6577 290a 0a20 2020 2020 2020 2069  view)..        i
+000441d0: 6620 706c 6f74 5f74 7970 6520 6973 204e  f plot_type is N
+000441e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000441f0: 2070 6c6f 745f 7479 7065 203d 206b 7761   plot_type = kwa
+00044200: 7267 732e 6765 7428 2272 6f69 5f70 6c6f  rgs.get("roi_plo
+00044210: 745f 7479 7065 222c 2073 656c 662e 6465  t_type", self.de
+00044220: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
+00044230: 6429 0a20 2020 2020 2020 206b 7761 7267  d).        kwarg
+00044240: 735b 2272 6f69 5f70 6c6f 745f 7479 7065  s["roi_plot_type
+00044250: 225d 203d 2070 6c6f 745f 7479 7065 0a0a  "] = plot_type..
+00044260: 2020 2020 2020 2020 2320 456e 7375 7265          # Ensure
+00044270: 2074 6861 7420 6c69 6e65 7769 6474 6820   that linewidth 
+00044280: 616e 6420 6f70 6163 6974 7920 666f 7220  and opacity for 
+00044290: 524f 4920 706c 6f74 7469 6e67 2061 7265  ROI plotting are
+000442a0: 2064 6566 696e 6564 2e0a 2020 2020 2020   defined..      
+000442b0: 2020 726f 695f 6b77 6172 6773 203d 207b    roi_kwargs = {
+000442c0: 7d0a 2020 2020 2020 2020 6966 206f 7061  }.        if opa
+000442d0: 6369 7479 2069 7320 4e6f 6e65 3a0a 2020  city is None:.  
+000442e0: 2020 2020 2020 2020 2020 6f70 6163 6974            opacit
+000442f0: 7920 3d20 302e 3320 6966 2022 6669 6c6c  y = 0.3 if "fill
+00044300: 6564 2220 696e 2070 6c6f 745f 7479 7065  ed" in plot_type
+00044310: 2065 6c73 6520 310a 2020 2020 2020 2020   else 1.        
+00044320: 726f 695f 6b77 6172 6773 5b22 6f70 6163  roi_kwargs["opac
+00044330: 6974 7922 5d20 3d20 6f70 6163 6974 790a  ity"] = opacity.
+00044340: 2020 2020 2020 2020 6966 206c 696e 6577          if linew
+00044350: 6964 7468 2069 7320 4e6f 6e65 3a0a 2020  idth is None:.  
+00044360: 2020 2020 2020 2020 2020 6c69 6e65 7769            linewi
+00044370: 6474 6820 3d20 6465 6661 756c 7450 6172  dth = defaultPar
+00044380: 616d 735b 226c 696e 6573 2e6c 696e 6577  ams["lines.linew
+00044390: 6964 7468 225d 5b30 5d0a 2020 2020 2020  idth"][0].      
+000443a0: 2020 726f 695f 6b77 6172 6773 5b22 6c69    roi_kwargs["li
+000443b0: 6e65 7769 6474 6822 5d20 3d20 6c69 6e65  newidth"] = line
+000443c0: 7769 6474 680a 0a20 2020 2020 2020 2023  width..        #
+000443d0: 2045 6e73 7572 6520 7468 6174 2074 6974   Ensure that tit
+000443e0: 6c65 2069 7320 7365 7420 746f 2062 6520  le is set to be 
+000443f0: 6120 7374 7269 6e67 2e0a 2020 2020 2020  a string..      
+00044400: 2020 6966 206b 7761 7267 732e 6765 7428    if kwargs.get(
+00044410: 2274 6974 6c65 222c 204e 6f6e 6529 2069  "title", None) i
+00044420: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00044430: 2020 2020 6b77 6172 6773 5b22 7469 746c      kwargs["titl
+00044440: 6522 5d20 3d20 7365 6c66 2e6e 616d 6520  e"] = self.name 
+00044450: 6f72 2022 220a 0a20 2020 2020 2020 2023  or ""..        #
+00044460: 2050 6c6f 7420 7769 7468 2069 6d61 6765   Plot with image
+00044470: 0a20 2020 2020 2020 2069 6620 696e 636c  .        if incl
+00044480: 7564 655f 696d 6167 6520 616e 6420 7365  ude_image and se
+00044490: 6c66 2e69 6d61 6765 2069 7320 6e6f 7420  lf.image is not 
+000444a0: 4e6f 6e65 3a0a 0a20 2020 2020 2020 2020  None:..         
+000444b0: 2020 2073 656c 662e 696d 6167 652e 706c     self.image.pl
+000444c0: 6f74 280a 2020 2020 2020 2020 2020 2020  ot(.            
+000444d0: 2020 2020 7669 6577 2c0a 2020 2020 2020      view,.      
+000444e0: 2020 2020 2020 2020 2020 736c 3d73 6c2c            sl=sl,
+000444f0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00044500: 2020 6964 783d 6964 782c 0a20 2020 2020    idx=idx,.     
+00044510: 2020 2020 2020 2020 2020 2070 6f73 3d70             pos=p
+00044520: 6f73 2c0a 2020 2020 2020 2020 2020 2020  os,.            
+00044530: 2020 2020 726f 6973 3d73 656c 662c 0a20      rois=self,. 
+00044540: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00044550: 6f69 5f6b 7761 7267 733d 726f 695f 6b77  oi_kwargs=roi_kw
+00044560: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
+00044570: 2020 2020 2020 6365 6e74 7265 5f6f 6e5f        centre_on_
+00044580: 726f 693d 6365 6e74 7265 5f6f 6e5f 726f  roi=centre_on_ro
+00044590: 692c 0a20 2020 2020 2020 2020 2020 2020  i,.             
+000445a0: 2020 2073 686f 773d 7368 6f77 2c0a 2020     show=show,.  
+000445b0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+000445c0: 7665 5f61 733d 7361 7665 5f61 732c 0a20  ve_as=save_as,. 
+000445d0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000445e0: 6567 656e 643d 6c65 6765 6e64 2c0a 2020  egend=legend,.  
+000445f0: 2020 2020 2020 2020 2020 2020 2020 6c65                le
+00044600: 6765 6e64 5f62 626f 785f 746f 5f61 6e63  gend_bbox_to_anc
+00044610: 686f 723d 6c65 6765 6e64 5f62 626f 785f  hor=legend_bbox_
+00044620: 746f 5f61 6e63 686f 722c 0a20 2020 2020  to_anchor,.     
+00044630: 2020 2020 2020 2020 2020 206c 6567 656e             legen
+00044640: 645f 6c6f 633d 6c65 6765 6e64 5f6c 6f63  d_loc=legend_loc
+00044650: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00044660: 2020 636f 6e73 656e 7375 735f 7479 7065    consensus_type
+00044670: 3d63 6f6e 7365 6e73 7573 5f74 7970 652c  =consensus_type,
+00044680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044690: 2065 7863 6c75 6465 5f66 726f 6d5f 636f   exclude_from_co
+000446a0: 6e73 656e 7375 733d 6578 636c 7564 655f  nsensus=exclude_
+000446b0: 6672 6f6d 5f63 6f6e 7365 6e73 7573 2c0a  from_consensus,.
+000446c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000446d0: 6178 3d61 782c 0a20 2020 2020 2020 2020  ax=ax,.         
+000446e0: 2020 2020 2020 202a 2a6b 7761 7267 730a         **kwargs.
+000446f0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00044700: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00044710: 0a0a 2020 2020 2020 2020 2320 506c 6f74  ..        # Plot
+00044720: 2063 6f6e 7365 6e73 7573 0a20 2020 2020   consensus.     
+00044730: 2020 2072 6f69 5f68 616e 646c 6573 203d     roi_handles =
+00044740: 205b 5d0a 2020 2020 2020 2020 6966 2063   [].        if c
+00044750: 6f6e 7365 6e73 7573 5f74 7970 6520 6973  onsensus_type is
+00044760: 206e 6f74 204e 6f6e 653a 0a0a 2020 2020   not None:..    
+00044770: 2020 2020 2020 2020 2320 506c 6f74 2063          # Plot c
+00044780: 6f6e 7365 6e73 7573 2063 6f6e 746f 7572  onsensus contour
+00044790: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+000447a0: 7365 6e73 7573 203d 2073 656c 662e 6765  sensus = self.ge
+000447b0: 745f 636f 6e73 656e 7375 7328 636f 6e73  t_consensus(cons
+000447c0: 656e 7375 735f 7479 7065 2c20 0a20 2020  ensus_type, .   
+000447d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000447e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000447f0: 6578 636c 7564 6564 203d 2073 656c 662e  excluded = self.
-00044800: 6765 745f 726f 6928 6578 636c 7564 655f  get_roi(exclude_
-00044810: 6672 6f6d 5f63 6f6e 7365 6e73 7573 290a  from_consensus).
+000447f0: 2020 2020 2020 2020 636f 6c6f 723d 636f          color=co
+00044800: 6e73 656e 7375 735f 636f 6c6f 722c 0a20  nsensus_color,. 
+00044810: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00044820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044830: 6578 636c 7564 6564 2e70 6c6f 7428 7669  excluded.plot(vi
-00044840: 6577 2c20 736c 3d73 6c2c 2069 6478 3d69  ew, sl=sl, idx=i
-00044850: 6478 2c20 706f 733d 706f 732c 2070 6c6f  dx, pos=pos, plo
-00044860: 745f 7479 7065 3d70 6c6f 745f 7479 7065  t_type=plot_type
-00044870: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00044880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044890: 6f70 6163 6974 793d 6f70 6163 6974 792c  opacity=opacity,
-000448a0: 206c 696e 6577 6964 7468 3d6c 696e 6577   linewidth=linew
-000448b0: 6964 7468 2c20 7368 6f77 3d46 616c 7365  idth, show=False
-000448c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000448d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000448e0: 6178 3d73 656c 662e 6178 2c20 2a2a 6b77  ax=self.ax, **kw
-000448f0: 6172 6773 290a 2020 2020 2020 2020 2020  args).          
-00044900: 2020 2020 2020 6966 206c 6567 656e 643a        if legend:
-00044910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00044920: 2020 2020 2072 6f69 5f68 616e 646c 6573       roi_handles
-00044930: 2e61 7070 656e 6428 0a20 2020 2020 2020  .append(.       
-00044940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044950: 2065 7863 6c75 6465 642e 6765 745f 7061   excluded.get_pa
-00044960: 7463 6828 706c 6f74 5f74 7970 652c 2065  tch(plot_type, e
-00044970: 7863 6c75 6465 642e 636f 6c6f 722c 206f  xcluded.color, o
-00044980: 7061 6369 7479 2c0a 2020 2020 2020 2020  pacity,.        
-00044990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000449a0: 2020 2020 6c69 6e65 7769 6474 682c 2065      linewidth, e
-000449b0: 7863 6c75 6465 642e 6e61 6d65 2929 0a0a  xcluded.name))..
-000449c0: 2020 2020 2020 2020 2320 4f74 6865 7277          # Otherw
-000449d0: 6973 652c 2070 6c6f 7420 6669 7273 7420  ise, plot first 
-000449e0: 524f 4920 616e 6420 6765 7420 6178 6573  ROI and get axes
-000449f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00044a00: 2020 2020 2020 2020 2020 2069 6620 6365             if ce
-00044a10: 6e74 7265 5f6f 6e5f 726f 6920 6973 206e  ntre_on_roi is n
-00044a20: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00044a30: 2020 2020 2020 2020 2063 656e 7472 616c           central
-00044a40: 203d 2073 656c 662e 6765 745f 726f 6928   = self.get_roi(
-00044a50: 6365 6e74 7265 5f6f 6e5f 726f 6929 0a20  centre_on_roi). 
-00044a60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00044a70: 6478 203d 2063 656e 7472 616c 2e67 6574  dx = central.get
-00044a80: 5f6d 6964 5f69 6478 2876 6965 7729 0a20  _mid_idx(view). 
-00044a90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00044aa0: 6c20 3d20 4e6f 6e65 0a20 2020 2020 2020  l = None.       
-00044ab0: 2020 2020 2020 2020 2070 6f73 203d 204e           pos = N
-00044ac0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00044ad0: 2020 2020 6669 7273 745f 726f 6920 3d20      first_roi = 
-00044ae0: 6365 6e74 7261 6c0a 2020 2020 2020 2020  central.        
-00044af0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00044b00: 2020 2020 2020 2020 2020 6365 6e74 7261            centra
-00044b10: 6c20 3d20 7365 6c66 2e67 6574 5f72 6f69  l = self.get_roi
-00044b20: 7328 6967 6e6f 7265 5f65 6d70 7479 3d54  s(ignore_empty=T
-00044b30: 7275 6529 5b30 5d0a 0a20 2020 2020 2020  rue)[0]..       
-00044b40: 2020 2020 2063 656e 7472 616c 2e70 6c6f       central.plo
-00044b50: 7428 7669 6577 2c20 736c 3d73 6c2c 2069  t(view, sl=sl, i
-00044b60: 6478 3d69 6478 2c20 706f 733d 706f 732c  dx=idx, pos=pos,
-00044b70: 2070 6c6f 745f 7479 7065 3d70 6c6f 745f   plot_type=plot_
-00044b80: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
-00044b90: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00044ba0: 7061 6369 7479 3d6f 7061 6369 7479 2c20  pacity=opacity, 
-00044bb0: 6c69 6e65 7769 6474 683d 6c69 6e65 7769  linewidth=linewi
-00044bc0: 6474 682c 2073 686f 773d 4661 6c73 652c  dth, show=False,
-00044bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00044be0: 2020 2020 2020 2020 2020 6178 3d61 7829            ax=ax)
-00044bf0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00044c00: 6c66 2e66 6967 203d 2063 656e 7472 616c  lf.fig = central
-00044c10: 2e66 6967 0a20 2020 2020 2020 2020 2020  .fig.           
-00044c20: 2073 656c 662e 6178 203d 2063 656e 7472   self.ax = centr
-00044c30: 616c 2e61 780a 0a20 2020 2020 2020 2020  al.ax..         
-00044c40: 2020 2069 6620 6c65 6765 6e64 3a0a 2020     if legend:.  
-00044c50: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-00044c60: 695f 6861 6e64 6c65 732e 6170 7065 6e64  i_handles.append
-00044c70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00044c80: 2020 2020 2020 2020 2020 6365 6e74 7261            centra
-00044c90: 6c2e 6765 745f 7061 7463 6828 706c 6f74  l.get_patch(plot
-00044ca0: 5f74 7970 652c 2063 656e 7472 616c 2e63  _type, central.c
-00044cb0: 6f6c 6f72 2c20 6f70 6163 6974 792c 0a20  olor, opacity,. 
-00044cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044cd0: 2020 2020 2020 2020 2020 206c 696e 6577             linew
-00044ce0: 6964 7468 2c20 6365 6e74 7261 6c2e 6e61  idth, central.na
-00044cf0: 6d65 2929 0a0a 2020 2020 2020 2020 2020  me))..          
-00044d00: 2020 2320 506c 6f74 206f 7468 6572 2052    # Plot other R
-00044d10: 4f49 730a 2020 2020 2020 2020 2020 2020  OIs.            
-00044d20: 666f 7220 692c 2072 6f69 2069 6e20 656e  for i, roi in en
-00044d30: 756d 6572 6174 6528 7365 6c66 2e67 6574  umerate(self.get
-00044d40: 5f72 6f69 7328 6967 6e6f 7265 5f65 6d70  _rois(ignore_emp
-00044d50: 7479 3d54 7275 6529 293a 0a0a 2020 2020  ty=True)):..    
-00044d60: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00044d70: 6f69 2069 7320 6365 6e74 7261 6c3a 0a20  oi is central:. 
-00044d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044d90: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
-00044da0: 2020 2020 2020 2020 2020 2020 2070 6c6f               plo
-00044db0: 745f 6b77 6172 6773 203d 207b 7d20 6966  t_kwargs = {} if
-00044dc0: 2069 203c 206c 656e 2873 656c 662e 726f   i < len(self.ro
-00044dd0: 6973 2920 2d20 3120 656c 7365 206b 7761  is) - 1 else kwa
-00044de0: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
-00044df0: 2020 2020 726f 692e 706c 6f74 2876 6965      roi.plot(vie
-00044e00: 772c 2073 6c3d 736c 2c20 6964 783d 6964  w, sl=sl, idx=id
-00044e10: 782c 2070 6f73 3d70 6f73 2c20 706c 6f74  x, pos=pos, plot
-00044e20: 5f74 7970 653d 706c 6f74 5f74 7970 652c  _type=plot_type,
-00044e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00044e40: 2020 2020 2020 2020 2020 6f70 6163 6974            opacit
-00044e50: 793d 6f70 6163 6974 792c 206c 696e 6577  y=opacity, linew
-00044e60: 6964 7468 3d6c 696e 6577 6964 7468 2c20  idth=linewidth, 
-00044e70: 7368 6f77 3d46 616c 7365 2c0a 2020 2020  show=False,.    
-00044e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044e90: 2020 2020 2061 783d 7365 6c66 2e61 782c       ax=self.ax,
-00044ea0: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-00044eb0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00044ec0: 6567 656e 643a 0a20 2020 2020 2020 2020  egend:.         
-00044ed0: 2020 2020 2020 2020 2020 2069 6620 2869             if (i
-00044ee0: 6478 2069 7320 4e6f 6e65 2061 6e64 2070  dx is None and p
-00044ef0: 6f73 2069 7320 4e6f 6e65 2061 6e64 2073  os is None and s
-00044f00: 6c20 6973 204e 6f6e 6529 206f 7220 5c0a  l is None) or \.
-00044f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044f20: 2020 2020 2020 2072 6f69 2e6f 6e5f 736c         roi.on_sl
-00044f30: 6963 6528 7669 6577 2c20 736c 3d73 6c2c  ice(view, sl=sl,
-00044f40: 2069 6478 3d69 6478 2c20 706f 733d 706f   idx=idx, pos=po
-00044f50: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00044f60: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
-00044f70: 6861 6e64 6c65 732e 6170 7065 6e64 2872  handles.append(r
-00044f80: 6f69 2e67 6574 5f70 6174 6368 2870 6c6f  oi.get_patch(plo
-00044f90: 745f 7479 7065 2c20 726f 692e 636f 6c6f  t_type, roi.colo
-00044fa0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00044fb0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00044fc0: 7061 6369 7479 2c20 6c69 6e65 7769 6474  pacity, linewidt
-00044fd0: 682c 2072 6f69 2e6e 616d 6529 290a 0a20  h, roi.name)).. 
-00044fe0: 2020 2020 2020 2023 2044 7261 7720 6c65         # Draw le
-00044ff0: 6765 6e64 0a20 2020 2020 2020 2069 6620  gend.        if 
-00045000: 6c65 6765 6e64 2061 6e64 206c 656e 2872  legend and len(r
-00045010: 6f69 5f68 616e 646c 6573 293a 0a20 2020  oi_handles):.   
-00045020: 2020 2020 2020 2020 2073 656c 662e 6178           self.ax
-00045030: 2e6c 6567 656e 6428 6861 6e64 6c65 733d  .legend(handles=
-00045040: 726f 695f 6861 6e64 6c65 732c 0a20 2020  roi_handles,.   
-00045050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045060: 2062 626f 785f 746f 5f61 6e63 686f 723d   bbox_to_anchor=
-00045070: 6c65 6765 6e64 5f62 626f 785f 746f 5f61  legend_bbox_to_a
-00045080: 6e63 686f 722c 206c 6f63 3d6c 6567 656e  nchor, loc=legen
-00045090: 645f 6c6f 632c 0a20 2020 2020 2020 2020  d_loc,.         
-000450a0: 2020 2020 2020 2020 2020 2066 6163 6563             facec
-000450b0: 6f6c 6f72 3d22 7768 6974 6522 2c20 6672  olor="white", fr
-000450c0: 616d 6561 6c70 6861 3d31 0a20 2020 2020  amealpha=1.     
-000450d0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-000450e0: 2020 2320 4469 7370 6c61 7920 696d 6167    # Display imag
-000450f0: 650a 2020 2020 2020 2020 706c 742e 7469  e.        plt.ti
-00045100: 6768 745f 6c61 796f 7574 2829 0a20 2020  ght_layout().   
-00045110: 2020 2020 2069 6620 7368 6f77 3a0a 2020       if show:.  
-00045120: 2020 2020 2020 2020 2020 706c 742e 7368            plt.sh
-00045130: 6f77 2829 0a0a 2020 2020 2020 2020 2320  ow()..        # 
-00045140: 5361 7665 2074 6f20 6669 6c65 0a20 2020  Save to file.   
-00045150: 2020 2020 2069 6620 7361 7665 5f61 733a       if save_as:
-00045160: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00045170: 662e 6669 672e 7361 7665 6669 6728 7361  f.fig.savefig(sa
-00045180: 7665 5f61 7329 0a20 2020 2020 2020 2020  ve_as).         
-00045190: 2020 2070 6c74 2e63 6c6f 7365 2829 0a0a     plt.close()..
-000451a0: 2020 2020 6465 6620 706c 6f74 5f63 6f6e      def plot_con
-000451b0: 7365 6e73 7573 2873 656c 662c 2063 6f6e  sensus(self, con
-000451c0: 7365 6e73 7573 5f74 7970 652c 2076 6965  sensus_type, vie
-000451d0: 773d 2278 2d79 222c 2073 6c3d 4e6f 6e65  w="x-y", sl=None
-000451e0: 2c20 6964 783d 4e6f 6e65 2c0a 2020 2020  , idx=None,.    
-000451f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045200: 2020 2070 6f73 3d4e 6f6e 652c 2072 6f69     pos=None, roi
-00045210: 735f 696e 5f62 6163 6b67 726f 756e 643d  s_in_background=
-00045220: 4661 6c73 652c 2063 6f6c 6f72 3d4e 6f6e  False, color=Non
-00045230: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
-00045240: 2020 2020 2020 2020 2020 2073 686f 773d             show=
-00045250: 5472 7565 2c20 2a2a 6b77 6172 6773 293a  True, **kwargs):
-00045260: 0a20 2020 2020 2020 2022 2222 506c 6f74  .        """Plot
-00045270: 2074 6865 2063 6f6e 7365 6e73 7573 2063   the consensus c
-00045280: 6f6e 746f 7572 2c20 7769 7468 2061 6c6c  ontour, with all
-00045290: 2052 4f49 7320 696e 2067 7265 7920 6265   ROIs in grey be
-000452a0: 6869 6e64 2069 7420 6966 0a20 2020 2020  hind it if.     
-000452b0: 2020 2072 6f69 735f 696e 5f62 6163 6b67     rois_in_backg
-000452c0: 726f 756e 643d 5472 7565 2e22 2222 0a0a  round=True."""..
-000452d0: 2020 2020 2020 2020 636f 6e73 656e 7375          consensu
-000452e0: 7320 3d20 7365 6c66 2e67 6574 5f63 6f6e  s = self.get_con
-000452f0: 7365 6e73 7573 2863 6f6e 7365 6e73 7573  sensus(consensus
-00045300: 5f74 7970 6529 0a0a 2020 2020 2020 2020  _type)..        
-00045310: 6966 2069 6478 2069 7320 4e6f 6e65 2061  if idx is None a
-00045320: 6e64 2073 6c20 6973 204e 6f6e 6520 616e  nd sl is None an
-00045330: 6420 706f 7320 6973 204e 6f6e 653a 0a20  d pos is None:. 
-00045340: 2020 2020 2020 2020 2020 2069 6478 203d             idx =
-00045350: 2073 656c 662e 6765 745f 6d69 645f 6964   self.get_mid_id
-00045360: 7828 7669 6577 290a 2020 2020 2020 2020  x(view).        
-00045370: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00045380: 2020 6964 7820 3d20 636f 6e73 656e 7375    idx = consensu
-00045390: 732e 6765 745f 6964 7828 7669 6577 2c20  s.get_idx(view, 
-000453a0: 736c 2c20 6964 782c 2070 6f73 290a 2020  sl, idx, pos).  
-000453b0: 2020 2020 2020 6178 203d 2073 6b72 742e        ax = skrt.
-000453c0: 696d 6167 652e 5f73 6c69 6365 5f61 7865  image._slice_axe
-000453d0: 735b 7669 6577 5d0a 2020 2020 2020 2020  s[view].        
-000453e0: 706f 7320 3d20 636f 6e73 656e 7375 732e  pos = consensus.
-000453f0: 6964 785f 746f 5f70 6f73 2869 6478 2c20  idx_to_pos(idx, 
-00045400: 6178 290a 0a20 2020 2020 2020 2069 6620  ax)..        if 
-00045410: 636f 6e73 656e 7375 732e 656d 7074 793a  consensus.empty:
-00045420: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00045430: 6e74 2866 227b 636f 6e73 656e 7375 735f  nt(f"{consensus_
-00045440: 7479 7065 7d20 636f 6e74 6f75 7220 6973  type} contour is
-00045450: 2065 6d70 7479 2229 0a20 2020 2020 2020   empty").       
-00045460: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-00045470: 2020 2020 636f 6e73 656e 7375 732e 706c      consensus.pl
-00045480: 6f74 2863 6f6c 6f72 3d63 6f6c 6f72 2c20  ot(color=color, 
-00045490: 706f 733d 706f 732c 2076 6965 773d 7669  pos=pos, view=vi
-000454a0: 6577 2c20 7368 6f77 3d46 616c 7365 2c20  ew, show=False, 
-000454b0: 2a2a 6b77 6172 6773 290a 0a20 2020 2020  **kwargs)..     
-000454c0: 2020 2069 6620 726f 6973 5f69 6e5f 6261     if rois_in_ba
-000454d0: 636b 6772 6f75 6e64 3a0a 2020 2020 2020  ckground:.      
-000454e0: 2020 2020 2020 6b77 6172 6773 5b22 6178        kwargs["ax
-000454f0: 225d 203d 2063 6f6e 7365 6e73 7573 2e61  "] = consensus.a
-00045500: 780a 2020 2020 2020 2020 2020 2020 666f  x.            fo
-00045510: 7220 726f 6920 696e 2073 656c 662e 6765  r roi in self.ge
-00045520: 745f 726f 6973 2869 676e 6f72 655f 656d  t_rois(ignore_em
-00045530: 7074 793d 5472 7565 293a 0a20 2020 2020  pty=True):.     
-00045540: 2020 2020 2020 2020 2020 2072 6f69 2e70             roi.p
-00045550: 6c6f 7428 636f 6c6f 723d 226c 6967 6874  lot(color="light
-00045560: 6772 6579 222c 2076 6965 773d 7669 6577  grey", view=view
-00045570: 2c20 706f 733d 706f 732c 2073 686f 773d  , pos=pos, show=
-00045580: 4661 6c73 652c 202a 2a6b 7761 7267 7329  False, **kwargs)
-00045590: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-000455a0: 7365 6e73 7573 2e70 6c6f 7428 636f 6c6f  sensus.plot(colo
-000455b0: 723d 636f 6c6f 722c 2076 6965 773d 7669  r=color, view=vi
-000455c0: 6577 2c20 706f 733d 706f 732c 2073 686f  ew, pos=pos, sho
-000455d0: 773d 4661 6c73 652c 202a 2a6b 7761 7267  w=False, **kwarg
-000455e0: 7329 0a0a 2020 2020 2020 2020 636f 6e73  s)..        cons
-000455f0: 656e 7375 732e 6178 2e73 6574 5f61 7370  ensus.ax.set_asp
-00045600: 6563 7428 2265 7175 616c 2229 0a0a 2020  ect("equal")..  
-00045610: 2020 2020 2020 6966 2073 686f 773a 0a20        if show:. 
-00045620: 2020 2020 2020 2020 2020 2070 6c74 2e73             plt.s
-00045630: 686f 7728 290a 0a20 2020 2064 6566 2067  how()..    def g
-00045640: 6574 5f6c 656e 6774 6828 7365 6c66 2c20  et_length(self, 
-00045650: 6178 293a 0a20 2020 2020 2020 2022 2222  ax):.        """
-00045660: 4765 7420 6c65 6e67 7468 2063 6f76 6572  Get length cover
-00045670: 6564 2062 7920 524f 4973 2061 6c6f 6e67  ed by ROIs along
-00045680: 2061 6e20 6178 6973 2e22 2222 0a0a 2020   an axis."""..  
-00045690: 2020 2020 2020 6578 7465 6e74 203d 2073        extent = s
-000456a0: 656c 662e 6765 745f 6578 7465 6e74 2861  elf.get_extent(a
-000456b0: 783d 6178 290a 2020 2020 2020 2020 7265  x=ax).        re
-000456c0: 7475 726e 2061 6273 2865 7874 656e 745b  turn abs(extent[
-000456d0: 315d 202d 2065 7874 656e 745b 305d 290a  1] - extent[0]).
-000456e0: 0a20 2020 2064 6566 2067 6574 5f63 656e  .    def get_cen
-000456f0: 7472 6528 7365 6c66 2c20 2a2a 6b77 6172  tre(self, **kwar
-00045700: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
-00045710: 4765 7420 3344 2063 656e 7472 6520 6f66  Get 3D centre of
-00045720: 2074 6865 2061 7265 6120 636f 7665 7265   the area covere
-00045730: 6420 6279 2052 4f49 732e 2222 220a 0a20  d by ROIs.""".. 
-00045740: 2020 2020 2020 206b 7761 7267 732e 706f         kwargs.po
-00045750: 7028 2261 7822 2c20 4e6f 6e65 290a 2020  p("ax", None).  
-00045760: 2020 2020 2020 6578 7465 6e74 7320 3d20        extents = 
-00045770: 5b73 656c 662e 6765 745f 6578 7465 6e74  [self.get_extent
-00045780: 2861 783d 6178 2c20 2a2a 6b77 6172 6773  (ax=ax, **kwargs
-00045790: 2920 666f 7220 6178 2069 6e20 736b 7274  ) for ax in skrt
-000457a0: 2e69 6d61 6765 2e5f 6178 6573 5d0a 2020  .image._axes].  
-000457b0: 2020 2020 2020 7265 7475 726e 205b 6e70        return [np
-000457c0: 2e6d 6561 6e28 6578 2920 666f 7220 6578  .mean(ex) for ex
-000457d0: 2069 6e20 6578 7465 6e74 735d 0a0a 2020   in extents]..  
-000457e0: 2020 6465 6620 6669 6e64 5f6d 6f73 745f    def find_most_
-000457f0: 706f 7075 6c61 7465 645f 736c 6963 6528  populated_slice(
-00045800: 7365 6c66 2c20 7669 6577 3d22 782d 7922  self, view="x-y"
-00045810: 293a 0a20 2020 2020 2020 2022 2222 4669  ):.        """Fi
-00045820: 6e64 2074 6865 2069 6e64 6578 206f 6620  nd the index of 
-00045830: 7468 6520 736c 6963 6520 7769 7468 2074  the slice with t
-00045840: 6865 206d 6f73 7420 524f 4973 206f 6e20  he most ROIs on 
-00045850: 6974 2e22 2222 0a0a 2020 2020 2020 2020  it."""..        
-00045860: 696e 6469 6365 7320 3d20 5b5d 0a20 2020  indices = [].   
-00045870: 2020 2020 2066 6f72 2072 6f69 2069 6e20       for roi in 
-00045880: 7365 6c66 2e67 6574 5f72 6f69 7328 6967  self.get_rois(ig
-00045890: 6e6f 7265 5f65 6d70 7479 3d54 7275 6529  nore_empty=True)
-000458a0: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
-000458b0: 6469 6365 732e 6578 7465 6e64 2872 6f69  dices.extend(roi
-000458c0: 2e67 6574 5f69 6e64 6963 6573 2876 6965  .get_indices(vie
-000458d0: 7729 290a 2020 2020 2020 2020 7661 6c73  w)).        vals
-000458e0: 2c20 636f 756e 7473 203d 206e 702e 756e  , counts = np.un
-000458f0: 6971 7565 2869 6e64 6963 6573 2c20 7265  ique(indices, re
-00045900: 7475 726e 5f63 6f75 6e74 733d 5472 7565  turn_counts=True
-00045910: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00045920: 2076 616c 735b 6e70 2e61 7267 6d61 7828   vals[np.argmax(
-00045930: 636f 756e 7473 295d 0a0a 2020 2020 6465  counts)]..    de
-00045940: 6620 7669 6577 2873 656c 662c 2069 6e63  f view(self, inc
-00045950: 6c75 6465 5f69 6d61 6765 3d54 7275 652c  lude_image=True,
-00045960: 2072 6f69 733d 4e6f 6e65 2c20 766f 7865   rois=None, voxe
-00045970: 6c5f 7369 7a65 3d5b 312c 2031 5d2c 2062  l_size=[1, 1], b
-00045980: 7566 6665 723d 352c 202a 2a6b 7761 7267  uffer=5, **kwarg
-00045990: 7329 3a0a 2020 2020 2020 2020 2222 2256  s):.        """V
-000459a0: 6965 7720 7468 6520 5374 7275 6374 7572  iew the Structur
-000459b0: 6553 6574 2e0a 0a20 2020 2020 2020 202a  eSet...        *
-000459c0: 2a50 6172 616d 6574 6572 733a 2a2a 0a20  *Parameters:**. 
-000459d0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000459e0: 696e 636c 7564 655f 696d 6167 6520 3a20  include_image : 
-000459f0: 626f 6f6c 2c20 6465 6661 756c 743d 5472  bool, default=Tr
-00045a00: 7565 0a20 2020 2020 2020 2020 2020 2049  ue.            I
-00045a10: 6620 5472 7565 2061 6e64 2074 6869 7320  f True and this 
-00045a20: 5374 7275 6374 7572 6553 6574 2068 6173  StructureSet has
-00045a30: 2061 6e20 6173 736f 6369 6174 6564 2069   an associated i
-00045a40: 6d61 6765 200a 2020 2020 2020 2020 2020  mage .          
-00045a50: 2020 2869 6e20 7365 6c66 2e69 6d61 6765    (in self.image
-00045a60: 292c 2074 6865 2069 6d61 6765 2077 696c  ), the image wil
-00045a70: 6c20 6265 2064 6973 706c 6179 6564 2062  l be displayed b
-00045a80: 6568 696e 6420 7468 6520 524f 4973 2e0a  ehind the ROIs..
-00045a90: 0a20 2020 2020 2020 2072 6f69 7320 3a20  .        rois : 
-00045aa0: 5374 7275 6374 7572 6553 6574 2f6c 6973  StructureSet/lis
-00045ab0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-00045ac0: 2020 2020 2020 2020 2020 2020 416e 7920              Any 
-00045ad0: 6f74 6865 7220 524f 4973 206f 7220 5374  other ROIs or St
-00045ae0: 7275 6374 7572 6553 6574 7320 746f 2069  ructureSets to i
-00045af0: 6e63 6c75 6465 2069 6e20 7468 6520 706c  nclude in the pl
-00045b00: 6f74 2e0a 0a20 2020 2020 2020 2076 6f78  ot...        vox
-00045b10: 656c 5f73 697a 6520 3a20 6c69 7374 2c20  el_size : list, 
-00045b20: 6465 6661 756c 743d 5b31 2c20 315d 0a20  default=[1, 1]. 
-00045b30: 2020 2020 2020 2020 2020 2049 6620 7468             If th
-00045b40: 6520 5374 7275 6374 7572 6553 6574 2064  e StructureSet d
-00045b50: 6f65 7320 6e6f 7420 6861 7665 2061 6e20  oes not have an 
-00045b60: 6173 736f 6369 6174 6564 2069 6d61 6765  associated image
-00045b70: 2061 6e64 2068 6173 2052 4f49 7320 0a20   and has ROIs . 
-00045b80: 2020 2020 2020 2020 2020 2064 6573 6372             descr
-00045b90: 6962 6564 206f 6e6c 7920 6279 2063 6f6e  ibed only by con
-00045ba0: 746f 7572 732c 2074 6869 7320 7769 6c6c  tours, this will
-00045bb0: 2062 6520 7468 6520 766f 7865 6c20 7369   be the voxel si
-00045bc0: 7a65 7320 7573 6564 2069 6e20 0a20 2020  zes used in .   
-00045bd0: 2020 2020 2020 2020 2074 6865 2078 2d79           the x-y
-00045be0: 2064 6972 6563 7469 6f6e 2077 6865 6e20   direction when 
-00045bf0: 636f 6e76 6572 7469 6e67 2052 4f49 7320  converting ROIs 
-00045c00: 746f 206d 6173 6b73 2069 6620 6120 6d61  to masks if a ma
-00045c10: 736b 2070 6c6f 7420 0a20 2020 2020 2020  sk plot .       
-00045c20: 2020 2020 2074 7970 6520 6973 2073 656c       type is sel
-00045c30: 6563 7465 642e 0a0a 2020 2020 2020 2020  ected...        
-00045c40: 6275 6666 6572 203a 2069 6e74 2c20 6465  buffer : int, de
-00045c50: 6661 756c 743d 350a 2020 2020 2020 2020  fault=5.        
-00045c60: 2020 2020 4966 2074 6865 2053 7472 7563      If the Struc
-00045c70: 7475 7265 5365 7420 646f 6573 206e 6f74  tureSet does not
-00045c80: 2068 6176 6520 616e 2061 7373 6f63 6961   have an associa
-00045c90: 7465 6420 696d 6167 6520 616e 6420 6861  ted image and ha
-00045ca0: 7320 524f 4973 0a20 2020 2020 2020 2020  s ROIs.         
-00045cb0: 2020 2064 6573 6372 6962 6564 206f 6e6c     described onl
-00045cc0: 7920 6279 2063 6f6e 746f 7572 732c 2074  y by contours, t
-00045cd0: 6869 7320 7769 6c6c 2062 6520 7468 6520  his will be the 
-00045ce0: 6e75 6d62 6572 206f 6620 6275 6666 6572  number of buffer
-00045cf0: 2076 6f78 656c 7320 0a20 2020 2020 2020   voxels .       
-00045d00: 2020 2020 2028 692e 652e 2077 6869 7465       (i.e. white
-00045d10: 7370 6163 6529 2064 6973 706c 6179 6564  space) displayed
-00045d20: 2061 726f 756e 6420 7468 6520 6578 7465   around the exte
-00045d30: 6e74 206f 6620 7468 6520 524f 4973 2e0a  nt of the ROIs..
-00045d40: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-00045d50: 2020 2020 2066 726f 6d20 736b 7274 2e62       from skrt.b
-00045d60: 6574 7465 725f 7669 6577 6572 2069 6d70  etter_viewer imp
-00045d70: 6f72 7420 4265 7474 6572 5669 6577 6572  ort BetterViewer
-00045d80: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-00045d90: 6164 2829 0a0a 2020 2020 2020 2020 2320  ad()..        # 
-00045da0: 5365 7420 696e 6974 6961 6c20 7a6f 6f6d  Set initial zoom
-00045db0: 2061 6d6f 756e 7420 616e 6420 6365 6e74   amount and cent
-00045dc0: 7265 0a20 2020 2020 2020 2073 656c 662e  re.        self.
-00045dd0: 726f 6973 5b30 5d2e 6c6f 6164 2829 0a20  rois[0].load(). 
-00045de0: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
-00045df0: 6d61 6765 2069 7320 6e6f 7420 4e6f 6e65  mage is not None
-00045e00: 2061 6e64 206e 6f74 2073 656c 662e 6765   and not self.ge
-00045e10: 745f 726f 6973 2869 676e 6f72 655f 656d  t_rois(ignore_em
-00045e20: 7074 793d 5472 7565 295b 305d 2e63 6f6e  pty=True)[0].con
-00045e30: 746f 7572 735f 6f6e 6c79 3a0a 2020 2020  tours_only:.    
-00045e40: 2020 2020 2020 2020 7669 6577 203d 206b          view = k
-00045e50: 7761 7267 732e 6765 7428 2269 6e69 745f  wargs.get("init_
-00045e60: 7669 6577 222c 2022 782d 7922 290a 2020  view", "x-y").  
-00045e70: 2020 2020 2020 2020 2020 6178 6573 203d            axes =
-00045e80: 2073 6b72 742e 696d 6167 652e 5f70 6c6f   skrt.image._plo
-00045e90: 745f 6178 6573 5b76 6965 775d 0a20 2020  t_axes[view].   
-00045ea0: 2020 2020 2020 2020 2065 7874 656e 7473           extents
-00045eb0: 203d 205b 7365 6c66 2e67 6574 5f6c 656e   = [self.get_len
-00045ec0: 6774 6828 6178 3d61 7829 2066 6f72 2061  gth(ax=ax) for a
-00045ed0: 7820 696e 2061 7865 735d 0a20 2020 2020  x in axes].     
-00045ee0: 2020 2020 2020 2069 6d5f 6c69 6d73 203d         im_lims =
-00045ef0: 205b 7365 6c66 2e69 6d61 6765 2e67 6574   [self.image.get
-00045f00: 5f6c 656e 6774 6828 6178 3d61 7829 2066  _length(ax=ax) f
-00045f10: 6f72 2061 7820 696e 2061 7865 735d 0a20  or ax in axes]. 
-00045f20: 2020 2020 2020 2020 2020 207a 6f6f 6d20             zoom 
-00045f30: 3d20 6d69 6e28 5b69 6d5f 6c69 6d73 5b69  = min([im_lims[i
-00045f40: 5d20 2f20 6578 7465 6e74 735b 695d 2066  ] / extents[i] f
-00045f50: 6f72 2069 2069 6e20 7261 6e67 6528 3229  or i in range(2)
-00045f60: 5d29 202a 2030 2e38 0a20 2020 2020 2020  ]) * 0.8.       
-00045f70: 2020 2020 207a 6f6f 6d5f 6365 6e74 7265       zoom_centre
-00045f80: 203d 2073 656c 662e 6765 745f 6365 6e74   = self.get_cent
-00045f90: 7265 2829 0a20 2020 2020 2020 2020 2020  re().           
-00045fa0: 2069 6620 7a6f 6f6d 203e 2031 3a0a 2020   if zoom > 1:.  
-00045fb0: 2020 2020 2020 2020 2020 2020 2020 6b77                kw
-00045fc0: 6172 6773 2e73 6574 6465 6661 756c 7428  args.setdefault(
-00045fd0: 227a 6f6f 6d22 2c20 7a6f 6f6d 290a 2020  "zoom", zoom).  
-00045fe0: 2020 2020 2020 2020 2020 2020 2020 6b77                kw
-00045ff0: 6172 6773 2e73 6574 6465 6661 756c 7428  args.setdefault(
-00046000: 227a 6f6f 6d5f 6365 6e74 7265 222c 207a  "zoom_centre", z
-00046010: 6f6f 6d5f 6365 6e74 7265 290a 0a20 2020  oom_centre)..   
-00046020: 2020 2020 2020 2020 2023 2053 6574 2069           # Set i
-00046030: 6e69 7469 616c 2073 6c69 6365 0a20 2020  nitial slice.   
-00046040: 2020 2020 2020 2020 206b 7761 7267 732e           kwargs.
-00046050: 7365 7464 6566 6175 6c74 280a 2020 2020  setdefault(.    
-00046060: 2020 2020 2020 2020 2020 2020 2269 6e69              "ini
-00046070: 745f 736c 6963 6522 2c20 0a20 2020 2020  t_slice", .     
-00046080: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00046090: 696d 6167 652e 6964 785f 746f 5f73 6c69  image.idx_to_sli
-000460a0: 6365 2873 656c 662e 6669 6e64 5f6d 6f73  ce(self.find_mos
-000460b0: 745f 706f 7075 6c61 7465 645f 736c 6963  t_populated_slic
-000460c0: 6528 7669 6577 292c 0a20 2020 2020 2020  e(view),.       
-000460d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000460e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000460f0: 2073 6b72 742e 696d 6167 652e 5f73 6c69   skrt.image._sli
-00046100: 6365 5f61 7865 735b 7669 6577 5d29 290a  ce_axes[view])).
-00046110: 0a20 2020 2020 2020 2069 6620 2270 6c6f  .        if "plo
-00046120: 745f 7479 7065 2220 696e 206b 7761 7267  t_type" in kwarg
-00046130: 733a 0a20 2020 2020 2020 2020 2020 206b  s:.            k
-00046140: 7761 7267 735b 2272 6f69 5f70 6c6f 745f  wargs["roi_plot_
-00046150: 7479 7065 225d 203d 206b 7761 7267 732e  type"] = kwargs.
-00046160: 706f 7028 2270 6c6f 745f 7479 7065 2229  pop("plot_type")
-00046170: 0a0a 2020 2020 2020 2020 2320 5669 6577  ..        # View
-00046180: 2077 6974 6820 696d 6167 650a 2020 2020   with image.    
-00046190: 2020 2020 6966 2069 6e63 6c75 6465 5f69      if include_i
-000461a0: 6d61 6765 2061 6e64 2073 656c 662e 696d  mage and self.im
-000461b0: 6167 6520 6973 206e 6f74 204e 6f6e 653a  age is not None:
-000461c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000461d0: 726f 6973 2069 7320 4e6f 6e65 3a0a 2020  rois is None:.  
-000461e0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-000461f0: 6973 203d 2073 656c 660a 2020 2020 2020  is = self.      
-00046200: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00046210: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00046220: 6b72 742e 636f 7265 2e69 735f 6c69 7374  krt.core.is_list
-00046230: 2872 6f69 7329 3a0a 2020 2020 2020 2020  (rois):.        
-00046240: 2020 2020 2020 2020 2020 2020 726f 6973              rois
-00046250: 203d 205b 7365 6c66 5d20 2b20 726f 6973   = [self] + rois
-00046260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046270: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00046280: 2020 2020 2020 2020 2020 2072 6f69 7320             rois 
-00046290: 3d20 5b73 656c 662c 2072 6f69 735d 0a20  = [self, rois]. 
-000462a0: 2020 2020 2020 2020 2020 2062 7620 3d20             bv = 
-000462b0: 4265 7474 6572 5669 6577 6572 2873 656c  BetterViewer(sel
-000462c0: 662e 696d 6167 652c 2072 6f69 733d 726f  f.image, rois=ro
-000462d0: 6973 2c20 2a2a 6b77 6172 6773 290a 0a20  is, **kwargs).. 
-000462e0: 2020 2020 2020 2023 2056 6965 7720 7769         # View wi
-000462f0: 7468 6f75 7420 696d 6167 650a 2020 2020  thout image.    
-00046300: 2020 2020 656c 7365 3a0a 0a20 2020 2020      else:..     
-00046310: 2020 2020 2020 2069 6620 6b77 6172 6773         if kwargs
-00046320: 2e67 6574 2822 7469 746c 6522 2c20 4e6f  .get("title", No
-00046330: 6e65 2920 6973 204e 6f6e 653a 0a20 2020  ne) is None:.   
-00046340: 2020 2020 2020 2020 2020 2020 206b 7761               kwa
-00046350: 7267 735b 2274 6974 6c65 225d 203d 2073  rgs["title"] = s
-00046360: 656c 662e 6e61 6d65 0a0a 2020 2020 2020  elf.name..      
-00046370: 2020 2020 2020 7374 7275 6374 7572 655f        structure_
-00046380: 7365 745f 746d 7020 3d20 7365 6c66 0a0a  set_tmp = self..
-00046390: 2020 2020 2020 2020 2020 2020 2320 4d61              # Ma
-000463a0: 6b65 2064 756d 6d79 2069 6d61 6765 0a20  ke dummy image. 
-000463b0: 2020 2020 2020 2020 2020 2069 6d20 3d20             im = 
-000463c0: 7365 6c66 2e67 6574 5f64 756d 6d79 5f69  self.get_dummy_i
-000463d0: 6d61 6765 2862 7566 6665 723d 6275 6666  mage(buffer=buff
-000463e0: 6572 2c20 0a20 2020 2020 2020 2020 2020  er, .           
-000463f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046400: 2020 2020 2020 2020 2020 2076 6f78 656c             voxel
-00046410: 5f73 697a 653d 766f 7865 6c5f 7369 7a65  _size=voxel_size
-00046420: 290a 2020 2020 2020 2020 2020 2020 7374  ).            st
-00046430: 7275 6374 7572 655f 7365 745f 746d 7020  ructure_set_tmp 
-00046440: 3d20 7365 6c66 2e63 6c6f 6e65 280a 2020  = self.clone(.  
-00046450: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00046460: 7079 5f72 6f69 733d 5472 7565 2c20 0a20  py_rois=True, . 
-00046470: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00046480: 6f70 795f 726f 695f 6461 7461 3d46 616c  opy_roi_data=Fal
-00046490: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-000464a0: 290a 2020 2020 2020 2020 2020 2020 7374  ).            st
-000464b0: 7275 6374 7572 655f 7365 745f 746d 702e  ructure_set_tmp.
-000464c0: 7365 745f 696d 6167 6528 696d 290a 2020  set_image(im).  
-000464d0: 2020 2020 2020 2020 2020 2222 220a 2020            """.  
-000464e0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-000464f0: 662e 726f 6973 5b30 5d2e 636f 6e74 6f75  f.rois[0].contou
-00046500: 7273 5f6f 6e6c 7920 6f72 2054 7275 653a  rs_only or True:
-00046510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046520: 2069 6d20 3d20 7365 6c66 2e67 6574 5f64   im = self.get_d
-00046530: 756d 6d79 5f69 6d61 6765 2862 7566 6665  ummy_image(buffe
-00046540: 723d 6275 6666 6572 2c20 0a20 2020 2020  r=buffer, .     
-00046550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046570: 2020 2020 2076 6f78 656c 5f73 697a 653d       voxel_size=
-00046580: 766f 7865 6c5f 7369 7a65 290a 2020 2020  voxel_size).    
-00046590: 2020 2020 2020 2020 2020 2020 7374 7275              stru
-000465a0: 6374 7572 655f 7365 745f 746d 7020 3d20  cture_set_tmp = 
-000465b0: 7365 6c66 2e63 6c6f 6e65 280a 2020 2020  self.clone(.    
-000465c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000465d0: 636f 7079 5f72 6f69 733d 5472 7565 2c20  copy_rois=True, 
-000465e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000465f0: 2020 2020 2063 6f70 795f 726f 695f 6461       copy_roi_da
-00046600: 7461 3d46 616c 7365 0a20 2020 2020 2020  ta=False.       
-00046610: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00046620: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
-00046630: 6f69 2069 6e20 7374 7275 6374 7572 655f  oi in structure_
-00046640: 7365 745f 746d 702e 726f 6973 3a0a 2020  set_tmp.rois:.  
-00046650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046660: 2020 6966 2072 6f69 2e63 6f6e 746f 7572    if roi.contour
-00046670: 735f 6f6e 6c79 3a0a 2020 2020 2020 2020  s_only:.        
-00046680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046690: 726f 692e 7365 745f 696d 6167 6528 696d  roi.set_image(im
-000466a0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-000466b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000466c0: 2020 2020 696d 203d 2073 6b72 742e 696d      im = skrt.im
-000466d0: 6167 652e 496d 6167 6528 0a20 2020 2020  age.Image(.     
-000466e0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000466f0: 702e 6f6e 6573 2873 656c 662e 726f 6973  p.ones(self.rois
-00046700: 5b30 5d2e 7368 6170 6529 202a 2031 6534  [0].shape) * 1e4
-00046710: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00046720: 2020 2020 2020 6166 6669 6e65 3d73 656c        affine=sel
-00046730: 662e 726f 6973 5b30 5d2e 6166 6669 6e65  f.rois[0].affine
-00046740: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00046750: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00046760: 2222 220a 0a20 2020 2020 2020 2020 2020  """..           
-00046770: 2069 6620 726f 6973 2069 7320 4e6f 6e65   if rois is None
-00046780: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00046790: 2020 726f 6973 203d 2073 7472 7563 7475    rois = structu
-000467a0: 7265 5f73 6574 5f74 6d70 0a20 2020 2020  re_set_tmp.     
-000467b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000467c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000467d0: 736b 7274 2e63 6f72 652e 6973 5f6c 6973  skrt.core.is_lis
-000467e0: 7428 726f 6973 293a 0a20 2020 2020 2020  t(rois):.       
-000467f0: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-00046800: 7320 3d20 5b73 7472 7563 7475 7265 5f73  s = [structure_s
-00046810: 6574 5f74 6d70 5d20 2b20 726f 6973 0a20  et_tmp] + rois. 
-00046820: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00046830: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00046840: 2020 2020 2020 2020 2072 6f69 7320 3d20           rois = 
-00046850: 5b73 7472 7563 7475 7265 5f73 6574 5f74  [structure_set_t
-00046860: 6d70 2c20 726f 6973 5d0a 2020 2020 2020  mp, rois].      
-00046870: 2020 2020 2020 6b77 6172 6773 5b22 7368        kwargs["sh
-00046880: 6f77 225d 203d 2046 616c 7365 0a20 2020  ow"] = False.   
-00046890: 2020 2020 2020 2020 2062 7620 3d20 4265           bv = Be
-000468a0: 7474 6572 5669 6577 6572 2869 6d2c 2072  tterViewer(im, r
-000468b0: 6f69 733d 726f 6973 2c20 2a2a 6b77 6172  ois=rois, **kwar
-000468c0: 6773 290a 0a20 2020 2020 2020 2020 2020  gs)..           
-000468d0: 2023 2041 646a 7573 7420 5549 0a20 2020   # Adjust UI.   
-000468e0: 2020 2020 2020 2020 206e 6f5f 7569 203d           no_ui =
-000468f0: 206b 7761 7267 732e 6765 7428 226e 6f5f   kwargs.get("no_
-00046900: 7569 222c 2073 6b72 742e 636f 7265 2e44  ui", skrt.core.D
-00046910: 6566 6175 6c74 7328 292e 6e6f 5f75 6929  efaults().no_ui)
-00046920: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00046930: 6e6f 7420 6e6f 5f75 693a 0a20 2020 2020  not no_ui:.     
-00046940: 2020 2020 2020 2020 2020 2062 762e 6d61             bv.ma
-00046950: 6b65 5f75 6928 6e6f 5f69 6e74 656e 7369  ke_ui(no_intensi
-00046960: 7479 3d54 7275 6529 0a20 2020 2020 2020  ty=True).       
-00046970: 2020 2020 2020 2020 2062 762e 7368 6f77           bv.show
-00046980: 2829 0a0a 2020 2020 2020 2020 7265 7475  ()..        retu
-00046990: 726e 2062 760a 0a20 2020 2064 6566 2067  rn bv..    def g
-000469a0: 6574 5f65 7874 656e 7428 7365 6c66 2c20  et_extent(self, 
-000469b0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-000469c0: 2020 2022 2222 4765 7420 6d69 6e20 616e     """Get min an
-000469d0: 6420 6d61 7820 6578 7465 6e74 206f 6620  d max extent of 
-000469e0: 616c 6c20 524f 4973 2069 6e20 7468 6520  all ROIs in the 
-000469f0: 5374 7275 6374 7572 6553 6574 2e22 2222  StructureSet."""
-00046a00: 0a0a 2020 2020 2020 2020 616c 6c5f 6578  ..        all_ex
-00046a10: 7465 6e74 7320 3d20 5b5d 0a20 2020 2020  tents = [].     
-00046a20: 2020 2066 6f72 2072 6f69 2069 6e20 7365     for roi in se
-00046a30: 6c66 2e67 6574 5f72 6f69 7328 6967 6e6f  lf.get_rois(igno
-00046a40: 7265 5f65 6d70 7479 3d54 7275 6529 3a0a  re_empty=True):.
-00046a50: 2020 2020 2020 2020 2020 2020 616c 6c5f              all_
-00046a60: 6578 7465 6e74 732e 6578 7465 6e64 2872  extents.extend(r
-00046a70: 6f69 2e67 6574 5f65 7874 656e 7428 2a2a  oi.get_extent(**
-00046a80: 6b77 6172 6773 2929 0a20 2020 2020 2020  kwargs)).       
-00046a90: 2072 6574 7572 6e20 6d69 6e28 616c 6c5f   return min(all_
-00046aa0: 6578 7465 6e74 7329 2c20 6d61 7828 616c  extents), max(al
-00046ab0: 6c5f 6578 7465 6e74 7329 0a0a 2020 2020  l_extents)..    
-00046ac0: 6465 6620 6765 745f 6578 7465 6e74 7328  def get_extents(
-00046ad0: 7365 6c66 2c20 726f 695f 6e61 6d65 733d  self, roi_names=
-00046ae0: 4e6f 6e65 2c20 6275 6666 6572 3d4e 6f6e  None, buffer=Non
-00046af0: 652c 2062 7566 6665 725f 756e 6974 733d  e, buffer_units=
-00046b00: 226d 6d22 2c0a 2020 2020 2020 2020 2020  "mm",.          
-00046b10: 2020 6d65 7468 6f64 3d4e 6f6e 652c 206f    method=None, o
-00046b20: 7269 6769 6e3d 4e6f 6e65 293a 0a20 2020  rigin=None):.   
-00046b30: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00046b40: 2047 6574 206d 696e 696d 756d 2061 6e64   Get minimum and
-00046b50: 206d 6178 696d 756d 2065 7874 656e 7420   maximum extent 
-00046b60: 6f66 2053 7472 7563 7475 7265 5365 7420  of StructureSet 
-00046b70: 524f 4973 2c0a 2020 2020 2020 2020 696e  ROIs,.        in
-00046b80: 206d 6d20 616c 6f6e 6720 616c 6c20 7468   mm along all th
-00046b90: 7265 6520 6178 6573 2c20 7265 7475 726e  ree axes, return
-00046ba0: 6564 2069 6e20 6f72 6465 7220 5b78 2c20  ed in order [x, 
-00046bb0: 792c 207a 5d2e 0a20 2020 2020 2020 204f  y, z]..        O
-00046bc0: 7074 696f 6e61 6c6c 7920 6170 706c 7920  ptionally apply 
-00046bd0: 6120 6275 6666 6572 2074 6f20 7468 6520  a buffer to the 
-00046be0: 6578 7465 6e74 7320 7375 6368 2074 6861  extents such tha
-00046bf0: 7420 7468 6579 2063 6f76 6572 0a20 2020  t they cover.   
-00046c00: 2020 2020 206d 6f72 6520 7468 616e 2074       more than t
-00046c10: 6865 2072 6567 696f 6e20 6f66 2074 6865  he region of the
-00046c20: 2052 4f49 732e 0a0a 2020 2020 2020 2020   ROIs...        
-00046c30: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
-00046c40: 0a20 2020 2020 2020 2072 6f69 5f6e 616d  .        roi_nam
-00046c50: 6573 203a 206c 6973 742c 2064 6566 6175  es : list, defau
-00046c60: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00046c70: 2020 2020 4c69 7374 206f 6620 6e61 6d65      List of name
-00046c80: 7320 6f66 2052 4f49 7320 746f 2062 6520  s of ROIs to be 
-00046c90: 636f 6e73 6964 6572 6564 2e20 2049 6620  considered.  If 
-00046ca0: 4e6f 6e65 2c20 616c 6c20 6f66 2074 6865  None, all of the
-00046cb0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-00046cc0: 7563 7475 7265 2073 6574 2773 2052 4f49  ucture set's ROI
-00046cd0: 7320 6172 6520 636f 6e73 6964 6572 6564  s are considered
-00046ce0: 2e0a 0a20 2020 2020 2020 2062 7566 6665  ...        buffe
-00046cf0: 7220 3a20 666c 6f61 742c 2064 6566 6175  r : float, defau
-00046d00: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00046d10: 2020 2020 4f70 7469 6f6e 616c 2062 7566      Optional buf
-00046d20: 6665 7220 746f 2061 6464 2074 6f20 7468  fer to add to th
-00046d30: 6520 6578 7465 6e74 732e 2055 6e69 7473  e extents. Units
-00046d40: 2073 6574 2062 7920 6062 7566 6665 725f   set by `buffer_
-00046d50: 756e 6974 7360 2e0a 0a20 2020 2020 2020  units`...       
-00046d60: 2062 7566 6665 725f 756e 6974 7320 3a20   buffer_units : 
-00046d70: 7374 722c 2064 6566 6175 6c74 3d22 6d6d  str, default="mm
-00046d80: 220a 2020 2020 2020 2020 2020 2020 556e  ".            Un
-00046d90: 6974 7320 666f 7220 6275 6666 6572 2c20  its for buffer, 
-00046da0: 6966 2075 7369 6e67 2e20 4361 6e20 6265  if using. Can be
-00046db0: 2022 6d6d 222c 2022 766f 7865 6c73 222c   "mm", "voxels",
-00046dc0: 206f 7220 2266 7261 6322 2028 7768 6963   or "frac" (whic
-00046dd0: 680a 2020 2020 2020 2020 2020 2020 6170  h.            ap
-00046de0: 706c 6965 7320 6275 6666 6572 2061 7320  plies buffer as 
-00046df0: 6120 6672 6163 7469 6f6e 206f 6620 746f  a fraction of to
-00046e00: 7461 6c20 6c65 6e67 7468 2069 6e20 6561  tal length in ea
-00046e10: 6368 2064 696d 656e 7369 6f6e 292e 0a0a  ch dimension)...
-00046e20: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
-00046e30: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
-00046e40: 6e65 0a20 2020 2020 2020 2020 2020 204d  ne.            M
-00046e50: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
-00046e60: 2065 7874 656e 7420 6361 6c63 756c 6174   extent calculat
-00046e70: 696f 6e2e 2043 616e 2062 653a 200a 0a20  ion. Can be: .. 
-00046e80: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00046e90: 2022 636f 6e74 6f75 7222 3a20 6765 7420   "contour": get 
-00046ea0: 6578 7465 6e74 2066 726f 6d20 6d69 6e2f  extent from min/
-00046eb0: 6d61 7820 706f 7369 7469 6f6e 7320 6f66  max positions of
-00046ec0: 2063 6f6e 746f 7572 2873 292e 0a20 2020   contour(s)..   
-00046ed0: 2020 2020 2020 2020 2020 2020 202a 2022               * "
-00046ee0: 6d61 736b 223a 2067 6574 2065 7874 656e  mask": get exten
-00046ef0: 7420 6672 6f6d 206d 696e 2f6d 6178 2070  t from min/max p
-00046f00: 6f73 6974 696f 6e73 206f 6620 766f 7865  ositions of voxe
-00046f10: 6c73 2069 6e20 7468 6520 0a20 2020 2020  ls in the .     
-00046f20: 2020 2020 2020 2020 2020 2020 2062 696e               bin
-00046f30: 6172 7920 6d61 736b 2e0a 2020 2020 2020  ary mask..      
-00046f40: 2020 2020 2020 2020 2020 2a20 4e6f 6e65            * None
-00046f50: 3a20 7573 6520 7468 6520 6d65 7468 6f64  : use the method
-00046f60: 2073 6574 2069 6e20 7365 6c66 2e64 6566   set in self.def
-00046f70: 6175 6c74 5f67 656f 6d5f 6d65 7468 6f64  ault_geom_method
-00046f80: 2e0a 0a20 2020 2020 2020 206f 7269 6769  ...        origi
-00046f90: 6e20 3a20 7475 706c 652c 2064 6566 6175  n : tuple, defau
-00046fa0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00046fb0: 2020 2020 5475 706c 6520 7370 6563 6966      Tuple specif
-00046fc0: 7969 6e67 2074 6865 2028 782c 2079 2c20  ying the (x, y, 
-00046fd0: 7a29 2063 6f6f 7264 696e 6174 6573 206f  z) coordinates o
-00046fe0: 6620 7468 6520 706f 696e 740a 2020 2020  f the point.    
-00046ff0: 2020 2020 2020 2020 7769 7468 2072 6573          with res
-00047000: 7065 6374 2074 6f20 7768 6963 6820 6578  pect to which ex
-00047010: 7465 6e74 7320 6172 6520 746f 2062 6520  tents are to be 
-00047020: 6465 7465 726d 696e 6564 2e0a 2020 2020  determined..    
-00047030: 2020 2020 2020 2020 4966 204e 6f6e 652c          If None,
-00047040: 2074 6865 6e20 2830 2c20 302c 2030 2920   then (0, 0, 0) 
-00047050: 6973 2075 7365 642e 0a20 2020 2020 2020  is used..       
-00047060: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-00047070: 7572 6e20 7365 6c66 2e63 6f6d 6269 6e65  urn self.combine
-00047080: 5f72 6f69 7328 726f 695f 6e61 6d65 7329  _rois(roi_names)
-00047090: 2e67 6574 5f65 7874 656e 7473 280a 2020  .get_extents(.  
-000470a0: 2020 2020 2020 2020 2020 2020 2020 6275                bu
-000470b0: 6666 6572 2c20 6275 6666 6572 5f75 6e69  ffer, buffer_uni
-000470c0: 7473 2c20 6d65 7468 6f64 2c20 6f72 6967  ts, method, orig
-000470d0: 696e 290a 0a20 2020 2064 6566 2067 6574  in)..    def get
-000470e0: 5f63 726f 705f 6c69 6d69 7473 2873 656c  _crop_limits(sel
-000470f0: 662c 2072 6f69 5f6e 616d 6573 3d4e 6f6e  f, roi_names=Non
-00047100: 652c 2063 726f 705f 6d61 7267 696e 733d  e, crop_margins=
-00047110: 4e6f 6e65 2c20 6d65 7468 6f64 3d4e 6f6e  None, method=Non
-00047120: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
-00047130: 2020 2020 2020 2020 4765 7420 6372 6f70          Get crop
-00047140: 206c 696d 6974 7320 636f 7272 6573 706f   limits correspo
-00047150: 6e64 696e 6720 746f 2053 7472 7563 7475  nding to Structu
-00047160: 7265 5365 7420 524f 4920 6578 7465 6e74  reSet ROI extent
-00047170: 7320 706c 7573 206d 6172 6769 6e73 2e0a  s plus margins..
-00047180: 0a20 2020 2020 2020 2054 6865 2074 7570  .        The tup
-00047190: 6c65 7320 6f66 206c 696d 6974 7320 7265  les of limits re
-000471a0: 7475 726e 6564 2c20 696e 2074 6865 206f  turned, in the o
-000471b0: 7264 6572 2028 782c 2079 2c20 7a29 2063  rder (x, y, z) c
-000471c0: 616e 0a20 2020 2020 2020 2062 6520 7573  an.        be us
-000471d0: 6564 2c20 666f 7220 6578 616d 706c 652c  ed, for example,
-000471e0: 2061 7320 696e 7075 7473 2074 6f20 736b   as inputs to sk
-000471f0: 7274 2e69 6d61 6765 2e49 6d61 6765 2e63  rt.image.Image.c
-00047200: 726f 7028 292e 0a0a 2020 2020 2020 2020  rop()...        
-00047210: 5468 6973 206d 6574 686f 6420 6973 2073  This method is s
-00047220: 696d 696c 6172 2074 6f20 7468 6520 6d65  imilar to the me
-00047230: 7468 6f64 2067 6574 5f65 7874 656e 7473  thod get_extents
-00047240: 2829 2c20 6275 7420 616c 6c6f 7773 0a20  (), but allows. 
-00047250: 2020 2020 2020 2064 6966 6665 7265 6e74         different
-00047260: 206d 6172 6769 6e73 206f 6e20 6561 6368   margins on each
-00047270: 2073 6964 6520 6f66 2074 6865 2053 7472   side of the Str
-00047280: 7563 7475 7265 5365 742e 0a0a 2020 2020  uctureSet...    
-00047290: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
-000472a0: 3a2a 2a0a 0a20 2020 2020 2020 2072 6f69  :**..        roi
-000472b0: 5f6e 616d 6573 203a 206c 6973 742c 2064  _names : list, d
-000472c0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-000472d0: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
-000472e0: 6e61 6d65 7320 6f66 2052 4f49 7320 746f  names of ROIs to
-000472f0: 2062 6520 636f 6e73 6964 6572 6564 2e20   be considered. 
-00047300: 2049 6620 4e6f 6e65 2c20 616c 6c20 6f66   If None, all of
-00047310: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00047320: 2073 7472 7563 7475 7265 2073 6574 2773   structure set's
-00047330: 2052 4f49 7320 6172 6520 636f 6e73 6964   ROIs are consid
-00047340: 6572 6564 2e0a 0a20 2020 2020 2020 2063  ered...        c
-00047350: 726f 705f 6d61 7267 696e 7320 3a20 666c  rop_margins : fl
-00047360: 6f61 742f 7475 706c 652c 2064 6566 6175  oat/tuple, defau
-00047370: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00047380: 2020 2020 466c 6f61 7420 6f72 2074 6872      Float or thr
-00047390: 6565 2d65 6c65 6d65 6e74 2074 7570 6c65  ee-element tuple
-000473a0: 2073 7065 6369 6679 696e 6720 7468 6520   specifying the 
-000473b0: 6d61 7267 696e 732c 2069 6e20 6d6d 2c0a  margins, in mm,.
-000473c0: 2020 2020 2020 2020 2020 2020 746f 2062              to b
-000473d0: 6520 6164 6465 6420 746f 2053 7472 7563  e added to Struc
-000473e0: 7475 7265 5365 7420 6578 7465 6e74 732e  tureSet extents.
-000473f0: 2020 4966 2061 2066 6c6f 6174 2c20 6d69    If a float, mi
-00047400: 6e75 7320 616e 6420 706c 7573 2074 6865  nus and plus the
-00047410: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00047420: 7565 2073 7065 6369 6669 6564 2061 7265  ue specified are
-00047430: 2061 6464 6564 2074 6f20 6c6f 7765 7220   added to lower 
-00047440: 616e 6420 7570 7065 7220 6578 7465 6e74  and upper extent
-00047450: 7320 7265 7370 6563 7469 7665 6c79 0a20  s respectively. 
-00047460: 2020 2020 2020 2020 2020 2061 6c6f 6e67             along
-00047470: 2065 6163 6820 6178 6973 2e20 2049 6620   each axis.  If 
-00047480: 6120 7468 7265 652d 656c 656d 656e 7420  a three-element 
-00047490: 7475 706c 652c 2065 6c65 6d65 6e74 7320  tuple, elements 
-000474a0: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
-000474b0: 7461 6b65 6e20 746f 2073 7065 6369 6679  taken to specify
-000474c0: 206d 6172 6769 6e73 2069 6e20 7468 6520   margins in the 
-000474d0: 6f72 6465 7220 2878 2c20 792c 207a 292e  order (x, y, z).
-000474e0: 2020 456c 656d 656e 7473 0a20 2020 2020    Elements.     
-000474f0: 2020 2020 2020 2063 616e 2062 6520 6569         can be ei
-00047500: 7468 6572 2066 6c6f 6174 7320 286d 696e  ther floats (min
-00047510: 7573 2061 6e64 2070 6c75 7320 7468 6520  us and plus the 
-00047520: 7661 6c75 6520 6164 6465 6420 7265 7370  value added resp
-00047530: 6563 7469 7665 6c79 0a20 2020 2020 2020  ectively.       
-00047540: 2020 2020 2074 6f20 6c6f 7765 7220 616e       to lower an
-00047550: 6420 7570 7065 7220 6578 7465 6e74 7329  d upper extents)
-00047560: 206f 7220 7477 6f2d 656c 656d 656e 7420   or two-element 
-00047570: 7475 706c 6573 2028 656c 656d 656e 7473  tuples (elements
-00047580: 2030 2061 6e64 2031 0a20 2020 2020 2020   0 and 1.       
-00047590: 2020 2020 2061 6464 6564 2072 6573 7065       added respe
-000475a0: 6374 6976 656c 7920 746f 206c 6f77 6572  ctively to lower
-000475b0: 2061 6e64 2075 7070 6572 2065 7874 656e   and upper exten
-000475c0: 7473 292e 0a0a 2020 2020 2020 2020 6d65  ts)...        me
-000475d0: 7468 6f64 203a 2073 7472 2c20 6465 6661  thod : str, defa
-000475e0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-000475f0: 2020 2020 204d 6574 686f 6420 746f 2075       Method to u
-00047600: 7365 2066 6f72 2065 7874 656e 7420 6361  se for extent ca
-00047610: 6c63 756c 6174 696f 6e2e 2043 616e 2062  lculation. Can b
-00047620: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
-00047630: 2020 2020 2a20 2263 6f6e 746f 7572 223a      * "contour":
-00047640: 2067 6574 2065 7874 656e 7420 6672 6f6d   get extent from
-00047650: 206d 696e 2f6d 6178 2070 6f73 6974 696f   min/max positio
-00047660: 6e73 206f 6620 636f 6e74 6f75 7228 7329  ns of contour(s)
-00047670: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00047680: 2020 2a20 226d 6173 6b22 3a20 6765 7420    * "mask": get 
-00047690: 6578 7465 6e74 2066 726f 6d20 6d69 6e2f  extent from min/
-000476a0: 6d61 7820 706f 7369 7469 6f6e 7320 6f66  max positions of
-000476b0: 2076 6f78 656c 7320 696e 2074 6865 0a20   voxels in the. 
-000476c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000476d0: 2062 696e 6172 7920 6d61 736b 2e0a 2020   binary mask..  
-000476e0: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-000476f0: 4e6f 6e65 3a20 7573 6520 7468 6520 6d65  None: use the me
-00047700: 7468 6f64 2073 6574 2069 6e20 7365 6c66  thod set in self
-00047710: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
-00047720: 7468 6f64 2e0a 2020 2020 2020 2020 2222  thod..        ""
-00047730: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00047740: 2073 656c 662e 636f 6d62 696e 655f 726f   self.combine_ro
-00047750: 6973 2872 6f69 5f6e 616d 6573 292e 6765  is(roi_names).ge
-00047760: 745f 6372 6f70 5f6c 696d 6974 7328 0a20  t_crop_limits(. 
-00047770: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00047780: 726f 705f 6d61 7267 696e 732c 206d 6574  rop_margins, met
-00047790: 686f 6429 0a0a 2020 2020 6465 6620 6765  hod)..    def ge
-000477a0: 745f 6262 6f78 5f63 656e 7472 655f 616e  t_bbox_centre_an
-000477b0: 645f 7769 6474 6873 2873 656c 662c 0a20  d_widths(self,. 
-000477c0: 2020 2020 2020 2020 2020 2072 6f69 5f6e             roi_n
-000477d0: 616d 6573 3d4e 6f6e 652c 2062 7566 6665  ames=None, buffe
-000477e0: 723d 4e6f 6e65 2c20 6275 6666 6572 5f75  r=None, buffer_u
-000477f0: 6e69 7473 3d22 6d6d 222c 206d 6574 686f  nits="mm", metho
-00047800: 643d 4e6f 6e65 293a 0a20 2020 2020 2020  d=None):.       
-00047810: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
-00047820: 2063 656e 7472 6520 616e 6420 7769 6474   centre and widt
-00047830: 6873 2069 6e20 6d6d 2061 6c6f 6e67 2061  hs in mm along a
-00047840: 6c6c 2074 6872 6565 2061 7865 7320 6f66  ll three axes of
-00047850: 2061 2062 6f75 6e64 696e 6720 626f 780a   a bounding box.
-00047860: 2020 2020 2020 2020 656e 636c 6f73 696e          enclosin
-00047870: 6720 5374 7275 6374 7572 6553 6574 2052  g StructureSet R
-00047880: 4f49 7320 616e 6420 6f70 7469 6f6e 616c  OIs and optional
-00047890: 2062 7566 6665 722e 2020 4365 6e74 7265   buffer.  Centre
-000478a0: 0a20 2020 2020 2020 2061 6e64 2077 6964  .        and wid
-000478b0: 7468 7320 6172 6520 7265 7475 726e 6564  ths are returned
-000478c0: 2061 7320 6120 7475 706c 6520 285b 782c   as a tuple ([x,
-000478d0: 2079 2c20 7a5d 2c20 5b64 782c 2064 792c   y, z], [dx, dy,
-000478e0: 2064 7a5d 292e 0a0a 2020 2020 2020 2020   dz])...        
-000478f0: 4d65 7468 6f64 2070 6172 616d 6574 6572  Method parameter
-00047900: 7320 6172 6520 7061 7373 6564 2074 6f0a  s are passed to.
-00047910: 2020 2020 2020 2020 736b 7274 2e73 7472          skrt.str
-00047920: 7563 7475 7265 732e 5374 7275 6374 7572  uctures.Structur
-00047930: 6553 6574 2e67 6574 5f65 7874 656e 7473  eSet.get_extents
-00047940: 2829 2074 6f20 6f62 7461 696e 2053 7472  () to obtain Str
-00047950: 7563 7475 7265 5365 740a 2020 2020 2020  uctureSet.      
-00047960: 2020 6578 7465 6e74 732e 2020 466f 7220    extents.  For 
-00047970: 7061 7261 6d65 7465 7220 6578 706c 616e  parameter explan
-00047980: 6174 696f 6e73 2c20 7365 650a 2020 2020  ations, see.    
-00047990: 2020 2020 736b 7274 2e73 7472 7563 7475      skrt.structu
-000479a0: 7265 732e 5374 7275 6374 7572 6553 6574  res.StructureSet
-000479b0: 2e67 6574 5f65 7874 656e 7473 2829 2064  .get_extents() d
-000479c0: 6f63 756d 656e 7461 7469 6f6e 2e0a 2020  ocumentation..  
-000479d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000479e0: 2020 6578 7465 6e74 7320 3d20 7365 6c66    extents = self
-000479f0: 2e67 6574 5f65 7874 656e 7473 2872 6f69  .get_extents(roi
-00047a00: 5f6e 616d 6573 2c20 6275 6666 6572 2c20  _names, buffer, 
-00047a10: 6275 6666 6572 5f75 6e69 7473 2c20 6d65  buffer_units, me
-00047a20: 7468 6f64 2920 0a20 2020 2020 2020 2063  thod) .        c
-00047a30: 656e 7472 6520 3d20 5b30 2e35 202a 2028  entre = [0.5 * (
-00047a40: 6578 7465 6e74 5b30 5d20 2b20 6578 7465  extent[0] + exte
-00047a50: 6e74 5b31 5d29 2066 6f72 2065 7874 656e  nt[1]) for exten
-00047a60: 7420 696e 2065 7874 656e 7473 5d0a 2020  t in extents].  
-00047a70: 2020 2020 2020 7769 6474 6873 203d 205b        widths = [
-00047a80: 2865 7874 656e 745b 315d 202d 2065 7874  (extent[1] - ext
-00047a90: 656e 745b 305d 2920 666f 7220 6578 7465  ent[0]) for exte
-00047aa0: 6e74 2069 6e20 6578 7465 6e74 735d 0a20  nt in extents]. 
-00047ab0: 2020 2020 2020 2072 6574 7572 6e20 2863         return (c
-00047ac0: 656e 7472 652c 2077 6964 7468 7329 0a0a  entre, widths)..
-00047ad0: 2020 2020 6465 6620 6765 745f 6475 6d6d      def get_dumm
-00047ae0: 795f 696d 6167 6528 7365 6c66 2c20 2a2a  y_image(self, **
-00047af0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-00047b00: 2022 2222 4d61 6b65 2061 2064 756d 6d79   """Make a dummy
-00047b10: 2069 6d61 6765 2074 6861 7420 636f 7665   image that cove
-00047b20: 7273 2074 6865 2061 7265 6120 7370 616e  rs the area span
-00047b30: 6e65 6420 6279 2061 6c6c 2052 4f49 7320  ned by all ROIs 
-00047b40: 696e 2074 6869 730a 2020 2020 2020 2020  in this.        
-00047b50: 5374 7275 6374 7572 6553 6574 2e20 5265  StructureSet. Re
-00047b60: 7475 726e 7320 616e 2049 6d61 6765 206f  turns an Image o
-00047b70: 626a 6563 742e 0a0a 2020 2020 2020 2020  bject...        
-00047b80: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
-00047b90: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00047ba0: 2076 6f78 656c 5f73 697a 6520 3a20 6c69   voxel_size : li
-00047bb0: 7374 2c20 6465 6661 756c 743d 4e6f 6e65  st, default=None
-00047bc0: 0a20 2020 2020 2020 2020 2020 2056 6f78  .            Vox
-00047bd0: 656c 2073 697a 6520 696e 206d 6d20 696e  el size in mm in
-00047be0: 2074 6865 2064 756d 6d79 2069 6d61 6765   the dummy image
-00047bf0: 2069 6e20 7468 6520 782d 7920 706c 616e   in the x-y plan
-00047c00: 652c 2067 6976 656e 2061 7320 0a20 2020  e, given as .   
-00047c10: 2020 2020 2020 2020 205b 7678 2c20 7679           [vx, vy
-00047c20: 5d2e 2049 6620 3c73 6861 7065 3e20 616e  ]. If <shape> an
-00047c30: 6420 3c76 6f78 656c 5f73 697a 653e 2061  d <voxel_size> a
-00047c40: 7265 2062 6f74 6820 4e6f 6e65 2c20 766f  re both None, vo
-00047c50: 7865 6c20 7369 7a65 7320 6f66 0a20 2020  xel sizes of.   
-00047c60: 2020 2020 2020 2020 205b 312c 2031 5d20           [1, 1] 
-00047c70: 7769 6c6c 2062 6520 7573 6564 2062 7920  will be used by 
-00047c80: 6465 6661 756c 742e 2054 6865 2076 6f78  default. The vox
-00047c90: 656c 2073 697a 6520 696e 2074 6865 207a  el size in the z
-00047ca0: 2064 6972 6563 7469 6f6e 200a 2020 2020   direction .    
-00047cb0: 2020 2020 2020 2020 6973 2064 6566 696e          is defin
-00047cc0: 6564 2062 7920 3c73 6c69 6365 5f74 6869  ed by <slice_thi
-00047cd0: 636b 6e65 7373 3e2e 0a0a 2020 2020 2020  ckness>...      
-00047ce0: 2020 7368 6170 6520 3a20 6c69 7374 2c20    shape : list, 
-00047cf0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-00047d00: 2020 2020 2020 2020 204e 756d 6265 7220           Number 
-00047d10: 6f66 2076 6f78 656c 7320 696e 2074 6865  of voxels in the
-00047d20: 2064 756d 6d79 2069 6d61 6765 2069 6e20   dummy image in 
-00047d30: 7468 6520 782d 7920 706c 616e 652c 2067  the x-y plane, g
-00047d40: 6976 656e 2061 730a 2020 2020 2020 2020  iven as.        
-00047d50: 2020 2020 5b6e 782c 206e 795d 2e20 4f6e      [nx, ny]. On
-00047d60: 6c79 2075 7365 6420 6966 203c 766f 7865  ly used if <voxe
-00047d70: 6c5f 7369 7a65 3e20 6973 204e 6f6e 652e  l_size> is None.
-00047d80: 200a 2020 2020 2020 2020 2020 2020 5468   .            Th
-00047d90: 6520 6e75 6d62 6572 206f 6620 766f 7865  e number of voxe
-00047da0: 6c73 2069 6e20 7468 6520 7a20 6469 7265  ls in the z dire
-00047db0: 6374 696f 6e20 7769 6c6c 2062 6520 7461  ction will be ta
-00047dc0: 6b65 6e20 6672 6f6d 2074 6865 200a 2020  ken from the .  
-00047dd0: 2020 2020 2020 2020 2020 6e75 6d62 6572            number
-00047de0: 206f 6620 736c 6963 6573 2069 6e20 7468   of slices in th
-00047df0: 6520 782d 7920 636f 6e74 6f75 7273 2064  e x-y contours d
-00047e00: 6963 7469 6f6e 6172 792e 0a0a 2020 2020  ictionary...    
-00047e10: 2020 2020 6669 6c6c 5f76 616c 203a 2069      fill_val : i
-00047e20: 6e74 2f66 6c6f 6174 2c20 6465 6661 756c  nt/float, defaul
-00047e30: 743d 3165 340a 2020 2020 2020 2020 2020  t=1e4.          
-00047e40: 2020 5661 6c75 6520 7769 7468 2077 6869    Value with whi
-00047e50: 6368 2074 6865 2076 6f78 656c 7320 696e  ch the voxels in
-00047e60: 2074 6865 2064 756d 6d79 2069 6d61 6765   the dummy image
-00047e70: 2073 686f 756c 6420 6265 2066 696c 6c65   should be fille
-00047e80: 642e 200a 0a20 2020 2020 2020 2062 7566  d. ..        buf
-00047e90: 6665 7220 3a20 696e 742c 2064 6566 6175  fer : int, defau
-00047ea0: 6c74 3d31 0a20 2020 2020 2020 2020 2020  lt=1.           
-00047eb0: 204e 756d 6265 7220 6f66 2065 6d70 7479   Number of empty
-00047ec0: 2062 7566 6665 7220 766f 7865 6c73 2074   buffer voxels t
-00047ed0: 6f20 6164 6420 6f75 7473 6964 6520 7468  o add outside th
-00047ee0: 6520 524f 4920 696e 2065 6163 680a 2020  e ROI in each.  
-00047ef0: 2020 2020 2020 2020 2020 6469 7265 6374            direct
-00047f00: 696f 6e2e 0a0a 2020 2020 2020 2020 736c  ion...        sl
-00047f10: 6963 655f 7468 6963 6b6e 6573 7320 3a20  ice_thickness : 
-00047f20: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
-00047f30: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00047f40: 566f 7865 6c20 7369 7a65 2069 6e20 6d6d  Voxel size in mm
-00047f50: 2069 6e20 7468 6520 6475 6d6d 7920 696d   in the dummy im
-00047f60: 6167 6520 696e 2074 6865 207a 2064 6972  age in the z dir
-00047f70: 6563 7469 6f6e 2e20 2049 6620 4e6f 6e65  ection.  If None
-00047f80: 2c0a 2020 2020 2020 2020 2020 2020 7468  ,.            th
-00047f90: 6520 7661 6c75 6520 7573 6564 2069 7320  e value used is 
-00047fa0: 7468 6520 6d69 6e69 6d75 6d20 6469 7374  the minimum dist
-00047fb0: 616e 6365 2062 6574 7765 656e 2073 6c69  ance between sli
-00047fc0: 6365 2070 6f73 6974 696f 6e73 0a20 2020  ce positions.   
-00047fd0: 2020 2020 2020 2020 2069 6e20 7468 6520           in the 
-00047fe0: 782d 7920 636f 6e74 6f75 7273 2064 6963  x-y contours dic
-00047ff0: 7469 6f6e 6172 792e 0a20 2020 2020 2020  tionary..       
-00048000: 2022 2222 0a20 2020 2020 2020 2065 7874   """.        ext
-00048010: 656e 7473 203d 205b 7365 6c66 2e67 6574  ents = [self.get
-00048020: 5f65 7874 656e 7428 6178 3d61 7829 2066  _extent(ax=ax) f
-00048030: 6f72 2061 7820 696e 2073 6b72 742e 696d  or ax in skrt.im
-00048040: 6167 652e 5f61 7865 735d 0a20 2020 2020  age._axes].     
-00048050: 2020 2073 6c69 6365 5f74 6869 636b 6e65     slice_thickne
-00048060: 7373 203d 206b 7761 7267 732e 706f 7028  ss = kwargs.pop(
-00048070: 2273 6c69 6365 5f74 6869 636b 6e65 7373  "slice_thickness
-00048080: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
-00048090: 2073 6c69 6365 5f74 6869 636b 6e65 7373   slice_thickness
-000480a0: 203d 2028 736c 6963 655f 7468 6963 6b6e   = (slice_thickn
-000480b0: 6573 7320 6f72 0a20 2020 2020 2020 2020  ess or.         
-000480c0: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
-000480d0: 726f 6973 2869 676e 6f72 655f 656d 7074  rois(ignore_empt
-000480e0: 793d 5472 7565 295b 305d 5c0a 2020 2020  y=True)[0]\.    
-000480f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048100: 2020 2020 2e67 6574 5f73 6c69 6365 5f74      .get_slice_t
-00048110: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
-00048120: 7328 2929 0a20 2020 2020 2020 2072 6574  s()).        ret
-00048130: 7572 6e20 6372 6561 7465 5f64 756d 6d79  urn create_dummy
-00048140: 5f69 6d61 6765 2865 7874 656e 7473 2c20  _image(extents, 
-00048150: 736c 6963 655f 7468 6963 6b6e 6573 732c  slice_thickness,
-00048160: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-00048170: 6465 6620 5f67 6574 5f63 6f6d 6269 6e61  def _get_combina
-00048180: 7469 6f6e 2873 656c 662c 206e 616d 652c  tion(self, name,
-00048190: 2066 6f72 6365 2c20 6578 636c 7564 652c   force, exclude,
-000481a0: 2063 6f6d 626f 5f6d 616b 6572 2c20 2a2a   combo_maker, **
-000481b0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-000481c0: 2022 2222 4569 7468 6572 2067 6574 2061   """Either get a
-000481d0: 6e20 616c 7265 6164 7920 6361 6c63 756c  n already calcul
-000481e0: 6174 6564 2063 6f6d 6269 6e61 7469 6f6e  ated combination
-000481f0: 2066 726f 6d20 7468 6520 6361 6368 650a   from the cache.
-00048200: 2020 2020 2020 2020 6f72 2063 7265 6174          or creat
-00048210: 6520 6974 2c20 6361 6368 6520 6974 2c20  e it, cache it, 
-00048220: 616e 6420 7265 7475 726e 2069 742e 2222  and return it.""
-00048230: 220a 0a20 2020 2020 2020 2023 2052 6574  "..        # Ret
-00048240: 7572 6e20 6361 6368 6564 2072 6573 756c  urn cached resul
-00048250: 7420 6966 2069 7420 6578 6973 7473 2061  t if it exists a
-00048260: 6e64 206e 6f74 2066 6f72 6369 6e67 0a20  nd not forcing. 
-00048270: 2020 2020 2020 2061 7474 7220 3d20 6622         attr = f"
-00048280: 5f7b 6e61 6d65 7d22 0a20 2020 2020 2020  _{name}".       
-00048290: 2069 6620 6578 636c 7564 653a 0a20 2020   if exclude:.   
-000482a0: 2020 2020 2020 2020 2061 7474 7220 2b3d           attr +=
-000482b0: 2066 225f 6578 636c 7564 6564 220a 2020   f"_excluded".  
-000482c0: 2020 2020 2020 6966 206e 6f74 2066 6f72        if not for
-000482d0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-000482e0: 6966 2065 7863 6c75 6465 2069 7320 4e6f  if exclude is No
-000482f0: 6e65 2061 6e64 2068 6173 6174 7472 2873  ne and hasattr(s
-00048300: 656c 662c 2061 7474 7229 3a0a 2020 2020  elf, attr):.    
-00048310: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00048320: 726e 2067 6574 6174 7472 2873 656c 662c  rn getattr(self,
-00048330: 2061 7474 7229 0a20 2020 2020 2020 2020   attr).         
-00048340: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00048350: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
-00048360: 7474 7228 7365 6c66 2c20 6174 7472 2920  ttr(self, attr) 
-00048370: 616e 6420 6578 636c 7564 6520 696e 2067  and exclude in g
-00048380: 6574 6174 7472 2873 656c 662c 2061 7474  etattr(self, att
-00048390: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-000483a0: 2020 2020 2020 2020 7265 7475 726e 2067          return g
-000483b0: 6574 6174 7472 2873 656c 662c 2061 7474  etattr(self, att
-000483c0: 7229 5b65 7863 6c75 6465 5d0a 0a20 2020  r)[exclude]..   
-000483d0: 2020 2020 2023 2047 6574 206c 6973 7420       # Get list 
-000483e0: 6f66 2052 4f49 7320 746f 2069 6e63 6c75  of ROIs to inclu
-000483f0: 6465 2069 6e20 7468 6973 2063 6f6d 6269  de in this combi
-00048400: 6e61 7469 6f6e 2052 4f49 0a20 2020 2020  nation ROI.     
-00048410: 2020 2069 6620 6578 636c 7564 6520 6973     if exclude is
-00048420: 206e 6f74 204e 6f6e 653a 0a0a 2020 2020   not None:..    
-00048430: 2020 2020 2020 2020 6966 2065 7863 6c75          if exclu
-00048440: 6465 206e 6f74 2069 6e20 7365 6c66 2e67  de not in self.g
-00048450: 6574 5f72 6f69 5f6e 616d 6573 2829 3a0a  et_roi_names():.
-00048460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048470: 7072 696e 7428 6622 524f 4920 746f 2065  print(f"ROI to e
-00048480: 7863 6c75 6465 207b 6578 636c 7564 657d  xclude {exclude}
-00048490: 206e 6f74 2066 6f75 6e64 2e22 290a 2020   not found.").  
-000484a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000484b0: 7475 726e 0a0a 2020 2020 2020 2020 2020  turn..          
-000484c0: 2020 726f 6973 5f74 6f5f 696e 636c 7564    rois_to_includ
-000484d0: 6520 3d20 5b72 6f69 2066 6f72 2072 6f69  e = [roi for roi
-000484e0: 2069 6e20 7365 6c66 2e72 6f69 7320 6966   in self.rois if
-000484f0: 2072 6f69 2e6e 616d 6520 213d 2065 7863   roi.name != exc
-00048500: 6c75 6465 5d0a 0a20 2020 2020 2020 2020  lude]..         
-00048510: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
-00048520: 7228 7365 6c66 2c20 6174 7472 293a 0a20  r(self, attr):. 
-00048530: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00048540: 6574 6174 7472 2873 656c 662c 2061 7474  etattr(self, att
-00048550: 722c 207b 7d29 0a20 2020 2020 2020 2065  r, {}).        e
-00048560: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00048570: 2072 6f69 735f 746f 5f69 6e63 6c75 6465   rois_to_include
-00048580: 203d 2073 656c 662e 726f 6973 0a0a 2020   = self.rois..  
-00048590: 2020 2020 2020 2320 4d61 6b65 206b 7761        # Make kwa
-000485a0: 7267 7320 666f 7220 524f 4920 6372 6561  rgs for ROI crea
-000485b0: 7469 6f6e 0a20 2020 2020 2020 2072 6f69  tion.        roi
-000485c0: 5f6b 7761 7267 7320 3d20 7365 6c66 2e72  _kwargs = self.r
-000485d0: 6f69 5f6b 7761 7267 732e 636f 7079 2829  oi_kwargs.copy()
-000485e0: 0a20 2020 2020 2020 2072 6f69 5f6b 7761  .        roi_kwa
-000485f0: 7267 732e 7570 6461 7465 286b 7761 7267  rgs.update(kwarg
-00048600: 7329 0a20 2020 2020 2020 2072 6f69 5f6b  s).        roi_k
-00048610: 7761 7267 735b 226e 616d 6522 5d20 3d20  wargs["name"] = 
-00048620: 6e61 6d65 0a20 2020 2020 2020 2072 6f69  name.        roi
-00048630: 5f6b 7761 7267 735b 2269 6d61 6765 225d  _kwargs["image"]
-00048640: 203d 2073 656c 662e 696d 6167 650a 2020   = self.image.  
-00048650: 2020 2020 2020 726f 695f 6b77 6172 6773        roi_kwargs
-00048660: 5b22 6166 6669 6e65 225d 203d 2072 6f69  ["affine"] = roi
-00048670: 735f 746f 5f69 6e63 6c75 6465 5b30 5d2e  s_to_include[0].
-00048680: 6765 745f 6166 6669 6e65 2873 7461 6e64  get_affine(stand
-00048690: 6172 6469 7365 3d54 7275 6529 0a0a 2020  ardise=True)..  
-000486a0: 2020 2020 2020 2320 4372 6561 7465 2074        # Create t
-000486b0: 6865 2052 4f49 0a20 2020 2020 2020 2072  he ROI.        r
-000486c0: 6f69 203d 2063 6f6d 626f 5f6d 616b 6572  oi = combo_maker
-000486d0: 2872 6f69 735f 746f 5f69 6e63 6c75 6465  (rois_to_include
-000486e0: 2c20 2a2a 726f 695f 6b77 6172 6773 290a  , **roi_kwargs).
-000486f0: 0a20 2020 2020 2020 2023 2041 6464 2069  .        # Add i
-00048700: 7420 746f 2074 6865 2063 6163 6865 2061  t to the cache a
-00048710: 6e64 2072 6574 7572 6e0a 2020 2020 2020  nd return.      
-00048720: 2020 6966 2065 7863 6c75 6465 2069 7320    if exclude is 
-00048730: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00048740: 2020 7365 7461 7474 7228 7365 6c66 2c20    setattr(self, 
-00048750: 6174 7472 2c20 726f 6929 0a20 2020 2020  attr, roi).     
-00048760: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00048770: 2020 2020 2067 6574 6174 7472 2873 656c       getattr(sel
-00048780: 662c 2061 7474 7229 5b65 7863 6c75 6465  f, attr)[exclude
-00048790: 5d20 3d20 726f 690a 2020 2020 2020 2020  ] = roi.        
-000487a0: 7265 7475 726e 2072 6f69 0a0a 2020 2020  return roi..    
-000487b0: 6465 6620 6765 745f 636f 6e73 656e 7375  def get_consensu
-000487c0: 7328 7365 6c66 2c20 636f 6e73 656e 7375  s(self, consensu
-000487d0: 735f 7479 7065 2c20 636f 6c6f 723d 2262  s_type, color="b
-000487e0: 6c75 6522 2c20 2a2a 6b77 6172 6773 293a  lue", **kwargs):
-000487f0: 0a0a 2020 2020 2020 2020 2320 4765 7420  ..        # Get 
-00048800: 636f 6e73 656e 7375 7320 6361 6c63 756c  consensus calcul
-00048810: 6174 696f 6e20 6675 6e63 7469 6f6e 0a20  ation function. 
-00048820: 2020 2020 2020 2069 6620 636f 6e73 656e         if consen
-00048830: 7375 735f 7479 7065 203d 3d20 226d 616a  sus_type == "maj
-00048840: 6f72 6974 7922 3a0a 2020 2020 2020 2020  ority":.        
-00048850: 2020 2020 636f 6e73 656e 7375 735f 6675      consensus_fu
-00048860: 6e63 203d 2053 7472 7563 7475 7265 5365  nc = StructureSe
-00048870: 742e 6765 745f 6d61 6a6f 7269 7479 5f76  t.get_majority_v
-00048880: 6f74 650a 2020 2020 2020 2020 656c 6966  ote.        elif
-00048890: 2063 6f6e 7365 6e73 7573 5f74 7970 6520   consensus_type 
-000488a0: 3d3d 2022 7375 6d22 3a0a 2020 2020 2020  == "sum":.      
-000488b0: 2020 2020 2020 636f 6e73 656e 7375 735f        consensus_
-000488c0: 6675 6e63 203d 2053 7472 7563 7475 7265  func = Structure
-000488d0: 5365 742e 6765 745f 7375 6d0a 2020 2020  Set.get_sum.    
-000488e0: 2020 2020 656c 6966 2063 6f6e 7365 6e73      elif consens
-000488f0: 7573 5f74 7970 6520 3d3d 2022 6f76 6572  us_type == "over
-00048900: 6c61 7022 3a0a 2020 2020 2020 2020 2020  lap":.          
-00048910: 2020 636f 6e73 656e 7375 735f 6675 6e63    consensus_func
-00048920: 203d 2053 7472 7563 7475 7265 5365 742e   = StructureSet.
-00048930: 6765 745f 6f76 6572 6c61 700a 2020 2020  get_overlap.    
-00048940: 2020 2020 656c 6966 2063 6f6e 7365 6e73      elif consens
-00048950: 7573 5f74 7970 6520 3d3d 2022 7374 6170  us_type == "stap
-00048960: 6c65 223a 0a20 2020 2020 2020 2020 2020  le":.           
-00048970: 2063 6f6e 7365 6e73 7573 5f66 756e 6320   consensus_func 
-00048980: 3d20 5374 7275 6374 7572 6553 6574 2e67  = StructureSet.g
-00048990: 6574 5f73 7461 706c 650a 2020 2020 2020  et_staple.      
-000489a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000489b0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-000489c0: 7272 6f72 2866 2255 6e72 6563 6f67 6e69  rror(f"Unrecogni
-000489d0: 7365 6420 636f 6e73 656e 7375 7320 7479  sed consensus ty
-000489e0: 7065 3a20 7b63 6f6e 7365 6e73 7573 5f74  pe: {consensus_t
-000489f0: 7970 657d 2229 0a0a 2020 2020 2020 2020  ype}")..        
-00048a00: 7265 7475 726e 2063 6f6e 7365 6e73 7573  return consensus
-00048a10: 5f66 756e 6328 7365 6c66 2c20 636f 6c6f  _func(self, colo
-00048a20: 723d 636f 6c6f 722c 202a 2a6b 7761 7267  r=color, **kwarg
-00048a30: 7329 0a0a 2020 2020 6465 6620 6765 745f  s)..    def get_
-00048a40: 7374 6170 6c65 2873 656c 662c 2066 6f72  staple(self, for
-00048a50: 6365 3d46 616c 7365 2c20 6578 636c 7564  ce=False, exclud
-00048a60: 653d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  e=None, **kwargs
-00048a70: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
-00048a80: 7420 524f 4920 6f62 6a65 6374 2072 6570  t ROI object rep
-00048a90: 7265 7365 6e74 696e 6720 7468 6520 5354  resenting the ST
-00048aa0: 4150 4c45 2063 6f6d 6269 6e61 7469 6f6e  APLE combination
-00048ab0: 206f 6620 524f 4973 2069 6e20 7468 6973   of ROIs in this
-00048ac0: 200a 2020 2020 2020 2020 7374 7275 6374   .        struct
-00048ad0: 7572 6520 7365 742e 2049 6620 3c65 7863  ure set. If <exc
-00048ae0: 6c75 6465 3e20 6973 2073 6574 2074 6f20  lude> is set to 
-00048af0: 6120 7374 7269 6e67 2c20 7468 6520 524f  a string, the RO
-00048b00: 4920 7769 7468 2074 6861 7420 6e61 6d65  I with that name
-00048b10: 200a 2020 2020 2020 2020 7769 6c6c 2062   .        will b
-00048b20: 6520 6578 636c 7564 6564 2066 726f 6d20  e excluded from 
-00048b30: 7468 6520 6361 6c63 756c 6174 696f 6e2e  the calculation.
-00048b40: 0a0a 2020 2020 2020 2020 2a2a 5061 7261  ..        **Para
-00048b50: 6d65 7465 7273 3a2a 2a0a 0a20 2020 2020  meters:**..     
-00048b60: 2020 2066 6f72 6365 203a 2062 6f6f 6c2c     force : bool,
-00048b70: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
-00048b80: 2020 2020 2020 2020 2020 2049 6620 4661             If Fa
-00048b90: 6c73 6520 616e 6420 5354 4150 4c45 2052  lse and STAPLE R
-00048ba0: 4f49 2068 6173 2061 6c72 6561 6479 2062  OI has already b
-00048bb0: 6565 6e20 6372 6561 7465 642c 2074 6865  een created, the
-00048bc0: 200a 2020 2020 2020 2020 2020 2020 7072   .            pr
-00048bd0: 6576 696f 7573 6c79 2063 6f6d 7075 7465  eviously compute
-00048be0: 6420 524f 4920 7769 6c6c 2062 6520 7265  d ROI will be re
-00048bf0: 7475 726e 6564 2e20 4966 2046 6f72 6365  turned. If Force
-00048c00: 3d54 7275 652c 2074 6865 200a 2020 2020  =True, the .    
-00048c10: 2020 2020 2020 2020 5354 4150 4c45 2052          STAPLE R
-00048c20: 4f49 2077 696c 6c20 6265 2072 6563 7265  OI will be recre
-00048c30: 6174 6564 2e0a 0a20 2020 2020 2020 2065  ated...        e
-00048c40: 7863 6c75 6465 203a 2073 7472 2c20 6465  xclude : str, de
-00048c50: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00048c60: 2020 2020 2020 2049 6620 7365 7420 746f         If set to
-00048c70: 2061 2073 7472 696e 672c 2074 6865 2066   a string, the f
-00048c80: 6972 7374 2052 4f49 2069 6e20 7365 6c66  irst ROI in self
-00048c90: 2e72 6f69 7320 7769 7468 2074 6861 7420  .rois with that 
-00048ca0: 6e61 6d65 2077 696c 6c20 0a20 2020 2020  name will .     
-00048cb0: 2020 2020 2020 2062 6520 6578 636c 7564         be exclud
-00048cc0: 6564 2066 726f 6d20 7468 6520 636f 6d62  ed from the comb
-00048cd0: 696e 6174 696f 6e2e 2054 6869 7320 6d61  ination. This ma
-00048ce0: 7920 6265 2075 7365 6675 6c20 6966 2063  y be useful if c
-00048cf0: 6f6d 7061 7269 736f 6e20 0a20 2020 2020  omparison .     
-00048d00: 2020 2020 2020 206f 6620 6120 7369 6e67         of a sing
-00048d10: 6c65 2052 4f49 2077 6974 6820 7468 6520  le ROI with the 
-00048d20: 636f 6e73 656e 7375 7320 6f66 2061 6c6c  consensus of all
-00048d30: 206f 7468 6572 7320 6973 2064 6573 6972   others is desir
-00048d40: 6564 2e0a 0a20 2020 2020 2020 2060 2a2a  ed...        `**
-00048d50: 606b 7761 7267 7320 3a0a 2020 2020 2020  `kwargs :.      
-00048d60: 2020 2020 2020 4578 7472 6120 6b65 7977        Extra keyw
-00048d70: 6f72 6420 6172 6775 6d65 6e74 7320 746f  ord arguments to
-00048d80: 2070 6173 7320 746f 2074 6865 2063 7265   pass to the cre
-00048d90: 6174 696f 6e20 6f66 2074 6865 2052 4f49  ation of the ROI
-00048da0: 206f 626a 6563 740a 2020 2020 2020 2020   object.        
-00048db0: 2020 2020 7265 7072 6573 656e 7469 6e67      representing
-00048dc0: 2074 6865 2063 6f6d 6269 6e61 7469 6f6e   the combination
-00048dd0: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00048de0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00048df0: 6c66 2e5f 6765 745f 636f 6d62 696e 6174  lf._get_combinat
-00048e00: 696f 6e28 2273 7461 706c 6522 2c20 666f  ion("staple", fo
-00048e10: 7263 652c 2065 7863 6c75 6465 2c20 6372  rce, exclude, cr
-00048e20: 6561 7465 5f73 7461 706c 652c 0a20 2020  eate_staple,.   
-00048e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048e50: 2020 2a2a 6b77 6172 6773 290a 0a20 2020    **kwargs)..   
-00048e60: 2064 6566 2067 6574 5f6d 616a 6f72 6974   def get_majorit
-00048e70: 795f 766f 7465 2873 656c 662c 2066 6f72  y_vote(self, for
-00048e80: 6365 3d46 616c 7365 2c20 6578 636c 7564  ce=False, exclud
-00048e90: 653d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  e=None, **kwargs
-00048ea0: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
-00048eb0: 7420 524f 4920 6f62 6a65 6374 2072 6570  t ROI object rep
-00048ec0: 7265 7365 6e74 696e 6720 7468 6520 6d61  resenting the ma
-00048ed0: 6a6f 7269 7479 2076 6f74 6520 636f 6d62  jority vote comb
-00048ee0: 696e 6174 696f 6e20 6f66 2052 4f49 7320  ination of ROIs 
-00048ef0: 696e 200a 2020 2020 2020 2020 7468 6973  in .        this
-00048f00: 2073 7472 7563 7475 7265 2073 6574 2e20   structure set. 
-00048f10: 4966 203c 6578 636c 7564 653e 2069 7320  If <exclude> is 
-00048f20: 7365 7420 746f 2061 2073 7472 696e 672c  set to a string,
-00048f30: 2074 6865 2052 4f49 2077 6974 6820 7468   the ROI with th
-00048f40: 6174 200a 2020 2020 2020 2020 6e61 6d65  at .        name
-00048f50: 2077 696c 6c20 6265 2065 7863 6c75 6465   will be exclude
-00048f60: 6420 6672 6f6d 2074 6865 2063 616c 6375  d from the calcu
-00048f70: 6c61 7469 6f6e 2e0a 0a20 2020 2020 2020  lation...       
-00048f80: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-00048f90: 0a0a 2020 2020 2020 2020 666f 7263 6520  ..        force 
-00048fa0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-00048fb0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00048fc0: 2020 4966 2046 616c 7365 2061 6e64 206d    If False and m
-00048fd0: 616a 6f72 6974 7920 766f 7465 2052 4f49  ajority vote ROI
-00048fe0: 2068 6173 2061 6c72 6561 6479 2062 6565   has already bee
-00048ff0: 6e20 6372 6561 7465 642c 2074 6865 200a  n created, the .
-00049000: 2020 2020 2020 2020 2020 2020 7072 6576              prev
-00049010: 696f 7573 6c79 2063 6f6d 7075 7465 6420  iously computed 
-00049020: 524f 4920 7769 6c6c 2062 6520 7265 7475  ROI will be retu
-00049030: 726e 6564 2e20 4966 2046 6f72 6365 3d54  rned. If Force=T
-00049040: 7275 652c 2074 6865 200a 2020 2020 2020  rue, the .      
-00049050: 2020 2020 2020 6d61 6a6f 7269 7479 2076        majority v
-00049060: 6f74 6520 524f 4920 7769 6c6c 2062 6520  ote ROI will be 
-00049070: 7265 6372 6561 7465 642e 0a0a 2020 2020  recreated...    
-00049080: 2020 2020 6578 636c 7564 6520 3a20 7374      exclude : st
-00049090: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
-000490a0: 2020 2020 2020 2020 2020 2020 4966 2073              If s
-000490b0: 6574 2074 6f20 6120 7374 7269 6e67 2c20  et to a string, 
-000490c0: 7468 6520 6669 7273 7420 524f 4920 696e  the first ROI in
-000490d0: 2073 656c 662e 726f 6973 2077 6974 6820   self.rois with 
-000490e0: 7468 6174 206e 616d 6520 7769 6c6c 200a  that name will .
-000490f0: 2020 2020 2020 2020 2020 2020 6265 2065              be e
-00049100: 7863 6c75 6465 6420 6672 6f6d 2074 6865  xcluded from the
-00049110: 2063 6f6d 6269 6e61 7469 6f6e 2e20 5468   combination. Th
-00049120: 6973 206d 6179 2062 6520 7573 6566 756c  is may be useful
-00049130: 2069 6620 636f 6d70 6172 6973 6f6e 200a   if comparison .
-00049140: 2020 2020 2020 2020 2020 2020 6f66 2061              of a
-00049150: 2073 696e 676c 6520 524f 4920 7769 7468   single ROI with
-00049160: 2074 6865 2063 6f6e 7365 6e73 7573 206f   the consensus o
-00049170: 6620 616c 6c20 6f74 6865 7273 2069 7320  f all others is 
-00049180: 6465 7369 7265 642e 0a0a 2020 2020 2020  desired...      
-00049190: 2020 602a 2a60 6b77 6172 6773 203a 0a20    `**`kwargs :. 
-000491a0: 2020 2020 2020 2020 2020 2045 7874 7261             Extra
-000491b0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
-000491c0: 7473 2074 6f20 7061 7373 2074 6f20 7468  ts to pass to th
-000491d0: 6520 6372 6561 7469 6f6e 206f 6620 7468  e creation of th
-000491e0: 6520 524f 4920 6f62 6a65 6374 0a20 2020  e ROI object.   
-000491f0: 2020 2020 2020 2020 2072 6570 7265 7365           represe
-00049200: 6e74 696e 6720 7468 6520 636f 6d62 696e  nting the combin
-00049210: 6174 696f 6e2e 0a20 2020 2020 2020 2022  ation..        "
-00049220: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
-00049230: 726e 2073 656c 662e 5f67 6574 5f63 6f6d  rn self._get_com
-00049240: 6269 6e61 7469 6f6e 2822 6d61 6a6f 7269  bination("majori
-00049250: 7479 5f76 6f74 6522 2c20 666f 7263 652c  ty_vote", force,
-00049260: 2065 7863 6c75 6465 2c20 0a20 2020 2020   exclude, .     
-00049270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049290: 6372 6561 7465 5f6d 616a 6f72 6974 795f  create_majority_
-000492a0: 766f 7465 2c20 2a2a 6b77 6172 6773 290a  vote, **kwargs).
-000492b0: 0a20 2020 2064 6566 2067 6574 5f73 756d  .    def get_sum
-000492c0: 2873 656c 662c 2066 6f72 6365 3d46 616c  (self, force=Fal
-000492d0: 7365 2c20 6578 636c 7564 653d 4e6f 6e65  se, exclude=None
-000492e0: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
-000492f0: 2020 2020 2022 2222 4765 7420 524f 4920       """Get ROI 
-00049300: 6f62 6a65 6374 2072 6570 7265 7365 6e74  object represent
-00049310: 696e 6720 7468 6520 7375 6d20 6f66 2052  ing the sum of R
-00049320: 4f49 7320 696e 2074 6869 7320 7374 7275  OIs in this stru
-00049330: 6374 7572 6520 7365 742e 200a 2020 2020  cture set. .    
-00049340: 2020 2020 4966 203c 6578 636c 7564 653e      If <exclude>
-00049350: 2069 7320 7365 7420 746f 2061 2073 7472   is set to a str
-00049360: 696e 672c 2074 6865 2052 4f49 2077 6974  ing, the ROI wit
-00049370: 6820 7468 6174 206e 616d 6520 7769 6c6c  h that name will
-00049380: 2062 6520 0a20 2020 2020 2020 2065 7863   be .        exc
-00049390: 6c75 6465 6420 6672 6f6d 2074 6865 2063  luded from the c
-000493a0: 616c 6375 6c61 7469 6f6e 2e0a 0a20 2020  alculation...   
-000493b0: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
-000493c0: 733a 2a2a 0a0a 2020 2020 2020 2020 666f  s:**..        fo
-000493d0: 7263 6520 3a20 626f 6f6c 2c20 6465 6661  rce : bool, defa
-000493e0: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
-000493f0: 2020 2020 2020 4966 2046 616c 7365 2061        If False a
-00049400: 6e64 2073 756d 2052 4f49 2068 6173 2061  nd sum ROI has a
-00049410: 6c72 6561 6479 2062 6565 6e20 6372 6561  lready been crea
-00049420: 7465 642c 2074 6865 200a 2020 2020 2020  ted, the .      
-00049430: 2020 2020 2020 7072 6576 696f 7573 6c79        previously
-00049440: 2063 6f6d 7075 7465 6420 524f 4920 7769   computed ROI wi
-00049450: 6c6c 2062 6520 7265 7475 726e 6564 2e20  ll be returned. 
-00049460: 4966 2046 6f72 6365 3d54 7275 652c 2074  If Force=True, t
-00049470: 6865 200a 2020 2020 2020 2020 2020 2020  he .            
-00049480: 7375 6d20 524f 4920 7769 6c6c 2062 6520  sum ROI will be 
-00049490: 7265 6372 6561 7465 642e 0a0a 2020 2020  recreated...    
-000494a0: 2020 2020 6578 636c 7564 6520 3a20 7374      exclude : st
-000494b0: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
-000494c0: 2020 2020 2020 2020 2020 2020 4966 2073              If s
-000494d0: 6574 2074 6f20 6120 7374 7269 6e67 2c20  et to a string, 
-000494e0: 7468 6520 6669 7273 7420 524f 4920 696e  the first ROI in
-000494f0: 2073 656c 662e 726f 6973 2077 6974 6820   self.rois with 
-00049500: 7468 6174 206e 616d 6520 7769 6c6c 200a  that name will .
-00049510: 2020 2020 2020 2020 2020 2020 6265 2065              be e
-00049520: 7863 6c75 6465 6420 6672 6f6d 2074 6865  xcluded from the
-00049530: 2063 6f6d 6269 6e61 7469 6f6e 2e20 5468   combination. Th
-00049540: 6973 206d 6179 2062 6520 7573 6566 756c  is may be useful
-00049550: 2069 6620 636f 6d70 6172 6973 6f6e 200a   if comparison .
-00049560: 2020 2020 2020 2020 2020 2020 6f66 2061              of a
-00049570: 2073 696e 676c 6520 524f 4920 7769 7468   single ROI with
-00049580: 2074 6865 2063 6f6e 7365 6e73 7573 206f   the consensus o
-00049590: 6620 616c 6c20 6f74 6865 7273 2069 7320  f all others is 
-000495a0: 6465 7369 7265 642e 0a0a 2020 2020 2020  desired...      
-000495b0: 2020 602a 2a60 6b77 6172 6773 203a 0a20    `**`kwargs :. 
-000495c0: 2020 2020 2020 2020 2020 2045 7874 7261             Extra
-000495d0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
-000495e0: 7473 2074 6f20 7061 7373 2074 6f20 7468  ts to pass to th
-000495f0: 6520 6372 6561 7469 6f6e 206f 6620 7468  e creation of th
-00049600: 6520 524f 4920 6f62 6a65 6374 0a20 2020  e ROI object.   
-00049610: 2020 2020 2020 2020 2072 6570 7265 7365           represe
-00049620: 6e74 696e 6720 7468 6520 636f 6d62 696e  nting the combin
-00049630: 6174 696f 6e2e 0a20 2020 2020 2020 2022  ation..        "
-00049640: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
-00049650: 726e 2073 656c 662e 5f67 6574 5f63 6f6d  rn self._get_com
-00049660: 6269 6e61 7469 6f6e 2822 7375 6d22 2c20  bination("sum", 
-00049670: 666f 7263 652c 2065 7863 6c75 6465 2c20  force, exclude, 
-00049680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044830: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+00044840: 653d 6578 636c 7564 655f 6672 6f6d 5f63  e=exclude_from_c
+00044850: 6f6e 7365 6e73 7573 290a 2020 2020 2020  onsensus).      
+00044860: 2020 2020 2020 636f 6e73 656e 7375 735f        consensus_
+00044870: 6b77 6172 6773 203d 207b 7d20 6966 2065  kwargs = {} if e
+00044880: 7863 6c75 6465 5f66 726f 6d5f 636f 6e73  xclude_from_cons
+00044890: 656e 7375 7320 6973 206e 6f74 204e 6f6e  ensus is not Non
+000448a0: 6520 5c0a 2020 2020 2020 2020 2020 2020  e \.            
+000448b0: 2020 2020 2020 2020 656c 7365 206b 7761          else kwa
+000448c0: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
+000448d0: 6966 2063 6f6e 7365 6e73 7573 5f6c 696e  if consensus_lin
+000448e0: 6577 6964 7468 2069 7320 4e6f 6e65 3a0a  ewidth is None:.
+000448f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044900: 636f 6e73 656e 7375 735f 6c69 6e65 7769  consensus_linewi
+00044910: 6474 6820 3d20 6465 6661 756c 7450 6172  dth = defaultPar
+00044920: 616d 735b 226c 696e 6573 2e6c 696e 6577  ams["lines.linew
+00044930: 6964 7468 225d 5b30 5d20 2b20 310a 0a20  idth"][0] + 1.. 
+00044940: 2020 2020 2020 2020 2020 2063 6f6e 7365             conse
+00044950: 6e73 7573 2e70 6c6f 7428 0a20 2020 2020  nsus.plot(.     
+00044960: 2020 2020 2020 2020 2020 2076 6965 772c             view,
+00044970: 2073 6c3d 736c 2c20 6964 783d 6964 782c   sl=sl, idx=idx,
+00044980: 2070 6f73 3d70 6f73 2c20 706c 6f74 5f74   pos=pos, plot_t
+00044990: 7970 653d 706c 6f74 5f74 7970 652c 200a  ype=plot_type, .
+000449a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000449b0: 636f 6c6f 723d 636f 6e73 656e 7375 735f  color=consensus_
+000449c0: 636f 6c6f 722c 206c 696e 6577 6964 7468  color, linewidth
+000449d0: 3d63 6f6e 7365 6e73 7573 5f6c 696e 6577  =consensus_linew
+000449e0: 6964 7468 2c20 0a20 2020 2020 2020 2020  idth, .         
+000449f0: 2020 2020 2020 206f 7061 6369 7479 3d6f         opacity=o
+00044a00: 7061 6369 7479 2c20 7368 6f77 3d46 616c  pacity, show=Fal
+00044a10: 7365 2c20 6178 3d61 782c 202a 2a63 6f6e  se, ax=ax, **con
+00044a20: 7365 6e73 7573 5f6b 7761 7267 7329 0a0a  sensus_kwargs)..
+00044a30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00044a40: 2e61 7820 3d20 636f 6e73 656e 7375 732e  .ax = consensus.
+00044a50: 6178 0a20 2020 2020 2020 2020 2020 2073  ax.            s
+00044a60: 656c 662e 6669 6720 3d20 636f 6e73 656e  elf.fig = consen
+00044a70: 7375 732e 6669 670a 0a20 2020 2020 2020  sus.fig..       
+00044a80: 2020 2020 2069 6620 6c65 6765 6e64 3a0a       if legend:.
+00044a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044aa0: 726f 695f 6861 6e64 6c65 732e 6170 7065  roi_handles.appe
+00044ab0: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
+00044ac0: 2020 2020 2020 2020 2020 2020 636f 6e73              cons
+00044ad0: 656e 7375 732e 6765 745f 7061 7463 6828  ensus.get_patch(
+00044ae0: 706c 6f74 5f74 7970 652c 2063 6f6e 7365  plot_type, conse
+00044af0: 6e73 7573 5f63 6f6c 6f72 2c20 6f70 6163  nsus_color, opac
+00044b00: 6974 792c 0a20 2020 2020 2020 2020 2020  ity,.           
+00044b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044b20: 206c 696e 6577 6964 7468 2c20 636f 6e73   linewidth, cons
+00044b30: 656e 7375 732e 6e61 6d65 2929 0a0a 2020  ensus.name))..  
+00044b40: 2020 2020 2020 2020 2020 2320 506c 6f74            # Plot
+00044b50: 2065 7863 6c75 6465 6420 524f 4920 6f6e   excluded ROI on
+00044b60: 2074 6f70 0a20 2020 2020 2020 2020 2020   top.           
+00044b70: 2069 6620 6578 636c 7564 655f 6672 6f6d   if exclude_from
+00044b80: 5f63 6f6e 7365 6e73 7573 2069 7320 6e6f  _consensus is no
+00044b90: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00044ba0: 2020 2020 2020 2020 6b77 6172 6773 5b22          kwargs["
+00044bb0: 696e 636c 7564 655f 696d 6167 6522 5d20  include_image"] 
+00044bc0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00044bd0: 2020 2020 2020 2020 6578 636c 7564 6564          excluded
+00044be0: 203d 2073 656c 662e 6765 745f 726f 6928   = self.get_roi(
+00044bf0: 6578 636c 7564 655f 6672 6f6d 5f63 6f6e  exclude_from_con
+00044c00: 7365 6e73 7573 290a 2020 2020 2020 2020  sensus).        
+00044c10: 2020 2020 2020 2020 6578 636c 7564 6564          excluded
+00044c20: 2e70 6c6f 7428 7669 6577 2c20 736c 3d73  .plot(view, sl=s
+00044c30: 6c2c 2069 6478 3d69 6478 2c20 706f 733d  l, idx=idx, pos=
+00044c40: 706f 732c 2070 6c6f 745f 7479 7065 3d70  pos, plot_type=p
+00044c50: 6c6f 745f 7479 7065 2c0a 2020 2020 2020  lot_type,.      
+00044c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044c70: 2020 2020 2020 2020 6f70 6163 6974 793d          opacity=
+00044c80: 6f70 6163 6974 792c 206c 696e 6577 6964  opacity, linewid
+00044c90: 7468 3d6c 696e 6577 6964 7468 2c20 7368  th=linewidth, sh
+00044ca0: 6f77 3d46 616c 7365 2c0a 2020 2020 2020  ow=False,.      
+00044cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044cc0: 2020 2020 2020 2020 6178 3d73 656c 662e          ax=self.
+00044cd0: 6178 2c20 2a2a 6b77 6172 6773 290a 2020  ax, **kwargs).  
+00044ce0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00044cf0: 206c 6567 656e 643a 0a20 2020 2020 2020   legend:.       
+00044d00: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+00044d10: 5f68 616e 646c 6573 2e61 7070 656e 6428  _handles.append(
+00044d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044d30: 2020 2020 2020 2020 2065 7863 6c75 6465           exclude
+00044d40: 642e 6765 745f 7061 7463 6828 706c 6f74  d.get_patch(plot
+00044d50: 5f74 7970 652c 2065 7863 6c75 6465 642e  _type, excluded.
+00044d60: 636f 6c6f 722c 206f 7061 6369 7479 2c0a  color, opacity,.
+00044d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044d80: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+00044d90: 7769 6474 682c 2065 7863 6c75 6465 642e  width, excluded.
+00044da0: 6e61 6d65 2929 0a0a 2020 2020 2020 2020  name))..        
+00044db0: 2320 4f74 6865 7277 6973 652c 2070 6c6f  # Otherwise, plo
+00044dc0: 7420 6669 7273 7420 524f 4920 616e 6420  t first ROI and 
+00044dd0: 6765 7420 6178 6573 0a20 2020 2020 2020  get axes.       
+00044de0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00044df0: 2020 2069 6620 6365 6e74 7265 5f6f 6e5f     if centre_on_
+00044e00: 726f 6920 6973 206e 6f74 204e 6f6e 653a  roi is not None:
+00044e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044e20: 2063 656e 7472 616c 203d 2073 656c 662e   central = self.
+00044e30: 6765 745f 726f 6928 6365 6e74 7265 5f6f  get_roi(centre_o
+00044e40: 6e5f 726f 6929 0a20 2020 2020 2020 2020  n_roi).         
+00044e50: 2020 2020 2020 2069 6478 203d 2063 656e         idx = cen
+00044e60: 7472 616c 2e67 6574 5f6d 6964 5f69 6478  tral.get_mid_idx
+00044e70: 2876 6965 7729 0a20 2020 2020 2020 2020  (view).         
+00044e80: 2020 2020 2020 2073 6c20 3d20 4e6f 6e65         sl = None
+00044e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044ea0: 2070 6f73 203d 204e 6f6e 650a 2020 2020   pos = None.    
+00044eb0: 2020 2020 2020 2020 2020 2020 6669 7273              firs
+00044ec0: 745f 726f 6920 3d20 6365 6e74 7261 6c0a  t_roi = central.
+00044ed0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00044ee0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00044ef0: 2020 6365 6e74 7261 6c20 3d20 7365 6c66    central = self
+00044f00: 2e67 6574 5f72 6f69 7328 6967 6e6f 7265  .get_rois(ignore
+00044f10: 5f65 6d70 7479 3d54 7275 6529 5b30 5d0a  _empty=True)[0].
+00044f20: 0a20 2020 2020 2020 2020 2020 2063 656e  .            cen
+00044f30: 7472 616c 2e70 6c6f 7428 7669 6577 2c20  tral.plot(view, 
+00044f40: 736c 3d73 6c2c 2069 6478 3d69 6478 2c20  sl=sl, idx=idx, 
+00044f50: 706f 733d 706f 732c 2070 6c6f 745f 7479  pos=pos, plot_ty
+00044f60: 7065 3d70 6c6f 745f 7479 7065 2c0a 2020  pe=plot_type,.  
+00044f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044f80: 2020 2020 2020 206f 7061 6369 7479 3d6f         opacity=o
+00044f90: 7061 6369 7479 2c20 6c69 6e65 7769 6474  pacity, linewidt
+00044fa0: 683d 6c69 6e65 7769 6474 682c 2073 686f  h=linewidth, sho
+00044fb0: 773d 4661 6c73 652c 0a20 2020 2020 2020  w=False,.       
+00044fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044fd0: 2020 6178 3d61 782c 202a 2a6b 7761 7267    ax=ax, **kwarg
+00044fe0: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
+00044ff0: 7365 6c66 2e66 6967 203d 2063 656e 7472  self.fig = centr
+00045000: 616c 2e66 6967 0a20 2020 2020 2020 2020  al.fig.         
+00045010: 2020 2073 656c 662e 6178 203d 2063 656e     self.ax = cen
+00045020: 7472 616c 2e61 780a 0a20 2020 2020 2020  tral.ax..       
+00045030: 2020 2020 2069 6620 6c65 6765 6e64 3a0a       if legend:.
+00045040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045050: 726f 695f 6861 6e64 6c65 732e 6170 7065  roi_handles.appe
+00045060: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
+00045070: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
+00045080: 7261 6c2e 6765 745f 7061 7463 6828 706c  ral.get_patch(pl
+00045090: 6f74 5f74 7970 652c 2063 656e 7472 616c  ot_type, central
+000450a0: 2e63 6f6c 6f72 2c20 6f70 6163 6974 792c  .color, opacity,
+000450b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000450c0: 2020 2020 2020 2020 2020 2020 206c 696e               lin
+000450d0: 6577 6964 7468 2c20 6365 6e74 7261 6c2e  ewidth, central.
+000450e0: 6e61 6d65 2929 0a0a 2020 2020 2020 2020  name))..        
+000450f0: 2020 2020 2320 506c 6f74 206f 7468 6572      # Plot other
+00045100: 2052 4f49 730a 2020 2020 2020 2020 2020   ROIs.          
+00045110: 2020 666f 7220 692c 2072 6f69 2069 6e20    for i, roi in 
+00045120: 656e 756d 6572 6174 6528 7365 6c66 2e67  enumerate(self.g
+00045130: 6574 5f72 6f69 7328 6967 6e6f 7265 5f65  et_rois(ignore_e
+00045140: 6d70 7479 3d54 7275 6529 293a 0a0a 2020  mpty=True)):..  
+00045150: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00045160: 2072 6f69 2069 7320 6365 6e74 7261 6c3a   roi is central:
+00045170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00045180: 2020 2020 2063 6f6e 7469 6e75 650a 0a20       continue.. 
+00045190: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000451a0: 6c6f 745f 6b77 6172 6773 203d 207b 7d20  lot_kwargs = {} 
+000451b0: 6966 2069 203c 206c 656e 2873 656c 662e  if i < len(self.
+000451c0: 726f 6973 2920 2d20 3120 656c 7365 206b  rois) - 1 else k
+000451d0: 7761 7267 730a 2020 2020 2020 2020 2020  wargs.          
+000451e0: 2020 2020 2020 726f 692e 706c 6f74 2876        roi.plot(v
+000451f0: 6965 772c 2073 6c3d 736c 2c20 6964 783d  iew, sl=sl, idx=
+00045200: 6964 782c 2070 6f73 3d70 6f73 2c20 706c  idx, pos=pos, pl
+00045210: 6f74 5f74 7970 653d 706c 6f74 5f74 7970  ot_type=plot_typ
+00045220: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00045230: 2020 2020 2020 2020 2020 2020 6f70 6163              opac
+00045240: 6974 793d 6f70 6163 6974 792c 206c 696e  ity=opacity, lin
+00045250: 6577 6964 7468 3d6c 696e 6577 6964 7468  ewidth=linewidth
+00045260: 2c20 7368 6f77 3d46 616c 7365 2c0a 2020  , show=False,.  
+00045270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045280: 2020 2020 2020 2061 783d 7365 6c66 2e61         ax=self.a
+00045290: 782c 202a 2a6b 7761 7267 7329 0a0a 2020  x, **kwargs)..  
+000452a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000452b0: 206c 6567 656e 643a 0a20 2020 2020 2020   legend:.       
+000452c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000452d0: 2869 6478 2069 7320 4e6f 6e65 2061 6e64  (idx is None and
+000452e0: 2070 6f73 2069 7320 4e6f 6e65 2061 6e64   pos is None and
+000452f0: 2073 6c20 6973 204e 6f6e 6529 206f 7220   sl is None) or 
+00045300: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00045310: 2020 2020 2020 2020 2072 6f69 2e6f 6e5f           roi.on_
+00045320: 736c 6963 6528 7669 6577 2c20 736c 3d73  slice(view, sl=s
+00045330: 6c2c 2069 6478 3d69 6478 2c20 706f 733d  l, idx=idx, pos=
+00045340: 706f 7329 3a0a 2020 2020 2020 2020 2020  pos):.          
+00045350: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+00045360: 695f 6861 6e64 6c65 732e 6170 7065 6e64  i_handles.append
+00045370: 2872 6f69 2e67 6574 5f70 6174 6368 2870  (roi.get_patch(p
+00045380: 6c6f 745f 7479 7065 2c20 726f 692e 636f  lot_type, roi.co
+00045390: 6c6f 722c 0a20 2020 2020 2020 2020 2020  lor,.           
+000453a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000453b0: 206f 7061 6369 7479 2c20 6c69 6e65 7769   opacity, linewi
+000453c0: 6474 682c 2072 6f69 2e6e 616d 6529 290a  dth, roi.name)).
+000453d0: 0a20 2020 2020 2020 2023 2044 7261 7720  .        # Draw 
+000453e0: 6c65 6765 6e64 0a20 2020 2020 2020 2069  legend.        i
+000453f0: 6620 6c65 6765 6e64 2061 6e64 206c 656e  f legend and len
+00045400: 2872 6f69 5f68 616e 646c 6573 293a 0a20  (roi_handles):. 
+00045410: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00045420: 6178 2e6c 6567 656e 6428 6861 6e64 6c65  ax.legend(handle
+00045430: 733d 726f 695f 6861 6e64 6c65 732c 0a20  s=roi_handles,. 
+00045440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045450: 2020 2062 626f 785f 746f 5f61 6e63 686f     bbox_to_ancho
+00045460: 723d 6c65 6765 6e64 5f62 626f 785f 746f  r=legend_bbox_to
+00045470: 5f61 6e63 686f 722c 206c 6f63 3d6c 6567  _anchor, loc=leg
+00045480: 656e 645f 6c6f 632c 0a20 2020 2020 2020  end_loc,.       
+00045490: 2020 2020 2020 2020 2020 2020 2066 6163               fac
+000454a0: 6563 6f6c 6f72 3d22 7768 6974 6522 2c20  ecolor="white", 
+000454b0: 6672 616d 6561 6c70 6861 3d31 0a20 2020  framealpha=1.   
+000454c0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+000454d0: 2020 2020 2320 4469 7370 6c61 7920 696d      # Display im
+000454e0: 6167 650a 2020 2020 2020 2020 706c 742e  age.        plt.
+000454f0: 7469 6768 745f 6c61 796f 7574 2829 0a20  tight_layout(). 
+00045500: 2020 2020 2020 2069 6620 7368 6f77 3a0a         if show:.
+00045510: 2020 2020 2020 2020 2020 2020 706c 742e              plt.
+00045520: 7368 6f77 2829 0a0a 2020 2020 2020 2020  show()..        
+00045530: 2320 5361 7665 2074 6f20 6669 6c65 0a20  # Save to file. 
+00045540: 2020 2020 2020 2069 6620 7361 7665 5f61         if save_a
+00045550: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
+00045560: 656c 662e 6669 672e 7361 7665 6669 6728  elf.fig.savefig(
+00045570: 7361 7665 5f61 7329 0a20 2020 2020 2020  save_as).       
+00045580: 2020 2020 2070 6c74 2e63 6c6f 7365 2829       plt.close()
+00045590: 0a0a 2020 2020 6465 6620 706c 6f74 5f63  ..    def plot_c
+000455a0: 6f6e 7365 6e73 7573 2873 656c 662c 2063  onsensus(self, c
+000455b0: 6f6e 7365 6e73 7573 5f74 7970 652c 2076  onsensus_type, v
+000455c0: 6965 773d 2278 2d79 222c 2073 6c3d 4e6f  iew="x-y", sl=No
+000455d0: 6e65 2c20 6964 783d 4e6f 6e65 2c0a 2020  ne, idx=None,.  
+000455e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000455f0: 2020 2020 2070 6f73 3d4e 6f6e 652c 2072       pos=None, r
+00045600: 6f69 735f 696e 5f62 6163 6b67 726f 756e  ois_in_backgroun
+00045610: 643d 4661 6c73 652c 2063 6f6c 6f72 3d4e  d=False, color=N
+00045620: 6f6e 652c 200a 2020 2020 2020 2020 2020  one, .          
+00045630: 2020 2020 2020 2020 2020 2020 2073 686f               sho
+00045640: 773d 5472 7565 2c20 2a2a 6b77 6172 6773  w=True, **kwargs
+00045650: 293a 0a20 2020 2020 2020 2022 2222 506c  ):.        """Pl
+00045660: 6f74 2074 6865 2063 6f6e 7365 6e73 7573  ot the consensus
+00045670: 2063 6f6e 746f 7572 2c20 7769 7468 2061   contour, with a
+00045680: 6c6c 2052 4f49 7320 696e 2067 7265 7920  ll ROIs in grey 
+00045690: 6265 6869 6e64 2069 7420 6966 0a20 2020  behind it if.   
+000456a0: 2020 2020 2072 6f69 735f 696e 5f62 6163       rois_in_bac
+000456b0: 6b67 726f 756e 643d 5472 7565 2e22 2222  kground=True."""
+000456c0: 0a0a 2020 2020 2020 2020 636f 6e73 656e  ..        consen
+000456d0: 7375 7320 3d20 7365 6c66 2e67 6574 5f63  sus = self.get_c
+000456e0: 6f6e 7365 6e73 7573 2863 6f6e 7365 6e73  onsensus(consens
+000456f0: 7573 5f74 7970 6529 0a0a 2020 2020 2020  us_type)..      
+00045700: 2020 6966 2069 6478 2069 7320 4e6f 6e65    if idx is None
+00045710: 2061 6e64 2073 6c20 6973 204e 6f6e 6520   and sl is None 
+00045720: 616e 6420 706f 7320 6973 204e 6f6e 653a  and pos is None:
+00045730: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
+00045740: 203d 2073 656c 662e 6765 745f 6d69 645f   = self.get_mid_
+00045750: 6964 7828 7669 6577 290a 2020 2020 2020  idx(view).      
+00045760: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00045770: 2020 2020 6964 7820 3d20 636f 6e73 656e      idx = consen
+00045780: 7375 732e 6765 745f 6964 7828 7669 6577  sus.get_idx(view
+00045790: 2c20 736c 2c20 6964 782c 2070 6f73 290a  , sl, idx, pos).
+000457a0: 2020 2020 2020 2020 6178 203d 2073 6b72          ax = skr
+000457b0: 742e 696d 6167 652e 5f73 6c69 6365 5f61  t.image._slice_a
+000457c0: 7865 735b 7669 6577 5d0a 2020 2020 2020  xes[view].      
+000457d0: 2020 706f 7320 3d20 636f 6e73 656e 7375    pos = consensu
+000457e0: 732e 6964 785f 746f 5f70 6f73 2869 6478  s.idx_to_pos(idx
+000457f0: 2c20 6178 290a 0a20 2020 2020 2020 2069  , ax)..        i
+00045800: 6620 636f 6e73 656e 7375 732e 656d 7074  f consensus.empt
+00045810: 793a 0a20 2020 2020 2020 2020 2020 2070  y:.            p
+00045820: 7269 6e74 2866 227b 636f 6e73 656e 7375  rint(f"{consensu
+00045830: 735f 7479 7065 7d20 636f 6e74 6f75 7220  s_type} contour 
+00045840: 6973 2065 6d70 7479 2229 0a20 2020 2020  is empty").     
+00045850: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+00045860: 2020 2020 2020 636f 6e73 656e 7375 732e        consensus.
+00045870: 706c 6f74 2863 6f6c 6f72 3d63 6f6c 6f72  plot(color=color
+00045880: 2c20 706f 733d 706f 732c 2076 6965 773d  , pos=pos, view=
+00045890: 7669 6577 2c20 7368 6f77 3d46 616c 7365  view, show=False
+000458a0: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
+000458b0: 2020 2020 2069 6620 726f 6973 5f69 6e5f       if rois_in_
+000458c0: 6261 636b 6772 6f75 6e64 3a0a 2020 2020  background:.    
+000458d0: 2020 2020 2020 2020 6b77 6172 6773 5b22          kwargs["
+000458e0: 6178 225d 203d 2063 6f6e 7365 6e73 7573  ax"] = consensus
+000458f0: 2e61 780a 2020 2020 2020 2020 2020 2020  .ax.            
+00045900: 666f 7220 726f 6920 696e 2073 656c 662e  for roi in self.
+00045910: 6765 745f 726f 6973 2869 676e 6f72 655f  get_rois(ignore_
+00045920: 656d 7074 793d 5472 7565 293a 0a20 2020  empty=True):.   
+00045930: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+00045940: 2e70 6c6f 7428 636f 6c6f 723d 226c 6967  .plot(color="lig
+00045950: 6874 6772 6579 222c 2076 6965 773d 7669  htgrey", view=vi
+00045960: 6577 2c20 706f 733d 706f 732c 2073 686f  ew, pos=pos, sho
+00045970: 773d 4661 6c73 652c 202a 2a6b 7761 7267  w=False, **kwarg
+00045980: 7329 0a20 2020 2020 2020 2020 2020 2063  s).            c
+00045990: 6f6e 7365 6e73 7573 2e70 6c6f 7428 636f  onsensus.plot(co
+000459a0: 6c6f 723d 636f 6c6f 722c 2076 6965 773d  lor=color, view=
+000459b0: 7669 6577 2c20 706f 733d 706f 732c 2073  view, pos=pos, s
+000459c0: 686f 773d 4661 6c73 652c 202a 2a6b 7761  how=False, **kwa
+000459d0: 7267 7329 0a0a 2020 2020 2020 2020 636f  rgs)..        co
+000459e0: 6e73 656e 7375 732e 6178 2e73 6574 5f61  nsensus.ax.set_a
+000459f0: 7370 6563 7428 2265 7175 616c 2229 0a0a  spect("equal")..
+00045a00: 2020 2020 2020 2020 6966 2073 686f 773a          if show:
+00045a10: 0a20 2020 2020 2020 2020 2020 2070 6c74  .            plt
+00045a20: 2e73 686f 7728 290a 0a20 2020 2064 6566  .show()..    def
+00045a30: 2067 6574 5f6c 656e 6774 6828 7365 6c66   get_length(self
+00045a40: 2c20 6178 293a 0a20 2020 2020 2020 2022  , ax):.        "
+00045a50: 2222 4765 7420 6c65 6e67 7468 2063 6f76  ""Get length cov
+00045a60: 6572 6564 2062 7920 524f 4973 2061 6c6f  ered by ROIs alo
+00045a70: 6e67 2061 6e20 6178 6973 2e22 2222 0a0a  ng an axis."""..
+00045a80: 2020 2020 2020 2020 6578 7465 6e74 203d          extent =
+00045a90: 2073 656c 662e 6765 745f 6578 7465 6e74   self.get_extent
+00045aa0: 2861 783d 6178 290a 2020 2020 2020 2020  (ax=ax).        
+00045ab0: 7265 7475 726e 2061 6273 2865 7874 656e  return abs(exten
+00045ac0: 745b 315d 202d 2065 7874 656e 745b 305d  t[1] - extent[0]
+00045ad0: 290a 0a20 2020 2064 6566 2067 6574 5f63  )..    def get_c
+00045ae0: 656e 7472 6528 7365 6c66 2c20 2a2a 6b77  entre(self, **kw
+00045af0: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
+00045b00: 2222 4765 7420 3344 2063 656e 7472 6520  ""Get 3D centre 
+00045b10: 6f66 2074 6865 2061 7265 6120 636f 7665  of the area cove
+00045b20: 7265 6420 6279 2052 4f49 732e 2222 220a  red by ROIs.""".
+00045b30: 0a20 2020 2020 2020 206b 7761 7267 732e  .        kwargs.
+00045b40: 706f 7028 2261 7822 2c20 4e6f 6e65 290a  pop("ax", None).
+00045b50: 2020 2020 2020 2020 6578 7465 6e74 7320          extents 
+00045b60: 3d20 5b73 656c 662e 6765 745f 6578 7465  = [self.get_exte
+00045b70: 6e74 2861 783d 6178 2c20 2a2a 6b77 6172  nt(ax=ax, **kwar
+00045b80: 6773 2920 666f 7220 6178 2069 6e20 736b  gs) for ax in sk
+00045b90: 7274 2e69 6d61 6765 2e5f 6178 6573 5d0a  rt.image._axes].
+00045ba0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+00045bb0: 6e70 2e6d 6561 6e28 6578 2920 666f 7220  np.mean(ex) for 
+00045bc0: 6578 2069 6e20 6578 7465 6e74 735d 0a0a  ex in extents]..
+00045bd0: 2020 2020 6465 6620 6669 6e64 5f6d 6f73      def find_mos
+00045be0: 745f 706f 7075 6c61 7465 645f 736c 6963  t_populated_slic
+00045bf0: 6528 7365 6c66 2c20 7669 6577 3d22 782d  e(self, view="x-
+00045c00: 7922 293a 0a20 2020 2020 2020 2022 2222  y"):.        """
+00045c10: 4669 6e64 2074 6865 2069 6e64 6578 206f  Find the index o
+00045c20: 6620 7468 6520 736c 6963 6520 7769 7468  f the slice with
+00045c30: 2074 6865 206d 6f73 7420 524f 4973 206f   the most ROIs o
+00045c40: 6e20 6974 2e22 2222 0a0a 2020 2020 2020  n it."""..      
+00045c50: 2020 696e 6469 6365 7320 3d20 5b5d 0a20    indices = []. 
+00045c60: 2020 2020 2020 2066 6f72 2072 6f69 2069         for roi i
+00045c70: 6e20 7365 6c66 2e67 6574 5f72 6f69 7328  n self.get_rois(
+00045c80: 6967 6e6f 7265 5f65 6d70 7479 3d54 7275  ignore_empty=Tru
+00045c90: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00045ca0: 696e 6469 6365 732e 6578 7465 6e64 2872  indices.extend(r
+00045cb0: 6f69 2e67 6574 5f69 6e64 6963 6573 2876  oi.get_indices(v
+00045cc0: 6965 7729 290a 2020 2020 2020 2020 7661  iew)).        va
+00045cd0: 6c73 2c20 636f 756e 7473 203d 206e 702e  ls, counts = np.
+00045ce0: 756e 6971 7565 2869 6e64 6963 6573 2c20  unique(indices, 
+00045cf0: 7265 7475 726e 5f63 6f75 6e74 733d 5472  return_counts=Tr
+00045d00: 7565 290a 2020 2020 2020 2020 7265 7475  ue).        retu
+00045d10: 726e 2076 616c 735b 6e70 2e61 7267 6d61  rn vals[np.argma
+00045d20: 7828 636f 756e 7473 295d 0a0a 2020 2020  x(counts)]..    
+00045d30: 6465 6620 7669 6577 2873 656c 662c 2069  def view(self, i
+00045d40: 6e63 6c75 6465 5f69 6d61 6765 3d54 7275  nclude_image=Tru
+00045d50: 652c 2072 6f69 733d 4e6f 6e65 2c20 766f  e, rois=None, vo
+00045d60: 7865 6c5f 7369 7a65 3d5b 312c 2031 5d2c  xel_size=[1, 1],
+00045d70: 2062 7566 6665 723d 352c 202a 2a6b 7761   buffer=5, **kwa
+00045d80: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
+00045d90: 2256 6965 7720 7468 6520 5374 7275 6374  "View the Struct
+00045da0: 7572 6553 6574 2e0a 0a20 2020 2020 2020  ureSet...       
+00045db0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+00045dc0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+00045dd0: 2020 696e 636c 7564 655f 696d 6167 6520    include_image 
+00045de0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
+00045df0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00045e00: 2049 6620 5472 7565 2061 6e64 2074 6869   If True and thi
+00045e10: 7320 5374 7275 6374 7572 6553 6574 2068  s StructureSet h
+00045e20: 6173 2061 6e20 6173 736f 6369 6174 6564  as an associated
+00045e30: 2069 6d61 6765 200a 2020 2020 2020 2020   image .        
+00045e40: 2020 2020 2869 6e20 7365 6c66 2e69 6d61      (in self.ima
+00045e50: 6765 292c 2074 6865 2069 6d61 6765 2077  ge), the image w
+00045e60: 696c 6c20 6265 2064 6973 706c 6179 6564  ill be displayed
+00045e70: 2062 6568 696e 6420 7468 6520 524f 4973   behind the ROIs
+00045e80: 2e0a 0a20 2020 2020 2020 2072 6f69 7320  ...        rois 
+00045e90: 3a20 5374 7275 6374 7572 6553 6574 2f6c  : StructureSet/l
+00045ea0: 6973 742c 2064 6566 6175 6c74 3d4e 6f6e  ist, default=Non
+00045eb0: 650a 2020 2020 2020 2020 2020 2020 416e  e.            An
+00045ec0: 7920 6f74 6865 7220 524f 4973 206f 7220  y other ROIs or 
+00045ed0: 5374 7275 6374 7572 6553 6574 7320 746f  StructureSets to
+00045ee0: 2069 6e63 6c75 6465 2069 6e20 7468 6520   include in the 
+00045ef0: 706c 6f74 2e0a 0a20 2020 2020 2020 2076  plot...        v
+00045f00: 6f78 656c 5f73 697a 6520 3a20 6c69 7374  oxel_size : list
+00045f10: 2c20 6465 6661 756c 743d 5b31 2c20 315d  , default=[1, 1]
+00045f20: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00045f30: 7468 6520 5374 7275 6374 7572 6553 6574  the StructureSet
+00045f40: 2064 6f65 7320 6e6f 7420 6861 7665 2061   does not have a
+00045f50: 6e20 6173 736f 6369 6174 6564 2069 6d61  n associated ima
+00045f60: 6765 2061 6e64 2068 6173 2052 4f49 7320  ge and has ROIs 
+00045f70: 0a20 2020 2020 2020 2020 2020 2064 6573  .            des
+00045f80: 6372 6962 6564 206f 6e6c 7920 6279 2063  cribed only by c
+00045f90: 6f6e 746f 7572 732c 2074 6869 7320 7769  ontours, this wi
+00045fa0: 6c6c 2062 6520 7468 6520 766f 7865 6c20  ll be the voxel 
+00045fb0: 7369 7a65 7320 7573 6564 2069 6e20 0a20  sizes used in . 
+00045fc0: 2020 2020 2020 2020 2020 2074 6865 2078             the x
+00045fd0: 2d79 2064 6972 6563 7469 6f6e 2077 6865  -y direction whe
+00045fe0: 6e20 636f 6e76 6572 7469 6e67 2052 4f49  n converting ROI
+00045ff0: 7320 746f 206d 6173 6b73 2069 6620 6120  s to masks if a 
+00046000: 6d61 736b 2070 6c6f 7420 0a20 2020 2020  mask plot .     
+00046010: 2020 2020 2020 2074 7970 6520 6973 2073         type is s
+00046020: 656c 6563 7465 642e 0a0a 2020 2020 2020  elected...      
+00046030: 2020 6275 6666 6572 203a 2069 6e74 2c20    buffer : int, 
+00046040: 6465 6661 756c 743d 350a 2020 2020 2020  default=5.      
+00046050: 2020 2020 2020 4966 2074 6865 2053 7472        If the Str
+00046060: 7563 7475 7265 5365 7420 646f 6573 206e  uctureSet does n
+00046070: 6f74 2068 6176 6520 616e 2061 7373 6f63  ot have an assoc
+00046080: 6961 7465 6420 696d 6167 6520 616e 6420  iated image and 
+00046090: 6861 7320 524f 4973 0a20 2020 2020 2020  has ROIs.       
+000460a0: 2020 2020 2064 6573 6372 6962 6564 206f       described o
+000460b0: 6e6c 7920 6279 2063 6f6e 746f 7572 732c  nly by contours,
+000460c0: 2074 6869 7320 7769 6c6c 2062 6520 7468   this will be th
+000460d0: 6520 6e75 6d62 6572 206f 6620 6275 6666  e number of buff
+000460e0: 6572 2076 6f78 656c 7320 0a20 2020 2020  er voxels .     
+000460f0: 2020 2020 2020 2028 692e 652e 2077 6869         (i.e. whi
+00046100: 7465 7370 6163 6529 2064 6973 706c 6179  tespace) display
+00046110: 6564 2061 726f 756e 6420 7468 6520 6578  ed around the ex
+00046120: 7465 6e74 206f 6620 7468 6520 524f 4973  tent of the ROIs
+00046130: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+00046140: 2020 2020 2020 2066 726f 6d20 736b 7274         from skrt
+00046150: 2e62 6574 7465 725f 7669 6577 6572 2069  .better_viewer i
+00046160: 6d70 6f72 7420 4265 7474 6572 5669 6577  mport BetterView
+00046170: 6572 0a20 2020 2020 2020 2073 656c 662e  er.        self.
+00046180: 6c6f 6164 2829 0a0a 2020 2020 2020 2020  load()..        
+00046190: 2320 5365 7420 696e 6974 6961 6c20 7a6f  # Set initial zo
+000461a0: 6f6d 2061 6d6f 756e 7420 616e 6420 6365  om amount and ce
+000461b0: 6e74 7265 0a20 2020 2020 2020 2073 656c  ntre.        sel
+000461c0: 662e 726f 6973 5b30 5d2e 6c6f 6164 2829  f.rois[0].load()
+000461d0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000461e0: 2e69 6d61 6765 2069 7320 6e6f 7420 4e6f  .image is not No
+000461f0: 6e65 2061 6e64 206e 6f74 2073 656c 662e  ne and not self.
+00046200: 6765 745f 726f 6973 2869 676e 6f72 655f  get_rois(ignore_
+00046210: 656d 7074 793d 5472 7565 295b 305d 2e63  empty=True)[0].c
+00046220: 6f6e 746f 7572 735f 6f6e 6c79 3a0a 2020  ontours_only:.  
+00046230: 2020 2020 2020 2020 2020 7669 6577 203d            view =
+00046240: 206b 7761 7267 732e 6765 7428 2269 6e69   kwargs.get("ini
+00046250: 745f 7669 6577 222c 2022 782d 7922 290a  t_view", "x-y").
+00046260: 2020 2020 2020 2020 2020 2020 6178 6573              axes
+00046270: 203d 2073 6b72 742e 696d 6167 652e 5f70   = skrt.image._p
+00046280: 6c6f 745f 6178 6573 5b76 6965 775d 0a20  lot_axes[view]. 
+00046290: 2020 2020 2020 2020 2020 2065 7874 656e             exten
+000462a0: 7473 203d 205b 7365 6c66 2e67 6574 5f6c  ts = [self.get_l
+000462b0: 656e 6774 6828 6178 3d61 7829 2066 6f72  ength(ax=ax) for
+000462c0: 2061 7820 696e 2061 7865 735d 0a20 2020   ax in axes].   
+000462d0: 2020 2020 2020 2020 2069 6d5f 6c69 6d73           im_lims
+000462e0: 203d 205b 7365 6c66 2e69 6d61 6765 2e67   = [self.image.g
+000462f0: 6574 5f6c 656e 6774 6828 6178 3d61 7829  et_length(ax=ax)
+00046300: 2066 6f72 2061 7820 696e 2061 7865 735d   for ax in axes]
+00046310: 0a20 2020 2020 2020 2020 2020 207a 6f6f  .            zoo
+00046320: 6d20 3d20 6d69 6e28 5b69 6d5f 6c69 6d73  m = min([im_lims
+00046330: 5b69 5d20 2f20 6578 7465 6e74 735b 695d  [i] / extents[i]
+00046340: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00046350: 3229 5d29 202a 2030 2e38 0a20 2020 2020  2)]) * 0.8.     
+00046360: 2020 2020 2020 207a 6f6f 6d5f 6365 6e74         zoom_cent
+00046370: 7265 203d 2073 656c 662e 6765 745f 6365  re = self.get_ce
+00046380: 6e74 7265 2829 0a20 2020 2020 2020 2020  ntre().         
+00046390: 2020 2069 6620 7a6f 6f6d 203e 2031 3a0a     if zoom > 1:.
+000463a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000463b0: 6b77 6172 6773 2e73 6574 6465 6661 756c  kwargs.setdefaul
+000463c0: 7428 227a 6f6f 6d22 2c20 7a6f 6f6d 290a  t("zoom", zoom).
+000463d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000463e0: 6b77 6172 6773 2e73 6574 6465 6661 756c  kwargs.setdefaul
+000463f0: 7428 227a 6f6f 6d5f 6365 6e74 7265 222c  t("zoom_centre",
+00046400: 207a 6f6f 6d5f 6365 6e74 7265 290a 0a20   zoom_centre).. 
+00046410: 2020 2020 2020 2020 2020 2023 2053 6574             # Set
+00046420: 2069 6e69 7469 616c 2073 6c69 6365 0a20   initial slice. 
+00046430: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
+00046440: 732e 7365 7464 6566 6175 6c74 280a 2020  s.setdefault(.  
+00046450: 2020 2020 2020 2020 2020 2020 2020 2269                "i
+00046460: 6e69 745f 736c 6963 6522 2c20 0a20 2020  nit_slice", .   
+00046470: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00046480: 662e 696d 6167 652e 6964 785f 746f 5f73  f.image.idx_to_s
+00046490: 6c69 6365 2873 656c 662e 6669 6e64 5f6d  lice(self.find_m
+000464a0: 6f73 745f 706f 7075 6c61 7465 645f 736c  ost_populated_sl
+000464b0: 6963 6528 7669 6577 292c 0a20 2020 2020  ice(view),.     
+000464c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000464d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000464e0: 2020 2073 6b72 742e 696d 6167 652e 5f73     skrt.image._s
+000464f0: 6c69 6365 5f61 7865 735b 7669 6577 5d29  lice_axes[view])
+00046500: 290a 0a20 2020 2020 2020 2069 6620 2270  )..        if "p
+00046510: 6c6f 745f 7479 7065 2220 696e 206b 7761  lot_type" in kwa
+00046520: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00046530: 206b 7761 7267 735b 2272 6f69 5f70 6c6f   kwargs["roi_plo
+00046540: 745f 7479 7065 225d 203d 206b 7761 7267  t_type"] = kwarg
+00046550: 732e 706f 7028 2270 6c6f 745f 7479 7065  s.pop("plot_type
+00046560: 2229 0a0a 2020 2020 2020 2020 2320 456e  ")..        # En
+00046570: 7375 7265 2074 6861 7420 7469 746c 6520  sure that title 
+00046580: 6973 2073 6574 2074 6f20 6265 2061 2073  is set to be a s
+00046590: 7472 696e 672e 0a20 2020 2020 2020 2069  tring..        i
+000465a0: 6620 6b77 6172 6773 2e67 6574 2822 7469  f kwargs.get("ti
+000465b0: 746c 6522 2c20 4e6f 6e65 2920 6973 204e  tle", None) is N
+000465c0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000465d0: 206b 7761 7267 735b 2274 6974 6c65 225d   kwargs["title"]
+000465e0: 203d 2073 656c 662e 6e61 6d65 206f 7220   = self.name or 
+000465f0: 2222 0a0a 2020 2020 2020 2020 2320 5669  ""..        # Vi
+00046600: 6577 2077 6974 6820 696d 6167 650a 2020  ew with image.  
+00046610: 2020 2020 2020 6966 2069 6e63 6c75 6465        if include
+00046620: 5f69 6d61 6765 2061 6e64 2073 656c 662e  _image and self.
+00046630: 696d 6167 6520 6973 206e 6f74 204e 6f6e  image is not Non
+00046640: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+00046650: 6620 726f 6973 2069 7320 4e6f 6e65 3a0a  f rois is None:.
+00046660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046670: 726f 6973 203d 2073 656c 660a 2020 2020  rois = self.    
+00046680: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00046690: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000466a0: 2073 6b72 742e 636f 7265 2e69 735f 6c69   skrt.core.is_li
+000466b0: 7374 2872 6f69 7329 3a0a 2020 2020 2020  st(rois):.      
+000466c0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+000466d0: 6973 203d 205b 7365 6c66 5d20 2b20 726f  is = [self] + ro
+000466e0: 6973 0a20 2020 2020 2020 2020 2020 2020  is.             
+000466f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00046700: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+00046710: 7320 3d20 5b73 656c 662c 2072 6f69 735d  s = [self, rois]
+00046720: 0a20 2020 2020 2020 2020 2020 2062 7620  .            bv 
+00046730: 3d20 4265 7474 6572 5669 6577 6572 2873  = BetterViewer(s
+00046740: 656c 662e 696d 6167 652c 2072 6f69 733d  elf.image, rois=
+00046750: 726f 6973 2c20 2a2a 6b77 6172 6773 290a  rois, **kwargs).
+00046760: 0a20 2020 2020 2020 2023 2056 6965 7720  .        # View 
+00046770: 7769 7468 6f75 7420 696d 6167 650a 2020  without image.  
+00046780: 2020 2020 2020 656c 7365 3a0a 0a20 2020        else:..   
+00046790: 2020 2020 2020 2020 2073 7472 7563 7475           structu
+000467a0: 7265 5f73 6574 5f74 6d70 203d 2073 656c  re_set_tmp = sel
+000467b0: 660a 0a20 2020 2020 2020 2020 2020 2023  f..            #
+000467c0: 204d 616b 6520 6475 6d6d 7920 696d 6167   Make dummy imag
+000467d0: 650a 2020 2020 2020 2020 2020 2020 696d  e.            im
+000467e0: 203d 2073 656c 662e 6765 745f 6475 6d6d   = self.get_dumm
+000467f0: 795f 696d 6167 6528 6275 6666 6572 3d62  y_image(buffer=b
+00046800: 7566 6665 722c 200a 2020 2020 2020 2020  uffer, .        
+00046810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046820: 2020 2020 2020 2020 2020 2020 2020 766f                vo
+00046830: 7865 6c5f 7369 7a65 3d76 6f78 656c 5f73  xel_size=voxel_s
+00046840: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
+00046850: 2073 7472 7563 7475 7265 5f73 6574 5f74   structure_set_t
+00046860: 6d70 203d 2073 656c 662e 636c 6f6e 6528  mp = self.clone(
+00046870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046880: 2063 6f70 795f 726f 6973 3d54 7275 652c   copy_rois=True,
+00046890: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+000468a0: 2020 636f 7079 5f72 6f69 5f64 6174 613d    copy_roi_data=
+000468b0: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
+000468c0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000468d0: 2073 7472 7563 7475 7265 5f73 6574 5f74   structure_set_t
+000468e0: 6d70 2e73 6574 5f69 6d61 6765 2869 6d29  mp.set_image(im)
+000468f0: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
+00046900: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00046910: 7365 6c66 2e72 6f69 735b 305d 2e63 6f6e  self.rois[0].con
+00046920: 746f 7572 735f 6f6e 6c79 206f 7220 5472  tours_only or Tr
+00046930: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
+00046940: 2020 2020 696d 203d 2073 656c 662e 6765      im = self.ge
+00046950: 745f 6475 6d6d 795f 696d 6167 6528 6275  t_dummy_image(bu
+00046960: 6666 6572 3d62 7566 6665 722c 200a 2020  ffer=buffer, .  
+00046970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046990: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
+000469a0: 7a65 3d76 6f78 656c 5f73 697a 6529 0a20  ze=voxel_size). 
+000469b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000469c0: 7472 7563 7475 7265 5f73 6574 5f74 6d70  tructure_set_tmp
+000469d0: 203d 2073 656c 662e 636c 6f6e 6528 0a20   = self.clone(. 
+000469e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000469f0: 2020 2063 6f70 795f 726f 6973 3d54 7275     copy_rois=Tru
+00046a00: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
+00046a10: 2020 2020 2020 2020 636f 7079 5f72 6f69          copy_roi
+00046a20: 5f64 6174 613d 4661 6c73 650a 2020 2020  _data=False.    
+00046a30: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00046a40: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00046a50: 7220 726f 6920 696e 2073 7472 7563 7475  r roi in structu
+00046a60: 7265 5f73 6574 5f74 6d70 2e72 6f69 733a  re_set_tmp.rois:
+00046a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046a80: 2020 2020 2069 6620 726f 692e 636f 6e74       if roi.cont
+00046a90: 6f75 7273 5f6f 6e6c 793a 0a20 2020 2020  ours_only:.     
+00046aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046ab0: 2020 2072 6f69 2e73 6574 5f69 6d61 6765     roi.set_image
+00046ac0: 2869 6d29 0a20 2020 2020 2020 2020 2020  (im).           
+00046ad0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00046ae0: 2020 2020 2020 2069 6d20 3d20 736b 7274         im = skrt
+00046af0: 2e69 6d61 6765 2e49 6d61 6765 280a 2020  .image.Image(.  
+00046b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046b10: 2020 6e70 2e6f 6e65 7328 7365 6c66 2e72    np.ones(self.r
+00046b20: 6f69 735b 305d 2e73 6861 7065 2920 2a20  ois[0].shape) * 
+00046b30: 3165 342c 0a20 2020 2020 2020 2020 2020  1e4,.           
+00046b40: 2020 2020 2020 2020 2061 6666 696e 653d           affine=
+00046b50: 7365 6c66 2e72 6f69 735b 305d 2e61 6666  self.rois[0].aff
+00046b60: 696e 652c 0a20 2020 2020 2020 2020 2020  ine,.           
+00046b70: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00046b80: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00046b90: 2020 2020 6966 2072 6f69 7320 6973 204e      if rois is N
+00046ba0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00046bb0: 2020 2020 2072 6f69 7320 3d20 7374 7275       rois = stru
+00046bc0: 6374 7572 655f 7365 745f 746d 700a 2020  cture_set_tmp.  
+00046bd0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00046be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046bf0: 6966 2073 6b72 742e 636f 7265 2e69 735f  if skrt.core.is_
+00046c00: 6c69 7374 2872 6f69 7329 3a0a 2020 2020  list(rois):.    
+00046c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046c20: 726f 6973 203d 205b 7374 7275 6374 7572  rois = [structur
+00046c30: 655f 7365 745f 746d 705d 202b 2072 6f69  e_set_tmp] + roi
+00046c40: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00046c50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00046c60: 2020 2020 2020 2020 2020 2020 726f 6973              rois
+00046c70: 203d 205b 7374 7275 6374 7572 655f 7365   = [structure_se
+00046c80: 745f 746d 702c 2072 6f69 735d 0a20 2020  t_tmp, rois].   
+00046c90: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
+00046ca0: 2273 686f 7722 5d20 3d20 4661 6c73 650a  "show"] = False.
+00046cb0: 2020 2020 2020 2020 2020 2020 6276 203d              bv =
+00046cc0: 2042 6574 7465 7256 6965 7765 7228 696d   BetterViewer(im
+00046cd0: 2c20 726f 6973 3d72 6f69 732c 202a 2a6b  , rois=rois, **k
+00046ce0: 7761 7267 7329 0a0a 2020 2020 2020 2020  wargs)..        
+00046cf0: 2020 2020 2320 4164 6a75 7374 2055 490a      # Adjust UI.
+00046d00: 2020 2020 2020 2020 2020 2020 6e6f 5f75              no_u
+00046d10: 6920 3d20 6b77 6172 6773 2e67 6574 2822  i = kwargs.get("
+00046d20: 6e6f 5f75 6922 2c20 736b 7274 2e63 6f72  no_ui", skrt.cor
+00046d30: 652e 4465 6661 756c 7473 2829 2e6e 6f5f  e.Defaults().no_
+00046d40: 7569 290a 2020 2020 2020 2020 2020 2020  ui).            
+00046d50: 6966 206e 6f74 206e 6f5f 7569 3a0a 2020  if not no_ui:.  
+00046d60: 2020 2020 2020 2020 2020 2020 2020 6276                bv
+00046d70: 2e6d 616b 655f 7569 286e 6f5f 696e 7465  .make_ui(no_inte
+00046d80: 6e73 6974 793d 5472 7565 290a 2020 2020  nsity=True).    
+00046d90: 2020 2020 2020 2020 2020 2020 6276 2e73              bv.s
+00046da0: 686f 7728 290a 0a20 2020 2020 2020 2072  how()..        r
+00046db0: 6574 7572 6e20 6276 0a0a 2020 2020 6465  eturn bv..    de
+00046dc0: 6620 6765 745f 6578 7465 6e74 2873 656c  f get_extent(sel
+00046dd0: 662c 202a 2a6b 7761 7267 7329 3a0a 2020  f, **kwargs):.  
+00046de0: 2020 2020 2020 2222 2247 6574 206d 696e        """Get min
+00046df0: 2061 6e64 206d 6178 2065 7874 656e 7420   and max extent 
+00046e00: 6f66 2061 6c6c 2052 4f49 7320 696e 2074  of all ROIs in t
+00046e10: 6865 2053 7472 7563 7475 7265 5365 742e  he StructureSet.
+00046e20: 2222 220a 0a20 2020 2020 2020 2061 6c6c  """..        all
+00046e30: 5f65 7874 656e 7473 203d 205b 5d0a 2020  _extents = [].  
+00046e40: 2020 2020 2020 666f 7220 726f 6920 696e        for roi in
+00046e50: 2073 656c 662e 6765 745f 726f 6973 2869   self.get_rois(i
+00046e60: 676e 6f72 655f 656d 7074 793d 5472 7565  gnore_empty=True
+00046e70: 293a 0a20 2020 2020 2020 2020 2020 2061  ):.            a
+00046e80: 6c6c 5f65 7874 656e 7473 2e65 7874 656e  ll_extents.exten
+00046e90: 6428 726f 692e 6765 745f 6578 7465 6e74  d(roi.get_extent
+00046ea0: 282a 2a6b 7761 7267 7329 290a 2020 2020  (**kwargs)).    
+00046eb0: 2020 2020 7265 7475 726e 206d 696e 2861      return min(a
+00046ec0: 6c6c 5f65 7874 656e 7473 292c 206d 6178  ll_extents), max
+00046ed0: 2861 6c6c 5f65 7874 656e 7473 290a 0a20  (all_extents).. 
+00046ee0: 2020 2064 6566 2067 6574 5f65 7874 656e     def get_exten
+00046ef0: 7473 2873 656c 662c 2072 6f69 5f6e 616d  ts(self, roi_nam
+00046f00: 6573 3d4e 6f6e 652c 2062 7566 6665 723d  es=None, buffer=
+00046f10: 4e6f 6e65 2c20 6275 6666 6572 5f75 6e69  None, buffer_uni
+00046f20: 7473 3d22 6d6d 222c 0a20 2020 2020 2020  ts="mm",.       
+00046f30: 2020 2020 206d 6574 686f 643d 4e6f 6e65       method=None
+00046f40: 2c20 6f72 6967 696e 3d4e 6f6e 6529 3a0a  , origin=None):.
+00046f50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00046f60: 2020 2020 4765 7420 6d69 6e69 6d75 6d20      Get minimum 
+00046f70: 616e 6420 6d61 7869 6d75 6d20 6578 7465  and maximum exte
+00046f80: 6e74 206f 6620 5374 7275 6374 7572 6553  nt of StructureS
+00046f90: 6574 2052 4f49 732c 0a20 2020 2020 2020  et ROIs,.       
+00046fa0: 2069 6e20 6d6d 2061 6c6f 6e67 2061 6c6c   in mm along all
+00046fb0: 2074 6872 6565 2061 7865 732c 2072 6574   three axes, ret
+00046fc0: 7572 6e65 6420 696e 206f 7264 6572 205b  urned in order [
+00046fd0: 782c 2079 2c20 7a5d 2e0a 2020 2020 2020  x, y, z]..      
+00046fe0: 2020 4f70 7469 6f6e 616c 6c79 2061 7070    Optionally app
+00046ff0: 6c79 2061 2062 7566 6665 7220 746f 2074  ly a buffer to t
+00047000: 6865 2065 7874 656e 7473 2073 7563 6820  he extents such 
+00047010: 7468 6174 2074 6865 7920 636f 7665 720a  that they cover.
+00047020: 2020 2020 2020 2020 6d6f 7265 2074 6861          more tha
+00047030: 6e20 7468 6520 7265 6769 6f6e 206f 6620  n the region of 
+00047040: 7468 6520 524f 4973 2e0a 0a20 2020 2020  the ROIs...     
+00047050: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+00047060: 2a2a 0a0a 2020 2020 2020 2020 726f 695f  **..        roi_
+00047070: 6e61 6d65 7320 3a20 6c69 7374 2c20 6465  names : list, de
+00047080: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00047090: 2020 2020 2020 204c 6973 7420 6f66 206e         List of n
+000470a0: 616d 6573 206f 6620 524f 4973 2074 6f20  ames of ROIs to 
+000470b0: 6265 2063 6f6e 7369 6465 7265 642e 2020  be considered.  
+000470c0: 4966 204e 6f6e 652c 2061 6c6c 206f 6620  If None, all of 
+000470d0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+000470e0: 7374 7275 6374 7572 6520 7365 7427 7320  structure set's 
+000470f0: 524f 4973 2061 7265 2063 6f6e 7369 6465  ROIs are conside
+00047100: 7265 642e 0a0a 2020 2020 2020 2020 6275  red...        bu
+00047110: 6666 6572 203a 2066 6c6f 6174 2c20 6465  ffer : float, de
+00047120: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00047130: 2020 2020 2020 204f 7074 696f 6e61 6c20         Optional 
+00047140: 6275 6666 6572 2074 6f20 6164 6420 746f  buffer to add to
+00047150: 2074 6865 2065 7874 656e 7473 2e20 556e   the extents. Un
+00047160: 6974 7320 7365 7420 6279 2060 6275 6666  its set by `buff
+00047170: 6572 5f75 6e69 7473 602e 0a0a 2020 2020  er_units`...    
+00047180: 2020 2020 6275 6666 6572 5f75 6e69 7473      buffer_units
+00047190: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
+000471a0: 226d 6d22 0a20 2020 2020 2020 2020 2020  "mm".           
+000471b0: 2055 6e69 7473 2066 6f72 2062 7566 6665   Units for buffe
+000471c0: 722c 2069 6620 7573 696e 672e 2043 616e  r, if using. Can
+000471d0: 2062 6520 226d 6d22 2c20 2276 6f78 656c   be "mm", "voxel
+000471e0: 7322 2c20 6f72 2022 6672 6163 2220 2877  s", or "frac" (w
+000471f0: 6869 6368 0a20 2020 2020 2020 2020 2020  hich.           
+00047200: 2061 7070 6c69 6573 2062 7566 6665 7220   applies buffer 
+00047210: 6173 2061 2066 7261 6374 696f 6e20 6f66  as a fraction of
+00047220: 2074 6f74 616c 206c 656e 6774 6820 696e   total length in
+00047230: 2065 6163 6820 6469 6d65 6e73 696f 6e29   each dimension)
+00047240: 2e0a 0a20 2020 2020 2020 206d 6574 686f  ...        metho
+00047250: 6420 3a20 7374 722c 2064 6566 6175 6c74  d : str, default
+00047260: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+00047270: 2020 4d65 7468 6f64 2074 6f20 7573 6520    Method to use 
+00047280: 666f 7220 6578 7465 6e74 2063 616c 6375  for extent calcu
+00047290: 6c61 7469 6f6e 2e20 4361 6e20 6265 3a20  lation. Can be: 
+000472a0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000472b0: 2020 2a20 2263 6f6e 746f 7572 223a 2067    * "contour": g
+000472c0: 6574 2065 7874 656e 7420 6672 6f6d 206d  et extent from m
+000472d0: 696e 2f6d 6178 2070 6f73 6974 696f 6e73  in/max positions
+000472e0: 206f 6620 636f 6e74 6f75 7228 7329 2e0a   of contour(s)..
+000472f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047300: 2a20 226d 6173 6b22 3a20 6765 7420 6578  * "mask": get ex
+00047310: 7465 6e74 2066 726f 6d20 6d69 6e2f 6d61  tent from min/ma
+00047320: 7820 706f 7369 7469 6f6e 7320 6f66 2076  x positions of v
+00047330: 6f78 656c 7320 696e 2074 6865 200a 2020  oxels in the .  
+00047340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047350: 6269 6e61 7279 206d 6173 6b2e 0a20 2020  binary mask..   
+00047360: 2020 2020 2020 2020 2020 2020 202a 204e               * N
+00047370: 6f6e 653a 2075 7365 2074 6865 206d 6574  one: use the met
+00047380: 686f 6420 7365 7420 696e 2073 656c 662e  hod set in self.
+00047390: 6465 6661 756c 745f 6765 6f6d 5f6d 6574  default_geom_met
+000473a0: 686f 642e 0a0a 2020 2020 2020 2020 6f72  hod...        or
+000473b0: 6967 696e 203a 2074 7570 6c65 2c20 6465  igin : tuple, de
+000473c0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+000473d0: 2020 2020 2020 2054 7570 6c65 2073 7065         Tuple spe
+000473e0: 6369 6679 696e 6720 7468 6520 2878 2c20  cifying the (x, 
+000473f0: 792c 207a 2920 636f 6f72 6469 6e61 7465  y, z) coordinate
+00047400: 7320 6f66 2074 6865 2070 6f69 6e74 0a20  s of the point. 
+00047410: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00047420: 7265 7370 6563 7420 746f 2077 6869 6368  respect to which
+00047430: 2065 7874 656e 7473 2061 7265 2074 6f20   extents are to 
+00047440: 6265 2064 6574 6572 6d69 6e65 642e 0a20  be determined.. 
+00047450: 2020 2020 2020 2020 2020 2049 6620 4e6f             If No
+00047460: 6e65 2c20 7468 656e 2028 302c 2030 2c20  ne, then (0, 0, 
+00047470: 3029 2069 7320 7573 6564 2e0a 2020 2020  0) is used..    
+00047480: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00047490: 7265 7475 726e 2073 656c 662e 636f 6d62  return self.comb
+000474a0: 696e 655f 726f 6973 2872 6f69 5f6e 616d  ine_rois(roi_nam
+000474b0: 6573 292e 6765 745f 6578 7465 6e74 7328  es).get_extents(
+000474c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000474d0: 2062 7566 6665 722c 2062 7566 6665 725f   buffer, buffer_
+000474e0: 756e 6974 732c 206d 6574 686f 642c 206f  units, method, o
+000474f0: 7269 6769 6e29 0a0a 2020 2020 6465 6620  rigin)..    def 
+00047500: 6765 745f 6372 6f70 5f6c 696d 6974 7328  get_crop_limits(
+00047510: 7365 6c66 2c20 726f 695f 6e61 6d65 733d  self, roi_names=
+00047520: 4e6f 6e65 2c20 6372 6f70 5f6d 6172 6769  None, crop_margi
+00047530: 6e73 3d4e 6f6e 652c 206d 6574 686f 643d  ns=None, method=
+00047540: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
+00047550: 2222 0a20 2020 2020 2020 2047 6574 2063  "".        Get c
+00047560: 726f 7020 6c69 6d69 7473 2063 6f72 7265  rop limits corre
+00047570: 7370 6f6e 6469 6e67 2074 6f20 5374 7275  sponding to Stru
+00047580: 6374 7572 6553 6574 2052 4f49 2065 7874  ctureSet ROI ext
+00047590: 656e 7473 2070 6c75 7320 6d61 7267 696e  ents plus margin
+000475a0: 732e 0a0a 2020 2020 2020 2020 5468 6520  s...        The 
+000475b0: 7475 706c 6573 206f 6620 6c69 6d69 7473  tuples of limits
+000475c0: 2072 6574 7572 6e65 642c 2069 6e20 7468   returned, in th
+000475d0: 6520 6f72 6465 7220 2878 2c20 792c 207a  e order (x, y, z
+000475e0: 2920 6361 6e0a 2020 2020 2020 2020 6265  ) can.        be
+000475f0: 2075 7365 642c 2066 6f72 2065 7861 6d70   used, for examp
+00047600: 6c65 2c20 6173 2069 6e70 7574 7320 746f  le, as inputs to
+00047610: 2073 6b72 742e 696d 6167 652e 496d 6167   skrt.image.Imag
+00047620: 652e 6372 6f70 2829 2e0a 0a20 2020 2020  e.crop()...     
+00047630: 2020 2054 6869 7320 6d65 7468 6f64 2069     This method i
+00047640: 7320 7369 6d69 6c61 7220 746f 2074 6865  s similar to the
+00047650: 206d 6574 686f 6420 6765 745f 6578 7465   method get_exte
+00047660: 6e74 7328 292c 2062 7574 2061 6c6c 6f77  nts(), but allow
+00047670: 730a 2020 2020 2020 2020 6469 6666 6572  s.        differ
+00047680: 656e 7420 6d61 7267 696e 7320 6f6e 2065  ent margins on e
+00047690: 6163 6820 7369 6465 206f 6620 7468 6520  ach side of the 
+000476a0: 5374 7275 6374 7572 6553 6574 2e0a 0a20  StructureSet... 
+000476b0: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
+000476c0: 6572 733a 2a2a 0a0a 2020 2020 2020 2020  ers:**..        
+000476d0: 726f 695f 6e61 6d65 7320 3a20 6c69 7374  roi_names : list
+000476e0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+000476f0: 2020 2020 2020 2020 2020 204c 6973 7420             List 
+00047700: 6f66 206e 616d 6573 206f 6620 524f 4973  of names of ROIs
+00047710: 2074 6f20 6265 2063 6f6e 7369 6465 7265   to be considere
+00047720: 642e 2020 4966 204e 6f6e 652c 2061 6c6c  d.  If None, all
+00047730: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
+00047740: 2020 2020 7374 7275 6374 7572 6520 7365      structure se
+00047750: 7427 7320 524f 4973 2061 7265 2063 6f6e  t's ROIs are con
+00047760: 7369 6465 7265 642e 0a0a 2020 2020 2020  sidered...      
+00047770: 2020 6372 6f70 5f6d 6172 6769 6e73 203a    crop_margins :
+00047780: 2066 6c6f 6174 2f74 7570 6c65 2c20 6465   float/tuple, de
+00047790: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+000477a0: 2020 2020 2020 2046 6c6f 6174 206f 7220         Float or 
+000477b0: 7468 7265 652d 656c 656d 656e 7420 7475  three-element tu
+000477c0: 706c 6520 7370 6563 6966 7969 6e67 2074  ple specifying t
+000477d0: 6865 206d 6172 6769 6e73 2c20 696e 206d  he margins, in m
+000477e0: 6d2c 0a20 2020 2020 2020 2020 2020 2074  m,.            t
+000477f0: 6f20 6265 2061 6464 6564 2074 6f20 5374  o be added to St
+00047800: 7275 6374 7572 6553 6574 2065 7874 656e  ructureSet exten
+00047810: 7473 2e20 2049 6620 6120 666c 6f61 742c  ts.  If a float,
+00047820: 206d 696e 7573 2061 6e64 2070 6c75 7320   minus and plus 
+00047830: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+00047840: 7661 6c75 6520 7370 6563 6966 6965 6420  value specified 
+00047850: 6172 6520 6164 6465 6420 746f 206c 6f77  are added to low
+00047860: 6572 2061 6e64 2075 7070 6572 2065 7874  er and upper ext
+00047870: 656e 7473 2072 6573 7065 6374 6976 656c  ents respectivel
+00047880: 790a 2020 2020 2020 2020 2020 2020 616c  y.            al
+00047890: 6f6e 6720 6561 6368 2061 7869 732e 2020  ong each axis.  
+000478a0: 4966 2061 2074 6872 6565 2d65 6c65 6d65  If a three-eleme
+000478b0: 6e74 2074 7570 6c65 2c20 656c 656d 656e  nt tuple, elemen
+000478c0: 7473 2061 7265 0a20 2020 2020 2020 2020  ts are.         
+000478d0: 2020 2074 616b 656e 2074 6f20 7370 6563     taken to spec
+000478e0: 6966 7920 6d61 7267 696e 7320 696e 2074  ify margins in t
+000478f0: 6865 206f 7264 6572 2028 782c 2079 2c20  he order (x, y, 
+00047900: 7a29 2e20 2045 6c65 6d65 6e74 730a 2020  z).  Elements.  
+00047910: 2020 2020 2020 2020 2020 6361 6e20 6265            can be
+00047920: 2065 6974 6865 7220 666c 6f61 7473 2028   either floats (
+00047930: 6d69 6e75 7320 616e 6420 706c 7573 2074  minus and plus t
+00047940: 6865 2076 616c 7565 2061 6464 6564 2072  he value added r
+00047950: 6573 7065 6374 6976 656c 790a 2020 2020  espectively.    
+00047960: 2020 2020 2020 2020 746f 206c 6f77 6572          to lower
+00047970: 2061 6e64 2075 7070 6572 2065 7874 656e   and upper exten
+00047980: 7473 2920 6f72 2074 776f 2d65 6c65 6d65  ts) or two-eleme
+00047990: 6e74 2074 7570 6c65 7320 2865 6c65 6d65  nt tuples (eleme
+000479a0: 6e74 7320 3020 616e 6420 310a 2020 2020  nts 0 and 1.    
+000479b0: 2020 2020 2020 2020 6164 6465 6420 7265          added re
+000479c0: 7370 6563 7469 7665 6c79 2074 6f20 6c6f  spectively to lo
+000479d0: 7765 7220 616e 6420 7570 7065 7220 6578  wer and upper ex
+000479e0: 7465 6e74 7329 2e0a 0a20 2020 2020 2020  tents)...       
+000479f0: 206d 6574 686f 6420 3a20 7374 722c 2064   method : str, d
+00047a00: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00047a10: 2020 2020 2020 2020 4d65 7468 6f64 2074          Method t
+00047a20: 6f20 7573 6520 666f 7220 6578 7465 6e74  o use for extent
+00047a30: 2063 616c 6375 6c61 7469 6f6e 2e20 4361   calculation. Ca
+00047a40: 6e20 6265 3a0a 0a20 2020 2020 2020 2020  n be:..         
+00047a50: 2020 2020 2020 202a 2022 636f 6e74 6f75         * "contou
+00047a60: 7222 3a20 6765 7420 6578 7465 6e74 2066  r": get extent f
+00047a70: 726f 6d20 6d69 6e2f 6d61 7820 706f 7369  rom min/max posi
+00047a80: 7469 6f6e 7320 6f66 2063 6f6e 746f 7572  tions of contour
+00047a90: 2873 292e 0a20 2020 2020 2020 2020 2020  (s)..           
+00047aa0: 2020 2020 202a 2022 6d61 736b 223a 2067       * "mask": g
+00047ab0: 6574 2065 7874 656e 7420 6672 6f6d 206d  et extent from m
+00047ac0: 696e 2f6d 6178 2070 6f73 6974 696f 6e73  in/max positions
+00047ad0: 206f 6620 766f 7865 6c73 2069 6e20 7468   of voxels in th
+00047ae0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00047af0: 2020 2020 6269 6e61 7279 206d 6173 6b2e      binary mask.
+00047b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047b10: 202a 204e 6f6e 653a 2075 7365 2074 6865   * None: use the
+00047b20: 206d 6574 686f 6420 7365 7420 696e 2073   method set in s
+00047b30: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
+00047b40: 5f6d 6574 686f 642e 0a20 2020 2020 2020  _method..       
+00047b50: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+00047b60: 7572 6e20 7365 6c66 2e63 6f6d 6269 6e65  urn self.combine
+00047b70: 5f72 6f69 7328 726f 695f 6e61 6d65 7329  _rois(roi_names)
+00047b80: 2e67 6574 5f63 726f 705f 6c69 6d69 7473  .get_crop_limits
+00047b90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00047ba0: 2020 6372 6f70 5f6d 6172 6769 6e73 2c20    crop_margins, 
+00047bb0: 6d65 7468 6f64 290a 0a20 2020 2064 6566  method)..    def
+00047bc0: 2067 6574 5f62 626f 785f 6365 6e74 7265   get_bbox_centre
+00047bd0: 5f61 6e64 5f77 6964 7468 7328 7365 6c66  _and_widths(self
+00047be0: 2c0a 2020 2020 2020 2020 2020 2020 726f  ,.            ro
+00047bf0: 695f 6e61 6d65 733d 4e6f 6e65 2c20 6275  i_names=None, bu
+00047c00: 6666 6572 3d4e 6f6e 652c 2062 7566 6665  ffer=None, buffe
+00047c10: 725f 756e 6974 733d 226d 6d22 2c20 6d65  r_units="mm", me
+00047c20: 7468 6f64 3d4e 6f6e 6529 3a0a 2020 2020  thod=None):.    
+00047c30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00047c40: 4765 7420 6365 6e74 7265 2061 6e64 2077  Get centre and w
+00047c50: 6964 7468 7320 696e 206d 6d20 616c 6f6e  idths in mm alon
+00047c60: 6720 616c 6c20 7468 7265 6520 6178 6573  g all three axes
+00047c70: 206f 6620 6120 626f 756e 6469 6e67 2062   of a bounding b
+00047c80: 6f78 0a20 2020 2020 2020 2065 6e63 6c6f  ox.        enclo
+00047c90: 7369 6e67 2053 7472 7563 7475 7265 5365  sing StructureSe
+00047ca0: 7420 524f 4973 2061 6e64 206f 7074 696f  t ROIs and optio
+00047cb0: 6e61 6c20 6275 6666 6572 2e20 2043 656e  nal buffer.  Cen
+00047cc0: 7472 650a 2020 2020 2020 2020 616e 6420  tre.        and 
+00047cd0: 7769 6474 6873 2061 7265 2072 6574 7572  widths are retur
+00047ce0: 6e65 6420 6173 2061 2074 7570 6c65 2028  ned as a tuple (
+00047cf0: 5b78 2c20 792c 207a 5d2c 205b 6478 2c20  [x, y, z], [dx, 
+00047d00: 6479 2c20 647a 5d29 2e0a 0a20 2020 2020  dy, dz])...     
+00047d10: 2020 204d 6574 686f 6420 7061 7261 6d65     Method parame
+00047d20: 7465 7273 2061 7265 2070 6173 7365 6420  ters are passed 
+00047d30: 746f 0a20 2020 2020 2020 2073 6b72 742e  to.        skrt.
+00047d40: 7374 7275 6374 7572 6573 2e53 7472 7563  structures.Struc
+00047d50: 7475 7265 5365 742e 6765 745f 6578 7465  tureSet.get_exte
+00047d60: 6e74 7328 2920 746f 206f 6274 6169 6e20  nts() to obtain 
+00047d70: 5374 7275 6374 7572 6553 6574 0a20 2020  StructureSet.   
+00047d80: 2020 2020 2065 7874 656e 7473 2e20 2046       extents.  F
+00047d90: 6f72 2070 6172 616d 6574 6572 2065 7870  or parameter exp
+00047da0: 6c61 6e61 7469 6f6e 732c 2073 6565 0a20  lanations, see. 
+00047db0: 2020 2020 2020 2073 6b72 742e 7374 7275         skrt.stru
+00047dc0: 6374 7572 6573 2e53 7472 7563 7475 7265  ctures.Structure
+00047dd0: 5365 742e 6765 745f 6578 7465 6e74 7328  Set.get_extents(
+00047de0: 2920 646f 6375 6d65 6e74 6174 696f 6e2e  ) documentation.
+00047df0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00047e00: 2020 2020 2065 7874 656e 7473 203d 2073       extents = s
+00047e10: 656c 662e 6765 745f 6578 7465 6e74 7328  elf.get_extents(
+00047e20: 726f 695f 6e61 6d65 732c 2062 7566 6665  roi_names, buffe
+00047e30: 722c 2062 7566 6665 725f 756e 6974 732c  r, buffer_units,
+00047e40: 206d 6574 686f 6429 200a 2020 2020 2020   method) .      
+00047e50: 2020 6365 6e74 7265 203d 205b 302e 3520    centre = [0.5 
+00047e60: 2a20 2865 7874 656e 745b 305d 202b 2065  * (extent[0] + e
+00047e70: 7874 656e 745b 315d 2920 666f 7220 6578  xtent[1]) for ex
+00047e80: 7465 6e74 2069 6e20 6578 7465 6e74 735d  tent in extents]
+00047e90: 0a20 2020 2020 2020 2077 6964 7468 7320  .        widths 
+00047ea0: 3d20 5b28 6578 7465 6e74 5b31 5d20 2d20  = [(extent[1] - 
+00047eb0: 6578 7465 6e74 5b30 5d29 2066 6f72 2065  extent[0]) for e
+00047ec0: 7874 656e 7420 696e 2065 7874 656e 7473  xtent in extents
+00047ed0: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
+00047ee0: 2028 6365 6e74 7265 2c20 7769 6474 6873   (centre, widths
+00047ef0: 290a 0a20 2020 2064 6566 2067 6574 5f64  )..    def get_d
+00047f00: 756d 6d79 5f69 6d61 6765 2873 656c 662c  ummy_image(self,
+00047f10: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+00047f20: 2020 2020 2222 224d 616b 6520 6120 6475      """Make a du
+00047f30: 6d6d 7920 696d 6167 6520 7468 6174 2063  mmy image that c
+00047f40: 6f76 6572 7320 7468 6520 6172 6561 2073  overs the area s
+00047f50: 7061 6e6e 6564 2062 7920 616c 6c20 524f  panned by all RO
+00047f60: 4973 2069 6e20 7468 6973 0a20 2020 2020  Is in this.     
+00047f70: 2020 2053 7472 7563 7475 7265 5365 742e     StructureSet.
+00047f80: 2052 6574 7572 6e73 2061 6e20 496d 6167   Returns an Imag
+00047f90: 6520 6f62 6a65 6374 2e0a 0a20 2020 2020  e object...     
+00047fa0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+00047fb0: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
+00047fc0: 2020 2020 766f 7865 6c5f 7369 7a65 203a      voxel_size :
+00047fd0: 206c 6973 742c 2064 6566 6175 6c74 3d4e   list, default=N
+00047fe0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00047ff0: 566f 7865 6c20 7369 7a65 2069 6e20 6d6d  Voxel size in mm
+00048000: 2069 6e20 7468 6520 6475 6d6d 7920 696d   in the dummy im
+00048010: 6167 6520 696e 2074 6865 2078 2d79 2070  age in the x-y p
+00048020: 6c61 6e65 2c20 6769 7665 6e20 6173 200a  lane, given as .
+00048030: 2020 2020 2020 2020 2020 2020 5b76 782c              [vx,
+00048040: 2076 795d 2e20 4966 203c 7368 6170 653e   vy]. If <shape>
+00048050: 2061 6e64 203c 766f 7865 6c5f 7369 7a65   and <voxel_size
+00048060: 3e20 6172 6520 626f 7468 204e 6f6e 652c  > are both None,
+00048070: 2076 6f78 656c 2073 697a 6573 206f 660a   voxel sizes of.
+00048080: 2020 2020 2020 2020 2020 2020 5b31 2c20              [1, 
+00048090: 315d 2077 696c 6c20 6265 2075 7365 6420  1] will be used 
+000480a0: 6279 2064 6566 6175 6c74 2e20 5468 6520  by default. The 
+000480b0: 766f 7865 6c20 7369 7a65 2069 6e20 7468  voxel size in th
+000480c0: 6520 7a20 6469 7265 6374 696f 6e20 0a20  e z direction . 
+000480d0: 2020 2020 2020 2020 2020 2069 7320 6465             is de
+000480e0: 6669 6e65 6420 6279 203c 736c 6963 655f  fined by <slice_
+000480f0: 7468 6963 6b6e 6573 733e 2e0a 0a20 2020  thickness>...   
+00048100: 2020 2020 2073 6861 7065 203a 206c 6973       shape : lis
+00048110: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+00048120: 2020 2020 2020 2020 2020 2020 4e75 6d62              Numb
+00048130: 6572 206f 6620 766f 7865 6c73 2069 6e20  er of voxels in 
+00048140: 7468 6520 6475 6d6d 7920 696d 6167 6520  the dummy image 
+00048150: 696e 2074 6865 2078 2d79 2070 6c61 6e65  in the x-y plane
+00048160: 2c20 6769 7665 6e20 6173 0a20 2020 2020  , given as.     
+00048170: 2020 2020 2020 205b 6e78 2c20 6e79 5d2e         [nx, ny].
+00048180: 204f 6e6c 7920 7573 6564 2069 6620 3c76   Only used if <v
+00048190: 6f78 656c 5f73 697a 653e 2069 7320 4e6f  oxel_size> is No
+000481a0: 6e65 2e20 0a20 2020 2020 2020 2020 2020  ne. .           
+000481b0: 2054 6865 206e 756d 6265 7220 6f66 2076   The number of v
+000481c0: 6f78 656c 7320 696e 2074 6865 207a 2064  oxels in the z d
+000481d0: 6972 6563 7469 6f6e 2077 696c 6c20 6265  irection will be
+000481e0: 2074 616b 656e 2066 726f 6d20 7468 6520   taken from the 
+000481f0: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
+00048200: 6265 7220 6f66 2073 6c69 6365 7320 696e  ber of slices in
+00048210: 2074 6865 2078 2d79 2063 6f6e 746f 7572   the x-y contour
+00048220: 7320 6469 6374 696f 6e61 7279 2e0a 0a20  s dictionary... 
+00048230: 2020 2020 2020 2066 696c 6c5f 7661 6c20         fill_val 
+00048240: 3a20 696e 742f 666c 6f61 742c 2064 6566  : int/float, def
+00048250: 6175 6c74 3d31 6534 0a20 2020 2020 2020  ault=1e4.       
+00048260: 2020 2020 2056 616c 7565 2077 6974 6820       Value with 
+00048270: 7768 6963 6820 7468 6520 766f 7865 6c73  which the voxels
+00048280: 2069 6e20 7468 6520 6475 6d6d 7920 696d   in the dummy im
+00048290: 6167 6520 7368 6f75 6c64 2062 6520 6669  age should be fi
+000482a0: 6c6c 6564 2e20 0a0a 2020 2020 2020 2020  lled. ..        
+000482b0: 6275 6666 6572 203a 2069 6e74 2c20 6465  buffer : int, de
+000482c0: 6661 756c 743d 310a 2020 2020 2020 2020  fault=1.        
+000482d0: 2020 2020 4e75 6d62 6572 206f 6620 656d      Number of em
+000482e0: 7074 7920 6275 6666 6572 2076 6f78 656c  pty buffer voxel
+000482f0: 7320 746f 2061 6464 206f 7574 7369 6465  s to add outside
+00048300: 2074 6865 2052 4f49 2069 6e20 6561 6368   the ROI in each
+00048310: 0a20 2020 2020 2020 2020 2020 2064 6972  .            dir
+00048320: 6563 7469 6f6e 2e0a 0a20 2020 2020 2020  ection...       
+00048330: 2073 6c69 6365 5f74 6869 636b 6e65 7373   slice_thickness
+00048340: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
+00048350: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00048360: 2020 2056 6f78 656c 2073 697a 6520 696e     Voxel size in
+00048370: 206d 6d20 696e 2074 6865 2064 756d 6d79   mm in the dummy
+00048380: 2069 6d61 6765 2069 6e20 7468 6520 7a20   image in the z 
+00048390: 6469 7265 6374 696f 6e2e 2020 4966 204e  direction.  If N
+000483a0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+000483b0: 2074 6865 2076 616c 7565 2075 7365 6420   the value used 
+000483c0: 6973 2074 6865 206d 696e 696d 756d 2064  is the minimum d
+000483d0: 6973 7461 6e63 6520 6265 7477 6565 6e20  istance between 
+000483e0: 736c 6963 6520 706f 7369 7469 6f6e 730a  slice positions.
+000483f0: 2020 2020 2020 2020 2020 2020 696e 2074              in t
+00048400: 6865 2078 2d79 2063 6f6e 746f 7572 7320  he x-y contours 
+00048410: 6469 6374 696f 6e61 7279 2e0a 2020 2020  dictionary..    
+00048420: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00048430: 6578 7465 6e74 7320 3d20 5b73 656c 662e  extents = [self.
+00048440: 6765 745f 6578 7465 6e74 2861 783d 6178  get_extent(ax=ax
+00048450: 2920 666f 7220 6178 2069 6e20 736b 7274  ) for ax in skrt
+00048460: 2e69 6d61 6765 2e5f 6178 6573 5d0a 2020  .image._axes].  
+00048470: 2020 2020 2020 736c 6963 655f 7468 6963        slice_thic
+00048480: 6b6e 6573 7320 3d20 6b77 6172 6773 2e70  kness = kwargs.p
+00048490: 6f70 2822 736c 6963 655f 7468 6963 6b6e  op("slice_thickn
+000484a0: 6573 7322 2c20 4e6f 6e65 290a 2020 2020  ess", None).    
+000484b0: 2020 2020 736c 6963 655f 7468 6963 6b6e      slice_thickn
+000484c0: 6573 7320 3d20 2873 6c69 6365 5f74 6869  ess = (slice_thi
+000484d0: 636b 6e65 7373 206f 720a 2020 2020 2020  ckness or.      
+000484e0: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
+000484f0: 6574 5f72 6f69 7328 6967 6e6f 7265 5f65  et_rois(ignore_e
+00048500: 6d70 7479 3d54 7275 6529 5b30 5d5c 0a20  mpty=True)[0]\. 
+00048510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048520: 2020 2020 2020 202e 6765 745f 736c 6963         .get_slic
+00048530: 655f 7468 6963 6b6e 6573 735f 636f 6e74  e_thickness_cont
+00048540: 6f75 7273 2829 290a 2020 2020 2020 2020  ours()).        
+00048550: 7265 7475 726e 2063 7265 6174 655f 6475  return create_du
+00048560: 6d6d 795f 696d 6167 6528 6578 7465 6e74  mmy_image(extent
+00048570: 732c 2073 6c69 6365 5f74 6869 636b 6e65  s, slice_thickne
+00048580: 7373 2c20 2a2a 6b77 6172 6773 290a 0a20  ss, **kwargs).. 
+00048590: 2020 2064 6566 205f 6765 745f 636f 6d62     def _get_comb
+000485a0: 696e 6174 696f 6e28 7365 6c66 2c20 6e61  ination(self, na
+000485b0: 6d65 2c20 666f 7263 652c 2065 7863 6c75  me, force, exclu
+000485c0: 6465 2c20 636f 6d62 6f5f 6d61 6b65 722c  de, combo_maker,
+000485d0: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+000485e0: 2020 2020 2222 2245 6974 6865 7220 6765      """Either ge
+000485f0: 7420 616e 2061 6c72 6561 6479 2063 616c  t an already cal
+00048600: 6375 6c61 7465 6420 636f 6d62 696e 6174  culated combinat
+00048610: 696f 6e20 6672 6f6d 2074 6865 2063 6163  ion from the cac
+00048620: 6865 0a20 2020 2020 2020 206f 7220 6372  he.        or cr
+00048630: 6561 7465 2069 742c 2063 6163 6865 2069  eate it, cache i
+00048640: 742c 2061 6e64 2072 6574 7572 6e20 6974  t, and return it
+00048650: 2e22 2222 0a0a 2020 2020 2020 2020 2320  ."""..        # 
+00048660: 5265 7475 726e 2063 6163 6865 6420 7265  Return cached re
+00048670: 7375 6c74 2069 6620 6974 2065 7869 7374  sult if it exist
+00048680: 7320 616e 6420 6e6f 7420 666f 7263 696e  s and not forcin
+00048690: 670a 2020 2020 2020 2020 6174 7472 203d  g.        attr =
+000486a0: 2066 225f 7b6e 616d 657d 220a 2020 2020   f"_{name}".    
+000486b0: 2020 2020 6966 2065 7863 6c75 6465 3a0a      if exclude:.
+000486c0: 2020 2020 2020 2020 2020 2020 6174 7472              attr
+000486d0: 202b 3d20 6622 5f65 7863 6c75 6465 6422   += f"_excluded"
+000486e0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000486f0: 666f 7263 653a 0a20 2020 2020 2020 2020  force:.         
+00048700: 2020 2069 6620 6578 636c 7564 6520 6973     if exclude is
+00048710: 204e 6f6e 6520 616e 6420 6861 7361 7474   None and hasatt
+00048720: 7228 7365 6c66 2c20 6174 7472 293a 0a20  r(self, attr):. 
+00048730: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00048740: 6574 7572 6e20 6765 7461 7474 7228 7365  eturn getattr(se
+00048750: 6c66 2c20 6174 7472 290a 2020 2020 2020  lf, attr).      
+00048760: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00048770: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+00048780: 6173 6174 7472 2873 656c 662c 2061 7474  asattr(self, att
+00048790: 7229 2061 6e64 2065 7863 6c75 6465 2069  r) and exclude i
+000487a0: 6e20 6765 7461 7474 7228 7365 6c66 2c20  n getattr(self, 
+000487b0: 6174 7472 293a 0a20 2020 2020 2020 2020  attr):.         
+000487c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000487d0: 6e20 6765 7461 7474 7228 7365 6c66 2c20  n getattr(self, 
+000487e0: 6174 7472 295b 6578 636c 7564 655d 0a0a  attr)[exclude]..
+000487f0: 2020 2020 2020 2020 2320 4765 7420 6c69          # Get li
+00048800: 7374 206f 6620 524f 4973 2074 6f20 696e  st of ROIs to in
+00048810: 636c 7564 6520 696e 2074 6869 7320 636f  clude in this co
+00048820: 6d62 696e 6174 696f 6e20 524f 490a 2020  mbination ROI.  
+00048830: 2020 2020 2020 6966 2065 7863 6c75 6465        if exclude
+00048840: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 0a20   is not None:.. 
+00048850: 2020 2020 2020 2020 2020 2069 6620 6578             if ex
+00048860: 636c 7564 6520 6e6f 7420 696e 2073 656c  clude not in sel
+00048870: 662e 6765 745f 726f 695f 6e61 6d65 7328  f.get_roi_names(
+00048880: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00048890: 2020 2070 7269 6e74 2866 2252 4f49 2074     print(f"ROI t
+000488a0: 6f20 6578 636c 7564 6520 7b65 7863 6c75  o exclude {exclu
+000488b0: 6465 7d20 6e6f 7420 666f 756e 642e 2229  de} not found.")
+000488c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000488d0: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
+000488e0: 2020 2020 2072 6f69 735f 746f 5f69 6e63       rois_to_inc
+000488f0: 6c75 6465 203d 205b 726f 6920 666f 7220  lude = [roi for 
+00048900: 726f 6920 696e 2073 656c 662e 726f 6973  roi in self.rois
+00048910: 2069 6620 726f 692e 6e61 6d65 2021 3d20   if roi.name != 
+00048920: 6578 636c 7564 655d 0a0a 2020 2020 2020  exclude]..      
+00048930: 2020 2020 2020 6966 206e 6f74 2068 6173        if not has
+00048940: 6174 7472 2873 656c 662c 2061 7474 7229  attr(self, attr)
+00048950: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00048960: 2020 7365 7461 7474 7228 7365 6c66 2c20    setattr(self, 
+00048970: 6174 7472 2c20 7b7d 290a 2020 2020 2020  attr, {}).      
+00048980: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00048990: 2020 2020 726f 6973 5f74 6f5f 696e 636c      rois_to_incl
+000489a0: 7564 6520 3d20 7365 6c66 2e72 6f69 730a  ude = self.rois.
+000489b0: 0a20 2020 2020 2020 2023 204d 616b 6520  .        # Make 
+000489c0: 6b77 6172 6773 2066 6f72 2052 4f49 2063  kwargs for ROI c
+000489d0: 7265 6174 696f 6e0a 2020 2020 2020 2020  reation.        
+000489e0: 726f 695f 6b77 6172 6773 203d 2073 656c  roi_kwargs = sel
+000489f0: 662e 726f 695f 6b77 6172 6773 2e63 6f70  f.roi_kwargs.cop
+00048a00: 7928 290a 2020 2020 2020 2020 726f 695f  y().        roi_
+00048a10: 6b77 6172 6773 2e75 7064 6174 6528 6b77  kwargs.update(kw
+00048a20: 6172 6773 290a 2020 2020 2020 2020 726f  args).        ro
+00048a30: 695f 6b77 6172 6773 5b22 6e61 6d65 225d  i_kwargs["name"]
+00048a40: 203d 206e 616d 650a 2020 2020 2020 2020   = name.        
+00048a50: 726f 695f 6b77 6172 6773 5b22 696d 6167  roi_kwargs["imag
+00048a60: 6522 5d20 3d20 7365 6c66 2e69 6d61 6765  e"] = self.image
+00048a70: 0a20 2020 2020 2020 2072 6f69 5f6b 7761  .        roi_kwa
+00048a80: 7267 735b 2261 6666 696e 6522 5d20 3d20  rgs["affine"] = 
+00048a90: 726f 6973 5f74 6f5f 696e 636c 7564 655b  rois_to_include[
+00048aa0: 305d 2e67 6574 5f61 6666 696e 6528 7374  0].get_affine(st
+00048ab0: 616e 6461 7264 6973 653d 5472 7565 290a  andardise=True).
+00048ac0: 0a20 2020 2020 2020 2023 2043 7265 6174  .        # Creat
+00048ad0: 6520 7468 6520 524f 490a 2020 2020 2020  e the ROI.      
+00048ae0: 2020 726f 6920 3d20 636f 6d62 6f5f 6d61    roi = combo_ma
+00048af0: 6b65 7228 726f 6973 5f74 6f5f 696e 636c  ker(rois_to_incl
+00048b00: 7564 652c 202a 2a72 6f69 5f6b 7761 7267  ude, **roi_kwarg
+00048b10: 7329 0a0a 2020 2020 2020 2020 2320 4164  s)..        # Ad
+00048b20: 6420 6974 2074 6f20 7468 6520 6361 6368  d it to the cach
+00048b30: 6520 616e 6420 7265 7475 726e 0a20 2020  e and return.   
+00048b40: 2020 2020 2069 6620 6578 636c 7564 6520       if exclude 
+00048b50: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00048b60: 2020 2020 2073 6574 6174 7472 2873 656c       setattr(sel
+00048b70: 662c 2061 7474 722c 2072 6f69 290a 2020  f, attr, roi).  
+00048b80: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00048b90: 2020 2020 2020 2020 6765 7461 7474 7228          getattr(
+00048ba0: 7365 6c66 2c20 6174 7472 295b 6578 636c  self, attr)[excl
+00048bb0: 7564 655d 203d 2072 6f69 0a20 2020 2020  ude] = roi.     
+00048bc0: 2020 2072 6574 7572 6e20 726f 690a 0a20     return roi.. 
+00048bd0: 2020 2064 6566 2067 6574 5f63 6f6e 7365     def get_conse
+00048be0: 6e73 7573 2873 656c 662c 2063 6f6e 7365  nsus(self, conse
+00048bf0: 6e73 7573 5f74 7970 652c 2063 6f6c 6f72  nsus_type, color
+00048c00: 3d22 626c 7565 222c 202a 2a6b 7761 7267  ="blue", **kwarg
+00048c10: 7329 3a0a 0a20 2020 2020 2020 2023 2047  s):..        # G
+00048c20: 6574 2063 6f6e 7365 6e73 7573 2063 616c  et consensus cal
+00048c30: 6375 6c61 7469 6f6e 2066 756e 6374 696f  culation functio
+00048c40: 6e0a 2020 2020 2020 2020 6966 2063 6f6e  n.        if con
+00048c50: 7365 6e73 7573 5f74 7970 6520 3d3d 2022  sensus_type == "
+00048c60: 6d61 6a6f 7269 7479 223a 0a20 2020 2020  majority":.     
+00048c70: 2020 2020 2020 2063 6f6e 7365 6e73 7573         consensus
+00048c80: 5f66 756e 6320 3d20 5374 7275 6374 7572  _func = Structur
+00048c90: 6553 6574 2e67 6574 5f6d 616a 6f72 6974  eSet.get_majorit
+00048ca0: 795f 766f 7465 0a20 2020 2020 2020 2065  y_vote.        e
+00048cb0: 6c69 6620 636f 6e73 656e 7375 735f 7479  lif consensus_ty
+00048cc0: 7065 203d 3d20 2273 756d 223a 0a20 2020  pe == "sum":.   
+00048cd0: 2020 2020 2020 2020 2063 6f6e 7365 6e73           consens
+00048ce0: 7573 5f66 756e 6320 3d20 5374 7275 6374  us_func = Struct
+00048cf0: 7572 6553 6574 2e67 6574 5f73 756d 0a20  ureSet.get_sum. 
+00048d00: 2020 2020 2020 2065 6c69 6620 636f 6e73         elif cons
+00048d10: 656e 7375 735f 7479 7065 203d 3d20 226f  ensus_type == "o
+00048d20: 7665 726c 6170 223a 0a20 2020 2020 2020  verlap":.       
+00048d30: 2020 2020 2063 6f6e 7365 6e73 7573 5f66       consensus_f
+00048d40: 756e 6320 3d20 5374 7275 6374 7572 6553  unc = StructureS
+00048d50: 6574 2e67 6574 5f6f 7665 726c 6170 0a20  et.get_overlap. 
+00048d60: 2020 2020 2020 2065 6c69 6620 636f 6e73         elif cons
+00048d70: 656e 7375 735f 7479 7065 203d 3d20 2273  ensus_type == "s
+00048d80: 7461 706c 6522 3a0a 2020 2020 2020 2020  taple":.        
+00048d90: 2020 2020 636f 6e73 656e 7375 735f 6675      consensus_fu
+00048da0: 6e63 203d 2053 7472 7563 7475 7265 5365  nc = StructureSe
+00048db0: 742e 6765 745f 7374 6170 6c65 0a20 2020  t.get_staple.   
+00048dc0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00048dd0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00048de0: 7565 4572 726f 7228 6622 556e 7265 636f  ueError(f"Unreco
+00048df0: 676e 6973 6564 2063 6f6e 7365 6e73 7573  gnised consensus
+00048e00: 2074 7970 653a 207b 636f 6e73 656e 7375   type: {consensu
+00048e10: 735f 7479 7065 7d22 290a 0a20 2020 2020  s_type}")..     
+00048e20: 2020 2072 6574 7572 6e20 636f 6e73 656e     return consen
+00048e30: 7375 735f 6675 6e63 2873 656c 662c 2063  sus_func(self, c
+00048e40: 6f6c 6f72 3d63 6f6c 6f72 2c20 2a2a 6b77  olor=color, **kw
+00048e50: 6172 6773 290a 0a20 2020 2064 6566 2067  args)..    def g
+00048e60: 6574 5f73 7461 706c 6528 7365 6c66 2c20  et_staple(self, 
+00048e70: 666f 7263 653d 4661 6c73 652c 2065 7863  force=False, exc
+00048e80: 6c75 6465 3d4e 6f6e 652c 202a 2a6b 7761  lude=None, **kwa
+00048e90: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
+00048ea0: 2247 6574 2052 4f49 206f 626a 6563 7420  "Get ROI object 
+00048eb0: 7265 7072 6573 656e 7469 6e67 2074 6865  representing the
+00048ec0: 2053 5441 504c 4520 636f 6d62 696e 6174   STAPLE combinat
+00048ed0: 696f 6e20 6f66 2052 4f49 7320 696e 2074  ion of ROIs in t
+00048ee0: 6869 7320 0a20 2020 2020 2020 2073 7472  his .        str
+00048ef0: 7563 7475 7265 2073 6574 2e20 4966 203c  ucture set. If <
+00048f00: 6578 636c 7564 653e 2069 7320 7365 7420  exclude> is set 
+00048f10: 746f 2061 2073 7472 696e 672c 2074 6865  to a string, the
+00048f20: 2052 4f49 2077 6974 6820 7468 6174 206e   ROI with that n
+00048f30: 616d 6520 0a20 2020 2020 2020 2077 696c  ame .        wil
+00048f40: 6c20 6265 2065 7863 6c75 6465 6420 6672  l be excluded fr
+00048f50: 6f6d 2074 6865 2063 616c 6375 6c61 7469  om the calculati
+00048f60: 6f6e 2e0a 0a20 2020 2020 2020 202a 2a50  on...        **P
+00048f70: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
+00048f80: 2020 2020 2020 666f 7263 6520 3a20 626f        force : bo
+00048f90: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
+00048fa0: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+00048fb0: 2046 616c 7365 2061 6e64 2053 5441 504c   False and STAPL
+00048fc0: 4520 524f 4920 6861 7320 616c 7265 6164  E ROI has alread
+00048fd0: 7920 6265 656e 2063 7265 6174 6564 2c20  y been created, 
+00048fe0: 7468 6520 0a20 2020 2020 2020 2020 2020  the .           
+00048ff0: 2070 7265 7669 6f75 736c 7920 636f 6d70   previously comp
+00049000: 7574 6564 2052 4f49 2077 696c 6c20 6265  uted ROI will be
+00049010: 2072 6574 7572 6e65 642e 2049 6620 466f   returned. If Fo
+00049020: 7263 653d 5472 7565 2c20 7468 6520 0a20  rce=True, the . 
+00049030: 2020 2020 2020 2020 2020 2053 5441 504c             STAPL
+00049040: 4520 524f 4920 7769 6c6c 2062 6520 7265  E ROI will be re
+00049050: 6372 6561 7465 642e 0a0a 2020 2020 2020  created...      
+00049060: 2020 6578 636c 7564 6520 3a20 7374 722c    exclude : str,
+00049070: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00049080: 2020 2020 2020 2020 2020 4966 2073 6574            If set
+00049090: 2074 6f20 6120 7374 7269 6e67 2c20 7468   to a string, th
+000490a0: 6520 6669 7273 7420 524f 4920 696e 2073  e first ROI in s
+000490b0: 656c 662e 726f 6973 2077 6974 6820 7468  elf.rois with th
+000490c0: 6174 206e 616d 6520 7769 6c6c 200a 2020  at name will .  
+000490d0: 2020 2020 2020 2020 2020 6265 2065 7863            be exc
+000490e0: 6c75 6465 6420 6672 6f6d 2074 6865 2063  luded from the c
+000490f0: 6f6d 6269 6e61 7469 6f6e 2e20 5468 6973  ombination. This
+00049100: 206d 6179 2062 6520 7573 6566 756c 2069   may be useful i
+00049110: 6620 636f 6d70 6172 6973 6f6e 200a 2020  f comparison .  
+00049120: 2020 2020 2020 2020 2020 6f66 2061 2073            of a s
+00049130: 696e 676c 6520 524f 4920 7769 7468 2074  ingle ROI with t
+00049140: 6865 2063 6f6e 7365 6e73 7573 206f 6620  he consensus of 
+00049150: 616c 6c20 6f74 6865 7273 2069 7320 6465  all others is de
+00049160: 7369 7265 642e 0a0a 2020 2020 2020 2020  sired...        
+00049170: 602a 2a60 6b77 6172 6773 203a 0a20 2020  `**`kwargs :.   
+00049180: 2020 2020 2020 2020 2045 7874 7261 206b           Extra k
+00049190: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+000491a0: 2074 6f20 7061 7373 2074 6f20 7468 6520   to pass to the 
+000491b0: 6372 6561 7469 6f6e 206f 6620 7468 6520  creation of the 
+000491c0: 524f 4920 6f62 6a65 6374 0a20 2020 2020  ROI object.     
+000491d0: 2020 2020 2020 2072 6570 7265 7365 6e74         represent
+000491e0: 696e 6720 7468 6520 636f 6d62 696e 6174  ing the combinat
+000491f0: 696f 6e2e 0a20 2020 2020 2020 2022 2222  ion..        """
+00049200: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00049210: 2073 656c 662e 5f67 6574 5f63 6f6d 6269   self._get_combi
+00049220: 6e61 7469 6f6e 2822 7374 6170 6c65 222c  nation("staple",
+00049230: 2066 6f72 6365 2c20 6578 636c 7564 652c   force, exclude,
+00049240: 2063 7265 6174 655f 7374 6170 6c65 2c0a   create_staple,.
+00049250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049270: 2020 2020 202a 2a6b 7761 7267 7329 0a0a       **kwargs)..
+00049280: 2020 2020 6465 6620 6765 745f 6d61 6a6f      def get_majo
+00049290: 7269 7479 5f76 6f74 6528 7365 6c66 2c20  rity_vote(self, 
+000492a0: 666f 7263 653d 4661 6c73 652c 2065 7863  force=False, exc
+000492b0: 6c75 6465 3d4e 6f6e 652c 202a 2a6b 7761  lude=None, **kwa
+000492c0: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
+000492d0: 2247 6574 2052 4f49 206f 626a 6563 7420  "Get ROI object 
+000492e0: 7265 7072 6573 656e 7469 6e67 2074 6865  representing the
+000492f0: 206d 616a 6f72 6974 7920 766f 7465 2063   majority vote c
+00049300: 6f6d 6269 6e61 7469 6f6e 206f 6620 524f  ombination of RO
+00049310: 4973 2069 6e20 0a20 2020 2020 2020 2074  Is in .        t
+00049320: 6869 7320 7374 7275 6374 7572 6520 7365  his structure se
+00049330: 742e 2049 6620 3c65 7863 6c75 6465 3e20  t. If <exclude> 
+00049340: 6973 2073 6574 2074 6f20 6120 7374 7269  is set to a stri
+00049350: 6e67 2c20 7468 6520 524f 4920 7769 7468  ng, the ROI with
+00049360: 2074 6861 7420 0a20 2020 2020 2020 206e   that .        n
+00049370: 616d 6520 7769 6c6c 2062 6520 6578 636c  ame will be excl
+00049380: 7564 6564 2066 726f 6d20 7468 6520 6361  uded from the ca
+00049390: 6c63 756c 6174 696f 6e2e 0a0a 2020 2020  lculation...    
+000493a0: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+000493b0: 3a2a 2a0a 0a20 2020 2020 2020 2066 6f72  :**..        for
+000493c0: 6365 203a 2062 6f6f 6c2c 2064 6566 6175  ce : bool, defau
+000493d0: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
+000493e0: 2020 2020 2049 6620 4661 6c73 6520 616e       If False an
+000493f0: 6420 6d61 6a6f 7269 7479 2076 6f74 6520  d majority vote 
+00049400: 524f 4920 6861 7320 616c 7265 6164 7920  ROI has already 
+00049410: 6265 656e 2063 7265 6174 6564 2c20 7468  been created, th
+00049420: 6520 0a20 2020 2020 2020 2020 2020 2070  e .            p
+00049430: 7265 7669 6f75 736c 7920 636f 6d70 7574  reviously comput
+00049440: 6564 2052 4f49 2077 696c 6c20 6265 2072  ed ROI will be r
+00049450: 6574 7572 6e65 642e 2049 6620 466f 7263  eturned. If Forc
+00049460: 653d 5472 7565 2c20 7468 6520 0a20 2020  e=True, the .   
+00049470: 2020 2020 2020 2020 206d 616a 6f72 6974           majorit
+00049480: 7920 766f 7465 2052 4f49 2077 696c 6c20  y vote ROI will 
+00049490: 6265 2072 6563 7265 6174 6564 2e0a 0a20  be recreated... 
+000494a0: 2020 2020 2020 2065 7863 6c75 6465 203a         exclude :
+000494b0: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
+000494c0: 6e65 0a20 2020 2020 2020 2020 2020 2049  ne.            I
+000494d0: 6620 7365 7420 746f 2061 2073 7472 696e  f set to a strin
+000494e0: 672c 2074 6865 2066 6972 7374 2052 4f49  g, the first ROI
+000494f0: 2069 6e20 7365 6c66 2e72 6f69 7320 7769   in self.rois wi
+00049500: 7468 2074 6861 7420 6e61 6d65 2077 696c  th that name wil
+00049510: 6c20 0a20 2020 2020 2020 2020 2020 2062  l .            b
+00049520: 6520 6578 636c 7564 6564 2066 726f 6d20  e excluded from 
+00049530: 7468 6520 636f 6d62 696e 6174 696f 6e2e  the combination.
+00049540: 2054 6869 7320 6d61 7920 6265 2075 7365   This may be use
+00049550: 6675 6c20 6966 2063 6f6d 7061 7269 736f  ful if compariso
+00049560: 6e20 0a20 2020 2020 2020 2020 2020 206f  n .            o
+00049570: 6620 6120 7369 6e67 6c65 2052 4f49 2077  f a single ROI w
+00049580: 6974 6820 7468 6520 636f 6e73 656e 7375  ith the consensu
+00049590: 7320 6f66 2061 6c6c 206f 7468 6572 7320  s of all others 
+000495a0: 6973 2064 6573 6972 6564 2e0a 0a20 2020  is desired...   
+000495b0: 2020 2020 2060 2a2a 606b 7761 7267 7320       `**`kwargs 
+000495c0: 3a0a 2020 2020 2020 2020 2020 2020 4578  :.            Ex
+000495d0: 7472 6120 6b65 7977 6f72 6420 6172 6775  tra keyword argu
+000495e0: 6d65 6e74 7320 746f 2070 6173 7320 746f  ments to pass to
+000495f0: 2074 6865 2063 7265 6174 696f 6e20 6f66   the creation of
+00049600: 2074 6865 2052 4f49 206f 626a 6563 740a   the ROI object.
+00049610: 2020 2020 2020 2020 2020 2020 7265 7072              repr
+00049620: 6573 656e 7469 6e67 2074 6865 2063 6f6d  esenting the com
+00049630: 6269 6e61 7469 6f6e 2e0a 2020 2020 2020  bination..      
+00049640: 2020 2222 220a 0a20 2020 2020 2020 2072    """..        r
+00049650: 6574 7572 6e20 7365 6c66 2e5f 6765 745f  eturn self._get_
+00049660: 636f 6d62 696e 6174 696f 6e28 226d 616a  combination("maj
+00049670: 6f72 6974 795f 766f 7465 222c 2066 6f72  ority_vote", for
+00049680: 6365 2c20 6578 636c 7564 652c 200a 2020  ce, exclude, .  
 00049690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000496a0: 2020 2020 2020 6372 6561 7465 5f72 6f69        create_roi
-000496b0: 5f73 756d 2c20 2a2a 6b77 6172 6773 290a  _sum, **kwargs).
-000496c0: 0a20 2020 2064 6566 2067 6574 5f6f 7665  .    def get_ove
-000496d0: 726c 6170 2873 656c 662c 2066 6f72 6365  rlap(self, force
-000496e0: 3d46 616c 7365 2c20 6578 636c 7564 653d  =False, exclude=
-000496f0: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
-00049700: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
-00049710: 524f 4920 6f62 6a65 6374 2072 6570 7265  ROI object repre
-00049720: 7365 6e74 696e 6720 7468 6520 6f76 6572  senting the over
-00049730: 6c61 7020 6f66 2052 4f49 7320 696e 2074  lap of ROIs in t
-00049740: 6869 7320 0a20 2020 2020 2020 2073 7472  his .        str
-00049750: 7563 7475 7265 2073 6574 2e20 4966 203c  ucture set. If <
-00049760: 6578 636c 7564 653e 2069 7320 7365 7420  exclude> is set 
-00049770: 746f 2061 2073 7472 696e 672c 2074 6865  to a string, the
-00049780: 2052 4f49 2077 6974 6820 7468 6174 206e   ROI with that n
-00049790: 616d 6520 0a20 2020 2020 2020 2077 696c  ame .        wil
-000497a0: 6c20 6265 2065 7863 6c75 6465 6420 6672  l be excluded fr
-000497b0: 6f6d 2074 6865 2063 616c 6375 6c61 7469  om the calculati
-000497c0: 6f6e 2e0a 0a20 2020 2020 2020 202a 2a50  on...        **P
-000497d0: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
-000497e0: 2020 2020 2020 666f 7263 6520 3a20 626f        force : bo
-000497f0: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
-00049800: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
-00049810: 2046 616c 7365 2061 6e64 206f 7665 726c   False and overl
-00049820: 6170 2052 4f49 2068 6173 2061 6c72 6561  ap ROI has alrea
-00049830: 6479 2062 6565 6e20 6372 6561 7465 642c  dy been created,
-00049840: 2074 6865 200a 2020 2020 2020 2020 2020   the .          
-00049850: 2020 7072 6576 696f 7573 6c79 2063 6f6d    previously com
-00049860: 7075 7465 6420 524f 4920 7769 6c6c 2062  puted ROI will b
-00049870: 6520 7265 7475 726e 6564 2e20 4966 2046  e returned. If F
-00049880: 6f72 6365 3d54 7275 652c 2074 6865 200a  orce=True, the .
-00049890: 2020 2020 2020 2020 2020 2020 6f76 6572              over
-000498a0: 6c61 7020 524f 4920 7769 6c6c 2062 6520  lap ROI will be 
-000498b0: 7265 6372 6561 7465 642e 0a0a 2020 2020  recreated...    
-000498c0: 2020 2020 6578 636c 7564 6520 3a20 7374      exclude : st
-000498d0: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
-000498e0: 2020 2020 2020 2020 2020 2020 4966 2073              If s
-000498f0: 6574 2074 6f20 6120 7374 7269 6e67 2c20  et to a string, 
-00049900: 7468 6520 6669 7273 7420 524f 4920 696e  the first ROI in
-00049910: 2073 656c 662e 726f 6973 2077 6974 6820   self.rois with 
-00049920: 7468 6174 206e 616d 6520 7769 6c6c 200a  that name will .
-00049930: 2020 2020 2020 2020 2020 2020 6265 2065              be e
-00049940: 7863 6c75 6465 6420 6672 6f6d 2074 6865  xcluded from the
-00049950: 2063 6f6d 6269 6e61 7469 6f6e 2e20 5468   combination. Th
-00049960: 6973 206d 6179 2062 6520 7573 6566 756c  is may be useful
-00049970: 2069 6620 636f 6d70 6172 6973 6f6e 200a   if comparison .
-00049980: 2020 2020 2020 2020 2020 2020 6f66 2061              of a
-00049990: 2073 696e 676c 6520 524f 4920 7769 7468   single ROI with
-000499a0: 2074 6865 2063 6f6e 7365 6e73 7573 206f   the consensus o
-000499b0: 6620 616c 6c20 6f74 6865 7273 2069 7320  f all others is 
-000499c0: 6465 7369 7265 642e 0a0a 2020 2020 2020  desired...      
-000499d0: 2020 602a 2a60 6b77 6172 6773 203a 0a20    `**`kwargs :. 
-000499e0: 2020 2020 2020 2020 2020 2045 7874 7261             Extra
-000499f0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
-00049a00: 7473 2074 6f20 7061 7373 2074 6f20 7468  ts to pass to th
-00049a10: 6520 6372 6561 7469 6f6e 206f 6620 7468  e creation of th
-00049a20: 6520 524f 4920 6f62 6a65 6374 0a20 2020  e ROI object.   
-00049a30: 2020 2020 2020 2020 2072 6570 7265 7365           represe
-00049a40: 6e74 696e 6720 7468 6520 636f 6d62 696e  nting the combin
-00049a50: 6174 696f 6e2e 0a20 2020 2020 2020 2022  ation..        "
-00049a60: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
-00049a70: 726e 2073 656c 662e 5f67 6574 5f63 6f6d  rn self._get_com
-00049a80: 6269 6e61 7469 6f6e 2822 6f76 6572 6c61  bination("overla
-00049a90: 7022 2c20 666f 7263 652c 2065 7863 6c75  p", force, exclu
-00049aa0: 6465 2c20 0a20 2020 2020 2020 2020 2020  de, .           
+000496a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000496b0: 2020 2063 7265 6174 655f 6d61 6a6f 7269     create_majori
+000496c0: 7479 5f76 6f74 652c 202a 2a6b 7761 7267  ty_vote, **kwarg
+000496d0: 7329 0a0a 2020 2020 6465 6620 6765 745f  s)..    def get_
+000496e0: 7375 6d28 7365 6c66 2c20 666f 7263 653d  sum(self, force=
+000496f0: 4661 6c73 652c 2065 7863 6c75 6465 3d4e  False, exclude=N
+00049700: 6f6e 652c 202a 2a6b 7761 7267 7329 3a0a  one, **kwargs):.
+00049710: 2020 2020 2020 2020 2222 2247 6574 2052          """Get R
+00049720: 4f49 206f 626a 6563 7420 7265 7072 6573  OI object repres
+00049730: 656e 7469 6e67 2074 6865 2073 756d 206f  enting the sum o
+00049740: 6620 524f 4973 2069 6e20 7468 6973 2073  f ROIs in this s
+00049750: 7472 7563 7475 7265 2073 6574 2e20 0a20  tructure set. . 
+00049760: 2020 2020 2020 2049 6620 3c65 7863 6c75         If <exclu
+00049770: 6465 3e20 6973 2073 6574 2074 6f20 6120  de> is set to a 
+00049780: 7374 7269 6e67 2c20 7468 6520 524f 4920  string, the ROI 
+00049790: 7769 7468 2074 6861 7420 6e61 6d65 2077  with that name w
+000497a0: 696c 6c20 6265 200a 2020 2020 2020 2020  ill be .        
+000497b0: 6578 636c 7564 6564 2066 726f 6d20 7468  excluded from th
+000497c0: 6520 6361 6c63 756c 6174 696f 6e2e 0a0a  e calculation...
+000497d0: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
+000497e0: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
+000497f0: 2066 6f72 6365 203a 2062 6f6f 6c2c 2064   force : bool, d
+00049800: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
+00049810: 2020 2020 2020 2020 2049 6620 4661 6c73           If Fals
+00049820: 6520 616e 6420 7375 6d20 524f 4920 6861  e and sum ROI ha
+00049830: 7320 616c 7265 6164 7920 6265 656e 2063  s already been c
+00049840: 7265 6174 6564 2c20 7468 6520 0a20 2020  reated, the .   
+00049850: 2020 2020 2020 2020 2070 7265 7669 6f75           previou
+00049860: 736c 7920 636f 6d70 7574 6564 2052 4f49  sly computed ROI
+00049870: 2077 696c 6c20 6265 2072 6574 7572 6e65   will be returne
+00049880: 642e 2049 6620 466f 7263 653d 5472 7565  d. If Force=True
+00049890: 2c20 7468 6520 0a20 2020 2020 2020 2020  , the .         
+000498a0: 2020 2073 756d 2052 4f49 2077 696c 6c20     sum ROI will 
+000498b0: 6265 2072 6563 7265 6174 6564 2e0a 0a20  be recreated... 
+000498c0: 2020 2020 2020 2065 7863 6c75 6465 203a         exclude :
+000498d0: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
+000498e0: 6e65 0a20 2020 2020 2020 2020 2020 2049  ne.            I
+000498f0: 6620 7365 7420 746f 2061 2073 7472 696e  f set to a strin
+00049900: 672c 2074 6865 2066 6972 7374 2052 4f49  g, the first ROI
+00049910: 2069 6e20 7365 6c66 2e72 6f69 7320 7769   in self.rois wi
+00049920: 7468 2074 6861 7420 6e61 6d65 2077 696c  th that name wil
+00049930: 6c20 0a20 2020 2020 2020 2020 2020 2062  l .            b
+00049940: 6520 6578 636c 7564 6564 2066 726f 6d20  e excluded from 
+00049950: 7468 6520 636f 6d62 696e 6174 696f 6e2e  the combination.
+00049960: 2054 6869 7320 6d61 7920 6265 2075 7365   This may be use
+00049970: 6675 6c20 6966 2063 6f6d 7061 7269 736f  ful if compariso
+00049980: 6e20 0a20 2020 2020 2020 2020 2020 206f  n .            o
+00049990: 6620 6120 7369 6e67 6c65 2052 4f49 2077  f a single ROI w
+000499a0: 6974 6820 7468 6520 636f 6e73 656e 7375  ith the consensu
+000499b0: 7320 6f66 2061 6c6c 206f 7468 6572 7320  s of all others 
+000499c0: 6973 2064 6573 6972 6564 2e0a 0a20 2020  is desired...   
+000499d0: 2020 2020 2060 2a2a 606b 7761 7267 7320       `**`kwargs 
+000499e0: 3a0a 2020 2020 2020 2020 2020 2020 4578  :.            Ex
+000499f0: 7472 6120 6b65 7977 6f72 6420 6172 6775  tra keyword argu
+00049a00: 6d65 6e74 7320 746f 2070 6173 7320 746f  ments to pass to
+00049a10: 2074 6865 2063 7265 6174 696f 6e20 6f66   the creation of
+00049a20: 2074 6865 2052 4f49 206f 626a 6563 740a   the ROI object.
+00049a30: 2020 2020 2020 2020 2020 2020 7265 7072              repr
+00049a40: 6573 656e 7469 6e67 2074 6865 2063 6f6d  esenting the com
+00049a50: 6269 6e61 7469 6f6e 2e0a 2020 2020 2020  bination..      
+00049a60: 2020 2222 220a 0a20 2020 2020 2020 2072    """..        r
+00049a70: 6574 7572 6e20 7365 6c66 2e5f 6765 745f  eturn self._get_
+00049a80: 636f 6d62 696e 6174 696f 6e28 2273 756d  combination("sum
+00049a90: 222c 2066 6f72 6365 2c20 6578 636c 7564  ", force, exclud
+00049aa0: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
 00049ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049ac0: 2020 2020 2020 2020 2020 6372 6561 7465            create
-00049ad0: 5f72 6f69 5f6f 7665 726c 6170 2c20 2a2a  _roi_overlap, **
-00049ae0: 6b77 6172 6773 290a 0a20 2020 2064 6566  kwargs)..    def
-00049af0: 2074 7261 6e73 666f 726d 2873 656c 662c   transform(self,
-00049b00: 2073 6361 6c65 3d31 2c20 7472 616e 736c   scale=1, transl
-00049b10: 6174 696f 6e3d 5b30 2c20 302c 2030 5d2c  ation=[0, 0, 0],
-00049b20: 2072 6f74 6174 696f 6e3d 5b30 2c20 302c   rotation=[0, 0,
-00049b30: 2030 5d2c 0a20 2020 2020 2020 2020 2020   0],.           
-00049b40: 2063 656e 7472 653d 5b30 2c20 302c 2030   centre=[0, 0, 0
-00049b50: 5d2c 2072 6573 616d 706c 653d 2266 696e  ], resample="fin
-00049b60: 6522 2c20 7265 7374 6f72 653d 5472 7565  e", restore=True
-00049b70: 2c20 0a20 2020 2020 2020 2020 2020 2066  , .            f
-00049b80: 696c 6c5f 7661 6c75 653d 4e6f 6e65 2c20  ill_value=None, 
-00049b90: 666f 7263 655f 636f 6e74 6f75 7273 3d46  force_contours=F
-00049ba0: 616c 7365 2c20 6e61 6d65 733d 4e6f 6e65  alse, names=None
-00049bb0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00049bc0: 2020 2020 2020 2041 7070 6c79 2074 6872         Apply thr
-00049bd0: 6565 2d64 696d 656e 7369 6f6e 616c 2073  ee-dimensional s
-00049be0: 696d 696c 6172 6974 7920 7472 616e 7366  imilarity transf
-00049bf0: 6f72 6d20 746f 2073 7472 7563 7475 7265  orm to structure
-00049c00: 2d73 6574 2052 4f49 732e 0a0a 2020 2020  -set ROIs...    
-00049c10: 2020 2020 4966 2074 6865 2074 7261 6e73      If the trans
-00049c20: 666f 726d 2063 6f72 7265 7370 6f6e 6473  form corresponds
-00049c30: 2074 6f20 6120 7472 616e 736c 6174 696f   to a translatio
-00049c40: 6e20 616e 642f 6f72 2072 6f74 6174 696f  n and/or rotatio
-00049c50: 6e0a 2020 2020 2020 2020 6162 6f75 7420  n.        about 
-00049c60: 7468 6520 7a2d 6178 6973 2c20 616e 6420  the z-axis, and 
-00049c70: 6569 7468 6572 2074 6865 2072 6f69 2073  either the roi s
-00049c80: 6f75 7263 6520 7479 7065 2069 7320 2264  ource type is "d
-00049c90: 6963 6f6d 220a 2020 2020 2020 2020 6f72  icom".        or
-00049ca0: 2066 6f72 6365 2d63 6f6e 746f 7572 7320   force-contours 
-00049cb0: 6973 2054 7275 652c 2074 6865 2074 7261  is True, the tra
-00049cc0: 6e73 666f 726d 2069 7320 6170 706c 6965  nsform is applie
-00049cd0: 6420 746f 2063 6f6e 746f 7572 0a20 2020  d to contour.   
-00049ce0: 2020 2020 2070 6f69 6e74 7320 616e 6420       points and 
-00049cf0: 7468 6520 726f 6920 6d61 736b 2069 7320  the roi mask is 
-00049d00: 7365 7420 6173 2075 6e6c 6f61 6465 642e  set as unloaded.
-00049d10: 2020 4f74 6865 7277 6973 6520 7468 6520    Otherwise the 
-00049d20: 7472 616e 7366 6f72 6d0a 2020 2020 2020  transform.      
-00049d30: 2020 6973 2061 7070 6c69 6564 2074 6f20    is applied to 
-00049d40: 7468 6520 6d61 736b 2061 6e64 2063 6f6e  the mask and con
-00049d50: 746f 7572 7320 6172 6520 7365 7420 6173  tours are set as
-00049d60: 2075 6e6c 6f61 6465 642e 0a0a 2020 2020   unloaded...    
-00049d70: 2020 2020 5468 6520 7472 616e 7366 6f72      The transfor
-00049d80: 6d20 6973 2061 7070 6c69 6564 2069 6e20  m is applied in 
-00049d90: 7468 6520 6f72 6465 723a 2074 7261 6e73  the order: trans
-00049da0: 6c61 7469 6f6e 2c20 7363 616c 696e 672c  lation, scaling,
-00049db0: 0a20 2020 2020 2020 2072 6f74 6174 696f  .        rotatio
-00049dc0: 6e2e 2020 5468 6520 6c61 7474 6572 2074  n.  The latter t
-00049dd0: 776f 2061 7265 2061 626f 7574 2074 6865  wo are about the
-00049de0: 2063 656e 7472 6520 636f 6f72 6469 6e61   centre coordina
-00049df0: 7465 732e 0a0a 2020 2020 2020 2020 2a2a  tes...        **
-00049e00: 5061 7261 6d65 7465 7273 3a2a 2a0a 2020  Parameters:**.  
-00049e10: 2020 2020 2020 0a20 2020 2020 2020 2066        .        f
-00049e20: 6f72 6365 5f63 6f6e 746f 7572 7320 3a20  orce_contours : 
-00049e30: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
-00049e40: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00049e50: 4966 2054 7275 652c 2061 6e64 2074 6865  If True, and the
-00049e60: 2074 7261 6e73 666f 726d 2063 6f72 7265   transform corre
-00049e70: 7370 6f6e 6473 2074 6f20 6120 7472 616e  sponds to a tran
-00049e80: 736c 6174 696f 6e0a 2020 2020 2020 2020  slation.        
-00049e90: 2020 2020 616e 642f 6f72 2072 6f74 6174      and/or rotat
-00049ea0: 696f 6e20 6162 6f75 7420 7468 6520 7a2d  ion about the z-
-00049eb0: 6178 6973 2c20 6170 706c 7920 7472 616e  axis, apply tran
-00049ec0: 7366 6f72 6d20 746f 2063 6f6e 746f 7572  sform to contour
-00049ed0: 0a20 2020 2020 2020 2020 2020 2070 6f69  .            poi
-00049ee0: 6e74 7320 696e 6465 7065 6e64 656e 746c  nts independentl
-00049ef0: 7920 6f66 2074 6865 206f 7269 6769 6e61  y of the origina
-00049f00: 6c20 6461 7461 2073 6f75 7263 652e 0a0a  l data source...
-00049f10: 2020 2020 2020 2020 6e61 6d65 7320 3a20          names : 
-00049f20: 6c69 7374 2f4e 6f6e 652c 2064 6566 6175  list/None, defau
-00049f30: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
-00049f40: 2020 2020 204c 6973 7420 6f66 2052 4f49       List of ROI
-00049f50: 7320 746f 2077 6869 6368 2074 7261 6e73  s to which trans
-00049f60: 666f 726d 2069 7320 746f 2062 6520 6170  form is to be ap
-00049f70: 706c 6965 642e 2020 4966 204e 6f6e 652c  plied.  If None,
-00049f80: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
-00049f90: 6e73 666f 726d 2069 7320 6170 706c 6965  nsform is applie
-00049fa0: 6420 746f 2061 6c6c 2052 4f49 732e 0a0a  d to all ROIs...
-00049fb0: 2020 2020 2020 2020 466f 7220 6f74 6865          For othe
-00049fc0: 7220 7061 7261 6d65 7465 7273 2c20 7365  r parameters, se
-00049fd0: 6520 646f 6375 6d65 6e74 6174 696f 6e20  e documentation 
-00049fe0: 666f 720a 2020 2020 2020 2020 736b 7274  for.        skrt
-00049ff0: 2e69 6d61 6765 2e49 6d61 6765 2e74 7261  .image.Image.tra
-0004a000: 6e73 666f 726d 2829 2e20 204e 6f74 6520  nsform().  Note 
-0004a010: 7468 6174 2074 6865 2060 606f 7264 6572  that the ``order
-0004a020: 6060 0a20 2020 2020 2020 2070 6172 616d  ``.        param
-0004a030: 6574 6572 2069 736e 2774 2061 7661 696c  eter isn't avail
-0004a040: 6162 6c65 2066 6f72 2073 7472 7563 7475  able for structu
-0004a050: 7265 2d73 6574 2074 7261 6e73 666f 726d  re-set transform
-0004a060: 7320 2d20 6120 7661 6c75 6520 6f66 2030  s - a value of 0
-0004a070: 0a20 2020 2020 2020 2069 7320 7573 6564  .        is used
-0004a080: 2061 6c77 6179 732e 0a20 2020 2020 2020   always..       
-0004a090: 2022 2222 0a0a 2020 2020 2020 2020 666f   """..        fo
-0004a0a0: 7220 726f 6920 696e 2073 656c 662e 6765  r roi in self.ge
-0004a0b0: 745f 726f 6973 286e 616d 6573 293a 0a20  t_rois(names):. 
-0004a0c0: 2020 2020 2020 2020 2020 2072 6f69 2e74             roi.t
-0004a0d0: 7261 6e73 666f 726d 2873 6361 6c65 2c20  ransform(scale, 
-0004a0e0: 7472 616e 736c 6174 696f 6e2c 2072 6f74  translation, rot
-0004a0f0: 6174 696f 6e2c 2063 656e 7472 652c 2072  ation, centre, r
-0004a100: 6573 616d 706c 652c 0a20 2020 2020 2020  esample,.       
-0004a110: 2020 2020 2020 2020 2020 2020 2072 6573               res
-0004a120: 746f 7265 2c20 6669 6c6c 5f76 616c 7565  tore, fill_value
-0004a130: 2c20 666f 7263 655f 636f 6e74 6f75 7273  , force_contours
-0004a140: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0004a150: 6e20 4e6f 6e65 0a0a 2020 2020 6465 6620  n None..    def 
-0004a160: 6164 645f 706c 616e 2873 656c 662c 2070  add_plan(self, p
-0004a170: 6c61 6e29 3a0a 2020 2020 2020 2020 2222  lan):.        ""
-0004a180: 2241 6464 2061 2050 6c61 6e20 6f62 6a65  "Add a Plan obje
-0004a190: 6374 2074 6f20 6265 2061 7373 6f63 6961  ct to be associa
-0004a1a0: 7465 6420 7769 7468 2074 6869 7320 7374  ted with this st
-0004a1b0: 7275 6374 7572 6520 7365 7420 616e 640a  ructure set and.
-0004a1c0: 2020 2020 2020 2020 6974 7320 524f 4973          its ROIs
-0004a1d0: 2e20 5468 6973 2064 6f65 7320 6e6f 7420  . This does not 
-0004a1e0: 6166 6665 6374 2074 6865 2073 7472 7563  affect the struc
-0004a1f0: 7475 7265 2073 6574 2061 7373 6f63 6961  ture set associa
-0004a200: 7465 6420 7769 7468 0a20 2020 2020 2020  ted with.       
-0004a210: 2074 6865 2050 6c61 6e20 6f62 6a65 6374   the Plan object
-0004a220: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
-0004a230: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
-0004a240: 2020 2020 706c 616e 203a 2073 6b72 742e      plan : skrt.
-0004a250: 646f 7365 2e50 6c61 6e0a 2020 2020 2020  dose.Plan.      
-0004a260: 2020 2020 2020 4120 506c 616e 206f 626a        A Plan obj
-0004a270: 6563 7420 746f 2061 7373 6967 6e20 746f  ect to assign to
-0004a280: 2074 6869 7320 7374 7275 6374 7572 6520   this structure 
-0004a290: 7365 742e 0a20 2020 2020 2020 2022 2222  set..        """
-0004a2a0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-0004a2b0: 2070 6c61 6e20 696e 2073 656c 662e 706c   plan in self.pl
-0004a2c0: 616e 733a 0a20 2020 2020 2020 2020 2020  ans:.           
-0004a2d0: 2073 656c 662e 706c 616e 732e 6170 7065   self.plans.appe
-0004a2e0: 6e64 2870 6c61 6e29 0a20 2020 2020 2020  nd(plan).       
-0004a2f0: 2020 2020 2073 656c 662e 706c 616e 732e       self.plans.
-0004a300: 736f 7274 2829 0a0a 2020 2020 2020 2020  sort()..        
-0004a310: 2020 2020 666f 7220 726f 6920 696e 2073      for roi in s
-0004a320: 656c 662e 726f 6973 3a0a 2020 2020 2020  elf.rois:.      
-0004a330: 2020 2020 2020 2020 2020 726f 692e 6164            roi.ad
-0004a340: 645f 706c 616e 2870 6c61 6e29 0a0a 2020  d_plan(plan)..  
-0004a350: 2020 6465 6620 636c 6561 725f 706c 616e    def clear_plan
-0004a360: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-0004a370: 2022 2222 436c 6561 7220 616c 6c20 706c   """Clear all pl
-0004a380: 616e 206d 6170 7320 6173 736f 6369 6174  an maps associat
-0004a390: 6564 2077 6974 6820 7468 6973 2073 7472  ed with this str
-0004a3a0: 7563 7475 7265 2073 6574 2e22 2222 0a0a  ucture set."""..
-0004a3b0: 2020 2020 2020 2020 7365 6c66 2e70 6c61          self.pla
-0004a3c0: 6e73 203d 205b 5d0a 0a20 2020 2064 6566  ns = []..    def
-0004a3d0: 2067 6574 5f70 6c61 6e73 2873 656c 6629   get_plans(self)
-0004a3e0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-0004a3f0: 7572 6e20 6c69 7374 206f 6620 506c 616e  urn list of Plan
-0004a400: 206f 626a 6563 7473 2061 7373 6f63 6961   objects associa
-0004a410: 7465 6420 7769 7468 2074 6869 7320 7374  ted with this st
-0004a420: 7275 6374 7572 6520 7365 742e 2222 220a  ructure set.""".
-0004a430: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0004a440: 7365 6c66 2e70 6c61 6e73 0a0a 2020 2020  self.plans..    
-0004a450: 6465 6620 696e 7465 7270 6f6c 6174 655f  def interpolate_
-0004a460: 706f 696e 7473 2873 656c 662c 206e 5f70  points(self, n_p
-0004a470: 6f69 6e74 3d4e 6f6e 652c 2064 7879 3d4e  oint=None, dxy=N
-0004a480: 6f6e 652c 0a20 2020 2020 2020 2073 6d6f  one,.        smo
-0004a490: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
-0004a4a0: 743d 3029 3a0a 2020 2020 2020 2020 2727  t=0):.        ''
-0004a4b0: 270a 2020 2020 2020 2020 5265 7475 726e  '.        Return
-0004a4c0: 206e 6577 2053 7472 7563 7475 7265 5365   new StructureSe
-0004a4d0: 7420 6f62 6a65 6374 2c20 7769 7468 2069  t object, with i
-0004a4e0: 6e74 6572 706f 6c61 7465 6420 636f 6e74  nterpolated cont
-0004a4f0: 6f75 7220 706f 696e 7473 2e0a 0a20 2020  our points...   
-0004a500: 2020 2020 2050 6f69 6e74 7320 6172 6520       Points are 
-0004a510: 696e 7465 7270 6f6c 6174 6564 2066 6f72  interpolated for
-0004a520: 2065 6163 6820 636f 6e74 6f75 7220 6f66   each contour of
-0004a530: 2065 6163 6820 524f 492e 0a0a 2020 2020   each ROI...    
-0004a540: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
-0004a550: 3a2a 2a0a 0a20 2020 2020 2020 206e 5f70  :**..        n_p
-0004a560: 6f69 6e74 203a 2069 6e74 2c20 6465 6661  oint : int, defa
-0004a570: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0004a580: 2020 2020 204e 756d 6265 7220 6f66 2070       Number of p
-0004a590: 6f69 6e74 7320 7065 7220 636f 6e74 6f75  oints per contou
-0004a5a0: 722c 2061 6674 6572 2069 6e74 6572 706f  r, after interpo
-0004a5b0: 6c61 7469 6f6e 2e20 2054 6869 7320 6d75  lation.  This mu
-0004a5c0: 7374 0a20 2020 2020 2020 2020 2020 2062  st.            b
-0004a5d0: 6520 7365 7420 746f 204e 6f6e 6520 666f  e set to None fo
-0004a5e0: 7220 6478 7920 746f 2062 6520 636f 6e73  r dxy to be cons
-0004a5f0: 6964 6572 6564 2e0a 0a20 2020 2020 2020  idered...       
-0004a600: 2064 7879 203a 2066 6c6f 6174 2c20 6465   dxy : float, de
-0004a610: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-0004a620: 2020 2020 2020 2041 7070 726f 7869 6d61         Approxima
-0004a630: 7465 2064 6973 7461 6e63 6520 7265 7175  te distance requ
-0004a640: 6972 6564 2062 6574 7765 656e 2063 6f6e  ired between con
-0004a650: 746f 7572 2070 6f69 6e74 732e 2020 5468  tour points.  Th
-0004a660: 6973 2069 7320 7461 6b65 6e0a 2020 2020  is is taken.    
-0004a670: 2020 2020 2020 2020 696e 746f 2061 6363          into acc
-0004a680: 6f75 6e74 206f 6e6c 7920 6966 206e 5f70  ount only if n_p
-0004a690: 6f69 6e74 2069 7320 7365 7420 746f 204e  oint is set to N
-0004a6a0: 6f6e 652e 2020 466f 7220 6120 636f 6e74  one.  For a cont
-0004a6b0: 6f75 7220 6f66 0a20 2020 2020 2020 2020  our of.         
-0004a6c0: 2020 206c 656e 6774 6820 636f 6e74 6f75     length contou
-0004a6d0: 725f 6c65 6e67 7468 2c20 7468 6520 6e75  r_length, the nu
-0004a6e0: 6d62 6572 206f 6620 636f 6e74 6f75 7220  mber of contour 
-0004a6f0: 706f 696e 7473 2069 7320 7468 656e 2074  points is then t
-0004a700: 616b 656e 0a20 2020 2020 2020 2020 2020  aken.           
-0004a710: 2074 6f20 6265 206d 6178 2869 6e74 2863   to be max(int(c
-0004a720: 6f6e 746f 7572 5f6c 656e 6774 6820 2f20  ontour_length / 
-0004a730: 6478 7929 2c20 3329 2e20 200a 0a20 2020  dxy), 3).  ..   
-0004a740: 2020 2020 2073 6d6f 6f74 686e 6573 735f       smoothness_
-0004a750: 7065 725f 706f 696e 7420 3a20 666c 6f61  per_point : floa
-0004a760: 742c 2064 6566 6175 6c74 3d30 0a20 2020  t, default=0.   
-0004a770: 2020 2020 2020 2020 2050 6172 616d 6574           Paramet
-0004a780: 6572 2064 6574 6572 6d69 6e69 6e67 2074  er determining t
-0004a790: 6865 2073 6d6f 6f74 686e 6573 7320 6f66  he smoothness of
-0004a7a0: 2074 6865 2042 2d73 706c 696e 6520 6375   the B-spline cu
-0004a7b0: 7276 6520 7573 6564 0a20 2020 2020 2020  rve used.       
-0004a7c0: 2020 2020 2069 6e20 636f 6e74 6f75 7220       in contour 
-0004a7d0: 6170 7072 6f78 696d 6174 696f 6e20 666f  approximation fo
-0004a7e0: 7220 696e 7465 7270 6f6c 6174 696f 6e2e  r interpolation.
-0004a7f0: 2020 5468 6520 7072 6f64 7563 7420 6f66    The product of
-0004a800: 0a20 2020 2020 2020 2020 2020 2073 6d6f  .            smo
-0004a810: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
-0004a820: 7420 616e 6420 7468 6520 6e75 6d62 6572  t and the number
-0004a830: 206f 6620 636f 6e74 6f75 7220 706f 696e   of contour poin
-0004a840: 7473 2028 7370 6563 6966 6965 640a 2020  ts (specified.  
-0004a850: 2020 2020 2020 2020 2020 6469 7265 6374            direct
-0004a860: 6c79 2076 6961 206e 5f70 6f69 6e74 2c20  ly via n_point, 
-0004a870: 6f72 2069 6e64 6972 6563 746c 7920 7669  or indirectly vi
-0004a880: 6120 6478 7929 2063 6f72 7265 7370 6f6e  a dxy) correspon
-0004a890: 6473 2074 6f20 7468 650a 2020 2020 2020  ds to the.      
-0004a8a0: 2020 2020 2020 7061 7261 6d65 7465 7220        parameter 
-0004a8b0: 7320 6f66 2073 6369 7079 2e69 6e74 6572  s of scipy.inter
-0004a8c0: 706f 6c61 7465 2e73 706c 7072 6570 202d  polate.splprep -
-0004a8d0: 2073 6565 2064 6f63 756d 656e 7461 7469   see documentati
-0004a8e0: 6f6e 2061 743a 0a20 2020 2020 2020 200a  on at:.        .
-0004a8f0: 2020 2020 2020 2020 2020 2020 6874 7470              http
-0004a900: 733a 2f2f 7363 6970 792e 6769 7468 7562  s://scipy.github
-0004a910: 2e69 6f2f 6465 7664 6f63 732f 7265 6665  .io/devdocs/refe
-0004a920: 7265 6e63 652f 6765 6e65 7261 7465 642f  rence/generated/
-0004a930: 7363 6970 792e 696e 7465 7270 6f6c 6174  scipy.interpolat
-0004a940: 652e 7370 6c70 7265 702e 6874 6d6c 2373  e.splprep.html#s
-0004a950: 6369 7079 2e69 6e74 6572 706f 6c61 7465  cipy.interpolate
-0004a960: 2e73 706c 7072 6570 0a0a 2020 2020 2020  .splprep..      
-0004a970: 2020 2020 2020 4120 736d 6f6f 7468 6e65        A smoothne
-0004a980: 7373 5f70 6572 5f70 6f69 6e74 206f 6620  ss_per_point of 
-0004a990: 3020 666f 7263 6573 2074 6865 2042 2d73  0 forces the B-s
-0004a9a0: 706c 696e 6520 746f 2070 6173 7320 7468  pline to pass th
-0004a9b0: 726f 7567 680a 2020 2020 2020 2020 2020  rough.          
-0004a9c0: 2020 616c 6c20 6f66 2074 6865 2070 7265    all of the pre
-0004a9d0: 2d69 6e74 6572 706f 6c61 7469 6f6e 2063  -interpolation c
-0004a9e0: 6f6e 746f 7572 2070 6f69 6e74 732e 0a20  ontour points.. 
-0004a9f0: 2020 2020 2020 2027 2727 0a0a 2020 2020         '''..    
-0004aa00: 2020 2020 2320 496e 7465 7270 6f6c 6174      # Interpolat
-0004aa10: 6520 706f 696e 7473 2066 6f72 2074 6865  e points for the
-0004aa20: 2072 6f69 730a 2020 2020 2020 2020 726f   rois.        ro
-0004aa30: 6973 203d 205b 5d0a 2020 2020 2020 2020  is = [].        
-0004aa40: 666f 7220 726f 6920 696e 2073 656c 662e  for roi in self.
-0004aa50: 6765 745f 726f 6973 2829 3a0a 2020 2020  get_rois():.    
-0004aa60: 2020 2020 2020 2020 726f 6973 2e61 7070          rois.app
-0004aa70: 656e 6428 726f 692e 696e 7465 7270 6f6c  end(roi.interpol
-0004aa80: 6174 655f 706f 696e 7473 280a 2020 2020  ate_points(.    
-0004aa90: 2020 2020 2020 2020 2020 2020 6e5f 706f              n_po
-0004aaa0: 696e 742c 2064 7879 2c20 736d 6f6f 7468  int, dxy, smooth
-0004aab0: 6e65 7373 5f70 6572 5f70 6f69 6e74 2929  ness_per_point))
-0004aac0: 0a0a 2020 2020 2020 2020 2320 436c 6f6e  ..        # Clon
-0004aad0: 6520 7365 6c66 2c20 7468 656e 2072 6573  e self, then res
-0004aae0: 6574 2073 6f75 7263 6520 616e 6420 726f  et source and ro
-0004aaf0: 6973 0a20 2020 2020 2020 2073 7320 3d20  is.        ss = 
-0004ab00: 5374 7275 6374 7572 6553 6574 2873 656c  StructureSet(sel
-0004ab10: 6629 0a20 2020 2020 2020 2073 732e 736f  f).        ss.so
-0004ab20: 7572 6365 7320 3d20 726f 6973 0a20 2020  urces = rois.   
-0004ab30: 2020 2020 2073 732e 726f 6973 203d 2072       ss.rois = r
-0004ab40: 6f69 730a 0a20 2020 2020 2020 2072 6574  ois..        ret
-0004ab50: 7572 6e20 7373 0a0a 2020 2020 6465 6620  urn ss..    def 
-0004ab60: 6f72 6465 725f 726f 6973 2873 656c 662c  order_rois(self,
-0004ab70: 206f 7264 6572 3d27 782b 2729 3a0a 2020   order='x+'):.  
-0004ab80: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
-0004ab90: 2020 4f72 6465 7220 524f 4973 2062 7920    Order ROIs by 
-0004aba0: 6f6e 6520 6f66 2074 6865 6972 2063 656e  one of their cen
-0004abb0: 7472 6f69 6420 636f 6f72 6469 6e61 7465  troid coordinate
-0004abc0: 732e 0a0a 2020 2020 2020 2020 2a2a 5061  s...        **Pa
-0004abd0: 7261 6d65 7465 723a 2a2a 0a0a 2020 2020  rameter:**..    
-0004abe0: 2020 2020 6f72 6465 7220 3a20 7374 722c      order : str,
-0004abf0: 2064 6566 6175 6c74 3d27 782b 270a 2020   default='x+'.  
-0004ac00: 2020 2020 2020 2020 2020 5370 6563 6966            Specif
-0004ac10: 6963 6174 696f 6e20 6f66 2077 6179 2069  ication of way i
-0004ac20: 7420 7768 6963 6820 524f 4973 2061 7265  t which ROIs are
-0004ac30: 2074 6f20 6265 206f 7264 6572 643a 0a20   to be orderd:. 
-0004ac40: 2020 2020 2020 2020 2020 202d 2027 782b             - 'x+
-0004ac50: 2720 3a20 696e 206f 7264 6572 206f 6620  ' : in order of 
-0004ac60: 696e 6372 6561 7369 6e67 2078 2076 616c  increasing x val
-0004ac70: 7565 2e0a 2020 2020 2020 2020 2020 2020  ue..            
-0004ac80: 2d20 2778 2d27 203a 2069 6e20 6f72 6465  - 'x-' : in orde
-0004ac90: 7220 6f66 2064 6563 7265 6173 696e 6720  r of decreasing 
-0004aca0: 7820 7661 6c75 652e 0a20 2020 2020 2020  x value..       
-0004acb0: 2020 2020 202d 2027 792b 2720 3a20 696e       - 'y+' : in
-0004acc0: 206f 7264 6572 206f 6620 696e 6372 6561   order of increa
-0004acd0: 7369 6e67 2079 2076 616c 7565 2e0a 2020  sing y value..  
-0004ace0: 2020 2020 2020 2020 2020 2d20 2779 2d27            - 'y-'
-0004acf0: 203a 2069 6e20 6f72 6465 7220 6f66 2064   : in order of d
-0004ad00: 6563 7265 6173 696e 6720 7920 7661 6c75  ecreasing y valu
-0004ad10: 652e 0a20 2020 2020 2020 2020 2020 202d  e..            -
-0004ad20: 2027 7a2b 2720 3a20 696e 206f 7264 6572   'z+' : in order
-0004ad30: 206f 6620 696e 6372 6561 7369 6e67 207a   of increasing z
-0004ad40: 2076 616c 7565 2e0a 2020 2020 2020 2020   value..        
-0004ad50: 2020 2020 2d20 277a 2d27 203a 2069 6e20      - 'z-' : in 
-0004ad60: 6f72 6465 7220 6f66 2064 6563 7265 6173  order of decreas
-0004ad70: 696e 6720 7a20 7661 6c75 652e 0a20 2020  ing z value..   
-0004ad80: 2020 2020 2027 2727 0a0a 2020 2020 2020       '''..      
-0004ad90: 2020 6966 206f 7264 6572 206e 6f74 2069    if order not i
-0004ada0: 6e20 5b27 782b 272c 2027 782d 272c 2027  n ['x+', 'x-', '
-0004adb0: 792b 272c 2027 792d 272c 2027 7a2b 272c  y+', 'y-', 'z+',
-0004adc0: 2027 7a2d 275d 3a0a 2020 2020 2020 2020   'z-']:.        
-0004add0: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-0004ade0: 2020 2020 2320 4465 7465 726d 696e 6520      # Determine 
-0004adf0: 6178 6973 2066 6f72 206f 7264 6572 696e  axis for orderin
-0004ae00: 672c 2061 6e64 2064 6972 6563 7469 6f6e  g, and direction
-0004ae10: 2e0a 2020 2020 2020 2020 6178 6973 203d  ..        axis =
-0004ae20: 2027 7879 7a27 2e66 696e 6428 6f72 6465   'xyz'.find(orde
-0004ae30: 725b 305d 290a 2020 2020 2020 2020 7265  r[0]).        re
-0004ae40: 7665 7273 6520 3d20 2827 2d27 2069 6e20  verse = ('-' in 
-0004ae50: 6f72 6465 7229 0a0a 2020 2020 2020 2020  order)..        
-0004ae60: 2320 4372 6561 7465 2064 6963 7469 6f6e  # Create diction
-0004ae70: 6172 7920 7768 6572 6520 6b65 7973 2061  ary where keys a
-0004ae80: 7265 2063 656e 7472 6f69 6420 636f 6f72  re centroid coor
-0004ae90: 6469 6e61 7465 730a 2020 2020 2020 2020  dinates.        
-0004aea0: 2320 616e 6420 7661 6c75 6573 2061 7265  # and values are
-0004aeb0: 206c 6973 7473 206f 6620 524f 4920 696e   lists of ROI in
-0004aec0: 6469 6369 6573 2061 7420 7468 6573 6520  dicies at these 
-0004aed0: 636f 6f72 6469 6e61 7465 732e 0a20 2020  coordinates..   
-0004aee0: 2020 2020 2063 656e 7472 6f69 6473 203d       centroids =
-0004aef0: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
-0004af00: 6920 696e 2072 616e 6765 286c 656e 2873  i in range(len(s
-0004af10: 656c 662e 726f 6973 2929 3a0a 2020 2020  elf.rois)):.    
-0004af20: 2020 2020 2020 2020 7879 7a20 3d20 7365          xyz = se
-0004af30: 6c66 2e72 6f69 735b 695d 2e67 6574 5f63  lf.rois[i].get_c
-0004af40: 656e 7472 6f69 6428 295b 6178 6973 5d0a  entroid()[axis].
-0004af50: 2020 2020 2020 2020 2020 2020 6966 2078              if x
-0004af60: 797a 206e 6f74 2069 6e20 6365 6e74 726f  yz not in centro
-0004af70: 6964 733a 0a20 2020 2020 2020 2020 2020  ids:.           
-0004af80: 2020 2020 2063 656e 7472 6f69 6473 5b78       centroids[x
-0004af90: 797a 5d20 3d20 5b5d 0a20 2020 2020 2020  yz] = [].       
-0004afa0: 2020 2020 2063 656e 7472 6f69 6473 5b78       centroids[x
-0004afb0: 797a 5d2e 6170 7065 6e64 2869 290a 0a20  yz].append(i).. 
-0004afc0: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
-0004afd0: 6c69 7374 206f 6620 524f 4973 206f 7264  list of ROIs ord
-0004afe0: 6572 6564 2062 7920 6365 6e74 726f 6964  ered by centroid
-0004aff0: 2063 6f6f 7264 696e 6174 652e 0a20 2020   coordinate..   
-0004b000: 2020 2020 2072 6f69 7320 3d20 5b5d 0a20       rois = []. 
-0004b010: 2020 2020 2020 2066 6f72 2063 656e 7472         for centr
-0004b020: 6f69 6420 696e 2073 6f72 7465 6428 6365  oid in sorted(ce
-0004b030: 6e74 726f 6964 732c 2072 6576 6572 7365  ntroids, reverse
-0004b040: 3d72 6576 6572 7365 293a 0a20 2020 2020  =reverse):.     
-0004b050: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-0004b060: 6365 6e74 726f 6964 735b 6365 6e74 726f  centroids[centro
-0004b070: 6964 5d3a 0a20 2020 2020 2020 2020 2020  id]:.           
-0004b080: 2020 2020 2072 6f69 732e 6170 7065 6e64       rois.append
-0004b090: 2873 656c 662e 726f 6973 5b69 5d29 0a0a  (self.rois[i])..
-0004b0a0: 2020 2020 2020 2020 2320 5374 6f72 6520          # Store 
-0004b0b0: 7468 6520 6e65 7720 6f72 6465 7220 6f66  the new order of
-0004b0c0: 2052 4f49 732e 0a20 2020 2020 2020 2073   ROIs..        s
-0004b0d0: 656c 662e 726f 6973 203d 2072 6f69 730a  elf.rois = rois.
-0004b0e0: 0a20 2020 2064 6566 2063 6f6d 6269 6e65  .    def combine
-0004b0f0: 5f72 6f69 7328 7365 6c66 2c20 6e61 6d65  _rois(self, name
-0004b100: 3d4e 6f6e 652c 2072 6f69 5f6e 616d 6573  =None, roi_names
-0004b110: 3d4e 6f6e 652c 2069 6d61 6765 3d4e 6f6e  =None, image=Non
-0004b120: 652c 206d 6574 686f 643d 4e6f 6e65 293a  e, method=None):
-0004b130: 0a20 2020 2020 2020 2027 2727 0a20 2020  .        '''.   
-0004b140: 2020 2020 2043 6f6d 6269 6e65 2074 776f       Combine two
-0004b150: 206f 7220 6d6f 7265 2052 4f49 7320 6173   or more ROIs as
-0004b160: 2061 2073 696e 676c 6520 524f 492e 0a0a   a single ROI...
-0004b170: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
-0004b180: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
-0004b190: 206e 616d 6520 3a20 7374 722c 2064 6566   name : str, def
-0004b1a0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-0004b1b0: 2020 2020 2020 4e61 6d65 2074 6f20 6265        Name to be
-0004b1c0: 2067 6976 656e 2074 6f20 7468 6520 636f   given to the co
-0004b1d0: 6d70 6f73 6974 6520 524f 492e 2020 4966  mposite ROI.  If
-0004b1e0: 204e 6f6e 652c 2074 6865 0a20 2020 2020   None, the.     
-0004b1f0: 2020 2020 2020 206e 616d 6520 6173 7369         name assi
-0004b200: 676e 6564 2069 7320 666f 726d 6564 2062  gned is formed b
-0004b210: 7920 6a6f 696e 696e 6720 746f 6765 7468  y joining togeth
-0004b220: 6572 2074 6865 206e 616d 6573 0a20 2020  er the names.   
-0004b230: 2020 2020 2020 2020 206f 6620 7468 6520           of the 
-0004b240: 6f72 6967 696e 616c 2052 4f49 732e 0a0a  original ROIs...
-0004b250: 2020 2020 2020 2020 726f 695f 6e61 6d65          roi_name
-0004b260: 7320 3a20 6c69 7374 2c20 6465 6661 756c  s : list, defaul
-0004b270: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-0004b280: 2020 204c 6973 7420 6f66 206e 616d 6573     List of names
-0004b290: 206f 6620 524f 4973 2074 6f20 6265 2063   of ROIs to be c
-0004b2a0: 6f6d 6269 6e65 642e 2020 4966 204e 6f6e  ombined.  If Non
-0004b2b0: 652c 2061 6c6c 206f 6620 7468 650a 2020  e, all of the.  
-0004b2c0: 2020 2020 2020 2020 2020 7374 7275 6374            struct
-0004b2d0: 7572 6520 7365 7427 7320 524f 4973 2061  ure set's ROIs a
-0004b2e0: 7265 2063 6f6d 6269 6e65 642e 0a0a 2020  re combined...  
-0004b2f0: 2020 2020 2020 696d 6167 6520 3a20 736b        image : sk
-0004b300: 7274 2e69 6d61 6765 2e49 6d61 6765 2c20  rt.image.Image, 
-0004b310: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-0004b320: 2020 2020 2020 2020 2049 6d61 6765 2074           Image t
-0004b330: 6f20 7365 7420 666f 7220 7468 6520 636f  o set for the co
-0004b340: 6d70 6f73 6974 6520 524f 492e 2020 4966  mposite ROI.  If
-0004b350: 204e 6f6e 652c 2075 7365 2074 6865 2069   None, use the i
-0004b360: 6d61 6765 0a20 2020 2020 2020 2020 2020  mage.           
-0004b370: 206f 6620 7468 6520 524f 4920 7769 7468   of the ROI with
-0004b380: 2074 6865 2066 6972 7374 206e 616d 6520   the first name 
-0004b390: 696e 203c 726f 695f 6e61 6d65 733e 2e0a  in <roi_names>..
-0004b3a0: 0a20 2020 2020 2020 206d 6574 686f 6420  .        method 
-0004b3b0: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
-0004b3c0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0004b3d0: 4d65 7468 6f64 2074 6f20 7573 6520 666f  Method to use fo
-0004b3e0: 7220 636f 6d62 696e 696e 6720 524f 4973  r combining ROIs
-0004b3f0: 2e20 2043 616e 2062 653a 200a 0a20 2020  .  Can be: ..   
-0004b400: 2020 2020 2020 2020 2020 2020 202d 2022               - "
-0004b410: 636f 6e74 6f75 7222 3a20 7461 6b65 2075  contour": take u
-0004b420: 6e61 7279 2075 6e69 6f6e 206f 6620 7368  nary union of sh
-0004b430: 6170 656c 7920 706f 6c79 676f 6e73 2e0a  apely polygons..
-0004b440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b450: 2d20 226d 6173 6b22 3a20 7375 6d20 6269  - "mask": sum bi
-0004b460: 6e61 7279 206d 6173 6b73 2e0a 2020 2020  nary masks..    
-0004b470: 2020 2020 2020 2020 2020 2020 2d20 2261              - "a
-0004b480: 7574 6f22 3a20 7573 6520 7468 6520 6465  uto": use the de
-0004b490: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
-0004b4a0: 6420 6f66 2074 6865 2052 4f49 2077 6974  d of the ROI wit
-0004b4b0: 6820 7468 650a 2020 2020 2020 2020 2020  h the.          
-0004b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b4d0: 6669 7273 7420 6e61 6d65 2069 6e20 3c72  first name in <r
-0004b4e0: 6f69 5f6e 616d 6573 3e2e 0a0a 2020 2020  oi_names>...    
-0004b4f0: 2020 2020 2020 2020 4966 204e 6f6e 652c          If None,
-0004b500: 2022 6175 746f 2220 6973 2075 7365 642e   "auto" is used.
-0004b510: 0a20 2020 2020 2020 2027 2727 0a0a 2020  .        '''..  
-0004b520: 2020 2020 2020 2320 4966 204e 6f6e 6520        # If None 
-0004b530: 7661 6c75 6573 2070 6173 7365 642c 2073  values passed, s
-0004b540: 6574 2064 6566 6175 6c74 2062 6568 6176  et default behav
-0004b550: 696f 7572 2e0a 2020 2020 2020 2020 6966  iour..        if
-0004b560: 2072 6f69 5f6e 616d 6573 2069 7320 4e6f   roi_names is No
-0004b570: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0004b580: 726f 695f 6e61 6d65 7320 3d20 7365 6c66  roi_names = self
-0004b590: 2e67 6574 5f72 6f69 5f6e 616d 6573 2829  .get_roi_names()
-0004b5a0: 0a20 2020 2020 2020 2069 6620 6e61 6d65  .        if name
-0004b5b0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0004b5c0: 2020 2020 2020 6e61 6d65 203d 2027 2b27        name = '+'
-0004b5d0: 2e6a 6f69 6e28 726f 695f 6e61 6d65 7329  .join(roi_names)
-0004b5e0: 0a20 2020 2020 2020 2069 6620 6d65 7468  .        if meth
-0004b5f0: 6f64 2069 6e20 5b4e 6f6e 652c 2022 6175  od in [None, "au
-0004b600: 746f 225d 3a0a 2020 2020 2020 2020 2020  to"]:.          
-0004b610: 2020 6d65 7468 6f64 203d 2073 656c 665b    method = self[
-0004b620: 726f 695f 6e61 6d65 735b 305d 5d2e 6465  roi_names[0]].de
-0004b630: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
-0004b640: 640a 2020 2020 2020 2020 6966 2069 6d61  d.        if ima
-0004b650: 6765 2069 7320 4e6f 6e65 3a0a 2020 2020  ge is None:.    
-0004b660: 2020 2020 2020 2020 696d 6167 6520 3d20          image = 
-0004b670: 7365 6c66 5b72 6f69 5f6e 616d 6573 5b30  self[roi_names[0
-0004b680: 5d5d 2e69 6d61 6765 0a0a 2020 2020 2020  ]].image..      
-0004b690: 2020 6966 2022 636f 6e74 6f75 7222 203d    if "contour" =
-0004b6a0: 3d20 6d65 7468 6f64 3a0a 2020 2020 2020  = method:.      
-0004b6b0: 2020 2020 2020 2320 4372 6561 7465 2061        # Create a
-0004b6c0: 2064 6963 7469 6f6e 6172 7920 636f 6e74   dictionary cont
-0004b6d0: 6169 6e69 6e67 2070 6f6c 7967 6f6e 7320  aining polygons 
-0004b6e0: 666f 7220 616c 6c20 524f 4973 2e0a 2020  for all ROIs..  
-0004b6f0: 2020 2020 2020 2020 2020 616c 6c5f 706f            all_po
-0004b700: 6c79 676f 6e73 203d 207b 7d0a 2020 2020  lygons = {}.    
-0004b710: 2020 2020 2020 2020 666f 7220 726f 6920          for roi 
-0004b720: 696e 2073 656c 662e 6765 745f 726f 6973  in self.get_rois
-0004b730: 2872 6f69 5f6e 616d 6573 293a 0a20 2020  (roi_names):.   
-0004b740: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0004b750: 206b 6579 2c20 706f 6c79 676f 6e73 2069   key, polygons i
-0004b760: 6e20 726f 692e 6765 745f 706f 6c79 676f  n roi.get_polygo
-0004b770: 6e73 2829 2e69 7465 6d73 2829 3a0a 2020  ns().items():.  
-0004b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b790: 2020 6966 206e 6f74 206b 6579 2069 6e20    if not key in 
-0004b7a0: 616c 6c5f 706f 6c79 676f 6e73 3a0a 2020  all_polygons:.  
-0004b7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b7c0: 2020 2020 2020 616c 6c5f 706f 6c79 676f        all_polygo
-0004b7d0: 6e73 5b6b 6579 5d20 3d20 5b5d 0a20 2020  ns[key] = [].   
-0004b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b7f0: 2061 6c6c 5f70 6f6c 7967 6f6e 735b 6b65   all_polygons[ke
-0004b800: 795d 2e65 7874 656e 6428 706f 6c79 676f  y].extend(polygo
-0004b810: 6e73 290a 0a20 2020 2020 2020 2020 2020  ns)..           
-0004b820: 2023 2045 7661 6c75 6174 6520 7468 6520   # Evaluate the 
-0004b830: 756e 6172 7920 756e 696f 6e20 6f66 2070  unary union of p
-0004b840: 6f6c 7967 6f6e 7320 666f 7220 6561 6368  olygons for each
-0004b850: 2073 6c69 6365 2e0a 2020 2020 2020 2020   slice..        
-0004b860: 2020 2020 616c 6c5f 706f 6c79 676f 6e73      all_polygons
-0004b870: 203d 207b 6b65 793a 205b 6f70 732e 756e   = {key: [ops.un
-0004b880: 6172 795f 756e 696f 6e28 616c 6c5f 706f  ary_union(all_po
-0004b890: 6c79 676f 6e73 5b6b 6579 5d29 5d0a 2020  lygons[key])].  
-0004b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b8b0: 2020 2066 6f72 206b 6579 2069 6e20 616c     for key in al
-0004b8c0: 6c5f 706f 6c79 676f 6e73 7d0a 0a20 2020  l_polygons}..   
-0004b8d0: 2020 2020 2020 2020 2023 2043 7265 6174           # Creat
-0004b8e0: 6520 7468 6520 636f 6d70 6f73 6974 6520  e the composite 
-0004b8f0: 524f 492e 0a20 2020 2020 2020 2020 2020  ROI..           
-0004b900: 2072 6f69 5f6e 6577 203d 2052 4f49 2873   roi_new = ROI(s
-0004b910: 6f75 7263 653d 616c 6c5f 706f 6c79 676f  ource=all_polygo
-0004b920: 6e73 2c20 696d 6167 653d 696d 6167 652c  ns, image=image,
-0004b930: 206e 616d 653d 6e61 6d65 290a 0a20 2020   name=name)..   
-0004b940: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0004b950: 2020 2020 2020 2023 2055 7365 2064 6174         # Use dat
-0004b960: 6120 6672 6f6d 206f 6e65 206f 6620 7468  a from one of th
-0004b970: 6520 524f 4973 2061 7320 6120 7374 6172  e ROIs as a star
-0004b980: 7469 6e67 2070 6f69 6e74 2e0a 2020 2020  ting point..    
-0004b990: 2020 2020 2020 2020 726f 6930 203d 2073          roi0 = s
-0004b9a0: 656c 662e 6765 745f 726f 6928 726f 695f  elf.get_roi(roi_
-0004b9b0: 6e61 6d65 735b 305d 290a 2020 2020 2020  names[0]).      
-0004b9c0: 2020 2020 2020 726f 695f 6e65 7720 3d20        roi_new = 
-0004b9d0: 524f 4928 736f 7572 6365 3d72 6f69 302e  ROI(source=roi0.
-0004b9e0: 6765 745f 6d61 736b 2829 2e63 6f70 7928  get_mask().copy(
-0004b9f0: 292c 2061 6666 696e 653d 726f 6930 2e61  ), affine=roi0.a
-0004ba00: 6666 696e 652c 0a20 2020 2020 2020 2020  ffine,.         
-0004ba10: 2020 2020 2020 2020 2020 206e 616d 653d             name=
-0004ba20: 6e61 6d65 2c20 696d 6167 653d 696d 6167  name, image=imag
-0004ba30: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-0004ba40: 2320 436f 6d62 696e 6520 7769 7468 2064  # Combine with d
-0004ba50: 6174 6120 6672 6f6d 2074 6865 206f 7468  ata from the oth
-0004ba60: 6572 2052 4f49 732e 0a20 2020 2020 2020  er ROIs..       
-0004ba70: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-0004ba80: 6e67 6528 312c 206c 656e 2872 6f69 5f6e  nge(1, len(roi_n
-0004ba90: 616d 6573 2929 3a0a 2020 2020 2020 2020  ames)):.        
-0004baa0: 2020 2020 2020 2020 726f 695f 6e65 772e          roi_new.
-0004bab0: 6d61 736b 2e64 6174 6120 7c3d 2073 656c  mask.data |= sel
-0004bac0: 662e 6765 745f 726f 6928 726f 695f 6e61  f.get_roi(roi_na
-0004bad0: 6d65 735b 695d 292e 6765 745f 6d61 736b  mes[i]).get_mask
-0004bae0: 2829 0a0a 2020 2020 2020 2020 7265 7475  ()..        retu
-0004baf0: 726e 2072 6f69 5f6e 6577 0a0a 2020 2020  rn roi_new..    
-0004bb00: 6465 6620 6765 745f 6d61 736b 5f69 6d61  def get_mask_ima
-0004bb10: 6765 2873 656c 662c 206e 616d 653d 4e6f  ge(self, name=No
-0004bb20: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
-0004bb30: 0a20 2020 2020 2020 2047 6574 2069 6d61  .        Get ima
-0004bb40: 6765 206f 626a 6563 7420 7265 7072 6573  ge object repres
-0004bb50: 656e 7469 6e67 206d 6173 6b20 666f 7220  enting mask for 
-0004bb60: 616c 6c20 524f 4973 206f 6620 7374 7275  all ROIs of stru
-0004bb70: 6374 7572 6520 7365 742e 0a0a 2020 2020  cture set...    
-0004bb80: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
-0004bb90: 3a2a 2a0a 0a20 2020 2020 2020 206e 616d  :**..        nam
-0004bba0: 6520 3a20 7374 722c 2064 6566 6175 6c74  e : str, default
-0004bbb0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0004bbc0: 2020 4e61 6d65 2074 6f20 6265 2067 6976    Name to be giv
-0004bbd0: 656e 2074 6f20 7468 6520 6d61 736b 2069  en to the mask i
-0004bbe0: 6d61 6765 2e20 2049 6620 4e6f 6e65 2c20  mage.  If None, 
-0004bbf0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-0004bc00: 6e61 6d65 2061 7373 6967 6e65 6420 6973  name assigned is
-0004bc10: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
-0004bc20: 2073 7472 7563 7475 7265 2073 6574 2c20   structure set, 
-0004bc30: 7769 7468 2073 7566 6669 780a 2020 2020  with suffix.    
-0004bc40: 2020 2020 2020 2020 225f 6d61 736b 2220          "_mask" 
-0004bc50: 6170 7065 6e64 6564 2e0a 2020 2020 2020  appended..      
-0004bc60: 2020 2222 220a 2020 2020 2020 2020 6e61    """.        na
-0004bc70: 6d65 203d 206e 616d 6520 6f72 2066 227b  me = name or f"{
-0004bc80: 7365 6c66 2e6e 616d 657d 5f6d 6173 6b22  self.name}_mask"
-0004bc90: 0a20 2020 2020 2020 2072 6f69 5f63 6f6d  .        roi_com
-0004bca0: 6269 6e65 6420 3d20 7365 6c66 2e63 6f6d  bined = self.com
-0004bcb0: 6269 6e65 5f72 6f69 7328 6e61 6d65 3d6e  bine_rois(name=n
-0004bcc0: 616d 6529 0a20 2020 2020 2020 206d 6173  ame).        mas
-0004bcd0: 6b5f 696d 6167 6520 3d20 726f 695f 636f  k_image = roi_co
-0004bce0: 6d62 696e 6564 2e67 6574 5f6d 6173 6b5f  mbined.get_mask_
-0004bcf0: 696d 6167 6528 290a 2020 2020 2020 2020  image().        
-0004bd00: 7265 7475 726e 206d 6173 6b5f 696d 6167  return mask_imag
-0004bd10: 650a 0a20 2020 2064 6566 2063 726f 7028  e..    def crop(
-0004bd20: 7365 6c66 2c20 786c 696d 3d4e 6f6e 652c  self, xlim=None,
-0004bd30: 2079 6c69 6d3d 4e6f 6e65 2c20 7a6c 696d   ylim=None, zlim
-0004bd40: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0004bd50: 2222 220a 2020 2020 2020 2020 4372 6f70  """.        Crop
-0004bd60: 2061 6c6c 2052 4f49 7320 6f66 2053 7472   all ROIs of Str
-0004bd70: 7563 7475 7265 5365 7420 746f 2073 7065  uctureSet to spe
-0004bd80: 6369 6669 6564 2072 616e 6765 2069 6e20  cified range in 
-0004bd90: 782c 2079 2c20 7a2e 0a0a 2020 2020 2020  x, y, z...      
-0004bda0: 2020 5468 6520 7061 7261 6d65 7465 7273    The parameters
-0004bdb0: 2078 6c69 6d2c 2079 6c69 6d2c 207a 6c69   xlim, ylim, zli
-0004bdc0: 6d20 6172 6520 7061 7373 6564 2074 6f20  m are passed to 
-0004bdd0: 6561 6368 2052 4f49 2773 2063 726f 7028  each ROI's crop(
-0004bde0: 2920 6d65 7468 6f64 2e0a 2020 2020 2020  ) method..      
-0004bdf0: 2020 466f 7220 6578 706c 616e 6174 696f    For explanatio
-0004be00: 6e20 6f66 2074 6865 7365 2070 6172 616d  n of these param
-0004be10: 6574 6572 732c 2073 6565 2064 6f63 756d  eters, see docum
-0004be20: 656e 7461 7469 6f6e 2066 6f72 0a20 2020  entation for.   
-0004be30: 2020 2020 2073 6b72 742e 7374 7275 6374       skrt.struct
-0004be40: 7572 6573 2e52 4f49 2e63 726f 7028 292e  ures.ROI.crop().
-0004be50: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0004be60: 2020 2020 2066 6f72 2072 6f69 2069 6e20       for roi in 
-0004be70: 7365 6c66 2e67 6574 5f72 6f69 7328 293a  self.get_rois():
-0004be80: 0a20 2020 2020 2020 2020 2020 2072 6f69  .            roi
-0004be90: 2e63 726f 7028 786c 696d 2c20 796c 696d  .crop(xlim, ylim
-0004bea0: 2c20 7a6c 696d 290a 0a63 6c61 7373 2053  , zlim)..class S
-0004beb0: 7472 7563 7475 7265 5365 7449 7465 7261  tructureSetItera
-0004bec0: 746f 723a 0a0a 2020 2020 6465 6620 5f5f  tor:..    def __
-0004bed0: 696e 6974 5f5f 2873 656c 662c 2073 7472  init__(self, str
-0004bee0: 7563 7475 7265 5f73 6574 293a 0a20 2020  ucture_set):.   
-0004bef0: 2020 2020 2073 656c 662e 6964 7820 3d20       self.idx = 
-0004bf00: 2d31 0a20 2020 2020 2020 2073 656c 662e  -1.        self.
-0004bf10: 7374 7275 6374 7572 655f 7365 7420 3d20  structure_set = 
-0004bf20: 7374 7275 6374 7572 655f 7365 740a 0a20  structure_set.. 
-0004bf30: 2020 2064 6566 205f 5f6e 6578 745f 5f28     def __next__(
-0004bf40: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
-0004bf50: 656c 662e 6964 7820 2b3d 2031 0a20 2020  elf.idx += 1.   
-0004bf60: 2020 2020 2069 6620 7365 6c66 2e69 6478       if self.idx
-0004bf70: 203c 206c 656e 2873 656c 662e 7374 7275   < len(self.stru
-0004bf80: 6374 7572 655f 7365 742e 6765 745f 726f  cture_set.get_ro
-0004bf90: 6973 2829 293a 0a20 2020 2020 2020 2020  is()):.         
-0004bfa0: 2020 2072 6574 7572 6e20 7365 6c66 2e73     return self.s
-0004bfb0: 7472 7563 7475 7265 5f73 6574 2e67 6574  tructure_set.get
-0004bfc0: 5f72 6f69 7328 295b 7365 6c66 2e69 6478  _rois()[self.idx
-0004bfd0: 5d0a 2020 2020 2020 2020 7261 6973 6520  ].        raise 
-0004bfe0: 5374 6f70 4974 6572 6174 696f 6e0a 0a0a  StopIteration...
-0004bff0: 6465 6620 6c6f 6164 5f72 6f69 735f 6469  def load_rois_di
-0004c000: 636f 6d28 7061 7468 2c20 6e61 6d65 733d  com(path, names=
-0004c010: 4e6f 6e65 293a 0a20 2020 2022 2222 4c6f  None):.    """Lo
-0004c020: 6164 2052 4f49 2873 2920 6672 6f6d 2061  ad ROI(s) from a
-0004c030: 2064 6963 6f6d 2073 7472 7563 7475 7265   dicom structure
-0004c040: 2073 6574 2066 696c 652e 203c 6e61 6d65   set file. <name
-0004c050: 3e20 6361 6e20 6265 2061 2073 696e 676c  > can be a singl
-0004c060: 650a 2020 2020 6e61 6d65 206f 7220 6c69  e.    name or li
-0004c070: 7374 206f 6620 6e61 6d65 7320 6f66 2052  st of names of R
-0004c080: 4f49 7320 746f 206c 6f61 642e 2222 220a  OIs to load.""".
-0004c090: 0a20 2020 2023 204c 6f61 6420 6469 636f  .    # Load dico
-0004c0a0: 6d20 6f62 6a65 6374 0a20 2020 2074 7279  m object.    try
-0004c0b0: 3a0a 2020 2020 2020 2020 6473 203d 2070  :.        ds = p
-0004c0c0: 7964 6963 6f6d 2e64 636d 7265 6164 2870  ydicom.dcmread(p
-0004c0d0: 6174 682c 2066 6f72 6365 3d54 7275 6529  ath, force=True)
-0004c0e0: 0a20 2020 2065 7863 6570 7420 7079 6469  .    except pydi
-0004c0f0: 636f 6d2e 6572 726f 7273 2e49 6e76 616c  com.errors.Inval
-0004c100: 6964 4469 636f 6d45 7272 6f72 3a0a 2020  idDicomError:.  
-0004c110: 2020 2020 2020 7265 7475 726e 205b 5d2c        return [],
-0004c120: 204e 6f6e 650a 2020 2020 6966 206e 6f74   None.    if not
-0004c130: 2068 6173 6174 7472 2864 732c 2022 534f   hasattr(ds, "SO
-0004c140: 5043 6c61 7373 5549 4422 293a 0a20 2020  PClassUID"):.   
-0004c150: 2020 2020 2072 6574 7572 6e20 5b5d 2c20       return [], 
-0004c160: 4e6f 6e65 0a20 2020 2069 6620 6e6f 7420  None.    if not 
-0004c170: 2864 732e 534f 5043 6c61 7373 5549 4420  (ds.SOPClassUID 
-0004c180: 3d3d 2022 312e 322e 3834 302e 3130 3030  == "1.2.840.1000
-0004c190: 382e 352e 312e 342e 312e 312e 3438 312e  8.5.1.4.1.1.481.
-0004c1a0: 3322 293a 0a20 2020 2020 2020 2070 7269  3"):.        pri
-0004c1b0: 6e74 2866 2257 6172 6e69 6e67 3a20 7b70  nt(f"Warning: {p
-0004c1c0: 6174 687d 2069 7320 6e6f 7420 6120 4449  ath} is not a DI
-0004c1d0: 434f 4d20 7374 7275 6374 7572 6520 7365  COM structure se
-0004c1e0: 7420 6669 6c65 2122 290a 2020 2020 2020  t file!").      
-0004c1f0: 2020 7265 7475 726e 205b 5d2c 204e 6f6e    return [], Non
-0004c200: 650a 0a20 2020 2023 2047 6574 2052 4f49  e..    # Get ROI
-0004c210: 206e 616d 6573 0a20 2020 2073 6571 203d   names.    seq =
-0004c220: 2067 6574 5f64 6963 6f6d 5f73 6571 7565   get_dicom_seque
-0004c230: 6e63 6528 6473 2c20 2253 7472 7563 7475  nce(ds, "Structu
-0004c240: 7265 5365 7452 4f49 2229 0a20 2020 2072  reSetROI").    r
-0004c250: 6f69 7320 3d20 7b7d 0a20 2020 2066 6f72  ois = {}.    for
-0004c260: 2072 6f69 2069 6e20 7365 713a 0a20 2020   roi in seq:.   
-0004c270: 2020 2020 2072 6f69 735b 696e 7428 726f       rois[int(ro
-0004c280: 692e 524f 494e 756d 6265 7229 5d20 3d20  i.ROINumber)] = 
-0004c290: 7b22 6e61 6d65 223a 2072 6f69 2e52 4f49  {"name": roi.ROI
-0004c2a0: 4e61 6d65 7d0a 0a20 2020 2023 2046 696e  Name}..    # Fin
-0004c2b0: 6420 524f 4973 206d 6174 6368 696e 6720  d ROIs matching 
-0004c2c0: 7265 7175 6573 7465 6420 6e61 6d65 730a  requested names.
-0004c2d0: 2020 2020 6e61 6d65 735f 746f 5f6c 6f61      names_to_loa
-0004c2e0: 6420 3d20 4e6f 6e65 0a20 2020 2069 6620  d = None.    if 
-0004c2f0: 6973 696e 7374 616e 6365 286e 616d 6573  isinstance(names
-0004c300: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
-0004c310: 6e61 6d65 735f 746f 5f6c 6f61 6420 3d20  names_to_load = 
-0004c320: 5b6e 616d 6573 5d0a 2020 2020 656c 6966  [names].    elif
-0004c330: 2073 6b72 742e 636f 7265 2e69 735f 6c69   skrt.core.is_li
-0004c340: 7374 286e 616d 6573 293a 0a20 2020 2020  st(names):.     
-0004c350: 2020 206e 616d 6573 5f74 6f5f 6c6f 6164     names_to_load
-0004c360: 203d 206e 616d 6573 0a20 2020 2069 6620   = names.    if 
-0004c370: 6e61 6d65 735f 746f 5f6c 6f61 643a 0a20  names_to_load:. 
-0004c380: 2020 2020 2020 2072 6f69 7320 3d20 7b0a         rois = {.
-0004c390: 2020 2020 2020 2020 2020 2020 693a 2073              i: s
-0004c3a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0004c3b0: 2069 2c20 7320 696e 2072 6f69 732e 6974   i, s in rois.it
-0004c3c0: 656d 7328 290a 2020 2020 2020 2020 2020  ems().          
-0004c3d0: 2020 6966 2061 6e79 280a 2020 2020 2020    if any(.      
-0004c3e0: 2020 2020 2020 2020 2020 5b66 6e6d 6174            [fnmat
-0004c3f0: 6368 2e66 6e6d 6174 6368 2873 5b22 6e61  ch.fnmatch(s["na
-0004c400: 6d65 225d 2e6c 6f77 6572 2829 2c20 6e2e  me"].lower(), n.
-0004c410: 6c6f 7765 7228 2929 2066 6f72 206e 2069  lower()) for n i
-0004c420: 6e20 6e61 6d65 735f 746f 5f6c 6f61 645d  n names_to_load]
-0004c430: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0004c440: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-0004c450: 2069 6620 6e6f 7420 6c65 6e28 726f 6973   if not len(rois
-0004c460: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-0004c470: 7269 6e74 2866 2257 6172 6e69 6e67 3a20  rint(f"Warning: 
-0004c480: 6e6f 2052 4f49 7320 666f 756e 6420 6d61  no ROIs found ma
-0004c490: 7463 6869 6e67 206e 616d 6528 7329 3a20  tching name(s): 
-0004c4a0: 7b6e 616d 6573 7d22 290a 2020 2020 2020  {names}").      
-0004c4b0: 2020 2020 2020 7265 7475 726e 205b 5d2c        return [],
-0004c4c0: 204e 6f6e 650a 0a20 2020 2023 2047 6574   None..    # Get
-0004c4d0: 2052 4f49 2064 6574 6169 6c73 0a20 2020   ROI details.   
-0004c4e0: 2072 6f69 5f73 6571 203d 2067 6574 5f64   roi_seq = get_d
-0004c4f0: 6963 6f6d 5f73 6571 7565 6e63 6528 6473  icom_sequence(ds
-0004c500: 2c20 2252 4f49 436f 6e74 6f75 7222 290a  , "ROIContour").
-0004c510: 2020 2020 666f 7220 726f 6920 696e 2072      for roi in r
-0004c520: 6f69 5f73 6571 3a0a 0a20 2020 2020 2020  oi_seq:..       
-0004c530: 206e 756d 6265 7220 3d20 726f 692e 5265   number = roi.Re
-0004c540: 6665 7265 6e63 6564 524f 494e 756d 6265  ferencedROINumbe
-0004c550: 720a 2020 2020 2020 2020 6966 206e 756d  r.        if num
-0004c560: 6265 7220 6e6f 7420 696e 2072 6f69 733a  ber not in rois:
-0004c570: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-0004c580: 7469 6e75 650a 2020 2020 2020 2020 6461  tinue.        da
-0004c590: 7461 203d 207b 2263 6f6e 746f 7572 7322  ta = {"contours"
-0004c5a0: 3a20 7b7d 7d0a 0a20 2020 2020 2020 2023  : {}}..        #
-0004c5b0: 2047 6574 2052 4f49 2063 6f6c 6f75 720a   Get ROI colour.
-0004c5c0: 2020 2020 2020 2020 6966 2022 524f 4944          if "ROID
-0004c5d0: 6973 706c 6179 436f 6c6f 7222 2069 6e20  isplayColor" in 
-0004c5e0: 726f 693a 0a20 2020 2020 2020 2020 2020  roi:.           
-0004c5f0: 2064 6174 615b 2263 6f6c 6f72 225d 203d   data["color"] =
-0004c600: 205b 696e 7428 6329 202f 2032 3535 2066   [int(c) / 255 f
-0004c610: 6f72 2063 2069 6e20 6c69 7374 2872 6f69  or c in list(roi
-0004c620: 2e52 4f49 4469 7370 6c61 7943 6f6c 6f72  .ROIDisplayColor
-0004c630: 295d 0a20 2020 2020 2020 2065 6c73 653a  )].        else:
-0004c640: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-0004c650: 615b 2263 6f6c 6f72 225d 203d 204e 6f6e  a["color"] = Non
-0004c660: 650a 0a20 2020 2020 2020 2023 2047 6574  e..        # Get
-0004c670: 2063 6f6e 746f 7572 730a 2020 2020 2020   contours.      
-0004c680: 2020 636f 6e74 6f75 725f 7365 7120 3d20    contour_seq = 
-0004c690: 6765 745f 6469 636f 6d5f 7365 7175 656e  get_dicom_sequen
-0004c6a0: 6365 2872 6f69 2c20 2243 6f6e 746f 7572  ce(roi, "Contour
-0004c6b0: 2229 0a20 2020 2020 2020 2069 6620 636f  ").        if co
-0004c6c0: 6e74 6f75 725f 7365 713a 0a20 2020 2020  ntour_seq:.     
-0004c6d0: 2020 2020 2020 2066 6f72 2063 2069 6e20         for c in 
-0004c6e0: 636f 6e74 6f75 725f 7365 713a 0a20 2020  contour_seq:.   
-0004c6f0: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
-0004c700: 6e65 5f64 6174 6120 3d20 5b0a 2020 2020  ne_data = [.    
-0004c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c720: 5b66 6c6f 6174 2870 2920 666f 7220 7020  [float(p) for p 
-0004c730: 696e 2063 2e43 6f6e 746f 7572 4461 7461  in c.ContourData
-0004c740: 5b69 202a 2033 203a 2069 202a 2033 202b  [i * 3 : i * 3 +
-0004c750: 2033 5d5d 0a20 2020 2020 2020 2020 2020   3]].           
-0004c760: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-0004c770: 6e20 7261 6e67 6528 632e 4e75 6d62 6572  n range(c.Number
-0004c780: 4f66 436f 6e74 6f75 7250 6f69 6e74 7329  OfContourPoints)
-0004c790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004c7a0: 205d 0a20 2020 2020 2020 2020 2020 2020   ].             
-0004c7b0: 2020 207a 203d 2066 6c6f 6174 2863 2e43     z = float(c.C
-0004c7c0: 6f6e 746f 7572 4461 7461 5b32 5d29 0a20  ontourData[2]). 
-0004c7d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004c7e0: 6620 7a20 6e6f 7420 696e 2064 6174 615b  f z not in data[
-0004c7f0: 2263 6f6e 746f 7572 7322 5d3a 0a20 2020  "contours"]:.   
-0004c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c810: 2064 6174 615b 2263 6f6e 746f 7572 7322   data["contours"
-0004c820: 5d5b 7a5d 203d 205b 5d0a 2020 2020 2020  ][z] = [].      
-0004c830: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
-0004c840: 636f 6e74 6f75 7273 225d 5b7a 5d2e 6170  contours"][z].ap
-0004c850: 7065 6e64 286e 702e 6172 7261 7928 706c  pend(np.array(pl
-0004c860: 616e 655f 6461 7461 2929 0a0a 2020 2020  ane_data))..    
-0004c870: 2020 2020 726f 6973 5b6e 756d 6265 725d      rois[number]
-0004c880: 2e75 7064 6174 6528 6461 7461 290a 0a20  .update(data).. 
-0004c890: 2020 2072 6574 7572 6e20 726f 6973 2c20     return rois, 
-0004c8a0: 6473 0a0a 0a64 6566 2067 6574 5f64 6963  ds...def get_dic
-0004c8b0: 6f6d 5f73 6571 7565 6e63 6528 6473 3d4e  om_sequence(ds=N
-0004c8c0: 6f6e 652c 2062 6173 656e 616d 653d 2222  one, basename=""
-0004c8d0: 293a 0a0a 2020 2020 7365 7175 656e 6365  ):..    sequence
-0004c8e0: 203d 205b 5d0a 2020 2020 666f 7220 7375   = [].    for su
-0004c8f0: 6666 6978 2069 6e20 5b22 5365 7175 656e  ffix in ["Sequen
-0004c900: 6365 222c 2022 7322 5d3a 0a20 2020 2020  ce", "s"]:.     
-0004c910: 2020 2061 7474 7269 6275 7465 203d 2066     attribute = f
-0004c920: 227b 6261 7365 6e61 6d65 7d7b 7375 6666  "{basename}{suff
-0004c930: 6978 7d22 0a20 2020 2020 2020 2069 6620  ix}".        if 
-0004c940: 6861 7361 7474 7228 6473 2c20 6174 7472  hasattr(ds, attr
-0004c950: 6962 7574 6529 3a0a 2020 2020 2020 2020  ibute):.        
-0004c960: 2020 2020 7365 7175 656e 6365 203d 2067      sequence = g
-0004c970: 6574 6174 7472 2864 732c 2061 7474 7269  etattr(ds, attri
-0004c980: 6275 7465 290a 2020 2020 2020 2020 2020  bute).          
-0004c990: 2020 6272 6561 6b0a 2020 2020 7265 7475    break.    retu
-0004c9a0: 726e 2073 6571 7565 6e63 650a 0a64 6566  rn sequence..def
-0004c9b0: 2063 6f6e 746f 7572 5f74 6f5f 706f 6c79   contour_to_poly
-0004c9c0: 676f 6e28 636f 6e74 6f75 7229 3a0a 2020  gon(contour):.  
-0004c9d0: 2020 2222 2243 6f6e 7665 7274 2061 206c    """Convert a l
-0004c9e0: 6973 7420 6f66 2063 6f6e 746f 7572 2070  ist of contour p
-0004c9f0: 6f69 6e74 7320 746f 2061 2053 6861 7065  oints to a Shape
-0004ca00: 6c79 2070 6f6c 7967 6f6e 2c20 656e 7375  ly polygon, ensu
-0004ca10: 7269 6e67 2074 6861 7420 0a20 2020 2074  ring that .    t
-0004ca20: 6865 2070 6f6c 7967 6f6e 2069 7320 7661  he polygon is va
-0004ca30: 6c69 642e 2222 220a 0a20 2020 2070 6f6c  lid."""..    pol
-0004ca40: 7967 6f6e 203d 2067 656f 6d65 7472 792e  ygon = geometry.
-0004ca50: 506f 6c79 676f 6e28 636f 6e74 6f75 7229  Polygon(contour)
-0004ca60: 0a0a 2020 2020 6465 6c74 6120 3d20 302e  ..    delta = 0.
-0004ca70: 3030 350a 2020 2020 6966 206e 6f74 2070  005.    if not p
-0004ca80: 6f6c 7967 6f6e 2e69 735f 7661 6c69 643a  olygon.is_valid:
-0004ca90: 0a20 2020 2020 2020 2074 6d70 203d 2067  .        tmp = g
-0004caa0: 656f 6d65 7472 792e 506f 6c79 676f 6e28  eometry.Polygon(
-0004cab0: 706f 6c79 676f 6e29 0a20 2020 2020 2020  polygon).       
-0004cac0: 2062 7566 6665 7220 3d20 302e 0a20 2020   buffer = 0..   
-0004cad0: 2020 2020 2023 2054 6865 2069 6465 6120       # The idea 
-0004cae0: 6865 7265 2069 7320 746f 2069 6e63 7265  here is to incre
-0004caf0: 6173 6520 7468 6520 6275 6666 6572 2064  ase the buffer d
-0004cb00: 6973 7461 6e63 6520 756e 7469 6c0a 2020  istance until.  
-0004cb10: 2020 2020 2020 2320 6120 7661 6c69 6420        # a valid 
-0004cb20: 706f 6c79 676f 6e20 6973 206f 6274 6169  polygon is obtai
-0004cb30: 6e65 642e 2020 5468 6973 2067 656e 6572  ned.  This gener
-0004cb40: 616c 6c79 2073 6565 6d73 2074 6f20 776f  ally seems to wo
-0004cb50: 726b 2e2e 2e0a 2020 2020 2020 2020 7768  rk....        wh
-0004cb60: 696c 6520 2869 7369 6e73 7461 6e63 6528  ile (isinstance(
-0004cb70: 706f 6c79 676f 6e2c 2067 656f 6d65 7472  polygon, geometr
-0004cb80: 792e 4d75 6c74 6950 6f6c 7967 6f6e 290a  y.MultiPolygon).
-0004cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cba0: 6f72 206e 6f74 2070 6f6c 7967 6f6e 2e69  or not polygon.i
-0004cbb0: 735f 7661 6c69 6429 3a0a 2020 2020 2020  s_valid):.      
-0004cbc0: 2020 2020 2020 6275 6666 6572 202b 3d20        buffer += 
-0004cbd0: 6465 6c74 610a 2020 2020 2020 2020 2020  delta.          
-0004cbe0: 2020 706f 6c79 676f 6e20 3d20 746d 702e    polygon = tmp.
-0004cbf0: 6275 6666 6572 2862 7566 6665 7229 0a20  buffer(buffer). 
-0004cc00: 2020 2020 2020 2070 6f69 6e74 7320 3d20         points = 
-0004cc10: 5b5d 0a20 2020 2020 2020 2066 6f72 2078  [].        for x
-0004cc20: 2c20 7920 696e 2070 6f6c 7967 6f6e 2e65  , y in polygon.e
-0004cc30: 7874 6572 696f 722e 636f 6f72 6473 3a0a  xterior.coords:.
-0004cc40: 2020 2020 2020 2020 2020 2020 706f 696e              poin
-0004cc50: 7473 2e61 7070 656e 6428 2878 2c20 7929  ts.append((x, y)
-0004cc60: 290a 2020 2020 2020 2020 706f 6c79 676f  ).        polygo
-0004cc70: 6e20 3d20 6765 6f6d 6574 7279 2e50 6f6c  n = geometry.Pol
-0004cc80: 7967 6f6e 2870 6f69 6e74 7329 0a0a 2020  ygon(points)..  
-0004cc90: 2020 7265 7475 726e 2070 6f6c 7967 6f6e    return polygon
-0004cca0: 0a0a 6465 6620 706f 6c79 676f 6e5f 746f  ..def polygon_to
-0004ccb0: 5f63 6f6e 746f 7572 2870 6f6c 7967 6f6e  _contour(polygon
-0004ccc0: 293a 0a20 2020 2027 2727 0a20 2020 2043  ):.    '''.    C
-0004ccd0: 6f6e 7665 7274 2061 2053 6861 7065 6c79  onvert a Shapely
-0004cce0: 2070 6f6c 7967 6f6e 2074 6f20 6120 6c69   polygon to a li
-0004ccf0: 7374 206f 6620 636f 6e74 6f75 7220 706f  st of contour po
-0004cd00: 696e 7473 2e0a 0a20 2020 202a 2a50 6172  ints...    **Par
-0004cd10: 616d 6574 6572 3a2a 2a0a 0a20 2020 2070  ameter:**..    p
-0004cd20: 6f6c 7967 6f6e 3a20 7368 6170 656c 792e  olygon: shapely.
-0004cd30: 6765 6f6d 6574 7279 2e70 6f6c 7967 6f6e  geometry.polygon
-0004cd40: 0a20 2020 2020 2020 2053 6861 7065 6c79  .        Shapely
-0004cd50: 2070 6f6c 7967 6f6e 2e0a 0a20 2020 207a   polygon...    z
-0004cd60: 5f70 6f6c 7967 6f6e 3a20 7a20 636f 6f72  _polygon: z coor
-0004cd70: 6469 6e61 7465 2061 7420 7768 6963 6820  dinate at which 
-0004cd80: 706f 6c79 676f 6e20 6973 2064 6566 696e  polygon is defin
-0004cd90: 6564 2e0a 2020 2020 2727 270a 2020 2020  ed..    '''.    
-0004cda0: 636f 6e74 6f75 725f 706f 696e 7473 203d  contour_points =
-0004cdb0: 205b 5d0a 2020 2020 666f 7220 782c 2079   [].    for x, y
-0004cdc0: 2069 6e20 6c69 7374 2870 6f6c 7967 6f6e   in list(polygon
-0004cdd0: 2e65 7874 6572 696f 722e 636f 6f72 6473  .exterior.coords
-0004cde0: 293a 0a20 2020 2020 2020 2063 6f6e 746f  ):.        conto
-0004cdf0: 7572 5f70 6f69 6e74 732e 6170 7065 6e64  ur_points.append
-0004ce00: 285b 782c 2079 5d29 0a20 2020 2063 6f6e  ([x, y]).    con
-0004ce10: 746f 7572 203d 206e 702e 6172 7261 7928  tour = np.array(
-0004ce20: 636f 6e74 6f75 725f 706f 696e 7473 290a  contour_points).
-0004ce30: 0a20 2020 2072 6574 7572 6e20 636f 6e74  .    return cont
-0004ce40: 6f75 720a 0a64 6566 2069 6e74 6572 706f  our..def interpo
-0004ce50: 6c61 7465 5f70 6f69 6e74 735f 7369 6e67  late_points_sing
-0004ce60: 6c65 5f63 6f6e 746f 7572 2873 6f75 7263  le_contour(sourc
-0004ce70: 653d 4e6f 6e65 2c20 6e5f 706f 696e 743d  e=None, n_point=
-0004ce80: 4e6f 6e65 2c20 6478 793d 4e6f 6e65 2c0a  None, dxy=None,.
-0004ce90: 2020 2020 2020 2020 736d 6f6f 7468 6e65          smoothne
-0004cea0: 7373 5f70 6572 5f70 6f69 6e74 3d30 293a  ss_per_point=0):
-0004ceb0: 0a20 2020 2027 2727 0a20 2020 2049 6e74  .    '''.    Int
-0004cec0: 6572 706f 6c61 7465 2070 6f69 6e74 7320  erpolate points 
-0004ced0: 666f 7220 6120 7369 6e67 6c65 2063 6f6e  for a single con
-0004cee0: 746f 7572 2e0a 0a20 2020 202a 2a50 6172  tour...    **Par
-0004cef0: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
-0004cf00: 736f 7572 6365 203a 2073 6861 7065 6c79  source : shapely
-0004cf10: 2e70 6f6c 7967 6f6e 2e50 6f6c 7967 6f6e  .polygon.Polygon
-0004cf20: 2f6e 702e 6e64 6172 7261 792f 6c69 7374  /np.ndarray/list
-0004cf30: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0004cf40: 2020 2020 2020 2043 6f6e 746f 7572 2072         Contour r
-0004cf50: 6570 7265 7365 6e74 6174 696f 6e20 6173  epresentation as
-0004cf60: 2065 6974 6865 7220 6120 7368 6170 656c   either a shapel
-0004cf70: 7920 506f 6c79 676f 6e2c 2061 206e 756d  y Polygon, a num
-0004cf80: 7079 0a20 2020 2020 2020 2061 7272 6179  py.        array
-0004cf90: 206f 6620 5b78 2c20 795d 2070 6169 7273   of [x, y] pairs
-0004cfa0: 206f 7220 6120 6c69 7374 206f 6620 5b78   or a list of [x
-0004cfb0: 2c20 795d 2070 6169 7273 2e20 2054 6865  , y] pairs.  The
-0004cfc0: 0a20 2020 2020 2020 2072 6574 7572 6e65  .        returne
-0004cfd0: 6420 636f 6e74 6f75 7220 6861 7320 7468  d contour has th
-0004cfe0: 6520 7361 6d65 2072 6570 7265 7365 6e74  e same represent
-0004cff0: 6174 696f 6e2e 0a0a 2020 2020 6e5f 706f  ation...    n_po
-0004d000: 696e 7420 3a20 696e 742c 2064 6566 6175  int : int, defau
-0004d010: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-0004d020: 4e75 6d62 6572 206f 6620 706f 696e 7473  Number of points
-0004d030: 2074 6f20 6465 6669 6e65 2063 6f6e 746f   to define conto
-0004d040: 7572 2c20 6166 7465 7220 696e 7465 7270  ur, after interp
-0004d050: 6f6c 6174 696f 6e2e 2020 5468 6973 206d  olation.  This m
-0004d060: 7573 740a 2020 2020 2020 2020 6265 2073  ust.        be s
-0004d070: 6574 2074 6f20 4e6f 6e65 2066 6f72 2064  et to None for d
-0004d080: 7879 2074 6f20 6265 2063 6f6e 7369 6465  xy to be conside
-0004d090: 7265 642e 0a0a 2020 2020 6478 7920 3a20  red...    dxy : 
-0004d0a0: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
-0004d0b0: 6f6e 650a 2020 2020 2020 2020 4170 7072  one.        Appr
-0004d0c0: 6f78 696d 6174 6520 6469 7374 616e 6365  oximate distance
-0004d0d0: 2072 6571 7569 7265 6420 6265 7477 6565   required betwee
-0004d0e0: 6e20 636f 6e74 6f75 7220 706f 696e 7473  n contour points
-0004d0f0: 2e20 2054 6869 7320 6973 2074 616b 656e  .  This is taken
-0004d100: 0a20 2020 2020 2020 2069 6e74 6f20 6163  .        into ac
-0004d110: 636f 756e 7420 6f6e 6c79 2069 6620 6e5f  count only if n_
-0004d120: 706f 696e 7420 6973 2073 6574 2074 6f20  point is set to 
-0004d130: 4e6f 6e65 2e20 2046 6f72 2061 2063 6f6e  None.  For a con
-0004d140: 746f 7572 206f 660a 2020 2020 2020 2020  tour of.        
-0004d150: 6c65 6e67 7468 2063 6f6e 746f 7572 5f6c  length contour_l
-0004d160: 656e 6774 682c 2074 6865 206e 756d 6265  ength, the numbe
-0004d170: 7220 6f66 2063 6f6e 746f 7572 2070 6f69  r of contour poi
-0004d180: 6e74 7320 6973 2074 6865 6e20 7461 6b65  nts is then take
-0004d190: 6e0a 2020 2020 2020 2020 746f 2062 6520  n.        to be 
-0004d1a0: 6d61 7828 696e 7428 636f 6e74 6f75 725f  max(int(contour_
-0004d1b0: 6c65 6e67 7468 202f 2064 7879 292c 2033  length / dxy), 3
-0004d1c0: 292e 2020 0a0a 2020 2020 736d 6f6f 7468  ).  ..    smooth
-0004d1d0: 6e65 7373 5f70 6572 5f70 6f69 6e74 203a  ness_per_point :
-0004d1e0: 2066 6c6f 6174 2c20 6465 6661 756c 743d   float, default=
-0004d1f0: 300a 2020 2020 2020 2020 5061 7261 6d65  0.        Parame
-0004d200: 7465 7220 6465 7465 726d 696e 696e 6720  ter determining 
-0004d210: 7468 6520 736d 6f6f 7468 6e65 7373 206f  the smoothness o
-0004d220: 6620 7468 6520 422d 7370 6c69 6e65 2063  f the B-spline c
-0004d230: 7572 7665 2075 7365 640a 2020 2020 2020  urve used.      
-0004d240: 2020 696e 2063 6f6e 746f 7572 2061 7070    in contour app
-0004d250: 726f 7869 6d61 7469 6f6e 2066 6f72 2069  roximation for i
-0004d260: 6e74 6572 706f 6c61 7469 6f6e 2e20 2054  nterpolation.  T
-0004d270: 6865 2070 726f 6475 6374 206f 660a 2020  he product of.  
-0004d280: 2020 2020 2020 736d 6f6f 7468 6e65 7373        smoothness
-0004d290: 5f70 6572 5f70 6f69 6e74 2061 6e64 2074  _per_point and t
-0004d2a0: 6865 206e 756d 6265 7220 6f66 2063 6f6e  he number of con
-0004d2b0: 746f 7572 2070 6f69 6e74 7320 2873 7065  tour points (spe
-0004d2c0: 6369 6669 6564 0a20 2020 2020 2020 2064  cified.        d
-0004d2d0: 6972 6563 746c 7920 7669 6120 6e5f 706f  irectly via n_po
-0004d2e0: 696e 742c 206f 7220 696e 6469 7265 6374  int, or indirect
-0004d2f0: 6c79 2076 6961 2064 7879 2920 636f 7272  ly via dxy) corr
-0004d300: 6573 706f 6e64 7320 746f 2074 6865 0a20  esponds to the. 
-0004d310: 2020 2020 2020 2070 6172 616d 6574 6572         parameter
-0004d320: 2073 206f 6620 7363 6970 792e 696e 7465   s of scipy.inte
-0004d330: 7270 6f6c 6174 652e 7370 6c70 7265 7020  rpolate.splprep 
-0004d340: 2d20 7365 6520 646f 6375 6d65 6e74 6174  - see documentat
-0004d350: 696f 6e20 6174 3a0a 2020 2020 2020 2020  ion at:.        
-0004d360: 0a20 2020 2020 2020 2068 7474 7073 3a2f  .        https:/
-0004d370: 2f73 6369 7079 2e67 6974 6875 622e 696f  /scipy.github.io
-0004d380: 2f64 6576 646f 6373 2f72 6566 6572 656e  /devdocs/referen
-0004d390: 6365 2f67 656e 6572 6174 6564 2f73 6369  ce/generated/sci
-0004d3a0: 7079 2e69 6e74 6572 706f 6c61 7465 2e73  py.interpolate.s
-0004d3b0: 706c 7072 6570 2e68 746d 6c23 7363 6970  plprep.html#scip
-0004d3c0: 792e 696e 7465 7270 6f6c 6174 652e 7370  y.interpolate.sp
-0004d3d0: 6c70 7265 700a 0a20 2020 2020 2020 2041  lprep..        A
-0004d3e0: 2073 6d6f 6f74 686e 6573 735f 7065 725f   smoothness_per_
-0004d3f0: 706f 696e 7420 6f66 2030 2066 6f72 6365  point of 0 force
-0004d400: 7320 7468 6520 422d 7370 6c69 6e65 2074  s the B-spline t
-0004d410: 6f20 7061 7373 2074 6872 6f75 6768 0a20  o pass through. 
-0004d420: 2020 2020 2020 2061 6c6c 206f 6620 7468         all of th
-0004d430: 6520 7072 652d 696e 7465 7270 6f6c 6174  e pre-interpolat
-0004d440: 696f 6e20 636f 6e74 6f75 7220 706f 696e  ion contour poin
-0004d450: 7473 2e0a 2020 2020 2727 270a 0a20 2020  ts..    '''..   
-0004d460: 2023 2045 7874 7261 6374 206c 6973 7420   # Extract list 
-0004d470: 6f66 2063 6f6e 746f 7572 2070 6f69 6e74  of contour point
-0004d480: 7320 6672 6f6d 2073 6f75 7263 652e 0a20  s from source.. 
-0004d490: 2020 2063 6f6e 746f 7572 5f6c 656e 6774     contour_lengt
-0004d4a0: 6820 3d20 4e6f 6e65 0a20 2020 2069 6620  h = None.    if 
-0004d4b0: 6973 696e 7374 616e 6365 2873 6f75 7263  isinstance(sourc
-0004d4c0: 652c 2067 656f 6d65 7472 792e 706f 6c79  e, geometry.poly
-0004d4d0: 676f 6e2e 506f 6c79 676f 6e29 3a0a 2020  gon.Polygon):.  
-0004d4e0: 2020 2020 2020 706f 696e 7473 203d 206c        points = l
-0004d4f0: 6973 7428 706f 6c79 676f 6e5f 746f 5f63  ist(polygon_to_c
-0004d500: 6f6e 746f 7572 2873 6f75 7263 6529 290a  ontour(source)).
-0004d510: 2020 2020 2020 2020 636f 6e74 6f75 725f          contour_
-0004d520: 6c65 6e67 7468 203d 2073 6f75 7263 652e  length = source.
-0004d530: 6c65 6e67 7468 0a20 2020 2065 6c69 6620  length.    elif 
-0004d540: 6973 696e 7374 616e 6365 2873 6f75 7263  isinstance(sourc
-0004d550: 652c 206e 702e 6e64 6172 7261 7929 206f  e, np.ndarray) o
-0004d560: 7220 6973 696e 7374 616e 6365 2873 6f75  r isinstance(sou
-0004d570: 7263 652c 206c 6973 7429 3a0a 2020 2020  rce, list):.    
-0004d580: 2020 2020 706f 696e 7473 203d 206c 6973      points = lis
-0004d590: 7428 736f 7572 6365 290a 2020 2020 656c  t(source).    el
-0004d5a0: 7365 3a0a 2020 2020 2020 2020 706f 696e  se:.        poin
-0004d5b0: 7473 203d 204e 6f6e 650a 0a20 2020 2069  ts = None..    i
-0004d5c0: 6620 706f 696e 7473 2069 7320 4e6f 6e65  f points is None
-0004d5d0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-0004d5e0: 2755 6e72 6563 6f67 6e69 7365 6420 736f  'Unrecognised so
-0004d5f0: 7572 6365 2070 6173 7365 6420 746f 2027  urce passed to '
-0004d600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004d610: 2027 5c27 696e 7465 7270 6f6c 6174 655f   '\'interpolate_
-0004d620: 706f 696e 7473 5f73 696e 676c 655f 636f  points_single_co
-0004d630: 6e74 6f75 7228 295c 2727 290a 2020 2020  ntour()\'').    
-0004d640: 2020 2020 7072 696e 7428 2753 6f75 7263      print('Sourc
-0004d650: 6520 6d75 7374 2062 6520 7368 6170 656c  e must be shapel
-0004d660: 7920 506f 6c79 676f 6e20 6f72 2063 6f6e  y Polygon or con
-0004d670: 746f 7572 2729 0a20 2020 2020 2020 2072  tour').        r
-0004d680: 6574 7572 6e20 4e6f 6e65 0a0a 2020 2020  eturn None..    
-0004d690: 2320 4966 206e 756d 6265 7220 6f66 2063  # If number of c
-0004d6a0: 6f6e 746f 7572 2070 6f69 6e74 7320 6e6f  ontour points no
-0004d6b0: 7420 7061 7373 6564 2064 6972 6563 746c  t passed directl
-0004d6c0: 792c 0a20 2020 2023 2074 7279 2074 6f20  y,.    # try to 
-0004d6d0: 6465 7465 726d 696e 6520 6974 7320 7661  determine its va
-0004d6e0: 6c75 6520 6672 6f6d 2074 6865 2064 6973  lue from the dis
-0004d6f0: 7461 6e63 6520 6265 7477 6565 6e20 636f  tance between co
-0004d700: 6e74 6f75 7220 706f 696e 7473 2e0a 2020  ntour points..  
-0004d710: 2020 6966 206e 5f70 6f69 6e74 2069 7320    if n_point is 
-0004d720: 4e6f 6e65 2061 6e64 2064 7879 3a0a 2020  None and dxy:.  
-0004d730: 2020 2020 2020 6966 2063 6f6e 746f 7572        if contour
-0004d740: 5f6c 656e 6774 6820 6973 204e 6f6e 653a  _length is None:
-0004d750: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-0004d760: 746f 7572 5f6c 656e 6774 6820 3d20 636f  tour_length = co
-0004d770: 6e74 6f75 725f 746f 5f70 6f6c 7967 6f6e  ntour_to_polygon
-0004d780: 2873 6f75 7263 6529 2e6c 656e 6774 680a  (source).length.
-0004d790: 2020 2020 2020 2020 6e5f 706f 696e 7420          n_point 
-0004d7a0: 3d20 6d61 7828 696e 7428 636f 6e74 6f75  = max(int(contou
-0004d7b0: 725f 6c65 6e67 7468 202f 2064 7879 292c  r_length / dxy),
-0004d7c0: 2033 290a 2020 2020 6966 206e 5f70 6f69   3).    if n_poi
-0004d7d0: 6e74 2069 7320 4e6f 6e65 3a0a 2020 2020  nt is None:.    
-0004d7e0: 2020 2020 7072 696e 7428 274e 6f20 696e      print('No in
-0004d7f0: 7465 7270 6f6c 6174 696f 6e20 7065 7266  terpolation perf
-0004d800: 6f72 6d65 6427 290a 2020 2020 2020 2020  ormed').        
-0004d810: 7072 696e 7428 274e 756d 6265 7220 6f66  print('Number of
-0004d820: 2063 6f6e 746f 7572 2070 6f69 6e74 7320   contour points 
-0004d830: 286e 5f70 6f69 6e74 2920 6f72 2064 6973  (n_point) or dis
-0004d840: 7461 6e63 6520 6265 7477 6565 6e20 706f  tance between po
-0004d850: 696e 7473 270a 2020 2020 2020 2020 2020  ints'.          
-0004d860: 2020 2020 2020 276d 7573 7420 6265 2073        'must be s
-0004d870: 7065 6369 6669 6564 2e27 290a 2020 2020  pecified.').    
-0004d880: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-0004d890: 0a20 2020 2023 204d 616b 6520 6c61 7374  .    # Make last
-0004d8a0: 2070 6f69 6e74 2074 6865 2073 616d 6520   point the same 
-0004d8b0: 6173 2074 6865 2066 6972 7374 2c20 746f  as the first, to
-0004d8c0: 2065 6e73 7572 6520 636c 6f73 6564 2063   ensure closed c
-0004d8d0: 7572 7665 2e0a 2020 2020 706f 696e 7473  urve..    points
-0004d8e0: 2e61 7070 656e 6428 706f 696e 7473 5b30  .append(points[0
-0004d8f0: 5d29 0a0a 2020 2020 2320 4469 7363 6172  ])..    # Discar
-0004d900: 6420 706f 696e 7473 2074 6861 7420 6172  d points that ar
-0004d910: 656e 2774 2073 6570 6172 6174 6564 2066  en't separated f
-0004d920: 726f 6d20 7468 6520 7072 6563 6565 6469  rom the preceedi
-0004d930: 6e67 2070 6f69 6e74 0a20 2020 2023 2062  ng point.    # b
-0004d940: 7920 6174 206c 6561 7374 2073 6f6d 6520  y at least some 
-0004d950: 6d69 6e69 6d75 6d20 6469 7374 616e 6365  minimum distance
-0004d960: 2e0a 2020 2020 6478 795f 6d69 6e20 3d20  ..    dxy_min = 
-0004d970: 302e 3030 310a 2020 2020 785f 6c61 7374  0.001.    x_last
-0004d980: 2c20 795f 6c61 7374 203d 2070 6f69 6e74  , y_last = point
-0004d990: 735b 305d 0a20 2020 2078 5f76 616c 7565  s[0].    x_value
-0004d9a0: 732c 2079 5f76 616c 7565 7320 3d20 285b  s, y_values = ([
-0004d9b0: 785f 6c61 7374 5d2c 205b 795f 6c61 7374  x_last], [y_last
-0004d9c0: 5d29 0a20 2020 2066 6f72 2069 2069 6e20  ]).    for i in 
-0004d9d0: 7261 6e67 6528 312c 206c 656e 2870 6f69  range(1, len(poi
-0004d9e0: 6e74 7329 293a 0a20 2020 2020 2020 2078  nts)):.        x
-0004d9f0: 2c20 7920 3d20 706f 696e 7473 5b69 5d0a  , y = points[i].
-0004da00: 2020 2020 2020 2020 6966 2028 6162 7328          if (abs(
-0004da10: 7820 2d20 785f 6c61 7374 2920 3e20 6478  x - x_last) > dx
-0004da20: 795f 6d69 6e29 206f 7220 2861 6273 2879  y_min) or (abs(y
-0004da30: 202d 2079 5f6c 6173 7429 203e 2064 7879   - y_last) > dxy
-0004da40: 5f6d 696e 293a 0a20 2020 2020 2020 2020  _min):.         
-0004da50: 2020 2078 5f76 616c 7565 732e 6170 7065     x_values.appe
-0004da60: 6e64 2870 6f69 6e74 735b 695d 5b30 5d29  nd(points[i][0])
-0004da70: 0a20 2020 2020 2020 2020 2020 2079 5f76  .            y_v
-0004da80: 616c 7565 732e 6170 7065 6e64 2870 6f69  alues.append(poi
-0004da90: 6e74 735b 695d 5b31 5d29 0a20 2020 2020  nts[i][1]).     
-0004daa0: 2020 2078 5f6c 6173 742c 2079 5f6c 6173     x_last, y_las
-0004dab0: 7420 3d20 706f 696e 7473 5b69 5d0a 0a20  t = points[i].. 
-0004dac0: 2020 2078 5f76 616c 7565 7320 3d20 6e70     x_values = np
-0004dad0: 2e61 7272 6179 2878 5f76 616c 7565 7329  .array(x_values)
-0004dae0: 0a20 2020 2079 5f76 616c 7565 7320 3d20  .    y_values = 
-0004daf0: 6e70 2e61 7272 6179 2879 5f76 616c 7565  np.array(y_value
-0004db00: 7329 0a0a 2020 2020 2320 496e 7465 7270  s)..    # Interp
-0004db10: 6f6c 6174 6520 636f 6e74 6f75 7220 706f  olate contour po
-0004db20: 696e 7473 2e0a 2020 2020 736d 6f6f 7468  ints..    smooth
-0004db30: 6e65 7373 203d 2073 6d6f 6f74 686e 6573  ness = smoothnes
-0004db40: 735f 7065 725f 706f 696e 7420 2a20 6c65  s_per_point * le
-0004db50: 6e28 785f 7661 6c75 6573 290a 2020 2020  n(x_values).    
-0004db60: 7472 793a 0a23 2020 2020 2020 2020 7769  try:.#        wi
-0004db70: 7468 2077 6172 6e69 6e67 732e 6361 7463  th warnings.catc
-0004db80: 685f 7761 726e 696e 6773 2829 3a0a 2320  h_warnings():.# 
-0004db90: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0004dba0: 6e67 732e 6669 6c74 6572 7761 726e 696e  ngs.filterwarnin
-0004dbb0: 6773 2822 6967 6e6f 7265 222c 206d 6573  gs("ignore", mes
-0004dbc0: 7361 6765 3d22 5365 7474 696e 6720 7822  sage="Setting x"
-0004dbd0: 290a 2020 2020 2020 2020 2020 2020 7463  ).            tc
-0004dbe0: 6b2c 2075 203d 2069 6e74 6572 706f 6c61  k, u = interpola
-0004dbf0: 7465 2e73 706c 7072 6570 280a 2020 2020  te.splprep(.    
-0004dc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dc10: 5b78 5f76 616c 7565 732c 2079 5f76 616c  [x_values, y_val
-0004dc20: 7565 735d 2c20 733d 736d 6f6f 7468 6e65  ues], s=smoothne
-0004dc30: 7373 2c20 7065 723d 5472 7565 290a 2020  ss, per=True).  
-0004dc40: 2020 6578 6365 7074 2054 7970 6545 7272    except TypeErr
-0004dc50: 6f72 2061 7320 7072 6f62 6c65 6d3a 0a20  or as problem:. 
-0004dc60: 2020 2020 2020 2070 7269 6e74 2822 5741         print("WA
-0004dc70: 524e 494e 473a 2050 726f 626c 656d 2069  RNING: Problem i
-0004dc80: 6e20 696e 7465 7270 6f6c 6174 655f 636f  n interpolate_co
-0004dc90: 6e74 6f75 725f 706f 696e 7473 2829 3a22  ntour_points():"
-0004dca0: 2c20 7072 6f62 6c65 6d29 0a20 2020 2020  , problem).     
-0004dcb0: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
-0004dcc0: 2020 2020 7869 5f76 616c 7565 732c 2079      xi_values, y
-0004dcd0: 695f 7661 6c75 6573 203d 2069 6e74 6572  i_values = inter
-0004dce0: 706f 6c61 7465 2e73 706c 6576 280a 2020  polate.splev(.  
-0004dcf0: 2020 2020 2020 6e70 2e6c 696e 7370 6163        np.linspac
-0004dd00: 6528 302e 2c20 312e 2c20 6e5f 706f 696e  e(0., 1., n_poin
-0004dd10: 7420 2b20 3129 2c20 7463 6b29 0a0a 2020  t + 1), tck)..  
-0004dd20: 2020 2320 5374 6f72 6520 706f 696e 7473    # Store points
-0004dd30: 2069 6e20 6120 666f 726d 2074 6861 7420   in a form that 
-0004dd40: 6d61 7920 6265 2063 6f6e 7665 7274 6564  may be converted
-0004dd50: 2074 6f20 6120 6e75 6d70 7920 6172 7261   to a numpy arra
-0004dd60: 792e 0a20 2020 2070 6f69 6e74 735f 696e  y..    points_in
-0004dd70: 7465 7270 6f6c 6174 6564 203d 206c 6973  terpolated = lis
-0004dd80: 7428 7a69 7028 7869 5f76 616c 7565 732c  t(zip(xi_values,
-0004dd90: 2079 695f 7661 6c75 6573 2929 0a20 2020   yi_values)).   
-0004dda0: 2070 6f69 6e74 735f 696e 7465 7270 6f6c   points_interpol
-0004ddb0: 6174 6564 203d 205b 7879 2066 6f72 2078  ated = [xy for x
-0004ddc0: 7920 696e 2070 6f69 6e74 735f 696e 7465  y in points_inte
-0004ddd0: 7270 6f6c 6174 6564 5d0a 0a20 2020 2023  rpolated]..    #
-0004dde0: 2052 6574 7572 6e20 696e 7465 7270 6f6c   Return interpol
-0004ddf0: 6174 6564 2063 6f6e 746f 7572 2069 6e20  ated contour in 
-0004de00: 7468 6520 7361 6d65 2072 6570 7265 7365  the same represe
-0004de10: 6e74 6174 696f 6e20 6173 2074 6865 2073  ntation as the s
-0004de20: 6f75 7263 652e 0a20 2020 2069 6620 6973  ource..    if is
-0004de30: 696e 7374 616e 6365 2873 6f75 7263 652c  instance(source,
-0004de40: 2067 656f 6d65 7472 792e 706f 6c79 676f   geometry.polygo
-0004de50: 6e2e 506f 6c79 676f 6e29 3a0a 2020 2020  n.Polygon):.    
-0004de60: 2020 2020 6f75 745f 6f62 6a65 6374 203d      out_object =
-0004de70: 2067 656f 6d65 7472 792e 706f 6c79 676f   geometry.polygo
-0004de80: 6e2e 506f 6c79 676f 6e28 706f 696e 7473  n.Polygon(points
-0004de90: 5f69 6e74 6572 706f 6c61 7465 6429 0a20  _interpolated). 
-0004dea0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-0004deb0: 6365 2873 6f75 7263 652c 206e 702e 6e64  ce(source, np.nd
-0004dec0: 6172 7261 7929 3a0a 2020 2020 2020 2020  array):.        
-0004ded0: 6f75 745f 6f62 6a65 6374 203d 206e 702e  out_object = np.
-0004dee0: 6172 7261 7928 706f 696e 7473 5f69 6e74  array(points_int
-0004def0: 6572 706f 6c61 7465 6429 0a20 2020 2065  erpolated).    e
-0004df00: 6c73 653a 0a20 2020 2020 2020 206f 7574  lse:.        out
-0004df10: 5f6f 626a 6563 7420 3d20 706f 696e 7473  _object = points
-0004df20: 5f69 6e74 6572 706f 6c61 7465 640a 0a20  _interpolated.. 
-0004df30: 2020 2072 6574 7572 6e20 6f75 745f 6f62     return out_ob
-0004df40: 6a65 6374 0a0a 6465 6620 7772 6974 655f  ject..def write_
-0004df50: 7374 7275 6374 7572 655f 7365 745f 6469  structure_set_di
-0004df60: 636f 6d28 0a20 2020 206f 7574 6e61 6d65  com(.    outname
-0004df70: 2c20 0a20 2020 2072 6f69 732c 200a 2020  , .    rois, .  
-0004df80: 2020 696d 6167 653d 4e6f 6e65 2c20 0a20    image=None, . 
-0004df90: 2020 2061 6666 696e 653d 4e6f 6e65 2c20     affine=None, 
-0004dfa0: 0a20 2020 2073 6861 7065 3d4e 6f6e 652c  .    shape=None,
-0004dfb0: 0a20 2020 206f 7269 656e 7461 7469 6f6e  .    orientation
-0004dfc0: 3d4e 6f6e 652c 200a 2020 2020 6865 6164  =None, .    head
-0004dfd0: 6572 5f73 6f75 7263 653d 4e6f 6e65 2c20  er_source=None, 
-0004dfe0: 0a20 2020 2070 6174 6965 6e74 5f69 643d  .    patient_id=
-0004dff0: 4e6f 6e65 2c0a 2020 2020 6d6f 6461 6c69  None,.    modali
-0004e000: 7479 3d4e 6f6e 652c 200a 2020 2020 726f  ty=None, .    ro
-0004e010: 6f74 5f75 6964 3d4e 6f6e 650a 293a 0a0a  ot_uid=None.):..
-0004e020: 2020 2020 2320 4368 6563 6b20 7765 2068      # Check we h
-0004e030: 6176 6520 7468 6520 7265 6c65 7661 6e74  ave the relevant
-0004e040: 2069 6e66 6f0a 2020 2020 6966 206e 6f74   info.    if not
-0004e050: 2069 6d61 6765 2061 6e64 2028 6e6f 7420   image and (not 
-0004e060: 6166 6669 6e65 206f 7220 6e6f 7420 7368  affine or not sh
-0004e070: 6170 6529 3a0a 2020 2020 2020 2020 7261  ape):.        ra
-0004e080: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
-0004e090: 2822 4d75 7374 2070 726f 7669 6465 2065  ("Must provide e
-0004e0a0: 6974 6865 7220 616e 2069 6d61 6765 206f  ither an image o
-0004e0b0: 7220 616e 2061 6666 696e 6520 6d61 7472  r an affine matr
-0004e0c0: 6978 2022 0a20 2020 2020 2020 2020 2020  ix ".           
-0004e0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e0e0: 2261 6e64 2073 6861 7065 2122 290a 0a20  "and shape!").. 
-0004e0f0: 2020 2023 2054 7279 2067 6574 7469 6e67     # Try getting
-0004e100: 2064 6963 6f6d 2064 6174 6173 6574 2066   dicom dataset f
-0004e110: 726f 6d20 696d 6167 650a 2020 2020 6473  rom image.    ds
-0004e120: 203d 204e 6f6e 650a 2020 2020 6966 2069   = None.    if i
-0004e130: 6d61 6765 3a0a 2020 2020 2020 2020 6966  mage:.        if
-0004e140: 2068 6173 6174 7472 2869 6d61 6765 2c20   hasattr(image, 
-0004e150: 2264 6963 6f6d 5f64 6174 6173 6574 2229  "dicom_dataset")
-0004e160: 3a0a 2020 2020 2020 2020 2020 2020 6473  :.            ds
-0004e170: 203d 2069 6d61 6765 2e64 6963 6f6d 5f64   = image.dicom_d
-0004e180: 6174 6173 6574 0a20 2020 2020 2020 2065  ataset.        e
-0004e190: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0004e1a0: 2064 7320 3d20 736b 7274 2e69 6d61 6765   ds = skrt.image
-0004e1b0: 2e63 7265 6174 655f 6469 636f 6d28 290a  .create_dicom().
-0004e1c0: 2020 2020 2020 2020 2020 2020 6473 2e73              ds.s
-0004e1d0: 6574 5f67 656f 6d65 7472 7928 0a20 2020  et_geometry(.   
-0004e1e0: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
-0004e1f0: 6765 2e67 6574 5f61 6666 696e 6528 292c  ge.get_affine(),
-0004e200: 2069 6d61 6765 2e67 6574 5f64 6174 6128   image.get_data(
-0004e210: 292e 7368 6170 652c 0a20 2020 2020 2020  ).shape,.       
-0004e220: 2020 2020 2020 2020 2069 6d61 6765 2e67           image.g
-0004e230: 6574 5f6f 7269 656e 7461 7469 6f6e 5f76  et_orientation_v
-0004e240: 6563 746f 7228 696d 6167 652e 6765 745f  ector(image.get_
-0004e250: 6166 6669 6e65 2c20 2264 6963 6f6d 2229  affine, "dicom")
-0004e260: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-0004e270: 2020 2020 2320 4f74 6865 7277 6973 652c      # Otherwise,
-0004e280: 2063 7265 6174 6520 6672 6573 6820 6469   create fresh di
-0004e290: 636f 6d20 6461 7461 7365 740a 2020 2020  com dataset.    
-0004e2a0: 656c 7365 3a0a 2020 2020 2020 2020 6473  else:.        ds
-0004e2b0: 203d 2073 6b72 742e 696d 6167 652e 6372   = skrt.image.cr
-0004e2c0: 6561 7465 5f64 6963 6f6d 2870 6174 6965  eate_dicom(patie
-0004e2d0: 6e74 5f69 642c 206d 6f64 616c 6974 792c  nt_id, modality,
-0004e2e0: 2072 6f6f 745f 7569 6429 0a20 2020 2020   root_uid).     
-0004e2f0: 2020 2064 732e 7365 745f 6765 6f6d 6574     ds.set_geomet
-0004e300: 7279 2861 6666 696e 652c 2073 6861 7065  ry(affine, shape
-0004e310: 2c20 6f72 6965 6e74 6174 696f 6e29 0a0a  , orientation)..
-0004e320: 2020 2020 2320 4164 6a75 7374 2064 6174      # Adjust dat
-0004e330: 6173 6574 2074 6f20 6265 2066 6f72 2053  aset to be for S
-0004e340: 7472 7563 7475 7265 5365 7420 696e 7374  tructureSet inst
-0004e350: 6561 6420 6f66 2069 6d61 6765 0a0a 0a64  ead of image...d
-0004e360: 6566 2064 6963 6f6d 5f64 6174 6173 6574  ef dicom_dataset
-0004e370: 5f74 6f5f 7374 7275 6374 7572 655f 7365  _to_structure_se
-0004e380: 7428 6473 293a 0a20 2020 2027 2727 436f  t(ds):.    '''Co
-0004e390: 6e76 6572 7420 616e 2065 7869 7374 696e  nvert an existin
-0004e3a0: 6720 696d 6167 6520 6469 636f 6d20 6461  g image dicom da
-0004e3b0: 7461 7365 7420 746f 2061 2053 7472 7563  taset to a Struc
-0004e3c0: 7475 7265 5365 7420 6461 7461 7365 742e  tureSet dataset.
-0004e3d0: 2727 270a 0a20 2020 2023 2041 646a 7573  '''..    # Adjus
-0004e3e0: 7420 636c 6173 7320 5549 4473 0a20 2020  t class UIDs.   
-0004e3f0: 2064 732e 6669 6c65 5f6d 6574 612e 496d   ds.file_meta.Im
-0004e400: 706c 656d 656e 7461 7469 6f6e 436c 6173  plementationClas
-0004e410: 7355 4944 203d 2022 392e 392e 392e 3130  sUID = "9.9.9.10
-0004e420: 302e 302e 302e 312e 302e 392e 362e 302e  0.0.0.1.0.9.6.0.
-0004e430: 302e 3122 0a20 2020 2064 732e 6669 6c65  0.1".    ds.file
-0004e440: 5f6d 6574 612e 4d65 6469 6153 746f 7261  _meta.MediaStora
-0004e450: 6765 534f 5043 6c61 7373 5549 4420 3d20  geSOPClassUID = 
-0004e460: 2231 2e32 2e38 3430 2e31 3030 3038 2e35  "1.2.840.10008.5
-0004e470: 2e31 2e34 2e31 2e31 2e34 3831 2e33 220a  .1.4.1.1.481.3".
-0004e480: 0a20 2020 2023 2041 7373 6967 6e20 656d  .    # Assign em
-0004e490: 7074 7920 7365 7175 656e 6365 730a 2020  pty sequences.  
-0004e4a0: 2020 6473 2e52 6566 6572 656e 6365 6446    ds.ReferencedF
-0004e4b0: 7261 6d65 6f66 5265 6665 7265 6e63 6553  rameofReferenceS
-0004e4c0: 6571 7565 6e63 6520 3d20 5365 7175 656e  equence = Sequen
-0004e4d0: 6365 2829 0a20 2020 2064 732e 5374 7275  ce().    ds.Stru
-0004e4e0: 6374 7572 6553 6574 524f 4953 6571 7565  ctureSetROISeque
-0004e4f0: 6e63 6520 3d20 5365 7175 656e 6365 2829  nce = Sequence()
-0004e500: 0a20 2020 2064 732e 5254 524f 494f 6273  .    ds.RTROIObs
-0004e510: 6572 7661 7469 6f6e 7353 6571 7565 6e63  ervationsSequenc
-0004e520: 6520 3d20 5365 7175 656e 6365 2829 0a20  e = Sequence(). 
-0004e530: 2020 2064 732e 524f 4943 6f6e 746f 7572     ds.ROIContour
-0004e540: 5365 7175 656e 6365 203d 2053 6571 7565  Sequence = Seque
-0004e550: 6e63 6528 290a 0a20 2020 2023 2041 7373  nce()..    # Ass
-0004e560: 6967 6e20 7374 7275 6374 7572 6520 7365  ign structure se
-0004e570: 7420 7072 6f70 6572 7469 6573 0a20 2020  t properties.   
-0004e580: 2064 732e 5374 7275 6374 7572 6553 6574   ds.StructureSet
-0004e590: 4c61 6265 6c20 3d20 2222 0a20 2020 2064  Label = "".    d
-0004e5a0: 732e 5374 7275 6374 7572 6553 6574 4461  s.StructureSetDa
-0004e5b0: 7465 203d 2064 732e 496e 7374 616e 6365  te = ds.Instance
-0004e5c0: 4372 6561 7469 6f6e 4461 7465 0a20 2020  CreationDate.   
-0004e5d0: 2064 732e 5374 7275 6374 7572 6553 6574   ds.StructureSet
-0004e5e0: 5469 6d65 203d 2064 732e 496e 7374 616e  Time = ds.Instan
-0004e5f0: 6365 4372 6561 7469 6f6e 5469 6d65 0a0a  ceCreationTime..
-0004e600: 2020 2020 2320 4173 7369 676e 2066 7261      # Assign fra
-0004e610: 6d65 206f 6620 7265 6665 7265 6e63 650a  me of reference.
-0004e620: 0a0a 6465 6620 6372 6561 7465 5f64 756d  ..def create_dum
-0004e630: 6d79 5f69 6d61 6765 280a 2020 2020 6578  my_image(.    ex
-0004e640: 7465 6e74 732c 200a 2020 2020 736c 6963  tents, .    slic
-0004e650: 655f 7468 6963 6b6e 6573 732c 0a20 2020  e_thickness,.   
-0004e660: 2073 6861 7065 3d4e 6f6e 652c 200a 2020   shape=None, .  
-0004e670: 2020 766f 7865 6c5f 7369 7a65 3d4e 6f6e    voxel_size=Non
-0004e680: 652c 0a20 2020 2066 696c 6c5f 7661 6c3d  e,.    fill_val=
-0004e690: 3165 342c 0a20 2020 2062 7566 6665 723d  1e4,.    buffer=
-0004e6a0: 320a 293a 0a20 2020 2022 2222 4d61 6b65  2.):.    """Make
-0004e6b0: 2061 2064 756d 6d79 2069 6d61 6765 2074   a dummy image t
-0004e6c0: 6861 7420 636f 7665 7273 2074 6865 2061  hat covers the a
-0004e6d0: 7265 6120 7370 616e 6e65 6420 6279 203c  rea spanned by <
-0004e6e0: 6578 7465 6e74 733e 2070 6c75 7320 6120  extents> plus a 
-0004e6f0: 0a20 2020 2062 7566 6665 722e 0a0a 2020  .    buffer...  
-0004e700: 2020 2a2a 5061 7261 6d65 7465 7273 3a2a    **Parameters:*
-0004e710: 2a0a 2020 2020 0a20 2020 2065 7874 656e  *.    .    exten
-0004e720: 7473 203a 206c 6973 740a 2020 2020 2020  ts : list.      
-0004e730: 2020 4c69 7374 206f 6620 5b6d 696e 2c20    List of [min, 
-0004e740: 6d61 785d 2065 7874 656e 7473 2069 6e20  max] extents in 
-0004e750: 6d6d 2061 6c6f 6e67 2065 6163 6820 6f66  mm along each of
-0004e760: 2074 6865 2074 6872 6565 2061 7865 7320   the three axes 
-0004e770: 696e 200a 2020 2020 2020 2020 6f72 6465  in .        orde
-0004e780: 7220 5b78 2c20 792c 207a 5d2e 0a0a 2020  r [x, y, z]...  
-0004e790: 2020 736c 6963 655f 7468 6963 6b6e 6573    slice_thicknes
-0004e7a0: 7320 3a20 666c 6f61 740a 2020 2020 2020  s : float.      
-0004e7b0: 2020 536c 6963 6520 7468 6963 6b6e 6573    Slice thicknes
-0004e7c0: 7320 696e 206d 6d2e 0a0a 2020 2020 766f  s in mm...    vo
-0004e7d0: 7865 6c5f 7369 7a65 203a 206c 6973 742c  xel_size : list,
-0004e7e0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0004e7f0: 2020 2020 2020 566f 7865 6c20 7369 7a65        Voxel size
-0004e800: 2069 6e20 6d6d 2069 6e20 7468 6520 6475   in mm in the du
-0004e810: 6d6d 7920 696d 6167 6520 696e 2074 6865  mmy image in the
-0004e820: 2078 2d79 2070 6c61 6e65 2c20 6769 7665   x-y plane, give
-0004e830: 6e20 6173 200a 2020 2020 2020 2020 5b76  n as .        [v
-0004e840: 782c 2076 795d 2e20 4966 203c 7368 6170  x, vy]. If <shap
-0004e850: 653e 2061 6e64 203c 766f 7865 6c5f 7369  e> and <voxel_si
-0004e860: 7a65 3e20 6172 6520 626f 7468 204e 6f6e  ze> are both Non
-0004e870: 652c 2076 6f78 656c 2073 697a 6573 206f  e, voxel sizes o
-0004e880: 660a 2020 2020 2020 2020 5b31 2c20 315d  f.        [1, 1]
-0004e890: 2077 696c 6c20 6265 2075 7365 6420 6279   will be used by
-0004e8a0: 2064 6566 6175 6c74 2e20 5468 6520 766f   default. The vo
-0004e8b0: 7865 6c20 7369 7a65 2069 6e20 7468 6520  xel size in the 
-0004e8c0: 7a20 6469 7265 6374 696f 6e20 0a20 2020  z direction .   
-0004e8d0: 2020 2020 2077 696c 6c20 6265 2074 616b       will be tak
-0004e8e0: 656e 2066 726f 6d20 7468 6520 6d69 6e69  en from the mini
-0004e8f0: 6d75 6d20 6469 7374 616e 6365 2062 6574  mum distance bet
-0004e900: 7765 656e 2073 6c69 6365 2070 6f73 6974  ween slice posit
-0004e910: 696f 6e73 2069 6e20 0a20 2020 2020 2020  ions in .       
-0004e920: 2074 6865 2078 2d79 2063 6f6e 746f 7572   the x-y contour
-0004e930: 7320 6469 6374 696f 6e61 7279 2e0a 0a20  s dictionary... 
-0004e940: 2020 2073 6861 7065 203a 206c 6973 742c     shape : list,
-0004e950: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0004e960: 2020 2020 2020 4e75 6d62 6572 206f 6620        Number of 
-0004e970: 766f 7865 6c73 2069 6e20 7468 6520 6475  voxels in the du
-0004e980: 6d6d 7920 696d 6167 6520 696e 2074 6865  mmy image in the
-0004e990: 2078 2d79 2070 6c61 6e65 2c20 6769 7665   x-y plane, give
-0004e9a0: 6e20 6173 0a20 2020 2020 2020 205b 6e78  n as.        [nx
-0004e9b0: 2c20 6e79 5d2e 204f 6e6c 7920 7573 6564  , ny]. Only used
-0004e9c0: 2069 6620 3c76 6f78 656c 5f73 697a 653e   if <voxel_size>
-0004e9d0: 2069 7320 4e6f 6e65 2e20 0a20 2020 2020   is None. .     
-0004e9e0: 2020 2054 6865 206e 756d 6265 7220 6f66     The number of
-0004e9f0: 2076 6f78 656c 7320 696e 2074 6865 207a   voxels in the z
-0004ea00: 2064 6972 6563 7469 6f6e 2077 696c 6c20   direction will 
-0004ea10: 6265 2074 616b 656e 2066 726f 6d20 7468  be taken from th
-0004ea20: 6520 0a20 2020 2020 2020 206e 756d 6265  e .        numbe
-0004ea30: 7220 6f66 2073 6c69 6365 7320 696e 2074  r of slices in t
-0004ea40: 6865 2078 2d79 2063 6f6e 746f 7572 7320  he x-y contours 
-0004ea50: 6469 6374 696f 6e61 7279 2e0a 0a20 2020  dictionary...   
-0004ea60: 2066 696c 6c5f 7661 6c20 3a20 696e 742f   fill_val : int/
-0004ea70: 666c 6f61 742c 2064 6566 6175 6c74 3d31  float, default=1
-0004ea80: 6534 0a20 2020 2020 2020 2056 616c 7565  e4.        Value
-0004ea90: 2077 6974 6820 7768 6963 6820 7468 6520   with which the 
-0004eaa0: 766f 7865 6c73 2069 6e20 7468 6520 6475  voxels in the du
-0004eab0: 6d6d 7920 696d 6167 6520 7368 6f75 6c64  mmy image should
-0004eac0: 2062 6520 6669 6c6c 6564 2e20 0a0a 2020   be filled. ..  
-0004ead0: 2020 6275 6666 6572 203a 2066 6c6f 6174    buffer : float
-0004eae0: 2c20 6465 6661 756c 743d 320a 2020 2020  , default=2.    
-0004eaf0: 2020 2020 4275 6666 6572 2061 6d6f 756e      Buffer amoun
-0004eb00: 7420 6f66 2077 6869 7465 7370 6163 6520  t of whitespace 
-0004eb10: 696e 206d 6d20 746f 2061 6464 206f 7574  in mm to add out
-0004eb20: 7369 6465 2074 6865 2052 4f49 2069 6e20  side the ROI in 
-0004eb30: 6561 6368 200a 2020 2020 2020 2020 6469  each .        di
-0004eb40: 7265 6374 696f 6e2e 0a20 2020 2022 2222  rection..    """
-0004eb50: 0a0a 2020 2020 2320 4173 7369 676e 2064  ..    # Assign d
-0004eb60: 6566 6175 6c74 2076 6f78 656c 2073 697a  efault voxel siz
-0004eb70: 650a 2020 2020 6966 2073 6861 7065 2069  e.    if shape i
-0004eb80: 7320 4e6f 6e65 2061 6e64 2076 6f78 656c  s None and voxel
-0004eb90: 5f73 697a 6520 6973 204e 6f6e 653a 0a20  _size is None:. 
-0004eba0: 2020 2020 2020 2076 6f78 656c 5f73 697a         voxel_siz
-0004ebb0: 6520 3d20 5b31 2c20 315d 0a20 2020 2069  e = [1, 1].    i
-0004ebc0: 6620 6e6f 7420 736b 7274 2e63 6f72 652e  f not skrt.core.
-0004ebd0: 6973 5f6c 6973 7428 766f 7865 6c5f 7369  is_list(voxel_si
-0004ebe0: 7a65 293a 0a20 2020 2020 2020 2076 6f78  ze):.        vox
-0004ebf0: 656c 5f73 697a 6520 3d20 5b76 6f78 656c  el_size = [voxel
-0004ec00: 5f73 697a 655d 202a 2032 0a0a 2020 2020  _size] * 2..    
-0004ec10: 2320 4361 6c63 756c 6174 6520 766f 7865  # Calculate voxe
-0004ec20: 6c20 7369 7a65 7320 6672 6f6d 2073 6861  l sizes from sha
-0004ec30: 7065 0a20 2020 2069 6620 7368 6170 6520  pe.    if shape 
-0004ec40: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0004ec50: 2020 2020 2073 6861 7065 203d 206c 6973       shape = lis
-0004ec60: 7428 7368 6170 6529 0a20 2020 2020 2020  t(shape).       
-0004ec70: 2069 6620 6c65 6e28 7368 6170 6529 2021   if len(shape) !
-0004ec80: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
-0004ec90: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
-0004eca0: 2822 5368 6170 6520 7368 6f75 6c64 2062  ("Shape should b
-0004ecb0: 6520 6120 6c69 7374 206f 6620 7477 6f20  e a list of two 
-0004ecc0: 7661 6c75 6573 2022 0a20 2020 2020 2020  values ".       
-0004ecd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ece0: 2020 2020 2022 7370 6563 6966 7969 6e67       "specifying
-0004ecf0: 2064 756d 6d79 2069 6d61 6765 2073 6861   dummy image sha
-0004ed00: 7065 2069 6e20 7468 6520 5b78 2c20 795d  pe in the [x, y]
-0004ed10: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0004ed20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0004ed30: 6469 7265 6374 696f 6e73 2e22 290a 0a20  directions.").. 
-0004ed40: 2020 2020 2020 2023 2043 616c 6375 6c61         # Calcula
-0004ed50: 7465 2076 6f78 656c 2073 697a 6520 6966  te voxel size if
-0004ed60: 2052 4f49 2065 7874 656e 7420 706c 7573   ROI extent plus
-0004ed70: 2062 7566 6665 7220 6973 2064 6976 6964   buffer is divid
-0004ed80: 6564 2062 7920 7368 6170 650a 2020 2020  ed by shape.    
-0004ed90: 2020 2020 766f 7865 6c5f 7369 7a65 203d      voxel_size =
-0004eda0: 205b 286d 6178 2865 7829 202d 206d 696e   [(max(ex) - min
-0004edb0: 2865 7829 202b 2032 202a 2062 7566 6665  (ex) + 2 * buffe
-0004edc0: 7229 202f 2073 6861 7065 5b69 5d0a 2020  r) / shape[i].  
-0004edd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ede0: 2020 2020 666f 7220 692c 2065 7820 696e      for i, ex in
-0004edf0: 2065 6e75 6d65 7261 7465 2865 7874 656e   enumerate(exten
-0004ee00: 7473 5b3a 325d 295d 0a0a 2020 2020 2320  ts[:2])]..    # 
-0004ee10: 4f74 6865 7277 6973 652c 2063 616c 6375  Otherwise, calcu
-0004ee20: 6c61 7465 2073 6861 7065 2066 726f 6d20  late shape from 
-0004ee30: 766f 7865 6c20 7369 7a65 730a 2020 2020  voxel sizes.    
-0004ee40: 656c 7365 3a0a 2020 2020 2020 2020 766f  else:.        vo
-0004ee50: 7865 6c5f 7369 7a65 203d 206c 6973 7428  xel_size = list(
-0004ee60: 766f 7865 6c5f 7369 7a65 290a 2020 2020  voxel_size).    
-0004ee70: 2020 2020 0a20 2020 2020 2020 2023 2043      .        # C
-0004ee80: 616c 6375 6c61 7465 206e 756d 6265 7220  alculate number 
-0004ee90: 6f66 2076 6f78 656c 7320 6e65 6564 6564  of voxels needed
-0004eea0: 2074 6f20 636f 7665 7220 524f 4920 706c   to cover ROI pl
-0004eeb0: 7573 2062 7566 6665 7220 6561 6368 2073  us buffer each s
-0004eec0: 6964 650a 2020 2020 2020 2020 7368 6170  ide.        shap
-0004eed0: 6520 3d20 5b28 6e70 2e63 6569 6c28 286d  e = [(np.ceil((m
-0004eee0: 6178 2865 7829 202d 206d 696e 2865 7829  ax(ex) - min(ex)
-0004eef0: 2920 2b20 3220 2a20 6275 6666 6572 2920  ) + 2 * buffer) 
-0004ef00: 2f20 766f 7865 6c5f 7369 7a65 5b69 5d29  / voxel_size[i])
-0004ef10: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0004ef20: 2020 2066 6f72 2069 2c20 6578 2069 6e20     for i, ex in 
-0004ef30: 656e 756d 6572 6174 6528 6578 7465 6e74  enumerate(extent
-0004ef40: 735b 3a32 5d29 5d0a 0a20 2020 2023 2047  s[:2])]..    # G
-0004ef50: 6574 207a 2076 6f78 656c 2073 697a 6520  et z voxel size 
-0004ef60: 616e 6420 7368 6170 650a 2020 2020 766f  and shape.    vo
-0004ef70: 7865 6c5f 7369 7a65 2e61 7070 656e 6428  xel_size.append(
-0004ef80: 736c 6963 655f 7468 6963 6b6e 6573 7329  slice_thickness)
-0004ef90: 0a20 2020 2073 6861 7065 5f7a 203d 2028  .    shape_z = (
-0004efa0: 6d61 7828 6578 7465 6e74 735b 325d 2920  max(extents[2]) 
-0004efb0: 2d20 6d69 6e28 6578 7465 6e74 735b 325d  - min(extents[2]
-0004efc0: 2929 202f 2073 6c69 6365 5f74 6869 636b  )) / slice_thick
-0004efd0: 6e65 7373 0a0a 2020 2020 2320 4164 6420  ness..    # Add 
-0004efe0: 6e65 6172 6573 7420 696e 7465 6765 7220  nearest integer 
-0004eff0: 6e75 6d62 6572 206f 6620 6275 6666 6572  number of buffer
-0004f000: 2076 6f78 656c 730a 2020 2020 6e5f 6275   voxels.    n_bu
-0004f010: 6666 5f7a 203d 206e 702e 6365 696c 2862  ff_z = np.ceil(b
-0004f020: 7566 6665 7220 2f20 736c 6963 655f 7468  uffer / slice_th
-0004f030: 6963 6b6e 6573 7329 0a20 2020 2073 6861  ickness).    sha
-0004f040: 7065 2e61 7070 656e 6428 7368 6170 655f  pe.append(shape_
-0004f050: 7a20 2b20 3220 2a20 6e5f 6275 6666 5f7a  z + 2 * n_buff_z
-0004f060: 290a 2020 2020 7368 6170 6520 3d20 5b69  ).    shape = [i
-0004f070: 6e74 2873 2920 666f 7220 7320 696e 2073  nt(s) for s in s
-0004f080: 6861 7065 5d0a 0a20 2020 2023 2047 6574  hape]..    # Get
-0004f090: 206f 7269 6769 6e20 706f 7369 7469 6f6e   origin position
-0004f0a0: 3b20 656e 7375 7265 2074 6861 7420 6f72  ; ensure that or
-0004f0b0: 6967 696e 2070 6f69 6e74 7320 746f 2063  igin points to c
-0004f0c0: 656e 7472 6520 6f66 2062 7566 6665 7220  entre of buffer 
-0004f0d0: 766f 7865 6c20 0a20 2020 2023 206f 7574  voxel .    # out
-0004f0e0: 7369 6465 2052 4f49 0a20 2020 206f 7269  side ROI.    ori
-0004f0f0: 6769 6e20 3d20 5b6d 696e 2865 7829 202b  gin = [min(ex) +
-0004f100: 2061 6273 2876 6f78 656c 5f73 697a 655b   abs(voxel_size[
-0004f110: 695d 2920 2a20 302e 3520 2d20 6275 6666  i]) * 0.5 - buff
-0004f120: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
-0004f130: 2066 6f72 2069 2c20 6578 2069 6e20 656e   for i, ex in en
-0004f140: 756d 6572 6174 6528 6578 7465 6e74 735b  umerate(extents[
-0004f150: 3a32 5d29 5d0a 2020 2020 6f72 6967 696e  :2])].    origin
-0004f160: 2e61 7070 656e 6428 6d69 6e28 6578 7465  .append(min(exte
-0004f170: 6e74 735b 325d 2920 2d20 6162 7328 736c  nts[2]) - abs(sl
-0004f180: 6963 655f 7468 6963 6b6e 6573 7329 202a  ice_thickness) *
-0004f190: 2028 6e5f 6275 6666 5f7a 202d 2030 2e35   (n_buff_z - 0.5
-0004f1a0: 2929 0a0a 2020 2020 2320 4372 6561 7465  ))..    # Create
-0004f1b0: 2069 6d61 6765 0a20 2020 2072 6574 7572   image.    retur
-0004f1c0: 6e20 736b 7274 2e69 6d61 6765 2e49 6d61  n skrt.image.Ima
-0004f1d0: 6765 280a 2020 2020 2020 2020 6e70 2e6f  ge(.        np.o
-0004f1e0: 6e65 7328 2873 6861 7065 5b31 5d2c 2073  nes((shape[1], s
-0004f1f0: 6861 7065 5b30 5d2c 2073 6861 7065 5b32  hape[0], shape[2
-0004f200: 5d29 2920 2a20 6669 6c6c 5f76 616c 2c0a  ])) * fill_val,.
-0004f210: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
-0004f220: 7a65 3d76 6f78 656c 5f73 697a 652c 0a20  ze=voxel_size,. 
-0004f230: 2020 2020 2020 206f 7269 6769 6e3d 6f72         origin=or
-0004f240: 6967 696e 0a20 2020 2029 0a0a 0a64 6566  igin.    )...def
-0004f250: 2063 7265 6174 655f 7374 6170 6c65 2872   create_staple(r
-0004f260: 6f69 732c 202a 2a6b 7761 7267 7329 3a0a  ois, **kwargs):.
-0004f270: 2020 2020 2222 2243 7265 6174 6520 5354      """Create ST
-0004f280: 4150 4c45 2052 4f49 2066 726f 6d20 6c69  APLE ROI from li
-0004f290: 7374 206f 6620 524f 4973 2e22 2222 0a0a  st of ROIs."""..
-0004f2a0: 2020 2020 2320 5472 7920 696d 706f 7274      # Try import
-0004f2b0: 2053 696d 706c 6549 544b 0a20 2020 2074   SimpleITK.    t
-0004f2c0: 7279 3a0a 2020 2020 2020 2020 696d 706f  ry:.        impo
-0004f2d0: 7274 2053 696d 706c 6549 544b 2061 7320  rt SimpleITK as 
-0004f2e0: 7369 746b 0a20 2020 2065 7863 6570 7420  sitk.    except 
-0004f2f0: 4d6f 6475 6c65 4e6f 7446 6f75 6e64 4572  ModuleNotFoundEr
-0004f300: 726f 723a 0a20 2020 2020 2020 2072 6169  ror:.        rai
-0004f310: 7365 204d 6f64 756c 654e 6f74 466f 756e  se ModuleNotFoun
-0004f320: 6445 7272 6f72 2822 5369 6d70 6c65 4954  dError("SimpleIT
-0004f330: 4b20 6973 2072 6571 7569 7265 6420 746f  K is required to
-0004f340: 2063 616c 6375 6c61 7465 2053 5441 504c   calculate STAPL
-0004f350: 4520 636f 6e74 6f75 722e 2022 0a20 2020  E contour. ".   
-0004f360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f370: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0004f380: 5472 7920 696e 7374 616c 6c69 6e67 2076  Try installing v
-0004f390: 6961 3a20 7069 7020 696e 7374 616c 6c20  ia: pip install 
-0004f3a0: 7369 6d70 6c65 6974 6b22 290a 0a20 2020  simpleitk")..   
-0004f3b0: 2023 2047 6574 2053 5441 504c 4520 6d61   # Get STAPLE ma
-0004f3c0: 736b 0a20 2020 2072 6f69 5f61 7272 6179  sk.    roi_array
-0004f3d0: 7320 3d20 5b5d 0a20 2020 2066 6f72 2072  s = [].    for r
-0004f3e0: 6f69 2069 6e20 726f 6973 3a0a 2020 2020  oi in rois:.    
-0004f3f0: 2020 2020 726f 695f 6172 7261 7973 2e61      roi_arrays.a
-0004f400: 7070 656e 6428 7369 746b 2e47 6574 496d  ppend(sitk.GetIm
-0004f410: 6167 6546 726f 6d41 7272 6179 2872 6f69  ageFromArray(roi
-0004f420: 2e67 6574 5f6d 6173 6b28 0a20 2020 2020  .get_mask(.     
-0004f430: 2020 2020 2020 2073 7461 6e64 6172 6469         standardi
-0004f440: 7365 3d54 7275 6529 2e61 7374 7970 6528  se=True).astype(
-0004f450: 696e 7429 2929 0a20 2020 2070 726f 6273  int))).    probs
-0004f460: 203d 2073 6974 6b2e 4765 7441 7272 6179   = sitk.GetArray
-0004f470: 4672 6f6d 496d 6167 6528 7369 746b 2e53  FromImage(sitk.S
-0004f480: 5441 504c 4528 726f 695f 6172 7261 7973  TAPLE(roi_arrays
-0004f490: 2c20 3129 290a 2020 2020 6d61 736b 203d  , 1)).    mask =
-0004f4a0: 2070 726f 6273 203e 2030 2e39 350a 0a20   probs > 0.95.. 
-0004f4b0: 2020 2023 2043 7265 6174 6520 5354 4150     # Create STAP
-0004f4c0: 4c45 2052 4f49 206f 626a 6563 740a 2020  LE ROI object.  
-0004f4d0: 2020 7265 7475 726e 2052 4f49 286d 6173    return ROI(mas
-0004f4e0: 6b2c 202a 2a6b 7761 7267 7329 0a0a 0a64  k, **kwargs)...d
-0004f4f0: 6566 2063 7265 6174 655f 6d61 6a6f 7269  ef create_majori
-0004f500: 7479 5f76 6f74 6528 726f 6973 2c20 2a2a  ty_vote(rois, **
-0004f510: 6b77 6172 6773 293a 0a20 2020 2022 2222  kwargs):.    """
-0004f520: 4372 6561 7465 206d 616a 6f72 6974 7920  Create majority 
-0004f530: 766f 7465 2052 4f49 2066 726f 6d20 6c69  vote ROI from li
-0004f540: 7374 206f 6620 524f 4973 2e22 2222 0a0a  st of ROIs."""..
-0004f550: 2020 2020 6d61 736b 203d 2072 6f69 735b      mask = rois[
-0004f560: 305d 2e67 6574 5f6d 6173 6b28 7374 616e  0].get_mask(stan
-0004f570: 6461 7264 6973 653d 5472 7565 292e 6173  dardise=True).as
-0004f580: 7479 7065 2869 6e74 290a 2020 2020 666f  type(int).    fo
-0004f590: 7220 726f 6920 696e 2072 6f69 735b 313a  r roi in rois[1:
-0004f5a0: 5d3a 0a20 2020 2020 2020 206d 6173 6b20  ]:.        mask 
-0004f5b0: 2b3d 2072 6f69 2e67 6574 5f6d 6173 6b28  += roi.get_mask(
-0004f5c0: 7374 616e 6461 7264 6973 653d 5472 7565  standardise=True
-0004f5d0: 292e 6173 7479 7065 2869 6e74 290a 2020  ).astype(int).  
-0004f5e0: 2020 6d61 736b 203d 206d 6173 6b20 3e3d    mask = mask >=
-0004f5f0: 206c 656e 2872 6f69 7329 202f 2032 0a20   len(rois) / 2. 
-0004f600: 2020 2072 6574 7572 6e20 524f 4928 6d61     return ROI(ma
-0004f610: 736b 2c20 2a2a 6b77 6172 6773 290a 0a0a  sk, **kwargs)...
-0004f620: 6465 6620 6372 6561 7465 5f72 6f69 5f73  def create_roi_s
-0004f630: 756d 2872 6f69 732c 202a 2a6b 7761 7267  um(rois, **kwarg
-0004f640: 7329 3a0a 2020 2020 2222 2243 7265 6174  s):.    """Creat
-0004f650: 6520 524f 4920 6672 6f6d 2073 756d 206f  e ROI from sum o
-0004f660: 6620 6c69 7374 206f 6620 524f 4973 2e22  f list of ROIs."
-0004f670: 2222 0a0a 2020 2020 6d61 736b 203d 2072  ""..    mask = r
-0004f680: 6f69 735b 305d 2e67 6574 5f6d 6173 6b28  ois[0].get_mask(
-0004f690: 7374 616e 6461 7264 6973 653d 5472 7565  standardise=True
-0004f6a0: 292e 636f 7079 2829 0a20 2020 2066 6f72  ).copy().    for
-0004f6b0: 2072 6f69 2069 6e20 726f 6973 5b31 3a5d   roi in rois[1:]
-0004f6c0: 3a0a 2020 2020 2020 2020 6d61 736b 202b  :.        mask +
-0004f6d0: 3d20 726f 692e 6765 745f 6d61 736b 2873  = roi.get_mask(s
-0004f6e0: 7461 6e64 6172 6469 7365 3d54 7275 6529  tandardise=True)
-0004f6f0: 0a20 2020 2072 6574 7572 6e20 524f 4928  .    return ROI(
-0004f700: 6d61 736b 2c20 2a2a 6b77 6172 6773 290a  mask, **kwargs).
-0004f710: 0a0a 6465 6620 6372 6561 7465 5f72 6f69  ..def create_roi
-0004f720: 5f6f 7665 726c 6170 2872 6f69 732c 202a  _overlap(rois, *
-0004f730: 2a6b 7761 7267 7329 3a0a 2020 2020 2222  *kwargs):.    ""
-0004f740: 2243 7265 6174 6520 524f 4920 6672 6f6d  "Create ROI from
-0004f750: 206f 7665 726c 6170 206f 6620 6c69 7374   overlap of list
-0004f760: 206f 6620 524f 4973 2e22 2222 0a0a 2020   of ROIs."""..  
-0004f770: 2020 6d61 736b 203d 2072 6f69 735b 305d    mask = rois[0]
-0004f780: 2e67 6574 5f6d 6173 6b28 7374 616e 6461  .get_mask(standa
-0004f790: 7264 6973 653d 5472 7565 292e 636f 7079  rdise=True).copy
-0004f7a0: 2829 0a20 2020 2066 6f72 2072 6f69 2069  ().    for roi i
-0004f7b0: 6e20 726f 6973 5b31 3a5d 3a0a 2020 2020  n rois[1:]:.    
-0004f7c0: 2020 2020 6d61 736b 202a 3d20 726f 692e      mask *= roi.
-0004f7d0: 6765 745f 6d61 736b 2873 7461 6e64 6172  get_mask(standar
-0004f7e0: 6469 7365 3d54 7275 6529 0a20 2020 2072  dise=True).    r
-0004f7f0: 6574 7572 6e20 524f 4928 6d61 736b 2c20  eturn ROI(mask, 
-0004f800: 2a2a 6b77 6172 6773 290a 0a0a 6465 6620  **kwargs)...def 
-0004f810: 6466 5f74 6f5f 6874 6d6c 2864 6629 3a0a  df_to_html(df):.
-0004f820: 2020 2020 2222 2243 6f6e 7665 7274 2061      """Convert a
-0004f830: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
-0004f840: 6520 746f 2068 746d 6c2e 2222 220a 0a20  e to html.""".. 
-0004f850: 2020 2023 2043 6f6e 7665 7274 2064 6174     # Convert dat
-0004f860: 6166 7261 6d65 2074 6f20 4854 4d4c 0a20  aframe to HTML. 
-0004f870: 2020 2068 746d 6c20 3d20 6466 2e66 696c     html = df.fil
-0004f880: 6c6e 6128 27e2 8094 2729 2e74 6f5f 6874  lna('...').to_ht
-0004f890: 6d6c 2869 6e64 6578 3d46 616c 7365 290a  ml(index=False).
-0004f8a0: 2020 2020 6874 6d6c 203d 2068 746d 6c2e      html = html.
-0004f8b0: 7265 706c 6163 6528 225e 3322 2c20 223c  replace("^3", "<
-0004f8c0: 7375 703e 333c 2f73 7570 3e22 292e 7265  sup>3</sup>").re
-0004f8d0: 706c 6163 6528 225e 3222 2c20 223c 7375  place("^2", "<su
-0004f8e0: 703e 323c 2f73 7570 3e22 290a 0a20 2020  p>2</sup>")..   
-0004f8f0: 2023 2041 6464 2068 6561 6465 7220 7769   # Add header wi
-0004f900: 7468 2073 7479 6c65 2064 6574 6169 6c73  th style details
-0004f910: 0a20 2020 2068 6561 6465 7220 3d20 2222  .    header = ""
-0004f920: 220a 2020 2020 2020 2020 3c68 6561 643e  ".        <head>
-0004f930: 0a20 2020 2020 2020 2020 2020 203c 7374  .            <st
-0004f940: 796c 653e 0a20 2020 2020 2020 2020 2020  yle>.           
-0004f950: 2020 2020 2074 682c 2074 6420 7b0a 2020       th, td {.  
-0004f960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f970: 2020 7061 6464 696e 673a 2032 7078 2032    padding: 2px 2
-0004f980: 7078 3b0a 2020 2020 2020 2020 2020 2020  px;.            
-0004f990: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-0004f9a0: 2020 2020 2020 7468 207b 0a20 2020 2020        th {.     
-0004f9b0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0004f9c0: 6163 6b67 726f 756e 642d 636f 6c6f 723a  ackground-color:
-0004f9d0: 2074 7261 6e73 7061 7265 6e74 3b0a 2020   transparent;.  
-0004f9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f9f0: 2020 7465 7874 2d61 6c69 676e 3a20 6365    text-align: ce
-0004fa00: 6e74 6572 3b0a 2020 2020 2020 2020 2020  nter;.          
-0004fa10: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0004fa20: 2020 2020 3c2f 7374 796c 653e 0a20 2020      </style>.   
-0004fa30: 2020 2020 203c 2f68 6561 643e 0a20 2020       </head>.   
-0004fa40: 2022 2222 0a20 2020 2074 6162 6c65 5f68   """.    table_h
-0004fa50: 746d 6c20 3d20 280a 2020 2020 2020 2020  tml = (.        
-0004fa60: 2868 6561 6465 7220 2b20 6874 6d6c 290a  (header + html).
-0004fa70: 2020 2020 2020 2020 2e72 6570 6c61 6365          .replace
-0004fa80: 2822 2667 743b 222c 2022 3e22 290a 2020  ("&gt;", ">").  
-0004fa90: 2020 2020 2020 2e72 6570 6c61 6365 2822        .replace("
-0004faa0: 266c 743b 222c 2022 3c22 290a 2020 2020  &lt;", "<").    
-0004fab0: 2020 2020 2e72 6570 6c61 6365 2822 2661      .replace("&a
-0004fac0: 6d70 3b22 2c20 2226 2229 0a20 2020 2029  mp;", "&").    )
-0004fad0: 0a20 2020 2072 6574 7572 6e20 7461 626c  .    return tabl
-0004fae0: 655f 6874 6d6c 0a0a 0a64 6566 2062 6573  e_html...def bes
-0004faf0: 745f 7465 7874 5f63 6f6c 6f72 2872 6564  t_text_color(red
-0004fb00: 2c20 6772 6565 6e2c 2062 6c75 6529 3a0a  , green, blue):.
-0004fb10: 2020 2020 6966 2028 7265 6420 2a20 302e      if (red * 0.
-0004fb20: 3239 3920 2b20 6772 6565 6e20 2a20 302e  299 + green * 0.
-0004fb30: 3538 3720 2b20 626c 7565 202a 2030 2e31  587 + blue * 0.1
-0004fb40: 3134 2920 3e20 3138 363a 0a20 2020 2020  14) > 186:.     
-0004fb50: 2020 2072 6574 7572 6e20 2262 6c61 636b     return "black
-0004fb60: 220a 2020 2020 7265 7475 726e 2022 7768  ".    return "wh
-0004fb70: 6974 6522 0a0a 0a64 6566 2067 6574 5f63  ite"...def get_c
-0004fb80: 6f6c 6f72 6564 5f72 6f69 5f73 7472 696e  olored_roi_strin
-0004fb90: 6728 726f 692c 2067 7265 793d 4661 6c73  g(roi, grey=Fals
-0004fba0: 652c 2063 6f6c 6f72 3d4e 6f6e 6529 3a0a  e, color=None):.
-0004fbb0: 2020 2020 2222 2247 6574 2052 4f49 206e      """Get ROI n
-0004fbc0: 616d 6520 696e 2048 544d 4c20 7769 7468  ame in HTML with
-0004fbd0: 2062 6163 6b67 726f 756e 6420 636f 6c6f   background colo
-0004fbe0: 7220 6672 6f6d 2072 6f69 2e63 6f6c 6f72  r from roi.color
-0004fbf0: 2e20 4966 2067 7265 793d 5472 7565 2c0a  . If grey=True,.
-0004fc00: 2020 2020 7468 6520 6261 636b 6772 6f75      the backgrou
-0004fc10: 6e64 2063 6f6c 6f72 2077 696c 6c20 6265  nd color will be
-0004fc20: 2067 7265 792e 2222 220a 0a20 2020 2069   grey."""..    i
-0004fc30: 6620 636f 6c6f 7220 6973 204e 6f6e 653a  f color is None:
-0004fc40: 0a20 2020 2020 2020 2063 6f6c 6f72 203d  .        color =
-0004fc50: 2072 6f69 2e63 6f6c 6f72 0a20 2020 2069   roi.color.    i
-0004fc60: 6620 6772 6579 3a0a 2020 2020 2020 2020  f grey:.        
-0004fc70: 7265 642c 2067 7265 656e 2c20 626c 7565  red, green, blue
-0004fc80: 203d 2032 3535 2c20 3235 352c 2032 3535   = 255, 255, 255
-0004fc90: 0a20 2020 2020 2020 2072 6564 2c20 6772  .        red, gr
-0004fca0: 6565 6e2c 2062 6c75 6520 3d20 3132 382c  een, blue = 128,
-0004fcb0: 2031 3238 2c20 3132 380a 2020 2020 2020   128, 128.      
-0004fcc0: 2020 7465 7874 5f63 6f6c 203d 2032 3030    text_col = 200
-0004fcd0: 2c20 3230 302c 2032 3030 0a20 2020 2020  , 200, 200.     
-0004fce0: 2020 2023 2041 766f 6964 2073 6574 7469     # Avoid setti
-0004fcf0: 6e67 2063 6f6c 6f75 7220 666f 7220 6772  ng colour for gr
-0004fd00: 6579 6564 206f 7574 2052 4f49 732e 0a20  eyed out ROIs.. 
-0004fd10: 2020 2020 2020 2023 2054 6869 7320 6769         # This gi
-0004fd20: 7665 7320 676f 6f64 2072 6561 6461 6269  ves good readabi
-0004fd30: 6c69 7479 2066 6f72 2062 6f74 6820 6461  lity for both da
-0004fd40: 726b 2061 6e64 206c 6967 6874 2074 6865  rk and light the
-0004fd50: 6d65 732e 0a20 2020 2020 2020 2072 6574  mes..        ret
-0004fd60: 7572 6e20 2827 3c70 3e26 6e62 7370 3b7b  urn ('<p>&nbsp;{
-0004fd70: 7d26 6e62 7370 3b3c 2f70 3e27 292e 666f  }&nbsp;</p>').fo
-0004fd80: 726d 6174 2872 6f69 2e6e 616d 6529 0a20  rmat(roi.name). 
-0004fd90: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0004fda0: 2072 6564 2c20 6772 6565 6e2c 2062 6c75   red, green, blu
-0004fdb0: 6520 3d20 5b63 202a 2032 3535 2066 6f72  e = [c * 255 for
-0004fdc0: 2063 2069 6e20 636f 6c6f 725b 3a33 5d5d   c in color[:3]]
-0004fdd0: 0a20 2020 2020 2020 2074 6578 745f 636f  .        text_co
-0004fde0: 6c20 3d20 6265 7374 5f74 6578 745f 636f  l = best_text_co
-0004fdf0: 6c6f 7228 7265 642c 2067 7265 656e 2c20  lor(red, green, 
-0004fe00: 626c 7565 290a 2020 2020 7265 7475 726e  blue).    return
-0004fe10: 2028 0a20 2020 2020 2020 2027 3c70 2073   (.        '<p s
-0004fe20: 7479 6c65 3d22 6261 636b 6772 6f75 6e64  tyle="background
-0004fe30: 2d63 6f6c 6f72 3a20 7267 6228 7b7d 2c20  -color: rgb({}, 
-0004fe40: 7b7d 2c20 7b7d 293b 2027 0a20 2020 2020  {}, {}); '.     
-0004fe50: 2020 2027 636f 6c6f 723a 207b 7d3b 223e     'color: {};">
-0004fe60: 266e 6273 703b 7b7d 266e 6273 703b 3c2f  &nbsp;{}&nbsp;</
-0004fe70: 703e 270a 2020 2020 292e 666f 726d 6174  p>'.    ).format
-0004fe80: 2872 6564 2c20 6772 6565 6e2c 2062 6c75  (red, green, blu
-0004fe90: 652c 2074 6578 745f 636f 6c2c 2072 6f69  e, text_col, roi
-0004fea0: 2e6e 616d 6529 0a0a 6465 6620 636f 6d70  .name)..def comp
-0004feb0: 6172 655f 726f 695f 7061 6972 7328 0a20  are_roi_pairs(. 
-0004fec0: 2020 2070 6169 7273 2c20 0a20 2020 2068     pairs, .    h
-0004fed0: 746d 6c3d 4661 6c73 652c 0a20 2020 206e  tml=False,.    n
-0004fee0: 616d 655f 6173 5f69 6e64 6578 3d54 7275  ame_as_index=Tru
-0004fef0: 652c 0a20 2020 2067 7265 7965 645f 6f75  e,.    greyed_ou
-0004ff00: 743d 4e6f 6e65 2c0a 2020 2020 636f 6c6f  t=None,.    colo
-0004ff10: 7265 643d 4661 6c73 652c 0a20 2020 2072  red=False,.    r
-0004ff20: 6f69 5f6b 7761 7267 733d 7b7d 2c0a 2020  oi_kwargs={},.  
-0004ff30: 2020 2a2a 6b77 6172 6773 0a29 3a0a 2020    **kwargs.):.  
-0004ff40: 2020 6966 2068 746d 6c3a 0a20 2020 2020    if html:.     
-0004ff50: 2020 206e 616d 655f 6173 5f69 6e64 6578     name_as_index
-0004ff60: 203d 2046 616c 7365 0a20 2020 2069 6620   = False.    if 
-0004ff70: 6772 6579 6564 5f6f 7574 2069 7320 4e6f  greyed_out is No
-0004ff80: 6e65 3a0a 2020 2020 2020 2020 6772 6579  ne:.        grey
-0004ff90: 6564 5f6f 7574 203d 205b 5d0a 2020 2020  ed_out = [].    
-0004ffa0: 6466 7320 3d20 5b5d 0a20 2020 2066 6f72  dfs = [].    for
-0004ffb0: 2072 6f69 312c 2072 6f69 3220 696e 2070   roi1, roi2 in p
-0004ffc0: 6169 7273 3a0a 0a20 2020 2020 2020 2023  airs:..        #
-0004ffd0: 2047 6574 2044 6174 6146 7261 6d65 2066   Get DataFrame f
-0004ffe0: 6f72 2074 6869 7320 7061 6972 0a20 2020  or this pair.   
-0004fff0: 2020 2020 2064 665f 726f 7720 3d20 726f       df_row = ro
-00050000: 6931 2e67 6574 5f63 6f6d 7061 7269 736f  i1.get_compariso
-00050010: 6e28 726f 6932 2c20 6e61 6d65 5f61 735f  n(roi2, name_as_
-00050020: 696e 6465 783d 6e61 6d65 5f61 735f 696e  index=name_as_in
-00050030: 6465 782c 0a20 2020 2020 2020 2020 2020  dex,.           
-00050040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050050: 2020 2020 2020 2020 2020 2a2a 6b77 6172            **kwar
-00050060: 6773 290a 0a20 2020 2020 2020 2023 2052  gs)..        # R
-00050070: 6570 6c61 6365 2076 616c 7565 7320 7769  eplace values wi
-00050080: 7468 2022 2d2d 2220 6966 2065 6974 6865  th "--" if eithe
-00050090: 7220 524f 4920 6973 2067 7265 7965 6420  r ROI is greyed 
-000500a0: 6f75 740a 2020 2020 2020 2020 6772 6579  out.        grey
-000500b0: 203d 2072 6f69 3120 696e 2067 7265 7965   = roi1 in greye
-000500c0: 645f 6f75 7420 6f72 2072 6f69 3220 696e  d_out or roi2 in
-000500d0: 2067 7265 7965 645f 6f75 740a 2020 2020   greyed_out.    
-000500e0: 2020 2020 6966 2067 7265 793a 0a20 2020      if grey:.   
-000500f0: 2020 2020 2020 2020 2066 6f72 2063 6f6c           for col
-00050100: 2069 6e20 6466 5f72 6f77 2e63 6f6c 756d   in df_row.colum
-00050110: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-00050120: 2020 2020 6966 2063 6f6c 203d 3d20 2252      if col == "R
-00050130: 4f49 223a 200a 2020 2020 2020 2020 2020  OI": .          
-00050140: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00050150: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00050160: 2020 2064 665f 726f 775b 636f 6c5d 203d     df_row[col] =
-00050170: 2022 2d2d 220a 0a20 2020 2020 2020 2023   "--"..        #
-00050180: 2041 646a 7573 7420 636f 6d70 6172 6973   Adjust comparis
-00050190: 6f6e 206e 616d 650a 2020 2020 2020 2020  on name.        
-000501a0: 636f 6d70 5f6e 616d 6520 3d20 726f 6931  comp_name = roi1
-000501b0: 2e67 6574 5f63 6f6d 7061 7269 736f 6e5f  .get_comparison_
-000501c0: 6e61 6d65 2872 6f69 322c 2063 6f6c 6f72  name(roi2, color
-000501d0: 6564 3d63 6f6c 6f72 6564 2c20 6772 6579  ed=colored, grey
-000501e0: 3d67 7265 792c 0a20 2020 2020 2020 2020  =grey,.         
-000501f0: 2020 2020 2020 2072 6f69 5f6b 7761 7267         roi_kwarg
-00050200: 733d 726f 695f 6b77 6172 6773 290a 2020  s=roi_kwargs).  
-00050210: 2020 2020 2020 6966 206e 616d 655f 6173        if name_as
-00050220: 5f69 6e64 6578 3a0a 2020 2020 2020 2020  _index:.        
-00050230: 2020 2020 6466 5f72 6f77 2e72 656e 616d      df_row.renam
-00050240: 6528 7b64 665f 726f 772e 696e 6465 785b  e({df_row.index[
-00050250: 305d 3a20 636f 6d70 5f6e 616d 657d 2c20  0]: comp_name}, 
-00050260: 696e 706c 6163 653d 5472 7565 290a 2020  inplace=True).  
-00050270: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00050280: 2020 2020 2020 2020 6466 5f72 6f77 2e69          df_row.i
-00050290: 6c6f 635b 302c 2030 5d20 3d20 636f 6d70  loc[0, 0] = comp
-000502a0: 5f6e 616d 650a 0a20 2020 2020 2020 2064  _name..        d
-000502b0: 6673 2e61 7070 656e 6428 6466 5f72 6f77  fs.append(df_row
-000502c0: 290a 0a20 2020 2069 676e 6f72 655f 696e  )..    ignore_in
-000502d0: 6465 7820 3d20 4661 6c73 6520 6966 206e  dex = False if n
-000502e0: 616d 655f 6173 5f69 6e64 6578 2065 6c73  ame_as_index els
-000502f0: 6520 5472 7565 0a20 2020 2064 6620 3d20  e True.    df = 
-00050300: 7064 2e63 6f6e 6361 7428 6466 732c 2069  pd.concat(dfs, i
-00050310: 676e 6f72 655f 696e 6465 783d 6967 6e6f  gnore_index=igno
-00050320: 7265 5f69 6e64 6578 2920 6966 2064 6673  re_index) if dfs
-00050330: 2065 6c73 6520 4e6f 6e65 0a20 2020 2069   else None.    i
-00050340: 6620 6874 6d6c 3a0a 2020 2020 2020 2020  f html:.        
-00050350: 7265 7475 726e 2064 665f 746f 5f68 746d  return df_to_htm
-00050360: 6c28 6466 290a 2020 2020 7265 7475 726e  l(df).    return
-00050370: 2064 660a 0a64 6566 2067 6574 5f63 6f6e   df..def get_con
-00050380: 666f 726d 6974 795f 696e 6465 7828 0a20  formity_index(. 
-00050390: 2020 2072 6f69 732c 0a20 2020 2063 695f     rois,.    ci_
-000503a0: 7479 7065 3d22 6765 6e22 2c0a 2020 2020  type="gen",.    
-000503b0: 7369 6e67 6c65 5f73 6c69 6365 3d46 616c  single_slice=Fal
-000503c0: 7365 2c0a 2020 2020 7669 6577 3d22 782d  se,.    view="x-
-000503d0: 7922 2c20 0a20 2020 2073 6c3d 4e6f 6e65  y", .    sl=None
-000503e0: 2c20 0a20 2020 2069 6478 3d4e 6f6e 652c  , .    idx=None,
-000503f0: 200a 2020 2020 706f 733d 4e6f 6e65 2c20   .    pos=None, 
-00050400: 0a20 2020 206d 6574 686f 643d 4e6f 6e65  .    method=None
-00050410: 2c0a 2020 2020 666c 6174 7465 6e3d 4661  ,.    flatten=Fa
-00050420: 6c73 652c 0a20 2020 2029 3a0a 2020 2020  lse,.    ):.    
-00050430: 2222 220a 2020 2020 4765 7420 636f 6e66  """.    Get conf
-00050440: 6f72 6d69 7479 2069 6e64 6578 2066 6f72  ormity index for
-00050450: 2074 776f 206f 7220 6d6f 7265 2052 4f49   two or more ROI
-00050460: 732e 0a0a 2020 2020 5468 6520 636f 6e66  s...    The conf
-00050470: 6f72 6d69 7479 2069 6e64 6578 206d 6179  ormity index may
-00050480: 2062 6520 6361 6c63 756c 6174 6564 2067   be calculated g
-00050490: 6c6f 6261 6c6c 7920 6f72 2066 6f72 2061  lobally or for a
-000504a0: 2073 696e 676c 6520 736c 6963 652e 0a0a   single slice...
-000504b0: 2020 2020 5468 6973 2066 756e 6374 696f      This functio
-000504c0: 6e20 7265 7475 726e 7320 6569 7468 6572  n returns either
-000504d0: 2074 6865 2076 616c 7565 206f 6620 6f6e   the value of on
-000504e0: 6520 6f66 2074 6865 2074 6872 6565 2074  e of the three t
-000504f0: 7970 6573 0a20 2020 206f 6620 636f 6e66  ypes.    of conf
-00050500: 6f72 6d69 7479 2069 6e64 6578 2028 2267  ormity index ("g
-00050510: 656e 2220 2866 6f72 2067 656e 6572 616c  en" (for general
-00050520: 6973 6564 292c 2022 7061 6972 7322 2c20  ised), "pairs", 
-00050530: 2263 6f6d 6d6f 6e22 290a 2020 2020 7265  "common").    re
-00050540: 6665 7272 6564 2074 6f20 696e 3a0a 2020  ferred to in:.  
-00050550: 2020 6874 7470 733a 2f2f 646f 692e 6f72    https://doi.or
-00050560: 672f 3130 2e31 3038 382f 3030 3331 2d39  g/10.1088/0031-9
-00050570: 3135 352f 3534 2f39 2f30 3138 0a20 2020  155/54/9/018.   
-00050580: 206f 7220 6120 736b 7274 2e63 6f72 652e   or a skrt.core.
-00050590: 4461 7461 206f 626a 6563 7420 7769 7468  Data object with
-000505a0: 2074 6865 2076 616c 7565 7320 6f66 2061   the values of a
-000505b0: 6c6c 2074 6872 6565 2e0a 2020 2020 466f  ll three..    Fo
-000505c0: 7220 7468 6520 6361 7365 206f 6620 7477  r the case of tw
-000505d0: 6f20 524f 4973 2c20 7468 6520 7468 7265  o ROIs, the thre
-000505e0: 6520 6d65 7472 6963 7320 6172 6520 616c  e metrics are al
-000505f0: 6c20 6571 7569 7661 6c65 6e74 0a20 2020  l equivalent.   
-00050600: 2074 6f20 7468 6520 4a61 6363 6172 6420   to the Jaccard 
-00050610: 636f 6e66 6f72 6d69 7479 2069 6e64 6578  conformity index
-00050620: 2e0a 0a20 2020 202a 2a50 6172 616d 6574  ...    **Paramet
-00050630: 6572 733a 2a2a 0a20 2020 2020 2020 200a  ers:**.        .
-00050640: 2020 2020 726f 6973 203a 206c 6973 740a      rois : list.
-00050650: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
-00050660: 7477 6f20 6f72 206d 6f72 6520 736b 7274  two or more skrt
-00050670: 2e73 7472 7563 7475 7265 732e 524f 4920  .structures.ROI 
-00050680: 6f62 6a65 6374 7320 666f 7220 7768 6963  objects for whic
-00050690: 6820 636f 6e66 6f72 6d69 7479 0a20 2020  h conformity.   
-000506a0: 2020 2020 2069 6e64 6578 2069 7320 746f       index is to
-000506b0: 2062 6520 6361 6c63 756c 6174 6564 2e0a   be calculated..
-000506c0: 0a20 2020 2063 695f 7479 7065 3a20 7374  .    ci_type: st
-000506d0: 722c 2064 6566 6175 6c74 3d22 6765 6e22  r, default="gen"
-000506e0: 0a20 2020 2020 2020 2054 7970 6520 6f66  .        Type of
-000506f0: 2063 6f6e 666f 726d 6974 7920 696e 6465   conformity inde
-00050700: 7820 746f 2062 6520 7265 7475 726e 6564  x to be returned
-00050710: 2c20 6672 6f6d 2022 6765 6e22 2028 666f  , from "gen" (fo
-00050720: 7220 6765 6e65 7261 6c69 7365 6429 2c0a  r generalised),.
-00050730: 2020 2020 2020 2020 2270 6169 7273 222c          "pairs",
-00050740: 2022 636f 6d6d 6f6e 222e 2020 4966 2073   "common".  If s
-00050750: 6574 2074 6f20 2261 6c6c 222c 2061 2073  et to "all", a s
-00050760: 6b72 742e 636f 7265 2e44 6174 6120 6f62  krt.core.Data ob
-00050770: 6a65 6374 2077 6974 680a 2020 2020 2020  ject with.      
-00050780: 2020 7661 6c75 6573 2066 6f72 2074 6865    values for the
-00050790: 2074 6872 6565 2074 7970 6573 206f 6620   three types of 
-000507a0: 636f 6e66 6f72 6d69 7479 2069 6e64 6578  conformity index
-000507b0: 2069 7320 7265 7475 726e 6564 2e0a 0a20   is returned... 
-000507c0: 2020 2073 696e 676c 655f 736c 6963 6520     single_slice 
-000507d0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-000507e0: 4661 6c73 650a 2020 2020 2020 2020 4966  False.        If
-000507f0: 2046 616c 7365 2c20 7468 6520 676c 6f62   False, the glob
-00050800: 616c 2033 4420 4469 6365 2073 636f 7265  al 3D Dice score
-00050810: 206f 6620 7468 6520 6675 6c6c 2052 4f49   of the full ROI
-00050820: 7320 7769 6c6c 2062 6520 7265 7475 726e  s will be return
-00050830: 6564 3b0a 2020 2020 2020 2020 6f74 6865  ed;.        othe
-00050840: 7277 6973 652c 2074 6865 2032 4420 4469  rwise, the 2D Di
-00050850: 6365 2073 636f 7265 206f 6e20 6120 7369  ce score on a si
-00050860: 6e67 6c65 2073 6c69 6365 2077 696c 6c20  ngle slice will 
-00050870: 6265 2072 6574 7572 6e65 642e 0a0a 2020  be returned...  
-00050880: 2020 7669 6577 203a 2073 7472 2c20 6465    view : str, de
-00050890: 6661 756c 743d 2278 2d79 220a 2020 2020  fault="x-y".    
-000508a0: 2020 2020 4f72 6965 6e74 6174 696f 6e20      Orientation 
-000508b0: 6f66 2073 6c69 6365 206f 6e20 7768 6963  of slice on whic
-000508c0: 6820 746f 2067 6574 2044 6963 6520 7363  h to get Dice sc
-000508d0: 6f72 652e 204f 6e6c 7920 7573 6564 2069  ore. Only used i
-000508e0: 6620 0a20 2020 2020 2020 2073 696e 676c  f .        singl
-000508f0: 655f 736c 6963 653d 5472 7565 2e20 4966  e_slice=True. If
-00050900: 2075 7369 6e67 2c20 3c61 783e 206d 7573   using, <ax> mus
-00050910: 7420 6265 2061 6e20 6178 6973 2074 6861  t be an axis tha
-00050920: 7420 6c69 6573 2061 6c6f 6e67 0a20 2020  t lies along.   
-00050930: 2020 2020 2074 6865 2073 6c69 6365 2069       the slice i
-00050940: 6e20 7468 6973 206f 7269 656e 7461 7469  n this orientati
-00050950: 6f6e 2e0a 0a20 2020 2073 6c20 3a20 696e  on...    sl : in
-00050960: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-00050970: 2020 2020 2020 2020 536c 6963 6520 6e75          Slice nu
-00050980: 6d62 6572 2e20 4966 206e 6f6e 6520 6f66  mber. If none of
-00050990: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
-000509a0: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
-000509b0: 6564 2062 7574 0a20 2020 2020 2020 203c  ed but.        <
-000509c0: 7369 6e67 6c65 5f73 6c69 6365 3e20 6973  single_slice> is
-000509d0: 2054 7275 652c 2074 6865 2063 656e 7472   True, the centr
-000509e0: 616c 2073 6c69 6365 206f 6620 7468 6973  al slice of this
-000509f0: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
-00050a00: 642e 0a0a 2020 2020 6964 7820 3a20 696e  d...    idx : in
-00050a10: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-00050a20: 2020 2020 2020 2020 4172 7261 7920 696e          Array in
-00050a30: 6465 7820 6f66 2073 6c69 6365 2e20 4966  dex of slice. If
-00050a40: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
-00050a50: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
-00050a60: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
-00050a70: 2020 2020 2020 203c 7369 6e67 6c65 5f73         <single_s
-00050a80: 6c69 6365 3e20 6973 2054 7275 652c 2074  lice> is True, t
-00050a90: 6865 2063 656e 7472 616c 2073 6c69 6365  he central slice
-00050aa0: 206f 6620 7468 6973 2052 4f49 2077 696c   of this ROI wil
-00050ab0: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
-00050ac0: 706f 7320 3a20 666c 6f61 742c 2064 6566  pos : float, def
-00050ad0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00050ae0: 2020 536c 6963 6520 706f 7369 7469 6f6e    Slice position
-00050af0: 2069 6e20 6d6d 2e20 4966 206e 6f6e 6520   in mm. If none 
-00050b00: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
-00050b10: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
-00050b20: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
-00050b30: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
-00050b40: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
-00050b50: 7472 616c 2073 6c69 6365 206f 6620 7468  tral slice of th
-00050b60: 6973 2052 4f49 2077 696c 6c20 6265 2075  is ROI will be u
-00050b70: 7365 642e 0a0a 2020 2020 6d65 7468 6f64  sed...    method
-00050b80: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
-00050b90: 4e6f 6e65 0a20 2020 2020 2020 204d 6574  None.        Met
-00050ba0: 686f 6420 746f 2075 7365 2066 6f72 2044  hod to use for D
-00050bb0: 6963 6520 7363 6f72 6520 6361 6c63 756c  ice score calcul
-00050bc0: 6174 696f 6e2e 2043 616e 2062 653a 200a  ation. Can be: .
-00050bd0: 2020 2020 2020 2020 2d20 2263 6f6e 746f          - "conto
-00050be0: 7572 223a 2067 6574 2069 6e74 6572 7365  ur": get interse
-00050bf0: 6374 696f 6e73 2061 6e64 2061 7265 6173  ctions and areas
-00050c00: 206f 6620 7368 6170 656c 7920 636f 6e74   of shapely cont
-00050c10: 6f75 7273 2e0a 2020 2020 2020 2020 2d20  ours..        - 
-00050c20: 226d 6173 6b22 3a20 636f 756e 7420 696e  "mask": count in
-00050c30: 7465 7273 6563 7469 6e67 2076 6f78 656c  tersecting voxel
-00050c40: 7320 696e 2062 696e 6172 7920 6d61 736b  s in binary mask
-00050c50: 732e 0a20 2020 2020 2020 202d 204e 6f6e  s..        - Non
-00050c60: 653a 2075 7365 2074 6865 206d 6574 686f  e: use the metho
-00050c70: 6420 7365 7420 696e 2073 656c 662e 6465  d set in self.de
-00050c80: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
-00050c90: 642e 0a20 2020 2020 2020 2046 6f72 206d  d..        For m
-00050ca0: 6f72 6520 7468 616e 2074 776f 2052 4f49  ore than two ROI
-00050cb0: 7320 616e 6420 3c63 695f 7479 7065 3e20  s and <ci_type> 
-00050cc0: 2263 6f6d 6d6f 6e22 2c20 6f6e 6c79 2074  "common", only t
-00050cd0: 6865 2022 6d61 736b 220a 2020 2020 2020  he "mask".      
-00050ce0: 2020 6d65 7468 6f64 2069 7320 696d 706c    method is impl
-00050cf0: 656d 656e 7465 642e 0a0a 2020 2020 666c  emented...    fl
-00050d00: 6174 7465 6e20 3a20 626f 6f6c 2c20 6465  atten : bool, de
-00050d10: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-00050d20: 2020 2020 4966 2054 7275 652c 2061 6c6c      If True, all
-00050d30: 2073 6c69 6365 7320 7769 6c6c 2062 6520   slices will be 
-00050d40: 666c 6174 7465 6e65 6420 696e 2074 6865  flattened in the
-00050d50: 2067 6976 656e 206f 7269 656e 7461 7469   given orientati
-00050d60: 6f6e 2061 6e64 0a20 2020 2020 2020 2074  on and.        t
-00050d70: 6865 2044 6963 6520 7363 6f72 6520 6f66  he Dice score of
-00050d80: 2074 6865 2066 6c61 7474 656e 6564 2073   the flattened s
-00050d90: 6c69 6365 7320 7769 6c6c 2062 6520 7265  lices will be re
-00050da0: 7475 726e 6564 2e20 4f6e 6c79 200a 2020  turned. Only .  
-00050db0: 2020 2020 2020 6176 6169 6c61 626c 6520        available 
-00050dc0: 6966 206d 6574 686f 643d 226d 6173 6b22  if method="mask"
-00050dd0: 2e0a 2020 2020 2222 220a 0a20 2020 2023  ..    """..    #
-00050de0: 2052 6571 7569 7265 2076 616c 6964 2069   Require valid i
-00050df0: 6e70 7574 732e 0a20 2020 2069 6620 6c65  nputs..    if le
-00050e00: 6e28 726f 6973 2920 3c20 3220 6f72 2063  n(rois) < 2 or c
-00050e10: 695f 7479 7065 206e 6f74 2069 6e20 5b22  i_type not in ["
-00050e20: 636f 6d6d 6f6e 222c 2022 6765 6e22 2c20  common", "gen", 
-00050e30: 2270 6169 7273 222c 2022 616c 6c22 5d3a  "pairs", "all"]:
-00050e40: 0a20 2020 2020 2020 2072 6574 7572 6e0a  .        return.
-00050e50: 0a20 2020 2023 2049 6e69 7469 616c 6973  .    # Initialis
-00050e60: 6520 4461 7461 206f 626a 6563 7420 666f  e Data object fo
-00050e70: 7220 636f 6e66 6f72 6d69 7479 2069 6e64  r conformity ind
-00050e80: 6963 6573 2e0a 2020 2020 6369 203d 2073  ices..    ci = s
-00050e90: 6b72 742e 636f 7265 2e44 6174 6128 7b22  krt.core.Data({"
-00050ea0: 636f 6d6d 6f6e 223a 2030 2c20 2267 656e  common": 0, "gen
-00050eb0: 223a 302c 2022 7061 6972 7322 3a30 7d29  ":0, "pairs":0})
-00050ec0: 0a0a 2020 2020 2320 4465 616c 2077 6974  ..    # Deal wit
-00050ed0: 6820 6361 7365 7320 2267 656e 2220 616e  h cases "gen" an
-00050ee0: 6420 2270 6169 7273 222e 0a20 2020 2023  d "pairs"..    #
-00050ef0: 0a20 2020 2023 2046 6f72 2022 6765 6e22  .    # For "gen"
-00050f00: 2c20 7468 6520 636f 6e66 6f72 6d69 7479  , the conformity
-00050f10: 2069 6e64 6578 2069 7320 6361 6c63 756c   index is calcul
-00050f20: 6174 6564 2061 7320 7468 6520 7261 7469  ated as the rati
-00050f30: 6f20 6f66 0a20 2020 2023 2028 3129 2074  o of.    # (1) t
-00050f40: 6865 2073 756d 206f 6620 7468 6520 696e  he sum of the in
-00050f50: 7465 7273 6563 7469 6f6e 7320 666f 7220  tersections for 
-00050f60: 616c 6c20 7061 6972 7320 746f 2028 3229  all pairs to (2)
-00050f70: 2074 6865 2073 756d 206f 660a 2020 2020   the sum of.    
-00050f80: 2320 7468 6520 756e 696f 6e73 2066 6f72  # the unions for
-00050f90: 2061 6c6c 2070 6169 7273 2e0a 2020 2020   all pairs..    
-00050fa0: 230a 2020 2020 2320 466f 7220 2270 6169  #.    # For "pai
-00050fb0: 7273 2c20 7468 6520 636f 6e66 6f72 6d69  rs, the conformi
-00050fc0: 7479 2069 6e64 6578 2069 7320 6361 6c63  ty index is calc
-00050fd0: 7561 6c74 6564 2061 7320 7468 6520 6d65  ualted as the me
-00050fe0: 616e 206f 6620 7468 650a 2020 2020 2320  an of the.    # 
-00050ff0: 4a61 6363 6172 6420 636f 6e66 6f72 6d69  Jaccard conformi
-00051000: 7479 2069 6e64 6963 6573 2066 6f72 2061  ty indices for a
-00051010: 6c6c 2070 6169 7273 2e0a 0a20 2020 206e  ll pairs...    n
-00051020: 756d 6572 6174 6f72 203d 2030 0a20 2020  umerator = 0.   
-00051030: 2064 656e 6f6d 696e 6174 6f72 203d 2030   denominator = 0
-00051040: 0a20 2020 206e 5f70 6169 7220 3d20 300a  .    n_pair = 0.
-00051050: 2020 2020 666f 7220 6964 7831 2069 6e20      for idx1 in 
-00051060: 7261 6e67 6528 6c65 6e28 726f 6973 2920  range(len(rois) 
-00051070: 2d20 3129 3a0a 2020 2020 2020 2020 666f  - 1):.        fo
-00051080: 7220 6964 7832 2069 6e20 7261 6e67 6528  r idx2 in range(
-00051090: 6964 7831 202b 2031 2c20 6c65 6e28 726f  idx1 + 1, len(ro
-000510a0: 6973 2929 3a0a 2020 2020 2020 2020 2020  is)):.          
-000510b0: 2020 726f 6931 203d 2072 6f69 735b 6964    roi1 = rois[id
-000510c0: 7831 5d0a 2020 2020 2020 2020 2020 2020  x1].            
-000510d0: 726f 6932 203d 2072 6f69 735b 6964 7832  roi2 = rois[idx2
-000510e0: 5d0a 2020 2020 2020 2020 2020 2020 696e  ].            in
-000510f0: 7465 7273 6563 7469 6f6e 2c20 756e 696f  tersection, unio
-00051100: 6e2c 206d 6561 6e5f 7369 7a65 203d 2028  n, mean_size = (
-00051110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00051120: 2020 2020 2072 6f69 312e 6765 745f 696e       roi1.get_in
-00051130: 7465 7273 6563 7469 6f6e 5f75 6e69 6f6e  tersection_union
-00051140: 5f73 697a 6528 726f 6932 2c20 7369 6e67  _size(roi2, sing
-00051150: 6c65 5f73 6c69 6365 2c0a 2020 2020 2020  le_slice,.      
-00051160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051170: 2020 7669 6577 2c20 736c 2c20 6964 782c    view, sl, idx,
-00051180: 2070 6f73 2c20 6d65 7468 6f64 2c20 666c   pos, method, fl
-00051190: 6174 7465 6e29 290a 2020 2020 2020 2020  atten)).        
-000511a0: 2020 2020 6e75 6d65 7261 746f 7220 2b3d      numerator +=
-000511b0: 2069 6e74 6572 7365 6374 696f 6e0a 2020   intersection.  
-000511c0: 2020 2020 2020 2020 2020 6465 6e6f 6d69            denomi
-000511d0: 6e61 746f 7220 2b3d 2075 6e69 6f6e 0a20  nator += union. 
-000511e0: 2020 2020 2020 2020 2020 2063 692e 7061             ci.pa
-000511f0: 6972 7320 2b3d 2069 6e74 6572 7365 6374  irs += intersect
-00051200: 696f 6e20 2f20 756e 696f 6e0a 2020 2020  ion / union.    
-00051210: 2020 2020 2020 2020 6e5f 7061 6972 202b          n_pair +
-00051220: 3d20 310a 0a20 2020 2063 692e 6765 6e20  = 1..    ci.gen 
-00051230: 3d20 6e75 6d65 7261 746f 7220 2f20 6465  = numerator / de
-00051240: 6e6f 6d69 6e61 746f 720a 2020 2020 6369  nominator.    ci
-00051250: 2e70 6169 7273 202f 3d20 6e5f 7061 6972  .pairs /= n_pair
-00051260: 0a0a 2020 2020 2320 4465 616c 2077 6974  ..    # Deal wit
-00051270: 6820 6361 7365 2022 636f 6d6d 6f6e 222e  h case "common".
-00051280: 0a20 2020 2023 0a20 2020 2023 2054 6865  .    #.    # The
-00051290: 2063 6f6e 666f 726d 6974 7920 696e 6465   conformity inde
-000512a0: 7820 6973 2063 616c 6375 6c61 7465 6420  x is calculated 
-000512b0: 6173 2074 6865 2072 6174 696f 206f 660a  as the ratio of.
-000512c0: 2020 2020 2320 2831 2920 7468 6520 636f      # (1) the co
-000512d0: 6d6d 6f6e 2069 6e74 6572 7365 6374 696f  mmon intersectio
-000512e0: 6e20 6f66 2061 6c6c 2052 4f49 7320 746f  n of all ROIs to
-000512f0: 2028 3229 2074 6865 2063 6f6d 6269 6e65   (2) the combine
-00051300: 6420 756e 696f 6e0a 2020 2020 2320 6f66  d union.    # of
-00051310: 2061 6c6c 2052 4f49 732e 0a20 2020 2069   all ROIs..    i
-00051320: 6620 3220 3d3d 206c 656e 2872 6f69 7329  f 2 == len(rois)
-00051330: 3a0a 2020 2020 2020 2020 696e 7465 7273  :.        inters
-00051340: 6563 7469 6f6e 2c20 756e 696f 6e2c 206d  ection, union, m
-00051350: 6561 6e5f 7369 7a65 203d 2028 0a20 2020  ean_size = (.   
-00051360: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-00051370: 735b 305d 2e67 6574 5f69 6e74 6572 7365  s[0].get_interse
-00051380: 6374 696f 6e5f 756e 696f 6e5f 7369 7a65  ction_union_size
-00051390: 2872 6f69 735b 315d 2c20 7369 6e67 6c65  (rois[1], single
-000513a0: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
-000513b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000513c0: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
-000513d0: 6f73 2c20 6d65 7468 6f64 2c20 666c 6174  os, method, flat
-000513e0: 7465 6e29 290a 2020 2020 2020 2020 6369  ten)).        ci
-000513f0: 2e63 6f6d 6d6f 6e20 3d20 696e 7465 7273  .common = inters
-00051400: 6563 7469 6f6e 202f 2075 6e69 6f6e 0a20  ection / union. 
-00051410: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00051420: 2069 6620 6e6f 7420 7369 6e67 6c65 5f73   if not single_s
-00051430: 6c69 6365 3a0a 2020 2020 2020 2020 2020  lice:.          
-00051440: 2020 6d61 736b 5f69 6e74 6572 7365 6374    mask_intersect
-00051450: 696f 6e20 3d20 726f 6973 5b30 5d2e 636c  ion = rois[0].cl
-00051460: 6f6e 6528 292e 6765 745f 6d61 736b 280a  one().get_mask(.
-00051470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051480: 2020 2020 7669 6577 2c20 666c 6174 7465      view, flatte
-00051490: 6e2c 2073 7461 6e64 6172 6469 7365 3d54  n, standardise=T
-000514a0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-000514b0: 206d 6173 6b5f 756e 696f 6e20 3d20 726f   mask_union = ro
-000514c0: 6973 5b30 5d2e 636c 6f6e 6528 292e 6765  is[0].clone().ge
-000514d0: 745f 6d61 736b 280a 2020 2020 2020 2020  t_mask(.        
-000514e0: 2020 2020 2020 2020 2020 2020 7669 6577              view
-000514f0: 2c20 666c 6174 7465 6e2c 2073 7461 6e64  , flatten, stand
-00051500: 6172 6469 7365 3d54 7275 6529 0a20 2020  ardise=True).   
-00051510: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00051520: 2020 2020 2020 206d 6173 6b5f 696e 7465         mask_inte
-00051530: 7273 6563 7469 6f6e 203d 2072 6f69 735b  rsection = rois[
-00051540: 305d 2e63 6c6f 6e65 2829 2e67 6574 5f73  0].clone().get_s
-00051550: 6c69 6365 280a 2020 2020 2020 2020 2020  lice(.          
-00051560: 2020 2020 2020 2020 2020 7669 6577 2c20            view, 
-00051570: 736c 2c20 6964 782c 2070 6f73 290a 2020  sl, idx, pos).  
-00051580: 2020 2020 2020 2020 2020 6d61 736b 5f75            mask_u
-00051590: 6e69 6f6e 203d 2072 6f69 735b 305d 2e63  nion = rois[0].c
-000515a0: 6c6f 6e65 2829 2e67 6574 5f73 6c69 6365  lone().get_slice
-000515b0: 2876 6965 772c 2073 6c2c 2069 6478 2c20  (view, sl, idx, 
-000515c0: 706f 7329 0a0a 2020 2020 2020 2020 666f  pos)..        fo
-000515d0: 7220 726f 6920 696e 2072 6f69 735b 313a  r roi in rois[1:
-000515e0: 5d3a 0a20 2020 2020 2020 2020 2020 2069  ]:.            i
-000515f0: 6620 6e6f 7420 7369 6e67 6c65 5f73 6c69  f not single_sli
-00051600: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-00051610: 2020 2020 6d61 736b 203d 2072 6f69 2e67      mask = roi.g
-00051620: 6574 5f6d 6173 6b28 7669 6577 2c20 666c  et_mask(view, fl
-00051630: 6174 7465 6e2c 2073 7461 6e64 6172 6469  atten, standardi
-00051640: 7365 3d54 7275 6529 0a20 2020 2020 2020  se=True).       
-00051650: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00051660: 2020 2020 2020 2020 2020 206d 6173 6b20             mask 
-00051670: 3d20 726f 692e 6765 745f 736c 6963 6528  = roi.get_slice(
-00051680: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
-00051690: 6f73 290a 0a20 2020 2020 2020 2020 2020  os)..           
-000516a0: 206d 6173 6b5f 696e 7465 7273 6563 7469   mask_intersecti
-000516b0: 6f6e 203d 2028 6d61 736b 5f69 6e74 6572  on = (mask_inter
-000516c0: 7365 6374 696f 6e20 2620 6d61 736b 290a  section & mask).
-000516d0: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-000516e0: 5f75 6e69 6f6e 203d 2028 6d61 736b 5f75  _union = (mask_u
-000516f0: 6e69 6f6e 207c 206d 6173 6b29 0a0a 2020  nion | mask)..  
-00051700: 2020 2020 2020 6369 2e63 6f6d 6d6f 6e20        ci.common 
-00051710: 3d20 6d61 736b 5f69 6e74 6572 7365 6374  = mask_intersect
-00051720: 696f 6e2e 7375 6d28 2920 2f20 6d61 736b  ion.sum() / mask
-00051730: 5f75 6e69 6f6e 2e73 756d 2829 0a0a 2020  _union.sum()..  
-00051740: 2020 7265 7475 726e 2067 6574 6174 7472    return getattr
-00051750: 2863 692c 2063 695f 7479 7065 2c20 6369  (ci, ci_type, ci
-00051760: 290a 0a64 6566 2067 6574 5f72 6f69 5f73  )..def get_roi_s
-00051770: 6c69 6365 2872 6f69 2c20 7a5f 6672 6163  lice(roi, z_frac
-00051780: 7469 6f6e 3d31 2c20 7375 6666 6978 3d4e  tion=1, suffix=N
-00051790: 6f6e 6529 3a0a 2020 2020 2222 220a 2020  one):.    """.  
-000517a0: 2020 4765 7420 524f 4920 6f62 6a65 6374    Get ROI object
-000517b0: 2063 6f72 7265 7370 6f6e 6469 6e67 2074   corresponding t
-000517c0: 6f20 782d 7920 736c 6963 6520 7468 726f  o x-y slice thro
-000517d0: 7567 6820 696e 7075 7420 524f 492e 0a0a  ugh input ROI...
-000517e0: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
-000517f0: 3a2a 2a0a 0a20 2020 2072 6f69 203a 2073  :**..    roi : s
-00051800: 6b72 742e 7374 7275 6374 7572 6573 2e52  krt.structures.R
-00051810: 4f49 0a20 2020 2020 2020 2052 4f49 206f  OI.        ROI o
-00051820: 626a 6563 7420 666f 7220 7768 6963 6820  bject for which 
-00051830: 736c 6963 6520 6973 2074 6f20 6265 206f  slice is to be o
-00051840: 6274 6169 6e65 642e 0a0a 2020 2020 7a5f  btained...    z_
-00051850: 6672 6163 7469 6f6e 203a 2066 6c6f 6174  fraction : float
-00051860: 2c20 6465 6661 756c 743d 310a 2020 2020  , default=1.    
-00051870: 2020 2020 506f 7369 7469 6f6e 2061 6c6f      Position alo
-00051880: 6e67 207a 2061 7869 7320 6174 2077 6869  ng z axis at whi
-00051890: 6368 2074 6f20 7461 6b65 2073 6c69 6365  ch to take slice
-000518a0: 2074 6872 6f75 6768 2052 4f49 2e0a 2020   through ROI..  
-000518b0: 2020 2020 2020 5468 6520 706f 7369 7469        The positi
-000518c0: 6f6e 2069 7320 7370 6563 6966 6965 6420  on is specified 
-000518d0: 6173 2074 6865 2066 7261 6374 696f 6e61  as the fractiona
-000518e0: 6c20 6469 7374 616e 6365 0a20 2020 2020  l distance.     
-000518f0: 2020 2066 726f 6d20 7468 6520 524f 4927     from the ROI'
-00051900: 7320 6d6f 7374 2d69 6e66 6572 696f 7220  s most-inferior 
-00051910: 706f 696e 743a 2030 2063 6f72 7265 7370  point: 0 corresp
-00051920: 6f6e 6473 2074 6f0a 2020 2020 2020 2020  onds to.        
-00051930: 7468 6520 6d6f 7374 2d69 6e66 6572 696f  the most-inferio
-00051940: 7220 706f 696e 7420 286c 6f77 6573 7420  r point (lowest 
-00051950: 7a29 3b20 3120 636f 7272 6573 706f 6e64  z); 1 correspond
-00051960: 7320 746f 2074 6865 0a20 2020 2020 2020  s to the.       
-00051970: 206d 6f73 742d 7375 7065 7269 6f72 2070   most-superior p
-00051980: 6f69 6e74 2028 6869 6768 6573 7420 7a29  oint (highest z)
-00051990: 2e20 2056 616c 7565 7320 666f 7220 7a5f  .  Values for z_
-000519a0: 6672 6163 7469 6f6e 0a20 2020 2020 2020  fraction.       
-000519b0: 206f 7574 7369 6465 2074 6865 2069 6e74   outside the int
-000519c0: 6572 7661 6c20 5b30 2c20 315d 2072 6573  erval [0, 1] res
-000519d0: 756c 7420 696e 2061 2052 756e 7469 6d65  ult in a Runtime
-000519e0: 4572 726f 722e 0a0a 2020 2020 7375 6666  Error...    suff
-000519f0: 6978 203a 2073 7472 2c20 6465 6661 756c  ix : str, defaul
-00051a00: 743d 4e6f 6e65 0a20 2020 2020 2020 2053  t=None.        S
-00051a10: 7566 6669 7820 746f 2061 7070 656e 6420  uffix to append 
-00051a20: 746f 206e 616d 6520 6f66 2069 6e70 7574  to name of input
-00051a30: 2052 4f49 2c20 746f 2066 6f72 6d20 6e61   ROI, to form na
-00051a40: 6d65 0a20 2020 2020 2020 206f 6620 6f75  me.        of ou
-00051a50: 7470 7574 2052 4f49 2e20 2049 6620 4e6f  tput ROI.  If No
-00051a60: 6e65 2c20 6170 7065 6e64 207a 5f66 7261  ne, append z_fra
-00051a70: 6374 696f 6e2c 2077 6974 6820 7661 6c75  ction, with valu
-00051a80: 650a 2020 2020 2020 2020 6769 7665 6e20  e.        given 
-00051a90: 746f 2074 776f 2064 6563 696d 616c 2070  to two decimal p
-00051aa0: 6c61 6365 732e 0a20 2020 2022 2222 0a20  laces..    """. 
-00051ab0: 2020 2023 2043 6865 636b 2074 6861 7420     # Check that 
-00051ac0: 7a5f 6672 6163 7469 6f6e 2069 7320 696e  z_fraction is in
-00051ad0: 2061 6c6c 6f77 6564 2069 6e74 6572 7661   allowed interva
-00051ae0: 6c2e 0a20 2020 2069 6620 7a5f 6672 6163  l..    if z_frac
-00051af0: 7469 6f6e 203c 2030 206f 7220 7a5f 6672  tion < 0 or z_fr
-00051b00: 6163 7469 6f6e 203e 2031 3a0a 2020 2020  action > 1:.    
-00051b10: 2020 2020 7261 6973 6520 5275 6e74 696d      raise Runtim
-00051b20: 6545 7272 6f72 2866 227a 5f66 7261 6374  eError(f"z_fract
-00051b30: 696f 6e3d 7b7a 5f66 7261 6374 696f 6e7d  ion={z_fraction}
-00051b40: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00051b50: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-00051b60: 6f75 7473 6964 6520 616c 6c6f 7765 6420  outside allowed 
-00051b70: 696e 7465 7276 616c 205b 302c 2031 5d22  interval [0, 1]"
-00051b80: 290a 0a20 2020 2023 2044 6574 6572 6d69  )..    # Determi
-00051b90: 6e65 2074 6865 2069 6e64 6578 206f 6620  ne the index of 
-00051ba0: 7468 6520 696d 6167 6520 736c 6963 6520  the image slice 
-00051bb0: 6174 2077 6869 6368 2074 6f20 7461 6b65  at which to take
-00051bc0: 2052 4f49 2073 6c69 6365 2e0a 2020 2020   ROI slice..    
-00051bd0: 706f 7331 2c20 706f 7332 203d 2072 6f69  pos1, pos2 = roi
-00051be0: 2e67 6574 5f65 7874 656e 7428 290a 2020  .get_extent().  
-00051bf0: 2020 706f 7320 3d20 706f 7331 202b 207a    pos = pos1 + z
-00051c00: 5f66 7261 6374 696f 6e20 2a20 2870 6f73  _fraction * (pos
-00051c10: 3220 2d20 706f 7331 290a 2020 2020 6964  2 - pos1).    id
-00051c20: 7820 3d20 726f 692e 706f 735f 746f 5f69  x = roi.pos_to_i
-00051c30: 6478 2870 6f73 2c20 227a 2229 0a0a 2020  dx(pos, "z")..  
-00051c40: 2020 2320 4f62 7461 696e 2063 6f6e 746f    # Obtain conto
-00051c50: 7572 7320 666f 7220 7265 7175 6972 6564  urs for required
-00051c60: 2073 6c69 6365 2c20 616e 6420 636f 6e76   slice, and conv
-00051c70: 6572 7420 746f 2052 4f49 206f 626a 6563  ert to ROI objec
-00051c80: 742e 0a20 2020 2063 6f6e 746f 7572 7320  t..    contours 
-00051c90: 3d20 726f 692e 6765 745f 636f 6e74 6f75  = roi.get_contou
-00051ca0: 7273 2869 6478 5f61 735f 6b65 793d 5472  rs(idx_as_key=Tr
-00051cb0: 7565 295b 6964 785d 0a20 2020 2072 6f69  ue)[idx].    roi
-00051cc0: 5f73 6c69 6365 203d 2052 4f49 287b 726f  _slice = ROI({ro
-00051cd0: 692e 6964 785f 746f 5f70 6f73 2869 6478  i.idx_to_pos(idx
-00051ce0: 2c20 227a 2229 3a20 636f 6e74 6f75 7273  , "z"): contours
-00051cf0: 7d29 0a0a 2020 2020 7375 6666 6978 203d  })..    suffix =
-00051d00: 2066 227b 7a5f 6672 6163 7469 6f6e 3a2e   f"{z_fraction:.
-00051d10: 3266 7d22 2069 6620 7375 6666 6978 2069  2f}" if suffix i
-00051d20: 7320 4e6f 6e65 2065 6c73 6520 7375 6666  s None else suff
-00051d30: 6978 0a20 2020 2069 6620 7375 6666 6978  ix.    if suffix
-00051d40: 3a0a 2020 2020 2020 2020 726f 695f 736c  :.        roi_sl
-00051d50: 6963 652e 6e61 6d65 203d 2066 227b 726f  ice.name = f"{ro
-00051d60: 692e 6e61 6d65 7d5f 7b73 7566 6669 787d  i.name}_{suffix}
-00051d70: 220a 2020 2020 656c 7365 3a0a 2020 2020  ".    else:.    
-00051d80: 2020 2020 726f 695f 736c 6963 652e 6e61      roi_slice.na
-00051d90: 6d65 203d 2073 7472 2872 6f69 2e6e 616d  me = str(roi.nam
-00051da0: 6529 0a0a 2020 2020 7265 7475 726e 2072  e)..    return r
-00051db0: 6f69 5f73 6c69 6365 0a0a 6465 6620 6765  oi_slice..def ge
-00051dc0: 745f 6d65 7472 6963 5f6d 6574 686f 6428  t_metric_method(
-00051dd0: 6d65 7472 6963 293a 0a20 2020 2022 2222  metric):.    """
-00051de0: 0a20 2020 204d 6170 2062 6574 7765 656e  .    Map between
-00051df0: 206d 6574 7269 6320 6964 656e 7469 6669   metric identifi
-00051e00: 6572 2061 7320 6c69 7374 6564 2069 6e20  er as listed in 
-00051e10: 6765 745f 636f 6d70 6172 6973 6f6e 5f6d  get_comparison_m
-00051e20: 6574 7269 6373 2829 0a20 2020 2061 6e64  etrics().    and
-00051e30: 206e 616d 6520 6f66 2052 4f49 206d 6574   name of ROI met
-00051e40: 686f 6420 666f 7220 6361 6c63 756c 6174  hod for calculat
-00051e50: 696e 6720 7468 6520 6d65 7472 6963 2e0a  ing the metric..
-00051e60: 2020 2020 0a20 2020 2054 6869 7320 6675      .    This fu
-00051e70: 6e63 7469 6f6e 2069 7320 7573 6564 2069  nction is used i
-00051e80: 6e20 524f 492e 6765 745f 6d65 7472 6963  n ROI.get_metric
-00051e90: 5f62 795f 736c 6963 6528 2920 746f 2064  _by_slice() to d
-00051ea0: 6574 6572 6d69 6e65 0a20 2020 2074 6865  etermine.    the
-00051eb0: 206d 6574 686f 6420 746f 2062 6520 6361   method to be ca
-00051ec0: 6c6c 6564 2066 6f72 2065 6163 6820 6d65  lled for each me
-00051ed0: 7472 6963 2e0a 2020 2020 2222 220a 2020  tric..    """.  
-00051ee0: 2020 2320 4b65 7973 2061 7265 206d 6574    # Keys are met
-00051ef0: 7269 6320 6964 656e 7469 6669 6572 733b  ric identifiers;
-00051f00: 2076 616c 7565 7320 6172 6520 6e61 6d65   values are name
-00051f10: 7320 6f66 2052 4f49 206d 6574 686f 6473  s of ROI methods
-00051f20: 0a20 2020 2023 2066 6f72 206d 6574 7269  .    # for metri
-00051f30: 6320 6361 6c63 756c 6174 696f 6e2e 0a20  c calculation.. 
-00051f40: 2020 2023 204d 6574 7269 6373 2061 7265     # Metrics are
-00051f50: 2069 6e63 6c75 6465 6420 696e 2074 6865   included in the
-00051f60: 2064 6963 7469 6f6e 6172 7920 6f6e 6c79   dictionary only
-00051f70: 2069 6620 6964 656e 7469 6669 6572 2061   if identifier a
-00051f80: 6e64 206d 6574 686f 640a 2020 2020 2320  nd method.    # 
-00051f90: 6e61 6d65 2061 7265 2064 6966 6665 7265  name are differe
-00051fa0: 6e74 2e0a 2020 2020 6d61 7070 696e 6773  nt..    mappings
-00051fb0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-00051fc0: 2022 6162 735f 6365 6e74 726f 6964 223a   "abs_centroid":
-00051fd0: 2022 6162 735f 6365 6e74 726f 6964 5f64   "abs_centroid_d
-00051fe0: 6973 7461 6e63 6522 2c0a 2020 2020 2020  istance",.      
-00051ff0: 2020 2020 2020 2263 656e 7472 6f69 6422        "centroid"
-00052000: 3a20 2263 656e 7472 6f69 645f 6469 7374  : "centroid_dist
-00052010: 616e 6365 222c 0a20 2020 2020 2020 2020  ance",.         
-00052020: 2020 2022 7265 6c5f 6172 6561 5f64 6966     "rel_area_dif
-00052030: 6622 3a20 2272 656c 6174 6976 655f 6172  f": "relative_ar
-00052040: 6561 5f64 6966 6622 2c0a 2020 2020 2020  ea_diff",.      
-00052050: 2020 2020 2020 7d0a 2020 2020 7265 7475        }.    retu
-00052060: 726e 206d 6170 7069 6e67 732e 6765 7428  rn mappings.get(
-00052070: 6d65 7472 6963 2c20 6d65 7472 6963 290a  metric, metric).
-00052080: 0a64 6566 2067 6574 5f63 6f6d 7061 7269  .def get_compari
-00052090: 736f 6e5f 6d65 7472 6963 7328 6365 6e74  son_metrics(cent
-000520a0: 726f 6964 5f63 6f6d 706f 6e65 6e74 733d  roid_components=
-000520b0: 4661 6c73 652c 2073 6c69 6365 5f73 7461  False, slice_sta
-000520c0: 7473 3d4e 6f6e 652c 0a20 2020 2020 2020  ts=None,.       
-000520d0: 2064 6566 6175 6c74 5f62 795f 736c 6963   default_by_slic
-000520e0: 653d 4e6f 6e65 2c20 7669 6577 3d22 782d  e=None, view="x-
-000520f0: 7922 293a 0a20 2020 2022 2222 0a20 2020  y"):.    """.   
-00052100: 2047 6574 206c 6973 7420 6f66 2063 6f6d   Get list of com
-00052110: 7061 7269 736f 6e20 6d65 7472 6963 732e  parison metrics.
-00052120: 0a0a 2020 2020 416c 6c20 6d65 7472 6963  ..    All metric
-00052130: 7320 6c69 7374 6564 2068 6572 6520 7368  s listed here sh
-00052140: 6f75 6c64 2062 6520 7265 636f 676e 6973  ould be recognis
-00052150: 6564 2062 7920 524f 492e 6765 745f 636f  ed by ROI.get_co
-00052160: 6d70 6172 6973 6f6e 2829 2c0a 2020 2020  mparison(),.    
-00052170: 616e 6420 616c 6c20 6d65 7472 6963 7320  and all metrics 
-00052180: 7265 636f 676e 6973 6564 2062 7920 524f  recognised by RO
-00052190: 492e 6765 745f 636f 6d70 6172 6973 6f6e  I.get_comparison
-000521a0: 2829 2073 686f 756c 6420 6265 206c 6973  () should be lis
-000521b0: 7465 6420 6865 7265 2e0a 0a20 2020 202a  ted here...    *
-000521c0: 2a50 6172 616d 6574 6572 733a 2a2a 0a0a  *Parameters:**..
-000521d0: 2020 2020 6365 6e74 726f 6964 5f63 6f6d      centroid_com
-000521e0: 706f 6e65 6e74 7320 3a20 626f 6f6c 2c20  ponents : bool, 
-000521f0: 6465 6661 756c 743d 4661 6c73 650a 2020  default=False.  
-00052200: 2020 2020 2020 4966 2054 7275 652c 2072        If True, r
-00052210: 6570 6c61 6365 206d 6574 7269 6373 2022  eplace metrics "
-00052220: 6365 6e74 726f 6964 2220 616e 6420 2263  centroid" and "c
-00052230: 656e 7472 6f69 645f 736c 6963 6522 2062  entroid_slice" b
-00052240: 7920 7468 650a 2020 2020 2020 2020 6d65  y the.        me
-00052250: 7472 6963 7320 666f 7220 7468 6569 7220  trics for their 
-00052260: 636f 6d70 6f6e 656e 7473 2e0a 0a20 2020  components...   
-00052270: 2073 6c69 6365 5f73 7461 7473 203a 2073   slice_stats : s
-00052280: 7472 2f6c 6973 742f 6469 6374 2c20 6465  tr/list/dict, de
-00052290: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-000522a0: 2020 2053 7065 6369 6669 6361 7469 6f6e     Specification
-000522b0: 206f 6620 7374 6174 6973 7469 6373 2074   of statistics t
-000522c0: 6f20 6265 2063 616c 6375 6c61 7465 6420  o be calculated 
-000522d0: 7265 6c61 7469 7665 0a20 2020 2020 2020  relative.       
-000522e0: 2074 6f20 736c 6963 652d 6279 2d73 6c69   to slice-by-sli
-000522f0: 6365 206d 6574 7269 6320 7661 6c75 6573  ce metric values
-00052300: 2e0a 0a20 2020 2020 2020 2041 2073 7461  ...        A sta
-00052310: 7469 7374 6963 2069 7320 7370 6563 6966  tistic is specif
-00052320: 6965 6420 6279 2074 6865 206e 616d 6520  ied by the name 
-00052330: 6f66 2074 6865 2066 756e 6374 696f 6e20  of the function 
-00052340: 666f 720a 2020 2020 2020 2020 6974 7320  for.        its 
-00052350: 6361 6c63 756c 6174 696f 6e20 696e 2074  calculation in t
-00052360: 6865 2050 7974 686f 6e20 7374 6174 6973  he Python statis
-00052370: 7469 6373 206d 6f64 756c 653a 0a0a 2020  tics module:..  
-00052380: 2020 2020 2020 6874 7470 733a 2f2f 646f        https://do
-00052390: 6373 2e70 7974 686f 6e2e 6f72 672f 332f  cs.python.org/3/
-000523a0: 6c69 6272 6172 792f 7374 6174 6973 7469  library/statisti
-000523b0: 6373 2e68 746d 6c0a 0a20 2020 2020 2020  cs.html..       
-000523c0: 2046 6f72 2069 7473 2075 7365 2068 6572   For its use her
-000523d0: 652c 2074 6865 2072 656c 6576 616e 7420  e, the relevant 
-000523e0: 6675 6e63 7469 6f6e 206d 7573 7420 7265  function must re
-000523f0: 7175 6972 650a 2020 2020 2020 2020 6120  quire.        a 
-00052400: 7369 6e67 6c65 2d76 6172 6961 626c 6520  single-variable 
-00052410: 696e 7075 742c 206d 7573 7420 6e6f 7420  input, must not 
-00052420: 7265 7175 6972 6520 616e 7920 6b65 7977  require any keyw
-00052430: 6f72 640a 2020 2020 2020 2020 6172 6775  ord.        argu
-00052440: 6d65 6e74 732c 2061 6e64 206d 7573 7420  ments, and must 
-00052450: 7265 7475 726e 2061 2073 696e 676c 6520  return a single 
-00052460: 6e75 6d62 6572 2e0a 0a20 2020 2020 2020  number...       
-00052470: 2041 7661 696c 6162 6c65 206f 7074 696f   Available optio
-00052480: 6e73 2069 6e63 6c75 6465 3a20 226d 6561  ns include: "mea
-00052490: 6e22 2c20 226d 6564 6961 6e22 2c20 226d  n", "median", "m
-000524a0: 6f64 6522 2c0a 2020 2020 2020 2020 2273  ode",.        "s
-000524b0: 7464 6576 222e 0a0a 2020 2020 2020 2053  tdev"...       S
-000524c0: 7461 7469 7374 6963 7320 746f 2062 6520  tatistics to be 
-000524d0: 6361 6c63 756c 6174 6564 2063 616e 2062  calculated can b
-000524e0: 6520 7370 6563 6966 6965 6420 7573 696e  e specified usin
-000524f0: 6720 616e 7920 6f66 0a20 2020 2020 2020  g any of.       
-00052500: 7468 6520 666f 6c6c 6f77 696e 673a 0a0a  the following:..
-00052510: 2020 2020 2020 202d 2053 7472 696e 6720         - String 
-00052520: 7370 6563 6966 7969 6e67 2073 696e 676c  specifying singl
-00052530: 6520 7374 6174 6973 7469 6320 746f 2062  e statistic to b
-00052540: 6520 6361 6c63 756c 6174 6564 2c0a 2020  e calculated,.  
-00052550: 2020 2020 2020 2077 6974 6820 736c 6963         with slic
-00052560: 6573 2063 6f6e 7369 6465 7265 6420 6173  es considered as
-00052570: 2067 6976 656e 2062 7920 3c64 6566 6175   given by <defau
-00052580: 6c74 5f62 795f 736c 6963 653e 2c0a 2020  lt_by_slice>,.  
-00052590: 2020 2020 2020 2066 6f72 2065 7861 6d70         for examp
-000525a0: 6c65 3a20 226d 6561 6e22 3b0a 2020 2020  le: "mean";.    
-000525b0: 2020 202d 204c 6973 7420 7370 6563 6966     - List specif
-000525c0: 7969 6e67 206d 756c 7469 706c 6520 7374  ying multiple st
-000525d0: 6174 6973 7469 6373 2074 6f20 6265 2063  atistics to be c
-000525e0: 616c 6375 6c61 7465 642c 0a20 2020 2020  alculated,.     
-000525f0: 2020 2020 7769 7468 2073 6c69 6365 7320      with slices 
-00052600: 636f 6e73 6964 6572 6564 2061 7320 6769  considered as gi
-00052610: 7665 6e20 6279 203c 6465 6661 756c 745f  ven by <default_
-00052620: 6279 5f73 6c69 6365 3e2c 0a20 2020 2020  by_slice>,.     
-00052630: 2020 2020 666f 7220 6578 616d 706c 653a      for example:
-00052640: 205b 226d 6561 6e22 2c20 2273 7464 6576   ["mean", "stdev
-00052650: 225d 3b0a 2020 2020 2020 202d 2044 6963  "];.       - Dic
-00052660: 7469 6f6e 6172 7920 7768 6572 6520 6b65  tionary where ke
-00052670: 7973 2073 7065 6369 6679 2073 6c69 6365  ys specify slice
-00052680: 7320 746f 2062 6520 636f 6e73 6964 6572  s to be consider
-00052690: 6564 2c0a 2020 2020 2020 2020 2061 6e64  ed,.         and
-000526a0: 2076 616c 7565 7320 7370 6563 6966 7920   values specify 
-000526b0: 7374 6174 6973 7469 6373 2028 7374 7269  statistics (stri
-000526c0: 6e67 206f 7220 6c69 7374 292c 2066 6f72  ng or list), for
-000526d0: 0a20 2020 2020 2020 2020 6578 616d 706c  .         exampl
-000526e0: 653a 207b 2275 6e69 6f6e 223a 205b 226d  e: {"union": ["m
-000526f0: 6561 6e22 2c20 2273 7464 6576 225d 7d2e  ean", "stdev"]}.
-00052700: 2020 5661 6c69 6420 736c 6963 650a 2020    Valid slice.  
-00052710: 2020 2020 2020 2073 7065 6369 6669 6361         specifica
-00052720: 7469 6f6e 7320 6172 6520 6173 206c 6973  tions are as lis
-00052730: 7465 6420 666f 7220 3c64 6566 6175 6c74  ted for <default
-00052740: 5f62 795f 736c 6963 653e 2e0a 0a20 2020  _by_slice>...   
-00052750: 2064 6566 6175 6c74 5f62 795f 736c 6963   default_by_slic
-00052760: 653a 2073 7472 2c20 6465 6661 756c 743d  e: str, default=
-00052770: 4e6f 6e65 0a20 2020 2020 2020 2044 6566  None.        Def
-00052780: 6175 6c74 2073 7065 6369 6669 6361 7469  ault specificati
-00052790: 6f6e 206f 6620 736c 6963 6573 2074 6f20  on of slices to 
-000527a0: 6265 2063 6f6e 7369 6465 7265 6420 7768  be considered wh
-000527b0: 656e 0a20 2020 2020 2020 2063 616c 6375  en.        calcu
-000527c0: 6c61 7469 6e67 2073 6c69 6365 2d62 792d  lating slice-by-
-000527d0: 736c 6963 6520 7374 6174 6973 7469 6373  slice statistics
-000527e0: 2066 6f72 2061 206d 6574 7269 6320 636f   for a metric co
-000527f0: 6d70 6172 696e 670a 2020 2020 2020 2020  mparing.        
-00052800: 7477 6f20 524f 4973 2c20 726f 6931 2061  two ROIs, roi1 a
-00052810: 6e64 2072 6f69 322e 2020 5468 6520 7661  nd roi2.  The va
-00052820: 6c69 6420 7370 6563 6966 6963 6174 696f  lid specificatio
-00052830: 6e73 2061 7265 3a0a 0a20 2020 2020 2020  ns are:..       
-00052840: 202d 2022 6c65 6674 223a 2063 6f6e 7369   - "left": consi
-00052850: 6465 7220 6f6e 6c79 2073 6c69 6365 7320  der only slices 
-00052860: 636f 6e74 6169 6e69 6e67 2072 6f69 313b  containing roi1;
-00052870: 0a20 2020 2020 2020 202d 2022 7269 6768  .        - "righ
-00052880: 7422 3a20 636f 6e73 6964 6572 206f 6e6c  t": consider onl
-00052890: 7920 736c 6963 6573 2063 6f6e 7461 696e  y slices contain
-000528a0: 696e 6720 726f 6932 3b0a 2020 2020 2020  ing roi2;.      
-000528b0: 2020 2d20 2275 6e69 6f6e 223a 2063 6f6e    - "union": con
-000528c0: 7369 6465 7220 736c 6963 6573 2063 6f6e  sider slices con
-000528d0: 7461 696e 696e 6720 6569 7468 6572 206f  taining either o
-000528e0: 6620 726f 6931 2061 6e64 2072 6f69 323b  f roi1 and roi2;
-000528f0: 0a20 2020 2020 2020 202d 2022 696e 7465  .        - "inte
-00052900: 7273 6563 7469 6f6e 223a 2063 6f6e 7369  rsection": consi
-00052910: 6465 7220 736c 6963 6573 2063 6f6e 7461  der slices conta
-00052920: 696e 696e 6720 626f 7468 2072 6f69 3120  ining both roi1 
-00052930: 616e 6420 726f 6932 2e0a 0a20 2020 2020  and roi2...     
-00052940: 2020 2049 6620 4e6f 6e65 2c20 7573 6520     If None, use 
-00052950: 736b 7274 2e63 6f72 652e 4465 6661 756c  skrt.core.Defaul
-00052960: 7473 2829 2e62 795f 736c 6963 650a 0a20  ts().by_slice.. 
-00052970: 2020 2020 2020 2076 6965 7720 3a20 7374         view : st
-00052980: 722c 2064 6566 6175 6c74 3d22 782d 7922  r, default="x-y"
-00052990: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
-000529a0: 656e 7461 7469 6f6e 2074 6f20 636f 6e73  entation to cons
-000529b0: 6964 6572 2077 6865 6e20 7461 6b69 6e67  ider when taking
-000529c0: 2063 656e 7472 6f69 6420 636f 6d70 6f6e   centroid compon
-000529d0: 656e 7473 2072 656c 6174 6976 650a 2020  ents relative.  
-000529e0: 2020 2020 2020 2020 2020 746f 2061 2073            to a s
-000529f0: 6c69 6365 2e20 2043 616e 2062 6520 2278  lice.  Can be "x
-00052a00: 2d79 222c 2022 792d 7a22 2c20 6f72 2022  -y", "y-z", or "
-00052a10: 782d 7a22 2e0a 2020 2020 2222 220a 2020  x-z"..    """.  
-00052a20: 2020 6d65 7472 6963 7320 3d20 5b0a 2020    metrics = [.  
-00052a30: 2020 2020 2020 2020 2020 2261 6273 5f63            "abs_c
-00052a40: 656e 7472 6f69 6422 2c0a 2020 2020 2020  entroid",.      
-00052a50: 2020 2020 2020 2261 6273 5f63 656e 7472        "abs_centr
-00052a60: 6f69 645f 666c 6174 222c 0a20 2020 2020  oid_flat",.     
-00052a70: 2020 2020 2020 2022 6162 735f 6365 6e74         "abs_cent
-00052a80: 726f 6964 5f73 6c69 6365 222c 0a20 2020  roid_slice",.   
-00052a90: 2020 2020 2020 2020 2022 6162 735f 6365           "abs_ce
-00052aa0: 6e74 726f 6964 5f73 6c69 6365 5f73 7461  ntroid_slice_sta
-00052ab0: 7473 222c 0a20 2020 2020 2020 2020 2020  ts",.           
-00052ac0: 2022 6172 6561 5f64 6966 6622 2c0a 2020   "area_diff",.  
-00052ad0: 2020 2020 2020 2020 2020 2261 7265 615f            "area_
-00052ae0: 6469 6666 5f66 6c61 7422 2c0a 2020 2020  diff_flat",.    
-00052af0: 2020 2020 2020 2020 2261 7265 615f 6469          "area_di
-00052b00: 6666 5f73 6c69 6365 5f73 7461 7473 222c  ff_slice_stats",
-00052b10: 0a20 2020 2020 2020 2020 2020 2022 6172  .            "ar
-00052b20: 6561 5f72 6174 696f 222c 0a20 2020 2020  ea_ratio",.     
-00052b30: 2020 2020 2020 2022 6172 6561 5f72 6174         "area_rat
-00052b40: 696f 5f66 6c61 7422 2c0a 2020 2020 2020  io_flat",.      
-00052b50: 2020 2020 2020 2261 7265 615f 7261 7469        "area_rati
-00052b60: 6f5f 736c 6963 655f 7374 6174 7322 2c0a  o_slice_stats",.
-00052b70: 2020 2020 2020 2020 2020 2020 2263 656e              "cen
-00052b80: 7472 6f69 6422 2c0a 2020 2020 2020 2020  troid",.        
-00052b90: 2020 2020 2263 656e 7472 6f69 645f 736c      "centroid_sl
-00052ba0: 6963 6522 2c0a 2020 2020 2020 2020 2020  ice",.          
-00052bb0: 2020 2263 656e 7472 6f69 645f 736c 6963    "centroid_slic
-00052bc0: 655f 7374 6174 7322 2c0a 2020 2020 2020  e_stats",.      
-00052bd0: 2020 2020 2020 2264 6963 6522 2c0a 2020        "dice",.  
-00052be0: 2020 2020 2020 2020 2020 2264 6963 655f            "dice_
-00052bf0: 666c 6174 222c 0a20 2020 2020 2020 2020  flat",.         
-00052c00: 2020 2022 6469 6365 5f73 6c69 6365 222c     "dice_slice",
-00052c10: 0a20 2020 2020 2020 2020 2020 2022 6469  .            "di
-00052c20: 6365 5f73 6c69 6365 5f73 7461 7473 222c  ce_slice_stats",
-00052c30: 0a20 2020 2020 2020 2020 2020 2022 6861  .            "ha
-00052c40: 7573 646f 7266 665f 6469 7374 616e 6365  usdorff_distance
-00052c50: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-00052c60: 6861 7573 646f 7266 665f 6469 7374 616e  hausdorff_distan
-00052c70: 6365 5f66 6c61 7422 2c0a 2020 2020 2020  ce_flat",.      
-00052c80: 2020 2020 2020 226a 6163 6361 7264 222c        "jaccard",
-00052c90: 0a20 2020 2020 2020 2020 2020 2022 6a61  .            "ja
-00052ca0: 6363 6172 645f 666c 6174 222c 0a20 2020  ccard_flat",.   
-00052cb0: 2020 2020 2020 2020 2022 6a61 6363 6172           "jaccar
-00052cc0: 645f 736c 6963 6522 2c0a 2020 2020 2020  d_slice",.      
-00052cd0: 2020 2020 2020 226a 6163 6361 7264 5f73        "jaccard_s
-00052ce0: 6c69 6365 5f73 7461 7473 222c 0a20 2020  lice_stats",.   
-00052cf0: 2020 2020 2020 2020 2022 6d65 616e 5f64           "mean_d
-00052d00: 6973 7461 6e63 655f 746f 5f63 6f6e 666f  istance_to_confo
-00052d10: 726d 6974 7922 2c0a 2020 2020 2020 2020  rmity",.        
-00052d20: 2020 2020 226d 6561 6e5f 6469 7374 616e      "mean_distan
-00052d30: 6365 5f74 6f5f 636f 6e66 6f72 6d69 7479  ce_to_conformity
-00052d40: 5f66 6c61 7422 2c0a 2020 2020 2020 2020  _flat",.        
-00052d50: 2020 2020 226d 6561 6e5f 7369 676e 6564      "mean_signed
-00052d60: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
-00052d70: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-00052d80: 226d 6561 6e5f 7369 676e 6564 5f73 7572  "mean_signed_sur
-00052d90: 6661 6365 5f64 6973 7461 6e63 655f 666c  face_distance_fl
-00052da0: 6174 222c 0a20 2020 2020 2020 2020 2020  at",.           
-00052db0: 2022 6d65 616e 5f73 7572 6661 6365 5f64   "mean_surface_d
-00052dc0: 6973 7461 6e63 6522 2c0a 2020 2020 2020  istance",.      
-00052dd0: 2020 2020 2020 226d 6561 6e5f 7375 7266        "mean_surf
-00052de0: 6163 655f 6469 7374 616e 6365 5f66 6c61  ace_distance_fla
-00052df0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
-00052e00: 226d 6561 6e5f 6f76 6572 5f63 6f6e 746f  "mean_over_conto
-00052e10: 7572 696e 6722 2c0a 2020 2020 2020 2020  uring",.        
-00052e20: 2020 2020 226d 6561 6e5f 6f76 6572 5f63      "mean_over_c
-00052e30: 6f6e 746f 7572 696e 675f 666c 6174 222c  ontouring_flat",
-00052e40: 0a20 2020 2020 2020 2020 2020 2022 6d65  .            "me
-00052e50: 616e 5f75 6e64 6572 5f63 6f6e 746f 7572  an_under_contour
-00052e60: 696e 6722 2c0a 2020 2020 2020 2020 2020  ing",.          
-00052e70: 2020 226d 6561 6e5f 756e 6465 725f 636f    "mean_under_co
-00052e80: 6e74 6f75 7269 6e67 5f66 6c61 7422 2c0a  ntouring_flat",.
-00052e90: 2020 2020 2020 2020 2020 2020 2272 656c              "rel
-00052ea0: 5f61 7265 615f 6469 6666 222c 0a20 2020  _area_diff",.   
-00052eb0: 2020 2020 2020 2020 2022 7265 6c5f 6172           "rel_ar
-00052ec0: 6561 5f64 6966 665f 666c 6174 222c 0a20  ea_diff_flat",. 
-00052ed0: 2020 2020 2020 2020 2020 2022 7265 6c5f             "rel_
-00052ee0: 6172 6561 5f64 6966 665f 736c 6963 655f  area_diff_slice_
-00052ef0: 7374 6174 7322 2c0a 2020 2020 2020 2020  stats",.        
-00052f00: 2020 2020 2272 656c 5f76 6f6c 756d 655f      "rel_volume_
-00052f10: 6469 6666 222c 0a20 2020 2020 2020 2020  diff",.         
-00052f20: 2020 2022 726d 735f 7369 676e 6564 5f73     "rms_signed_s
-00052f30: 7572 6661 6365 5f64 6973 7461 6e63 6522  urface_distance"
-00052f40: 2c0a 2020 2020 2020 2020 2020 2020 2272  ,.            "r
-00052f50: 6d73 5f73 6967 6e65 645f 7375 7266 6163  ms_signed_surfac
-00052f60: 655f 6469 7374 616e 6365 5f66 6c61 7422  e_distance_flat"
-00052f70: 2c0a 2020 2020 2020 2020 2020 2020 2272  ,.            "r
-00052f80: 6d73 5f73 7572 6661 6365 5f64 6973 7461  ms_surface_dista
-00052f90: 6e63 6522 2c0a 2020 2020 2020 2020 2020  nce",.          
-00052fa0: 2020 2272 6d73 5f73 7572 6661 6365 5f64    "rms_surface_d
-00052fb0: 6973 7461 6e63 655f 666c 6174 222c 0a20  istance_flat",. 
-00052fc0: 2020 2020 2020 2020 2020 2022 766f 6c75             "volu
-00052fd0: 6d65 5f64 6966 6622 2c0a 2020 2020 2020  me_diff",.      
-00052fe0: 2020 2020 2020 2276 6f6c 756d 655f 7261        "volume_ra
-00052ff0: 7469 6f22 2c0a 2020 2020 2020 2020 2020  tio",.          
-00053000: 2020 5d0a 0a20 2020 2023 2052 6570 6c61    ]..    # Repla
-00053010: 6365 2063 656e 7472 6f69 6420 7665 6374  ce centroid vect
-00053020: 6f72 7320 6279 2063 6f6d 706f 6e65 6e74  ors by component
-00053030: 732e 0a20 2020 2069 6620 6365 6e74 726f  s..    if centro
-00053040: 6964 5f63 6f6d 706f 6e65 6e74 733a 0a20  id_components:. 
-00053050: 2020 2020 2020 2063 656e 7472 6f69 6473         centroids
-00053060: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-00053070: 2020 2020 2022 6365 6e74 726f 6964 223a       "centroid":
-00053080: 205b 2263 656e 7472 6f69 645f 7822 2c20   ["centroid_x", 
-00053090: 2263 656e 7472 6f69 645f 7922 2c20 2263  "centroid_y", "c
-000530a0: 656e 7472 6f69 645f 7a22 5d2c 0a20 2020  entroid_z"],.   
-000530b0: 2020 2020 2020 2020 2020 2020 2022 6365               "ce
-000530c0: 6e74 726f 6964 5f73 6c69 6365 223a 205b  ntroid_slice": [
-000530d0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000530e0: 2020 7d0a 2020 2020 2020 2020 6966 2073    }.        if s
-000530f0: 6c69 6365 5f73 7461 7473 2069 7320 6e6f  lice_stats is no
-00053100: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00053110: 2020 2020 6365 6e74 726f 6964 735b 2263      centroids["c
-00053120: 656e 7472 6f69 645f 736c 6963 655f 7374  entroid_slice_st
-00053130: 6174 7322 5d20 3d20 5b5d 0a0a 2020 2020  ats"] = []..    
-00053140: 2020 2020 666f 7220 695f 6178 2069 6e20      for i_ax in 
-00053150: 736b 7274 2e69 6d61 6765 2e5f 706c 6f74  skrt.image._plot
-00053160: 5f61 7865 735b 7669 6577 5d3a 0a20 2020  _axes[view]:.   
-00053170: 2020 2020 2020 2020 2061 7820 3d20 736b           ax = sk
-00053180: 7274 2e69 6d61 6765 2e5f 6178 6573 5b69  rt.image._axes[i
-00053190: 5f61 785d 0a20 2020 2020 2020 2020 2020  _ax].           
-000531a0: 2063 656e 7472 6f69 6473 5b22 6365 6e74   centroids["cent
-000531b0: 726f 6964 5f73 6c69 6365 225d 2e61 7070  roid_slice"].app
-000531c0: 656e 6428 6622 6365 6e74 726f 6964 5f73  end(f"centroid_s
-000531d0: 6c69 6365 5f7b 6178 7d22 290a 0a20 2020  lice_{ax}")..   
-000531e0: 2020 2020 2020 2020 2069 6620 736c 6963           if slic
-000531f0: 655f 7374 6174 7320 6973 206e 6f74 204e  e_stats is not N
-00053200: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00053210: 2020 2020 2063 656e 7472 6f69 6473 5b22       centroids["
-00053220: 6365 6e74 726f 6964 5f73 6c69 6365 5f73  centroid_slice_s
-00053230: 7461 7473 225d 2e61 7070 656e 6428 0a20  tats"].append(. 
-00053240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053250: 2020 2020 2020 2066 2263 656e 7472 6f69         f"centroi
-00053260: 645f 7b61 787d 5f73 6c69 6365 5f73 7461  d_{ax}_slice_sta
-00053270: 7473 2229 0a0a 2020 2020 2020 2020 666f  ts")..        fo
-00053280: 7220 7665 6374 6f72 2c20 636f 6d70 6f6e  r vector, compon
-00053290: 656e 7473 2069 6e20 6365 6e74 726f 6964  ents in centroid
-000532a0: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
-000532b0: 2020 2020 2020 2069 6478 203d 206d 6574         idx = met
-000532c0: 7269 6373 2e69 6e64 6578 2876 6563 746f  rics.index(vecto
-000532d0: 7229 0a20 2020 2020 2020 2020 2020 206d  r).            m
-000532e0: 6574 7269 6373 5b69 6478 203a 2069 6478  etrics[idx : idx
-000532f0: 202b 2031 5d20 3d20 636f 6d70 6f6e 656e   + 1] = componen
-00053300: 7473 0a0a 2020 2020 2320 5265 6d6f 7665  ts..    # Remove
-00053310: 206d 6574 7269 6373 2077 6974 6820 7375   metrics with su
-00053320: 6666 6978 2022 736c 6963 655f 7374 6174  ffix "slice_stat
-00053330: 7322 2c0a 2020 2020 2320 616e 6420 7265  s",.    # and re
-00053340: 706c 6163 6520 7769 7468 2073 7065 6369  place with speci
-00053350: 6669 6320 6d65 7472 6963 7320 7265 6c61  fic metrics rela
-00053360: 7469 6e67 2074 6f20 736c 6963 652d 6279  ting to slice-by
-00053370: 2d73 6c69 6365 2073 7461 7469 7374 6963  -slice statistic
-00053380: 732e 0a20 2020 2069 6620 736c 6963 655f  s..    if slice_
-00053390: 7374 6174 7320 6973 206e 6f74 204e 6f6e  stats is not Non
-000533a0: 653a 0a20 2020 2020 2020 2073 6c69 6365  e:.        slice
-000533b0: 5f73 7461 7473 5f6d 6574 7269 6373 203d  _stats_metrics =
-000533c0: 205b 5d0a 2020 2020 2020 2020 6d65 7472   [].        metr
-000533d0: 6963 7332 203d 205b 5d0a 2020 2020 2020  ics2 = [].      
-000533e0: 2020 666f 7220 6d65 7472 6963 2069 6e20    for metric in 
-000533f0: 6d65 7472 6963 733a 0a20 2020 2020 2020  metrics:.       
-00053400: 2020 2020 2069 6620 2273 6c69 6365 5f73       if "slice_s
-00053410: 7461 7473 2220 696e 206d 6574 7269 633a  tats" in metric:
-00053420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00053430: 2073 6c69 6365 5f73 7461 7473 5f6d 6574   slice_stats_met
-00053440: 7269 6373 2e61 7070 656e 6428 6d65 7472  rics.append(metr
-00053450: 6963 2e73 706c 6974 2822 5f73 6c69 6365  ic.split("_slice
-00053460: 5f73 7461 7473 2229 5b30 5d29 0a20 2020  _stats")[0]).   
-00053470: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00053480: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00053490: 6574 7269 6373 322e 6170 7065 6e64 286d  etrics2.append(m
-000534a0: 6574 7269 6329 0a0a 2020 2020 2020 2020  etric)..        
-000534b0: 666f 7220 6279 5f73 6c69 6365 2c20 7374  for by_slice, st
-000534c0: 6174 7320 696e 2028 0a20 2020 2020 2020  ats in (.       
-000534d0: 2020 2020 2020 2020 2065 7870 616e 645f           expand_
-000534e0: 736c 6963 655f 7374 6174 7328 736c 6963  slice_stats(slic
-000534f0: 655f 7374 6174 732c 2064 6566 6175 6c74  e_stats, default
-00053500: 5f62 795f 736c 6963 6529 2e69 7465 6d73  _by_slice).items
-00053510: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
-00053520: 2066 6f72 206d 6574 7269 6320 696e 2073   for metric in s
-00053530: 6c69 6365 5f73 7461 7473 5f6d 6574 7269  lice_stats_metri
-00053540: 6373 3a0a 2020 2020 2020 2020 2020 2020  cs:.            
-00053550: 2020 2020 666f 7220 7374 6174 2069 6e20      for stat in 
-00053560: 7374 6174 733a 0a20 2020 2020 2020 2020  stats:.         
-00053570: 2020 2020 2020 2020 2020 206d 6574 7269             metri
-00053580: 6373 322e 6170 7065 6e64 2866 227b 6d65  cs2.append(f"{me
-00053590: 7472 6963 7d5f 736c 6963 655f 7b62 795f  tric}_slice_{by_
-000535a0: 736c 6963 657d 5f7b 7374 6174 7d22 290a  slice}_{stat}").
-000535b0: 2020 2020 2020 2020 6d65 7472 6963 7320          metrics 
-000535c0: 3d20 6d65 7472 6963 7332 0a0a 2020 2020  = metrics2..    
-000535d0: 7265 7475 726e 2073 6f72 7465 6428 6d65  return sorted(me
-000535e0: 7472 6963 7329 0a0a 6465 6620 6765 745f  trics)..def get_
-000535f0: 636f 6e73 656e 7375 735f 7479 7065 7328  consensus_types(
-00053600: 293a 0a20 2020 2022 2222 0a20 2020 2047  ):.    """.    G
-00053610: 6574 206c 6973 7420 6f66 2063 6f6e 7365  et list of conse
-00053620: 6e73 7573 2074 7970 6573 2e0a 0a20 2020  nsus types...   
-00053630: 2041 6c6c 2063 6f6e 7365 6e73 7573 2074   All consensus t
-00053640: 7970 6573 206c 6973 7465 6420 6865 7265  ypes listed here
-00053650: 2073 686f 756c 6420 6265 2072 6563 6f67   should be recog
-00053660: 6e69 7365 6420 6279 0a20 2020 2053 7472  nised by.    Str
-00053670: 7563 7475 7265 5365 742e 6765 745f 636f  uctureSet.get_co
-00053680: 6e73 656e 7375 7328 292c 2061 6e64 2061  nsensus(), and a
-00053690: 6c6c 2063 6f6e 7365 6e73 7573 2074 7970  ll consensus typ
-000536a0: 6573 2072 6563 6f67 6e69 7365 640a 2020  es recognised.  
-000536b0: 2020 6279 2053 7472 7563 7475 7265 5365    by StructureSe
-000536c0: 742e 6765 745f 636f 6e73 656e 7375 7320  t.get_consensus 
-000536d0: 7368 6f75 6c64 2062 6520 6c69 7374 6564  should be listed
-000536e0: 2068 6572 652e 0a20 2020 2022 2222 0a20   here..    """. 
-000536f0: 2020 2072 6574 7572 6e20 5b0a 2020 2020     return [.    
-00053700: 2020 2020 2020 2020 226d 616a 6f72 6974          "majorit
-00053710: 7922 2c0a 2020 2020 2020 2020 2020 2020  y",.            
-00053720: 226f 7665 726c 6170 222c 0a20 2020 2020  "overlap",.     
-00053730: 2020 2020 2020 2022 7374 6170 6c65 222c         "staple",
-00053740: 0a20 2020 2020 2020 2020 2020 2022 7375  .            "su
-00053750: 6d22 2c0a 2020 2020 2020 2020 2020 2020  m",.            
-00053760: 5d0a 0a64 6566 2067 6574 5f62 795f 736c  ]..def get_by_sl
-00053770: 6963 655f 6d65 7468 6f64 7328 293a 0a20  ice_methods():. 
-00053780: 2020 2022 2222 0a20 2020 2047 6574 206c     """.    Get l
-00053790: 6973 7420 6f66 206d 6574 686f 6473 2066  ist of methods f
-000537a0: 6f72 2064 6566 696e 696e 6720 736c 6963  or defining slic
-000537b0: 6573 2074 6f20 6265 2063 6f6e 7369 6465  es to be conside
-000537c0: 7265 640a 2020 2020 666f 7220 736c 6963  red.    for slic
-000537d0: 652d 6279 2d73 6c69 6365 2052 4f49 2063  e-by-slice ROI c
-000537e0: 6f6d 7061 7269 736f 6e73 2e0a 2020 2020  omparisons..    
-000537f0: 2222 220a 2020 2020 7265 7475 726e 205b  """.    return [
-00053800: 226c 6566 7422 2c20 2272 6967 6874 222c  "left", "right",
-00053810: 2022 756e 696f 6e22 2c20 2269 6e74 6572   "union", "inter
-00053820: 7365 6374 696f 6e22 5d0a 0a64 6566 2067  section"]..def g
-00053830: 6574 5f61 6c6c 5f72 6f69 7328 6f62 6a73  et_all_rois(objs
-00053840: 3d4e 6f6e 6529 3a0a 2020 2020 2222 220a  =None):.    """.
-00053850: 2020 2020 4372 6561 7465 206c 6973 7420      Create list 
-00053860: 6f66 2052 4f49 7320 6672 6f6d 2061 7262  of ROIs from arb
-00053870: 6974 7261 7279 2063 6f6d 6269 6e61 7469  itrary combinati
-00053880: 6f6e 206f 6620 524f 4973 2061 6e64 2053  on of ROIs and S
-00053890: 7472 7563 7475 7265 5365 7473 2e0a 0a20  tructureSets... 
-000538a0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-000538b0: 2a2a 0a0a 2020 2020 6f62 6a73 203a 2052  **..    objs : R
-000538c0: 4f49 2f53 7472 7563 7475 7265 5365 742f  OI/StructureSet/
-000538d0: 6c69 7374 2c20 6465 6661 756c 743d 4e6f  list, default=No
-000538e0: 6e65 0a20 2020 2020 2020 204f 626a 6563  ne.        Objec
-000538f0: 7428 7329 2066 726f 6d20 7768 6963 6820  t(s) from which 
-00053900: 6120 6c69 7374 206f 6620 524f 4973 2069  a list of ROIs i
-00053910: 7320 746f 2062 6520 6372 6561 7465 642e  s to be created.
-00053920: 2020 5468 650a 2020 2020 2020 2020 6f62    The.        ob
-00053930: 6a65 6374 2873 2920 6361 6e20 6265 2061  ject(s) can be a
-00053940: 2073 696e 676c 6520 736b 7274 2e73 7472   single skrt.str
-00053950: 7563 7475 7265 732e 524f 4920 6f62 6a65  uctures.ROI obje
-00053960: 6374 2c20 6120 7369 6e67 6c65 0a20 2020  ct, a single.   
-00053970: 2020 2020 2073 6b72 742e 7374 7275 6374       skrt.struct
-00053980: 7572 6573 2e53 7472 7563 7475 7265 5365  ures.StructureSe
-00053990: 7420 6f62 6a65 6374 2c20 6f72 2061 206c  t object, or a l
-000539a0: 6973 7420 636f 6e74 6169 6e69 6e67 2061  ist containing a
-000539b0: 6e79 0a20 2020 2020 2020 2063 6f6d 6269  ny.        combi
-000539c0: 6e61 7469 6f6e 206f 6620 524f 4920 616e  nation of ROI an
-000539d0: 6420 5374 7275 6374 7572 6553 6574 206f  d StructureSet o
-000539e0: 626a 6563 7473 2e0a 2020 2020 2222 220a  bjects..    """.
-000539f0: 2020 2020 2320 456e 7375 7265 2074 6861      # Ensure tha
-00053a00: 7420 6f62 6a73 2069 7320 6120 6c69 7374  t objs is a list
-00053a10: 0a20 2020 2069 6620 6973 7375 6263 6c61  .    if issubcla
-00053a20: 7373 2874 7970 6528 6f62 6a73 292c 2028  ss(type(objs), (
-00053a30: 524f 492c 2053 7472 7563 7475 7265 5365  ROI, StructureSe
-00053a40: 7429 293a 0a20 2020 2020 2020 206f 626a  t)):.        obj
-00053a50: 7320 3d20 5b6f 626a 735d 0a20 2020 2065  s = [objs].    e
-00053a60: 6c69 6620 6f62 6a73 2069 7320 4e6f 6e65  lif objs is None
-00053a70: 3a0a 2020 2020 2020 2020 6f62 6a73 203d  :.        objs =
-00053a80: 205b 5d0a 0a20 2020 2023 2043 7265 6174   []..    # Creat
-00053a90: 6520 6120 6c69 7374 2063 6f6e 7461 696e  e a list contain
-00053aa0: 696e 6720 616c 6c20 756e 6971 7565 2072  ing all unique r
-00053ab0: 6f69 732e 0a20 2020 2061 6c6c 5f72 6f69  ois..    all_roi
-00053ac0: 7320 3d20 5b5d 0a20 2020 2066 6f72 2069  s = [].    for i
-00053ad0: 7465 6d20 696e 206f 626a 733a 0a20 2020  tem in objs:.   
-00053ae0: 2020 2020 2069 6620 6973 7375 6263 6c61       if issubcla
-00053af0: 7373 2874 7970 6528 6974 656d 292c 2052  ss(type(item), R
-00053b00: 4f49 293a 0a20 2020 2020 2020 2020 2020  OI):.           
-00053b10: 2063 616e 6469 6461 7465 5f72 6f69 7320   candidate_rois 
-00053b20: 3d20 5b69 7465 6d5d 0a20 2020 2020 2020  = [item].       
-00053b30: 2065 6c69 6620 6973 7375 6263 6c61 7373   elif issubclass
-00053b40: 2874 7970 6528 6974 656d 292c 2053 7472  (type(item), Str
-00053b50: 7563 7475 7265 5365 7429 3a0a 2020 2020  uctureSet):.    
-00053b60: 2020 2020 2020 2020 6361 6e64 6964 6174          candidat
-00053b70: 655f 726f 6973 203d 2069 7465 6d2e 6765  e_rois = item.ge
-00053b80: 745f 726f 6973 2829 0a20 2020 2020 2020  t_rois().       
-00053b90: 2066 6f72 2072 6f69 2069 6e20 6361 6e64   for roi in cand
-00053ba0: 6964 6174 655f 726f 6973 3a0a 2020 2020  idate_rois:.    
-00053bb0: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
-00053bc0: 6f69 2069 6e20 616c 6c5f 726f 6973 3a0a  oi in all_rois:.
-00053bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053be0: 616c 6c5f 726f 6973 2e61 7070 656e 6428  all_rois.append(
-00053bf0: 726f 6929 0a0a 2020 2020 7265 7475 726e  roi)..    return
-00053c00: 2061 6c6c 5f72 6f69 730a 0a64 6566 2067   all_rois..def g
-00053c10: 6574 5f74 7261 6e73 6c61 7469 6f6e 5f74  et_translation_t
-00053c20: 6f5f 616c 6967 6e28 726f 6931 2c20 726f  o_align(roi1, ro
-00053c30: 6932 2c20 7a5f 6672 6163 7469 6f6e 313d  i2, z_fraction1=
-00053c40: 4e6f 6e65 2c20 7a5f 6672 6163 7469 6f6e  None, z_fraction
-00053c50: 323d 4e6f 6e65 293a 0a20 2020 2022 2222  2=None):.    """
-00053c60: 0a20 2020 2044 6574 6572 6d69 6e65 2074  .    Determine t
-00053c70: 7261 6e73 6c61 7469 6f6e 2066 6f72 2061  ranslation for a
-00053c80: 6c69 676e 696e 6720 3c72 6f69 313e 2074  ligning <roi1> t
-00053c90: 6f20 3c72 6f69 323e 2e0a 0a20 2020 202a  o <roi2>...    *
-00053ca0: 2a50 6172 616d 6574 6572 733a 2a2a 0a0a  *Parameters:**..
-00053cb0: 2020 2020 726f 6931 203a 2052 4f49 2f53      roi1 : ROI/S
-00053cc0: 7472 7563 7475 7265 5365 742f 6c69 7374  tructureSet/list
-00053cd0: 0a20 2020 2020 2020 2052 4f49 2074 6861  .        ROI tha
-00053ce0: 7420 6973 2074 6f20 6265 2074 7261 6e73  t is to be trans
-00053cf0: 6c61 7469 6f6e 2074 6f20 6163 6869 6576  lation to achiev
-00053d00: 6520 7468 6520 616c 6967 6e6d 656e 742e  e the alignment.
-00053d10: 2020 5468 6973 0a20 2020 2020 2020 2063    This.        c
-00053d20: 616e 2062 6520 7370 6563 6966 6965 6420  an be specified 
-00053d30: 6469 7265 6374 6c79 2061 7320 6120 7369  directly as a si
-00053d40: 6e67 6c65 2052 4f49 2e20 2041 6c74 6572  ngle ROI.  Alter
-00053d50: 6e61 7469 7665 6c79 2c0a 2020 2020 2020  natively,.      
-00053d60: 2020 6974 2063 616e 2062 6520 6120 5374    it can be a St
-00053d70: 7275 6374 7572 6553 6574 2c20 6f72 2061  ructureSet, or a
-00053d80: 206c 6973 7420 6f72 2052 4f49 2f53 7472   list or ROI/Str
-00053d90: 7563 7475 7265 5365 7420 6f62 6a65 6374  uctureSet object
-00053da0: 732c 0a20 2020 2020 2020 2069 6e20 7768  s,.        in wh
-00053db0: 6963 6820 6361 7365 2074 6865 2069 6e64  ich case the ind
-00053dc0: 6976 6964 7561 6c20 524f 4973 2077 696c  ividual ROIs wil
-00053dd0: 6c20 6265 2063 6f6d 6269 6e65 642e 0a0a  l be combined...
-00053de0: 2020 2020 726f 6932 203a 2052 4f49 2f53      roi2 : ROI/S
-00053df0: 7472 7563 7475 7265 5365 742f 6c69 7374  tructureSet/list
-00053e00: 0a20 2020 2020 2020 2052 4f49 2077 6974  .        ROI wit
-00053e10: 6820 7768 6963 6820 616c 6967 6e6d 656e  h which alignmen
-00053e20: 7420 6973 2074 6f20 6265 2070 6572 666f  t is to be perfo
-00053e30: 726d 6564 2e20 2054 6869 7320 6361 6e20  rmed.  This can 
-00053e40: 6265 0a20 2020 2020 2020 2073 7065 6369  be.        speci
-00053e50: 6669 6564 2064 6972 6563 746c 7920 6173  fied directly as
-00053e60: 2061 2073 696e 676c 6520 524f 492e 2020   a single ROI.  
-00053e70: 416c 7465 726e 6174 6976 656c 792c 2069  Alternatively, i
-00053e80: 7420 6361 6e0a 2020 2020 2020 2020 6265  t can.        be
-00053e90: 2061 2053 7472 7563 7475 7265 5365 742c   a StructureSet,
-00053ea0: 206f 7220 6120 6c69 7374 206f 7220 524f   or a list or RO
-00053eb0: 492f 5374 7275 6374 7572 6553 6574 206f  I/StructureSet o
-00053ec0: 626a 6563 7473 2c0a 2020 2020 2020 2020  bjects,.        
-00053ed0: 696e 2077 6869 6368 2063 6173 6520 7468  in which case th
-00053ee0: 6520 696e 6469 7669 6475 616c 2052 4f49  e individual ROI
-00053ef0: 7320 7769 6c6c 2062 6520 636f 6d62 696e  s will be combin
-00053f00: 6564 2e0a 0a20 2020 207a 5f66 7261 6374  ed...    z_fract
-00053f10: 696f 6e31 203a 2066 6c6f 6174 2c20 6465  ion1 : float, de
-00053f20: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00053f30: 2020 2050 6f73 6974 696f 6e20 616c 6f6e     Position alon
-00053f40: 6720 7a20 6178 6973 206f 6620 736c 6963  g z axis of slic
-00053f50: 6520 7468 726f 7567 6820 3c72 6f69 313e  e through <roi1>
-00053f60: 206f 6e20 7768 6963 680a 2020 2020 2020   on which.      
-00053f70: 2020 746f 2061 6c69 676e 2e20 2049 6620    to align.  If 
-00053f80: 4e6f 6e65 2c20 616c 6967 6e6d 656e 7420  None, alignment 
-00053f90: 6973 2074 6f20 7468 6520 6365 6e74 726f  is to the centro
-00053fa0: 6964 206f 6620 7468 650a 2020 2020 2020  id of the.      
-00053fb0: 2020 7768 6f6c 6520 524f 4920 766f 6c75    whole ROI volu
-00053fc0: 6d65 2e20 204f 7468 6572 7769 7365 2c20  me.  Otherwise, 
-00053fd0: 616c 6967 6e6d 656e 7420 6973 2074 6f20  alignment is to 
-00053fe0: 7468 650a 2020 2020 2020 2020 6365 6e74  the.        cent
-00053ff0: 726f 6964 206f 6620 7468 6520 736c 6963  roid of the slic
-00054000: 6520 6174 2074 6865 2073 7065 6369 6669  e at the specifi
-00054010: 6564 2064 6973 7461 6e63 650a 2020 2020  ed distance.    
-00054020: 2020 2020 6672 6f6d 2074 6865 2052 4f49      from the ROI
-00054030: 2773 206d 6f73 742d 696e 6665 7269 6f72  's most-inferior
-00054040: 2070 6f69 6e74 3a20 3020 636f 7272 6573   point: 0 corres
-00054050: 706f 6e64 7320 746f 0a20 2020 2020 2020  ponds to.       
-00054060: 2074 6865 206d 6f73 742d 696e 6665 7269   the most-inferi
-00054070: 6f72 2070 6f69 6e74 2028 6c6f 7765 7374  or point (lowest
-00054080: 207a 293b 2031 2063 6f72 7265 7370 6f6e   z); 1 correspon
-00054090: 6473 2074 6f20 7468 650a 2020 2020 2020  ds to the.      
-000540a0: 2020 6d6f 7374 2d73 7570 6572 696f 7220    most-superior 
-000540b0: 706f 696e 7420 2868 6967 6865 7374 207a  point (highest z
-000540c0: 292e 2020 5661 6c75 6573 2066 6f72 207a  ).  Values for z
-000540d0: 5f66 7261 6374 696f 6e0a 2020 2020 2020  _fraction.      
-000540e0: 2020 6f75 7473 6964 6520 7468 6520 696e    outside the in
-000540f0: 7465 7276 616c 205b 302c 2031 5d20 7265  terval [0, 1] re
-00054100: 7375 6c74 2069 6e20 6120 5275 6e74 696d  sult in a Runtim
-00054110: 6545 7272 6f72 2e0a 0a20 2020 207a 5f66  eError...    z_f
-00054120: 7261 6374 696f 6e32 203a 2066 6c6f 6174  raction2 : float
-00054130: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00054140: 2020 2020 2020 2050 6f73 6974 696f 6e20         Position 
-00054150: 616c 6f6e 6720 7a20 6178 6973 206f 6620  along z axis of 
-00054160: 736c 6963 6520 7468 726f 7567 6820 3c72  slice through <r
-00054170: 6f69 323e 206f 6e20 7768 6963 680a 2020  oi2> on which.  
-00054180: 2020 2020 2020 746f 2061 6c69 676e 2e20        to align. 
-00054190: 2049 6620 4e6f 6e65 2c20 616c 6967 6e6d   If None, alignm
-000541a0: 656e 7420 6973 2074 6f20 7468 6520 6365  ent is to the ce
-000541b0: 6e74 726f 6964 206f 6620 7468 650a 2020  ntroid of the.  
-000541c0: 2020 2020 2020 7768 6f6c 6520 524f 4920        whole ROI 
-000541d0: 766f 6c75 6d65 2e20 204f 7468 6572 7769  volume.  Otherwi
-000541e0: 7365 2c20 616c 6967 6e6d 656e 7420 6973  se, alignment is
-000541f0: 2074 6f20 7468 650a 2020 2020 2020 2020   to the.        
-00054200: 6365 6e74 726f 6964 206f 6620 7468 6520  centroid of the 
-00054210: 736c 6963 6520 6174 2074 6865 2073 7065  slice at the spe
-00054220: 6369 6669 6564 2064 6973 7461 6e63 650a  cified distance.
-00054230: 2020 2020 2020 2020 6672 6f6d 2074 6865          from the
-00054240: 2052 4f49 2773 206d 6f73 742d 696e 6665   ROI's most-infe
-00054250: 7269 6f72 2070 6f69 6e74 3a20 3020 636f  rior point: 0 co
-00054260: 7272 6573 706f 6e64 7320 746f 0a20 2020  rresponds to.   
-00054270: 2020 2020 2074 6865 206d 6f73 742d 696e       the most-in
-00054280: 6665 7269 6f72 2070 6f69 6e74 2028 6c6f  ferior point (lo
-00054290: 7765 7374 207a 293b 2031 2063 6f72 7265  west z); 1 corre
-000542a0: 7370 6f6e 6473 2074 6f20 7468 650a 2020  sponds to the.  
-000542b0: 2020 2020 2020 6d6f 7374 2d73 7570 6572        most-super
-000542c0: 696f 7220 706f 696e 7420 2868 6967 6865  ior point (highe
-000542d0: 7374 207a 292e 2020 5661 6c75 6573 2066  st z).  Values f
-000542e0: 6f72 207a 5f66 7261 6374 696f 6e0a 2020  or z_fraction.  
-000542f0: 2020 2020 2020 6f75 7473 6964 6520 7468        outside th
-00054300: 6520 696e 7465 7276 616c 205b 302c 2031  e interval [0, 1
-00054310: 5d20 7265 7375 6c74 2069 6e20 6120 5275  ] result in a Ru
-00054320: 6e74 696d 6545 7272 6f72 2e0a 2020 2020  ntimeError..    
-00054330: 2020 2020 2222 220a 2020 2020 2320 4372      """.    # Cr
-00054340: 6561 7465 206c 6973 7420 6f66 2074 776f  eate list of two
-00054350: 2073 696e 676c 6520 524f 4973 2e0a 2020   single ROIs..  
-00054360: 2020 726f 6973 203d 205b 5d0a 2020 2020    rois = [].    
-00054370: 666f 7220 726f 6920 696e 205b 726f 6931  for roi in [roi1
-00054380: 2c20 726f 6932 5d3a 0a20 2020 2020 2020  , roi2]:.       
-00054390: 2069 6620 6973 696e 7374 616e 6365 2872   if isinstance(r
-000543a0: 6f69 2c20 524f 4929 3a0a 2020 2020 2020  oi, ROI):.      
-000543b0: 2020 2020 2020 2320 5374 6f72 6520 7369        # Store si
-000543c0: 6e67 6c65 2052 4f49 2064 6972 6563 746c  ngle ROI directl
-000543d0: 792e 0a20 2020 2020 2020 2020 2020 2072  y..            r
-000543e0: 6f69 732e 6170 7065 6e64 2872 6f69 290a  ois.append(roi).
-000543f0: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-00054400: 6e73 7461 6e63 6528 726f 692c 2053 7472  nstance(roi, Str
-00054410: 7563 7475 7265 5365 7429 3a0a 2020 2020  uctureSet):.    
-00054420: 2020 2020 2020 2020 2320 436f 6d62 696e          # Combin
-00054430: 6520 524f 4973 206f 6620 5374 7275 6374  e ROIs of Struct
-00054440: 7572 6553 6574 2e0a 2020 2020 2020 2020  ureSet..        
-00054450: 2020 2020 726f 6973 2e61 7070 656e 6428      rois.append(
-00054460: 726f 692e 636f 6d62 696e 655f 726f 6973  roi.combine_rois
-00054470: 2829 290a 2020 2020 2020 2020 656c 7365  ()).        else
-00054480: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00054490: 436f 6d62 696e 6520 524f 4973 2066 726f  Combine ROIs fro
-000544a0: 6d20 6c69 7374 2e0a 2020 2020 2020 2020  m list..        
-000544b0: 2020 2020 726f 6973 2e61 7070 656e 6428      rois.append(
-000544c0: 5374 7275 6374 7572 6553 6574 2867 6574  StructureSet(get
-000544d0: 5f61 6c6c 5f72 6f69 7328 726f 6929 292e  _all_rois(roi)).
-000544e0: 636f 6d62 696e 655f 726f 6973 2829 290a  combine_rois()).
-000544f0: 0a20 2020 2023 2043 616c 6375 6c61 7465  .    # Calculate
-00054500: 2061 6c69 676e 6d65 6e74 2070 6f69 6e74   alignment point
-00054510: 732e 0a20 2020 2063 656e 7472 6f69 6473  s..    centroids
-00054520: 203d 205b 5d0a 2020 2020 666f 7220 726f   = [].    for ro
-00054530: 692c 207a 5f66 7261 6374 696f 6e20 696e  i, z_fraction in
-00054540: 207a 6970 2872 6f69 732c 205b 7a5f 6672   zip(rois, [z_fr
-00054550: 6163 7469 6f6e 312c 207a 5f66 7261 6374  action1, z_fract
-00054560: 696f 6e32 5d29 3a0a 2020 2020 2020 2020  ion2]):.        
-00054570: 2320 4361 6c63 756c 6174 6520 6365 6e74  # Calculate cent
-00054580: 726f 6964 2066 6f72 2074 6865 2077 686f  roid for the who
-00054590: 6c65 2052 4f49 2076 6f6c 756d 652e 0a20  le ROI volume.. 
-000545a0: 2020 2020 2020 2069 6620 7a5f 6672 6163         if z_frac
-000545b0: 7469 6f6e 2069 7320 4e6f 6e65 3a0a 2020  tion is None:.  
-000545c0: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
-000545d0: 6964 732e 6170 7065 6e64 2872 6f69 2e67  ids.append(roi.g
-000545e0: 6574 5f63 656e 7472 6f69 6428 2929 0a20  et_centroid()). 
-000545f0: 2020 2020 2020 2023 2043 616c 6375 6c61         # Calcula
-00054600: 7465 2063 656e 7472 6f69 6420 666f 7220  te centroid for 
-00054610: 736c 6963 6520 6174 2073 7065 6369 6669  slice at specifi
-00054620: 6564 2070 6f73 6974 696f 6e2e 0a20 2020  ed position..   
-00054630: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00054640: 2020 2020 2020 2063 656e 7472 6f69 6473         centroids
-00054650: 2e61 7070 656e 6428 726f 692e 6765 745f  .append(roi.get_
-00054660: 726f 695f 736c 6963 6528 7a5f 6672 6163  roi_slice(z_frac
-00054670: 7469 6f6e 292e 6765 745f 6365 6e74 726f  tion).get_centro
-00054680: 6964 2829 290a 0a20 2020 2072 6574 7572  id())..    retur
-00054690: 6e20 7475 706c 6528 6365 6e74 726f 6964  n tuple(centroid
-000546a0: 735b 315d 202d 2063 656e 7472 6f69 6473  s[1] - centroids
-000546b0: 5b30 5d29 0a0a 6465 6620 6765 745f 736c  [0])..def get_sl
-000546c0: 6963 655f 706f 7369 7469 6f6e 7328 726f  ice_positions(ro
-000546d0: 6931 2c20 726f 6932 3d4e 6f6e 652c 2076  i1, roi2=None, v
-000546e0: 6965 773d 2278 2d79 222c 2070 6f73 6974  iew="x-y", posit
-000546f0: 696f 6e5f 6173 5f69 6478 3d46 616c 7365  ion_as_idx=False
-00054700: 2c0a 2020 2020 2020 2020 6d65 7468 6f64  ,.        method
-00054710: 3d4e 6f6e 6529 3a0a 2020 2020 2222 220a  =None):.    """.
-00054720: 2020 2020 4765 7420 6f72 6465 7265 6420      Get ordered 
-00054730: 6c69 7374 206f 6620 736c 6963 6520 706f  list of slice po
-00054740: 7369 7469 6f6e 7320 666f 7220 6569 7468  sitions for eith
-00054750: 6572 206f 7220 626f 7468 206f 6620 6120  er or both of a 
-00054760: 7061 6972 206f 6620 524f 4973 2e0a 0a20  pair of ROIs... 
-00054770: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-00054780: 2a2a 0a0a 2020 2020 726f 6931 203a 2073  **..    roi1 : s
-00054790: 6b72 742e 7374 7275 6374 7572 6573 2e52  krt.structures.R
-000547a0: 4f49 0a20 2020 2020 2020 2052 4f49 2c20  OI.        ROI, 
-000547b0: 6f72 206f 6e65 206f 6620 6120 7061 6972  or one of a pair
-000547c0: 206f 6620 524f 4973 2c20 666f 7220 7768   of ROIs, for wh
-000547d0: 6963 6820 736c 6963 6520 696e 666f 726d  ich slice inform
-000547e0: 6174 696f 6e20 6973 2074 6f0a 2020 2020  ation is to.    
-000547f0: 2020 2020 6265 206f 6274 6169 6e65 642e      be obtained.
-00054800: 0a0a 2020 2020 726f 6932 203a 2073 6b72  ..    roi2 : skr
-00054810: 742e 7374 7275 6374 7572 6573 2e52 4f49  t.structures.ROI
-00054820: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00054830: 2020 2020 2020 2049 6620 6e6f 7420 4e6f         If not No
-00054840: 6e65 2c20 7365 636f 6e64 2069 6e20 6120  ne, second in a 
-00054850: 7061 6972 206f 6620 524f 4973 2066 6f72  pair of ROIs for
-00054860: 2077 6869 6368 2073 6c69 6365 2069 6e66   which slice inf
-00054870: 6f72 6d61 7469 6f6e 0a20 2020 2020 2020  ormation.       
-00054880: 2069 7320 746f 2062 6520 6f62 7461 696e   is to be obtain
-00054890: 6564 2e0a 0a20 2020 2076 6965 7720 3a20  ed...    view : 
-000548a0: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
-000548b0: 7922 0a20 2020 2020 2020 2056 6965 7720  y".        View 
-000548c0: 696e 2077 6869 6368 2074 6f20 6f62 7461  in which to obta
-000548d0: 696e 2073 6c69 6365 732e 0a0a 2020 2020  in slices...    
-000548e0: 706f 7369 7469 6f6e 5f61 735f 6964 7820  position_as_idx 
-000548f0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-00054900: 4661 6c73 650a 2020 2020 2020 2020 4966  False.        If
-00054910: 2054 7275 652c 2072 6574 7572 6e20 706f   True, return po
-00054920: 7369 7469 6f6e 7320 6173 2073 6c69 6365  sitions as slice
-00054930: 2069 6e64 6963 6573 3b20 6966 2046 616c   indices; if Fal
-00054940: 7365 2c0a 2020 2020 2020 2020 7265 7475  se,.        retu
-00054950: 726e 2070 6f73 6974 696f 6e73 2061 7320  rn positions as 
-00054960: 736c 6963 6520 7a2d 636f 6f72 6469 6e61  slice z-coordina
-00054970: 7465 7320 286d 6d29 2e0a 0a20 2020 206d  tes (mm)...    m
-00054980: 6574 686f 643a 2073 7472 2c20 6465 6661  ethod: str, defa
-00054990: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-000549a0: 2053 7472 696e 6720 7370 6563 6966 7969   String specifyi
-000549b0: 6e67 2073 6c69 6365 7320 666f 7220 7768  ng slices for wh
-000549c0: 6963 6820 706f 7369 7469 6f6e 7320 6172  ich positions ar
-000549d0: 6520 746f 2062 6520 6f62 7461 696e 6564  e to be obtained
-000549e0: 2c0a 2020 2020 2020 2020 666f 7220 524f  ,.        for RO
-000549f0: 4973 2072 6f69 312c 2072 6f69 323a 0a0a  Is roi1, roi2:..
-00054a00: 2020 2020 2020 2020 2d20 226c 6566 7422          - "left"
-00054a10: 2028 6f72 2072 6f69 3220 6973 204e 6f6e   (or roi2 is Non
-00054a20: 6529 3a20 7265 7475 726e 2070 6f73 6974  e): return posit
-00054a30: 696f 6e73 206f 6620 736c 6963 6573 2063  ions of slices c
-00054a40: 6f6e 7461 696e 696e 6720 726f 6931 3b0a  ontaining roi1;.
-00054a50: 2020 2020 2020 2020 2d20 2272 6967 6874          - "right
-00054a60: 223a 2072 6574 7572 6e20 706f 7369 7469  ": return positi
-00054a70: 6f6e 7320 6f66 2073 6c69 6365 7320 636f  ons of slices co
-00054a80: 6e74 6169 6e69 6e67 2072 6f69 323b 0a20  ntaining roi2;. 
-00054a90: 2020 2020 2020 202d 2022 756e 696f 6e22         - "union"
-00054aa0: 3a20 7265 7475 726e 2070 6f73 6974 696f  : return positio
-00054ab0: 6e73 206f 6620 736c 6963 6573 2063 6f6e  ns of slices con
-00054ac0: 7461 696e 696e 6720 6569 7468 6572 2072  taining either r
-00054ad0: 6f69 3120 6f72 2072 6f69 323b 0a20 2020  oi1 or roi2;.   
-00054ae0: 2020 2020 202d 2022 696e 7465 7273 6563       - "intersec
-00054af0: 7469 6f6e 223a 2072 6574 7572 6e20 706f  tion": return po
-00054b00: 7369 7469 6f6e 7320 6f66 2073 6c69 6365  sitions of slice
-00054b10: 7320 636f 6e74 6169 6e69 6e67 2062 6f74  s containing bot
-00054b20: 680a 2020 2020 2020 2020 2020 726f 6931  h.          roi1
-00054b30: 2061 6e64 2072 6f69 322e 0a0a 2020 2020   and roi2...    
-00054b40: 2020 2020 4966 204e 6f6e 652c 2076 616c      If None, val
-00054b50: 7565 206f 6620 736b 7274 2e63 6f72 652e  ue of skrt.core.
-00054b60: 4465 6661 756c 7473 2829 2e62 795f 736c  Defaults().by_sl
-00054b70: 6963 6520 6973 2075 7365 642e 0a20 2020  ice is used..   
-00054b80: 2022 2222 0a20 2020 206d 6574 686f 6420   """.    method 
-00054b90: 3d20 6d65 7468 6f64 206f 7220 736b 7274  = method or skrt
-00054ba0: 2e63 6f72 652e 4465 6661 756c 7473 2829  .core.Defaults()
-00054bb0: 2e62 795f 736c 6963 650a 2020 2020 6966  .by_slice.    if
-00054bc0: 206d 6574 686f 6420 6e6f 7420 696e 2067   method not in g
-00054bd0: 6574 5f62 795f 736c 6963 655f 6d65 7468  et_by_slice_meth
-00054be0: 6f64 7328 293a 0a20 2020 2020 2020 2072  ods():.        r
-00054bf0: 6169 7365 2052 756e 7469 6d65 4572 726f  aise RuntimeErro
-00054c00: 7228 6622 4d65 7468 6f64 206d 7573 7420  r(f"Method must 
-00054c10: 6265 206f 6e65 206f 6620 7b67 6574 5f62  be one of {get_b
-00054c20: 795f 736c 6963 655f 6d65 7468 6f64 7328  y_slice_methods(
-00054c30: 297d 220a 2020 2020 2020 2020 2220 2d20  )}".        " - 
-00054c40: 6e6f 7420 277b 6d65 7468 6f64 7d27 2229  not '{method}'")
-00054c50: 0a0a 2020 2020 696e 6469 6365 7320 3d20  ..    indices = 
-00054c60: 4e6f 6e65 0a0a 2020 2020 696e 6469 6365  None..    indice
-00054c70: 7331 203d 2072 6f69 312e 6765 745f 696e  s1 = roi1.get_in
-00054c80: 6469 6365 7328 7669 6577 3d76 6965 772c  dices(view=view,
-00054c90: 206d 6574 686f 643d 226d 6173 6b22 290a   method="mask").
-00054ca0: 2020 2020 6966 206e 6f74 2069 7373 7562      if not issub
-00054cb0: 636c 6173 7328 7479 7065 2872 6f69 3229  class(type(roi2)
-00054cc0: 2c20 524f 4929 206f 7220 226c 6566 7422  , ROI) or "left"
-00054cd0: 203d 3d20 6d65 7468 6f64 3a0a 2020 2020   == method:.    
-00054ce0: 2020 2020 696e 6469 6365 7320 3d20 696e      indices = in
-00054cf0: 6469 6365 7331 0a0a 2020 2020 6966 2069  dices1..    if i
-00054d00: 6e64 6963 6573 2069 7320 4e6f 6e65 3a0a  ndices is None:.
-00054d10: 2020 2020 2020 2020 696e 6469 6365 7332          indices2
-00054d20: 203d 2072 6f69 322e 6765 745f 696e 6469   = roi2.get_indi
-00054d30: 6365 7328 7669 6577 3d76 6965 772c 206d  ces(view=view, m
-00054d40: 6574 686f 643d 226d 6173 6b22 290a 2020  ethod="mask").  
-00054d50: 2020 2020 2020 6966 2022 7269 6768 7422        if "right"
-00054d60: 203d 3d20 6d65 7468 6f64 3a0a 2020 2020   == method:.    
-00054d70: 2020 2020 2020 2020 696e 6469 6365 7320          indices 
-00054d80: 3d20 696e 6469 6365 7332 0a20 2020 2020  = indices2.     
-00054d90: 2020 200a 2020 2020 6966 2069 6e64 6963     .    if indic
-00054da0: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
-00054db0: 2020 2020 6966 2022 756e 696f 6e22 203d      if "union" =
-00054dc0: 3d20 6d65 7468 6f64 3a0a 2020 2020 2020  = method:.      
-00054dd0: 2020 2020 2020 696e 6469 6365 7320 3d20        indices = 
-00054de0: 6c69 7374 2873 6574 2869 6e64 6963 6573  list(set(indices
-00054df0: 3129 2e75 6e69 6f6e 2873 6574 2869 6e64  1).union(set(ind
-00054e00: 6963 6573 3229 2929 0a0a 2020 2020 6966  ices2)))..    if
-00054e10: 2069 6e64 6963 6573 2069 7320 4e6f 6e65   indices is None
-00054e20: 3a0a 2020 2020 2020 2020 6966 2022 696e  :.        if "in
-00054e30: 7465 7273 6563 7469 6f6e 2220 3d3d 206d  tersection" == m
-00054e40: 6574 686f 643a 0a20 2020 2020 2020 2020  ethod:.         
-00054e50: 2020 2069 6e64 6963 6573 203d 206c 6973     indices = lis
-00054e60: 7428 7365 7428 696e 6469 6365 7331 292e  t(set(indices1).
-00054e70: 696e 7465 7273 6563 7469 6f6e 2873 6574  intersection(set
-00054e80: 2869 6e64 6963 6573 3229 2929 0a0a 2020  (indices2)))..  
-00054e90: 2020 6966 2069 6e64 6963 6573 2069 7320    if indices is 
-00054ea0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00054eb0: 2020 6966 2070 6f73 6974 696f 6e5f 6173    if position_as
-00054ec0: 5f69 6478 3a0a 2020 2020 2020 2020 2020  _idx:.          
-00054ed0: 2020 7265 7475 726e 2073 6f72 7465 6428    return sorted(
-00054ee0: 696e 6469 6365 7329 0a20 2020 2020 2020  indices).       
-00054ef0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00054f00: 2020 2061 7820 3d20 736b 7274 2e69 6d61     ax = skrt.ima
-00054f10: 6765 2e5f 736c 6963 655f 6178 6573 5b76  ge._slice_axes[v
-00054f20: 6965 775d 0a20 2020 2020 2020 2020 2020  iew].           
-00054f30: 2072 6574 7572 6e20 736f 7274 6564 285b   return sorted([
-00054f40: 726f 6931 2e69 6478 5f74 6f5f 706f 7328  roi1.idx_to_pos(
-00054f50: 6964 782c 2061 7829 2066 6f72 2069 6478  idx, ax) for idx
-00054f60: 2069 6e20 696e 6469 6365 735d 290a 0a64   in indices])..d
-00054f70: 6566 2065 7870 616e 645f 736c 6963 655f  ef expand_slice_
-00054f80: 7374 6174 7328 736c 6963 655f 7374 6174  stats(slice_stat
-00054f90: 733d 4e6f 6e65 2c20 6465 6661 756c 745f  s=None, default_
-00054fa0: 6279 5f73 6c69 6365 3d4e 6f6e 6529 3a0a  by_slice=None):.
-00054fb0: 2020 2020 2222 220a 2020 2020 4578 7061      """.    Expa
-00054fc0: 6e64 2073 7065 6369 6669 6361 7469 6f6e  nd specification
-00054fd0: 206f 6620 7374 6174 6973 7469 6373 2074   of statistics t
-00054fe0: 6f20 6361 6c63 756c 6174 6520 666f 7220  o calculate for 
-00054ff0: 524f 4920 636f 6d70 6172 6973 6f6e 0a20  ROI comparison. 
-00055000: 2020 206d 6574 7269 6373 2065 7661 6c75     metrics evalu
-00055010: 6174 6564 2073 6c69 6365 2062 7920 736c  ated slice by sl
-00055020: 6963 652e 0a0a 2020 2020 4120 6469 6374  ice...    A dict
-00055030: 696f 6e61 7279 2069 7320 7265 7475 726e  ionary is return
-00055040: 6564 2c20 7768 6572 6520 6b65 7973 2067  ed, where keys g
-00055050: 6976 6520 7468 6520 736c 6963 6573 2074  ive the slices t
-00055060: 6f20 6265 2063 6f6e 7369 6465 7265 640a  o be considered.
-00055070: 2020 2020 666f 7220 6361 6c63 756c 6174      for calculat
-00055080: 696e 6720 7374 6174 6973 7469 6373 2c20  ing statistics, 
-00055090: 616e 6420 7661 6c75 6573 2061 7265 206c  and values are l
-000550a0: 6973 7473 206f 6620 6d65 7472 6963 732e  ists of metrics.
-000550b0: 0a0a 2020 2020 2a2a 5061 7261 6d65 7465  ..    **Paramete
-000550c0: 7273 3a2a 2a0a 0a20 2020 2073 6c69 6365  rs:**..    slice
-000550d0: 5f73 7461 7473 203a 2073 7472 2f6c 6973  _stats : str/lis
-000550e0: 742f 6469 6374 2c20 6465 6661 756c 743d  t/dict, default=
-000550f0: 4e6f 6e65 0a20 2020 2020 2020 2053 7065  None.        Spe
-00055100: 6369 6669 6361 7469 6f6e 206f 6620 7374  cification of st
-00055110: 6174 6973 7469 6373 2074 6f20 6265 2063  atistics to be c
-00055120: 616c 6375 6c61 7465 6420 7265 6c61 7469  alculated relati
-00055130: 7665 0a20 2020 2020 2020 2074 6f20 736c  ve.        to sl
-00055140: 6963 652d 6279 2d73 6c69 6365 206d 6574  ice-by-slice met
-00055150: 7269 6320 7661 6c75 6573 2e0a 0a20 2020  ric values...   
-00055160: 2020 2020 2041 2073 7461 7469 7374 6963       A statistic
-00055170: 2069 7320 7370 6563 6966 6965 6420 6279   is specified by
-00055180: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
-00055190: 2066 756e 6374 696f 6e20 666f 720a 2020   function for.  
-000551a0: 2020 2020 2020 6974 7320 6361 6c63 756c        its calcul
-000551b0: 6174 696f 6e20 696e 2074 6865 2050 7974  ation in the Pyt
-000551c0: 686f 6e20 7374 6174 6973 7469 6373 206d  hon statistics m
-000551d0: 6f64 756c 653a 0a0a 2020 2020 2020 2020  odule:..        
-000551e0: 6874 7470 733a 2f2f 646f 6373 2e70 7974  https://docs.pyt
-000551f0: 686f 6e2e 6f72 672f 332f 6c69 6272 6172  hon.org/3/librar
-00055200: 792f 7374 6174 6973 7469 6373 2e68 746d  y/statistics.htm
-00055210: 6c0a 0a20 2020 2020 2020 2046 6f72 2069  l..        For i
-00055220: 7473 2075 7365 2068 6572 652c 2074 6865  ts use here, the
-00055230: 2072 656c 6576 616e 7420 6675 6e63 7469   relevant functi
-00055240: 6f6e 206d 7573 7420 7265 7175 6972 650a  on must require.
-00055250: 2020 2020 2020 2020 6120 7369 6e67 6c65          a single
-00055260: 2d76 6172 6961 626c 6520 696e 7075 742c  -variable input,
-00055270: 206d 7573 7420 6e6f 7420 7265 7175 6972   must not requir
-00055280: 6520 616e 7920 6b65 7977 6f72 640a 2020  e any keyword.  
-00055290: 2020 2020 2020 6172 6775 6d65 6e74 732c        arguments,
-000552a0: 2061 6e64 206d 7573 7420 7265 7475 726e   and must return
-000552b0: 2061 2073 696e 676c 6520 6e75 6d62 6572   a single number
-000552c0: 2e0a 0a20 2020 2020 2020 2041 7661 696c  ...        Avail
-000552d0: 6162 6c65 206f 7074 696f 6e73 2069 6e63  able options inc
-000552e0: 6c75 6465 3a20 226d 6561 6e22 2c20 226d  lude: "mean", "m
-000552f0: 6564 6961 6e22 2c20 226d 6f64 6522 2c0a  edian", "mode",.
-00055300: 2020 2020 2020 2020 2273 7464 6576 222e          "stdev".
-00055310: 0a0a 2020 2020 2020 2053 7461 7469 7374  ..       Statist
-00055320: 6963 7320 746f 2062 6520 6361 6c63 756c  ics to be calcul
-00055330: 6174 6564 2063 616e 2062 6520 7370 6563  ated can be spec
-00055340: 6966 6965 6420 7573 696e 6720 616e 7920  ified using any 
-00055350: 6f66 0a20 2020 2020 2020 7468 6520 666f  of.       the fo
-00055360: 6c6c 6f77 696e 673a 0a0a 2020 2020 2020  llowing:..      
-00055370: 202d 2053 7472 696e 6720 7370 6563 6966   - String specif
-00055380: 7969 6e67 2073 696e 676c 6520 7374 6174  ying single stat
-00055390: 6973 7469 6320 746f 2062 6520 6361 6c63  istic to be calc
-000553a0: 756c 6174 6564 2c0a 2020 2020 2020 2020  ulated,.        
-000553b0: 2077 6974 6820 736c 6963 6573 2063 6f6e   with slices con
-000553c0: 7369 6465 7265 6420 6173 2067 6976 656e  sidered as given
-000553d0: 2062 7920 3c64 6566 6175 6c74 5f62 795f   by <default_by_
-000553e0: 736c 6963 653e 2c0a 2020 2020 2020 2020  slice>,.        
-000553f0: 2066 6f72 2065 7861 6d70 6c65 3a20 226d   for example: "m
-00055400: 6561 6e22 3b0a 2020 2020 2020 202d 204c  ean";.       - L
-00055410: 6973 7420 7370 6563 6966 7969 6e67 206d  ist specifying m
-00055420: 756c 7469 706c 6520 7374 6174 6973 7469  ultiple statisti
-00055430: 6373 2074 6f20 6265 2063 616c 6375 6c61  cs to be calcula
-00055440: 7465 642c 0a20 2020 2020 2020 2020 7769  ted,.         wi
-00055450: 7468 2073 6c69 6365 7320 636f 6e73 6964  th slices consid
-00055460: 6572 6564 2061 7320 6769 7665 6e20 6279  ered as given by
-00055470: 203c 6465 6661 756c 745f 6279 5f73 6c69   <default_by_sli
-00055480: 6365 3e2c 0a20 2020 2020 2020 2020 666f  ce>,.         fo
-00055490: 7220 6578 616d 706c 653a 205b 226d 6561  r example: ["mea
-000554a0: 6e22 2c20 2273 7464 6576 225d 3b0a 2020  n", "stdev"];.  
-000554b0: 2020 2020 202d 2044 6963 7469 6f6e 6172       - Dictionar
-000554c0: 7920 7768 6572 6520 6b65 7973 2073 7065  y where keys spe
-000554d0: 6369 6679 2073 6c69 6365 7320 746f 2062  cify slices to b
-000554e0: 6520 636f 6e73 6964 6572 6564 2c0a 2020  e considered,.  
-000554f0: 2020 2020 2020 2061 6e64 2076 616c 7565         and value
-00055500: 7320 7370 6563 6966 7920 7374 6174 6973  s specify statis
-00055510: 7469 6373 2028 7374 7269 6e67 206f 7220  tics (string or 
-00055520: 6c69 7374 292c 2066 6f72 0a20 2020 2020  list), for.     
-00055530: 2020 2020 6578 616d 706c 653a 207b 2275      example: {"u
-00055540: 6e69 6f6e 223a 205b 226d 6561 6e22 2c20  nion": ["mean", 
-00055550: 2273 7464 6576 225d 7d2e 2020 5661 6c69  "stdev"]}.  Vali
-00055560: 6420 736c 6963 650a 2020 2020 2020 2020  d slice.        
-00055570: 2073 7065 6369 6669 6361 7469 6f6e 7320   specifications 
-00055580: 6172 6520 6173 206c 6973 7465 6420 666f  are as listed fo
-00055590: 7220 3c64 6566 6175 6c74 5f62 795f 736c  r <default_by_sl
-000555a0: 6963 653e 2e0a 0a20 2020 2064 6566 6175  ice>...    defau
-000555b0: 6c74 5f62 795f 736c 6963 653a 2073 7472  lt_by_slice: str
-000555c0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-000555d0: 2020 2020 2020 2044 6566 6175 6c74 2073         Default s
-000555e0: 7065 6369 6669 6361 7469 6f6e 206f 6620  pecification of 
-000555f0: 736c 6963 6573 2074 6f20 6265 2063 6f6e  slices to be con
-00055600: 7369 6465 7265 6420 7768 656e 0a20 2020  sidered when.   
-00055610: 2020 2020 2063 616c 6375 6c61 7469 6e67       calculating
-00055620: 2073 6c69 6365 2d62 792d 736c 6963 6520   slice-by-slice 
-00055630: 7374 6174 6973 7469 6373 2066 6f72 2061  statistics for a
-00055640: 206d 6574 7269 6320 636f 6d70 6172 696e   metric comparin
-00055650: 670a 2020 2020 2020 2020 7477 6f20 524f  g.        two RO
-00055660: 4973 2c20 726f 6931 2061 6e64 2072 6f69  Is, roi1 and roi
-00055670: 322e 2020 5468 6520 7661 6c69 6420 7370  2.  The valid sp
-00055680: 6563 6966 6963 6174 696f 6e73 2061 7265  ecifications are
-00055690: 3a0a 0a20 2020 2020 2020 202d 2022 6c65  :..        - "le
-000556a0: 6674 223a 2063 6f6e 7369 6465 7220 6f6e  ft": consider on
-000556b0: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
-000556c0: 6e69 6e67 2072 6f69 313b 0a20 2020 2020  ning roi1;.     
-000556d0: 2020 202d 2022 7269 6768 7422 3a20 636f     - "right": co
-000556e0: 6e73 6964 6572 206f 6e6c 7920 736c 6963  nsider only slic
-000556f0: 6573 2063 6f6e 7461 696e 696e 6720 726f  es containing ro
-00055700: 6932 3b0a 2020 2020 2020 2020 2d20 2275  i2;.        - "u
-00055710: 6e69 6f6e 223a 2063 6f6e 7369 6465 7220  nion": consider 
-00055720: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
-00055730: 6720 6569 7468 6572 206f 6620 726f 6931  g either of roi1
-00055740: 2061 6e64 2072 6f69 323b 0a20 2020 2020   and roi2;.     
-00055750: 2020 202d 2022 696e 7465 7273 6563 7469     - "intersecti
-00055760: 6f6e 223a 2063 6f6e 7369 6465 7220 736c  on": consider sl
-00055770: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
-00055780: 626f 7468 2072 6f69 3120 616e 6420 726f  both roi1 and ro
-00055790: 6932 2e0a 0a20 2020 2020 2020 2049 6620  i2...        If 
-000557a0: 4e6f 6e65 2c20 7573 6520 736b 7274 2e63  None, use skrt.c
-000557b0: 6f72 652e 4465 6661 756c 7473 2829 2e62  ore.Defaults().b
-000557c0: 795f 736c 6963 650a 2020 2020 2222 220a  y_slice.    """.
-000557d0: 2020 2020 6966 206e 6f74 2073 6c69 6365      if not slice
-000557e0: 5f73 7461 7473 3a0a 2020 2020 2020 2020  _stats:.        
-000557f0: 7265 7475 726e 207b 7d0a 0a20 2020 2023  return {}..    #
-00055800: 2053 6574 2064 6566 6175 6c74 206d 6574   Set default met
-00055810: 686f 6420 666f 7220 736c 6963 6520 7365  hod for slice se
-00055820: 6c65 6374 696f 6e2e 0a20 2020 2064 6566  lection..    def
-00055830: 6175 6c74 5f62 795f 736c 6963 6520 3d20  ault_by_slice = 
-00055840: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
-00055850: 206f 7220 736b 7274 2e63 6f72 652e 4465   or skrt.core.De
-00055860: 6661 756c 7473 2829 2e62 795f 736c 6963  faults().by_slic
-00055870: 650a 0a20 2020 2023 2045 6e73 7572 6520  e..    # Ensure 
-00055880: 7468 6174 2073 6c69 6365 5f73 7461 7473  that slice_stats
-00055890: 2069 7320 6120 6469 6374 696f 6e61 7279   is a dictionary
-000558a0: 2e0a 2020 2020 6966 2069 7369 6e73 7461  ..    if isinsta
-000558b0: 6e63 6528 736c 6963 655f 7374 6174 732c  nce(slice_stats,
-000558c0: 2073 7472 293a 0a20 2020 2020 2020 2073   str):.        s
-000558d0: 6c69 6365 5f73 7461 7473 203d 207b 6465  lice_stats = {de
-000558e0: 6661 756c 745f 6279 5f73 6c69 6365 3a20  fault_by_slice: 
-000558f0: 5b73 6c69 6365 5f73 7461 7473 5d7d 0a0a  [slice_stats]}..
-00055900: 2020 2020 656c 6966 2073 6b72 742e 636f      elif skrt.co
-00055910: 7265 2e69 735f 6c69 7374 2873 6c69 6365  re.is_list(slice
-00055920: 5f73 7461 7473 293a 0a20 2020 2020 2020  _stats):.       
-00055930: 2073 6c69 6365 5f73 7461 7473 203d 207b   slice_stats = {
-00055940: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
-00055950: 3a20 736c 6963 655f 7374 6174 737d 0a0a  : slice_stats}..
-00055960: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-00055970: 6e63 6528 736c 6963 655f 7374 6174 732c  nce(slice_stats,
-00055980: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
-00055990: 6368 6563 6b65 645f 736c 6963 655f 7374  checked_slice_st
-000559a0: 6174 7320 3d20 7b7d 0a20 2020 2020 2020  ats = {}.       
-000559b0: 2066 6f72 2062 795f 736c 6963 652c 2073   for by_slice, s
-000559c0: 7461 7473 2069 6e20 736c 6963 655f 7374  tats in slice_st
-000559d0: 6174 732e 6974 656d 7328 293a 0a20 2020  ats.items():.   
-000559e0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-000559f0: 7374 616e 6365 2873 7461 7473 2c20 7374  stance(stats, st
-00055a00: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00055a10: 2020 2020 6368 6563 6b65 645f 736c 6963      checked_slic
-00055a20: 655f 7374 6174 735b 6279 5f73 6c69 6365  e_stats[by_slice
-00055a30: 5d20 3d20 5b73 7461 7473 5d0a 2020 2020  ] = [stats].    
-00055a40: 2020 2020 2020 2020 656c 6966 2073 6b72          elif skr
-00055a50: 742e 636f 7265 2e69 735f 6c69 7374 2873  t.core.is_list(s
-00055a60: 7461 7473 293a 0a20 2020 2020 2020 2020  tats):.         
-00055a70: 2020 2020 2020 2063 6865 636b 6564 5f73         checked_s
-00055a80: 6c69 6365 5f73 7461 7473 5b62 795f 736c  lice_stats[by_sl
-00055a90: 6963 655d 203d 206c 6973 7428 7374 6174  ice] = list(stat
-00055aa0: 7329 0a20 2020 2020 2020 2073 6c69 6365  s).        slice
-00055ab0: 5f73 7461 7473 203d 2063 6865 636b 6564  _stats = checked
-00055ac0: 5f73 6c69 6365 5f73 7461 7473 0a0a 2020  _slice_stats..  
-00055ad0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00055ae0: 736c 6963 655f 7374 6174 732c 2064 6963  slice_stats, dic
-00055af0: 7429 3a0a 2020 2020 2020 2020 7265 7475  t):.        retu
-00055b00: 726e 2073 6c69 6365 5f73 7461 7473 0a0a  rn slice_stats..
-00055b10: 2020 2020 7265 7475 726e 207b 7d0a           return {}.
+00049ac0: 2020 2020 2020 2020 2063 7265 6174 655f           create_
+00049ad0: 726f 695f 7375 6d2c 202a 2a6b 7761 7267  roi_sum, **kwarg
+00049ae0: 7329 0a0a 2020 2020 6465 6620 6765 745f  s)..    def get_
+00049af0: 6f76 6572 6c61 7028 7365 6c66 2c20 666f  overlap(self, fo
+00049b00: 7263 653d 4661 6c73 652c 2065 7863 6c75  rce=False, exclu
+00049b10: 6465 3d4e 6f6e 652c 202a 2a6b 7761 7267  de=None, **kwarg
+00049b20: 7329 3a0a 2020 2020 2020 2020 2222 2247  s):.        """G
+00049b30: 6574 2052 4f49 206f 626a 6563 7420 7265  et ROI object re
+00049b40: 7072 6573 656e 7469 6e67 2074 6865 206f  presenting the o
+00049b50: 7665 726c 6170 206f 6620 524f 4973 2069  verlap of ROIs i
+00049b60: 6e20 7468 6973 200a 2020 2020 2020 2020  n this .        
+00049b70: 7374 7275 6374 7572 6520 7365 742e 2049  structure set. I
+00049b80: 6620 3c65 7863 6c75 6465 3e20 6973 2073  f <exclude> is s
+00049b90: 6574 2074 6f20 6120 7374 7269 6e67 2c20  et to a string, 
+00049ba0: 7468 6520 524f 4920 7769 7468 2074 6861  the ROI with tha
+00049bb0: 7420 6e61 6d65 200a 2020 2020 2020 2020  t name .        
+00049bc0: 7769 6c6c 2062 6520 6578 636c 7564 6564  will be excluded
+00049bd0: 2066 726f 6d20 7468 6520 6361 6c63 756c   from the calcul
+00049be0: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
+00049bf0: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+00049c00: 0a20 2020 2020 2020 2066 6f72 6365 203a  .        force :
+00049c10: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
+00049c20: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00049c30: 2049 6620 4661 6c73 6520 616e 6420 6f76   If False and ov
+00049c40: 6572 6c61 7020 524f 4920 6861 7320 616c  erlap ROI has al
+00049c50: 7265 6164 7920 6265 656e 2063 7265 6174  ready been creat
+00049c60: 6564 2c20 7468 6520 0a20 2020 2020 2020  ed, the .       
+00049c70: 2020 2020 2070 7265 7669 6f75 736c 7920       previously 
+00049c80: 636f 6d70 7574 6564 2052 4f49 2077 696c  computed ROI wil
+00049c90: 6c20 6265 2072 6574 7572 6e65 642e 2049  l be returned. I
+00049ca0: 6620 466f 7263 653d 5472 7565 2c20 7468  f Force=True, th
+00049cb0: 6520 0a20 2020 2020 2020 2020 2020 206f  e .            o
+00049cc0: 7665 726c 6170 2052 4f49 2077 696c 6c20  verlap ROI will 
+00049cd0: 6265 2072 6563 7265 6174 6564 2e0a 0a20  be recreated... 
+00049ce0: 2020 2020 2020 2065 7863 6c75 6465 203a         exclude :
+00049cf0: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
+00049d00: 6e65 0a20 2020 2020 2020 2020 2020 2049  ne.            I
+00049d10: 6620 7365 7420 746f 2061 2073 7472 696e  f set to a strin
+00049d20: 672c 2074 6865 2066 6972 7374 2052 4f49  g, the first ROI
+00049d30: 2069 6e20 7365 6c66 2e72 6f69 7320 7769   in self.rois wi
+00049d40: 7468 2074 6861 7420 6e61 6d65 2077 696c  th that name wil
+00049d50: 6c20 0a20 2020 2020 2020 2020 2020 2062  l .            b
+00049d60: 6520 6578 636c 7564 6564 2066 726f 6d20  e excluded from 
+00049d70: 7468 6520 636f 6d62 696e 6174 696f 6e2e  the combination.
+00049d80: 2054 6869 7320 6d61 7920 6265 2075 7365   This may be use
+00049d90: 6675 6c20 6966 2063 6f6d 7061 7269 736f  ful if compariso
+00049da0: 6e20 0a20 2020 2020 2020 2020 2020 206f  n .            o
+00049db0: 6620 6120 7369 6e67 6c65 2052 4f49 2077  f a single ROI w
+00049dc0: 6974 6820 7468 6520 636f 6e73 656e 7375  ith the consensu
+00049dd0: 7320 6f66 2061 6c6c 206f 7468 6572 7320  s of all others 
+00049de0: 6973 2064 6573 6972 6564 2e0a 0a20 2020  is desired...   
+00049df0: 2020 2020 2060 2a2a 606b 7761 7267 7320       `**`kwargs 
+00049e00: 3a0a 2020 2020 2020 2020 2020 2020 4578  :.            Ex
+00049e10: 7472 6120 6b65 7977 6f72 6420 6172 6775  tra keyword argu
+00049e20: 6d65 6e74 7320 746f 2070 6173 7320 746f  ments to pass to
+00049e30: 2074 6865 2063 7265 6174 696f 6e20 6f66   the creation of
+00049e40: 2074 6865 2052 4f49 206f 626a 6563 740a   the ROI object.
+00049e50: 2020 2020 2020 2020 2020 2020 7265 7072              repr
+00049e60: 6573 656e 7469 6e67 2074 6865 2063 6f6d  esenting the com
+00049e70: 6269 6e61 7469 6f6e 2e0a 2020 2020 2020  bination..      
+00049e80: 2020 2222 220a 0a20 2020 2020 2020 2072    """..        r
+00049e90: 6574 7572 6e20 7365 6c66 2e5f 6765 745f  eturn self._get_
+00049ea0: 636f 6d62 696e 6174 696f 6e28 226f 7665  combination("ove
+00049eb0: 726c 6170 222c 2066 6f72 6365 2c20 6578  rlap", force, ex
+00049ec0: 636c 7564 652c 200a 2020 2020 2020 2020  clude, .        
+00049ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049ee0: 2020 2020 2020 2020 2020 2020 2063 7265               cre
+00049ef0: 6174 655f 726f 695f 6f76 6572 6c61 702c  ate_roi_overlap,
+00049f00: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+00049f10: 6465 6620 7472 616e 7366 6f72 6d28 7365  def transform(se
+00049f20: 6c66 2c20 7363 616c 653d 312c 2074 7261  lf, scale=1, tra
+00049f30: 6e73 6c61 7469 6f6e 3d5b 302c 2030 2c20  nslation=[0, 0, 
+00049f40: 305d 2c20 726f 7461 7469 6f6e 3d5b 302c  0], rotation=[0,
+00049f50: 2030 2c20 305d 2c0a 2020 2020 2020 2020   0, 0],.        
+00049f60: 2020 2020 6365 6e74 7265 3d5b 302c 2030      centre=[0, 0
+00049f70: 2c20 305d 2c20 7265 7361 6d70 6c65 3d22  , 0], resample="
+00049f80: 6669 6e65 222c 2072 6573 746f 7265 3d54  fine", restore=T
+00049f90: 7275 652c 200a 2020 2020 2020 2020 2020  rue, .          
+00049fa0: 2020 6669 6c6c 5f76 616c 7565 3d4e 6f6e    fill_value=Non
+00049fb0: 652c 2066 6f72 6365 5f63 6f6e 746f 7572  e, force_contour
+00049fc0: 733d 4661 6c73 652c 206e 616d 6573 3d4e  s=False, names=N
+00049fd0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
+00049fe0: 220a 2020 2020 2020 2020 4170 706c 7920  ".        Apply 
+00049ff0: 7468 7265 652d 6469 6d65 6e73 696f 6e61  three-dimensiona
+0004a000: 6c20 7369 6d69 6c61 7269 7479 2074 7261  l similarity tra
+0004a010: 6e73 666f 726d 2074 6f20 7374 7275 6374  nsform to struct
+0004a020: 7572 652d 7365 7420 524f 4973 2e0a 0a20  ure-set ROIs... 
+0004a030: 2020 2020 2020 2049 6620 7468 6520 7472         If the tr
+0004a040: 616e 7366 6f72 6d20 636f 7272 6573 706f  ansform correspo
+0004a050: 6e64 7320 746f 2061 2074 7261 6e73 6c61  nds to a transla
+0004a060: 7469 6f6e 2061 6e64 2f6f 7220 726f 7461  tion and/or rota
+0004a070: 7469 6f6e 0a20 2020 2020 2020 2061 626f  tion.        abo
+0004a080: 7574 2074 6865 207a 2d61 7869 732c 2061  ut the z-axis, a
+0004a090: 6e64 2065 6974 6865 7220 7468 6520 726f  nd either the ro
+0004a0a0: 6920 736f 7572 6365 2074 7970 6520 6973  i source type is
+0004a0b0: 2022 6469 636f 6d22 0a20 2020 2020 2020   "dicom".       
+0004a0c0: 206f 7220 666f 7263 652d 636f 6e74 6f75   or force-contou
+0004a0d0: 7273 2069 7320 5472 7565 2c20 7468 6520  rs is True, the 
+0004a0e0: 7472 616e 7366 6f72 6d20 6973 2061 7070  transform is app
+0004a0f0: 6c69 6564 2074 6f20 636f 6e74 6f75 720a  lied to contour.
+0004a100: 2020 2020 2020 2020 706f 696e 7473 2061          points a
+0004a110: 6e64 2074 6865 2072 6f69 206d 6173 6b20  nd the roi mask 
+0004a120: 6973 2073 6574 2061 7320 756e 6c6f 6164  is set as unload
+0004a130: 6564 2e20 204f 7468 6572 7769 7365 2074  ed.  Otherwise t
+0004a140: 6865 2074 7261 6e73 666f 726d 0a20 2020  he transform.   
+0004a150: 2020 2020 2069 7320 6170 706c 6965 6420       is applied 
+0004a160: 746f 2074 6865 206d 6173 6b20 616e 6420  to the mask and 
+0004a170: 636f 6e74 6f75 7273 2061 7265 2073 6574  contours are set
+0004a180: 2061 7320 756e 6c6f 6164 6564 2e0a 0a20   as unloaded... 
+0004a190: 2020 2020 2020 2054 6865 2074 7261 6e73         The trans
+0004a1a0: 666f 726d 2069 7320 6170 706c 6965 6420  form is applied 
+0004a1b0: 696e 2074 6865 206f 7264 6572 3a20 7472  in the order: tr
+0004a1c0: 616e 736c 6174 696f 6e2c 2073 6361 6c69  anslation, scali
+0004a1d0: 6e67 2c0a 2020 2020 2020 2020 726f 7461  ng,.        rota
+0004a1e0: 7469 6f6e 2e20 2054 6865 206c 6174 7465  tion.  The latte
+0004a1f0: 7220 7477 6f20 6172 6520 6162 6f75 7420  r two are about 
+0004a200: 7468 6520 6365 6e74 7265 2063 6f6f 7264  the centre coord
+0004a210: 696e 6174 6573 2e0a 0a20 2020 2020 2020  inates...       
+0004a220: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+0004a230: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0004a240: 2020 666f 7263 655f 636f 6e74 6f75 7273    force_contours
+0004a250: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+0004a260: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+0004a270: 2020 2049 6620 5472 7565 2c20 616e 6420     If True, and 
+0004a280: 7468 6520 7472 616e 7366 6f72 6d20 636f  the transform co
+0004a290: 7272 6573 706f 6e64 7320 746f 2061 2074  rresponds to a t
+0004a2a0: 7261 6e73 6c61 7469 6f6e 0a20 2020 2020  ranslation.     
+0004a2b0: 2020 2020 2020 2061 6e64 2f6f 7220 726f         and/or ro
+0004a2c0: 7461 7469 6f6e 2061 626f 7574 2074 6865  tation about the
+0004a2d0: 207a 2d61 7869 732c 2061 7070 6c79 2074   z-axis, apply t
+0004a2e0: 7261 6e73 666f 726d 2074 6f20 636f 6e74  ransform to cont
+0004a2f0: 6f75 720a 2020 2020 2020 2020 2020 2020  our.            
+0004a300: 706f 696e 7473 2069 6e64 6570 656e 6465  points independe
+0004a310: 6e74 6c79 206f 6620 7468 6520 6f72 6967  ntly of the orig
+0004a320: 696e 616c 2064 6174 6120 736f 7572 6365  inal data source
+0004a330: 2e0a 0a20 2020 2020 2020 206e 616d 6573  ...        names
+0004a340: 203a 206c 6973 742f 4e6f 6e65 2c20 6465   : list/None, de
+0004a350: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+0004a360: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
+0004a370: 524f 4973 2074 6f20 7768 6963 6820 7472  ROIs to which tr
+0004a380: 616e 7366 6f72 6d20 6973 2074 6f20 6265  ansform is to be
+0004a390: 2061 7070 6c69 6564 2e20 2049 6620 4e6f   applied.  If No
+0004a3a0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+0004a3b0: 7472 616e 7366 6f72 6d20 6973 2061 7070  transform is app
+0004a3c0: 6c69 6564 2074 6f20 616c 6c20 524f 4973  lied to all ROIs
+0004a3d0: 2e0a 0a20 2020 2020 2020 2046 6f72 206f  ...        For o
+0004a3e0: 7468 6572 2070 6172 616d 6574 6572 732c  ther parameters,
+0004a3f0: 2073 6565 2064 6f63 756d 656e 7461 7469   see documentati
+0004a400: 6f6e 2066 6f72 0a20 2020 2020 2020 2073  on for.        s
+0004a410: 6b72 742e 696d 6167 652e 496d 6167 652e  krt.image.Image.
+0004a420: 7472 616e 7366 6f72 6d28 292e 2020 4e6f  transform().  No
+0004a430: 7465 2074 6861 7420 7468 6520 6060 6f72  te that the ``or
+0004a440: 6465 7260 600a 2020 2020 2020 2020 7061  der``.        pa
+0004a450: 7261 6d65 7465 7220 6973 6e27 7420 6176  rameter isn't av
+0004a460: 6169 6c61 626c 6520 666f 7220 7374 7275  ailable for stru
+0004a470: 6374 7572 652d 7365 7420 7472 616e 7366  cture-set transf
+0004a480: 6f72 6d73 202d 2061 2076 616c 7565 206f  orms - a value o
+0004a490: 6620 300a 2020 2020 2020 2020 6973 2075  f 0.        is u
+0004a4a0: 7365 6420 616c 7761 7973 2e0a 2020 2020  sed always..    
+0004a4b0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+0004a4c0: 2066 6f72 2072 6f69 2069 6e20 7365 6c66   for roi in self
+0004a4d0: 2e67 6574 5f72 6f69 7328 6e61 6d65 7329  .get_rois(names)
+0004a4e0: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
+0004a4f0: 692e 7472 616e 7366 6f72 6d28 7363 616c  i.transform(scal
+0004a500: 652c 2074 7261 6e73 6c61 7469 6f6e 2c20  e, translation, 
+0004a510: 726f 7461 7469 6f6e 2c20 6365 6e74 7265  rotation, centre
+0004a520: 2c20 7265 7361 6d70 6c65 2c0a 2020 2020  , resample,.    
+0004a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a540: 7265 7374 6f72 652c 2066 696c 6c5f 7661  restore, fill_va
+0004a550: 6c75 652c 2066 6f72 6365 5f63 6f6e 746f  lue, force_conto
+0004a560: 7572 7329 0a0a 2020 2020 2020 2020 7265  urs)..        re
+0004a570: 7475 726e 204e 6f6e 650a 0a20 2020 2064  turn None..    d
+0004a580: 6566 2061 6464 5f70 6c61 6e28 7365 6c66  ef add_plan(self
+0004a590: 2c20 706c 616e 293a 0a20 2020 2020 2020  , plan):.       
+0004a5a0: 2022 2222 4164 6420 6120 506c 616e 206f   """Add a Plan o
+0004a5b0: 626a 6563 7420 746f 2062 6520 6173 736f  bject to be asso
+0004a5c0: 6369 6174 6564 2077 6974 6820 7468 6973  ciated with this
+0004a5d0: 2073 7472 7563 7475 7265 2073 6574 2061   structure set a
+0004a5e0: 6e64 0a20 2020 2020 2020 2069 7473 2052  nd.        its R
+0004a5f0: 4f49 732e 2054 6869 7320 646f 6573 206e  OIs. This does n
+0004a600: 6f74 2061 6666 6563 7420 7468 6520 7374  ot affect the st
+0004a610: 7275 6374 7572 6520 7365 7420 6173 736f  ructure set asso
+0004a620: 6369 6174 6564 2077 6974 680a 2020 2020  ciated with.    
+0004a630: 2020 2020 7468 6520 506c 616e 206f 626a      the Plan obj
+0004a640: 6563 742e 0a0a 2020 2020 2020 2020 2a2a  ect...        **
+0004a650: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
+0004a660: 2020 2020 2020 2070 6c61 6e20 3a20 736b         plan : sk
+0004a670: 7274 2e64 6f73 652e 506c 616e 0a20 2020  rt.dose.Plan.   
+0004a680: 2020 2020 2020 2020 2041 2050 6c61 6e20           A Plan 
+0004a690: 6f62 6a65 6374 2074 6f20 6173 7369 676e  object to assign
+0004a6a0: 2074 6f20 7468 6973 2073 7472 7563 7475   to this structu
+0004a6b0: 7265 2073 6574 2e0a 2020 2020 2020 2020  re set..        
+0004a6c0: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
+0004a6d0: 6e6f 7420 706c 616e 2069 6e20 7365 6c66  not plan in self
+0004a6e0: 2e70 6c61 6e73 3a0a 2020 2020 2020 2020  .plans:.        
+0004a6f0: 2020 2020 7365 6c66 2e70 6c61 6e73 2e61      self.plans.a
+0004a700: 7070 656e 6428 706c 616e 290a 2020 2020  ppend(plan).    
+0004a710: 2020 2020 2020 2020 7365 6c66 2e70 6c61          self.pla
+0004a720: 6e73 2e73 6f72 7428 290a 0a20 2020 2020  ns.sort()..     
+0004a730: 2020 2020 2020 2066 6f72 2072 6f69 2069         for roi i
+0004a740: 6e20 7365 6c66 2e72 6f69 733a 0a20 2020  n self.rois:.   
+0004a750: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+0004a760: 2e61 6464 5f70 6c61 6e28 706c 616e 290a  .add_plan(plan).
+0004a770: 0a20 2020 2064 6566 2063 6c65 6172 5f70  .    def clear_p
+0004a780: 6c61 6e73 2873 656c 6629 3a0a 2020 2020  lans(self):.    
+0004a790: 2020 2020 2222 2243 6c65 6172 2061 6c6c      """Clear all
+0004a7a0: 2070 6c61 6e20 6d61 7073 2061 7373 6f63   plan maps assoc
+0004a7b0: 6961 7465 6420 7769 7468 2074 6869 7320  iated with this 
+0004a7c0: 7374 7275 6374 7572 6520 7365 742e 2222  structure set.""
+0004a7d0: 220a 0a20 2020 2020 2020 2073 656c 662e  "..        self.
+0004a7e0: 706c 616e 7320 3d20 5b5d 0a0a 2020 2020  plans = []..    
+0004a7f0: 6465 6620 6765 745f 706c 616e 7328 7365  def get_plans(se
+0004a800: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0004a810: 5265 7475 726e 206c 6973 7420 6f66 2050  Return list of P
+0004a820: 6c61 6e20 6f62 6a65 6374 7320 6173 736f  lan objects asso
+0004a830: 6369 6174 6564 2077 6974 6820 7468 6973  ciated with this
+0004a840: 2073 7472 7563 7475 7265 2073 6574 2e22   structure set."
+0004a850: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
+0004a860: 726e 2073 656c 662e 706c 616e 730a 0a20  rn self.plans.. 
+0004a870: 2020 2064 6566 2069 6e74 6572 706f 6c61     def interpola
+0004a880: 7465 5f70 6f69 6e74 7328 7365 6c66 2c20  te_points(self, 
+0004a890: 6e5f 706f 696e 743d 4e6f 6e65 2c20 6478  n_point=None, dx
+0004a8a0: 793d 4e6f 6e65 2c0a 2020 2020 2020 2020  y=None,.        
+0004a8b0: 736d 6f6f 7468 6e65 7373 5f70 6572 5f70  smoothness_per_p
+0004a8c0: 6f69 6e74 3d30 293a 0a20 2020 2020 2020  oint=0):.       
+0004a8d0: 2027 2727 0a20 2020 2020 2020 2052 6574   '''.        Ret
+0004a8e0: 7572 6e20 6e65 7720 5374 7275 6374 7572  urn new Structur
+0004a8f0: 6553 6574 206f 626a 6563 742c 2077 6974  eSet object, wit
+0004a900: 6820 696e 7465 7270 6f6c 6174 6564 2063  h interpolated c
+0004a910: 6f6e 746f 7572 2070 6f69 6e74 732e 0a0a  ontour points...
+0004a920: 2020 2020 2020 2020 506f 696e 7473 2061          Points a
+0004a930: 7265 2069 6e74 6572 706f 6c61 7465 6420  re interpolated 
+0004a940: 666f 7220 6561 6368 2063 6f6e 746f 7572  for each contour
+0004a950: 206f 6620 6561 6368 2052 4f49 2e0a 0a20   of each ROI... 
+0004a960: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
+0004a970: 6572 733a 2a2a 0a0a 2020 2020 2020 2020  ers:**..        
+0004a980: 6e5f 706f 696e 7420 3a20 696e 742c 2064  n_point : int, d
+0004a990: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0004a9a0: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
+0004a9b0: 6620 706f 696e 7473 2070 6572 2063 6f6e  f points per con
+0004a9c0: 746f 7572 2c20 6166 7465 7220 696e 7465  tour, after inte
+0004a9d0: 7270 6f6c 6174 696f 6e2e 2020 5468 6973  rpolation.  This
+0004a9e0: 206d 7573 740a 2020 2020 2020 2020 2020   must.          
+0004a9f0: 2020 6265 2073 6574 2074 6f20 4e6f 6e65    be set to None
+0004aa00: 2066 6f72 2064 7879 2074 6f20 6265 2063   for dxy to be c
+0004aa10: 6f6e 7369 6465 7265 642e 0a0a 2020 2020  onsidered...    
+0004aa20: 2020 2020 6478 7920 3a20 666c 6f61 742c      dxy : float,
+0004aa30: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0004aa40: 2020 2020 2020 2020 2020 4170 7072 6f78            Approx
+0004aa50: 696d 6174 6520 6469 7374 616e 6365 2072  imate distance r
+0004aa60: 6571 7569 7265 6420 6265 7477 6565 6e20  equired between 
+0004aa70: 636f 6e74 6f75 7220 706f 696e 7473 2e20  contour points. 
+0004aa80: 2054 6869 7320 6973 2074 616b 656e 0a20   This is taken. 
+0004aa90: 2020 2020 2020 2020 2020 2069 6e74 6f20             into 
+0004aaa0: 6163 636f 756e 7420 6f6e 6c79 2069 6620  account only if 
+0004aab0: 6e5f 706f 696e 7420 6973 2073 6574 2074  n_point is set t
+0004aac0: 6f20 4e6f 6e65 2e20 2046 6f72 2061 2063  o None.  For a c
+0004aad0: 6f6e 746f 7572 206f 660a 2020 2020 2020  ontour of.      
+0004aae0: 2020 2020 2020 6c65 6e67 7468 2063 6f6e        length con
+0004aaf0: 746f 7572 5f6c 656e 6774 682c 2074 6865  tour_length, the
+0004ab00: 206e 756d 6265 7220 6f66 2063 6f6e 746f   number of conto
+0004ab10: 7572 2070 6f69 6e74 7320 6973 2074 6865  ur points is the
+0004ab20: 6e20 7461 6b65 6e0a 2020 2020 2020 2020  n taken.        
+0004ab30: 2020 2020 746f 2062 6520 6d61 7828 696e      to be max(in
+0004ab40: 7428 636f 6e74 6f75 725f 6c65 6e67 7468  t(contour_length
+0004ab50: 202f 2064 7879 292c 2033 292e 2020 0a0a   / dxy), 3).  ..
+0004ab60: 2020 2020 2020 2020 736d 6f6f 7468 6e65          smoothne
+0004ab70: 7373 5f70 6572 5f70 6f69 6e74 203a 2066  ss_per_point : f
+0004ab80: 6c6f 6174 2c20 6465 6661 756c 743d 300a  loat, default=0.
+0004ab90: 2020 2020 2020 2020 2020 2020 5061 7261              Para
+0004aba0: 6d65 7465 7220 6465 7465 726d 696e 696e  meter determinin
+0004abb0: 6720 7468 6520 736d 6f6f 7468 6e65 7373  g the smoothness
+0004abc0: 206f 6620 7468 6520 422d 7370 6c69 6e65   of the B-spline
+0004abd0: 2063 7572 7665 2075 7365 640a 2020 2020   curve used.    
+0004abe0: 2020 2020 2020 2020 696e 2063 6f6e 746f          in conto
+0004abf0: 7572 2061 7070 726f 7869 6d61 7469 6f6e  ur approximation
+0004ac00: 2066 6f72 2069 6e74 6572 706f 6c61 7469   for interpolati
+0004ac10: 6f6e 2e20 2054 6865 2070 726f 6475 6374  on.  The product
+0004ac20: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
+0004ac30: 736d 6f6f 7468 6e65 7373 5f70 6572 5f70  smoothness_per_p
+0004ac40: 6f69 6e74 2061 6e64 2074 6865 206e 756d  oint and the num
+0004ac50: 6265 7220 6f66 2063 6f6e 746f 7572 2070  ber of contour p
+0004ac60: 6f69 6e74 7320 2873 7065 6369 6669 6564  oints (specified
+0004ac70: 0a20 2020 2020 2020 2020 2020 2064 6972  .            dir
+0004ac80: 6563 746c 7920 7669 6120 6e5f 706f 696e  ectly via n_poin
+0004ac90: 742c 206f 7220 696e 6469 7265 6374 6c79  t, or indirectly
+0004aca0: 2076 6961 2064 7879 2920 636f 7272 6573   via dxy) corres
+0004acb0: 706f 6e64 7320 746f 2074 6865 0a20 2020  ponds to the.   
+0004acc0: 2020 2020 2020 2020 2070 6172 616d 6574           paramet
+0004acd0: 6572 2073 206f 6620 7363 6970 792e 696e  er s of scipy.in
+0004ace0: 7465 7270 6f6c 6174 652e 7370 6c70 7265  terpolate.splpre
+0004acf0: 7020 2d20 7365 6520 646f 6375 6d65 6e74  p - see document
+0004ad00: 6174 696f 6e20 6174 3a0a 2020 2020 2020  ation at:.      
+0004ad10: 2020 0a20 2020 2020 2020 2020 2020 2068    .            h
+0004ad20: 7474 7073 3a2f 2f73 6369 7079 2e67 6974  ttps://scipy.git
+0004ad30: 6875 622e 696f 2f64 6576 646f 6373 2f72  hub.io/devdocs/r
+0004ad40: 6566 6572 656e 6365 2f67 656e 6572 6174  eference/generat
+0004ad50: 6564 2f73 6369 7079 2e69 6e74 6572 706f  ed/scipy.interpo
+0004ad60: 6c61 7465 2e73 706c 7072 6570 2e68 746d  late.splprep.htm
+0004ad70: 6c23 7363 6970 792e 696e 7465 7270 6f6c  l#scipy.interpol
+0004ad80: 6174 652e 7370 6c70 7265 700a 0a20 2020  ate.splprep..   
+0004ad90: 2020 2020 2020 2020 2041 2073 6d6f 6f74           A smoot
+0004ada0: 686e 6573 735f 7065 725f 706f 696e 7420  hness_per_point 
+0004adb0: 6f66 2030 2066 6f72 6365 7320 7468 6520  of 0 forces the 
+0004adc0: 422d 7370 6c69 6e65 2074 6f20 7061 7373  B-spline to pass
+0004add0: 2074 6872 6f75 6768 0a20 2020 2020 2020   through.       
+0004ade0: 2020 2020 2061 6c6c 206f 6620 7468 6520       all of the 
+0004adf0: 7072 652d 696e 7465 7270 6f6c 6174 696f  pre-interpolatio
+0004ae00: 6e20 636f 6e74 6f75 7220 706f 696e 7473  n contour points
+0004ae10: 2e0a 2020 2020 2020 2020 2727 270a 0a20  ..        '''.. 
+0004ae20: 2020 2020 2020 2023 2049 6e74 6572 706f         # Interpo
+0004ae30: 6c61 7465 2070 6f69 6e74 7320 666f 7220  late points for 
+0004ae40: 7468 6520 726f 6973 0a20 2020 2020 2020  the rois.       
+0004ae50: 2072 6f69 7320 3d20 5b5d 0a20 2020 2020   rois = [].     
+0004ae60: 2020 2066 6f72 2072 6f69 2069 6e20 7365     for roi in se
+0004ae70: 6c66 2e67 6574 5f72 6f69 7328 293a 0a20  lf.get_rois():. 
+0004ae80: 2020 2020 2020 2020 2020 2072 6f69 732e             rois.
+0004ae90: 6170 7065 6e64 2872 6f69 2e69 6e74 6572  append(roi.inter
+0004aea0: 706f 6c61 7465 5f70 6f69 6e74 7328 0a20  polate_points(. 
+0004aeb0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0004aec0: 5f70 6f69 6e74 2c20 6478 792c 2073 6d6f  _point, dxy, smo
+0004aed0: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
+0004aee0: 7429 290a 0a20 2020 2020 2020 2023 2043  t))..        # C
+0004aef0: 6c6f 6e65 2073 656c 662c 2074 6865 6e20  lone self, then 
+0004af00: 7265 7365 7420 736f 7572 6365 2061 6e64  reset source and
+0004af10: 2072 6f69 730a 2020 2020 2020 2020 7373   rois.        ss
+0004af20: 203d 2053 7472 7563 7475 7265 5365 7428   = StructureSet(
+0004af30: 7365 6c66 290a 2020 2020 2020 2020 7373  self).        ss
+0004af40: 2e73 6f75 7263 6573 203d 2072 6f69 730a  .sources = rois.
+0004af50: 2020 2020 2020 2020 7373 2e72 6f69 7320          ss.rois 
+0004af60: 3d20 726f 6973 0a0a 2020 2020 2020 2020  = rois..        
+0004af70: 7265 7475 726e 2073 730a 0a20 2020 2064  return ss..    d
+0004af80: 6566 206f 7264 6572 5f72 6f69 7328 7365  ef order_rois(se
+0004af90: 6c66 2c20 6f72 6465 723d 2778 2b27 293a  lf, order='x+'):
+0004afa0: 0a20 2020 2020 2020 2027 2727 0a20 2020  .        '''.   
+0004afb0: 2020 2020 204f 7264 6572 2052 4f49 7320       Order ROIs 
+0004afc0: 6279 206f 6e65 206f 6620 7468 6569 7220  by one of their 
+0004afd0: 6365 6e74 726f 6964 2063 6f6f 7264 696e  centroid coordin
+0004afe0: 6174 6573 2e0a 0a20 2020 2020 2020 202a  ates...        *
+0004aff0: 2a50 6172 616d 6574 6572 3a2a 2a0a 0a20  *Parameter:**.. 
+0004b000: 2020 2020 2020 206f 7264 6572 203a 2073         order : s
+0004b010: 7472 2c20 6465 6661 756c 743d 2778 2b27  tr, default='x+'
+0004b020: 0a20 2020 2020 2020 2020 2020 2053 7065  .            Spe
+0004b030: 6369 6669 6361 7469 6f6e 206f 6620 7761  cification of wa
+0004b040: 7920 6974 2077 6869 6368 2052 4f49 7320  y it which ROIs 
+0004b050: 6172 6520 746f 2062 6520 6f72 6465 7264  are to be orderd
+0004b060: 3a0a 2020 2020 2020 2020 2020 2020 2d20  :.            - 
+0004b070: 2778 2b27 203a 2069 6e20 6f72 6465 7220  'x+' : in order 
+0004b080: 6f66 2069 6e63 7265 6173 696e 6720 7820  of increasing x 
+0004b090: 7661 6c75 652e 0a20 2020 2020 2020 2020  value..         
+0004b0a0: 2020 202d 2027 782d 2720 3a20 696e 206f     - 'x-' : in o
+0004b0b0: 7264 6572 206f 6620 6465 6372 6561 7369  rder of decreasi
+0004b0c0: 6e67 2078 2076 616c 7565 2e0a 2020 2020  ng x value..    
+0004b0d0: 2020 2020 2020 2020 2d20 2779 2b27 203a          - 'y+' :
+0004b0e0: 2069 6e20 6f72 6465 7220 6f66 2069 6e63   in order of inc
+0004b0f0: 7265 6173 696e 6720 7920 7661 6c75 652e  reasing y value.
+0004b100: 0a20 2020 2020 2020 2020 2020 202d 2027  .            - '
+0004b110: 792d 2720 3a20 696e 206f 7264 6572 206f  y-' : in order o
+0004b120: 6620 6465 6372 6561 7369 6e67 2079 2076  f decreasing y v
+0004b130: 616c 7565 2e0a 2020 2020 2020 2020 2020  alue..          
+0004b140: 2020 2d20 277a 2b27 203a 2069 6e20 6f72    - 'z+' : in or
+0004b150: 6465 7220 6f66 2069 6e63 7265 6173 696e  der of increasin
+0004b160: 6720 7a20 7661 6c75 652e 0a20 2020 2020  g z value..     
+0004b170: 2020 2020 2020 202d 2027 7a2d 2720 3a20         - 'z-' : 
+0004b180: 696e 206f 7264 6572 206f 6620 6465 6372  in order of decr
+0004b190: 6561 7369 6e67 207a 2076 616c 7565 2e0a  easing z value..
+0004b1a0: 2020 2020 2020 2020 2727 270a 0a20 2020          '''..   
+0004b1b0: 2020 2020 2069 6620 6f72 6465 7220 6e6f       if order no
+0004b1c0: 7420 696e 205b 2778 2b27 2c20 2778 2d27  t in ['x+', 'x-'
+0004b1d0: 2c20 2779 2b27 2c20 2779 2d27 2c20 277a  , 'y+', 'y-', 'z
+0004b1e0: 2b27 2c20 277a 2d27 5d3a 0a20 2020 2020  +', 'z-']:.     
+0004b1f0: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
+0004b200: 2020 2020 2020 2023 2044 6574 6572 6d69         # Determi
+0004b210: 6e65 2061 7869 7320 666f 7220 6f72 6465  ne axis for orde
+0004b220: 7269 6e67 2c20 616e 6420 6469 7265 6374  ring, and direct
+0004b230: 696f 6e2e 0a20 2020 2020 2020 2061 7869  ion..        axi
+0004b240: 7320 3d20 2778 797a 272e 6669 6e64 286f  s = 'xyz'.find(o
+0004b250: 7264 6572 5b30 5d29 0a20 2020 2020 2020  rder[0]).       
+0004b260: 2072 6576 6572 7365 203d 2028 272d 2720   reverse = ('-' 
+0004b270: 696e 206f 7264 6572 290a 0a20 2020 2020  in order)..     
+0004b280: 2020 2023 2043 7265 6174 6520 6469 6374     # Create dict
+0004b290: 696f 6e61 7279 2077 6865 7265 206b 6579  ionary where key
+0004b2a0: 7320 6172 6520 6365 6e74 726f 6964 2063  s are centroid c
+0004b2b0: 6f6f 7264 696e 6174 6573 0a20 2020 2020  oordinates.     
+0004b2c0: 2020 2023 2061 6e64 2076 616c 7565 7320     # and values 
+0004b2d0: 6172 6520 6c69 7374 7320 6f66 2052 4f49  are lists of ROI
+0004b2e0: 2069 6e64 6963 6965 7320 6174 2074 6865   indicies at the
+0004b2f0: 7365 2063 6f6f 7264 696e 6174 6573 2e0a  se coordinates..
+0004b300: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+0004b310: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
+0004b320: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
+0004b330: 6e28 7365 6c66 2e72 6f69 7329 293a 0a20  n(self.rois)):. 
+0004b340: 2020 2020 2020 2020 2020 2078 797a 203d             xyz =
+0004b350: 2073 656c 662e 726f 6973 5b69 5d2e 6765   self.rois[i].ge
+0004b360: 745f 6365 6e74 726f 6964 2829 5b61 7869  t_centroid()[axi
+0004b370: 735d 0a20 2020 2020 2020 2020 2020 2069  s].            i
+0004b380: 6620 7879 7a20 6e6f 7420 696e 2063 656e  f xyz not in cen
+0004b390: 7472 6f69 6473 3a0a 2020 2020 2020 2020  troids:.        
+0004b3a0: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+0004b3b0: 735b 7879 7a5d 203d 205b 5d0a 2020 2020  s[xyz] = [].    
+0004b3c0: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+0004b3d0: 735b 7879 7a5d 2e61 7070 656e 6428 6929  s[xyz].append(i)
+0004b3e0: 0a0a 2020 2020 2020 2020 2320 4372 6561  ..        # Crea
+0004b3f0: 7465 206c 6973 7420 6f66 2052 4f49 7320  te list of ROIs 
+0004b400: 6f72 6465 7265 6420 6279 2063 656e 7472  ordered by centr
+0004b410: 6f69 6420 636f 6f72 6469 6e61 7465 2e0a  oid coordinate..
+0004b420: 2020 2020 2020 2020 726f 6973 203d 205b          rois = [
+0004b430: 5d0a 2020 2020 2020 2020 666f 7220 6365  ].        for ce
+0004b440: 6e74 726f 6964 2069 6e20 736f 7274 6564  ntroid in sorted
+0004b450: 2863 656e 7472 6f69 6473 2c20 7265 7665  (centroids, reve
+0004b460: 7273 653d 7265 7665 7273 6529 3a0a 2020  rse=reverse):.  
+0004b470: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+0004b480: 696e 2063 656e 7472 6f69 6473 5b63 656e  in centroids[cen
+0004b490: 7472 6f69 645d 3a0a 2020 2020 2020 2020  troid]:.        
+0004b4a0: 2020 2020 2020 2020 726f 6973 2e61 7070          rois.app
+0004b4b0: 656e 6428 7365 6c66 2e72 6f69 735b 695d  end(self.rois[i]
+0004b4c0: 290a 0a20 2020 2020 2020 2023 2053 746f  )..        # Sto
+0004b4d0: 7265 2074 6865 206e 6577 206f 7264 6572  re the new order
+0004b4e0: 206f 6620 524f 4973 2e0a 2020 2020 2020   of ROIs..      
+0004b4f0: 2020 7365 6c66 2e72 6f69 7320 3d20 726f    self.rois = ro
+0004b500: 6973 0a0a 2020 2020 6465 6620 636f 6d62  is..    def comb
+0004b510: 696e 655f 726f 6973 2873 656c 662c 206e  ine_rois(self, n
+0004b520: 616d 653d 4e6f 6e65 2c20 726f 695f 6e61  ame=None, roi_na
+0004b530: 6d65 733d 4e6f 6e65 2c20 696d 6167 653d  mes=None, image=
+0004b540: 4e6f 6e65 2c20 6d65 7468 6f64 3d4e 6f6e  None, method=Non
+0004b550: 6529 3a0a 2020 2020 2020 2020 2727 270a  e):.        '''.
+0004b560: 2020 2020 2020 2020 436f 6d62 696e 6520          Combine 
+0004b570: 7477 6f20 6f72 206d 6f72 6520 524f 4973  two or more ROIs
+0004b580: 2061 7320 6120 7369 6e67 6c65 2052 4f49   as a single ROI
+0004b590: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
+0004b5a0: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
+0004b5b0: 2020 2020 6e61 6d65 203a 2073 7472 2c20      name : str, 
+0004b5c0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+0004b5d0: 2020 2020 2020 2020 204e 616d 6520 746f           Name to
+0004b5e0: 2062 6520 6769 7665 6e20 746f 2074 6865   be given to the
+0004b5f0: 2063 6f6d 706f 7369 7465 2052 4f49 2e20   composite ROI. 
+0004b600: 2049 6620 4e6f 6e65 2c20 7468 650a 2020   If None, the.  
+0004b610: 2020 2020 2020 2020 2020 6e61 6d65 2061            name a
+0004b620: 7373 6967 6e65 6420 6973 2066 6f72 6d65  ssigned is forme
+0004b630: 6420 6279 206a 6f69 6e69 6e67 2074 6f67  d by joining tog
+0004b640: 6574 6865 7220 7468 6520 6e61 6d65 730a  ether the names.
+0004b650: 2020 2020 2020 2020 2020 2020 6f66 2074              of t
+0004b660: 6865 206f 7269 6769 6e61 6c20 524f 4973  he original ROIs
+0004b670: 2e0a 0a20 2020 2020 2020 2072 6f69 5f6e  ...        roi_n
+0004b680: 616d 6573 203a 206c 6973 742c 2064 6566  ames : list, def
+0004b690: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0004b6a0: 2020 2020 2020 4c69 7374 206f 6620 6e61        List of na
+0004b6b0: 6d65 7320 6f66 2052 4f49 7320 746f 2062  mes of ROIs to b
+0004b6c0: 6520 636f 6d62 696e 6564 2e20 2049 6620  e combined.  If 
+0004b6d0: 4e6f 6e65 2c20 616c 6c20 6f66 2074 6865  None, all of the
+0004b6e0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
+0004b6f0: 7563 7475 7265 2073 6574 2773 2052 4f49  ucture set's ROI
+0004b700: 7320 6172 6520 636f 6d62 696e 6564 2e0a  s are combined..
+0004b710: 0a20 2020 2020 2020 2069 6d61 6765 203a  .        image :
+0004b720: 2073 6b72 742e 696d 6167 652e 496d 6167   skrt.image.Imag
+0004b730: 652c 2064 6566 6175 6c74 3d4e 6f6e 650a  e, default=None.
+0004b740: 2020 2020 2020 2020 2020 2020 496d 6167              Imag
+0004b750: 6520 746f 2073 6574 2066 6f72 2074 6865  e to set for the
+0004b760: 2063 6f6d 706f 7369 7465 2052 4f49 2e20   composite ROI. 
+0004b770: 2049 6620 4e6f 6e65 2c20 7573 6520 7468   If None, use th
+0004b780: 6520 696d 6167 650a 2020 2020 2020 2020  e image.        
+0004b790: 2020 2020 6f66 2074 6865 2052 4f49 2077      of the ROI w
+0004b7a0: 6974 6820 7468 6520 6669 7273 7420 6e61  ith the first na
+0004b7b0: 6d65 2069 6e20 3c72 6f69 5f6e 616d 6573  me in <roi_names
+0004b7c0: 3e2e 0a0a 2020 2020 2020 2020 6d65 7468  >...        meth
+0004b7d0: 6f64 203a 2073 7472 2c20 6465 6661 756c  od : str, defaul
+0004b7e0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+0004b7f0: 2020 204d 6574 686f 6420 746f 2075 7365     Method to use
+0004b800: 2066 6f72 2063 6f6d 6269 6e69 6e67 2052   for combining R
+0004b810: 4f49 732e 2020 4361 6e20 6265 3a20 0a0a  OIs.  Can be: ..
+0004b820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b830: 2d20 2263 6f6e 746f 7572 223a 2074 616b  - "contour": tak
+0004b840: 6520 756e 6172 7920 756e 696f 6e20 6f66  e unary union of
+0004b850: 2073 6861 7065 6c79 2070 6f6c 7967 6f6e   shapely polygon
+0004b860: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
+0004b870: 2020 202d 2022 6d61 736b 223a 2073 756d     - "mask": sum
+0004b880: 2062 696e 6172 7920 6d61 736b 732e 0a20   binary masks.. 
+0004b890: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+0004b8a0: 2022 6175 746f 223a 2075 7365 2074 6865   "auto": use the
+0004b8b0: 2064 6566 6175 6c74 5f67 656f 6d5f 6d65   default_geom_me
+0004b8c0: 7468 6f64 206f 6620 7468 6520 524f 4920  thod of the ROI 
+0004b8d0: 7769 7468 2074 6865 0a20 2020 2020 2020  with the.       
+0004b8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b8f0: 2020 2066 6972 7374 206e 616d 6520 696e     first name in
+0004b900: 203c 726f 695f 6e61 6d65 733e 2e0a 0a20   <roi_names>... 
+0004b910: 2020 2020 2020 2020 2020 2049 6620 4e6f             If No
+0004b920: 6e65 2c20 2261 7574 6f22 2069 7320 7573  ne, "auto" is us
+0004b930: 6564 2e0a 2020 2020 2020 2020 2727 270a  ed..        '''.
+0004b940: 0a20 2020 2020 2020 2023 2049 6620 4e6f  .        # If No
+0004b950: 6e65 2076 616c 7565 7320 7061 7373 6564  ne values passed
+0004b960: 2c20 7365 7420 6465 6661 756c 7420 6265  , set default be
+0004b970: 6861 7669 6f75 722e 0a20 2020 2020 2020  haviour..       
+0004b980: 2069 6620 726f 695f 6e61 6d65 7320 6973   if roi_names is
+0004b990: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0004b9a0: 2020 2072 6f69 5f6e 616d 6573 203d 2073     roi_names = s
+0004b9b0: 656c 662e 6765 745f 726f 695f 6e61 6d65  elf.get_roi_name
+0004b9c0: 7328 290a 2020 2020 2020 2020 6966 206e  s().        if n
+0004b9d0: 616d 6520 6973 204e 6f6e 653a 0a20 2020  ame is None:.   
+0004b9e0: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
+0004b9f0: 272b 272e 6a6f 696e 2872 6f69 5f6e 616d  '+'.join(roi_nam
+0004ba00: 6573 290a 2020 2020 2020 2020 6966 206d  es).        if m
+0004ba10: 6574 686f 6420 696e 205b 4e6f 6e65 2c20  ethod in [None, 
+0004ba20: 2261 7574 6f22 5d3a 0a20 2020 2020 2020  "auto"]:.       
+0004ba30: 2020 2020 206d 6574 686f 6420 3d20 7365       method = se
+0004ba40: 6c66 5b72 6f69 5f6e 616d 6573 5b30 5d5d  lf[roi_names[0]]
+0004ba50: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
+0004ba60: 7468 6f64 0a20 2020 2020 2020 2069 6620  thod.        if 
+0004ba70: 696d 6167 6520 6973 204e 6f6e 653a 0a20  image is None:. 
+0004ba80: 2020 2020 2020 2020 2020 2069 6d61 6765             image
+0004ba90: 203d 2073 656c 665b 726f 695f 6e61 6d65   = self[roi_name
+0004baa0: 735b 305d 5d2e 696d 6167 650a 0a20 2020  s[0]].image..   
+0004bab0: 2020 2020 2069 6620 2263 6f6e 746f 7572       if "contour
+0004bac0: 2220 3d3d 206d 6574 686f 643a 0a20 2020  " == method:.   
+0004bad0: 2020 2020 2020 2020 2023 2043 7265 6174           # Creat
+0004bae0: 6520 6120 6469 6374 696f 6e61 7279 2063  e a dictionary c
+0004baf0: 6f6e 7461 696e 696e 6720 706f 6c79 676f  ontaining polygo
+0004bb00: 6e73 2066 6f72 2061 6c6c 2052 4f49 732e  ns for all ROIs.
+0004bb10: 0a20 2020 2020 2020 2020 2020 2061 6c6c  .            all
+0004bb20: 5f70 6f6c 7967 6f6e 7320 3d20 7b7d 0a20  _polygons = {}. 
+0004bb30: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
+0004bb40: 6f69 2069 6e20 7365 6c66 2e67 6574 5f72  oi in self.get_r
+0004bb50: 6f69 7328 726f 695f 6e61 6d65 7329 3a0a  ois(roi_names):.
+0004bb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bb70: 666f 7220 6b65 792c 2070 6f6c 7967 6f6e  for key, polygon
+0004bb80: 7320 696e 2072 6f69 2e67 6574 5f70 6f6c  s in roi.get_pol
+0004bb90: 7967 6f6e 7328 292e 6974 656d 7328 293a  ygons().items():
+0004bba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004bbb0: 2020 2020 2069 6620 6e6f 7420 6b65 7920       if not key 
+0004bbc0: 696e 2061 6c6c 5f70 6f6c 7967 6f6e 733a  in all_polygons:
+0004bbd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004bbe0: 2020 2020 2020 2020 2061 6c6c 5f70 6f6c           all_pol
+0004bbf0: 7967 6f6e 735b 6b65 795d 203d 205b 5d0a  ygons[key] = [].
+0004bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bc10: 2020 2020 616c 6c5f 706f 6c79 676f 6e73      all_polygons
+0004bc20: 5b6b 6579 5d2e 6578 7465 6e64 2870 6f6c  [key].extend(pol
+0004bc30: 7967 6f6e 7329 0a0a 2020 2020 2020 2020  ygons)..        
+0004bc40: 2020 2020 2320 4576 616c 7561 7465 2074      # Evaluate t
+0004bc50: 6865 2075 6e61 7279 2075 6e69 6f6e 206f  he unary union o
+0004bc60: 6620 706f 6c79 676f 6e73 2066 6f72 2065  f polygons for e
+0004bc70: 6163 6820 736c 6963 652e 0a20 2020 2020  ach slice..     
+0004bc80: 2020 2020 2020 2061 6c6c 5f70 6f6c 7967         all_polyg
+0004bc90: 6f6e 7320 3d20 7b6b 6579 3a20 5b6f 7073  ons = {key: [ops
+0004bca0: 2e75 6e61 7279 5f75 6e69 6f6e 2861 6c6c  .unary_union(all
+0004bcb0: 5f70 6f6c 7967 6f6e 735b 6b65 795d 295d  _polygons[key])]
+0004bcc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004bcd0: 2020 2020 2020 666f 7220 6b65 7920 696e        for key in
+0004bce0: 2061 6c6c 5f70 6f6c 7967 6f6e 737d 0a0a   all_polygons}..
+0004bcf0: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
+0004bd00: 6561 7465 2074 6865 2063 6f6d 706f 7369  eate the composi
+0004bd10: 7465 2052 4f49 2e0a 2020 2020 2020 2020  te ROI..        
+0004bd20: 2020 2020 726f 695f 6e65 7720 3d20 524f      roi_new = RO
+0004bd30: 4928 736f 7572 6365 3d61 6c6c 5f70 6f6c  I(source=all_pol
+0004bd40: 7967 6f6e 732c 2069 6d61 6765 3d69 6d61  ygons, image=ima
+0004bd50: 6765 2c20 6e61 6d65 3d6e 616d 6529 0a0a  ge, name=name)..
+0004bd60: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0004bd70: 2020 2020 2020 2020 2020 2320 5573 6520            # Use 
+0004bd80: 6461 7461 2066 726f 6d20 6f6e 6520 6f66  data from one of
+0004bd90: 2074 6865 2052 4f49 7320 6173 2061 2073   the ROIs as a s
+0004bda0: 7461 7274 696e 6720 706f 696e 742e 0a20  tarting point.. 
+0004bdb0: 2020 2020 2020 2020 2020 2072 6f69 3020             roi0 
+0004bdc0: 3d20 7365 6c66 2e67 6574 5f72 6f69 2872  = self.get_roi(r
+0004bdd0: 6f69 5f6e 616d 6573 5b30 5d29 0a20 2020  oi_names[0]).   
+0004bde0: 2020 2020 2020 2020 2072 6f69 5f6e 6577           roi_new
+0004bdf0: 203d 2052 4f49 2873 6f75 7263 653d 726f   = ROI(source=ro
+0004be00: 6930 2e67 6574 5f6d 6173 6b28 292e 636f  i0.get_mask().co
+0004be10: 7079 2829 2c20 6166 6669 6e65 3d72 6f69  py(), affine=roi
+0004be20: 302e 6166 6669 6e65 2c0a 2020 2020 2020  0.affine,.      
+0004be30: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+0004be40: 6d65 3d6e 616d 652c 2069 6d61 6765 3d69  me=name, image=i
+0004be50: 6d61 6765 290a 0a20 2020 2020 2020 2020  mage)..         
+0004be60: 2020 2023 2043 6f6d 6269 6e65 2077 6974     # Combine wit
+0004be70: 6820 6461 7461 2066 726f 6d20 7468 6520  h data from the 
+0004be80: 6f74 6865 7220 524f 4973 2e0a 2020 2020  other ROIs..    
+0004be90: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+0004bea0: 2072 616e 6765 2831 2c20 6c65 6e28 726f   range(1, len(ro
+0004beb0: 695f 6e61 6d65 7329 293a 0a20 2020 2020  i_names)):.     
+0004bec0: 2020 2020 2020 2020 2020 2072 6f69 5f6e             roi_n
+0004bed0: 6577 2e6d 6173 6b2e 6461 7461 207c 3d20  ew.mask.data |= 
+0004bee0: 7365 6c66 2e67 6574 5f72 6f69 2872 6f69  self.get_roi(roi
+0004bef0: 5f6e 616d 6573 5b69 5d29 2e67 6574 5f6d  _names[i]).get_m
+0004bf00: 6173 6b28 290a 0a20 2020 2020 2020 2072  ask()..        r
+0004bf10: 6574 7572 6e20 726f 695f 6e65 770a 0a20  eturn roi_new.. 
+0004bf20: 2020 2064 6566 2067 6574 5f6d 6173 6b5f     def get_mask_
+0004bf30: 696d 6167 6528 7365 6c66 2c20 6e61 6d65  image(self, name
+0004bf40: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+0004bf50: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
+0004bf60: 696d 6167 6520 6f62 6a65 6374 2072 6570  image object rep
+0004bf70: 7265 7365 6e74 696e 6720 6d61 736b 2066  resenting mask f
+0004bf80: 6f72 2061 6c6c 2052 4f49 7320 6f66 2073  or all ROIs of s
+0004bf90: 7472 7563 7475 7265 2073 6574 2e0a 0a20  tructure set... 
+0004bfa0: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
+0004bfb0: 6572 733a 2a2a 0a0a 2020 2020 2020 2020  ers:**..        
+0004bfc0: 6e61 6d65 203a 2073 7472 2c20 6465 6661  name : str, defa
+0004bfd0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+0004bfe0: 2020 2020 204e 616d 6520 746f 2062 6520       Name to be 
+0004bff0: 6769 7665 6e20 746f 2074 6865 206d 6173  given to the mas
+0004c000: 6b20 696d 6167 652e 2020 4966 204e 6f6e  k image.  If Non
+0004c010: 652c 2074 6865 0a20 2020 2020 2020 2020  e, the.         
+0004c020: 2020 206e 616d 6520 6173 7369 676e 6564     name assigned
+0004c030: 2069 7320 7468 6520 6e61 6d65 206f 6620   is the name of 
+0004c040: 7468 6520 7374 7275 6374 7572 6520 7365  the structure se
+0004c050: 742c 2077 6974 6820 7375 6666 6978 0a20  t, with suffix. 
+0004c060: 2020 2020 2020 2020 2020 2022 5f6d 6173             "_mas
+0004c070: 6b22 2061 7070 656e 6465 642e 0a20 2020  k" appended..   
+0004c080: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0004c090: 206e 616d 6520 3d20 6e61 6d65 206f 7220   name = name or 
+0004c0a0: 6622 7b73 656c 662e 6e61 6d65 7d5f 6d61  f"{self.name}_ma
+0004c0b0: 736b 220a 2020 2020 2020 2020 726f 695f  sk".        roi_
+0004c0c0: 636f 6d62 696e 6564 203d 2073 656c 662e  combined = self.
+0004c0d0: 636f 6d62 696e 655f 726f 6973 286e 616d  combine_rois(nam
+0004c0e0: 653d 6e61 6d65 290a 2020 2020 2020 2020  e=name).        
+0004c0f0: 6d61 736b 5f69 6d61 6765 203d 2072 6f69  mask_image = roi
+0004c100: 5f63 6f6d 6269 6e65 642e 6765 745f 6d61  _combined.get_ma
+0004c110: 736b 5f69 6d61 6765 2829 0a20 2020 2020  sk_image().     
+0004c120: 2020 2072 6574 7572 6e20 6d61 736b 5f69     return mask_i
+0004c130: 6d61 6765 0a0a 2020 2020 6465 6620 6372  mage..    def cr
+0004c140: 6f70 2873 656c 662c 2078 6c69 6d3d 4e6f  op(self, xlim=No
+0004c150: 6e65 2c20 796c 696d 3d4e 6f6e 652c 207a  ne, ylim=None, z
+0004c160: 6c69 6d3d 4e6f 6e65 293a 0a20 2020 2020  lim=None):.     
+0004c170: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
+0004c180: 726f 7020 616c 6c20 524f 4973 206f 6620  rop all ROIs of 
+0004c190: 5374 7275 6374 7572 6553 6574 2074 6f20  StructureSet to 
+0004c1a0: 7370 6563 6966 6965 6420 7261 6e67 6520  specified range 
+0004c1b0: 696e 2078 2c20 792c 207a 2e0a 0a20 2020  in x, y, z...   
+0004c1c0: 2020 2020 2054 6865 2070 6172 616d 6574       The paramet
+0004c1d0: 6572 7320 786c 696d 2c20 796c 696d 2c20  ers xlim, ylim, 
+0004c1e0: 7a6c 696d 2061 7265 2070 6173 7365 6420  zlim are passed 
+0004c1f0: 746f 2065 6163 6820 524f 4927 7320 6372  to each ROI's cr
+0004c200: 6f70 2829 206d 6574 686f 642e 0a20 2020  op() method..   
+0004c210: 2020 2020 2046 6f72 2065 7870 6c61 6e61       For explana
+0004c220: 7469 6f6e 206f 6620 7468 6573 6520 7061  tion of these pa
+0004c230: 7261 6d65 7465 7273 2c20 7365 6520 646f  rameters, see do
+0004c240: 6375 6d65 6e74 6174 696f 6e20 666f 720a  cumentation for.
+0004c250: 2020 2020 2020 2020 736b 7274 2e73 7472          skrt.str
+0004c260: 7563 7475 7265 732e 524f 492e 6372 6f70  uctures.ROI.crop
+0004c270: 2829 2e0a 2020 2020 2020 2020 2222 220a  ()..        """.
+0004c280: 2020 2020 2020 2020 666f 7220 726f 6920          for roi 
+0004c290: 696e 2073 656c 662e 6765 745f 726f 6973  in self.get_rois
+0004c2a0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0004c2b0: 726f 692e 6372 6f70 2878 6c69 6d2c 2079  roi.crop(xlim, y
+0004c2c0: 6c69 6d2c 207a 6c69 6d29 0a0a 636c 6173  lim, zlim)..clas
+0004c2d0: 7320 5374 7275 6374 7572 6553 6574 4974  s StructureSetIt
+0004c2e0: 6572 6174 6f72 3a0a 0a20 2020 2064 6566  erator:..    def
+0004c2f0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+0004c300: 7374 7275 6374 7572 655f 7365 7429 3a0a  structure_set):.
+0004c310: 2020 2020 2020 2020 7365 6c66 2e69 6478          self.idx
+0004c320: 203d 202d 310a 2020 2020 2020 2020 7365   = -1.        se
+0004c330: 6c66 2e73 7472 7563 7475 7265 5f73 6574  lf.structure_set
+0004c340: 203d 2073 7472 7563 7475 7265 5f73 6574   = structure_set
+0004c350: 0a0a 2020 2020 6465 6620 5f5f 6e65 7874  ..    def __next
+0004c360: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+0004c370: 2020 7365 6c66 2e69 6478 202b 3d20 310a    self.idx += 1.
+0004c380: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0004c390: 6964 7820 3c20 6c65 6e28 7365 6c66 2e73  idx < len(self.s
+0004c3a0: 7472 7563 7475 7265 5f73 6574 2e67 6574  tructure_set.get
+0004c3b0: 5f72 6f69 7328 2929 3a0a 2020 2020 2020  _rois()):.      
+0004c3c0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0004c3d0: 662e 7374 7275 6374 7572 655f 7365 742e  f.structure_set.
+0004c3e0: 6765 745f 726f 6973 2829 5b73 656c 662e  get_rois()[self.
+0004c3f0: 6964 785d 0a20 2020 2020 2020 2072 6169  idx].        rai
+0004c400: 7365 2053 746f 7049 7465 7261 7469 6f6e  se StopIteration
+0004c410: 0a0a 0a64 6566 206c 6f61 645f 726f 6973  ...def load_rois
+0004c420: 5f64 6963 6f6d 2870 6174 682c 206e 616d  _dicom(path, nam
+0004c430: 6573 3d4e 6f6e 6529 3a0a 2020 2020 2222  es=None):.    ""
+0004c440: 224c 6f61 6420 524f 4928 7329 2066 726f  "Load ROI(s) fro
+0004c450: 6d20 6120 6469 636f 6d20 7374 7275 6374  m a dicom struct
+0004c460: 7572 6520 7365 7420 6669 6c65 2e20 3c6e  ure set file. <n
+0004c470: 616d 653e 2063 616e 2062 6520 6120 7369  ame> can be a si
+0004c480: 6e67 6c65 0a20 2020 206e 616d 6520 6f72  ngle.    name or
+0004c490: 206c 6973 7420 6f66 206e 616d 6573 206f   list of names o
+0004c4a0: 6620 524f 4973 2074 6f20 6c6f 6164 2e22  f ROIs to load."
+0004c4b0: 2222 0a0a 2020 2020 2320 4c6f 6164 2064  ""..    # Load d
+0004c4c0: 6963 6f6d 206f 626a 6563 740a 2020 2020  icom object.    
+0004c4d0: 7472 793a 0a20 2020 2020 2020 2064 7320  try:.        ds 
+0004c4e0: 3d20 7079 6469 636f 6d2e 6463 6d72 6561  = pydicom.dcmrea
+0004c4f0: 6428 7061 7468 2c20 666f 7263 653d 5472  d(path, force=Tr
+0004c500: 7565 290a 2020 2020 6578 6365 7074 2070  ue).    except p
+0004c510: 7964 6963 6f6d 2e65 7272 6f72 732e 496e  ydicom.errors.In
+0004c520: 7661 6c69 6444 6963 6f6d 4572 726f 723a  validDicomError:
+0004c530: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0004c540: 5b5d 2c20 4e6f 6e65 0a20 2020 2069 6620  [], None.    if 
+0004c550: 6e6f 7420 6861 7361 7474 7228 6473 2c20  not hasattr(ds, 
+0004c560: 2253 4f50 436c 6173 7355 4944 2229 3a0a  "SOPClassUID"):.
+0004c570: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+0004c580: 5d2c 204e 6f6e 650a 2020 2020 6966 206e  ], None.    if n
+0004c590: 6f74 2028 6473 2e53 4f50 436c 6173 7355  ot (ds.SOPClassU
+0004c5a0: 4944 203d 3d20 2231 2e32 2e38 3430 2e31  ID == "1.2.840.1
+0004c5b0: 3030 3038 2e35 2e31 2e34 2e31 2e31 2e34  0008.5.1.4.1.1.4
+0004c5c0: 3831 2e33 2229 3a0a 2020 2020 2020 2020  81.3"):.        
+0004c5d0: 7072 696e 7428 6622 5761 726e 696e 673a  print(f"Warning:
+0004c5e0: 207b 7061 7468 7d20 6973 206e 6f74 2061   {path} is not a
+0004c5f0: 2044 4943 4f4d 2073 7472 7563 7475 7265   DICOM structure
+0004c600: 2073 6574 2066 696c 6521 2229 0a20 2020   set file!").   
+0004c610: 2020 2020 2072 6574 7572 6e20 5b5d 2c20       return [], 
+0004c620: 4e6f 6e65 0a0a 2020 2020 2320 4765 7420  None..    # Get 
+0004c630: 524f 4920 6e61 6d65 730a 2020 2020 7365  ROI names.    se
+0004c640: 7120 3d20 6765 745f 6469 636f 6d5f 7365  q = get_dicom_se
+0004c650: 7175 656e 6365 2864 732c 2022 5374 7275  quence(ds, "Stru
+0004c660: 6374 7572 6553 6574 524f 4922 290a 2020  ctureSetROI").  
+0004c670: 2020 726f 6973 203d 207b 7d0a 2020 2020    rois = {}.    
+0004c680: 666f 7220 726f 6920 696e 2073 6571 3a0a  for roi in seq:.
+0004c690: 2020 2020 2020 2020 726f 6973 5b69 6e74          rois[int
+0004c6a0: 2872 6f69 2e52 4f49 4e75 6d62 6572 295d  (roi.ROINumber)]
+0004c6b0: 203d 207b 226e 616d 6522 3a20 726f 692e   = {"name": roi.
+0004c6c0: 524f 494e 616d 657d 0a0a 2020 2020 2320  ROIName}..    # 
+0004c6d0: 4669 6e64 2052 4f49 7320 6d61 7463 6869  Find ROIs matchi
+0004c6e0: 6e67 2072 6571 7565 7374 6564 206e 616d  ng requested nam
+0004c6f0: 6573 0a20 2020 206e 616d 6573 5f74 6f5f  es.    names_to_
+0004c700: 6c6f 6164 203d 204e 6f6e 650a 2020 2020  load = None.    
+0004c710: 6966 2069 7369 6e73 7461 6e63 6528 6e61  if isinstance(na
+0004c720: 6d65 732c 2073 7472 293a 0a20 2020 2020  mes, str):.     
+0004c730: 2020 206e 616d 6573 5f74 6f5f 6c6f 6164     names_to_load
+0004c740: 203d 205b 6e61 6d65 735d 0a20 2020 2065   = [names].    e
+0004c750: 6c69 6620 736b 7274 2e63 6f72 652e 6973  lif skrt.core.is
+0004c760: 5f6c 6973 7428 6e61 6d65 7329 3a0a 2020  _list(names):.  
+0004c770: 2020 2020 2020 6e61 6d65 735f 746f 5f6c        names_to_l
+0004c780: 6f61 6420 3d20 6e61 6d65 730a 2020 2020  oad = names.    
+0004c790: 6966 206e 616d 6573 5f74 6f5f 6c6f 6164  if names_to_load
+0004c7a0: 3a0a 2020 2020 2020 2020 726f 6973 203d  :.        rois =
+0004c7b0: 207b 0a20 2020 2020 2020 2020 2020 2069   {.            i
+0004c7c0: 3a20 730a 2020 2020 2020 2020 2020 2020  : s.            
+0004c7d0: 666f 7220 692c 2073 2069 6e20 726f 6973  for i, s in rois
+0004c7e0: 2e69 7465 6d73 2829 0a20 2020 2020 2020  .items().       
+0004c7f0: 2020 2020 2069 6620 616e 7928 0a20 2020       if any(.   
+0004c800: 2020 2020 2020 2020 2020 2020 205b 666e               [fn
+0004c810: 6d61 7463 682e 666e 6d61 7463 6828 735b  match.fnmatch(s[
+0004c820: 226e 616d 6522 5d2e 6c6f 7765 7228 292c  "name"].lower(),
+0004c830: 206e 2e6c 6f77 6572 2829 2920 666f 7220   n.lower()) for 
+0004c840: 6e20 696e 206e 616d 6573 5f74 6f5f 6c6f  n in names_to_lo
+0004c850: 6164 5d0a 2020 2020 2020 2020 2020 2020  ad].            
+0004c860: 290a 2020 2020 2020 2020 7d0a 2020 2020  ).        }.    
+0004c870: 2020 2020 6966 206e 6f74 206c 656e 2872      if not len(r
+0004c880: 6f69 7329 3a0a 2020 2020 2020 2020 2020  ois):.          
+0004c890: 2020 7072 696e 7428 6622 5761 726e 696e    print(f"Warnin
+0004c8a0: 673a 206e 6f20 524f 4973 2066 6f75 6e64  g: no ROIs found
+0004c8b0: 206d 6174 6368 696e 6720 6e61 6d65 2873   matching name(s
+0004c8c0: 293a 207b 6e61 6d65 737d 2229 0a20 2020  ): {names}").   
+0004c8d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0004c8e0: 5b5d 2c20 4e6f 6e65 0a0a 2020 2020 2320  [], None..    # 
+0004c8f0: 4765 7420 524f 4920 6465 7461 696c 730a  Get ROI details.
+0004c900: 2020 2020 726f 695f 7365 7120 3d20 6765      roi_seq = ge
+0004c910: 745f 6469 636f 6d5f 7365 7175 656e 6365  t_dicom_sequence
+0004c920: 2864 732c 2022 524f 4943 6f6e 746f 7572  (ds, "ROIContour
+0004c930: 2229 0a20 2020 2066 6f72 2072 6f69 2069  ").    for roi i
+0004c940: 6e20 726f 695f 7365 713a 0a0a 2020 2020  n roi_seq:..    
+0004c950: 2020 2020 6e75 6d62 6572 203d 2072 6f69      number = roi
+0004c960: 2e52 6566 6572 656e 6365 6452 4f49 4e75  .ReferencedROINu
+0004c970: 6d62 6572 0a20 2020 2020 2020 2069 6620  mber.        if 
+0004c980: 6e75 6d62 6572 206e 6f74 2069 6e20 726f  number not in ro
+0004c990: 6973 3a0a 2020 2020 2020 2020 2020 2020  is:.            
+0004c9a0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0004c9b0: 2064 6174 6120 3d20 7b22 636f 6e74 6f75   data = {"contou
+0004c9c0: 7273 223a 207b 7d7d 0a0a 2020 2020 2020  rs": {}}..      
+0004c9d0: 2020 2320 4765 7420 524f 4920 636f 6c6f    # Get ROI colo
+0004c9e0: 7572 0a20 2020 2020 2020 2069 6620 2252  ur.        if "R
+0004c9f0: 4f49 4469 7370 6c61 7943 6f6c 6f72 2220  OIDisplayColor" 
+0004ca00: 696e 2072 6f69 3a0a 2020 2020 2020 2020  in roi:.        
+0004ca10: 2020 2020 6461 7461 5b22 636f 6c6f 7222      data["color"
+0004ca20: 5d20 3d20 5b69 6e74 2863 2920 2f20 3235  ] = [int(c) / 25
+0004ca30: 3520 666f 7220 6320 696e 206c 6973 7428  5 for c in list(
+0004ca40: 726f 692e 524f 4944 6973 706c 6179 436f  roi.ROIDisplayCo
+0004ca50: 6c6f 7229 5d0a 2020 2020 2020 2020 656c  lor)].        el
+0004ca60: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0004ca70: 6461 7461 5b22 636f 6c6f 7222 5d20 3d20  data["color"] = 
+0004ca80: 4e6f 6e65 0a0a 2020 2020 2020 2020 2320  None..        # 
+0004ca90: 4765 7420 636f 6e74 6f75 7273 0a20 2020  Get contours.   
+0004caa0: 2020 2020 2063 6f6e 746f 7572 5f73 6571       contour_seq
+0004cab0: 203d 2067 6574 5f64 6963 6f6d 5f73 6571   = get_dicom_seq
+0004cac0: 7565 6e63 6528 726f 692c 2022 436f 6e74  uence(roi, "Cont
+0004cad0: 6f75 7222 290a 2020 2020 2020 2020 6966  our").        if
+0004cae0: 2063 6f6e 746f 7572 5f73 6571 3a0a 2020   contour_seq:.  
+0004caf0: 2020 2020 2020 2020 2020 666f 7220 6320            for c 
+0004cb00: 696e 2063 6f6e 746f 7572 5f73 6571 3a0a  in contour_seq:.
+0004cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cb20: 706c 616e 655f 6461 7461 203d 205b 0a20  plane_data = [. 
+0004cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cb40: 2020 205b 666c 6f61 7428 7029 2066 6f72     [float(p) for
+0004cb50: 2070 2069 6e20 632e 436f 6e74 6f75 7244   p in c.ContourD
+0004cb60: 6174 615b 6920 2a20 3320 3a20 6920 2a20  ata[i * 3 : i * 
+0004cb70: 3320 2b20 335d 5d0a 2020 2020 2020 2020  3 + 3]].        
+0004cb80: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0004cb90: 6920 696e 2072 616e 6765 2863 2e4e 756d  i in range(c.Num
+0004cba0: 6265 724f 6643 6f6e 746f 7572 506f 696e  berOfContourPoin
+0004cbb0: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
+0004cbc0: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
+0004cbd0: 2020 2020 2020 7a20 3d20 666c 6f61 7428        z = float(
+0004cbe0: 632e 436f 6e74 6f75 7244 6174 615b 325d  c.ContourData[2]
+0004cbf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0004cc00: 2020 6966 207a 206e 6f74 2069 6e20 6461    if z not in da
+0004cc10: 7461 5b22 636f 6e74 6f75 7273 225d 3a0a  ta["contours"]:.
+0004cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cc30: 2020 2020 6461 7461 5b22 636f 6e74 6f75      data["contou
+0004cc40: 7273 225d 5b7a 5d20 3d20 5b5d 0a20 2020  rs"][z] = [].   
+0004cc50: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0004cc60: 615b 2263 6f6e 746f 7572 7322 5d5b 7a5d  a["contours"][z]
+0004cc70: 2e61 7070 656e 6428 6e70 2e61 7272 6179  .append(np.array
+0004cc80: 2870 6c61 6e65 5f64 6174 6129 290a 0a20  (plane_data)).. 
+0004cc90: 2020 2020 2020 2072 6f69 735b 6e75 6d62         rois[numb
+0004cca0: 6572 5d2e 7570 6461 7465 2864 6174 6129  er].update(data)
+0004ccb0: 0a0a 2020 2020 7265 7475 726e 2072 6f69  ..    return roi
+0004ccc0: 732c 2064 730a 0a0a 6465 6620 6765 745f  s, ds...def get_
+0004ccd0: 6469 636f 6d5f 7365 7175 656e 6365 2864  dicom_sequence(d
+0004cce0: 733d 4e6f 6e65 2c20 6261 7365 6e61 6d65  s=None, basename
+0004ccf0: 3d22 2229 3a0a 0a20 2020 2073 6571 7565  =""):..    seque
+0004cd00: 6e63 6520 3d20 5b5d 0a20 2020 2066 6f72  nce = [].    for
+0004cd10: 2073 7566 6669 7820 696e 205b 2253 6571   suffix in ["Seq
+0004cd20: 7565 6e63 6522 2c20 2273 225d 3a0a 2020  uence", "s"]:.  
+0004cd30: 2020 2020 2020 6174 7472 6962 7574 6520        attribute 
+0004cd40: 3d20 6622 7b62 6173 656e 616d 657d 7b73  = f"{basename}{s
+0004cd50: 7566 6669 787d 220a 2020 2020 2020 2020  uffix}".        
+0004cd60: 6966 2068 6173 6174 7472 2864 732c 2061  if hasattr(ds, a
+0004cd70: 7474 7269 6275 7465 293a 0a20 2020 2020  ttribute):.     
+0004cd80: 2020 2020 2020 2073 6571 7565 6e63 6520         sequence 
+0004cd90: 3d20 6765 7461 7474 7228 6473 2c20 6174  = getattr(ds, at
+0004cda0: 7472 6962 7574 6529 0a20 2020 2020 2020  tribute).       
+0004cdb0: 2020 2020 2062 7265 616b 0a20 2020 2072       break.    r
+0004cdc0: 6574 7572 6e20 7365 7175 656e 6365 0a0a  eturn sequence..
+0004cdd0: 6465 6620 636f 6e74 6f75 725f 746f 5f70  def contour_to_p
+0004cde0: 6f6c 7967 6f6e 2863 6f6e 746f 7572 293a  olygon(contour):
+0004cdf0: 0a20 2020 2022 2222 436f 6e76 6572 7420  .    """Convert 
+0004ce00: 6120 6c69 7374 206f 6620 636f 6e74 6f75  a list of contou
+0004ce10: 7220 706f 696e 7473 2074 6f20 6120 5368  r points to a Sh
+0004ce20: 6170 656c 7920 706f 6c79 676f 6e2c 2065  apely polygon, e
+0004ce30: 6e73 7572 696e 6720 7468 6174 200a 2020  nsuring that .  
+0004ce40: 2020 7468 6520 706f 6c79 676f 6e20 6973    the polygon is
+0004ce50: 2076 616c 6964 2e22 2222 0a0a 2020 2020   valid."""..    
+0004ce60: 2320 4469 7361 626c 6520 7368 6170 656c  # Disable shapel
+0004ce70: 7920 494e 464f 206d 6573 7361 6765 7320  y INFO messages 
+0004ce80: 6973 7375 6564 2077 6865 6e20 6120 706f  issued when a po
+0004ce90: 6c79 676f 6e20 6973 6e27 7420 7661 6c69  lygon isn't vali
+0004cea0: 643a 0a20 2020 2023 2022 6361 6c6c 6261  d:.    # "callba
+0004ceb0: 636b 202d 2049 4e46 4f20 2d20 5269 6e67  ck - INFO - Ring
+0004cec0: 2053 656c 662d 696e 7465 7273 6563 7469   Self-intersecti
+0004ced0: 6f6e 2061 7420 6f72 206e 6561 7220 706f  on at or near po
+0004cee0: 696e 7422 0a20 2020 206c 6f67 6769 6e67  int".    logging
+0004cef0: 2e67 6574 4c6f 6767 6572 2827 7368 6170  .getLogger('shap
+0004cf00: 656c 792e 6765 6f73 2729 2e73 6574 4c65  ely.geos').setLe
+0004cf10: 7665 6c28 0a20 2020 2020 2020 2020 2020  vel(.           
+0004cf20: 2073 6b72 742e 636f 7265 2e44 6566 6175   skrt.core.Defau
+0004cf30: 6c74 7328 292e 7368 6170 656c 795f 6c6f  lts().shapely_lo
+0004cf40: 675f 6c65 7665 6c29 0a0a 2020 2020 706f  g_level)..    po
+0004cf50: 6c79 676f 6e20 3d20 6765 6f6d 6574 7279  lygon = geometry
+0004cf60: 2e50 6f6c 7967 6f6e 2863 6f6e 746f 7572  .Polygon(contour
+0004cf70: 290a 0a20 2020 2064 656c 7461 203d 2030  )..    delta = 0
+0004cf80: 2e30 3035 0a20 2020 2069 6620 6e6f 7420  .005.    if not 
+0004cf90: 706f 6c79 676f 6e2e 6973 5f76 616c 6964  polygon.is_valid
+0004cfa0: 3a0a 2020 2020 2020 2020 746d 7020 3d20  :.        tmp = 
+0004cfb0: 6765 6f6d 6574 7279 2e50 6f6c 7967 6f6e  geometry.Polygon
+0004cfc0: 2870 6f6c 7967 6f6e 290a 2020 2020 2020  (polygon).      
+0004cfd0: 2020 6275 6666 6572 203d 2030 2e0a 2020    buffer = 0..  
+0004cfe0: 2020 2020 2020 2320 5468 6520 6964 6561        # The idea
+0004cff0: 2068 6572 6520 6973 2074 6f20 696e 6372   here is to incr
+0004d000: 6561 7365 2074 6865 2062 7566 6665 7220  ease the buffer 
+0004d010: 6469 7374 616e 6365 2075 6e74 696c 0a20  distance until. 
+0004d020: 2020 2020 2020 2023 2061 2076 616c 6964         # a valid
+0004d030: 2070 6f6c 7967 6f6e 2069 7320 6f62 7461   polygon is obta
+0004d040: 696e 6564 2e20 2054 6869 7320 6765 6e65  ined.  This gene
+0004d050: 7261 6c6c 7920 7365 656d 7320 746f 2077  rally seems to w
+0004d060: 6f72 6b2e 2e2e 0a20 2020 2020 2020 2077  ork....        w
+0004d070: 6869 6c65 2028 6973 696e 7374 616e 6365  hile (isinstance
+0004d080: 2870 6f6c 7967 6f6e 2c20 6765 6f6d 6574  (polygon, geomet
+0004d090: 7279 2e4d 756c 7469 506f 6c79 676f 6e29  ry.MultiPolygon)
+0004d0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004d0b0: 206f 7220 6e6f 7420 706f 6c79 676f 6e2e   or not polygon.
+0004d0c0: 6973 5f76 616c 6964 293a 0a20 2020 2020  is_valid):.     
+0004d0d0: 2020 2020 2020 2062 7566 6665 7220 2b3d         buffer +=
+0004d0e0: 2064 656c 7461 0a20 2020 2020 2020 2020   delta.         
+0004d0f0: 2020 2070 6f6c 7967 6f6e 203d 2074 6d70     polygon = tmp
+0004d100: 2e62 7566 6665 7228 6275 6666 6572 290a  .buffer(buffer).
+0004d110: 2020 2020 2020 2020 706f 696e 7473 203d          points =
+0004d120: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
+0004d130: 782c 2079 2069 6e20 706f 6c79 676f 6e2e  x, y in polygon.
+0004d140: 6578 7465 7269 6f72 2e63 6f6f 7264 733a  exterior.coords:
+0004d150: 0a20 2020 2020 2020 2020 2020 2070 6f69  .            poi
+0004d160: 6e74 732e 6170 7065 6e64 2828 782c 2079  nts.append((x, y
+0004d170: 2929 0a20 2020 2020 2020 2070 6f6c 7967  )).        polyg
+0004d180: 6f6e 203d 2067 656f 6d65 7472 792e 506f  on = geometry.Po
+0004d190: 6c79 676f 6e28 706f 696e 7473 290a 0a20  lygon(points).. 
+0004d1a0: 2020 2072 6574 7572 6e20 706f 6c79 676f     return polygo
+0004d1b0: 6e0a 0a64 6566 2070 6f6c 7967 6f6e 5f74  n..def polygon_t
+0004d1c0: 6f5f 636f 6e74 6f75 7228 706f 6c79 676f  o_contour(polygo
+0004d1d0: 6e29 3a0a 2020 2020 2727 270a 2020 2020  n):.    '''.    
+0004d1e0: 436f 6e76 6572 7420 6120 5368 6170 656c  Convert a Shapel
+0004d1f0: 7920 706f 6c79 676f 6e20 746f 2061 206c  y polygon to a l
+0004d200: 6973 7420 6f66 2063 6f6e 746f 7572 2070  ist of contour p
+0004d210: 6f69 6e74 732e 0a0a 2020 2020 2a2a 5061  oints...    **Pa
+0004d220: 7261 6d65 7465 723a 2a2a 0a0a 2020 2020  rameter:**..    
+0004d230: 706f 6c79 676f 6e3a 2073 6861 7065 6c79  polygon: shapely
+0004d240: 2e67 656f 6d65 7472 792e 706f 6c79 676f  .geometry.polygo
+0004d250: 6e0a 2020 2020 2020 2020 5368 6170 656c  n.        Shapel
+0004d260: 7920 706f 6c79 676f 6e2e 0a0a 2020 2020  y polygon...    
+0004d270: 7a5f 706f 6c79 676f 6e3a 207a 2063 6f6f  z_polygon: z coo
+0004d280: 7264 696e 6174 6520 6174 2077 6869 6368  rdinate at which
+0004d290: 2070 6f6c 7967 6f6e 2069 7320 6465 6669   polygon is defi
+0004d2a0: 6e65 642e 0a20 2020 2027 2727 0a20 2020  ned..    '''.   
+0004d2b0: 2063 6f6e 746f 7572 5f70 6f69 6e74 7320   contour_points 
+0004d2c0: 3d20 5b5d 0a20 2020 2066 6f72 2078 2c20  = [].    for x, 
+0004d2d0: 7920 696e 206c 6973 7428 706f 6c79 676f  y in list(polygo
+0004d2e0: 6e2e 6578 7465 7269 6f72 2e63 6f6f 7264  n.exterior.coord
+0004d2f0: 7329 3a0a 2020 2020 2020 2020 636f 6e74  s):.        cont
+0004d300: 6f75 725f 706f 696e 7473 2e61 7070 656e  our_points.appen
+0004d310: 6428 5b78 2c20 795d 290a 2020 2020 636f  d([x, y]).    co
+0004d320: 6e74 6f75 7220 3d20 6e70 2e61 7272 6179  ntour = np.array
+0004d330: 2863 6f6e 746f 7572 5f70 6f69 6e74 7329  (contour_points)
+0004d340: 0a0a 2020 2020 7265 7475 726e 2063 6f6e  ..    return con
+0004d350: 746f 7572 0a0a 6465 6620 696e 7465 7270  tour..def interp
+0004d360: 6f6c 6174 655f 706f 696e 7473 5f73 696e  olate_points_sin
+0004d370: 676c 655f 636f 6e74 6f75 7228 736f 7572  gle_contour(sour
+0004d380: 6365 3d4e 6f6e 652c 206e 5f70 6f69 6e74  ce=None, n_point
+0004d390: 3d4e 6f6e 652c 2064 7879 3d4e 6f6e 652c  =None, dxy=None,
+0004d3a0: 0a20 2020 2020 2020 2073 6d6f 6f74 686e  .        smoothn
+0004d3b0: 6573 735f 7065 725f 706f 696e 743d 3029  ess_per_point=0)
+0004d3c0: 3a0a 2020 2020 2727 270a 2020 2020 496e  :.    '''.    In
+0004d3d0: 7465 7270 6f6c 6174 6520 706f 696e 7473  terpolate points
+0004d3e0: 2066 6f72 2061 2073 696e 676c 6520 636f   for a single co
+0004d3f0: 6e74 6f75 722e 0a0a 2020 2020 2a2a 5061  ntour...    **Pa
+0004d400: 7261 6d65 7465 7273 3a2a 2a0a 0a20 2020  rameters:**..   
+0004d410: 2073 6f75 7263 6520 3a20 7368 6170 656c   source : shapel
+0004d420: 792e 706f 6c79 676f 6e2e 506f 6c79 676f  y.polygon.Polygo
+0004d430: 6e2f 6e70 2e6e 6461 7272 6179 2f6c 6973  n/np.ndarray/lis
+0004d440: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+0004d450: 2020 2020 2020 2020 436f 6e74 6f75 7220          Contour 
+0004d460: 7265 7072 6573 656e 7461 7469 6f6e 2061  representation a
+0004d470: 7320 6569 7468 6572 2061 2073 6861 7065  s either a shape
+0004d480: 6c79 2050 6f6c 7967 6f6e 2c20 6120 6e75  ly Polygon, a nu
+0004d490: 6d70 790a 2020 2020 2020 2020 6172 7261  mpy.        arra
+0004d4a0: 7920 6f66 205b 782c 2079 5d20 7061 6972  y of [x, y] pair
+0004d4b0: 7320 6f72 2061 206c 6973 7420 6f66 205b  s or a list of [
+0004d4c0: 782c 2079 5d20 7061 6972 732e 2020 5468  x, y] pairs.  Th
+0004d4d0: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+0004d4e0: 6564 2063 6f6e 746f 7572 2068 6173 2074  ed contour has t
+0004d4f0: 6865 2073 616d 6520 7265 7072 6573 656e  he same represen
+0004d500: 7461 7469 6f6e 2e0a 0a20 2020 206e 5f70  tation...    n_p
+0004d510: 6f69 6e74 203a 2069 6e74 2c20 6465 6661  oint : int, defa
+0004d520: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+0004d530: 204e 756d 6265 7220 6f66 2070 6f69 6e74   Number of point
+0004d540: 7320 746f 2064 6566 696e 6520 636f 6e74  s to define cont
+0004d550: 6f75 722c 2061 6674 6572 2069 6e74 6572  our, after inter
+0004d560: 706f 6c61 7469 6f6e 2e20 2054 6869 7320  polation.  This 
+0004d570: 6d75 7374 0a20 2020 2020 2020 2062 6520  must.        be 
+0004d580: 7365 7420 746f 204e 6f6e 6520 666f 7220  set to None for 
+0004d590: 6478 7920 746f 2062 6520 636f 6e73 6964  dxy to be consid
+0004d5a0: 6572 6564 2e0a 0a20 2020 2064 7879 203a  ered...    dxy :
+0004d5b0: 2066 6c6f 6174 2c20 6465 6661 756c 743d   float, default=
+0004d5c0: 4e6f 6e65 0a20 2020 2020 2020 2041 7070  None.        App
+0004d5d0: 726f 7869 6d61 7465 2064 6973 7461 6e63  roximate distanc
+0004d5e0: 6520 7265 7175 6972 6564 2062 6574 7765  e required betwe
+0004d5f0: 656e 2063 6f6e 746f 7572 2070 6f69 6e74  en contour point
+0004d600: 732e 2020 5468 6973 2069 7320 7461 6b65  s.  This is take
+0004d610: 6e0a 2020 2020 2020 2020 696e 746f 2061  n.        into a
+0004d620: 6363 6f75 6e74 206f 6e6c 7920 6966 206e  ccount only if n
+0004d630: 5f70 6f69 6e74 2069 7320 7365 7420 746f  _point is set to
+0004d640: 204e 6f6e 652e 2020 466f 7220 6120 636f   None.  For a co
+0004d650: 6e74 6f75 7220 6f66 0a20 2020 2020 2020  ntour of.       
+0004d660: 206c 656e 6774 6820 636f 6e74 6f75 725f   length contour_
+0004d670: 6c65 6e67 7468 2c20 7468 6520 6e75 6d62  length, the numb
+0004d680: 6572 206f 6620 636f 6e74 6f75 7220 706f  er of contour po
+0004d690: 696e 7473 2069 7320 7468 656e 2074 616b  ints is then tak
+0004d6a0: 656e 0a20 2020 2020 2020 2074 6f20 6265  en.        to be
+0004d6b0: 206d 6178 2869 6e74 2863 6f6e 746f 7572   max(int(contour
+0004d6c0: 5f6c 656e 6774 6820 2f20 6478 7929 2c20  _length / dxy), 
+0004d6d0: 3329 2e20 200a 0a20 2020 2073 6d6f 6f74  3).  ..    smoot
+0004d6e0: 686e 6573 735f 7065 725f 706f 696e 7420  hness_per_point 
+0004d6f0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+0004d700: 3d30 0a20 2020 2020 2020 2050 6172 616d  =0.        Param
+0004d710: 6574 6572 2064 6574 6572 6d69 6e69 6e67  eter determining
+0004d720: 2074 6865 2073 6d6f 6f74 686e 6573 7320   the smoothness 
+0004d730: 6f66 2074 6865 2042 2d73 706c 696e 6520  of the B-spline 
+0004d740: 6375 7276 6520 7573 6564 0a20 2020 2020  curve used.     
+0004d750: 2020 2069 6e20 636f 6e74 6f75 7220 6170     in contour ap
+0004d760: 7072 6f78 696d 6174 696f 6e20 666f 7220  proximation for 
+0004d770: 696e 7465 7270 6f6c 6174 696f 6e2e 2020  interpolation.  
+0004d780: 5468 6520 7072 6f64 7563 7420 6f66 0a20  The product of. 
+0004d790: 2020 2020 2020 2073 6d6f 6f74 686e 6573         smoothnes
+0004d7a0: 735f 7065 725f 706f 696e 7420 616e 6420  s_per_point and 
+0004d7b0: 7468 6520 6e75 6d62 6572 206f 6620 636f  the number of co
+0004d7c0: 6e74 6f75 7220 706f 696e 7473 2028 7370  ntour points (sp
+0004d7d0: 6563 6966 6965 640a 2020 2020 2020 2020  ecified.        
+0004d7e0: 6469 7265 6374 6c79 2076 6961 206e 5f70  directly via n_p
+0004d7f0: 6f69 6e74 2c20 6f72 2069 6e64 6972 6563  oint, or indirec
+0004d800: 746c 7920 7669 6120 6478 7929 2063 6f72  tly via dxy) cor
+0004d810: 7265 7370 6f6e 6473 2074 6f20 7468 650a  responds to the.
+0004d820: 2020 2020 2020 2020 7061 7261 6d65 7465          paramete
+0004d830: 7220 7320 6f66 2073 6369 7079 2e69 6e74  r s of scipy.int
+0004d840: 6572 706f 6c61 7465 2e73 706c 7072 6570  erpolate.splprep
+0004d850: 202d 2073 6565 2064 6f63 756d 656e 7461   - see documenta
+0004d860: 7469 6f6e 2061 743a 0a20 2020 2020 2020  tion at:.       
+0004d870: 200a 2020 2020 2020 2020 6874 7470 733a   .        https:
+0004d880: 2f2f 7363 6970 792e 6769 7468 7562 2e69  //scipy.github.i
+0004d890: 6f2f 6465 7664 6f63 732f 7265 6665 7265  o/devdocs/refere
+0004d8a0: 6e63 652f 6765 6e65 7261 7465 642f 7363  nce/generated/sc
+0004d8b0: 6970 792e 696e 7465 7270 6f6c 6174 652e  ipy.interpolate.
+0004d8c0: 7370 6c70 7265 702e 6874 6d6c 2373 6369  splprep.html#sci
+0004d8d0: 7079 2e69 6e74 6572 706f 6c61 7465 2e73  py.interpolate.s
+0004d8e0: 706c 7072 6570 0a0a 2020 2020 2020 2020  plprep..        
+0004d8f0: 4120 736d 6f6f 7468 6e65 7373 5f70 6572  A smoothness_per
+0004d900: 5f70 6f69 6e74 206f 6620 3020 666f 7263  _point of 0 forc
+0004d910: 6573 2074 6865 2042 2d73 706c 696e 6520  es the B-spline 
+0004d920: 746f 2070 6173 7320 7468 726f 7567 680a  to pass through.
+0004d930: 2020 2020 2020 2020 616c 6c20 6f66 2074          all of t
+0004d940: 6865 2070 7265 2d69 6e74 6572 706f 6c61  he pre-interpola
+0004d950: 7469 6f6e 2063 6f6e 746f 7572 2070 6f69  tion contour poi
+0004d960: 6e74 732e 0a20 2020 2027 2727 0a0a 2020  nts..    '''..  
+0004d970: 2020 2320 4578 7472 6163 7420 6c69 7374    # Extract list
+0004d980: 206f 6620 636f 6e74 6f75 7220 706f 696e   of contour poin
+0004d990: 7473 2066 726f 6d20 736f 7572 6365 2e0a  ts from source..
+0004d9a0: 2020 2020 636f 6e74 6f75 725f 6c65 6e67      contour_leng
+0004d9b0: 7468 203d 204e 6f6e 650a 2020 2020 6966  th = None.    if
+0004d9c0: 2069 7369 6e73 7461 6e63 6528 736f 7572   isinstance(sour
+0004d9d0: 6365 2c20 6765 6f6d 6574 7279 2e70 6f6c  ce, geometry.pol
+0004d9e0: 7967 6f6e 2e50 6f6c 7967 6f6e 293a 0a20  ygon.Polygon):. 
+0004d9f0: 2020 2020 2020 2070 6f69 6e74 7320 3d20         points = 
+0004da00: 6c69 7374 2870 6f6c 7967 6f6e 5f74 6f5f  list(polygon_to_
+0004da10: 636f 6e74 6f75 7228 736f 7572 6365 2929  contour(source))
+0004da20: 0a20 2020 2020 2020 2063 6f6e 746f 7572  .        contour
+0004da30: 5f6c 656e 6774 6820 3d20 736f 7572 6365  _length = source
+0004da40: 2e6c 656e 6774 680a 2020 2020 656c 6966  .length.    elif
+0004da50: 2069 7369 6e73 7461 6e63 6528 736f 7572   isinstance(sour
+0004da60: 6365 2c20 6e70 2e6e 6461 7272 6179 2920  ce, np.ndarray) 
+0004da70: 6f72 2069 7369 6e73 7461 6e63 6528 736f  or isinstance(so
+0004da80: 7572 6365 2c20 6c69 7374 293a 0a20 2020  urce, list):.   
+0004da90: 2020 2020 2070 6f69 6e74 7320 3d20 6c69       points = li
+0004daa0: 7374 2873 6f75 7263 6529 0a20 2020 2065  st(source).    e
+0004dab0: 6c73 653a 0a20 2020 2020 2020 2070 6f69  lse:.        poi
+0004dac0: 6e74 7320 3d20 4e6f 6e65 0a0a 2020 2020  nts = None..    
+0004dad0: 6966 2070 6f69 6e74 7320 6973 204e 6f6e  if points is Non
+0004dae0: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
+0004daf0: 2827 556e 7265 636f 676e 6973 6564 2073  ('Unrecognised s
+0004db00: 6f75 7263 6520 7061 7373 6564 2074 6f20  ource passed to 
+0004db10: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0004db20: 2020 275c 2769 6e74 6572 706f 6c61 7465    '\'interpolate
+0004db30: 5f70 6f69 6e74 735f 7369 6e67 6c65 5f63  _points_single_c
+0004db40: 6f6e 746f 7572 2829 5c27 2729 0a20 2020  ontour()\'').   
+0004db50: 2020 2020 2070 7269 6e74 2827 536f 7572       print('Sour
+0004db60: 6365 206d 7573 7420 6265 2073 6861 7065  ce must be shape
+0004db70: 6c79 2050 6f6c 7967 6f6e 206f 7220 636f  ly Polygon or co
+0004db80: 6e74 6f75 7227 290a 2020 2020 2020 2020  ntour').        
+0004db90: 7265 7475 726e 204e 6f6e 650a 0a20 2020  return None..   
+0004dba0: 2023 2049 6620 6e75 6d62 6572 206f 6620   # If number of 
+0004dbb0: 636f 6e74 6f75 7220 706f 696e 7473 206e  contour points n
+0004dbc0: 6f74 2070 6173 7365 6420 6469 7265 6374  ot passed direct
+0004dbd0: 6c79 2c0a 2020 2020 2320 7472 7920 746f  ly,.    # try to
+0004dbe0: 2064 6574 6572 6d69 6e65 2069 7473 2076   determine its v
+0004dbf0: 616c 7565 2066 726f 6d20 7468 6520 6469  alue from the di
+0004dc00: 7374 616e 6365 2062 6574 7765 656e 2063  stance between c
+0004dc10: 6f6e 746f 7572 2070 6f69 6e74 732e 0a20  ontour points.. 
+0004dc20: 2020 2069 6620 6e5f 706f 696e 7420 6973     if n_point is
+0004dc30: 204e 6f6e 6520 616e 6420 6478 793a 0a20   None and dxy:. 
+0004dc40: 2020 2020 2020 2069 6620 636f 6e74 6f75         if contou
+0004dc50: 725f 6c65 6e67 7468 2069 7320 4e6f 6e65  r_length is None
+0004dc60: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+0004dc70: 6e74 6f75 725f 6c65 6e67 7468 203d 2063  ntour_length = c
+0004dc80: 6f6e 746f 7572 5f74 6f5f 706f 6c79 676f  ontour_to_polygo
+0004dc90: 6e28 736f 7572 6365 292e 6c65 6e67 7468  n(source).length
+0004dca0: 0a20 2020 2020 2020 206e 5f70 6f69 6e74  .        n_point
+0004dcb0: 203d 206d 6178 2869 6e74 2863 6f6e 746f   = max(int(conto
+0004dcc0: 7572 5f6c 656e 6774 6820 2f20 6478 7929  ur_length / dxy)
+0004dcd0: 2c20 3329 0a20 2020 2069 6620 6e5f 706f  , 3).    if n_po
+0004dce0: 696e 7420 6973 204e 6f6e 653a 0a20 2020  int is None:.   
+0004dcf0: 2020 2020 2070 7269 6e74 2827 4e6f 2069       print('No i
+0004dd00: 6e74 6572 706f 6c61 7469 6f6e 2070 6572  nterpolation per
+0004dd10: 666f 726d 6564 2729 0a20 2020 2020 2020  formed').       
+0004dd20: 2070 7269 6e74 2827 4e75 6d62 6572 206f   print('Number o
+0004dd30: 6620 636f 6e74 6f75 7220 706f 696e 7473  f contour points
+0004dd40: 2028 6e5f 706f 696e 7429 206f 7220 6469   (n_point) or di
+0004dd50: 7374 616e 6365 2062 6574 7765 656e 2070  stance between p
+0004dd60: 6f69 6e74 7327 0a20 2020 2020 2020 2020  oints'.         
+0004dd70: 2020 2020 2020 2027 6d75 7374 2062 6520         'must be 
+0004dd80: 7370 6563 6966 6965 642e 2729 0a20 2020  specified.').   
+0004dd90: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0004dda0: 0a0a 2020 2020 2320 4d61 6b65 206c 6173  ..    # Make las
+0004ddb0: 7420 706f 696e 7420 7468 6520 7361 6d65  t point the same
+0004ddc0: 2061 7320 7468 6520 6669 7273 742c 2074   as the first, t
+0004ddd0: 6f20 656e 7375 7265 2063 6c6f 7365 6420  o ensure closed 
+0004dde0: 6375 7276 652e 0a20 2020 2070 6f69 6e74  curve..    point
+0004ddf0: 732e 6170 7065 6e64 2870 6f69 6e74 735b  s.append(points[
+0004de00: 305d 290a 0a20 2020 2023 2044 6973 6361  0])..    # Disca
+0004de10: 7264 2070 6f69 6e74 7320 7468 6174 2061  rd points that a
+0004de20: 7265 6e27 7420 7365 7061 7261 7465 6420  ren't separated 
+0004de30: 6672 6f6d 2074 6865 2070 7265 6365 6564  from the preceed
+0004de40: 696e 6720 706f 696e 740a 2020 2020 2320  ing point.    # 
+0004de50: 6279 2061 7420 6c65 6173 7420 736f 6d65  by at least some
+0004de60: 206d 696e 696d 756d 2064 6973 7461 6e63   minimum distanc
+0004de70: 652e 0a20 2020 2064 7879 5f6d 696e 203d  e..    dxy_min =
+0004de80: 2030 2e30 3031 0a20 2020 2078 5f6c 6173   0.001.    x_las
+0004de90: 742c 2079 5f6c 6173 7420 3d20 706f 696e  t, y_last = poin
+0004dea0: 7473 5b30 5d0a 2020 2020 785f 7661 6c75  ts[0].    x_valu
+0004deb0: 6573 2c20 795f 7661 6c75 6573 203d 2028  es, y_values = (
+0004dec0: 5b78 5f6c 6173 745d 2c20 5b79 5f6c 6173  [x_last], [y_las
+0004ded0: 745d 290a 2020 2020 666f 7220 6920 696e  t]).    for i in
+0004dee0: 2072 616e 6765 2831 2c20 6c65 6e28 706f   range(1, len(po
+0004def0: 696e 7473 2929 3a0a 2020 2020 2020 2020  ints)):.        
+0004df00: 782c 2079 203d 2070 6f69 6e74 735b 695d  x, y = points[i]
+0004df10: 0a20 2020 2020 2020 2069 6620 2861 6273  .        if (abs
+0004df20: 2878 202d 2078 5f6c 6173 7429 203e 2064  (x - x_last) > d
+0004df30: 7879 5f6d 696e 2920 6f72 2028 6162 7328  xy_min) or (abs(
+0004df40: 7920 2d20 795f 6c61 7374 2920 3e20 6478  y - y_last) > dx
+0004df50: 795f 6d69 6e29 3a0a 2020 2020 2020 2020  y_min):.        
+0004df60: 2020 2020 785f 7661 6c75 6573 2e61 7070      x_values.app
+0004df70: 656e 6428 706f 696e 7473 5b69 5d5b 305d  end(points[i][0]
+0004df80: 290a 2020 2020 2020 2020 2020 2020 795f  ).            y_
+0004df90: 7661 6c75 6573 2e61 7070 656e 6428 706f  values.append(po
+0004dfa0: 696e 7473 5b69 5d5b 315d 290a 2020 2020  ints[i][1]).    
+0004dfb0: 2020 2020 785f 6c61 7374 2c20 795f 6c61      x_last, y_la
+0004dfc0: 7374 203d 2070 6f69 6e74 735b 695d 0a0a  st = points[i]..
+0004dfd0: 2020 2020 785f 7661 6c75 6573 203d 206e      x_values = n
+0004dfe0: 702e 6172 7261 7928 785f 7661 6c75 6573  p.array(x_values
+0004dff0: 290a 2020 2020 795f 7661 6c75 6573 203d  ).    y_values =
+0004e000: 206e 702e 6172 7261 7928 795f 7661 6c75   np.array(y_valu
+0004e010: 6573 290a 0a20 2020 2023 2049 6e74 6572  es)..    # Inter
+0004e020: 706f 6c61 7465 2063 6f6e 746f 7572 2070  polate contour p
+0004e030: 6f69 6e74 732e 0a20 2020 2073 6d6f 6f74  oints..    smoot
+0004e040: 686e 6573 7320 3d20 736d 6f6f 7468 6e65  hness = smoothne
+0004e050: 7373 5f70 6572 5f70 6f69 6e74 202a 206c  ss_per_point * l
+0004e060: 656e 2878 5f76 616c 7565 7329 0a20 2020  en(x_values).   
+0004e070: 2074 7279 3a0a 2320 2020 2020 2020 2077   try:.#        w
+0004e080: 6974 6820 7761 726e 696e 6773 2e63 6174  ith warnings.cat
+0004e090: 6368 5f77 6172 6e69 6e67 7328 293a 0a23  ch_warnings():.#
+0004e0a0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+0004e0b0: 696e 6773 2e66 696c 7465 7277 6172 6e69  ings.filterwarni
+0004e0c0: 6e67 7328 2269 676e 6f72 6522 2c20 6d65  ngs("ignore", me
+0004e0d0: 7373 6167 653d 2253 6574 7469 6e67 2078  ssage="Setting x
+0004e0e0: 2229 0a20 2020 2020 2020 2020 2020 2074  ").            t
+0004e0f0: 636b 2c20 7520 3d20 696e 7465 7270 6f6c  ck, u = interpol
+0004e100: 6174 652e 7370 6c70 7265 7028 0a20 2020  ate.splprep(.   
+0004e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e120: 205b 785f 7661 6c75 6573 2c20 795f 7661   [x_values, y_va
+0004e130: 6c75 6573 5d2c 2073 3d73 6d6f 6f74 686e  lues], s=smoothn
+0004e140: 6573 732c 2070 6572 3d54 7275 6529 0a20  ess, per=True). 
+0004e150: 2020 2065 7863 6570 7420 5479 7065 4572     except TypeEr
+0004e160: 726f 7220 6173 2070 726f 626c 656d 3a0a  ror as problem:.
+0004e170: 2020 2020 2020 2020 7072 696e 7428 2257          print("W
+0004e180: 4152 4e49 4e47 3a20 5072 6f62 6c65 6d20  ARNING: Problem 
+0004e190: 696e 2069 6e74 6572 706f 6c61 7465 5f63  in interpolate_c
+0004e1a0: 6f6e 746f 7572 5f70 6f69 6e74 7328 293a  ontour_points():
+0004e1b0: 222c 2070 726f 626c 656d 290a 2020 2020  ", problem).    
+0004e1c0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+0004e1d0: 0a20 2020 2078 695f 7661 6c75 6573 2c20  .    xi_values, 
+0004e1e0: 7969 5f76 616c 7565 7320 3d20 696e 7465  yi_values = inte
+0004e1f0: 7270 6f6c 6174 652e 7370 6c65 7628 0a20  rpolate.splev(. 
+0004e200: 2020 2020 2020 206e 702e 6c69 6e73 7061         np.linspa
+0004e210: 6365 2830 2e2c 2031 2e2c 206e 5f70 6f69  ce(0., 1., n_poi
+0004e220: 6e74 202b 2031 292c 2074 636b 290a 0a20  nt + 1), tck).. 
+0004e230: 2020 2023 2053 746f 7265 2070 6f69 6e74     # Store point
+0004e240: 7320 696e 2061 2066 6f72 6d20 7468 6174  s in a form that
+0004e250: 206d 6179 2062 6520 636f 6e76 6572 7465   may be converte
+0004e260: 6420 746f 2061 206e 756d 7079 2061 7272  d to a numpy arr
+0004e270: 6179 2e0a 2020 2020 706f 696e 7473 5f69  ay..    points_i
+0004e280: 6e74 6572 706f 6c61 7465 6420 3d20 6c69  nterpolated = li
+0004e290: 7374 287a 6970 2878 695f 7661 6c75 6573  st(zip(xi_values
+0004e2a0: 2c20 7969 5f76 616c 7565 7329 290a 2020  , yi_values)).  
+0004e2b0: 2020 706f 696e 7473 5f69 6e74 6572 706f    points_interpo
+0004e2c0: 6c61 7465 6420 3d20 5b78 7920 666f 7220  lated = [xy for 
+0004e2d0: 7879 2069 6e20 706f 696e 7473 5f69 6e74  xy in points_int
+0004e2e0: 6572 706f 6c61 7465 645d 0a0a 2020 2020  erpolated]..    
+0004e2f0: 2320 5265 7475 726e 2069 6e74 6572 706f  # Return interpo
+0004e300: 6c61 7465 6420 636f 6e74 6f75 7220 696e  lated contour in
+0004e310: 2074 6865 2073 616d 6520 7265 7072 6573   the same repres
+0004e320: 656e 7461 7469 6f6e 2061 7320 7468 6520  entation as the 
+0004e330: 736f 7572 6365 2e0a 2020 2020 6966 2069  source..    if i
+0004e340: 7369 6e73 7461 6e63 6528 736f 7572 6365  sinstance(source
+0004e350: 2c20 6765 6f6d 6574 7279 2e70 6f6c 7967  , geometry.polyg
+0004e360: 6f6e 2e50 6f6c 7967 6f6e 293a 0a20 2020  on.Polygon):.   
+0004e370: 2020 2020 206f 7574 5f6f 626a 6563 7420       out_object 
+0004e380: 3d20 6765 6f6d 6574 7279 2e70 6f6c 7967  = geometry.polyg
+0004e390: 6f6e 2e50 6f6c 7967 6f6e 2870 6f69 6e74  on.Polygon(point
+0004e3a0: 735f 696e 7465 7270 6f6c 6174 6564 290a  s_interpolated).
+0004e3b0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+0004e3c0: 6e63 6528 736f 7572 6365 2c20 6e70 2e6e  nce(source, np.n
+0004e3d0: 6461 7272 6179 293a 0a20 2020 2020 2020  darray):.       
+0004e3e0: 206f 7574 5f6f 626a 6563 7420 3d20 6e70   out_object = np
+0004e3f0: 2e61 7272 6179 2870 6f69 6e74 735f 696e  .array(points_in
+0004e400: 7465 7270 6f6c 6174 6564 290a 2020 2020  terpolated).    
+0004e410: 656c 7365 3a0a 2020 2020 2020 2020 6f75  else:.        ou
+0004e420: 745f 6f62 6a65 6374 203d 2070 6f69 6e74  t_object = point
+0004e430: 735f 696e 7465 7270 6f6c 6174 6564 0a0a  s_interpolated..
+0004e440: 2020 2020 7265 7475 726e 206f 7574 5f6f      return out_o
+0004e450: 626a 6563 740a 0a64 6566 2077 7269 7465  bject..def write
+0004e460: 5f73 7472 7563 7475 7265 5f73 6574 5f64  _structure_set_d
+0004e470: 6963 6f6d 280a 2020 2020 6f75 746e 616d  icom(.    outnam
+0004e480: 652c 200a 2020 2020 726f 6973 2c20 0a20  e, .    rois, . 
+0004e490: 2020 2069 6d61 6765 3d4e 6f6e 652c 200a     image=None, .
+0004e4a0: 2020 2020 6166 6669 6e65 3d4e 6f6e 652c      affine=None,
+0004e4b0: 200a 2020 2020 7368 6170 653d 4e6f 6e65   .    shape=None
+0004e4c0: 2c0a 2020 2020 6f72 6965 6e74 6174 696f  ,.    orientatio
+0004e4d0: 6e3d 4e6f 6e65 2c20 0a20 2020 2068 6561  n=None, .    hea
+0004e4e0: 6465 725f 736f 7572 6365 3d4e 6f6e 652c  der_source=None,
+0004e4f0: 200a 2020 2020 7061 7469 656e 745f 6964   .    patient_id
+0004e500: 3d4e 6f6e 652c 0a20 2020 206d 6f64 616c  =None,.    modal
+0004e510: 6974 793d 4e6f 6e65 2c20 0a20 2020 2072  ity=None, .    r
+0004e520: 6f6f 745f 7569 643d 4e6f 6e65 0a29 3a0a  oot_uid=None.):.
+0004e530: 0a20 2020 2023 2043 6865 636b 2077 6520  .    # Check we 
+0004e540: 6861 7665 2074 6865 2072 656c 6576 616e  have the relevan
+0004e550: 7420 696e 666f 0a20 2020 2069 6620 6e6f  t info.    if no
+0004e560: 7420 696d 6167 6520 616e 6420 286e 6f74  t image and (not
+0004e570: 2061 6666 696e 6520 6f72 206e 6f74 2073   affine or not s
+0004e580: 6861 7065 293a 0a20 2020 2020 2020 2072  hape):.        r
+0004e590: 6169 7365 2052 756e 7469 6d65 4572 726f  aise RuntimeErro
+0004e5a0: 7228 224d 7573 7420 7072 6f76 6964 6520  r("Must provide 
+0004e5b0: 6569 7468 6572 2061 6e20 696d 6167 6520  either an image 
+0004e5c0: 6f72 2061 6e20 6166 6669 6e65 206d 6174  or an affine mat
+0004e5d0: 7269 7820 220a 2020 2020 2020 2020 2020  rix ".          
+0004e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e5f0: 2022 616e 6420 7368 6170 6521 2229 0a0a   "and shape!")..
+0004e600: 2020 2020 2320 5472 7920 6765 7474 696e      # Try gettin
+0004e610: 6720 6469 636f 6d20 6461 7461 7365 7420  g dicom dataset 
+0004e620: 6672 6f6d 2069 6d61 6765 0a20 2020 2064  from image.    d
+0004e630: 7320 3d20 4e6f 6e65 0a20 2020 2069 6620  s = None.    if 
+0004e640: 696d 6167 653a 0a20 2020 2020 2020 2069  image:.        i
+0004e650: 6620 6861 7361 7474 7228 696d 6167 652c  f hasattr(image,
+0004e660: 2022 6469 636f 6d5f 6461 7461 7365 7422   "dicom_dataset"
+0004e670: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
+0004e680: 7320 3d20 696d 6167 652e 6469 636f 6d5f  s = image.dicom_
+0004e690: 6461 7461 7365 740a 2020 2020 2020 2020  dataset.        
+0004e6a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0004e6b0: 2020 6473 203d 2073 6b72 742e 696d 6167    ds = skrt.imag
+0004e6c0: 652e 6372 6561 7465 5f64 6963 6f6d 2829  e.create_dicom()
+0004e6d0: 0a20 2020 2020 2020 2020 2020 2064 732e  .            ds.
+0004e6e0: 7365 745f 6765 6f6d 6574 7279 280a 2020  set_geometry(.  
+0004e6f0: 2020 2020 2020 2020 2020 2020 2020 696d                im
+0004e700: 6167 652e 6765 745f 6166 6669 6e65 2829  age.get_affine()
+0004e710: 2c20 696d 6167 652e 6765 745f 6461 7461  , image.get_data
+0004e720: 2829 2e73 6861 7065 2c0a 2020 2020 2020  ().shape,.      
+0004e730: 2020 2020 2020 2020 2020 696d 6167 652e            image.
+0004e740: 6765 745f 6f72 6965 6e74 6174 696f 6e5f  get_orientation_
+0004e750: 7665 6374 6f72 2869 6d61 6765 2e67 6574  vector(image.get
+0004e760: 5f61 6666 696e 652c 2022 6469 636f 6d22  _affine, "dicom"
+0004e770: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+0004e780: 0a20 2020 2023 204f 7468 6572 7769 7365  .    # Otherwise
+0004e790: 2c20 6372 6561 7465 2066 7265 7368 2064  , create fresh d
+0004e7a0: 6963 6f6d 2064 6174 6173 6574 0a20 2020  icom dataset.   
+0004e7b0: 2065 6c73 653a 0a20 2020 2020 2020 2064   else:.        d
+0004e7c0: 7320 3d20 736b 7274 2e69 6d61 6765 2e63  s = skrt.image.c
+0004e7d0: 7265 6174 655f 6469 636f 6d28 7061 7469  reate_dicom(pati
+0004e7e0: 656e 745f 6964 2c20 6d6f 6461 6c69 7479  ent_id, modality
+0004e7f0: 2c20 726f 6f74 5f75 6964 290a 2020 2020  , root_uid).    
+0004e800: 2020 2020 6473 2e73 6574 5f67 656f 6d65      ds.set_geome
+0004e810: 7472 7928 6166 6669 6e65 2c20 7368 6170  try(affine, shap
+0004e820: 652c 206f 7269 656e 7461 7469 6f6e 290a  e, orientation).
+0004e830: 0a20 2020 2023 2041 646a 7573 7420 6461  .    # Adjust da
+0004e840: 7461 7365 7420 746f 2062 6520 666f 7220  taset to be for 
+0004e850: 5374 7275 6374 7572 6553 6574 2069 6e73  StructureSet ins
+0004e860: 7465 6164 206f 6620 696d 6167 650a 0a0a  tead of image...
+0004e870: 6465 6620 6469 636f 6d5f 6461 7461 7365  def dicom_datase
+0004e880: 745f 746f 5f73 7472 7563 7475 7265 5f73  t_to_structure_s
+0004e890: 6574 2864 7329 3a0a 2020 2020 2727 2743  et(ds):.    '''C
+0004e8a0: 6f6e 7665 7274 2061 6e20 6578 6973 7469  onvert an existi
+0004e8b0: 6e67 2069 6d61 6765 2064 6963 6f6d 2064  ng image dicom d
+0004e8c0: 6174 6173 6574 2074 6f20 6120 5374 7275  ataset to a Stru
+0004e8d0: 6374 7572 6553 6574 2064 6174 6173 6574  ctureSet dataset
+0004e8e0: 2e27 2727 0a0a 2020 2020 2320 4164 6a75  .'''..    # Adju
+0004e8f0: 7374 2063 6c61 7373 2055 4944 730a 2020  st class UIDs.  
+0004e900: 2020 6473 2e66 696c 655f 6d65 7461 2e49    ds.file_meta.I
+0004e910: 6d70 6c65 6d65 6e74 6174 696f 6e43 6c61  mplementationCla
+0004e920: 7373 5549 4420 3d20 2239 2e39 2e39 2e31  ssUID = "9.9.9.1
+0004e930: 3030 2e30 2e30 2e31 2e30 2e39 2e36 2e30  00.0.0.1.0.9.6.0
+0004e940: 2e30 2e31 220a 2020 2020 6473 2e66 696c  .0.1".    ds.fil
+0004e950: 655f 6d65 7461 2e4d 6564 6961 5374 6f72  e_meta.MediaStor
+0004e960: 6167 6553 4f50 436c 6173 7355 4944 203d  ageSOPClassUID =
+0004e970: 2022 312e 322e 3834 302e 3130 3030 382e   "1.2.840.10008.
+0004e980: 352e 312e 342e 312e 312e 3438 312e 3322  5.1.4.1.1.481.3"
+0004e990: 0a0a 2020 2020 2320 4173 7369 676e 2065  ..    # Assign e
+0004e9a0: 6d70 7479 2073 6571 7565 6e63 6573 0a20  mpty sequences. 
+0004e9b0: 2020 2064 732e 5265 6665 7265 6e63 6564     ds.Referenced
+0004e9c0: 4672 616d 656f 6652 6566 6572 656e 6365  FrameofReference
+0004e9d0: 5365 7175 656e 6365 203d 2053 6571 7565  Sequence = Seque
+0004e9e0: 6e63 6528 290a 2020 2020 6473 2e53 7472  nce().    ds.Str
+0004e9f0: 7563 7475 7265 5365 7452 4f49 5365 7175  uctureSetROISequ
+0004ea00: 656e 6365 203d 2053 6571 7565 6e63 6528  ence = Sequence(
+0004ea10: 290a 2020 2020 6473 2e52 5452 4f49 4f62  ).    ds.RTROIOb
+0004ea20: 7365 7276 6174 696f 6e73 5365 7175 656e  servationsSequen
+0004ea30: 6365 203d 2053 6571 7565 6e63 6528 290a  ce = Sequence().
+0004ea40: 2020 2020 6473 2e52 4f49 436f 6e74 6f75      ds.ROIContou
+0004ea50: 7253 6571 7565 6e63 6520 3d20 5365 7175  rSequence = Sequ
+0004ea60: 656e 6365 2829 0a0a 2020 2020 2320 4173  ence()..    # As
+0004ea70: 7369 676e 2073 7472 7563 7475 7265 2073  sign structure s
+0004ea80: 6574 2070 726f 7065 7274 6965 730a 2020  et properties.  
+0004ea90: 2020 6473 2e53 7472 7563 7475 7265 5365    ds.StructureSe
+0004eaa0: 744c 6162 656c 203d 2022 220a 2020 2020  tLabel = "".    
+0004eab0: 6473 2e53 7472 7563 7475 7265 5365 7444  ds.StructureSetD
+0004eac0: 6174 6520 3d20 6473 2e49 6e73 7461 6e63  ate = ds.Instanc
+0004ead0: 6543 7265 6174 696f 6e44 6174 650a 2020  eCreationDate.  
+0004eae0: 2020 6473 2e53 7472 7563 7475 7265 5365    ds.StructureSe
+0004eaf0: 7454 696d 6520 3d20 6473 2e49 6e73 7461  tTime = ds.Insta
+0004eb00: 6e63 6543 7265 6174 696f 6e54 696d 650a  nceCreationTime.
+0004eb10: 0a20 2020 2023 2041 7373 6967 6e20 6672  .    # Assign fr
+0004eb20: 616d 6520 6f66 2072 6566 6572 656e 6365  ame of reference
+0004eb30: 0a0a 0a64 6566 2063 7265 6174 655f 6475  ...def create_du
+0004eb40: 6d6d 795f 696d 6167 6528 0a20 2020 2065  mmy_image(.    e
+0004eb50: 7874 656e 7473 2c20 0a20 2020 2073 6c69  xtents, .    sli
+0004eb60: 6365 5f74 6869 636b 6e65 7373 2c0a 2020  ce_thickness,.  
+0004eb70: 2020 7368 6170 653d 4e6f 6e65 2c20 0a20    shape=None, . 
+0004eb80: 2020 2076 6f78 656c 5f73 697a 653d 4e6f     voxel_size=No
+0004eb90: 6e65 2c0a 2020 2020 6669 6c6c 5f76 616c  ne,.    fill_val
+0004eba0: 3d31 6534 2c0a 2020 2020 6275 6666 6572  =1e4,.    buffer
+0004ebb0: 3d32 0a29 3a0a 2020 2020 2222 224d 616b  =2.):.    """Mak
+0004ebc0: 6520 6120 6475 6d6d 7920 696d 6167 6520  e a dummy image 
+0004ebd0: 7468 6174 2063 6f76 6572 7320 7468 6520  that covers the 
+0004ebe0: 6172 6561 2073 7061 6e6e 6564 2062 7920  area spanned by 
+0004ebf0: 3c65 7874 656e 7473 3e20 706c 7573 2061  <extents> plus a
+0004ec00: 200a 2020 2020 6275 6666 6572 2e0a 0a20   .    buffer... 
+0004ec10: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+0004ec20: 2a2a 0a20 2020 200a 2020 2020 6578 7465  **.    .    exte
+0004ec30: 6e74 7320 3a20 6c69 7374 0a20 2020 2020  nts : list.     
+0004ec40: 2020 204c 6973 7420 6f66 205b 6d69 6e2c     List of [min,
+0004ec50: 206d 6178 5d20 6578 7465 6e74 7320 696e   max] extents in
+0004ec60: 206d 6d20 616c 6f6e 6720 6561 6368 206f   mm along each o
+0004ec70: 6620 7468 6520 7468 7265 6520 6178 6573  f the three axes
+0004ec80: 2069 6e20 0a20 2020 2020 2020 206f 7264   in .        ord
+0004ec90: 6572 205b 782c 2079 2c20 7a5d 2e0a 0a20  er [x, y, z]... 
+0004eca0: 2020 2073 6c69 6365 5f74 6869 636b 6e65     slice_thickne
+0004ecb0: 7373 203a 2066 6c6f 6174 0a20 2020 2020  ss : float.     
+0004ecc0: 2020 2053 6c69 6365 2074 6869 636b 6e65     Slice thickne
+0004ecd0: 7373 2069 6e20 6d6d 2e0a 0a20 2020 2076  ss in mm...    v
+0004ece0: 6f78 656c 5f73 697a 6520 3a20 6c69 7374  oxel_size : list
+0004ecf0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+0004ed00: 2020 2020 2020 2056 6f78 656c 2073 697a         Voxel siz
+0004ed10: 6520 696e 206d 6d20 696e 2074 6865 2064  e in mm in the d
+0004ed20: 756d 6d79 2069 6d61 6765 2069 6e20 7468  ummy image in th
+0004ed30: 6520 782d 7920 706c 616e 652c 2067 6976  e x-y plane, giv
+0004ed40: 656e 2061 7320 0a20 2020 2020 2020 205b  en as .        [
+0004ed50: 7678 2c20 7679 5d2e 2049 6620 3c73 6861  vx, vy]. If <sha
+0004ed60: 7065 3e20 616e 6420 3c76 6f78 656c 5f73  pe> and <voxel_s
+0004ed70: 697a 653e 2061 7265 2062 6f74 6820 4e6f  ize> are both No
+0004ed80: 6e65 2c20 766f 7865 6c20 7369 7a65 7320  ne, voxel sizes 
+0004ed90: 6f66 0a20 2020 2020 2020 205b 312c 2031  of.        [1, 1
+0004eda0: 5d20 7769 6c6c 2062 6520 7573 6564 2062  ] will be used b
+0004edb0: 7920 6465 6661 756c 742e 2054 6865 2076  y default. The v
+0004edc0: 6f78 656c 2073 697a 6520 696e 2074 6865  oxel size in the
+0004edd0: 207a 2064 6972 6563 7469 6f6e 200a 2020   z direction .  
+0004ede0: 2020 2020 2020 7769 6c6c 2062 6520 7461        will be ta
+0004edf0: 6b65 6e20 6672 6f6d 2074 6865 206d 696e  ken from the min
+0004ee00: 696d 756d 2064 6973 7461 6e63 6520 6265  imum distance be
+0004ee10: 7477 6565 6e20 736c 6963 6520 706f 7369  tween slice posi
+0004ee20: 7469 6f6e 7320 696e 200a 2020 2020 2020  tions in .      
+0004ee30: 2020 7468 6520 782d 7920 636f 6e74 6f75    the x-y contou
+0004ee40: 7273 2064 6963 7469 6f6e 6172 792e 0a0a  rs dictionary...
+0004ee50: 2020 2020 7368 6170 6520 3a20 6c69 7374      shape : list
+0004ee60: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+0004ee70: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
+0004ee80: 2076 6f78 656c 7320 696e 2074 6865 2064   voxels in the d
+0004ee90: 756d 6d79 2069 6d61 6765 2069 6e20 7468  ummy image in th
+0004eea0: 6520 782d 7920 706c 616e 652c 2067 6976  e x-y plane, giv
+0004eeb0: 656e 2061 730a 2020 2020 2020 2020 5b6e  en as.        [n
+0004eec0: 782c 206e 795d 2e20 4f6e 6c79 2075 7365  x, ny]. Only use
+0004eed0: 6420 6966 203c 766f 7865 6c5f 7369 7a65  d if <voxel_size
+0004eee0: 3e20 6973 204e 6f6e 652e 200a 2020 2020  > is None. .    
+0004eef0: 2020 2020 5468 6520 6e75 6d62 6572 206f      The number o
+0004ef00: 6620 766f 7865 6c73 2069 6e20 7468 6520  f voxels in the 
+0004ef10: 7a20 6469 7265 6374 696f 6e20 7769 6c6c  z direction will
+0004ef20: 2062 6520 7461 6b65 6e20 6672 6f6d 2074   be taken from t
+0004ef30: 6865 200a 2020 2020 2020 2020 6e75 6d62  he .        numb
+0004ef40: 6572 206f 6620 736c 6963 6573 2069 6e20  er of slices in 
+0004ef50: 7468 6520 782d 7920 636f 6e74 6f75 7273  the x-y contours
+0004ef60: 2064 6963 7469 6f6e 6172 792e 0a0a 2020   dictionary...  
+0004ef70: 2020 6669 6c6c 5f76 616c 203a 2069 6e74    fill_val : int
+0004ef80: 2f66 6c6f 6174 2c20 6465 6661 756c 743d  /float, default=
+0004ef90: 3165 340a 2020 2020 2020 2020 5661 6c75  1e4.        Valu
+0004efa0: 6520 7769 7468 2077 6869 6368 2074 6865  e with which the
+0004efb0: 2076 6f78 656c 7320 696e 2074 6865 2064   voxels in the d
+0004efc0: 756d 6d79 2069 6d61 6765 2073 686f 756c  ummy image shoul
+0004efd0: 6420 6265 2066 696c 6c65 642e 200a 0a20  d be filled. .. 
+0004efe0: 2020 2062 7566 6665 7220 3a20 666c 6f61     buffer : floa
+0004eff0: 742c 2064 6566 6175 6c74 3d32 0a20 2020  t, default=2.   
+0004f000: 2020 2020 2042 7566 6665 7220 616d 6f75       Buffer amou
+0004f010: 6e74 206f 6620 7768 6974 6573 7061 6365  nt of whitespace
+0004f020: 2069 6e20 6d6d 2074 6f20 6164 6420 6f75   in mm to add ou
+0004f030: 7473 6964 6520 7468 6520 524f 4920 696e  tside the ROI in
+0004f040: 2065 6163 6820 0a20 2020 2020 2020 2064   each .        d
+0004f050: 6972 6563 7469 6f6e 2e0a 2020 2020 2222  irection..    ""
+0004f060: 220a 0a20 2020 2023 2041 7373 6967 6e20  "..    # Assign 
+0004f070: 6465 6661 756c 7420 766f 7865 6c20 7369  default voxel si
+0004f080: 7a65 0a20 2020 2069 6620 7368 6170 6520  ze.    if shape 
+0004f090: 6973 204e 6f6e 6520 616e 6420 766f 7865  is None and voxe
+0004f0a0: 6c5f 7369 7a65 2069 7320 4e6f 6e65 3a0a  l_size is None:.
+0004f0b0: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
+0004f0c0: 7a65 203d 205b 312c 2031 5d0a 2020 2020  ze = [1, 1].    
+0004f0d0: 6966 206e 6f74 2073 6b72 742e 636f 7265  if not skrt.core
+0004f0e0: 2e69 735f 6c69 7374 2876 6f78 656c 5f73  .is_list(voxel_s
+0004f0f0: 697a 6529 3a0a 2020 2020 2020 2020 766f  ize):.        vo
+0004f100: 7865 6c5f 7369 7a65 203d 205b 766f 7865  xel_size = [voxe
+0004f110: 6c5f 7369 7a65 5d20 2a20 320a 0a20 2020  l_size] * 2..   
+0004f120: 2023 2043 616c 6375 6c61 7465 2076 6f78   # Calculate vox
+0004f130: 656c 2073 697a 6573 2066 726f 6d20 7368  el sizes from sh
+0004f140: 6170 650a 2020 2020 6966 2073 6861 7065  ape.    if shape
+0004f150: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0004f160: 2020 2020 2020 7368 6170 6520 3d20 6c69        shape = li
+0004f170: 7374 2873 6861 7065 290a 2020 2020 2020  st(shape).      
+0004f180: 2020 6966 206c 656e 2873 6861 7065 2920    if len(shape) 
+0004f190: 213d 2032 3a0a 2020 2020 2020 2020 2020  != 2:.          
+0004f1a0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+0004f1b0: 7228 2253 6861 7065 2073 686f 756c 6420  r("Shape should 
+0004f1c0: 6265 2061 206c 6973 7420 6f66 2074 776f  be a list of two
+0004f1d0: 2076 616c 7565 7320 220a 2020 2020 2020   values ".      
+0004f1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f1f0: 2020 2020 2020 2273 7065 6369 6679 696e        "specifyin
+0004f200: 6720 6475 6d6d 7920 696d 6167 6520 7368  g dummy image sh
+0004f210: 6170 6520 696e 2074 6865 205b 782c 2079  ape in the [x, y
+0004f220: 5d20 220a 2020 2020 2020 2020 2020 2020  ] ".            
+0004f230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f240: 2264 6972 6563 7469 6f6e 732e 2229 0a0a  "directions.")..
+0004f250: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
+0004f260: 6174 6520 766f 7865 6c20 7369 7a65 2069  ate voxel size i
+0004f270: 6620 524f 4920 6578 7465 6e74 2070 6c75  f ROI extent plu
+0004f280: 7320 6275 6666 6572 2069 7320 6469 7669  s buffer is divi
+0004f290: 6465 6420 6279 2073 6861 7065 0a20 2020  ded by shape.   
+0004f2a0: 2020 2020 2076 6f78 656c 5f73 697a 6520       voxel_size 
+0004f2b0: 3d20 5b28 6d61 7828 6578 2920 2d20 6d69  = [(max(ex) - mi
+0004f2c0: 6e28 6578 2920 2b20 3220 2a20 6275 6666  n(ex) + 2 * buff
+0004f2d0: 6572 2920 2f20 7368 6170 655b 695d 0a20  er) / shape[i]. 
+0004f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f2f0: 2020 2020 2066 6f72 2069 2c20 6578 2069       for i, ex i
+0004f300: 6e20 656e 756d 6572 6174 6528 6578 7465  n enumerate(exte
+0004f310: 6e74 735b 3a32 5d29 5d0a 0a20 2020 2023  nts[:2])]..    #
+0004f320: 204f 7468 6572 7769 7365 2c20 6361 6c63   Otherwise, calc
+0004f330: 756c 6174 6520 7368 6170 6520 6672 6f6d  ulate shape from
+0004f340: 2076 6f78 656c 2073 697a 6573 0a20 2020   voxel sizes.   
+0004f350: 2065 6c73 653a 0a20 2020 2020 2020 2076   else:.        v
+0004f360: 6f78 656c 5f73 697a 6520 3d20 6c69 7374  oxel_size = list
+0004f370: 2876 6f78 656c 5f73 697a 6529 0a20 2020  (voxel_size).   
+0004f380: 2020 2020 200a 2020 2020 2020 2020 2320       .        # 
+0004f390: 4361 6c63 756c 6174 6520 6e75 6d62 6572  Calculate number
+0004f3a0: 206f 6620 766f 7865 6c73 206e 6565 6465   of voxels neede
+0004f3b0: 6420 746f 2063 6f76 6572 2052 4f49 2070  d to cover ROI p
+0004f3c0: 6c75 7320 6275 6666 6572 2065 6163 6820  lus buffer each 
+0004f3d0: 7369 6465 0a20 2020 2020 2020 2073 6861  side.        sha
+0004f3e0: 7065 203d 205b 286e 702e 6365 696c 2828  pe = [(np.ceil((
+0004f3f0: 6d61 7828 6578 2920 2d20 6d69 6e28 6578  max(ex) - min(ex
+0004f400: 2929 202b 2032 202a 2062 7566 6665 7229  )) + 2 * buffer)
+0004f410: 202f 2076 6f78 656c 5f73 697a 655b 695d   / voxel_size[i]
+0004f420: 2920 0a20 2020 2020 2020 2020 2020 2020  ) .             
+0004f430: 2020 2020 666f 7220 692c 2065 7820 696e      for i, ex in
+0004f440: 2065 6e75 6d65 7261 7465 2865 7874 656e   enumerate(exten
+0004f450: 7473 5b3a 325d 295d 0a0a 2020 2020 2320  ts[:2])]..    # 
+0004f460: 4765 7420 7a20 766f 7865 6c20 7369 7a65  Get z voxel size
+0004f470: 2061 6e64 2073 6861 7065 0a20 2020 2076   and shape.    v
+0004f480: 6f78 656c 5f73 697a 652e 6170 7065 6e64  oxel_size.append
+0004f490: 2873 6c69 6365 5f74 6869 636b 6e65 7373  (slice_thickness
+0004f4a0: 290a 2020 2020 7368 6170 655f 7a20 3d20  ).    shape_z = 
+0004f4b0: 286d 6178 2865 7874 656e 7473 5b32 5d29  (max(extents[2])
+0004f4c0: 202d 206d 696e 2865 7874 656e 7473 5b32   - min(extents[2
+0004f4d0: 5d29 2920 2f20 736c 6963 655f 7468 6963  ])) / slice_thic
+0004f4e0: 6b6e 6573 730a 0a20 2020 2023 2041 6464  kness..    # Add
+0004f4f0: 206e 6561 7265 7374 2069 6e74 6567 6572   nearest integer
+0004f500: 206e 756d 6265 7220 6f66 2062 7566 6665   number of buffe
+0004f510: 7220 766f 7865 6c73 0a20 2020 206e 5f62  r voxels.    n_b
+0004f520: 7566 665f 7a20 3d20 6e70 2e63 6569 6c28  uff_z = np.ceil(
+0004f530: 6275 6666 6572 202f 2073 6c69 6365 5f74  buffer / slice_t
+0004f540: 6869 636b 6e65 7373 290a 2020 2020 7368  hickness).    sh
+0004f550: 6170 652e 6170 7065 6e64 2873 6861 7065  ape.append(shape
+0004f560: 5f7a 202b 2032 202a 206e 5f62 7566 665f  _z + 2 * n_buff_
+0004f570: 7a29 0a20 2020 2073 6861 7065 203d 205b  z).    shape = [
+0004f580: 696e 7428 7329 2066 6f72 2073 2069 6e20  int(s) for s in 
+0004f590: 7368 6170 655d 0a0a 2020 2020 2320 4765  shape]..    # Ge
+0004f5a0: 7420 6f72 6967 696e 2070 6f73 6974 696f  t origin positio
+0004f5b0: 6e3b 2065 6e73 7572 6520 7468 6174 206f  n; ensure that o
+0004f5c0: 7269 6769 6e20 706f 696e 7473 2074 6f20  rigin points to 
+0004f5d0: 6365 6e74 7265 206f 6620 6275 6666 6572  centre of buffer
+0004f5e0: 2076 6f78 656c 200a 2020 2020 2320 6f75   voxel .    # ou
+0004f5f0: 7473 6964 6520 524f 490a 2020 2020 6f72  tside ROI.    or
+0004f600: 6967 696e 203d 205b 6d69 6e28 6578 2920  igin = [min(ex) 
+0004f610: 2b20 6162 7328 766f 7865 6c5f 7369 7a65  + abs(voxel_size
+0004f620: 5b69 5d29 202a 2030 2e35 202d 2062 7566  [i]) * 0.5 - buf
+0004f630: 6665 720a 2020 2020 2020 2020 2020 2020  fer.            
+0004f640: 2020 666f 7220 692c 2065 7820 696e 2065    for i, ex in e
+0004f650: 6e75 6d65 7261 7465 2865 7874 656e 7473  numerate(extents
+0004f660: 5b3a 325d 295d 0a20 2020 206f 7269 6769  [:2])].    origi
+0004f670: 6e2e 6170 7065 6e64 286d 696e 2865 7874  n.append(min(ext
+0004f680: 656e 7473 5b32 5d29 202d 2061 6273 2873  ents[2]) - abs(s
+0004f690: 6c69 6365 5f74 6869 636b 6e65 7373 2920  lice_thickness) 
+0004f6a0: 2a20 286e 5f62 7566 665f 7a20 2d20 302e  * (n_buff_z - 0.
+0004f6b0: 3529 290a 0a20 2020 2023 2043 7265 6174  5))..    # Creat
+0004f6c0: 6520 696d 6167 650a 2020 2020 7265 7475  e image.    retu
+0004f6d0: 726e 2073 6b72 742e 696d 6167 652e 496d  rn skrt.image.Im
+0004f6e0: 6167 6528 0a20 2020 2020 2020 206e 702e  age(.        np.
+0004f6f0: 6f6e 6573 2828 7368 6170 655b 315d 2c20  ones((shape[1], 
+0004f700: 7368 6170 655b 305d 2c20 7368 6170 655b  shape[0], shape[
+0004f710: 325d 2929 202a 2066 696c 6c5f 7661 6c2c  2])) * fill_val,
+0004f720: 0a20 2020 2020 2020 2076 6f78 656c 5f73  .        voxel_s
+0004f730: 697a 653d 766f 7865 6c5f 7369 7a65 2c0a  ize=voxel_size,.
+0004f740: 2020 2020 2020 2020 6f72 6967 696e 3d6f          origin=o
+0004f750: 7269 6769 6e0a 2020 2020 290a 0a0a 6465  rigin.    )...de
+0004f760: 6620 6372 6561 7465 5f73 7461 706c 6528  f create_staple(
+0004f770: 726f 6973 2c20 2a2a 6b77 6172 6773 293a  rois, **kwargs):
+0004f780: 0a20 2020 2022 2222 4372 6561 7465 2053  .    """Create S
+0004f790: 5441 504c 4520 524f 4920 6672 6f6d 206c  TAPLE ROI from l
+0004f7a0: 6973 7420 6f66 2052 4f49 732e 2222 220a  ist of ROIs.""".
+0004f7b0: 0a20 2020 2023 2054 7279 2069 6d70 6f72  .    # Try impor
+0004f7c0: 7420 5369 6d70 6c65 4954 4b0a 2020 2020  t SimpleITK.    
+0004f7d0: 7472 793a 0a20 2020 2020 2020 2069 6d70  try:.        imp
+0004f7e0: 6f72 7420 5369 6d70 6c65 4954 4b20 6173  ort SimpleITK as
+0004f7f0: 2073 6974 6b0a 2020 2020 6578 6365 7074   sitk.    except
+0004f800: 204d 6f64 756c 654e 6f74 466f 756e 6445   ModuleNotFoundE
+0004f810: 7272 6f72 3a0a 2020 2020 2020 2020 7261  rror:.        ra
+0004f820: 6973 6520 4d6f 6475 6c65 4e6f 7446 6f75  ise ModuleNotFou
+0004f830: 6e64 4572 726f 7228 2253 696d 706c 6549  ndError("SimpleI
+0004f840: 544b 2069 7320 7265 7175 6972 6564 2074  TK is required t
+0004f850: 6f20 6361 6c63 756c 6174 6520 5354 4150  o calculate STAP
+0004f860: 4c45 2063 6f6e 746f 7572 2e20 220a 2020  LE contour. ".  
+0004f870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f890: 2254 7279 2069 6e73 7461 6c6c 696e 6720  "Try installing 
+0004f8a0: 7669 613a 2070 6970 2069 6e73 7461 6c6c  via: pip install
+0004f8b0: 2073 696d 706c 6569 746b 2229 0a0a 2020   simpleitk")..  
+0004f8c0: 2020 2320 4765 7420 5354 4150 4c45 206d    # Get STAPLE m
+0004f8d0: 6173 6b0a 2020 2020 726f 695f 6172 7261  ask.    roi_arra
+0004f8e0: 7973 203d 205b 5d0a 2020 2020 666f 7220  ys = [].    for 
+0004f8f0: 726f 6920 696e 2072 6f69 733a 0a20 2020  roi in rois:.   
+0004f900: 2020 2020 2072 6f69 5f61 7272 6179 732e       roi_arrays.
+0004f910: 6170 7065 6e64 2873 6974 6b2e 4765 7449  append(sitk.GetI
+0004f920: 6d61 6765 4672 6f6d 4172 7261 7928 726f  mageFromArray(ro
+0004f930: 692e 6765 745f 6d61 736b 280a 2020 2020  i.get_mask(.    
+0004f940: 2020 2020 2020 2020 7374 616e 6461 7264          standard
+0004f950: 6973 653d 5472 7565 292e 6173 7479 7065  ise=True).astype
+0004f960: 2869 6e74 2929 290a 2020 2020 7072 6f62  (int))).    prob
+0004f970: 7320 3d20 7369 746b 2e47 6574 4172 7261  s = sitk.GetArra
+0004f980: 7946 726f 6d49 6d61 6765 2873 6974 6b2e  yFromImage(sitk.
+0004f990: 5354 4150 4c45 2872 6f69 5f61 7272 6179  STAPLE(roi_array
+0004f9a0: 732c 2031 2929 0a20 2020 206d 6173 6b20  s, 1)).    mask 
+0004f9b0: 3d20 7072 6f62 7320 3e20 302e 3935 0a0a  = probs > 0.95..
+0004f9c0: 2020 2020 2320 4372 6561 7465 2053 5441      # Create STA
+0004f9d0: 504c 4520 524f 4920 6f62 6a65 6374 0a20  PLE ROI object. 
+0004f9e0: 2020 2072 6574 7572 6e20 524f 4928 6d61     return ROI(ma
+0004f9f0: 736b 2c20 2a2a 6b77 6172 6773 290a 0a0a  sk, **kwargs)...
+0004fa00: 6465 6620 6372 6561 7465 5f6d 616a 6f72  def create_major
+0004fa10: 6974 795f 766f 7465 2872 6f69 732c 202a  ity_vote(rois, *
+0004fa20: 2a6b 7761 7267 7329 3a0a 2020 2020 2222  *kwargs):.    ""
+0004fa30: 2243 7265 6174 6520 6d61 6a6f 7269 7479  "Create majority
+0004fa40: 2076 6f74 6520 524f 4920 6672 6f6d 206c   vote ROI from l
+0004fa50: 6973 7420 6f66 2052 4f49 732e 2222 220a  ist of ROIs.""".
+0004fa60: 0a20 2020 206d 6173 6b20 3d20 726f 6973  .    mask = rois
+0004fa70: 5b30 5d2e 6765 745f 6d61 736b 2873 7461  [0].get_mask(sta
+0004fa80: 6e64 6172 6469 7365 3d54 7275 6529 2e61  ndardise=True).a
+0004fa90: 7374 7970 6528 696e 7429 0a20 2020 2066  stype(int).    f
+0004faa0: 6f72 2072 6f69 2069 6e20 726f 6973 5b31  or roi in rois[1
+0004fab0: 3a5d 3a0a 2020 2020 2020 2020 6d61 736b  :]:.        mask
+0004fac0: 202b 3d20 726f 692e 6765 745f 6d61 736b   += roi.get_mask
+0004fad0: 2873 7461 6e64 6172 6469 7365 3d54 7275  (standardise=Tru
+0004fae0: 6529 2e61 7374 7970 6528 696e 7429 0a20  e).astype(int). 
+0004faf0: 2020 206d 6173 6b20 3d20 6d61 736b 203e     mask = mask >
+0004fb00: 3d20 6c65 6e28 726f 6973 2920 2f20 320a  = len(rois) / 2.
+0004fb10: 2020 2020 7265 7475 726e 2052 4f49 286d      return ROI(m
+0004fb20: 6173 6b2c 202a 2a6b 7761 7267 7329 0a0a  ask, **kwargs)..
+0004fb30: 0a64 6566 2063 7265 6174 655f 726f 695f  .def create_roi_
+0004fb40: 7375 6d28 726f 6973 2c20 2a2a 6b77 6172  sum(rois, **kwar
+0004fb50: 6773 293a 0a20 2020 2022 2222 4372 6561  gs):.    """Crea
+0004fb60: 7465 2052 4f49 2066 726f 6d20 7375 6d20  te ROI from sum 
+0004fb70: 6f66 206c 6973 7420 6f66 2052 4f49 732e  of list of ROIs.
+0004fb80: 2222 220a 0a20 2020 206d 6173 6b20 3d20  """..    mask = 
+0004fb90: 726f 6973 5b30 5d2e 6765 745f 6d61 736b  rois[0].get_mask
+0004fba0: 2873 7461 6e64 6172 6469 7365 3d54 7275  (standardise=Tru
+0004fbb0: 6529 2e63 6f70 7928 290a 2020 2020 666f  e).copy().    fo
+0004fbc0: 7220 726f 6920 696e 2072 6f69 735b 313a  r roi in rois[1:
+0004fbd0: 5d3a 0a20 2020 2020 2020 206d 6173 6b20  ]:.        mask 
+0004fbe0: 2b3d 2072 6f69 2e67 6574 5f6d 6173 6b28  += roi.get_mask(
+0004fbf0: 7374 616e 6461 7264 6973 653d 5472 7565  standardise=True
+0004fc00: 290a 2020 2020 7265 7475 726e 2052 4f49  ).    return ROI
+0004fc10: 286d 6173 6b2c 202a 2a6b 7761 7267 7329  (mask, **kwargs)
+0004fc20: 0a0a 0a64 6566 2063 7265 6174 655f 726f  ...def create_ro
+0004fc30: 695f 6f76 6572 6c61 7028 726f 6973 2c20  i_overlap(rois, 
+0004fc40: 2a2a 6b77 6172 6773 293a 0a20 2020 2022  **kwargs):.    "
+0004fc50: 2222 4372 6561 7465 2052 4f49 2066 726f  ""Create ROI fro
+0004fc60: 6d20 6f76 6572 6c61 7020 6f66 206c 6973  m overlap of lis
+0004fc70: 7420 6f66 2052 4f49 732e 2222 220a 0a20  t of ROIs.""".. 
+0004fc80: 2020 206d 6173 6b20 3d20 726f 6973 5b30     mask = rois[0
+0004fc90: 5d2e 6765 745f 6d61 736b 2873 7461 6e64  ].get_mask(stand
+0004fca0: 6172 6469 7365 3d54 7275 6529 2e63 6f70  ardise=True).cop
+0004fcb0: 7928 290a 2020 2020 666f 7220 726f 6920  y().    for roi 
+0004fcc0: 696e 2072 6f69 735b 313a 5d3a 0a20 2020  in rois[1:]:.   
+0004fcd0: 2020 2020 206d 6173 6b20 2a3d 2072 6f69       mask *= roi
+0004fce0: 2e67 6574 5f6d 6173 6b28 7374 616e 6461  .get_mask(standa
+0004fcf0: 7264 6973 653d 5472 7565 290a 2020 2020  rdise=True).    
+0004fd00: 7265 7475 726e 2052 4f49 286d 6173 6b2c  return ROI(mask,
+0004fd10: 202a 2a6b 7761 7267 7329 0a0a 0a64 6566   **kwargs)...def
+0004fd20: 2064 665f 746f 5f68 746d 6c28 6466 293a   df_to_html(df):
+0004fd30: 0a20 2020 2022 2222 436f 6e76 6572 7420  .    """Convert 
+0004fd40: 6120 7061 6e64 6173 2044 6174 6146 7261  a pandas DataFra
+0004fd50: 6d65 2074 6f20 6874 6d6c 2e22 2222 0a0a  me to html."""..
+0004fd60: 2020 2020 2320 436f 6e76 6572 7420 6461      # Convert da
+0004fd70: 7461 6672 616d 6520 746f 2048 544d 4c0a  taframe to HTML.
+0004fd80: 2020 2020 6874 6d6c 203d 2064 662e 6669      html = df.fi
+0004fd90: 6c6c 6e61 2827 e280 9427 292e 746f 5f68  llna('...').to_h
+0004fda0: 746d 6c28 696e 6465 783d 4661 6c73 6529  tml(index=False)
+0004fdb0: 0a20 2020 2068 746d 6c20 3d20 6874 6d6c  .    html = html
+0004fdc0: 2e72 6570 6c61 6365 2822 5e33 222c 2022  .replace("^3", "
+0004fdd0: 3c73 7570 3e33 3c2f 7375 703e 2229 2e72  <sup>3</sup>").r
+0004fde0: 6570 6c61 6365 2822 5e32 222c 2022 3c73  eplace("^2", "<s
+0004fdf0: 7570 3e32 3c2f 7375 703e 2229 0a0a 2020  up>2</sup>")..  
+0004fe00: 2020 2320 4164 6420 6865 6164 6572 2077    # Add header w
+0004fe10: 6974 6820 7374 796c 6520 6465 7461 696c  ith style detail
+0004fe20: 730a 2020 2020 6865 6164 6572 203d 2022  s.    header = "
+0004fe30: 2222 0a20 2020 2020 2020 203c 6865 6164  "".        <head
+0004fe40: 3e0a 2020 2020 2020 2020 2020 2020 3c73  >.            <s
+0004fe50: 7479 6c65 3e0a 2020 2020 2020 2020 2020  tyle>.          
+0004fe60: 2020 2020 2020 7468 2c20 7464 207b 0a20        th, td {. 
+0004fe70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fe80: 2020 2070 6164 6469 6e67 3a20 3270 7820     padding: 2px 
+0004fe90: 3270 783b 0a20 2020 2020 2020 2020 2020  2px;.           
+0004fea0: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+0004feb0: 2020 2020 2020 2074 6820 7b0a 2020 2020         th {.    
+0004fec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fed0: 6261 636b 6772 6f75 6e64 2d63 6f6c 6f72  background-color
+0004fee0: 3a20 7472 616e 7370 6172 656e 743b 0a20  : transparent;. 
+0004fef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ff00: 2020 2074 6578 742d 616c 6967 6e3a 2063     text-align: c
+0004ff10: 656e 7465 723b 0a20 2020 2020 2020 2020  enter;.         
+0004ff20: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0004ff30: 2020 2020 203c 2f73 7479 6c65 3e0a 2020       </style>.  
+0004ff40: 2020 2020 2020 3c2f 6865 6164 3e0a 2020        </head>.  
+0004ff50: 2020 2222 220a 2020 2020 7461 626c 655f    """.    table_
+0004ff60: 6874 6d6c 203d 2028 0a20 2020 2020 2020  html = (.       
+0004ff70: 2028 6865 6164 6572 202b 2068 746d 6c29   (header + html)
+0004ff80: 0a20 2020 2020 2020 202e 7265 706c 6163  .        .replac
+0004ff90: 6528 2226 6774 3b22 2c20 223e 2229 0a20  e("&gt;", ">"). 
+0004ffa0: 2020 2020 2020 202e 7265 706c 6163 6528         .replace(
+0004ffb0: 2226 6c74 3b22 2c20 223c 2229 0a20 2020  "&lt;", "<").   
+0004ffc0: 2020 2020 202e 7265 706c 6163 6528 2226       .replace("&
+0004ffd0: 616d 703b 222c 2022 2622 290a 2020 2020  amp;", "&").    
+0004ffe0: 290a 2020 2020 7265 7475 726e 2074 6162  ).    return tab
+0004fff0: 6c65 5f68 746d 6c0a 0a0a 6465 6620 6265  le_html...def be
+00050000: 7374 5f74 6578 745f 636f 6c6f 7228 7265  st_text_color(re
+00050010: 642c 2067 7265 656e 2c20 626c 7565 293a  d, green, blue):
+00050020: 0a20 2020 2069 6620 2872 6564 202a 2030  .    if (red * 0
+00050030: 2e32 3939 202b 2067 7265 656e 202a 2030  .299 + green * 0
+00050040: 2e35 3837 202b 2062 6c75 6520 2a20 302e  .587 + blue * 0.
+00050050: 3131 3429 203e 2031 3836 3a0a 2020 2020  114) > 186:.    
+00050060: 2020 2020 7265 7475 726e 2022 626c 6163      return "blac
+00050070: 6b22 0a20 2020 2072 6574 7572 6e20 2277  k".    return "w
+00050080: 6869 7465 220a 0a0a 6465 6620 6765 745f  hite"...def get_
+00050090: 636f 6c6f 7265 645f 726f 695f 7374 7269  colored_roi_stri
+000500a0: 6e67 2872 6f69 2c20 6772 6579 3d46 616c  ng(roi, grey=Fal
+000500b0: 7365 2c20 636f 6c6f 723d 4e6f 6e65 293a  se, color=None):
+000500c0: 0a20 2020 2022 2222 4765 7420 524f 4920  .    """Get ROI 
+000500d0: 6e61 6d65 2069 6e20 4854 4d4c 2077 6974  name in HTML wit
+000500e0: 6820 6261 636b 6772 6f75 6e64 2063 6f6c  h background col
+000500f0: 6f72 2066 726f 6d20 726f 692e 636f 6c6f  or from roi.colo
+00050100: 722e 2049 6620 6772 6579 3d54 7275 652c  r. If grey=True,
+00050110: 0a20 2020 2074 6865 2062 6163 6b67 726f  .    the backgro
+00050120: 756e 6420 636f 6c6f 7220 7769 6c6c 2062  und color will b
+00050130: 6520 6772 6579 2e22 2222 0a0a 2020 2020  e grey."""..    
+00050140: 6966 2063 6f6c 6f72 2069 7320 4e6f 6e65  if color is None
+00050150: 3a0a 2020 2020 2020 2020 636f 6c6f 7220  :.        color 
+00050160: 3d20 726f 692e 636f 6c6f 720a 2020 2020  = roi.color.    
+00050170: 6966 2067 7265 793a 0a20 2020 2020 2020  if grey:.       
+00050180: 2072 6564 2c20 6772 6565 6e2c 2062 6c75   red, green, blu
+00050190: 6520 3d20 3235 352c 2032 3535 2c20 3235  e = 255, 255, 25
+000501a0: 350a 2020 2020 2020 2020 7265 642c 2067  5.        red, g
+000501b0: 7265 656e 2c20 626c 7565 203d 2031 3238  reen, blue = 128
+000501c0: 2c20 3132 382c 2031 3238 0a20 2020 2020  , 128, 128.     
+000501d0: 2020 2074 6578 745f 636f 6c20 3d20 3230     text_col = 20
+000501e0: 302c 2032 3030 2c20 3230 300a 2020 2020  0, 200, 200.    
+000501f0: 2020 2020 2320 4176 6f69 6420 7365 7474      # Avoid sett
+00050200: 696e 6720 636f 6c6f 7572 2066 6f72 2067  ing colour for g
+00050210: 7265 7965 6420 6f75 7420 524f 4973 2e0a  reyed out ROIs..
+00050220: 2020 2020 2020 2020 2320 5468 6973 2067          # This g
+00050230: 6976 6573 2067 6f6f 6420 7265 6164 6162  ives good readab
+00050240: 696c 6974 7920 666f 7220 626f 7468 2064  ility for both d
+00050250: 6172 6b20 616e 6420 6c69 6768 7420 7468  ark and light th
+00050260: 656d 6573 2e0a 2020 2020 2020 2020 7265  emes..        re
+00050270: 7475 726e 2028 273c 703e 266e 6273 703b  turn ('<p>&nbsp;
+00050280: 7b7d 266e 6273 703b 3c2f 703e 2729 2e66  {}&nbsp;</p>').f
+00050290: 6f72 6d61 7428 726f 692e 6e61 6d65 290a  ormat(roi.name).
+000502a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000502b0: 2020 7265 642c 2067 7265 656e 2c20 626c    red, green, bl
+000502c0: 7565 203d 205b 6320 2a20 3235 3520 666f  ue = [c * 255 fo
+000502d0: 7220 6320 696e 2063 6f6c 6f72 5b3a 335d  r c in color[:3]
+000502e0: 5d0a 2020 2020 2020 2020 7465 7874 5f63  ].        text_c
+000502f0: 6f6c 203d 2062 6573 745f 7465 7874 5f63  ol = best_text_c
+00050300: 6f6c 6f72 2872 6564 2c20 6772 6565 6e2c  olor(red, green,
+00050310: 2062 6c75 6529 0a20 2020 2072 6574 7572   blue).    retur
+00050320: 6e20 280a 2020 2020 2020 2020 273c 7020  n (.        '<p 
+00050330: 7374 796c 653d 2262 6163 6b67 726f 756e  style="backgroun
+00050340: 642d 636f 6c6f 723a 2072 6762 287b 7d2c  d-color: rgb({},
+00050350: 207b 7d2c 207b 7d29 3b20 270a 2020 2020   {}, {}); '.    
+00050360: 2020 2020 2763 6f6c 6f72 3a20 7b7d 3b22      'color: {};"
+00050370: 3e26 6e62 7370 3b7b 7d26 6e62 7370 3b3c  >&nbsp;{}&nbsp;<
+00050380: 2f70 3e27 0a20 2020 2029 2e66 6f72 6d61  /p>'.    ).forma
+00050390: 7428 7265 642c 2067 7265 656e 2c20 626c  t(red, green, bl
+000503a0: 7565 2c20 7465 7874 5f63 6f6c 2c20 726f  ue, text_col, ro
+000503b0: 692e 6e61 6d65 290a 0a64 6566 2063 6f6d  i.name)..def com
+000503c0: 7061 7265 5f72 6f69 5f70 6169 7273 280a  pare_roi_pairs(.
+000503d0: 2020 2020 7061 6972 732c 200a 2020 2020      pairs, .    
+000503e0: 6874 6d6c 3d46 616c 7365 2c0a 2020 2020  html=False,.    
+000503f0: 6e61 6d65 5f61 735f 696e 6465 783d 5472  name_as_index=Tr
+00050400: 7565 2c0a 2020 2020 6772 6579 6564 5f6f  ue,.    greyed_o
+00050410: 7574 3d4e 6f6e 652c 0a20 2020 2063 6f6c  ut=None,.    col
+00050420: 6f72 6564 3d46 616c 7365 2c0a 2020 2020  ored=False,.    
+00050430: 726f 695f 6b77 6172 6773 3d7b 7d2c 0a20  roi_kwargs={},. 
+00050440: 2020 202a 2a6b 7761 7267 730a 293a 0a20     **kwargs.):. 
+00050450: 2020 2069 6620 6874 6d6c 3a0a 2020 2020     if html:.    
+00050460: 2020 2020 6e61 6d65 5f61 735f 696e 6465      name_as_inde
+00050470: 7820 3d20 4661 6c73 650a 2020 2020 6966  x = False.    if
+00050480: 2067 7265 7965 645f 6f75 7420 6973 204e   greyed_out is N
+00050490: 6f6e 653a 0a20 2020 2020 2020 2067 7265  one:.        gre
+000504a0: 7965 645f 6f75 7420 3d20 5b5d 0a20 2020  yed_out = [].   
+000504b0: 2064 6673 203d 205b 5d0a 2020 2020 666f   dfs = [].    fo
+000504c0: 7220 726f 6931 2c20 726f 6932 2069 6e20  r roi1, roi2 in 
+000504d0: 7061 6972 733a 0a0a 2020 2020 2020 2020  pairs:..        
+000504e0: 2320 4765 7420 4461 7461 4672 616d 6520  # Get DataFrame 
+000504f0: 666f 7220 7468 6973 2070 6169 720a 2020  for this pair.  
+00050500: 2020 2020 2020 6466 5f72 6f77 203d 2072        df_row = r
+00050510: 6f69 312e 6765 745f 636f 6d70 6172 6973  oi1.get_comparis
+00050520: 6f6e 2872 6f69 322c 206e 616d 655f 6173  on(roi2, name_as
+00050530: 5f69 6e64 6578 3d6e 616d 655f 6173 5f69  _index=name_as_i
+00050540: 6e64 6578 2c0a 2020 2020 2020 2020 2020  ndex,.          
+00050550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050560: 2020 2020 2020 2020 2020 202a 2a6b 7761             **kwa
+00050570: 7267 7329 0a0a 2020 2020 2020 2020 2320  rgs)..        # 
+00050580: 5265 706c 6163 6520 7661 6c75 6573 2077  Replace values w
+00050590: 6974 6820 222d 2d22 2069 6620 6569 7468  ith "--" if eith
+000505a0: 6572 2052 4f49 2069 7320 6772 6579 6564  er ROI is greyed
+000505b0: 206f 7574 0a20 2020 2020 2020 2067 7265   out.        gre
+000505c0: 7920 3d20 726f 6931 2069 6e20 6772 6579  y = roi1 in grey
+000505d0: 6564 5f6f 7574 206f 7220 726f 6932 2069  ed_out or roi2 i
+000505e0: 6e20 6772 6579 6564 5f6f 7574 0a20 2020  n greyed_out.   
+000505f0: 2020 2020 2069 6620 6772 6579 3a0a 2020       if grey:.  
+00050600: 2020 2020 2020 2020 2020 666f 7220 636f            for co
+00050610: 6c20 696e 2064 665f 726f 772e 636f 6c75  l in df_row.colu
+00050620: 6d6e 733a 0a20 2020 2020 2020 2020 2020  mns:.           
+00050630: 2020 2020 2069 6620 636f 6c20 3d3d 2022       if col == "
+00050640: 524f 4922 3a20 0a20 2020 2020 2020 2020  ROI": .         
+00050650: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00050660: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+00050670: 2020 2020 6466 5f72 6f77 5b63 6f6c 5d20      df_row[col] 
+00050680: 3d20 222d 2d22 0a0a 2020 2020 2020 2020  = "--"..        
+00050690: 2320 4164 6a75 7374 2063 6f6d 7061 7269  # Adjust compari
+000506a0: 736f 6e20 6e61 6d65 0a20 2020 2020 2020  son name.       
+000506b0: 2063 6f6d 705f 6e61 6d65 203d 2072 6f69   comp_name = roi
+000506c0: 312e 6765 745f 636f 6d70 6172 6973 6f6e  1.get_comparison
+000506d0: 5f6e 616d 6528 726f 6932 2c20 636f 6c6f  _name(roi2, colo
+000506e0: 7265 643d 636f 6c6f 7265 642c 2067 7265  red=colored, gre
+000506f0: 793d 6772 6579 2c0a 2020 2020 2020 2020  y=grey,.        
+00050700: 2020 2020 2020 2020 726f 695f 6b77 6172          roi_kwar
+00050710: 6773 3d72 6f69 5f6b 7761 7267 7329 0a20  gs=roi_kwargs). 
+00050720: 2020 2020 2020 2069 6620 6e61 6d65 5f61         if name_a
+00050730: 735f 696e 6465 783a 0a20 2020 2020 2020  s_index:.       
+00050740: 2020 2020 2064 665f 726f 772e 7265 6e61       df_row.rena
+00050750: 6d65 287b 6466 5f72 6f77 2e69 6e64 6578  me({df_row.index
+00050760: 5b30 5d3a 2063 6f6d 705f 6e61 6d65 7d2c  [0]: comp_name},
+00050770: 2069 6e70 6c61 6365 3d54 7275 6529 0a20   inplace=True). 
+00050780: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00050790: 2020 2020 2020 2020 2064 665f 726f 772e           df_row.
+000507a0: 696c 6f63 5b30 2c20 305d 203d 2063 6f6d  iloc[0, 0] = com
+000507b0: 705f 6e61 6d65 0a0a 2020 2020 2020 2020  p_name..        
+000507c0: 6466 732e 6170 7065 6e64 2864 665f 726f  dfs.append(df_ro
+000507d0: 7729 0a0a 2020 2020 6967 6e6f 7265 5f69  w)..    ignore_i
+000507e0: 6e64 6578 203d 2046 616c 7365 2069 6620  ndex = False if 
+000507f0: 6e61 6d65 5f61 735f 696e 6465 7820 656c  name_as_index el
+00050800: 7365 2054 7275 650a 2020 2020 6466 203d  se True.    df =
+00050810: 2070 642e 636f 6e63 6174 2864 6673 2c20   pd.concat(dfs, 
+00050820: 6967 6e6f 7265 5f69 6e64 6578 3d69 676e  ignore_index=ign
+00050830: 6f72 655f 696e 6465 7829 2069 6620 6466  ore_index) if df
+00050840: 7320 656c 7365 204e 6f6e 650a 2020 2020  s else None.    
+00050850: 6966 2068 746d 6c3a 0a20 2020 2020 2020  if html:.       
+00050860: 2072 6574 7572 6e20 6466 5f74 6f5f 6874   return df_to_ht
+00050870: 6d6c 2864 6629 0a20 2020 2072 6574 7572  ml(df).    retur
+00050880: 6e20 6466 0a0a 6465 6620 6765 745f 636f  n df..def get_co
+00050890: 6e66 6f72 6d69 7479 5f69 6e64 6578 280a  nformity_index(.
+000508a0: 2020 2020 726f 6973 2c0a 2020 2020 6369      rois,.    ci
+000508b0: 5f74 7970 653d 2267 656e 222c 0a20 2020  _type="gen",.   
+000508c0: 2073 696e 676c 655f 736c 6963 653d 4661   single_slice=Fa
+000508d0: 6c73 652c 0a20 2020 2076 6965 773d 2278  lse,.    view="x
+000508e0: 2d79 222c 200a 2020 2020 736c 3d4e 6f6e  -y", .    sl=Non
+000508f0: 652c 200a 2020 2020 6964 783d 4e6f 6e65  e, .    idx=None
+00050900: 2c20 0a20 2020 2070 6f73 3d4e 6f6e 652c  , .    pos=None,
+00050910: 200a 2020 2020 6d65 7468 6f64 3d4e 6f6e   .    method=Non
+00050920: 652c 0a20 2020 2066 6c61 7474 656e 3d46  e,.    flatten=F
+00050930: 616c 7365 2c0a 2020 2020 293a 0a20 2020  alse,.    ):.   
+00050940: 2022 2222 0a20 2020 2047 6574 2063 6f6e   """.    Get con
+00050950: 666f 726d 6974 7920 696e 6465 7820 666f  formity index fo
+00050960: 7220 7477 6f20 6f72 206d 6f72 6520 524f  r two or more RO
+00050970: 4973 2e0a 0a20 2020 2054 6865 2063 6f6e  Is...    The con
+00050980: 666f 726d 6974 7920 696e 6465 7820 6d61  formity index ma
+00050990: 7920 6265 2063 616c 6375 6c61 7465 6420  y be calculated 
+000509a0: 676c 6f62 616c 6c79 206f 7220 666f 7220  globally or for 
+000509b0: 6120 7369 6e67 6c65 2073 6c69 6365 2e0a  a single slice..
+000509c0: 0a20 2020 2054 6869 7320 6675 6e63 7469  .    This functi
+000509d0: 6f6e 2072 6574 7572 6e73 2065 6974 6865  on returns eithe
+000509e0: 7220 7468 6520 7661 6c75 6520 6f66 206f  r the value of o
+000509f0: 6e65 206f 6620 7468 6520 7468 7265 6520  ne of the three 
+00050a00: 7479 7065 730a 2020 2020 6f66 2063 6f6e  types.    of con
+00050a10: 666f 726d 6974 7920 696e 6465 7820 2822  formity index ("
+00050a20: 6765 6e22 2028 666f 7220 6765 6e65 7261  gen" (for genera
+00050a30: 6c69 7365 6429 2c20 2270 6169 7273 222c  lised), "pairs",
+00050a40: 2022 636f 6d6d 6f6e 2229 0a20 2020 2072   "common").    r
+00050a50: 6566 6572 7265 6420 746f 2069 6e3a 0a20  eferred to in:. 
+00050a60: 2020 2068 7474 7073 3a2f 2f64 6f69 2e6f     https://doi.o
+00050a70: 7267 2f31 302e 3130 3838 2f30 3033 312d  rg/10.1088/0031-
+00050a80: 3931 3535 2f35 342f 392f 3031 380a 2020  9155/54/9/018.  
+00050a90: 2020 6f72 2061 2073 6b72 742e 636f 7265    or a skrt.core
+00050aa0: 2e44 6174 6120 6f62 6a65 6374 2077 6974  .Data object wit
+00050ab0: 6820 7468 6520 7661 6c75 6573 206f 6620  h the values of 
+00050ac0: 616c 6c20 7468 7265 652e 0a20 2020 2046  all three..    F
+00050ad0: 6f72 2074 6865 2063 6173 6520 6f66 2074  or the case of t
+00050ae0: 776f 2052 4f49 732c 2074 6865 2074 6872  wo ROIs, the thr
+00050af0: 6565 206d 6574 7269 6373 2061 7265 2061  ee metrics are a
+00050b00: 6c6c 2065 7175 6976 616c 656e 740a 2020  ll equivalent.  
+00050b10: 2020 746f 2074 6865 204a 6163 6361 7264    to the Jaccard
+00050b20: 2063 6f6e 666f 726d 6974 7920 696e 6465   conformity inde
+00050b30: 782e 0a0a 2020 2020 2a2a 5061 7261 6d65  x...    **Parame
+00050b40: 7465 7273 3a2a 2a0a 2020 2020 2020 2020  ters:**.        
+00050b50: 0a20 2020 2072 6f69 7320 3a20 6c69 7374  .    rois : list
+00050b60: 0a20 2020 2020 2020 204c 6973 7420 6f66  .        List of
+00050b70: 2074 776f 206f 7220 6d6f 7265 2073 6b72   two or more skr
+00050b80: 742e 7374 7275 6374 7572 6573 2e52 4f49  t.structures.ROI
+00050b90: 206f 626a 6563 7473 2066 6f72 2077 6869   objects for whi
+00050ba0: 6368 2063 6f6e 666f 726d 6974 790a 2020  ch conformity.  
+00050bb0: 2020 2020 2020 696e 6465 7820 6973 2074        index is t
+00050bc0: 6f20 6265 2063 616c 6375 6c61 7465 642e  o be calculated.
+00050bd0: 0a0a 2020 2020 6369 5f74 7970 653a 2073  ..    ci_type: s
+00050be0: 7472 2c20 6465 6661 756c 743d 2267 656e  tr, default="gen
+00050bf0: 220a 2020 2020 2020 2020 5479 7065 206f  ".        Type o
+00050c00: 6620 636f 6e66 6f72 6d69 7479 2069 6e64  f conformity ind
+00050c10: 6578 2074 6f20 6265 2072 6574 7572 6e65  ex to be returne
+00050c20: 642c 2066 726f 6d20 2267 656e 2220 2866  d, from "gen" (f
+00050c30: 6f72 2067 656e 6572 616c 6973 6564 292c  or generalised),
+00050c40: 0a20 2020 2020 2020 2022 7061 6972 7322  .        "pairs"
+00050c50: 2c20 2263 6f6d 6d6f 6e22 2e20 2049 6620  , "common".  If 
+00050c60: 7365 7420 746f 2022 616c 6c22 2c20 6120  set to "all", a 
+00050c70: 736b 7274 2e63 6f72 652e 4461 7461 206f  skrt.core.Data o
+00050c80: 626a 6563 7420 7769 7468 0a20 2020 2020  bject with.     
+00050c90: 2020 2076 616c 7565 7320 666f 7220 7468     values for th
+00050ca0: 6520 7468 7265 6520 7479 7065 7320 6f66  e three types of
+00050cb0: 2063 6f6e 666f 726d 6974 7920 696e 6465   conformity inde
+00050cc0: 7820 6973 2072 6574 7572 6e65 642e 0a0a  x is returned...
+00050cd0: 2020 2020 7369 6e67 6c65 5f73 6c69 6365      single_slice
+00050ce0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+00050cf0: 3d46 616c 7365 0a20 2020 2020 2020 2049  =False.        I
+00050d00: 6620 4661 6c73 652c 2074 6865 2067 6c6f  f False, the glo
+00050d10: 6261 6c20 3344 2044 6963 6520 7363 6f72  bal 3D Dice scor
+00050d20: 6520 6f66 2074 6865 2066 756c 6c20 524f  e of the full RO
+00050d30: 4973 2077 696c 6c20 6265 2072 6574 7572  Is will be retur
+00050d40: 6e65 643b 0a20 2020 2020 2020 206f 7468  ned;.        oth
+00050d50: 6572 7769 7365 2c20 7468 6520 3244 2044  erwise, the 2D D
+00050d60: 6963 6520 7363 6f72 6520 6f6e 2061 2073  ice score on a s
+00050d70: 696e 676c 6520 736c 6963 6520 7769 6c6c  ingle slice will
+00050d80: 2062 6520 7265 7475 726e 6564 2e0a 0a20   be returned... 
+00050d90: 2020 2076 6965 7720 3a20 7374 722c 2064     view : str, d
+00050da0: 6566 6175 6c74 3d22 782d 7922 0a20 2020  efault="x-y".   
+00050db0: 2020 2020 204f 7269 656e 7461 7469 6f6e       Orientation
+00050dc0: 206f 6620 736c 6963 6520 6f6e 2077 6869   of slice on whi
+00050dd0: 6368 2074 6f20 6765 7420 4469 6365 2073  ch to get Dice s
+00050de0: 636f 7265 2e20 4f6e 6c79 2075 7365 6420  core. Only used 
+00050df0: 6966 200a 2020 2020 2020 2020 7369 6e67  if .        sing
+00050e00: 6c65 5f73 6c69 6365 3d54 7275 652e 2049  le_slice=True. I
+00050e10: 6620 7573 696e 672c 203c 6178 3e20 6d75  f using, <ax> mu
+00050e20: 7374 2062 6520 616e 2061 7869 7320 7468  st be an axis th
+00050e30: 6174 206c 6965 7320 616c 6f6e 670a 2020  at lies along.  
+00050e40: 2020 2020 2020 7468 6520 736c 6963 6520        the slice 
+00050e50: 696e 2074 6869 7320 6f72 6965 6e74 6174  in this orientat
+00050e60: 696f 6e2e 0a0a 2020 2020 736c 203a 2069  ion...    sl : i
+00050e70: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
+00050e80: 0a20 2020 2020 2020 2053 6c69 6365 206e  .        Slice n
+00050e90: 756d 6265 722e 2049 6620 6e6f 6e65 206f  umber. If none o
+00050ea0: 6620 3c73 6c3e 2c20 3c69 6478 3e20 6f72  f <sl>, <idx> or
+00050eb0: 203c 706f 733e 2061 7265 2073 7570 706c   <pos> are suppl
+00050ec0: 6965 6420 6275 740a 2020 2020 2020 2020  ied but.        
+00050ed0: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
+00050ee0: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
+00050ef0: 7261 6c20 736c 6963 6520 6f66 2074 6869  ral slice of thi
+00050f00: 7320 524f 4920 7769 6c6c 2062 6520 7573  s ROI will be us
+00050f10: 6564 2e0a 0a20 2020 2069 6478 203a 2069  ed...    idx : i
+00050f20: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
+00050f30: 0a20 2020 2020 2020 2041 7272 6179 2069  .        Array i
+00050f40: 6e64 6578 206f 6620 736c 6963 652e 2049  ndex of slice. I
+00050f50: 6620 6e6f 6e65 206f 6620 3c73 6c3e 2c20  f none of <sl>, 
+00050f60: 3c69 6478 3e20 6f72 203c 706f 733e 2061  <idx> or <pos> a
+00050f70: 7265 2073 7570 706c 6965 6420 6275 740a  re supplied but.
+00050f80: 2020 2020 2020 2020 3c73 696e 676c 655f          <single_
+00050f90: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
+00050fa0: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
+00050fb0: 6520 6f66 2074 6869 7320 524f 4920 7769  e of this ROI wi
+00050fc0: 6c6c 2062 6520 7573 6564 2e0a 0a20 2020  ll be used...   
+00050fd0: 2070 6f73 203a 2066 6c6f 6174 2c20 6465   pos : float, de
+00050fe0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00050ff0: 2020 2053 6c69 6365 2070 6f73 6974 696f     Slice positio
+00051000: 6e20 696e 206d 6d2e 2049 6620 6e6f 6e65  n in mm. If none
+00051010: 206f 6620 3c73 6c3e 2c20 3c69 6478 3e20   of <sl>, <idx> 
+00051020: 6f72 203c 706f 733e 2061 7265 2073 7570  or <pos> are sup
+00051030: 706c 6965 6420 6275 740a 2020 2020 2020  plied but.      
+00051040: 2020 3c73 696e 676c 655f 736c 6963 653e    <single_slice>
+00051050: 2069 7320 5472 7565 2c20 7468 6520 6365   is True, the ce
+00051060: 6e74 7261 6c20 736c 6963 6520 6f66 2074  ntral slice of t
+00051070: 6869 7320 524f 4920 7769 6c6c 2062 6520  his ROI will be 
+00051080: 7573 6564 2e0a 0a20 2020 206d 6574 686f  used...    metho
+00051090: 6420 3a20 7374 722c 2064 6566 6175 6c74  d : str, default
+000510a0: 3d4e 6f6e 650a 2020 2020 2020 2020 4d65  =None.        Me
+000510b0: 7468 6f64 2074 6f20 7573 6520 666f 7220  thod to use for 
+000510c0: 4469 6365 2073 636f 7265 2063 616c 6375  Dice score calcu
+000510d0: 6c61 7469 6f6e 2e20 4361 6e20 6265 3a20  lation. Can be: 
+000510e0: 0a20 2020 2020 2020 202d 2022 636f 6e74  .        - "cont
+000510f0: 6f75 7222 3a20 6765 7420 696e 7465 7273  our": get inters
+00051100: 6563 7469 6f6e 7320 616e 6420 6172 6561  ections and area
+00051110: 7320 6f66 2073 6861 7065 6c79 2063 6f6e  s of shapely con
+00051120: 746f 7572 732e 0a20 2020 2020 2020 202d  tours..        -
+00051130: 2022 6d61 736b 223a 2063 6f75 6e74 2069   "mask": count i
+00051140: 6e74 6572 7365 6374 696e 6720 766f 7865  ntersecting voxe
+00051150: 6c73 2069 6e20 6269 6e61 7279 206d 6173  ls in binary mas
+00051160: 6b73 2e0a 2020 2020 2020 2020 2d20 4e6f  ks..        - No
+00051170: 6e65 3a20 7573 6520 7468 6520 6d65 7468  ne: use the meth
+00051180: 6f64 2073 6574 2069 6e20 7365 6c66 2e64  od set in self.d
+00051190: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
+000511a0: 6f64 2e0a 2020 2020 2020 2020 466f 7220  od..        For 
+000511b0: 6d6f 7265 2074 6861 6e20 7477 6f20 524f  more than two RO
+000511c0: 4973 2061 6e64 203c 6369 5f74 7970 653e  Is and <ci_type>
+000511d0: 2022 636f 6d6d 6f6e 222c 206f 6e6c 7920   "common", only 
+000511e0: 7468 6520 226d 6173 6b22 0a20 2020 2020  the "mask".     
+000511f0: 2020 206d 6574 686f 6420 6973 2069 6d70     method is imp
+00051200: 6c65 6d65 6e74 6564 2e0a 0a20 2020 2066  lemented...    f
+00051210: 6c61 7474 656e 203a 2062 6f6f 6c2c 2064  latten : bool, d
+00051220: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
+00051230: 2020 2020 2049 6620 5472 7565 2c20 616c       If True, al
+00051240: 6c20 736c 6963 6573 2077 696c 6c20 6265  l slices will be
+00051250: 2066 6c61 7474 656e 6564 2069 6e20 7468   flattened in th
+00051260: 6520 6769 7665 6e20 6f72 6965 6e74 6174  e given orientat
+00051270: 696f 6e20 616e 640a 2020 2020 2020 2020  ion and.        
+00051280: 7468 6520 4469 6365 2073 636f 7265 206f  the Dice score o
+00051290: 6620 7468 6520 666c 6174 7465 6e65 6420  f the flattened 
+000512a0: 736c 6963 6573 2077 696c 6c20 6265 2072  slices will be r
+000512b0: 6574 7572 6e65 642e 204f 6e6c 7920 0a20  eturned. Only . 
+000512c0: 2020 2020 2020 2061 7661 696c 6162 6c65         available
+000512d0: 2069 6620 6d65 7468 6f64 3d22 6d61 736b   if method="mask
+000512e0: 222e 0a20 2020 2022 2222 0a0a 2020 2020  "..    """..    
+000512f0: 2320 5265 7175 6972 6520 7661 6c69 6420  # Require valid 
+00051300: 696e 7075 7473 2e0a 2020 2020 6966 206c  inputs..    if l
+00051310: 656e 2872 6f69 7329 203c 2032 206f 7220  en(rois) < 2 or 
+00051320: 6369 5f74 7970 6520 6e6f 7420 696e 205b  ci_type not in [
+00051330: 2263 6f6d 6d6f 6e22 2c20 2267 656e 222c  "common", "gen",
+00051340: 2022 7061 6972 7322 2c20 2261 6c6c 225d   "pairs", "all"]
+00051350: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00051360: 0a0a 2020 2020 2320 496e 6974 6961 6c69  ..    # Initiali
+00051370: 7365 2044 6174 6120 6f62 6a65 6374 2066  se Data object f
+00051380: 6f72 2063 6f6e 666f 726d 6974 7920 696e  or conformity in
+00051390: 6469 6365 732e 0a20 2020 2063 6920 3d20  dices..    ci = 
+000513a0: 736b 7274 2e63 6f72 652e 4461 7461 287b  skrt.core.Data({
+000513b0: 2263 6f6d 6d6f 6e22 3a20 302c 2022 6765  "common": 0, "ge
+000513c0: 6e22 3a30 2c20 2270 6169 7273 223a 307d  n":0, "pairs":0}
+000513d0: 290a 0a20 2020 2023 2044 6561 6c20 7769  )..    # Deal wi
+000513e0: 7468 2063 6173 6573 2022 6765 6e22 2061  th cases "gen" a
+000513f0: 6e64 2022 7061 6972 7322 2e0a 2020 2020  nd "pairs"..    
+00051400: 230a 2020 2020 2320 466f 7220 2267 656e  #.    # For "gen
+00051410: 222c 2074 6865 2063 6f6e 666f 726d 6974  ", the conformit
+00051420: 7920 696e 6465 7820 6973 2063 616c 6375  y index is calcu
+00051430: 6c61 7465 6420 6173 2074 6865 2072 6174  lated as the rat
+00051440: 696f 206f 660a 2020 2020 2320 2831 2920  io of.    # (1) 
+00051450: 7468 6520 7375 6d20 6f66 2074 6865 2069  the sum of the i
+00051460: 6e74 6572 7365 6374 696f 6e73 2066 6f72  ntersections for
+00051470: 2061 6c6c 2070 6169 7273 2074 6f20 2832   all pairs to (2
+00051480: 2920 7468 6520 7375 6d20 6f66 0a20 2020  ) the sum of.   
+00051490: 2023 2074 6865 2075 6e69 6f6e 7320 666f   # the unions fo
+000514a0: 7220 616c 6c20 7061 6972 732e 0a20 2020  r all pairs..   
+000514b0: 2023 0a20 2020 2023 2046 6f72 2022 7061   #.    # For "pa
+000514c0: 6972 732c 2074 6865 2063 6f6e 666f 726d  irs, the conform
+000514d0: 6974 7920 696e 6465 7820 6973 2063 616c  ity index is cal
+000514e0: 6375 616c 7465 6420 6173 2074 6865 206d  cualted as the m
+000514f0: 6561 6e20 6f66 2074 6865 0a20 2020 2023  ean of the.    #
+00051500: 204a 6163 6361 7264 2063 6f6e 666f 726d   Jaccard conform
+00051510: 6974 7920 696e 6469 6365 7320 666f 7220  ity indices for 
+00051520: 616c 6c20 7061 6972 732e 0a0a 2020 2020  all pairs...    
+00051530: 6e75 6d65 7261 746f 7220 3d20 300a 2020  numerator = 0.  
+00051540: 2020 6465 6e6f 6d69 6e61 746f 7220 3d20    denominator = 
+00051550: 300a 2020 2020 6e5f 7061 6972 203d 2030  0.    n_pair = 0
+00051560: 0a20 2020 2066 6f72 2069 6478 3120 696e  .    for idx1 in
+00051570: 2072 616e 6765 286c 656e 2872 6f69 7329   range(len(rois)
+00051580: 202d 2031 293a 0a20 2020 2020 2020 2066   - 1):.        f
+00051590: 6f72 2069 6478 3220 696e 2072 616e 6765  or idx2 in range
+000515a0: 2869 6478 3120 2b20 312c 206c 656e 2872  (idx1 + 1, len(r
+000515b0: 6f69 7329 293a 0a20 2020 2020 2020 2020  ois)):.         
+000515c0: 2020 2072 6f69 3120 3d20 726f 6973 5b69     roi1 = rois[i
+000515d0: 6478 315d 0a20 2020 2020 2020 2020 2020  dx1].           
+000515e0: 2072 6f69 3220 3d20 726f 6973 5b69 6478   roi2 = rois[idx
+000515f0: 325d 0a20 2020 2020 2020 2020 2020 2069  2].            i
+00051600: 6e74 6572 7365 6374 696f 6e2c 2075 6e69  ntersection, uni
+00051610: 6f6e 2c20 6d65 616e 5f73 697a 6520 3d20  on, mean_size = 
+00051620: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00051630: 2020 2020 2020 726f 6931 2e67 6574 5f69        roi1.get_i
+00051640: 6e74 6572 7365 6374 696f 6e5f 756e 696f  ntersection_unio
+00051650: 6e5f 7369 7a65 2872 6f69 322c 2073 696e  n_size(roi2, sin
+00051660: 676c 655f 736c 6963 652c 0a20 2020 2020  gle_slice,.     
+00051670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051680: 2020 2076 6965 772c 2073 6c2c 2069 6478     view, sl, idx
+00051690: 2c20 706f 732c 206d 6574 686f 642c 2066  , pos, method, f
+000516a0: 6c61 7474 656e 2929 0a20 2020 2020 2020  latten)).       
+000516b0: 2020 2020 206e 756d 6572 6174 6f72 202b       numerator +
+000516c0: 3d20 696e 7465 7273 6563 7469 6f6e 0a20  = intersection. 
+000516d0: 2020 2020 2020 2020 2020 2064 656e 6f6d             denom
+000516e0: 696e 6174 6f72 202b 3d20 756e 696f 6e0a  inator += union.
+000516f0: 2020 2020 2020 2020 2020 2020 6369 2e70              ci.p
+00051700: 6169 7273 202b 3d20 696e 7465 7273 6563  airs += intersec
+00051710: 7469 6f6e 202f 2075 6e69 6f6e 0a20 2020  tion / union.   
+00051720: 2020 2020 2020 2020 206e 5f70 6169 7220           n_pair 
+00051730: 2b3d 2031 0a0a 2020 2020 6369 2e67 656e  += 1..    ci.gen
+00051740: 203d 206e 756d 6572 6174 6f72 202f 2064   = numerator / d
+00051750: 656e 6f6d 696e 6174 6f72 0a20 2020 2063  enominator.    c
+00051760: 692e 7061 6972 7320 2f3d 206e 5f70 6169  i.pairs /= n_pai
+00051770: 720a 0a20 2020 2023 2044 6561 6c20 7769  r..    # Deal wi
+00051780: 7468 2063 6173 6520 2263 6f6d 6d6f 6e22  th case "common"
+00051790: 2e0a 2020 2020 230a 2020 2020 2320 5468  ..    #.    # Th
+000517a0: 6520 636f 6e66 6f72 6d69 7479 2069 6e64  e conformity ind
+000517b0: 6578 2069 7320 6361 6c63 756c 6174 6564  ex is calculated
+000517c0: 2061 7320 7468 6520 7261 7469 6f20 6f66   as the ratio of
+000517d0: 0a20 2020 2023 2028 3129 2074 6865 2063  .    # (1) the c
+000517e0: 6f6d 6d6f 6e20 696e 7465 7273 6563 7469  ommon intersecti
+000517f0: 6f6e 206f 6620 616c 6c20 524f 4973 2074  on of all ROIs t
+00051800: 6f20 2832 2920 7468 6520 636f 6d62 696e  o (2) the combin
+00051810: 6564 2075 6e69 6f6e 0a20 2020 2023 206f  ed union.    # o
+00051820: 6620 616c 6c20 524f 4973 2e0a 2020 2020  f all ROIs..    
+00051830: 6966 2032 203d 3d20 6c65 6e28 726f 6973  if 2 == len(rois
+00051840: 293a 0a20 2020 2020 2020 2069 6e74 6572  ):.        inter
+00051850: 7365 6374 696f 6e2c 2075 6e69 6f6e 2c20  section, union, 
+00051860: 6d65 616e 5f73 697a 6520 3d20 280a 2020  mean_size = (.  
+00051870: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+00051880: 6973 5b30 5d2e 6765 745f 696e 7465 7273  is[0].get_inters
+00051890: 6563 7469 6f6e 5f75 6e69 6f6e 5f73 697a  ection_union_siz
+000518a0: 6528 726f 6973 5b31 5d2c 2073 696e 676c  e(rois[1], singl
+000518b0: 655f 736c 6963 652c 0a20 2020 2020 2020  e_slice,.       
+000518c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000518d0: 2076 6965 772c 2073 6c2c 2069 6478 2c20   view, sl, idx, 
+000518e0: 706f 732c 206d 6574 686f 642c 2066 6c61  pos, method, fla
+000518f0: 7474 656e 2929 0a20 2020 2020 2020 2063  tten)).        c
+00051900: 692e 636f 6d6d 6f6e 203d 2069 6e74 6572  i.common = inter
+00051910: 7365 6374 696f 6e20 2f20 756e 696f 6e0a  section / union.
+00051920: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00051930: 2020 6966 206e 6f74 2073 696e 676c 655f    if not single_
+00051940: 736c 6963 653a 0a20 2020 2020 2020 2020  slice:.         
+00051950: 2020 206d 6173 6b5f 696e 7465 7273 6563     mask_intersec
+00051960: 7469 6f6e 203d 2072 6f69 735b 305d 2e63  tion = rois[0].c
+00051970: 6c6f 6e65 2829 2e67 6574 5f6d 6173 6b28  lone().get_mask(
+00051980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00051990: 2020 2020 2076 6965 772c 2066 6c61 7474       view, flatt
+000519a0: 656e 2c20 7374 616e 6461 7264 6973 653d  en, standardise=
+000519b0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+000519c0: 2020 6d61 736b 5f75 6e69 6f6e 203d 2072    mask_union = r
+000519d0: 6f69 735b 305d 2e63 6c6f 6e65 2829 2e67  ois[0].clone().g
+000519e0: 6574 5f6d 6173 6b28 0a20 2020 2020 2020  et_mask(.       
+000519f0: 2020 2020 2020 2020 2020 2020 2076 6965               vie
+00051a00: 772c 2066 6c61 7474 656e 2c20 7374 616e  w, flatten, stan
+00051a10: 6461 7264 6973 653d 5472 7565 290a 2020  dardise=True).  
+00051a20: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00051a30: 2020 2020 2020 2020 6d61 736b 5f69 6e74          mask_int
+00051a40: 6572 7365 6374 696f 6e20 3d20 726f 6973  ersection = rois
+00051a50: 5b30 5d2e 636c 6f6e 6528 292e 6765 745f  [0].clone().get_
+00051a60: 736c 6963 6528 0a20 2020 2020 2020 2020  slice(.         
+00051a70: 2020 2020 2020 2020 2020 2076 6965 772c             view,
+00051a80: 2073 6c2c 2069 6478 2c20 706f 7329 0a20   sl, idx, pos). 
+00051a90: 2020 2020 2020 2020 2020 206d 6173 6b5f             mask_
+00051aa0: 756e 696f 6e20 3d20 726f 6973 5b30 5d2e  union = rois[0].
+00051ab0: 636c 6f6e 6528 292e 6765 745f 736c 6963  clone().get_slic
+00051ac0: 6528 7669 6577 2c20 736c 2c20 6964 782c  e(view, sl, idx,
+00051ad0: 2070 6f73 290a 0a20 2020 2020 2020 2066   pos)..        f
+00051ae0: 6f72 2072 6f69 2069 6e20 726f 6973 5b31  or roi in rois[1
+00051af0: 3a5d 3a0a 2020 2020 2020 2020 2020 2020  :]:.            
+00051b00: 6966 206e 6f74 2073 696e 676c 655f 736c  if not single_sl
+00051b10: 6963 653a 0a20 2020 2020 2020 2020 2020  ice:.           
+00051b20: 2020 2020 206d 6173 6b20 3d20 726f 692e       mask = roi.
+00051b30: 6765 745f 6d61 736b 2876 6965 772c 2066  get_mask(view, f
+00051b40: 6c61 7474 656e 2c20 7374 616e 6461 7264  latten, standard
+00051b50: 6973 653d 5472 7565 290a 2020 2020 2020  ise=True).      
+00051b60: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00051b70: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+00051b80: 203d 2072 6f69 2e67 6574 5f73 6c69 6365   = roi.get_slice
+00051b90: 2876 6965 772c 2073 6c2c 2069 6478 2c20  (view, sl, idx, 
+00051ba0: 706f 7329 0a0a 2020 2020 2020 2020 2020  pos)..          
+00051bb0: 2020 6d61 736b 5f69 6e74 6572 7365 6374    mask_intersect
+00051bc0: 696f 6e20 3d20 286d 6173 6b5f 696e 7465  ion = (mask_inte
+00051bd0: 7273 6563 7469 6f6e 2026 206d 6173 6b29  rsection & mask)
+00051be0: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
+00051bf0: 6b5f 756e 696f 6e20 3d20 286d 6173 6b5f  k_union = (mask_
+00051c00: 756e 696f 6e20 7c20 6d61 736b 290a 0a20  union | mask).. 
+00051c10: 2020 2020 2020 2063 692e 636f 6d6d 6f6e         ci.common
+00051c20: 203d 206d 6173 6b5f 696e 7465 7273 6563   = mask_intersec
+00051c30: 7469 6f6e 2e73 756d 2829 202f 206d 6173  tion.sum() / mas
+00051c40: 6b5f 756e 696f 6e2e 7375 6d28 290a 0a20  k_union.sum().. 
+00051c50: 2020 2072 6574 7572 6e20 6765 7461 7474     return getatt
+00051c60: 7228 6369 2c20 6369 5f74 7970 652c 2063  r(ci, ci_type, c
+00051c70: 6929 0a0a 6465 6620 6765 745f 726f 695f  i)..def get_roi_
+00051c80: 736c 6963 6528 726f 692c 207a 5f66 7261  slice(roi, z_fra
+00051c90: 6374 696f 6e3d 312c 2073 7566 6669 783d  ction=1, suffix=
+00051ca0: 4e6f 6e65 293a 0a20 2020 2022 2222 0a20  None):.    """. 
+00051cb0: 2020 2047 6574 2052 4f49 206f 626a 6563     Get ROI objec
+00051cc0: 7420 636f 7272 6573 706f 6e64 696e 6720  t corresponding 
+00051cd0: 746f 2078 2d79 2073 6c69 6365 2074 6872  to x-y slice thr
+00051ce0: 6f75 6768 2069 6e70 7574 2052 4f49 2e0a  ough input ROI..
+00051cf0: 0a20 2020 202a 2a50 6172 616d 6574 6572  .    **Parameter
+00051d00: 733a 2a2a 0a0a 2020 2020 726f 6920 3a20  s:**..    roi : 
+00051d10: 736b 7274 2e73 7472 7563 7475 7265 732e  skrt.structures.
+00051d20: 524f 490a 2020 2020 2020 2020 524f 4920  ROI.        ROI 
+00051d30: 6f62 6a65 6374 2066 6f72 2077 6869 6368  object for which
+00051d40: 2073 6c69 6365 2069 7320 746f 2062 6520   slice is to be 
+00051d50: 6f62 7461 696e 6564 2e0a 0a20 2020 207a  obtained...    z
+00051d60: 5f66 7261 6374 696f 6e20 3a20 666c 6f61  _fraction : floa
+00051d70: 742c 2064 6566 6175 6c74 3d31 0a20 2020  t, default=1.   
+00051d80: 2020 2020 2050 6f73 6974 696f 6e20 616c       Position al
+00051d90: 6f6e 6720 7a20 6178 6973 2061 7420 7768  ong z axis at wh
+00051da0: 6963 6820 746f 2074 616b 6520 736c 6963  ich to take slic
+00051db0: 6520 7468 726f 7567 6820 524f 492e 0a20  e through ROI.. 
+00051dc0: 2020 2020 2020 2054 6865 2070 6f73 6974         The posit
+00051dd0: 696f 6e20 6973 2073 7065 6369 6669 6564  ion is specified
+00051de0: 2061 7320 7468 6520 6672 6163 7469 6f6e   as the fraction
+00051df0: 616c 2064 6973 7461 6e63 650a 2020 2020  al distance.    
+00051e00: 2020 2020 6672 6f6d 2074 6865 2052 4f49      from the ROI
+00051e10: 2773 206d 6f73 742d 696e 6665 7269 6f72  's most-inferior
+00051e20: 2070 6f69 6e74 3a20 3020 636f 7272 6573   point: 0 corres
+00051e30: 706f 6e64 7320 746f 0a20 2020 2020 2020  ponds to.       
+00051e40: 2074 6865 206d 6f73 742d 696e 6665 7269   the most-inferi
+00051e50: 6f72 2070 6f69 6e74 2028 6c6f 7765 7374  or point (lowest
+00051e60: 207a 293b 2031 2063 6f72 7265 7370 6f6e   z); 1 correspon
+00051e70: 6473 2074 6f20 7468 650a 2020 2020 2020  ds to the.      
+00051e80: 2020 6d6f 7374 2d73 7570 6572 696f 7220    most-superior 
+00051e90: 706f 696e 7420 2868 6967 6865 7374 207a  point (highest z
+00051ea0: 292e 2020 5661 6c75 6573 2066 6f72 207a  ).  Values for z
+00051eb0: 5f66 7261 6374 696f 6e0a 2020 2020 2020  _fraction.      
+00051ec0: 2020 6f75 7473 6964 6520 7468 6520 696e    outside the in
+00051ed0: 7465 7276 616c 205b 302c 2031 5d20 7265  terval [0, 1] re
+00051ee0: 7375 6c74 2069 6e20 6120 5275 6e74 696d  sult in a Runtim
+00051ef0: 6545 7272 6f72 2e0a 0a20 2020 2073 7566  eError...    suf
+00051f00: 6669 7820 3a20 7374 722c 2064 6566 6175  fix : str, defau
+00051f10: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00051f20: 5375 6666 6978 2074 6f20 6170 7065 6e64  Suffix to append
+00051f30: 2074 6f20 6e61 6d65 206f 6620 696e 7075   to name of inpu
+00051f40: 7420 524f 492c 2074 6f20 666f 726d 206e  t ROI, to form n
+00051f50: 616d 650a 2020 2020 2020 2020 6f66 206f  ame.        of o
+00051f60: 7574 7075 7420 524f 492e 2020 4966 204e  utput ROI.  If N
+00051f70: 6f6e 652c 2061 7070 656e 6420 7a5f 6672  one, append z_fr
+00051f80: 6163 7469 6f6e 2c20 7769 7468 2076 616c  action, with val
+00051f90: 7565 0a20 2020 2020 2020 2067 6976 656e  ue.        given
+00051fa0: 2074 6f20 7477 6f20 6465 6369 6d61 6c20   to two decimal 
+00051fb0: 706c 6163 6573 2e0a 2020 2020 2222 220a  places..    """.
+00051fc0: 2020 2020 2320 4368 6563 6b20 7468 6174      # Check that
+00051fd0: 207a 5f66 7261 6374 696f 6e20 6973 2069   z_fraction is i
+00051fe0: 6e20 616c 6c6f 7765 6420 696e 7465 7276  n allowed interv
+00051ff0: 616c 2e0a 2020 2020 6966 207a 5f66 7261  al..    if z_fra
+00052000: 6374 696f 6e20 3c20 3020 6f72 207a 5f66  ction < 0 or z_f
+00052010: 7261 6374 696f 6e20 3e20 313a 0a20 2020  raction > 1:.   
+00052020: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
+00052030: 6d65 4572 726f 7228 6622 7a5f 6672 6163  meError(f"z_frac
+00052040: 7469 6f6e 3d7b 7a5f 6672 6163 7469 6f6e  tion={z_fraction
+00052050: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+00052060: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00052070: 206f 7574 7369 6465 2061 6c6c 6f77 6564   outside allowed
+00052080: 2069 6e74 6572 7661 6c20 5b30 2c20 315d   interval [0, 1]
+00052090: 2229 0a0a 2020 2020 2320 4465 7465 726d  ")..    # Determ
+000520a0: 696e 6520 7468 6520 696e 6465 7820 6f66  ine the index of
+000520b0: 2074 6865 2069 6d61 6765 2073 6c69 6365   the image slice
+000520c0: 2061 7420 7768 6963 6820 746f 2074 616b   at which to tak
+000520d0: 6520 524f 4920 736c 6963 652e 0a20 2020  e ROI slice..   
+000520e0: 2070 6f73 312c 2070 6f73 3220 3d20 726f   pos1, pos2 = ro
+000520f0: 692e 6765 745f 6578 7465 6e74 2829 0a20  i.get_extent(). 
+00052100: 2020 2070 6f73 203d 2070 6f73 3120 2b20     pos = pos1 + 
+00052110: 7a5f 6672 6163 7469 6f6e 202a 2028 706f  z_fraction * (po
+00052120: 7332 202d 2070 6f73 3129 0a20 2020 2069  s2 - pos1).    i
+00052130: 6478 203d 2072 6f69 2e70 6f73 5f74 6f5f  dx = roi.pos_to_
+00052140: 6964 7828 706f 732c 2022 7a22 290a 0a20  idx(pos, "z").. 
+00052150: 2020 2023 204f 6274 6169 6e20 636f 6e74     # Obtain cont
+00052160: 6f75 7273 2066 6f72 2072 6571 7569 7265  ours for require
+00052170: 6420 736c 6963 652c 2061 6e64 2063 6f6e  d slice, and con
+00052180: 7665 7274 2074 6f20 524f 4920 6f62 6a65  vert to ROI obje
+00052190: 6374 2e0a 2020 2020 636f 6e74 6f75 7273  ct..    contours
+000521a0: 203d 2072 6f69 2e67 6574 5f63 6f6e 746f   = roi.get_conto
+000521b0: 7572 7328 6964 785f 6173 5f6b 6579 3d54  urs(idx_as_key=T
+000521c0: 7275 6529 5b69 6478 5d0a 2020 2020 726f  rue)[idx].    ro
+000521d0: 695f 736c 6963 6520 3d20 524f 4928 7b72  i_slice = ROI({r
+000521e0: 6f69 2e69 6478 5f74 6f5f 706f 7328 6964  oi.idx_to_pos(id
+000521f0: 782c 2022 7a22 293a 2063 6f6e 746f 7572  x, "z"): contour
+00052200: 737d 290a 0a20 2020 2073 7566 6669 7820  s})..    suffix 
+00052210: 3d20 6622 7b7a 5f66 7261 6374 696f 6e3a  = f"{z_fraction:
+00052220: 2e32 667d 2220 6966 2073 7566 6669 7820  .2f}" if suffix 
+00052230: 6973 204e 6f6e 6520 656c 7365 2073 7566  is None else suf
+00052240: 6669 780a 2020 2020 6966 2073 7566 6669  fix.    if suffi
+00052250: 783a 0a20 2020 2020 2020 2072 6f69 5f73  x:.        roi_s
+00052260: 6c69 6365 2e6e 616d 6520 3d20 6622 7b72  lice.name = f"{r
+00052270: 6f69 2e6e 616d 657d 5f7b 7375 6666 6978  oi.name}_{suffix
+00052280: 7d22 0a20 2020 2065 6c73 653a 0a20 2020  }".    else:.   
+00052290: 2020 2020 2072 6f69 5f73 6c69 6365 2e6e       roi_slice.n
+000522a0: 616d 6520 3d20 7374 7228 726f 692e 6e61  ame = str(roi.na
+000522b0: 6d65 290a 0a20 2020 2072 6574 7572 6e20  me)..    return 
+000522c0: 726f 695f 736c 6963 650a 0a64 6566 2067  roi_slice..def g
+000522d0: 6574 5f6d 6574 7269 635f 6d65 7468 6f64  et_metric_method
+000522e0: 286d 6574 7269 6329 3a0a 2020 2020 2222  (metric):.    ""
+000522f0: 220a 2020 2020 4d61 7020 6265 7477 6565  ".    Map betwee
+00052300: 6e20 6d65 7472 6963 2069 6465 6e74 6966  n metric identif
+00052310: 6965 7220 6173 206c 6973 7465 6420 696e  ier as listed in
+00052320: 2067 6574 5f63 6f6d 7061 7269 736f 6e5f   get_comparison_
+00052330: 6d65 7472 6963 7328 290a 2020 2020 616e  metrics().    an
+00052340: 6420 6e61 6d65 206f 6620 524f 4920 6d65  d name of ROI me
+00052350: 7468 6f64 2066 6f72 2063 616c 6375 6c61  thod for calcula
+00052360: 7469 6e67 2074 6865 206d 6574 7269 632e  ting the metric.
+00052370: 0a20 2020 200a 2020 2020 5468 6973 2066  .    .    This f
+00052380: 756e 6374 696f 6e20 6973 2075 7365 6420  unction is used 
+00052390: 696e 2052 4f49 2e67 6574 5f6d 6574 7269  in ROI.get_metri
+000523a0: 635f 6279 5f73 6c69 6365 2829 2074 6f20  c_by_slice() to 
+000523b0: 6465 7465 726d 696e 650a 2020 2020 7468  determine.    th
+000523c0: 6520 6d65 7468 6f64 2074 6f20 6265 2063  e method to be c
+000523d0: 616c 6c65 6420 666f 7220 6561 6368 206d  alled for each m
+000523e0: 6574 7269 632e 0a20 2020 2022 2222 0a20  etric..    """. 
+000523f0: 2020 2023 204b 6579 7320 6172 6520 6d65     # Keys are me
+00052400: 7472 6963 2069 6465 6e74 6966 6965 7273  tric identifiers
+00052410: 3b20 7661 6c75 6573 2061 7265 206e 616d  ; values are nam
+00052420: 6573 206f 6620 524f 4920 6d65 7468 6f64  es of ROI method
+00052430: 730a 2020 2020 2320 666f 7220 6d65 7472  s.    # for metr
+00052440: 6963 2063 616c 6375 6c61 7469 6f6e 2e0a  ic calculation..
+00052450: 2020 2020 2320 4d65 7472 6963 7320 6172      # Metrics ar
+00052460: 6520 696e 636c 7564 6564 2069 6e20 7468  e included in th
+00052470: 6520 6469 6374 696f 6e61 7279 206f 6e6c  e dictionary onl
+00052480: 7920 6966 2069 6465 6e74 6966 6965 7220  y if identifier 
+00052490: 616e 6420 6d65 7468 6f64 0a20 2020 2023  and method.    #
+000524a0: 206e 616d 6520 6172 6520 6469 6666 6572   name are differ
+000524b0: 656e 742e 0a20 2020 206d 6170 7069 6e67  ent..    mapping
+000524c0: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
+000524d0: 2020 2261 6273 5f63 656e 7472 6f69 6422    "abs_centroid"
+000524e0: 3a20 2261 6273 5f63 656e 7472 6f69 645f  : "abs_centroid_
+000524f0: 6469 7374 616e 6365 222c 0a20 2020 2020  distance",.     
+00052500: 2020 2020 2020 2022 6365 6e74 726f 6964         "centroid
+00052510: 223a 2022 6365 6e74 726f 6964 5f64 6973  ": "centroid_dis
+00052520: 7461 6e63 6522 2c0a 2020 2020 2020 2020  tance",.        
+00052530: 2020 2020 2272 656c 5f61 7265 615f 6469      "rel_area_di
+00052540: 6666 223a 2022 7265 6c61 7469 7665 5f61  ff": "relative_a
+00052550: 7265 615f 6469 6666 222c 0a20 2020 2020  rea_diff",.     
+00052560: 2020 2020 2020 207d 0a20 2020 2072 6574         }.    ret
+00052570: 7572 6e20 6d61 7070 696e 6773 2e67 6574  urn mappings.get
+00052580: 286d 6574 7269 632c 206d 6574 7269 6329  (metric, metric)
+00052590: 0a0a 6465 6620 6765 745f 636f 6d70 6172  ..def get_compar
+000525a0: 6973 6f6e 5f6d 6574 7269 6373 2863 656e  ison_metrics(cen
+000525b0: 7472 6f69 645f 636f 6d70 6f6e 656e 7473  troid_components
+000525c0: 3d46 616c 7365 2c20 736c 6963 655f 7374  =False, slice_st
+000525d0: 6174 733d 4e6f 6e65 2c0a 2020 2020 2020  ats=None,.      
+000525e0: 2020 6465 6661 756c 745f 6279 5f73 6c69    default_by_sli
+000525f0: 6365 3d4e 6f6e 652c 2076 6965 773d 2278  ce=None, view="x
+00052600: 2d79 2229 3a0a 2020 2020 2222 220a 2020  -y"):.    """.  
+00052610: 2020 4765 7420 6c69 7374 206f 6620 636f    Get list of co
+00052620: 6d70 6172 6973 6f6e 206d 6574 7269 6373  mparison metrics
+00052630: 2e0a 0a20 2020 2041 6c6c 206d 6574 7269  ...    All metri
+00052640: 6373 206c 6973 7465 6420 6865 7265 2073  cs listed here s
+00052650: 686f 756c 6420 6265 2072 6563 6f67 6e69  hould be recogni
+00052660: 7365 6420 6279 2052 4f49 2e67 6574 5f63  sed by ROI.get_c
+00052670: 6f6d 7061 7269 736f 6e28 292c 0a20 2020  omparison(),.   
+00052680: 2061 6e64 2061 6c6c 206d 6574 7269 6373   and all metrics
+00052690: 2072 6563 6f67 6e69 7365 6420 6279 2052   recognised by R
+000526a0: 4f49 2e67 6574 5f63 6f6d 7061 7269 736f  OI.get_compariso
+000526b0: 6e28 2920 7368 6f75 6c64 2062 6520 6c69  n() should be li
+000526c0: 7374 6564 2068 6572 652e 0a0a 2020 2020  sted here...    
+000526d0: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+000526e0: 0a20 2020 2063 656e 7472 6f69 645f 636f  .    centroid_co
+000526f0: 6d70 6f6e 656e 7473 203a 2062 6f6f 6c2c  mponents : bool,
+00052700: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
+00052710: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+00052720: 7265 706c 6163 6520 6d65 7472 6963 7320  replace metrics 
+00052730: 2263 656e 7472 6f69 6422 2061 6e64 2022  "centroid" and "
+00052740: 6365 6e74 726f 6964 5f73 6c69 6365 2220  centroid_slice" 
+00052750: 6279 2074 6865 0a20 2020 2020 2020 206d  by the.        m
+00052760: 6574 7269 6373 2066 6f72 2074 6865 6972  etrics for their
+00052770: 2063 6f6d 706f 6e65 6e74 732e 0a0a 2020   components...  
+00052780: 2020 736c 6963 655f 7374 6174 7320 3a20    slice_stats : 
+00052790: 7374 722f 6c69 7374 2f64 6963 742c 2064  str/list/dict, d
+000527a0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+000527b0: 2020 2020 5370 6563 6966 6963 6174 696f      Specificatio
+000527c0: 6e20 6f66 2073 7461 7469 7374 6963 7320  n of statistics 
+000527d0: 746f 2062 6520 6361 6c63 756c 6174 6564  to be calculated
+000527e0: 2072 656c 6174 6976 650a 2020 2020 2020   relative.      
+000527f0: 2020 746f 2073 6c69 6365 2d62 792d 736c    to slice-by-sl
+00052800: 6963 6520 6d65 7472 6963 2076 616c 7565  ice metric value
+00052810: 732e 0a0a 2020 2020 2020 2020 4120 7374  s...        A st
+00052820: 6174 6973 7469 6320 6973 2073 7065 6369  atistic is speci
+00052830: 6669 6564 2062 7920 7468 6520 6e61 6d65  fied by the name
+00052840: 206f 6620 7468 6520 6675 6e63 7469 6f6e   of the function
+00052850: 2066 6f72 0a20 2020 2020 2020 2069 7473   for.        its
+00052860: 2063 616c 6375 6c61 7469 6f6e 2069 6e20   calculation in 
+00052870: 7468 6520 5079 7468 6f6e 2073 7461 7469  the Python stati
+00052880: 7374 6963 7320 6d6f 6475 6c65 3a0a 0a20  stics module:.. 
+00052890: 2020 2020 2020 2068 7474 7073 3a2f 2f64         https://d
+000528a0: 6f63 732e 7079 7468 6f6e 2e6f 7267 2f33  ocs.python.org/3
+000528b0: 2f6c 6962 7261 7279 2f73 7461 7469 7374  /library/statist
+000528c0: 6963 732e 6874 6d6c 0a0a 2020 2020 2020  ics.html..      
+000528d0: 2020 466f 7220 6974 7320 7573 6520 6865    For its use he
+000528e0: 7265 2c20 7468 6520 7265 6c65 7661 6e74  re, the relevant
+000528f0: 2066 756e 6374 696f 6e20 6d75 7374 2072   function must r
+00052900: 6571 7569 7265 0a20 2020 2020 2020 2061  equire.        a
+00052910: 2073 696e 676c 652d 7661 7269 6162 6c65   single-variable
+00052920: 2069 6e70 7574 2c20 6d75 7374 206e 6f74   input, must not
+00052930: 2072 6571 7569 7265 2061 6e79 206b 6579   require any key
+00052940: 776f 7264 0a20 2020 2020 2020 2061 7267  word.        arg
+00052950: 756d 656e 7473 2c20 616e 6420 6d75 7374  uments, and must
+00052960: 2072 6574 7572 6e20 6120 7369 6e67 6c65   return a single
+00052970: 206e 756d 6265 722e 0a0a 2020 2020 2020   number...      
+00052980: 2020 4176 6169 6c61 626c 6520 6f70 7469    Available opti
+00052990: 6f6e 7320 696e 636c 7564 653a 2022 6d65  ons include: "me
+000529a0: 616e 222c 2022 6d65 6469 616e 222c 2022  an", "median", "
+000529b0: 6d6f 6465 222c 0a20 2020 2020 2020 2022  mode",.        "
+000529c0: 7374 6465 7622 2e0a 0a20 2020 2020 2020  stdev"...       
+000529d0: 5374 6174 6973 7469 6373 2074 6f20 6265  Statistics to be
+000529e0: 2063 616c 6375 6c61 7465 6420 6361 6e20   calculated can 
+000529f0: 6265 2073 7065 6369 6669 6564 2075 7369  be specified usi
+00052a00: 6e67 2061 6e79 206f 660a 2020 2020 2020  ng any of.      
+00052a10: 2074 6865 2066 6f6c 6c6f 7769 6e67 3a0a   the following:.
+00052a20: 0a20 2020 2020 2020 2d20 5374 7269 6e67  .       - String
+00052a30: 2073 7065 6369 6679 696e 6720 7369 6e67   specifying sing
+00052a40: 6c65 2073 7461 7469 7374 6963 2074 6f20  le statistic to 
+00052a50: 6265 2063 616c 6375 6c61 7465 642c 0a20  be calculated,. 
+00052a60: 2020 2020 2020 2020 7769 7468 2073 6c69          with sli
+00052a70: 6365 7320 636f 6e73 6964 6572 6564 2061  ces considered a
+00052a80: 7320 6769 7665 6e20 6279 203c 6465 6661  s given by <defa
+00052a90: 756c 745f 6279 5f73 6c69 6365 3e2c 0a20  ult_by_slice>,. 
+00052aa0: 2020 2020 2020 2020 666f 7220 6578 616d          for exam
+00052ab0: 706c 653a 2022 6d65 616e 223b 0a20 2020  ple: "mean";.   
+00052ac0: 2020 2020 2d20 4c69 7374 2073 7065 6369      - List speci
+00052ad0: 6679 696e 6720 6d75 6c74 6970 6c65 2073  fying multiple s
+00052ae0: 7461 7469 7374 6963 7320 746f 2062 6520  tatistics to be 
+00052af0: 6361 6c63 756c 6174 6564 2c0a 2020 2020  calculated,.    
+00052b00: 2020 2020 2077 6974 6820 736c 6963 6573       with slices
+00052b10: 2063 6f6e 7369 6465 7265 6420 6173 2067   considered as g
+00052b20: 6976 656e 2062 7920 3c64 6566 6175 6c74  iven by <default
+00052b30: 5f62 795f 736c 6963 653e 2c0a 2020 2020  _by_slice>,.    
+00052b40: 2020 2020 2066 6f72 2065 7861 6d70 6c65       for example
+00052b50: 3a20 5b22 6d65 616e 222c 2022 7374 6465  : ["mean", "stde
+00052b60: 7622 5d3b 0a20 2020 2020 2020 2d20 4469  v"];.       - Di
+00052b70: 6374 696f 6e61 7279 2077 6865 7265 206b  ctionary where k
+00052b80: 6579 7320 7370 6563 6966 7920 736c 6963  eys specify slic
+00052b90: 6573 2074 6f20 6265 2063 6f6e 7369 6465  es to be conside
+00052ba0: 7265 642c 0a20 2020 2020 2020 2020 616e  red,.         an
+00052bb0: 6420 7661 6c75 6573 2073 7065 6369 6679  d values specify
+00052bc0: 2073 7461 7469 7374 6963 7320 2873 7472   statistics (str
+00052bd0: 696e 6720 6f72 206c 6973 7429 2c20 666f  ing or list), fo
+00052be0: 720a 2020 2020 2020 2020 2065 7861 6d70  r.         examp
+00052bf0: 6c65 3a20 7b22 756e 696f 6e22 3a20 5b22  le: {"union": ["
+00052c00: 6d65 616e 222c 2022 7374 6465 7622 5d7d  mean", "stdev"]}
+00052c10: 2e20 2056 616c 6964 2073 6c69 6365 0a20  .  Valid slice. 
+00052c20: 2020 2020 2020 2020 7370 6563 6966 6963          specific
+00052c30: 6174 696f 6e73 2061 7265 2061 7320 6c69  ations are as li
+00052c40: 7374 6564 2066 6f72 203c 6465 6661 756c  sted for <defaul
+00052c50: 745f 6279 5f73 6c69 6365 3e2e 0a0a 2020  t_by_slice>...  
+00052c60: 2020 6465 6661 756c 745f 6279 5f73 6c69    default_by_sli
+00052c70: 6365 3a20 7374 722c 2064 6566 6175 6c74  ce: str, default
+00052c80: 3d4e 6f6e 650a 2020 2020 2020 2020 4465  =None.        De
+00052c90: 6661 756c 7420 7370 6563 6966 6963 6174  fault specificat
+00052ca0: 696f 6e20 6f66 2073 6c69 6365 7320 746f  ion of slices to
+00052cb0: 2062 6520 636f 6e73 6964 6572 6564 2077   be considered w
+00052cc0: 6865 6e0a 2020 2020 2020 2020 6361 6c63  hen.        calc
+00052cd0: 756c 6174 696e 6720 736c 6963 652d 6279  ulating slice-by
+00052ce0: 2d73 6c69 6365 2073 7461 7469 7374 6963  -slice statistic
+00052cf0: 7320 666f 7220 6120 6d65 7472 6963 2063  s for a metric c
+00052d00: 6f6d 7061 7269 6e67 0a20 2020 2020 2020  omparing.       
+00052d10: 2074 776f 2052 4f49 732c 2072 6f69 3120   two ROIs, roi1 
+00052d20: 616e 6420 726f 6932 2e20 2054 6865 2076  and roi2.  The v
+00052d30: 616c 6964 2073 7065 6369 6669 6361 7469  alid specificati
+00052d40: 6f6e 7320 6172 653a 0a0a 2020 2020 2020  ons are:..      
+00052d50: 2020 2d20 226c 6566 7422 3a20 636f 6e73    - "left": cons
+00052d60: 6964 6572 206f 6e6c 7920 736c 6963 6573  ider only slices
+00052d70: 2063 6f6e 7461 696e 696e 6720 726f 6931   containing roi1
+00052d80: 3b0a 2020 2020 2020 2020 2d20 2272 6967  ;.        - "rig
+00052d90: 6874 223a 2063 6f6e 7369 6465 7220 6f6e  ht": consider on
+00052da0: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
+00052db0: 6e69 6e67 2072 6f69 323b 0a20 2020 2020  ning roi2;.     
+00052dc0: 2020 202d 2022 756e 696f 6e22 3a20 636f     - "union": co
+00052dd0: 6e73 6964 6572 2073 6c69 6365 7320 636f  nsider slices co
+00052de0: 6e74 6169 6e69 6e67 2065 6974 6865 7220  ntaining either 
+00052df0: 6f66 2072 6f69 3120 616e 6420 726f 6932  of roi1 and roi2
+00052e00: 3b0a 2020 2020 2020 2020 2d20 2269 6e74  ;.        - "int
+00052e10: 6572 7365 6374 696f 6e22 3a20 636f 6e73  ersection": cons
+00052e20: 6964 6572 2073 6c69 6365 7320 636f 6e74  ider slices cont
+00052e30: 6169 6e69 6e67 2062 6f74 6820 726f 6931  aining both roi1
+00052e40: 2061 6e64 2072 6f69 322e 0a0a 2020 2020   and roi2...    
+00052e50: 2020 2020 4966 204e 6f6e 652c 2075 7365      If None, use
+00052e60: 2073 6b72 742e 636f 7265 2e44 6566 6175   skrt.core.Defau
+00052e70: 6c74 7328 292e 6279 5f73 6c69 6365 0a0a  lts().by_slice..
+00052e80: 2020 2020 2020 2020 7669 6577 203a 2073          view : s
+00052e90: 7472 2c20 6465 6661 756c 743d 2278 2d79  tr, default="x-y
+00052ea0: 220a 2020 2020 2020 2020 2020 2020 4f72  ".            Or
+00052eb0: 6965 6e74 6174 696f 6e20 746f 2063 6f6e  ientation to con
+00052ec0: 7369 6465 7220 7768 656e 2074 616b 696e  sider when takin
+00052ed0: 6720 6365 6e74 726f 6964 2063 6f6d 706f  g centroid compo
+00052ee0: 6e65 6e74 7320 7265 6c61 7469 7665 0a20  nents relative. 
+00052ef0: 2020 2020 2020 2020 2020 2074 6f20 6120             to a 
+00052f00: 736c 6963 652e 2020 4361 6e20 6265 2022  slice.  Can be "
+00052f10: 782d 7922 2c20 2279 2d7a 222c 206f 7220  x-y", "y-z", or 
+00052f20: 2278 2d7a 222e 0a20 2020 2022 2222 0a20  "x-z"..    """. 
+00052f30: 2020 206d 6574 7269 6373 203d 205b 0a20     metrics = [. 
+00052f40: 2020 2020 2020 2020 2020 2022 6162 735f             "abs_
+00052f50: 6365 6e74 726f 6964 222c 0a20 2020 2020  centroid",.     
+00052f60: 2020 2020 2020 2022 6162 735f 6365 6e74         "abs_cent
+00052f70: 726f 6964 5f66 6c61 7422 2c0a 2020 2020  roid_flat",.    
+00052f80: 2020 2020 2020 2020 2261 6273 5f63 656e          "abs_cen
+00052f90: 7472 6f69 645f 736c 6963 6522 2c0a 2020  troid_slice",.  
+00052fa0: 2020 2020 2020 2020 2020 2261 6273 5f63            "abs_c
+00052fb0: 656e 7472 6f69 645f 736c 6963 655f 7374  entroid_slice_st
+00052fc0: 6174 7322 2c0a 2020 2020 2020 2020 2020  ats",.          
+00052fd0: 2020 2261 7265 615f 6469 6666 222c 0a20    "area_diff",. 
+00052fe0: 2020 2020 2020 2020 2020 2022 6172 6561             "area
+00052ff0: 5f64 6966 665f 666c 6174 222c 0a20 2020  _diff_flat",.   
+00053000: 2020 2020 2020 2020 2022 6172 6561 5f64           "area_d
+00053010: 6966 665f 736c 6963 655f 7374 6174 7322  iff_slice_stats"
+00053020: 2c0a 2020 2020 2020 2020 2020 2020 2261  ,.            "a
+00053030: 7265 615f 7261 7469 6f22 2c0a 2020 2020  rea_ratio",.    
+00053040: 2020 2020 2020 2020 2261 7265 615f 7261          "area_ra
+00053050: 7469 6f5f 666c 6174 222c 0a20 2020 2020  tio_flat",.     
+00053060: 2020 2020 2020 2022 6172 6561 5f72 6174         "area_rat
+00053070: 696f 5f73 6c69 6365 5f73 7461 7473 222c  io_slice_stats",
+00053080: 0a20 2020 2020 2020 2020 2020 2022 6365  .            "ce
+00053090: 6e74 726f 6964 222c 0a20 2020 2020 2020  ntroid",.       
+000530a0: 2020 2020 2022 6365 6e74 726f 6964 5f73       "centroid_s
+000530b0: 6c69 6365 222c 0a20 2020 2020 2020 2020  lice",.         
+000530c0: 2020 2022 6365 6e74 726f 6964 5f73 6c69     "centroid_sli
+000530d0: 6365 5f73 7461 7473 222c 0a20 2020 2020  ce_stats",.     
+000530e0: 2020 2020 2020 2022 6469 6365 222c 0a20         "dice",. 
+000530f0: 2020 2020 2020 2020 2020 2022 6469 6365             "dice
+00053100: 5f66 6c61 7422 2c0a 2020 2020 2020 2020  _flat",.        
+00053110: 2020 2020 2264 6963 655f 736c 6963 6522      "dice_slice"
+00053120: 2c0a 2020 2020 2020 2020 2020 2020 2264  ,.            "d
+00053130: 6963 655f 736c 6963 655f 7374 6174 7322  ice_slice_stats"
+00053140: 2c0a 2020 2020 2020 2020 2020 2020 2268  ,.            "h
+00053150: 6175 7364 6f72 6666 5f64 6973 7461 6e63  ausdorff_distanc
+00053160: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
+00053170: 2268 6175 7364 6f72 6666 5f64 6973 7461  "hausdorff_dista
+00053180: 6e63 655f 666c 6174 222c 0a20 2020 2020  nce_flat",.     
+00053190: 2020 2020 2020 2022 6a61 6363 6172 6422         "jaccard"
+000531a0: 2c0a 2020 2020 2020 2020 2020 2020 226a  ,.            "j
+000531b0: 6163 6361 7264 5f66 6c61 7422 2c0a 2020  accard_flat",.  
+000531c0: 2020 2020 2020 2020 2020 226a 6163 6361            "jacca
+000531d0: 7264 5f73 6c69 6365 222c 0a20 2020 2020  rd_slice",.     
+000531e0: 2020 2020 2020 2022 6a61 6363 6172 645f         "jaccard_
+000531f0: 736c 6963 655f 7374 6174 7322 2c0a 2020  slice_stats",.  
+00053200: 2020 2020 2020 2020 2020 226d 6561 6e5f            "mean_
+00053210: 6469 7374 616e 6365 5f74 6f5f 636f 6e66  distance_to_conf
+00053220: 6f72 6d69 7479 222c 0a20 2020 2020 2020  ormity",.       
+00053230: 2020 2020 2022 6d65 616e 5f64 6973 7461       "mean_dista
+00053240: 6e63 655f 746f 5f63 6f6e 666f 726d 6974  nce_to_conformit
+00053250: 795f 666c 6174 222c 0a20 2020 2020 2020  y_flat",.       
+00053260: 2020 2020 2022 6d65 616e 5f73 6967 6e65       "mean_signe
+00053270: 645f 7375 7266 6163 655f 6469 7374 616e  d_surface_distan
+00053280: 6365 222c 0a20 2020 2020 2020 2020 2020  ce",.           
+00053290: 2022 6d65 616e 5f73 6967 6e65 645f 7375   "mean_signed_su
+000532a0: 7266 6163 655f 6469 7374 616e 6365 5f66  rface_distance_f
+000532b0: 6c61 7422 2c0a 2020 2020 2020 2020 2020  lat",.          
+000532c0: 2020 226d 6561 6e5f 7375 7266 6163 655f    "mean_surface_
+000532d0: 6469 7374 616e 6365 222c 0a20 2020 2020  distance",.     
+000532e0: 2020 2020 2020 2022 6d65 616e 5f73 7572         "mean_sur
+000532f0: 6661 6365 5f64 6973 7461 6e63 655f 666c  face_distance_fl
+00053300: 6174 222c 0a20 2020 2020 2020 2020 2020  at",.           
+00053310: 2022 6d65 616e 5f6f 7665 725f 636f 6e74   "mean_over_cont
+00053320: 6f75 7269 6e67 222c 0a20 2020 2020 2020  ouring",.       
+00053330: 2020 2020 2022 6d65 616e 5f6f 7665 725f       "mean_over_
+00053340: 636f 6e74 6f75 7269 6e67 5f66 6c61 7422  contouring_flat"
+00053350: 2c0a 2020 2020 2020 2020 2020 2020 226d  ,.            "m
+00053360: 6561 6e5f 756e 6465 725f 636f 6e74 6f75  ean_under_contou
+00053370: 7269 6e67 222c 0a20 2020 2020 2020 2020  ring",.         
+00053380: 2020 2022 6d65 616e 5f75 6e64 6572 5f63     "mean_under_c
+00053390: 6f6e 746f 7572 696e 675f 666c 6174 222c  ontouring_flat",
+000533a0: 0a20 2020 2020 2020 2020 2020 2022 7265  .            "re
+000533b0: 6c5f 6172 6561 5f64 6966 6622 2c0a 2020  l_area_diff",.  
+000533c0: 2020 2020 2020 2020 2020 2272 656c 5f61            "rel_a
+000533d0: 7265 615f 6469 6666 5f66 6c61 7422 2c0a  rea_diff_flat",.
+000533e0: 2020 2020 2020 2020 2020 2020 2272 656c              "rel
+000533f0: 5f61 7265 615f 6469 6666 5f73 6c69 6365  _area_diff_slice
+00053400: 5f73 7461 7473 222c 0a20 2020 2020 2020  _stats",.       
+00053410: 2020 2020 2022 7265 6c5f 766f 6c75 6d65       "rel_volume
+00053420: 5f64 6966 6622 2c0a 2020 2020 2020 2020  _diff",.        
+00053430: 2020 2020 2272 6d73 5f73 6967 6e65 645f      "rms_signed_
+00053440: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
+00053450: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+00053460: 726d 735f 7369 676e 6564 5f73 7572 6661  rms_signed_surfa
+00053470: 6365 5f64 6973 7461 6e63 655f 666c 6174  ce_distance_flat
+00053480: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+00053490: 726d 735f 7375 7266 6163 655f 6469 7374  rms_surface_dist
+000534a0: 616e 6365 222c 0a20 2020 2020 2020 2020  ance",.         
+000534b0: 2020 2022 726d 735f 7375 7266 6163 655f     "rms_surface_
+000534c0: 6469 7374 616e 6365 5f66 6c61 7422 2c0a  distance_flat",.
+000534d0: 2020 2020 2020 2020 2020 2020 2276 6f6c              "vol
+000534e0: 756d 655f 6469 6666 222c 0a20 2020 2020  ume_diff",.     
+000534f0: 2020 2020 2020 2022 766f 6c75 6d65 5f72         "volume_r
+00053500: 6174 696f 222c 0a20 2020 2020 2020 2020  atio",.         
+00053510: 2020 205d 0a0a 2020 2020 2320 5265 706c     ]..    # Repl
+00053520: 6163 6520 6365 6e74 726f 6964 2076 6563  ace centroid vec
+00053530: 746f 7273 2062 7920 636f 6d70 6f6e 656e  tors by componen
+00053540: 7473 2e0a 2020 2020 6966 2063 656e 7472  ts..    if centr
+00053550: 6f69 645f 636f 6d70 6f6e 656e 7473 3a0a  oid_components:.
+00053560: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+00053570: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
+00053580: 2020 2020 2020 2263 656e 7472 6f69 6422        "centroid"
+00053590: 3a20 5b22 6365 6e74 726f 6964 5f78 222c  : ["centroid_x",
+000535a0: 2022 6365 6e74 726f 6964 5f79 222c 2022   "centroid_y", "
+000535b0: 6365 6e74 726f 6964 5f7a 225d 2c0a 2020  centroid_z"],.  
+000535c0: 2020 2020 2020 2020 2020 2020 2020 2263                "c
+000535d0: 656e 7472 6f69 645f 736c 6963 6522 3a20  entroid_slice": 
+000535e0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
+000535f0: 2020 207d 0a20 2020 2020 2020 2069 6620     }.        if 
+00053600: 736c 6963 655f 7374 6174 7320 6973 206e  slice_stats is n
+00053610: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00053620: 2020 2020 2063 656e 7472 6f69 6473 5b22       centroids["
+00053630: 6365 6e74 726f 6964 5f73 6c69 6365 5f73  centroid_slice_s
+00053640: 7461 7473 225d 203d 205b 5d0a 0a20 2020  tats"] = []..   
+00053650: 2020 2020 2066 6f72 2069 5f61 7820 696e       for i_ax in
+00053660: 2073 6b72 742e 696d 6167 652e 5f70 6c6f   skrt.image._plo
+00053670: 745f 6178 6573 5b76 6965 775d 3a0a 2020  t_axes[view]:.  
+00053680: 2020 2020 2020 2020 2020 6178 203d 2073            ax = s
+00053690: 6b72 742e 696d 6167 652e 5f61 7865 735b  krt.image._axes[
+000536a0: 695f 6178 5d0a 2020 2020 2020 2020 2020  i_ax].          
+000536b0: 2020 6365 6e74 726f 6964 735b 2263 656e    centroids["cen
+000536c0: 7472 6f69 645f 736c 6963 6522 5d2e 6170  troid_slice"].ap
+000536d0: 7065 6e64 2866 2263 656e 7472 6f69 645f  pend(f"centroid_
+000536e0: 736c 6963 655f 7b61 787d 2229 0a0a 2020  slice_{ax}")..  
+000536f0: 2020 2020 2020 2020 2020 6966 2073 6c69            if sli
+00053700: 6365 5f73 7461 7473 2069 7320 6e6f 7420  ce_stats is not 
+00053710: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00053720: 2020 2020 2020 6365 6e74 726f 6964 735b        centroids[
+00053730: 2263 656e 7472 6f69 645f 736c 6963 655f  "centroid_slice_
+00053740: 7374 6174 7322 5d2e 6170 7065 6e64 280a  stats"].append(.
+00053750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053760: 2020 2020 2020 2020 6622 6365 6e74 726f          f"centro
+00053770: 6964 5f7b 6178 7d5f 736c 6963 655f 7374  id_{ax}_slice_st
+00053780: 6174 7322 290a 0a20 2020 2020 2020 2066  ats")..        f
+00053790: 6f72 2076 6563 746f 722c 2063 6f6d 706f  or vector, compo
+000537a0: 6e65 6e74 7320 696e 2063 656e 7472 6f69  nents in centroi
+000537b0: 6473 2e69 7465 6d73 2829 3a0a 2020 2020  ds.items():.    
+000537c0: 2020 2020 2020 2020 6964 7820 3d20 6d65          idx = me
+000537d0: 7472 6963 732e 696e 6465 7828 7665 6374  trics.index(vect
+000537e0: 6f72 290a 2020 2020 2020 2020 2020 2020  or).            
+000537f0: 6d65 7472 6963 735b 6964 7820 3a20 6964  metrics[idx : id
+00053800: 7820 2b20 315d 203d 2063 6f6d 706f 6e65  x + 1] = compone
+00053810: 6e74 730a 0a20 2020 2023 2052 656d 6f76  nts..    # Remov
+00053820: 6520 6d65 7472 6963 7320 7769 7468 2073  e metrics with s
+00053830: 7566 6669 7820 2273 6c69 6365 5f73 7461  uffix "slice_sta
+00053840: 7473 222c 0a20 2020 2023 2061 6e64 2072  ts",.    # and r
+00053850: 6570 6c61 6365 2077 6974 6820 7370 6563  eplace with spec
+00053860: 6966 6963 206d 6574 7269 6373 2072 656c  ific metrics rel
+00053870: 6174 696e 6720 746f 2073 6c69 6365 2d62  ating to slice-b
+00053880: 792d 736c 6963 6520 7374 6174 6973 7469  y-slice statisti
+00053890: 6373 2e0a 2020 2020 6966 2073 6c69 6365  cs..    if slice
+000538a0: 5f73 7461 7473 2069 7320 6e6f 7420 4e6f  _stats is not No
+000538b0: 6e65 3a0a 2020 2020 2020 2020 736c 6963  ne:.        slic
+000538c0: 655f 7374 6174 735f 6d65 7472 6963 7320  e_stats_metrics 
+000538d0: 3d20 5b5d 0a20 2020 2020 2020 206d 6574  = [].        met
+000538e0: 7269 6373 3220 3d20 5b5d 0a20 2020 2020  rics2 = [].     
+000538f0: 2020 2066 6f72 206d 6574 7269 6320 696e     for metric in
+00053900: 206d 6574 7269 6373 3a0a 2020 2020 2020   metrics:.      
+00053910: 2020 2020 2020 6966 2022 736c 6963 655f        if "slice_
+00053920: 7374 6174 7322 2069 6e20 6d65 7472 6963  stats" in metric
+00053930: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00053940: 2020 736c 6963 655f 7374 6174 735f 6d65    slice_stats_me
+00053950: 7472 6963 732e 6170 7065 6e64 286d 6574  trics.append(met
+00053960: 7269 632e 7370 6c69 7428 225f 736c 6963  ric.split("_slic
+00053970: 655f 7374 6174 7322 295b 305d 290a 2020  e_stats")[0]).  
+00053980: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00053990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000539a0: 6d65 7472 6963 7332 2e61 7070 656e 6428  metrics2.append(
+000539b0: 6d65 7472 6963 290a 0a20 2020 2020 2020  metric)..       
+000539c0: 2066 6f72 2062 795f 736c 6963 652c 2073   for by_slice, s
+000539d0: 7461 7473 2069 6e20 280a 2020 2020 2020  tats in (.      
+000539e0: 2020 2020 2020 2020 2020 6578 7061 6e64            expand
+000539f0: 5f73 6c69 6365 5f73 7461 7473 2873 6c69  _slice_stats(sli
+00053a00: 6365 5f73 7461 7473 2c20 6465 6661 756c  ce_stats, defaul
+00053a10: 745f 6279 5f73 6c69 6365 292e 6974 656d  t_by_slice).item
+00053a20: 7328 2929 3a0a 2020 2020 2020 2020 2020  s()):.          
+00053a30: 2020 666f 7220 6d65 7472 6963 2069 6e20    for metric in 
+00053a40: 736c 6963 655f 7374 6174 735f 6d65 7472  slice_stats_metr
+00053a50: 6963 733a 0a20 2020 2020 2020 2020 2020  ics:.           
+00053a60: 2020 2020 2066 6f72 2073 7461 7420 696e       for stat in
+00053a70: 2073 7461 7473 3a0a 2020 2020 2020 2020   stats:.        
+00053a80: 2020 2020 2020 2020 2020 2020 6d65 7472              metr
+00053a90: 6963 7332 2e61 7070 656e 6428 6622 7b6d  ics2.append(f"{m
+00053aa0: 6574 7269 637d 5f73 6c69 6365 5f7b 6279  etric}_slice_{by
+00053ab0: 5f73 6c69 6365 7d5f 7b73 7461 747d 2229  _slice}_{stat}")
+00053ac0: 0a20 2020 2020 2020 206d 6574 7269 6373  .        metrics
+00053ad0: 203d 206d 6574 7269 6373 320a 0a20 2020   = metrics2..   
+00053ae0: 2072 6574 7572 6e20 736f 7274 6564 286d   return sorted(m
+00053af0: 6574 7269 6373 290a 0a64 6566 2067 6574  etrics)..def get
+00053b00: 5f63 6f6e 7365 6e73 7573 5f74 7970 6573  _consensus_types
+00053b10: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
+00053b20: 4765 7420 6c69 7374 206f 6620 636f 6e73  Get list of cons
+00053b30: 656e 7375 7320 7479 7065 732e 0a0a 2020  ensus types...  
+00053b40: 2020 416c 6c20 636f 6e73 656e 7375 7320    All consensus 
+00053b50: 7479 7065 7320 6c69 7374 6564 2068 6572  types listed her
+00053b60: 6520 7368 6f75 6c64 2062 6520 7265 636f  e should be reco
+00053b70: 676e 6973 6564 2062 790a 2020 2020 5374  gnised by.    St
+00053b80: 7275 6374 7572 6553 6574 2e67 6574 5f63  ructureSet.get_c
+00053b90: 6f6e 7365 6e73 7573 2829 2c20 616e 6420  onsensus(), and 
+00053ba0: 616c 6c20 636f 6e73 656e 7375 7320 7479  all consensus ty
+00053bb0: 7065 7320 7265 636f 676e 6973 6564 0a20  pes recognised. 
+00053bc0: 2020 2062 7920 5374 7275 6374 7572 6553     by StructureS
+00053bd0: 6574 2e67 6574 5f63 6f6e 7365 6e73 7573  et.get_consensus
+00053be0: 2073 686f 756c 6420 6265 206c 6973 7465   should be liste
+00053bf0: 6420 6865 7265 2e0a 2020 2020 2222 220a  d here..    """.
+00053c00: 2020 2020 7265 7475 726e 205b 0a20 2020      return [.   
+00053c10: 2020 2020 2020 2020 2022 6d61 6a6f 7269           "majori
+00053c20: 7479 222c 0a20 2020 2020 2020 2020 2020  ty",.           
+00053c30: 2022 6f76 6572 6c61 7022 2c0a 2020 2020   "overlap",.    
+00053c40: 2020 2020 2020 2020 2273 7461 706c 6522          "staple"
+00053c50: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
+00053c60: 756d 222c 0a20 2020 2020 2020 2020 2020  um",.           
+00053c70: 205d 0a0a 6465 6620 6765 745f 6279 5f73   ]..def get_by_s
+00053c80: 6c69 6365 5f6d 6574 686f 6473 2829 3a0a  lice_methods():.
+00053c90: 2020 2020 2222 220a 2020 2020 4765 7420      """.    Get 
+00053ca0: 6c69 7374 206f 6620 6d65 7468 6f64 7320  list of methods 
+00053cb0: 666f 7220 6465 6669 6e69 6e67 2073 6c69  for defining sli
+00053cc0: 6365 7320 746f 2062 6520 636f 6e73 6964  ces to be consid
+00053cd0: 6572 6564 0a20 2020 2066 6f72 2073 6c69  ered.    for sli
+00053ce0: 6365 2d62 792d 736c 6963 6520 524f 4920  ce-by-slice ROI 
+00053cf0: 636f 6d70 6172 6973 6f6e 732e 0a20 2020  comparisons..   
+00053d00: 2022 2222 0a20 2020 2072 6574 7572 6e20   """.    return 
+00053d10: 5b22 6c65 6674 222c 2022 7269 6768 7422  ["left", "right"
+00053d20: 2c20 2275 6e69 6f6e 222c 2022 696e 7465  , "union", "inte
+00053d30: 7273 6563 7469 6f6e 225d 0a0a 6465 6620  rsection"]..def 
+00053d40: 6765 745f 616c 6c5f 726f 6973 286f 626a  get_all_rois(obj
+00053d50: 733d 4e6f 6e65 293a 0a20 2020 2022 2222  s=None):.    """
+00053d60: 0a20 2020 2043 7265 6174 6520 6c69 7374  .    Create list
+00053d70: 206f 6620 524f 4973 2066 726f 6d20 6172   of ROIs from ar
+00053d80: 6269 7472 6172 7920 636f 6d62 696e 6174  bitrary combinat
+00053d90: 696f 6e20 6f66 2052 4f49 7320 616e 6420  ion of ROIs and 
+00053da0: 5374 7275 6374 7572 6553 6574 732e 0a0a  StructureSets...
+00053db0: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+00053dc0: 3a2a 2a0a 0a20 2020 206f 626a 7320 3a20  :**..    objs : 
+00053dd0: 524f 492f 5374 7275 6374 7572 6553 6574  ROI/StructureSet
+00053de0: 2f6c 6973 742c 2064 6566 6175 6c74 3d4e  /list, default=N
+00053df0: 6f6e 650a 2020 2020 2020 2020 4f62 6a65  one.        Obje
+00053e00: 6374 2873 2920 6672 6f6d 2077 6869 6368  ct(s) from which
+00053e10: 2061 206c 6973 7420 6f66 2052 4f49 7320   a list of ROIs 
+00053e20: 6973 2074 6f20 6265 2063 7265 6174 6564  is to be created
+00053e30: 2e20 2054 6865 0a20 2020 2020 2020 206f  .  The.        o
+00053e40: 626a 6563 7428 7329 2063 616e 2062 6520  bject(s) can be 
+00053e50: 6120 7369 6e67 6c65 2073 6b72 742e 7374  a single skrt.st
+00053e60: 7275 6374 7572 6573 2e52 4f49 206f 626a  ructures.ROI obj
+00053e70: 6563 742c 2061 2073 696e 676c 650a 2020  ect, a single.  
+00053e80: 2020 2020 2020 736b 7274 2e73 7472 7563        skrt.struc
+00053e90: 7475 7265 732e 5374 7275 6374 7572 6553  tures.StructureS
+00053ea0: 6574 206f 626a 6563 742c 206f 7220 6120  et object, or a 
+00053eb0: 6c69 7374 2063 6f6e 7461 696e 696e 6720  list containing 
+00053ec0: 616e 790a 2020 2020 2020 2020 636f 6d62  any.        comb
+00053ed0: 696e 6174 696f 6e20 6f66 2052 4f49 2061  ination of ROI a
+00053ee0: 6e64 2053 7472 7563 7475 7265 5365 7420  nd StructureSet 
+00053ef0: 6f62 6a65 6374 732e 0a20 2020 2022 2222  objects..    """
+00053f00: 0a20 2020 2023 2045 6e73 7572 6520 7468  .    # Ensure th
+00053f10: 6174 206f 626a 7320 6973 2061 206c 6973  at objs is a lis
+00053f20: 740a 2020 2020 6966 2069 7373 7562 636c  t.    if issubcl
+00053f30: 6173 7328 7479 7065 286f 626a 7329 2c20  ass(type(objs), 
+00053f40: 2852 4f49 2c20 5374 7275 6374 7572 6553  (ROI, StructureS
+00053f50: 6574 2929 3a0a 2020 2020 2020 2020 6f62  et)):.        ob
+00053f60: 6a73 203d 205b 6f62 6a73 5d0a 2020 2020  js = [objs].    
+00053f70: 656c 6966 206f 626a 7320 6973 204e 6f6e  elif objs is Non
+00053f80: 653a 0a20 2020 2020 2020 206f 626a 7320  e:.        objs 
+00053f90: 3d20 5b5d 0a0a 2020 2020 2320 4372 6561  = []..    # Crea
+00053fa0: 7465 2061 206c 6973 7420 636f 6e74 6169  te a list contai
+00053fb0: 6e69 6e67 2061 6c6c 2075 6e69 7175 6520  ning all unique 
+00053fc0: 726f 6973 2e0a 2020 2020 616c 6c5f 726f  rois..    all_ro
+00053fd0: 6973 203d 205b 5d0a 2020 2020 666f 7220  is = [].    for 
+00053fe0: 6974 656d 2069 6e20 6f62 6a73 3a0a 2020  item in objs:.  
+00053ff0: 2020 2020 2020 6966 2069 7373 7562 636c        if issubcl
+00054000: 6173 7328 7479 7065 2869 7465 6d29 2c20  ass(type(item), 
+00054010: 524f 4929 3a0a 2020 2020 2020 2020 2020  ROI):.          
+00054020: 2020 6361 6e64 6964 6174 655f 726f 6973    candidate_rois
+00054030: 203d 205b 6974 656d 5d0a 2020 2020 2020   = [item].      
+00054040: 2020 656c 6966 2069 7373 7562 636c 6173    elif issubclas
+00054050: 7328 7479 7065 2869 7465 6d29 2c20 5374  s(type(item), St
+00054060: 7275 6374 7572 6553 6574 293a 0a20 2020  ructureSet):.   
+00054070: 2020 2020 2020 2020 2063 616e 6469 6461           candida
+00054080: 7465 5f72 6f69 7320 3d20 6974 656d 2e67  te_rois = item.g
+00054090: 6574 5f72 6f69 7328 290a 2020 2020 2020  et_rois().      
+000540a0: 2020 666f 7220 726f 6920 696e 2063 616e    for roi in can
+000540b0: 6469 6461 7465 5f72 6f69 733a 0a20 2020  didate_rois:.   
+000540c0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000540d0: 726f 6920 696e 2061 6c6c 5f72 6f69 733a  roi in all_rois:
+000540e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000540f0: 2061 6c6c 5f72 6f69 732e 6170 7065 6e64   all_rois.append
+00054100: 2872 6f69 290a 0a20 2020 2072 6574 7572  (roi)..    retur
+00054110: 6e20 616c 6c5f 726f 6973 0a0a 6465 6620  n all_rois..def 
+00054120: 6765 745f 7472 616e 736c 6174 696f 6e5f  get_translation_
+00054130: 746f 5f61 6c69 676e 2872 6f69 312c 2072  to_align(roi1, r
+00054140: 6f69 322c 207a 5f66 7261 6374 696f 6e31  oi2, z_fraction1
+00054150: 3d4e 6f6e 652c 207a 5f66 7261 6374 696f  =None, z_fractio
+00054160: 6e32 3d4e 6f6e 6529 3a0a 2020 2020 2222  n2=None):.    ""
+00054170: 220a 2020 2020 4465 7465 726d 696e 6520  ".    Determine 
+00054180: 7472 616e 736c 6174 696f 6e20 666f 7220  translation for 
+00054190: 616c 6967 6e69 6e67 203c 726f 6931 3e20  aligning <roi1> 
+000541a0: 746f 203c 726f 6932 3e2e 0a0a 2020 2020  to <roi2>...    
+000541b0: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+000541c0: 0a20 2020 2072 6f69 3120 3a20 524f 492f  .    roi1 : ROI/
+000541d0: 5374 7275 6374 7572 6553 6574 2f6c 6973  StructureSet/lis
+000541e0: 740a 2020 2020 2020 2020 524f 4920 7468  t.        ROI th
+000541f0: 6174 2069 7320 746f 2062 6520 7472 616e  at is to be tran
+00054200: 736c 6174 696f 6e20 746f 2061 6368 6965  slation to achie
+00054210: 7665 2074 6865 2061 6c69 676e 6d65 6e74  ve the alignment
+00054220: 2e20 2054 6869 730a 2020 2020 2020 2020  .  This.        
+00054230: 6361 6e20 6265 2073 7065 6369 6669 6564  can be specified
+00054240: 2064 6972 6563 746c 7920 6173 2061 2073   directly as a s
+00054250: 696e 676c 6520 524f 492e 2020 416c 7465  ingle ROI.  Alte
+00054260: 726e 6174 6976 656c 792c 0a20 2020 2020  rnatively,.     
+00054270: 2020 2069 7420 6361 6e20 6265 2061 2053     it can be a S
+00054280: 7472 7563 7475 7265 5365 742c 206f 7220  tructureSet, or 
+00054290: 6120 6c69 7374 206f 7220 524f 492f 5374  a list or ROI/St
+000542a0: 7275 6374 7572 6553 6574 206f 626a 6563  ructureSet objec
+000542b0: 7473 2c0a 2020 2020 2020 2020 696e 2077  ts,.        in w
+000542c0: 6869 6368 2063 6173 6520 7468 6520 696e  hich case the in
+000542d0: 6469 7669 6475 616c 2052 4f49 7320 7769  dividual ROIs wi
+000542e0: 6c6c 2062 6520 636f 6d62 696e 6564 2e0a  ll be combined..
+000542f0: 0a20 2020 2072 6f69 3220 3a20 524f 492f  .    roi2 : ROI/
+00054300: 5374 7275 6374 7572 6553 6574 2f6c 6973  StructureSet/lis
+00054310: 740a 2020 2020 2020 2020 524f 4920 7769  t.        ROI wi
+00054320: 7468 2077 6869 6368 2061 6c69 676e 6d65  th which alignme
+00054330: 6e74 2069 7320 746f 2062 6520 7065 7266  nt is to be perf
+00054340: 6f72 6d65 642e 2020 5468 6973 2063 616e  ormed.  This can
+00054350: 2062 650a 2020 2020 2020 2020 7370 6563   be.        spec
+00054360: 6966 6965 6420 6469 7265 6374 6c79 2061  ified directly a
+00054370: 7320 6120 7369 6e67 6c65 2052 4f49 2e20  s a single ROI. 
+00054380: 2041 6c74 6572 6e61 7469 7665 6c79 2c20   Alternatively, 
+00054390: 6974 2063 616e 0a20 2020 2020 2020 2062  it can.        b
+000543a0: 6520 6120 5374 7275 6374 7572 6553 6574  e a StructureSet
+000543b0: 2c20 6f72 2061 206c 6973 7420 6f72 2052  , or a list or R
+000543c0: 4f49 2f53 7472 7563 7475 7265 5365 7420  OI/StructureSet 
+000543d0: 6f62 6a65 6374 732c 0a20 2020 2020 2020  objects,.       
+000543e0: 2069 6e20 7768 6963 6820 6361 7365 2074   in which case t
+000543f0: 6865 2069 6e64 6976 6964 7561 6c20 524f  he individual RO
+00054400: 4973 2077 696c 6c20 6265 2063 6f6d 6269  Is will be combi
+00054410: 6e65 642e 0a0a 2020 2020 7a5f 6672 6163  ned...    z_frac
+00054420: 7469 6f6e 3120 3a20 666c 6f61 742c 2064  tion1 : float, d
+00054430: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00054440: 2020 2020 506f 7369 7469 6f6e 2061 6c6f      Position alo
+00054450: 6e67 207a 2061 7869 7320 6f66 2073 6c69  ng z axis of sli
+00054460: 6365 2074 6872 6f75 6768 203c 726f 6931  ce through <roi1
+00054470: 3e20 6f6e 2077 6869 6368 0a20 2020 2020  > on which.     
+00054480: 2020 2074 6f20 616c 6967 6e2e 2020 4966     to align.  If
+00054490: 204e 6f6e 652c 2061 6c69 676e 6d65 6e74   None, alignment
+000544a0: 2069 7320 746f 2074 6865 2063 656e 7472   is to the centr
+000544b0: 6f69 6420 6f66 2074 6865 0a20 2020 2020  oid of the.     
+000544c0: 2020 2077 686f 6c65 2052 4f49 2076 6f6c     whole ROI vol
+000544d0: 756d 652e 2020 4f74 6865 7277 6973 652c  ume.  Otherwise,
+000544e0: 2061 6c69 676e 6d65 6e74 2069 7320 746f   alignment is to
+000544f0: 2074 6865 0a20 2020 2020 2020 2063 656e   the.        cen
+00054500: 7472 6f69 6420 6f66 2074 6865 2073 6c69  troid of the sli
+00054510: 6365 2061 7420 7468 6520 7370 6563 6966  ce at the specif
+00054520: 6965 6420 6469 7374 616e 6365 0a20 2020  ied distance.   
+00054530: 2020 2020 2066 726f 6d20 7468 6520 524f       from the RO
+00054540: 4927 7320 6d6f 7374 2d69 6e66 6572 696f  I's most-inferio
+00054550: 7220 706f 696e 743a 2030 2063 6f72 7265  r point: 0 corre
+00054560: 7370 6f6e 6473 2074 6f0a 2020 2020 2020  sponds to.      
+00054570: 2020 7468 6520 6d6f 7374 2d69 6e66 6572    the most-infer
+00054580: 696f 7220 706f 696e 7420 286c 6f77 6573  ior point (lowes
+00054590: 7420 7a29 3b20 3120 636f 7272 6573 706f  t z); 1 correspo
+000545a0: 6e64 7320 746f 2074 6865 0a20 2020 2020  nds to the.     
+000545b0: 2020 206d 6f73 742d 7375 7065 7269 6f72     most-superior
+000545c0: 2070 6f69 6e74 2028 6869 6768 6573 7420   point (highest 
+000545d0: 7a29 2e20 2056 616c 7565 7320 666f 7220  z).  Values for 
+000545e0: 7a5f 6672 6163 7469 6f6e 0a20 2020 2020  z_fraction.     
+000545f0: 2020 206f 7574 7369 6465 2074 6865 2069     outside the i
+00054600: 6e74 6572 7661 6c20 5b30 2c20 315d 2072  nterval [0, 1] r
+00054610: 6573 756c 7420 696e 2061 2052 756e 7469  esult in a Runti
+00054620: 6d65 4572 726f 722e 0a0a 2020 2020 7a5f  meError...    z_
+00054630: 6672 6163 7469 6f6e 3220 3a20 666c 6f61  fraction2 : floa
+00054640: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+00054650: 2020 2020 2020 2020 506f 7369 7469 6f6e          Position
+00054660: 2061 6c6f 6e67 207a 2061 7869 7320 6f66   along z axis of
+00054670: 2073 6c69 6365 2074 6872 6f75 6768 203c   slice through <
+00054680: 726f 6932 3e20 6f6e 2077 6869 6368 0a20  roi2> on which. 
+00054690: 2020 2020 2020 2074 6f20 616c 6967 6e2e         to align.
+000546a0: 2020 4966 204e 6f6e 652c 2061 6c69 676e    If None, align
+000546b0: 6d65 6e74 2069 7320 746f 2074 6865 2063  ment is to the c
+000546c0: 656e 7472 6f69 6420 6f66 2074 6865 0a20  entroid of the. 
+000546d0: 2020 2020 2020 2077 686f 6c65 2052 4f49         whole ROI
+000546e0: 2076 6f6c 756d 652e 2020 4f74 6865 7277   volume.  Otherw
+000546f0: 6973 652c 2061 6c69 676e 6d65 6e74 2069  ise, alignment i
+00054700: 7320 746f 2074 6865 0a20 2020 2020 2020  s to the.       
+00054710: 2063 656e 7472 6f69 6420 6f66 2074 6865   centroid of the
+00054720: 2073 6c69 6365 2061 7420 7468 6520 7370   slice at the sp
+00054730: 6563 6966 6965 6420 6469 7374 616e 6365  ecified distance
+00054740: 0a20 2020 2020 2020 2066 726f 6d20 7468  .        from th
+00054750: 6520 524f 4927 7320 6d6f 7374 2d69 6e66  e ROI's most-inf
+00054760: 6572 696f 7220 706f 696e 743a 2030 2063  erior point: 0 c
+00054770: 6f72 7265 7370 6f6e 6473 2074 6f0a 2020  orresponds to.  
+00054780: 2020 2020 2020 7468 6520 6d6f 7374 2d69        the most-i
+00054790: 6e66 6572 696f 7220 706f 696e 7420 286c  nferior point (l
+000547a0: 6f77 6573 7420 7a29 3b20 3120 636f 7272  owest z); 1 corr
+000547b0: 6573 706f 6e64 7320 746f 2074 6865 0a20  esponds to the. 
+000547c0: 2020 2020 2020 206d 6f73 742d 7375 7065         most-supe
+000547d0: 7269 6f72 2070 6f69 6e74 2028 6869 6768  rior point (high
+000547e0: 6573 7420 7a29 2e20 2056 616c 7565 7320  est z).  Values 
+000547f0: 666f 7220 7a5f 6672 6163 7469 6f6e 0a20  for z_fraction. 
+00054800: 2020 2020 2020 206f 7574 7369 6465 2074         outside t
+00054810: 6865 2069 6e74 6572 7661 6c20 5b30 2c20  he interval [0, 
+00054820: 315d 2072 6573 756c 7420 696e 2061 2052  1] result in a R
+00054830: 756e 7469 6d65 4572 726f 722e 0a20 2020  untimeError..   
+00054840: 2020 2020 2022 2222 0a20 2020 2023 2043       """.    # C
+00054850: 7265 6174 6520 6c69 7374 206f 6620 7477  reate list of tw
+00054860: 6f20 7369 6e67 6c65 2052 4f49 732e 0a20  o single ROIs.. 
+00054870: 2020 2072 6f69 7320 3d20 5b5d 0a20 2020     rois = [].   
+00054880: 2066 6f72 2072 6f69 2069 6e20 5b72 6f69   for roi in [roi
+00054890: 312c 2072 6f69 325d 3a0a 2020 2020 2020  1, roi2]:.      
+000548a0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000548b0: 726f 692c 2052 4f49 293a 0a20 2020 2020  roi, ROI):.     
+000548c0: 2020 2020 2020 2023 2053 746f 7265 2073         # Store s
+000548d0: 696e 676c 6520 524f 4920 6469 7265 6374  ingle ROI direct
+000548e0: 6c79 2e0a 2020 2020 2020 2020 2020 2020  ly..            
+000548f0: 726f 6973 2e61 7070 656e 6428 726f 6929  rois.append(roi)
+00054900: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
+00054910: 696e 7374 616e 6365 2872 6f69 2c20 5374  instance(roi, St
+00054920: 7275 6374 7572 6553 6574 293a 0a20 2020  ructureSet):.   
+00054930: 2020 2020 2020 2020 2023 2043 6f6d 6269           # Combi
+00054940: 6e65 2052 4f49 7320 6f66 2053 7472 7563  ne ROIs of Struc
+00054950: 7475 7265 5365 742e 0a20 2020 2020 2020  tureSet..       
+00054960: 2020 2020 2072 6f69 732e 6170 7065 6e64       rois.append
+00054970: 2872 6f69 2e63 6f6d 6269 6e65 5f72 6f69  (roi.combine_roi
+00054980: 7328 2929 0a20 2020 2020 2020 2065 6c73  s()).        els
+00054990: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+000549a0: 2043 6f6d 6269 6e65 2052 4f49 7320 6672   Combine ROIs fr
+000549b0: 6f6d 206c 6973 742e 0a20 2020 2020 2020  om list..       
+000549c0: 2020 2020 2072 6f69 732e 6170 7065 6e64       rois.append
+000549d0: 2853 7472 7563 7475 7265 5365 7428 6765  (StructureSet(ge
+000549e0: 745f 616c 6c5f 726f 6973 2872 6f69 2929  t_all_rois(roi))
+000549f0: 2e63 6f6d 6269 6e65 5f72 6f69 7328 2929  .combine_rois())
+00054a00: 0a0a 2020 2020 2320 4361 6c63 756c 6174  ..    # Calculat
+00054a10: 6520 616c 6967 6e6d 656e 7420 706f 696e  e alignment poin
+00054a20: 7473 2e0a 2020 2020 6365 6e74 726f 6964  ts..    centroid
+00054a30: 7320 3d20 5b5d 0a20 2020 2066 6f72 2072  s = [].    for r
+00054a40: 6f69 2c20 7a5f 6672 6163 7469 6f6e 2069  oi, z_fraction i
+00054a50: 6e20 7a69 7028 726f 6973 2c20 5b7a 5f66  n zip(rois, [z_f
+00054a60: 7261 6374 696f 6e31 2c20 7a5f 6672 6163  raction1, z_frac
+00054a70: 7469 6f6e 325d 293a 0a20 2020 2020 2020  tion2]):.       
+00054a80: 2023 2043 616c 6375 6c61 7465 2063 656e   # Calculate cen
+00054a90: 7472 6f69 6420 666f 7220 7468 6520 7768  troid for the wh
+00054aa0: 6f6c 6520 524f 4920 766f 6c75 6d65 2e0a  ole ROI volume..
+00054ab0: 2020 2020 2020 2020 6966 207a 5f66 7261          if z_fra
+00054ac0: 6374 696f 6e20 6973 204e 6f6e 653a 0a20  ction is None:. 
+00054ad0: 2020 2020 2020 2020 2020 2063 656e 7472             centr
+00054ae0: 6f69 6473 2e61 7070 656e 6428 726f 692e  oids.append(roi.
+00054af0: 6765 745f 6365 6e74 726f 6964 2829 290a  get_centroid()).
+00054b00: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
+00054b10: 6174 6520 6365 6e74 726f 6964 2066 6f72  ate centroid for
+00054b20: 2073 6c69 6365 2061 7420 7370 6563 6966   slice at specif
+00054b30: 6965 6420 706f 7369 7469 6f6e 2e0a 2020  ied position..  
+00054b40: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00054b50: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+00054b60: 732e 6170 7065 6e64 2872 6f69 2e67 6574  s.append(roi.get
+00054b70: 5f72 6f69 5f73 6c69 6365 287a 5f66 7261  _roi_slice(z_fra
+00054b80: 6374 696f 6e29 2e67 6574 5f63 656e 7472  ction).get_centr
+00054b90: 6f69 6428 2929 0a0a 2020 2020 7265 7475  oid())..    retu
+00054ba0: 726e 2074 7570 6c65 2863 656e 7472 6f69  rn tuple(centroi
+00054bb0: 6473 5b31 5d20 2d20 6365 6e74 726f 6964  ds[1] - centroid
+00054bc0: 735b 305d 290a 0a64 6566 2067 6574 5f73  s[0])..def get_s
+00054bd0: 6c69 6365 5f70 6f73 6974 696f 6e73 2872  lice_positions(r
+00054be0: 6f69 312c 2072 6f69 323d 4e6f 6e65 2c20  oi1, roi2=None, 
+00054bf0: 7669 6577 3d22 782d 7922 2c20 706f 7369  view="x-y", posi
+00054c00: 7469 6f6e 5f61 735f 6964 783d 4661 6c73  tion_as_idx=Fals
+00054c10: 652c 0a20 2020 2020 2020 206d 6574 686f  e,.        metho
+00054c20: 643d 4e6f 6e65 293a 0a20 2020 2022 2222  d=None):.    """
+00054c30: 0a20 2020 2047 6574 206f 7264 6572 6564  .    Get ordered
+00054c40: 206c 6973 7420 6f66 2073 6c69 6365 2070   list of slice p
+00054c50: 6f73 6974 696f 6e73 2066 6f72 2065 6974  ositions for eit
+00054c60: 6865 7220 6f72 2062 6f74 6820 6f66 2061  her or both of a
+00054c70: 2070 6169 7220 6f66 2052 4f49 732e 0a0a   pair of ROIs...
+00054c80: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+00054c90: 3a2a 2a0a 0a20 2020 2072 6f69 3120 3a20  :**..    roi1 : 
+00054ca0: 736b 7274 2e73 7472 7563 7475 7265 732e  skrt.structures.
+00054cb0: 524f 490a 2020 2020 2020 2020 524f 492c  ROI.        ROI,
+00054cc0: 206f 7220 6f6e 6520 6f66 2061 2070 6169   or one of a pai
+00054cd0: 7220 6f66 2052 4f49 732c 2066 6f72 2077  r of ROIs, for w
+00054ce0: 6869 6368 2073 6c69 6365 2069 6e66 6f72  hich slice infor
+00054cf0: 6d61 7469 6f6e 2069 7320 746f 0a20 2020  mation is to.   
+00054d00: 2020 2020 2062 6520 6f62 7461 696e 6564       be obtained
+00054d10: 2e0a 0a20 2020 2072 6f69 3220 3a20 736b  ...    roi2 : sk
+00054d20: 7274 2e73 7472 7563 7475 7265 732e 524f  rt.structures.RO
+00054d30: 492c 2064 6566 6175 6c74 3d4e 6f6e 650a  I, default=None.
+00054d40: 2020 2020 2020 2020 4966 206e 6f74 204e          If not N
+00054d50: 6f6e 652c 2073 6563 6f6e 6420 696e 2061  one, second in a
+00054d60: 2070 6169 7220 6f66 2052 4f49 7320 666f   pair of ROIs fo
+00054d70: 7220 7768 6963 6820 736c 6963 6520 696e  r which slice in
+00054d80: 666f 726d 6174 696f 6e0a 2020 2020 2020  formation.      
+00054d90: 2020 6973 2074 6f20 6265 206f 6274 6169    is to be obtai
+00054da0: 6e65 642e 0a0a 2020 2020 7669 6577 203a  ned...    view :
+00054db0: 2073 7472 2c20 6465 6661 756c 743d 2278   str, default="x
+00054dc0: 2d79 220a 2020 2020 2020 2020 5669 6577  -y".        View
+00054dd0: 2069 6e20 7768 6963 6820 746f 206f 6274   in which to obt
+00054de0: 6169 6e20 736c 6963 6573 2e0a 0a20 2020  ain slices...   
+00054df0: 2070 6f73 6974 696f 6e5f 6173 5f69 6478   position_as_idx
+00054e00: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+00054e10: 3d46 616c 7365 0a20 2020 2020 2020 2049  =False.        I
+00054e20: 6620 5472 7565 2c20 7265 7475 726e 2070  f True, return p
+00054e30: 6f73 6974 696f 6e73 2061 7320 736c 6963  ositions as slic
+00054e40: 6520 696e 6469 6365 733b 2069 6620 4661  e indices; if Fa
+00054e50: 6c73 652c 0a20 2020 2020 2020 2072 6574  lse,.        ret
+00054e60: 7572 6e20 706f 7369 7469 6f6e 7320 6173  urn positions as
+00054e70: 2073 6c69 6365 207a 2d63 6f6f 7264 696e   slice z-coordin
+00054e80: 6174 6573 2028 6d6d 292e 0a0a 2020 2020  ates (mm)...    
+00054e90: 6d65 7468 6f64 3a20 7374 722c 2064 6566  method: str, def
+00054ea0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+00054eb0: 2020 5374 7269 6e67 2073 7065 6369 6679    String specify
+00054ec0: 696e 6720 736c 6963 6573 2066 6f72 2077  ing slices for w
+00054ed0: 6869 6368 2070 6f73 6974 696f 6e73 2061  hich positions a
+00054ee0: 7265 2074 6f20 6265 206f 6274 6169 6e65  re to be obtaine
+00054ef0: 642c 0a20 2020 2020 2020 2066 6f72 2052  d,.        for R
+00054f00: 4f49 7320 726f 6931 2c20 726f 6932 3a0a  OIs roi1, roi2:.
+00054f10: 0a20 2020 2020 2020 202d 2022 6c65 6674  .        - "left
+00054f20: 2220 286f 7220 726f 6932 2069 7320 4e6f  " (or roi2 is No
+00054f30: 6e65 293a 2072 6574 7572 6e20 706f 7369  ne): return posi
+00054f40: 7469 6f6e 7320 6f66 2073 6c69 6365 7320  tions of slices 
+00054f50: 636f 6e74 6169 6e69 6e67 2072 6f69 313b  containing roi1;
+00054f60: 0a20 2020 2020 2020 202d 2022 7269 6768  .        - "righ
+00054f70: 7422 3a20 7265 7475 726e 2070 6f73 6974  t": return posit
+00054f80: 696f 6e73 206f 6620 736c 6963 6573 2063  ions of slices c
+00054f90: 6f6e 7461 696e 696e 6720 726f 6932 3b0a  ontaining roi2;.
+00054fa0: 2020 2020 2020 2020 2d20 2275 6e69 6f6e          - "union
+00054fb0: 223a 2072 6574 7572 6e20 706f 7369 7469  ": return positi
+00054fc0: 6f6e 7320 6f66 2073 6c69 6365 7320 636f  ons of slices co
+00054fd0: 6e74 6169 6e69 6e67 2065 6974 6865 7220  ntaining either 
+00054fe0: 726f 6931 206f 7220 726f 6932 3b0a 2020  roi1 or roi2;.  
+00054ff0: 2020 2020 2020 2d20 2269 6e74 6572 7365        - "interse
+00055000: 6374 696f 6e22 3a20 7265 7475 726e 2070  ction": return p
+00055010: 6f73 6974 696f 6e73 206f 6620 736c 6963  ositions of slic
+00055020: 6573 2063 6f6e 7461 696e 696e 6720 626f  es containing bo
+00055030: 7468 0a20 2020 2020 2020 2020 2072 6f69  th.          roi
+00055040: 3120 616e 6420 726f 6932 2e0a 0a20 2020  1 and roi2...   
+00055050: 2020 2020 2049 6620 4e6f 6e65 2c20 7661       If None, va
+00055060: 6c75 6520 6f66 2073 6b72 742e 636f 7265  lue of skrt.core
+00055070: 2e44 6566 6175 6c74 7328 292e 6279 5f73  .Defaults().by_s
+00055080: 6c69 6365 2069 7320 7573 6564 2e0a 2020  lice is used..  
+00055090: 2020 2222 220a 2020 2020 6d65 7468 6f64    """.    method
+000550a0: 203d 206d 6574 686f 6420 6f72 2073 6b72   = method or skr
+000550b0: 742e 636f 7265 2e44 6566 6175 6c74 7328  t.core.Defaults(
+000550c0: 292e 6279 5f73 6c69 6365 0a20 2020 2069  ).by_slice.    i
+000550d0: 6620 6d65 7468 6f64 206e 6f74 2069 6e20  f method not in 
+000550e0: 6765 745f 6279 5f73 6c69 6365 5f6d 6574  get_by_slice_met
+000550f0: 686f 6473 2829 3a0a 2020 2020 2020 2020  hods():.        
+00055100: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
+00055110: 6f72 2866 224d 6574 686f 6420 6d75 7374  or(f"Method must
+00055120: 2062 6520 6f6e 6520 6f66 207b 6765 745f   be one of {get_
+00055130: 6279 5f73 6c69 6365 5f6d 6574 686f 6473  by_slice_methods
+00055140: 2829 7d22 0a20 2020 2020 2020 2022 202d  ()}".        " -
+00055150: 206e 6f74 2027 7b6d 6574 686f 647d 2722   not '{method}'"
+00055160: 290a 0a20 2020 2069 6e64 6963 6573 203d  )..    indices =
+00055170: 204e 6f6e 650a 0a20 2020 2069 6e64 6963   None..    indic
+00055180: 6573 3120 3d20 726f 6931 2e67 6574 5f69  es1 = roi1.get_i
+00055190: 6e64 6963 6573 2876 6965 773d 7669 6577  ndices(view=view
+000551a0: 2c20 6d65 7468 6f64 3d22 6d61 736b 2229  , method="mask")
+000551b0: 0a20 2020 2069 6620 6e6f 7420 6973 7375  .    if not issu
+000551c0: 6263 6c61 7373 2874 7970 6528 726f 6932  bclass(type(roi2
+000551d0: 292c 2052 4f49 2920 6f72 2022 6c65 6674  ), ROI) or "left
+000551e0: 2220 3d3d 206d 6574 686f 643a 0a20 2020  " == method:.   
+000551f0: 2020 2020 2069 6e64 6963 6573 203d 2069       indices = i
+00055200: 6e64 6963 6573 310a 0a20 2020 2069 6620  ndices1..    if 
+00055210: 696e 6469 6365 7320 6973 204e 6f6e 653a  indices is None:
+00055220: 0a20 2020 2020 2020 2069 6e64 6963 6573  .        indices
+00055230: 3220 3d20 726f 6932 2e67 6574 5f69 6e64  2 = roi2.get_ind
+00055240: 6963 6573 2876 6965 773d 7669 6577 2c20  ices(view=view, 
+00055250: 6d65 7468 6f64 3d22 6d61 736b 2229 0a20  method="mask"). 
+00055260: 2020 2020 2020 2069 6620 2272 6967 6874         if "right
+00055270: 2220 3d3d 206d 6574 686f 643a 0a20 2020  " == method:.   
+00055280: 2020 2020 2020 2020 2069 6e64 6963 6573           indices
+00055290: 203d 2069 6e64 6963 6573 320a 2020 2020   = indices2.    
+000552a0: 2020 2020 0a20 2020 2069 6620 696e 6469      .    if indi
+000552b0: 6365 7320 6973 204e 6f6e 653a 0a20 2020  ces is None:.   
+000552c0: 2020 2020 2069 6620 2275 6e69 6f6e 2220       if "union" 
+000552d0: 3d3d 206d 6574 686f 643a 0a20 2020 2020  == method:.     
+000552e0: 2020 2020 2020 2069 6e64 6963 6573 203d         indices =
+000552f0: 206c 6973 7428 7365 7428 696e 6469 6365   list(set(indice
+00055300: 7331 292e 756e 696f 6e28 7365 7428 696e  s1).union(set(in
+00055310: 6469 6365 7332 2929 290a 0a20 2020 2069  dices2)))..    i
+00055320: 6620 696e 6469 6365 7320 6973 204e 6f6e  f indices is Non
+00055330: 653a 0a20 2020 2020 2020 2069 6620 2269  e:.        if "i
+00055340: 6e74 6572 7365 6374 696f 6e22 203d 3d20  ntersection" == 
+00055350: 6d65 7468 6f64 3a0a 2020 2020 2020 2020  method:.        
+00055360: 2020 2020 696e 6469 6365 7320 3d20 6c69      indices = li
+00055370: 7374 2873 6574 2869 6e64 6963 6573 3129  st(set(indices1)
+00055380: 2e69 6e74 6572 7365 6374 696f 6e28 7365  .intersection(se
+00055390: 7428 696e 6469 6365 7332 2929 290a 0a20  t(indices2))).. 
+000553a0: 2020 2069 6620 696e 6469 6365 7320 6973     if indices is
+000553b0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+000553c0: 2020 2069 6620 706f 7369 7469 6f6e 5f61     if position_a
+000553d0: 735f 6964 783a 0a20 2020 2020 2020 2020  s_idx:.         
+000553e0: 2020 2072 6574 7572 6e20 736f 7274 6564     return sorted
+000553f0: 2869 6e64 6963 6573 290a 2020 2020 2020  (indices).      
+00055400: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00055410: 2020 2020 6178 203d 2073 6b72 742e 696d      ax = skrt.im
+00055420: 6167 652e 5f73 6c69 6365 5f61 7865 735b  age._slice_axes[
+00055430: 7669 6577 5d0a 2020 2020 2020 2020 2020  view].          
+00055440: 2020 7265 7475 726e 2073 6f72 7465 6428    return sorted(
+00055450: 5b72 6f69 312e 6964 785f 746f 5f70 6f73  [roi1.idx_to_pos
+00055460: 2869 6478 2c20 6178 2920 666f 7220 6964  (idx, ax) for id
+00055470: 7820 696e 2069 6e64 6963 6573 5d29 0a0a  x in indices])..
+00055480: 6465 6620 6578 7061 6e64 5f73 6c69 6365  def expand_slice
+00055490: 5f73 7461 7473 2873 6c69 6365 5f73 7461  _stats(slice_sta
+000554a0: 7473 3d4e 6f6e 652c 2064 6566 6175 6c74  ts=None, default
+000554b0: 5f62 795f 736c 6963 653d 4e6f 6e65 293a  _by_slice=None):
+000554c0: 0a20 2020 2022 2222 0a20 2020 2045 7870  .    """.    Exp
+000554d0: 616e 6420 7370 6563 6966 6963 6174 696f  and specificatio
+000554e0: 6e20 6f66 2073 7461 7469 7374 6963 7320  n of statistics 
+000554f0: 746f 2063 616c 6375 6c61 7465 2066 6f72  to calculate for
+00055500: 2052 4f49 2063 6f6d 7061 7269 736f 6e0a   ROI comparison.
+00055510: 2020 2020 6d65 7472 6963 7320 6576 616c      metrics eval
+00055520: 7561 7465 6420 736c 6963 6520 6279 2073  uated slice by s
+00055530: 6c69 6365 2e0a 0a20 2020 2041 2064 6963  lice...    A dic
+00055540: 7469 6f6e 6172 7920 6973 2072 6574 7572  tionary is retur
+00055550: 6e65 642c 2077 6865 7265 206b 6579 7320  ned, where keys 
+00055560: 6769 7665 2074 6865 2073 6c69 6365 7320  give the slices 
+00055570: 746f 2062 6520 636f 6e73 6964 6572 6564  to be considered
+00055580: 0a20 2020 2066 6f72 2063 616c 6375 6c61  .    for calcula
+00055590: 7469 6e67 2073 7461 7469 7374 6963 732c  ting statistics,
+000555a0: 2061 6e64 2076 616c 7565 7320 6172 6520   and values are 
+000555b0: 6c69 7374 7320 6f66 206d 6574 7269 6373  lists of metrics
+000555c0: 2e0a 0a20 2020 202a 2a50 6172 616d 6574  ...    **Paramet
+000555d0: 6572 733a 2a2a 0a0a 2020 2020 736c 6963  ers:**..    slic
+000555e0: 655f 7374 6174 7320 3a20 7374 722f 6c69  e_stats : str/li
+000555f0: 7374 2f64 6963 742c 2064 6566 6175 6c74  st/dict, default
+00055600: 3d4e 6f6e 650a 2020 2020 2020 2020 5370  =None.        Sp
+00055610: 6563 6966 6963 6174 696f 6e20 6f66 2073  ecification of s
+00055620: 7461 7469 7374 6963 7320 746f 2062 6520  tatistics to be 
+00055630: 6361 6c63 756c 6174 6564 2072 656c 6174  calculated relat
+00055640: 6976 650a 2020 2020 2020 2020 746f 2073  ive.        to s
+00055650: 6c69 6365 2d62 792d 736c 6963 6520 6d65  lice-by-slice me
+00055660: 7472 6963 2076 616c 7565 732e 0a0a 2020  tric values...  
+00055670: 2020 2020 2020 4120 7374 6174 6973 7469        A statisti
+00055680: 6320 6973 2073 7065 6369 6669 6564 2062  c is specified b
+00055690: 7920 7468 6520 6e61 6d65 206f 6620 7468  y the name of th
+000556a0: 6520 6675 6e63 7469 6f6e 2066 6f72 0a20  e function for. 
+000556b0: 2020 2020 2020 2069 7473 2063 616c 6375         its calcu
+000556c0: 6c61 7469 6f6e 2069 6e20 7468 6520 5079  lation in the Py
+000556d0: 7468 6f6e 2073 7461 7469 7374 6963 7320  thon statistics 
+000556e0: 6d6f 6475 6c65 3a0a 0a20 2020 2020 2020  module:..       
+000556f0: 2068 7474 7073 3a2f 2f64 6f63 732e 7079   https://docs.py
+00055700: 7468 6f6e 2e6f 7267 2f33 2f6c 6962 7261  thon.org/3/libra
+00055710: 7279 2f73 7461 7469 7374 6963 732e 6874  ry/statistics.ht
+00055720: 6d6c 0a0a 2020 2020 2020 2020 466f 7220  ml..        For 
+00055730: 6974 7320 7573 6520 6865 7265 2c20 7468  its use here, th
+00055740: 6520 7265 6c65 7661 6e74 2066 756e 6374  e relevant funct
+00055750: 696f 6e20 6d75 7374 2072 6571 7569 7265  ion must require
+00055760: 0a20 2020 2020 2020 2061 2073 696e 676c  .        a singl
+00055770: 652d 7661 7269 6162 6c65 2069 6e70 7574  e-variable input
+00055780: 2c20 6d75 7374 206e 6f74 2072 6571 7569  , must not requi
+00055790: 7265 2061 6e79 206b 6579 776f 7264 0a20  re any keyword. 
+000557a0: 2020 2020 2020 2061 7267 756d 656e 7473         arguments
+000557b0: 2c20 616e 6420 6d75 7374 2072 6574 7572  , and must retur
+000557c0: 6e20 6120 7369 6e67 6c65 206e 756d 6265  n a single numbe
+000557d0: 722e 0a0a 2020 2020 2020 2020 4176 6169  r...        Avai
+000557e0: 6c61 626c 6520 6f70 7469 6f6e 7320 696e  lable options in
+000557f0: 636c 7564 653a 2022 6d65 616e 222c 2022  clude: "mean", "
+00055800: 6d65 6469 616e 222c 2022 6d6f 6465 222c  median", "mode",
+00055810: 0a20 2020 2020 2020 2022 7374 6465 7622  .        "stdev"
+00055820: 2e0a 0a20 2020 2020 2020 5374 6174 6973  ...       Statis
+00055830: 7469 6373 2074 6f20 6265 2063 616c 6375  tics to be calcu
+00055840: 6c61 7465 6420 6361 6e20 6265 2073 7065  lated can be spe
+00055850: 6369 6669 6564 2075 7369 6e67 2061 6e79  cified using any
+00055860: 206f 660a 2020 2020 2020 2074 6865 2066   of.       the f
+00055870: 6f6c 6c6f 7769 6e67 3a0a 0a20 2020 2020  ollowing:..     
+00055880: 2020 2d20 5374 7269 6e67 2073 7065 6369    - String speci
+00055890: 6679 696e 6720 7369 6e67 6c65 2073 7461  fying single sta
+000558a0: 7469 7374 6963 2074 6f20 6265 2063 616c  tistic to be cal
+000558b0: 6375 6c61 7465 642c 0a20 2020 2020 2020  culated,.       
+000558c0: 2020 7769 7468 2073 6c69 6365 7320 636f    with slices co
+000558d0: 6e73 6964 6572 6564 2061 7320 6769 7665  nsidered as give
+000558e0: 6e20 6279 203c 6465 6661 756c 745f 6279  n by <default_by
+000558f0: 5f73 6c69 6365 3e2c 0a20 2020 2020 2020  _slice>,.       
+00055900: 2020 666f 7220 6578 616d 706c 653a 2022    for example: "
+00055910: 6d65 616e 223b 0a20 2020 2020 2020 2d20  mean";.       - 
+00055920: 4c69 7374 2073 7065 6369 6679 696e 6720  List specifying 
+00055930: 6d75 6c74 6970 6c65 2073 7461 7469 7374  multiple statist
+00055940: 6963 7320 746f 2062 6520 6361 6c63 756c  ics to be calcul
+00055950: 6174 6564 2c0a 2020 2020 2020 2020 2077  ated,.         w
+00055960: 6974 6820 736c 6963 6573 2063 6f6e 7369  ith slices consi
+00055970: 6465 7265 6420 6173 2067 6976 656e 2062  dered as given b
+00055980: 7920 3c64 6566 6175 6c74 5f62 795f 736c  y <default_by_sl
+00055990: 6963 653e 2c0a 2020 2020 2020 2020 2066  ice>,.         f
+000559a0: 6f72 2065 7861 6d70 6c65 3a20 5b22 6d65  or example: ["me
+000559b0: 616e 222c 2022 7374 6465 7622 5d3b 0a20  an", "stdev"];. 
+000559c0: 2020 2020 2020 2d20 4469 6374 696f 6e61        - Dictiona
+000559d0: 7279 2077 6865 7265 206b 6579 7320 7370  ry where keys sp
+000559e0: 6563 6966 7920 736c 6963 6573 2074 6f20  ecify slices to 
+000559f0: 6265 2063 6f6e 7369 6465 7265 642c 0a20  be considered,. 
+00055a00: 2020 2020 2020 2020 616e 6420 7661 6c75          and valu
+00055a10: 6573 2073 7065 6369 6679 2073 7461 7469  es specify stati
+00055a20: 7374 6963 7320 2873 7472 696e 6720 6f72  stics (string or
+00055a30: 206c 6973 7429 2c20 666f 720a 2020 2020   list), for.    
+00055a40: 2020 2020 2065 7861 6d70 6c65 3a20 7b22       example: {"
+00055a50: 756e 696f 6e22 3a20 5b22 6d65 616e 222c  union": ["mean",
+00055a60: 2022 7374 6465 7622 5d7d 2e20 2056 616c   "stdev"]}.  Val
+00055a70: 6964 2073 6c69 6365 0a20 2020 2020 2020  id slice.       
+00055a80: 2020 7370 6563 6966 6963 6174 696f 6e73    specifications
+00055a90: 2061 7265 2061 7320 6c69 7374 6564 2066   are as listed f
+00055aa0: 6f72 203c 6465 6661 756c 745f 6279 5f73  or <default_by_s
+00055ab0: 6c69 6365 3e2e 0a0a 2020 2020 6465 6661  lice>...    defa
+00055ac0: 756c 745f 6279 5f73 6c69 6365 3a20 7374  ult_by_slice: st
+00055ad0: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+00055ae0: 2020 2020 2020 2020 4465 6661 756c 7420          Default 
+00055af0: 7370 6563 6966 6963 6174 696f 6e20 6f66  specification of
+00055b00: 2073 6c69 6365 7320 746f 2062 6520 636f   slices to be co
+00055b10: 6e73 6964 6572 6564 2077 6865 6e0a 2020  nsidered when.  
+00055b20: 2020 2020 2020 6361 6c63 756c 6174 696e        calculatin
+00055b30: 6720 736c 6963 652d 6279 2d73 6c69 6365  g slice-by-slice
+00055b40: 2073 7461 7469 7374 6963 7320 666f 7220   statistics for 
+00055b50: 6120 6d65 7472 6963 2063 6f6d 7061 7269  a metric compari
+00055b60: 6e67 0a20 2020 2020 2020 2074 776f 2052  ng.        two R
+00055b70: 4f49 732c 2072 6f69 3120 616e 6420 726f  OIs, roi1 and ro
+00055b80: 6932 2e20 2054 6865 2076 616c 6964 2073  i2.  The valid s
+00055b90: 7065 6369 6669 6361 7469 6f6e 7320 6172  pecifications ar
+00055ba0: 653a 0a0a 2020 2020 2020 2020 2d20 226c  e:..        - "l
+00055bb0: 6566 7422 3a20 636f 6e73 6964 6572 206f  eft": consider o
+00055bc0: 6e6c 7920 736c 6963 6573 2063 6f6e 7461  nly slices conta
+00055bd0: 696e 696e 6720 726f 6931 3b0a 2020 2020  ining roi1;.    
+00055be0: 2020 2020 2d20 2272 6967 6874 223a 2063      - "right": c
+00055bf0: 6f6e 7369 6465 7220 6f6e 6c79 2073 6c69  onsider only sli
+00055c00: 6365 7320 636f 6e74 6169 6e69 6e67 2072  ces containing r
+00055c10: 6f69 323b 0a20 2020 2020 2020 202d 2022  oi2;.        - "
+00055c20: 756e 696f 6e22 3a20 636f 6e73 6964 6572  union": consider
+00055c30: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
+00055c40: 6e67 2065 6974 6865 7220 6f66 2072 6f69  ng either of roi
+00055c50: 3120 616e 6420 726f 6932 3b0a 2020 2020  1 and roi2;.    
+00055c60: 2020 2020 2d20 2269 6e74 6572 7365 6374      - "intersect
+00055c70: 696f 6e22 3a20 636f 6e73 6964 6572 2073  ion": consider s
+00055c80: 6c69 6365 7320 636f 6e74 6169 6e69 6e67  lices containing
+00055c90: 2062 6f74 6820 726f 6931 2061 6e64 2072   both roi1 and r
+00055ca0: 6f69 322e 0a0a 2020 2020 2020 2020 4966  oi2...        If
+00055cb0: 204e 6f6e 652c 2075 7365 2073 6b72 742e   None, use skrt.
+00055cc0: 636f 7265 2e44 6566 6175 6c74 7328 292e  core.Defaults().
+00055cd0: 6279 5f73 6c69 6365 0a20 2020 2022 2222  by_slice.    """
+00055ce0: 0a20 2020 2069 6620 6e6f 7420 736c 6963  .    if not slic
+00055cf0: 655f 7374 6174 733a 0a20 2020 2020 2020  e_stats:.       
+00055d00: 2072 6574 7572 6e20 7b7d 0a0a 2020 2020   return {}..    
+00055d10: 2320 5365 7420 6465 6661 756c 7420 6d65  # Set default me
+00055d20: 7468 6f64 2066 6f72 2073 6c69 6365 2073  thod for slice s
+00055d30: 656c 6563 7469 6f6e 2e0a 2020 2020 6465  election..    de
+00055d40: 6661 756c 745f 6279 5f73 6c69 6365 203d  fault_by_slice =
+00055d50: 2064 6566 6175 6c74 5f62 795f 736c 6963   default_by_slic
+00055d60: 6520 6f72 2073 6b72 742e 636f 7265 2e44  e or skrt.core.D
+00055d70: 6566 6175 6c74 7328 292e 6279 5f73 6c69  efaults().by_sli
+00055d80: 6365 0a0a 2020 2020 2320 456e 7375 7265  ce..    # Ensure
+00055d90: 2074 6861 7420 736c 6963 655f 7374 6174   that slice_stat
+00055da0: 7320 6973 2061 2064 6963 7469 6f6e 6172  s is a dictionar
+00055db0: 792e 0a20 2020 2069 6620 6973 696e 7374  y..    if isinst
+00055dc0: 616e 6365 2873 6c69 6365 5f73 7461 7473  ance(slice_stats
+00055dd0: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+00055de0: 736c 6963 655f 7374 6174 7320 3d20 7b64  slice_stats = {d
+00055df0: 6566 6175 6c74 5f62 795f 736c 6963 653a  efault_by_slice:
+00055e00: 205b 736c 6963 655f 7374 6174 735d 7d0a   [slice_stats]}.
+00055e10: 0a20 2020 2065 6c69 6620 736b 7274 2e63  .    elif skrt.c
+00055e20: 6f72 652e 6973 5f6c 6973 7428 736c 6963  ore.is_list(slic
+00055e30: 655f 7374 6174 7329 3a0a 2020 2020 2020  e_stats):.      
+00055e40: 2020 736c 6963 655f 7374 6174 7320 3d20    slice_stats = 
+00055e50: 7b64 6566 6175 6c74 5f62 795f 736c 6963  {default_by_slic
+00055e60: 653a 2073 6c69 6365 5f73 7461 7473 7d0a  e: slice_stats}.
+00055e70: 0a20 2020 2065 6c69 6620 6973 696e 7374  .    elif isinst
+00055e80: 616e 6365 2873 6c69 6365 5f73 7461 7473  ance(slice_stats
+00055e90: 2c20 6469 6374 293a 0a20 2020 2020 2020  , dict):.       
+00055ea0: 2063 6865 636b 6564 5f73 6c69 6365 5f73   checked_slice_s
+00055eb0: 7461 7473 203d 207b 7d0a 2020 2020 2020  tats = {}.      
+00055ec0: 2020 666f 7220 6279 5f73 6c69 6365 2c20    for by_slice, 
+00055ed0: 7374 6174 7320 696e 2073 6c69 6365 5f73  stats in slice_s
+00055ee0: 7461 7473 2e69 7465 6d73 2829 3a0a 2020  tats.items():.  
+00055ef0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+00055f00: 6e73 7461 6e63 6528 7374 6174 732c 2073  nstance(stats, s
+00055f10: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
+00055f20: 2020 2020 2063 6865 636b 6564 5f73 6c69       checked_sli
+00055f30: 6365 5f73 7461 7473 5b62 795f 736c 6963  ce_stats[by_slic
+00055f40: 655d 203d 205b 7374 6174 735d 0a20 2020  e] = [stats].   
+00055f50: 2020 2020 2020 2020 2065 6c69 6620 736b           elif sk
+00055f60: 7274 2e63 6f72 652e 6973 5f6c 6973 7428  rt.core.is_list(
+00055f70: 7374 6174 7329 3a0a 2020 2020 2020 2020  stats):.        
+00055f80: 2020 2020 2020 2020 6368 6563 6b65 645f          checked_
+00055f90: 736c 6963 655f 7374 6174 735b 6279 5f73  slice_stats[by_s
+00055fa0: 6c69 6365 5d20 3d20 6c69 7374 2873 7461  lice] = list(sta
+00055fb0: 7473 290a 2020 2020 2020 2020 736c 6963  ts).        slic
+00055fc0: 655f 7374 6174 7320 3d20 6368 6563 6b65  e_stats = checke
+00055fd0: 645f 736c 6963 655f 7374 6174 730a 0a20  d_slice_stats.. 
+00055fe0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00055ff0: 2873 6c69 6365 5f73 7461 7473 2c20 6469  (slice_stats, di
+00056000: 6374 293a 0a20 2020 2020 2020 2072 6574  ct):.        ret
+00056010: 7572 6e20 736c 6963 655f 7374 6174 730a  urn slice_stats.
+00056020: 0a20 2020 2072 6574 7572 6e20 7b7d 0a    .    return {}.
```

### Comparing `scikit-rt-0.4.5/src/skrt/viewer/core.py` & `scikit-rt-0.4.6/src/skrt/viewer/core.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/src/skrt/viewer/viewer.py` & `scikit-rt-0.4.6/src/skrt/viewer/viewer.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_01_setup.py` & `scikit-rt-0.4.6/tests/test_01_setup.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_application.py` & `scikit-rt-0.4.6/tests/test_application.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_core.py` & `scikit-rt-0.4.6/tests/test_core.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_dose.py` & `scikit-rt-0.4.6/tests/test_dose.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_image.py` & `scikit-rt-0.4.6/tests/test_image.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_multi.py` & `scikit-rt-0.4.6/tests/test_multi.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_patient.py` & `scikit-rt-0.4.6/tests/test_patient.py`

 * *Files 6% similar despite different names*

```diff
@@ -207,24 +207,33 @@
 
 def test_null_patient():
     p = Patient()
     assert(type(p).__name__ == 'Patient')
     assert(p.id == '')
     assert(p.path == '')
     assert(p.studies == [])
+    assert(p.get_studies() == [])
+    assert(p.get_images() == [])
+    assert(p.get_structure_sets() == [])
+    assert(p.get_doses() == [])
+    assert(p.get_plans() == [])
 
 def test_null_study():
     s = Study()
     assert(type(s).__name__ == 'Study')
     assert(s.date == '')
     assert(s.files == [])
     assert(s.path == '')
     assert(s.subdir == '')
     assert(s.time == '')
     assert(s.timestamp == '')
+    assert(s.get_images() == [])
+    assert(s.get_structure_sets() == [])
+    assert(s.get_doses() == [])
+    assert(s.get_plans() == [])
 
 def test_unsorted_images():
     '''Test loading to patient object of unsorted DICOM images.'''
 
     # Create directory for patient data.
     pid = "test_patient2"
     pdir = Path("tmp")/pid
@@ -249,22 +258,24 @@
         im.write(pdir/str(idx), modality=modality, header_extras=header_extras)
 
     # Load images to Patient object.
     p = Patient(pdir, unsorted_dicom=True)
 
     # Check that there is a single study, then check its date and time.
     assert len(p.studies) == 1
-    s = p.studies[0]
+    s = p.get_studies()[0]
     assert s.study_instance_uid == study_instance_uid
     assert s.date == study_date
     assert s.time == study_time
 
     # Check that the number of images loaded is correct,
     # that they have the right modality, that the series numbers
     # are as expected, and that the image data can be loaded.
+    assert len(p.get_images()) == len(series_numbers)
+    assert len(s.get_images()) == len(series_numbers)
     series_numbers2 = []
     for key, images in s.image_types.items():
         assert key == modality.lower()
         assert len(images) == len(series_numbers)
         for image in images:
             series_number = image.get_dicom_dataset().SeriesNumber
             assert series_number in series_numbers
```

### Comparing `scikit-rt-0.4.5/tests/test_qv_image.py` & `scikit-rt-0.4.6/tests/test_qv_image.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_qv_quickviewer.py` & `scikit-rt-0.4.6/tests/test_qv_quickviewer.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_qv_struct_loader.py` & `scikit-rt-0.4.6/tests/test_qv_struct_loader.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_qv_struct_metrics.py` & `scikit-rt-0.4.6/tests/test_qv_struct_metrics.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_qv_structs.py` & `scikit-rt-0.4.6/tests/test_qv_structs.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_registration.py` & `scikit-rt-0.4.6/tests/test_registration.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_roi_metrics.py` & `scikit-rt-0.4.6/tests/test_roi_metrics.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_segmentation.py` & `scikit-rt-0.4.6/tests/test_segmentation.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_structs.py` & `scikit-rt-0.4.6/tests/test_structs.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_synthetic_image.py` & `scikit-rt-0.4.6/tests/test_synthetic_image.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.5/tests/test_viewer.py` & `scikit-rt-0.4.6/tests/test_viewer.py`

 * *Files identical despite different names*

