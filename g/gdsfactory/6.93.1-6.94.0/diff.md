# Comparing `tmp/gdsfactory-6.93.1.tar.gz` & `tmp/gdsfactory-6.94.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "gdsfactory-6.93.1.tar", last modified: Sat May 13 17:56:40 2023, max compression
+gzip compressed data, was "gdsfactory-6.94.0.tar", last modified: Fri Jan  1 00:00:00 2016, max compression
```

## Comparing `gdsfactory-6.93.1.tar` & `gdsfactory-6.94.0.tar`

### file list

```diff
@@ -1,694 +1,693 @@
--rw-r--r--   0        0        0     1072 2023-05-13 17:56:23.262048 gdsfactory-6.93.1/LICENSE
--rw-r--r--   0        0        0    14281 2023-05-13 17:56:23.262048 gdsfactory-6.93.1/README.md
--rw-r--r--   0        0        0     3415 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/__init__.py
--rw-r--r--   0        0        0     2096 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/add_keepout.py
--rw-r--r--   0        0        0    12629 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/add_labels.py
--rw-r--r--   0        0        0     3711 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/add_loopback.py
--rw-r--r--   0        0        0     5054 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/add_padding.py
--rw-r--r--   0        0        0    15465 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/add_pins.py
--rw-r--r--   0        0        0    14700 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/add_ports.py
--rw-r--r--   0        0        0     2884 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/add_tapers.py
--rw-r--r--   0        0        0     2257 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/add_tapers_cross_section.py
--rw-r--r--   0        0        0     1831 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/add_termination.py
--rw-r--r--   0        0        0     1676 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/asserts.py
--rw-r--r--   0        0        0    11843 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/cell.py
--rw-r--r--   0        0        0    15946 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/circuitviz.py
--rw-r--r--   0        0        0     5718 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/cli.py
--rw-r--r--   0        0        0   100602 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/component.py
--rw-r--r--   0        0        0    23360 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/component_layout.py
--rw-r--r--   0        0        0    29699 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/component_reference.py
--rw-r--r--   0        0        0     1205 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/C.py
--rw-r--r--   0        0        0     1144 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/L.py
--rw-r--r--   0        0        0    20964 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/__init__.py
--rw-r--r--   0        0        0     2621 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/add_fiducials.py
--rw-r--r--   0        0        0    14087 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/add_grating_couplers.py
--rw-r--r--   0        0        0     2014 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/add_trenches.py
--rw-r--r--   0        0        0     3207 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/align.py
--rw-r--r--   0        0        0     2622 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/array_component.py
--rw-r--r--   0        0        0     4705 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/array_with_fanout.py
--rw-r--r--   0        0        0     4322 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/array_with_via.py
--rw-r--r--   0        0        0     4042 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/awg.py
--rw-r--r--   0        0        0     1269 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/bbox.py
--rw-r--r--   0        0        0     2851 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/bend_circular.py
--rw-r--r--   0        0        0     2649 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/bend_circular_heater.py
--rw-r--r--   0        0        0     7903 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/bend_euler.py
--rw-r--r--   0        0        0     2682 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/bend_port.py
--rw-r--r--   0        0        0     3664 2023-05-13 17:56:23.270048 gdsfactory-6.93.1/gdsfactory/components/bend_s.py
--rw-r--r--   0        0        0     5373 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/bezier.py
--rw-r--r--   0        0        0     1605 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/cavity.py
--rw-r--r--   0        0        0     5766 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/cdc.py
--rw-r--r--   0        0        0     2929 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/cdsem_all.py
--rw-r--r--   0        0        0     1788 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/cdsem_bend180.py
--rw-r--r--   0        0        0     1631 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/cdsem_coupler.py
--rw-r--r--   0        0        0     1412 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/cdsem_straight.py
--rw-r--r--   0        0        0     1565 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/cdsem_straight_density.py
--rw-r--r--   0        0        0      793 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/circle.py
--rw-r--r--   0        0        0     5722 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/coh_rx_dual_pol.py
--rw-r--r--   0        0        0     8922 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/coh_rx_single_pol.py
--rw-r--r--   0        0        0     5043 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/coh_tx_dual_pol.py
--rw-r--r--   0        0        0     6118 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/coh_tx_single_pol.py
--rw-r--r--   0        0        0     2548 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/compass.py
--rw-r--r--   0        0        0     9856 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/component_lattice.py
--rw-r--r--   0        0        0     7174 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/component_sequence.py
--rw-r--r--   0        0        0      812 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/copy_layers.py
--rw-r--r--   0        0        0     3460 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/coupler.py
--rw-r--r--   0        0        0     2113 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/coupler90.py
--rw-r--r--   0        0        0     1802 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/coupler90bend.py
--rw-r--r--   0        0        0     4666 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/coupler_adiabatic.py
--rw-r--r--   0        0        0     1909 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/coupler_asymmetric.py
--rw-r--r--   0        0        0     3970 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/coupler_full.py
--rw-r--r--   0        0        0     3414 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/coupler_ring.py
--rw-r--r--   0        0        0     1060 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/coupler_straight.py
--rw-r--r--   0        0        0     1164 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/coupler_straight_asymmetric.py
--rw-r--r--   0        0        0     2192 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/coupler_symmetric.py
--rw-r--r--   0        0        0     1848 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/cross.py
--rw-r--r--   0        0        0    12873 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/crossing_waveguide.py
--rw-r--r--   0        0        0      500 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/csv_data/grating_coupler_1etch_h220_e70.csv
--rw-r--r--   0        0        0     1014 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv
--rw-r--r--   0        0        0    19749 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv
--rw-r--r--   0        0        0    19751 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv
--rw-r--r--   0        0        0    19749 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv
--rw-r--r--   0        0        0    19751 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv
--rw-r--r--   0        0        0    19775 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv
--rw-r--r--   0        0        0     3143 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv
--rw-r--r--   0        0        0     5272 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/cutback_2x2.py
--rw-r--r--   0        0        0     6450 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/cutback_bend.py
--rw-r--r--   0        0        0     3765 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/cutback_component.py
--rw-r--r--   0        0        0     2721 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/cutback_splitter.py
--rw-r--r--   0        0        0     2971 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/dbr.py
--rw-r--r--   0        0        0     4288 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/dbr_tapered.py
--rw-r--r--   0        0        0     2486 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/delay_snake.py
--rw-r--r--   0        0        0     3177 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/delay_snake2.py
--rw-r--r--   0        0        0     3237 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/delay_snake3.py
--rw-r--r--   0        0        0     4319 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/delay_snake_sbend.py
--rw-r--r--   0        0        0     1226 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/dicing_lane.py
--rw-r--r--   0        0        0     3471 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/die.py
--rw-r--r--   0        0        0     2975 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/die_bbox.py
--rw-r--r--   0        0        0     2863 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/die_bbox_frame.py
--rw-r--r--   0        0        0     8015 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/disk.py
--rw-r--r--   0        0        0     4112 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/edge_coupler_array.py
--rw-r--r--   0        0        0     1214 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/ellipse.py
--rw-r--r--   0        0        0     1800 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/extend_ports_list.py
--rw-r--r--   0        0        0     7944 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/extension.py
--rw-r--r--   0        0        0      981 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/fiber.py
--rw-r--r--   0        0        0     1432 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/fiber_array.py
--rw-r--r--   0        0        0      722 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/fiducial_squares.py
--rw-r--r--   0        0        0     3290 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/ge_detector_straight_si_contacts.py
--rw-r--r--   0        0        0     1063 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/grating_coupler_array.py
--rw-r--r--   0        0        0     4682 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/grating_coupler_dual_pol.py
--rw-r--r--   0        0        0     7110 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/grating_coupler_elliptical.py
--rw-r--r--   0        0        0     7221 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/grating_coupler_elliptical_arbitrary.py
--rw-r--r--   0        0        0     4960 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/grating_coupler_elliptical_lumerical.py
--rw-r--r--   0        0        0     4592 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/grating_coupler_elliptical_trenches.py
--rw-r--r--   0        0        0     1773 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/grating_coupler_functions.py
--rw-r--r--   0        0        0     9058 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/grating_coupler_loss.py
--rw-r--r--   0        0        0     1786 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/grating_coupler_loss_fiber_single.py
--rw-r--r--   0        0        0     4142 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/grating_coupler_rectangular.py
--rw-r--r--   0        0        0     4685 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/grating_coupler_rectangular_arbitrary.py
--rw-r--r--   0        0        0     3887 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py
--rw-r--r--   0        0        0     1578 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/grating_coupler_tree.py
--rw-r--r--   0        0        0     8773 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/greek_cross.py
--rw-r--r--   0        0        0     1019 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/hline.py
--rw-r--r--   0        0        0     3687 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/interdigital_capacitor.py
--rw-r--r--   0        0        0     1825 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/litho_calipers.py
--rw-r--r--   0        0        0     1244 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/litho_ruler.py
--rw-r--r--   0        0        0     1304 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/litho_steps.py
--rw-r--r--   0        0        0      650 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/logo.py
--rw-r--r--   0        0        0     1679 2023-05-13 17:56:23.274048 gdsfactory-6.93.1/gdsfactory/components/loop_mirror.py
--rw-r--r--   0        0        0     3873 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/mmi1x2.py
--rw-r--r--   0        0        0     2814 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/mmi1x2_with_sbend.py
--rw-r--r--   0        0        0     3858 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/mmi2x2.py
--rw-r--r--   0        0        0     3299 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/mmi2x2_with_sbend.py
--rw-r--r--   0        0        0     4947 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/mmi_90degree_hybrid.py
--rw-r--r--   0        0        0     3265 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/mode_converter.py
--rw-r--r--   0        0        0     7414 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/mzi.py
--rw-r--r--   0        0        0     2499 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/mzi_arm.py
--rw-r--r--   0        0        0     5835 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/mzi_arms.py
--rw-r--r--   0        0        0    12214 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/mzi_lattice.py
--rw-r--r--   0        0        0     4025 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/mzi_pads_center.py
--rw-r--r--   0        0        0     1064 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/mzi_phase_shifter.py
--rw-r--r--   0        0        0     6342 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/mzit.py
--rw-r--r--   0        0        0     3502 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/mzit_lattice.py
--rw-r--r--   0        0        0     6047 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/mzm.py
--rw-r--r--   0        0        0     3518 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/nxn.py
--rw-r--r--   0        0        0     1940 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/optimal_90deg.py
--rw-r--r--   0        0        0     3876 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/optimal_hairpin.py
--rw-r--r--   0        0        0     6131 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/optimal_step.py
--rw-r--r--   0        0        0     6327 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/pack_doe.py
--rw-r--r--   0        0        0     3860 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/pad.py
--rw-r--r--   0        0        0     1890 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/pad_gsg.py
--rw-r--r--   0        0        0     1157 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/pads_shorted.py
--rw-r--r--   0        0        0     3833 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/polarization_splitter_rotator.py
--rw-r--r--   0        0        0     1147 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/ramp.py
--rw-r--r--   0        0        0     1508 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/rectangle.py
--rw-r--r--   0        0        0     2972 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/rectangle_with_slits.py
--rw-r--r--   0        0        0     1508 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/regular_polygon.py
--rw-r--r--   0        0        0     3302 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/resistance_meander.py
--rw-r--r--   0        0        0     2642 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/resistance_sheet.py
--rw-r--r--   0        0        0     1273 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/ring.py
--rw-r--r--   0        0        0     4143 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/ring_crow.py
--rw-r--r--   0        0        0     3272 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/ring_crow_couplers.py
--rw-r--r--   0        0        0     2267 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/ring_double.py
--rw-r--r--   0        0        0     3846 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/ring_double_heater.py
--rw-r--r--   0        0        0     7757 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/ring_double_pn.py
--rw-r--r--   0        0        0    12137 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/ring_section_based.py
--rw-r--r--   0        0        0     2719 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/ring_single.py
--rw-r--r--   0        0        0     1968 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/ring_single_array.py
--rw-r--r--   0        0        0     6098 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/ring_single_bend_coupler.py
--rw-r--r--   0        0        0     2714 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/ring_single_dut.py
--rw-r--r--   0        0        0     4018 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/ring_single_heater.py
--rw-r--r--   0        0        0     5267 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/ring_single_pn.py
--rw-r--r--   0        0        0     2282 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/seal_ring.py
--rw-r--r--   0        0        0     3758 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/snspd.py
--rw-r--r--   0        0        0     2059 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/spiral_double.py
--rw-r--r--   0        0        0     5871 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/spiral_external_io.py
--rw-r--r--   0        0        0    16658 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/spiral_heater.py
--rw-r--r--   0        0        0     9181 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/spiral_inner_io.py
--rw-r--r--   0        0        0     1754 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/splitter_chain.py
--rw-r--r--   0        0        0     5327 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/splitter_tree.py
--rw-r--r--   0        0        0     2526 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/straight.py
--rw-r--r--   0        0        0     1033 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/straight_array.py
--rw-r--r--   0        0        0     7914 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/straight_heater_doped_rib.py
--rw-r--r--   0        0        0     1922 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/straight_heater_doped_strip.py
--rw-r--r--   0        0        0     7891 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/straight_heater_meander.py
--rw-r--r--   0        0        0     8090 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/straight_heater_meander_doped.py
--rw-r--r--   0        0        0     5686 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/straight_heater_metal.py
--rw-r--r--   0        0        0     2809 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/straight_pin.py
--rw-r--r--   0        0        0     3974 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/straight_pin_slot.py
--rw-r--r--   0        0        0      655 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/straight_rib.py
--rw-r--r--   0        0        0      820 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/switch_tree.py
--rw-r--r--   0        0        0     7713 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/taper.py
--rw-r--r--   0        0        0     3530 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/taper_adiabatic.py
--rw-r--r--   0        0        0     2457 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/taper_cross_section.py
--rw-r--r--   0        0        0     2363 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/taper_from_csv.py
--rw-r--r--   0        0        0     1215 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/taper_parabolic.py
--rw-r--r--   0        0        0     1635 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/terminator.py
--rw-r--r--   0        0        0     2913 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/text.py
--rw-r--r--   0        0        0     3821 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/text_freetype.py
--rw-r--r--   0        0        0     3160 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/text_rectangular.py
--rw-r--r--   0        0        0     3943 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/text_rectangular_font.py
--rw-r--r--   0        0        0     2536 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/triangles.py
--rw-r--r--   0        0        0      715 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/verniers.py
--rw-r--r--   0        0        0     2468 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/version_stamp.py
--rw-r--r--   0        0        0     2436 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/via.py
--rw-r--r--   0        0        0     3060 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/via_corner.py
--rw-r--r--   0        0        0     5342 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/via_cutback.py
--rw-r--r--   0        0        0    15574 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/via_stack.py
--rw-r--r--   0        0        0     4420 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/via_stack_slot.py
--rw-r--r--   0        0        0     4944 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/via_stack_with_offset.py
--rw-r--r--   0        0        0     1088 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/wafer.py
--rw-r--r--   0        0        0     2542 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/wire.py
--rw-r--r--   0        0        0      978 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/components/wire_sbend.py
--rw-r--r--   0        0        0     7978 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/config.py
--rw-r--r--   0        0        0      481 2023-05-13 17:56:23.278048 gdsfactory-6.93.1/gdsfactory/conftest.py
--rw-r--r--   0        0        0    38409 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/constants.py
--rw-r--r--   0        0        0     1476 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/containers.py
--rw-r--r--   0        0        0    82607 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/cross_section.py
--rw-r--r--   0        0        0     2974 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/decorators.py
--rw-r--r--   0        0        0     7312 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/difftest.py
--rw-r--r--   0        0        0      988 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/events.py
--rw-r--r--   0        0        0      204 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/export/__init__.py
--rw-r--r--   0        0        0     3353 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/export/to_3d.py
--rw-r--r--   0        0        0     1940 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/export/to_np.py
--rw-r--r--   0        0        0     3058 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/export/to_stl.py
--rw-r--r--   0        0        0     7438 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/export/write_gerbers.py
--rw-r--r--   0        0        0     2968 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/filestorage.py
--rw-r--r--   0        0        0    11860 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/fill.py
--rw-r--r--   0        0        0     7799 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/font.py
--rw-r--r--   0        0        0     8073 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/functions.py
--rw-r--r--   0        0        0       20 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/gdsdiff/.gitattributes
--rw-r--r--   0        0        0       83 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/gdsdiff/.gitconfig
--rw-r--r--   0        0        0       72 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/gdsdiff/__init__.py
--rw-r--r--   0        0        0     1069 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/gdsdiff/gds_diff_git.py
--rw-r--r--   0        0        0     2935 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/gdsdiff/gdsdiff.py
--rw-r--r--   0        0        0      708 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/gdsdiff/install.py
--rw-r--r--   0        0        0      271 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/gdsdiff/sample.py
--rw-r--r--   0        0        0     1059 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/gdsdiff/test_xor.py
--rw-r--r--   0        0        0     1100 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/README.md
--rw-r--r--   0        0        0     1722 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/__init__.py
--rw-r--r--   0        0        0      169 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/generic_tech.sh
--rw-r--r--   0        0        0     8142 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/get_klayout_pyxs.py
--rw-r--r--   0        0        0       44 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/README.md
--rw-r--r--   0        0        0      104 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/drc/Makefile
--rw-r--r--   0        0        0        0 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/drc/__init__.py
--rw-r--r--   0        0        0     2842 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/drc/errors.py
--rw-r--r--   0        0        0      579 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/drc/generic.drc
--rw-r--r--   0        0        0     2929 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/drc/generic.lydrc
--rw-r--r--   0        0        0     1014 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/drc/write_drc.py
--rw-r--r--   0        0        0     6193 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/grain.xml
--rw-r--r--   0        0        0    10140 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/icon_128x128.png
--rw-r--r--   0        0        0     4248 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/icon_64x64.png
--rw-r--r--   0        0        0       27 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/.gitignore
--rw-r--r--   0        0        0      494 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/Makefile
--rw-r--r--   0        0        0     4062 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/README.md
--rw-r--r--   0        0        0     2419 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md
--rw-r--r--   0        0        0     9696 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc
--rw-r--r--   0        0        0    12347 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py
--rw-r--r--   0        0        0     7540 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs
--rw-r--r--   0        0        0     3446 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs
--rw-r--r--   0        0        0      479 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/devices_connections.lvs
--rw-r--r--   0        0        0      582 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs
--rw-r--r--   0        0        0      108 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_derivations.lvs
--rw-r--r--   0        0        0      186 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_connections.lvs
--rw-r--r--   0        0        0      398 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_derivations.lvs
--rw-r--r--   0        0        0      574 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs
--rw-r--r--   0        0        0     6034 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs
--rw-r--r--   0        0        0    12078 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/run_lvs.py
--rw-r--r--   0        0        0      477 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/testing/testcases/README.md
--rw-r--r--   0        0        0     2831 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py
--rw-r--r--   0        0        0      925 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice
--rw-r--r--   0        0        0    10945 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym
--rw-r--r--   0        0        0      710 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym
--rw-r--r--   0        0        0      538 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym
--rw-r--r--   0        0        0        0 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/python/__init__.py
--rw-r--r--   0        0        0      114 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/python/kgdsfactory/__init__.py
--rw-r--r--   0        0        0     4303 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py
--rw-r--r--   0        0        0      269 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/Makefile
--rw-r--r--   0        0        0     1854 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25
--rw-r--r--   0        0        0     1519 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/generic.layerstack
--rw-r--r--   0        0        0    40616 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp
--rw-r--r--   0        0        0    40616 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/layers.lyp
--rw-r--r--   0        0        0     5977 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/tech.lyt
--rw-r--r--   0        0        0     4258 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs
--rw-r--r--   0        0        0     4537 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs
--rw-r--r--   0        0        0     4690 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs
--rw-r--r--   0        0        0     5508 2023-05-13 17:56:23.282049 gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs
--rw-r--r--   0        0        0     1855 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/generic_tech/layer_map.py
--rw-r--r--   0        0        0     6511 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/generic_tech/layer_stack.py
--rw-r--r--   0        0        0    10666 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/generic_tech/layer_views.yaml
--rw-r--r--   0        0        0      158 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/generic_tech/simulation_settings.py
--rw-r--r--   0        0        0     1431 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/__init__.py
--rw-r--r--   0        0        0     4917 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/boolean.py
--rw-r--r--   0        0        0     3814 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/boolean_klayout.py
--rw-r--r--   0        0        0     1904 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/boolean_polygons.py
--rw-r--r--   0        0        0      598 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/check_duplicated_cells.py
--rw-r--r--   0        0        0     2719 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/check_exclusion.py
--rw-r--r--   0        0        0     2829 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/check_inclusion.py
--rw-r--r--   0        0        0     3566 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/check_space.py
--rw-r--r--   0        0        0     1904 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/check_width.py
--rw-r--r--   0        0        0     5005 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/fill_klayout.py
--rw-r--r--   0        0        0     7084 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/fill_tiled.py
--rw-r--r--   0        0        0     1697 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/fillet.py
--rw-r--r--   0        0        0     6664 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/functions.py
--rw-r--r--   0        0        0     2167 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/invert.py
--rw-r--r--   0        0        0     3685 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/layer_priority.py
--rw-r--r--   0        0        0     3046 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/manhattanize.py
--rw-r--r--   0        0        0     4192 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/maskprep.py
--rw-r--r--   0        0        0     4744 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/maskprep_flat.py
--rw-r--r--   0        0        0     3250 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/offset.py
--rw-r--r--   0        0        0     3842 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/outline.py
--rw-r--r--   0        0        0     2510 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/trim.py
--rw-r--r--   0        0        0     2948 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/union.py
--rw-r--r--   0        0        0     9629 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/write_drc.py
--rw-r--r--   0        0        0     1783 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/geometry/xor_diff.py
--rw-r--r--   0        0        0     1158 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/get_factories.py
--rw-r--r--   0        0        0    23561 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/get_netlist.py
--rw-r--r--   0        0        0    14426 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/get_netlist_flat.py
--rw-r--r--   0        0        0      682 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/get_netlist_klayout.py
--rw-r--r--   0        0        0     9745 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/grid.py
--rw-r--r--   0        0        0     4363 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/install.py
--rw-r--r--   0        0        0     1970 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/klive.py
--rw-r--r--   0        0        0      585 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/labels/__init__.py
--rw-r--r--   0        0        0     3563 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/labels/add_label_yaml.py
--rw-r--r--   0        0        0     3847 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/labels/ehva.py
--rw-r--r--   0        0        0     3810 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/labels/merge_test_metadata.py
--rw-r--r--   0        0        0     4668 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/labels/siepic.py
--rw-r--r--   0        0        0     4847 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/labels/write_labels.py
--rw-r--r--   0        0        0     1149 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/materials.py
--rw-r--r--   0        0        0     5247 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/name.py
--rw-r--r--   0        0        0    11586 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/pack.py
--rw-r--r--   0        0        0    50880 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/path.py
--rw-r--r--   0        0        0    25849 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/pdk.py
--rw-r--r--   0        0        0     6170 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/picmodel.py
--rw-r--r--   0        0        0     5068 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/pixelate.py
--rw-r--r--   0        0        0        0 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/plugins/dagster/__init__.py
--rw-r--r--   0        0        0      976 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/plugins/dagster/workflow.py
--rw-r--r--   0        0        0      566 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/plugins/database/README.md
--rw-r--r--   0        0        0        0 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/plugins/database/__init__.py
--rw-r--r--   0        0        0     6216 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/plugins/database/db_upload.py
--rw-r--r--   0        0        0    16143 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/plugins/database/models.py
--rw-r--r--   0        0        0       32 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/plugins/web/Makefile
--rw-r--r--   0        0        0       23 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/plugins/web/__init__.py
--rw-r--r--   0        0        0     4080 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/plugins/web/main.py
--rwxr-xr-x   0        0        0     7379 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/plugins/web/server.py
--rwxr-xr-x   0        0        0      594 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/plugins/web/server_jupyter.py
--rw-r--r--   0        0        0     1299 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/plugins/web/static/client.css
--rw-r--r--   0        0        0    32209 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/port.py
--rw-r--r--   0        0        0    37609 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/quickplotter.py
--rw-r--r--   0        0        0      696 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/read/__init__.py
--rw-r--r--   0        0        0     1639 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/read/from_dphox.py
--rw-r--r--   0        0        0     1285 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/read/from_gdspaths.py
--rw-r--r--   0        0        0     1953 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/read/from_np.py
--rw-r--r--   0        0        0     2813 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/read/from_phidl.py
--rw-r--r--   0        0        0    38082 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/read/from_yaml.py
--rw-r--r--   0        0        0     5897 2023-05-13 17:56:23.286049 gdsfactory-6.93.1/gdsfactory/read/from_yaml_template.py
--rw-r--r--   0        0        0     5688 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/read/import_gds.py
--rw-r--r--   0        0        0     3407 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/read/labels.py
--rw-r--r--   0        0        0     3769 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/__init__.py
--rw-r--r--   0        0        0     2920 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/add_electrical_pads_shortest.py
--rw-r--r--   0        0        0     3015 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/add_electrical_pads_top.py
--rw-r--r--   0        0        0     3035 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/add_electrical_pads_top_dc.py
--rw-r--r--   0        0        0     8715 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/add_fiber_array.py
--rw-r--r--   0        0        0    10624 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/add_fiber_single.py
--rw-r--r--   0        0        0     8967 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/add_pads.py
--rw-r--r--   0        0        0    38940 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/all_angle.py
--rw-r--r--   0        0        0     3916 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/auto_taper.py
--rw-r--r--   0        0        0      982 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/factories.py
--rw-r--r--   0        0        0     4415 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/fanout.py
--rw-r--r--   0        0        0     2800 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/fanout2x2.py
--rw-r--r--   0        0        0    24342 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/get_bundle.py
--rw-r--r--   0        0        0     8632 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/get_bundle_corner.py
--rw-r--r--   0        0        0     6900 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/get_bundle_from_steps.py
--rw-r--r--   0        0        0    12949 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/get_bundle_from_waypoints.py
--rw-r--r--   0        0        0     5284 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/get_bundle_path_length_match.py
--rw-r--r--   0        0        0     1937 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/get_bundle_sbend.py
--rw-r--r--   0        0        0    17064 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/get_bundle_u.py
--rw-r--r--   0        0        0     1510 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/get_input_labels.py
--rw-r--r--   0        0        0     9233 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/get_route.py
--rw-r--r--   0        0        0    10824 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/get_route_astar.py
--rw-r--r--   0        0        0     6119 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/get_route_from_steps.py
--rw-r--r--   0        0        0     2766 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/get_route_sbend.py
--rw-r--r--   0        0        0     3311 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/get_routes_bend180.py
--rw-r--r--   0        0        0     1854 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/get_routes_straight.py
--rw-r--r--   0        0        0    34394 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/manhattan.py
--rw-r--r--   0        0        0    10081 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/path_length_matching.py
--rw-r--r--   0        0        0    22568 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/route_fiber_array.py
--rw-r--r--   0        0        0     8679 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/route_fiber_single.py
--rw-r--r--   0        0        0    18132 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/route_ports_to_side.py
--rw-r--r--   0        0        0     4361 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/route_quad.py
--rw-r--r--   0        0        0    14370 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/route_sharp.py
--rw-r--r--   0        0        0    10167 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/route_south.py
--rw-r--r--   0        0        0     5072 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/sort_ports.py
--rw-r--r--   0        0        0     2477 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/routing/utils.py
--rw-r--r--   0        0        0     2889 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/01_component_pcell.py
--rw-r--r--   0        0        0      646 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/01_component_pcell/test_straight_wide.yml
--rw-r--r--   0        0        0     1101 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/01_component_pcell_with_pins.py
--rw-r--r--   0        0        0      664 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml
--rw-r--r--   0        0        0      347 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/02_component_autoname.py
--rw-r--r--   0        0        0      887 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/03_move.py
--rw-r--r--   0        0        0      881 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/04_connect.py
--rw-r--r--   0        0        0      710 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/05_remove_layers.py
--rw-r--r--   0        0        0      931 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/06_remapping_layers.py
--rw-r--r--   0        0        0     1082 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/07_flattening_device.py
--rw-r--r--   0        0        0      475 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/08_group.py
--rw-r--r--   0        0        0     1631 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/11_component_layout.py
--rw-r--r--   0        0        0     2245 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/12_component_refs.py
--rw-r--r--   0        0        0      955 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/13_component_netlist.py
--rw-r--r--   0        0        0     2592 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/14_component_connectivity.py
--rw-r--r--   0        0        0     1636 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/15_component_sequence1.py
--rw-r--r--   0        0        0     1680 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/16_component_sequence2.py
--rw-r--r--   0        0        0      965 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/17_ports.py
--rw-r--r--   0        0        0      489 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/18_port_markers.py
--rw-r--r--   0        0        0      361 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/19_references.py
--rw-r--r--   0        0        0      533 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/20_components.py
--rw-r--r--   0        0        0      507 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/21_add_fiber_array.py
--rw-r--r--   0        0        0      493 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/22_add_fiber_single.py
--rw-r--r--   0        0        0      569 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/22_add_pads.py
--rw-r--r--   0        0        0      848 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/23_reticle.py
--rw-r--r--   0        0        0     1588 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/23_reticle_passives.py
--rw-r--r--   0        0        0      457 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/24_doe.py
--rw-r--r--   0        0        0      687 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/24_doe_2.py
--rw-r--r--   0        0        0      692 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/24_doe_3.py
--rw-r--r--   0        0        0      306 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/25_slot_cross_section.py
--rw-r--r--   0        0        0     1363 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/30_lidar.py
--rw-r--r--   0        0        0     1412 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/30_lidar_pcell.py
--rw-r--r--   0        0        0     1943 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/30_lidar_with_pads.py
--rw-r--r--   0        0        0        0 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/__init__.py
--rw-r--r--   0        0        0     1307 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing.py
--rw-r--r--   0        0        0      558 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml
--rw-r--r--   0        0        0     6062 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml
--rw-r--r--   0        0        0      444 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_error_intermediate_180.pic.yml
--rw-r--r--   0        0        0      463 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_error_overconstrained.pic.yml
--rw-r--r--   0        0        0     1552 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml
--rw-r--r--   0        0        0     1315 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml
--rw-r--r--   0        0        0      602 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml
--rw-r--r--   0        0        0     3317 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml
--rw-r--r--   0        0        0     1484 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml
--rw-r--r--   0        0        0     3045 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml
--rw-r--r--   0        0        0     3782 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml
--rw-r--r--   0        0        0     1988 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/big_device.py
--rw-r--r--   0        0        0       19 2023-05-13 17:56:23.290049 gdsfactory-6.93.1/gdsfactory/samples/demo/Makefile
--rw-r--r--   0        0        0        0 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/demo/__init__.py
--rw-r--r--   0        0        0     1129 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/demo/benchmark/fill_demo.py
--rw-r--r--   0        0        0      343 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/demo/benchmark/snap_demo_phidl.py
--rw-r--r--   0        0        0      637 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/demo/circuits/mask.pic.yml
--rw-r--r--   0        0        0      622 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml
--rw-r--r--   0        0        0      569 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml
--rw-r--r--   0        0        0      453 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/demo/circuits/pads.pic.yml
--rw-r--r--   0        0        0      287 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/demo/circuits/rectangles.pic.yml
--rw-r--r--   0        0        0     2260 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/demo/drc_errors.py
--rw-r--r--   0        0        0     1014 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/demo/drc_write.py
--rw-r--r--   0        0        0     4530 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/demo/layers.py
--rw-r--r--   0        0        0      158 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/demo/layers_sky130.py
--rw-r--r--   0        0        0      364 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/demo/layers_xsection.py
--rw-r--r--   0        0        0     1062 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/demo/lvs.py
--rw-r--r--   0        0        0      574 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/demo/pcell.py
--rw-r--r--   0        0        0     4174 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/netlists/mzi.yml
--rw-r--r--   0        0        0     5840 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/netlists/mzi_full.yml
--rw-r--r--   0        0        0        0 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/__init__.py
--rw-r--r--   0        0        0     4235 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/fab_c.py
--rw-r--r--   0        0        0      475 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/fab_d/__init__.py
--rw-r--r--   0        0        0     1880 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/fab_d/phase_shifters.py
--rw-r--r--   0        0        0     1715 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c.py
--rw-r--r--   0        0        0       50 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_ports_bend_euler_c_.csv
--rw-r--r--   0        0        0       93 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_ports_gc_nitride_c_.csv
--rw-r--r--   0        0        0       85 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_c_.csv
--rw-r--r--   0        0        0      139 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_o_.csv
--rw-r--r--   0        0        0       90 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_c_.csv
--rw-r--r--   0        0        0      126 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_o_.csv
--rw-r--r--   0        0        0       48 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_ports_straight_c_.csv
--rw-r--r--   0        0        0     1023 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml
--rw-r--r--   0        0        0     2100 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml
--rw-r--r--   0        0        0     1839 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml
--rw-r--r--   0        0        0     1283 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml
--rw-r--r--   0        0        0     1592 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml
--rw-r--r--   0        0        0     1061 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml
--rw-r--r--   0        0        0     1054 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml
--rw-r--r--   0        0        0     1577 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml
--rw-r--r--   0        0        0     4313 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml
--rw-r--r--   0        0        0     3625 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml
--rw-r--r--   0        0        0     3603 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml
--rw-r--r--   0        0        0     4271 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml
--rw-r--r--   0        0        0      840 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml
--rw-r--r--   0        0        0     2171 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml
--rw-r--r--   0        0        0      316 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/schematic.py
--rw-r--r--   0        0        0    17692 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/schematic_editor.py
--rw-r--r--   0        0        0     4194 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/serialization.py
--rw-r--r--   0        0        0     1612 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/show.py
--rw-r--r--   0        0        0      724 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/__init__.py
--rw-r--r--   0        0        0     4369 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/add_simulation_markers.py
--rw-r--r--   0        0        0     2476 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/convert_sparameters.py
--rw-r--r--   0        0        0      547 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/devsim/__init__.py
--rw-r--r--   0        0        0     2559 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/devsim/doping.py
--rw-r--r--   0        0        0    11977 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/devsim/get_simulation.py
--rw-r--r--   0        0        0    23665 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/devsim/get_simulation_xsection.py
--rw-r--r--   0        0        0    19708 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/devsim/get_solver.py
--rw-r--r--   0        0        0     1636 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/devsim/test_devsim.py
--rw-r--r--   0        0        0      189 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/disable_print.py
--rw-r--r--   0        0        0       79 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/eme/__init__.py
--rw-r--r--   0        0        0    14784 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/eme/meow_eme.py
--rw-r--r--   0        0        0     1771 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/eme/test_meow_simulation.py
--rw-r--r--   0        0        0        0 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/fem/__init__.py
--rw-r--r--   0        0        0     8968 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/fem/mode_solver.py
--rw-r--r--   0        0        0     2205 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/fem/test_mode_solver.py
--rw-r--r--   0        0        0     3447 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/get_effective_indices.py
--rw-r--r--   0        0        0     3109 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/get_modes_path.py
--rw-r--r--   0        0        0     3888 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/get_sparameters_path.py
--rw-r--r--   0        0        0     2003 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/__init__.py
--rw-r--r--   0        0        0     3194 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/get_material.py
--rw-r--r--   0        0        0     6137 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/get_meep_geometry.py
--rw-r--r--   0        0        0     6054 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/get_port_eigenmode.py
--rw-r--r--   0        0        0    11014 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/get_simulation.py
--rw-r--r--   0        0        0    15915 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/get_simulation_grating_farfield.py
--rw-r--r--   0        0        0    18182 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/get_simulation_grating_fiber.py
--rw-r--r--   0        0        0    12302 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/meep_adjoint_optimization.py
--rw-r--r--   0        0        0    11914 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_eigenmode.py
--rw-r--r--   0        0        0      832 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_materials.py
--rw-r--r--   0        0        0    10128 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_crossing.csv
--rw-r--r--   0        0        0    10128 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_straight.csv
--rw-r--r--   0        0        0     6642 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep.py
--rw-r--r--   0        0        0    10128 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_crossing.csv
--rw-r--r--   0        0        0    10128 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_straight.csv
--rw-r--r--   0        0        0    10093 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_symmetries_straight.csv
--rw-r--r--   0        0        0    10085 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi.csv
--rw-r--r--   0        0        0    10085 2023-05-13 17:56:23.294049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi_pool.csv
--rw-r--r--   0        0        0    34701 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_crossing_symmetric.csv
--rw-r--r--   0        0        0    10123 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight.csv
--rw-r--r--   0        0        0     9966 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_batch.csv
--rw-r--r--   0        0        0     9966 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi.csv
--rw-r--r--   0        0        0    10085 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi_pool.csv
--rw-r--r--   0        0        0    10129 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_symmetric.csv
--rw-r--r--   0        0        0    14053 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/write_sparameters_grating.py
--rw-r--r--   0        0        0    21281 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/write_sparameters_meep.py
--rw-r--r--   0        0        0     8143 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/write_sparameters_meep_batch.py
--rw-r--r--   0        0        0     9577 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmeep/write_sparameters_meep_mpi.py
--rw-r--r--   0        0        0     1246 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmsh/__init__.py
--rw-r--r--   0        0        0     6653 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmsh/break_geometry.py
--rw-r--r--   0        0        0    11250 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmsh/mesh.py
--rw-r--r--   0        0        0    11808 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmsh/meshtracker.py
--rw-r--r--   0        0        0     7752 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmsh/parse_component.py
--rw-r--r--   0        0        0     3644 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmsh/parse_gds.py
--rw-r--r--   0        0        0     3605 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmsh/parse_layerstack.py
--rw-r--r--   0        0        0     2990 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmsh/refine.py
--rw-r--r--   0        0        0    10851 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmsh/scratch/mesh3D.py
--rw-r--r--   0        0        0     2489 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmsh/tests/test_meshing.py
--rw-r--r--   0        0        0    14168 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmsh/uz_xsection_mesh.py
--rw-r--r--   0        0        0     7441 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmsh/xy_xsection_mesh.py
--rw-r--r--   0        0        0    16326 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gmsh/xyz_mesh.py
--rw-r--r--   0        0        0     1624 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/__init__.py
--rw-r--r--   0        0        0     4368 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/get_results.py
--rw-r--r--   0        0        0    20009 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/get_simulation.py
--rw-r--r--   0        0        0    21071 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/get_simulation_grating_coupler.py
--rw-r--r--   0        0        0     2821 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/materials.py
--rw-r--r--   0        0        0    26362 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/modes.py
--rw-r--r--   0        0        0     8941 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/sim_run.yaml
--rw-r--r--   0        0        0     8114 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/sim_ref.yaml
--rw-r--r--   0        0        0     8114 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/sim_run.yaml
--rw-r--r--   0        0        0      728 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/test_modes.py
--rw-r--r--   0        0        0      262 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/test_modes/test_sweep_width.csv
--rw-r--r--   0        0        0      879 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/test_results.py
--rw-r--r--   0        0        0     1505 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/test_simulation.py
--rw-r--r--   0        0        0     1270 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters.py
--rw-r--r--   0        0        0     9297 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters/test_sparameters_straight.csv
--rw-r--r--   0        0        0     1732 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters_grating_coupler.py
--rw-r--r--   0        0        0     1224 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/utils.py
--rw-r--r--   0        0        0    10515 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/write_sparameters.py
--rw-r--r--   0        0        0     7695 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/write_sparameters_grating_coupler.py
--rw-r--r--   0        0        0      588 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/lumerical/__init__.py
--rw-r--r--   0        0        0    16011 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/lumerical/interconnect.py
--rw-r--r--   0        0        0     4286 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/lumerical/read.py
--rw-r--r--   0        0        0     3569 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/lumerical/settings.py
--rw-r--r--   0        0        0     2348 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/lumerical/test_read_sparameters.py
--rw-r--r--   0        0        0    19865 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/lumerical/write_sparameters_lumerical.py
--rw-r--r--   0        0        0     1504 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/lumerical/write_sparameters_lumerical_components.py
--rw-r--r--   0        0        0      932 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/modes/__init__.py
--rw-r--r--   0        0        0     1618 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/modes/coupler.py
--rw-r--r--   0        0        0     4166 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/modes/find_coupling_vs_gap.py
--rw-r--r--   0        0        0     2773 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/modes/find_mode_dispersion.py
--rw-r--r--   0        0        0     8924 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/modes/find_modes.py
--rwxr-xr-x   0        0        0     7032 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/modes/find_modes_cross_section.py
--rw-r--r--   0        0        0     4458 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/modes/find_neff_ng_dw_dh.py
--rw-r--r--   0        0        0     2728 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/modes/find_neff_vs_width.py
--rw-r--r--   0        0        0     7138 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/modes/get_mode_solver_coupler.py
--rwxr-xr-x   0        0        0     4462 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/modes/get_mode_solver_cross_section.py
--rw-r--r--   0        0        0     5411 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/modes/get_mode_solver_rib.py
--rw-r--r--   0        0        0     1110 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/modes/modes/neff_vs_width_nitride.csv
--rw-r--r--   0        0        0     1102 2023-05-13 17:56:23.298049 gdsfactory-6.93.1/gdsfactory/simulation/modes/modes/neff_vs_width_rib.csv
--rw-r--r--   0        0        0     1110 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/modes/modes/neff_vs_width_strip.csv
--rw-r--r--   0        0        0     8023 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/modes/neff_convergence_test.py
--rw-r--r--   0        0        0      267 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/modes/neff_vs_width.csv
--rw-r--r--   0        0        0     2469 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/modes/overlap.py
--rw-r--r--   0        0        0      418 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/modes/tests/test_dw_dh.py
--rw-r--r--   0        0        0       83 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh.csv
--rw-r--r--   0        0        0      548 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh_dispersion.csv
--rw-r--r--   0        0        0     1137 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/modes/tests/test_find_modes.py
--rw-r--r--   0        0        0      649 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/modes/tests/test_find_modes_dispersion.py
--rw-r--r--   0        0        0      354 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/modes/tests/test_neff_vs_width.py
--rw-r--r--   0        0        0      113 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/modes/tests/test_neff_vs_width/test_neff_vs_width.csv
--rw-r--r--   0        0        0    15492 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/modes/types.py
--rw-r--r--   0        0        0     1169 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/modes/waveguide.py
--rw-r--r--   0        0        0     2013 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/photonic_circuit_models/__init__.py
--rw-r--r--   0        0        0      597 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/photonic_circuit_models/coupler.py
--rw-r--r--   0        0        0      377 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/photonic_circuit_models/fsr.py
--rw-r--r--   0        0        0      418 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/photonic_circuit_models/heater.py
--rw-r--r--   0        0        0     3069 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/photonic_circuit_models/mzi.py
--rw-r--r--   0        0        0     2616 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/photonic_circuit_models/ring.py
--rw-r--r--   0        0        0     7332 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/plot.py
--rw-r--r--   0        0        0     2480 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/plot_csv.py
--rw-r--r--   0        0        0      703 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/port_symmetries.py
--rw-r--r--   0        0        0     4637 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/process/diffusion.py
--rw-r--r--   0        0        0     5317 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/process/implant_tables.py
--rw-r--r--   0        0        0     6784 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/process/pysrim.py
--rw-r--r--   0        0        0     2182 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/process/silicon.py
--rw-r--r--   0        0        0     1861 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/process/skew/antimony_si_skew.csv
--rw-r--r--   0        0        0     1050 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/process/skew/arsenic_si_skew.csv
--rw-r--r--   0        0        0     1468 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/process/skew/boron_si_skew.csv
--rw-r--r--   0        0        0     1118 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/process/skew/phosphorus_si_skew.csv
--rw-r--r--   0        0        0      191 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sax/__init__.py
--rw-r--r--   0        0        0    14792 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sax/build_model.py
--rw-r--r--   0        0        0     7449 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sax/femwell_waveguide_model.py
--rw-r--r--   0        0        0     1571 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sax/interpolators.py
--rw-r--r--   0        0        0     6755 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sax/meep_FDTD_model.py
--rw-r--r--   0        0        0     4528 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sax/meow_eme_model.py
--rw-r--r--   0        0        0     5613 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sax/mlp.py
--rw-r--r--   0        0        0     7358 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sax/models.py
--rw-r--r--   0        0        0    13884 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sax/parameter.py
--rwxr-xr-x   0        0        0     2205 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sax/plot_model.py
--rw-r--r--   0        0        0     6805 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sax/read.py
--rw-r--r--   0        0        0     1350 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sax/tests/test_mzi.py
--rw-r--r--   0        0        0     2220 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sax/tests/test_mzi_lattice.py
--rw-r--r--   0        0        0     1397 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sax/tests/test_parameters.py
--rw-r--r--   0        0        0     1357 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/__init__.py
--rw-r--r--   0        0        0     1573 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/add_gc.py
--rw-r--r--   0        0        0     3383 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/circuit.py
--rw-r--r--   0        0        0      891 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/__init__.py
--rw-r--r--   0        0        0     1295 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/bend_circular.py
--rw-r--r--   0        0        0     1388 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/bend_euler.py
--rw-r--r--   0        0        0     2560 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/coupler.py
--rw-r--r--   0        0        0     1046 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/coupler_fdtd.py
--rw-r--r--   0        0        0     1848 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/coupler_ring.py
--rw-r--r--   0        0        0     1329 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/coupler_ring_fdtd.py
--rw-r--r--   0        0        0      589 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/coupler_ring_siepic.py
--rw-r--r--   0        0        0      913 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/gc.py
--rw-r--r--   0        0        0     2032 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/mmi1x2.py
--rw-r--r--   0        0        0     1910 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/mmi2x2.py
--rw-r--r--   0        0        0     2618 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/mzi.py
--rw-r--r--   0        0        0     1759 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/mzi_siepic.py
--rw-r--r--   0        0        0      487 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/mzi_thermal.py
--rw-r--r--   0        0        0     2597 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/ring_double.py
--rw-r--r--   0        0        0     1665 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/ring_double_siepic.py
--rw-r--r--   0        0        0     1782 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/ring_single.py
--rw-r--r--   0        0        0     1416 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/ring_single_siepic.py
--rw-r--r--   0        0        0     1099 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/straight.py
--rw-r--r--   0        0        0      800 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/get_transmission.py
--rw-r--r--   0        0        0     2516 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/model_from_gdsfactory.py
--rw-r--r--   0        0        0     3841 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/model_from_sparameters.py
--rw-r--r--   0        0        0     2438 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/plot_circuit.py
--rw-r--r--   0        0        0     1798 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/plot_circuit_montecarlo.py
--rw-r--r--   0        0        0     2773 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/plot_model.py
--rw-r--r--   0        0        0     1261 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_circuit.py
--rw-r--r--   0        0        0       90 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_circuit/test_circuit_transmission.yml
--rw-r--r--   0        0        0     1109 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_components.py
--rw-r--r--   0        0        0       66 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_components/test_circuits_mzi_.yml
--rw-r--r--   0        0        0       69 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_components/test_circuits_ring_double_.yml
--rw-r--r--   0        0        0       69 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_components/test_circuits_ring_single_.yml
--rw-r--r--   0        0        0       92 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_bend_circular_.yml
--rw-r--r--   0        0        0       92 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_bend_euler_.yml
--rw-r--r--   0        0        0      412 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_coupler_.yml
--rw-r--r--   0        0        0      412 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_coupler_ring_.yml
--rw-r--r--   0        0        0      114 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_gc1550te_.yml
--rw-r--r--   0        0        0      256 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_mmi1x2_.yml
--rw-r--r--   0        0        0      460 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_mmi2x2_.yml
--rw-r--r--   0        0        0      104 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_straight_.yml
--rw-r--r--   0        0        0      166 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/simphony/types.py
--rw-r--r--   0        0        0      471 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sipann/__init__.py
--rw-r--r--   0        0        0     1376 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sipann/bend_circular.py
--rw-r--r--   0        0        0     1465 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sipann/bend_euler.py
--rw-r--r--   0        0        0     2508 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sipann/coupler.py
--rw-r--r--   0        0        0     1892 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sipann/coupler_ring.py
--rw-r--r--   0        0        0      736 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/sipann/straight.py
--rw-r--r--   0        0        0      100 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/thermal/__init__.py
--rw-r--r--   0        0        0     7781 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/simulation/thermal/heater.py
--rw-r--r--   0        0        0     1744 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/snap.py
--rw-r--r--   0        0        0     4245 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/symbols.py
--rw-r--r--   0        0        0      524 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/technology/__init__.py
--rw-r--r--   0        0        0     7599 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/technology/klayout_tech.py
--rw-r--r--   0        0        0     1078 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/technology/layer_map.py
--rw-r--r--   0        0        0    16131 2023-05-13 17:56:23.302049 gdsfactory-6.93.1/gdsfactory/technology/layer_stack.py
--rw-r--r--   0        0        0    42084 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/gdsfactory/technology/layer_views.py
--rw-r--r--   0        0        0     1984 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/gdsfactory/technology/simulation_settings.py
--rw-r--r--   0        0        0     1635 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/gdsfactory/types.py
--rw-r--r--   0        0        0    10000 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/gdsfactory/typings.py
--rw-r--r--   0        0        0        0 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/gdsfactory/utils/__init__.py
--rw-r--r--   0        0        0     1304 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/gdsfactory/utils/async_utils.py
--rw-r--r--   0        0        0      376 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/gdsfactory/utils/color_utils.py
--rw-r--r--   0        0        0      558 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/gdsfactory/utils/file_utils.py
--rw-r--r--   0        0        0      185 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/gdsfactory/utils/function_utils.py
--rw-r--r--   0        0        0      676 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/gdsfactory/utils/xml_utils.py
--rw-r--r--   0        0        0     1429 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/gdsfactory/utils/yaml_utils.py
--rw-r--r--   0        0        0     4825 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/gdsfactory/watch.py
--rw-r--r--   0        0        0        0 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/gdsfactory/widgets/__init__.py
--rw-r--r--   0        0        0     7921 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/gdsfactory/widgets/layout_viewer.py
--rw-r--r--   0        0        0     7464 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/gdsfactory/write_cells.py
--rw-r--r--   0        0        0     5545 2023-05-13 17:56:23.306049 gdsfactory-6.93.1/pyproject.toml
--rw-r--r--   0        0        0    18734 1970-01-01 00:00:00.000000 gdsfactory-6.93.1/PKG-INFO
+-rw-r--r--   0        0        0     1072 2023-05-17 19:15:16.789954 gdsfactory-6.94.0/LICENSE
+-rw-r--r--   0        0        0    14319 2023-05-17 19:15:16.789954 gdsfactory-6.94.0/README.md
+-rw-r--r--   0        0        0     3451 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/__init__.py
+-rw-r--r--   0        0        0     2104 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/add_keepout.py
+-rw-r--r--   0        0        0    12629 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/add_labels.py
+-rw-r--r--   0        0        0     3711 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/add_loopback.py
+-rw-r--r--   0        0        0     5054 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/add_padding.py
+-rw-r--r--   0        0        0    15639 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/add_pins.py
+-rw-r--r--   0        0        0    14700 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/add_ports.py
+-rw-r--r--   0        0        0     2884 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/add_tapers.py
+-rw-r--r--   0        0        0     2257 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/add_tapers_cross_section.py
+-rw-r--r--   0        0        0     1831 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/add_termination.py
+-rw-r--r--   0        0        0     1856 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/asserts.py
+-rw-r--r--   0        0        0    12017 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/cell.py
+-rw-r--r--   0        0        0    16040 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/circuitviz.py
+-rw-r--r--   0        0        0     5718 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/cli.py
+-rw-r--r--   0        0        0   100853 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/component.py
+-rw-r--r--   0        0        0    23424 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/component_layout.py
+-rw-r--r--   0        0        0    29787 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/component_reference.py
+-rw-r--r--   0        0        0     1205 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/C.py
+-rw-r--r--   0        0        0     1144 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/L.py
+-rw-r--r--   0        0        0    20964 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/__init__.py
+-rw-r--r--   0        0        0     2621 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/add_fiducials.py
+-rw-r--r--   0        0        0    14087 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/add_grating_couplers.py
+-rw-r--r--   0        0        0     2014 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/add_trenches.py
+-rw-r--r--   0        0        0     3207 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/align.py
+-rw-r--r--   0        0        0     2622 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/array_component.py
+-rw-r--r--   0        0        0     4705 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/array_with_fanout.py
+-rw-r--r--   0        0        0     4322 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/array_with_via.py
+-rw-r--r--   0        0        0     4042 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/awg.py
+-rw-r--r--   0        0        0     1269 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/bbox.py
+-rw-r--r--   0        0        0     2851 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/bend_circular.py
+-rw-r--r--   0        0        0     2649 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/bend_circular_heater.py
+-rw-r--r--   0        0        0     7903 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/bend_euler.py
+-rw-r--r--   0        0        0     2682 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/bend_port.py
+-rw-r--r--   0        0        0     3664 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/bend_s.py
+-rw-r--r--   0        0        0     5373 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/bezier.py
+-rw-r--r--   0        0        0     1605 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/cavity.py
+-rw-r--r--   0        0        0     5766 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/cdc.py
+-rw-r--r--   0        0        0     2929 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/cdsem_all.py
+-rw-r--r--   0        0        0     1788 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/cdsem_bend180.py
+-rw-r--r--   0        0        0     1631 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/cdsem_coupler.py
+-rw-r--r--   0        0        0     1412 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/cdsem_straight.py
+-rw-r--r--   0        0        0     1565 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/cdsem_straight_density.py
+-rw-r--r--   0        0        0      793 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/circle.py
+-rw-r--r--   0        0        0     5722 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/coh_rx_dual_pol.py
+-rw-r--r--   0        0        0     8922 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/coh_rx_single_pol.py
+-rw-r--r--   0        0        0     5043 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/coh_tx_dual_pol.py
+-rw-r--r--   0        0        0     6118 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/coh_tx_single_pol.py
+-rw-r--r--   0        0        0     2548 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/compass.py
+-rw-r--r--   0        0        0     9876 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/component_lattice.py
+-rw-r--r--   0        0        0     7174 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/component_sequence.py
+-rw-r--r--   0        0        0      812 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/copy_layers.py
+-rw-r--r--   0        0        0     3460 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/coupler.py
+-rw-r--r--   0        0        0     2113 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/coupler90.py
+-rw-r--r--   0        0        0     1802 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/coupler90bend.py
+-rw-r--r--   0        0        0     4666 2023-05-17 19:15:16.797954 gdsfactory-6.94.0/gdsfactory/components/coupler_adiabatic.py
+-rw-r--r--   0        0        0     1909 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/coupler_asymmetric.py
+-rw-r--r--   0        0        0     3970 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/coupler_full.py
+-rw-r--r--   0        0        0     3414 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/coupler_ring.py
+-rw-r--r--   0        0        0     1060 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/coupler_straight.py
+-rw-r--r--   0        0        0     1164 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/coupler_straight_asymmetric.py
+-rw-r--r--   0        0        0     2192 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/coupler_symmetric.py
+-rw-r--r--   0        0        0     1848 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/cross.py
+-rw-r--r--   0        0        0    12873 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/crossing_waveguide.py
+-rw-r--r--   0        0        0      500 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/csv_data/grating_coupler_1etch_h220_e70.csv
+-rw-r--r--   0        0        0     1014 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv
+-rw-r--r--   0        0        0    19749 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv
+-rw-r--r--   0        0        0    19751 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv
+-rw-r--r--   0        0        0    19749 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv
+-rw-r--r--   0        0        0    19751 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv
+-rw-r--r--   0        0        0    19775 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv
+-rw-r--r--   0        0        0     3143 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv
+-rw-r--r--   0        0        0     5272 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/cutback_2x2.py
+-rw-r--r--   0        0        0     6450 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/cutback_bend.py
+-rw-r--r--   0        0        0     3765 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/cutback_component.py
+-rw-r--r--   0        0        0     2721 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/cutback_splitter.py
+-rw-r--r--   0        0        0     2971 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/dbr.py
+-rw-r--r--   0        0        0     4288 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/dbr_tapered.py
+-rw-r--r--   0        0        0     2486 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/delay_snake.py
+-rw-r--r--   0        0        0     3177 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/delay_snake2.py
+-rw-r--r--   0        0        0     3245 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/delay_snake3.py
+-rw-r--r--   0        0        0     4319 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/delay_snake_sbend.py
+-rw-r--r--   0        0        0     1226 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/dicing_lane.py
+-rw-r--r--   0        0        0     3471 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/die.py
+-rw-r--r--   0        0        0     2975 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/die_bbox.py
+-rw-r--r--   0        0        0     2863 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/die_bbox_frame.py
+-rw-r--r--   0        0        0     8015 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/disk.py
+-rw-r--r--   0        0        0     4112 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/edge_coupler_array.py
+-rw-r--r--   0        0        0     1214 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/ellipse.py
+-rw-r--r--   0        0        0     1800 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/extend_ports_list.py
+-rw-r--r--   0        0        0     7988 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/extension.py
+-rw-r--r--   0        0        0      981 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/fiber.py
+-rw-r--r--   0        0        0     1432 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/fiber_array.py
+-rw-r--r--   0        0        0      722 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/fiducial_squares.py
+-rw-r--r--   0        0        0     3290 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/ge_detector_straight_si_contacts.py
+-rw-r--r--   0        0        0     1063 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/grating_coupler_array.py
+-rw-r--r--   0        0        0     4682 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/grating_coupler_dual_pol.py
+-rw-r--r--   0        0        0     7110 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/grating_coupler_elliptical.py
+-rw-r--r--   0        0        0     7221 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/grating_coupler_elliptical_arbitrary.py
+-rw-r--r--   0        0        0     4960 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/grating_coupler_elliptical_lumerical.py
+-rw-r--r--   0        0        0     4592 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/grating_coupler_elliptical_trenches.py
+-rw-r--r--   0        0        0     1773 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/grating_coupler_functions.py
+-rw-r--r--   0        0        0     9058 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/grating_coupler_loss.py
+-rw-r--r--   0        0        0     1786 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/grating_coupler_loss_fiber_single.py
+-rw-r--r--   0        0        0     4142 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/grating_coupler_rectangular.py
+-rw-r--r--   0        0        0     4685 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/grating_coupler_rectangular_arbitrary.py
+-rw-r--r--   0        0        0     3887 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py
+-rw-r--r--   0        0        0     1578 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/grating_coupler_tree.py
+-rw-r--r--   0        0        0     8811 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/greek_cross.py
+-rw-r--r--   0        0        0     1019 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/hline.py
+-rw-r--r--   0        0        0     3687 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/interdigital_capacitor.py
+-rw-r--r--   0        0        0     1825 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/litho_calipers.py
+-rw-r--r--   0        0        0     1244 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/litho_ruler.py
+-rw-r--r--   0        0        0     1304 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/litho_steps.py
+-rw-r--r--   0        0        0      650 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/logo.py
+-rw-r--r--   0        0        0     1679 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/loop_mirror.py
+-rw-r--r--   0        0        0     3873 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/mmi1x2.py
+-rw-r--r--   0        0        0     2814 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/mmi1x2_with_sbend.py
+-rw-r--r--   0        0        0     3858 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/mmi2x2.py
+-rw-r--r--   0        0        0     3299 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/mmi2x2_with_sbend.py
+-rw-r--r--   0        0        0     4947 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/mmi_90degree_hybrid.py
+-rw-r--r--   0        0        0     3265 2023-05-17 19:15:16.801955 gdsfactory-6.94.0/gdsfactory/components/mode_converter.py
+-rw-r--r--   0        0        0     7409 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/mzi.py
+-rw-r--r--   0        0        0     2499 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/mzi_arm.py
+-rw-r--r--   0        0        0     5835 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/mzi_arms.py
+-rw-r--r--   0        0        0    12214 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/mzi_lattice.py
+-rw-r--r--   0        0        0     4025 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/mzi_pads_center.py
+-rw-r--r--   0        0        0     1064 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/mzi_phase_shifter.py
+-rw-r--r--   0        0        0     6342 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/mzit.py
+-rw-r--r--   0        0        0     3502 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/mzit_lattice.py
+-rw-r--r--   0        0        0     6047 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/mzm.py
+-rw-r--r--   0        0        0     3518 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/nxn.py
+-rw-r--r--   0        0        0     1940 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/optimal_90deg.py
+-rw-r--r--   0        0        0     3876 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/optimal_hairpin.py
+-rw-r--r--   0        0        0     6131 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/optimal_step.py
+-rw-r--r--   0        0        0     6327 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/pack_doe.py
+-rw-r--r--   0        0        0     3860 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/pad.py
+-rw-r--r--   0        0        0     1890 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/pad_gsg.py
+-rw-r--r--   0        0        0     1157 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/pads_shorted.py
+-rw-r--r--   0        0        0     3833 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/polarization_splitter_rotator.py
+-rw-r--r--   0        0        0     1147 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/ramp.py
+-rw-r--r--   0        0        0     1508 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/rectangle.py
+-rw-r--r--   0        0        0     2972 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/rectangle_with_slits.py
+-rw-r--r--   0        0        0     1508 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/regular_polygon.py
+-rw-r--r--   0        0        0     3302 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/resistance_meander.py
+-rw-r--r--   0        0        0     2642 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/resistance_sheet.py
+-rw-r--r--   0        0        0     1273 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/ring.py
+-rw-r--r--   0        0        0     4143 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/ring_crow.py
+-rw-r--r--   0        0        0     3272 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/ring_crow_couplers.py
+-rw-r--r--   0        0        0     2267 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/ring_double.py
+-rw-r--r--   0        0        0     2846 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/ring_double_bend_coupler.py
+-rw-r--r--   0        0        0     3846 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/ring_double_heater.py
+-rw-r--r--   0        0        0     7757 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/ring_double_pn.py
+-rw-r--r--   0        0        0    12137 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/ring_section_based.py
+-rw-r--r--   0        0        0     2719 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/ring_single.py
+-rw-r--r--   0        0        0     1968 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/ring_single_array.py
+-rw-r--r--   0        0        0     6868 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/ring_single_bend_coupler.py
+-rw-r--r--   0        0        0     2714 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/ring_single_dut.py
+-rw-r--r--   0        0        0     4018 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/ring_single_heater.py
+-rw-r--r--   0        0        0     5267 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/ring_single_pn.py
+-rw-r--r--   0        0        0     2282 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/seal_ring.py
+-rw-r--r--   0        0        0     3758 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/snspd.py
+-rw-r--r--   0        0        0     2059 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/spiral_double.py
+-rw-r--r--   0        0        0     5871 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/spiral_external_io.py
+-rw-r--r--   0        0        0    16692 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/spiral_heater.py
+-rw-r--r--   0        0        0     9181 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/spiral_inner_io.py
+-rw-r--r--   0        0        0     1733 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/splitter_chain.py
+-rw-r--r--   0        0        0     5327 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/splitter_tree.py
+-rw-r--r--   0        0        0     2526 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/straight.py
+-rw-r--r--   0        0        0     1033 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/straight_array.py
+-rw-r--r--   0        0        0     7914 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/straight_heater_doped_rib.py
+-rw-r--r--   0        0        0     1922 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/straight_heater_doped_strip.py
+-rw-r--r--   0        0        0     7891 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/straight_heater_meander.py
+-rw-r--r--   0        0        0     8090 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/straight_heater_meander_doped.py
+-rw-r--r--   0        0        0     5686 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/straight_heater_metal.py
+-rw-r--r--   0        0        0     2809 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/straight_pin.py
+-rw-r--r--   0        0        0     3974 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/straight_pin_slot.py
+-rw-r--r--   0        0        0      655 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/straight_rib.py
+-rw-r--r--   0        0        0      820 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/switch_tree.py
+-rw-r--r--   0        0        0     7730 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/taper.py
+-rw-r--r--   0        0        0     3530 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/taper_adiabatic.py
+-rw-r--r--   0        0        0     2457 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/taper_cross_section.py
+-rw-r--r--   0        0        0     2363 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/taper_from_csv.py
+-rw-r--r--   0        0        0     1215 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/taper_parabolic.py
+-rw-r--r--   0        0        0     1635 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/terminator.py
+-rw-r--r--   0        0        0     2913 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/text.py
+-rw-r--r--   0        0        0     3821 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/text_freetype.py
+-rw-r--r--   0        0        0     3160 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/text_rectangular.py
+-rw-r--r--   0        0        0     3943 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/text_rectangular_font.py
+-rw-r--r--   0        0        0     2536 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/triangles.py
+-rw-r--r--   0        0        0      715 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/verniers.py
+-rw-r--r--   0        0        0     2468 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/version_stamp.py
+-rw-r--r--   0        0        0     2436 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/via.py
+-rw-r--r--   0        0        0     3060 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/via_corner.py
+-rw-r--r--   0        0        0     5342 2023-05-17 19:15:16.805955 gdsfactory-6.94.0/gdsfactory/components/via_cutback.py
+-rw-r--r--   0        0        0    15612 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/components/via_stack.py
+-rw-r--r--   0        0        0     4430 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/components/via_stack_slot.py
+-rw-r--r--   0        0        0     4944 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/components/via_stack_with_offset.py
+-rw-r--r--   0        0        0     1088 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/components/wafer.py
+-rw-r--r--   0        0        0     2542 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/components/wire.py
+-rw-r--r--   0        0        0      978 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/components/wire_sbend.py
+-rw-r--r--   0        0        0     8105 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/config.py
+-rw-r--r--   0        0        0      481 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/conftest.py
+-rw-r--r--   0        0        0    38409 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/constants.py
+-rw-r--r--   0        0        0     1476 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/containers.py
+-rw-r--r--   0        0        0    82893 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/cross_section.py
+-rw-r--r--   0        0        0     2982 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/decorators.py
+-rw-r--r--   0        0        0     7312 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/difftest.py
+-rw-r--r--   0        0        0     1020 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/events.py
+-rw-r--r--   0        0        0      204 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/export/__init__.py
+-rw-r--r--   0        0        0     3353 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/export/to_3d.py
+-rw-r--r--   0        0        0     1940 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/export/to_np.py
+-rw-r--r--   0        0        0     3058 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/export/to_stl.py
+-rw-r--r--   0        0        0     7445 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/export/write_gerbers.py
+-rw-r--r--   0        0        0     2976 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/filestorage.py
+-rw-r--r--   0        0        0    11890 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/fill.py
+-rw-r--r--   0        0        0     7799 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/font.py
+-rw-r--r--   0        0        0     8073 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/functions.py
+-rw-r--r--   0        0        0       20 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/gdsdiff/.gitattributes
+-rw-r--r--   0        0        0       83 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/gdsdiff/.gitconfig
+-rw-r--r--   0        0        0       72 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/gdsdiff/__init__.py
+-rw-r--r--   0        0        0     1069 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/gdsdiff/gds_diff_git.py
+-rw-r--r--   0        0        0     2935 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/gdsdiff/gdsdiff.py
+-rw-r--r--   0        0        0      708 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/gdsdiff/install.py
+-rw-r--r--   0        0        0      271 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/gdsdiff/sample.py
+-rw-r--r--   0        0        0     1059 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/gdsdiff/test_xor.py
+-rw-r--r--   0        0        0     1100 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/README.md
+-rw-r--r--   0        0        0     1722 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/__init__.py
+-rw-r--r--   0        0        0      169 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/generic_tech.sh
+-rw-r--r--   0        0        0     8142 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/get_klayout_pyxs.py
+-rw-r--r--   0        0        0      161 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/README.md
+-rw-r--r--   0        0        0      104 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/drc/Makefile
+-rw-r--r--   0        0        0        0 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/drc/__init__.py
+-rw-r--r--   0        0        0     2842 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/drc/errors.py
+-rw-r--r--   0        0        0     6193 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/grain.xml
+-rw-r--r--   0        0        0    10140 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/icon_128x128.png
+-rw-r--r--   0        0        0     4248 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/icon_64x64.png
+-rw-r--r--   0        0        0       27 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/.gitignore
+-rw-r--r--   0        0        0      494 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/Makefile
+-rw-r--r--   0        0        0     4062 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/README.md
+-rw-r--r--   0        0        0     2419 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md
+-rw-r--r--   0        0        0     9696 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc
+-rw-r--r--   0        0        0    12379 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py
+-rw-r--r--   0        0        0     7235 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs
+-rw-r--r--   0        0        0     3446 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs
+-rw-r--r--   0        0        0      479 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/devices_connections.lvs
+-rw-r--r--   0        0        0      582 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs
+-rw-r--r--   0        0        0      108 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_derivations.lvs
+-rw-r--r--   0        0        0      186 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_connections.lvs
+-rw-r--r--   0        0        0      398 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_derivations.lvs
+-rw-r--r--   0        0        0      574 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs
+-rw-r--r--   0        0        0     6034 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs
+-rw-r--r--   0        0        0    10704 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/run_lvs.py
+-rw-r--r--   0        0        0      477 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/README.md
+-rw-r--r--   0        0        0     4337 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py
+-rw-r--r--   0        0        0      926 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice
+-rw-r--r--   0        0        0    10945 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym
+-rw-r--r--   0        0        0      710 2023-05-17 19:15:16.809955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym
+-rw-r--r--   0        0        0      538 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym
+-rw-r--r--   0        0        0        0 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/python/__init__.py
+-rw-r--r--   0        0        0      114 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/python/kgdsfactory/__init__.py
+-rw-r--r--   0        0        0     4311 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py
+-rw-r--r--   0        0        0      269 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/Makefile
+-rw-r--r--   0        0        0     1854 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25
+-rw-r--r--   0        0        0     1519 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/generic.layerstack
+-rw-r--r--   0        0        0    41073 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp
+-rw-r--r--   0        0        0    40616 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/layers.lyp
+-rw-r--r--   0        0        0     5977 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/tech.lyt
+-rw-r--r--   0        0        0     4258 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs
+-rw-r--r--   0        0        0     4537 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs
+-rw-r--r--   0        0        0     4690 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs
+-rw-r--r--   0        0        0     5508 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs
+-rw-r--r--   0        0        0     1883 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/layer_map.py
+-rw-r--r--   0        0        0     6511 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/layer_stack.py
+-rw-r--r--   0        0        0    10780 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/layer_views.yaml
+-rw-r--r--   0        0        0      158 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/generic_tech/simulation_settings.py
+-rw-r--r--   0        0        0     1431 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/__init__.py
+-rw-r--r--   0        0        0     4917 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/boolean.py
+-rw-r--r--   0        0        0     3814 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/boolean_klayout.py
+-rw-r--r--   0        0        0     1904 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/boolean_polygons.py
+-rw-r--r--   0        0        0      598 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/check_duplicated_cells.py
+-rw-r--r--   0        0        0     2719 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/check_exclusion.py
+-rw-r--r--   0        0        0     2829 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/check_inclusion.py
+-rw-r--r--   0        0        0     3566 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/check_space.py
+-rw-r--r--   0        0        0     1904 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/check_width.py
+-rw-r--r--   0        0        0     5015 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/fill_klayout.py
+-rw-r--r--   0        0        0     7084 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/fill_tiled.py
+-rw-r--r--   0        0        0     1697 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/fillet.py
+-rw-r--r--   0        0        0     6664 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/functions.py
+-rw-r--r--   0        0        0     2167 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/invert.py
+-rw-r--r--   0        0        0     3685 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/layer_priority.py
+-rw-r--r--   0        0        0     3054 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/manhattanize.py
+-rw-r--r--   0        0        0     4192 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/maskprep.py
+-rw-r--r--   0        0        0     4812 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/maskprep_flat.py
+-rw-r--r--   0        0        0     3250 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/offset.py
+-rw-r--r--   0        0        0     3842 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/outline.py
+-rw-r--r--   0        0        0     2510 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/trim.py
+-rw-r--r--   0        0        0     2948 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/union.py
+-rw-r--r--   0        0        0     1898 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/write_connectivity.py
+-rw-r--r--   0        0        0    10532 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/write_drc.py
+-rw-r--r--   0        0        0     1783 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/geometry/xor_diff.py
+-rw-r--r--   0        0        0     1158 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/get_factories.py
+-rw-r--r--   0        0        0    23569 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/get_netlist.py
+-rw-r--r--   0        0        0    14446 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/get_netlist_flat.py
+-rw-r--r--   0        0        0      682 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/get_netlist_klayout.py
+-rw-r--r--   0        0        0     9745 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/grid.py
+-rw-r--r--   0        0        0     4393 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/install.py
+-rw-r--r--   0        0        0     1970 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/klive.py
+-rw-r--r--   0        0        0      585 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/labels/__init__.py
+-rw-r--r--   0        0        0     3563 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/labels/add_label_yaml.py
+-rw-r--r--   0        0        0     3847 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/labels/ehva.py
+-rw-r--r--   0        0        0     3810 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/labels/merge_test_metadata.py
+-rw-r--r--   0        0        0     4668 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/labels/siepic.py
+-rw-r--r--   0        0        0     4847 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/labels/write_labels.py
+-rw-r--r--   0        0        0     1149 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/materials.py
+-rw-r--r--   0        0        0     5247 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/name.py
+-rw-r--r--   0        0        0    11586 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/pack.py
+-rw-r--r--   0        0        0    50895 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/path.py
+-rw-r--r--   0        0        0    25857 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/pdk.py
+-rw-r--r--   0        0        0     6220 2023-05-17 19:15:16.813955 gdsfactory-6.94.0/gdsfactory/picmodel.py
+-rw-r--r--   0        0        0     5068 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/pixelate.py
+-rw-r--r--   0        0        0        0 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/plugins/dagster/__init__.py
+-rw-r--r--   0        0        0      976 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/plugins/dagster/workflow.py
+-rw-r--r--   0        0        0      566 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/plugins/database/README.md
+-rw-r--r--   0        0        0        0 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/plugins/database/__init__.py
+-rw-r--r--   0        0        0     6216 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/plugins/database/db_upload.py
+-rw-r--r--   0        0        0    16143 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/plugins/database/models.py
+-rw-r--r--   0        0        0       32 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/plugins/web/Makefile
+-rw-r--r--   0        0        0       23 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/plugins/web/__init__.py
+-rw-r--r--   0        0        0     4080 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/plugins/web/main.py
+-rwxr-xr-x   0        0        0     7511 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/plugins/web/server.py
+-rwxr-xr-x   0        0        0      594 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/plugins/web/server_jupyter.py
+-rw-r--r--   0        0        0     1299 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/plugins/web/static/client.css
+-rw-r--r--   0        0        0    32235 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/port.py
+-rw-r--r--   0        0        0    37817 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/quickplotter.py
+-rw-r--r--   0        0        0      696 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/read/__init__.py
+-rw-r--r--   0        0        0     1639 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/read/from_dphox.py
+-rw-r--r--   0        0        0     1285 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/read/from_gdspaths.py
+-rw-r--r--   0        0        0     1953 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/read/from_np.py
+-rw-r--r--   0        0        0     2813 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/read/from_phidl.py
+-rw-r--r--   0        0        0    38082 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/read/from_yaml.py
+-rw-r--r--   0        0        0     5897 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/read/from_yaml_template.py
+-rw-r--r--   0        0        0     5688 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/read/import_gds.py
+-rw-r--r--   0        0        0     3407 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/read/labels.py
+-rw-r--r--   0        0        0     3769 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/__init__.py
+-rw-r--r--   0        0        0     2920 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/add_electrical_pads_shortest.py
+-rw-r--r--   0        0        0     3015 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/add_electrical_pads_top.py
+-rw-r--r--   0        0        0     3035 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/add_electrical_pads_top_dc.py
+-rw-r--r--   0        0        0     8715 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/add_fiber_array.py
+-rw-r--r--   0        0        0    10624 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/add_fiber_single.py
+-rw-r--r--   0        0        0     8967 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/add_pads.py
+-rw-r--r--   0        0        0    38948 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/all_angle.py
+-rw-r--r--   0        0        0     3916 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/auto_taper.py
+-rw-r--r--   0        0        0      982 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/factories.py
+-rw-r--r--   0        0        0     4415 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/fanout.py
+-rw-r--r--   0        0        0     2800 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/fanout2x2.py
+-rw-r--r--   0        0        0    24342 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/get_bundle.py
+-rw-r--r--   0        0        0     8652 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/get_bundle_corner.py
+-rw-r--r--   0        0        0     6910 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/get_bundle_from_steps.py
+-rw-r--r--   0        0        0    12949 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/get_bundle_from_waypoints.py
+-rw-r--r--   0        0        0     5284 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/get_bundle_path_length_match.py
+-rw-r--r--   0        0        0     1937 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/get_bundle_sbend.py
+-rw-r--r--   0        0        0    17064 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/get_bundle_u.py
+-rw-r--r--   0        0        0     1510 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/get_input_labels.py
+-rw-r--r--   0        0        0     9233 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/get_route.py
+-rw-r--r--   0        0        0    10872 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/get_route_astar.py
+-rw-r--r--   0        0        0     6119 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/get_route_from_steps.py
+-rw-r--r--   0        0        0     2766 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/get_route_sbend.py
+-rw-r--r--   0        0        0     3311 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/get_routes_bend180.py
+-rw-r--r--   0        0        0     1854 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/get_routes_straight.py
+-rw-r--r--   0        0        0    34394 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/manhattan.py
+-rw-r--r--   0        0        0    10081 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/path_length_matching.py
+-rw-r--r--   0        0        0    22568 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/route_fiber_array.py
+-rw-r--r--   0        0        0     8679 2023-05-17 19:15:16.817956 gdsfactory-6.94.0/gdsfactory/routing/route_fiber_single.py
+-rw-r--r--   0        0        0    18132 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/routing/route_ports_to_side.py
+-rw-r--r--   0        0        0     4379 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/routing/route_quad.py
+-rw-r--r--   0        0        0    14370 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/routing/route_sharp.py
+-rw-r--r--   0        0        0    10167 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/routing/route_south.py
+-rw-r--r--   0        0        0     5072 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/routing/sort_ports.py
+-rw-r--r--   0        0        0     2477 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/routing/utils.py
+-rw-r--r--   0        0        0     2897 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/01_component_pcell.py
+-rw-r--r--   0        0        0      646 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/01_component_pcell/test_straight_wide.yml
+-rw-r--r--   0        0        0     1109 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/01_component_pcell_with_pins.py
+-rw-r--r--   0        0        0      664 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml
+-rw-r--r--   0        0        0      347 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/02_component_autoname.py
+-rw-r--r--   0        0        0      887 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/03_move.py
+-rw-r--r--   0        0        0      881 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/04_connect.py
+-rw-r--r--   0        0        0      710 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/05_remove_layers.py
+-rw-r--r--   0        0        0      931 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/06_remapping_layers.py
+-rw-r--r--   0        0        0     1082 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/07_flattening_device.py
+-rw-r--r--   0        0        0      475 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/08_group.py
+-rw-r--r--   0        0        0     1631 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/11_component_layout.py
+-rw-r--r--   0        0        0     2245 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/12_component_refs.py
+-rw-r--r--   0        0        0      955 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/13_component_netlist.py
+-rw-r--r--   0        0        0     2592 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/14_component_connectivity.py
+-rw-r--r--   0        0        0     1636 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/15_component_sequence1.py
+-rw-r--r--   0        0        0     1680 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/16_component_sequence2.py
+-rw-r--r--   0        0        0      965 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/17_ports.py
+-rw-r--r--   0        0        0      489 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/18_port_markers.py
+-rw-r--r--   0        0        0      361 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/19_references.py
+-rw-r--r--   0        0        0      533 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/20_components.py
+-rw-r--r--   0        0        0      507 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/21_add_fiber_array.py
+-rw-r--r--   0        0        0      493 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/22_add_fiber_single.py
+-rw-r--r--   0        0        0      569 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/22_add_pads.py
+-rw-r--r--   0        0        0      848 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/23_reticle.py
+-rw-r--r--   0        0        0     1588 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/23_reticle_passives.py
+-rw-r--r--   0        0        0      457 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/24_doe.py
+-rw-r--r--   0        0        0      687 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/24_doe_2.py
+-rw-r--r--   0        0        0      692 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/24_doe_3.py
+-rw-r--r--   0        0        0      306 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/25_slot_cross_section.py
+-rw-r--r--   0        0        0     1363 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/30_lidar.py
+-rw-r--r--   0        0        0     1412 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/30_lidar_pcell.py
+-rw-r--r--   0        0        0     1943 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/30_lidar_with_pads.py
+-rw-r--r--   0        0        0        0 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/__init__.py
+-rw-r--r--   0        0        0     1307 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing.py
+-rw-r--r--   0        0        0      558 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml
+-rw-r--r--   0        0        0     6062 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml
+-rw-r--r--   0        0        0      444 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_error_intermediate_180.pic.yml
+-rw-r--r--   0        0        0      463 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_error_overconstrained.pic.yml
+-rw-r--r--   0        0        0     1552 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml
+-rw-r--r--   0        0        0     1315 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml
+-rw-r--r--   0        0        0      602 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml
+-rw-r--r--   0        0        0     3317 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml
+-rw-r--r--   0        0        0     1484 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml
+-rw-r--r--   0        0        0     3045 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml
+-rw-r--r--   0        0        0     3782 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml
+-rw-r--r--   0        0        0     1988 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/big_device.py
+-rw-r--r--   0        0        0       19 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/Makefile
+-rw-r--r--   0        0        0        0 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/__init__.py
+-rw-r--r--   0        0        0     1129 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/benchmark/fill_demo.py
+-rw-r--r--   0        0        0      343 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/benchmark/snap_demo_phidl.py
+-rw-r--r--   0        0        0      637 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/circuits/mask.pic.yml
+-rw-r--r--   0        0        0      622 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml
+-rw-r--r--   0        0        0      569 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml
+-rw-r--r--   0        0        0      453 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/circuits/pads.pic.yml
+-rw-r--r--   0        0        0      287 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/circuits/rectangles.pic.yml
+-rw-r--r--   0        0        0     2260 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/drc_errors.py
+-rw-r--r--   0        0        0     1014 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/drc_write.py
+-rw-r--r--   0        0        0     4530 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/layers.py
+-rw-r--r--   0        0        0      158 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/layers_sky130.py
+-rw-r--r--   0        0        0      364 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/layers_xsection.py
+-rw-r--r--   0        0        0     1062 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/lvs.py
+-rw-r--r--   0        0        0      574 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/demo/pcell.py
+-rw-r--r--   0        0        0     4174 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/netlists/mzi.yml
+-rw-r--r--   0        0        0     5840 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/netlists/mzi_full.yml
+-rw-r--r--   0        0        0        0 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/__init__.py
+-rw-r--r--   0        0        0     4235 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/fab_c.py
+-rw-r--r--   0        0        0      475 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/fab_d/__init__.py
+-rw-r--r--   0        0        0     1880 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/fab_d/phase_shifters.py
+-rw-r--r--   0        0        0     1715 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c.py
+-rw-r--r--   0        0        0       50 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_ports_bend_euler_c_.csv
+-rw-r--r--   0        0        0       93 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_ports_gc_nitride_c_.csv
+-rw-r--r--   0        0        0       85 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_c_.csv
+-rw-r--r--   0        0        0      139 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_o_.csv
+-rw-r--r--   0        0        0       90 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_c_.csv
+-rw-r--r--   0        0        0      126 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_o_.csv
+-rw-r--r--   0        0        0       48 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_ports_straight_c_.csv
+-rw-r--r--   0        0        0     1023 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml
+-rw-r--r--   0        0        0     2100 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml
+-rw-r--r--   0        0        0     1839 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml
+-rw-r--r--   0        0        0     1283 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml
+-rw-r--r--   0        0        0     1592 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml
+-rw-r--r--   0        0        0     1061 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml
+-rw-r--r--   0        0        0     1054 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml
+-rw-r--r--   0        0        0     1577 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml
+-rw-r--r--   0        0        0     4313 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml
+-rw-r--r--   0        0        0     3625 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml
+-rw-r--r--   0        0        0     3603 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml
+-rw-r--r--   0        0        0     4271 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml
+-rw-r--r--   0        0        0      840 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml
+-rw-r--r--   0        0        0     2171 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml
+-rw-r--r--   0        0        0      316 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/schematic.py
+-rw-r--r--   0        0        0    17862 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/schematic_editor.py
+-rw-r--r--   0        0        0     4194 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/serialization.py
+-rw-r--r--   0        0        0     1612 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/show.py
+-rw-r--r--   0        0        0      724 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/simulation/__init__.py
+-rw-r--r--   0        0        0     4369 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/simulation/add_simulation_markers.py
+-rw-r--r--   0        0        0     2476 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/simulation/convert_sparameters.py
+-rw-r--r--   0        0        0      547 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/simulation/devsim/__init__.py
+-rw-r--r--   0        0        0     2559 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/simulation/devsim/doping.py
+-rw-r--r--   0        0        0    11977 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/simulation/devsim/get_simulation.py
+-rw-r--r--   0        0        0    23687 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/simulation/devsim/get_simulation_xsection.py
+-rw-r--r--   0        0        0    19756 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/simulation/devsim/get_solver.py
+-rw-r--r--   0        0        0     1644 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/simulation/devsim/test_devsim.py
+-rw-r--r--   0        0        0      189 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/simulation/disable_print.py
+-rw-r--r--   0        0        0       79 2023-05-17 19:15:16.821956 gdsfactory-6.94.0/gdsfactory/simulation/eme/__init__.py
+-rw-r--r--   0        0        0    14784 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/eme/meow_eme.py
+-rw-r--r--   0        0        0     1787 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/eme/test_meow_simulation.py
+-rw-r--r--   0        0        0        0 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/fem/__init__.py
+-rw-r--r--   0        0        0     8968 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/fem/mode_solver.py
+-rw-r--r--   0        0        0     2221 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/fem/test_mode_solver.py
+-rw-r--r--   0        0        0     3455 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/get_effective_indices.py
+-rw-r--r--   0        0        0     3109 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/get_modes_path.py
+-rw-r--r--   0        0        0     3888 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/get_sparameters_path.py
+-rw-r--r--   0        0        0     2003 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/__init__.py
+-rw-r--r--   0        0        0     3194 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/get_material.py
+-rw-r--r--   0        0        0     6137 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/get_meep_geometry.py
+-rw-r--r--   0        0        0     6054 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/get_port_eigenmode.py
+-rw-r--r--   0        0        0    11014 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/get_simulation.py
+-rw-r--r--   0        0        0    15915 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/get_simulation_grating_farfield.py
+-rw-r--r--   0        0        0    18182 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/get_simulation_grating_fiber.py
+-rw-r--r--   0        0        0    12312 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/meep_adjoint_optimization.py
+-rw-r--r--   0        0        0    11914 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_eigenmode.py
+-rw-r--r--   0        0        0      832 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_materials.py
+-rw-r--r--   0        0        0    10128 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_crossing.csv
+-rw-r--r--   0        0        0    10128 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_straight.csv
+-rw-r--r--   0        0        0     6642 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep.py
+-rw-r--r--   0        0        0    10128 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_crossing.csv
+-rw-r--r--   0        0        0    10128 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_straight.csv
+-rw-r--r--   0        0        0    10093 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_symmetries_straight.csv
+-rw-r--r--   0        0        0    10085 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi.csv
+-rw-r--r--   0        0        0    10085 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi_pool.csv
+-rw-r--r--   0        0        0    34701 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_crossing_symmetric.csv
+-rw-r--r--   0        0        0    10123 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight.csv
+-rw-r--r--   0        0        0     9966 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_batch.csv
+-rw-r--r--   0        0        0     9966 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi.csv
+-rw-r--r--   0        0        0    10085 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi_pool.csv
+-rw-r--r--   0        0        0    10129 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_symmetric.csv
+-rw-r--r--   0        0        0    14053 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/write_sparameters_grating.py
+-rw-r--r--   0        0        0    21281 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/write_sparameters_meep.py
+-rw-r--r--   0        0        0     8143 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/write_sparameters_meep_batch.py
+-rw-r--r--   0        0        0     9577 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmeep/write_sparameters_meep_mpi.py
+-rw-r--r--   0        0        0     1246 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmsh/__init__.py
+-rw-r--r--   0        0        0     6653 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmsh/break_geometry.py
+-rw-r--r--   0        0        0    11250 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmsh/mesh.py
+-rw-r--r--   0        0        0    11824 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmsh/meshtracker.py
+-rw-r--r--   0        0        0     7752 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmsh/parse_component.py
+-rw-r--r--   0        0        0     3644 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmsh/parse_gds.py
+-rw-r--r--   0        0        0     3605 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmsh/parse_layerstack.py
+-rw-r--r--   0        0        0     2990 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmsh/refine.py
+-rw-r--r--   0        0        0    10851 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmsh/scratch/mesh3D.py
+-rw-r--r--   0        0        0     2513 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmsh/tests/test_meshing.py
+-rw-r--r--   0        0        0    14168 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmsh/uz_xsection_mesh.py
+-rw-r--r--   0        0        0     7441 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmsh/xy_xsection_mesh.py
+-rw-r--r--   0        0        0    16334 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gmsh/xyz_mesh.py
+-rw-r--r--   0        0        0     1624 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/__init__.py
+-rw-r--r--   0        0        0     4368 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/get_results.py
+-rw-r--r--   0        0        0    20009 2023-05-17 19:15:16.825956 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/get_simulation.py
+-rw-r--r--   0        0        0    21071 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/get_simulation_grating_coupler.py
+-rw-r--r--   0        0        0     2821 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/materials.py
+-rw-r--r--   0        0        0    26438 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/modes.py
+-rw-r--r--   0        0        0     8941 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/sim_run.yaml
+-rw-r--r--   0        0        0     8114 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/sim_ref.yaml
+-rw-r--r--   0        0        0     8114 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/sim_run.yaml
+-rw-r--r--   0        0        0      744 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/test_modes.py
+-rw-r--r--   0        0        0      262 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/test_modes/test_sweep_width.csv
+-rw-r--r--   0        0        0      879 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/test_results.py
+-rw-r--r--   0        0        0     1505 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/test_simulation.py
+-rw-r--r--   0        0        0     1270 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters.py
+-rw-r--r--   0        0        0     9297 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters/test_sparameters_straight.csv
+-rw-r--r--   0        0        0     1732 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters_grating_coupler.py
+-rw-r--r--   0        0        0     1224 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/utils.py
+-rw-r--r--   0        0        0    10515 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/write_sparameters.py
+-rw-r--r--   0        0        0     7695 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/write_sparameters_grating_coupler.py
+-rw-r--r--   0        0        0      588 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/lumerical/__init__.py
+-rw-r--r--   0        0        0    16091 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/lumerical/interconnect.py
+-rw-r--r--   0        0        0     4286 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/lumerical/read.py
+-rw-r--r--   0        0        0     3569 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/lumerical/settings.py
+-rw-r--r--   0        0        0     2348 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/lumerical/test_read_sparameters.py
+-rw-r--r--   0        0        0    19865 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/lumerical/write_sparameters_lumerical.py
+-rw-r--r--   0        0        0     1504 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/lumerical/write_sparameters_lumerical_components.py
+-rw-r--r--   0        0        0      932 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/__init__.py
+-rw-r--r--   0        0        0     1618 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/coupler.py
+-rw-r--r--   0        0        0     4166 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/find_coupling_vs_gap.py
+-rw-r--r--   0        0        0     2773 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/find_mode_dispersion.py
+-rw-r--r--   0        0        0     8924 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/find_modes.py
+-rwxr-xr-x   0        0        0     7032 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/find_modes_cross_section.py
+-rw-r--r--   0        0        0     4458 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/find_neff_ng_dw_dh.py
+-rw-r--r--   0        0        0     2728 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/find_neff_vs_width.py
+-rw-r--r--   0        0        0     7148 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/get_mode_solver_coupler.py
+-rwxr-xr-x   0        0        0     4462 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/get_mode_solver_cross_section.py
+-rw-r--r--   0        0        0     5411 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/get_mode_solver_rib.py
+-rw-r--r--   0        0        0     1110 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/modes/neff_vs_width_nitride.csv
+-rw-r--r--   0        0        0     1102 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/modes/neff_vs_width_rib.csv
+-rw-r--r--   0        0        0     1110 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/modes/neff_vs_width_strip.csv
+-rw-r--r--   0        0        0     8023 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/neff_convergence_test.py
+-rw-r--r--   0        0        0      267 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/neff_vs_width.csv
+-rw-r--r--   0        0        0     2469 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/overlap.py
+-rw-r--r--   0        0        0      418 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/tests/test_dw_dh.py
+-rw-r--r--   0        0        0       83 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh.csv
+-rw-r--r--   0        0        0      548 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh_dispersion.csv
+-rw-r--r--   0        0        0     1137 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/tests/test_find_modes.py
+-rw-r--r--   0        0        0      649 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/tests/test_find_modes_dispersion.py
+-rw-r--r--   0        0        0      354 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/tests/test_neff_vs_width.py
+-rw-r--r--   0        0        0      113 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/tests/test_neff_vs_width/test_neff_vs_width.csv
+-rw-r--r--   0        0        0    15492 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/types.py
+-rw-r--r--   0        0        0     1169 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/modes/waveguide.py
+-rw-r--r--   0        0        0     2013 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/photonic_circuit_models/__init__.py
+-rw-r--r--   0        0        0      597 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/photonic_circuit_models/coupler.py
+-rw-r--r--   0        0        0      377 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/photonic_circuit_models/fsr.py
+-rw-r--r--   0        0        0      418 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/photonic_circuit_models/heater.py
+-rw-r--r--   0        0        0     3069 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/photonic_circuit_models/mzi.py
+-rw-r--r--   0        0        0     2616 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/photonic_circuit_models/ring.py
+-rw-r--r--   0        0        0     7332 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/plot.py
+-rw-r--r--   0        0        0     2480 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/plot_csv.py
+-rw-r--r--   0        0        0      703 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/port_symmetries.py
+-rw-r--r--   0        0        0     4685 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/process/diffusion.py
+-rw-r--r--   0        0        0     5317 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/process/implant_tables.py
+-rw-r--r--   0        0        0     6800 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/process/pysrim.py
+-rw-r--r--   0        0        0     2182 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/process/silicon.py
+-rw-r--r--   0        0        0     1861 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/process/skew/antimony_si_skew.csv
+-rw-r--r--   0        0        0     1050 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/process/skew/arsenic_si_skew.csv
+-rw-r--r--   0        0        0     1468 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/process/skew/boron_si_skew.csv
+-rw-r--r--   0        0        0     1118 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/process/skew/phosphorus_si_skew.csv
+-rw-r--r--   0        0        0      191 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/sax/__init__.py
+-rw-r--r--   0        0        0    14848 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/sax/build_model.py
+-rw-r--r--   0        0        0     7449 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/sax/femwell_waveguide_model.py
+-rw-r--r--   0        0        0     1571 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/sax/interpolators.py
+-rw-r--r--   0        0        0     6755 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/sax/meep_FDTD_model.py
+-rw-r--r--   0        0        0     4528 2023-05-17 19:15:16.829957 gdsfactory-6.94.0/gdsfactory/simulation/sax/meow_eme_model.py
+-rw-r--r--   0        0        0     5613 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/sax/mlp.py
+-rw-r--r--   0        0        0     7358 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/sax/models.py
+-rw-r--r--   0        0        0    13894 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/sax/parameter.py
+-rwxr-xr-x   0        0        0     2225 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/sax/plot_model.py
+-rw-r--r--   0        0        0     6805 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/sax/read.py
+-rw-r--r--   0        0        0     1350 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/sax/tests/test_mzi.py
+-rw-r--r--   0        0        0     2220 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/sax/tests/test_mzi_lattice.py
+-rw-r--r--   0        0        0     1405 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/sax/tests/test_parameters.py
+-rw-r--r--   0        0        0     1357 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/__init__.py
+-rw-r--r--   0        0        0     1573 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/add_gc.py
+-rw-r--r--   0        0        0     3383 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/circuit.py
+-rw-r--r--   0        0        0      891 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/__init__.py
+-rw-r--r--   0        0        0     1295 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/bend_circular.py
+-rw-r--r--   0        0        0     1388 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/bend_euler.py
+-rw-r--r--   0        0        0     2560 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/coupler.py
+-rw-r--r--   0        0        0     1046 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/coupler_fdtd.py
+-rw-r--r--   0        0        0     1848 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/coupler_ring.py
+-rw-r--r--   0        0        0     1329 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/coupler_ring_fdtd.py
+-rw-r--r--   0        0        0      589 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/coupler_ring_siepic.py
+-rw-r--r--   0        0        0      913 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/gc.py
+-rw-r--r--   0        0        0     2032 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/mmi1x2.py
+-rw-r--r--   0        0        0     1910 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/mmi2x2.py
+-rw-r--r--   0        0        0     2618 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/mzi.py
+-rw-r--r--   0        0        0     1759 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/mzi_siepic.py
+-rw-r--r--   0        0        0      487 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/mzi_thermal.py
+-rw-r--r--   0        0        0     2597 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/ring_double.py
+-rw-r--r--   0        0        0     1665 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/ring_double_siepic.py
+-rw-r--r--   0        0        0     1782 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/ring_single.py
+-rw-r--r--   0        0        0     1416 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/ring_single_siepic.py
+-rw-r--r--   0        0        0     1099 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/straight.py
+-rw-r--r--   0        0        0      800 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/get_transmission.py
+-rw-r--r--   0        0        0     2516 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/model_from_gdsfactory.py
+-rw-r--r--   0        0        0     3841 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/model_from_sparameters.py
+-rw-r--r--   0        0        0     2438 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/plot_circuit.py
+-rw-r--r--   0        0        0     1798 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/plot_circuit_montecarlo.py
+-rw-r--r--   0        0        0     2773 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/plot_model.py
+-rw-r--r--   0        0        0     1261 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_circuit.py
+-rw-r--r--   0        0        0       90 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_circuit/test_circuit_transmission.yml
+-rw-r--r--   0        0        0     1109 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_components.py
+-rw-r--r--   0        0        0       66 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_components/test_circuits_mzi_.yml
+-rw-r--r--   0        0        0       69 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_components/test_circuits_ring_double_.yml
+-rw-r--r--   0        0        0       69 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_components/test_circuits_ring_single_.yml
+-rw-r--r--   0        0        0       92 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_bend_circular_.yml
+-rw-r--r--   0        0        0       92 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_bend_euler_.yml
+-rw-r--r--   0        0        0      412 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_coupler_.yml
+-rw-r--r--   0        0        0      412 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_coupler_ring_.yml
+-rw-r--r--   0        0        0      114 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_gc1550te_.yml
+-rw-r--r--   0        0        0      256 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_mmi1x2_.yml
+-rw-r--r--   0        0        0      460 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_mmi2x2_.yml
+-rw-r--r--   0        0        0      104 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_straight_.yml
+-rw-r--r--   0        0        0      166 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/simphony/types.py
+-rw-r--r--   0        0        0      471 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/sipann/__init__.py
+-rw-r--r--   0        0        0     1376 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/sipann/bend_circular.py
+-rw-r--r--   0        0        0     1465 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/sipann/bend_euler.py
+-rw-r--r--   0        0        0     2508 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/sipann/coupler.py
+-rw-r--r--   0        0        0     1892 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/sipann/coupler_ring.py
+-rw-r--r--   0        0        0      736 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/sipann/straight.py
+-rw-r--r--   0        0        0      100 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/thermal/__init__.py
+-rw-r--r--   0        0        0     7789 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/simulation/thermal/heater.py
+-rw-r--r--   0        0        0     1744 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/snap.py
+-rw-r--r--   0        0        0     4245 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/symbols.py
+-rw-r--r--   0        0        0      524 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/technology/__init__.py
+-rw-r--r--   0        0        0     7607 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/technology/klayout_tech.py
+-rw-r--r--   0        0        0     1078 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/technology/layer_map.py
+-rw-r--r--   0        0        0    16139 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/technology/layer_stack.py
+-rw-r--r--   0        0        0    42133 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/technology/layer_views.py
+-rw-r--r--   0        0        0     1984 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/technology/simulation_settings.py
+-rw-r--r--   0        0        0     1635 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/types.py
+-rw-r--r--   0        0        0    10008 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/typings.py
+-rw-r--r--   0        0        0        0 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/utils/__init__.py
+-rw-r--r--   0        0        0     1342 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/utils/async_utils.py
+-rw-r--r--   0        0        0      376 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/utils/color_utils.py
+-rw-r--r--   0        0        0      558 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/utils/file_utils.py
+-rw-r--r--   0        0        0      185 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/utils/function_utils.py
+-rw-r--r--   0        0        0      684 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/utils/xml_utils.py
+-rw-r--r--   0        0        0     1453 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/utils/yaml_utils.py
+-rw-r--r--   0        0        0     4865 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/watch.py
+-rw-r--r--   0        0        0        0 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/widgets/__init__.py
+-rw-r--r--   0        0        0     7969 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/widgets/layout_viewer.py
+-rw-r--r--   0        0        0     7480 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/gdsfactory/write_cells.py
+-rw-r--r--   0        0        0     5545 2023-05-17 19:15:16.833957 gdsfactory-6.94.0/pyproject.toml
+-rw-r--r--   0        0        0    18772 1970-01-01 00:00:00.000000 gdsfactory-6.94.0/PKG-INFO
```

### Comparing `gdsfactory-6.93.1/LICENSE` & `gdsfactory-6.94.0/LICENSE`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/README.md` & `gdsfactory-6.94.0/README.md`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-# gdsfactory 6.93.1
+# gdsfactory 6.94.0
 
 [![docs](https://github.com/gdsfactory/gdsfactory/actions/workflows/pages.yml/badge.svg)](https://gdsfactory.github.io/gdsfactory/)
 [![PyPI](https://img.shields.io/pypi/v/gdsfactory)](https://pypi.org/project/gdsfactory/)
 [![Conda Version](https://img.shields.io/conda/vn/conda-forge/gdsfactory.svg)](https://anaconda.org/conda-forge/gdsfactory)
 [![Dockerhub](https://img.shields.io/docker/pulls/joamatab/gdsfactory)](https://hub.docker.com/r/joamatab/gdsfactory)
 [![PyPI Python](https://img.shields.io/pypi/pyversions/gdsfactory.svg)](https://pypi.python.org/pypi/gdsfactory)
 [![issues](https://img.shields.io/github/issues/gdsfactory/gdsfactory)](https://github.com/gdsfactory/gdsfactory/issues)
@@ -15,15 +15,17 @@
 [![codecov](https://img.shields.io/codecov/c/github/gdsfactory/gdsfactory)](https://codecov.io/gh/gdsfactory/gdsfactory/tree/main/gdsfactory)
 [![black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)
 [![Binder](https://mybinder.org/badge_logo.svg)](https://mybinder.org/v2/gh/gdsfactory/binder-sandbox/HEAD)
 [![Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/gdsfactory/gdsfactory)
 
 ![logo](https://i.imgur.com/v4wpHpg.png)
 
-gdsfactory is a python library to design chips (Photonics, Analog, Quantum, MEMs, ...), 3D objects for 3D printing or PCBs. It's like Android or Linux for hardware design.
+gdsfactory: An open source platform for end to-end photonic chip design and validation.
+
+gdsfactory is a python library to design chips (Photonics, Analog, Quantum, MEMs, ...), objects for 3D printing or PCBs.
 
 You can describe your hardware in code (python or YAML), verify them (DRC, simulation, extraction) and validate them (to make sure they meet the specifications after fabrication).
 
 ![workflow](https://i.imgur.com/abvxJJw.png)
 
 It provides you and end to end design flow to:
```

### Comparing `gdsfactory-6.93.1/gdsfactory/__init__.py` & `gdsfactory-6.94.0/gdsfactory/__init__.py`

 * *Files 1% similar despite different names*

```diff
@@ -22,15 +22,15 @@
 from toolz import compose
 from gdsfactory.component_layout import Group
 from gdsfactory.path import Path
 
 
 # NOTE: import order matters. Only change the order if you know what you are doing
 from gdsfactory.component import Component, ComponentReference
-from gdsfactory.config import CONF, call_if_func, PATH
+from gdsfactory.config import CONF, call_if_func, PATH, logger
 from gdsfactory.port import Port
 from gdsfactory.cell import cell
 from gdsfactory.cell import cell_without_validator
 from gdsfactory.cell import clear_cache
 from gdsfactory.show import show
 from gdsfactory.read.import_gds import import_gds
 from gdsfactory.cross_section import CrossSection, Section, xsection
@@ -77,15 +77,15 @@
 from gdsfactory.cross_section import get_cross_section_factories
 
 c = components
 
 
 def __getattr__(name):
     if name == "types":
-        warn("gdsfactory.types has been renamed to gdsfactory.typings")
+        warn("gdsfactory.types has been renamed to gdsfactory.typings", stacklevel=3)
         return typings
     raise AttributeError(f"No module named {name}")
 
 
 __all__ = (
     "CONF",
     "Component",
@@ -129,21 +129,22 @@
     "get_layer",
     "get_padding_points",
     "get_generic_pdk",
     "grid",
     "grid_with_text",
     "import_gds",
     "labels",
+    "logger",
     "pack",
     "partial",
     "path",
     "read",
     "routing",
     "show",
     "snap",
     "typings",
     "technology",
     "write_cells",
     "xsection",
     "PATH",
 )
-__version__ = "6.93.1"
+__version__ = "6.94.0"
```

### Comparing `gdsfactory-6.93.1/gdsfactory/add_keepout.py` & `gdsfactory-6.94.0/gdsfactory/add_keepout.py`

 * *Files 1% similar despite different names*

```diff
@@ -36,15 +36,15 @@
                 for polygon in polygons:
                     polygon_keepout = polygon_grow(polygon.points, margin)
                     c.add_polygon(points=polygon_keepout, layer=ko_layer)
 
     return c
 
 
-def test_add_keepout():
+def test_add_keepout() -> None:
     from gdsfactory.components.straight import straight
 
     c = straight()
     polygons = len(c.get_polygons())
     target_layers = [LAYER.WG]
     keepout_layers = [LAYER.NO_TILE_SI]
     # print(len(c.get_polygons()))
```

### Comparing `gdsfactory-6.93.1/gdsfactory/add_labels.py` & `gdsfactory-6.94.0/gdsfactory/add_labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/add_loopback.py` & `gdsfactory-6.94.0/gdsfactory/add_loopback.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/add_padding.py` & `gdsfactory-6.94.0/gdsfactory/add_padding.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/add_pins.py` & `gdsfactory-6.94.0/gdsfactory/add_pins.py`

 * *Files 1% similar despite different names*

```diff
@@ -310,15 +310,15 @@
 
 
 def add_pin_path(
     component: Component,
     port: Port,
     pin_length: float = 2 * nm,
     layer: LayerSpec = "PORT",
-    layer_label: LayerSpec = None,
+    layer_label: Optional[LayerSpec] = None,
 ) -> None:
     """Add half out path pin to a component.
 
     This port type is compatible with SiEPIC pdk.
 
     Args:
         component: to add pin.
@@ -463,14 +463,18 @@
     for port in ports:
         function(component=component, port=port, **kwargs)
     return component
 
 
 add_pins_triangle = partial(add_pins, function=add_pin_triangle)
 add_pins_center = partial(add_pins, function=add_pin_rectangle)
+add_pin_inside1nm = partial(
+    add_pin_rectangle_inside, pin_length=1 * nm, layer_label=None
+)
+add_pins_inside1nm = partial(add_pins, function=add_pin_inside1nm)
 
 
 def add_settings_label(
     component: Component,
     reference: ComponentReference,
     layer_label: LayerSpec = "LABEL_SETTINGS",
 ) -> None:
```

### Comparing `gdsfactory-6.93.1/gdsfactory/add_ports.py` & `gdsfactory-6.94.0/gdsfactory/add_ports.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/add_tapers.py` & `gdsfactory-6.94.0/gdsfactory/add_tapers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/add_tapers_cross_section.py` & `gdsfactory-6.94.0/gdsfactory/add_tapers_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/add_termination.py` & `gdsfactory-6.94.0/gdsfactory/add_termination.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/asserts.py` & `gdsfactory-6.94.0/gdsfactory/asserts.py`

 * *Files 14% similar despite different names*

```diff
@@ -16,28 +16,34 @@
     if not gc.info.get("wavelength"):
         raise ValueError(f"{gc.name} wavelength does not have wavelength")
     if not (0.5 < gc.info["wavelength"] < 5.0):
         raise ValueError(f"{gc.name} wavelength {gc.wavelength} should be in um")
 
     if "o1" not in gc.ports:
         warnings.warn(
-            f"grating_coupler {gc.name} should have a o1 port. It has {gc.ports}"
+            f"grating_coupler {gc.name} should have a o1 port. It has {gc.ports}",
+            stacklevel=3,
         )
     if "o1" in gc.ports and gc.ports["o1"].orientation != 180:
         warnings.warn(
             f"grating_coupler {gc.name} orientation = {gc.ports['o1'].orientation}"
-            " should be 180 degrees"
+            " should be 180 degrees",
+            stacklevel=3,
         )
 
 
 def version(
     requirement: str, current: str = __version__, package_name="gdsfactory"
 ) -> None:
     """Raises error if current version does not match requirement."""
-    import semantic_version
+    try:
+        import semantic_version
+    except ModuleNotFoundError as e:
+        print("You need to 'pip install semantic-version'")
+        raise e
 
     s = semantic_version.SimpleSpec(requirement)
     if not s.match(semantic_version.Version(current)):
         raise ValueError(
             f"{package_name} requirement {requirement}\n"
             f"not compatible your current installed version {current}\n"
             "you can run:\n"
```

### Comparing `gdsfactory-6.93.1/gdsfactory/cell.py` & `gdsfactory-6.94.0/gdsfactory/cell.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,26 +1,30 @@
 """Cell decorator for functions that return a Component."""
 from __future__ import annotations
 
 import functools
 import hashlib
 import inspect
-from typing import Any, Callable, Dict, Optional, Tuple, TypeVar
+from typing import Any, Callable, Dict, Optional, Tuple
+from typing_extensions import ParamSpec
 
 import toolz
 from pydantic import BaseModel, validate_arguments
 
 from gdsfactory.component import Component
 from gdsfactory.name import MAX_NAME_LENGTH, clean_name, get_name_short
 from gdsfactory.serialization import clean_dict, clean_value_name
 
 CACHE: Dict[str, Component] = {}
 
 INFO_VERSION = 2
 
+CellSettings = ParamSpec("CellSettings")
+_F = Callable[CellSettings, Component]
+
 
 class CellReturnTypeError(ValueError):
     pass
 
 
 def clear_cache() -> None:
     """Clears Component CACHE."""
@@ -56,15 +60,15 @@
     full: Dict[str, Any]
     changed: Dict[str, Any]
     default: Dict[str, Any]
 
     child: Optional[Dict[str, Any]] = None
 
 
-def cell_without_validator(func):
+def cell_without_validator(func) -> Callable[CellSettings, Component]:
     """Decorator for Component functions.
 
     Similar to cell decorator but does not enforce argument types.
 
     I recommend using @cell instead.
     """
 
@@ -220,18 +224,15 @@
         component.lock()
         CACHE[name] = component
         return component
 
     return _cell
 
 
-_F = TypeVar("_F", bound=Callable)
-
-
-def cell(func: _F) -> _F:
+def cell(func: Callable[CellSettings, Component]) -> Callable[CellSettings, Component]:
     """Decorator for Component functions.
 
     Wraps cell_without_validator
     Validates type annotations with pydantic.
 
     Implements a cache so that if a component has already been build
     it will return the component from the cache directly.
```

### Comparing `gdsfactory-6.93.1/gdsfactory/circuitviz.py` & `gdsfactory-6.94.0/gdsfactory/circuitviz.py`

 * *Files 5% similar despite different names*

```diff
@@ -74,15 +74,15 @@
     x0: float
     y0: float
     x1: float
     y1: float
     name: str
 
 
-def _enlarge_limits(ax, x, y, w=0.0, h=0.0):
+def _enlarge_limits(ax, x, y, w=0.0, h=0.0) -> None:
     xlim = ax.get_xlim()
     ylim = ax.get_ylim()
     x_min, x_max = xlim if xlim != (0.0, 1.0) else (np.inf, -np.inf)
     y_min, y_max = ylim if ylim != (0.0, 1.0) else (np.inf, -np.inf)
     x_min = min(x_min, x)
     x_max = max(x + w, x_max)
     y_min = min(y_min, y)
@@ -164,15 +164,15 @@
 
     # data['srcs'] = _viz_bk_srcs(objs)
 
     srcs = _get_sources(objs)
     dss = data["dss"] = _get_column_data_sources(srcs)
     netlist = data["netlist"]
 
-    def cb_rect_on_change_data(attr, old, new):
+    def cb_rect_on_change_data(attr, old, new) -> None:
         tags = np.array(old["tag"], dtype=object)
         xy_old = np.stack([old["x"], old["y"]], 1)
         xy_new = np.stack([new["x"], new["y"]], 1)
         if xy_old.shape != xy_new.shape:
             dss["Rect"].data.__dict__.update(old)
             return
         dxs, dys = (xy_new - xy_old).T  # type: ignore
@@ -229,19 +229,19 @@
                             data["x"][i] += dx
                             data["y"][i] += dy
                         else:
                             continue
                     v.data = data
         save_netlist(netlist, netlist_filename)
 
-    def cb_rect_selected_on_change_indices(attr, old, new):
+    def cb_rect_selected_on_change_indices(attr, old, new) -> None:
         if len(new) > 1:
             data["dss"]["Rect"].selected.indices = [new[0]]
 
-    def cp_double_tap(event):
+    def cp_double_tap(event) -> None:
         # only works on 'hierarchical netlists...'
         if netlist is None:
             return
         df = pd.DataFrame(data["dss"]["Rect"].data)
         mask = np.ones_like(df.x, dtype=bool)
         mask &= df.x - df.width / 2 < event.x
         mask &= event.x < df.x + df.width / 2
@@ -319,15 +319,15 @@
     fig.toolbar.active_tap = tap_tool
     fig.toolbar.active_drag = draw_tool
     fig.toolbar.logo = None
     fig.xaxis.major_label_text_font_size = "0pt"
     fig.yaxis.major_label_text_font_size = "0pt"
     fig.match_aspect = True
 
-    def bkapp(doc):
+    def bkapp(doc) -> None:
         doc.add_root(fig)
         data["doc"] = doc
 
     return bkapp
 
 
 def get_ports(component):
@@ -337,15 +337,15 @@
 
 def is_output_port(port):
     if "," in port:
         return is_output_port(port.split(",")[-1])
     return port.startswith("out")
 
 
-def is_input_port(port):
+def is_input_port(port) -> bool:
     return not is_output_port(port)
 
 
 def get_input_ports(component):
     ports = get_ports(component)
     return [p for p in ports if is_input_port(p)]
 
@@ -453,15 +453,17 @@
         p_in, p_out = net
         point1 = port_coords[p_in]
         point2 = port_coords[p_out]
         els += viz_connection(netlist, p_in, p_out, instance_size, point1, point2)
     return els
 
 
-def show_netlist(schematic: SchematicConfiguration, instances: Dict, netlist_filename):
+def show_netlist(
+    schematic: SchematicConfiguration, instances: Dict, netlist_filename
+) -> None:
     global data
     data["netlist"] = schematic
     fig = bp.figure(width=800, height=500)
     app = viz_bk(
         schematic,
         instances=instances,
         fig=fig,
@@ -469,15 +471,15 @@
         netlist_filename=netlist_filename,
     )
     bio.show(app)
 
 
 def update_schematic_plot(
     schematic: SchematicConfiguration, instances: Dict, *args, **kwargs
-):
+) -> None:
     global data
 
     if "doc" in data:
         doc = data["doc"]
         doc.add_next_tick_callback(
             partial(
                 _update_schematic_plot,
@@ -485,21 +487,21 @@
                 instances=instances,
             )
         )
 
 
 def _update_schematic_plot(
     schematic: SchematicConfiguration, instances: Dict, *args, **kwargs
-):
+) -> None:
     srcs = _get_sources(viz_netlist(schematic, instances=instances))
     for k in srcs:
         data["dss"][k].data = srcs[k]
 
 
-def add_instance(name: str, component):
+def add_instance(name: str, component) -> None:
     inst_viz = viz_instance(
         data["netlist"], instance_name=name, component=component, instance_size=0
     )
     srcs = _get_sources([inst_viz])
     for k, src in srcs.items():
         cds: bm.ColumnDataSource = data["dss"][k]
         cds.stream(src)
@@ -507,11 +509,11 @@
 
 def get_deltas(netlist):
     return {
         k: {"dx": p.dx or 0, "dy": p.dy or 0} for k, p in netlist.placements.items()
     }
 
 
-def apply_deltas(netlist, deltas):
+def apply_deltas(netlist, deltas) -> None:
     for k, d in deltas.items():
         netlist.placements[k].dx = d["dx"]
         netlist.placements[k].dy = d["dy"]
```

### Comparing `gdsfactory-6.93.1/gdsfactory/cli.py` & `gdsfactory-6.94.0/gdsfactory/cli.py`

 * *Files 0% similar despite different names*

```diff
@@ -19,15 +19,15 @@
 from gdsfactory.write_cells import write_cells as write_cells_to_separate_gds
 
 try:
     import rich_click as click
 except ImportError:
     import click
 
-VERSION = "6.93.1"
+VERSION = "6.94.0"
 LAYER_LABEL = LAYER.LABEL
 
 
 def print_version(ctx: Context, param: Option, value: bool) -> None:
     """Prints the version."""
     if not value or ctx.resilient_parsing:
         return
```

### Comparing `gdsfactory-6.93.1/gdsfactory/component.py` & `gdsfactory-6.94.0/gdsfactory/component.py`

 * *Files 1% similar despite different names*

```diff
@@ -99,6190 +99,6206 @@
 00000620: 7272 6f72 293a 0a20 2020 2070 6173 730a  rror):.    pass.
 00000630: 0a0a 636c 6173 7320 4d75 7461 6269 6c69  ..class Mutabili
 00000640: 7479 4572 726f 7228 5661 6c75 6545 7272  tyError(ValueErr
 00000650: 6f72 293a 0a20 2020 2070 6173 730a 0a0a  or):.    pass...
 00000660: 6465 6620 5f67 6574 5f64 6570 656e 6465  def _get_depende
 00000670: 6e63 6965 7328 636f 6d70 6f6e 656e 742c  ncies(component,
 00000680: 2072 6566 6572 656e 6365 735f 7365 7429   references_set)
-00000690: 3a0a 2020 2020 666f 7220 7265 6620 696e  :.    for ref in
-000006a0: 2063 6f6d 706f 6e65 6e74 2e72 6566 6572   component.refer
-000006b0: 656e 6365 733a 0a20 2020 2020 2020 2072  ences:.        r
-000006c0: 6566 6572 656e 6365 735f 7365 742e 6164  eferences_set.ad
-000006d0: 6428 7265 662e 7265 665f 6365 6c6c 290a  d(ref.ref_cell).
-000006e0: 2020 2020 2020 2020 5f67 6574 5f64 6570          _get_dep
-000006f0: 656e 6465 6e63 6965 7328 7265 662e 7265  endencies(ref.re
-00000700: 665f 6365 6c6c 2c20 7265 6665 7265 6e63  f_cell, referenc
-00000710: 6573 5f73 6574 290a 0a0a 6d75 7461 6269  es_set)...mutabi
-00000720: 6c69 7479 5f65 7272 6f72 5f6d 6573 7361  lity_error_messa
-00000730: 6765 203d 2022 2222 0a59 6f75 2063 616e  ge = """.You can
-00000740: 6e6f 7420 6d6f 6469 6679 2061 2043 6f6d  not modify a Com
-00000750: 706f 6e65 6e74 2061 6674 6572 2063 7265  ponent after cre
-00000760: 6174 696f 6e20 6173 2069 7420 7769 6c6c  ation as it will
-00000770: 2061 6666 6563 7420 616c 6c20 6f66 2069   affect all of i
-00000780: 7473 2069 6e73 7461 6e63 6573 2e0a 0a43  ts instances...C
-00000790: 7265 6174 6520 6120 6e65 7720 436f 6d70  reate a new Comp
-000007a0: 6f6e 656e 7420 616e 6420 6164 6420 6120  onent and add a 
-000007b0: 7265 6665 7265 6e63 6520 746f 2069 742e  reference to it.
-000007c0: 0a0a 466f 7220 6578 616d 706c 653a 0a0a  ..For example:..
-000007d0: 2320 4241 440a 6320 3d20 6766 2e63 6f6d  # BAD.c = gf.com
-000007e0: 706f 6e65 6e74 732e 6265 6e64 5f65 756c  ponents.bend_eul
-000007f0: 6572 2829 0a63 2e61 6464 5f72 6566 2867  er().c.add_ref(g
-00000800: 662e 636f 6d70 6f6e 656e 7473 2e6d 7a69  f.components.mzi
-00000810: 2829 290a 0a23 2047 4f4f 440a 6320 3d20  ())..# GOOD.c = 
-00000820: 6766 2e43 6f6d 706f 6e65 6e74 2829 0a63  gf.Component().c
-00000830: 2e61 6464 5f72 6566 2867 662e 636f 6d70  .add_ref(gf.comp
-00000840: 6f6e 656e 7473 2e62 656e 645f 6575 6c65  onents.bend_eule
-00000850: 7228 2929 0a63 2e61 6464 5f72 6566 2867  r()).c.add_ref(g
-00000860: 662e 636f 6d70 6f6e 656e 7473 2e6d 7a69  f.components.mzi
-00000870: 2829 290a 2222 220a 0a6d 6f76 655f 6572  ())."""..move_er
-00000880: 726f 725f 6d65 7373 6167 6520 3d20 2222  ror_message = ""
-00000890: 220a 596f 7520 6361 6e6e 6f74 206d 6f76  ".You cannot mov
-000008a0: 6520 6120 436f 6d70 6f6e 656e 742e 2059  e a Component. Y
-000008b0: 6f75 2063 616e 2063 7265 6174 6520 6120  ou can create a 
-000008c0: 6e65 7720 436f 6d70 6f6e 656e 742c 2061  new Component, a
-000008d0: 6464 2061 2072 6566 6572 656e 6365 2074  dd a reference t
-000008e0: 6f20 7468 6520 6f74 6865 7220 436f 6d70  o the other Comp
-000008f0: 6f6e 656e 7420 616e 6420 7468 656e 206d  onent and then m
-00000900: 6f76 6520 7468 6520 7265 6665 7265 6e63  ove the referenc
-00000910: 652e 0a0a 466f 7220 6578 616d 706c 653a  e...For example:
-00000920: 0a0a 2320 4241 440a 6320 3d20 6766 2e63  ..# BAD.c = gf.c
-00000930: 6f6d 706f 6e65 6e74 732e 7374 7261 6967  omponents.straig
-00000940: 6874 2829 0a63 2e78 6d69 6e20 3d20 3130  ht().c.xmin = 10
-00000950: 0a0a 2320 474f 4f44 0a63 203d 2067 662e  ..# GOOD.c = gf.
-00000960: 436f 6d70 6f6e 656e 7428 290a 7265 6620  Component().ref 
-00000970: 3d20 632e 6164 645f 7265 6628 6766 2e63  = c.add_ref(gf.c
-00000980: 6f6d 706f 6e65 6e74 732e 7374 7261 6967  omponents.straig
-00000990: 6874 2829 2920 2320 6f72 2072 6566 203d  ht()) # or ref =
-000009a0: 2063 203c 3c20 6766 2e63 6f6d 706f 6e65   c << gf.compone
-000009b0: 6e74 732e 7374 7261 6967 6874 2829 0a72  nts.straight().r
-000009c0: 6566 2e78 6d69 6e20 3d20 3130 0a22 2222  ef.xmin = 10."""
-000009d0: 0a0a 5061 7468 5479 7065 203d 2055 6e69  ..PathType = Uni
-000009e0: 6f6e 5b73 7472 2c20 5061 7468 5d0a 466c  on[str, Path].Fl
-000009f0: 6f61 7432 203d 2054 7570 6c65 5b66 6c6f  oat2 = Tuple[flo
-00000a00: 6174 2c20 666c 6f61 745d 0a4c 6179 6572  at, float].Layer
-00000a10: 203d 2054 7570 6c65 5b69 6e74 2c20 696e   = Tuple[int, in
-00000a20: 745d 0a4c 6179 6572 7320 3d20 5475 706c  t].Layers = Tupl
-00000a30: 655b 4c61 7965 722c 202e 2e2e 5d0a 4c61  e[Layer, ...].La
-00000a40: 7965 7253 7065 6320 3d20 556e 696f 6e5b  yerSpec = Union[
-00000a50: 7374 722c 2069 6e74 2c20 4c61 7965 722c  str, int, Layer,
-00000a60: 204e 6f6e 655d 0a0a 5f74 696d 6573 7461   None].._timesta
-00000a70: 6d70 3230 3139 203d 2064 6174 6574 696d  mp2019 = datetim
-00000a80: 652e 6461 7465 7469 6d65 2e66 726f 6d74  e.datetime.fromt
-00000a90: 696d 6573 7461 6d70 2831 3537 3230 3134  imestamp(1572014
-00000aa0: 3139 322e 3832 3733 290a 4d41 585f 4e41  192.8273).MAX_NA
-00000ab0: 4d45 5f4c 454e 4754 4820 3d20 3332 0a0a  ME_LENGTH = 32..
-00000ac0: 0a64 6566 205f 726e 6428 6172 722c 2070  .def _rnd(arr, p
-00000ad0: 7265 6369 7369 6f6e 3d31 652d 3429 3a0a  recision=1e-4):.
-00000ae0: 2020 2020 6172 7220 3d20 6e70 2e61 7363      arr = np.asc
-00000af0: 6f6e 7469 6775 6f75 7361 7272 6179 2861  ontiguousarray(a
-00000b00: 7272 290a 2020 2020 6e64 6967 6974 7320  rr).    ndigits 
-00000b10: 3d20 726f 756e 6428 2d6d 6174 682e 6c6f  = round(-math.lo
-00000b20: 6731 3028 7072 6563 6973 696f 6e29 290a  g10(precision)).
-00000b30: 2020 2020 7265 7475 726e 206e 702e 6173      return np.as
-00000b40: 636f 6e74 6967 756f 7573 6172 7261 7928  contiguousarray(
-00000b50: 6172 722e 726f 756e 6428 6e64 6967 6974  arr.round(ndigit
-00000b60: 7329 202f 2070 7265 6369 7369 6f6e 2c20  s) / precision, 
-00000b70: 6474 7970 653d 6e70 2e69 6e74 3634 290a  dtype=np.int64).
-00000b80: 0a0a 636c 6173 7320 436f 6d70 6f6e 656e  ..class Componen
-00000b90: 7428 5f47 656f 6d65 7472 7948 656c 7065  t(_GeometryHelpe
-00000ba0: 7229 3a0a 2020 2020 2222 2241 2043 6f6d  r):.    """A Com
-00000bb0: 706f 6e65 6e74 2069 7320 616e 2065 6d70  ponent is an emp
-00000bc0: 7479 2063 616e 7661 7320 7768 6572 6520  ty canvas where 
-00000bd0: 796f 7520 6164 6420 706f 6c79 676f 6e73  you add polygons
-00000be0: 2c20 7265 6665 7265 6e63 6573 2061 6e64  , references and
-00000bf0: 2070 6f72 7473 205c 0a20 2020 2020 2020   ports \.       
-00000c00: 2020 2020 2028 746f 2063 6f6e 6e65 6374       (to connect
-00000c10: 2074 6f20 6f74 6865 7220 636f 6d70 6f6e   to other compon
-00000c20: 656e 7473 292e 0a0a 2020 2020 2d20 7374  ents)...    - st
-00000c30: 6f72 6573 2073 6574 7469 6e67 7320 7468  ores settings th
-00000c40: 6174 2079 6f75 2075 7365 2074 6f20 6275  at you use to bu
-00000c50: 696c 6420 7468 6520 636f 6d70 6f6e 656e  ild the componen
-00000c60: 740a 2020 2020 2d20 7374 6f72 6573 2069  t.    - stores i
-00000c70: 6e66 6f20 7468 6174 2079 6f75 2077 616e  nfo that you wan
-00000c80: 7420 746f 2075 7365 0a20 2020 202d 2063  t to use.    - c
-00000c90: 616e 2072 6574 7572 6e20 706f 7274 7320  an return ports 
-00000ca0: 6279 2074 7970 6520 286f 7074 6963 616c  by type (optical
-00000cb0: 2c20 656c 6563 7472 6963 616c 202e 2e2e  , electrical ...
-00000cc0: 290a 2020 2020 2d20 6361 6e20 7265 7475  ).    - can retu
-00000cd0: 726e 206e 6574 6c69 7374 2066 6f72 2063  rn netlist for c
-00000ce0: 6972 6375 6974 2073 696d 756c 6174 696f  ircuit simulatio
-00000cf0: 6e0a 2020 2020 2d20 6361 6e20 7772 6974  n.    - can writ
-00000d00: 6520 746f 2047 4453 2c20 4f41 5349 530a  e to GDS, OASIS.
-00000d10: 2020 2020 2d20 6361 6e20 7368 6f77 2069      - can show i
-00000d20: 6e20 4b4c 6179 6f75 742c 206d 6174 706c  n KLayout, matpl
-00000d30: 6f74 6c69 622c 2033 442c 2051 5420 7669  otlib, 3D, QT vi
-00000d40: 6577 6572 2c20 686f 6c6f 7669 6577 730a  ewer, holoviews.
-00000d50: 2020 2020 2d20 6361 6e20 7265 7475 726e      - can return
-00000d60: 2063 6f70 792c 206d 6972 726f 722c 2066   copy, mirror, f
-00000d70: 6c61 7474 656e 6564 2028 6e6f 2072 6566  lattened (no ref
-00000d80: 6572 656e 6365 7329 0a0a 2020 2020 4172  erences)..    Ar
-00000d90: 6773 3a0a 2020 2020 2020 2020 6e61 6d65  gs:.        name
-00000da0: 3a20 636f 6d70 6f6e 656e 745f 6e61 6d65  : component_name
-00000db0: 2e20 5573 6520 4063 656c 6c20 6465 636f  . Use @cell deco
-00000dc0: 7261 746f 7220 666f 7220 6175 746f 2d6e  rator for auto-n
-00000dd0: 616d 696e 672e 0a20 2020 2020 2020 2077  aming..        w
-00000de0: 6974 685f 7575 6964 3a20 6164 6473 2075  ith_uuid: adds u
-00000df0: 6e69 7175 6520 6964 656e 7469 6669 6572  nique identifier
-00000e00: 2e0a 0a20 2020 2050 726f 7065 7274 6965  ...    Propertie
-00000e10: 733a 0a20 2020 2020 2020 2069 6e66 6f3a  s:.        info:
-00000e20: 2064 6963 7469 6f6e 6172 7920 7468 6174   dictionary that
-00000e30: 2069 6e63 6c75 6465 730a 2020 2020 2020   includes.      
-00000e40: 2020 2020 2020 2d20 6465 7269 7665 6420        - derived 
-00000e50: 7072 6f70 6572 7469 6573 0a20 2020 2020  properties.     
-00000e60: 2020 2020 2020 202d 2065 7874 6572 6e61         - externa
-00000e70: 6c20 6d65 7461 6461 7461 2028 7465 7374  l metadata (test
-00000e80: 5f70 726f 746f 636f 6c2c 2064 6f63 732c  _protocol, docs,
-00000e90: 202e 2e2e 290a 2020 2020 2020 2020 2020   ...).          
-00000ea0: 2020 2d20 7369 6d75 6c61 7469 6f6e 5f73    - simulation_s
-00000eb0: 6574 7469 6e67 730a 2020 2020 2020 2020  ettings.        
-00000ec0: 2020 2020 2d20 6675 6e63 7469 6f6e 5f6e      - function_n
-00000ed0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-00000ee0: 2d20 6e61 6d65 3a20 666f 7220 7468 6520  - name: for the 
-00000ef0: 636f 6d70 6f6e 656e 740a 0a20 2020 2020  component..     
-00000f00: 2020 2073 6574 7469 6e67 733a 0a20 2020     settings:.   
-00000f10: 2020 2020 2020 2020 2066 756c 6c3a 2066           full: f
-00000f20: 756c 6c20 7365 7474 696e 6773 2070 6173  ull settings pas
-00000f30: 7365 6420 746f 2074 6865 2066 756e 6374  sed to the funct
-00000f40: 696f 6e20 746f 2063 7265 6174 6520 636f  ion to create co
-00000f50: 6d70 6f6e 656e 742e 0a20 2020 2020 2020  mponent..       
-00000f60: 2020 2020 2063 6861 6e67 6564 3a20 6368       changed: ch
-00000f70: 616e 6765 6420 7365 7474 696e 6773 2e0a  anged settings..
-00000f80: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00000f90: 756c 743a 2064 6566 6175 6c74 2063 6f6d  ult: default com
-00000fa0: 706f 6e65 6e74 2073 6574 7469 6e67 732e  ponent settings.
-00000fb0: 0a20 2020 2020 2020 2020 2020 2063 6869  .            chi
-00000fc0: 6c64 3a20 6469 6374 2069 6e66 6f20 6672  ld: dict info fr
-00000fd0: 6f6d 2074 6865 2063 6869 6c64 7265 6e2c  om the children,
-00000fe0: 2069 6620 616e 792e 0a20 2020 2022 2222   if any..    """
-00000ff0: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-00001000: 5f5f 280a 2020 2020 2020 2020 7365 6c66  __(.        self
-00001010: 2c0a 2020 2020 2020 2020 6e61 6d65 3a20  ,.        name: 
-00001020: 7374 7220 3d20 2255 6e6e 616d 6564 222c  str = "Unnamed",
-00001030: 0a20 2020 2020 2020 2077 6974 685f 7575  .        with_uu
-00001040: 6964 3a20 626f 6f6c 203d 2046 616c 7365  id: bool = False
-00001050: 2c0a 2020 2020 2920 2d3e 204e 6f6e 653a  ,.    ) -> None:
-00001060: 0a20 2020 2020 2020 2022 2222 496e 6974  .        """Init
-00001070: 6961 6c69 7a65 2074 6865 2043 6f6d 706f  ialize the Compo
-00001080: 6e65 6e74 206f 626a 6563 742e 2222 220a  nent object.""".
-00001090: 2020 2020 2020 2020 7365 6c66 2e75 6964          self.uid
-000010a0: 203d 2073 7472 2875 7569 642e 7575 6964   = str(uuid.uuid
-000010b0: 3428 2929 5b3a 385d 0a20 2020 2020 2020  4())[:8].       
-000010c0: 2069 6620 7769 7468 5f75 7569 6420 6f72   if with_uuid or
-000010d0: 206e 616d 6520 3d3d 2022 556e 6e61 6d65   name == "Unname
-000010e0: 6422 3a0a 2020 2020 2020 2020 2020 2020  d":.            
-000010f0: 6e61 6d65 202b 3d20 6622 5f7b 7365 6c66  name += f"_{self
-00001100: 2e75 6964 7d22 0a0a 2020 2020 2020 2020  .uid}"..        
-00001110: 7365 6c66 2e5f 6365 6c6c 203d 2067 6473  self._cell = gds
-00001120: 746b 2e43 656c 6c28 6e61 6d65 3d6e 616d  tk.Cell(name=nam
-00001130: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
-00001140: 6e61 6d65 203d 206e 616d 650a 2020 2020  name = name.    
-00001150: 2020 2020 7365 6c66 2e69 6e66 6f3a 2044      self.info: D
-00001160: 6963 745b 7374 722c 2041 6e79 5d20 3d20  ict[str, Any] = 
-00001170: 7b7d 0a0a 2020 2020 2020 2020 7365 6c66  {}..        self
-00001180: 2e73 6574 7469 6e67 733a 2044 6963 745b  .settings: Dict[
-00001190: 7374 722c 2041 6e79 5d20 3d20 7b7d 0a20  str, Any] = {}. 
-000011a0: 2020 2020 2020 2073 656c 662e 5f6c 6f63         self._loc
-000011b0: 6b65 6420 3d20 4661 6c73 650a 2020 2020  ked = False.    
-000011c0: 2020 2020 7365 6c66 2e67 6574 5f63 6869      self.get_chi
-000011d0: 6c64 5f6e 616d 6520 3d20 4661 6c73 650a  ld_name = False.
-000011e0: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
-000011f0: 6665 7265 6e63 655f 6e61 6d65 735f 636f  ference_names_co
-00001200: 756e 7465 7220 3d20 436f 756e 7465 7228  unter = Counter(
-00001210: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-00001220: 7265 6665 7265 6e63 655f 6e61 6d65 735f  reference_names_
-00001230: 7573 6564 203d 2073 6574 2829 0a20 2020  used = set().   
-00001240: 2020 2020 2073 656c 662e 5f6e 616d 6564       self._named
-00001250: 5f72 6566 6572 656e 6365 7320 3d20 7b7d  _references = {}
-00001260: 0a20 2020 2020 2020 2073 656c 662e 5f72  .        self._r
-00001270: 6566 6572 656e 6365 7320 3d20 5b5d 0a0a  eferences = []..
-00001280: 2020 2020 2020 2020 7365 6c66 2e70 6f72          self.por
-00001290: 7473 203d 207b 7d0a 0a20 2020 2040 7072  ts = {}..    @pr
-000012a0: 6f70 6572 7479 0a20 2020 2064 6566 2072  operty.    def r
-000012b0: 6566 6572 656e 6365 7328 7365 6c66 293a  eferences(self):
-000012c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000012d0: 7365 6c66 2e5f 7265 6665 7265 6e63 6573  self._references
-000012e0: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-000012f0: 2020 2020 6465 6620 706f 6c79 676f 6e73      def polygons
-00001300: 2873 656c 6629 202d 3e20 4c69 7374 5b50  (self) -> List[P
-00001310: 6f6c 7967 6f6e 5d3a 0a20 2020 2020 2020  olygon]:.       
-00001320: 2072 6574 7572 6e20 7365 6c66 2e5f 6365   return self._ce
-00001330: 6c6c 2e70 6f6c 7967 6f6e 730a 0a20 2020  ll.polygons..   
-00001340: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-00001350: 6566 2061 7265 6128 7365 6c66 2920 2d3e  ef area(self) ->
-00001360: 2066 6c6f 6174 3a0a 2020 2020 2020 2020   float:.        
-00001370: 7265 7475 726e 2073 656c 662e 5f63 656c  return self._cel
-00001380: 6c2e 6172 6561 0a0a 2020 2020 4070 726f  l.area..    @pro
-00001390: 7065 7274 790a 2020 2020 6465 6620 6c61  perty.    def la
-000013a0: 6265 6c73 2873 656c 6629 202d 3e20 4c69  bels(self) -> Li
-000013b0: 7374 5b4c 6162 656c 5d3a 0a20 2020 2020  st[Label]:.     
-000013c0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-000013d0: 6365 6c6c 2e6c 6162 656c 730a 0a20 2020  cell.labels..   
-000013e0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-000013f0: 6566 2070 6174 6873 2873 656c 6629 3a0a  ef paths(self):.
-00001400: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00001410: 656c 662e 5f63 656c 6c2e 7061 7468 730a  elf._cell.paths.
-00001420: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-00001430: 2020 2064 6566 206e 616d 6528 7365 6c66     def name(self
-00001440: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
-00001450: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
-00001460: 656c 6c2e 6e61 6d65 0a0a 2020 2020 406e  ell.name..    @n
-00001470: 616d 652e 7365 7474 6572 0a20 2020 2064  ame.setter.    d
-00001480: 6566 206e 616d 6528 7365 6c66 2c20 7661  ef name(self, va
-00001490: 6c75 6529 3a0a 2020 2020 2020 2020 7365  lue):.        se
-000014a0: 6c66 2e5f 6365 6c6c 2e6e 616d 6520 3d20  lf._cell.name = 
-000014b0: 7661 6c75 650a 0a20 2020 2064 6566 205f  value..    def _
-000014c0: 5f69 7465 725f 5f28 7365 6c66 293a 0a20  _iter__(self):. 
-000014d0: 2020 2020 2020 2022 2222 596f 7520 6361         """You ca
-000014e0: 6e20 6974 6572 6174 6520 6f76 6572 2070  n iterate over p
-000014f0: 6f6c 7967 6f6e 732c 2070 6174 6873 2c20  olygons, paths, 
-00001500: 6c61 6265 6c73 2061 6e64 2072 6566 6572  labels and refer
-00001510: 656e 6365 732e 2222 220a 2020 2020 2020  ences.""".      
-00001520: 2020 7265 7475 726e 2069 7465 7274 6f6f    return itertoo
-00001530: 6c73 2e63 6861 696e 2873 656c 662e 706f  ls.chain(self.po
-00001540: 6c79 676f 6e73 2c20 7365 6c66 2e70 6174  lygons, self.pat
-00001550: 6873 2c20 7365 6c66 2e6c 6162 656c 732c  hs, self.labels,
-00001560: 2073 656c 662e 7265 6665 7265 6e63 6573   self.references
-00001570: 290a 0a20 2020 2064 6566 2067 6574 5f70  )..    def get_p
-00001580: 6f6c 7967 6f6e 7328 0a20 2020 2020 2020  olygons(.       
-00001590: 2073 656c 662c 0a20 2020 2020 2020 2062   self,.        b
-000015a0: 795f 7370 6563 3a20 556e 696f 6e5b 626f  y_spec: Union[bo
-000015b0: 6f6c 2c20 5475 706c 655b 696e 742c 2069  ol, Tuple[int, i
-000015c0: 6e74 5d5d 203d 2046 616c 7365 2c0a 2020  nt]] = False,.  
-000015d0: 2020 2020 2020 6465 7074 683a 204f 7074        depth: Opt
-000015e0: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
-000015f0: 652c 0a20 2020 2020 2020 2069 6e63 6c75  e,.        inclu
-00001600: 6465 5f70 6174 6873 3a20 626f 6f6c 203d  de_paths: bool =
-00001610: 2054 7275 652c 0a20 2020 2020 2020 2061   True,.        a
-00001620: 735f 6172 7261 793a 2062 6f6f 6c20 3d20  s_array: bool = 
-00001630: 5472 7565 2c0a 2020 2020 2920 2d3e 2055  True,.    ) -> U
-00001640: 6e69 6f6e 5b4c 6973 745b 506f 6c79 676f  nion[List[Polygo
-00001650: 6e5d 2c20 4469 6374 5b54 7570 6c65 5b69  n], Dict[Tuple[i
-00001660: 6e74 2c20 696e 745d 2c20 4c69 7374 5b50  nt, int], List[P
-00001670: 6f6c 7967 6f6e 5d5d 5d3a 0a20 2020 2020  olygon]]]:.     
-00001680: 2020 2022 2222 5265 7475 726e 2061 206c     """Return a l
-00001690: 6973 7420 6f66 2070 6f6c 7967 6f6e 7320  ist of polygons 
-000016a0: 696e 2074 6869 7320 6365 6c6c 2e0a 0a20  in this cell... 
-000016b0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-000016c0: 2020 2020 2020 2020 2062 795f 7370 6563           by_spec
-000016d0: 3a20 626f 6f6c 206f 7220 6c61 7965 720a  : bool or layer.
-000016e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000016f0: 4966 2054 7275 652c 2074 6865 2072 6574  If True, the ret
-00001700: 7572 6e20 7661 6c75 6520 6973 2061 2064  urn value is a d
-00001710: 6963 7469 6f6e 6172 7920 7769 7468 2074  ictionary with t
-00001720: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
-00001730: 2020 2070 6f6c 7967 6f6e 7320 6f66 2065     polygons of e
-00001740: 6163 6820 696e 6469 7669 6475 616c 2070  ach individual p
-00001750: 6169 7220 286c 6179 6572 2c20 6461 7461  air (layer, data
-00001760: 7479 7065 292c 2077 6869 6368 0a20 2020  type), which.   
-00001770: 2020 2020 2020 2020 2020 2020 2061 7265               are
-00001780: 2075 7365 6420 6173 206b 6579 732e 2020   used as keys.  
-00001790: 4966 2073 6574 2074 6f20 6120 7475 706c  If set to a tupl
-000017a0: 6520 6f66 2028 6c61 7965 722c 2064 6174  e of (layer, dat
-000017b0: 6174 7970 6529 2c0a 2020 2020 2020 2020  atype),.        
-000017c0: 2020 2020 2020 2020 6f6e 6c79 2070 6f6c          only pol
-000017d0: 7967 6f6e 7320 7769 7468 2074 6861 7420  ygons with that 
-000017e0: 7370 6563 6966 6963 6174 696f 6e20 6172  specification ar
-000017f0: 6520 7265 7475 726e 6564 2e0a 2020 2020  e returned..    
-00001800: 2020 2020 2020 2020 6465 7074 683a 2069          depth: i
-00001810: 6e74 6567 6572 206f 7220 4e6f 6e65 0a20  nteger or None. 
-00001820: 2020 2020 2020 2020 2020 2020 2020 2049                 I
-00001830: 6620 6e6f 7420 4e6f 6e65 2c20 6465 6669  f not None, defi
-00001840: 6e65 7320 6672 6f6d 2068 6f77 206d 616e  nes from how man
-00001850: 7920 7265 6665 7265 6e63 6520 6c65 7665  y reference leve
-00001860: 6c73 2074 6f0a 2020 2020 2020 2020 2020  ls to.          
-00001870: 2020 2020 2020 7265 7472 6965 7665 2070        retrieve p
-00001880: 6f6c 7967 6f6e 732e 2020 5265 6665 7265  olygons.  Refere
-00001890: 6e63 6573 2062 656c 6f77 2074 6869 7320  nces below this 
-000018a0: 6c65 7665 6c20 7769 6c6c 2072 6573 756c  level will resul
-000018b0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-000018c0: 2020 696e 2061 2062 6f75 6e64 696e 6720    in a bounding 
-000018d0: 626f 782e 2020 4966 2060 6279 5f73 7065  box.  If `by_spe
-000018e0: 6360 2069 7320 5472 7565 2074 6865 206b  c` is True the k
-000018f0: 6579 2077 696c 6c20 6265 2074 6865 0a20  ey will be the. 
-00001900: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00001910: 616d 6520 6f66 2074 6869 7320 6365 6c6c  ame of this cell
-00001920: 2e0a 2020 2020 2020 2020 2020 2020 696e  ..            in
-00001930: 636c 7564 655f 7061 7468 733a 2049 6620  clude_paths: If 
-00001940: 5472 7565 2c20 706f 6c79 676f 6e61 6c20  True, polygonal 
-00001950: 7265 7072 6573 656e 7461 7469 6f6e 206f  representation o
-00001960: 6620 7061 7468 7320 6172 6520 616c 736f  f paths are also
-00001970: 2069 6e63 6c75 6465 6420 696e 2074 6865   included in the
-00001980: 2072 6573 756c 742e 0a20 2020 2020 2020   result..       
-00001990: 2020 2020 2061 735f 6172 7261 793a 2077       as_array: w
-000019a0: 6865 6e20 6173 5f61 7272 6179 3d66 616c  hen as_array=fal
-000019b0: 7365 2c20 7265 7475 726e 2074 6865 2050  se, return the P
-000019c0: 6f6c 7967 6f6e 206f 626a 6563 7473 2069  olygon objects i
-000019d0: 6e73 7465 6164 2e0a 2020 2020 2020 2020  nstead..        
-000019e0: 2020 2020 2020 2020 706f 6c79 676f 6e20          polygon 
-000019f0: 6f62 6a65 6374 7320 6861 7665 206d 6f72  objects have mor
-00001a00: 6520 696e 666f 726d 6174 696f 6e20 2865  e information (e
-00001a10: 7370 6563 6961 6c6c 7920 7768 656e 2062  specially when b
-00001a20: 795f 7370 6563 3d46 616c 7365 2920 616e  y_spec=False) an
-00001a30: 6420 6172 6520 6661 7374 6572 2074 6f20  d are faster to 
-00001a40: 7265 7472 6965 7665 2e0a 0a20 2020 2020  retrieve...     
-00001a50: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-00001a60: 2020 2020 2020 206f 7574 3a20 6c69 7374         out: list
-00001a70: 206f 6620 6172 7261 792d 6c69 6b65 5b4e   of array-like[N
-00001a80: 5d5b 325d 206f 7220 6469 6374 696f 6e61  ][2] or dictiona
-00001a90: 7279 0a20 2020 2020 2020 2020 2020 2020  ry.             
-00001aa0: 2020 204c 6973 7420 636f 6e74 6169 6e69     List containi
-00001ab0: 6e67 2074 6865 2063 6f6f 7264 696e 6174  ng the coordinat
-00001ac0: 6573 206f 6620 7468 6520 7665 7274 6963  es of the vertic
-00001ad0: 6573 206f 6620 6561 6368 0a20 2020 2020  es of each.     
-00001ae0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-00001af0: 6f6e 2c20 6f72 2064 6963 7469 6f6e 6172  on, or dictionar
-00001b00: 7920 7769 7468 2077 6974 6820 7468 6520  y with with the 
-00001b10: 6c69 7374 206f 6620 706f 6c79 676f 6e73  list of polygons
-00001b20: 2028 6966 0a20 2020 2020 2020 2020 2020   (if.           
-00001b30: 2020 2020 2060 6279 5f73 7065 6360 2069       `by_spec` i
-00001b40: 7320 5472 7565 292e 0a0a 2020 2020 2020  s True)...      
-00001b50: 2020 4e6f 7465 3a0a 2020 2020 2020 2020    Note:.        
-00001b60: 2020 2020 496e 7374 616e 6365 7320 6f66      Instances of
-00001b70: 2060 466c 6578 5061 7468 6020 616e 6420   `FlexPath` and 
-00001b80: 6052 6f62 7573 7450 6174 6860 2061 7265  `RobustPath` are
-00001b90: 2061 6c73 6f20 696e 636c 7564 6564 2069   also included i
-00001ba0: 6e0a 2020 2020 2020 2020 2020 2020 7468  n.            th
-00001bb0: 6520 7265 7375 6c74 2062 7920 636f 6d70  e result by comp
-00001bc0: 7574 696e 6720 7468 6569 7220 706f 6c79  uting their poly
-00001bd0: 676f 6e61 6c20 626f 756e 6461 7279 2e0a  gonal boundary..
-00001be0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00001bf0: 2020 2020 7265 7475 726e 2067 6574 5f70      return get_p
-00001c00: 6f6c 7967 6f6e 7328 0a20 2020 2020 2020  olygons(.       
-00001c10: 2020 2020 2069 6e73 7461 6e63 653d 7365       instance=se
-00001c20: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
-00001c30: 6279 5f73 7065 633d 6279 5f73 7065 632c  by_spec=by_spec,
-00001c40: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
-00001c50: 7468 3d64 6570 7468 2c0a 2020 2020 2020  th=depth,.      
-00001c60: 2020 2020 2020 696e 636c 7564 655f 7061        include_pa
-00001c70: 7468 733d 696e 636c 7564 655f 7061 7468  ths=include_path
-00001c80: 732c 0a20 2020 2020 2020 2020 2020 2061  s,.            a
-00001c90: 735f 6172 7261 793d 6173 5f61 7272 6179  s_array=as_array
-00001ca0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00001cb0: 2064 6566 2067 6574 5f64 6570 656e 6465   def get_depende
-00001cc0: 6e63 6965 7328 7365 6c66 2c20 7265 6375  ncies(self, recu
-00001cd0: 7273 6976 653a 2062 6f6f 6c20 3d20 4661  rsive: bool = Fa
-00001ce0: 6c73 6529 202d 3e20 4c69 7374 5b43 6f6d  lse) -> List[Com
-00001cf0: 706f 6e65 6e74 5d3a 0a20 2020 2020 2020  ponent]:.       
-00001d00: 2022 2222 5265 7475 726e 2061 2073 6574   """Return a set
-00001d10: 206f 6620 7468 6520 6365 6c6c 7320 696e   of the cells in
-00001d20: 636c 7564 6564 2069 6e20 7468 6973 2063  cluded in this c
-00001d30: 656c 6c20 6173 2072 6566 6572 656e 6365  ell as reference
-00001d40: 732e 0a0a 2020 2020 2020 2020 4172 6773  s...        Args
-00001d50: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00001d60: 6375 7273 6976 653a 2049 6620 5472 7565  cursive: If True
-00001d70: 2072 6574 7572 6e73 2064 6570 656e 6465   returns depende
-00001d80: 6e63 6965 7320 7265 6375 7273 6976 656c  ncies recursivel
-00001d90: 792e 0a0a 2020 2020 2020 2020 5265 7475  y...        Retu
-00001da0: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
-00001db0: 206f 7574 3a20 6c69 7374 206f 6620 436f   out: list of Co
-00001dc0: 6d70 6f6e 656e 7473 2072 6566 6572 656e  mponents referen
-00001dd0: 6365 6420 6279 2074 6869 7320 436f 6d70  ced by this Comp
-00001de0: 6f6e 656e 742e 0a20 2020 2020 2020 2022  onent..        "
-00001df0: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
-00001e00: 7420 7265 6375 7273 6976 653a 0a20 2020  t recursive:.   
-00001e10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00001e20: 6c69 7374 287b 7265 662e 7061 7265 6e74  list({ref.parent
-00001e30: 2066 6f72 2072 6566 2069 6e20 7365 6c66   for ref in self
-00001e40: 2e72 6566 6572 656e 6365 737d 290a 0a20  .references}).. 
-00001e50: 2020 2020 2020 2072 6566 6572 656e 6365         reference
-00001e60: 735f 7365 7420 3d20 7365 7428 290a 2020  s_set = set().  
-00001e70: 2020 2020 2020 5f67 6574 5f64 6570 656e        _get_depen
-00001e80: 6465 6e63 6965 7328 7365 6c66 2c20 7265  dencies(self, re
-00001e90: 6665 7265 6e63 6573 5f73 6574 3d72 6566  ferences_set=ref
-00001ea0: 6572 656e 6365 735f 7365 7429 0a20 2020  erences_set).   
-00001eb0: 2020 2020 2072 6574 7572 6e20 6c69 7374       return list
-00001ec0: 2872 6566 6572 656e 6365 735f 7365 7429  (references_set)
-00001ed0: 0a0a 2020 2020 6465 6620 6765 745f 636f  ..    def get_co
-00001ee0: 6d70 6f6e 656e 745f 7370 6563 2873 656c  mponent_spec(sel
-00001ef0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-00001f00: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
-00001f10: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-00001f20: 2020 2022 636f 6d70 6f6e 656e 7422 3a20     "component": 
-00001f30: 7365 6c66 2e73 6574 7469 6e67 732e 6675  self.settings.fu
-00001f40: 6e63 7469 6f6e 5f6e 616d 652c 0a20 2020  nction_name,.   
-00001f50: 2020 2020 2020 2020 2020 2020 2022 7365               "se
-00001f60: 7474 696e 6773 223a 2073 656c 662e 7365  ttings": self.se
-00001f70: 7474 696e 6773 2e63 6861 6e67 6564 2c0a  ttings.changed,.
-00001f80: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-00001f90: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00001fa0: 662e 7365 7474 696e 6773 0a20 2020 2020  f.settings.     
-00001fb0: 2020 2020 2020 2065 6c73 6520 7b22 636f         else {"co
-00001fc0: 6d70 6f6e 656e 7422 3a20 7365 6c66 2e6e  mponent": self.n
-00001fd0: 616d 652c 2022 7365 7474 696e 6773 223a  ame, "settings":
-00001fe0: 207b 7d7d 0a20 2020 2020 2020 2029 0a0a   {}}.        )..
-00001ff0: 2020 2020 6465 6620 5f5f 6765 7469 7465      def __getite
-00002000: 6d5f 5f28 7365 6c66 2c20 6b65 7929 3a0a  m__(self, key):.
-00002010: 2020 2020 2020 2020 2222 2241 6363 6573          """Acces
-00002020: 7320 7265 6665 7265 6e63 6520 706f 7274  s reference port
-00002030: 732e 2222 220a 2020 2020 2020 2020 6966  s.""".        if
-00002040: 206b 6579 206e 6f74 2069 6e20 7365 6c66   key not in self
-00002050: 2e70 6f72 7473 3a0a 2020 2020 2020 2020  .ports:.        
-00002060: 2020 2020 706f 7274 7320 3d20 6c69 7374      ports = list
-00002070: 2873 656c 662e 706f 7274 732e 6b65 7973  (self.ports.keys
-00002080: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
-00002090: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000020a0: 2866 227b 6b65 7921 727d 206e 6f74 2069  (f"{key!r} not i
-000020b0: 6e20 7b70 6f72 7473 7d22 290a 0a20 2020  n {ports}")..   
-000020c0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000020d0: 2e70 6f72 7473 5b6b 6579 5d0a 0a20 2020  .ports[key]..   
-000020e0: 2064 6566 205f 5f6c 7368 6966 745f 5f28   def __lshift__(
-000020f0: 7365 6c66 2c20 656c 656d 656e 7429 3a0a  self, element):.
-00002100: 2020 2020 2020 2020 2222 2243 6f6e 7665          """Conve
-00002110: 6e69 656e 6365 206f 7065 7261 746f 7220  nience operator 
-00002120: 6571 7569 7661 6c65 6e74 2074 6f20 6164  equivalent to ad
-00002130: 645f 7265 6628 292e 2222 220a 2020 2020  d_ref().""".    
-00002140: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00002150: 6164 645f 7265 6628 656c 656d 656e 7429  add_ref(element)
-00002160: 0a0a 2020 2020 6465 6620 756e 6c6f 636b  ..    def unlock
-00002170: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00002180: 2020 2020 2020 2020 2222 224f 6e6c 7920          """Only 
-00002190: 646f 2074 6869 7320 6966 2079 6f75 206b  do this if you k
-000021a0: 6e6f 7720 7768 6174 2079 6f75 2061 7265  now what you are
-000021b0: 2064 6f69 6e67 2e22 2222 0a20 2020 2020   doing.""".     
-000021c0: 2020 2073 656c 662e 5f6c 6f63 6b65 6420     self._locked 
-000021d0: 3d20 4661 6c73 650a 0a20 2020 2064 6566  = False..    def
-000021e0: 206c 6f63 6b28 7365 6c66 2920 2d3e 204e   lock(self) -> N
-000021f0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00002200: 4d61 6b65 7320 7375 7265 2063 6f6d 706f  Makes sure compo
-00002210: 6e65 6e74 7320 6361 6e27 7420 6164 6420  nents can't add 
-00002220: 6e65 7720 656c 656d 656e 7473 206f 7220  new elements or 
-00002230: 6d6f 7665 2065 7869 7374 696e 6720 6f6e  move existing on
-00002240: 6573 2e0a 0a20 2020 2020 2020 2043 6f6d  es...        Com
-00002250: 706f 6e65 6e74 7320 6c6f 636b 2061 7574  ponents lock aut
-00002260: 6f6d 6174 6963 616c 6c79 2077 6865 6e20  omatically when 
-00002270: 676f 696e 6720 696e 746f 2074 6865 2043  going into the C
-00002280: 4143 4845 2074 6f0a 2020 2020 2020 2020  ACHE to.        
-00002290: 656e 7375 7265 206f 6e65 2063 6f6d 706f  ensure one compo
-000022a0: 6e65 6e74 2064 6f65 7320 6e6f 7420 6368  nent does not ch
-000022b0: 616e 6765 206f 7468 6572 730a 2020 2020  ange others.    
-000022c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000022d0: 7365 6c66 2e5f 6c6f 636b 6564 203d 2054  self._locked = T
-000022e0: 7275 650a 0a20 2020 2064 6566 205f 5f73  rue..    def __s
-000022f0: 6574 6974 656d 5f5f 2873 656c 662c 206b  etitem__(self, k
-00002300: 6579 2c20 656c 656d 656e 7429 3a0a 2020  ey, element):.  
-00002310: 2020 2020 2020 2222 2241 6c6c 6f77 2061        """Allow a
-00002320: 6464 696e 6720 706f 6c79 676f 6e73 2061  dding polygons a
-00002330: 6e64 2063 656c 6c20 7265 6665 7265 6e63  nd cell referenc
-00002340: 6573 2e0a 0a20 2020 2020 2020 206c 696b  es...        lik
-00002350: 6520 445b 2761 7263 3327 5d20 3d20 7067  e D['arc3'] = pg
-00002360: 2e61 7263 2829 0a0a 2020 2020 2020 2020  .arc()..        
-00002370: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00002380: 2020 6b65 793a 2041 6c69 6173 206e 616d    key: Alias nam
-00002390: 652e 0a20 2020 2020 2020 2020 2020 2065  e..            e
-000023a0: 6c65 6d65 6e74 3a20 4f62 6a65 6374 2074  lement: Object t
-000023b0: 6861 7420 7769 6c6c 2062 6520 6163 6365  hat will be acce
-000023c0: 7373 6962 6c65 2062 7920 616c 6961 7320  ssible by alias 
-000023d0: 6e61 6d65 2e0a 0a20 2020 2020 2020 2022  name...        "
-000023e0: 2222 0a20 2020 2020 2020 2069 6620 6973  "".        if is
-000023f0: 696e 7374 616e 6365 2865 6c65 6d65 6e74  instance(element
-00002400: 2c20 2843 6f6d 706f 6e65 6e74 5265 6665  , (ComponentRefe
-00002410: 7265 6e63 652c 2050 6f6c 7967 6f6e 2929  rence, Polygon))
-00002420: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00002430: 6c66 2e6e 616d 6564 5f72 6566 6572 656e  lf.named_referen
-00002440: 6365 735b 6b65 795d 203d 2065 6c65 6d65  ces[key] = eleme
-00002450: 6e74 0a20 2020 2020 2020 2065 6c73 653a  nt.        else:
-00002460: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00002470: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-00002480: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00002490: 2254 7269 6564 2074 6f20 6173 7369 676e  "Tried to assign
-000024a0: 2061 6c69 6173 207b 6b65 7921 727d 2069   alias {key!r} i
-000024b0: 6e20 436f 6d70 6f6e 656e 7420 7b73 656c  n Component {sel
-000024c0: 662e 6e61 6d65 2172 7d2c 220a 2020 2020  f.name!r},".    
-000024d0: 2020 2020 2020 2020 2020 2020 2262 7574              "but
-000024e0: 2066 6169 6c65 6420 6265 6361 7573 6520   failed because 
-000024f0: 7468 6520 6974 656d 2077 6173 206e 6f74  the item was not
-00002500: 2061 2043 6f6d 706f 6e65 6e74 5265 6665   a ComponentRefe
-00002510: 7265 6e63 6522 0a20 2020 2020 2020 2020  rence".         
-00002520: 2020 2029 0a0a 2020 2020 4063 6c61 7373     )..    @class
-00002530: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
-00002540: 5f67 6574 5f76 616c 6964 6174 6f72 735f  _get_validators_
-00002550: 5f28 636c 7329 3a0a 2020 2020 2020 2020  _(cls):.        
-00002560: 2222 2247 6574 2076 616c 6964 6174 6f72  """Get validator
-00002570: 7320 666f 7220 7468 6520 436f 6d70 6f6e  s for the Compon
-00002580: 656e 7420 6f62 6a65 6374 2e22 2222 0a20  ent object.""". 
-00002590: 2020 2020 2020 2079 6965 6c64 2063 6c73         yield cls
-000025a0: 2e76 616c 6964 6174 650a 0a20 2020 2040  .validate..    @
-000025b0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-000025c0: 6465 6620 7661 6c69 6461 7465 2863 6c73  def validate(cls
-000025d0: 2c20 7629 3a0a 2020 2020 2020 2020 2222  , v):.        ""
-000025e0: 2250 7964 616e 7469 6320 6173 7375 6d65  "Pydantic assume
-000025f0: 7320 636f 6d70 6f6e 656e 7420 6973 2076  s component is v
-00002600: 616c 6964 2069 6620 7468 6520 666f 6c6c  alid if the foll
-00002610: 6f77 696e 6720 6172 6520 7472 7565 2e0a  owing are true..
-00002620: 0a20 2020 2020 2020 202d 206e 616d 6520  .        - name 
-00002630: 6368 6172 6163 7465 7273 203c 204d 4158  characters < MAX
-00002640: 5f4e 414d 455f 4c45 4e47 5448 0a20 2020  _NAME_LENGTH.   
-00002650: 2020 2020 202d 2069 7320 6e6f 7420 656d       - is not em
-00002660: 7074 7920 2868 6173 2072 6566 6572 656e  pty (has referen
-00002670: 6365 7320 6f72 2070 6f6c 7967 6f6e 7329  ces or polygons)
-00002680: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00002690: 2020 2020 204d 4158 5f4e 414d 455f 4c45       MAX_NAME_LE
-000026a0: 4e47 5448 203d 2039 390a 2020 2020 2020  NGTH = 99.      
-000026b0: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
-000026c0: 6e63 6528 0a20 2020 2020 2020 2020 2020  nce(.           
-000026d0: 2076 2c20 436f 6d70 6f6e 656e 740a 2020   v, Component.  
-000026e0: 2020 2020 2020 292c 2066 2254 7970 6545        ), f"TypeE
-000026f0: 7272 6f72 2c20 476f 7420 7b74 7970 6528  rror, Got {type(
-00002700: 7629 7d2c 2065 7870 6563 7469 6e67 2043  v)}, expecting C
-00002710: 6f6d 706f 6e65 6e74 220a 2020 2020 2020  omponent".      
-00002720: 2020 6173 7365 7274 2028 0a20 2020 2020    assert (.     
-00002730: 2020 2020 2020 206c 656e 2876 2e6e 616d         len(v.nam
-00002740: 6529 203c 3d20 4d41 585f 4e41 4d45 5f4c  e) <= MAX_NAME_L
-00002750: 454e 4754 480a 2020 2020 2020 2020 292c  ENGTH.        ),
-00002760: 2066 226e 616d 6520 607b 762e 6e61 6d65   f"name `{v.name
-00002770: 7d60 207b 6c65 6e28 762e 6e61 6d65 297d  }` {len(v.name)}
-00002780: 203e 207b 4d41 585f 4e41 4d45 5f4c 454e   > {MAX_NAME_LEN
-00002790: 4754 487d 2022 0a20 2020 2020 2020 2072  GTH} ".        r
-000027a0: 6574 7572 6e20 760a 0a20 2020 2040 7072  eturn v..    @pr
-000027b0: 6f70 6572 7479 0a20 2020 2064 6566 206e  operty.    def n
-000027c0: 616d 6564 5f72 6566 6572 656e 6365 7328  amed_references(
-000027d0: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-000027e0: 6574 7572 6e20 7365 6c66 2e5f 6e61 6d65  eturn self._name
-000027f0: 645f 7265 6665 7265 6e63 6573 0a0a 2020  d_references..  
-00002800: 2020 6465 6620 6164 645f 6c61 6265 6c28    def add_label(
-00002810: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00002820: 2020 2020 2020 2074 6578 743a 2073 7472         text: str
-00002830: 203d 2022 6865 6c6c 6f22 2c0a 2020 2020   = "hello",.    
-00002840: 2020 2020 706f 7369 7469 6f6e 3a20 5475      position: Tu
-00002850: 706c 655b 666c 6f61 742c 2066 6c6f 6174  ple[float, float
-00002860: 5d20 3d20 2830 2e30 2c20 302e 3029 2c0a  ] = (0.0, 0.0),.
-00002870: 2020 2020 2020 2020 6d61 676e 6966 6963          magnific
-00002880: 6174 696f 6e3a 2066 6c6f 6174 203d 2031  ation: float = 1
-00002890: 2e30 2c0a 2020 2020 2020 2020 726f 7461  .0,.        rota
-000028a0: 7469 6f6e 3a20 666c 6f61 7420 3d20 302c  tion: float = 0,
-000028b0: 0a20 2020 2020 2020 2061 6e63 686f 723a  .        anchor:
-000028c0: 2073 7472 203d 2022 6f22 2c0a 2020 2020   str = "o",.    
-000028d0: 2020 2020 6c61 7965 723d 2254 4558 5422      layer="TEXT"
-000028e0: 2c0a 2020 2020 2020 2020 785f 7265 666c  ,.        x_refl
-000028f0: 6563 7469 6f6e 3d46 616c 7365 2c0a 2020  ection=False,.  
-00002900: 2020 2920 2d3e 204c 6162 656c 3a0a 2020    ) -> Label:.  
-00002910: 2020 2020 2020 2222 2241 6464 7320 4c61        """Adds La
-00002920: 6265 6c20 746f 2074 6865 2043 6f6d 706f  bel to the Compo
-00002930: 6e65 6e74 2e0a 0a20 2020 2020 2020 2041  nent...        A
-00002940: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00002950: 2074 6578 743a 204c 6162 656c 2074 6578   text: Label tex
-00002960: 742e 0a20 2020 2020 2020 2020 2020 2070  t..            p
-00002970: 6f73 6974 696f 6e3a 2078 2d2c 2079 2d63  osition: x-, y-c
-00002980: 6f6f 7264 696e 6174 6573 206f 6620 7468  oordinates of th
-00002990: 6520 4c61 6265 6c20 6c6f 6361 7469 6f6e  e Label location
-000029a0: 2e0a 2020 2020 2020 2020 2020 2020 6d61  ..            ma
-000029b0: 676e 6966 6963 6174 696f 6e3a 204d 6167  gnification: Mag
-000029c0: 6e69 6669 6361 7469 6f6e 2066 6163 746f  nification facto
-000029d0: 7220 666f 7220 7468 6520 4c61 6265 6c20  r for the Label 
-000029e0: 7465 7874 2e0a 2020 2020 2020 2020 2020  text..          
-000029f0: 2020 726f 7461 7469 6f6e 3a20 416e 676c    rotation: Angl
-00002a00: 6520 726f 7461 7469 6f6e 206f 6620 7468  e rotation of th
-00002a10: 6520 4c61 6265 6c20 7465 7874 2e0a 2020  e Label text..  
-00002a20: 2020 2020 2020 2020 2020 616e 6368 6f72            anchor
-00002a30: 3a20 7b27 6e27 2c20 2765 272c 2027 7327  : {'n', 'e', 's'
-00002a40: 2c20 2777 272c 2027 6f27 2c20 276e 6527  , 'w', 'o', 'ne'
-00002a50: 2c20 276e 7727 2c20 2e2e 2e7d 0a20 2020  , 'nw', ...}.   
-00002a60: 2020 2020 2020 2020 2020 2020 2050 6f73               Pos
-00002a70: 6974 696f 6e20 6f66 2074 6865 2061 6e63  ition of the anc
-00002a80: 686f 7220 7265 6c61 7469 7665 2074 6f20  hor relative to 
-00002a90: 7468 6520 7465 7874 2e0a 2020 2020 2020  the text..      
-00002aa0: 2020 2020 2020 6c61 7965 723a 2053 7065        layer: Spe
-00002ab0: 6369 6669 6320 6c61 7965 7228 7329 2074  cific layer(s) t
-00002ac0: 6f20 7075 7420 4c61 6265 6c20 6f6e 2e0a  o put Label on..
-00002ad0: 2020 2020 2020 2020 2020 2020 785f 7265              x_re
-00002ae0: 666c 6563 7469 6f6e 3a20 5472 7565 2072  flection: True r
-00002af0: 6566 6c65 6374 7320 6163 726f 7373 2074  eflects across t
-00002b00: 6865 2068 6f72 697a 6f6e 7461 6c20 6178  he horizontal ax
-00002b10: 6973 2062 6566 6f72 6520 726f 7461 7469  is before rotati
-00002b20: 6f6e 2e0a 2020 2020 2020 2020 2222 220a  on..        """.
-00002b30: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
-00002b40: 6661 6374 6f72 792e 7064 6b20 696d 706f  factory.pdk impo
-00002b50: 7274 2067 6574 5f6c 6179 6572 0a0a 2020  rt get_layer..  
-00002b60: 2020 2020 2020 6c61 7965 7220 3d20 6765        layer = ge
-00002b70: 745f 6c61 7965 7228 6c61 7965 7229 0a0a  t_layer(layer)..
-00002b80: 2020 2020 2020 2020 6764 735f 6c61 7965          gds_laye
-00002b90: 722c 2067 6473 5f64 6174 6174 7970 6520  r, gds_datatype 
-00002ba0: 3d20 6c61 7965 720a 0a20 2020 2020 2020  = layer..       
-00002bb0: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-00002bc0: 6365 2874 6578 742c 2073 7472 293a 0a20  ce(text, str):. 
-00002bd0: 2020 2020 2020 2020 2020 2074 6578 7420             text 
-00002be0: 3d20 7465 7874 0a20 2020 2020 2020 206c  = text.        l
-00002bf0: 6162 656c 203d 204c 6162 656c 280a 2020  abel = Label(.  
-00002c00: 2020 2020 2020 2020 2020 7465 7874 3d74            text=t
-00002c10: 6578 742c 0a20 2020 2020 2020 2020 2020  ext,.           
-00002c20: 206f 7269 6769 6e3d 706f 7369 7469 6f6e   origin=position
-00002c30: 2c0a 2020 2020 2020 2020 2020 2020 616e  ,.            an
-00002c40: 6368 6f72 3d61 6e63 686f 722c 0a20 2020  chor=anchor,.   
-00002c50: 2020 2020 2020 2020 206d 6167 6e69 6669           magnifi
-00002c60: 6361 7469 6f6e 3d6d 6167 6e69 6669 6361  cation=magnifica
-00002c70: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-00002c80: 2020 726f 7461 7469 6f6e 3d72 6f74 6174    rotation=rotat
-00002c90: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-00002ca0: 206c 6179 6572 3d67 6473 5f6c 6179 6572   layer=gds_layer
-00002cb0: 2c0a 2020 2020 2020 2020 2020 2020 7465  ,.            te
-00002cc0: 7874 7479 7065 3d67 6473 5f64 6174 6174  xttype=gds_datat
-00002cd0: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
-00002ce0: 2078 5f72 6566 6c65 6374 696f 6e3d 785f   x_reflection=x_
-00002cf0: 7265 666c 6563 7469 6f6e 2c0a 2020 2020  reflection,.    
-00002d00: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
-00002d10: 6c66 2e61 6464 286c 6162 656c 290a 2020  lf.add(label).  
-00002d20: 2020 2020 2020 7265 7475 726e 206c 6162        return lab
-00002d30: 656c 0a0a 2020 2020 4070 726f 7065 7274  el..    @propert
-00002d40: 790a 2020 2020 6465 6620 6262 6f78 2873  y.    def bbox(s
-00002d50: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00002d60: 2252 6574 7572 6e73 2074 6865 2062 6f75  "Returns the bou
-00002d70: 6e64 696e 6720 626f 7820 6f66 2074 6865  nding box of the
-00002d80: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
-00002d90: 6e63 652e 0a0a 2020 2020 2020 2020 6974  nce...        it
-00002da0: 2073 6e61 7073 2074 6f20 3320 6465 6369   snaps to 3 deci
-00002db0: 6d61 6c73 2069 6e20 756d 2028 302e 3030  mals in um (0.00
-00002dc0: 3175 6d20 3d20 316e 6d20 7072 6563 6973  1um = 1nm precis
-00002dd0: 696f 6e29 0a20 2020 2020 2020 2022 2222  ion).        """
-00002de0: 0a20 2020 2020 2020 2062 626f 7820 3d20  .        bbox = 
-00002df0: 7365 6c66 2e5f 6365 6c6c 2e62 6f75 6e64  self._cell.bound
-00002e00: 696e 675f 626f 7828 290a 2020 2020 2020  ing_box().      
-00002e10: 2020 6966 2062 626f 7820 6973 204e 6f6e    if bbox is Non
-00002e20: 653a 0a20 2020 2020 2020 2020 2020 2062  e:.            b
-00002e30: 626f 7820 3d20 2828 302c 2030 292c 2028  box = ((0, 0), (
-00002e40: 302c 2030 2929 0a20 2020 2020 2020 2072  0, 0)).        r
-00002e50: 6574 7572 6e20 6e70 2e72 6f75 6e64 2862  eturn np.round(b
-00002e60: 626f 782c 2033 290a 0a20 2020 2040 7072  box, 3)..    @pr
-00002e70: 6f70 6572 7479 0a20 2020 2064 6566 2070  operty.    def p
-00002e80: 6f72 7473 5f6c 6179 6572 2873 656c 6629  orts_layer(self)
-00002e90: 202d 3e20 4469 6374 5b73 7472 2c20 7374   -> Dict[str, st
-00002ea0: 725d 3a0a 2020 2020 2020 2020 2222 2252  r]:.        """R
-00002eb0: 6574 7572 6e73 2061 206d 6170 7069 6e67  eturns a mapping
-00002ec0: 2066 726f 6d20 6c61 7965 7230 5f6c 6179   from layer0_lay
-00002ed0: 6572 315f 4530 3a20 706f 7274 4e61 6d65  er1_E0: portName
-00002ee0: 2e22 2222 0a20 2020 2020 2020 2072 6574  .""".        ret
-00002ef0: 7572 6e20 6d61 705f 706f 7274 735f 6c61  urn map_ports_la
-00002f00: 7965 725f 746f 5f6f 7269 656e 7461 7469  yer_to_orientati
-00002f10: 6f6e 2873 656c 662e 706f 7274 7329 0a0a  on(self.ports)..
-00002f20: 2020 2020 6465 6620 706f 7274 5f62 795f      def port_by_
-00002f30: 6f72 6965 6e74 6174 696f 6e5f 6377 2873  orientation_cw(s
-00002f40: 656c 662c 206b 6579 3a20 7374 722c 202a  elf, key: str, *
-00002f50: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
-00002f60: 2020 2222 2252 6574 7572 6e73 2070 6f72    """Returns por
-00002f70: 7420 6279 2069 6e64 6578 696e 6720 7468  t by indexing th
-00002f80: 656d 2063 6c6f 636b 7769 7365 2e22 2222  em clockwise."""
-00002f90: 0a20 2020 2020 2020 206d 203d 206d 6170  .        m = map
-00002fa0: 5f70 6f72 7473 5f74 6f5f 6f72 6965 6e74  _ports_to_orient
-00002fb0: 6174 696f 6e5f 6377 2873 656c 662e 706f  ation_cw(self.po
-00002fc0: 7274 732c 202a 2a6b 7761 7267 7329 0a20  rts, **kwargs). 
-00002fd0: 2020 2020 2020 2069 6620 6b65 7920 6e6f         if key no
-00002fe0: 7420 696e 206d 3a0a 2020 2020 2020 2020  t in m:.        
-00002ff0: 2020 2020 7261 6973 6520 4b65 7945 7272      raise KeyErr
-00003000: 6f72 2866 227b 6b65 797d 206e 6f74 2069  or(f"{key} not i
-00003010: 6e20 7b6c 6973 7428 6d2e 6b65 7973 2829  n {list(m.keys()
-00003020: 297d 2229 0a20 2020 2020 2020 206b 6579  )}").        key
-00003030: 3220 3d20 6d5b 6b65 795d 0a20 2020 2020  2 = m[key].     
-00003040: 2020 2072 6574 7572 6e20 7365 6c66 2e70     return self.p
-00003050: 6f72 7473 5b6b 6579 325d 0a0a 2020 2020  orts[key2]..    
-00003060: 6465 6620 706f 7274 5f62 795f 6f72 6965  def port_by_orie
-00003070: 6e74 6174 696f 6e5f 6363 7728 7365 6c66  ntation_ccw(self
-00003080: 2c20 6b65 793a 2073 7472 2c20 2a2a 6b77  , key: str, **kw
-00003090: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
-000030a0: 2222 5265 7475 726e 7320 706f 7274 2062  ""Returns port b
-000030b0: 7920 696e 6465 7869 6e67 2074 6865 6d20  y indexing them 
-000030c0: 636c 6f63 6b77 6973 652e 2222 220a 2020  clockwise.""".  
-000030d0: 2020 2020 2020 6d20 3d20 6d61 705f 706f        m = map_po
-000030e0: 7274 735f 746f 5f6f 7269 656e 7461 7469  rts_to_orientati
-000030f0: 6f6e 5f63 6377 2873 656c 662e 706f 7274  on_ccw(self.port
-00003100: 732c 202a 2a6b 7761 7267 7329 0a20 2020  s, **kwargs).   
-00003110: 2020 2020 2069 6620 6b65 7920 6e6f 7420       if key not 
-00003120: 696e 206d 3a0a 2020 2020 2020 2020 2020  in m:.          
-00003130: 2020 7261 6973 6520 4b65 7945 7272 6f72    raise KeyError
-00003140: 2866 227b 6b65 797d 206e 6f74 2069 6e20  (f"{key} not in 
-00003150: 7b6c 6973 7428 6d2e 6b65 7973 2829 297d  {list(m.keys())}
-00003160: 2229 0a20 2020 2020 2020 206b 6579 3220  ").        key2 
-00003170: 3d20 6d5b 6b65 795d 0a20 2020 2020 2020  = m[key].       
-00003180: 2072 6574 7572 6e20 7365 6c66 2e70 6f72   return self.por
-00003190: 7473 5b6b 6579 325d 0a0a 2020 2020 6465  ts[key2]..    de
-000031a0: 6620 6765 745f 706f 7274 735f 7873 697a  f get_ports_xsiz
-000031b0: 6528 7365 6c66 2c20 2a2a 6b77 6172 6773  e(self, **kwargs
-000031c0: 2920 2d3e 2066 6c6f 6174 3a0a 2020 2020  ) -> float:.    
-000031d0: 2020 2020 2222 2252 6574 7572 6e73 2078      """Returns x
-000031e0: 6469 7374 616e 6365 2066 726f 6d20 6561  distance from ea
-000031f0: 7374 2074 6f20 7765 7374 2070 6f72 7473  st to west ports
-00003200: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
-00003210: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
-00003220: 2020 2020 206c 6179 6572 3a20 706f 7274       layer: port
-00003230: 2047 4453 206c 6179 6572 2e0a 2020 2020   GDS layer..    
-00003240: 2020 2020 2020 2020 7072 6566 6978 3a20          prefix: 
-00003250: 7769 7468 2069 6e20 706f 7274 206e 616d  with in port nam
-00003260: 652e 0a20 2020 2020 2020 2020 2020 206f  e..            o
-00003270: 7269 656e 7461 7469 6f6e 3a20 696e 2064  rientation: in d
-00003280: 6567 7265 6573 2e0a 2020 2020 2020 2020  egrees..        
-00003290: 2020 2020 7769 6474 683a 2070 6f72 7420      width: port 
-000032a0: 7769 6474 682e 0a20 2020 2020 2020 2020  width..         
-000032b0: 2020 206c 6179 6572 735f 6578 636c 7564     layers_exclud
-000032c0: 6564 3a20 4c69 7374 206f 6620 6c61 7965  ed: List of laye
-000032d0: 7273 2074 6f20 6578 636c 7564 652e 0a20  rs to exclude.. 
-000032e0: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
-000032f0: 7479 7065 3a20 6f70 7469 6361 6c2c 2065  type: optical, e
-00003300: 6c65 6374 7269 6361 6c2c 202e 2e2e 0a20  lectrical, .... 
-00003310: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00003320: 2020 2070 6f72 7473 5f63 7720 3d20 7365     ports_cw = se
-00003330: 6c66 2e67 6574 5f70 6f72 7473 5f6c 6973  lf.get_ports_lis
-00003340: 7428 636c 6f63 6b77 6973 653d 5472 7565  t(clockwise=True
-00003350: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
-00003360: 2020 2020 706f 7274 735f 6363 7720 3d20      ports_ccw = 
-00003370: 7365 6c66 2e67 6574 5f70 6f72 7473 5f6c  self.get_ports_l
-00003380: 6973 7428 636c 6f63 6b77 6973 653d 4661  ist(clockwise=Fa
-00003390: 6c73 652c 202a 2a6b 7761 7267 7329 0a20  lse, **kwargs). 
-000033a0: 2020 2020 2020 2072 6574 7572 6e20 736e         return sn
-000033b0: 6170 5f74 6f5f 6772 6964 2870 6f72 7473  ap_to_grid(ports
-000033c0: 5f63 6377 5b30 5d2e 7820 2d20 706f 7274  _ccw[0].x - port
-000033d0: 735f 6377 5b30 5d2e 7829 0a0a 2020 2020  s_cw[0].x)..    
-000033e0: 6465 6620 6765 745f 706f 7274 735f 7973  def get_ports_ys
-000033f0: 697a 6528 7365 6c66 2c20 2a2a 6b77 6172  ize(self, **kwar
-00003400: 6773 2920 2d3e 2066 6c6f 6174 3a0a 2020  gs) -> float:.  
-00003410: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-00003420: 2079 6469 7374 616e 6365 2066 726f 6d20   ydistance from 
-00003430: 6561 7374 2074 6f20 7765 7374 2070 6f72  east to west por
-00003440: 7473 2e0a 0a20 2020 2020 2020 204b 6579  ts...        Key
-00003450: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
-00003460: 2020 2020 2020 206c 6179 6572 3a20 706f         layer: po
-00003470: 7274 2047 4453 206c 6179 6572 2e0a 2020  rt GDS layer..  
-00003480: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-00003490: 3a20 7769 7468 2069 6e20 706f 7274 206e  : with in port n
-000034a0: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
-000034b0: 206f 7269 656e 7461 7469 6f6e 3a20 696e   orientation: in
-000034c0: 2064 6567 7265 6573 2e0a 2020 2020 2020   degrees..      
-000034d0: 2020 2020 2020 7769 6474 683a 2070 6f72        width: por
-000034e0: 7420 7769 6474 6820 2875 6d29 2e0a 2020  t width (um)..  
-000034f0: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
-00003500: 5f65 7863 6c75 6465 643a 204c 6973 7420  _excluded: List 
-00003510: 6f66 206c 6179 6572 7320 746f 2065 7863  of layers to exc
-00003520: 6c75 6465 2e0a 2020 2020 2020 2020 2020  lude..          
-00003530: 2020 706f 7274 5f74 7970 653a 206f 7074    port_type: opt
-00003540: 6963 616c 2c20 656c 6563 7472 6963 616c  ical, electrical
-00003550: 2c20 2e2e 2e0a 2020 2020 2020 2020 2222  , ....        ""
-00003560: 220a 2020 2020 2020 2020 706f 7274 735f  ".        ports_
-00003570: 6377 203d 2073 656c 662e 6765 745f 706f  cw = self.get_po
-00003580: 7274 735f 6c69 7374 2863 6c6f 636b 7769  rts_list(clockwi
-00003590: 7365 3d54 7275 652c 202a 2a6b 7761 7267  se=True, **kwarg
-000035a0: 7329 0a20 2020 2020 2020 2070 6f72 7473  s).        ports
-000035b0: 5f63 6377 203d 2073 656c 662e 6765 745f  _ccw = self.get_
-000035c0: 706f 7274 735f 6c69 7374 2863 6c6f 636b  ports_list(clock
-000035d0: 7769 7365 3d46 616c 7365 2c20 2a2a 6b77  wise=False, **kw
-000035e0: 6172 6773 290a 2020 2020 2020 2020 7265  args).        re
-000035f0: 7475 726e 2073 6e61 705f 746f 5f67 7269  turn snap_to_gri
-00003600: 6428 706f 7274 735f 6363 775b 305d 2e79  d(ports_ccw[0].y
-00003610: 202d 2070 6f72 7473 5f63 775b 305d 2e79   - ports_cw[0].y
-00003620: 290a 0a20 2020 2064 6566 2070 6c6f 745f  )..    def plot_
-00003630: 6e65 746c 6973 7428 0a20 2020 2020 2020  netlist(.       
-00003640: 2073 656c 662c 2077 6974 685f 6c61 6265   self, with_labe
-00003650: 6c73 3a20 626f 6f6c 203d 2054 7275 652c  ls: bool = True,
-00003660: 2066 6f6e 745f 7765 6967 6874 3a20 7374   font_weight: st
-00003670: 7220 3d20 226e 6f72 6d61 6c22 2c20 2a2a  r = "normal", **
-00003680: 6b77 6172 6773 0a20 2020 2029 3a0a 2020  kwargs.    ):.  
-00003690: 2020 2020 2020 2222 2250 6c6f 7473 2061        """Plots a
-000036a0: 206e 6574 6c69 7374 2067 7261 7068 2077   netlist graph w
-000036b0: 6974 6820 6e65 7477 6f72 6b78 2e0a 0a20  ith networkx... 
-000036c0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-000036d0: 2020 2020 2020 2020 2077 6974 685f 6c61           with_la
-000036e0: 6265 6c73 3a20 6164 6420 6c61 6265 6c20  bels: add label 
-000036f0: 746f 2065 6163 6820 6e6f 6465 2e0a 2020  to each node..  
-00003700: 2020 2020 2020 2020 2020 666f 6e74 5f77            font_w
-00003710: 6569 6768 743a 206e 6f72 6d61 6c2c 2062  eight: normal, b
-00003720: 6f6c 642e 0a20 2020 2020 2020 2020 2020  old..           
-00003730: 202a 2a6b 7761 7267 733a 206b 6579 776f   **kwargs: keywo
-00003740: 7264 2061 7267 756d 656e 7473 2066 6f72  rd arguments for
-00003750: 2074 6865 2067 6574 5f6e 6574 6c69 7374   the get_netlist
-00003760: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
-00003770: 2020 2222 220a 2020 2020 2020 2020 696d    """.        im
-00003780: 706f 7274 206d 6174 706c 6f74 6c69 622e  port matplotlib.
-00003790: 7079 706c 6f74 2061 7320 706c 740a 2020  pyplot as plt.  
-000037a0: 2020 2020 2020 696d 706f 7274 206e 6574        import net
-000037b0: 776f 726b 7820 6173 206e 780a 0a20 2020  workx as nx..   
-000037c0: 2020 2020 2070 6c74 2e66 6967 7572 6528       plt.figure(
-000037d0: 290a 2020 2020 2020 2020 6e65 746c 6973  ).        netlis
-000037e0: 7420 3d20 7365 6c66 2e67 6574 5f6e 6574  t = self.get_net
-000037f0: 6c69 7374 282a 2a6b 7761 7267 7329 0a20  list(**kwargs). 
-00003800: 2020 2020 2020 2063 6f6e 6e65 6374 696f         connectio
-00003810: 6e73 203d 206e 6574 6c69 7374 5b22 636f  ns = netlist["co
-00003820: 6e6e 6563 7469 6f6e 7322 5d0a 2020 2020  nnections"].    
-00003830: 2020 2020 706c 6163 656d 656e 7473 203d      placements =
-00003840: 206e 6574 6c69 7374 5b22 706c 6163 656d   netlist["placem
-00003850: 656e 7473 225d 0a20 2020 2020 2020 2047  ents"].        G
-00003860: 203d 206e 782e 4772 6170 6828 290a 2020   = nx.Graph().  
-00003870: 2020 2020 2020 472e 6164 645f 6564 6765        G.add_edge
-00003880: 735f 6672 6f6d 280a 2020 2020 2020 2020  s_from(.        
-00003890: 2020 2020 5b0a 2020 2020 2020 2020 2020      [.          
-000038a0: 2020 2020 2020 2822 2c22 2e6a 6f69 6e28        (",".join(
-000038b0: 6b2e 7370 6c69 7428 222c 2229 5b3a 2d31  k.split(",")[:-1
-000038c0: 5d29 2c20 222c 222e 6a6f 696e 2876 2e73  ]), ",".join(v.s
-000038d0: 706c 6974 2822 2c22 295b 3a2d 315d 2929  plit(",")[:-1]))
-000038e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000038f0: 2066 6f72 206b 2c20 7620 696e 2063 6f6e   for k, v in con
-00003900: 6e65 6374 696f 6e73 2e69 7465 6d73 2829  nections.items()
-00003910: 0a20 2020 2020 2020 2020 2020 205d 0a20  .            ]. 
-00003920: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00003930: 2070 6f73 203d 207b 6b3a 2028 765b 2278   pos = {k: (v["x
-00003940: 225d 2c20 765b 2279 225d 2920 666f 7220  "], v["y"]) for 
-00003950: 6b2c 2076 2069 6e20 706c 6163 656d 656e  k, v in placemen
-00003960: 7473 2e69 7465 6d73 2829 7d0a 2020 2020  ts.items()}.    
-00003970: 2020 2020 6c61 6265 6c73 203d 207b 6b3a      labels = {k:
-00003980: 2022 2c22 2e6a 6f69 6e28 6b2e 7370 6c69   ",".join(k.spli
-00003990: 7428 222c 2229 5b3a 315d 2920 666f 7220  t(",")[:1]) for 
-000039a0: 6b20 696e 2070 6c61 6365 6d65 6e74 732e  k in placements.
-000039b0: 6b65 7973 2829 7d0a 2020 2020 2020 2020  keys()}.        
-000039c0: 6e78 2e64 7261 7728 0a20 2020 2020 2020  nx.draw(.       
-000039d0: 2020 2020 2047 2c0a 2020 2020 2020 2020       G,.        
-000039e0: 2020 2020 7769 7468 5f6c 6162 656c 733d      with_labels=
-000039f0: 7769 7468 5f6c 6162 656c 732c 0a20 2020  with_labels,.   
-00003a00: 2020 2020 2020 2020 2066 6f6e 745f 7765           font_we
-00003a10: 6967 6874 3d66 6f6e 745f 7765 6967 6874  ight=font_weight
-00003a20: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
-00003a30: 6265 6c73 3d6c 6162 656c 732c 0a20 2020  bels=labels,.   
-00003a40: 2020 2020 2020 2020 2070 6f73 3d70 6f73           pos=pos
-00003a50: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-00003a60: 2020 2020 7265 7475 726e 2047 0a0a 2020      return G..  
-00003a70: 2020 6465 6620 706c 6f74 5f6e 6574 6c69    def plot_netli
-00003a80: 7374 5f66 6c61 7428 0a20 2020 2020 2020  st_flat(.       
-00003a90: 2073 656c 662c 2077 6974 685f 6c61 6265   self, with_labe
-00003aa0: 6c73 3a20 626f 6f6c 203d 2054 7275 652c  ls: bool = True,
-00003ab0: 2066 6f6e 745f 7765 6967 6874 3a20 7374   font_weight: st
-00003ac0: 7220 3d20 226e 6f72 6d61 6c22 2c20 2a2a  r = "normal", **
-00003ad0: 6b77 6172 6773 0a20 2020 2029 3a0a 2020  kwargs.    ):.  
-00003ae0: 2020 2020 2020 2222 2250 6c6f 7473 2061        """Plots a
-00003af0: 206e 6574 6c69 7374 2067 7261 7068 2077   netlist graph w
-00003b00: 6974 6820 6e65 7477 6f72 6b78 2e0a 0a20  ith networkx... 
-00003b10: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-00003b20: 2020 2020 2020 2020 2066 6c61 743a 2069           flat: i
-00003b30: 6620 7472 7565 2c20 7769 6c6c 2070 6c6f  f true, will plo
-00003b40: 7420 7468 6520 666c 6174 206e 6574 6c69  t the flat netli
-00003b50: 7374 0a20 2020 2020 2020 2020 2020 2077  st.            w
-00003b60: 6974 685f 6c61 6265 6c73 3a20 6164 6420  ith_labels: add 
-00003b70: 6c61 6265 6c20 746f 2065 6163 6820 6e6f  label to each no
-00003b80: 6465 2e0a 2020 2020 2020 2020 2020 2020  de..            
-00003b90: 666f 6e74 5f77 6569 6768 743a 206e 6f72  font_weight: nor
-00003ba0: 6d61 6c2c 2062 6f6c 642e 0a20 2020 2020  mal, bold..     
-00003bb0: 2020 2020 2020 202a 2a6b 7761 7267 733a         **kwargs:
-00003bc0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
-00003bd0: 7473 2066 6f72 2074 6865 2067 6574 5f6e  ts for the get_n
-00003be0: 6574 6c69 7374 2066 756e 6374 696f 6e0a  etlist function.
-00003bf0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00003c00: 2020 2020 696d 706f 7274 206d 6174 706c      import matpl
-00003c10: 6f74 6c69 622e 7079 706c 6f74 2061 7320  otlib.pyplot as 
-00003c20: 706c 740a 2020 2020 2020 2020 696d 706f  plt.        impo
-00003c30: 7274 206e 6574 776f 726b 7820 6173 206e  rt networkx as n
-00003c40: 780a 0a20 2020 2020 2020 2070 6c74 2e66  x..        plt.f
-00003c50: 6967 7572 6528 290a 2020 2020 2020 2020  igure().        
-00003c60: 6e65 746c 6973 7420 3d20 7365 6c66 2e67  netlist = self.g
-00003c70: 6574 5f6e 6574 6c69 7374 5f66 6c61 7428  et_netlist_flat(
-00003c80: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
-00003c90: 2020 636f 6e6e 6563 7469 6f6e 7320 3d20    connections = 
-00003ca0: 6e65 746c 6973 745b 2263 6f6e 6e65 6374  netlist["connect
-00003cb0: 696f 6e73 225d 0a20 2020 2020 2020 2070  ions"].        p
-00003cc0: 6c61 6365 6d65 6e74 7320 3d20 6e65 746c  lacements = netl
-00003cd0: 6973 745b 2270 6c61 6365 6d65 6e74 7322  ist["placements"
-00003ce0: 5d0a 2020 2020 2020 2020 636f 6e6e 6563  ].        connec
-00003cf0: 7469 6f6e 735f 6c69 7374 203d 205b 5d0a  tions_list = [].
-00003d00: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
-00003d10: 5f6c 6973 7420 696e 2063 6f6e 6e65 6374  _list in connect
-00003d20: 696f 6e73 2e69 7465 6d73 2829 3a0a 2020  ions.items():.  
-00003d30: 2020 2020 2020 2020 2020 636f 6e6e 6563            connec
-00003d40: 7469 6f6e 735f 6c69 7374 2e65 7874 656e  tions_list.exten
-00003d50: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
-00003d60: 2020 2028 222c 222e 6a6f 696e 286b 2e73     (",".join(k.s
-00003d70: 706c 6974 2822 2c22 295b 3a2d 315d 292c  plit(",")[:-1]),
-00003d80: 2022 2c22 2e6a 6f69 6e28 762e 7370 6c69   ",".join(v.spli
-00003d90: 7428 222c 2229 5b3a 2d31 5d29 290a 2020  t(",")[:-1])).  
-00003da0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00003db0: 7220 7620 696e 2076 5f6c 6973 740a 2020  r v in v_list.  
-00003dc0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00003dd0: 2020 2020 4720 3d20 6e78 2e47 7261 7068      G = nx.Graph
-00003de0: 2829 0a20 2020 2020 2020 2047 2e61 6464  ().        G.add
-00003df0: 5f65 6467 6573 5f66 726f 6d28 636f 6e6e  _edges_from(conn
-00003e00: 6563 7469 6f6e 735f 6c69 7374 290a 2020  ections_list).  
-00003e10: 2020 2020 2020 706f 7320 3d20 7b6b 3a20        pos = {k: 
-00003e20: 2876 5b22 7822 5d2c 2076 5b22 7922 5d29  (v["x"], v["y"])
-00003e30: 2066 6f72 206b 2c20 7620 696e 2070 6c61   for k, v in pla
-00003e40: 6365 6d65 6e74 732e 6974 656d 7328 297d  cements.items()}
-00003e50: 0a20 2020 2020 2020 206c 6162 656c 7320  .        labels 
-00003e60: 3d20 7b6b 3a20 222c 222e 6a6f 696e 286b  = {k: ",".join(k
-00003e70: 2e73 706c 6974 2822 2c22 295b 3a31 5d29  .split(",")[:1])
-00003e80: 2066 6f72 206b 2069 6e20 706c 6163 656d   for k in placem
-00003e90: 656e 7473 2e6b 6579 7328 297d 0a20 2020  ents.keys()}.   
-00003ea0: 2020 2020 206e 782e 6472 6177 280a 2020       nx.draw(.  
-00003eb0: 2020 2020 2020 2020 2020 472c 0a20 2020            G,.   
-00003ec0: 2020 2020 2020 2020 2077 6974 685f 6c61           with_la
-00003ed0: 6265 6c73 3d77 6974 685f 6c61 6265 6c73  bels=with_labels
-00003ee0: 2c0a 2020 2020 2020 2020 2020 2020 666f  ,.            fo
-00003ef0: 6e74 5f77 6569 6768 743d 666f 6e74 5f77  nt_weight=font_w
-00003f00: 6569 6768 742c 0a20 2020 2020 2020 2020  eight,.         
-00003f10: 2020 206c 6162 656c 733d 6c61 6265 6c73     labels=labels
-00003f20: 2c0a 2020 2020 2020 2020 2020 2020 706f  ,.            po
-00003f30: 733d 706f 732c 0a20 2020 2020 2020 2029  s=pos,.        )
-00003f40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00003f50: 470a 0a20 2020 2064 6566 2067 6574 5f6e  G..    def get_n
-00003f60: 6574 6c69 7374 5f79 616d 6c28 7365 6c66  etlist_yaml(self
-00003f70: 2c20 2a2a 6b77 6172 6773 2920 2d3e 2044  , **kwargs) -> D
-00003f80: 6963 745b 7374 722c 2041 6e79 5d3a 0a20  ict[str, Any]:. 
-00003f90: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
-00003fa0: 6163 746f 7279 2e67 6574 5f6e 6574 6c69  actory.get_netli
-00003fb0: 7374 2069 6d70 6f72 7420 6765 745f 6e65  st import get_ne
-00003fc0: 746c 6973 745f 7961 6d6c 0a0a 2020 2020  tlist_yaml..    
-00003fd0: 2020 2020 7265 7475 726e 2067 6574 5f6e      return get_n
-00003fe0: 6574 6c69 7374 5f79 616d 6c28 7365 6c66  etlist_yaml(self
-00003ff0: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
-00004000: 2064 6566 2077 7269 7465 5f6e 6574 6c69   def write_netli
-00004010: 7374 2873 656c 662c 2066 696c 6570 6174  st(self, filepat
-00004020: 683a 2073 7472 2920 2d3e 204e 6f6e 653a  h: str) -> None:
-00004030: 0a20 2020 2020 2020 2022 2222 5772 6974  .        """Writ
-00004040: 6520 6e65 746c 6973 7420 696e 2059 414d  e netlist in YAM
-00004050: 4c2e 2222 220a 2020 2020 2020 2020 6e65  L.""".        ne
-00004060: 746c 6973 7420 3d20 7365 6c66 2e67 6574  tlist = self.get
-00004070: 5f6e 6574 6c69 7374 2829 0a20 2020 2020  _netlist().     
-00004080: 2020 204f 6d65 6761 436f 6e66 2e73 6176     OmegaConf.sav
-00004090: 6528 6e65 746c 6973 742c 2066 696c 6570  e(netlist, filep
-000040a0: 6174 6829 0a0a 2020 2020 6465 6620 7772  ath)..    def wr
-000040b0: 6974 655f 6e65 746c 6973 745f 646f 7428  ite_netlist_dot(
-000040c0: 7365 6c66 2c20 6669 6c65 7061 7468 3a20  self, filepath: 
-000040d0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-000040e0: 4e6f 6e65 2920 2d3e 204e 6f6e 653a 0a20  None) -> None:. 
-000040f0: 2020 2020 2020 2022 2222 5772 6974 6520         """Write 
-00004100: 6e65 746c 6973 7420 6772 6170 6820 696e  netlist graph in
-00004110: 2044 4f54 2066 6f72 6d61 742e 2222 220a   DOT format.""".
-00004120: 2020 2020 2020 2020 6672 6f6d 206e 6574          from net
-00004130: 776f 726b 782e 6472 6177 696e 672e 6e78  workx.drawing.nx
-00004140: 5f61 6772 6170 6820 696d 706f 7274 2077  _agraph import w
-00004150: 7269 7465 5f64 6f74 0a0a 2020 2020 2020  rite_dot..      
-00004160: 2020 6669 6c65 7061 7468 203d 2066 696c    filepath = fil
-00004170: 6570 6174 6820 6f72 2066 227b 7365 6c66  epath or f"{self
-00004180: 2e6e 616d 657d 2e64 6f74 220a 0a20 2020  .name}.dot"..   
-00004190: 2020 2020 2047 203d 2073 656c 662e 706c       G = self.pl
-000041a0: 6f74 5f6e 6574 6c69 7374 2829 0a20 2020  ot_netlist().   
-000041b0: 2020 2020 2077 7269 7465 5f64 6f74 2847       write_dot(G
-000041c0: 2c20 6669 6c65 7061 7468 290a 0a20 2020  , filepath)..   
-000041d0: 2064 6566 2067 6574 5f6e 6574 6c69 7374   def get_netlist
-000041e0: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
-000041f0: 202d 3e20 4469 6374 5b73 7472 2c20 416e   -> Dict[str, An
-00004200: 795d 3a0a 2020 2020 2020 2020 2222 2246  y]:.        """F
-00004210: 726f 6d20 436f 6d70 6f6e 656e 7420 7265  rom Component re
-00004220: 7475 726e 7320 696e 7374 616e 6365 732c  turns instances,
-00004230: 2063 6f6e 6e65 6374 696f 6e73 2061 6e64   connections and
-00004240: 2070 6c61 6365 6d65 6e74 7320 6469 6374   placements dict
-00004250: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
-00004260: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
-00004270: 2020 2020 2063 6f6d 706f 6e65 6e74 3a20       component: 
-00004280: 746f 2065 7874 7261 6374 206e 6574 6c69  to extract netli
-00004290: 7374 2e0a 2020 2020 2020 2020 2020 2020  st..            
-000042a0: 6675 6c6c 5f73 6574 7469 6e67 733a 2054  full_settings: T
-000042b0: 7275 6520 7265 7475 726e 7320 616c 6c2c  rue returns all,
-000042c0: 2066 616c 7365 2063 6861 6e67 6564 2073   false changed s
-000042d0: 6574 7469 6e67 732e 0a20 2020 2020 2020  ettings..       
-000042e0: 2020 2020 2074 6f6c 6572 616e 6365 3a20       tolerance: 
-000042f0: 746f 6c65 7261 6e63 6520 696e 206e 6d20  tolerance in nm 
-00004300: 746f 2063 6f6e 7369 6465 7220 7477 6f20  to consider two 
-00004310: 706f 7274 7320 636f 6e6e 6563 7465 642e  ports connected.
-00004320: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00004330: 6c75 6465 5f70 6f72 745f 7479 7065 733a  lude_port_types:
-00004340: 206f 7074 696f 6e61 6c20 6c69 7374 206f   optional list o
-00004350: 6620 706f 7274 2074 7970 6573 2074 6f20  f port types to 
-00004360: 6578 636c 7564 6520 6672 6f6d 206e 6574  exclude from net
-00004370: 6c69 7374 696e 672e 0a20 2020 2020 2020  listing..       
-00004380: 2020 2020 2067 6574 5f69 6e73 7461 6e63       get_instanc
-00004390: 655f 6e61 6d65 3a20 6675 6e63 7469 6f6e  e_name: function
-000043a0: 2074 6f20 6765 7420 696e 7374 616e 6365   to get instance
-000043b0: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
-000043c0: 2020 2061 6c6c 6f77 5f6d 756c 7469 706c     allow_multipl
-000043d0: 653a 2046 616c 7365 2074 6f20 7261 6973  e: False to rais
-000043e0: 6520 616e 2065 7272 6f72 2069 6620 6d6f  e an error if mo
-000043f0: 7265 2074 6861 6e20 7477 6f20 706f 7274  re than two port
-00004400: 7320 7368 6172 6520 7468 6520 7361 6d65  s share the same
-00004410: 2063 6f6e 6e65 6374 696f 6e2e 0a20 2020   connection..   
-00004420: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00004430: 5472 7565 2c20 7769 6c6c 2072 6574 7572  True, will retur
-00004440: 6e20 6b65 793a 205b 7661 6c75 655d 2070  n key: [value] p
-00004450: 6169 7273 2077 6974 6820 5b76 616c 7565  airs with [value
-00004460: 5d20 6120 6c69 7374 206f 6620 616c 6c20  ] a list of all 
-00004470: 636f 6e6e 6563 7465 6420 696e 7374 616e  connected instan
-00004480: 6365 732e 0a0a 2020 2020 2020 2020 5265  ces...        Re
-00004490: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
-000044a0: 2020 204e 6574 6c69 7374 2064 6963 7420     Netlist dict 
-000044b0: 2869 6e73 7461 6e63 6573 2c20 636f 6e6e  (instances, conn
-000044c0: 6563 7469 6f6e 732c 2070 6c61 6365 6d65  ections, placeme
-000044d0: 6e74 732c 2070 6f72 7473 290a 2020 2020  nts, ports).    
-000044e0: 2020 2020 2020 2020 2020 2020 696e 7374              inst
-000044f0: 616e 6365 733a 2044 6963 7420 6f66 2069  ances: Dict of i
-00004500: 6e73 7461 6e63 6520 6e61 6d65 2061 6e64  nstance name and
-00004510: 2073 6574 7469 6e67 732e 0a20 2020 2020   settings..     
-00004520: 2020 2020 2020 2020 2020 2063 6f6e 6e65             conne
-00004530: 6374 696f 6e73 3a20 4469 6374 206f 6620  ctions: Dict of 
-00004540: 496e 7374 616e 6365 314e 616d 652c 706f  Instance1Name,po
-00004550: 7274 4e61 6d65 3a20 496e 7374 616e 6365  rtName: Instance
-00004560: 324e 616d 652c 706f 7274 4e61 6d65 2e0a  2Name,portName..
-00004570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004580: 706c 6163 656d 656e 7473 3a20 4469 6374  placements: Dict
-00004590: 206f 6620 696e 7374 616e 6365 206e 616d   of instance nam
-000045a0: 6573 2061 6e64 2070 6c61 6365 6d65 6e74  es and placement
-000045b0: 7320 2878 2c20 792c 2072 6f74 6174 696f  s (x, y, rotatio
-000045c0: 6e29 2e0a 2020 2020 2020 2020 2020 2020  n)..            
-000045d0: 2020 2020 706f 7274 733a 2044 6963 7420      ports: Dict 
-000045e0: 706f 7274 4e61 6d65 3a20 436f 6d70 6f6e  portName: Compon
-000045f0: 656e 744e 616d 652c 706f 7274 2e0a 2020  entName,port..  
-00004600: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-00004610: 6d65 3a20 6e61 6d65 206f 6620 636f 6d70  me: name of comp
-00004620: 6f6e 656e 742e 0a20 2020 2020 2020 2022  onent..        "
-00004630: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-00004640: 6764 7366 6163 746f 7279 2e67 6574 5f6e  gdsfactory.get_n
-00004650: 6574 6c69 7374 2069 6d70 6f72 7420 6765  etlist import ge
-00004660: 745f 6e65 746c 6973 740a 0a20 2020 2020  t_netlist..     
-00004670: 2020 2072 6574 7572 6e20 6765 745f 6e65     return get_ne
-00004680: 746c 6973 7428 636f 6d70 6f6e 656e 743d  tlist(component=
-00004690: 7365 6c66 2c20 2a2a 6b77 6172 6773 290a  self, **kwargs).
-000046a0: 0a20 2020 2064 6566 2067 6574 5f6e 6574  .    def get_net
-000046b0: 6c69 7374 5f72 6563 7572 7369 7665 2873  list_recursive(s
-000046c0: 656c 662c 202a 2a6b 7761 7267 7329 202d  elf, **kwargs) -
-000046d0: 3e20 4469 6374 5b73 7472 2c20 4469 6374  > Dict[str, Dict
-000046e0: 436f 6e66 6967 5d3a 0a20 2020 2020 2020  Config]:.       
-000046f0: 2022 2222 5265 7475 726e 7320 7265 6375   """Returns recu
-00004700: 7273 6976 6520 6e65 746c 6973 7420 666f  rsive netlist fo
-00004710: 7220 6120 636f 6d70 6f6e 656e 7420 616e  r a component an
-00004720: 6420 7375 6263 6f6d 706f 6e65 6e74 732e  d subcomponents.
-00004730: 0a0a 2020 2020 2020 2020 4b65 7977 6f72  ..        Keywor
-00004740: 6420 4172 6773 3a0a 2020 2020 2020 2020  d Args:.        
-00004750: 2020 2020 636f 6d70 6f6e 656e 743a 2074      component: t
-00004760: 6f20 6578 7472 6163 7420 6e65 746c 6973  o extract netlis
-00004770: 742e 0a20 2020 2020 2020 2020 2020 2063  t..            c
-00004780: 6f6d 706f 6e65 6e74 5f73 7566 6669 783a  omponent_suffix:
-00004790: 2073 7566 6669 7820 746f 2061 7070 656e   suffix to appen
-000047a0: 6420 746f 2065 6163 6820 636f 6d70 6f6e  d to each compon
-000047b0: 656e 7420 6e61 6d65 2e0a 2020 2020 2020  ent name..      
-000047c0: 2020 2020 2020 2020 2020 7573 6566 756c            useful
-000047d0: 2069 6620 746f 2073 6176 6520 616e 6420   if to save and 
-000047e0: 7265 6c6f 6164 2061 2062 6163 6b2d 616e  reload a back-an
-000047f0: 6e6f 7461 7465 6420 6e65 746c 6973 742e  notated netlist.
-00004800: 0a20 2020 2020 2020 2020 2020 2067 6574  .            get
-00004810: 5f6e 6574 6c69 7374 5f66 756e 633a 2066  _netlist_func: f
-00004820: 756e 6374 696f 6e20 746f 2065 7874 7261  unction to extra
-00004830: 6374 2069 6e64 6976 6964 7561 6c20 6e65  ct individual ne
-00004840: 746c 6973 7473 2e0a 2020 2020 2020 2020  tlists..        
-00004850: 2020 2020 6675 6c6c 5f73 6574 7469 6e67      full_setting
-00004860: 733a 2054 7275 6520 7265 7475 726e 7320  s: True returns 
-00004870: 616c 6c2c 2066 616c 7365 2063 6861 6e67  all, false chang
-00004880: 6564 2073 6574 7469 6e67 732e 0a20 2020  ed settings..   
-00004890: 2020 2020 2020 2020 2074 6f6c 6572 616e           toleran
-000048a0: 6365 3a20 746f 6c65 7261 6e63 6520 696e  ce: tolerance in
-000048b0: 206e 6d20 746f 2063 6f6e 7369 6465 7220   nm to consider 
-000048c0: 7477 6f20 706f 7274 7320 636f 6e6e 6563  two ports connec
-000048d0: 7465 642e 0a20 2020 2020 2020 2020 2020  ted..           
-000048e0: 2065 7863 6c75 6465 5f70 6f72 745f 7479   exclude_port_ty
-000048f0: 7065 733a 206f 7074 696f 6e61 6c20 6c69  pes: optional li
-00004900: 7374 206f 6620 706f 7274 2074 7970 6573  st of port types
-00004910: 2074 6f20 6578 636c 7564 6520 6672 6f6d   to exclude from
-00004920: 206e 6574 6c69 7374 696e 672e 0a20 2020   netlisting..   
-00004930: 2020 2020 2020 2020 2067 6574 5f69 6e73           get_ins
-00004940: 7461 6e63 655f 6e61 6d65 3a20 6675 6e63  tance_name: func
-00004950: 7469 6f6e 2074 6f20 6765 7420 696e 7374  tion to get inst
-00004960: 616e 6365 206e 616d 652e 0a20 2020 2020  ance name..     
-00004970: 2020 2020 2020 2061 6c6c 6f77 5f6d 756c         allow_mul
-00004980: 7469 706c 653a 2046 616c 7365 2074 6f20  tiple: False to 
-00004990: 7261 6973 6520 616e 2065 7272 6f72 2069  raise an error i
-000049a0: 6620 6d6f 7265 2074 6861 6e20 7477 6f20  f more than two 
-000049b0: 706f 7274 7320 7368 6172 6520 7468 6520  ports share the 
-000049c0: 7361 6d65 2063 6f6e 6e65 6374 696f 6e2e  same connection.
-000049d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000049e0: 2069 6620 5472 7565 2c20 7769 6c6c 2072   if True, will r
-000049f0: 6574 7572 6e20 6b65 793a 205b 7661 6c75  eturn key: [valu
-00004a00: 655d 2070 6169 7273 2077 6974 6820 5b76  e] pairs with [v
-00004a10: 616c 7565 5d20 6120 6c69 7374 206f 6620  alue] a list of 
-00004a20: 616c 6c20 636f 6e6e 6563 7465 6420 696e  all connected in
-00004a30: 7374 616e 6365 732e 0a0a 2020 2020 2020  stances...      
-00004a40: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
-00004a50: 2020 2020 2020 2044 6963 7469 6f6e 6172         Dictionar
-00004a60: 7920 6f66 206e 6574 6c69 7374 732c 206b  y of netlists, k
-00004a70: 6579 6564 2062 7920 7468 6520 6e61 6d65  eyed by the name
-00004a80: 206f 6620 6561 6368 2063 6f6d 706f 6e65   of each compone
-00004a90: 6e74 2e0a 2020 2020 2020 2020 2222 220a  nt..        """.
-00004aa0: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
-00004ab0: 6661 6374 6f72 792e 6765 745f 6e65 746c  factory.get_netl
-00004ac0: 6973 7420 696d 706f 7274 2067 6574 5f6e  ist import get_n
-00004ad0: 6574 6c69 7374 5f72 6563 7572 7369 7665  etlist_recursive
-00004ae0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00004af0: 2067 6574 5f6e 6574 6c69 7374 5f72 6563   get_netlist_rec
-00004b00: 7572 7369 7665 2863 6f6d 706f 6e65 6e74  ursive(component
-00004b10: 3d73 656c 662c 202a 2a6b 7761 7267 7329  =self, **kwargs)
-00004b20: 0a0a 2020 2020 6465 6620 6765 745f 6e65  ..    def get_ne
-00004b30: 746c 6973 745f 666c 6174 2873 656c 662c  tlist_flat(self,
-00004b40: 202a 2a6b 7761 7267 7329 202d 3e20 4469   **kwargs) -> Di
-00004b50: 6374 5b73 7472 2c20 4469 6374 436f 6e66  ct[str, DictConf
-00004b60: 6967 5d3a 0a20 2020 2020 2020 2022 2222  ig]:.        """
-00004b70: 5265 7475 726e 7320 6120 6e65 746c 6973  Returns a netlis
-00004b80: 7420 7768 6572 6520 616c 6c20 7375 6269  t where all subi
-00004b90: 6e73 7461 6e63 6573 2061 7265 2065 7870  nstances are exp
-00004ba0: 6f73 6564 2061 6e64 2069 6e64 6570 656e  osed and indepen
-00004bb0: 6465 6e74 6c79 206e 616d 6564 2e0a 0a20  dently named... 
-00004bc0: 2020 2020 2020 204b 6579 776f 7264 2041         Keyword A
-00004bd0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00004be0: 2063 6f6d 706f 6e65 6e74 3a20 746f 2065   component: to e
-00004bf0: 7874 7261 6374 206e 6574 6c69 7374 2e0a  xtract netlist..
-00004c00: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00004c10: 6f6e 656e 745f 7375 6666 6978 3a20 7375  onent_suffix: su
-00004c20: 6666 6978 2074 6f20 6170 7065 6e64 2074  ffix to append t
-00004c30: 6f20 6561 6368 2063 6f6d 706f 6e65 6e74  o each component
-00004c40: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
-00004c50: 2020 2020 2020 2075 7365 6675 6c20 6966         useful if
-00004c60: 2074 6f20 7361 7665 2061 6e64 2072 656c   to save and rel
-00004c70: 6f61 6420 6120 6261 636b 2d61 6e6e 6f74  oad a back-annot
-00004c80: 6174 6564 206e 6574 6c69 7374 2e0a 2020  ated netlist..  
-00004c90: 2020 2020 2020 2020 2020 6765 745f 6e65            get_ne
-00004ca0: 746c 6973 745f 6675 6e63 3a20 6675 6e63  tlist_func: func
-00004cb0: 7469 6f6e 2074 6f20 6578 7472 6163 7420  tion to extract 
-00004cc0: 696e 6469 7669 6475 616c 206e 6574 6c69  individual netli
-00004cd0: 7374 732e 0a20 2020 2020 2020 2020 2020  sts..           
-00004ce0: 2066 756c 6c5f 7365 7474 696e 6773 3a20   full_settings: 
-00004cf0: 5472 7565 2072 6574 7572 6e73 2061 6c6c  True returns all
-00004d00: 2c20 6661 6c73 6520 6368 616e 6765 6420  , false changed 
-00004d10: 7365 7474 696e 6773 2e0a 2020 2020 2020  settings..      
-00004d20: 2020 2020 2020 746f 6c65 7261 6e63 653a        tolerance:
-00004d30: 2074 6f6c 6572 616e 6365 2069 6e20 6e6d   tolerance in nm
-00004d40: 2074 6f20 636f 6e73 6964 6572 2074 776f   to consider two
-00004d50: 2070 6f72 7473 2063 6f6e 6e65 6374 6564   ports connected
-00004d60: 2e0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
-00004d70: 636c 7564 655f 706f 7274 5f74 7970 6573  clude_port_types
-00004d80: 3a20 6f70 7469 6f6e 616c 206c 6973 7420  : optional list 
-00004d90: 6f66 2070 6f72 7420 7479 7065 7320 746f  of port types to
-00004da0: 2065 7863 6c75 6465 2066 726f 6d20 6e65   exclude from ne
-00004db0: 746c 6973 7469 6e67 2e0a 2020 2020 2020  tlisting..      
-00004dc0: 2020 2020 2020 6765 745f 696e 7374 616e        get_instan
-00004dd0: 6365 5f6e 616d 653a 2066 756e 6374 696f  ce_name: functio
-00004de0: 6e20 746f 2067 6574 2069 6e73 7461 6e63  n to get instanc
-00004df0: 6520 6e61 6d65 2e0a 2020 2020 2020 2020  e name..        
-00004e00: 2020 2020 616c 6c6f 775f 6d75 6c74 6970      allow_multip
-00004e10: 6c65 3a20 4661 6c73 6520 746f 2072 6169  le: False to rai
-00004e20: 7365 2061 6e20 6572 726f 7220 6966 206d  se an error if m
-00004e30: 6f72 6520 7468 616e 2074 776f 2070 6f72  ore than two por
-00004e40: 7473 2073 6861 7265 2074 6865 2073 616d  ts share the sam
-00004e50: 6520 636f 6e6e 6563 7469 6f6e 2e0a 2020  e connection..  
-00004e60: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00004e70: 2054 7275 652c 2077 696c 6c20 7265 7475   True, will retu
-00004e80: 726e 206b 6579 3a20 5b76 616c 7565 5d20  rn key: [value] 
-00004e90: 7061 6972 7320 7769 7468 205b 7661 6c75  pairs with [valu
-00004ea0: 655d 2061 206c 6973 7420 6f66 2061 6c6c  e] a list of all
-00004eb0: 2063 6f6e 6e65 6374 6564 2069 6e73 7461   connected insta
-00004ec0: 6e63 6573 2e0a 0a20 2020 2020 2020 2052  nces...        R
-00004ed0: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
-00004ee0: 2020 2020 4469 6374 696f 6e61 7279 206f      Dictionary o
-00004ef0: 6620 6e65 746c 6973 7473 2c20 6b65 7965  f netlists, keye
-00004f00: 6420 6279 2074 6865 206e 616d 6520 6f66  d by the name of
-00004f10: 2065 6163 6820 636f 6d70 6f6e 656e 742e   each component.
-00004f20: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00004f30: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
-00004f40: 746f 7279 2e67 6574 5f6e 6574 6c69 7374  tory.get_netlist
-00004f50: 5f66 6c61 7420 696d 706f 7274 2067 6574  _flat import get
-00004f60: 5f6e 6574 6c69 7374 5f66 6c61 740a 0a20  _netlist_flat.. 
-00004f70: 2020 2020 2020 2072 6574 7572 6e20 6765         return ge
-00004f80: 745f 6e65 746c 6973 745f 666c 6174 2863  t_netlist_flat(c
-00004f90: 6f6d 706f 6e65 6e74 3d73 656c 662c 202a  omponent=self, *
-00004fa0: 2a6b 7761 7267 7329 0a0a 2020 2020 6465  *kwargs)..    de
-00004fb0: 6620 6173 7365 7274 5f70 6f72 7473 5f6f  f assert_ports_o
-00004fc0: 6e5f 6772 6964 2873 656c 662c 206e 6d3a  n_grid(self, nm:
-00004fd0: 2069 6e74 203d 2031 2920 2d3e 204e 6f6e   int = 1) -> Non
-00004fe0: 653a 0a20 2020 2020 2020 2022 2222 4173  e:.        """As
-00004ff0: 7365 7274 7320 7468 6174 2061 6c6c 2070  serts that all p
-00005000: 6f72 7473 2061 7265 206f 6e20 6772 6964  orts are on grid
-00005010: 2e22 2222 0a20 2020 2020 2020 2066 6f72  .""".        for
-00005020: 2070 6f72 7420 696e 2073 656c 662e 706f   port in self.po
-00005030: 7274 732e 7661 6c75 6573 2829 3a0a 2020  rts.values():.  
-00005040: 2020 2020 2020 2020 2020 706f 7274 2e61            port.a
-00005050: 7373 6572 745f 6f6e 5f67 7269 6428 6e6d  ssert_on_grid(nm
-00005060: 3d6e 6d29 0a0a 2020 2020 6465 6620 6765  =nm)..    def ge
-00005070: 745f 706f 7274 7328 7365 6c66 2c20 6465  t_ports(self, de
-00005080: 7074 683d 4e6f 6e65 293a 0a20 2020 2020  pth=None):.     
-00005090: 2020 2022 2222 5265 7475 726e 7320 636f     """Returns co
-000050a0: 7069 6573 206f 6620 616c 6c20 7468 6520  pies of all the 
-000050b0: 706f 7274 7320 6f66 2074 6865 2043 6f6d  ports of the Com
-000050c0: 706f 6e65 6e74 2c20 726f 7461 7465 6420  ponent, rotated 
-000050d0: 616e 6420 5c0a 2020 2020 2020 2020 2020  and \.          
-000050e0: 2020 2020 2020 7472 616e 736c 6174 6564        translated
-000050f0: 2073 6f20 7468 6174 2074 6865 7927 7265   so that they're
-00005100: 2069 6e20 7468 6569 7220 746f 702d 6c65   in their top-le
-00005110: 7665 6c20 706f 7369 7469 6f6e 2e0a 0a20  vel position... 
-00005120: 2020 2020 2020 2054 6865 2050 6f72 7473         The Ports
-00005130: 2072 6574 7572 6e65 6420 6172 6520 636f   returned are co
-00005140: 7069 6573 206f 6620 7468 6520 6f72 6967  pies of the orig
-00005150: 696e 616c 732c 2062 7574 2065 6163 6820  inals, but each 
-00005160: 636f 7079 2068 6173 2074 6865 2073 616d  copy has the sam
-00005170: 650a 2020 2020 2020 2020 6060 7569 6460  e.        ``uid`
-00005180: 6020 6173 2074 6865 206f 7269 6769 6e61  ` as the origina
-00005190: 6c20 736f 2074 6861 7420 7468 6579 2063  l so that they c
-000051a0: 616e 2062 6520 7472 6163 6564 2062 6163  an be traced bac
-000051b0: 6b20 746f 2074 6865 206f 7269 6769 6e61  k to the origina
-000051c0: 6c20 6966 206e 6565 6465 642e 0a0a 2020  l if needed...  
-000051d0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-000051e0: 2020 2020 2020 2020 6465 7074 6820 3a20          depth : 
-000051f0: 696e 7420 6f72 204e 6f6e 650a 2020 2020  int or None.    
-00005200: 2020 2020 2020 2020 2020 2020 4966 206e              If n
-00005210: 6f74 204e 6f6e 652c 2064 6566 696e 6573  ot None, defines
-00005220: 2066 726f 6d20 686f 7720 6d61 6e79 2072   from how many r
-00005230: 6566 6572 656e 6365 206c 6576 656c 7320  eference levels 
-00005240: 746f 0a20 2020 2020 2020 2020 2020 2020  to.             
-00005250: 2020 2072 6574 7269 6576 6520 506f 7274     retrieve Port
-00005260: 7320 6672 6f6d 2e0a 0a20 2020 2020 2020  s from...       
-00005270: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
-00005280: 2020 2020 2020 706f 7274 5f6c 6973 7420        port_list 
-00005290: 3a20 6c69 7374 206f 6620 506f 7274 204c  : list of Port L
-000052a0: 6973 7420 6f66 2061 6c6c 2050 6f72 7473  ist of all Ports
-000052b0: 2069 6e20 7468 6520 436f 6d70 6f6e 656e   in the Componen
-000052c0: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
-000052d0: 2020 2020 2020 2070 6f72 745f 6c69 7374         port_list
-000052e0: 203d 205b 702e 5f63 6f70 7928 2920 666f   = [p._copy() fo
-000052f0: 7220 7020 696e 2073 656c 662e 706f 7274  r p in self.port
-00005300: 732e 7661 6c75 6573 2829 5d0a 0a20 2020  s.values()]..   
-00005310: 2020 2020 2069 6620 6465 7074 6820 6973       if depth is
-00005320: 204e 6f6e 6520 6f72 2064 6570 7468 203e   None or depth >
-00005330: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00005340: 666f 7220 7220 696e 2073 656c 662e 7265  for r in self.re
-00005350: 6665 7265 6e63 6573 3a0a 2020 2020 2020  ferences:.      
-00005360: 2020 2020 2020 2020 2020 6e65 775f 6465            new_de
-00005370: 7074 6820 3d20 4e6f 6e65 2069 6620 6465  pth = None if de
-00005380: 7074 6820 6973 204e 6f6e 6520 656c 7365  pth is None else
-00005390: 2064 6570 7468 202d 2031 0a20 2020 2020   depth - 1.     
-000053a0: 2020 2020 2020 2020 2020 2072 6566 5f70             ref_p
-000053b0: 6f72 7473 203d 2072 2e70 6172 656e 742e  orts = r.parent.
-000053c0: 6765 745f 706f 7274 7328 6465 7074 683d  get_ports(depth=
-000053d0: 6e65 775f 6465 7074 6829 0a0a 2020 2020  new_depth)..    
-000053e0: 2020 2020 2020 2020 2020 2020 2320 5472              # Tr
-000053f0: 616e 7366 6f72 6d20 706f 7274 7320 7468  ansform ports th
-00005400: 6174 2063 616d 6520 6672 6f6d 2061 2072  at came from a r
-00005410: 6566 6572 656e 6365 0a20 2020 2020 2020  eference.       
-00005420: 2020 2020 2020 2020 2072 6566 5f70 6f72           ref_por
-00005430: 7473 5f74 7261 6e73 666f 726d 6564 203d  ts_transformed =
-00005440: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-00005450: 2020 2020 666f 7220 7270 2069 6e20 7265      for rp in re
-00005460: 665f 706f 7274 733a 0a20 2020 2020 2020  f_ports:.       
-00005470: 2020 2020 2020 2020 2020 2020 206e 6577               new
-00005480: 5f70 6f72 7420 3d20 7270 2e5f 636f 7079  _port = rp._copy
-00005490: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-000054a0: 2020 2020 2020 206e 6577 5f63 656e 7465         new_cente
-000054b0: 722c 206e 6577 5f6f 7269 656e 7461 7469  r, new_orientati
-000054c0: 6f6e 203d 2072 2e5f 7472 616e 7366 6f72  on = r._transfor
-000054d0: 6d5f 706f 7274 280a 2020 2020 2020 2020  m_port(.        
-000054e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000054f0: 7270 2e63 656e 7465 722c 0a20 2020 2020  rp.center,.     
-00005500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005510: 2020 2072 702e 6f72 6965 6e74 6174 696f     rp.orientatio
-00005520: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-00005530: 2020 2020 2020 2020 2020 2072 2e6f 7269             r.ori
-00005540: 6769 6e2c 0a20 2020 2020 2020 2020 2020  gin,.           
-00005550: 2020 2020 2020 2020 2020 2020 2072 2e72               r.r
-00005560: 6f74 6174 696f 6e2c 0a20 2020 2020 2020  otation,.       
-00005570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005580: 2072 2e78 5f72 6566 6c65 6374 696f 6e2c   r.x_reflection,
-00005590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000055a0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000055b0: 2020 2020 2020 2020 2020 206e 6577 5f70             new_p
-000055c0: 6f72 742e 6365 6e74 6572 203d 206e 6577  ort.center = new
-000055d0: 5f63 656e 7465 720a 2020 2020 2020 2020  _center.        
-000055e0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-000055f0: 706f 7274 2e6e 6577 5f6f 7269 656e 7461  port.new_orienta
-00005600: 7469 6f6e 203d 206e 6577 5f6f 7269 656e  tion = new_orien
-00005610: 7461 7469 6f6e 0a20 2020 2020 2020 2020  tation.         
-00005620: 2020 2020 2020 2020 2020 2072 6566 5f70             ref_p
-00005630: 6f72 7473 5f74 7261 6e73 666f 726d 6564  orts_transformed
-00005640: 2e61 7070 656e 6428 6e65 775f 706f 7274  .append(new_port
-00005650: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00005660: 2020 706f 7274 5f6c 6973 7420 2b3d 2072    port_list += r
-00005670: 6566 5f70 6f72 7473 5f74 7261 6e73 666f  ef_ports_transfo
-00005680: 726d 6564 0a0a 2020 2020 2020 2020 7265  rmed..        re
-00005690: 7475 726e 2070 6f72 745f 6c69 7374 0a0a  turn port_list..
-000056a0: 2020 2020 6465 6620 6765 745f 706f 7274      def get_port
-000056b0: 735f 6469 6374 2873 656c 662c 202a 2a6b  s_dict(self, **k
-000056c0: 7761 7267 7329 202d 3e20 4469 6374 5b73  wargs) -> Dict[s
-000056d0: 7472 2c20 506f 7274 5d3a 0a20 2020 2020  tr, Port]:.     
-000056e0: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
-000056f0: 6469 6374 206f 6620 706f 7274 732e 0a0a  dict of ports...
-00005700: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
-00005710: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00005720: 2020 6c61 7965 723a 2070 6f72 7420 4744    layer: port GD
-00005730: 5320 6c61 7965 722e 0a20 2020 2020 2020  S layer..       
-00005740: 2020 2020 2070 7265 6669 783a 2073 656c       prefix: sel
-00005750: 6563 7420 706f 7274 7320 7769 7468 2070  ect ports with p
-00005760: 7265 6669 7820 696e 2070 6f72 7420 6e61  refix in port na
-00005770: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
-00005780: 7375 6666 6978 3a20 7365 6c65 6374 2070  suffix: select p
-00005790: 6f72 7473 2077 6974 6820 706f 7274 206e  orts with port n
-000057a0: 616d 6520 7375 6666 6978 2e0a 2020 2020  ame suffix..    
-000057b0: 2020 2020 2020 2020 6f72 6965 6e74 6174          orientat
-000057c0: 696f 6e3a 2073 656c 6563 7420 706f 7274  ion: select port
-000057d0: 7320 7769 7468 206f 7269 656e 7461 7469  s with orientati
-000057e0: 6f6e 2069 6e20 6465 6772 6565 732e 0a20  on in degrees.. 
-000057f0: 2020 2020 2020 2020 2020 2077 6964 7468             width
-00005800: 3a20 7365 6c65 6374 2070 6f72 7473 2077  : select ports w
-00005810: 6974 6820 706f 7274 2077 6964 7468 2e0a  ith port width..
-00005820: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00005830: 7273 5f65 7863 6c75 6465 643a 204c 6973  rs_excluded: Lis
-00005840: 7420 6f66 206c 6179 6572 7320 746f 2065  t of layers to e
-00005850: 7863 6c75 6465 2e0a 2020 2020 2020 2020  xclude..        
-00005860: 2020 2020 706f 7274 5f74 7970 653a 2073      port_type: s
-00005870: 656c 6563 7420 706f 7274 7320 7769 7468  elect ports with
-00005880: 2070 6f72 745f 7479 7065 2028 6f70 7469   port_type (opti
-00005890: 6361 6c2c 2065 6c65 6374 7269 6361 6c2c  cal, electrical,
-000058a0: 2076 6572 7469 6361 6c5f 7465 292e 0a20   vertical_te).. 
-000058b0: 2020 2020 2020 2020 2020 2063 6c6f 636b             clock
-000058c0: 7769 7365 3a20 6966 2054 7275 652c 2073  wise: if True, s
-000058d0: 6f72 7420 706f 7274 7320 636c 6f63 6b77  ort ports clockw
-000058e0: 6973 652c 2046 616c 7365 3a20 636f 756e  ise, False: coun
-000058f0: 7465 722d 636c 6f63 6b77 6973 652e 0a20  ter-clockwise.. 
-00005900: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00005910: 2020 2072 6574 7572 6e20 7365 6c65 6374     return select
-00005920: 5f70 6f72 7473 2873 656c 662e 706f 7274  _ports(self.port
-00005930: 732c 202a 2a6b 7761 7267 7329 0a0a 2020  s, **kwargs)..  
-00005940: 2020 6465 6620 6765 745f 706f 7274 735f    def get_ports_
-00005950: 6c69 7374 2873 656c 662c 202a 2a6b 7761  list(self, **kwa
-00005960: 7267 7329 202d 3e20 4c69 7374 5b50 6f72  rgs) -> List[Por
-00005970: 745d 3a0a 2020 2020 2020 2020 2222 2252  t]:.        """R
-00005980: 6574 7572 6e73 206c 6973 7420 6f66 2070  eturns list of p
-00005990: 6f72 7473 2e0a 0a20 2020 2020 2020 204b  orts...        K
-000059a0: 6579 776f 7264 2041 7267 733a 0a20 2020  eyword Args:.   
-000059b0: 2020 2020 2020 2020 206c 6179 6572 3a20           layer: 
-000059c0: 7365 6c65 6374 2070 6f72 7473 2077 6974  select ports wit
-000059d0: 6820 4744 5320 6c61 7965 722e 0a20 2020  h GDS layer..   
-000059e0: 2020 2020 2020 2020 2070 7265 6669 783a           prefix:
-000059f0: 2073 656c 6563 7420 706f 7274 7320 7769   select ports wi
-00005a00: 7468 2070 7265 6669 7820 696e 2070 6f72  th prefix in por
-00005a10: 7420 6e61 6d65 2e0a 2020 2020 2020 2020  t name..        
-00005a20: 2020 2020 7375 6666 6978 3a20 7365 6c65      suffix: sele
-00005a30: 6374 2070 6f72 7473 2077 6974 6820 706f  ct ports with po
-00005a40: 7274 206e 616d 6520 7375 6666 6978 2e0a  rt name suffix..
-00005a50: 2020 2020 2020 2020 2020 2020 6f72 6965              orie
-00005a60: 6e74 6174 696f 6e3a 2073 656c 6563 7420  ntation: select 
-00005a70: 706f 7274 7320 7769 7468 206f 7269 656e  ports with orien
-00005a80: 7461 7469 6f6e 2069 6e20 6465 6772 6565  tation in degree
-00005a90: 732e 0a20 2020 2020 2020 2020 2020 206f  s..            o
-00005aa0: 7269 656e 7461 7469 6f6e 3a20 7365 6c65  rientation: sele
-00005ab0: 6374 2070 6f72 7473 2077 6974 6820 6f72  ct ports with or
-00005ac0: 6965 6e74 6174 696f 6e20 696e 2064 6567  ientation in deg
-00005ad0: 7265 6573 2e0a 2020 2020 2020 2020 2020  rees..          
-00005ae0: 2020 7769 6474 683a 2073 656c 6563 7420    width: select 
-00005af0: 706f 7274 7320 7769 7468 2070 6f72 7420  ports with port 
-00005b00: 7769 6474 682e 0a20 2020 2020 2020 2020  width..         
-00005b10: 2020 206c 6179 6572 735f 6578 636c 7564     layers_exclud
-00005b20: 6564 3a20 4c69 7374 206f 6620 6c61 7965  ed: List of laye
-00005b30: 7273 2074 6f20 6578 636c 7564 652e 0a20  rs to exclude.. 
-00005b40: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
-00005b50: 7479 7065 3a20 7365 6c65 6374 2070 6f72  type: select por
-00005b60: 7473 2077 6974 6820 706f 7274 5f74 7970  ts with port_typ
-00005b70: 6520 286f 7074 6963 616c 2c20 656c 6563  e (optical, elec
-00005b80: 7472 6963 616c 2c20 7665 7274 6963 616c  trical, vertical
-00005b90: 5f74 6529 2e0a 2020 2020 2020 2020 2020  _te)..          
-00005ba0: 2020 636c 6f63 6b77 6973 653a 2069 6620    clockwise: if 
-00005bb0: 5472 7565 2c20 736f 7274 2070 6f72 7473  True, sort ports
-00005bc0: 2063 6c6f 636b 7769 7365 2c20 4661 6c73   clockwise, Fals
-00005bd0: 653a 2063 6f75 6e74 6572 2d63 6c6f 636b  e: counter-clock
-00005be0: 7769 7365 2e0a 2020 2020 2020 2020 2222  wise..        ""
-00005bf0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00005c00: 206c 6973 7428 7365 6c65 6374 5f70 6f72   list(select_por
-00005c10: 7473 2873 656c 662e 706f 7274 732c 202a  ts(self.ports, *
-00005c20: 2a6b 7761 7267 7329 2e76 616c 7565 7328  *kwargs).values(
-00005c30: 2929 0a0a 2020 2020 6465 6620 6765 745f  ))..    def get_
-00005c40: 706f 7274 735f 7061 6e64 6173 2873 656c  ports_pandas(sel
-00005c50: 6629 3a0a 2020 2020 2020 2020 696d 706f  f):.        impo
-00005c60: 7274 2070 616e 6461 7320 6173 2070 640a  rt pandas as pd.
-00005c70: 0a20 2020 2020 2020 2063 6f6c 5f73 7065  .        col_spe
-00005c80: 6320 3d20 5b0a 2020 2020 2020 2020 2020  c = [.          
-00005c90: 2020 226e 616d 6522 2c0a 2020 2020 2020    "name",.      
-00005ca0: 2020 2020 2020 2277 6964 7468 222c 0a20        "width",. 
-00005cb0: 2020 2020 2020 2020 2020 2022 6365 6e74             "cent
-00005cc0: 6572 222c 0a20 2020 2020 2020 2020 2020  er",.           
-00005cd0: 2022 6f72 6965 6e74 6174 696f 6e22 2c0a   "orientation",.
-00005ce0: 2020 2020 2020 2020 2020 2020 226c 6179              "lay
-00005cf0: 6572 222c 0a20 2020 2020 2020 2020 2020  er",.           
-00005d00: 2022 706f 7274 5f74 7970 6522 2c0a 2020   "port_type",.  
-00005d10: 2020 2020 2020 2020 2020 2273 6865 6172            "shear
-00005d20: 5f61 6e67 6c65 222c 0a20 2020 2020 2020  _angle",.       
-00005d30: 205d 0a0a 2020 2020 2020 2020 7265 7475   ]..        retu
-00005d40: 726e 2070 642e 4461 7461 4672 616d 6528  rn pd.DataFrame(
-00005d50: 0a20 2020 2020 2020 2020 2020 205b 706f  .            [po
-00005d60: 7274 2e74 6f5f 6469 6374 2829 2066 6f72  rt.to_dict() for
-00005d70: 2070 6f72 7420 696e 2073 656c 662e 6765   port in self.ge
-00005d80: 745f 706f 7274 735f 6c69 7374 2829 5d2c  t_ports_list()],
-00005d90: 2063 6f6c 756d 6e73 3d63 6f6c 5f73 7065   columns=col_spe
-00005da0: 630a 2020 2020 2020 2020 290a 0a20 2020  c.        )..   
-00005db0: 2064 6566 2067 6574 5f70 6f72 7473 5f70   def get_ports_p
-00005dc0: 6f6c 6172 7328 7365 6c66 293a 0a20 2020  olars(self):.   
-00005dd0: 2020 2020 2069 6d70 6f72 7420 706f 6c61       import pola
-00005de0: 7273 2061 7320 706c 0a0a 2020 2020 2020  rs as pl..      
-00005df0: 2020 636f 6c5f 7370 6563 203d 207b 0a20    col_spec = {. 
-00005e00: 2020 2020 2020 2020 2020 2022 6e61 6d65             "name
-00005e10: 223a 2070 6c2e 5574 6638 2c0a 2020 2020  ": pl.Utf8,.    
-00005e20: 2020 2020 2020 2020 2277 6964 7468 223a          "width":
-00005e30: 2070 6c2e 466c 6f61 7436 342c 0a20 2020   pl.Float64,.   
-00005e40: 2020 2020 2020 2020 2022 6365 6e74 6572           "center
-00005e50: 223a 2070 6c2e 4c69 7374 2870 6c2e 466c  ": pl.List(pl.Fl
-00005e60: 6f61 7436 3429 2c0a 2020 2020 2020 2020  oat64),.        
-00005e70: 2020 2020 226f 7269 656e 7461 7469 6f6e      "orientation
-00005e80: 223a 2070 6c2e 466c 6f61 7436 342c 0a20  ": pl.Float64,. 
-00005e90: 2020 2020 2020 2020 2020 2022 6c61 7965             "laye
-00005ea0: 7222 3a20 706c 2e4c 6973 7428 706c 2e55  r": pl.List(pl.U
-00005eb0: 496e 7431 3629 2c0a 2020 2020 2020 2020  Int16),.        
-00005ec0: 2020 2020 2270 6f72 745f 7479 7065 223a      "port_type":
-00005ed0: 2070 6c2e 5574 6638 2c0a 2020 2020 2020   pl.Utf8,.      
-00005ee0: 2020 2020 2020 2273 6865 6172 5f61 6e67        "shear_ang
-00005ef0: 6c65 223a 2070 6c2e 466c 6f61 7436 342c  le": pl.Float64,
-00005f00: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
-00005f10: 2020 2020 7265 7475 726e 2070 6c2e 4461      return pl.Da
-00005f20: 7461 4672 616d 6528 0a20 2020 2020 2020  taFrame(.       
-00005f30: 2020 2020 205b 706f 7274 2e74 6f5f 6469       [port.to_di
-00005f40: 6374 2829 2066 6f72 2070 6f72 7420 696e  ct() for port in
-00005f50: 2073 656c 662e 6765 745f 706f 7274 735f   self.get_ports_
-00005f60: 6c69 7374 2829 5d2c 2073 6368 656d 613d  list()], schema=
-00005f70: 636f 6c5f 7370 6563 0a20 2020 2020 2020  col_spec.       
-00005f80: 2029 0a0a 2020 2020 6465 6620 7265 6628   )..    def ref(
-00005f90: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00005fa0: 2020 2020 2020 2070 6f73 6974 696f 6e3a         position:
-00005fb0: 2043 6f6f 7264 696e 6174 6520 3d20 2830   Coordinate = (0
-00005fc0: 2c20 3029 2c0a 2020 2020 2020 2020 706f  , 0),.        po
-00005fd0: 7274 5f69 643a 204f 7074 696f 6e61 6c5b  rt_id: Optional[
-00005fe0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-00005ff0: 2020 2020 2072 6f74 6174 696f 6e3a 2066       rotation: f
-00006000: 6c6f 6174 203d 2030 2c0a 2020 2020 2020  loat = 0,.      
-00006010: 2020 685f 6d69 7272 6f72 3a20 626f 6f6c    h_mirror: bool
-00006020: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
-00006030: 2020 765f 6d69 7272 6f72 3a20 626f 6f6c    v_mirror: bool
-00006040: 203d 2046 616c 7365 2c0a 2020 2020 2920   = False,.    ) 
-00006050: 2d3e 2043 6f6d 706f 6e65 6e74 5265 6665  -> ComponentRefe
-00006060: 7265 6e63 653a 0a20 2020 2020 2020 2022  rence:.        "
-00006070: 2222 5265 7475 726e 7320 436f 6d70 6f6e  ""Returns Compon
-00006080: 656e 7420 7265 6665 7265 6e63 652e 0a0a  ent reference...
-00006090: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-000060a0: 2020 2020 2020 2020 2020 706f 7369 7469            positi
-000060b0: 6f6e 3a20 782c 2079 2070 6f73 6974 696f  on: x, y positio
-000060c0: 6e2e 0a20 2020 2020 2020 2020 2020 2070  n..            p
-000060d0: 6f72 745f 6964 3a20 6e61 6d65 206f 6620  ort_id: name of 
-000060e0: 7468 6520 706f 7274 2e0a 2020 2020 2020  the port..      
-000060f0: 2020 2020 2020 726f 7461 7469 6f6e 3a20        rotation: 
-00006100: 696e 2064 6567 7265 6573 2e0a 2020 2020  in degrees..    
-00006110: 2020 2020 2020 2020 685f 6d69 7272 6f72          h_mirror
-00006120: 3a20 686f 7269 7a6f 6e74 616c 206d 6972  : horizontal mir
-00006130: 726f 7220 7573 696e 6720 7920 6178 6973  ror using y axis
-00006140: 2028 782c 2031 2920 2831 2c20 3029 2e0a   (x, 1) (1, 0)..
-00006150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006160: 5468 6973 2069 7320 7468 6520 6d6f 7374  This is the most
-00006170: 2063 6f6d 6d6f 6e20 6d69 7272 6f72 2e0a   common mirror..
-00006180: 2020 2020 2020 2020 2020 2020 765f 6d69              v_mi
-00006190: 7272 6f72 3a20 7665 7274 6963 616c 206d  rror: vertical m
-000061a0: 6972 726f 7220 7573 696e 6720 7820 6178  irror using x ax
-000061b0: 6973 2028 312c 2079 2920 2830 2c20 7929  is (1, y) (0, y)
-000061c0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000061d0: 2020 2020 2020 5f72 6566 203d 2043 6f6d        _ref = Com
-000061e0: 706f 6e65 6e74 5265 6665 7265 6e63 6528  ponentReference(
-000061f0: 7365 6c66 290a 0a20 2020 2020 2020 2069  self)..        i
-00006200: 6620 706f 7274 5f69 6420 616e 6420 706f  f port_id and po
-00006210: 7274 5f69 6420 6e6f 7420 696e 2073 656c  rt_id not in sel
-00006220: 662e 706f 7274 733a 0a20 2020 2020 2020  f.ports:.       
-00006230: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00006240: 4572 726f 7228 6622 706f 7274 207b 706f  Error(f"port {po
-00006250: 7274 5f69 647d 206e 6f74 2069 6e20 7b73  rt_id} not in {s
-00006260: 656c 662e 706f 7274 732e 6b65 7973 2829  elf.ports.keys()
-00006270: 7d22 290a 0a20 2020 2020 2020 206f 7269  }")..        ori
-00006280: 6769 6e20 3d20 7365 6c66 2e70 6f72 7473  gin = self.ports
-00006290: 5b70 6f72 745f 6964 5d2e 6365 6e74 6572  [port_id].center
-000062a0: 2069 6620 706f 7274 5f69 6420 656c 7365   if port_id else
-000062b0: 2028 302c 2030 290a 2020 2020 2020 2020   (0, 0).        
-000062c0: 6966 2068 5f6d 6972 726f 723a 0a20 2020  if h_mirror:.   
-000062d0: 2020 2020 2020 2020 205f 7265 662e 6d69           _ref.mi
-000062e0: 7272 6f72 5f78 2870 6f72 745f 6964 290a  rror_x(port_id).
-000062f0: 0a20 2020 2020 2020 2069 6620 765f 6d69  .        if v_mi
-00006300: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-00006310: 2020 5f72 6566 2e6d 6972 726f 725f 7928    _ref.mirror_y(
-00006320: 706f 7274 5f69 6429 0a0a 2020 2020 2020  port_id)..      
-00006330: 2020 6966 2072 6f74 6174 696f 6e20 213d    if rotation !=
-00006340: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00006350: 5f72 6566 2e72 6f74 6174 6528 726f 7461  _ref.rotate(rota
-00006360: 7469 6f6e 2c20 6f72 6967 696e 290a 2020  tion, origin).  
-00006370: 2020 2020 2020 5f72 6566 2e6d 6f76 6528        _ref.move(
-00006380: 6f72 6967 696e 2c20 706f 7369 7469 6f6e  origin, position
-00006390: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-000063a0: 6e20 5f72 6566 0a0a 2020 2020 6465 6620  n _ref..    def 
-000063b0: 7265 665f 6365 6e74 6572 2873 656c 662c  ref_center(self,
-000063c0: 2070 6f73 6974 696f 6e3d 2830 2c20 3029   position=(0, 0)
-000063d0: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
-000063e0: 7475 726e 7320 6120 7265 6665 7265 6e63  turns a referenc
-000063f0: 6520 6f66 2074 6865 2063 6f6d 706f 6e65  e of the compone
-00006400: 6e74 2063 656e 7465 7265 6420 6174 2028  nt centered at (
-00006410: 783d 302c 2079 3d30 292e 2222 220a 2020  x=0, y=0).""".  
-00006420: 2020 2020 2020 7369 203d 2073 656c 662e        si = self.
-00006430: 7369 7a65 5f69 6e66 6f0a 2020 2020 2020  size_info.      
-00006440: 2020 7963 203d 2073 692e 736f 7574 6820    yc = si.south 
-00006450: 2b20 7369 2e68 6569 6768 7420 2f20 320a  + si.height / 2.
-00006460: 2020 2020 2020 2020 7863 203d 2073 692e          xc = si.
-00006470: 7765 7374 202b 2073 692e 7769 6474 6820  west + si.width 
-00006480: 2f20 320a 2020 2020 2020 2020 6365 6e74  / 2.        cent
-00006490: 6572 203d 2028 7863 2c20 7963 290a 2020  er = (xc, yc).  
-000064a0: 2020 2020 2020 5f72 6566 203d 2043 6f6d        _ref = Com
-000064b0: 706f 6e65 6e74 5265 6665 7265 6e63 6528  ponentReference(
-000064c0: 7365 6c66 290a 2020 2020 2020 2020 5f72  self).        _r
-000064d0: 6566 2e6d 6f76 6528 6365 6e74 6572 2c20  ef.move(center, 
-000064e0: 706f 7369 7469 6f6e 290a 2020 2020 2020  position).      
-000064f0: 2020 7265 7475 726e 205f 7265 660a 0a20    return _ref.. 
-00006500: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
-00006510: 7365 6c66 2920 2d3e 2073 7472 3a0a 2020  self) -> str:.  
-00006520: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
-00006530: 6120 7374 7269 6e67 2072 6570 7265 7365  a string represe
-00006540: 6e74 6174 696f 6e20 6f66 2074 6865 206f  ntation of the o
-00006550: 626a 6563 742e 2222 220a 2020 2020 2020  bject.""".      
-00006560: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
-00006570: 2020 2020 2020 2066 227b 7365 6c66 2e6e         f"{self.n
-00006580: 616d 657d 3a20 7569 6420 7b73 656c 662e  ame}: uid {self.
-00006590: 7569 647d 2c20 220a 2020 2020 2020 2020  uid}, ".        
-000065a0: 2020 2020 6622 706f 7274 7320 7b6c 6973      f"ports {lis
-000065b0: 7428 7365 6c66 2e70 6f72 7473 2e6b 6579  t(self.ports.key
-000065c0: 7328 2929 7d2c 2022 0a20 2020 2020 2020  s())}, ".       
-000065d0: 2020 2020 2066 2272 6566 6572 656e 6365       f"reference
-000065e0: 7320 7b6c 6973 7428 7365 6c66 2e6e 616d  s {list(self.nam
-000065f0: 6564 5f72 6566 6572 656e 6365 732e 6b65  ed_references.ke
-00006600: 7973 2829 297d 2c20 220a 2020 2020 2020  ys())}, ".      
-00006610: 2020 2020 2020 6622 7b6c 656e 2873 656c        f"{len(sel
-00006620: 662e 706f 6c79 676f 6e73 297d 2070 6f6c  f.polygons)} pol
-00006630: 7967 6f6e 7322 0a20 2020 2020 2020 2029  ygons".        )
-00006640: 0a0a 2020 2020 6465 6620 7070 7269 6e74  ..    def pprint
-00006650: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00006660: 2020 2020 2020 2020 2222 2250 7269 6e74          """Print
-00006670: 7320 636f 6d70 6f6e 656e 7420 696e 666f  s component info
-00006680: 2e22 2222 0a20 2020 2020 2020 2074 7279  .""".        try
-00006690: 3a0a 2020 2020 2020 2020 2020 2020 6672  :.            fr
-000066a0: 6f6d 2072 6963 6820 696d 706f 7274 2070  om rich import p
-000066b0: 7265 7474 790a 0a20 2020 2020 2020 2020  retty..         
-000066c0: 2020 2070 7265 7474 792e 696e 7374 616c     pretty.instal
-000066d0: 6c28 290a 2020 2020 2020 2020 2020 2020  l().            
-000066e0: 7072 6574 7479 2e70 7072 696e 7428 7365  pretty.pprint(se
-000066f0: 6c66 2e74 6f5f 6469 6374 2829 290a 2020  lf.to_dict()).  
-00006700: 2020 2020 2020 6578 6365 7074 2049 6d70        except Imp
-00006710: 6f72 7445 7272 6f72 3a0a 2020 2020 2020  ortError:.      
-00006720: 2020 2020 2020 7072 696e 7428 7961 6d6c        print(yaml
-00006730: 2e64 756d 7028 7365 6c66 2e74 6f5f 6469  .dump(self.to_di
-00006740: 6374 2829 2929 0a0a 2020 2020 6465 6620  ct()))..    def 
-00006750: 7070 7269 6e74 5f70 6f72 7473 2873 656c  pprint_ports(sel
-00006760: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00006770: 2020 2020 2222 2250 7269 6e74 7320 636f      """Prints co
-00006780: 6d70 6f6e 656e 7420 6e65 746c 6973 7473  mponent netlists
-00006790: 2e22 2222 0a20 2020 2020 2020 2070 6f72  .""".        por
-000067a0: 7473 5f6c 6973 7420 3d20 7365 6c66 2e67  ts_list = self.g
-000067b0: 6574 5f70 6f72 7473 5f6c 6973 7428 290a  et_ports_list().
-000067c0: 2020 2020 2020 2020 666f 7220 706f 7274          for port
-000067d0: 2069 6e20 706f 7274 735f 6c69 7374 3a0a   in ports_list:.
-000067e0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000067f0: 7428 706f 7274 290a 0a20 2020 2040 7072  t(port)..    @pr
-00006800: 6f70 6572 7479 0a20 2020 2064 6566 206d  operty.    def m
-00006810: 6574 6164 6174 615f 6368 696c 6428 7365  etadata_child(se
-00006820: 6c66 2920 2d3e 2044 6963 743a 0a20 2020  lf) -> Dict:.   
-00006830: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00006840: 6d65 7461 6461 7461 2066 726f 6d20 6368  metadata from ch
-00006850: 696c 6420 6966 2061 6e79 2c20 4f74 6865  ild if any, Othe
-00006860: 7277 6973 6520 7265 7475 726e 7320 636f  rwise returns co
-00006870: 6d70 6f6e 656e 7420 6f77 6e2e 0a0a 2020  mponent own...  
-00006880: 2020 2020 2020 6d65 7461 6461 7461 2047        metadata G
-00006890: 7265 6174 2074 6f20 6163 6365 7373 2074  reat to access t
-000068a0: 6865 2063 6869 6c64 7265 6e20 6d65 7461  he children meta
-000068b0: 6461 7461 2061 7420 7468 6520 626f 7474  data at the bott
-000068c0: 6f6d 206f 6620 7468 650a 2020 2020 2020  om of the.      
-000068d0: 2020 6869 6572 6172 6368 792e 0a20 2020    hierarchy..   
-000068e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000068f0: 2073 6574 7469 6e67 7320 3d20 6469 6374   settings = dict
-00006900: 2873 656c 662e 7365 7474 696e 6773 290a  (self.settings).
-00006910: 0a20 2020 2020 2020 2077 6869 6c65 2073  .        while s
-00006920: 6574 7469 6e67 732e 6765 7428 2263 6869  ettings.get("chi
-00006930: 6c64 2229 3a0a 2020 2020 2020 2020 2020  ld"):.          
-00006940: 2020 7365 7474 696e 6773 203d 2073 6574    settings = set
-00006950: 7469 6e67 732e 6765 7428 2263 6869 6c64  tings.get("child
-00006960: 2229 0a0a 2020 2020 2020 2020 7265 7475  ")..        retu
-00006970: 726e 2064 6963 7428 7365 7474 696e 6773  rn dict(settings
-00006980: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
-00006990: 0a20 2020 2064 6566 206d 6574 6164 6174  .    def metadat
-000069a0: 6128 7365 6c66 2920 2d3e 2044 6963 743a  a(self) -> Dict:
-000069b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000069c0: 6469 6374 2873 656c 662e 7365 7474 696e  dict(self.settin
-000069d0: 6773 290a 0a20 2020 2064 6566 2061 6464  gs)..    def add
-000069e0: 5f70 6f72 7428 0a20 2020 2020 2020 2073  _port(.        s
-000069f0: 656c 662c 0a20 2020 2020 2020 206e 616d  elf,.        nam
-00006a00: 653a 204f 7074 696f 6e61 6c5b 556e 696f  e: Optional[Unio
-00006a10: 6e5b 7374 722c 206f 626a 6563 745d 5d20  n[str, object]] 
-00006a20: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00006a30: 6365 6e74 6572 3a20 4f70 7469 6f6e 616c  center: Optional
-00006a40: 5b54 7570 6c65 5b66 6c6f 6174 2c20 666c  [Tuple[float, fl
-00006a50: 6f61 745d 5d20 3d20 4e6f 6e65 2c0a 2020  oat]] = None,.  
-00006a60: 2020 2020 2020 7769 6474 683a 204f 7074        width: Opt
-00006a70: 696f 6e61 6c5b 666c 6f61 745d 203d 204e  ional[float] = N
-00006a80: 6f6e 652c 0a20 2020 2020 2020 206f 7269  one,.        ori
-00006a90: 656e 7461 7469 6f6e 3a20 4f70 7469 6f6e  entation: Option
-00006aa0: 616c 5b66 6c6f 6174 5d20 3d20 4e6f 6e65  al[float] = None
-00006ab0: 2c0a 2020 2020 2020 2020 706f 7274 3a20  ,.        port: 
-00006ac0: 4f70 7469 6f6e 616c 5b50 6f72 745d 203d  Optional[Port] =
-00006ad0: 204e 6f6e 652c 0a20 2020 2020 2020 206c   None,.        l
-00006ae0: 6179 6572 3a20 4c61 7965 7253 7065 6320  ayer: LayerSpec 
-00006af0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00006b00: 706f 7274 5f74 7970 653a 204f 7074 696f  port_type: Optio
-00006b10: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
-00006b20: 0a20 2020 2020 2020 2063 726f 7373 5f73  .        cross_s
-00006b30: 6563 7469 6f6e 3a20 4f70 7469 6f6e 616c  ection: Optional
-00006b40: 5b43 726f 7373 5365 6374 696f 6e5d 203d  [CrossSection] =
-00006b50: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
-00006b60: 506f 7274 3a0a 2020 2020 2020 2020 2222  Port:.        ""
-00006b70: 2241 6464 2070 6f72 7420 746f 2063 6f6d  "Add port to com
-00006b80: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
-00006b90: 2059 6f75 2063 616e 2063 6f70 7920 616e   You can copy an
-00006ba0: 2065 7869 7374 696e 6720 706f 7274 206c   existing port l
-00006bb0: 696b 6520 6164 645f 706f 7274 2870 6f72  ike add_port(por
-00006bc0: 7420 3d20 6578 6973 7469 6e67 5f70 6f72  t = existing_por
-00006bd0: 7429 206f 720a 2020 2020 2020 2020 6372  t) or.        cr
-00006be0: 6561 7465 2061 206e 6577 2070 6f72 7420  eate a new port 
-00006bf0: 6164 645f 706f 7274 286d 796e 616d 652c  add_port(myname,
-00006c00: 206d 7963 656e 7465 722c 206d 7977 6964   mycenter, mywid
-00006c10: 7468 2c20 6d79 6f72 6965 6e74 6174 696f  th, myorientatio
-00006c20: 6e29 2e0a 2020 2020 2020 2020 596f 7520  n)..        You 
-00006c30: 6361 6e20 616c 736f 2063 6f70 7920 616e  can also copy an
-00006c40: 2065 7869 7374 696e 6720 706f 7274 0a20   existing port. 
-00006c50: 2020 2020 2020 2077 6974 6820 6120 6e65         with a ne
-00006c60: 7720 6e61 6d65 2061 6464 5f70 6f72 7428  w name add_port(
-00006c70: 706f 7274 203d 2065 7869 7374 696e 675f  port = existing_
-00006c80: 706f 7274 2c20 6e61 6d65 203d 206e 6577  port, name = new
-00006c90: 5f6e 616d 6529 0a0a 2020 2020 2020 2020  _name)..        
-00006ca0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00006cb0: 2020 6e61 6d65 3a20 706f 7274 206e 616d    name: port nam
-00006cc0: 652e 0a20 2020 2020 2020 2020 2020 2063  e..            c
-00006cd0: 656e 7465 723a 2078 2c20 792e 0a20 2020  enter: x, y..   
-00006ce0: 2020 2020 2020 2020 2077 6964 7468 3a20           width: 
-00006cf0: 696e 2075 6d2e 0a20 2020 2020 2020 2020  in um..         
-00006d00: 2020 206f 7269 656e 7461 7469 6f6e 3a20     orientation: 
-00006d10: 696e 2064 6567 2e0a 2020 2020 2020 2020  in deg..        
-00006d20: 2020 2020 706f 7274 3a20 6f70 7469 6f6e      port: option
-00006d30: 616c 2070 6f72 742e 0a20 2020 2020 2020  al port..       
-00006d40: 2020 2020 206c 6179 6572 3a20 706f 7274       layer: port
-00006d50: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
-00006d60: 2020 2020 706f 7274 5f74 7970 653a 206f      port_type: o
-00006d70: 7074 6963 616c 2c20 656c 6563 7472 6963  ptical, electric
-00006d80: 616c 2c20 7665 7274 6963 616c 5f64 632c  al, vertical_dc,
-00006d90: 2076 6572 7469 6361 6c5f 7465 2c20 7665   vertical_te, ve
-00006da0: 7274 6963 616c 5f74 6d2e 2044 6566 6175  rtical_tm. Defau
-00006db0: 6c74 7320 746f 206f 7074 6963 616c 2e0a  lts to optical..
-00006dc0: 2020 2020 2020 2020 2020 2020 6372 6f73              cros
-00006dd0: 735f 7365 6374 696f 6e3a 2070 6f72 7420  s_section: port 
-00006de0: 6372 6f73 735f 7365 6374 696f 6e2e 0a20  cross_section.. 
-00006df0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00006e00: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-00006e10: 7279 2e70 646b 2069 6d70 6f72 7420 6765  ry.pdk import ge
-00006e20: 745f 6c61 7965 720a 0a20 2020 2020 2020  t_layer..       
-00006e30: 206c 6179 6572 203d 2067 6574 5f6c 6179   layer = get_lay
-00006e40: 6572 286c 6179 6572 290a 0a20 2020 2020  er(layer)..     
-00006e50: 2020 2069 6620 706f 7274 3a0a 2020 2020     if port:.    
-00006e60: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00006e70: 7369 6e73 7461 6e63 6528 706f 7274 2c20  sinstance(port, 
-00006e80: 506f 7274 293a 0a20 2020 2020 2020 2020  Port):.         
-00006e90: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00006ea0: 7565 4572 726f 7228 6622 6164 645f 706f  ueError(f"add_po
-00006eb0: 7274 2829 206e 6565 6473 2061 2050 6f72  rt() needs a Por
-00006ec0: 742c 2067 6f74 207b 7479 7065 2870 6f72  t, got {type(por
-00006ed0: 7429 7d22 290a 2020 2020 2020 2020 2020  t)}").          
-00006ee0: 2020 7020 3d20 706f 7274 2e63 6f70 7928    p = port.copy(
-00006ef0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00006f00: 206e 616d 6520 6973 206e 6f74 204e 6f6e   name is not Non
-00006f10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00006f20: 2020 2070 2e6e 616d 6520 3d20 6e61 6d65     p.name = name
-00006f30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00006f40: 6365 6e74 6572 2069 7320 6e6f 7420 4e6f  center is not No
-00006f50: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00006f60: 2020 2020 702e 6365 6e74 6572 203d 2063      p.center = c
-00006f70: 656e 7465 720a 2020 2020 2020 2020 2020  enter.          
-00006f80: 2020 6966 2077 6964 7468 2069 7320 6e6f    if width is no
-00006f90: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00006fa0: 2020 2020 2020 2020 702e 7769 6474 6820          p.width 
-00006fb0: 3d20 7769 6474 680a 2020 2020 2020 2020  = width.        
-00006fc0: 2020 2020 6966 206f 7269 656e 7461 7469      if orientati
-00006fd0: 6f6e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  on is not None:.
-00006fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ff0: 702e 6f72 6965 6e74 6174 696f 6e20 3d20  p.orientation = 
-00007000: 6f72 6965 6e74 6174 696f 6e0a 2020 2020  orientation.    
-00007010: 2020 2020 2020 2020 6966 2070 6f72 745f          if port_
-00007020: 7479 7065 2069 7320 6e6f 7420 4e6f 6e65  type is not None
-00007030: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007040: 2020 702e 706f 7274 5f74 7970 6520 3d20    p.port_type = 
-00007050: 706f 7274 5f74 7970 650a 2020 2020 2020  port_type.      
-00007060: 2020 2020 2020 6966 206c 6179 6572 2069        if layer i
-00007070: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00007080: 2020 2020 2020 2020 2020 2020 702e 6c61              p.la
-00007090: 7965 7220 3d20 6c61 7965 720a 2020 2020  yer = layer.    
-000070a0: 2020 2020 2020 2020 702e 7061 7265 6e74          p.parent
-000070b0: 203d 2073 656c 660a 0a20 2020 2020 2020   = self..       
-000070c0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-000070d0: 286e 616d 652c 2050 6f72 7429 3a0a 2020  (name, Port):.  
-000070e0: 2020 2020 2020 2020 2020 7020 3d20 6e61            p = na
-000070f0: 6d65 2e63 6f70 7928 290a 2020 2020 2020  me.copy().      
-00007100: 2020 2020 2020 702e 7061 7265 6e74 203d        p.parent =
-00007110: 2073 656c 660a 2020 2020 2020 2020 2020   self.          
-00007120: 2020 6e61 6d65 203d 2070 2e6e 616d 650a    name = p.name.
-00007130: 2020 2020 2020 2020 656c 6966 2063 656e          elif cen
-00007140: 7465 7220 6973 204e 6f6e 653a 0a20 2020  ter is None:.   
-00007150: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00007160: 616c 7565 4572 726f 7228 2250 6f72 7420  alueError("Port 
-00007170: 6e65 6564 7320 6365 6e74 6572 2070 6172  needs center par
-00007180: 616d 6574 6572 2028 782c 2079 2920 756d  ameter (x, y) um
-00007190: 2e22 290a 0a20 2020 2020 2020 2065 6c73  .")..        els
-000071a0: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-000071b0: 203d 2050 6f72 7428 0a20 2020 2020 2020   = Port(.       
-000071c0: 2020 2020 2020 2020 206e 616d 653d 6e61           name=na
-000071d0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-000071e0: 2020 2020 6365 6e74 6572 3d63 656e 7465      center=cente
-000071f0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00007200: 2020 2077 6964 7468 3d77 6964 7468 2c0a     width=width,.
-00007210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007220: 6f72 6965 6e74 6174 696f 6e3d 6f72 6965  orientation=orie
-00007230: 6e74 6174 696f 6e2c 0a20 2020 2020 2020  ntation,.       
-00007240: 2020 2020 2020 2020 2070 6172 656e 743d           parent=
-00007250: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
-00007260: 2020 2020 2020 6c61 7965 723d 6c61 7965        layer=laye
-00007270: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00007280: 2020 2070 6f72 745f 7479 7065 3d70 6f72     port_type=por
-00007290: 745f 7479 7065 206f 7220 226f 7074 6963  t_type or "optic
-000072a0: 616c 222c 0a20 2020 2020 2020 2020 2020  al",.           
-000072b0: 2020 2020 2063 726f 7373 5f73 6563 7469       cross_secti
-000072c0: 6f6e 3d63 726f 7373 5f73 6563 7469 6f6e  on=cross_section
-000072d0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-000072e0: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
-000072f0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00007300: 2020 2020 2020 2020 2070 2e6e 616d 6520           p.name 
-00007310: 3d20 6e61 6d65 0a20 2020 2020 2020 2069  = name.        i
-00007320: 6620 702e 6e61 6d65 2069 6e20 7365 6c66  f p.name in self
-00007330: 2e70 6f72 7473 3a0a 2020 2020 2020 2020  .ports:.        
-00007340: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00007350: 7272 6f72 2866 2261 6464 5f70 6f72 7428  rror(f"add_port(
-00007360: 2920 506f 7274 206e 616d 6520 7b70 2e6e  ) Port name {p.n
-00007370: 616d 6521 727d 2065 7869 7374 7320 696e  ame!r} exists in
-00007380: 207b 7365 6c66 2e6e 616d 6521 727d 2229   {self.name!r}")
-00007390: 0a0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-000073a0: 6f72 7473 5b70 2e6e 616d 655d 203d 2070  orts[p.name] = p
-000073b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000073c0: 700a 0a20 2020 2064 6566 2061 6464 5f70  p..    def add_p
-000073d0: 6f72 7473 280a 2020 2020 2020 2020 7365  orts(.        se
-000073e0: 6c66 2c0a 2020 2020 2020 2020 706f 7274  lf,.        port
-000073f0: 733a 2055 6e69 6f6e 5b4c 6973 745b 506f  s: Union[List[Po
-00007400: 7274 5d2c 2044 6963 745b 7374 722c 2050  rt], Dict[str, P
-00007410: 6f72 745d 5d2c 0a20 2020 2020 2020 2070  ort]],.        p
-00007420: 7265 6669 783a 2073 7472 203d 2022 222c  refix: str = "",
-00007430: 0a20 2020 2020 2020 2073 7566 6669 783a  .        suffix:
+00000690: 202d 3e20 4e6f 6e65 3a0a 2020 2020 666f   -> None:.    fo
+000006a0: 7220 7265 6620 696e 2063 6f6d 706f 6e65  r ref in compone
+000006b0: 6e74 2e72 6566 6572 656e 6365 733a 0a20  nt.references:. 
+000006c0: 2020 2020 2020 2072 6566 6572 656e 6365         reference
+000006d0: 735f 7365 742e 6164 6428 7265 662e 7265  s_set.add(ref.re
+000006e0: 665f 6365 6c6c 290a 2020 2020 2020 2020  f_cell).        
+000006f0: 5f67 6574 5f64 6570 656e 6465 6e63 6965  _get_dependencie
+00000700: 7328 7265 662e 7265 665f 6365 6c6c 2c20  s(ref.ref_cell, 
+00000710: 7265 6665 7265 6e63 6573 5f73 6574 290a  references_set).
+00000720: 0a0a 6d75 7461 6269 6c69 7479 5f65 7272  ..mutability_err
+00000730: 6f72 5f6d 6573 7361 6765 203d 2022 2222  or_message = """
+00000740: 0a59 6f75 2063 616e 6e6f 7420 6d6f 6469  .You cannot modi
+00000750: 6679 2061 2043 6f6d 706f 6e65 6e74 2061  fy a Component a
+00000760: 6674 6572 2063 7265 6174 696f 6e20 6173  fter creation as
+00000770: 2069 7420 7769 6c6c 2061 6666 6563 7420   it will affect 
+00000780: 616c 6c20 6f66 2069 7473 2069 6e73 7461  all of its insta
+00000790: 6e63 6573 2e0a 0a43 7265 6174 6520 6120  nces...Create a 
+000007a0: 6e65 7720 436f 6d70 6f6e 656e 7420 616e  new Component an
+000007b0: 6420 6164 6420 6120 7265 6665 7265 6e63  d add a referenc
+000007c0: 6520 746f 2069 742e 0a0a 466f 7220 6578  e to it...For ex
+000007d0: 616d 706c 653a 0a0a 2320 4241 440a 6320  ample:..# BAD.c 
+000007e0: 3d20 6766 2e63 6f6d 706f 6e65 6e74 732e  = gf.components.
+000007f0: 6265 6e64 5f65 756c 6572 2829 0a63 2e61  bend_euler().c.a
+00000800: 6464 5f72 6566 2867 662e 636f 6d70 6f6e  dd_ref(gf.compon
+00000810: 656e 7473 2e6d 7a69 2829 290a 0a23 2047  ents.mzi())..# G
+00000820: 4f4f 440a 6320 3d20 6766 2e43 6f6d 706f  OOD.c = gf.Compo
+00000830: 6e65 6e74 2829 0a63 2e61 6464 5f72 6566  nent().c.add_ref
+00000840: 2867 662e 636f 6d70 6f6e 656e 7473 2e62  (gf.components.b
+00000850: 656e 645f 6575 6c65 7228 2929 0a63 2e61  end_euler()).c.a
+00000860: 6464 5f72 6566 2867 662e 636f 6d70 6f6e  dd_ref(gf.compon
+00000870: 656e 7473 2e6d 7a69 2829 290a 2222 220a  ents.mzi()).""".
+00000880: 0a6d 6f76 655f 6572 726f 725f 6d65 7373  .move_error_mess
+00000890: 6167 6520 3d20 2222 220a 596f 7520 6361  age = """.You ca
+000008a0: 6e6e 6f74 206d 6f76 6520 6120 436f 6d70  nnot move a Comp
+000008b0: 6f6e 656e 742e 2059 6f75 2063 616e 2063  onent. You can c
+000008c0: 7265 6174 6520 6120 6e65 7720 436f 6d70  reate a new Comp
+000008d0: 6f6e 656e 742c 2061 6464 2061 2072 6566  onent, add a ref
+000008e0: 6572 656e 6365 2074 6f20 7468 6520 6f74  erence to the ot
+000008f0: 6865 7220 436f 6d70 6f6e 656e 7420 616e  her Component an
+00000900: 6420 7468 656e 206d 6f76 6520 7468 6520  d then move the 
+00000910: 7265 6665 7265 6e63 652e 0a0a 466f 7220  reference...For 
+00000920: 6578 616d 706c 653a 0a0a 2320 4241 440a  example:..# BAD.
+00000930: 6320 3d20 6766 2e63 6f6d 706f 6e65 6e74  c = gf.component
+00000940: 732e 7374 7261 6967 6874 2829 0a63 2e78  s.straight().c.x
+00000950: 6d69 6e20 3d20 3130 0a0a 2320 474f 4f44  min = 10..# GOOD
+00000960: 0a63 203d 2067 662e 436f 6d70 6f6e 656e  .c = gf.Componen
+00000970: 7428 290a 7265 6620 3d20 632e 6164 645f  t().ref = c.add_
+00000980: 7265 6628 6766 2e63 6f6d 706f 6e65 6e74  ref(gf.component
+00000990: 732e 7374 7261 6967 6874 2829 2920 2320  s.straight()) # 
+000009a0: 6f72 2072 6566 203d 2063 203c 3c20 6766  or ref = c << gf
+000009b0: 2e63 6f6d 706f 6e65 6e74 732e 7374 7261  .components.stra
+000009c0: 6967 6874 2829 0a72 6566 2e78 6d69 6e20  ight().ref.xmin 
+000009d0: 3d20 3130 0a22 2222 0a0a 5061 7468 5479  = 10."""..PathTy
+000009e0: 7065 203d 2055 6e69 6f6e 5b73 7472 2c20  pe = Union[str, 
+000009f0: 5061 7468 5d0a 466c 6f61 7432 203d 2054  Path].Float2 = T
+00000a00: 7570 6c65 5b66 6c6f 6174 2c20 666c 6f61  uple[float, floa
+00000a10: 745d 0a4c 6179 6572 203d 2054 7570 6c65  t].Layer = Tuple
+00000a20: 5b69 6e74 2c20 696e 745d 0a4c 6179 6572  [int, int].Layer
+00000a30: 7320 3d20 5475 706c 655b 4c61 7965 722c  s = Tuple[Layer,
+00000a40: 202e 2e2e 5d0a 4c61 7965 7253 7065 6320   ...].LayerSpec 
+00000a50: 3d20 556e 696f 6e5b 7374 722c 2069 6e74  = Union[str, int
+00000a60: 2c20 4c61 7965 722c 204e 6f6e 655d 0a0a  , Layer, None]..
+00000a70: 5f74 696d 6573 7461 6d70 3230 3139 203d  _timestamp2019 =
+00000a80: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
+00000a90: 6d65 2e66 726f 6d74 696d 6573 7461 6d70  me.fromtimestamp
+00000aa0: 2831 3537 3230 3134 3139 322e 3832 3733  (1572014192.8273
+00000ab0: 290a 4d41 585f 4e41 4d45 5f4c 454e 4754  ).MAX_NAME_LENGT
+00000ac0: 4820 3d20 3332 0a0a 0a64 6566 205f 726e  H = 32...def _rn
+00000ad0: 6428 6172 722c 2070 7265 6369 7369 6f6e  d(arr, precision
+00000ae0: 3d31 652d 3429 3a0a 2020 2020 6172 7220  =1e-4):.    arr 
+00000af0: 3d20 6e70 2e61 7363 6f6e 7469 6775 6f75  = np.ascontiguou
+00000b00: 7361 7272 6179 2861 7272 290a 2020 2020  sarray(arr).    
+00000b10: 6e64 6967 6974 7320 3d20 726f 756e 6428  ndigits = round(
+00000b20: 2d6d 6174 682e 6c6f 6731 3028 7072 6563  -math.log10(prec
+00000b30: 6973 696f 6e29 290a 2020 2020 7265 7475  ision)).    retu
+00000b40: 726e 206e 702e 6173 636f 6e74 6967 756f  rn np.ascontiguo
+00000b50: 7573 6172 7261 7928 6172 722e 726f 756e  usarray(arr.roun
+00000b60: 6428 6e64 6967 6974 7329 202f 2070 7265  d(ndigits) / pre
+00000b70: 6369 7369 6f6e 2c20 6474 7970 653d 6e70  cision, dtype=np
+00000b80: 2e69 6e74 3634 290a 0a0a 636c 6173 7320  .int64)...class 
+00000b90: 436f 6d70 6f6e 656e 7428 5f47 656f 6d65  Component(_Geome
+00000ba0: 7472 7948 656c 7065 7229 3a0a 2020 2020  tryHelper):.    
+00000bb0: 2222 2241 2043 6f6d 706f 6e65 6e74 2069  """A Component i
+00000bc0: 7320 616e 2065 6d70 7479 2063 616e 7661  s an empty canva
+00000bd0: 7320 7768 6572 6520 796f 7520 6164 6420  s where you add 
+00000be0: 706f 6c79 676f 6e73 2c20 7265 6665 7265  polygons, refere
+00000bf0: 6e63 6573 2061 6e64 2070 6f72 7473 205c  nces and ports \
+00000c00: 0a20 2020 2020 2020 2020 2020 2028 746f  .            (to
+00000c10: 2063 6f6e 6e65 6374 2074 6f20 6f74 6865   connect to othe
+00000c20: 7220 636f 6d70 6f6e 656e 7473 292e 0a0a  r components)...
+00000c30: 2020 2020 2d20 7374 6f72 6573 2073 6574      - stores set
+00000c40: 7469 6e67 7320 7468 6174 2079 6f75 2075  tings that you u
+00000c50: 7365 2074 6f20 6275 696c 6420 7468 6520  se to build the 
+00000c60: 636f 6d70 6f6e 656e 740a 2020 2020 2d20  component.    - 
+00000c70: 7374 6f72 6573 2069 6e66 6f20 7468 6174  stores info that
+00000c80: 2079 6f75 2077 616e 7420 746f 2075 7365   you want to use
+00000c90: 0a20 2020 202d 2063 616e 2072 6574 7572  .    - can retur
+00000ca0: 6e20 706f 7274 7320 6279 2074 7970 6520  n ports by type 
+00000cb0: 286f 7074 6963 616c 2c20 656c 6563 7472  (optical, electr
+00000cc0: 6963 616c 202e 2e2e 290a 2020 2020 2d20  ical ...).    - 
+00000cd0: 6361 6e20 7265 7475 726e 206e 6574 6c69  can return netli
+00000ce0: 7374 2066 6f72 2063 6972 6375 6974 2073  st for circuit s
+00000cf0: 696d 756c 6174 696f 6e0a 2020 2020 2d20  imulation.    - 
+00000d00: 6361 6e20 7772 6974 6520 746f 2047 4453  can write to GDS
+00000d10: 2c20 4f41 5349 530a 2020 2020 2d20 6361  , OASIS.    - ca
+00000d20: 6e20 7368 6f77 2069 6e20 4b4c 6179 6f75  n show in KLayou
+00000d30: 742c 206d 6174 706c 6f74 6c69 622c 2033  t, matplotlib, 3
+00000d40: 442c 2051 5420 7669 6577 6572 2c20 686f  D, QT viewer, ho
+00000d50: 6c6f 7669 6577 730a 2020 2020 2d20 6361  loviews.    - ca
+00000d60: 6e20 7265 7475 726e 2063 6f70 792c 206d  n return copy, m
+00000d70: 6972 726f 722c 2066 6c61 7474 656e 6564  irror, flattened
+00000d80: 2028 6e6f 2072 6566 6572 656e 6365 7329   (no references)
+00000d90: 0a0a 2020 2020 4172 6773 3a0a 2020 2020  ..    Args:.    
+00000da0: 2020 2020 6e61 6d65 3a20 636f 6d70 6f6e      name: compon
+00000db0: 656e 745f 6e61 6d65 2e20 5573 6520 4063  ent_name. Use @c
+00000dc0: 656c 6c20 6465 636f 7261 746f 7220 666f  ell decorator fo
+00000dd0: 7220 6175 746f 2d6e 616d 696e 672e 0a20  r auto-naming.. 
+00000de0: 2020 2020 2020 2077 6974 685f 7575 6964         with_uuid
+00000df0: 3a20 6164 6473 2075 6e69 7175 6520 6964  : adds unique id
+00000e00: 656e 7469 6669 6572 2e0a 0a20 2020 2050  entifier...    P
+00000e10: 726f 7065 7274 6965 733a 0a20 2020 2020  roperties:.     
+00000e20: 2020 2069 6e66 6f3a 2064 6963 7469 6f6e     info: diction
+00000e30: 6172 7920 7468 6174 2069 6e63 6c75 6465  ary that include
+00000e40: 730a 2020 2020 2020 2020 2020 2020 2d20  s.            - 
+00000e50: 6465 7269 7665 6420 7072 6f70 6572 7469  derived properti
+00000e60: 6573 0a20 2020 2020 2020 2020 2020 202d  es.            -
+00000e70: 2065 7874 6572 6e61 6c20 6d65 7461 6461   external metada
+00000e80: 7461 2028 7465 7374 5f70 726f 746f 636f  ta (test_protoco
+00000e90: 6c2c 2064 6f63 732c 202e 2e2e 290a 2020  l, docs, ...).  
+00000ea0: 2020 2020 2020 2020 2020 2d20 7369 6d75            - simu
+00000eb0: 6c61 7469 6f6e 5f73 6574 7469 6e67 730a  lation_settings.
+00000ec0: 2020 2020 2020 2020 2020 2020 2d20 6675              - fu
+00000ed0: 6e63 7469 6f6e 5f6e 616d 650a 2020 2020  nction_name.    
+00000ee0: 2020 2020 2020 2020 2d20 6e61 6d65 3a20          - name: 
+00000ef0: 666f 7220 7468 6520 636f 6d70 6f6e 656e  for the componen
+00000f00: 740a 0a20 2020 2020 2020 2073 6574 7469  t..        setti
+00000f10: 6e67 733a 0a20 2020 2020 2020 2020 2020  ngs:.           
+00000f20: 2066 756c 6c3a 2066 756c 6c20 7365 7474   full: full sett
+00000f30: 696e 6773 2070 6173 7365 6420 746f 2074  ings passed to t
+00000f40: 6865 2066 756e 6374 696f 6e20 746f 2063  he function to c
+00000f50: 7265 6174 6520 636f 6d70 6f6e 656e 742e  reate component.
+00000f60: 0a20 2020 2020 2020 2020 2020 2063 6861  .            cha
+00000f70: 6e67 6564 3a20 6368 616e 6765 6420 7365  nged: changed se
+00000f80: 7474 696e 6773 2e0a 2020 2020 2020 2020  ttings..        
+00000f90: 2020 2020 6465 6661 756c 743a 2064 6566      default: def
+00000fa0: 6175 6c74 2063 6f6d 706f 6e65 6e74 2073  ault component s
+00000fb0: 6574 7469 6e67 732e 0a20 2020 2020 2020  ettings..       
+00000fc0: 2020 2020 2063 6869 6c64 3a20 6469 6374       child: dict
+00000fd0: 2069 6e66 6f20 6672 6f6d 2074 6865 2063   info from the c
+00000fe0: 6869 6c64 7265 6e2c 2069 6620 616e 792e  hildren, if any.
+00000ff0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+00001000: 6620 5f5f 696e 6974 5f5f 280a 2020 2020  f __init__(.    
+00001010: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00001020: 2020 6e61 6d65 3a20 7374 7220 3d20 2255    name: str = "U
+00001030: 6e6e 616d 6564 222c 0a20 2020 2020 2020  nnamed",.       
+00001040: 2077 6974 685f 7575 6964 3a20 626f 6f6c   with_uuid: bool
+00001050: 203d 2046 616c 7365 2c0a 2020 2020 2920   = False,.    ) 
+00001060: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00001070: 2022 2222 496e 6974 6961 6c69 7a65 2074   """Initialize t
+00001080: 6865 2043 6f6d 706f 6e65 6e74 206f 626a  he Component obj
+00001090: 6563 742e 2222 220a 2020 2020 2020 2020  ect.""".        
+000010a0: 7365 6c66 2e75 6964 203d 2073 7472 2875  self.uid = str(u
+000010b0: 7569 642e 7575 6964 3428 2929 5b3a 385d  uid.uuid4())[:8]
+000010c0: 0a20 2020 2020 2020 2069 6620 7769 7468  .        if with
+000010d0: 5f75 7569 6420 6f72 206e 616d 6520 3d3d  _uuid or name ==
+000010e0: 2022 556e 6e61 6d65 6422 3a0a 2020 2020   "Unnamed":.    
+000010f0: 2020 2020 2020 2020 6e61 6d65 202b 3d20          name += 
+00001100: 6622 5f7b 7365 6c66 2e75 6964 7d22 0a0a  f"_{self.uid}"..
+00001110: 2020 2020 2020 2020 7365 6c66 2e5f 6365          self._ce
+00001120: 6c6c 203d 2067 6473 746b 2e43 656c 6c28  ll = gdstk.Cell(
+00001130: 6e61 6d65 3d6e 616d 6529 0a20 2020 2020  name=name).     
+00001140: 2020 2073 656c 662e 6e61 6d65 203d 206e     self.name = n
+00001150: 616d 650a 2020 2020 2020 2020 7365 6c66  ame.        self
+00001160: 2e69 6e66 6f3a 2044 6963 745b 7374 722c  .info: Dict[str,
+00001170: 2041 6e79 5d20 3d20 7b7d 0a0a 2020 2020   Any] = {}..    
+00001180: 2020 2020 7365 6c66 2e73 6574 7469 6e67      self.setting
+00001190: 733a 2044 6963 745b 7374 722c 2041 6e79  s: Dict[str, Any
+000011a0: 5d20 3d20 7b7d 0a20 2020 2020 2020 2073  ] = {}.        s
+000011b0: 656c 662e 5f6c 6f63 6b65 6420 3d20 4661  elf._locked = Fa
+000011c0: 6c73 650a 2020 2020 2020 2020 7365 6c66  lse.        self
+000011d0: 2e67 6574 5f63 6869 6c64 5f6e 616d 6520  .get_child_name 
+000011e0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+000011f0: 7365 6c66 2e5f 7265 6665 7265 6e63 655f  self._reference_
+00001200: 6e61 6d65 735f 636f 756e 7465 7220 3d20  names_counter = 
+00001210: 436f 756e 7465 7228 290a 2020 2020 2020  Counter().      
+00001220: 2020 7365 6c66 2e5f 7265 6665 7265 6e63    self._referenc
+00001230: 655f 6e61 6d65 735f 7573 6564 203d 2073  e_names_used = s
+00001240: 6574 2829 0a20 2020 2020 2020 2073 656c  et().        sel
+00001250: 662e 5f6e 616d 6564 5f72 6566 6572 656e  f._named_referen
+00001260: 6365 7320 3d20 7b7d 0a20 2020 2020 2020  ces = {}.       
+00001270: 2073 656c 662e 5f72 6566 6572 656e 6365   self._reference
+00001280: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
+00001290: 7365 6c66 2e70 6f72 7473 203d 207b 7d0a  self.ports = {}.
+000012a0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+000012b0: 2020 2064 6566 2072 6566 6572 656e 6365     def reference
+000012c0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+000012d0: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
+000012e0: 6665 7265 6e63 6573 0a0a 2020 2020 4070  ferences..    @p
+000012f0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+00001300: 706f 6c79 676f 6e73 2873 656c 6629 202d  polygons(self) -
+00001310: 3e20 4c69 7374 5b50 6f6c 7967 6f6e 5d3a  > List[Polygon]:
+00001320: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00001330: 7365 6c66 2e5f 6365 6c6c 2e70 6f6c 7967  self._cell.polyg
+00001340: 6f6e 730a 0a20 2020 2040 7072 6f70 6572  ons..    @proper
+00001350: 7479 0a20 2020 2064 6566 2061 7265 6128  ty.    def area(
+00001360: 7365 6c66 2920 2d3e 2066 6c6f 6174 3a0a  self) -> float:.
+00001370: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00001380: 656c 662e 5f63 656c 6c2e 6172 6561 0a0a  elf._cell.area..
+00001390: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+000013a0: 2020 6465 6620 6c61 6265 6c73 2873 656c    def labels(sel
+000013b0: 6629 202d 3e20 4c69 7374 5b4c 6162 656c  f) -> List[Label
+000013c0: 5d3a 0a20 2020 2020 2020 2072 6574 7572  ]:.        retur
+000013d0: 6e20 7365 6c66 2e5f 6365 6c6c 2e6c 6162  n self._cell.lab
+000013e0: 656c 730a 0a20 2020 2040 7072 6f70 6572  els..    @proper
+000013f0: 7479 0a20 2020 2064 6566 2070 6174 6873  ty.    def paths
+00001400: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00001410: 7265 7475 726e 2073 656c 662e 5f63 656c  return self._cel
+00001420: 6c2e 7061 7468 730a 0a20 2020 2040 7072  l.paths..    @pr
+00001430: 6f70 6572 7479 0a20 2020 2064 6566 206e  operty.    def n
+00001440: 616d 6528 7365 6c66 2920 2d3e 2073 7472  ame(self) -> str
+00001450: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00001460: 2073 656c 662e 5f63 656c 6c2e 6e61 6d65   self._cell.name
+00001470: 0a0a 2020 2020 406e 616d 652e 7365 7474  ..    @name.sett
+00001480: 6572 0a20 2020 2064 6566 206e 616d 6528  er.    def name(
+00001490: 7365 6c66 2c20 7661 6c75 6529 202d 3e20  self, value) -> 
+000014a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7365  None:.        se
+000014b0: 6c66 2e5f 6365 6c6c 2e6e 616d 6520 3d20  lf._cell.name = 
+000014c0: 7661 6c75 650a 0a20 2020 2064 6566 205f  value..    def _
+000014d0: 5f69 7465 725f 5f28 7365 6c66 293a 0a20  _iter__(self):. 
+000014e0: 2020 2020 2020 2022 2222 596f 7520 6361         """You ca
+000014f0: 6e20 6974 6572 6174 6520 6f76 6572 2070  n iterate over p
+00001500: 6f6c 7967 6f6e 732c 2070 6174 6873 2c20  olygons, paths, 
+00001510: 6c61 6265 6c73 2061 6e64 2072 6566 6572  labels and refer
+00001520: 656e 6365 732e 2222 220a 2020 2020 2020  ences.""".      
+00001530: 2020 7265 7475 726e 2069 7465 7274 6f6f    return itertoo
+00001540: 6c73 2e63 6861 696e 2873 656c 662e 706f  ls.chain(self.po
+00001550: 6c79 676f 6e73 2c20 7365 6c66 2e70 6174  lygons, self.pat
+00001560: 6873 2c20 7365 6c66 2e6c 6162 656c 732c  hs, self.labels,
+00001570: 2073 656c 662e 7265 6665 7265 6e63 6573   self.references
+00001580: 290a 0a20 2020 2064 6566 2067 6574 5f70  )..    def get_p
+00001590: 6f6c 7967 6f6e 7328 0a20 2020 2020 2020  olygons(.       
+000015a0: 2073 656c 662c 0a20 2020 2020 2020 2062   self,.        b
+000015b0: 795f 7370 6563 3a20 556e 696f 6e5b 626f  y_spec: Union[bo
+000015c0: 6f6c 2c20 5475 706c 655b 696e 742c 2069  ol, Tuple[int, i
+000015d0: 6e74 5d5d 203d 2046 616c 7365 2c0a 2020  nt]] = False,.  
+000015e0: 2020 2020 2020 6465 7074 683a 204f 7074        depth: Opt
+000015f0: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
+00001600: 652c 0a20 2020 2020 2020 2069 6e63 6c75  e,.        inclu
+00001610: 6465 5f70 6174 6873 3a20 626f 6f6c 203d  de_paths: bool =
+00001620: 2054 7275 652c 0a20 2020 2020 2020 2061   True,.        a
+00001630: 735f 6172 7261 793a 2062 6f6f 6c20 3d20  s_array: bool = 
+00001640: 5472 7565 2c0a 2020 2020 2920 2d3e 2055  True,.    ) -> U
+00001650: 6e69 6f6e 5b4c 6973 745b 506f 6c79 676f  nion[List[Polygo
+00001660: 6e5d 2c20 4469 6374 5b54 7570 6c65 5b69  n], Dict[Tuple[i
+00001670: 6e74 2c20 696e 745d 2c20 4c69 7374 5b50  nt, int], List[P
+00001680: 6f6c 7967 6f6e 5d5d 5d3a 0a20 2020 2020  olygon]]]:.     
+00001690: 2020 2022 2222 5265 7475 726e 2061 206c     """Return a l
+000016a0: 6973 7420 6f66 2070 6f6c 7967 6f6e 7320  ist of polygons 
+000016b0: 696e 2074 6869 7320 6365 6c6c 2e0a 0a20  in this cell... 
+000016c0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+000016d0: 2020 2020 2020 2020 2062 795f 7370 6563           by_spec
+000016e0: 3a20 626f 6f6c 206f 7220 6c61 7965 720a  : bool or layer.
+000016f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001700: 4966 2054 7275 652c 2074 6865 2072 6574  If True, the ret
+00001710: 7572 6e20 7661 6c75 6520 6973 2061 2064  urn value is a d
+00001720: 6963 7469 6f6e 6172 7920 7769 7468 2074  ictionary with t
+00001730: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
+00001740: 2020 2070 6f6c 7967 6f6e 7320 6f66 2065     polygons of e
+00001750: 6163 6820 696e 6469 7669 6475 616c 2070  ach individual p
+00001760: 6169 7220 286c 6179 6572 2c20 6461 7461  air (layer, data
+00001770: 7479 7065 292c 2077 6869 6368 0a20 2020  type), which.   
+00001780: 2020 2020 2020 2020 2020 2020 2061 7265               are
+00001790: 2075 7365 6420 6173 206b 6579 732e 2020   used as keys.  
+000017a0: 4966 2073 6574 2074 6f20 6120 7475 706c  If set to a tupl
+000017b0: 6520 6f66 2028 6c61 7965 722c 2064 6174  e of (layer, dat
+000017c0: 6174 7970 6529 2c0a 2020 2020 2020 2020  atype),.        
+000017d0: 2020 2020 2020 2020 6f6e 6c79 2070 6f6c          only pol
+000017e0: 7967 6f6e 7320 7769 7468 2074 6861 7420  ygons with that 
+000017f0: 7370 6563 6966 6963 6174 696f 6e20 6172  specification ar
+00001800: 6520 7265 7475 726e 6564 2e0a 2020 2020  e returned..    
+00001810: 2020 2020 2020 2020 6465 7074 683a 2069          depth: i
+00001820: 6e74 6567 6572 206f 7220 4e6f 6e65 0a20  nteger or None. 
+00001830: 2020 2020 2020 2020 2020 2020 2020 2049                 I
+00001840: 6620 6e6f 7420 4e6f 6e65 2c20 6465 6669  f not None, defi
+00001850: 6e65 7320 6672 6f6d 2068 6f77 206d 616e  nes from how man
+00001860: 7920 7265 6665 7265 6e63 6520 6c65 7665  y reference leve
+00001870: 6c73 2074 6f0a 2020 2020 2020 2020 2020  ls to.          
+00001880: 2020 2020 2020 7265 7472 6965 7665 2070        retrieve p
+00001890: 6f6c 7967 6f6e 732e 2020 5265 6665 7265  olygons.  Refere
+000018a0: 6e63 6573 2062 656c 6f77 2074 6869 7320  nces below this 
+000018b0: 6c65 7665 6c20 7769 6c6c 2072 6573 756c  level will resul
+000018c0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+000018d0: 2020 696e 2061 2062 6f75 6e64 696e 6720    in a bounding 
+000018e0: 626f 782e 2020 4966 2060 6279 5f73 7065  box.  If `by_spe
+000018f0: 6360 2069 7320 5472 7565 2074 6865 206b  c` is True the k
+00001900: 6579 2077 696c 6c20 6265 2074 6865 0a20  ey will be the. 
+00001910: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00001920: 616d 6520 6f66 2074 6869 7320 6365 6c6c  ame of this cell
+00001930: 2e0a 2020 2020 2020 2020 2020 2020 696e  ..            in
+00001940: 636c 7564 655f 7061 7468 733a 2049 6620  clude_paths: If 
+00001950: 5472 7565 2c20 706f 6c79 676f 6e61 6c20  True, polygonal 
+00001960: 7265 7072 6573 656e 7461 7469 6f6e 206f  representation o
+00001970: 6620 7061 7468 7320 6172 6520 616c 736f  f paths are also
+00001980: 2069 6e63 6c75 6465 6420 696e 2074 6865   included in the
+00001990: 2072 6573 756c 742e 0a20 2020 2020 2020   result..       
+000019a0: 2020 2020 2061 735f 6172 7261 793a 2077       as_array: w
+000019b0: 6865 6e20 6173 5f61 7272 6179 3d66 616c  hen as_array=fal
+000019c0: 7365 2c20 7265 7475 726e 2074 6865 2050  se, return the P
+000019d0: 6f6c 7967 6f6e 206f 626a 6563 7473 2069  olygon objects i
+000019e0: 6e73 7465 6164 2e0a 2020 2020 2020 2020  nstead..        
+000019f0: 2020 2020 2020 2020 706f 6c79 676f 6e20          polygon 
+00001a00: 6f62 6a65 6374 7320 6861 7665 206d 6f72  objects have mor
+00001a10: 6520 696e 666f 726d 6174 696f 6e20 2865  e information (e
+00001a20: 7370 6563 6961 6c6c 7920 7768 656e 2062  specially when b
+00001a30: 795f 7370 6563 3d46 616c 7365 2920 616e  y_spec=False) an
+00001a40: 6420 6172 6520 6661 7374 6572 2074 6f20  d are faster to 
+00001a50: 7265 7472 6965 7665 2e0a 0a20 2020 2020  retrieve...     
+00001a60: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+00001a70: 2020 2020 2020 206f 7574 3a20 6c69 7374         out: list
+00001a80: 206f 6620 6172 7261 792d 6c69 6b65 5b4e   of array-like[N
+00001a90: 5d5b 325d 206f 7220 6469 6374 696f 6e61  ][2] or dictiona
+00001aa0: 7279 0a20 2020 2020 2020 2020 2020 2020  ry.             
+00001ab0: 2020 204c 6973 7420 636f 6e74 6169 6e69     List containi
+00001ac0: 6e67 2074 6865 2063 6f6f 7264 696e 6174  ng the coordinat
+00001ad0: 6573 206f 6620 7468 6520 7665 7274 6963  es of the vertic
+00001ae0: 6573 206f 6620 6561 6368 0a20 2020 2020  es of each.     
+00001af0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+00001b00: 6f6e 2c20 6f72 2064 6963 7469 6f6e 6172  on, or dictionar
+00001b10: 7920 7769 7468 2077 6974 6820 7468 6520  y with with the 
+00001b20: 6c69 7374 206f 6620 706f 6c79 676f 6e73  list of polygons
+00001b30: 2028 6966 0a20 2020 2020 2020 2020 2020   (if.           
+00001b40: 2020 2020 2060 6279 5f73 7065 6360 2069       `by_spec` i
+00001b50: 7320 5472 7565 292e 0a0a 2020 2020 2020  s True)...      
+00001b60: 2020 4e6f 7465 3a0a 2020 2020 2020 2020    Note:.        
+00001b70: 2020 2020 496e 7374 616e 6365 7320 6f66      Instances of
+00001b80: 2060 466c 6578 5061 7468 6020 616e 6420   `FlexPath` and 
+00001b90: 6052 6f62 7573 7450 6174 6860 2061 7265  `RobustPath` are
+00001ba0: 2061 6c73 6f20 696e 636c 7564 6564 2069   also included i
+00001bb0: 6e0a 2020 2020 2020 2020 2020 2020 7468  n.            th
+00001bc0: 6520 7265 7375 6c74 2062 7920 636f 6d70  e result by comp
+00001bd0: 7574 696e 6720 7468 6569 7220 706f 6c79  uting their poly
+00001be0: 676f 6e61 6c20 626f 756e 6461 7279 2e0a  gonal boundary..
+00001bf0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00001c00: 2020 2020 7265 7475 726e 2067 6574 5f70      return get_p
+00001c10: 6f6c 7967 6f6e 7328 0a20 2020 2020 2020  olygons(.       
+00001c20: 2020 2020 2069 6e73 7461 6e63 653d 7365       instance=se
+00001c30: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+00001c40: 6279 5f73 7065 633d 6279 5f73 7065 632c  by_spec=by_spec,
+00001c50: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
+00001c60: 7468 3d64 6570 7468 2c0a 2020 2020 2020  th=depth,.      
+00001c70: 2020 2020 2020 696e 636c 7564 655f 7061        include_pa
+00001c80: 7468 733d 696e 636c 7564 655f 7061 7468  ths=include_path
+00001c90: 732c 0a20 2020 2020 2020 2020 2020 2061  s,.            a
+00001ca0: 735f 6172 7261 793d 6173 5f61 7272 6179  s_array=as_array
+00001cb0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00001cc0: 2064 6566 2067 6574 5f64 6570 656e 6465   def get_depende
+00001cd0: 6e63 6965 7328 7365 6c66 2c20 7265 6375  ncies(self, recu
+00001ce0: 7273 6976 653a 2062 6f6f 6c20 3d20 4661  rsive: bool = Fa
+00001cf0: 6c73 6529 202d 3e20 4c69 7374 5b43 6f6d  lse) -> List[Com
+00001d00: 706f 6e65 6e74 5d3a 0a20 2020 2020 2020  ponent]:.       
+00001d10: 2022 2222 5265 7475 726e 2061 2073 6574   """Return a set
+00001d20: 206f 6620 7468 6520 6365 6c6c 7320 696e   of the cells in
+00001d30: 636c 7564 6564 2069 6e20 7468 6973 2063  cluded in this c
+00001d40: 656c 6c20 6173 2072 6566 6572 656e 6365  ell as reference
+00001d50: 732e 0a0a 2020 2020 2020 2020 4172 6773  s...        Args
+00001d60: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00001d70: 6375 7273 6976 653a 2049 6620 5472 7565  cursive: If True
+00001d80: 2072 6574 7572 6e73 2064 6570 656e 6465   returns depende
+00001d90: 6e63 6965 7320 7265 6375 7273 6976 656c  ncies recursivel
+00001da0: 792e 0a0a 2020 2020 2020 2020 5265 7475  y...        Retu
+00001db0: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
+00001dc0: 206f 7574 3a20 6c69 7374 206f 6620 436f   out: list of Co
+00001dd0: 6d70 6f6e 656e 7473 2072 6566 6572 656e  mponents referen
+00001de0: 6365 6420 6279 2074 6869 7320 436f 6d70  ced by this Comp
+00001df0: 6f6e 656e 742e 0a20 2020 2020 2020 2022  onent..        "
+00001e00: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+00001e10: 7420 7265 6375 7273 6976 653a 0a20 2020  t recursive:.   
+00001e20: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00001e30: 6c69 7374 287b 7265 662e 7061 7265 6e74  list({ref.parent
+00001e40: 2066 6f72 2072 6566 2069 6e20 7365 6c66   for ref in self
+00001e50: 2e72 6566 6572 656e 6365 737d 290a 0a20  .references}).. 
+00001e60: 2020 2020 2020 2072 6566 6572 656e 6365         reference
+00001e70: 735f 7365 7420 3d20 7365 7428 290a 2020  s_set = set().  
+00001e80: 2020 2020 2020 5f67 6574 5f64 6570 656e        _get_depen
+00001e90: 6465 6e63 6965 7328 7365 6c66 2c20 7265  dencies(self, re
+00001ea0: 6665 7265 6e63 6573 5f73 6574 3d72 6566  ferences_set=ref
+00001eb0: 6572 656e 6365 735f 7365 7429 0a20 2020  erences_set).   
+00001ec0: 2020 2020 2072 6574 7572 6e20 6c69 7374       return list
+00001ed0: 2872 6566 6572 656e 6365 735f 7365 7429  (references_set)
+00001ee0: 0a0a 2020 2020 6465 6620 6765 745f 636f  ..    def get_co
+00001ef0: 6d70 6f6e 656e 745f 7370 6563 2873 656c  mponent_spec(sel
+00001f00: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+00001f10: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
+00001f20: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00001f30: 2020 2022 636f 6d70 6f6e 656e 7422 3a20     "component": 
+00001f40: 7365 6c66 2e73 6574 7469 6e67 732e 6675  self.settings.fu
+00001f50: 6e63 7469 6f6e 5f6e 616d 652c 0a20 2020  nction_name,.   
+00001f60: 2020 2020 2020 2020 2020 2020 2022 7365               "se
+00001f70: 7474 696e 6773 223a 2073 656c 662e 7365  ttings": self.se
+00001f80: 7474 696e 6773 2e63 6861 6e67 6564 2c0a  ttings.changed,.
+00001f90: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+00001fa0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00001fb0: 662e 7365 7474 696e 6773 0a20 2020 2020  f.settings.     
+00001fc0: 2020 2020 2020 2065 6c73 6520 7b22 636f         else {"co
+00001fd0: 6d70 6f6e 656e 7422 3a20 7365 6c66 2e6e  mponent": self.n
+00001fe0: 616d 652c 2022 7365 7474 696e 6773 223a  ame, "settings":
+00001ff0: 207b 7d7d 0a20 2020 2020 2020 2029 0a0a   {}}.        )..
+00002000: 2020 2020 6465 6620 5f5f 6765 7469 7465      def __getite
+00002010: 6d5f 5f28 7365 6c66 2c20 6b65 7929 3a0a  m__(self, key):.
+00002020: 2020 2020 2020 2020 2222 2241 6363 6573          """Acces
+00002030: 7320 7265 6665 7265 6e63 6520 706f 7274  s reference port
+00002040: 732e 2222 220a 2020 2020 2020 2020 6966  s.""".        if
+00002050: 206b 6579 206e 6f74 2069 6e20 7365 6c66   key not in self
+00002060: 2e70 6f72 7473 3a0a 2020 2020 2020 2020  .ports:.        
+00002070: 2020 2020 706f 7274 7320 3d20 6c69 7374      ports = list
+00002080: 2873 656c 662e 706f 7274 732e 6b65 7973  (self.ports.keys
+00002090: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
+000020a0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+000020b0: 2866 227b 6b65 7921 727d 206e 6f74 2069  (f"{key!r} not i
+000020c0: 6e20 7b70 6f72 7473 7d22 290a 0a20 2020  n {ports}")..   
+000020d0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000020e0: 2e70 6f72 7473 5b6b 6579 5d0a 0a20 2020  .ports[key]..   
+000020f0: 2064 6566 205f 5f6c 7368 6966 745f 5f28   def __lshift__(
+00002100: 7365 6c66 2c20 656c 656d 656e 7429 3a0a  self, element):.
+00002110: 2020 2020 2020 2020 2222 2243 6f6e 7665          """Conve
+00002120: 6e69 656e 6365 206f 7065 7261 746f 7220  nience operator 
+00002130: 6571 7569 7661 6c65 6e74 2074 6f20 6164  equivalent to ad
+00002140: 645f 7265 6628 292e 2222 220a 2020 2020  d_ref().""".    
+00002150: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00002160: 6164 645f 7265 6628 656c 656d 656e 7429  add_ref(element)
+00002170: 0a0a 2020 2020 6465 6620 756e 6c6f 636b  ..    def unlock
+00002180: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00002190: 2020 2020 2020 2020 2222 224f 6e6c 7920          """Only 
+000021a0: 646f 2074 6869 7320 6966 2079 6f75 206b  do this if you k
+000021b0: 6e6f 7720 7768 6174 2079 6f75 2061 7265  now what you are
+000021c0: 2064 6f69 6e67 2e22 2222 0a20 2020 2020   doing.""".     
+000021d0: 2020 2073 656c 662e 5f6c 6f63 6b65 6420     self._locked 
+000021e0: 3d20 4661 6c73 650a 0a20 2020 2064 6566  = False..    def
+000021f0: 206c 6f63 6b28 7365 6c66 2920 2d3e 204e   lock(self) -> N
+00002200: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00002210: 4d61 6b65 7320 7375 7265 2063 6f6d 706f  Makes sure compo
+00002220: 6e65 6e74 7320 6361 6e27 7420 6164 6420  nents can't add 
+00002230: 6e65 7720 656c 656d 656e 7473 206f 7220  new elements or 
+00002240: 6d6f 7665 2065 7869 7374 696e 6720 6f6e  move existing on
+00002250: 6573 2e0a 0a20 2020 2020 2020 2043 6f6d  es...        Com
+00002260: 706f 6e65 6e74 7320 6c6f 636b 2061 7574  ponents lock aut
+00002270: 6f6d 6174 6963 616c 6c79 2077 6865 6e20  omatically when 
+00002280: 676f 696e 6720 696e 746f 2074 6865 2043  going into the C
+00002290: 4143 4845 2074 6f0a 2020 2020 2020 2020  ACHE to.        
+000022a0: 656e 7375 7265 206f 6e65 2063 6f6d 706f  ensure one compo
+000022b0: 6e65 6e74 2064 6f65 7320 6e6f 7420 6368  nent does not ch
+000022c0: 616e 6765 206f 7468 6572 730a 2020 2020  ange others.    
+000022d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000022e0: 7365 6c66 2e5f 6c6f 636b 6564 203d 2054  self._locked = T
+000022f0: 7275 650a 0a20 2020 2064 6566 205f 5f73  rue..    def __s
+00002300: 6574 6974 656d 5f5f 2873 656c 662c 206b  etitem__(self, k
+00002310: 6579 2c20 656c 656d 656e 7429 3a0a 2020  ey, element):.  
+00002320: 2020 2020 2020 2222 2241 6c6c 6f77 2061        """Allow a
+00002330: 6464 696e 6720 706f 6c79 676f 6e73 2061  dding polygons a
+00002340: 6e64 2063 656c 6c20 7265 6665 7265 6e63  nd cell referenc
+00002350: 6573 2e0a 0a20 2020 2020 2020 206c 696b  es...        lik
+00002360: 6520 445b 2761 7263 3327 5d20 3d20 7067  e D['arc3'] = pg
+00002370: 2e61 7263 2829 0a0a 2020 2020 2020 2020  .arc()..        
+00002380: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+00002390: 2020 6b65 793a 2041 6c69 6173 206e 616d    key: Alias nam
+000023a0: 652e 0a20 2020 2020 2020 2020 2020 2065  e..            e
+000023b0: 6c65 6d65 6e74 3a20 4f62 6a65 6374 2074  lement: Object t
+000023c0: 6861 7420 7769 6c6c 2062 6520 6163 6365  hat will be acce
+000023d0: 7373 6962 6c65 2062 7920 616c 6961 7320  ssible by alias 
+000023e0: 6e61 6d65 2e0a 0a20 2020 2020 2020 2022  name...        "
+000023f0: 2222 0a20 2020 2020 2020 2069 6620 6973  "".        if is
+00002400: 696e 7374 616e 6365 2865 6c65 6d65 6e74  instance(element
+00002410: 2c20 2843 6f6d 706f 6e65 6e74 5265 6665  , (ComponentRefe
+00002420: 7265 6e63 652c 2050 6f6c 7967 6f6e 2929  rence, Polygon))
+00002430: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00002440: 6c66 2e6e 616d 6564 5f72 6566 6572 656e  lf.named_referen
+00002450: 6365 735b 6b65 795d 203d 2065 6c65 6d65  ces[key] = eleme
+00002460: 6e74 0a20 2020 2020 2020 2065 6c73 653a  nt.        else:
+00002470: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00002480: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+00002490: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000024a0: 2254 7269 6564 2074 6f20 6173 7369 676e  "Tried to assign
+000024b0: 2061 6c69 6173 207b 6b65 7921 727d 2069   alias {key!r} i
+000024c0: 6e20 436f 6d70 6f6e 656e 7420 7b73 656c  n Component {sel
+000024d0: 662e 6e61 6d65 2172 7d2c 220a 2020 2020  f.name!r},".    
+000024e0: 2020 2020 2020 2020 2020 2020 2262 7574              "but
+000024f0: 2066 6169 6c65 6420 6265 6361 7573 6520   failed because 
+00002500: 7468 6520 6974 656d 2077 6173 206e 6f74  the item was not
+00002510: 2061 2043 6f6d 706f 6e65 6e74 5265 6665   a ComponentRefe
+00002520: 7265 6e63 6522 0a20 2020 2020 2020 2020  rence".         
+00002530: 2020 2029 0a0a 2020 2020 4063 6c61 7373     )..    @class
+00002540: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
+00002550: 5f67 6574 5f76 616c 6964 6174 6f72 735f  _get_validators_
+00002560: 5f28 636c 7329 3a0a 2020 2020 2020 2020  _(cls):.        
+00002570: 2222 2247 6574 2076 616c 6964 6174 6f72  """Get validator
+00002580: 7320 666f 7220 7468 6520 436f 6d70 6f6e  s for the Compon
+00002590: 656e 7420 6f62 6a65 6374 2e22 2222 0a20  ent object.""". 
+000025a0: 2020 2020 2020 2079 6965 6c64 2063 6c73         yield cls
+000025b0: 2e76 616c 6964 6174 650a 0a20 2020 2040  .validate..    @
+000025c0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+000025d0: 6465 6620 7661 6c69 6461 7465 2863 6c73  def validate(cls
+000025e0: 2c20 7629 3a0a 2020 2020 2020 2020 2222  , v):.        ""
+000025f0: 2250 7964 616e 7469 6320 6173 7375 6d65  "Pydantic assume
+00002600: 7320 636f 6d70 6f6e 656e 7420 6973 2076  s component is v
+00002610: 616c 6964 2069 6620 7468 6520 666f 6c6c  alid if the foll
+00002620: 6f77 696e 6720 6172 6520 7472 7565 2e0a  owing are true..
+00002630: 0a20 2020 2020 2020 202d 206e 616d 6520  .        - name 
+00002640: 6368 6172 6163 7465 7273 203c 204d 4158  characters < MAX
+00002650: 5f4e 414d 455f 4c45 4e47 5448 0a20 2020  _NAME_LENGTH.   
+00002660: 2020 2020 202d 2069 7320 6e6f 7420 656d       - is not em
+00002670: 7074 7920 2868 6173 2072 6566 6572 656e  pty (has referen
+00002680: 6365 7320 6f72 2070 6f6c 7967 6f6e 7329  ces or polygons)
+00002690: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000026a0: 2020 2020 204d 4158 5f4e 414d 455f 4c45       MAX_NAME_LE
+000026b0: 4e47 5448 203d 2039 390a 2020 2020 2020  NGTH = 99.      
+000026c0: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
+000026d0: 6e63 6528 0a20 2020 2020 2020 2020 2020  nce(.           
+000026e0: 2076 2c20 436f 6d70 6f6e 656e 740a 2020   v, Component.  
+000026f0: 2020 2020 2020 292c 2066 2254 7970 6545        ), f"TypeE
+00002700: 7272 6f72 2c20 476f 7420 7b74 7970 6528  rror, Got {type(
+00002710: 7629 7d2c 2065 7870 6563 7469 6e67 2043  v)}, expecting C
+00002720: 6f6d 706f 6e65 6e74 220a 2020 2020 2020  omponent".      
+00002730: 2020 6173 7365 7274 2028 0a20 2020 2020    assert (.     
+00002740: 2020 2020 2020 206c 656e 2876 2e6e 616d         len(v.nam
+00002750: 6529 203c 3d20 4d41 585f 4e41 4d45 5f4c  e) <= MAX_NAME_L
+00002760: 454e 4754 480a 2020 2020 2020 2020 292c  ENGTH.        ),
+00002770: 2066 226e 616d 6520 607b 762e 6e61 6d65   f"name `{v.name
+00002780: 7d60 207b 6c65 6e28 762e 6e61 6d65 297d  }` {len(v.name)}
+00002790: 203e 207b 4d41 585f 4e41 4d45 5f4c 454e   > {MAX_NAME_LEN
+000027a0: 4754 487d 2022 0a20 2020 2020 2020 2072  GTH} ".        r
+000027b0: 6574 7572 6e20 760a 0a20 2020 2040 7072  eturn v..    @pr
+000027c0: 6f70 6572 7479 0a20 2020 2064 6566 206e  operty.    def n
+000027d0: 616d 6564 5f72 6566 6572 656e 6365 7328  amed_references(
+000027e0: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+000027f0: 6574 7572 6e20 7365 6c66 2e5f 6e61 6d65  eturn self._name
+00002800: 645f 7265 6665 7265 6e63 6573 0a0a 2020  d_references..  
+00002810: 2020 6465 6620 6164 645f 6c61 6265 6c28    def add_label(
+00002820: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00002830: 2020 2020 2020 2074 6578 743a 2073 7472         text: str
+00002840: 203d 2022 6865 6c6c 6f22 2c0a 2020 2020   = "hello",.    
+00002850: 2020 2020 706f 7369 7469 6f6e 3a20 5475      position: Tu
+00002860: 706c 655b 666c 6f61 742c 2066 6c6f 6174  ple[float, float
+00002870: 5d20 3d20 2830 2e30 2c20 302e 3029 2c0a  ] = (0.0, 0.0),.
+00002880: 2020 2020 2020 2020 6d61 676e 6966 6963          magnific
+00002890: 6174 696f 6e3a 2066 6c6f 6174 203d 2031  ation: float = 1
+000028a0: 2e30 2c0a 2020 2020 2020 2020 726f 7461  .0,.        rota
+000028b0: 7469 6f6e 3a20 666c 6f61 7420 3d20 302c  tion: float = 0,
+000028c0: 0a20 2020 2020 2020 2061 6e63 686f 723a  .        anchor:
+000028d0: 2073 7472 203d 2022 6f22 2c0a 2020 2020   str = "o",.    
+000028e0: 2020 2020 6c61 7965 723d 2254 4558 5422      layer="TEXT"
+000028f0: 2c0a 2020 2020 2020 2020 785f 7265 666c  ,.        x_refl
+00002900: 6563 7469 6f6e 3d46 616c 7365 2c0a 2020  ection=False,.  
+00002910: 2020 2920 2d3e 204c 6162 656c 3a0a 2020    ) -> Label:.  
+00002920: 2020 2020 2020 2222 2241 6464 7320 4c61        """Adds La
+00002930: 6265 6c20 746f 2074 6865 2043 6f6d 706f  bel to the Compo
+00002940: 6e65 6e74 2e0a 0a20 2020 2020 2020 2041  nent...        A
+00002950: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00002960: 2074 6578 743a 204c 6162 656c 2074 6578   text: Label tex
+00002970: 742e 0a20 2020 2020 2020 2020 2020 2070  t..            p
+00002980: 6f73 6974 696f 6e3a 2078 2d2c 2079 2d63  osition: x-, y-c
+00002990: 6f6f 7264 696e 6174 6573 206f 6620 7468  oordinates of th
+000029a0: 6520 4c61 6265 6c20 6c6f 6361 7469 6f6e  e Label location
+000029b0: 2e0a 2020 2020 2020 2020 2020 2020 6d61  ..            ma
+000029c0: 676e 6966 6963 6174 696f 6e3a 204d 6167  gnification: Mag
+000029d0: 6e69 6669 6361 7469 6f6e 2066 6163 746f  nification facto
+000029e0: 7220 666f 7220 7468 6520 4c61 6265 6c20  r for the Label 
+000029f0: 7465 7874 2e0a 2020 2020 2020 2020 2020  text..          
+00002a00: 2020 726f 7461 7469 6f6e 3a20 416e 676c    rotation: Angl
+00002a10: 6520 726f 7461 7469 6f6e 206f 6620 7468  e rotation of th
+00002a20: 6520 4c61 6265 6c20 7465 7874 2e0a 2020  e Label text..  
+00002a30: 2020 2020 2020 2020 2020 616e 6368 6f72            anchor
+00002a40: 3a20 7b27 6e27 2c20 2765 272c 2027 7327  : {'n', 'e', 's'
+00002a50: 2c20 2777 272c 2027 6f27 2c20 276e 6527  , 'w', 'o', 'ne'
+00002a60: 2c20 276e 7727 2c20 2e2e 2e7d 0a20 2020  , 'nw', ...}.   
+00002a70: 2020 2020 2020 2020 2020 2020 2050 6f73               Pos
+00002a80: 6974 696f 6e20 6f66 2074 6865 2061 6e63  ition of the anc
+00002a90: 686f 7220 7265 6c61 7469 7665 2074 6f20  hor relative to 
+00002aa0: 7468 6520 7465 7874 2e0a 2020 2020 2020  the text..      
+00002ab0: 2020 2020 2020 6c61 7965 723a 2053 7065        layer: Spe
+00002ac0: 6369 6669 6320 6c61 7965 7228 7329 2074  cific layer(s) t
+00002ad0: 6f20 7075 7420 4c61 6265 6c20 6f6e 2e0a  o put Label on..
+00002ae0: 2020 2020 2020 2020 2020 2020 785f 7265              x_re
+00002af0: 666c 6563 7469 6f6e 3a20 5472 7565 2072  flection: True r
+00002b00: 6566 6c65 6374 7320 6163 726f 7373 2074  eflects across t
+00002b10: 6865 2068 6f72 697a 6f6e 7461 6c20 6178  he horizontal ax
+00002b20: 6973 2062 6566 6f72 6520 726f 7461 7469  is before rotati
+00002b30: 6f6e 2e0a 2020 2020 2020 2020 2222 220a  on..        """.
+00002b40: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
+00002b50: 6661 6374 6f72 792e 7064 6b20 696d 706f  factory.pdk impo
+00002b60: 7274 2067 6574 5f6c 6179 6572 0a0a 2020  rt get_layer..  
+00002b70: 2020 2020 2020 6c61 7965 7220 3d20 6765        layer = ge
+00002b80: 745f 6c61 7965 7228 6c61 7965 7229 0a0a  t_layer(layer)..
+00002b90: 2020 2020 2020 2020 6764 735f 6c61 7965          gds_laye
+00002ba0: 722c 2067 6473 5f64 6174 6174 7970 6520  r, gds_datatype 
+00002bb0: 3d20 6c61 7965 720a 0a20 2020 2020 2020  = layer..       
+00002bc0: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+00002bd0: 6365 2874 6578 742c 2073 7472 293a 0a20  ce(text, str):. 
+00002be0: 2020 2020 2020 2020 2020 2074 6578 7420             text 
+00002bf0: 3d20 7465 7874 0a20 2020 2020 2020 206c  = text.        l
+00002c00: 6162 656c 203d 204c 6162 656c 280a 2020  abel = Label(.  
+00002c10: 2020 2020 2020 2020 2020 7465 7874 3d74            text=t
+00002c20: 6578 742c 0a20 2020 2020 2020 2020 2020  ext,.           
+00002c30: 206f 7269 6769 6e3d 706f 7369 7469 6f6e   origin=position
+00002c40: 2c0a 2020 2020 2020 2020 2020 2020 616e  ,.            an
+00002c50: 6368 6f72 3d61 6e63 686f 722c 0a20 2020  chor=anchor,.   
+00002c60: 2020 2020 2020 2020 206d 6167 6e69 6669           magnifi
+00002c70: 6361 7469 6f6e 3d6d 6167 6e69 6669 6361  cation=magnifica
+00002c80: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
+00002c90: 2020 726f 7461 7469 6f6e 3d72 6f74 6174    rotation=rotat
+00002ca0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+00002cb0: 206c 6179 6572 3d67 6473 5f6c 6179 6572   layer=gds_layer
+00002cc0: 2c0a 2020 2020 2020 2020 2020 2020 7465  ,.            te
+00002cd0: 7874 7479 7065 3d67 6473 5f64 6174 6174  xttype=gds_datat
+00002ce0: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
+00002cf0: 2078 5f72 6566 6c65 6374 696f 6e3d 785f   x_reflection=x_
+00002d00: 7265 666c 6563 7469 6f6e 2c0a 2020 2020  reflection,.    
+00002d10: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
+00002d20: 6c66 2e61 6464 286c 6162 656c 290a 2020  lf.add(label).  
+00002d30: 2020 2020 2020 7265 7475 726e 206c 6162        return lab
+00002d40: 656c 0a0a 2020 2020 4070 726f 7065 7274  el..    @propert
+00002d50: 790a 2020 2020 6465 6620 6262 6f78 2873  y.    def bbox(s
+00002d60: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00002d70: 2252 6574 7572 6e73 2074 6865 2062 6f75  "Returns the bou
+00002d80: 6e64 696e 6720 626f 7820 6f66 2074 6865  nding box of the
+00002d90: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
+00002da0: 6e63 652e 0a0a 2020 2020 2020 2020 6974  nce...        it
+00002db0: 2073 6e61 7073 2074 6f20 3320 6465 6369   snaps to 3 deci
+00002dc0: 6d61 6c73 2069 6e20 756d 2028 302e 3030  mals in um (0.00
+00002dd0: 3175 6d20 3d20 316e 6d20 7072 6563 6973  1um = 1nm precis
+00002de0: 696f 6e29 0a20 2020 2020 2020 2022 2222  ion).        """
+00002df0: 0a20 2020 2020 2020 2062 626f 7820 3d20  .        bbox = 
+00002e00: 7365 6c66 2e5f 6365 6c6c 2e62 6f75 6e64  self._cell.bound
+00002e10: 696e 675f 626f 7828 290a 2020 2020 2020  ing_box().      
+00002e20: 2020 6966 2062 626f 7820 6973 204e 6f6e    if bbox is Non
+00002e30: 653a 0a20 2020 2020 2020 2020 2020 2062  e:.            b
+00002e40: 626f 7820 3d20 2828 302c 2030 292c 2028  box = ((0, 0), (
+00002e50: 302c 2030 2929 0a20 2020 2020 2020 2072  0, 0)).        r
+00002e60: 6574 7572 6e20 6e70 2e72 6f75 6e64 2862  eturn np.round(b
+00002e70: 626f 782c 2033 290a 0a20 2020 2040 7072  box, 3)..    @pr
+00002e80: 6f70 6572 7479 0a20 2020 2064 6566 2070  operty.    def p
+00002e90: 6f72 7473 5f6c 6179 6572 2873 656c 6629  orts_layer(self)
+00002ea0: 202d 3e20 4469 6374 5b73 7472 2c20 7374   -> Dict[str, st
+00002eb0: 725d 3a0a 2020 2020 2020 2020 2222 2252  r]:.        """R
+00002ec0: 6574 7572 6e73 2061 206d 6170 7069 6e67  eturns a mapping
+00002ed0: 2066 726f 6d20 6c61 7965 7230 5f6c 6179   from layer0_lay
+00002ee0: 6572 315f 4530 3a20 706f 7274 4e61 6d65  er1_E0: portName
+00002ef0: 2e22 2222 0a20 2020 2020 2020 2072 6574  .""".        ret
+00002f00: 7572 6e20 6d61 705f 706f 7274 735f 6c61  urn map_ports_la
+00002f10: 7965 725f 746f 5f6f 7269 656e 7461 7469  yer_to_orientati
+00002f20: 6f6e 2873 656c 662e 706f 7274 7329 0a0a  on(self.ports)..
+00002f30: 2020 2020 6465 6620 706f 7274 5f62 795f      def port_by_
+00002f40: 6f72 6965 6e74 6174 696f 6e5f 6377 2873  orientation_cw(s
+00002f50: 656c 662c 206b 6579 3a20 7374 722c 202a  elf, key: str, *
+00002f60: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
+00002f70: 2020 2222 2252 6574 7572 6e73 2070 6f72    """Returns por
+00002f80: 7420 6279 2069 6e64 6578 696e 6720 7468  t by indexing th
+00002f90: 656d 2063 6c6f 636b 7769 7365 2e22 2222  em clockwise."""
+00002fa0: 0a20 2020 2020 2020 206d 203d 206d 6170  .        m = map
+00002fb0: 5f70 6f72 7473 5f74 6f5f 6f72 6965 6e74  _ports_to_orient
+00002fc0: 6174 696f 6e5f 6377 2873 656c 662e 706f  ation_cw(self.po
+00002fd0: 7274 732c 202a 2a6b 7761 7267 7329 0a20  rts, **kwargs). 
+00002fe0: 2020 2020 2020 2069 6620 6b65 7920 6e6f         if key no
+00002ff0: 7420 696e 206d 3a0a 2020 2020 2020 2020  t in m:.        
+00003000: 2020 2020 7261 6973 6520 4b65 7945 7272      raise KeyErr
+00003010: 6f72 2866 227b 6b65 797d 206e 6f74 2069  or(f"{key} not i
+00003020: 6e20 7b6c 6973 7428 6d2e 6b65 7973 2829  n {list(m.keys()
+00003030: 297d 2229 0a20 2020 2020 2020 206b 6579  )}").        key
+00003040: 3220 3d20 6d5b 6b65 795d 0a20 2020 2020  2 = m[key].     
+00003050: 2020 2072 6574 7572 6e20 7365 6c66 2e70     return self.p
+00003060: 6f72 7473 5b6b 6579 325d 0a0a 2020 2020  orts[key2]..    
+00003070: 6465 6620 706f 7274 5f62 795f 6f72 6965  def port_by_orie
+00003080: 6e74 6174 696f 6e5f 6363 7728 7365 6c66  ntation_ccw(self
+00003090: 2c20 6b65 793a 2073 7472 2c20 2a2a 6b77  , key: str, **kw
+000030a0: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
+000030b0: 2222 5265 7475 726e 7320 706f 7274 2062  ""Returns port b
+000030c0: 7920 696e 6465 7869 6e67 2074 6865 6d20  y indexing them 
+000030d0: 636c 6f63 6b77 6973 652e 2222 220a 2020  clockwise.""".  
+000030e0: 2020 2020 2020 6d20 3d20 6d61 705f 706f        m = map_po
+000030f0: 7274 735f 746f 5f6f 7269 656e 7461 7469  rts_to_orientati
+00003100: 6f6e 5f63 6377 2873 656c 662e 706f 7274  on_ccw(self.port
+00003110: 732c 202a 2a6b 7761 7267 7329 0a20 2020  s, **kwargs).   
+00003120: 2020 2020 2069 6620 6b65 7920 6e6f 7420       if key not 
+00003130: 696e 206d 3a0a 2020 2020 2020 2020 2020  in m:.          
+00003140: 2020 7261 6973 6520 4b65 7945 7272 6f72    raise KeyError
+00003150: 2866 227b 6b65 797d 206e 6f74 2069 6e20  (f"{key} not in 
+00003160: 7b6c 6973 7428 6d2e 6b65 7973 2829 297d  {list(m.keys())}
+00003170: 2229 0a20 2020 2020 2020 206b 6579 3220  ").        key2 
+00003180: 3d20 6d5b 6b65 795d 0a20 2020 2020 2020  = m[key].       
+00003190: 2072 6574 7572 6e20 7365 6c66 2e70 6f72   return self.por
+000031a0: 7473 5b6b 6579 325d 0a0a 2020 2020 6465  ts[key2]..    de
+000031b0: 6620 6765 745f 706f 7274 735f 7873 697a  f get_ports_xsiz
+000031c0: 6528 7365 6c66 2c20 2a2a 6b77 6172 6773  e(self, **kwargs
+000031d0: 2920 2d3e 2066 6c6f 6174 3a0a 2020 2020  ) -> float:.    
+000031e0: 2020 2020 2222 2252 6574 7572 6e73 2078      """Returns x
+000031f0: 6469 7374 616e 6365 2066 726f 6d20 6561  distance from ea
+00003200: 7374 2074 6f20 7765 7374 2070 6f72 7473  st to west ports
+00003210: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
+00003220: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
+00003230: 2020 2020 206c 6179 6572 3a20 706f 7274       layer: port
+00003240: 2047 4453 206c 6179 6572 2e0a 2020 2020   GDS layer..    
+00003250: 2020 2020 2020 2020 7072 6566 6978 3a20          prefix: 
+00003260: 7769 7468 2069 6e20 706f 7274 206e 616d  with in port nam
+00003270: 652e 0a20 2020 2020 2020 2020 2020 206f  e..            o
+00003280: 7269 656e 7461 7469 6f6e 3a20 696e 2064  rientation: in d
+00003290: 6567 7265 6573 2e0a 2020 2020 2020 2020  egrees..        
+000032a0: 2020 2020 7769 6474 683a 2070 6f72 7420      width: port 
+000032b0: 7769 6474 682e 0a20 2020 2020 2020 2020  width..         
+000032c0: 2020 206c 6179 6572 735f 6578 636c 7564     layers_exclud
+000032d0: 6564 3a20 4c69 7374 206f 6620 6c61 7965  ed: List of laye
+000032e0: 7273 2074 6f20 6578 636c 7564 652e 0a20  rs to exclude.. 
+000032f0: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
+00003300: 7479 7065 3a20 6f70 7469 6361 6c2c 2065  type: optical, e
+00003310: 6c65 6374 7269 6361 6c2c 202e 2e2e 0a20  lectrical, .... 
+00003320: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00003330: 2020 2070 6f72 7473 5f63 7720 3d20 7365     ports_cw = se
+00003340: 6c66 2e67 6574 5f70 6f72 7473 5f6c 6973  lf.get_ports_lis
+00003350: 7428 636c 6f63 6b77 6973 653d 5472 7565  t(clockwise=True
+00003360: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
+00003370: 2020 2020 706f 7274 735f 6363 7720 3d20      ports_ccw = 
+00003380: 7365 6c66 2e67 6574 5f70 6f72 7473 5f6c  self.get_ports_l
+00003390: 6973 7428 636c 6f63 6b77 6973 653d 4661  ist(clockwise=Fa
+000033a0: 6c73 652c 202a 2a6b 7761 7267 7329 0a20  lse, **kwargs). 
+000033b0: 2020 2020 2020 2072 6574 7572 6e20 736e         return sn
+000033c0: 6170 5f74 6f5f 6772 6964 2870 6f72 7473  ap_to_grid(ports
+000033d0: 5f63 6377 5b30 5d2e 7820 2d20 706f 7274  _ccw[0].x - port
+000033e0: 735f 6377 5b30 5d2e 7829 0a0a 2020 2020  s_cw[0].x)..    
+000033f0: 6465 6620 6765 745f 706f 7274 735f 7973  def get_ports_ys
+00003400: 697a 6528 7365 6c66 2c20 2a2a 6b77 6172  ize(self, **kwar
+00003410: 6773 2920 2d3e 2066 6c6f 6174 3a0a 2020  gs) -> float:.  
+00003420: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+00003430: 2079 6469 7374 616e 6365 2066 726f 6d20   ydistance from 
+00003440: 6561 7374 2074 6f20 7765 7374 2070 6f72  east to west por
+00003450: 7473 2e0a 0a20 2020 2020 2020 204b 6579  ts...        Key
+00003460: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
+00003470: 2020 2020 2020 206c 6179 6572 3a20 706f         layer: po
+00003480: 7274 2047 4453 206c 6179 6572 2e0a 2020  rt GDS layer..  
+00003490: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+000034a0: 3a20 7769 7468 2069 6e20 706f 7274 206e  : with in port n
+000034b0: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
+000034c0: 206f 7269 656e 7461 7469 6f6e 3a20 696e   orientation: in
+000034d0: 2064 6567 7265 6573 2e0a 2020 2020 2020   degrees..      
+000034e0: 2020 2020 2020 7769 6474 683a 2070 6f72        width: por
+000034f0: 7420 7769 6474 6820 2875 6d29 2e0a 2020  t width (um)..  
+00003500: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
+00003510: 5f65 7863 6c75 6465 643a 204c 6973 7420  _excluded: List 
+00003520: 6f66 206c 6179 6572 7320 746f 2065 7863  of layers to exc
+00003530: 6c75 6465 2e0a 2020 2020 2020 2020 2020  lude..          
+00003540: 2020 706f 7274 5f74 7970 653a 206f 7074    port_type: opt
+00003550: 6963 616c 2c20 656c 6563 7472 6963 616c  ical, electrical
+00003560: 2c20 2e2e 2e0a 2020 2020 2020 2020 2222  , ....        ""
+00003570: 220a 2020 2020 2020 2020 706f 7274 735f  ".        ports_
+00003580: 6377 203d 2073 656c 662e 6765 745f 706f  cw = self.get_po
+00003590: 7274 735f 6c69 7374 2863 6c6f 636b 7769  rts_list(clockwi
+000035a0: 7365 3d54 7275 652c 202a 2a6b 7761 7267  se=True, **kwarg
+000035b0: 7329 0a20 2020 2020 2020 2070 6f72 7473  s).        ports
+000035c0: 5f63 6377 203d 2073 656c 662e 6765 745f  _ccw = self.get_
+000035d0: 706f 7274 735f 6c69 7374 2863 6c6f 636b  ports_list(clock
+000035e0: 7769 7365 3d46 616c 7365 2c20 2a2a 6b77  wise=False, **kw
+000035f0: 6172 6773 290a 2020 2020 2020 2020 7265  args).        re
+00003600: 7475 726e 2073 6e61 705f 746f 5f67 7269  turn snap_to_gri
+00003610: 6428 706f 7274 735f 6363 775b 305d 2e79  d(ports_ccw[0].y
+00003620: 202d 2070 6f72 7473 5f63 775b 305d 2e79   - ports_cw[0].y
+00003630: 290a 0a20 2020 2064 6566 2070 6c6f 745f  )..    def plot_
+00003640: 6e65 746c 6973 7428 0a20 2020 2020 2020  netlist(.       
+00003650: 2073 656c 662c 2077 6974 685f 6c61 6265   self, with_labe
+00003660: 6c73 3a20 626f 6f6c 203d 2054 7275 652c  ls: bool = True,
+00003670: 2066 6f6e 745f 7765 6967 6874 3a20 7374   font_weight: st
+00003680: 7220 3d20 226e 6f72 6d61 6c22 2c20 2a2a  r = "normal", **
+00003690: 6b77 6172 6773 0a20 2020 2029 3a0a 2020  kwargs.    ):.  
+000036a0: 2020 2020 2020 2222 2250 6c6f 7473 2061        """Plots a
+000036b0: 206e 6574 6c69 7374 2067 7261 7068 2077   netlist graph w
+000036c0: 6974 6820 6e65 7477 6f72 6b78 2e0a 0a20  ith networkx... 
+000036d0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+000036e0: 2020 2020 2020 2020 2077 6974 685f 6c61           with_la
+000036f0: 6265 6c73 3a20 6164 6420 6c61 6265 6c20  bels: add label 
+00003700: 746f 2065 6163 6820 6e6f 6465 2e0a 2020  to each node..  
+00003710: 2020 2020 2020 2020 2020 666f 6e74 5f77            font_w
+00003720: 6569 6768 743a 206e 6f72 6d61 6c2c 2062  eight: normal, b
+00003730: 6f6c 642e 0a20 2020 2020 2020 2020 2020  old..           
+00003740: 202a 2a6b 7761 7267 733a 206b 6579 776f   **kwargs: keywo
+00003750: 7264 2061 7267 756d 656e 7473 2066 6f72  rd arguments for
+00003760: 2074 6865 2067 6574 5f6e 6574 6c69 7374   the get_netlist
+00003770: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
+00003780: 2020 2222 220a 2020 2020 2020 2020 696d    """.        im
+00003790: 706f 7274 206d 6174 706c 6f74 6c69 622e  port matplotlib.
+000037a0: 7079 706c 6f74 2061 7320 706c 740a 2020  pyplot as plt.  
+000037b0: 2020 2020 2020 696d 706f 7274 206e 6574        import net
+000037c0: 776f 726b 7820 6173 206e 780a 0a20 2020  workx as nx..   
+000037d0: 2020 2020 2070 6c74 2e66 6967 7572 6528       plt.figure(
+000037e0: 290a 2020 2020 2020 2020 6e65 746c 6973  ).        netlis
+000037f0: 7420 3d20 7365 6c66 2e67 6574 5f6e 6574  t = self.get_net
+00003800: 6c69 7374 282a 2a6b 7761 7267 7329 0a20  list(**kwargs). 
+00003810: 2020 2020 2020 2063 6f6e 6e65 6374 696f         connectio
+00003820: 6e73 203d 206e 6574 6c69 7374 5b22 636f  ns = netlist["co
+00003830: 6e6e 6563 7469 6f6e 7322 5d0a 2020 2020  nnections"].    
+00003840: 2020 2020 706c 6163 656d 656e 7473 203d      placements =
+00003850: 206e 6574 6c69 7374 5b22 706c 6163 656d   netlist["placem
+00003860: 656e 7473 225d 0a20 2020 2020 2020 2047  ents"].        G
+00003870: 203d 206e 782e 4772 6170 6828 290a 2020   = nx.Graph().  
+00003880: 2020 2020 2020 472e 6164 645f 6564 6765        G.add_edge
+00003890: 735f 6672 6f6d 280a 2020 2020 2020 2020  s_from(.        
+000038a0: 2020 2020 5b0a 2020 2020 2020 2020 2020      [.          
+000038b0: 2020 2020 2020 2822 2c22 2e6a 6f69 6e28        (",".join(
+000038c0: 6b2e 7370 6c69 7428 222c 2229 5b3a 2d31  k.split(",")[:-1
+000038d0: 5d29 2c20 222c 222e 6a6f 696e 2876 2e73  ]), ",".join(v.s
+000038e0: 706c 6974 2822 2c22 295b 3a2d 315d 2929  plit(",")[:-1]))
+000038f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003900: 2066 6f72 206b 2c20 7620 696e 2063 6f6e   for k, v in con
+00003910: 6e65 6374 696f 6e73 2e69 7465 6d73 2829  nections.items()
+00003920: 0a20 2020 2020 2020 2020 2020 205d 0a20  .            ]. 
+00003930: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00003940: 2070 6f73 203d 207b 6b3a 2028 765b 2278   pos = {k: (v["x
+00003950: 225d 2c20 765b 2279 225d 2920 666f 7220  "], v["y"]) for 
+00003960: 6b2c 2076 2069 6e20 706c 6163 656d 656e  k, v in placemen
+00003970: 7473 2e69 7465 6d73 2829 7d0a 2020 2020  ts.items()}.    
+00003980: 2020 2020 6c61 6265 6c73 203d 207b 6b3a      labels = {k:
+00003990: 2022 2c22 2e6a 6f69 6e28 6b2e 7370 6c69   ",".join(k.spli
+000039a0: 7428 222c 2229 5b3a 315d 2920 666f 7220  t(",")[:1]) for 
+000039b0: 6b20 696e 2070 6c61 6365 6d65 6e74 732e  k in placements.
+000039c0: 6b65 7973 2829 7d0a 2020 2020 2020 2020  keys()}.        
+000039d0: 6e78 2e64 7261 7728 0a20 2020 2020 2020  nx.draw(.       
+000039e0: 2020 2020 2047 2c0a 2020 2020 2020 2020       G,.        
+000039f0: 2020 2020 7769 7468 5f6c 6162 656c 733d      with_labels=
+00003a00: 7769 7468 5f6c 6162 656c 732c 0a20 2020  with_labels,.   
+00003a10: 2020 2020 2020 2020 2066 6f6e 745f 7765           font_we
+00003a20: 6967 6874 3d66 6f6e 745f 7765 6967 6874  ight=font_weight
+00003a30: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
+00003a40: 6265 6c73 3d6c 6162 656c 732c 0a20 2020  bels=labels,.   
+00003a50: 2020 2020 2020 2020 2070 6f73 3d70 6f73           pos=pos
+00003a60: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00003a70: 2020 2020 7265 7475 726e 2047 0a0a 2020      return G..  
+00003a80: 2020 6465 6620 706c 6f74 5f6e 6574 6c69    def plot_netli
+00003a90: 7374 5f66 6c61 7428 0a20 2020 2020 2020  st_flat(.       
+00003aa0: 2073 656c 662c 2077 6974 685f 6c61 6265   self, with_labe
+00003ab0: 6c73 3a20 626f 6f6c 203d 2054 7275 652c  ls: bool = True,
+00003ac0: 2066 6f6e 745f 7765 6967 6874 3a20 7374   font_weight: st
+00003ad0: 7220 3d20 226e 6f72 6d61 6c22 2c20 2a2a  r = "normal", **
+00003ae0: 6b77 6172 6773 0a20 2020 2029 3a0a 2020  kwargs.    ):.  
+00003af0: 2020 2020 2020 2222 2250 6c6f 7473 2061        """Plots a
+00003b00: 206e 6574 6c69 7374 2067 7261 7068 2077   netlist graph w
+00003b10: 6974 6820 6e65 7477 6f72 6b78 2e0a 0a20  ith networkx... 
+00003b20: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+00003b30: 2020 2020 2020 2020 2066 6c61 743a 2069           flat: i
+00003b40: 6620 7472 7565 2c20 7769 6c6c 2070 6c6f  f true, will plo
+00003b50: 7420 7468 6520 666c 6174 206e 6574 6c69  t the flat netli
+00003b60: 7374 0a20 2020 2020 2020 2020 2020 2077  st.            w
+00003b70: 6974 685f 6c61 6265 6c73 3a20 6164 6420  ith_labels: add 
+00003b80: 6c61 6265 6c20 746f 2065 6163 6820 6e6f  label to each no
+00003b90: 6465 2e0a 2020 2020 2020 2020 2020 2020  de..            
+00003ba0: 666f 6e74 5f77 6569 6768 743a 206e 6f72  font_weight: nor
+00003bb0: 6d61 6c2c 2062 6f6c 642e 0a20 2020 2020  mal, bold..     
+00003bc0: 2020 2020 2020 202a 2a6b 7761 7267 733a         **kwargs:
+00003bd0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+00003be0: 7473 2066 6f72 2074 6865 2067 6574 5f6e  ts for the get_n
+00003bf0: 6574 6c69 7374 2066 756e 6374 696f 6e0a  etlist function.
+00003c00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00003c10: 2020 2020 696d 706f 7274 206d 6174 706c      import matpl
+00003c20: 6f74 6c69 622e 7079 706c 6f74 2061 7320  otlib.pyplot as 
+00003c30: 706c 740a 2020 2020 2020 2020 696d 706f  plt.        impo
+00003c40: 7274 206e 6574 776f 726b 7820 6173 206e  rt networkx as n
+00003c50: 780a 0a20 2020 2020 2020 2070 6c74 2e66  x..        plt.f
+00003c60: 6967 7572 6528 290a 2020 2020 2020 2020  igure().        
+00003c70: 6e65 746c 6973 7420 3d20 7365 6c66 2e67  netlist = self.g
+00003c80: 6574 5f6e 6574 6c69 7374 5f66 6c61 7428  et_netlist_flat(
+00003c90: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+00003ca0: 2020 636f 6e6e 6563 7469 6f6e 7320 3d20    connections = 
+00003cb0: 6e65 746c 6973 745b 2263 6f6e 6e65 6374  netlist["connect
+00003cc0: 696f 6e73 225d 0a20 2020 2020 2020 2070  ions"].        p
+00003cd0: 6c61 6365 6d65 6e74 7320 3d20 6e65 746c  lacements = netl
+00003ce0: 6973 745b 2270 6c61 6365 6d65 6e74 7322  ist["placements"
+00003cf0: 5d0a 2020 2020 2020 2020 636f 6e6e 6563  ].        connec
+00003d00: 7469 6f6e 735f 6c69 7374 203d 205b 5d0a  tions_list = [].
+00003d10: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
+00003d20: 5f6c 6973 7420 696e 2063 6f6e 6e65 6374  _list in connect
+00003d30: 696f 6e73 2e69 7465 6d73 2829 3a0a 2020  ions.items():.  
+00003d40: 2020 2020 2020 2020 2020 636f 6e6e 6563            connec
+00003d50: 7469 6f6e 735f 6c69 7374 2e65 7874 656e  tions_list.exten
+00003d60: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
+00003d70: 2020 2028 222c 222e 6a6f 696e 286b 2e73     (",".join(k.s
+00003d80: 706c 6974 2822 2c22 295b 3a2d 315d 292c  plit(",")[:-1]),
+00003d90: 2022 2c22 2e6a 6f69 6e28 762e 7370 6c69   ",".join(v.spli
+00003da0: 7428 222c 2229 5b3a 2d31 5d29 290a 2020  t(",")[:-1])).  
+00003db0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00003dc0: 7220 7620 696e 2076 5f6c 6973 740a 2020  r v in v_list.  
+00003dd0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00003de0: 2020 2020 4720 3d20 6e78 2e47 7261 7068      G = nx.Graph
+00003df0: 2829 0a20 2020 2020 2020 2047 2e61 6464  ().        G.add
+00003e00: 5f65 6467 6573 5f66 726f 6d28 636f 6e6e  _edges_from(conn
+00003e10: 6563 7469 6f6e 735f 6c69 7374 290a 2020  ections_list).  
+00003e20: 2020 2020 2020 706f 7320 3d20 7b6b 3a20        pos = {k: 
+00003e30: 2876 5b22 7822 5d2c 2076 5b22 7922 5d29  (v["x"], v["y"])
+00003e40: 2066 6f72 206b 2c20 7620 696e 2070 6c61   for k, v in pla
+00003e50: 6365 6d65 6e74 732e 6974 656d 7328 297d  cements.items()}
+00003e60: 0a20 2020 2020 2020 206c 6162 656c 7320  .        labels 
+00003e70: 3d20 7b6b 3a20 222c 222e 6a6f 696e 286b  = {k: ",".join(k
+00003e80: 2e73 706c 6974 2822 2c22 295b 3a31 5d29  .split(",")[:1])
+00003e90: 2066 6f72 206b 2069 6e20 706c 6163 656d   for k in placem
+00003ea0: 656e 7473 2e6b 6579 7328 297d 0a20 2020  ents.keys()}.   
+00003eb0: 2020 2020 206e 782e 6472 6177 280a 2020       nx.draw(.  
+00003ec0: 2020 2020 2020 2020 2020 472c 0a20 2020            G,.   
+00003ed0: 2020 2020 2020 2020 2077 6974 685f 6c61           with_la
+00003ee0: 6265 6c73 3d77 6974 685f 6c61 6265 6c73  bels=with_labels
+00003ef0: 2c0a 2020 2020 2020 2020 2020 2020 666f  ,.            fo
+00003f00: 6e74 5f77 6569 6768 743d 666f 6e74 5f77  nt_weight=font_w
+00003f10: 6569 6768 742c 0a20 2020 2020 2020 2020  eight,.         
+00003f20: 2020 206c 6162 656c 733d 6c61 6265 6c73     labels=labels
+00003f30: 2c0a 2020 2020 2020 2020 2020 2020 706f  ,.            po
+00003f40: 733d 706f 732c 0a20 2020 2020 2020 2029  s=pos,.        )
+00003f50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00003f60: 470a 0a20 2020 2064 6566 2067 6574 5f6e  G..    def get_n
+00003f70: 6574 6c69 7374 5f79 616d 6c28 7365 6c66  etlist_yaml(self
+00003f80: 2c20 2a2a 6b77 6172 6773 2920 2d3e 2044  , **kwargs) -> D
+00003f90: 6963 745b 7374 722c 2041 6e79 5d3a 0a20  ict[str, Any]:. 
+00003fa0: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
+00003fb0: 6163 746f 7279 2e67 6574 5f6e 6574 6c69  actory.get_netli
+00003fc0: 7374 2069 6d70 6f72 7420 6765 745f 6e65  st import get_ne
+00003fd0: 746c 6973 745f 7961 6d6c 0a0a 2020 2020  tlist_yaml..    
+00003fe0: 2020 2020 7265 7475 726e 2067 6574 5f6e      return get_n
+00003ff0: 6574 6c69 7374 5f79 616d 6c28 7365 6c66  etlist_yaml(self
+00004000: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
+00004010: 2064 6566 2077 7269 7465 5f6e 6574 6c69   def write_netli
+00004020: 7374 2873 656c 662c 2066 696c 6570 6174  st(self, filepat
+00004030: 683a 2073 7472 2920 2d3e 204e 6f6e 653a  h: str) -> None:
+00004040: 0a20 2020 2020 2020 2022 2222 5772 6974  .        """Writ
+00004050: 6520 6e65 746c 6973 7420 696e 2059 414d  e netlist in YAM
+00004060: 4c2e 2222 220a 2020 2020 2020 2020 6e65  L.""".        ne
+00004070: 746c 6973 7420 3d20 7365 6c66 2e67 6574  tlist = self.get
+00004080: 5f6e 6574 6c69 7374 2829 0a20 2020 2020  _netlist().     
+00004090: 2020 204f 6d65 6761 436f 6e66 2e73 6176     OmegaConf.sav
+000040a0: 6528 6e65 746c 6973 742c 2066 696c 6570  e(netlist, filep
+000040b0: 6174 6829 0a0a 2020 2020 6465 6620 7772  ath)..    def wr
+000040c0: 6974 655f 6e65 746c 6973 745f 646f 7428  ite_netlist_dot(
+000040d0: 7365 6c66 2c20 6669 6c65 7061 7468 3a20  self, filepath: 
+000040e0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+000040f0: 4e6f 6e65 2920 2d3e 204e 6f6e 653a 0a20  None) -> None:. 
+00004100: 2020 2020 2020 2022 2222 5772 6974 6520         """Write 
+00004110: 6e65 746c 6973 7420 6772 6170 6820 696e  netlist graph in
+00004120: 2044 4f54 2066 6f72 6d61 742e 2222 220a   DOT format.""".
+00004130: 2020 2020 2020 2020 6672 6f6d 206e 6574          from net
+00004140: 776f 726b 782e 6472 6177 696e 672e 6e78  workx.drawing.nx
+00004150: 5f61 6772 6170 6820 696d 706f 7274 2077  _agraph import w
+00004160: 7269 7465 5f64 6f74 0a0a 2020 2020 2020  rite_dot..      
+00004170: 2020 6669 6c65 7061 7468 203d 2066 696c    filepath = fil
+00004180: 6570 6174 6820 6f72 2066 227b 7365 6c66  epath or f"{self
+00004190: 2e6e 616d 657d 2e64 6f74 220a 0a20 2020  .name}.dot"..   
+000041a0: 2020 2020 2047 203d 2073 656c 662e 706c       G = self.pl
+000041b0: 6f74 5f6e 6574 6c69 7374 2829 0a20 2020  ot_netlist().   
+000041c0: 2020 2020 2077 7269 7465 5f64 6f74 2847       write_dot(G
+000041d0: 2c20 6669 6c65 7061 7468 290a 0a20 2020  , filepath)..   
+000041e0: 2064 6566 2067 6574 5f6e 6574 6c69 7374   def get_netlist
+000041f0: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
+00004200: 202d 3e20 4469 6374 5b73 7472 2c20 416e   -> Dict[str, An
+00004210: 795d 3a0a 2020 2020 2020 2020 2222 2246  y]:.        """F
+00004220: 726f 6d20 436f 6d70 6f6e 656e 7420 7265  rom Component re
+00004230: 7475 726e 7320 696e 7374 616e 6365 732c  turns instances,
+00004240: 2063 6f6e 6e65 6374 696f 6e73 2061 6e64   connections and
+00004250: 2070 6c61 6365 6d65 6e74 7320 6469 6374   placements dict
+00004260: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
+00004270: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
+00004280: 2020 2020 2063 6f6d 706f 6e65 6e74 3a20       component: 
+00004290: 746f 2065 7874 7261 6374 206e 6574 6c69  to extract netli
+000042a0: 7374 2e0a 2020 2020 2020 2020 2020 2020  st..            
+000042b0: 6675 6c6c 5f73 6574 7469 6e67 733a 2054  full_settings: T
+000042c0: 7275 6520 7265 7475 726e 7320 616c 6c2c  rue returns all,
+000042d0: 2066 616c 7365 2063 6861 6e67 6564 2073   false changed s
+000042e0: 6574 7469 6e67 732e 0a20 2020 2020 2020  ettings..       
+000042f0: 2020 2020 2074 6f6c 6572 616e 6365 3a20       tolerance: 
+00004300: 746f 6c65 7261 6e63 6520 696e 206e 6d20  tolerance in nm 
+00004310: 746f 2063 6f6e 7369 6465 7220 7477 6f20  to consider two 
+00004320: 706f 7274 7320 636f 6e6e 6563 7465 642e  ports connected.
+00004330: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00004340: 6c75 6465 5f70 6f72 745f 7479 7065 733a  lude_port_types:
+00004350: 206f 7074 696f 6e61 6c20 6c69 7374 206f   optional list o
+00004360: 6620 706f 7274 2074 7970 6573 2074 6f20  f port types to 
+00004370: 6578 636c 7564 6520 6672 6f6d 206e 6574  exclude from net
+00004380: 6c69 7374 696e 672e 0a20 2020 2020 2020  listing..       
+00004390: 2020 2020 2067 6574 5f69 6e73 7461 6e63       get_instanc
+000043a0: 655f 6e61 6d65 3a20 6675 6e63 7469 6f6e  e_name: function
+000043b0: 2074 6f20 6765 7420 696e 7374 616e 6365   to get instance
+000043c0: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
+000043d0: 2020 2061 6c6c 6f77 5f6d 756c 7469 706c     allow_multipl
+000043e0: 653a 2046 616c 7365 2074 6f20 7261 6973  e: False to rais
+000043f0: 6520 616e 2065 7272 6f72 2069 6620 6d6f  e an error if mo
+00004400: 7265 2074 6861 6e20 7477 6f20 706f 7274  re than two port
+00004410: 7320 7368 6172 6520 7468 6520 7361 6d65  s share the same
+00004420: 2063 6f6e 6e65 6374 696f 6e2e 0a20 2020   connection..   
+00004430: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00004440: 5472 7565 2c20 7769 6c6c 2072 6574 7572  True, will retur
+00004450: 6e20 6b65 793a 205b 7661 6c75 655d 2070  n key: [value] p
+00004460: 6169 7273 2077 6974 6820 5b76 616c 7565  airs with [value
+00004470: 5d20 6120 6c69 7374 206f 6620 616c 6c20  ] a list of all 
+00004480: 636f 6e6e 6563 7465 6420 696e 7374 616e  connected instan
+00004490: 6365 732e 0a0a 2020 2020 2020 2020 5265  ces...        Re
+000044a0: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
+000044b0: 2020 204e 6574 6c69 7374 2064 6963 7420     Netlist dict 
+000044c0: 2869 6e73 7461 6e63 6573 2c20 636f 6e6e  (instances, conn
+000044d0: 6563 7469 6f6e 732c 2070 6c61 6365 6d65  ections, placeme
+000044e0: 6e74 732c 2070 6f72 7473 290a 2020 2020  nts, ports).    
+000044f0: 2020 2020 2020 2020 2020 2020 696e 7374              inst
+00004500: 616e 6365 733a 2044 6963 7420 6f66 2069  ances: Dict of i
+00004510: 6e73 7461 6e63 6520 6e61 6d65 2061 6e64  nstance name and
+00004520: 2073 6574 7469 6e67 732e 0a20 2020 2020   settings..     
+00004530: 2020 2020 2020 2020 2020 2063 6f6e 6e65             conne
+00004540: 6374 696f 6e73 3a20 4469 6374 206f 6620  ctions: Dict of 
+00004550: 496e 7374 616e 6365 314e 616d 652c 706f  Instance1Name,po
+00004560: 7274 4e61 6d65 3a20 496e 7374 616e 6365  rtName: Instance
+00004570: 324e 616d 652c 706f 7274 4e61 6d65 2e0a  2Name,portName..
+00004580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004590: 706c 6163 656d 656e 7473 3a20 4469 6374  placements: Dict
+000045a0: 206f 6620 696e 7374 616e 6365 206e 616d   of instance nam
+000045b0: 6573 2061 6e64 2070 6c61 6365 6d65 6e74  es and placement
+000045c0: 7320 2878 2c20 792c 2072 6f74 6174 696f  s (x, y, rotatio
+000045d0: 6e29 2e0a 2020 2020 2020 2020 2020 2020  n)..            
+000045e0: 2020 2020 706f 7274 733a 2044 6963 7420      ports: Dict 
+000045f0: 706f 7274 4e61 6d65 3a20 436f 6d70 6f6e  portName: Compon
+00004600: 656e 744e 616d 652c 706f 7274 2e0a 2020  entName,port..  
+00004610: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+00004620: 6d65 3a20 6e61 6d65 206f 6620 636f 6d70  me: name of comp
+00004630: 6f6e 656e 742e 0a20 2020 2020 2020 2022  onent..        "
+00004640: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+00004650: 6764 7366 6163 746f 7279 2e67 6574 5f6e  gdsfactory.get_n
+00004660: 6574 6c69 7374 2069 6d70 6f72 7420 6765  etlist import ge
+00004670: 745f 6e65 746c 6973 740a 0a20 2020 2020  t_netlist..     
+00004680: 2020 2072 6574 7572 6e20 6765 745f 6e65     return get_ne
+00004690: 746c 6973 7428 636f 6d70 6f6e 656e 743d  tlist(component=
+000046a0: 7365 6c66 2c20 2a2a 6b77 6172 6773 290a  self, **kwargs).
+000046b0: 0a20 2020 2064 6566 2067 6574 5f6e 6574  .    def get_net
+000046c0: 6c69 7374 5f72 6563 7572 7369 7665 2873  list_recursive(s
+000046d0: 656c 662c 202a 2a6b 7761 7267 7329 202d  elf, **kwargs) -
+000046e0: 3e20 4469 6374 5b73 7472 2c20 4469 6374  > Dict[str, Dict
+000046f0: 436f 6e66 6967 5d3a 0a20 2020 2020 2020  Config]:.       
+00004700: 2022 2222 5265 7475 726e 7320 7265 6375   """Returns recu
+00004710: 7273 6976 6520 6e65 746c 6973 7420 666f  rsive netlist fo
+00004720: 7220 6120 636f 6d70 6f6e 656e 7420 616e  r a component an
+00004730: 6420 7375 6263 6f6d 706f 6e65 6e74 732e  d subcomponents.
+00004740: 0a0a 2020 2020 2020 2020 4b65 7977 6f72  ..        Keywor
+00004750: 6420 4172 6773 3a0a 2020 2020 2020 2020  d Args:.        
+00004760: 2020 2020 636f 6d70 6f6e 656e 743a 2074      component: t
+00004770: 6f20 6578 7472 6163 7420 6e65 746c 6973  o extract netlis
+00004780: 742e 0a20 2020 2020 2020 2020 2020 2063  t..            c
+00004790: 6f6d 706f 6e65 6e74 5f73 7566 6669 783a  omponent_suffix:
+000047a0: 2073 7566 6669 7820 746f 2061 7070 656e   suffix to appen
+000047b0: 6420 746f 2065 6163 6820 636f 6d70 6f6e  d to each compon
+000047c0: 656e 7420 6e61 6d65 2e0a 2020 2020 2020  ent name..      
+000047d0: 2020 2020 2020 2020 2020 7573 6566 756c            useful
+000047e0: 2069 6620 746f 2073 6176 6520 616e 6420   if to save and 
+000047f0: 7265 6c6f 6164 2061 2062 6163 6b2d 616e  reload a back-an
+00004800: 6e6f 7461 7465 6420 6e65 746c 6973 742e  notated netlist.
+00004810: 0a20 2020 2020 2020 2020 2020 2067 6574  .            get
+00004820: 5f6e 6574 6c69 7374 5f66 756e 633a 2066  _netlist_func: f
+00004830: 756e 6374 696f 6e20 746f 2065 7874 7261  unction to extra
+00004840: 6374 2069 6e64 6976 6964 7561 6c20 6e65  ct individual ne
+00004850: 746c 6973 7473 2e0a 2020 2020 2020 2020  tlists..        
+00004860: 2020 2020 6675 6c6c 5f73 6574 7469 6e67      full_setting
+00004870: 733a 2054 7275 6520 7265 7475 726e 7320  s: True returns 
+00004880: 616c 6c2c 2066 616c 7365 2063 6861 6e67  all, false chang
+00004890: 6564 2073 6574 7469 6e67 732e 0a20 2020  ed settings..   
+000048a0: 2020 2020 2020 2020 2074 6f6c 6572 616e           toleran
+000048b0: 6365 3a20 746f 6c65 7261 6e63 6520 696e  ce: tolerance in
+000048c0: 206e 6d20 746f 2063 6f6e 7369 6465 7220   nm to consider 
+000048d0: 7477 6f20 706f 7274 7320 636f 6e6e 6563  two ports connec
+000048e0: 7465 642e 0a20 2020 2020 2020 2020 2020  ted..           
+000048f0: 2065 7863 6c75 6465 5f70 6f72 745f 7479   exclude_port_ty
+00004900: 7065 733a 206f 7074 696f 6e61 6c20 6c69  pes: optional li
+00004910: 7374 206f 6620 706f 7274 2074 7970 6573  st of port types
+00004920: 2074 6f20 6578 636c 7564 6520 6672 6f6d   to exclude from
+00004930: 206e 6574 6c69 7374 696e 672e 0a20 2020   netlisting..   
+00004940: 2020 2020 2020 2020 2067 6574 5f69 6e73           get_ins
+00004950: 7461 6e63 655f 6e61 6d65 3a20 6675 6e63  tance_name: func
+00004960: 7469 6f6e 2074 6f20 6765 7420 696e 7374  tion to get inst
+00004970: 616e 6365 206e 616d 652e 0a20 2020 2020  ance name..     
+00004980: 2020 2020 2020 2061 6c6c 6f77 5f6d 756c         allow_mul
+00004990: 7469 706c 653a 2046 616c 7365 2074 6f20  tiple: False to 
+000049a0: 7261 6973 6520 616e 2065 7272 6f72 2069  raise an error i
+000049b0: 6620 6d6f 7265 2074 6861 6e20 7477 6f20  f more than two 
+000049c0: 706f 7274 7320 7368 6172 6520 7468 6520  ports share the 
+000049d0: 7361 6d65 2063 6f6e 6e65 6374 696f 6e2e  same connection.
+000049e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000049f0: 2069 6620 5472 7565 2c20 7769 6c6c 2072   if True, will r
+00004a00: 6574 7572 6e20 6b65 793a 205b 7661 6c75  eturn key: [valu
+00004a10: 655d 2070 6169 7273 2077 6974 6820 5b76  e] pairs with [v
+00004a20: 616c 7565 5d20 6120 6c69 7374 206f 6620  alue] a list of 
+00004a30: 616c 6c20 636f 6e6e 6563 7465 6420 696e  all connected in
+00004a40: 7374 616e 6365 732e 0a0a 2020 2020 2020  stances...      
+00004a50: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
+00004a60: 2020 2020 2020 2044 6963 7469 6f6e 6172         Dictionar
+00004a70: 7920 6f66 206e 6574 6c69 7374 732c 206b  y of netlists, k
+00004a80: 6579 6564 2062 7920 7468 6520 6e61 6d65  eyed by the name
+00004a90: 206f 6620 6561 6368 2063 6f6d 706f 6e65   of each compone
+00004aa0: 6e74 2e0a 2020 2020 2020 2020 2222 220a  nt..        """.
+00004ab0: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
+00004ac0: 6661 6374 6f72 792e 6765 745f 6e65 746c  factory.get_netl
+00004ad0: 6973 7420 696d 706f 7274 2067 6574 5f6e  ist import get_n
+00004ae0: 6574 6c69 7374 5f72 6563 7572 7369 7665  etlist_recursive
+00004af0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00004b00: 2067 6574 5f6e 6574 6c69 7374 5f72 6563   get_netlist_rec
+00004b10: 7572 7369 7665 2863 6f6d 706f 6e65 6e74  ursive(component
+00004b20: 3d73 656c 662c 202a 2a6b 7761 7267 7329  =self, **kwargs)
+00004b30: 0a0a 2020 2020 6465 6620 6765 745f 6e65  ..    def get_ne
+00004b40: 746c 6973 745f 666c 6174 2873 656c 662c  tlist_flat(self,
+00004b50: 202a 2a6b 7761 7267 7329 202d 3e20 4469   **kwargs) -> Di
+00004b60: 6374 5b73 7472 2c20 4469 6374 436f 6e66  ct[str, DictConf
+00004b70: 6967 5d3a 0a20 2020 2020 2020 2022 2222  ig]:.        """
+00004b80: 5265 7475 726e 7320 6120 6e65 746c 6973  Returns a netlis
+00004b90: 7420 7768 6572 6520 616c 6c20 7375 6269  t where all subi
+00004ba0: 6e73 7461 6e63 6573 2061 7265 2065 7870  nstances are exp
+00004bb0: 6f73 6564 2061 6e64 2069 6e64 6570 656e  osed and indepen
+00004bc0: 6465 6e74 6c79 206e 616d 6564 2e0a 0a20  dently named... 
+00004bd0: 2020 2020 2020 204b 6579 776f 7264 2041         Keyword A
+00004be0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00004bf0: 2063 6f6d 706f 6e65 6e74 3a20 746f 2065   component: to e
+00004c00: 7874 7261 6374 206e 6574 6c69 7374 2e0a  xtract netlist..
+00004c10: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00004c20: 6f6e 656e 745f 7375 6666 6978 3a20 7375  onent_suffix: su
+00004c30: 6666 6978 2074 6f20 6170 7065 6e64 2074  ffix to append t
+00004c40: 6f20 6561 6368 2063 6f6d 706f 6e65 6e74  o each component
+00004c50: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
+00004c60: 2020 2020 2020 2075 7365 6675 6c20 6966         useful if
+00004c70: 2074 6f20 7361 7665 2061 6e64 2072 656c   to save and rel
+00004c80: 6f61 6420 6120 6261 636b 2d61 6e6e 6f74  oad a back-annot
+00004c90: 6174 6564 206e 6574 6c69 7374 2e0a 2020  ated netlist..  
+00004ca0: 2020 2020 2020 2020 2020 6765 745f 6e65            get_ne
+00004cb0: 746c 6973 745f 6675 6e63 3a20 6675 6e63  tlist_func: func
+00004cc0: 7469 6f6e 2074 6f20 6578 7472 6163 7420  tion to extract 
+00004cd0: 696e 6469 7669 6475 616c 206e 6574 6c69  individual netli
+00004ce0: 7374 732e 0a20 2020 2020 2020 2020 2020  sts..           
+00004cf0: 2066 756c 6c5f 7365 7474 696e 6773 3a20   full_settings: 
+00004d00: 5472 7565 2072 6574 7572 6e73 2061 6c6c  True returns all
+00004d10: 2c20 6661 6c73 6520 6368 616e 6765 6420  , false changed 
+00004d20: 7365 7474 696e 6773 2e0a 2020 2020 2020  settings..      
+00004d30: 2020 2020 2020 746f 6c65 7261 6e63 653a        tolerance:
+00004d40: 2074 6f6c 6572 616e 6365 2069 6e20 6e6d   tolerance in nm
+00004d50: 2074 6f20 636f 6e73 6964 6572 2074 776f   to consider two
+00004d60: 2070 6f72 7473 2063 6f6e 6e65 6374 6564   ports connected
+00004d70: 2e0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
+00004d80: 636c 7564 655f 706f 7274 5f74 7970 6573  clude_port_types
+00004d90: 3a20 6f70 7469 6f6e 616c 206c 6973 7420  : optional list 
+00004da0: 6f66 2070 6f72 7420 7479 7065 7320 746f  of port types to
+00004db0: 2065 7863 6c75 6465 2066 726f 6d20 6e65   exclude from ne
+00004dc0: 746c 6973 7469 6e67 2e0a 2020 2020 2020  tlisting..      
+00004dd0: 2020 2020 2020 6765 745f 696e 7374 616e        get_instan
+00004de0: 6365 5f6e 616d 653a 2066 756e 6374 696f  ce_name: functio
+00004df0: 6e20 746f 2067 6574 2069 6e73 7461 6e63  n to get instanc
+00004e00: 6520 6e61 6d65 2e0a 2020 2020 2020 2020  e name..        
+00004e10: 2020 2020 616c 6c6f 775f 6d75 6c74 6970      allow_multip
+00004e20: 6c65 3a20 4661 6c73 6520 746f 2072 6169  le: False to rai
+00004e30: 7365 2061 6e20 6572 726f 7220 6966 206d  se an error if m
+00004e40: 6f72 6520 7468 616e 2074 776f 2070 6f72  ore than two por
+00004e50: 7473 2073 6861 7265 2074 6865 2073 616d  ts share the sam
+00004e60: 6520 636f 6e6e 6563 7469 6f6e 2e0a 2020  e connection..  
+00004e70: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00004e80: 2054 7275 652c 2077 696c 6c20 7265 7475   True, will retu
+00004e90: 726e 206b 6579 3a20 5b76 616c 7565 5d20  rn key: [value] 
+00004ea0: 7061 6972 7320 7769 7468 205b 7661 6c75  pairs with [valu
+00004eb0: 655d 2061 206c 6973 7420 6f66 2061 6c6c  e] a list of all
+00004ec0: 2063 6f6e 6e65 6374 6564 2069 6e73 7461   connected insta
+00004ed0: 6e63 6573 2e0a 0a20 2020 2020 2020 2052  nces...        R
+00004ee0: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
+00004ef0: 2020 2020 4469 6374 696f 6e61 7279 206f      Dictionary o
+00004f00: 6620 6e65 746c 6973 7473 2c20 6b65 7965  f netlists, keye
+00004f10: 6420 6279 2074 6865 206e 616d 6520 6f66  d by the name of
+00004f20: 2065 6163 6820 636f 6d70 6f6e 656e 742e   each component.
+00004f30: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00004f40: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
+00004f50: 746f 7279 2e67 6574 5f6e 6574 6c69 7374  tory.get_netlist
+00004f60: 5f66 6c61 7420 696d 706f 7274 2067 6574  _flat import get
+00004f70: 5f6e 6574 6c69 7374 5f66 6c61 740a 0a20  _netlist_flat.. 
+00004f80: 2020 2020 2020 2072 6574 7572 6e20 6765         return ge
+00004f90: 745f 6e65 746c 6973 745f 666c 6174 2863  t_netlist_flat(c
+00004fa0: 6f6d 706f 6e65 6e74 3d73 656c 662c 202a  omponent=self, *
+00004fb0: 2a6b 7761 7267 7329 0a0a 2020 2020 6465  *kwargs)..    de
+00004fc0: 6620 6173 7365 7274 5f70 6f72 7473 5f6f  f assert_ports_o
+00004fd0: 6e5f 6772 6964 2873 656c 662c 206e 6d3a  n_grid(self, nm:
+00004fe0: 2069 6e74 203d 2031 2920 2d3e 204e 6f6e   int = 1) -> Non
+00004ff0: 653a 0a20 2020 2020 2020 2022 2222 4173  e:.        """As
+00005000: 7365 7274 7320 7468 6174 2061 6c6c 2070  serts that all p
+00005010: 6f72 7473 2061 7265 206f 6e20 6772 6964  orts are on grid
+00005020: 2e22 2222 0a20 2020 2020 2020 2066 6f72  .""".        for
+00005030: 2070 6f72 7420 696e 2073 656c 662e 706f   port in self.po
+00005040: 7274 732e 7661 6c75 6573 2829 3a0a 2020  rts.values():.  
+00005050: 2020 2020 2020 2020 2020 706f 7274 2e61            port.a
+00005060: 7373 6572 745f 6f6e 5f67 7269 6428 6e6d  ssert_on_grid(nm
+00005070: 3d6e 6d29 0a0a 2020 2020 6465 6620 6765  =nm)..    def ge
+00005080: 745f 706f 7274 7328 7365 6c66 2c20 6465  t_ports(self, de
+00005090: 7074 683d 4e6f 6e65 293a 0a20 2020 2020  pth=None):.     
+000050a0: 2020 2022 2222 5265 7475 726e 7320 636f     """Returns co
+000050b0: 7069 6573 206f 6620 616c 6c20 7468 6520  pies of all the 
+000050c0: 706f 7274 7320 6f66 2074 6865 2043 6f6d  ports of the Com
+000050d0: 706f 6e65 6e74 2c20 726f 7461 7465 6420  ponent, rotated 
+000050e0: 616e 6420 5c0a 2020 2020 2020 2020 2020  and \.          
+000050f0: 2020 2020 2020 7472 616e 736c 6174 6564        translated
+00005100: 2073 6f20 7468 6174 2074 6865 7927 7265   so that they're
+00005110: 2069 6e20 7468 6569 7220 746f 702d 6c65   in their top-le
+00005120: 7665 6c20 706f 7369 7469 6f6e 2e0a 0a20  vel position... 
+00005130: 2020 2020 2020 2054 6865 2050 6f72 7473         The Ports
+00005140: 2072 6574 7572 6e65 6420 6172 6520 636f   returned are co
+00005150: 7069 6573 206f 6620 7468 6520 6f72 6967  pies of the orig
+00005160: 696e 616c 732c 2062 7574 2065 6163 6820  inals, but each 
+00005170: 636f 7079 2068 6173 2074 6865 2073 616d  copy has the sam
+00005180: 650a 2020 2020 2020 2020 6060 7569 6460  e.        ``uid`
+00005190: 6020 6173 2074 6865 206f 7269 6769 6e61  ` as the origina
+000051a0: 6c20 736f 2074 6861 7420 7468 6579 2063  l so that they c
+000051b0: 616e 2062 6520 7472 6163 6564 2062 6163  an be traced bac
+000051c0: 6b20 746f 2074 6865 206f 7269 6769 6e61  k to the origina
+000051d0: 6c20 6966 206e 6565 6465 642e 0a0a 2020  l if needed...  
+000051e0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+000051f0: 2020 2020 2020 2020 6465 7074 6820 3a20          depth : 
+00005200: 696e 7420 6f72 204e 6f6e 650a 2020 2020  int or None.    
+00005210: 2020 2020 2020 2020 2020 2020 4966 206e              If n
+00005220: 6f74 204e 6f6e 652c 2064 6566 696e 6573  ot None, defines
+00005230: 2066 726f 6d20 686f 7720 6d61 6e79 2072   from how many r
+00005240: 6566 6572 656e 6365 206c 6576 656c 7320  eference levels 
+00005250: 746f 0a20 2020 2020 2020 2020 2020 2020  to.             
+00005260: 2020 2072 6574 7269 6576 6520 506f 7274     retrieve Port
+00005270: 7320 6672 6f6d 2e0a 0a20 2020 2020 2020  s from...       
+00005280: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
+00005290: 2020 2020 2020 706f 7274 5f6c 6973 7420        port_list 
+000052a0: 3a20 6c69 7374 206f 6620 506f 7274 204c  : list of Port L
+000052b0: 6973 7420 6f66 2061 6c6c 2050 6f72 7473  ist of all Ports
+000052c0: 2069 6e20 7468 6520 436f 6d70 6f6e 656e   in the Componen
+000052d0: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
+000052e0: 2020 2020 2020 2070 6f72 745f 6c69 7374         port_list
+000052f0: 203d 205b 702e 5f63 6f70 7928 2920 666f   = [p._copy() fo
+00005300: 7220 7020 696e 2073 656c 662e 706f 7274  r p in self.port
+00005310: 732e 7661 6c75 6573 2829 5d0a 0a20 2020  s.values()]..   
+00005320: 2020 2020 2069 6620 6465 7074 6820 6973       if depth is
+00005330: 204e 6f6e 6520 6f72 2064 6570 7468 203e   None or depth >
+00005340: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00005350: 666f 7220 7220 696e 2073 656c 662e 7265  for r in self.re
+00005360: 6665 7265 6e63 6573 3a0a 2020 2020 2020  ferences:.      
+00005370: 2020 2020 2020 2020 2020 6e65 775f 6465            new_de
+00005380: 7074 6820 3d20 4e6f 6e65 2069 6620 6465  pth = None if de
+00005390: 7074 6820 6973 204e 6f6e 6520 656c 7365  pth is None else
+000053a0: 2064 6570 7468 202d 2031 0a20 2020 2020   depth - 1.     
+000053b0: 2020 2020 2020 2020 2020 2072 6566 5f70             ref_p
+000053c0: 6f72 7473 203d 2072 2e70 6172 656e 742e  orts = r.parent.
+000053d0: 6765 745f 706f 7274 7328 6465 7074 683d  get_ports(depth=
+000053e0: 6e65 775f 6465 7074 6829 0a0a 2020 2020  new_depth)..    
+000053f0: 2020 2020 2020 2020 2020 2020 2320 5472              # Tr
+00005400: 616e 7366 6f72 6d20 706f 7274 7320 7468  ansform ports th
+00005410: 6174 2063 616d 6520 6672 6f6d 2061 2072  at came from a r
+00005420: 6566 6572 656e 6365 0a20 2020 2020 2020  eference.       
+00005430: 2020 2020 2020 2020 2072 6566 5f70 6f72           ref_por
+00005440: 7473 5f74 7261 6e73 666f 726d 6564 203d  ts_transformed =
+00005450: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00005460: 2020 2020 666f 7220 7270 2069 6e20 7265      for rp in re
+00005470: 665f 706f 7274 733a 0a20 2020 2020 2020  f_ports:.       
+00005480: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00005490: 5f70 6f72 7420 3d20 7270 2e5f 636f 7079  _port = rp._copy
+000054a0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+000054b0: 2020 2020 2020 206e 6577 5f63 656e 7465         new_cente
+000054c0: 722c 206e 6577 5f6f 7269 656e 7461 7469  r, new_orientati
+000054d0: 6f6e 203d 2072 2e5f 7472 616e 7366 6f72  on = r._transfor
+000054e0: 6d5f 706f 7274 280a 2020 2020 2020 2020  m_port(.        
+000054f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005500: 7270 2e63 656e 7465 722c 0a20 2020 2020  rp.center,.     
+00005510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005520: 2020 2072 702e 6f72 6965 6e74 6174 696f     rp.orientatio
+00005530: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+00005540: 2020 2020 2020 2020 2020 2072 2e6f 7269             r.ori
+00005550: 6769 6e2c 0a20 2020 2020 2020 2020 2020  gin,.           
+00005560: 2020 2020 2020 2020 2020 2020 2072 2e72               r.r
+00005570: 6f74 6174 696f 6e2c 0a20 2020 2020 2020  otation,.       
+00005580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005590: 2072 2e78 5f72 6566 6c65 6374 696f 6e2c   r.x_reflection,
+000055a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000055b0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000055c0: 2020 2020 2020 2020 2020 206e 6577 5f70             new_p
+000055d0: 6f72 742e 6365 6e74 6572 203d 206e 6577  ort.center = new
+000055e0: 5f63 656e 7465 720a 2020 2020 2020 2020  _center.        
+000055f0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00005600: 706f 7274 2e6e 6577 5f6f 7269 656e 7461  port.new_orienta
+00005610: 7469 6f6e 203d 206e 6577 5f6f 7269 656e  tion = new_orien
+00005620: 7461 7469 6f6e 0a20 2020 2020 2020 2020  tation.         
+00005630: 2020 2020 2020 2020 2020 2072 6566 5f70             ref_p
+00005640: 6f72 7473 5f74 7261 6e73 666f 726d 6564  orts_transformed
+00005650: 2e61 7070 656e 6428 6e65 775f 706f 7274  .append(new_port
+00005660: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00005670: 2020 706f 7274 5f6c 6973 7420 2b3d 2072    port_list += r
+00005680: 6566 5f70 6f72 7473 5f74 7261 6e73 666f  ef_ports_transfo
+00005690: 726d 6564 0a0a 2020 2020 2020 2020 7265  rmed..        re
+000056a0: 7475 726e 2070 6f72 745f 6c69 7374 0a0a  turn port_list..
+000056b0: 2020 2020 6465 6620 6765 745f 706f 7274      def get_port
+000056c0: 735f 6469 6374 2873 656c 662c 202a 2a6b  s_dict(self, **k
+000056d0: 7761 7267 7329 202d 3e20 4469 6374 5b73  wargs) -> Dict[s
+000056e0: 7472 2c20 506f 7274 5d3a 0a20 2020 2020  tr, Port]:.     
+000056f0: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
+00005700: 6469 6374 206f 6620 706f 7274 732e 0a0a  dict of ports...
+00005710: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
+00005720: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+00005730: 2020 6c61 7965 723a 2070 6f72 7420 4744    layer: port GD
+00005740: 5320 6c61 7965 722e 0a20 2020 2020 2020  S layer..       
+00005750: 2020 2020 2070 7265 6669 783a 2073 656c       prefix: sel
+00005760: 6563 7420 706f 7274 7320 7769 7468 2070  ect ports with p
+00005770: 7265 6669 7820 696e 2070 6f72 7420 6e61  refix in port na
+00005780: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
+00005790: 7375 6666 6978 3a20 7365 6c65 6374 2070  suffix: select p
+000057a0: 6f72 7473 2077 6974 6820 706f 7274 206e  orts with port n
+000057b0: 616d 6520 7375 6666 6978 2e0a 2020 2020  ame suffix..    
+000057c0: 2020 2020 2020 2020 6f72 6965 6e74 6174          orientat
+000057d0: 696f 6e3a 2073 656c 6563 7420 706f 7274  ion: select port
+000057e0: 7320 7769 7468 206f 7269 656e 7461 7469  s with orientati
+000057f0: 6f6e 2069 6e20 6465 6772 6565 732e 0a20  on in degrees.. 
+00005800: 2020 2020 2020 2020 2020 2077 6964 7468             width
+00005810: 3a20 7365 6c65 6374 2070 6f72 7473 2077  : select ports w
+00005820: 6974 6820 706f 7274 2077 6964 7468 2e0a  ith port width..
+00005830: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00005840: 7273 5f65 7863 6c75 6465 643a 204c 6973  rs_excluded: Lis
+00005850: 7420 6f66 206c 6179 6572 7320 746f 2065  t of layers to e
+00005860: 7863 6c75 6465 2e0a 2020 2020 2020 2020  xclude..        
+00005870: 2020 2020 706f 7274 5f74 7970 653a 2073      port_type: s
+00005880: 656c 6563 7420 706f 7274 7320 7769 7468  elect ports with
+00005890: 2070 6f72 745f 7479 7065 2028 6f70 7469   port_type (opti
+000058a0: 6361 6c2c 2065 6c65 6374 7269 6361 6c2c  cal, electrical,
+000058b0: 2076 6572 7469 6361 6c5f 7465 292e 0a20   vertical_te).. 
+000058c0: 2020 2020 2020 2020 2020 2063 6c6f 636b             clock
+000058d0: 7769 7365 3a20 6966 2054 7275 652c 2073  wise: if True, s
+000058e0: 6f72 7420 706f 7274 7320 636c 6f63 6b77  ort ports clockw
+000058f0: 6973 652c 2046 616c 7365 3a20 636f 756e  ise, False: coun
+00005900: 7465 722d 636c 6f63 6b77 6973 652e 0a20  ter-clockwise.. 
+00005910: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00005920: 2020 2072 6574 7572 6e20 7365 6c65 6374     return select
+00005930: 5f70 6f72 7473 2873 656c 662e 706f 7274  _ports(self.port
+00005940: 732c 202a 2a6b 7761 7267 7329 0a0a 2020  s, **kwargs)..  
+00005950: 2020 6465 6620 6765 745f 706f 7274 735f    def get_ports_
+00005960: 6c69 7374 2873 656c 662c 202a 2a6b 7761  list(self, **kwa
+00005970: 7267 7329 202d 3e20 4c69 7374 5b50 6f72  rgs) -> List[Por
+00005980: 745d 3a0a 2020 2020 2020 2020 2222 2252  t]:.        """R
+00005990: 6574 7572 6e73 206c 6973 7420 6f66 2070  eturns list of p
+000059a0: 6f72 7473 2e0a 0a20 2020 2020 2020 204b  orts...        K
+000059b0: 6579 776f 7264 2041 7267 733a 0a20 2020  eyword Args:.   
+000059c0: 2020 2020 2020 2020 206c 6179 6572 3a20           layer: 
+000059d0: 7365 6c65 6374 2070 6f72 7473 2077 6974  select ports wit
+000059e0: 6820 4744 5320 6c61 7965 722e 0a20 2020  h GDS layer..   
+000059f0: 2020 2020 2020 2020 2070 7265 6669 783a           prefix:
+00005a00: 2073 656c 6563 7420 706f 7274 7320 7769   select ports wi
+00005a10: 7468 2070 7265 6669 7820 696e 2070 6f72  th prefix in por
+00005a20: 7420 6e61 6d65 2e0a 2020 2020 2020 2020  t name..        
+00005a30: 2020 2020 7375 6666 6978 3a20 7365 6c65      suffix: sele
+00005a40: 6374 2070 6f72 7473 2077 6974 6820 706f  ct ports with po
+00005a50: 7274 206e 616d 6520 7375 6666 6978 2e0a  rt name suffix..
+00005a60: 2020 2020 2020 2020 2020 2020 6f72 6965              orie
+00005a70: 6e74 6174 696f 6e3a 2073 656c 6563 7420  ntation: select 
+00005a80: 706f 7274 7320 7769 7468 206f 7269 656e  ports with orien
+00005a90: 7461 7469 6f6e 2069 6e20 6465 6772 6565  tation in degree
+00005aa0: 732e 0a20 2020 2020 2020 2020 2020 206f  s..            o
+00005ab0: 7269 656e 7461 7469 6f6e 3a20 7365 6c65  rientation: sele
+00005ac0: 6374 2070 6f72 7473 2077 6974 6820 6f72  ct ports with or
+00005ad0: 6965 6e74 6174 696f 6e20 696e 2064 6567  ientation in deg
+00005ae0: 7265 6573 2e0a 2020 2020 2020 2020 2020  rees..          
+00005af0: 2020 7769 6474 683a 2073 656c 6563 7420    width: select 
+00005b00: 706f 7274 7320 7769 7468 2070 6f72 7420  ports with port 
+00005b10: 7769 6474 682e 0a20 2020 2020 2020 2020  width..         
+00005b20: 2020 206c 6179 6572 735f 6578 636c 7564     layers_exclud
+00005b30: 6564 3a20 4c69 7374 206f 6620 6c61 7965  ed: List of laye
+00005b40: 7273 2074 6f20 6578 636c 7564 652e 0a20  rs to exclude.. 
+00005b50: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
+00005b60: 7479 7065 3a20 7365 6c65 6374 2070 6f72  type: select por
+00005b70: 7473 2077 6974 6820 706f 7274 5f74 7970  ts with port_typ
+00005b80: 6520 286f 7074 6963 616c 2c20 656c 6563  e (optical, elec
+00005b90: 7472 6963 616c 2c20 7665 7274 6963 616c  trical, vertical
+00005ba0: 5f74 6529 2e0a 2020 2020 2020 2020 2020  _te)..          
+00005bb0: 2020 636c 6f63 6b77 6973 653a 2069 6620    clockwise: if 
+00005bc0: 5472 7565 2c20 736f 7274 2070 6f72 7473  True, sort ports
+00005bd0: 2063 6c6f 636b 7769 7365 2c20 4661 6c73   clockwise, Fals
+00005be0: 653a 2063 6f75 6e74 6572 2d63 6c6f 636b  e: counter-clock
+00005bf0: 7769 7365 2e0a 2020 2020 2020 2020 2222  wise..        ""
+00005c00: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00005c10: 206c 6973 7428 7365 6c65 6374 5f70 6f72   list(select_por
+00005c20: 7473 2873 656c 662e 706f 7274 732c 202a  ts(self.ports, *
+00005c30: 2a6b 7761 7267 7329 2e76 616c 7565 7328  *kwargs).values(
+00005c40: 2929 0a0a 2020 2020 6465 6620 6765 745f  ))..    def get_
+00005c50: 706f 7274 735f 7061 6e64 6173 2873 656c  ports_pandas(sel
+00005c60: 6629 3a0a 2020 2020 2020 2020 696d 706f  f):.        impo
+00005c70: 7274 2070 616e 6461 7320 6173 2070 640a  rt pandas as pd.
+00005c80: 0a20 2020 2020 2020 2063 6f6c 5f73 7065  .        col_spe
+00005c90: 6320 3d20 5b0a 2020 2020 2020 2020 2020  c = [.          
+00005ca0: 2020 226e 616d 6522 2c0a 2020 2020 2020    "name",.      
+00005cb0: 2020 2020 2020 2277 6964 7468 222c 0a20        "width",. 
+00005cc0: 2020 2020 2020 2020 2020 2022 6365 6e74             "cent
+00005cd0: 6572 222c 0a20 2020 2020 2020 2020 2020  er",.           
+00005ce0: 2022 6f72 6965 6e74 6174 696f 6e22 2c0a   "orientation",.
+00005cf0: 2020 2020 2020 2020 2020 2020 226c 6179              "lay
+00005d00: 6572 222c 0a20 2020 2020 2020 2020 2020  er",.           
+00005d10: 2022 706f 7274 5f74 7970 6522 2c0a 2020   "port_type",.  
+00005d20: 2020 2020 2020 2020 2020 2273 6865 6172            "shear
+00005d30: 5f61 6e67 6c65 222c 0a20 2020 2020 2020  _angle",.       
+00005d40: 205d 0a0a 2020 2020 2020 2020 7265 7475   ]..        retu
+00005d50: 726e 2070 642e 4461 7461 4672 616d 6528  rn pd.DataFrame(
+00005d60: 0a20 2020 2020 2020 2020 2020 205b 706f  .            [po
+00005d70: 7274 2e74 6f5f 6469 6374 2829 2066 6f72  rt.to_dict() for
+00005d80: 2070 6f72 7420 696e 2073 656c 662e 6765   port in self.ge
+00005d90: 745f 706f 7274 735f 6c69 7374 2829 5d2c  t_ports_list()],
+00005da0: 2063 6f6c 756d 6e73 3d63 6f6c 5f73 7065   columns=col_spe
+00005db0: 630a 2020 2020 2020 2020 290a 0a20 2020  c.        )..   
+00005dc0: 2064 6566 2067 6574 5f70 6f72 7473 5f70   def get_ports_p
+00005dd0: 6f6c 6172 7328 7365 6c66 293a 0a20 2020  olars(self):.   
+00005de0: 2020 2020 2069 6d70 6f72 7420 706f 6c61       import pola
+00005df0: 7273 2061 7320 706c 0a0a 2020 2020 2020  rs as pl..      
+00005e00: 2020 636f 6c5f 7370 6563 203d 207b 0a20    col_spec = {. 
+00005e10: 2020 2020 2020 2020 2020 2022 6e61 6d65             "name
+00005e20: 223a 2070 6c2e 5574 6638 2c0a 2020 2020  ": pl.Utf8,.    
+00005e30: 2020 2020 2020 2020 2277 6964 7468 223a          "width":
+00005e40: 2070 6c2e 466c 6f61 7436 342c 0a20 2020   pl.Float64,.   
+00005e50: 2020 2020 2020 2020 2022 6365 6e74 6572           "center
+00005e60: 223a 2070 6c2e 4c69 7374 2870 6c2e 466c  ": pl.List(pl.Fl
+00005e70: 6f61 7436 3429 2c0a 2020 2020 2020 2020  oat64),.        
+00005e80: 2020 2020 226f 7269 656e 7461 7469 6f6e      "orientation
+00005e90: 223a 2070 6c2e 466c 6f61 7436 342c 0a20  ": pl.Float64,. 
+00005ea0: 2020 2020 2020 2020 2020 2022 6c61 7965             "laye
+00005eb0: 7222 3a20 706c 2e4c 6973 7428 706c 2e55  r": pl.List(pl.U
+00005ec0: 496e 7431 3629 2c0a 2020 2020 2020 2020  Int16),.        
+00005ed0: 2020 2020 2270 6f72 745f 7479 7065 223a      "port_type":
+00005ee0: 2070 6c2e 5574 6638 2c0a 2020 2020 2020   pl.Utf8,.      
+00005ef0: 2020 2020 2020 2273 6865 6172 5f61 6e67        "shear_ang
+00005f00: 6c65 223a 2070 6c2e 466c 6f61 7436 342c  le": pl.Float64,
+00005f10: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+00005f20: 2020 2020 7265 7475 726e 2070 6c2e 4461      return pl.Da
+00005f30: 7461 4672 616d 6528 0a20 2020 2020 2020  taFrame(.       
+00005f40: 2020 2020 205b 706f 7274 2e74 6f5f 6469       [port.to_di
+00005f50: 6374 2829 2066 6f72 2070 6f72 7420 696e  ct() for port in
+00005f60: 2073 656c 662e 6765 745f 706f 7274 735f   self.get_ports_
+00005f70: 6c69 7374 2829 5d2c 2073 6368 656d 613d  list()], schema=
+00005f80: 636f 6c5f 7370 6563 0a20 2020 2020 2020  col_spec.       
+00005f90: 2029 0a0a 2020 2020 6465 6620 7265 6628   )..    def ref(
+00005fa0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00005fb0: 2020 2020 2020 2070 6f73 6974 696f 6e3a         position:
+00005fc0: 2043 6f6f 7264 696e 6174 6520 3d20 2830   Coordinate = (0
+00005fd0: 2c20 3029 2c0a 2020 2020 2020 2020 706f  , 0),.        po
+00005fe0: 7274 5f69 643a 204f 7074 696f 6e61 6c5b  rt_id: Optional[
+00005ff0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+00006000: 2020 2020 2072 6f74 6174 696f 6e3a 2066       rotation: f
+00006010: 6c6f 6174 203d 2030 2c0a 2020 2020 2020  loat = 0,.      
+00006020: 2020 685f 6d69 7272 6f72 3a20 626f 6f6c    h_mirror: bool
+00006030: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+00006040: 2020 765f 6d69 7272 6f72 3a20 626f 6f6c    v_mirror: bool
+00006050: 203d 2046 616c 7365 2c0a 2020 2020 2920   = False,.    ) 
+00006060: 2d3e 2043 6f6d 706f 6e65 6e74 5265 6665  -> ComponentRefe
+00006070: 7265 6e63 653a 0a20 2020 2020 2020 2022  rence:.        "
+00006080: 2222 5265 7475 726e 7320 436f 6d70 6f6e  ""Returns Compon
+00006090: 656e 7420 7265 6665 7265 6e63 652e 0a0a  ent reference...
+000060a0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+000060b0: 2020 2020 2020 2020 2020 706f 7369 7469            positi
+000060c0: 6f6e 3a20 782c 2079 2070 6f73 6974 696f  on: x, y positio
+000060d0: 6e2e 0a20 2020 2020 2020 2020 2020 2070  n..            p
+000060e0: 6f72 745f 6964 3a20 6e61 6d65 206f 6620  ort_id: name of 
+000060f0: 7468 6520 706f 7274 2e0a 2020 2020 2020  the port..      
+00006100: 2020 2020 2020 726f 7461 7469 6f6e 3a20        rotation: 
+00006110: 696e 2064 6567 7265 6573 2e0a 2020 2020  in degrees..    
+00006120: 2020 2020 2020 2020 685f 6d69 7272 6f72          h_mirror
+00006130: 3a20 686f 7269 7a6f 6e74 616c 206d 6972  : horizontal mir
+00006140: 726f 7220 7573 696e 6720 7920 6178 6973  ror using y axis
+00006150: 2028 782c 2031 2920 2831 2c20 3029 2e0a   (x, 1) (1, 0)..
+00006160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006170: 5468 6973 2069 7320 7468 6520 6d6f 7374  This is the most
+00006180: 2063 6f6d 6d6f 6e20 6d69 7272 6f72 2e0a   common mirror..
+00006190: 2020 2020 2020 2020 2020 2020 765f 6d69              v_mi
+000061a0: 7272 6f72 3a20 7665 7274 6963 616c 206d  rror: vertical m
+000061b0: 6972 726f 7220 7573 696e 6720 7820 6178  irror using x ax
+000061c0: 6973 2028 312c 2079 2920 2830 2c20 7929  is (1, y) (0, y)
+000061d0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000061e0: 2020 2020 2020 5f72 6566 203d 2043 6f6d        _ref = Com
+000061f0: 706f 6e65 6e74 5265 6665 7265 6e63 6528  ponentReference(
+00006200: 7365 6c66 290a 0a20 2020 2020 2020 2069  self)..        i
+00006210: 6620 706f 7274 5f69 6420 616e 6420 706f  f port_id and po
+00006220: 7274 5f69 6420 6e6f 7420 696e 2073 656c  rt_id not in sel
+00006230: 662e 706f 7274 733a 0a20 2020 2020 2020  f.ports:.       
+00006240: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00006250: 4572 726f 7228 6622 706f 7274 207b 706f  Error(f"port {po
+00006260: 7274 5f69 647d 206e 6f74 2069 6e20 7b73  rt_id} not in {s
+00006270: 656c 662e 706f 7274 732e 6b65 7973 2829  elf.ports.keys()
+00006280: 7d22 290a 0a20 2020 2020 2020 206f 7269  }")..        ori
+00006290: 6769 6e20 3d20 7365 6c66 2e70 6f72 7473  gin = self.ports
+000062a0: 5b70 6f72 745f 6964 5d2e 6365 6e74 6572  [port_id].center
+000062b0: 2069 6620 706f 7274 5f69 6420 656c 7365   if port_id else
+000062c0: 2028 302c 2030 290a 2020 2020 2020 2020   (0, 0).        
+000062d0: 6966 2068 5f6d 6972 726f 723a 0a20 2020  if h_mirror:.   
+000062e0: 2020 2020 2020 2020 205f 7265 662e 6d69           _ref.mi
+000062f0: 7272 6f72 5f78 2870 6f72 745f 6964 290a  rror_x(port_id).
+00006300: 0a20 2020 2020 2020 2069 6620 765f 6d69  .        if v_mi
+00006310: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+00006320: 2020 5f72 6566 2e6d 6972 726f 725f 7928    _ref.mirror_y(
+00006330: 706f 7274 5f69 6429 0a0a 2020 2020 2020  port_id)..      
+00006340: 2020 6966 2072 6f74 6174 696f 6e20 213d    if rotation !=
+00006350: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00006360: 5f72 6566 2e72 6f74 6174 6528 726f 7461  _ref.rotate(rota
+00006370: 7469 6f6e 2c20 6f72 6967 696e 290a 2020  tion, origin).  
+00006380: 2020 2020 2020 5f72 6566 2e6d 6f76 6528        _ref.move(
+00006390: 6f72 6967 696e 2c20 706f 7369 7469 6f6e  origin, position
+000063a0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+000063b0: 6e20 5f72 6566 0a0a 2020 2020 6465 6620  n _ref..    def 
+000063c0: 7265 665f 6365 6e74 6572 2873 656c 662c  ref_center(self,
+000063d0: 2070 6f73 6974 696f 6e3d 2830 2c20 3029   position=(0, 0)
+000063e0: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
+000063f0: 7475 726e 7320 6120 7265 6665 7265 6e63  turns a referenc
+00006400: 6520 6f66 2074 6865 2063 6f6d 706f 6e65  e of the compone
+00006410: 6e74 2063 656e 7465 7265 6420 6174 2028  nt centered at (
+00006420: 783d 302c 2079 3d30 292e 2222 220a 2020  x=0, y=0).""".  
+00006430: 2020 2020 2020 7369 203d 2073 656c 662e        si = self.
+00006440: 7369 7a65 5f69 6e66 6f0a 2020 2020 2020  size_info.      
+00006450: 2020 7963 203d 2073 692e 736f 7574 6820    yc = si.south 
+00006460: 2b20 7369 2e68 6569 6768 7420 2f20 320a  + si.height / 2.
+00006470: 2020 2020 2020 2020 7863 203d 2073 692e          xc = si.
+00006480: 7765 7374 202b 2073 692e 7769 6474 6820  west + si.width 
+00006490: 2f20 320a 2020 2020 2020 2020 6365 6e74  / 2.        cent
+000064a0: 6572 203d 2028 7863 2c20 7963 290a 2020  er = (xc, yc).  
+000064b0: 2020 2020 2020 5f72 6566 203d 2043 6f6d        _ref = Com
+000064c0: 706f 6e65 6e74 5265 6665 7265 6e63 6528  ponentReference(
+000064d0: 7365 6c66 290a 2020 2020 2020 2020 5f72  self).        _r
+000064e0: 6566 2e6d 6f76 6528 6365 6e74 6572 2c20  ef.move(center, 
+000064f0: 706f 7369 7469 6f6e 290a 2020 2020 2020  position).      
+00006500: 2020 7265 7475 726e 205f 7265 660a 0a20    return _ref.. 
+00006510: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
+00006520: 7365 6c66 2920 2d3e 2073 7472 3a0a 2020  self) -> str:.  
+00006530: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
+00006540: 6120 7374 7269 6e67 2072 6570 7265 7365  a string represe
+00006550: 6e74 6174 696f 6e20 6f66 2074 6865 206f  ntation of the o
+00006560: 626a 6563 742e 2222 220a 2020 2020 2020  bject.""".      
+00006570: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
+00006580: 2020 2020 2020 2066 227b 7365 6c66 2e6e         f"{self.n
+00006590: 616d 657d 3a20 7569 6420 7b73 656c 662e  ame}: uid {self.
+000065a0: 7569 647d 2c20 220a 2020 2020 2020 2020  uid}, ".        
+000065b0: 2020 2020 6622 706f 7274 7320 7b6c 6973      f"ports {lis
+000065c0: 7428 7365 6c66 2e70 6f72 7473 2e6b 6579  t(self.ports.key
+000065d0: 7328 2929 7d2c 2022 0a20 2020 2020 2020  s())}, ".       
+000065e0: 2020 2020 2066 2272 6566 6572 656e 6365       f"reference
+000065f0: 7320 7b6c 6973 7428 7365 6c66 2e6e 616d  s {list(self.nam
+00006600: 6564 5f72 6566 6572 656e 6365 732e 6b65  ed_references.ke
+00006610: 7973 2829 297d 2c20 220a 2020 2020 2020  ys())}, ".      
+00006620: 2020 2020 2020 6622 7b6c 656e 2873 656c        f"{len(sel
+00006630: 662e 706f 6c79 676f 6e73 297d 2070 6f6c  f.polygons)} pol
+00006640: 7967 6f6e 7322 0a20 2020 2020 2020 2029  ygons".        )
+00006650: 0a0a 2020 2020 6465 6620 7070 7269 6e74  ..    def pprint
+00006660: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00006670: 2020 2020 2020 2020 2222 2250 7269 6e74          """Print
+00006680: 7320 636f 6d70 6f6e 656e 7420 696e 666f  s component info
+00006690: 2e22 2222 0a20 2020 2020 2020 2074 7279  .""".        try
+000066a0: 3a0a 2020 2020 2020 2020 2020 2020 6672  :.            fr
+000066b0: 6f6d 2072 6963 6820 696d 706f 7274 2070  om rich import p
+000066c0: 7265 7474 790a 0a20 2020 2020 2020 2020  retty..         
+000066d0: 2020 2070 7265 7474 792e 696e 7374 616c     pretty.instal
+000066e0: 6c28 290a 2020 2020 2020 2020 2020 2020  l().            
+000066f0: 7072 6574 7479 2e70 7072 696e 7428 7365  pretty.pprint(se
+00006700: 6c66 2e74 6f5f 6469 6374 2829 290a 2020  lf.to_dict()).  
+00006710: 2020 2020 2020 6578 6365 7074 2049 6d70        except Imp
+00006720: 6f72 7445 7272 6f72 3a0a 2020 2020 2020  ortError:.      
+00006730: 2020 2020 2020 7072 696e 7428 7961 6d6c        print(yaml
+00006740: 2e64 756d 7028 7365 6c66 2e74 6f5f 6469  .dump(self.to_di
+00006750: 6374 2829 2929 0a0a 2020 2020 6465 6620  ct()))..    def 
+00006760: 7070 7269 6e74 5f70 6f72 7473 2873 656c  pprint_ports(sel
+00006770: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00006780: 2020 2020 2222 2250 7269 6e74 7320 636f      """Prints co
+00006790: 6d70 6f6e 656e 7420 6e65 746c 6973 7473  mponent netlists
+000067a0: 2e22 2222 0a20 2020 2020 2020 2070 6f72  .""".        por
+000067b0: 7473 5f6c 6973 7420 3d20 7365 6c66 2e67  ts_list = self.g
+000067c0: 6574 5f70 6f72 7473 5f6c 6973 7428 290a  et_ports_list().
+000067d0: 2020 2020 2020 2020 666f 7220 706f 7274          for port
+000067e0: 2069 6e20 706f 7274 735f 6c69 7374 3a0a   in ports_list:.
+000067f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00006800: 7428 706f 7274 290a 0a20 2020 2040 7072  t(port)..    @pr
+00006810: 6f70 6572 7479 0a20 2020 2064 6566 206d  operty.    def m
+00006820: 6574 6164 6174 615f 6368 696c 6428 7365  etadata_child(se
+00006830: 6c66 2920 2d3e 2044 6963 743a 0a20 2020  lf) -> Dict:.   
+00006840: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
+00006850: 6d65 7461 6461 7461 2066 726f 6d20 6368  metadata from ch
+00006860: 696c 6420 6966 2061 6e79 2c20 4f74 6865  ild if any, Othe
+00006870: 7277 6973 6520 7265 7475 726e 7320 636f  rwise returns co
+00006880: 6d70 6f6e 656e 7420 6f77 6e2e 0a0a 2020  mponent own...  
+00006890: 2020 2020 2020 6d65 7461 6461 7461 2047        metadata G
+000068a0: 7265 6174 2074 6f20 6163 6365 7373 2074  reat to access t
+000068b0: 6865 2063 6869 6c64 7265 6e20 6d65 7461  he children meta
+000068c0: 6461 7461 2061 7420 7468 6520 626f 7474  data at the bott
+000068d0: 6f6d 206f 6620 7468 650a 2020 2020 2020  om of the.      
+000068e0: 2020 6869 6572 6172 6368 792e 0a20 2020    hierarchy..   
+000068f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00006900: 2073 6574 7469 6e67 7320 3d20 6469 6374   settings = dict
+00006910: 2873 656c 662e 7365 7474 696e 6773 290a  (self.settings).
+00006920: 0a20 2020 2020 2020 2077 6869 6c65 2073  .        while s
+00006930: 6574 7469 6e67 732e 6765 7428 2263 6869  ettings.get("chi
+00006940: 6c64 2229 3a0a 2020 2020 2020 2020 2020  ld"):.          
+00006950: 2020 7365 7474 696e 6773 203d 2073 6574    settings = set
+00006960: 7469 6e67 732e 6765 7428 2263 6869 6c64  tings.get("child
+00006970: 2229 0a0a 2020 2020 2020 2020 7265 7475  ")..        retu
+00006980: 726e 2064 6963 7428 7365 7474 696e 6773  rn dict(settings
+00006990: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+000069a0: 0a20 2020 2064 6566 206d 6574 6164 6174  .    def metadat
+000069b0: 6128 7365 6c66 2920 2d3e 2044 6963 743a  a(self) -> Dict:
+000069c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000069d0: 6469 6374 2873 656c 662e 7365 7474 696e  dict(self.settin
+000069e0: 6773 290a 0a20 2020 2064 6566 2061 6464  gs)..    def add
+000069f0: 5f70 6f72 7428 0a20 2020 2020 2020 2073  _port(.        s
+00006a00: 656c 662c 0a20 2020 2020 2020 206e 616d  elf,.        nam
+00006a10: 653a 204f 7074 696f 6e61 6c5b 556e 696f  e: Optional[Unio
+00006a20: 6e5b 7374 722c 206f 626a 6563 745d 5d20  n[str, object]] 
+00006a30: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00006a40: 6365 6e74 6572 3a20 4f70 7469 6f6e 616c  center: Optional
+00006a50: 5b54 7570 6c65 5b66 6c6f 6174 2c20 666c  [Tuple[float, fl
+00006a60: 6f61 745d 5d20 3d20 4e6f 6e65 2c0a 2020  oat]] = None,.  
+00006a70: 2020 2020 2020 7769 6474 683a 204f 7074        width: Opt
+00006a80: 696f 6e61 6c5b 666c 6f61 745d 203d 204e  ional[float] = N
+00006a90: 6f6e 652c 0a20 2020 2020 2020 206f 7269  one,.        ori
+00006aa0: 656e 7461 7469 6f6e 3a20 4f70 7469 6f6e  entation: Option
+00006ab0: 616c 5b66 6c6f 6174 5d20 3d20 4e6f 6e65  al[float] = None
+00006ac0: 2c0a 2020 2020 2020 2020 706f 7274 3a20  ,.        port: 
+00006ad0: 4f70 7469 6f6e 616c 5b50 6f72 745d 203d  Optional[Port] =
+00006ae0: 204e 6f6e 652c 0a20 2020 2020 2020 206c   None,.        l
+00006af0: 6179 6572 3a20 4f70 7469 6f6e 616c 5b4c  ayer: Optional[L
+00006b00: 6179 6572 5370 6563 5d20 3d20 4e6f 6e65  ayerSpec] = None
+00006b10: 2c0a 2020 2020 2020 2020 706f 7274 5f74  ,.        port_t
+00006b20: 7970 653a 204f 7074 696f 6e61 6c5b 7374  ype: Optional[st
+00006b30: 725d 203d 204e 6f6e 652c 0a20 2020 2020  r] = None,.     
+00006b40: 2020 2063 726f 7373 5f73 6563 7469 6f6e     cross_section
+00006b50: 3a20 4f70 7469 6f6e 616c 5b43 726f 7373  : Optional[Cross
+00006b60: 5365 6374 696f 6e5d 203d 204e 6f6e 652c  Section] = None,
+00006b70: 0a20 2020 2029 202d 3e20 506f 7274 3a0a  .    ) -> Port:.
+00006b80: 2020 2020 2020 2020 2222 2241 6464 2070          """Add p
+00006b90: 6f72 7420 746f 2063 6f6d 706f 6e65 6e74  ort to component
+00006ba0: 2e0a 0a20 2020 2020 2020 2059 6f75 2063  ...        You c
+00006bb0: 616e 2063 6f70 7920 616e 2065 7869 7374  an copy an exist
+00006bc0: 696e 6720 706f 7274 206c 696b 6520 6164  ing port like ad
+00006bd0: 645f 706f 7274 2870 6f72 7420 3d20 6578  d_port(port = ex
+00006be0: 6973 7469 6e67 5f70 6f72 7429 206f 720a  isting_port) or.
+00006bf0: 2020 2020 2020 2020 6372 6561 7465 2061          create a
+00006c00: 206e 6577 2070 6f72 7420 6164 645f 706f   new port add_po
+00006c10: 7274 286d 796e 616d 652c 206d 7963 656e  rt(myname, mycen
+00006c20: 7465 722c 206d 7977 6964 7468 2c20 6d79  ter, mywidth, my
+00006c30: 6f72 6965 6e74 6174 696f 6e29 2e0a 2020  orientation)..  
+00006c40: 2020 2020 2020 596f 7520 6361 6e20 616c        You can al
+00006c50: 736f 2063 6f70 7920 616e 2065 7869 7374  so copy an exist
+00006c60: 696e 6720 706f 7274 0a20 2020 2020 2020  ing port.       
+00006c70: 2077 6974 6820 6120 6e65 7720 6e61 6d65   with a new name
+00006c80: 2061 6464 5f70 6f72 7428 706f 7274 203d   add_port(port =
+00006c90: 2065 7869 7374 696e 675f 706f 7274 2c20   existing_port, 
+00006ca0: 6e61 6d65 203d 206e 6577 5f6e 616d 6529  name = new_name)
+00006cb0: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+00006cc0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00006cd0: 3a20 706f 7274 206e 616d 652e 0a20 2020  : port name..   
+00006ce0: 2020 2020 2020 2020 2063 656e 7465 723a           center:
+00006cf0: 2078 2c20 792e 0a20 2020 2020 2020 2020   x, y..         
+00006d00: 2020 2077 6964 7468 3a20 696e 2075 6d2e     width: in um.
+00006d10: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
+00006d20: 656e 7461 7469 6f6e 3a20 696e 2064 6567  entation: in deg
+00006d30: 2e0a 2020 2020 2020 2020 2020 2020 706f  ..            po
+00006d40: 7274 3a20 6f70 7469 6f6e 616c 2070 6f72  rt: optional por
+00006d50: 742e 0a20 2020 2020 2020 2020 2020 206c  t..            l
+00006d60: 6179 6572 3a20 706f 7274 206c 6179 6572  ayer: port layer
+00006d70: 2e0a 2020 2020 2020 2020 2020 2020 706f  ..            po
+00006d80: 7274 5f74 7970 653a 206f 7074 6963 616c  rt_type: optical
+00006d90: 2c20 656c 6563 7472 6963 616c 2c20 7665  , electrical, ve
+00006da0: 7274 6963 616c 5f64 632c 2076 6572 7469  rtical_dc, verti
+00006db0: 6361 6c5f 7465 2c20 7665 7274 6963 616c  cal_te, vertical
+00006dc0: 5f74 6d2e 2044 6566 6175 6c74 7320 746f  _tm. Defaults to
+00006dd0: 206f 7074 6963 616c 2e0a 2020 2020 2020   optical..      
+00006de0: 2020 2020 2020 6372 6f73 735f 7365 6374        cross_sect
+00006df0: 696f 6e3a 2070 6f72 7420 6372 6f73 735f  ion: port cross_
+00006e00: 7365 6374 696f 6e2e 0a20 2020 2020 2020  section..       
+00006e10: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
+00006e20: 6d20 6764 7366 6163 746f 7279 2e70 646b  m gdsfactory.pdk
+00006e30: 2069 6d70 6f72 7420 6765 745f 6c61 7965   import get_laye
+00006e40: 720a 0a20 2020 2020 2020 206c 6179 6572  r..        layer
+00006e50: 203d 2067 6574 5f6c 6179 6572 286c 6179   = get_layer(lay
+00006e60: 6572 290a 0a20 2020 2020 2020 2069 6620  er)..        if 
+00006e70: 706f 7274 3a0a 2020 2020 2020 2020 2020  port:.          
+00006e80: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00006e90: 6e63 6528 706f 7274 2c20 506f 7274 293a  nce(port, Port):
+00006ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006eb0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00006ec0: 7228 6622 6164 645f 706f 7274 2829 206e  r(f"add_port() n
+00006ed0: 6565 6473 2061 2050 6f72 742c 2067 6f74  eeds a Port, got
+00006ee0: 207b 7479 7065 2870 6f72 7429 7d22 290a   {type(port)}").
+00006ef0: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
+00006f00: 706f 7274 2e63 6f70 7928 290a 2020 2020  port.copy().    
+00006f10: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
+00006f20: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00006f30: 2020 2020 2020 2020 2020 2020 2070 2e6e               p.n
+00006f40: 616d 6520 3d20 6e61 6d65 0a20 2020 2020  ame = name.     
+00006f50: 2020 2020 2020 2069 6620 6365 6e74 6572         if center
+00006f60: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00006f70: 2020 2020 2020 2020 2020 2020 2020 702e                p.
+00006f80: 6365 6e74 6572 203d 2063 656e 7465 720a  center = center.
+00006f90: 2020 2020 2020 2020 2020 2020 6966 2077              if w
+00006fa0: 6964 7468 2069 7320 6e6f 7420 4e6f 6e65  idth is not None
+00006fb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006fc0: 2020 702e 7769 6474 6820 3d20 7769 6474    p.width = widt
+00006fd0: 680a 2020 2020 2020 2020 2020 2020 6966  h.            if
+00006fe0: 206f 7269 656e 7461 7469 6f6e 2069 7320   orientation is 
+00006ff0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00007000: 2020 2020 2020 2020 2020 702e 6f72 6965            p.orie
+00007010: 6e74 6174 696f 6e20 3d20 6f72 6965 6e74  ntation = orient
+00007020: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
+00007030: 2020 6966 2070 6f72 745f 7479 7065 2069    if port_type i
+00007040: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00007050: 2020 2020 2020 2020 2020 2020 702e 706f              p.po
+00007060: 7274 5f74 7970 6520 3d20 706f 7274 5f74  rt_type = port_t
+00007070: 7970 650a 2020 2020 2020 2020 2020 2020  ype.            
+00007080: 6966 206c 6179 6572 2069 7320 6e6f 7420  if layer is not 
+00007090: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000070a0: 2020 2020 2020 702e 6c61 7965 7220 3d20        p.layer = 
+000070b0: 6c61 7965 720a 2020 2020 2020 2020 2020  layer.          
+000070c0: 2020 702e 7061 7265 6e74 203d 2073 656c    p.parent = sel
+000070d0: 660a 0a20 2020 2020 2020 2065 6c69 6620  f..        elif 
+000070e0: 6973 696e 7374 616e 6365 286e 616d 652c  isinstance(name,
+000070f0: 2050 6f72 7429 3a0a 2020 2020 2020 2020   Port):.        
+00007100: 2020 2020 7020 3d20 6e61 6d65 2e63 6f70      p = name.cop
+00007110: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
+00007120: 702e 7061 7265 6e74 203d 2073 656c 660a  p.parent = self.
+00007130: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00007140: 203d 2070 2e6e 616d 650a 2020 2020 2020   = p.name.      
+00007150: 2020 656c 6966 2063 656e 7465 7220 6973    elif center is
+00007160: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00007170: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00007180: 726f 7228 2250 6f72 7420 6e65 6564 7320  ror("Port needs 
+00007190: 6365 6e74 6572 2070 6172 616d 6574 6572  center parameter
+000071a0: 2028 782c 2079 2920 756d 2e22 290a 0a20   (x, y) um.").. 
+000071b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000071c0: 2020 2020 2020 2020 2070 203d 2050 6f72           p = Por
+000071d0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+000071e0: 2020 206e 616d 653d 6e61 6d65 2c0a 2020     name=name,.  
+000071f0: 2020 2020 2020 2020 2020 2020 2020 6365                ce
+00007200: 6e74 6572 3d63 656e 7465 722c 0a20 2020  nter=center,.   
+00007210: 2020 2020 2020 2020 2020 2020 2077 6964               wid
+00007220: 7468 3d77 6964 7468 2c0a 2020 2020 2020  th=width,.      
+00007230: 2020 2020 2020 2020 2020 6f72 6965 6e74            orient
+00007240: 6174 696f 6e3d 6f72 6965 6e74 6174 696f  ation=orientatio
+00007250: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+00007260: 2020 2070 6172 656e 743d 7365 6c66 2c0a     parent=self,.
+00007270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007280: 6c61 7965 723d 6c61 7965 722c 0a20 2020  layer=layer,.   
+00007290: 2020 2020 2020 2020 2020 2020 2070 6f72               por
+000072a0: 745f 7479 7065 3d70 6f72 745f 7479 7065  t_type=port_type
+000072b0: 206f 7220 226f 7074 6963 616c 222c 0a20   or "optical",. 
+000072c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000072d0: 726f 7373 5f73 6563 7469 6f6e 3d63 726f  ross_section=cro
+000072e0: 7373 5f73 6563 7469 6f6e 2c0a 2020 2020  ss_section,.    
+000072f0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00007300: 2020 6966 206e 616d 6520 6973 206e 6f74    if name is not
+00007310: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00007320: 2020 2070 2e6e 616d 6520 3d20 6e61 6d65     p.name = name
+00007330: 0a20 2020 2020 2020 2069 6620 702e 6e61  .        if p.na
+00007340: 6d65 2069 6e20 7365 6c66 2e70 6f72 7473  me in self.ports
+00007350: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00007360: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
+00007370: 2261 6464 5f70 6f72 7428 2920 506f 7274  "add_port() Port
+00007380: 206e 616d 6520 7b70 2e6e 616d 6521 727d   name {p.name!r}
+00007390: 2065 7869 7374 7320 696e 207b 7365 6c66   exists in {self
+000073a0: 2e6e 616d 6521 727d 2229 0a0a 2020 2020  .name!r}")..    
+000073b0: 2020 2020 7365 6c66 2e70 6f72 7473 5b70      self.ports[p
+000073c0: 2e6e 616d 655d 203d 2070 0a20 2020 2020  .name] = p.     
+000073d0: 2020 2072 6574 7572 6e20 700a 0a20 2020     return p..   
+000073e0: 2064 6566 2061 6464 5f70 6f72 7473 280a   def add_ports(.
+000073f0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+00007400: 2020 2020 2020 706f 7274 733a 2055 6e69        ports: Uni
+00007410: 6f6e 5b4c 6973 745b 506f 7274 5d2c 2044  on[List[Port], D
+00007420: 6963 745b 7374 722c 2050 6f72 745d 5d2c  ict[str, Port]],
+00007430: 0a20 2020 2020 2020 2070 7265 6669 783a  .        prefix:
 00007440: 2073 7472 203d 2022 222c 0a20 2020 2020   str = "",.     
-00007450: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
-00007460: 2029 202d 3e20 4e6f 6e65 3a0a 2020 2020   ) -> None:.    
-00007470: 2020 2020 2222 2241 6464 2061 206c 6973      """Add a lis
-00007480: 7420 6f72 2064 6963 7420 6f66 2070 6f72  t or dict of por
-00007490: 7473 2e0a 0a20 2020 2020 2020 2079 6f75  ts...        you
-000074a0: 2063 616e 2069 6e63 6c75 6465 2061 2070   can include a p
-000074b0: 7265 6669 7820 746f 2061 6464 2074 6f20  refix to add to 
-000074c0: 7468 6520 6e65 7720 706f 7274 206e 616d  the new port nam
-000074d0: 6573 2074 6f20 6176 6f69 6420 6e61 6d65  es to avoid name
-000074e0: 2063 6f6e 666c 6963 7473 2e0a 0a20 2020   conflicts...   
-000074f0: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-00007500: 2020 2020 2020 2070 6f72 7473 3a20 6c69         ports: li
-00007510: 7374 206f 7220 6469 6374 206f 6620 706f  st or dict of po
-00007520: 7274 732e 0a20 2020 2020 2020 2020 2020  rts..           
-00007530: 2070 7265 6669 783a 2074 6f20 7072 6570   prefix: to prep
-00007540: 656e 6420 746f 2065 6163 6820 706f 7274  end to each port
-00007550: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
-00007560: 2020 2073 7566 6669 783a 2074 6f20 6170     suffix: to ap
-00007570: 7065 6e64 2074 6f20 6561 6368 2070 6f72  pend to each por
-00007580: 7420 6e61 6d65 2e0a 2020 2020 2020 2020  t name..        
-00007590: 2222 220a 2020 2020 2020 2020 706f 7274  """.        port
-000075a0: 7320 3d20 706f 7274 7320 6966 2069 7369  s = ports if isi
-000075b0: 6e73 7461 6e63 6528 706f 7274 732c 206c  nstance(ports, l
-000075c0: 6973 7429 2065 6c73 6520 706f 7274 732e  ist) else ports.
-000075d0: 7661 6c75 6573 2829 0a20 2020 2020 2020  values().       
-000075e0: 2066 6f72 2070 6f72 7420 696e 206c 6973   for port in lis
-000075f0: 7428 706f 7274 7329 3a0a 2020 2020 2020  t(ports):.      
-00007600: 2020 2020 2020 6e61 6d65 203d 2066 227b        name = f"{
-00007610: 7072 6566 6978 7d7b 706f 7274 2e6e 616d  prefix}{port.nam
-00007620: 657d 7b73 7566 6669 787d 220a 2020 2020  e}{suffix}".    
-00007630: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-00007640: 5f70 6f72 7428 6e61 6d65 3d6e 616d 652c  _port(name=name,
-00007650: 2070 6f72 743d 706f 7274 2c20 2a2a 6b77   port=port, **kw
-00007660: 6172 6773 290a 0a20 2020 2064 6566 2073  args)..    def s
-00007670: 6e61 705f 706f 7274 735f 746f 5f67 7269  nap_ports_to_gri
-00007680: 6428 7365 6c66 2c20 6e6d 3a20 696e 7420  d(self, nm: int 
-00007690: 3d20 3129 202d 3e20 4e6f 6e65 3a0a 2020  = 1) -> None:.  
-000076a0: 2020 2020 2020 666f 7220 706f 7274 2069        for port i
-000076b0: 6e20 7365 6c66 2e70 6f72 7473 2e76 616c  n self.ports.val
-000076c0: 7565 7328 293a 0a20 2020 2020 2020 2020  ues():.         
-000076d0: 2020 2070 6f72 742e 736e 6170 5f74 6f5f     port.snap_to_
-000076e0: 6772 6964 286e 6d3d 6e6d 290a 0a20 2020  grid(nm=nm)..   
-000076f0: 2064 6566 2072 656d 6f76 655f 6c61 7965   def remove_laye
-00007700: 7273 280a 2020 2020 2020 2020 7365 6c66  rs(.        self
-00007710: 2c0a 2020 2020 2020 2020 6c61 7965 7273  ,.        layers
-00007720: 3a20 4c69 7374 5b4c 6179 6572 5370 6563  : List[LayerSpec
-00007730: 5d2c 0a20 2020 2020 2020 2069 6e63 6c75  ],.        inclu
-00007740: 6465 5f6c 6162 656c 733a 2062 6f6f 6c20  de_labels: bool 
-00007750: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
-00007760: 696e 7665 7274 5f73 656c 6563 7469 6f6e  invert_selection
-00007770: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-00007780: 2020 2020 2020 2020 7265 6375 7273 6976          recursiv
-00007790: 653a 2062 6f6f 6c20 3d20 5472 7565 2c0a  e: bool = True,.
-000077a0: 2020 2020 2920 2d3e 2043 6f6d 706f 6e65      ) -> Compone
-000077b0: 6e74 3a0a 2020 2020 2020 2020 2222 2252  nt:.        """R
-000077c0: 656d 6f76 6520 6120 6c69 7374 206f 6620  emove a list of 
-000077d0: 6c61 7965 7273 2061 6e64 2072 6574 7572  layers and retur
-000077e0: 6e73 2074 6865 2073 616d 6520 436f 6d70  ns the same Comp
-000077f0: 6f6e 656e 742e 0a0a 2020 2020 2020 2020  onent...        
-00007800: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00007810: 2020 6c61 7965 7273 3a20 6c69 7374 206f    layers: list o
-00007820: 6620 6c61 7965 7273 2074 6f20 7265 6d6f  f layers to remo
-00007830: 7665 2e0a 2020 2020 2020 2020 2020 2020  ve..            
-00007840: 696e 636c 7564 655f 6c61 6265 6c73 3a20  include_labels: 
-00007850: 7265 6d6f 7665 206c 6162 656c 7320 6f6e  remove labels on
-00007860: 2074 686f 7365 206c 6179 6572 732e 0a20   those layers.. 
-00007870: 2020 2020 2020 2020 2020 2069 6e76 6572             inver
-00007880: 745f 7365 6c65 6374 696f 6e3a 2072 656d  t_selection: rem
-00007890: 6f76 6573 2061 6c6c 206c 6179 6572 7320  oves all layers 
-000078a0: 6578 6365 7074 206c 6179 6572 7320 7370  except layers sp
-000078b0: 6563 6966 6965 642e 0a20 2020 2020 2020  ecified..       
-000078c0: 2020 2020 2072 6563 7572 7369 7665 3a20       recursive: 
-000078d0: 6f70 6572 6174 6520 6f6e 2074 6865 2063  operate on the c
-000078e0: 656c 6c73 2069 6e63 6c75 6465 6420 696e  ells included in
-000078f0: 2074 6869 7320 6365 6c6c 2e0a 2020 2020   this cell..    
-00007900: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00007910: 6672 6f6d 2067 6473 6661 6374 6f72 7920  from gdsfactory 
-00007920: 696d 706f 7274 2067 6574 5f6c 6179 6572  import get_layer
-00007930: 0a0a 2020 2020 2020 2020 636f 6d70 6f6e  ..        compon
-00007940: 656e 7420 3d20 7365 6c66 2e66 6c61 7474  ent = self.flatt
-00007950: 656e 2829 2069 6620 7265 6375 7273 6976  en() if recursiv
-00007960: 6520 616e 6420 7365 6c66 2e72 6566 6572  e and self.refer
-00007970: 656e 6365 7320 656c 7365 2073 656c 660a  ences else self.
-00007980: 2020 2020 2020 2020 6c61 7965 7273 203d          layers =
-00007990: 205b 6765 745f 6c61 7965 7228 6c61 7965   [get_layer(laye
-000079a0: 7229 2066 6f72 206c 6179 6572 2069 6e20  r) for layer in 
-000079b0: 6c61 7965 7273 5d0a 0a20 2020 2020 2020  layers]..       
-000079c0: 2073 686f 756c 645f 7265 6d6f 7665 203d   should_remove =
-000079d0: 206e 6f74 2069 6e76 6572 745f 7365 6c65   not invert_sele
-000079e0: 6374 696f 6e0a 2020 2020 2020 2020 636f  ction.        co
-000079f0: 6d70 6f6e 656e 742e 5f63 656c 6c2e 6669  mponent._cell.fi
-00007a00: 6c74 6572 280a 2020 2020 2020 2020 2020  lter(.          
-00007a10: 2020 7370 6563 3d6c 6179 6572 732c 0a20    spec=layers,. 
-00007a20: 2020 2020 2020 2020 2020 2072 656d 6f76             remov
-00007a30: 653d 7368 6f75 6c64 5f72 656d 6f76 652c  e=should_remove,
-00007a40: 0a20 2020 2020 2020 2020 2020 2070 6f6c  .            pol
-00007a50: 7967 6f6e 733d 5472 7565 2c0a 2020 2020  ygons=True,.    
-00007a60: 2020 2020 2020 2020 7061 7468 733d 5472          paths=Tr
-00007a70: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-00007a80: 6c61 6265 6c73 3d69 6e63 6c75 6465 5f6c  labels=include_l
-00007a90: 6162 656c 732c 0a20 2020 2020 2020 2029  abels,.        )
-00007aa0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00007ab0: 636f 6d70 6f6e 656e 740a 0a20 2020 2064  component..    d
-00007ac0: 6566 2065 7874 7261 6374 280a 2020 2020  ef extract(.    
-00007ad0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00007ae0: 2020 6c61 7965 7273 3a20 4c69 7374 5b55    layers: List[U
-00007af0: 6e69 6f6e 5b54 7570 6c65 5b69 6e74 2c20  nion[Tuple[int, 
-00007b00: 696e 745d 2c20 7374 725d 5d2c 0a20 2020  int], str]],.   
-00007b10: 2029 202d 3e20 436f 6d70 6f6e 656e 743a   ) -> Component:
-00007b20: 0a20 2020 2020 2020 2022 2222 4578 7472  .        """Extr
-00007b30: 6163 7420 706f 6c79 676f 6e73 2066 726f  act polygons fro
-00007b40: 6d20 6120 436f 6d70 6f6e 656e 7420 616e  m a Component an
-00007b50: 6420 7265 7475 726e 7320 6120 6e65 7720  d returns a new 
-00007b60: 436f 6d70 6f6e 656e 742e 2222 220a 2020  Component.""".  
-00007b70: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
-00007b80: 6374 6f72 792e 7064 6b20 696d 706f 7274  ctory.pdk import
-00007b90: 2067 6574 5f6c 6179 6572 0a0a 2020 2020   get_layer..    
-00007ba0: 2020 2020 6966 2074 7970 6528 6c61 7965      if type(laye
-00007bb0: 7273 2920 6e6f 7420 696e 2028 6c69 7374  rs) not in (list
-00007bc0: 2c20 7475 706c 6529 3a0a 2020 2020 2020  , tuple):.      
-00007bd0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00007be0: 6545 7272 6f72 2866 226c 6179 6572 7320  eError(f"layers 
-00007bf0: 7b6c 6179 6572 7321 727d 206e 6565 6473  {layers!r} needs
-00007c00: 2074 6f20 6265 2061 206c 6973 7420 6f72   to be a list or
-00007c10: 2074 7570 6c65 2229 0a0a 2020 2020 2020   tuple")..      
-00007c20: 2020 6c61 7965 7273 203d 205b 6765 745f    layers = [get_
-00007c30: 6c61 7965 7228 6c61 7965 7229 2066 6f72  layer(layer) for
-00007c40: 206c 6179 6572 2069 6e20 6c61 7965 7273   layer in layers
-00007c50: 5d0a 2020 2020 2020 2020 2320 636f 6d70  ].        # comp
-00007c60: 6f6e 656e 7420 3d20 7365 6c66 2e63 6f70  onent = self.cop
-00007c70: 7928 290a 2020 2020 2020 2020 2320 636f  y().        # co
-00007c80: 6d70 6f6e 656e 742e 5f63 656c 6c2e 6669  mponent._cell.fi
-00007c90: 6c74 6572 2873 7065 633d 6c61 7965 7273  lter(spec=layers
-00007ca0: 2c20 7265 6d6f 7665 3d46 616c 7365 290a  , remove=False).
-00007cb0: 0a20 2020 2020 2020 2063 6f6d 706f 6e65  .        compone
-00007cc0: 6e74 203d 2043 6f6d 706f 6e65 6e74 2829  nt = Component()
-00007cd0: 0a20 2020 2020 2020 2070 6f6c 795f 6469  .        poly_di
-00007ce0: 6374 203d 2073 656c 662e 6765 745f 706f  ct = self.get_po
-00007cf0: 6c79 676f 6e73 2862 795f 7370 6563 3d54  lygons(by_spec=T
-00007d00: 7275 652c 2069 6e63 6c75 6465 5f70 6174  rue, include_pat
-00007d10: 6873 3d46 616c 7365 290a 0a20 2020 2020  hs=False)..     
-00007d20: 2020 2066 6f72 206c 6179 6572 2069 6e20     for layer in 
-00007d30: 6c61 7965 7273 3a0a 2020 2020 2020 2020  layers:.        
-00007d40: 2020 2020 6966 206c 6179 6572 2069 6e20      if layer in 
-00007d50: 706f 6c79 5f64 6963 743a 0a20 2020 2020  poly_dict:.     
-00007d60: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-00007d70: 6f6e 7320 3d20 706f 6c79 5f64 6963 745b  ons = poly_dict[
-00007d80: 6c61 7965 725d 0a20 2020 2020 2020 2020  layer].         
-00007d90: 2020 2020 2020 2066 6f72 2070 6f6c 7967         for polyg
-00007da0: 6f6e 2069 6e20 706f 6c79 676f 6e73 3a0a  on in polygons:.
-00007db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007dc0: 2020 2020 636f 6d70 6f6e 656e 742e 6164      component.ad
-00007dd0: 645f 706f 6c79 676f 6e28 706f 6c79 676f  d_polygon(polygo
-00007de0: 6e2c 206c 6179 6572 290a 0a20 2020 2020  n, layer)..     
-00007df0: 2020 2066 6f72 206c 6179 6572 2069 6e20     for layer in 
-00007e00: 6c61 7965 7273 3a0a 2020 2020 2020 2020  layers:.        
-00007e10: 2020 2020 666f 7220 7061 7468 2069 6e20      for path in 
-00007e20: 7365 6c66 2e5f 6365 6c6c 2e67 6574 5f70  self._cell.get_p
-00007e30: 6174 6873 286c 6179 6572 3d6c 6179 6572  aths(layer=layer
-00007e40: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00007e50: 2020 2063 6f6d 706f 6e65 6e74 2e61 6464     component.add
-00007e60: 2870 6174 6829 0a0a 2020 2020 2020 2020  (path)..        
-00007e70: 7265 7475 726e 2063 6f6d 706f 6e65 6e74  return component
-00007e80: 0a0a 2020 2020 6465 6620 6164 645f 706f  ..    def add_po
-00007e90: 6c79 676f 6e28 7365 6c66 2c20 706f 696e  lygon(self, poin
-00007ea0: 7473 2c20 6c61 7965 723d 6e70 2e6e 616e  ts, layer=np.nan
-00007eb0: 293a 0a20 2020 2020 2020 2022 2222 4164  ):.        """Ad
-00007ec0: 6473 2061 2050 6f6c 7967 6f6e 2074 6f20  ds a Polygon to 
-00007ed0: 7468 6520 436f 6d70 6f6e 656e 742e 0a0a  the Component...
-00007ee0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-00007ef0: 2020 2020 2020 2020 2020 706f 696e 7473            points
-00007f00: 3a20 436f 6f72 6469 6e61 7465 7320 6f66  : Coordinates of
-00007f10: 2074 6865 2076 6572 7469 6365 7320 6f66   the vertices of
-00007f20: 2074 6865 2050 6f6c 7967 6f6e 2e0a 2020   the Polygon..  
-00007f30: 2020 2020 2020 2020 2020 6c61 7965 723a            layer:
-00007f40: 206c 6179 6572 2073 7065 6320 746f 2061   layer spec to a
-00007f50: 6464 2070 6f6c 7967 6f6e 206f 6e2e 0a20  dd polygon on.. 
-00007f60: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00007f70: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-00007f80: 7279 2e70 646b 2069 6d70 6f72 7420 6765  ry.pdk import ge
-00007f90: 745f 6c61 7965 720a 0a20 2020 2020 2020  t_layer..       
-00007fa0: 206c 6179 6572 203d 2067 6574 5f6c 6179   layer = get_lay
-00007fb0: 6572 286c 6179 6572 290a 0a20 2020 2020  er(layer)..     
-00007fc0: 2020 2069 6620 6c61 7965 7220 6973 204e     if layer is N
-00007fd0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00007fe0: 2072 6574 7572 6e20 4e6f 6e65 0a0a 2020   return None..  
-00007ff0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00008000: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00008010: 616e 6365 286c 6179 6572 2c20 7365 7429  ance(layer, set)
-00008020: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008030: 2020 7265 7475 726e 205b 7365 6c66 2e61    return [self.a
-00008040: 6464 5f70 6f6c 7967 6f6e 2870 6f69 6e74  dd_polygon(point
-00008050: 732c 206c 7929 2066 6f72 206c 7920 696e  s, ly) for ly in
-00008060: 206c 6179 6572 5d0a 2020 2020 2020 2020   layer].        
-00008070: 2020 2020 656c 6966 2061 6c6c 2869 7369      elif all(isi
-00008080: 6e73 7461 6e63 6528 6c79 2c20 284c 6179  nstance(ly, (Lay
-00008090: 6572 2929 2066 6f72 206c 7920 696e 206c  er)) for ly in l
-000080a0: 6179 6572 293a 0a20 2020 2020 2020 2020  ayer):.         
-000080b0: 2020 2020 2020 2072 6574 7572 6e20 5b73         return [s
-000080c0: 656c 662e 6164 645f 706f 6c79 676f 6e28  elf.add_polygon(
-000080d0: 706f 696e 7473 2c20 6c79 2920 666f 7220  points, ly) for 
-000080e0: 6c79 2069 6e20 6c61 7965 725d 0a20 2020  ly in layer].   
-000080f0: 2020 2020 2020 2020 2065 6c69 6620 6c65           elif le
-00008100: 6e28 6c61 7965 7229 203e 2032 3a20 2023  n(layer) > 2:  #
-00008110: 2053 6f6d 656f 6e65 2077 726f 7465 2065   Someone wrote e
-00008120: 2e67 2e20 6c61 7965 7220 3d20 5b31 2c34  .g. layer = [1,4
-00008130: 2c35 5d0a 2020 2020 2020 2020 2020 2020  ,5].            
-00008140: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00008150: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00008160: 2020 2020 2020 2020 2020 2222 2220 5b50            """ [P
-00008170: 4849 444c 5d20 4966 2073 7065 6369 6679  HIDL] If specify
-00008180: 696e 6720 6d75 6c74 6970 6c65 206c 6179  ing multiple lay
-00008190: 6572 730a 2020 2020 2020 2020 2020 2020  ers.            
-000081a0: 2020 2020 796f 7520 6d75 7374 2075 7365      you must use
-000081b0: 2073 6574 206e 6f74 6174 696f 6e2c 2065   set notation, e
-000081c0: 2e67 2e20 7b31 2c35 2c38 7d20 2222 220a  .g. {1,5,8} """.
-000081d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000081e0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-000081f0: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
-00008200: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
-00008210: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00008220: 6e63 6528 706f 696e 7473 2c20 6764 7374  nce(points, gdst
-00008230: 6b2e 506f 6c79 676f 6e29 3a0a 2020 2020  k.Polygon):.    
-00008240: 2020 2020 2020 2020 2320 6966 206c 6179          # if lay
-00008250: 6572 2069 7320 756e 7370 6563 6966 6965  er is unspecifie
-00008260: 6420 6f72 206d 6174 6368 6573 206f 7269  d or matches ori
-00008270: 6769 6e61 6c20 706f 6c79 676f 6e2c 206a  ginal polygon, j
-00008280: 7573 7420 6164 6420 6974 2061 732d 6973  ust add it as-is
-00008290: 0a20 2020 2020 2020 2020 2020 2070 6f6c  .            pol
-000082a0: 7967 6f6e 203d 2070 6f69 6e74 730a 2020  ygon = points.  
-000082b0: 2020 2020 2020 2020 2020 6966 206c 6179            if lay
-000082c0: 6572 2069 7320 6e70 2e6e 616e 206f 7220  er is np.nan or 
-000082d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000082e0: 2020 6973 696e 7374 616e 6365 286c 6179    isinstance(lay
-000082f0: 6572 2c20 7475 706c 6529 2061 6e64 2028  er, tuple) and (
-00008300: 706f 6c79 676f 6e2e 6c61 7965 722c 2070  polygon.layer, p
-00008310: 6f6c 7967 6f6e 2e64 6174 6174 7970 6529  olygon.datatype)
-00008320: 203d 3d20 6c61 7965 720a 2020 2020 2020   == layer.      
-00008330: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00008340: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
-00008350: 203d 2050 6f6c 7967 6f6e 2870 6f6c 7967   = Polygon(polyg
-00008360: 6f6e 2e70 6f69 6e74 732c 2070 6f6c 7967  on.points, polyg
-00008370: 6f6e 2e6c 6179 6572 2c20 706f 6c79 676f  on.layer, polygo
-00008380: 6e2e 6461 7461 7479 7065 290a 2020 2020  n.datatype).    
-00008390: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000083a0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-000083b0: 7965 722c 2064 6174 6174 7970 6520 3d20  yer, datatype = 
-000083c0: 5f70 6172 7365 5f6c 6179 6572 286c 6179  _parse_layer(lay
-000083d0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
-000083e0: 2020 2020 706f 6c79 676f 6e20 3d20 506f      polygon = Po
-000083f0: 6c79 676f 6e28 706f 6c79 676f 6e2e 706f  lygon(polygon.po
-00008400: 696e 7473 2c20 6c61 7965 722c 2064 6174  ints, layer, dat
-00008410: 6174 7970 6529 0a20 2020 2020 2020 2020  atype).         
-00008420: 2020 2073 656c 662e 5f61 6464 5f70 6f6c     self._add_pol
-00008430: 7967 6f6e 7328 706f 6c79 676f 6e29 0a20  ygons(polygon). 
-00008440: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00008450: 6e20 706f 6c79 676f 6e0a 0a20 2020 2020  n polygon..     
-00008460: 2020 2065 6c69 6620 6861 7361 7474 7228     elif hasattr(
-00008470: 706f 696e 7473 2c20 2267 656f 6d73 2229  points, "geoms")
-00008480: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00008490: 7220 6765 6f6d 2069 6e20 706f 696e 7473  r geom in points
-000084a0: 2e67 656f 6d73 3a0a 2020 2020 2020 2020  .geoms:.        
-000084b0: 2020 2020 2020 2020 706f 6c79 676f 6e20          polygon 
-000084c0: 3d20 7365 6c66 2e61 6464 5f70 6f6c 7967  = self.add_polyg
-000084d0: 6f6e 2867 656f 6d2c 206c 6179 6572 3d6c  on(geom, layer=l
-000084e0: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
-000084f0: 2020 7265 7475 726e 2070 6f6c 7967 6f6e    return polygon
-00008500: 0a20 2020 2020 2020 2065 6c69 6620 6861  .        elif ha
-00008510: 7361 7474 7228 706f 696e 7473 2c20 2265  sattr(points, "e
-00008520: 7874 6572 696f 7222 293a 2020 2320 706f  xterior"):  # po
-00008530: 696e 7473 2069 7320 6120 7368 6170 656c  ints is a shapel
-00008540: 7920 506f 6c79 676f 6e0a 2020 2020 2020  y Polygon.      
-00008550: 2020 2020 2020 6c61 7965 722c 2064 6174        layer, dat
-00008560: 6174 7970 6520 3d20 5f70 6172 7365 5f6c  atype = _parse_l
-00008570: 6179 6572 286c 6179 6572 290a 2020 2020  ayer(layer).    
-00008580: 2020 2020 2020 2020 706f 696e 7473 5f6f          points_o
-00008590: 6e5f 6772 6964 203d 206e 702e 726f 756e  n_grid = np.roun
-000085a0: 6428 706f 696e 7473 2e65 7874 6572 696f  d(points.exterio
-000085b0: 722e 636f 6f72 6473 2c20 3329 0a20 2020  r.coords, 3).   
-000085c0: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
-000085d0: 203d 2067 6473 746b 2e50 6f6c 7967 6f6e   = gdstk.Polygon
-000085e0: 2870 6f69 6e74 735f 6f6e 5f67 7269 642c  (points_on_grid,
-000085f0: 206c 6179 6572 2c20 6461 7461 7479 7065   layer, datatype
-00008600: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00008610: 6620 706f 696e 7473 2e69 6e74 6572 696f  f points.interio
-00008620: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-00008630: 2020 2020 6672 6f6d 2073 6861 7065 6c79      from shapely
-00008640: 2069 6d70 6f72 7420 6765 745f 636f 6f72   import get_coor
-00008650: 6469 6e61 7465 730a 0a20 2020 2020 2020  dinates..       
-00008660: 2020 2020 2020 2020 2070 6f69 6e74 735f           points_
-00008670: 6f6e 5f67 7269 645f 696e 7465 7269 6f72  on_grid_interior
-00008680: 203d 206e 702e 726f 756e 6428 6765 745f   = np.round(get_
-00008690: 636f 6f72 6469 6e61 7465 7328 706f 696e  coordinates(poin
-000086a0: 7473 2e69 6e74 6572 696f 7273 292c 2033  ts.interiors), 3
-000086b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000086c0: 2020 706f 6c79 676f 6e5f 696e 7465 7269    polygon_interi
-000086d0: 6f72 203d 2067 6473 746b 2e50 6f6c 7967  or = gdstk.Polyg
-000086e0: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-000086f0: 2020 2020 2020 2020 706f 696e 7473 5f6f          points_o
-00008700: 6e5f 6772 6964 5f69 6e74 6572 696f 722c  n_grid_interior,
-00008710: 206c 6179 6572 2c20 6461 7461 7479 7065   layer, datatype
-00008720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008730: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00008740: 2020 2070 6f6c 7967 6f6e 7320 3d20 6764     polygons = gd
-00008750: 7374 6b2e 626f 6f6c 6561 6e28 0a20 2020  stk.boolean(.   
-00008760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008770: 2070 6f6c 7967 6f6e 2c0a 2020 2020 2020   polygon,.      
-00008780: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00008790: 6c79 676f 6e5f 696e 7465 7269 6f72 2c0a  lygon_interior,.
-000087a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000087b0: 2020 2020 6f70 6572 6174 696f 6e3d 226e      operation="n
-000087c0: 6f74 222c 0a20 2020 2020 2020 2020 2020  ot",.           
-000087d0: 2020 2020 2020 2020 206c 6179 6572 3d6c           layer=l
-000087e0: 6179 6572 2c0a 2020 2020 2020 2020 2020  ayer,.          
-000087f0: 2020 2020 2020 2020 2020 6461 7461 7479            dataty
-00008800: 7065 3d64 6174 6174 7970 652c 0a20 2020  pe=datatype,.   
-00008810: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00008820: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00008830: 6f72 2070 6f6c 7967 6f6e 2069 6e20 706f  or polygon in po
-00008840: 6c79 676f 6e73 3a0a 2020 2020 2020 2020  lygons:.        
-00008850: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008860: 2e5f 6164 645f 706f 6c79 676f 6e73 2870  ._add_polygons(p
-00008870: 6f6c 7967 6f6e 290a 2020 2020 2020 2020  olygon).        
-00008880: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-00008890: 6f6c 7967 6f6e 0a0a 2020 2020 2020 2020  olygon..        
-000088a0: 2020 2020 7365 6c66 2e5f 6164 645f 706f      self._add_po
-000088b0: 6c79 676f 6e73 2870 6f6c 7967 6f6e 290a  lygons(polygon).
-000088c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000088d0: 726e 2070 6f6c 7967 6f6e 0a0a 2020 2020  rn polygon..    
-000088e0: 2020 2020 706f 696e 7473 203d 206e 702e      points = np.
-000088f0: 6173 6172 7261 7928 706f 696e 7473 290a  asarray(points).
-00008900: 2020 2020 2020 2020 6966 2070 6f69 6e74          if point
-00008910: 732e 6e64 696d 203d 3d20 313a 0a20 2020  s.ndim == 1:.   
-00008920: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00008930: 5b73 656c 662e 6164 645f 706f 6c79 676f  [self.add_polygo
-00008940: 6e28 706f 6c79 2c20 6c61 7965 723d 6c61  n(poly, layer=la
-00008950: 7965 7229 2066 6f72 2070 6f6c 7920 696e  yer) for poly in
-00008960: 2070 6f69 6e74 735d 0a20 2020 2020 2020   points].       
-00008970: 2069 6620 6c61 7965 7220 6973 206e 702e   if layer is np.
-00008980: 6e61 6e3a 0a20 2020 2020 2020 2020 2020  nan:.           
-00008990: 206c 6179 6572 203d 2030 0a0a 2020 2020   layer = 0..    
-000089a0: 2020 2020 6966 2070 6f69 6e74 732e 6e64      if points.nd
-000089b0: 696d 203d 3d20 323a 0a20 2020 2020 2020  im == 2:.       
-000089c0: 2020 2020 2023 2061 6464 2073 696e 676c       # add singl
-000089d0: 6520 706f 6c79 676f 6e20 6672 6f6d 2070  e polygon from p
-000089e0: 6f69 6e74 730a 2020 2020 2020 2020 2020  oints.          
-000089f0: 2020 6966 206c 656e 2870 6f69 6e74 735b    if len(points[
-00008a00: 305d 2920 3e20 323a 0a20 2020 2020 2020  0]) > 2:.       
-00008a10: 2020 2020 2020 2020 2023 2043 6f6e 7665           # Conve
-00008a20: 7274 2074 6f20 666f 726d 205b 5b31 2c32  rt to form [[1,2
-00008a30: 5d2c 5b33 2c34 5d2c 5b35 2c36 5d5d 0a20  ],[3,4],[5,6]]. 
-00008a40: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00008a50: 6f69 6e74 7320 3d20 6e70 2e63 6f6c 756d  oints = np.colum
-00008a60: 6e5f 7374 6163 6b28 706f 696e 7473 290a  n_stack(points).
-00008a70: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00008a80: 722c 2064 6174 6174 7970 6520 3d20 5f70  r, datatype = _p
-00008a90: 6172 7365 5f6c 6179 6572 286c 6179 6572  arse_layer(layer
-00008aa0: 290a 2020 2020 2020 2020 2020 2020 706f  ).            po
-00008ab0: 6c79 676f 6e20 3d20 506f 6c79 676f 6e28  lygon = Polygon(
-00008ac0: 706f 696e 7473 2c20 6c61 7965 723d 6c61  points, layer=la
-00008ad0: 7965 722c 2064 6174 6174 7970 653d 6461  yer, datatype=da
-00008ae0: 7461 7479 7065 290a 2020 2020 2020 2020  tatype).        
-00008af0: 2020 2020 7365 6c66 2e5f 6164 645f 706f      self._add_po
-00008b00: 6c79 676f 6e73 2870 6f6c 7967 6f6e 290a  lygons(polygon).
-00008b10: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00008b20: 726e 2070 6f6c 7967 6f6e 0a20 2020 2020  rn polygon.     
-00008b30: 2020 2065 6c69 6620 706f 696e 7473 2e6e     elif points.n
-00008b40: 6469 6d20 3d3d 2033 3a0a 2020 2020 2020  dim == 3:.      
-00008b50: 2020 2020 2020 6c61 7965 722c 2064 6174        layer, dat
-00008b60: 6174 7970 6520 3d20 5f70 6172 7365 5f6c  atype = _parse_l
-00008b70: 6179 6572 286c 6179 6572 290a 2020 2020  ayer(layer).    
-00008b80: 2020 2020 2020 2020 706f 6c79 676f 6e73          polygons
-00008b90: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-00008ba0: 2020 2020 2050 6f6c 7967 6f6e 2870 706f       Polygon(ppo
-00008bb0: 696e 7473 2c20 6c61 7965 723d 6c61 7965  ints, layer=laye
-00008bc0: 722c 2064 6174 6174 7970 653d 6461 7461  r, datatype=data
-00008bd0: 7479 7065 2920 666f 7220 7070 6f69 6e74  type) for ppoint
-00008be0: 7320 696e 2070 6f69 6e74 730a 2020 2020  s in points.    
-00008bf0: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-00008c00: 2020 2020 2020 7365 6c66 2e5f 6164 645f        self._add_
-00008c10: 706f 6c79 676f 6e73 282a 706f 6c79 676f  polygons(*polygo
-00008c20: 6e73 290a 2020 2020 2020 2020 2020 2020  ns).            
-00008c30: 7265 7475 726e 2070 6f6c 7967 6f6e 730a  return polygons.
-00008c40: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00008c50: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00008c60: 5661 6c75 6545 7272 6f72 2866 2255 6e61  ValueError(f"Una
-00008c70: 626c 6520 746f 2061 6464 207b 706f 696e  ble to add {poin
-00008c80: 7473 2e6e 6469 6d7d 2d64 696d 656e 7369  ts.ndim}-dimensi
-00008c90: 6f6e 616c 2070 6f69 6e74 7320 6f62 6a65  onal points obje
-00008ca0: 6374 2229 0a0a 2020 2020 6465 6620 5f61  ct")..    def _a
-00008cb0: 6464 5f70 6f6c 7967 6f6e 7328 7365 6c66  dd_polygons(self
-00008cc0: 2c20 2a70 6f6c 7967 6f6e 733a 204c 6973  , *polygons: Lis
-00008cd0: 745b 506f 6c79 676f 6e5d 293a 0a20 2020  t[Polygon]):.   
-00008ce0: 2020 2020 2073 656c 662e 6973 5f75 6e6c       self.is_unl
-00008cf0: 6f63 6b65 6428 290a 2020 2020 2020 2020  ocked().        
-00008d00: 7365 6c66 2e5f 6365 6c6c 2e61 6464 282a  self._cell.add(*
-00008d10: 706f 6c79 676f 6e73 290a 0a20 2020 2064  polygons)..    d
-00008d20: 6566 2063 6f70 7928 7365 6c66 2920 2d3e  ef copy(self) ->
-00008d30: 2043 6f6d 706f 6e65 6e74 3a0a 2020 2020   Component:.    
-00008d40: 2020 2020 7265 7475 726e 2063 6f70 7928      return copy(
-00008d50: 7365 6c66 290a 0a20 2020 2064 6566 2061  self)..    def a
-00008d60: 6464 5f72 6566 5f63 6f6e 7461 696e 6572  dd_ref_container
-00008d70: 2873 656c 662c 2063 6f6d 706f 6e65 6e74  (self, component
-00008d80: 3a20 436f 6d70 6f6e 656e 7429 202d 3e20  : Component) -> 
-00008d90: 436f 6d70 6f6e 656e 7452 6566 6572 656e  ComponentReferen
-00008da0: 6365 3a0a 2020 2020 2020 2020 2222 2241  ce:.        """A
-00008db0: 6464 2072 6566 6572 656e 6365 2c20 706f  dd reference, po
-00008dc0: 7274 7320 616e 6420 636f 7079 5f63 6869  rts and copy_chi
-00008dd0: 6c64 5f69 6e66 6f2e 2222 220a 2020 2020  ld_info.""".    
-00008de0: 2020 2020 7265 6620 3d20 7365 6c66 203c      ref = self <
-00008df0: 3c20 636f 6d70 6f6e 656e 740a 2020 2020  < component.    
-00008e00: 2020 2020 7365 6c66 2e61 6464 5f70 6f72      self.add_por
-00008e10: 7473 2872 6566 2e70 6f72 7473 290a 2020  ts(ref.ports).  
-00008e20: 2020 2020 2020 7365 6c66 2e63 6f70 795f        self.copy_
-00008e30: 6368 696c 645f 696e 666f 2863 6f6d 706f  child_info(compo
-00008e40: 6e65 6e74 290a 2020 2020 2020 2020 7265  nent).        re
-00008e50: 7475 726e 2072 6566 0a0a 2020 2020 6465  turn ref..    de
-00008e60: 6620 636f 7079 5f63 6869 6c64 5f69 6e66  f copy_child_inf
-00008e70: 6f28 7365 6c66 2c20 636f 6d70 6f6e 656e  o(self, componen
-00008e80: 743a 2043 6f6d 706f 6e65 6e74 2920 2d3e  t: Component) ->
-00008e90: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00008ea0: 2222 436f 7079 2061 6e64 2073 6574 7469  ""Copy and setti
-00008eb0: 6e67 7320 696e 666f 2066 726f 6d20 6368  ngs info from ch
-00008ec0: 696c 6420 636f 6d70 6f6e 656e 7420 696e  ild component in
-00008ed0: 746f 2070 6172 656e 742e 0a0a 2020 2020  to parent...    
-00008ee0: 2020 2020 5061 7265 6e74 2063 6f6d 706f      Parent compo
-00008ef0: 6e65 6e74 7320 6361 6e20 6163 6365 7373  nents can access
-00008f00: 2063 6869 6c64 2063 656c 6c73 2073 6574   child cells set
-00008f10: 7469 6e67 732e 0a20 2020 2020 2020 2022  tings..        "
-00008f20: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
-00008f30: 7420 6973 696e 7374 616e 6365 2863 6f6d  t isinstance(com
-00008f40: 706f 6e65 6e74 2c20 2843 6f6d 706f 6e65  ponent, (Compone
-00008f50: 6e74 2c20 436f 6d70 6f6e 656e 7452 6566  nt, ComponentRef
-00008f60: 6572 656e 6365 2929 3a0a 2020 2020 2020  erence)):.      
-00008f70: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00008f80: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00008f90: 2020 2020 2020 2020 6622 7b74 7970 6528          f"{type(
-00008fa0: 636f 6d70 6f6e 656e 7429 7d22 2022 6973  component)}" "is
-00008fb0: 206e 6f74 2061 2043 6f6d 706f 6e65 6e74   not a Component
-00008fc0: 206f 7220 436f 6d70 6f6e 656e 7452 6566   or ComponentRef
-00008fd0: 6572 656e 6365 220a 2020 2020 2020 2020  erence".        
-00008fe0: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
-00008ff0: 656c 662e 6765 745f 6368 696c 645f 6e61  elf.get_child_na
-00009000: 6d65 203d 2054 7275 650a 2020 2020 2020  me = True.      
-00009010: 2020 7365 6c66 2e63 6869 6c64 203d 2063    self.child = c
-00009020: 6f6d 706f 6e65 6e74 0a20 2020 2020 2020  omponent.       
-00009030: 2073 656c 662e 696e 666f 2e75 7064 6174   self.info.updat
-00009040: 6528 636f 6d70 6f6e 656e 742e 696e 666f  e(component.info
-00009050: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
-00009060: 6574 7469 6e67 732e 7570 6461 7465 2863  ettings.update(c
-00009070: 6f6d 706f 6e65 6e74 2e73 6574 7469 6e67  omponent.setting
-00009080: 7329 0a0a 2020 2020 4070 726f 7065 7274  s)..    @propert
-00009090: 790a 2020 2020 6465 6620 7369 7a65 5f69  y.    def size_i
-000090a0: 6e66 6f28 7365 6c66 2920 2d3e 2053 697a  nfo(self) -> Siz
-000090b0: 6549 6e66 6f3a 0a20 2020 2020 2020 2022  eInfo:.        "
-000090c0: 2222 5369 7a65 2069 6e66 6f20 6f66 2074  ""Size info of t
-000090d0: 6865 2063 6f6d 706f 6e65 6e74 2e22 2222  he component."""
-000090e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000090f0: 5369 7a65 496e 666f 2873 656c 662e 6262  SizeInfo(self.bb
-00009100: 6f78 290a 0a20 2020 2064 6566 2067 6574  ox)..    def get
-00009110: 5f73 6574 7469 6e67 2873 656c 662c 2073  _setting(self, s
-00009120: 6574 7469 6e67 3a20 7374 7229 202d 3e20  etting: str) -> 
-00009130: 556e 696f 6e5b 7374 722c 2069 6e74 2c20  Union[str, int, 
-00009140: 666c 6f61 745d 3a0a 2020 2020 2020 2020  float]:.        
-00009150: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
-00009160: 2020 2020 2073 656c 662e 696e 666f 2e67       self.info.g
-00009170: 6574 2873 6574 7469 6e67 290a 2020 2020  et(setting).    
-00009180: 2020 2020 2020 2020 6f72 2073 656c 662e          or self.
-00009190: 7365 7474 696e 6773 2e66 756c 6c2e 6765  settings.full.ge
-000091a0: 7428 7365 7474 696e 6729 0a20 2020 2020  t(setting).     
-000091b0: 2020 2020 2020 206f 7220 7365 6c66 2e6d         or self.m
-000091c0: 6574 6164 6174 615f 6368 696c 642e 6765  etadata_child.ge
-000091d0: 7428 7365 7474 696e 6729 0a20 2020 2020  t(setting).     
-000091e0: 2020 2029 0a0a 2020 2020 6465 6620 6973     )..    def is
-000091f0: 5f75 6e6c 6f63 6b65 6428 7365 6c66 2920  _unlocked(self) 
-00009200: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00009210: 2022 2222 5261 6973 6573 2065 7272 6f72   """Raises error
-00009220: 2069 6620 436f 6d70 6f6e 656e 7420 6973   if Component is
-00009230: 206c 6f63 6b65 642e 2222 220a 2020 2020   locked.""".    
-00009240: 2020 2020 6966 2073 656c 662e 5f6c 6f63      if self._loc
-00009250: 6b65 643a 0a20 2020 2020 2020 2020 2020  ked:.           
-00009260: 2072 6169 7365 204d 7574 6162 696c 6974   raise Mutabilit
-00009270: 7945 7272 6f72 280a 2020 2020 2020 2020  yError(.        
-00009280: 2020 2020 2020 2020 6622 436f 6d70 6f6e          f"Compon
-00009290: 656e 7420 7b73 656c 662e 6e61 6d65 2172  ent {self.name!r
-000092a0: 7d20 6361 6e6e 6f74 2062 6520 6d6f 6469  } cannot be modi
-000092b0: 6669 6564 2061 7320 6974 2773 2061 6c72  fied as it's alr
-000092c0: 6561 6479 206f 6e20 6361 6368 652e 2022  eady on cache. "
-000092d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000092e0: 202b 206d 7574 6162 696c 6974 795f 6572   + mutability_er
-000092f0: 726f 725f 6d65 7373 6167 650a 2020 2020  ror_message.    
-00009300: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00009310: 6566 205f 6164 6428 7365 6c66 2c20 656c  ef _add(self, el
-00009320: 656d 656e 7429 202d 3e20 4e6f 6e65 3a0a  ement) -> None:.
-00009330: 2020 2020 2020 2020 2222 2241 6464 2061          """Add a
-00009340: 206e 6577 2065 6c65 6d65 6e74 206f 7220   new element or 
-00009350: 6c69 7374 206f 6620 656c 656d 656e 7473  list of elements
-00009360: 2074 6f20 7468 6973 2043 6f6d 706f 6e65   to this Compone
-00009370: 6e74 2e0a 0a20 2020 2020 2020 2041 7267  nt...        Arg
-00009380: 733a 0a20 2020 2020 2020 2020 2020 2065  s:.            e
-00009390: 6c65 6d65 6e74 3a20 506f 6c79 676f 6e2c  lement: Polygon,
-000093a0: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
-000093b0: 6e63 6520 6f72 2069 7465 7261 626c 650a  nce or iterable.
-000093c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000093d0: 5468 6520 656c 656d 656e 7420 6f72 2069  The element or i
-000093e0: 7465 7261 626c 6520 6f66 2065 6c65 6d65  terable of eleme
-000093f0: 6e74 7320 746f 2062 6520 696e 7365 7274  nts to be insert
-00009400: 6564 2069 6e20 7468 6973 2063 656c 6c2e  ed in this cell.
-00009410: 0a0a 2020 2020 2020 2020 5261 6973 6573  ..        Raises
-00009420: 3a0a 2020 2020 2020 2020 2020 2020 4d75  :.            Mu
-00009430: 7461 6269 6c69 7479 4572 726f 723a 2069  tabilityError: i
-00009440: 6620 636f 6d70 6f6e 656e 7420 6973 206c  f component is l
-00009450: 6f63 6b65 642e 0a20 2020 2020 2020 2022  ocked..        "
-00009460: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-00009470: 6973 5f75 6e6c 6f63 6b65 6428 290a 2020  is_unlocked().  
-00009480: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00009490: 6e63 6528 656c 656d 656e 742c 2043 6f6d  nce(element, Com
-000094a0: 706f 6e65 6e74 5265 6665 7265 6e63 6529  ponentReference)
-000094b0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-000094c0: 6c66 2e5f 6365 6c6c 2e61 6464 2865 6c65  lf._cell.add(ele
-000094d0: 6d65 6e74 2e5f 7265 6665 7265 6e63 6529  ment._reference)
-000094e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000094f0: 662e 5f72 6566 6572 656e 6365 732e 6170  f._references.ap
-00009500: 7065 6e64 2865 6c65 6d65 6e74 290a 2020  pend(element).  
-00009510: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00009520: 2020 2020 2020 2020 7365 6c66 2e5f 6365          self._ce
-00009530: 6c6c 2e61 6464 2865 6c65 6d65 6e74 290a  ll.add(element).
-00009540: 0a20 2020 2064 6566 2061 6464 2873 656c  .    def add(sel
-00009550: 662c 2065 6c65 6d65 6e74 2920 2d3e 204e  f, element) -> N
-00009560: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00009570: 4164 6420 6120 6e65 7720 656c 656d 656e  Add a new elemen
-00009580: 7420 6f72 206c 6973 7420 6f66 2065 6c65  t or list of ele
-00009590: 6d65 6e74 7320 746f 2074 6869 7320 436f  ments to this Co
-000095a0: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
-000095b0: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-000095c0: 2020 2020 656c 656d 656e 743a 2050 6f6c      element: Pol
-000095d0: 7967 6f6e 2c20 436f 6d70 6f6e 656e 7452  ygon, ComponentR
-000095e0: 6566 6572 656e 6365 206f 7220 6974 6572  eference or iter
-000095f0: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
-00009600: 2020 2020 2054 6865 2065 6c65 6d65 6e74       The element
-00009610: 206f 7220 6974 6572 6162 6c65 206f 6620   or iterable of 
-00009620: 656c 656d 656e 7473 2074 6f20 6265 2069  elements to be i
-00009630: 6e73 6572 7465 6420 696e 2074 6869 7320  nserted in this 
-00009640: 6365 6c6c 2e0a 0a20 2020 2020 2020 2052  cell...        R
-00009650: 6169 7365 733a 0a20 2020 2020 2020 2020  aises:.         
-00009660: 2020 204d 7574 6162 696c 6974 7945 7272     MutabilityErr
-00009670: 6f72 3a20 6966 2063 6f6d 706f 6e65 6e74  or: if component
-00009680: 2069 7320 6c6f 636b 6564 2e0a 2020 2020   is locked..    
-00009690: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000096a0: 6966 2069 7369 6e73 7461 6e63 6528 656c  if isinstance(el
-000096b0: 656d 656e 742c 2043 6f6d 706f 6e65 6e74  ement, Component
-000096c0: 5265 6665 7265 6e63 6529 3a0a 2020 2020  Reference):.    
-000096d0: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
-000096e0: 6769 7374 6572 5f72 6566 6572 656e 6365  gister_reference
-000096f0: 2865 6c65 6d65 6e74 290a 2020 2020 2020  (element).      
-00009700: 2020 2020 2020 7365 6c66 2e5f 6164 6428        self._add(
-00009710: 656c 656d 656e 7429 0a20 2020 2020 2020  element).       
-00009720: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00009730: 2865 6c65 6d65 6e74 2c20 4974 6572 6162  (element, Iterab
-00009740: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
-00009750: 2066 6f72 2073 7562 656c 656d 656e 7420   for subelement 
-00009760: 696e 2065 6c65 6d65 6e74 3a0a 2020 2020  in element:.    
-00009770: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00009780: 2e61 6464 2873 7562 656c 656d 656e 7429  .add(subelement)
-00009790: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-000097a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000097b0: 5f61 6464 2865 6c65 6d65 6e74 290a 0a20  _add(element).. 
-000097c0: 2020 2064 6566 2061 6464 5f61 7272 6179     def add_array
-000097d0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-000097e0: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
-000097f0: 743a 2043 6f6d 706f 6e65 6e74 2c0a 2020  t: Component,.  
-00009800: 2020 2020 2020 636f 6c75 6d6e 733a 2069        columns: i
-00009810: 6e74 203d 2032 2c0a 2020 2020 2020 2020  nt = 2,.        
-00009820: 726f 7773 3a20 696e 7420 3d20 322c 0a20  rows: int = 2,. 
-00009830: 2020 2020 2020 2073 7061 6369 6e67 3a20         spacing: 
-00009840: 5475 706c 655b 666c 6f61 742c 2066 6c6f  Tuple[float, flo
-00009850: 6174 5d20 3d20 2831 3030 2c20 3130 3029  at] = (100, 100)
-00009860: 2c0a 2020 2020 2020 2020 616c 6961 733a  ,.        alias:
-00009870: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-00009880: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
-00009890: 436f 6d70 6f6e 656e 7452 6566 6572 656e  ComponentReferen
-000098a0: 6365 3a0a 2020 2020 2020 2020 2222 2243  ce:.        """C
-000098b0: 7265 6174 6573 2061 2043 6f6d 706f 6e65  reates a Compone
-000098c0: 6e74 5265 6665 7265 6e63 6520 7265 6665  ntReference refe
-000098d0: 7265 6e63 6520 746f 2061 2043 6f6d 706f  rence to a Compo
-000098e0: 6e65 6e74 2e0a 0a20 2020 2020 2020 2041  nent...        A
-000098f0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00009900: 2063 6f6d 706f 6e65 6e74 3a20 5468 6520   component: The 
-00009910: 7265 6665 7265 6e63 6564 2063 6f6d 706f  referenced compo
-00009920: 6e65 6e74 2e0a 2020 2020 2020 2020 2020  nent..          
-00009930: 2020 636f 6c75 6d6e 733a 204e 756d 6265    columns: Numbe
-00009940: 7220 6f66 2063 6f6c 756d 6e73 2069 6e20  r of columns in 
-00009950: 7468 6520 6172 7261 792e 0a20 2020 2020  the array..     
-00009960: 2020 2020 2020 2072 6f77 733a 204e 756d         rows: Num
-00009970: 6265 7220 6f66 2072 6f77 7320 696e 2074  ber of rows in t
-00009980: 6865 2061 7272 6179 2e0a 2020 2020 2020  he array..      
-00009990: 2020 2020 2020 7370 6163 696e 673a 2061        spacing: a
-000099a0: 7272 6179 2d6c 696b 655b 325d 206f 6620  rray-like[2] of 
-000099b0: 696e 7420 6f72 2066 6c6f 6174 2e0a 2020  int or float..  
-000099c0: 2020 2020 2020 2020 2020 2020 2020 4469                Di
-000099d0: 7374 616e 6365 2062 6574 7765 656e 2061  stance between a
-000099e0: 646a 6163 656e 7420 636f 6c75 6d6e 7320  djacent columns 
-000099f0: 616e 6420 6164 6a61 6365 6e74 2072 6f77  and adjacent row
-00009a00: 732e 0a20 2020 2020 2020 2020 2020 2061  s..            a
-00009a10: 6c69 6173 3a20 7374 7220 6f72 204e 6f6e  lias: str or Non
-00009a20: 652e 2041 6c69 6173 206f 6620 7468 6520  e. Alias of the 
-00009a30: 7265 6665 7265 6e63 6564 2043 6f6d 706f  referenced Compo
-00009a40: 6e65 6e74 2e0a 0a20 2020 2020 2020 2052  nent...        R
-00009a50: 6574 7572 6e73 0a20 2020 2020 2020 2020  eturns.         
-00009a60: 2020 2061 3a20 436f 6d70 6f6e 656e 7452     a: ComponentR
-00009a70: 6566 6572 656e 6365 2063 6f6e 7461 696e  eference contain
-00009a80: 696e 6720 7265 6665 7265 6e63 6573 2074  ing references t
-00009a90: 6f20 7468 6520 436f 6d70 6f6e 656e 742e  o the Component.
-00009aa0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00009ab0: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-00009ac0: 7374 616e 6365 2863 6f6d 706f 6e65 6e74  stance(component
-00009ad0: 2c20 436f 6d70 6f6e 656e 7429 3a0a 2020  , Component):.  
-00009ae0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00009af0: 5479 7065 4572 726f 7228 2261 6464 5f61  TypeError("add_a
-00009b00: 7272 6179 2829 206e 6565 6473 2061 2043  rray() needs a C
-00009b10: 6f6d 706f 6e65 6e74 206f 626a 6563 742e  omponent object.
-00009b20: 2229 0a20 2020 2020 2020 2072 6566 203d  ").        ref =
-00009b30: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
-00009b40: 6e63 6528 0a20 2020 2020 2020 2020 2020  nce(.           
-00009b50: 2063 6f6d 706f 6e65 6e74 3d63 6f6d 706f   component=compo
-00009b60: 6e65 6e74 2c0a 2020 2020 2020 2020 2020  nent,.          
-00009b70: 2020 636f 6c75 6d6e 733d 696e 7428 726f    columns=int(ro
-00009b80: 756e 6428 636f 6c75 6d6e 7329 292c 0a20  und(columns)),. 
-00009b90: 2020 2020 2020 2020 2020 2072 6f77 733d             rows=
-00009ba0: 696e 7428 726f 756e 6428 726f 7773 2929  int(round(rows))
-00009bb0: 2c0a 2020 2020 2020 2020 2020 2020 7370  ,.            sp
-00009bc0: 6163 696e 673d 7370 6163 696e 672c 0a20  acing=spacing,. 
-00009bd0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00009be0: 2072 6566 2e6e 616d 6520 3d20 4e6f 6e65   ref.name = None
-00009bf0: 0a20 2020 2020 2020 2073 656c 662e 5f61  .        self._a
-00009c00: 6464 2872 6566 290a 2020 2020 2020 2020  dd(ref).        
-00009c10: 7365 6c66 2e5f 7265 6769 7374 6572 5f72  self._register_r
-00009c20: 6566 6572 656e 6365 2872 6566 6572 656e  eference(referen
-00009c30: 6365 3d72 6566 2c20 616c 6961 733d 616c  ce=ref, alias=al
-00009c40: 6961 7329 0a20 2020 2020 2020 2072 6574  ias).        ret
-00009c50: 7572 6e20 7265 660a 0a20 2020 2064 6566  urn ref..    def
-00009c60: 2064 6973 7472 6962 7574 6528 0a20 2020   distribute(.   
-00009c70: 2020 2020 2073 656c 662c 2065 6c65 6d65       self, eleme
-00009c80: 6e74 733d 2261 6c6c 222c 2064 6972 6563  nts="all", direc
-00009c90: 7469 6f6e 3d22 7822 2c20 7370 6163 696e  tion="x", spacin
-00009ca0: 673d 3130 302c 2073 6570 6172 6174 696f  g=100, separatio
-00009cb0: 6e3d 5472 7565 2c20 6564 6765 3d22 6365  n=True, edge="ce
-00009cc0: 6e74 6572 220a 2020 2020 293a 0a20 2020  nter".    ):.   
-00009cd0: 2020 2020 2022 2222 4469 7374 7269 6275       """Distribu
-00009ce0: 7465 7320 7468 6520 7370 6563 6966 6965  tes the specifie
-00009cf0: 6420 656c 656d 656e 7473 2069 6e20 7468  d elements in th
-00009d00: 6520 436f 6d70 6f6e 656e 742e 0a0a 2020  e Component...  
-00009d10: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-00009d20: 2020 2020 2020 2020 656c 656d 656e 7473          elements
-00009d30: 203a 2061 7272 6179 2d6c 696b 6520 6f66   : array-like of
-00009d40: 206f 626a 6563 7473 206f 7220 2761 6c6c   objects or 'all
-00009d50: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00009d60: 2020 456c 656d 656e 7473 2074 6f20 6469    Elements to di
-00009d70: 7374 7269 6275 7465 2e0a 2020 2020 2020  stribute..      
-00009d80: 2020 2020 2020 6469 7265 6374 696f 6e20        direction 
-00009d90: 3a20 7b27 7827 2c20 2779 277d 0a20 2020  : {'x', 'y'}.   
-00009da0: 2020 2020 2020 2020 2020 2020 2044 6972               Dir
-00009db0: 6563 7469 6f6e 206f 6620 6469 7374 7269  ection of distri
-00009dc0: 6275 7469 6f6e 3b20 6569 7468 6572 2061  bution; either a
-00009dd0: 206c 696e 6520 696e 2074 6865 2078 2d64   line in the x-d
-00009de0: 6972 6563 7469 6f6e 206f 720a 2020 2020  irection or.    
-00009df0: 2020 2020 2020 2020 2020 2020 792d 6469              y-di
-00009e00: 7265 6374 696f 6e2e 0a20 2020 2020 2020  rection..       
-00009e10: 2020 2020 2073 7061 6369 6e67 203a 2069       spacing : i
-00009e20: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
-00009e30: 2020 2020 2020 2020 2020 2020 4469 7374              Dist
-00009e40: 616e 6365 2062 6574 7765 656e 2065 6c65  ance between ele
-00009e50: 6d65 6e74 732e 0a20 2020 2020 2020 2020  ments..         
-00009e60: 2020 2073 6570 6172 6174 696f 6e20 3a20     separation : 
-00009e70: 626f 6f6c 0a20 2020 2020 2020 2020 2020  bool.           
-00009e80: 2020 2020 2049 6620 5472 7565 2c20 6775       If True, gu
-00009e90: 6172 616e 7465 6573 2065 6c65 6d65 6e74  arantees element
-00009ea0: 7320 6172 6520 7365 7061 7261 7465 6420  s are separated 
-00009eb0: 7769 7468 2061 2066 6978 6564 2073 7061  with a fixed spa
-00009ec0: 6369 6e67 0a20 2020 2020 2020 2020 2020  cing.           
-00009ed0: 2020 2020 2062 6574 7765 656e 3b20 6966       between; if
-00009ee0: 2020 4661 6c73 652c 2065 6c65 6d65 6e74    False, element
-00009ef0: 7320 6172 6520 7370 6163 6564 2065 7665  s are spaced eve
-00009f00: 6e6c 7920 616c 6f6e 6720 6120 6772 6964  nly along a grid
-00009f10: 2e0a 2020 2020 2020 2020 2020 2020 6564  ..            ed
-00009f20: 6765 203a 207b 2778 272c 2027 786d 696e  ge : {'x', 'xmin
-00009f30: 272c 2027 786d 6178 272c 2027 7927 2c20  ', 'xmax', 'y', 
-00009f40: 2779 6d69 6e27 2c20 2779 6d61 7827 7d0a  'ymin', 'ymax'}.
-00009f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f60: 5768 6963 6820 6564 6765 2074 6f20 7065  Which edge to pe
-00009f70: 7266 6f72 6d20 7468 6520 6469 7374 7269  rform the distri
-00009f80: 6275 7469 6f6e 2061 6c6f 6e67 2028 756e  bution along (un
-00009f90: 7573 6564 2069 660a 2020 2020 2020 2020  used if.        
-00009fa0: 2020 2020 2020 2020 7365 7061 7261 7469          separati
-00009fb0: 6f6e 203d 3d20 5472 7565 290a 0a20 2020  on == True)..   
-00009fc0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00009fd0: 2069 6620 656c 656d 656e 7473 203d 3d20   if elements == 
-00009fe0: 2261 6c6c 223a 0a20 2020 2020 2020 2020  "all":.         
-00009ff0: 2020 2065 6c65 6d65 6e74 7320 3d20 7365     elements = se
-0000a000: 6c66 2e70 6f6c 7967 6f6e 7320 2b20 7365  lf.polygons + se
-0000a010: 6c66 2e72 6566 6572 656e 6365 730a 2020  lf.references.  
-0000a020: 2020 2020 2020 5f64 6973 7472 6962 7574        _distribut
-0000a030: 6528 0a20 2020 2020 2020 2020 2020 2065  e(.            e
-0000a040: 6c65 6d65 6e74 733d 656c 656d 656e 7473  lements=elements
-0000a050: 2c0a 2020 2020 2020 2020 2020 2020 6469  ,.            di
-0000a060: 7265 6374 696f 6e3d 6469 7265 6374 696f  rection=directio
-0000a070: 6e2c 0a20 2020 2020 2020 2020 2020 2073  n,.            s
-0000a080: 7061 6369 6e67 3d73 7061 6369 6e67 2c0a  pacing=spacing,.
-0000a090: 2020 2020 2020 2020 2020 2020 7365 7061              sepa
-0000a0a0: 7261 7469 6f6e 3d73 6570 6172 6174 696f  ration=separatio
-0000a0b0: 6e2c 0a20 2020 2020 2020 2020 2020 2065  n,.            e
-0000a0c0: 6467 653d 6564 6765 2c0a 2020 2020 2020  dge=edge,.      
-0000a0d0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
-0000a0e0: 726e 2073 656c 660a 0a20 2020 2064 6566  rn self..    def
-0000a0f0: 2061 6c69 676e 2873 656c 662c 2065 6c65   align(self, ele
-0000a100: 6d65 6e74 733d 2261 6c6c 222c 2061 6c69  ments="all", ali
-0000a110: 676e 6d65 6e74 3d22 796d 6178 2229 3a0a  gnment="ymax"):.
-0000a120: 2020 2020 2020 2020 2222 2241 6c69 676e          """Align
-0000a130: 2065 6c65 6d65 6e74 7320 696e 2074 6865   elements in the
-0000a140: 2043 6f6d 706f 6e65 6e74 2e0a 0a20 2020   Component...   
-0000a150: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-0000a160: 2020 2020 2020 2065 6c65 6d65 6e74 7320         elements 
-0000a170: 3a20 6172 7261 792d 6c69 6b65 206f 6620  : array-like of 
-0000a180: 6f62 6a65 6374 732c 206f 7220 2761 6c6c  objects, or 'all
-0000a190: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0000a1a0: 2020 456c 656d 656e 7473 2069 6e20 7468    Elements in th
-0000a1b0: 6520 436f 6d70 6f6e 656e 7420 746f 2061  e Component to a
-0000a1c0: 6c69 676e 2e0a 2020 2020 2020 2020 2020  lign..          
-0000a1d0: 2020 616c 6967 6e6d 656e 7420 3a20 7b27    alignment : {'
-0000a1e0: 7827 2c20 2779 272c 2027 786d 696e 272c  x', 'y', 'xmin',
-0000a1f0: 2027 786d 6178 272c 2027 796d 696e 272c   'xmax', 'ymin',
-0000a200: 2027 796d 6178 277d 0a20 2020 2020 2020   'ymax'}.       
-0000a210: 2020 2020 2020 2020 2057 6869 6368 2065           Which e
-0000a220: 6467 6520 746f 2061 6c69 676e 2061 6c6f  dge to align alo
-0000a230: 6e67 2028 652e 672e 2027 796d 6178 2720  ng (e.g. 'ymax' 
-0000a240: 7769 6c6c 206d 6f76 6520 7468 6520 656c  will move the el
-0000a250: 656d 656e 7473 2073 7563 680a 2020 2020  ements such.    
-0000a260: 2020 2020 2020 2020 2020 2020 7468 6174              that
-0000a270: 2061 6c6c 206f 6620 7468 6569 7220 746f   all of their to
-0000a280: 706d 6f73 7420 706f 696e 7473 2061 7265  pmost points are
-0000a290: 2061 6c69 676e 6564 292e 0a20 2020 2020   aligned)..     
-0000a2a0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0000a2b0: 6620 656c 656d 656e 7473 203d 3d20 2261  f elements == "a
-0000a2c0: 6c6c 223a 0a20 2020 2020 2020 2020 2020  ll":.           
-0000a2d0: 2065 6c65 6d65 6e74 7320 3d20 7365 6c66   elements = self
-0000a2e0: 2e70 6f6c 7967 6f6e 7320 2b20 7365 6c66  .polygons + self
-0000a2f0: 2e72 6566 6572 656e 6365 730a 2020 2020  .references.    
-0000a300: 2020 2020 5f61 6c69 676e 2865 6c65 6d65      _align(eleme
-0000a310: 6e74 732c 2061 6c69 676e 6d65 6e74 3d61  nts, alignment=a
-0000a320: 6c69 676e 6d65 6e74 290a 2020 2020 2020  lignment).      
-0000a330: 2020 7265 7475 726e 2073 656c 660a 0a20    return self.. 
-0000a340: 2020 2064 6566 2066 6c61 7474 656e 2873     def flatten(s
-0000a350: 656c 662c 2073 696e 676c 655f 6c61 7965  elf, single_laye
-0000a360: 723a 204f 7074 696f 6e61 6c5b 4c61 7965  r: Optional[Laye
-0000a370: 7253 7065 635d 203d 204e 6f6e 6529 3a0a  rSpec] = None):.
-0000a380: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-0000a390: 6e73 2061 2066 6c61 7474 656e 6564 2063  ns a flattened c
-0000a3a0: 6f70 7920 6f66 2074 6865 2063 6f6d 706f  opy of the compo
-0000a3b0: 6e65 6e74 2e0a 0a20 2020 2020 2020 2046  nent...        F
-0000a3c0: 6c61 7474 656e 7320 7468 6520 6869 6572  lattens the hier
-0000a3d0: 6172 6368 7920 6f66 2074 6865 2043 6f6d  archy of the Com
-0000a3e0: 706f 6e65 6e74 2073 7563 6820 7468 6174  ponent such that
-0000a3f0: 2074 6865 7265 2061 7265 206e 6f20 6c6f   there are no lo
-0000a400: 6e67 6572 0a20 2020 2020 2020 2061 6e79  nger.        any
-0000a410: 2072 6566 6572 656e 6365 7320 746f 206f   references to o
-0000a420: 7468 6572 2043 6f6d 706f 6e65 6e74 732e  ther Components.
-0000a430: 2041 6c6c 2070 6f6c 7967 6f6e 7320 616e   All polygons an
-0000a440: 6420 6c61 6265 6c73 2066 726f 6d0a 2020  d labels from.  
-0000a450: 2020 2020 2020 756e 6465 726c 7969 6e67        underlying
-0000a460: 2072 6566 6572 656e 6365 7320 6172 6520   references are 
-0000a470: 636f 7069 6564 2061 6e64 2070 6c61 6365  copied and place
-0000a480: 6420 696e 2074 6865 2074 6f70 2d6c 6576  d in the top-lev
-0000a490: 656c 2043 6f6d 706f 6e65 6e74 2e0a 2020  el Component..  
-0000a4a0: 2020 2020 2020 4966 2073 696e 676c 655f        If single_
-0000a4b0: 6c61 7965 7220 6973 2073 7065 6369 6669  layer is specifi
-0000a4c0: 6564 2c20 616c 6c20 706f 6c79 676f 6e73  ed, all polygons
-0000a4d0: 2061 7265 206d 6f76 6564 2074 6f20 7468   are moved to th
-0000a4e0: 6174 206c 6179 6572 2e0a 0a20 2020 2020  at layer...     
-0000a4f0: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-0000a500: 2020 2020 2073 696e 676c 655f 6c61 7965       single_laye
-0000a510: 723a 206d 6f76 6520 616c 6c20 706f 6c79  r: move all poly
-0000a520: 676f 6e73 2061 7265 206d 6f76 6564 2074  gons are moved t
-0000a530: 6f20 7468 6520 7370 6563 6966 6965 6420  o the specified 
-0000a540: 286f 7074 696f 6e61 6c29 2e0a 2020 2020  (optional)..    
-0000a550: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000a560: 636f 6d70 6f6e 656e 745f 666c 6174 203d  component_flat =
-0000a570: 2043 6f6d 706f 6e65 6e74 2829 0a0a 2020   Component()..  
-0000a580: 2020 2020 2020 5f63 656c 6c20 3d20 7365        _cell = se
-0000a590: 6c66 2e5f 6365 6c6c 2e63 6f70 7928 6e61  lf._cell.copy(na
-0000a5a0: 6d65 3d63 6f6d 706f 6e65 6e74 5f66 6c61  me=component_fla
-0000a5b0: 742e 6e61 6d65 290a 2020 2020 2020 2020  t.name).        
-0000a5c0: 5f63 656c 6c20 3d20 5f63 656c 6c2e 666c  _cell = _cell.fl
-0000a5d0: 6174 7465 6e28 290a 2020 2020 2020 2020  atten().        
-0000a5e0: 636f 6d70 6f6e 656e 745f 666c 6174 2e5f  component_flat._
-0000a5f0: 6365 6c6c 203d 205f 6365 6c6c 0a20 2020  cell = _cell.   
-0000a600: 2020 2020 2069 6620 7369 6e67 6c65 5f6c       if single_l
-0000a610: 6179 6572 2069 7320 6e6f 7420 4e6f 6e65  ayer is not None
-0000a620: 3a0a 2020 2020 2020 2020 2020 2020 6672  :.            fr
-0000a630: 6f6d 2067 6473 6661 6374 6f72 7920 696d  om gdsfactory im
-0000a640: 706f 7274 2067 6574 5f6c 6179 6572 0a0a  port get_layer..
-0000a650: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-0000a660: 722c 2064 6174 6174 7970 6520 3d20 6765  r, datatype = ge
-0000a670: 745f 6c61 7965 7228 7369 6e67 6c65 5f6c  t_layer(single_l
-0000a680: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
-0000a690: 2020 666f 7220 706f 6c79 676f 6e20 696e    for polygon in
-0000a6a0: 205f 6365 6c6c 2e70 6f6c 7967 6f6e 733a   _cell.polygons:
-0000a6b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a6c0: 2070 6f6c 7967 6f6e 2e6c 6179 6572 203d   polygon.layer =
-0000a6d0: 206c 6179 6572 0a20 2020 2020 2020 2020   layer.         
-0000a6e0: 2020 2020 2020 2070 6f6c 7967 6f6e 2e64         polygon.d
-0000a6f0: 6174 6174 7970 6520 3d20 6461 7461 7479  atatype = dataty
-0000a700: 7065 0a20 2020 2020 2020 2020 2020 2066  pe.            f
-0000a710: 6f72 2070 6174 6820 696e 205f 6365 6c6c  or path in _cell
-0000a720: 2e70 6174 6873 3a0a 2020 2020 2020 2020  .paths:.        
-0000a730: 2020 2020 2020 2020 7061 7468 2e73 6574          path.set
-0000a740: 5f6c 6179 6572 7328 6c61 7965 7229 0a20  _layers(layer). 
-0000a750: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000a760: 6174 682e 7365 745f 6461 7461 7479 7065  ath.set_datatype
-0000a770: 7328 6461 7461 7479 7065 290a 0a20 2020  s(datatype)..   
-0000a780: 2020 2020 2063 6f6d 706f 6e65 6e74 5f66       component_f
-0000a790: 6c61 742e 696e 666f 203d 2073 656c 662e  lat.info = self.
-0000a7a0: 696e 666f 2e63 6f70 7928 290a 2020 2020  info.copy().    
-0000a7b0: 2020 2020 636f 6d70 6f6e 656e 745f 666c      component_fl
-0000a7c0: 6174 2e61 6464 5f70 6f72 7473 2873 656c  at.add_ports(sel
-0000a7d0: 662e 706f 7274 7329 0a20 2020 2020 2020  f.ports).       
-0000a7e0: 2072 6574 7572 6e20 636f 6d70 6f6e 656e   return componen
-0000a7f0: 745f 666c 6174 0a0a 2020 2020 6465 6620  t_flat..    def 
-0000a800: 666c 6174 7465 6e5f 7265 6665 7265 6e63  flatten_referenc
-0000a810: 6528 7365 6c66 2c20 7265 663a 2043 6f6d  e(self, ref: Com
-0000a820: 706f 6e65 6e74 5265 6665 7265 6e63 6529  ponentReference)
-0000a830: 3a0a 2020 2020 2020 2020 2222 2246 726f  :.        """Fro
-0000a840: 6d20 6578 6973 7469 6e67 2063 656c 6c20  m existing cell 
-0000a850: 7265 706c 6163 6573 2072 6566 6572 656e  replaces referen
-0000a860: 6365 2077 6974 6820 6120 666c 6174 7465  ce with a flatte
-0000a870: 6e20 7265 6665 7265 6e63 6520 5c0a 2020  n reference \.  
-0000a880: 2020 2020 2020 7768 6963 6820 6861 7320        which has 
-0000a890: 7468 6520 7472 616e 7366 6f72 6d61 7469  the transformati
-0000a8a0: 6f6e 7320 616c 7265 6164 7920 6170 706c  ons already appl
-0000a8b0: 6965 642e 0a0a 2020 2020 2020 2020 5472  ied...        Tr
-0000a8c0: 616e 7366 6f72 6d65 6420 7265 6665 7265  ansformed refere
-0000a8d0: 6e63 6520 6b65 6570 7320 7468 6520 6f72  nce keeps the or
-0000a8e0: 6967 696e 616c 206e 616d 652e 0a0a 2020  iginal name...  
-0000a8f0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-0000a900: 2020 2020 2020 2020 7265 663a 2074 6865          ref: the
-0000a910: 2072 6566 6572 656e 6365 2074 6f20 666c   reference to fl
-0000a920: 6174 7465 6e20 696e 746f 2061 206e 6577  atten into a new
-0000a930: 2063 656c 6c2e 0a0a 2020 2020 2020 2020   cell...        
-0000a940: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
-0000a950: 2067 6473 6661 6374 6f72 792e 6675 6e63   gdsfactory.func
-0000a960: 7469 6f6e 7320 696d 706f 7274 2074 7261  tions import tra
-0000a970: 6e73 666f 726d 6564 0a0a 2020 2020 2020  nsformed..      
-0000a980: 2020 7365 6c66 2e72 656d 6f76 6528 7265    self.remove(re
-0000a990: 6629 0a20 2020 2020 2020 206e 6577 5f63  f).        new_c
-0000a9a0: 6f6d 706f 6e65 6e74 203d 2074 7261 6e73  omponent = trans
-0000a9b0: 666f 726d 6564 2872 6566 2c20 6465 636f  formed(ref, deco
-0000a9c0: 7261 746f 723d 4e6f 6e65 290a 2020 2020  rator=None).    
-0000a9d0: 2020 2020 7365 6c66 2e61 6464 5f72 6566      self.add_ref
-0000a9e0: 286e 6577 5f63 6f6d 706f 6e65 6e74 2c20  (new_component, 
-0000a9f0: 616c 6961 733d 7265 662e 6e61 6d65 290a  alias=ref.name).
-0000aa00: 0a20 2020 2064 6566 2061 6464 5f72 6566  .    def add_ref
-0000aa10: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
-0000aa20: 636f 6d70 6f6e 656e 743a 2043 6f6d 706f  component: Compo
-0000aa30: 6e65 6e74 2c20 616c 6961 733a 204f 7074  nent, alias: Opt
-0000aa40: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-0000aa50: 652c 202a 2a6b 7761 7267 730a 2020 2020  e, **kwargs.    
-0000aa60: 2920 2d3e 2043 6f6d 706f 6e65 6e74 5265  ) -> ComponentRe
-0000aa70: 6665 7265 6e63 653a 0a20 2020 2020 2020  ference:.       
-0000aa80: 2022 2222 4164 6420 436f 6d70 6f6e 656e   """Add Componen
-0000aa90: 7452 6566 6572 656e 6365 2074 6f20 7468  tReference to th
-0000aaa0: 6520 6375 7272 656e 7420 436f 6d70 6f6e  e current Compon
-0000aab0: 656e 742e 0a0a 2020 2020 2020 2020 4172  ent...        Ar
-0000aac0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-0000aad0: 636f 6d70 6f6e 656e 743a 2043 6f6d 706f  component: Compo
-0000aae0: 6e65 6e74 2e0a 2020 2020 2020 2020 2020  nent..          
-0000aaf0: 2020 616c 6961 733a 206e 616d 6564 5f72    alias: named_r
-0000ab00: 6566 6572 656e 6365 732e 0a0a 2020 2020  eferences...    
-0000ab10: 2020 2020 4b65 7977 6f72 6420 4172 6773      Keyword Args
-0000ab20: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-0000ab30: 6c75 6d6e 733a 204e 756d 6265 7220 6f66  lumns: Number of
-0000ab40: 2063 6f6c 756d 6e73 2069 6e20 7468 6520   columns in the 
-0000ab50: 6172 7261 792e 0a20 2020 2020 2020 2020  array..         
-0000ab60: 2020 2072 6f77 733a 204e 756d 6265 7220     rows: Number 
-0000ab70: 6f66 2072 6f77 7320 696e 2074 6865 2061  of rows in the a
-0000ab80: 7272 6179 2e0a 2020 2020 2020 2020 2020  rray..          
-0000ab90: 2020 7370 6163 696e 673a 2044 6973 7461    spacing: Dista
-0000aba0: 6e63 6573 2062 6574 7765 656e 2061 646a  nces between adj
-0000abb0: 6163 656e 7420 636f 6c75 6d6e 7320 616e  acent columns an
-0000abc0: 6420 6164 6a61 6365 6e74 2072 6f77 732e  d adjacent rows.
-0000abd0: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
-0000abe0: 6769 6e3a 2061 7272 6179 2d6c 696b 655b  gin: array-like[
-0000abf0: 325d 206f 6620 696e 7420 6f72 2066 6c6f  2] of int or flo
-0000ac00: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
-0000ac10: 2020 2050 6f73 6974 696f 6e20 7768 6572     Position wher
-0000ac20: 6520 7468 6520 6365 6c6c 2069 7320 696e  e the cell is in
-0000ac30: 7365 7274 6564 2e0a 2020 2020 2020 2020  serted..        
-0000ac40: 2020 2020 726f 7461 7469 6f6e 203a 2069      rotation : i
-0000ac50: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
-0000ac60: 2020 2020 2020 2020 2020 2020 416e 676c              Angl
-0000ac70: 6520 6f66 2072 6f74 6174 696f 6e20 6f66  e of rotation of
-0000ac80: 2074 6865 2072 6566 6572 656e 6365 2028   the reference (
-0000ac90: 696e 2060 6465 6772 6565 7360 292e 0a20  in `degrees`).. 
-0000aca0: 2020 2020 2020 2020 2020 206d 6167 6e69             magni
-0000acb0: 6669 6361 7469 6f6e 203a 2069 6e74 206f  fication : int o
-0000acc0: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
-0000acd0: 2020 2020 2020 2020 4d61 676e 6966 6963          Magnific
-0000ace0: 6174 696f 6e20 6661 6374 6f72 2066 6f72  ation factor for
-0000acf0: 2074 6865 2072 6566 6572 656e 6365 2e0a   the reference..
-0000ad00: 2020 2020 2020 2020 2020 2020 785f 7265              x_re
-0000ad10: 666c 6563 7469 6f6e 203a 2062 6f6f 6c0a  flection : bool.
-0000ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad30: 4966 2054 7275 652c 2074 6865 2072 6566  If True, the ref
-0000ad40: 6572 656e 6365 2069 7320 7265 666c 6563  erence is reflec
-0000ad50: 7465 6420 7061 7261 6c6c 656c 2074 6f20  ted parallel to 
-0000ad60: 7468 6520 7820 6469 7265 6374 696f 6e0a  the x direction.
-0000ad70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad80: 6265 666f 7265 2062 6569 6e67 2072 6f74  before being rot
-0000ad90: 6174 6564 2e0a 2020 2020 2020 2020 2020  ated..          
-0000ada0: 2020 6e61 6d65 203a 2073 7472 2028 6f70    name : str (op
-0000adb0: 7469 6f6e 616c 290a 2020 2020 2020 2020  tional).        
-0000adc0: 2020 2020 2020 2020 4120 6e61 6d65 2066          A name f
-0000add0: 6f72 2074 6865 2072 6566 6572 656e 6365  or the reference
-0000ade0: 2028 6966 2070 726f 7669 6465 6429 2e0a   (if provided)..
-0000adf0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000ae00: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-0000ae10: 7374 616e 6365 2863 6f6d 706f 6e65 6e74  stance(component
-0000ae20: 2c20 436f 6d70 6f6e 656e 7429 3a0a 2020  , Component):.  
-0000ae30: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000ae40: 5479 7065 4572 726f 7228 6622 7479 7065  TypeError(f"type
-0000ae50: 203d 207b 7479 7065 2843 6f6d 706f 6e65   = {type(Compone
-0000ae60: 6e74 297d 206e 6565 6473 2074 6f20 6265  nt)} needs to be
-0000ae70: 2061 2043 6f6d 706f 6e65 6e74 2e22 290a   a Component.").
-0000ae80: 2020 2020 2020 2020 7265 6620 3d20 436f          ref = Co
-0000ae90: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
-0000aea0: 2863 6f6d 706f 6e65 6e74 2c20 2a2a 6b77  (component, **kw
-0000aeb0: 6172 6773 290a 2020 2020 2020 2020 7365  args).        se
-0000aec0: 6c66 2e5f 6164 6428 7265 6629 0a20 2020  lf._add(ref).   
-0000aed0: 2020 2020 2073 656c 662e 5f72 6567 6973       self._regis
-0000aee0: 7465 725f 7265 6665 7265 6e63 6528 7265  ter_reference(re
-0000aef0: 6665 7265 6e63 653d 7265 662c 2061 6c69  ference=ref, ali
-0000af00: 6173 3d61 6c69 6173 290a 2020 2020 2020  as=alias).      
-0000af10: 2020 7265 7475 726e 2072 6566 0a0a 2020    return ref..  
-0000af20: 2020 6465 6620 5f72 6567 6973 7465 725f    def _register_
-0000af30: 7265 6665 7265 6e63 6528 0a20 2020 2020  reference(.     
-0000af40: 2020 2073 656c 662c 2072 6566 6572 656e     self, referen
-0000af50: 6365 3a20 436f 6d70 6f6e 656e 7452 6566  ce: ComponentRef
-0000af60: 6572 656e 6365 2c20 616c 6961 733a 204f  erence, alias: O
-0000af70: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-0000af80: 6f6e 650a 2020 2020 2920 2d3e 204e 6f6e  one.    ) -> Non
-0000af90: 653a 0a20 2020 2020 2020 2063 6f6d 706f  e:.        compo
-0000afa0: 6e65 6e74 203d 2072 6566 6572 656e 6365  nent = reference
-0000afb0: 2e70 6172 656e 740a 2020 2020 2020 2020  .parent.        
-0000afc0: 7265 6665 7265 6e63 652e 6f77 6e65 7220  reference.owner 
-0000afd0: 3d20 7365 6c66 0a0a 2020 2020 2020 2020  = self..        
-0000afe0: 6966 2061 6c69 6173 2069 7320 4e6f 6e65  if alias is None
-0000aff0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0000b000: 2072 6566 6572 656e 6365 2e6e 616d 6520   reference.name 
-0000b010: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000b020: 2020 2020 2020 2020 2020 2020 2061 6c69               ali
-0000b030: 6173 203d 2072 6566 6572 656e 6365 2e6e  as = reference.n
-0000b040: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-0000b050: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000b060: 2020 2020 2020 7072 6566 6978 203d 2028        prefix = (
-0000b070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b080: 2020 2020 2063 6f6d 706f 6e65 6e74 2e73       component.s
-0000b090: 6574 7469 6e67 732e 6675 6e63 7469 6f6e  ettings.function
-0000b0a0: 5f6e 616d 650a 2020 2020 2020 2020 2020  _name.          
-0000b0b0: 2020 2020 2020 2020 2020 6966 2068 6173            if has
-0000b0c0: 6174 7472 2863 6f6d 706f 6e65 6e74 2c20  attr(component, 
-0000b0d0: 2273 6574 7469 6e67 7322 290a 2020 2020  "settings").    
-0000b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0f0: 616e 6420 6861 7361 7474 7228 636f 6d70  and hasattr(comp
-0000b100: 6f6e 656e 742e 7365 7474 696e 6773 2c20  onent.settings, 
-0000b110: 2266 756e 6374 696f 6e5f 6e61 6d65 2229  "function_name")
-0000b120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b130: 2020 2020 2065 6c73 6520 636f 6d70 6f6e       else compon
-0000b140: 656e 742e 6e61 6d65 0a20 2020 2020 2020  ent.name.       
-0000b150: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000b160: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b170: 5f72 6566 6572 656e 6365 5f6e 616d 6573  _reference_names
-0000b180: 5f63 6f75 6e74 6572 2e75 7064 6174 6528  _counter.update(
-0000b190: 7b70 7265 6669 783a 2031 7d29 0a20 2020  {prefix: 1}).   
-0000b1a0: 2020 2020 2020 2020 2020 2020 2061 6c69               ali
-0000b1b0: 6173 203d 2066 227b 7072 6566 6978 7d5f  as = f"{prefix}_
-0000b1c0: 7b73 656c 662e 5f72 6566 6572 656e 6365  {self._reference
-0000b1d0: 5f6e 616d 6573 5f63 6f75 6e74 6572 5b70  _names_counter[p
-0000b1e0: 7265 6669 785d 7d22 0a0a 2020 2020 2020  refix]}"..      
-0000b1f0: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-0000b200: 616c 6961 7320 696e 2073 656c 662e 5f6e  alias in self._n
-0000b210: 616d 6564 5f72 6566 6572 656e 6365 733a  amed_references:
-0000b220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b230: 2020 2020 2073 656c 662e 5f72 6566 6572       self._refer
-0000b240: 656e 6365 5f6e 616d 6573 5f63 6f75 6e74  ence_names_count
-0000b250: 6572 2e75 7064 6174 6528 7b70 7265 6669  er.update({prefi
-0000b260: 783a 2031 7d29 0a20 2020 2020 2020 2020  x: 1}).         
-0000b270: 2020 2020 2020 2020 2020 2061 6c69 6173             alias
-0000b280: 203d 2066 227b 7072 6566 6978 7d5f 7b73   = f"{prefix}_{s
-0000b290: 656c 662e 5f72 6566 6572 656e 6365 5f6e  elf._reference_n
-0000b2a0: 616d 6573 5f63 6f75 6e74 6572 5b70 7265  ames_counter[pre
-0000b2b0: 6669 785d 7d22 0a0a 2020 2020 2020 2020  fix]}"..        
-0000b2c0: 7265 6665 7265 6e63 652e 6e61 6d65 203d  reference.name =
-0000b2d0: 2061 6c69 6173 0a20 2020 2020 2020 2073   alias.        s
-0000b2e0: 656c 662e 5f6e 616d 6564 5f72 6566 6572  elf._named_refer
-0000b2f0: 656e 6365 735b 616c 6961 735d 203d 2072  ences[alias] = r
-0000b300: 6566 6572 656e 6365 0a0a 2020 2020 4070  eference..    @p
-0000b310: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-0000b320: 6c61 7965 7273 2873 656c 6629 202d 3e20  layers(self) -> 
-0000b330: 5365 745b 5475 706c 655b 696e 742c 2069  Set[Tuple[int, i
-0000b340: 6e74 5d5d 3a0a 2020 2020 2020 2020 2222  nt]]:.        ""
-0000b350: 2252 6574 7572 6e73 2061 2073 6574 206f  "Returns a set o
-0000b360: 6620 7468 6520 4c61 7965 7273 2069 6e20  f the Layers in 
-0000b370: 7468 6520 436f 6d70 6f6e 656e 742e 2222  the Component.""
-0000b380: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-0000b390: 2073 656c 662e 6765 745f 6c61 7965 7273   self.get_layers
-0000b3a0: 2829 0a0a 2020 2020 6465 6620 6765 745f  ()..    def get_
-0000b3b0: 6c61 7965 7273 2873 656c 6629 202d 3e20  layers(self) -> 
-0000b3c0: 5365 745b 5475 706c 655b 696e 742c 2069  Set[Tuple[int, i
-0000b3d0: 6e74 5d5d 3a0a 2020 2020 2020 2020 2222  nt]]:.        ""
-0000b3e0: 2252 6574 7572 6e20 6120 7365 7420 6f66  "Return a set of
-0000b3f0: 2028 6c61 7965 722c 2064 6174 6174 7970   (layer, datatyp
-0000b400: 6529 2e0a 0a20 2020 2020 2020 202e 2e20  e)...        .. 
-0000b410: 636f 6465 203a 3a0a 0a20 2020 2020 2020  code ::..       
-0000b420: 2020 2020 2069 6d70 6f72 7420 6764 7366       import gdsf
-0000b430: 6163 746f 7279 2061 7320 6766 0a20 2020  actory as gf.   
-0000b440: 2020 2020 2020 2020 2067 662e 636f 6d70           gf.comp
-0000b450: 6f6e 656e 7473 2e73 7472 6169 6768 7428  onents.straight(
-0000b460: 292e 6765 745f 6c61 7965 7273 2829 203d  ).get_layers() =
-0000b470: 3d20 7b28 312c 2030 292c 2028 3131 312c  = {(1, 0), (111,
-0000b480: 2030 297d 0a20 2020 2020 2020 2022 2222   0)}.        """
-0000b490: 0a20 2020 2020 2020 2070 6f6c 7967 6f6e  .        polygon
-0000b4a0: 7320 3d20 7365 6c66 2e5f 6365 6c6c 2e67  s = self._cell.g
-0000b4b0: 6574 5f70 6f6c 7967 6f6e 7328 6465 7074  et_polygons(dept
-0000b4c0: 683d 4e6f 6e65 290a 2020 2020 2020 2020  h=None).        
-0000b4d0: 7265 7475 726e 207b 2870 6f6c 7967 6f6e  return {(polygon
-0000b4e0: 2e6c 6179 6572 2c20 706f 6c79 676f 6e2e  .layer, polygon.
-0000b4f0: 6461 7461 7479 7065 2920 666f 7220 706f  datatype) for po
-0000b500: 6c79 676f 6e20 696e 2070 6f6c 7967 6f6e  lygon in polygon
-0000b510: 737d 0a0a 2020 2020 6465 6620 6765 745f  s}..    def get_
-0000b520: 6c61 7965 725f 6e61 6d65 7328 7365 6c66  layer_names(self
-0000b530: 2920 2d3e 204c 6973 745b 5475 706c 655b  ) -> List[Tuple[
-0000b540: 696e 742c 2069 6e74 5d5d 3a0a 2020 2020  int, int]]:.    
-0000b550: 2020 2020 2222 2252 6574 7572 6e20 6c61      """Return la
-0000b560: 7965 7220 6e61 6d65 7320 7573 6564 2069  yer names used i
-0000b570: 6e20 7468 6520 6465 7369 676e 2e0a 0a20  n the design... 
-0000b580: 2020 2020 2020 202e 2e20 636f 6465 203a         .. code :
-0000b590: 3a0a 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0000b5a0: 6d70 6f72 7420 6764 7366 6163 746f 7279  mport gdsfactory
-0000b5b0: 2061 7320 6766 0a20 2020 2020 2020 2020   as gf.         
-0000b5c0: 2020 2067 662e 636f 6d70 6f6e 656e 7473     gf.components
-0000b5d0: 2e73 7472 6169 6768 7428 292e 6765 745f  .straight().get_
-0000b5e0: 6e61 6d65 7328 2920 3d3d 205b 2757 4727  names() == ['WG'
-0000b5f0: 5d0a 2020 2020 2020 2020 2222 220a 2020  ].        """.  
-0000b600: 2020 2020 2020 696d 706f 7274 2067 6473        import gds
-0000b610: 6661 6374 6f72 7920 6173 2067 660a 0a20  factory as gf.. 
-0000b620: 2020 2020 2020 2050 444b 203d 2067 662e         PDK = gf.
-0000b630: 6765 745f 6163 7469 7665 5f70 646b 2829  get_active_pdk()
-0000b640: 0a20 2020 2020 2020 204c 4159 4552 5320  .        LAYERS 
-0000b650: 3d20 5044 4b2e 6c61 7965 7273 0a20 2020  = PDK.layers.   
-0000b660: 2020 2020 206e 616d 655f 746f 5f6c 6179       name_to_lay
-0000b670: 6572 203d 2064 6963 7428 4c41 5945 5253  er = dict(LAYERS
-0000b680: 290a 2020 2020 2020 2020 6c61 7965 725f  ).        layer_
-0000b690: 746f 5f6e 616d 6520 3d20 7b76 3a20 6b20  to_name = {v: k 
-0000b6a0: 666f 7220 6b2c 2076 2069 6e20 6e61 6d65  for k, v in name
-0000b6b0: 5f74 6f5f 6c61 7965 722e 6974 656d 7328  _to_layer.items(
-0000b6c0: 297d 0a20 2020 2020 2020 206c 6179 6572  )}.        layer
-0000b6d0: 5f6e 616d 6573 203d 205b 5d0a 0a20 2020  _names = []..   
-0000b6e0: 2020 2020 2066 6f72 206c 6179 6572 2069       for layer i
-0000b6f0: 6e20 7365 6c66 2e6c 6179 6572 733a 0a20  n self.layers:. 
-0000b700: 2020 2020 2020 2020 2020 2069 6620 6c61             if la
-0000b710: 7965 7220 6e6f 7420 696e 206c 6179 6572  yer not in layer
-0000b720: 5f74 6f5f 6e61 6d65 3a0a 2020 2020 2020  _to_name:.      
-0000b730: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-0000b740: 6773 2e77 6172 6e28 6622 7b6c 6179 6572  gs.warn(f"{layer
-0000b750: 7d20 6e6f 7420 696e 204c 6179 6572 4d61  } not in LayerMa
-0000b760: 702e 2e22 290a 2020 2020 2020 2020 2020  p..").          
-0000b770: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000b780: 2020 2020 2020 2020 6c61 7965 725f 6e61          layer_na
-0000b790: 6d65 732e 6170 7065 6e64 286c 6179 6572  mes.append(layer
-0000b7a0: 5f74 6f5f 6e61 6d65 5b6c 6179 6572 5d29  _to_name[layer])
-0000b7b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000b7c0: 6c61 7965 725f 6e61 6d65 730a 0a20 2020  layer_names..   
-0000b7d0: 2064 6566 205f 6970 7974 686f 6e5f 6469   def _ipython_di
-0000b7e0: 7370 6c61 795f 2873 656c 6629 202d 3e20  splay_(self) -> 
-0000b7f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-0000b800: 2253 686f 7720 6765 6f6d 6574 7279 2069  "Show geometry i
-0000b810: 6e20 4b4c 6179 6f75 7420 616e 6420 696e  n KLayout and in
-0000b820: 206d 6174 706c 6f74 6c69 6220 666f 7220   matplotlib for 
-0000b830: 4a75 7079 7465 7220 4e6f 7465 626f 6f6b  Jupyter Notebook
-0000b840: 732e 2222 220a 2020 2020 2020 2020 7365  s.""".        se
-0000b850: 6c66 2e73 686f 7728 7368 6f77 5f70 6f72  lf.show(show_por
-0000b860: 7473 3d54 7275 6529 2020 2320 7368 6f77  ts=True)  # show
-0000b870: 2069 6e20 6b6c 6179 6f75 740a 2020 2020   in klayout.    
-0000b880: 2020 2020 7365 6c66 2e70 6c6f 745f 6b6c      self.plot_kl
-0000b890: 6179 6f75 7428 290a 2020 2020 2020 2020  ayout().        
-0000b8a0: 7072 696e 7428 7365 6c66 290a 0a20 2020  print(self)..   
-0000b8b0: 2064 6566 2061 6464 5f70 696e 735f 7472   def add_pins_tr
-0000b8c0: 6961 6e67 6c65 280a 2020 2020 2020 2020  iangle(.        
-0000b8d0: 7365 6c66 2c0a 2020 2020 2020 2020 706f  self,.        po
-0000b8e0: 7274 5f6d 6172 6b65 725f 6c61 7965 723a  rt_marker_layer:
-0000b8f0: 204c 6179 6572 203d 2028 312c 2031 3029   Layer = (1, 10)
-0000b900: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
-0000b910: 2022 2222 5265 7475 726e 7320 636f 6d70   """Returns comp
-0000b920: 6f6e 656e 7420 7769 7468 2074 7269 616e  onent with trian
-0000b930: 6775 6c61 7220 7069 6e73 2e22 2222 0a20  gular pins.""". 
-0000b940: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
-0000b950: 6163 746f 7279 2e61 6464 5f70 696e 7320  actory.add_pins 
-0000b960: 696d 706f 7274 2061 6464 5f70 696e 735f  import add_pins_
-0000b970: 7472 6961 6e67 6c65 0a0a 2020 2020 2020  triangle..      
-0000b980: 2020 636f 6d70 6f6e 656e 7420 3d20 7365    component = se
-0000b990: 6c66 2e63 6f70 7928 290a 2020 2020 2020  lf.copy().      
-0000b9a0: 2020 636f 6d70 6f6e 656e 742e 6e61 6d65    component.name
-0000b9b0: 203d 2073 656c 662e 6e61 6d65 0a20 2020   = self.name.   
-0000b9c0: 2020 2020 2061 6464 5f70 696e 735f 7472       add_pins_tr
-0000b9d0: 6961 6e67 6c65 2863 6f6d 706f 6e65 6e74  iangle(component
-0000b9e0: 3d63 6f6d 706f 6e65 6e74 2c20 6c61 7965  =component, laye
-0000b9f0: 723d 706f 7274 5f6d 6172 6b65 725f 6c61  r=port_marker_la
-0000ba00: 7965 7229 0a20 2020 2020 2020 2072 6574  yer).        ret
-0000ba10: 7572 6e20 636f 6d70 6f6e 656e 740a 0a20  urn component.. 
-0000ba20: 2020 2064 6566 2070 6c6f 745f 7769 6467     def plot_widg
-0000ba30: 6574 280a 2020 2020 2020 2020 7365 6c66  et(.        self
-0000ba40: 2c0a 2020 2020 2020 2020 7368 6f77 5f70  ,.        show_p
-0000ba50: 6f72 7473 3a20 626f 6f6c 203d 2054 7275  orts: bool = Tru
-0000ba60: 652c 0a20 2020 2020 2020 2070 6f72 745f  e,.        port_
-0000ba70: 6d61 726b 6572 5f6c 6179 6572 3a20 4c61  marker_layer: La
-0000ba80: 7965 7220 3d20 2831 2c20 3130 292c 0a20  yer = (1, 10),. 
-0000ba90: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-0000baa0: 2252 6574 7572 6e73 2069 7079 7468 6f6e  "Returns ipython
-0000bab0: 2077 6964 6765 7420 666f 7220 6b6c 6179   widget for klay
-0000bac0: 6f75 7420 7669 7375 616c 697a 6174 696f  out visualizatio
-0000bad0: 6e2e 0a0a 2020 2020 2020 2020 4172 6773  n...        Args
-0000bae0: 3a0a 2020 2020 2020 2020 2020 2020 7368  :.            sh
-0000baf0: 6f77 5f70 6f72 7473 3a20 7368 6f77 7320  ow_ports: shows 
-0000bb00: 636f 6d70 6f6e 656e 7420 7769 7468 2070  component with p
-0000bb10: 6f72 7420 6d61 726b 6572 7320 616e 6420  ort markers and 
-0000bb20: 6c61 6265 6c73 2e0a 2020 2020 2020 2020  labels..        
-0000bb30: 2020 2020 706f 7274 5f6d 6172 6b65 725f      port_marker_
-0000bb40: 6c61 7965 723a 2066 6f72 2074 6865 2070  layer: for the p
-0000bb50: 6f72 7473 2e0a 2020 2020 2020 2020 2222  orts..        ""
-0000bb60: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
-0000bb70: 6473 6661 6374 6f72 792e 7064 6b20 696d  dsfactory.pdk im
-0000bb80: 706f 7274 2067 6574 5f6c 6179 6572 5f76  port get_layer_v
-0000bb90: 6965 7773 0a20 2020 2020 2020 2066 726f  iews.        fro
-0000bba0: 6d20 6764 7366 6163 746f 7279 2e77 6964  m gdsfactory.wid
-0000bbb0: 6765 7473 2e6c 6179 6f75 745f 7669 6577  gets.layout_view
-0000bbc0: 6572 2069 6d70 6f72 7420 4c61 796f 7574  er import Layout
-0000bbd0: 5669 6577 6572 0a20 2020 2020 2020 2066  Viewer.        f
-0000bbe0: 726f 6d20 4950 7974 686f 6e2e 6469 7370  rom IPython.disp
-0000bbf0: 6c61 7920 696d 706f 7274 2064 6973 706c  lay import displ
-0000bc00: 6179 0a0a 2020 2020 2020 2020 636f 6d70  ay..        comp
-0000bc10: 6f6e 656e 7420 3d20 280a 2020 2020 2020  onent = (.      
-0000bc20: 2020 2020 2020 7365 6c66 2e61 6464 5f70        self.add_p
-0000bc30: 696e 735f 7472 6961 6e67 6c65 2870 6f72  ins_triangle(por
-0000bc40: 745f 6d61 726b 6572 5f6c 6179 6572 3d70  t_marker_layer=p
-0000bc50: 6f72 745f 6d61 726b 6572 5f6c 6179 6572  ort_marker_layer
-0000bc60: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0000bc70: 2073 686f 775f 706f 7274 730a 2020 2020   show_ports.    
-0000bc80: 2020 2020 2020 2020 656c 7365 2073 656c          else sel
-0000bc90: 660a 2020 2020 2020 2020 290a 0a20 2020  f.        )..   
-0000bca0: 2020 2020 2067 6473 7061 7468 203d 2063       gdspath = c
-0000bcb0: 6f6d 706f 6e65 6e74 2e77 7269 7465 5f67  omponent.write_g
-0000bcc0: 6473 286c 6f67 6769 6e67 3d46 616c 7365  ds(logging=False
-0000bcd0: 290a 2020 2020 2020 2020 6c79 705f 7061  ).        lyp_pa
-0000bce0: 7468 203d 2067 6473 7061 7468 2e77 6974  th = gdspath.wit
-0000bcf0: 685f 7375 6666 6978 2822 2e6c 7970 2229  h_suffix(".lyp")
-0000bd00: 0a0a 2020 2020 2020 2020 6c61 7965 725f  ..        layer_
-0000bd10: 7669 6577 7320 3d20 6765 745f 6c61 7965  views = get_laye
-0000bd20: 725f 7669 6577 7328 290a 2020 2020 2020  r_views().      
-0000bd30: 2020 6c61 7965 725f 7669 6577 732e 746f    layer_views.to
-0000bd40: 5f6c 7970 2866 696c 6570 6174 683d 6c79  _lyp(filepath=ly
-0000bd50: 705f 7061 7468 290a 0a20 2020 2020 2020  p_path)..       
-0000bd60: 206c 6179 6f75 7420 3d20 4c61 796f 7574   layout = Layout
-0000bd70: 5669 6577 6572 2867 6473 7061 7468 2c20  Viewer(gdspath, 
-0000bd80: 6c79 705f 7061 7468 290a 2020 2020 2020  lyp_path).      
-0000bd90: 2020 6469 7370 6c61 7928 6c61 796f 7574    display(layout
-0000bda0: 2e77 6964 6765 7429 0a0a 2020 2020 6465  .widget)..    de
-0000bdb0: 6620 706c 6f74 5f6b 6c61 796f 7574 280a  f plot_klayout(.
-0000bdc0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0000bdd0: 2020 2020 2020 7368 6f77 5f70 6f72 7473        show_ports
-0000bde0: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
-0000bdf0: 2020 2020 2020 2070 6f72 745f 6d61 726b         port_mark
-0000be00: 6572 5f6c 6179 6572 3a20 4c61 7965 7220  er_layer: Layer 
-0000be10: 3d20 2831 2c20 3130 292c 0a20 2020 2020  = (1, 10),.     
-0000be20: 2020 2073 686f 775f 6c61 6265 6c73 3a20     show_labels: 
-0000be30: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-0000be40: 2020 2920 2d3e 204e 6f6e 653a 0a20 2020    ) -> None:.   
-0000be50: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-0000be60: 6b6c 6179 6f75 7420 696d 6167 652e 0a0a  klayout image...
-0000be70: 2020 2020 2020 2020 4966 2069 7420 6661          If it fa
-0000be80: 696c 7320 746f 2069 6d70 6f72 7420 6b6c  ils to import kl
-0000be90: 6179 6f75 7420 6465 6661 756c 7473 2074  ayout defaults t
-0000bea0: 6f20 6d61 7470 6c6f 746c 6962 2e0a 0a20  o matplotlib... 
-0000beb0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-0000bec0: 2020 2020 2020 2020 2073 686f 775f 706f           show_po
-0000bed0: 7274 733a 2073 686f 7773 2063 6f6d 706f  rts: shows compo
-0000bee0: 6e65 6e74 2077 6974 6820 706f 7274 206d  nent with port m
-0000bef0: 6172 6b65 7273 2061 6e64 206c 6162 656c  arkers and label
-0000bf00: 732e 0a20 2020 2020 2020 2020 2020 2070  s..            p
-0000bf10: 6f72 745f 6d61 726b 6572 5f6c 6179 6572  ort_marker_layer
-0000bf20: 3a20 666f 7220 7468 6520 706f 7274 732e  : for the ports.
-0000bf30: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
-0000bf40: 775f 6c61 6265 6c73 3a20 7368 6f77 7320  w_labels: shows 
-0000bf50: 6c61 6265 6c73 2e0a 2020 2020 2020 2020  labels..        
-0000bf60: 2222 220a 0a20 2020 2020 2020 2063 6f6d  """..        com
-0000bf70: 706f 6e65 6e74 203d 2028 0a20 2020 2020  ponent = (.     
-0000bf80: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-0000bf90: 7069 6e73 5f74 7269 616e 676c 6528 706f  pins_triangle(po
-0000bfa0: 7274 5f6d 6172 6b65 725f 6c61 7965 723d  rt_marker_layer=
-0000bfb0: 706f 7274 5f6d 6172 6b65 725f 6c61 7965  port_marker_laye
-0000bfc0: 7229 0a20 2020 2020 2020 2020 2020 2069  r).            i
-0000bfd0: 6620 7368 6f77 5f70 6f72 7473 0a20 2020  f show_ports.   
-0000bfe0: 2020 2020 2020 2020 2065 6c73 6520 7365           else se
-0000bff0: 6c66 0a20 2020 2020 2020 2029 0a0a 2020  lf.        )..  
-0000c000: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000c010: 2020 2020 2020 2069 6d70 6f72 7420 6b6c         import kl
-0000c020: 6179 6f75 742e 6462 2061 7320 6462 2020  ayout.db as db  
-0000c030: 2320 6e6f 7161 3a20 4634 3031 0a20 2020  # noqa: F401.   
-0000c040: 2020 2020 2020 2020 2069 6d70 6f72 7420           import 
-0000c050: 6b6c 6179 6f75 742e 6c61 7920 6173 206c  klayout.lay as l
-0000c060: 6179 0a20 2020 2020 2020 2020 2020 2066  ay.            f
-0000c070: 726f 6d20 6764 7366 6163 746f 7279 2e70  rom gdsfactory.p
-0000c080: 646b 2069 6d70 6f72 7420 6765 745f 6c61  dk import get_la
-0000c090: 7965 725f 7669 6577 730a 2020 2020 2020  yer_views.      
-0000c0a0: 2020 2020 2020 6672 6f6d 2049 5079 7468        from IPyth
-0000c0b0: 6f6e 2e64 6973 706c 6179 2069 6d70 6f72  on.display impor
-0000c0c0: 7420 6469 7370 6c61 790a 2020 2020 2020  t display.      
-0000c0d0: 2020 2020 2020 6672 6f6d 2069 7079 7769        from ipywi
-0000c0e0: 6467 6574 7320 696d 706f 7274 2049 6d61  dgets import Ima
-0000c0f0: 6765 0a0a 2020 2020 2020 2020 2020 2020  ge..            
-0000c100: 6764 7370 6174 6820 3d20 636f 6d70 6f6e  gdspath = compon
-0000c110: 656e 742e 7772 6974 655f 6764 7328 6c6f  ent.write_gds(lo
-0000c120: 6767 696e 673d 4661 6c73 6529 0a20 2020  gging=False).   
-0000c130: 2020 2020 2020 2020 206c 7970 5f70 6174           lyp_pat
-0000c140: 6820 3d20 6764 7370 6174 682e 7769 7468  h = gdspath.with
-0000c150: 5f73 7566 6669 7828 222e 6c79 7022 290a  _suffix(".lyp").
-0000c160: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-0000c170: 6572 5f76 6965 7773 203d 2067 6574 5f6c  er_views = get_l
-0000c180: 6179 6572 5f76 6965 7773 2829 0a20 2020  ayer_views().   
-0000c190: 2020 2020 2020 2020 206c 6179 6572 5f76           layer_v
-0000c1a0: 6965 7773 2e74 6f5f 6c79 7028 6669 6c65  iews.to_lyp(file
-0000c1b0: 7061 7468 3d6c 7970 5f70 6174 6829 0a0a  path=lyp_path)..
-0000c1c0: 2020 2020 2020 2020 2020 2020 6c61 796f              layo
-0000c1d0: 7574 5f76 6965 7720 3d20 6c61 792e 4c61  ut_view = lay.La
-0000c1e0: 796f 7574 5669 6577 2829 0a20 2020 2020  youtView().     
-0000c1f0: 2020 2020 2020 206c 6179 6f75 745f 7669         layout_vi
-0000c200: 6577 2e6c 6f61 645f 6c61 796f 7574 2873  ew.load_layout(s
-0000c210: 7472 2867 6473 7061 7468 2e61 6273 6f6c  tr(gdspath.absol
-0000c220: 7574 6528 2929 290a 2020 2020 2020 2020  ute())).        
-0000c230: 2020 2020 6c61 796f 7574 5f76 6965 772e      layout_view.
-0000c240: 6d61 785f 6869 6572 2829 0a20 2020 2020  max_hier().     
-0000c250: 2020 2020 2020 206c 6179 6f75 745f 7669         layout_vi
-0000c260: 6577 2e6c 6f61 645f 6c61 7965 725f 7072  ew.load_layer_pr
-0000c270: 6f70 7328 7374 7228 6c79 705f 7061 7468  ops(str(lyp_path
-0000c280: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-0000c290: 6c61 796f 7574 5f76 6965 772e 7365 745f  layout_view.set_
-0000c2a0: 636f 6e66 6967 2822 7465 7874 2d76 6973  config("text-vis
-0000c2b0: 6962 6c65 222c 2022 7472 7565 2220 6966  ible", "true" if
-0000c2c0: 2073 686f 775f 6c61 6265 6c73 2065 6c73   show_labels els
-0000c2d0: 6520 2266 616c 7365 2229 0a0a 2020 2020  e "false")..    
-0000c2e0: 2020 2020 2020 2020 7069 7865 6c5f 6275          pixel_bu
-0000c2f0: 6666 6572 203d 206c 6179 6f75 745f 7669  ffer = layout_vi
-0000c300: 6577 2e67 6574 5f70 6978 656c 735f 7769  ew.get_pixels_wi
-0000c310: 7468 5f6f 7074 696f 6e73 2838 3030 2c20  th_options(800, 
-0000c320: 3630 3029 0a20 2020 2020 2020 2020 2020  600).           
-0000c330: 2070 6e67 5f64 6174 6120 3d20 7069 7865   png_data = pixe
-0000c340: 6c5f 6275 6666 6572 2e74 6f5f 706e 675f  l_buffer.to_png_
-0000c350: 6461 7461 2829 0a20 2020 2020 2020 2020  data().         
-0000c360: 2020 2069 6d61 6765 203d 2049 6d61 6765     image = Image
-0000c370: 2876 616c 7565 3d70 6e67 5f64 6174 612c  (value=png_data,
-0000c380: 2066 6f72 6d61 743d 2270 6e67 2229 0a20   format="png"). 
-0000c390: 2020 2020 2020 2020 2020 2064 6973 706c             displ
-0000c3a0: 6179 2869 6d61 6765 290a 0a20 2020 2020  ay(image)..     
-0000c3b0: 2020 2065 7863 6570 7420 496d 706f 7274     except Import
-0000c3c0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-0000c3d0: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-0000c3e0: 2020 2020 2020 2020 2020 2259 6f75 2063            "You c
-0000c3f0: 616e 2069 6e73 7461 6c6c 2060 7069 7020  an install `pip 
-0000c400: 696e 7374 616c 6c20 6764 7366 6163 746f  install gdsfacto
-0000c410: 7279 5b66 756c 6c5d 6020 666f 7220 6265  ry[full]` for be
-0000c420: 7474 6572 2076 6973 7561 6c69 7a61 7469  tter visualizati
-0000c430: 6f6e 220a 2020 2020 2020 2020 2020 2020  on".            
-0000c440: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-0000c450: 6d70 6f6e 656e 742e 706c 6f74 2870 6c6f  mponent.plot(plo
-0000c460: 7474 6572 3d22 6d61 7470 6c6f 746c 6962  tter="matplotlib
-0000c470: 2229 0a0a 2020 2020 6465 6620 706c 6f74  ")..    def plot
-0000c480: 5f6a 7570 7974 6572 2873 656c 6629 3a0a  _jupyter(self):.
-0000c490: 2020 2020 2020 2020 2222 2253 686f 7773          """Shows
-0000c4a0: 2063 7572 7265 6e74 2067 6473 2069 6e20   current gds in 
-0000c4b0: 6b6c 6179 6f75 742e 2055 7365 7320 4b77  klayout. Uses Kw
-0000c4c0: 6562 2069 6620 7365 7276 6572 2072 756e  eb if server run
-0000c4d0: 6e69 6e67 2e0a 0a20 2020 2020 2020 2069  ning...        i
-0000c4e0: 6620 6e6f 7420 7472 6965 7320 7573 696e  f not tries usin
-0000c4f0: 6720 4b6c 6179 6f75 7420 7769 6467 6574  g Klayout widget
-0000c500: 2061 6e64 2066 696e 616c 6c79 2064 6566   and finally def
-0000c510: 6175 6c74 7320 746f 206d 6174 706c 6f74  aults to matplot
-0000c520: 6c69 622e 0a20 2020 2020 2020 2022 2222  lib..        """
-0000c530: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0000c540: 2020 2020 2020 2020 2020 696d 706f 7274            import
-0000c550: 206f 730a 2020 2020 2020 2020 2020 2020   os.            
-0000c560: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-0000c570: 636f 6e66 6967 2069 6d70 6f72 7420 5041  config import PA
-0000c580: 5448 0a20 2020 2020 2020 2020 2020 2066  TH.            f
-0000c590: 726f 6d20 6764 7366 6163 746f 7279 2e70  rom gdsfactory.p
-0000c5a0: 646b 2069 6d70 6f72 7420 6765 745f 6c61  dk import get_la
-0000c5b0: 7965 725f 7669 6577 730a 2020 2020 2020  yer_views.      
-0000c5c0: 2020 2020 2020 6672 6f6d 2049 5079 7468        from IPyth
-0000c5d0: 6f6e 2e64 6973 706c 6179 2069 6d70 6f72  on.display impor
-0000c5e0: 7420 4946 7261 6d65 0a20 2020 2020 2020  t IFrame.       
-0000c5f0: 2020 2020 2069 6d70 6f72 7420 6b77 6562       import kweb
-0000c600: 2e73 6572 7665 725f 6a75 7079 7465 7220  .server_jupyter 
-0000c610: 6173 206b 6a0a 2020 2020 2020 2020 2020  as kj.          
-0000c620: 2020 6672 6f6d 2068 746d 6c20 696d 706f    from html impo
-0000c630: 7274 2065 7363 6170 650a 0a20 2020 2020  rt escape..     
-0000c640: 2020 2020 2020 2067 6473 7061 7468 203d         gdspath =
-0000c650: 2073 656c 662e 7772 6974 655f 6764 7328   self.write_gds(
-0000c660: 6764 7364 6972 3d50 4154 482e 6764 736c  gdsdir=PATH.gdsl
-0000c670: 6962 202f 2022 6578 7472 6122 2c20 6c6f  ib / "extra", lo
-0000c680: 6767 696e 673d 4661 6c73 6529 0a0a 2020  gging=False)..  
-0000c690: 2020 2020 2020 2020 2020 6469 7270 6174            dirpat
-0000c6a0: 6820 3d20 4744 5344 4952 5f54 454d 500a  h = GDSDIR_TEMP.
-0000c6b0: 2020 2020 2020 2020 2020 2020 6469 7270              dirp
-0000c6c0: 6174 682e 6d6b 6469 7228 6578 6973 745f  ath.mkdir(exist_
-0000c6d0: 6f6b 3d54 7275 652c 2070 6172 656e 7473  ok=True, parents
-0000c6e0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-0000c6f0: 2020 206c 7970 5f70 6174 6820 3d20 6469     lyp_path = di
-0000c700: 7270 6174 6820 2f20 226c 6179 6572 732e  rpath / "layers.
-0000c710: 6c79 7022 0a0a 2020 2020 2020 2020 2020  lyp"..          
-0000c720: 2020 6c61 7965 725f 7072 6f70 7320 3d20    layer_props = 
-0000c730: 6765 745f 6c61 7965 725f 7669 6577 7328  get_layer_views(
-0000c740: 290a 2020 2020 2020 2020 2020 2020 6c61  ).            la
-0000c750: 7965 725f 7072 6f70 732e 746f 5f6c 7970  yer_props.to_lyp
-0000c760: 2866 696c 6570 6174 683d 6c79 705f 7061  (filepath=lyp_pa
-0000c770: 7468 290a 0a20 2020 2020 2020 2020 2020  th)..           
-0000c780: 2073 7263 203d 2066 2268 7474 703a 2f2f   src = f"http://
-0000c790: 3132 372e 302e 302e 313a 7b6b 6a2e 706f  127.0.0.1:{kj.po
-0000c7a0: 7274 7d2f 6764 733f 6764 735f 6669 6c65  rt}/gds?gds_file
-0000c7b0: 3d7b 6573 6361 7065 2873 7472 2867 6473  ={escape(str(gds
-0000c7c0: 7061 7468 2929 7d26 6c61 7965 725f 7072  path))}&layer_pr
-0000c7d0: 6f70 733d 7b65 7363 6170 6528 7374 7228  ops={escape(str(
-0000c7e0: 6c79 705f 7061 7468 2929 7d22 0a20 2020  lyp_path))}".   
-0000c7f0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0000c800: 6465 6275 6728 7372 6329 0a0a 2020 2020  debug(src)..    
-0000c810: 2020 2020 2020 2020 6966 206b 6a2e 6a75          if kj.ju
-0000c820: 7079 7465 725f 7365 7276 6572 2061 6e64  pyter_server and
-0000c830: 206e 6f74 206f 732e 656e 7669 726f 6e2e   not os.environ.
-0000c840: 6765 7428 2244 4f43 5322 2c20 4661 6c73  get("DOCS", Fals
-0000c850: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0000c860: 2020 2020 7265 7475 726e 2049 4672 616d      return IFram
-0000c870: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-0000c880: 2020 2020 2020 2073 7263 3d73 7263 2c0a         src=src,.
-0000c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c8a0: 2020 2020 7769 6474 683d 3134 3030 2c0a      width=1400,.
-0000c8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c8c0: 2020 2020 6865 6967 6874 3d36 3030 2c0a      height=600,.
-0000c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c8e0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0000c8f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000c900: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000c910: 706c 6f74 5f6b 6c61 796f 7574 2829 0a20  plot_klayout(). 
-0000c920: 2020 2020 2020 2065 7863 6570 7420 496d         except Im
-0000c930: 706f 7274 4572 726f 723a 0a20 2020 2020  portError:.     
-0000c940: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
-0000c950: 2020 2020 2020 2020 2020 2020 2020 2259                "Y
-0000c960: 6f75 2063 616e 2069 6e73 7461 6c6c 2060  ou can install `
-0000c970: 7069 7020 696e 7374 616c 6c20 6764 7366  pip install gdsf
-0000c980: 6163 746f 7279 5b66 756c 6c5d 6020 666f  actory[full]` fo
-0000c990: 7220 6265 7474 6572 2076 6973 7561 6c69  r better visuali
-0000c9a0: 7a61 7469 6f6e 220a 2020 2020 2020 2020  zation".        
-0000c9b0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000c9c0: 2020 7265 7475 726e 2073 656c 662e 706c    return self.pl
-0000c9d0: 6f74 5f6b 6c61 796f 7574 2829 0a0a 2020  ot_klayout()..  
-0000c9e0: 2020 6465 6620 706c 6f74 5f6d 6174 706c    def plot_matpl
-0000c9f0: 6f74 6c69 6228 7365 6c66 2c20 2a2a 6b77  otlib(self, **kw
-0000ca00: 6172 6773 2920 2d3e 204e 6f6e 653a 0a20  args) -> None:. 
-0000ca10: 2020 2020 2020 2022 2222 506c 6f74 2063         """Plot c
-0000ca20: 6f6d 706f 6e65 6e74 2075 7369 6e67 206d  omponent using m
-0000ca30: 6174 706c 6f74 6c69 622e 0a0a 2020 2020  atplotlib...    
-0000ca40: 2020 2020 4b65 7977 6f72 6420 4172 6773      Keyword Args
-0000ca50: 3a0a 2020 2020 2020 2020 2020 2020 7368  :.            sh
-0000ca60: 6f77 5f70 6f72 7473 3a20 5365 7473 2077  ow_ports: Sets w
-0000ca70: 6865 7468 6572 2070 6f72 7473 2061 7265  hether ports are
-0000ca80: 2064 7261 776e 2e0a 2020 2020 2020 2020   drawn..        
-0000ca90: 2020 2020 7368 6f77 5f73 7562 706f 7274      show_subport
-0000caa0: 733a 2053 6574 7320 7768 6574 6865 7220  s: Sets whether 
-0000cab0: 7375 6270 6f72 7473 2028 706f 7274 7320  subports (ports 
-0000cac0: 7468 6174 2062 656c 6f6e 6720 746f 2072  that belong to r
-0000cad0: 6566 6572 656e 6365 7329 2061 7265 2064  eferences) are d
-0000cae0: 7261 776e 2e0a 2020 2020 2020 2020 2020  rawn..          
-0000caf0: 2020 6c61 6265 6c5f 616c 6961 7365 733a    label_aliases:
-0000cb00: 2053 6574 7320 7768 6574 6865 7220 616c   Sets whether al
-0000cb10: 6961 7365 7320 6172 6520 6c61 6265 6c65  iases are labele
-0000cb20: 6420 7769 7468 2061 2074 6578 7420 6e61  d with a text na
-0000cb30: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
-0000cb40: 6e65 775f 7769 6e64 6f77 3a20 4966 2054  new_window: If T
-0000cb50: 7275 652c 2065 6163 6820 6361 6c6c 2074  rue, each call t
-0000cb60: 6f20 7175 6963 6b70 6c6f 7428 2920 7769  o quickplot() wi
-0000cb70: 6c6c 2067 656e 6572 6174 6520 6120 7365  ll generate a se
-0000cb80: 7061 7261 7465 2077 696e 646f 772e 0a20  parate window.. 
-0000cb90: 2020 2020 2020 2020 2020 2062 6c6f 636b             block
-0000cba0: 696e 673a 2049 6620 5472 7565 2c20 6361  ing: If True, ca
-0000cbb0: 6c6c 696e 6720 7175 6963 6b70 6c6f 7428  lling quickplot(
-0000cbc0: 2920 7769 6c6c 2070 6175 7365 2065 7865  ) will pause exe
-0000cbd0: 6375 7469 6f6e 206f 6620 2822 626c 6f63  cution of ("bloc
-0000cbe0: 6b22 2920 7468 650a 2020 2020 2020 2020  k") the.        
-0000cbf0: 2020 2020 2020 2020 7265 6d61 696e 6465          remainde
-0000cc00: 7220 6f66 2074 6865 2070 7974 686f 6e20  r of the python 
-0000cc10: 636f 6465 2075 6e74 696c 2074 6865 2071  code until the q
-0000cc20: 7569 636b 706c 6f74 2829 2077 696e 646f  uickplot() windo
-0000cc30: 7720 6973 2063 6c6f 7365 642e 0a20 2020  w is closed..   
-0000cc40: 2020 2020 2020 2020 2020 2020 2049 6620               If 
-0000cc50: 4661 6c73 652c 2074 6865 2077 696e 646f  False, the windo
-0000cc60: 7720 7769 6c6c 2062 6520 6f70 656e 6564  w will be opened
-0000cc70: 2061 6e64 2063 6f64 6520 7769 6c6c 2063   and code will c
-0000cc80: 6f6e 7469 6e75 6520 746f 2072 756e 2e0a  ontinue to run..
-0000cc90: 2020 2020 2020 2020 2020 2020 7a6f 6f6d              zoom
-0000cca0: 5f66 6163 746f 723a 2053 6574 7320 7468  _factor: Sets th
-0000ccb0: 6520 7363 616c 696e 6720 6661 6374 6f72  e scaling factor
-0000ccc0: 2077 6865 6e20 7a6f 6f6d 696e 6720 7468   when zooming th
-0000ccd0: 6520 7175 6963 6b70 6c6f 7420 7769 6e64  e quickplot wind
-0000cce0: 6f77 2077 6974 6820 7468 650a 2020 2020  ow with the.    
-0000ccf0: 2020 2020 2020 2020 2020 2020 6d6f 7573              mous
-0000cd00: 6577 6865 656c 2f74 7261 636b 7061 642e  ewheel/trackpad.
-0000cd10: 0a20 2020 2020 2020 2020 2020 2069 6e74  .            int
-0000cd20: 6572 6163 7469 7665 5f7a 6f6f 6d3a 2045  eractive_zoom: E
-0000cd30: 6e61 626c 6573 2075 7369 6e67 206d 6f75  nables using mou
-0000cd40: 7365 7768 6565 6c2f 7472 6163 6b70 6164  sewheel/trackpad
-0000cd50: 2074 6f20 7a6f 6f6d 2e0a 2020 2020 2020   to zoom..      
-0000cd60: 2020 2020 2020 666f 6e74 7369 7a65 3a20        fontsize: 
-0000cd70: 666f 7220 6c61 6265 6c73 2e0a 2020 2020  for labels..    
-0000cd80: 2020 2020 2020 2020 6c61 7965 7273 5f65          layers_e
-0000cd90: 7863 6c75 6465 643a 206c 6973 7420 6f66  xcluded: list of
-0000cda0: 206c 6179 6572 7320 746f 2065 7863 6c75   layers to exclu
-0000cdb0: 6465 2e0a 2020 2020 2020 2020 2020 2020  de..            
-0000cdc0: 6c61 7965 725f 7669 6577 733a 206c 6179  layer_views: lay
-0000cdd0: 6572 5f76 6965 7773 2063 6f6c 6f72 7320  er_views colors 
-0000cde0: 6c6f 6164 6564 2066 726f 6d20 4b6c 6179  loaded from Klay
-0000cdf0: 6f75 742e 0a20 2020 2020 2020 2020 2020  out..           
-0000ce00: 206d 696e 5f61 7370 6563 743a 206d 696e   min_aspect: min
-0000ce10: 696d 756d 2061 7370 6563 7420 7261 7469  imum aspect rati
-0000ce20: 6f2e 0a20 2020 2020 2020 2022 2222 0a20  o..        """. 
-0000ce30: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
-0000ce40: 6163 746f 7279 2e71 7569 636b 706c 6f74  actory.quickplot
-0000ce50: 7465 7220 696d 706f 7274 2071 7569 636b  ter import quick
-0000ce60: 706c 6f74 0a0a 2020 2020 2020 2020 7175  plot..        qu
-0000ce70: 6963 6b70 6c6f 7428 7365 6c66 2c20 2a2a  ickplot(self, **
-0000ce80: 6b77 6172 6773 290a 0a20 2020 2064 6566  kwargs)..    def
-0000ce90: 2070 6c6f 7428 7365 6c66 2c20 706c 6f74   plot(self, plot
-0000cea0: 7465 723a 204f 7074 696f 6e61 6c5b 506c  ter: Optional[Pl
-0000ceb0: 6f74 7465 725d 203d 204e 6f6e 652c 202a  otter] = None, *
-0000cec0: 2a6b 7761 7267 7329 202d 3e20 4e6f 6e65  *kwargs) -> None
-0000ced0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-0000cee0: 7572 6e73 2063 6f6d 706f 6e65 6e74 2070  urns component p
-0000cef0: 6c6f 7420 7573 696e 6720 6b6c 6179 6f75  lot using klayou
-0000cf00: 742c 206d 6174 706c 6f74 6c69 622c 2068  t, matplotlib, h
-0000cf10: 6f6c 6f76 6965 7773 206f 7220 7174 2e0a  oloviews or qt..
-0000cf20: 0a20 2020 2020 2020 2057 6520 7265 636f  .        We reco
-0000cf30: 6d6d 656e 6420 7573 696e 6720 6b6c 6179  mmend using klay
-0000cf40: 6f75 742e 0a0a 2020 2020 2020 2020 4172  out...        Ar
-0000cf50: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-0000cf60: 706c 6f74 7465 723a 2070 6c6f 7420 6261  plotter: plot ba
-0000cf70: 636b 656e 6420 2827 686f 6c6f 7669 6577  ckend ('holoview
-0000cf80: 7327 2c20 276d 6174 706c 6f74 6c69 6227  s', 'matplotlib'
-0000cf90: 2c20 2771 7427 2c20 276b 6c61 796f 7574  , 'qt', 'klayout
-0000cfa0: 2729 2e0a 2020 2020 2020 2020 2222 220a  ')..        """.
-0000cfb0: 2020 2020 2020 2020 706c 6f74 7465 7220          plotter 
-0000cfc0: 3d20 706c 6f74 7465 7220 6f72 2043 4f4e  = plotter or CON
-0000cfd0: 462e 6765 7428 2270 6c6f 7474 6572 222c  F.get("plotter",
-0000cfe0: 2022 6d61 7470 6c6f 746c 6962 2229 0a0a   "matplotlib")..
-0000cff0: 2020 2020 2020 2020 6966 2070 6c6f 7474          if plott
-0000d000: 6572 203d 3d20 226b 6c61 796f 7574 223a  er == "klayout":
-0000d010: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000d020: 662e 706c 6f74 5f6b 6c61 796f 7574 2829  f.plot_klayout()
-0000d030: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000d040: 7572 6e0a 0a20 2020 2020 2020 2065 6c69  urn..        eli
-0000d050: 6620 706c 6f74 7465 7220 3d3d 2022 6d61  f plotter == "ma
-0000d060: 7470 6c6f 746c 6962 223a 0a20 2020 2020  tplotlib":.     
-0000d070: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
-0000d080: 6163 746f 7279 2e71 7569 636b 706c 6f74  actory.quickplot
-0000d090: 7465 7220 696d 706f 7274 2071 7569 636b  ter import quick
-0000d0a0: 706c 6f74 0a0a 2020 2020 2020 2020 2020  plot..          
-0000d0b0: 2020 7175 6963 6b70 6c6f 7428 7365 6c66    quickplot(self
-0000d0c0: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
-0000d0d0: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-0000d0e0: 2020 2020 2020 2020 656c 6966 2070 6c6f          elif plo
-0000d0f0: 7474 6572 203d 3d20 2268 6f6c 6f76 6965  tter == "holovie
-0000d100: 7773 223a 0a20 2020 2020 2020 2020 2020  ws":.           
-0000d110: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000d120: 2020 2020 2020 696d 706f 7274 2068 6f6c        import hol
-0000d130: 6f76 6965 7773 2061 7320 6876 0a0a 2020  oviews as hv..  
-0000d140: 2020 2020 2020 2020 2020 2020 2020 6876                hv
-0000d150: 2e65 7874 656e 7369 6f6e 2822 626f 6b65  .extension("boke
-0000d160: 6822 290a 2020 2020 2020 2020 2020 2020  h").            
-0000d170: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
-0000d180: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
-0000d190: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-0000d1a0: 796f 7520 6e65 6564 2074 6f20 6070 6970  you need to `pip
-0000d1b0: 2069 6e73 7461 6c6c 2068 6f6c 6f76 6965   install holovie
-0000d1c0: 7773 6022 290a 2020 2020 2020 2020 2020  ws`").          
-0000d1d0: 2020 2020 2020 7261 6973 6520 650a 2020        raise e.  
-0000d1e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000d1f0: 2073 656c 662e 706c 6f74 5f68 6f6c 6f76   self.plot_holov
-0000d200: 6965 7773 282a 2a6b 7761 7267 7329 0a0a  iews(**kwargs)..
-0000d210: 2020 2020 2020 2020 656c 6966 2070 6c6f          elif plo
-0000d220: 7474 6572 203d 3d20 2271 7422 3a0a 2020  tter == "qt":.  
-0000d230: 2020 2020 2020 2020 2020 6672 6f6d 2067            from g
-0000d240: 6473 6661 6374 6f72 792e 7175 6963 6b70  dsfactory.quickp
-0000d250: 6c6f 7474 6572 2069 6d70 6f72 7420 7175  lotter import qu
-0000d260: 6963 6b70 6c6f 7432 0a0a 2020 2020 2020  ickplot2..      
-0000d270: 2020 2020 2020 7175 6963 6b70 6c6f 7432        quickplot2
-0000d280: 2873 656c 6629 0a20 2020 2020 2020 2020  (self).         
-0000d290: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
-0000d2a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000d2b0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0000d2c0: 7272 6f72 2866 227b 706c 6f74 7465 7221  rror(f"{plotter!
-0000d2d0: 727d 206e 6f74 2069 6e20 7b50 6c6f 7474  r} not in {Plott
-0000d2e0: 6572 7d22 290a 0a20 2020 2064 6566 2070  er}")..    def p
-0000d2f0: 6c6f 745f 686f 6c6f 7669 6577 7328 0a20  lot_holoviews(. 
-0000d300: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0000d310: 2020 2020 206c 6179 6572 735f 6578 636c       layers_excl
-0000d320: 7564 6564 3a20 4f70 7469 6f6e 616c 5b4c  uded: Optional[L
-0000d330: 6179 6572 735d 203d 204e 6f6e 652c 0a20  ayers] = None,. 
-0000d340: 2020 2020 2020 206c 6179 6572 5f76 6965         layer_vie
-0000d350: 7773 3a20 4f70 7469 6f6e 616c 5b4c 6179  ws: Optional[Lay
-0000d360: 6572 5669 6577 735d 203d 204e 6f6e 652c  erViews] = None,
-0000d370: 0a20 2020 2020 2020 206d 696e 5f61 7370  .        min_asp
-0000d380: 6563 743a 2066 6c6f 6174 203d 2030 2e32  ect: float = 0.2
-0000d390: 352c 0a20 2020 2020 2020 2070 6164 6469  5,.        paddi
-0000d3a0: 6e67 3a20 666c 6f61 7420 3d20 302e 352c  ng: float = 0.5,
-0000d3b0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-0000d3c0: 2222 2250 6c6f 7420 636f 6d70 6f6e 656e  """Plot componen
-0000d3d0: 7420 696e 2068 6f6c 6f76 6965 7773 2e0a  t in holoviews..
-0000d3e0: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-0000d3f0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-0000d400: 735f 6578 636c 7564 6564 3a20 6c69 7374  s_excluded: list
-0000d410: 206f 6620 6c61 7965 7273 2074 6f20 6578   of layers to ex
-0000d420: 636c 7564 652e 0a20 2020 2020 2020 2020  clude..         
-0000d430: 2020 206c 6179 6572 5f76 6965 7773 3a20     layer_views: 
-0000d440: 6c61 7965 725f 7669 6577 7320 636f 6c6f  layer_views colo
-0000d450: 7273 206c 6f61 6465 6420 6672 6f6d 204b  rs loaded from K
-0000d460: 6c61 796f 7574 2e0a 2020 2020 2020 2020  layout..        
-0000d470: 2020 2020 6d69 6e5f 6173 7065 6374 3a20      min_aspect: 
-0000d480: 6d69 6e69 6d75 6d20 6173 7065 6374 2072  minimum aspect r
-0000d490: 6174 696f 2e0a 2020 2020 2020 2020 2020  atio..          
-0000d4a0: 2020 7061 6464 696e 673a 2061 726f 756e    padding: aroun
-0000d4b0: 6420 626f 756e 6469 6e67 2062 6f78 2e0a  d bounding box..
-0000d4c0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-0000d4d0: 3a0a 2020 2020 2020 2020 2020 2020 486f  :.            Ho
-0000d4e0: 6c6f 7669 6577 7320 4f76 6572 6c61 7920  loviews Overlay 
-0000d4f0: 746f 2064 6973 706c 6179 2061 6c6c 2070  to display all p
-0000d500: 6f6c 7967 6f6e 732e 0a20 2020 2020 2020  olygons..       
-0000d510: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-0000d520: 6d20 6764 7366 6163 746f 7279 2e61 6464  m gdsfactory.add
-0000d530: 5f70 696e 7320 696d 706f 7274 2067 6574  _pins import get
-0000d540: 5f70 696e 5f74 7269 616e 676c 655f 706f  _pin_triangle_po
-0000d550: 6c79 676f 6e5f 7469 700a 2020 2020 2020  lygon_tip.      
-0000d560: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
-0000d570: 792e 6765 6e65 7269 635f 7465 6368 2069  y.generic_tech i
-0000d580: 6d70 6f72 7420 4c41 5945 525f 5649 4557  mport LAYER_VIEW
-0000d590: 530a 0a20 2020 2020 2020 2069 6620 6c61  S..        if la
-0000d5a0: 7965 725f 7669 6577 7320 6973 204e 6f6e  yer_views is Non
-0000d5b0: 653a 0a20 2020 2020 2020 2020 2020 206c  e:.            l
-0000d5c0: 6179 6572 5f76 6965 7773 203d 204c 4159  ayer_views = LAY
-0000d5d0: 4552 5f56 4945 5753 0a0a 2020 2020 2020  ER_VIEWS..      
-0000d5e0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000d5f0: 2020 2069 6d70 6f72 7420 686f 6c6f 7669     import holovi
-0000d600: 6577 7320 6173 2068 760a 0a20 2020 2020  ews as hv..     
-0000d610: 2020 2020 2020 2068 762e 6578 7465 6e73         hv.extens
-0000d620: 696f 6e28 2262 6f6b 6568 2229 0a20 2020  ion("bokeh").   
-0000d630: 2020 2020 2065 7863 6570 7420 496d 706f       except Impo
-0000d640: 7274 4572 726f 7220 6173 2065 3a0a 2020  rtError as e:.  
-0000d650: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000d660: 2279 6f75 206e 6565 6420 746f 2060 7069  "you need to `pi
-0000d670: 7020 696e 7374 616c 6c20 686f 6c6f 7669  p install holovi
-0000d680: 6577 7360 2229 0a20 2020 2020 2020 2020  ews`").         
-0000d690: 2020 2072 6169 7365 2065 0a0a 2020 2020     raise e..    
-0000d6a0: 2020 2020 7365 6c66 2e5f 6262 5f76 616c      self._bb_val
-0000d6b0: 6964 203d 2046 616c 7365 2020 2320 7265  id = False  # re
-0000d6c0: 636f 6d70 7574 6520 7468 6520 626f 756e  compute the boun
-0000d6d0: 6469 6e67 2062 6f78 0a20 2020 2020 2020  ding box.       
-0000d6e0: 2062 203d 2073 656c 662e 6262 6f78 202b   b = self.bbox +
-0000d6f0: 2028 282d 7061 6464 696e 672c 202d 7061   ((-padding, -pa
-0000d700: 6464 696e 6729 2c20 2870 6164 6469 6e67  dding), (padding
-0000d710: 2c20 7061 6464 696e 6729 290a 2020 2020  , padding)).    
-0000d720: 2020 2020 6220 3d20 6e70 2e61 7272 6179      b = np.array
-0000d730: 2862 2e66 6c61 7429 0a20 2020 2020 2020  (b.flat).       
-0000d740: 2063 656e 7465 7220 3d20 6e70 2e61 7272   center = np.arr
-0000d750: 6179 2828 6e70 2e73 756d 2862 5b3a 3a32  ay((np.sum(b[::2
-0000d760: 5d29 202f 2032 2c20 6e70 2e73 756d 2862  ]) / 2, np.sum(b
-0000d770: 5b31 3a3a 325d 2920 2f20 3229 290a 2020  [1::2]) / 2)).  
-0000d780: 2020 2020 2020 7369 7a65 203d 206e 702e        size = np.
-0000d790: 6172 7261 7928 286e 702e 6162 7328 625b  array((np.abs(b[
-0000d7a0: 325d 202d 2062 5b30 5d29 2c20 6e70 2e61  2] - b[0]), np.a
-0000d7b0: 6273 2862 5b33 5d20 2d20 625b 315d 2929  bs(b[3] - b[1]))
-0000d7c0: 290a 2020 2020 2020 2020 6478 203d 206e  ).        dx = n
-0000d7d0: 702e 6172 7261 7928 0a20 2020 2020 2020  p.array(.       
-0000d7e0: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-0000d7f0: 2020 2020 2020 206e 702e 6d61 7869 6d75         np.maximu
-0000d800: 6d28 6d69 6e5f 6173 7065 6374 202a 2073  m(min_aspect * s
-0000d810: 697a 655b 315d 2c20 7369 7a65 5b30 5d29  ize[1], size[0])
-0000d820: 202f 2032 2c0a 2020 2020 2020 2020 2020   / 2,.          
-0000d830: 2020 2020 2020 6e70 2e6d 6178 696d 756d        np.maximum
-0000d840: 2873 697a 655b 315d 2c20 6d69 6e5f 6173  (size[1], min_as
-0000d850: 7065 6374 202a 2073 697a 655b 305d 2920  pect * size[0]) 
-0000d860: 2f20 322c 0a20 2020 2020 2020 2020 2020  / 2,.           
-0000d870: 2029 0a20 2020 2020 2020 2029 0a20 2020   ).        ).   
-0000d880: 2020 2020 2062 203d 206e 702e 6873 7461       b = np.hsta
-0000d890: 636b 2828 6365 6e74 6572 202d 2064 782c  ck((center - dx,
-0000d8a0: 2063 656e 7465 7220 2b20 6478 2929 0a0a   center + dx))..
-0000d8b0: 2020 2020 2020 2020 706c 6f74 735f 746f          plots_to
-0000d8c0: 5f6f 7665 726c 6179 203d 205b 5d0a 2020  _overlay = [].  
-0000d8d0: 2020 2020 2020 6c61 7965 7273 5f65 7863        layers_exc
-0000d8e0: 6c75 6465 6420 3d20 5b5d 2069 6620 6c61  luded = [] if la
-0000d8f0: 7965 7273 5f65 7863 6c75 6465 6420 6973  yers_excluded is
-0000d900: 204e 6f6e 6520 656c 7365 206c 6179 6572   None else layer
-0000d910: 735f 6578 636c 7564 6564 0a0a 2020 2020  s_excluded..    
-0000d920: 2020 2020 666f 7220 6c61 7965 722c 2070      for layer, p
-0000d930: 6f6c 7967 6f6e 2069 6e20 7365 6c66 2e67  olygon in self.g
-0000d940: 6574 5f70 6f6c 7967 6f6e 7328 6279 5f73  et_polygons(by_s
-0000d950: 7065 633d 5472 7565 292e 6974 656d 7328  pec=True).items(
-0000d960: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0000d970: 6620 6c61 7965 7220 696e 206c 6179 6572  f layer in layer
-0000d980: 735f 6578 636c 7564 6564 3a0a 2020 2020  s_excluded:.    
-0000d990: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0000d9a0: 696e 7565 0a0a 2020 2020 2020 2020 2020  inue..          
-0000d9b0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000d9c0: 2020 2020 2020 206c 6179 6572 5f76 6965         layer_vie
-0000d9d0: 7720 3d20 6c61 7965 725f 7669 6577 732e  w = layer_views.
-0000d9e0: 6765 745f 6672 6f6d 5f74 7570 6c65 286c  get_from_tuple(l
-0000d9f0: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
-0000da00: 2020 6578 6365 7074 2056 616c 7565 4572    except ValueEr
-0000da10: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-0000da20: 2020 2020 206c 6179 6572 7320 3d20 6c69       layers = li
-0000da30: 7374 286c 6179 6572 5f76 6965 7773 2e67  st(layer_views.g
-0000da40: 6574 5f6c 6179 6572 5f76 6965 7773 2829  et_layer_views()
-0000da50: 2e6b 6579 7328 2929 0a20 2020 2020 2020  .keys()).       
-0000da60: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0000da70: 732e 7761 726e 2866 227b 6c61 7965 7221  s.warn(f"{layer!
-0000da80: 727d 206e 6f74 2064 6566 696e 6564 2069  r} not defined i
-0000da90: 6e20 7b6c 6179 6572 737d 2229 0a20 2020  n {layers}").   
-0000daa0: 2020 2020 2020 2020 2020 2020 206c 6179               lay
-0000dab0: 6572 5f76 6965 7720 3d20 4c61 7965 7256  er_view = LayerV
-0000dac0: 6965 7728 6c61 7965 723d 6c61 7965 7229  iew(layer=layer)
-0000dad0: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
-0000dae0: 4f44 4f3a 204d 6174 6368 2075 7020 6f70  ODO: Match up op
-0000daf0: 7469 6f6e 7320 7769 7468 204c 6179 6572  tions with Layer
-0000db00: 5669 6577 730a 2020 2020 2020 2020 2020  Views.          
-0000db10: 2020 706c 6f74 735f 746f 5f6f 7665 726c    plots_to_overl
-0000db20: 6179 2e61 7070 656e 6428 0a20 2020 2020  ay.append(.     
-0000db30: 2020 2020 2020 2020 2020 2068 762e 506f             hv.Po
-0000db40: 6c79 676f 6e73 2870 6f6c 7967 6f6e 2c20  lygons(polygon, 
-0000db50: 6c61 6265 6c3d 7374 7228 6c61 7965 725f  label=str(layer_
-0000db60: 7669 6577 2e6e 616d 6529 292e 6f70 7473  view.name)).opts
-0000db70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000db80: 2020 2020 2020 6461 7461 5f61 7370 6563        data_aspec
-0000db90: 743d 312c 0a20 2020 2020 2020 2020 2020  t=1,.           
-0000dba0: 2020 2020 2020 2020 2066 7261 6d65 5f77           frame_w
-0000dbb0: 6964 7468 3d35 3030 2c0a 2020 2020 2020  idth=500,.      
-0000dbc0: 2020 2020 2020 2020 2020 2020 2020 796c                yl
-0000dbd0: 696d 3d28 625b 315d 2c20 625b 335d 292c  im=(b[1], b[3]),
-0000dbe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dbf0: 2020 2020 2078 6c69 6d3d 2862 5b30 5d2c       xlim=(b[0],
-0000dc00: 2062 5b32 5d29 2c0a 2020 2020 2020 2020   b[2]),.        
-0000dc10: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
-0000dc20: 5f63 6f6c 6f72 3d6c 6179 6572 5f76 6965  _color=layer_vie
-0000dc30: 772e 6669 6c6c 5f63 6f6c 6f72 2e61 735f  w.fill_color.as_
-0000dc40: 7267 6228 2920 6f72 2022 222c 0a20 2020  rgb() or "",.   
-0000dc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc60: 206c 696e 655f 636f 6c6f 723d 6c61 7965   line_color=laye
-0000dc70: 725f 7669 6577 2e66 7261 6d65 5f63 6f6c  r_view.frame_col
-0000dc80: 6f72 2e61 735f 7267 6228 2920 6f72 2022  or.as_rgb() or "
-0000dc90: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000dca0: 2020 2020 2020 2066 696c 6c5f 616c 7068         fill_alph
-0000dcb0: 613d 6c61 7965 725f 7669 6577 2e67 6574  a=layer_view.get
-0000dcc0: 5f61 6c70 6861 2829 206f 7220 2222 2c0a  _alpha() or "",.
-0000dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dce0: 2020 2020 6c69 6e65 5f61 6c70 6861 3d6c      line_alpha=l
-0000dcf0: 6179 6572 5f76 6965 772e 6765 745f 616c  ayer_view.get_al
-0000dd00: 7068 6128 2920 6f72 2022 222c 0a20 2020  pha() or "",.   
-0000dd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd20: 2074 6f6f 6c73 3d5b 2268 6f76 6572 225d   tools=["hover"]
-0000dd30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000dd40: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000dd50: 290a 2020 2020 2020 2020 666f 7220 6e61  ).        for na
-0000dd60: 6d65 2c20 706f 7274 2069 6e20 7365 6c66  me, port in self
-0000dd70: 2e70 6f72 7473 2e69 7465 6d73 2829 3a0a  .ports.items():.
-0000dd80: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-0000dd90: 203d 2073 7472 286e 616d 6529 0a20 2020   = str(name).   
-0000dda0: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
-0000ddb0: 2c20 7074 6970 203d 2067 6574 5f70 696e  , ptip = get_pin
-0000ddc0: 5f74 7269 616e 676c 655f 706f 6c79 676f  _triangle_polygo
-0000ddd0: 6e5f 7469 7028 706f 7274 3d70 6f72 7429  n_tip(port=port)
-0000dde0: 0a0a 2020 2020 2020 2020 2020 2020 706c  ..            pl
-0000ddf0: 6f74 735f 746f 5f6f 7665 726c 6179 2e61  ots_to_overlay.a
-0000de00: 7070 656e 6428 0a20 2020 2020 2020 2020  ppend(.         
-0000de10: 2020 2020 2020 2068 762e 506f 6c79 676f         hv.Polygo
-0000de20: 6e73 2870 6f6c 7967 6f6e 2c20 6c61 6265  ns(polygon, labe
-0000de30: 6c3d 6e61 6d65 292e 6f70 7473 280a 2020  l=name).opts(.  
-0000de40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000de50: 2020 6461 7461 5f61 7370 6563 743d 312c    data_aspect=1,
-0000de60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000de70: 2020 2020 2066 7261 6d65 5f77 6964 7468       frame_width
-0000de80: 3d35 3030 2c0a 2020 2020 2020 2020 2020  =500,.          
-0000de90: 2020 2020 2020 2020 2020 6669 6c6c 5f61            fill_a
-0000dea0: 6c70 6861 3d30 2c0a 2020 2020 2020 2020  lpha=0,.        
-0000deb0: 2020 2020 2020 2020 2020 2020 796c 696d              ylim
-0000dec0: 3d28 625b 315d 2c20 625b 335d 292c 0a20  =(b[1], b[3]),. 
-0000ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dee0: 2020 2078 6c69 6d3d 2862 5b30 5d2c 2062     xlim=(b[0], b
-0000def0: 5b32 5d29 2c0a 2020 2020 2020 2020 2020  [2]),.          
-0000df00: 2020 2020 2020 2020 2020 636f 6c6f 723d            color=
-0000df10: 2272 6564 222c 0a20 2020 2020 2020 2020  "red",.         
-0000df20: 2020 2020 2020 2020 2020 206c 696e 655f             line_
-0000df30: 616c 7068 613d 6c61 7965 725f 7669 6577  alpha=layer_view
-0000df40: 2e67 6574 5f61 6c70 6861 2829 206f 7220  .get_alpha() or 
-0000df50: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
-0000df60: 2020 2020 2020 2020 746f 6f6c 733d 5b22          tools=["
-0000df70: 686f 7665 7222 5d2c 0a20 2020 2020 2020  hover"],.       
-0000df80: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000df90: 2020 2020 2020 2020 2020 202a 2068 762e             * hv.
-0000dfa0: 5465 7874 2870 7469 705b 305d 2c20 7074  Text(ptip[0], pt
-0000dfb0: 6970 5b31 5d2c 206e 616d 6529 0a20 2020  ip[1], name).   
-0000dfc0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0000dfd0: 2020 2020 7265 7475 726e 2068 762e 4f76      return hv.Ov
-0000dfe0: 6572 6c61 7928 706c 6f74 735f 746f 5f6f  erlay(plots_to_o
-0000dff0: 7665 726c 6179 292e 6f70 7473 280a 2020  verlay).opts(.  
-0000e000: 2020 2020 2020 2020 2020 7368 6f77 5f6c            show_l
-0000e010: 6567 656e 643d 5472 7565 2c20 7368 6172  egend=True, shar
-0000e020: 6564 5f61 7865 733d 4661 6c73 652c 2079  ed_axes=False, y
-0000e030: 6c69 6d3d 2862 5b31 5d2c 2062 5b33 5d29  lim=(b[1], b[3])
-0000e040: 2c20 786c 696d 3d28 625b 305d 2c20 625b  , xlim=(b[0], b[
-0000e050: 325d 290a 2020 2020 2020 2020 290a 0a20  2]).        ).. 
-0000e060: 2020 2064 6566 2073 686f 7728 0a20 2020     def show(.   
-0000e070: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0000e080: 2020 2073 686f 775f 706f 7274 733a 2062     show_ports: b
-0000e090: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-0000e0a0: 2020 2020 2073 686f 775f 7375 6270 6f72       show_subpor
-0000e0b0: 7473 3a20 626f 6f6c 203d 2046 616c 7365  ts: bool = False
-0000e0c0: 2c0a 2020 2020 2020 2020 706f 7274 5f6d  ,.        port_m
-0000e0d0: 6172 6b65 725f 6c61 7965 723a 204c 6179  arker_layer: Lay
-0000e0e0: 6572 203d 2028 312c 2031 3029 2c0a 2020  er = (1, 10),.  
-0000e0f0: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
-0000e100: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
-0000e110: 2020 2020 2020 2022 2222 5368 6f77 2063         """Show c
-0000e120: 6f6d 706f 6e65 6e74 2069 6e20 4b4c 6179  omponent in KLay
-0000e130: 6f75 742e 0a0a 2020 2020 2020 2020 7265  out...        re
-0000e140: 7475 726e 7320 6120 636f 7079 206f 6620  turns a copy of 
-0000e150: 7468 6520 436f 6d70 6f6e 656e 742c 2073  the Component, s
-0000e160: 6f20 7468 6520 6f72 6967 696e 616c 2063  o the original c
-0000e170: 6f6d 706f 6e65 6e74 2072 656d 6169 6e73  omponent remains
-0000e180: 2069 6e74 6163 742e 0a20 2020 2020 2020   intact..       
-0000e190: 2077 6974 6820 7069 6e73 206d 6172 6b65   with pins marke
-0000e1a0: 7273 206f 6e20 6561 6368 2070 6f72 7420  rs on each port 
-0000e1b0: 7368 6f77 5f70 6f72 7473 203d 2054 7275  show_ports = Tru
-0000e1c0: 652c 2061 6e64 206f 7074 696f 6e61 6c6c  e, and optionall
-0000e1d0: 7920 616c 736f 0a20 2020 2020 2020 2074  y also.        t
-0000e1e0: 6865 2070 6f72 7473 2066 726f 6d20 7468  he ports from th
-0000e1f0: 6520 7265 6665 7265 6e63 6573 2028 7368  e references (sh
-0000e200: 6f77 5f73 7562 706f 7274 733d 5472 7565  ow_subports=True
-0000e210: 290a 0a20 2020 2020 2020 2041 7267 733a  )..        Args:
-0000e220: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
-0000e230: 775f 706f 7274 733a 2073 686f 7773 2063  w_ports: shows c
-0000e240: 6f6d 706f 6e65 6e74 2077 6974 6820 706f  omponent with po
-0000e250: 7274 206d 6172 6b65 7273 2061 6e64 206c  rt markers and l
-0000e260: 6162 656c 732e 0a20 2020 2020 2020 2020  abels..         
-0000e270: 2020 2073 686f 775f 7375 6270 6f72 7473     show_subports
-0000e280: 3a20 6164 6420 706f 7274 7320 6d61 726b  : add ports mark
-0000e290: 6572 7320 616e 6420 6c61 6265 6c73 2074  ers and labels t
-0000e2a0: 6f20 7265 6665 7265 6e63 6573 2e0a 2020  o references..  
-0000e2b0: 2020 2020 2020 2020 2020 706f 7274 5f6d            port_m
-0000e2c0: 6172 6b65 725f 6c61 7965 723a 2066 6f72  arker_layer: for
-0000e2d0: 2074 6865 2070 6f72 7473 2e0a 0a20 2020   the ports...   
-0000e2e0: 2020 2020 204b 6579 776f 7264 2041 7267       Keyword Arg
-0000e2f0: 733a 0a20 2020 2020 2020 2020 2020 2067  s:.            g
-0000e300: 6473 7061 7468 3a20 4744 5320 6669 6c65  dspath: GDS file
-0000e310: 2070 6174 6820 746f 2077 7269 7465 2074   path to write t
-0000e320: 6f2e 0a20 2020 2020 2020 2020 2020 2067  o..            g
-0000e330: 6473 6469 723a 2064 6972 6563 746f 7279  dsdir: directory
-0000e340: 2066 6f72 2074 6865 2047 4453 2066 696c   for the GDS fil
-0000e350: 652e 2044 6566 6175 6c74 7320 746f 202f  e. Defaults to /
-0000e360: 746d 702f 2e0a 2020 2020 2020 2020 2020  tmp/..          
-0000e370: 2020 756e 6974 3a20 756e 6974 2073 697a    unit: unit siz
-0000e380: 6520 666f 7220 6f62 6a65 6374 7320 696e  e for objects in
-0000e390: 206c 6962 7261 7279 2e20 3175 6d20 6279   library. 1um by
-0000e3a0: 2064 6566 6175 6c74 2e0a 2020 2020 2020   default..      
-0000e3b0: 2020 2020 2020 7072 6563 6973 696f 6e3a        precision:
-0000e3c0: 2066 6f72 206f 626a 6563 7420 6469 6d65   for object dime
-0000e3d0: 6e73 696f 6e73 2069 6e20 7468 6520 6c69  nsions in the li
-0000e3e0: 6272 6172 7920 286d 292e 2031 6e6d 2062  brary (m). 1nm b
-0000e3f0: 7920 6465 6661 756c 742e 0a20 2020 2020  y default..     
-0000e400: 2020 2020 2020 2074 696d 6573 7461 6d70         timestamp
-0000e410: 3a20 4465 6661 756c 7473 2074 6f20 3230  : Defaults to 20
-0000e420: 3139 2d31 302d 3235 2e20 4966 204e 6f6e  19-10-25. If Non
-0000e430: 6520 7573 6573 2063 7572 7265 6e74 2074  e uses current t
-0000e440: 696d 652e 0a20 2020 2020 2020 2022 2222  ime..        """
-0000e450: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
-0000e460: 7366 6163 746f 7279 2e61 6464 5f70 696e  sfactory.add_pin
-0000e470: 7320 696d 706f 7274 2061 6464 5f70 696e  s import add_pin
-0000e480: 735f 7472 6961 6e67 6c65 0a20 2020 2020  s_triangle.     
-0000e490: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-0000e4a0: 7279 2e73 686f 7720 696d 706f 7274 2073  ry.show import s
-0000e4b0: 686f 770a 0a20 2020 2020 2020 2063 6f6d  how..        com
-0000e4c0: 706f 6e65 6e74 203d 2028 0a20 2020 2020  ponent = (.     
-0000e4d0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-0000e4e0: 7069 6e73 5f74 7269 616e 676c 6528 706f  pins_triangle(po
-0000e4f0: 7274 5f6d 6172 6b65 725f 6c61 7965 723d  rt_marker_layer=
-0000e500: 706f 7274 5f6d 6172 6b65 725f 6c61 7965  port_marker_laye
-0000e510: 7229 0a20 2020 2020 2020 2020 2020 2069  r).            i
-0000e520: 6620 7368 6f77 5f70 6f72 7473 0a20 2020  f show_ports.   
-0000e530: 2020 2020 2020 2020 2065 6c73 6520 7365           else se
-0000e540: 6c66 0a20 2020 2020 2020 2029 0a0a 2020  lf.        )..  
-0000e550: 2020 2020 2020 6966 2073 686f 775f 7375        if show_su
-0000e560: 6270 6f72 7473 3a0a 2020 2020 2020 2020  bports:.        
-0000e570: 2020 2020 636f 6d70 6f6e 656e 7420 3d20      component = 
-0000e580: 7365 6c66 2e63 6f70 7928 290a 2020 2020  self.copy().    
-0000e590: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
-0000e5a0: 742e 6e61 6d65 203d 2073 656c 662e 6e61  t.name = self.na
-0000e5b0: 6d65 0a20 2020 2020 2020 2020 2020 2066  me.            f
-0000e5c0: 6f72 2072 6566 6572 656e 6365 2069 6e20  or reference in 
-0000e5d0: 636f 6d70 6f6e 656e 742e 7265 6665 7265  component.refere
-0000e5e0: 6e63 6573 3a0a 2020 2020 2020 2020 2020  nces:.          
-0000e5f0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0000e600: 6e63 6528 636f 6d70 6f6e 656e 742c 2043  nce(component, C
-0000e610: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
-0000e620: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0000e630: 2020 2020 2020 2020 6164 645f 7069 6e73          add_pins
-0000e640: 5f74 7269 616e 676c 6528 0a20 2020 2020  _triangle(.     
-0000e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e660: 2020 2063 6f6d 706f 6e65 6e74 3d63 6f6d     component=com
-0000e670: 706f 6e65 6e74 2c0a 2020 2020 2020 2020  ponent,.        
-0000e680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e690: 7265 6665 7265 6e63 653d 7265 6665 7265  reference=refere
-0000e6a0: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
-0000e6b0: 2020 2020 2020 2020 2020 2020 206c 6179               lay
-0000e6c0: 6572 3d70 6f72 745f 6d61 726b 6572 5f6c  er=port_marker_l
-0000e6d0: 6179 6572 2c0a 2020 2020 2020 2020 2020  ayer,.          
-0000e6e0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0000e6f0: 2020 2020 2073 686f 7728 636f 6d70 6f6e       show(compon
-0000e700: 656e 742c 202a 2a6b 7761 7267 7329 0a0a  ent, **kwargs)..
-0000e710: 2020 2020 6465 6620 5f77 7269 7465 5f6c      def _write_l
-0000e720: 6962 7261 7279 280a 2020 2020 2020 2020  ibrary(.        
-0000e730: 7365 6c66 2c0a 2020 2020 2020 2020 6764  self,.        gd
-0000e740: 7370 6174 683a 204f 7074 696f 6e61 6c5b  spath: Optional[
-0000e750: 5061 7468 5479 7065 5d20 3d20 4e6f 6e65  PathType] = None
-0000e760: 2c0a 2020 2020 2020 2020 6764 7364 6972  ,.        gdsdir
-0000e770: 3a20 4f70 7469 6f6e 616c 5b50 6174 6854  : Optional[PathT
-0000e780: 7970 655d 203d 204e 6f6e 652c 0a20 2020  ype] = None,.   
-0000e790: 2020 2020 2074 696d 6573 7461 6d70 3a20       timestamp: 
-0000e7a0: 4f70 7469 6f6e 616c 5b64 6174 6574 696d  Optional[datetim
-0000e7b0: 652e 6461 7465 7469 6d65 5d20 3d20 5f74  e.datetime] = _t
-0000e7c0: 696d 6573 7461 6d70 3230 3139 2c0a 2020  imestamp2019,.  
-0000e7d0: 2020 2020 2020 6c6f 6767 696e 673a 2062        logging: b
-0000e7e0: 6f6f 6c20 3d20 5472 7565 2c0a 2020 2020  ool = True,.    
-0000e7f0: 2020 2020 7769 7468 5f6f 6173 6973 3a20      with_oasis: 
-0000e800: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-0000e810: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
-0000e820: 2020 2020 2920 2d3e 2050 6174 683a 0a20      ) -> Path:. 
-0000e830: 2020 2020 2020 2022 2222 5772 6974 6520         """Write 
-0000e840: 636f 6d70 6f6e 656e 7420 746f 2047 4453  component to GDS
-0000e850: 206f 7220 4f41 5349 5320 616e 6420 7265   or OASIS and re
-0000e860: 7475 726e 7320 6764 7370 6174 682e 0a0a  turns gdspath...
-0000e870: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-0000e880: 2020 2020 2020 2020 2020 6764 7370 6174            gdspat
-0000e890: 683a 2047 4453 2066 696c 6520 7061 7468  h: GDS file path
-0000e8a0: 2074 6f20 7772 6974 6520 746f 2e0a 2020   to write to..  
-0000e8b0: 2020 2020 2020 2020 2020 6764 7364 6972            gdsdir
-0000e8c0: 3a20 6469 7265 6374 6f72 7920 666f 7220  : directory for 
-0000e8d0: 7468 6520 4744 5320 6669 6c65 2e20 4465  the GDS file. De
-0000e8e0: 6661 756c 7473 2074 6f20 2f74 6d70 2f72  faults to /tmp/r
-0000e8f0: 616e 646f 6d46 696c 652f 6764 7366 6163  andomFile/gdsfac
-0000e900: 746f 7279 2e0a 2020 2020 2020 2020 2020  tory..          
-0000e910: 2020 7469 6d65 7374 616d 703a 2044 6566    timestamp: Def
-0000e920: 6175 6c74 7320 746f 2032 3031 392d 3130  aults to 2019-10
-0000e930: 2d32 3520 666f 7220 636f 6e73 6973 7465  -25 for consiste
-0000e940: 6e74 2068 6173 682e 0a20 2020 2020 2020  nt hash..       
-0000e950: 2020 2020 2020 2020 2049 6620 4e6f 6e65           If None
-0000e960: 2075 7365 7320 6375 7272 656e 7420 7469   uses current ti
-0000e970: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
-0000e980: 6c6f 6767 696e 673a 2064 6973 6162 6c65  logging: disable
-0000e990: 2047 4453 2070 6174 6820 6c6f 6767 696e   GDS path loggin
-0000e9a0: 672c 2066 6f72 2065 7861 6d70 6c65 2066  g, for example f
-0000e9b0: 6f72 2073 686f 7769 6e67 2069 7420 696e  or showing it in
-0000e9c0: 204b 4c61 796f 7574 2e0a 2020 2020 2020   KLayout..      
-0000e9d0: 2020 2020 2020 7769 7468 5f6f 6173 6973        with_oasis
-0000e9e0: 3a20 4966 2054 7275 652c 2066 696c 6520  : If True, file 
-0000e9f0: 7769 6c6c 2062 6520 7772 6974 7465 6e20  will be written 
-0000ea00: 746f 204f 4153 4953 2e20 4f74 6865 7277  to OASIS. Otherw
-0000ea10: 6973 652c 2066 696c 6520 7769 6c6c 2062  ise, file will b
-0000ea20: 6520 7772 6974 7465 6e20 746f 2047 4453  e written to GDS
-0000ea30: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
-0000ea40: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
-0000ea50: 2020 2020 204b 6579 776f 7264 2061 7267       Keyword arg
-0000ea60: 756d 656e 7473 2077 696c 6c20 6f76 6572  uments will over
-0000ea70: 7269 6465 2074 6865 2061 6374 6976 6520  ride the active 
-0000ea80: 5044 4b27 7320 6465 6661 756c 7420 4764  PDK's default Gd
-0000ea90: 7357 7269 7465 5365 7474 696e 6773 2061  sWriteSettings a
-0000eaa0: 6e64 204f 6173 6973 5772 6974 6553 6574  nd OasisWriteSet
-0000eab0: 7469 6e67 732e 0a0a 2020 2020 2020 2020  tings...        
-0000eac0: 2020 2020 4764 7320 7365 7474 696e 6773      Gds settings
-0000ead0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000eae0: 2020 756e 6974 3a20 756e 6974 2073 697a    unit: unit siz
-0000eaf0: 6520 666f 7220 6f62 6a65 6374 7320 696e  e for objects in
-0000eb00: 206c 6962 7261 7279 2e20 3175 6d20 6279   library. 1um by
-0000eb10: 2064 6566 6175 6c74 2e0a 2020 2020 2020   default..      
-0000eb20: 2020 2020 2020 2020 2020 7072 6563 6973            precis
-0000eb30: 696f 6e3a 2066 6f72 2064 696d 656e 7369  ion: for dimensi
-0000eb40: 6f6e 7320 696e 2074 6865 206c 6962 7261  ons in the libra
-0000eb50: 7279 2028 6d29 2e20 316e 6d20 6279 2064  ry (m). 1nm by d
-0000eb60: 6566 6175 6c74 2e0a 2020 2020 2020 2020  efault..        
-0000eb70: 2020 2020 2020 2020 6f6e 5f64 7570 6c69          on_dupli
-0000eb80: 6361 7465 5f63 656c 6c3a 2073 7065 6369  cate_cell: speci
-0000eb90: 6679 2068 6f77 2074 6f20 7265 736f 6c76  fy how to resolv
-0000eba0: 6520 6475 706c 6963 6174 652d 6e61 6d65  e duplicate-name
-0000ebb0: 6420 6365 6c6c 732e 2043 686f 6f73 6520  d cells. Choose 
-0000ebc0: 6f6e 6520 6f66 2074 6865 2066 6f6c 6c6f  one of the follo
-0000ebd0: 7769 6e67 3a0a 2020 2020 2020 2020 2020  wing:.          
-0000ebe0: 2020 2020 2020 2020 2020 2277 6172 6e22            "warn"
-0000ebf0: 2028 6465 6661 756c 7429 3a20 6f76 6572   (default): over
-0000ec00: 7772 6974 6520 616c 6c20 6475 706c 6963  write all duplic
-0000ec10: 6174 6520 6365 6c6c 7320 7769 7468 206f  ate cells with o
-0000ec20: 6e65 206f 6620 7468 6520 6475 706c 6963  ne of the duplic
-0000ec30: 6174 6573 2028 6172 6269 7472 6172 696c  ates (arbitraril
-0000ec40: 7929 2e0a 2020 2020 2020 2020 2020 2020  y)..            
-0000ec50: 2020 2020 2020 2020 2265 7272 6f72 223a          "error":
-0000ec60: 2074 6872 6f77 2061 2056 616c 7565 4572   throw a ValueEr
-0000ec70: 726f 7220 7768 656e 2061 7474 656d 7074  ror when attempt
-0000ec80: 696e 6720 746f 2077 7269 7465 2061 2067  ing to write a g
-0000ec90: 6473 2077 6974 6820 6475 706c 6963 6174  ds with duplicat
-0000eca0: 6520 6365 6c6c 732e 0a20 2020 2020 2020  e cells..       
-0000ecb0: 2020 2020 2020 2020 2020 2020 2022 6f76               "ov
-0000ecc0: 6572 7772 6974 6522 3a20 6f76 6572 7772  erwrite": overwr
-0000ecd0: 6974 6520 616c 6c20 6475 706c 6963 6174  ite all duplicat
-0000ece0: 6520 6365 6c6c 7320 7769 7468 206f 6e65  e cells with one
-0000ecf0: 206f 6620 7468 6520 6475 706c 6963 6174   of the duplicat
-0000ed00: 6573 2c20 7769 7468 6f75 7420 7761 726e  es, without warn
-0000ed10: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
-0000ed20: 2020 2020 2020 2020 204e 6f6e 653a 2064           None: d
-0000ed30: 6f20 6e6f 7420 7472 7920 746f 2072 6573  o not try to res
-0000ed40: 6f6c 7665 2028 6174 2079 6f75 7220 6f77  olve (at your ow
-0000ed50: 6e20 7269 736b 2129 0a20 2020 2020 2020  n risk!).       
-0000ed60: 2020 2020 2020 2020 2066 6c61 7474 656e           flatten
-0000ed70: 5f69 6e76 616c 6964 5f72 6566 733a 2066  _invalid_refs: f
-0000ed80: 6c61 7474 656e 7320 636f 6d70 6f6e 656e  lattens componen
-0000ed90: 7420 7265 6665 7265 6e63 6573 2077 6869  t references whi
-0000eda0: 6368 2068 6176 6520 696e 7661 6c69 6420  ch have invalid 
-0000edb0: 7472 616e 7366 6f72 6d61 7469 6f6e 732e  transformations.
-0000edc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000edd0: 206d 6178 5f70 6f69 6e74 733a 204d 6178   max_points: Max
-0000ede0: 696d 616c 206e 756d 6265 7220 6f66 2076  imal number of v
-0000edf0: 6572 7469 6365 7320 7065 7220 706f 6c79  ertices per poly
-0000ee00: 676f 6e2e 2050 6f6c 7967 6f6e 7320 7769  gon. Polygons wi
-0000ee10: 7468 206d 6f72 6520 7665 7274 6963 6573  th more vertices
-0000ee20: 2074 6861 7420 7468 6973 2061 7265 2061   that this are a
-0000ee30: 7574 6f6d 6174 6963 616c 6c79 2066 7261  utomatically fra
-0000ee40: 6374 7572 6564 2e0a 0a20 2020 2020 2020  ctured...       
-0000ee50: 2020 2020 204f 6173 6973 2073 6574 7469       Oasis setti
-0000ee60: 6e67 733a 0a20 2020 2020 2020 2020 2020  ngs:.           
-0000ee70: 2020 2020 2063 6f6d 7072 6573 7369 6f6e       compression
-0000ee80: 5f6c 6576 656c 3a20 4c65 7665 6c20 6f66  _level: Level of
-0000ee90: 2063 6f6d 7072 6573 7369 6f6e 2066 6f72   compression for
-0000eea0: 2063 656c 6c73 2028 6265 7477 6565 6e20   cells (between 
-0000eeb0: 3020 616e 6420 3929 2e0a 2020 2020 2020  0 and 9)..      
-0000eec0: 2020 2020 2020 2020 2020 2020 2020 5365                Se
-0000eed0: 7474 696e 6720 746f 2030 2077 696c 6c20  tting to 0 will 
-0000eee0: 6469 7361 626c 6520 6365 6c6c 2063 6f6d  disable cell com
-0000eef0: 7072 6573 7369 6f6e 2c20 3120 6769 7665  pression, 1 give
-0000ef00: 7320 7468 6520 6265 7374 2073 7065 6564  s the best speed
-0000ef10: 2061 6e64 2039 2c20 7468 6520 6265 7374   and 9, the best
-0000ef20: 2063 6f6d 7072 6573 7369 6f6e 2e0a 2020   compression..  
-0000ef30: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0000ef40: 7465 6374 5f72 6563 7461 6e67 6c65 733a  tect_rectangles:
-0000ef50: 2053 746f 7265 2072 6563 7461 6e67 6c65   Store rectangle
-0000ef60: 7320 696e 2063 6f6d 7072 6573 7365 6420  s in compressed 
-0000ef70: 666f 726d 6174 2e0a 2020 2020 2020 2020  format..        
-0000ef80: 2020 2020 2020 2020 6465 7465 6374 5f74          detect_t
-0000ef90: 7261 7065 7a6f 6964 733a 2053 746f 7265  rapezoids: Store
-0000efa0: 2074 7261 7065 7a6f 6964 7320 696e 2063   trapezoids in c
-0000efb0: 6f6d 7072 6573 7365 6420 666f 726d 6174  ompressed format
-0000efc0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000efd0: 2020 6369 7263 6c65 5f74 6f6c 6572 616e    circle_toleran
-0000efe0: 6365 3a20 546f 6c65 7261 6e63 6520 666f  ce: Tolerance fo
-0000eff0: 7220 6465 7465 6374 696e 6720 6369 7263  r detecting circ
-0000f000: 6c65 732e 2049 6620 6c65 7373 206f 7220  les. If less or 
-0000f010: 6571 7561 6c20 746f 2030 2c20 6e6f 2064  equal to 0, no d
-0000f020: 6574 6563 7469 6f6e 2069 7320 7065 7266  etection is perf
-0000f030: 6f72 6d65 642e 2043 6972 636c 6573 2061  ormed. Circles a
-0000f040: 7265 2073 746f 7265 6420 696e 2063 6f6d  re stored in com
-0000f050: 7072 6573 7365 6420 666f 726d 6174 2e0a  pressed format..
-0000f060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f070: 7661 6c69 6461 7469 6f6e 2028 2263 7263  validation ("crc
-0000f080: 3332 222c 2022 6368 6563 6b73 756d 3332  32", "checksum32
-0000f090: 222c 204e 6f6e 6529 3a20 7479 7065 206f  ", None): type o
-0000f0a0: 6620 7661 6c69 6461 7469 6f6e 2074 6f20  f validation to 
-0000f0b0: 696e 636c 7564 6520 696e 2074 6865 2073  include in the s
-0000f0c0: 6176 6564 2066 696c 652e 0a20 2020 2020  aved file..     
-0000f0d0: 2020 2020 2020 2020 2020 2073 7461 6e64             stand
-0000f0e0: 6172 645f 7072 6f70 6572 7469 6573 3a20  ard_properties: 
-0000f0f0: 5374 6f72 6520 7374 616e 6461 7264 204f  Store standard O
-0000f100: 4153 4953 2070 726f 7065 7274 6965 7320  ASIS properties 
-0000f110: 696e 2074 6865 2066 696c 652e 0a0a 2020  in the file...  
-0000f120: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-0000f130: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-0000f140: 7279 2e70 646b 2069 6d70 6f72 7420 6765  ry.pdk import ge
-0000f150: 745f 6163 7469 7665 5f70 646b 0a0a 2020  t_active_pdk..  
-0000f160: 2020 2020 2020 6966 2067 6473 7061 7468        if gdspath
-0000f170: 2061 6e64 2067 6473 6469 723a 0a20 2020   and gdsdir:.   
-0000f180: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0000f190: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
-0000f1a0: 2020 2020 2020 2020 2267 6473 7061 7468          "gdspath
-0000f1b0: 2061 6e64 2067 6473 6469 7220 6861 7665   and gdsdir have
-0000f1c0: 2062 6f74 6820 6265 656e 2073 7065 6369   both been speci
-0000f1d0: 6669 6564 2e20 6764 7370 6174 6820 7769  fied. gdspath wi
-0000f1e0: 6c6c 2074 616b 6520 7072 6563 6564 656e  ll take preceden
-0000f1f0: 6365 2061 6e64 2067 6473 6469 7220 7769  ce and gdsdir wi
-0000f200: 6c6c 2062 6520 6967 6e6f 7265 642e 220a  ll be ignored.".
-0000f210: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0000f220: 2020 2020 2020 2064 6566 6175 6c74 5f73         default_s
-0000f230: 6574 7469 6e67 7320 3d20 6765 745f 6163  ettings = get_ac
-0000f240: 7469 7665 5f70 646b 2829 2e67 6473 5f77  tive_pdk().gds_w
-0000f250: 7269 7465 5f73 6574 7469 6e67 730a 2020  rite_settings.  
-0000f260: 2020 2020 2020 6465 6661 756c 745f 6f61        default_oa
-0000f270: 7369 735f 7365 7474 696e 6773 203d 2067  sis_settings = g
-0000f280: 6574 5f61 6374 6976 655f 7064 6b28 292e  et_active_pdk().
-0000f290: 6f61 7369 735f 7365 7474 696e 6773 0a0a  oasis_settings..
-0000f2a0: 2020 2020 2020 2020 6578 706c 6963 6974          explicit
-0000f2b0: 5f67 6473 5f73 6574 7469 6e67 7320 3d20  _gds_settings = 
-0000f2c0: 7b0a 2020 2020 2020 2020 2020 2020 6b3a  {.            k:
-0000f2d0: 2076 0a20 2020 2020 2020 2020 2020 2066   v.            f
-0000f2e0: 6f72 206b 2c20 7620 696e 206b 7761 7267  or k, v in kwarg
-0000f2f0: 732e 6974 656d 7328 290a 2020 2020 2020  s.items().      
-0000f300: 2020 2020 2020 6966 2076 2069 7320 6e6f        if v is no
-0000f310: 7420 4e6f 6e65 2061 6e64 206b 2069 6e20  t None and k in 
-0000f320: 6465 6661 756c 745f 7365 7474 696e 6773  default_settings
-0000f330: 2e64 6963 7428 290a 2020 2020 2020 2020  .dict().        
-0000f340: 7d0a 2020 2020 2020 2020 6578 706c 6963  }.        explic
-0000f350: 6974 5f6f 6173 5f73 6574 7469 6e67 7320  it_oas_settings 
-0000f360: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-0000f370: 6b3a 2076 0a20 2020 2020 2020 2020 2020  k: v.           
-0000f380: 2066 6f72 206b 2c20 7620 696e 206b 7761   for k, v in kwa
-0000f390: 7267 732e 6974 656d 7328 290a 2020 2020  rgs.items().    
-0000f3a0: 2020 2020 2020 2020 6966 2076 2069 7320          if v is 
-0000f3b0: 6e6f 7420 4e6f 6e65 2061 6e64 206b 2069  not None and k i
-0000f3c0: 6e20 6465 6661 756c 745f 6f61 7369 735f  n default_oasis_
-0000f3d0: 7365 7474 696e 6773 2e64 6963 7428 290a  settings.dict().
-0000f3e0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-0000f3f0: 2020 2320 7570 6461 7465 2074 6865 2077    # update the w
-0000f400: 7269 7465 2073 6574 7469 6e67 7320 7769  rite settings wi
-0000f410: 7468 2061 6e79 2073 6574 7469 6e67 7320  th any settings 
-0000f420: 6578 706c 6963 6974 6c79 2070 6173 7365  explicitly passe
-0000f430: 640a 2020 2020 2020 2020 7772 6974 655f  d.        write_
-0000f440: 7365 7474 696e 6773 203d 2064 6566 6175  settings = defau
-0000f450: 6c74 5f73 6574 7469 6e67 732e 636f 7079  lt_settings.copy
-0000f460: 2875 7064 6174 653d 6578 706c 6963 6974  (update=explicit
-0000f470: 5f67 6473 5f73 6574 7469 6e67 7329 0a20  _gds_settings). 
-0000f480: 2020 2020 2020 206f 6173 6973 5f73 6574         oasis_set
-0000f490: 7469 6e67 7320 3d20 6465 6661 756c 745f  tings = default_
-0000f4a0: 6f61 7369 735f 7365 7474 696e 6773 2e63  oasis_settings.c
-0000f4b0: 6f70 7928 7570 6461 7465 3d65 7870 6c69  opy(update=expli
-0000f4c0: 6369 745f 6f61 735f 7365 7474 696e 6773  cit_oas_settings
-0000f4d0: 290a 0a20 2020 2020 2020 205f 6368 6563  )..        _chec
-0000f4e0: 6b5f 756e 6361 6368 6564 5f63 6f6d 706f  k_uncached_compo
-0000f4f0: 6e65 6e74 7328 0a20 2020 2020 2020 2020  nents(.         
-0000f500: 2020 2063 6f6d 706f 6e65 6e74 3d73 656c     component=sel
-0000f510: 662c 206d 6f64 653d 7772 6974 655f 7365  f, mode=write_se
-0000f520: 7474 696e 6773 2e6f 6e5f 756e 6361 6368  ttings.on_uncach
-0000f530: 6564 5f63 6f6d 706f 6e65 6e74 0a20 2020  ed_component.   
-0000f540: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0000f550: 6966 2077 7269 7465 5f73 6574 7469 6e67  if write_setting
-0000f560: 732e 666c 6174 7465 6e5f 696e 7661 6c69  s.flatten_invali
-0000f570: 645f 7265 6673 3a0a 2020 2020 2020 2020  d_refs:.        
-0000f580: 2020 2020 746f 705f 6365 6c6c 203d 2066      top_cell = f
-0000f590: 6c61 7474 656e 5f69 6e76 616c 6964 5f72  latten_invalid_r
-0000f5a0: 6566 735f 7265 6375 7273 6976 6528 7365  efs_recursive(se
-0000f5b0: 6c66 290a 2020 2020 2020 2020 656c 7365  lf).        else
-0000f5c0: 3a0a 2020 2020 2020 2020 2020 2020 746f  :.            to
-0000f5d0: 705f 6365 6c6c 203d 2073 656c 660a 0a20  p_cell = self.. 
-0000f5e0: 2020 2020 2020 2067 6473 6469 7220 3d20         gdsdir = 
-0000f5f0: 6764 7364 6972 206f 7220 4744 5344 4952  gdsdir or GDSDIR
-0000f600: 5f54 454d 500a 2020 2020 2020 2020 6764  _TEMP.        gd
-0000f610: 7364 6972 203d 2070 6174 686c 6962 2e50  sdir = pathlib.P
-0000f620: 6174 6828 6764 7364 6972 290a 2020 2020  ath(gdsdir).    
-0000f630: 2020 2020 6966 2077 6974 685f 6f61 7369      if with_oasi
-0000f640: 733a 0a20 2020 2020 2020 2020 2020 2067  s:.            g
-0000f650: 6473 7061 7468 203d 2067 6473 7061 7468  dspath = gdspath
-0000f660: 206f 7220 6764 7364 6972 202f 2066 227b   or gdsdir / f"{
-0000f670: 746f 705f 6365 6c6c 2e6e 616d 657d 2e6f  top_cell.name}.o
-0000f680: 6173 220a 2020 2020 2020 2020 656c 7365  as".        else
-0000f690: 3a0a 2020 2020 2020 2020 2020 2020 6764  :.            gd
-0000f6a0: 7370 6174 6820 3d20 6764 7370 6174 6820  spath = gdspath 
-0000f6b0: 6f72 2067 6473 6469 7220 2f20 6622 7b74  or gdsdir / f"{t
-0000f6c0: 6f70 5f63 656c 6c2e 6e61 6d65 7d2e 6764  op_cell.name}.gd
-0000f6d0: 7322 0a20 2020 2020 2020 2067 6473 7061  s".        gdspa
-0000f6e0: 7468 203d 2070 6174 686c 6962 2e50 6174  th = pathlib.Pat
-0000f6f0: 6828 6764 7370 6174 6829 0a20 2020 2020  h(gdspath).     
-0000f700: 2020 2067 6473 6469 7220 3d20 6764 7370     gdsdir = gdsp
-0000f710: 6174 682e 7061 7265 6e74 0a20 2020 2020  ath.parent.     
-0000f720: 2020 2067 6473 6469 722e 6d6b 6469 7228     gdsdir.mkdir(
-0000f730: 6578 6973 745f 6f6b 3d54 7275 652c 2070  exist_ok=True, p
-0000f740: 6172 656e 7473 3d54 7275 6529 0a0a 2020  arents=True)..  
-0000f750: 2020 2020 2020 6365 6c6c 7320 3d20 746f        cells = to
-0000f760: 705f 6365 6c6c 2e67 6574 5f64 6570 656e  p_cell.get_depen
-0000f770: 6465 6e63 6965 7328 7265 6375 7273 6976  dencies(recursiv
-0000f780: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-0000f790: 6365 6c6c 5f6e 616d 6573 203d 205b 6365  cell_names = [ce
-0000f7a0: 6c6c 2e6e 616d 6520 666f 7220 6365 6c6c  ll.name for cell
-0000f7b0: 2069 6e20 6c69 7374 2863 656c 6c73 295d   in list(cells)]
-0000f7c0: 0a20 2020 2020 2020 2063 656c 6c5f 6e61  .        cell_na
-0000f7d0: 6d65 735f 756e 6971 7565 203d 2073 6574  mes_unique = set
-0000f7e0: 2863 656c 6c5f 6e61 6d65 7329 0a0a 2020  (cell_names)..  
-0000f7f0: 2020 2020 2020 6966 206c 656e 2863 656c        if len(cel
-0000f800: 6c5f 6e61 6d65 7329 2021 3d20 6c65 6e28  l_names) != len(
-0000f810: 7365 7428 6365 6c6c 5f6e 616d 6573 2929  set(cell_names))
-0000f820: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-0000f830: 7220 6365 6c6c 5f6e 616d 6520 696e 2063  r cell_name in c
-0000f840: 656c 6c5f 6e61 6d65 735f 756e 6971 7565  ell_names_unique
-0000f850: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f860: 2020 6365 6c6c 5f6e 616d 6573 2e72 656d    cell_names.rem
-0000f870: 6f76 6528 6365 6c6c 5f6e 616d 6529 0a0a  ove(cell_name)..
-0000f880: 2020 2020 2020 2020 2020 2020 6966 2077              if w
-0000f890: 7269 7465 5f73 6574 7469 6e67 732e 6f6e  rite_settings.on
-0000f8a0: 5f64 7570 6c69 6361 7465 5f63 656c 6c20  _duplicate_cell 
-0000f8b0: 3d3d 2022 6572 726f 7222 3a0a 2020 2020  == "error":.    
-0000f8c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000f8d0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-0000f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f8f0: 2020 6622 4475 706c 6963 6174 6564 2063    f"Duplicated c
-0000f900: 656c 6c20 6e61 6d65 7320 696e 207b 746f  ell names in {to
-0000f910: 705f 6365 6c6c 2e6e 616d 6521 727d 3a20  p_cell.name!r}: 
-0000f920: 7b63 656c 6c5f 6e61 6d65 7321 727d 220a  {cell_names!r}".
-0000f930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f940: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0000f950: 6966 2077 7269 7465 5f73 6574 7469 6e67  if write_setting
-0000f960: 732e 6f6e 5f64 7570 6c69 6361 7465 5f63  s.on_duplicate_c
-0000f970: 656c 6c20 696e 207b 2277 6172 6e22 2c20  ell in {"warn", 
-0000f980: 226f 7665 7277 7269 7465 227d 3a0a 2020  "overwrite"}:.  
-0000f990: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000f9a0: 2077 7269 7465 5f73 6574 7469 6e67 732e   write_settings.
-0000f9b0: 6f6e 5f64 7570 6c69 6361 7465 5f63 656c  on_duplicate_cel
-0000f9c0: 6c20 3d3d 2022 7761 726e 223a 0a20 2020  l == "warn":.   
-0000f9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f9e0: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
-0000f9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa00: 2020 2020 2020 2020 6622 4475 706c 6963          f"Duplic
-0000fa10: 6174 6564 2063 656c 6c20 6e61 6d65 7320  ated cell names 
-0000fa20: 696e 207b 746f 705f 6365 6c6c 2e6e 616d  in {top_cell.nam
-0000fa30: 6521 727d 3a20 207b 6365 6c6c 5f6e 616d  e!r}:  {cell_nam
-0000fa40: 6573 7d22 2c0a 2020 2020 2020 2020 2020  es}",.          
-0000fa50: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000fa60: 2020 2020 2020 2020 2020 2020 6365 6c6c              cell
-0000fa70: 735f 6469 6374 203d 207b 6365 6c6c 2e6e  s_dict = {cell.n
-0000fa80: 616d 653a 2063 656c 6c2e 5f63 656c 6c20  ame: cell._cell 
-0000fa90: 666f 7220 6365 6c6c 2069 6e20 6365 6c6c  for cell in cell
-0000faa0: 737d 0a20 2020 2020 2020 2020 2020 2020  s}.             
-0000fab0: 2020 2063 656c 6c73 203d 2063 656c 6c73     cells = cells
-0000fac0: 5f64 6963 742e 7661 6c75 6573 2829 0a20  _dict.values(). 
-0000fad0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0000fae0: 7772 6974 655f 7365 7474 696e 6773 2e6f  write_settings.o
-0000faf0: 6e5f 6475 706c 6963 6174 655f 6365 6c6c  n_duplicate_cell
-0000fb00: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0000fb10: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0000fb20: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-0000fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb40: 2020 2020 6622 6f6e 5f64 7570 6c69 6361      f"on_duplica
-0000fb50: 7465 5f63 656c 6c3a 207b 7772 6974 655f  te_cell: {write_
-0000fb60: 7365 7474 696e 6773 2e6f 6e5f 6475 706c  settings.on_dupl
-0000fb70: 6963 6174 655f 6365 6c6c 2172 7d20 6e6f  icate_cell!r} no
-0000fb80: 7420 696e 2028 4e6f 6e65 2c20 7761 726e  t in (None, warn
-0000fb90: 2c20 6572 726f 722c 206f 7665 7277 7269  , error, overwri
-0000fba0: 7465 2922 0a20 2020 2020 2020 2020 2020  te)".           
-0000fbb0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0000fbc0: 616c 6c5f 6365 6c6c 7320 3d20 5b74 6f70  all_cells = [top
-0000fbd0: 5f63 656c 6c2e 5f63 656c 6c5d 202b 2073  _cell._cell] + s
-0000fbe0: 6f72 7465 6428 6365 6c6c 732c 206b 6579  orted(cells, key
-0000fbf0: 3d6c 616d 6264 6120 6363 3a20 6363 2e6e  =lambda cc: cc.n
-0000fc00: 616d 6529 0a0a 2020 2020 2020 2020 6e6f  ame)..        no
-0000fc10: 5f6e 616d 655f 6365 6c6c 7320 3d20 5b0a  _name_cells = [.
-0000fc20: 2020 2020 2020 2020 2020 2020 6365 6c6c              cell
-0000fc30: 2e6e 616d 6520 666f 7220 6365 6c6c 2069  .name for cell i
-0000fc40: 6e20 616c 6c5f 6365 6c6c 7320 6966 2063  n all_cells if c
-0000fc50: 656c 6c2e 6e61 6d65 2e73 7461 7274 7377  ell.name.startsw
-0000fc60: 6974 6828 2255 6e6e 616d 6564 2229 0a20  ith("Unnamed"). 
-0000fc70: 2020 2020 2020 205d 0a0a 2020 2020 2020         ]..      
-0000fc80: 2020 6966 206e 6f5f 6e61 6d65 5f63 656c    if no_name_cel
-0000fc90: 6c73 3a0a 2020 2020 2020 2020 2020 2020  ls:.            
-0000fca0: 7761 726e 696e 6773 2e77 6172 6e28 0a20  warnings.warn(. 
-0000fcb0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000fcc0: 2243 6f6d 706f 6e65 6e74 207b 746f 705f  "Component {top_
-0000fcd0: 6365 6c6c 2e6e 616d 6521 727d 2063 6f6e  cell.name!r} con
-0000fce0: 7461 696e 7320 7b6c 656e 286e 6f5f 6e61  tains {len(no_na
-0000fcf0: 6d65 5f63 656c 6c73 297d 2055 6e6e 616d  me_cells)} Unnam
-0000fd00: 6564 2063 656c 6c73 220a 2020 2020 2020  ed cells".      
-0000fd10: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000fd20: 2023 2066 6f72 2063 656c 6c20 696e 2061   # for cell in a
-0000fd30: 6c6c 5f63 656c 6c73 3a0a 2020 2020 2020  ll_cells:.      
-0000fd40: 2020 2320 2020 2020 7072 696e 7428 6365    #     print(ce
-0000fd50: 6c6c 2e6e 616d 652c 2074 7970 6528 6365  ll.name, type(ce
-0000fd60: 6c6c 2929 0a0a 2020 2020 2020 2020 6c69  ll))..        li
-0000fd70: 6220 3d20 6764 7374 6b2e 4c69 6272 6172  b = gdstk.Librar
-0000fd80: 7928 0a20 2020 2020 2020 2020 2020 2075  y(.            u
-0000fd90: 6e69 743d 7772 6974 655f 7365 7474 696e  nit=write_settin
-0000fda0: 6773 2e75 6e69 742c 2070 7265 6369 7369  gs.unit, precisi
-0000fdb0: 6f6e 3d77 7269 7465 5f73 6574 7469 6e67  on=write_setting
-0000fdc0: 732e 7072 6563 6973 696f 6e0a 2020 2020  s.precision.    
-0000fdd0: 2020 2020 290a 2020 2020 2020 2020 6c69      ).        li
-0000fde0: 622e 6164 6428 746f 705f 6365 6c6c 2e5f  b.add(top_cell._
-0000fdf0: 6365 6c6c 290a 2020 2020 2020 2020 6c69  cell).        li
-0000fe00: 622e 6164 6428 2a74 6f70 5f63 656c 6c2e  b.add(*top_cell.
-0000fe10: 5f63 656c 6c2e 6465 7065 6e64 656e 6369  _cell.dependenci
-0000fe20: 6573 2854 7275 6529 290a 0a20 2020 2020  es(True))..     
-0000fe30: 2020 2069 6620 7769 7468 5f6f 6173 6973     if with_oasis
-0000fe40: 3a0a 2020 2020 2020 2020 2020 2020 6c69  :.            li
-0000fe50: 622e 7772 6974 655f 6f61 7328 6764 7370  b.write_oas(gdsp
-0000fe60: 6174 682c 202a 2a6f 6173 6973 5f73 6574  ath, **oasis_set
-0000fe70: 7469 6e67 732e 6469 6374 2829 290a 2020  tings.dict()).  
-0000fe80: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000fe90: 2020 2020 2020 2020 6c69 622e 7772 6974          lib.writ
-0000fea0: 655f 6764 7328 0a20 2020 2020 2020 2020  e_gds(.         
-0000feb0: 2020 2020 2020 2067 6473 7061 7468 2c20         gdspath, 
-0000fec0: 7469 6d65 7374 616d 703d 7469 6d65 7374  timestamp=timest
-0000fed0: 616d 702c 206d 6178 5f70 6f69 6e74 733d  amp, max_points=
-0000fee0: 7772 6974 655f 7365 7474 696e 6773 2e6d  write_settings.m
-0000fef0: 6178 5f70 6f69 6e74 730a 2020 2020 2020  ax_points.      
-0000ff00: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000ff10: 6966 206c 6f67 6769 6e67 3a0a 2020 2020  if logging:.    
-0000ff20: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
-0000ff30: 6e66 6f28 6622 5772 6f74 6520 746f 207b  nfo(f"Wrote to {
-0000ff40: 7374 7228 6764 7370 6174 6829 2172 7d22  str(gdspath)!r}"
-0000ff50: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0000ff60: 2067 6473 7061 7468 0a0a 2020 2020 6465   gdspath..    de
-0000ff70: 6620 7772 6974 655f 6764 7328 0a20 2020  f write_gds(.   
-0000ff80: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0000ff90: 2020 2067 6473 7061 7468 3a20 4f70 7469     gdspath: Opti
-0000ffa0: 6f6e 616c 5b50 6174 6854 7970 655d 203d  onal[PathType] =
-0000ffb0: 204e 6f6e 652c 0a20 2020 2020 2020 2067   None,.        g
-0000ffc0: 6473 6469 723a 204f 7074 696f 6e61 6c5b  dsdir: Optional[
-0000ffd0: 5061 7468 5479 7065 5d20 3d20 4e6f 6e65  PathType] = None
-0000ffe0: 2c0a 2020 2020 2020 2020 2a2a 6b77 6172  ,.        **kwar
-0000fff0: 6773 2c0a 2020 2020 2920 2d3e 2050 6174  gs,.    ) -> Pat
-00010000: 683a 0a20 2020 2020 2020 2022 2222 5772  h:.        """Wr
-00010010: 6974 6520 636f 6d70 6f6e 656e 7420 746f  ite component to
-00010020: 2047 4453 2061 6e64 2072 6574 7572 6e73   GDS and returns
-00010030: 2067 6473 7061 7468 2e0a 0a20 2020 2020   gdspath...     
-00010040: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00010050: 2020 2020 2067 6473 7061 7468 3a20 4744       gdspath: GD
-00010060: 5320 6669 6c65 2070 6174 6820 746f 2077  S file path to w
-00010070: 7269 7465 2074 6f2e 0a20 2020 2020 2020  rite to..       
-00010080: 2020 2020 2067 6473 6469 723a 2064 6972       gdsdir: dir
-00010090: 6563 746f 7279 2066 6f72 2074 6865 2047  ectory for the G
-000100a0: 4453 2066 696c 652e 2044 6566 6175 6c74  DS file. Default
-000100b0: 7320 746f 202f 746d 702f 7261 6e64 6f6d  s to /tmp/random
-000100c0: 4669 6c65 2f67 6473 6661 6374 6f72 792e  File/gdsfactory.
-000100d0: 0a0a 2020 2020 2020 2020 4b65 7977 6f72  ..        Keywor
-000100e0: 6420 4172 6773 3a0a 2020 2020 2020 2020  d Args:.        
-000100f0: 2020 2020 756e 6974 3a20 756e 6974 2073      unit: unit s
-00010100: 697a 6520 666f 7220 6f62 6a65 6374 7320  ize for objects 
-00010110: 696e 206c 6962 7261 7279 2e20 3175 6d20  in library. 1um 
-00010120: 6279 2064 6566 6175 6c74 2e0a 2020 2020  by default..    
-00010130: 2020 2020 2020 2020 7072 6563 6973 696f          precisio
-00010140: 6e3a 2066 6f72 2064 696d 656e 7369 6f6e  n: for dimension
-00010150: 7320 696e 2074 6865 206c 6962 7261 7279  s in the library
-00010160: 2028 6d29 2e20 316e 6d20 6279 2064 6566   (m). 1nm by def
-00010170: 6175 6c74 2e0a 2020 2020 2020 2020 2020  ault..          
-00010180: 2020 6c6f 6767 696e 673a 2064 6973 6162    logging: disab
-00010190: 6c65 2047 4453 2070 6174 6820 6c6f 6767  le GDS path logg
-000101a0: 696e 672c 2066 6f72 2065 7861 6d70 6c65  ing, for example
-000101b0: 2066 6f72 2073 686f 7769 6e67 2069 7420   for showing it 
-000101c0: 696e 204b 4c61 796f 7574 2e0a 2020 2020  in KLayout..    
-000101d0: 2020 2020 2020 2020 6f6e 5f64 7570 6c69          on_dupli
-000101e0: 6361 7465 5f63 656c 6c3a 2073 7065 6369  cate_cell: speci
-000101f0: 6679 2068 6f77 2074 6f20 7265 736f 6c76  fy how to resolv
-00010200: 6520 6475 706c 6963 6174 652d 6e61 6d65  e duplicate-name
-00010210: 6420 6365 6c6c 732e 2043 686f 6f73 6520  d cells. Choose 
-00010220: 6f6e 6520 6f66 2074 6865 2066 6f6c 6c6f  one of the follo
-00010230: 7769 6e67 3a0a 2020 2020 2020 2020 2020  wing:.          
-00010240: 2020 2020 2020 2277 6172 6e22 2028 6465        "warn" (de
-00010250: 6661 756c 7429 3a20 6f76 6572 7772 6974  fault): overwrit
-00010260: 6520 616c 6c20 6475 706c 6963 6174 6520  e all duplicate 
-00010270: 6365 6c6c 7320 7769 7468 206f 6e65 206f  cells with one o
-00010280: 6620 7468 6520 6475 706c 6963 6174 6573  f the duplicates
-00010290: 2028 6172 6269 7472 6172 696c 7929 2e0a   (arbitrarily)..
-000102a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000102b0: 2265 7272 6f72 223a 2074 6872 6f77 2061  "error": throw a
-000102c0: 2056 616c 7565 4572 726f 7220 7768 656e   ValueError when
-000102d0: 2061 7474 656d 7074 696e 6720 746f 2077   attempting to w
-000102e0: 7269 7465 2061 2067 6473 2077 6974 6820  rite a gds with 
-000102f0: 6475 706c 6963 6174 6520 6365 6c6c 732e  duplicate cells.
-00010300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010310: 2022 6f76 6572 7772 6974 6522 3a20 6f76   "overwrite": ov
-00010320: 6572 7772 6974 6520 616c 6c20 6475 706c  erwrite all dupl
-00010330: 6963 6174 6520 6365 6c6c 7320 7769 7468  icate cells with
-00010340: 206f 6e65 206f 6620 7468 6520 6475 706c   one of the dupl
-00010350: 6963 6174 6573 2c20 7769 7468 6f75 7420  icates, without 
-00010360: 7761 726e 696e 672e 0a20 2020 2020 2020  warning..       
-00010370: 2020 2020 206f 6e5f 756e 6361 6368 6564       on_uncached
-00010380: 5f63 6f6d 706f 6e65 6e74 3a20 4c69 7465  _component: Lite
-00010390: 7261 6c5b 2277 6172 6e22 2c20 2265 7272  ral["warn", "err
-000103a0: 6f72 225d 203d 2022 7761 726e 220a 2020  or"] = "warn".  
-000103b0: 2020 2020 2020 2020 2020 666c 6174 7465            flatte
-000103c0: 6e5f 696e 7661 6c69 645f 7265 6673 3a20  n_invalid_refs: 
-000103d0: 666c 6174 7465 6e73 2063 6f6d 706f 6e65  flattens compone
-000103e0: 6e74 2072 6566 6572 656e 6365 7320 7768  nt references wh
-000103f0: 6963 6820 6861 7665 2069 6e76 616c 6964  ich have invalid
-00010400: 2074 7261 6e73 666f 726d 6174 696f 6e73   transformations
-00010410: 2e0a 2020 2020 2020 2020 2020 2020 6d61  ..            ma
-00010420: 785f 706f 696e 7473 3a20 4d61 7869 6d61  x_points: Maxima
-00010430: 6c20 6e75 6d62 6572 206f 6620 7665 7274  l number of vert
-00010440: 6963 6573 2070 6572 2070 6f6c 7967 6f6e  ices per polygon
-00010450: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010460: 2020 506f 6c79 676f 6e73 2077 6974 6820    Polygons with 
-00010470: 6d6f 7265 2076 6572 7469 6365 7320 7468  more vertices th
-00010480: 6174 2074 6869 7320 6172 6520 6175 746f  at this are auto
-00010490: 6d61 7469 6361 6c6c 7920 6672 6163 7475  matically fractu
-000104a0: 7265 642e 0a20 2020 2020 2020 2022 2222  red..        """
-000104b0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000104c0: 2073 656c 662e 5f77 7269 7465 5f6c 6962   self._write_lib
-000104d0: 7261 7279 280a 2020 2020 2020 2020 2020  rary(.          
-000104e0: 2020 6764 7370 6174 683d 6764 7370 6174    gdspath=gdspat
-000104f0: 682c 2067 6473 6469 723d 6764 7364 6972  h, gdsdir=gdsdir
-00010500: 2c20 7769 7468 5f6f 6173 6973 3d46 616c  , with_oasis=Fal
-00010510: 7365 2c20 2a2a 6b77 6172 6773 0a20 2020  se, **kwargs.   
-00010520: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00010530: 7772 6974 655f 6f61 7328 0a20 2020 2020  write_oas(.     
-00010540: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00010550: 2067 6473 7061 7468 3a20 4f70 7469 6f6e   gdspath: Option
-00010560: 616c 5b50 6174 6854 7970 655d 203d 204e  al[PathType] = N
-00010570: 6f6e 652c 0a20 2020 2020 2020 2067 6473  one,.        gds
-00010580: 6469 723a 204f 7074 696f 6e61 6c5b 5061  dir: Optional[Pa
-00010590: 7468 5479 7065 5d20 3d20 4e6f 6e65 2c0a  thType] = None,.
-000105a0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-000105b0: 2c0a 2020 2020 2920 2d3e 2050 6174 683a  ,.    ) -> Path:
-000105c0: 0a20 2020 2020 2020 2022 2222 5772 6974  .        """Writ
-000105d0: 6520 636f 6d70 6f6e 656e 7420 746f 2047  e component to G
-000105e0: 4453 2061 6e64 2072 6574 7572 6e73 2067  DS and returns g
-000105f0: 6473 7061 7468 2e0a 0a20 2020 2020 2020  dspath...       
-00010600: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00010610: 2020 2067 6473 7061 7468 3a20 4744 5320     gdspath: GDS 
-00010620: 6669 6c65 2070 6174 6820 746f 2077 7269  file path to wri
-00010630: 7465 2074 6f2e 0a20 2020 2020 2020 2020  te to..         
-00010640: 2020 2067 6473 6469 723a 2064 6972 6563     gdsdir: direc
-00010650: 746f 7279 2066 6f72 2074 6865 2047 4453  tory for the GDS
-00010660: 2066 696c 652e 2044 6566 6175 6c74 7320   file. Defaults 
-00010670: 746f 202f 746d 702f 7261 6e64 6f6d 4669  to /tmp/randomFi
-00010680: 6c65 2f67 6473 6661 6374 6f72 792e 0a0a  le/gdsfactory...
-00010690: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
-000106a0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-000106b0: 2020 756e 6974 3a20 756e 6974 2073 697a    unit: unit siz
-000106c0: 6520 666f 7220 6f62 6a65 6374 7320 696e  e for objects in
-000106d0: 206c 6962 7261 7279 2e20 3175 6d20 6279   library. 1um by
-000106e0: 2064 6566 6175 6c74 2e0a 2020 2020 2020   default..      
-000106f0: 2020 2020 2020 7072 6563 6973 696f 6e3a        precision:
-00010700: 2066 6f72 2064 696d 656e 7369 6f6e 7320   for dimensions 
-00010710: 696e 2074 6865 206c 6962 7261 7279 2028  in the library (
-00010720: 6d29 2e20 316e 6d20 6279 2064 6566 6175  m). 1nm by defau
-00010730: 6c74 2e0a 2020 2020 2020 2020 2020 2020  lt..            
-00010740: 6c6f 6767 696e 673a 2064 6973 6162 6c65  logging: disable
-00010750: 2047 4453 2070 6174 6820 6c6f 6767 696e   GDS path loggin
-00010760: 672c 2066 6f72 2065 7861 6d70 6c65 2066  g, for example f
-00010770: 6f72 2073 686f 7769 6e67 2069 7420 696e  or showing it in
-00010780: 204b 4c61 796f 7574 2e0a 2020 2020 2020   KLayout..      
-00010790: 2020 2020 2020 6f6e 5f64 7570 6c69 6361        on_duplica
-000107a0: 7465 5f63 656c 6c3a 2073 7065 6369 6679  te_cell: specify
-000107b0: 2068 6f77 2074 6f20 7265 736f 6c76 6520   how to resolve 
-000107c0: 6475 706c 6963 6174 652d 6e61 6d65 6420  duplicate-named 
-000107d0: 6365 6c6c 732e 2043 686f 6f73 6520 6f6e  cells. Choose on
-000107e0: 6520 6f66 2074 6865 2066 6f6c 6c6f 7769  e of the followi
-000107f0: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
-00010800: 2020 2020 2277 6172 6e22 2028 6465 6661      "warn" (defa
-00010810: 756c 7429 3a20 6f76 6572 7772 6974 6520  ult): overwrite 
-00010820: 616c 6c20 6475 706c 6963 6174 6520 6365  all duplicate ce
-00010830: 6c6c 7320 7769 7468 206f 6e65 206f 6620  lls with one of 
-00010840: 7468 6520 6475 706c 6963 6174 6573 2028  the duplicates (
-00010850: 6172 6269 7472 6172 696c 7929 2e0a 2020  arbitrarily)..  
-00010860: 2020 2020 2020 2020 2020 2020 2020 2265                "e
-00010870: 7272 6f72 223a 2074 6872 6f77 2061 2056  rror": throw a V
-00010880: 616c 7565 4572 726f 7220 7768 656e 2061  alueError when a
-00010890: 7474 656d 7074 696e 6720 746f 2077 7269  ttempting to wri
-000108a0: 7465 2061 2067 6473 2077 6974 6820 6475  te a gds with du
-000108b0: 706c 6963 6174 6520 6365 6c6c 732e 0a20  plicate cells.. 
-000108c0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000108d0: 6f76 6572 7772 6974 6522 3a20 6f76 6572  overwrite": over
-000108e0: 7772 6974 6520 616c 6c20 6475 706c 6963  write all duplic
-000108f0: 6174 6520 6365 6c6c 7320 7769 7468 206f  ate cells with o
-00010900: 6e65 206f 6620 7468 6520 6475 706c 6963  ne of the duplic
-00010910: 6174 6573 2c20 7769 7468 6f75 7420 7761  ates, without wa
-00010920: 726e 696e 672e 0a20 2020 2020 2020 2020  rning..         
-00010930: 2020 2020 2020 204e 6f6e 653a 2064 6f20         None: do 
-00010940: 6e6f 7420 7472 7920 746f 2072 6573 6f6c  not try to resol
-00010950: 7665 2028 6174 2079 6f75 7220 6f77 6e20  ve (at your own 
-00010960: 7269 736b 2129 0a20 2020 2020 2020 2020  risk!).         
-00010970: 2020 206f 6e5f 756e 6361 6368 6564 5f63     on_uncached_c
-00010980: 6f6d 706f 6e65 6e74 3a20 4c69 7465 7261  omponent: Litera
-00010990: 6c5b 2277 6172 6e22 2c20 2265 7272 6f72  l["warn", "error
-000109a0: 225d 203d 2022 7761 726e 220a 2020 2020  "] = "warn".    
-000109b0: 2020 2020 2020 2020 666c 6174 7465 6e5f          flatten_
-000109c0: 696e 7661 6c69 645f 7265 6673 3a20 666c  invalid_refs: fl
-000109d0: 6174 7465 6e73 2063 6f6d 706f 6e65 6e74  attens component
-000109e0: 2072 6566 6572 656e 6365 7320 7768 6963   references whic
-000109f0: 6820 6861 7665 2069 6e76 616c 6964 2074  h have invalid t
-00010a00: 7261 6e73 666f 726d 6174 696f 6e73 2e0a  ransformations..
-00010a10: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00010a20: 7265 7373 696f 6e5f 6c65 7665 6c3a 204c  ression_level: L
-00010a30: 6576 656c 206f 6620 636f 6d70 7265 7373  evel of compress
-00010a40: 696f 6e20 666f 7220 6365 6c6c 7320 2862  ion for cells (b
-00010a50: 6574 7765 656e 2030 2061 6e64 2039 292e  etween 0 and 9).
-00010a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010a70: 2053 6574 7469 6e67 2074 6f20 3020 7769   Setting to 0 wi
-00010a80: 6c6c 2064 6973 6162 6c65 2063 656c 6c20  ll disable cell 
-00010a90: 636f 6d70 7265 7373 696f 6e2c 2031 2067  compression, 1 g
-00010aa0: 6976 6573 2074 6865 2062 6573 7420 7370  ives the best sp
-00010ab0: 6565 6420 616e 6420 392c 2074 6865 2062  eed and 9, the b
-00010ac0: 6573 7420 636f 6d70 7265 7373 696f 6e2e  est compression.
-00010ad0: 0a20 2020 2020 2020 2020 2020 2064 6574  .            det
-00010ae0: 6563 745f 7265 6374 616e 676c 6573 3a20  ect_rectangles: 
-00010af0: 5374 6f72 6520 7265 6374 616e 676c 6573  Store rectangles
-00010b00: 2069 6e20 636f 6d70 7265 7373 6564 2066   in compressed f
-00010b10: 6f72 6d61 742e 0a20 2020 2020 2020 2020  ormat..         
-00010b20: 2020 2064 6574 6563 745f 7472 6170 657a     detect_trapez
-00010b30: 6f69 6473 3a20 5374 6f72 6520 7472 6170  oids: Store trap
-00010b40: 657a 6f69 6473 2069 6e20 636f 6d70 7265  ezoids in compre
-00010b50: 7373 6564 2066 6f72 6d61 742e 0a20 2020  ssed format..   
-00010b60: 2020 2020 2020 2020 2063 6972 636c 655f           circle_
-00010b70: 746f 6c65 7261 6e63 653a 2054 6f6c 6572  tolerance: Toler
-00010b80: 616e 6365 2066 6f72 2064 6574 6563 7469  ance for detecti
-00010b90: 6e67 2063 6972 636c 6573 2e20 4966 206c  ng circles. If l
-00010ba0: 6573 7320 6f72 2065 7175 616c 2074 6f20  ess or equal to 
-00010bb0: 302c 206e 6f20 6465 7465 6374 696f 6e20  0, no detection 
-00010bc0: 6973 2070 6572 666f 726d 6564 2e0a 2020  is performed..  
-00010bd0: 2020 2020 2020 2020 2020 2020 2020 4369                Ci
-00010be0: 7263 6c65 7320 6172 6520 7374 6f72 6564  rcles are stored
-00010bf0: 2069 6e20 636f 6d70 7265 7373 6564 2066   in compressed f
-00010c00: 6f72 6d61 742e 0a20 2020 2020 2020 2020  ormat..         
-00010c10: 2020 2076 616c 6964 6174 696f 6e20 2822     validation ("
-00010c20: 6372 6333 3222 2c20 2263 6865 636b 7375  crc32", "checksu
-00010c30: 6d33 3222 2c20 4e6f 6e65 2920 e280 9320  m32", None) ... 
-00010c40: 7479 7065 206f 6620 7661 6c69 6461 7469  type of validati
-00010c50: 6f6e 2074 6f20 696e 636c 7564 6520 696e  on to include in
-00010c60: 2074 6865 2073 6176 6564 2066 696c 652e   the saved file.
-00010c70: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
-00010c80: 6e64 6172 645f 7072 6f70 6572 7469 6573  ndard_properties
-00010c90: 3a20 5374 6f72 6520 7374 616e 6461 7264  : Store standard
-00010ca0: 204f 4153 4953 2070 726f 7065 7274 6965   OASIS propertie
-00010cb0: 7320 696e 2074 6865 2066 696c 652e 0a20  s in the file.. 
-00010cc0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00010cd0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00010ce0: 7772 6974 655f 6c69 6272 6172 7928 0a20  write_library(. 
-00010cf0: 2020 2020 2020 2020 2020 2067 6473 7061             gdspa
-00010d00: 7468 3d67 6473 7061 7468 2c0a 2020 2020  th=gdspath,.    
-00010d10: 2020 2020 2020 2020 6764 7364 6972 3d67          gdsdir=g
-00010d20: 6473 6469 722c 0a20 2020 2020 2020 2020  dsdir,.         
-00010d30: 2020 2077 6974 685f 6f61 7369 733d 5472     with_oasis=Tr
-00010d40: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-00010d50: 2a2a 6b77 6172 6773 2c0a 2020 2020 2020  **kwargs,.      
-00010d60: 2020 290a 0a20 2020 2064 6566 2077 7269    )..    def wri
-00010d70: 7465 5f67 6473 5f77 6974 685f 6d65 7461  te_gds_with_meta
-00010d80: 6461 7461 2873 656c 662c 202a 6172 6773  data(self, *args
-00010d90: 2c20 2a2a 6b77 6172 6773 2920 2d3e 2050  , **kwargs) -> P
-00010da0: 6174 683a 0a20 2020 2020 2020 2022 2222  ath:.        """
-00010db0: 5772 6974 6520 636f 6d70 6f6e 656e 7420  Write component 
-00010dc0: 696e 2047 4453 2061 6e64 206d 6574 6164  in GDS and metad
-00010dd0: 6174 6120 2863 6f6d 706f 6e65 6e74 2073  ata (component s
-00010de0: 6574 7469 6e67 7329 2069 6e20 5941 4d4c  ettings) in YAML
-00010df0: 2e22 2222 0a20 2020 2020 2020 2067 6473  .""".        gds
-00010e00: 7061 7468 203d 2073 656c 662e 7772 6974  path = self.writ
-00010e10: 655f 6764 7328 2a61 7267 732c 202a 2a6b  e_gds(*args, **k
-00010e20: 7761 7267 7329 0a20 2020 2020 2020 206d  wargs).        m
-00010e30: 6574 6164 6174 6120 3d20 6764 7370 6174  etadata = gdspat
-00010e40: 682e 7769 7468 5f73 7566 6669 7828 222e  h.with_suffix(".
-00010e50: 796d 6c22 290a 2020 2020 2020 2020 6d65  yml").        me
-00010e60: 7461 6461 7461 2e77 7269 7465 5f74 6578  tadata.write_tex
-00010e70: 7428 7365 6c66 2e74 6f5f 7961 6d6c 2877  t(self.to_yaml(w
-00010e80: 6974 685f 6365 6c6c 733d 5472 7565 2c20  ith_cells=True, 
-00010e90: 7769 7468 5f70 6f72 7473 3d54 7275 6529  with_ports=True)
-00010ea0: 290a 2020 2020 2020 2020 6c6f 6767 6572  ).        logger
-00010eb0: 2e69 6e66 6f28 6622 5772 6974 6520 5941  .info(f"Write YA
-00010ec0: 4d4c 206d 6574 6164 6174 6120 746f 207b  ML metadata to {
-00010ed0: 7374 7228 6d65 7461 6461 7461 2921 727d  str(metadata)!r}
-00010ee0: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
-00010ef0: 6e20 6764 7370 6174 680a 0a20 2020 2064  n gdspath..    d
-00010f00: 6566 2074 6f5f 6469 6374 280a 2020 2020  ef to_dict(.    
-00010f10: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00010f20: 2020 6967 6e6f 7265 5f63 6f6d 706f 6e65    ignore_compone
-00010f30: 6e74 735f 7072 6566 6978 3a20 4f70 7469  nts_prefix: Opti
-00010f40: 6f6e 616c 5b4c 6973 745b 7374 725d 5d20  onal[List[str]] 
-00010f50: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00010f60: 6967 6e6f 7265 5f66 756e 6374 696f 6e73  ignore_functions
-00010f70: 5f70 7265 6669 783a 204f 7074 696f 6e61  _prefix: Optiona
-00010f80: 6c5b 4c69 7374 5b73 7472 5d5d 203d 204e  l[List[str]] = N
-00010f90: 6f6e 652c 0a20 2020 2020 2020 2077 6974  one,.        wit
-00010fa0: 685f 6365 6c6c 733a 2062 6f6f 6c20 3d20  h_cells: bool = 
-00010fb0: 4661 6c73 652c 0a20 2020 2020 2020 2077  False,.        w
-00010fc0: 6974 685f 706f 7274 733a 2062 6f6f 6c20  ith_ports: bool 
-00010fd0: 3d20 5472 7565 2c0a 2020 2020 2920 2d3e  = True,.    ) ->
-00010fe0: 2044 6963 745b 7374 722c 2041 6e79 5d3a   Dict[str, Any]:
-00010ff0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-00011000: 726e 7320 4469 6374 2072 6570 7265 7365  rns Dict represe
-00011010: 6e74 6174 696f 6e20 6f66 2061 2063 6f6d  ntation of a com
-00011020: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
-00011030: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00011040: 2020 2069 676e 6f72 655f 636f 6d70 6f6e     ignore_compon
-00011050: 656e 7473 5f70 7265 6669 783a 2066 6f72  ents_prefix: for
-00011060: 2063 6f6d 706f 6e65 6e74 7320 746f 2069   components to i
-00011070: 676e 6f72 6520 7768 656e 2065 7870 6f72  gnore when expor
-00011080: 7469 6e67 2e0a 2020 2020 2020 2020 2020  ting..          
-00011090: 2020 6967 6e6f 7265 5f66 756e 6374 696f    ignore_functio
-000110a0: 6e73 5f70 7265 6669 783a 2066 6f72 2066  ns_prefix: for f
-000110b0: 756e 6374 696f 6e73 2074 6f20 6967 6e6f  unctions to igno
-000110c0: 7265 2077 6865 6e20 6578 706f 7274 696e  re when exportin
-000110d0: 672e 0a20 2020 2020 2020 2020 2020 2077  g..            w
-000110e0: 6974 685f 6365 6c6c 733a 2077 7269 7465  ith_cells: write
-000110f0: 2063 656c 6c73 2072 6563 7572 7369 7665   cells recursive
-00011100: 6c79 2e0a 2020 2020 2020 2020 2020 2020  ly..            
-00011110: 7769 7468 5f70 6f72 7473 3a20 7772 6974  with_ports: writ
-00011120: 6520 706f 7274 2069 6e66 6f72 6d61 7469  e port informati
-00011130: 6f6e 2064 6963 742e 0a20 2020 2020 2020  on dict..       
-00011140: 2022 2222 0a20 2020 2020 2020 2064 203d   """.        d =
-00011150: 207b 7d0a 2020 2020 2020 2020 6966 2077   {}.        if w
-00011160: 6974 685f 706f 7274 733a 0a20 2020 2020  ith_ports:.     
-00011170: 2020 2020 2020 2070 6f72 7473 203d 207b         ports = {
-00011180: 706f 7274 2e6e 616d 653a 2070 6f72 742e  port.name: port.
-00011190: 746f 5f64 6963 7428 2920 666f 7220 706f  to_dict() for po
-000111a0: 7274 2069 6e20 7365 6c66 2e67 6574 5f70  rt in self.get_p
-000111b0: 6f72 7473 5f6c 6973 7428 297d 0a20 2020  orts_list()}.   
-000111c0: 2020 2020 2020 2020 2064 5b22 706f 7274           d["port
-000111d0: 7322 5d20 3d20 706f 7274 730a 0a20 2020  s"] = ports..   
-000111e0: 2020 2020 2069 6620 7769 7468 5f63 656c       if with_cel
-000111f0: 6c73 3a0a 2020 2020 2020 2020 2020 2020  ls:.            
-00011200: 6365 6c6c 7320 3d20 7265 6375 7273 655f  cells = recurse_
-00011210: 7374 7275 6374 7572 6573 280a 2020 2020  structures(.    
-00011220: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00011230: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00011240: 2020 6967 6e6f 7265 5f66 756e 6374 696f    ignore_functio
-00011250: 6e73 5f70 7265 6669 783d 6967 6e6f 7265  ns_prefix=ignore
-00011260: 5f66 756e 6374 696f 6e73 5f70 7265 6669  _functions_prefi
-00011270: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
-00011280: 2020 2069 676e 6f72 655f 636f 6d70 6f6e     ignore_compon
-00011290: 656e 7473 5f70 7265 6669 783d 6967 6e6f  ents_prefix=igno
-000112a0: 7265 5f63 6f6d 706f 6e65 6e74 735f 7072  re_components_pr
-000112b0: 6566 6978 2c0a 2020 2020 2020 2020 2020  efix,.          
-000112c0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-000112d0: 645b 2263 656c 6c73 225d 203d 2063 6c65  d["cells"] = cle
-000112e0: 616e 5f64 6963 7428 6365 6c6c 7329 0a0a  an_dict(cells)..
-000112f0: 2020 2020 2020 2020 645b 226e 616d 6522          d["name"
-00011300: 5d20 3d20 7365 6c66 2e6e 616d 650a 2020  ] = self.name.  
-00011310: 2020 2020 2020 645b 2273 6574 7469 6e67        d["setting
-00011320: 7322 5d20 3d20 636c 6561 6e5f 6469 6374  s"] = clean_dict
-00011330: 2864 6963 7428 7365 6c66 2e73 6574 7469  (dict(self.setti
-00011340: 6e67 7329 290a 2020 2020 2020 2020 7265  ngs)).        re
-00011350: 7475 726e 2064 0a0a 2020 2020 6465 6620  turn d..    def 
-00011360: 746f 5f79 616d 6c28 7365 6c66 2c20 2a2a  to_yaml(self, **
-00011370: 6b77 6172 6773 2920 2d3e 2073 7472 3a0a  kwargs) -> str:.
-00011380: 2020 2020 2020 2020 2222 2257 7269 7465          """Write
-00011390: 2044 6963 7420 7265 7072 6573 656e 7461   Dict representa
-000113a0: 7469 6f6e 206f 6620 6120 636f 6d70 6f6e  tion of a compon
-000113b0: 656e 7420 696e 2059 414d 4c20 666f 726d  ent in YAML form
-000113c0: 6174 2e0a 0a20 2020 2020 2020 2041 7267  at...        Arg
-000113d0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-000113e0: 676e 6f72 655f 636f 6d70 6f6e 656e 7473  gnore_components
-000113f0: 5f70 7265 6669 783a 2066 6f72 2063 6f6d  _prefix: for com
-00011400: 706f 6e65 6e74 7320 746f 2069 676e 6f72  ponents to ignor
-00011410: 6520 7768 656e 2065 7870 6f72 7469 6e67  e when exporting
-00011420: 2e0a 2020 2020 2020 2020 2020 2020 6967  ..            ig
-00011430: 6e6f 7265 5f66 756e 6374 696f 6e73 5f70  nore_functions_p
-00011440: 7265 6669 783a 2066 6f72 2066 756e 6374  refix: for funct
-00011450: 696f 6e73 2074 6f20 6967 6e6f 7265 2077  ions to ignore w
-00011460: 6865 6e20 6578 706f 7274 696e 672e 0a20  hen exporting.. 
-00011470: 2020 2020 2020 2020 2020 2077 6974 685f             with_
-00011480: 6365 6c6c 733a 2077 7269 7465 2063 656c  cells: write cel
-00011490: 6c73 2072 6563 7572 7369 7665 6c79 2e0a  ls recursively..
-000114a0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-000114b0: 5f70 6f72 7473 3a20 7772 6974 6520 706f  _ports: write po
-000114c0: 7274 2069 6e66 6f72 6d61 7469 6f6e 2e0a  rt information..
-000114d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000114e0: 2020 2020 7265 7475 726e 204f 6d65 6761      return Omega
-000114f0: 436f 6e66 2e74 6f5f 7961 6d6c 2863 6c65  Conf.to_yaml(cle
-00011500: 616e 5f64 6963 7428 7365 6c66 2e74 6f5f  an_dict(self.to_
-00011510: 6469 6374 282a 2a6b 7761 7267 7329 2929  dict(**kwargs)))
-00011520: 0a0a 2020 2020 6465 6620 746f 5f64 6963  ..    def to_dic
-00011530: 745f 706f 6c79 676f 6e73 2873 656c 6629  t_polygons(self)
-00011540: 202d 3e20 4469 6374 5b73 7472 2c20 416e   -> Dict[str, An
-00011550: 795d 3a0a 2020 2020 2020 2020 2222 2252  y]:.        """R
-00011560: 6574 7572 6e73 2061 2064 6963 7420 7265  eturns a dict re
-00011570: 7072 6573 656e 7461 7469 6f6e 206f 6620  presentation of 
-00011580: 7468 6520 666c 6174 7465 6e65 6420 636f  the flattened co
-00011590: 6d70 6f6e 656e 742e 2222 220a 2020 2020  mponent.""".    
-000115a0: 2020 2020 6420 3d20 7b7d 0a20 2020 2020      d = {}.     
-000115b0: 2020 2070 6f6c 7967 6f6e 7320 3d20 7b7d     polygons = {}
-000115c0: 0a20 2020 2020 2020 206c 6179 6572 5f74  .        layer_t
-000115d0: 6f5f 706f 6c79 676f 6e73 203d 2073 656c  o_polygons = sel
-000115e0: 662e 6765 745f 706f 6c79 676f 6e73 2862  f.get_polygons(b
-000115f0: 795f 7370 6563 3d54 7275 6529 0a0a 2020  y_spec=True)..  
-00011600: 2020 2020 2020 666f 7220 6c61 7965 722c        for layer,
-00011610: 2070 6f6c 7967 6f6e 735f 6c61 7965 7220   polygons_layer 
-00011620: 696e 206c 6179 6572 5f74 6f5f 706f 6c79  in layer_to_poly
-00011630: 676f 6e73 2e69 7465 6d73 2829 3a0a 2020  gons.items():.  
-00011640: 2020 2020 2020 2020 2020 6c61 7965 725f            layer_
-00011650: 6e61 6d65 203d 2066 227b 6c61 7965 725b  name = f"{layer[
-00011660: 305d 7d5f 7b6c 6179 6572 5b31 5d7d 220a  0]}_{layer[1]}".
-00011670: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00011680: 706f 6c79 676f 6e20 696e 2070 6f6c 7967  polygon in polyg
-00011690: 6f6e 735f 6c61 7965 723a 0a20 2020 2020  ons_layer:.     
-000116a0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-000116b0: 6f6e 735b 6c61 7965 725f 6e61 6d65 5d20  ons[layer_name] 
-000116c0: 3d20 5b74 7570 6c65 2873 6e61 705f 746f  = [tuple(snap_to
-000116d0: 5f67 7269 6428 7629 2920 666f 7220 7620  _grid(v)) for v 
-000116e0: 696e 2070 6f6c 7967 6f6e 5d0a 0a20 2020  in polygon]..   
-000116f0: 2020 2020 2070 6f72 7473 203d 207b 706f       ports = {po
-00011700: 7274 2e6e 616d 653a 2070 6f72 742e 7365  rt.name: port.se
-00011710: 7474 696e 6773 2066 6f72 2070 6f72 7420  ttings for port 
-00011720: 696e 2073 656c 662e 6765 745f 706f 7274  in self.get_port
-00011730: 735f 6c69 7374 2829 7d0a 2020 2020 2020  s_list()}.      
-00011740: 2020 636c 6561 6e5f 6469 6374 2870 6f72    clean_dict(por
-00011750: 7473 290a 2020 2020 2020 2020 636c 6561  ts).        clea
-00011760: 6e5f 6469 6374 2870 6f6c 7967 6f6e 7329  n_dict(polygons)
-00011770: 0a20 2020 2020 2020 2064 2e69 6e66 6f20  .        d.info 
-00011780: 3d20 7365 6c66 2e69 6e66 6f0a 2020 2020  = self.info.    
-00011790: 2020 2020 642e 706f 6c79 676f 6e73 203d      d.polygons =
-000117a0: 2070 6f6c 7967 6f6e 730a 2020 2020 2020   polygons.      
-000117b0: 2020 642e 706f 7274 7320 3d20 706f 7274    d.ports = port
-000117c0: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
-000117d0: 2064 0a0a 2020 2020 6465 6620 6175 746f   d..    def auto
-000117e0: 5f72 656e 616d 655f 706f 7274 7328 7365  _rename_ports(se
-000117f0: 6c66 2c20 2a2a 6b77 6172 6773 2920 2d3e  lf, **kwargs) ->
-00011800: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00011810: 2222 5265 6e61 6d65 2070 6f72 7473 2062  ""Rename ports b
-00011820: 7920 6f72 6965 6e74 6174 696f 6e20 4e53  y orientation NS
-00011830: 4557 2028 6e6f 7274 682c 2073 6f75 7468  EW (north, south
-00011840: 2c20 6561 7374 2c20 7765 7374 292e 0a0a  , east, west)...
-00011850: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
-00011860: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00011870: 2020 6675 6e63 7469 6f6e 3a20 746f 2072    function: to r
-00011880: 656e 616d 6520 706f 7274 732e 0a20 2020  ename ports..   
-00011890: 2020 2020 2020 2020 2073 656c 6563 745f           select_
-000118a0: 706f 7274 735f 6f70 7469 6361 6c3a 2074  ports_optical: t
-000118b0: 6f20 7365 6c65 6374 206f 7074 6963 616c  o select optical
-000118c0: 2070 6f72 7473 2e0a 2020 2020 2020 2020   ports..        
-000118d0: 2020 2020 7365 6c65 6374 5f70 6f72 7473      select_ports
-000118e0: 5f65 6c65 6374 7269 6361 6c3a 2074 6f20  _electrical: to 
-000118f0: 7365 6c65 6374 2065 6c65 6374 7269 6361  select electrica
-00011900: 6c20 706f 7274 732e 0a20 2020 2020 2020  l ports..       
-00011910: 2020 2020 2070 7265 6669 785f 6f70 7469       prefix_opti
-00011920: 6361 6c3a 2070 7265 6669 782e 0a20 2020  cal: prefix..   
-00011930: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
-00011940: 656c 6563 7472 6963 616c 3a20 7072 6566  electrical: pref
-00011950: 6978 2e0a 0a20 2020 2020 2020 202e 2e20  ix...        .. 
-00011960: 636f 6465 3a3a 0a0a 2020 2020 2020 2020  code::..        
-00011970: 2020 2020 2020 2020 2020 3320 2034 0a20            3  4. 
-00011980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011990: 5f7c 5f5f 7c5f 0a20 2020 2020 2020 2020  _|__|_.         
-000119a0: 2020 2020 3220 2d7c 2020 2020 2020 7c2d      2 -|      |-
-000119b0: 2035 0a20 2020 2020 2020 2020 2020 2020   5.             
-000119c0: 2020 207c 2020 2020 2020 7c0a 2020 2020     |      |.    
-000119d0: 2020 2020 2020 2020 2031 202d 7c5f 5f5f           1 -|___
-000119e0: 5f5f 5f7c 2d20 360a 2020 2020 2020 2020  ___|- 6.        
-000119f0: 2020 2020 2020 2020 2020 7c20 207c 0a20            |  |. 
-00011a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a10: 2038 2020 370a 2020 2020 2020 2020 2222   8  7.        ""
-00011a20: 220a 2020 2020 2020 2020 7365 6c66 2e69  ".        self.i
-00011a30: 735f 756e 6c6f 636b 6564 2829 0a20 2020  s_unlocked().   
-00011a40: 2020 2020 2061 7574 6f5f 7265 6e61 6d65       auto_rename
-00011a50: 5f70 6f72 7473 2873 656c 662c 202a 2a6b  _ports(self, **k
-00011a60: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
-00011a70: 6175 746f 5f72 656e 616d 655f 706f 7274  auto_rename_port
-00011a80: 735f 636f 756e 7465 725f 636c 6f63 6b77  s_counter_clockw
-00011a90: 6973 6528 7365 6c66 2c20 2a2a 6b77 6172  ise(self, **kwar
-00011aa0: 6773 2920 2d3e 204e 6f6e 653a 0a20 2020  gs) -> None:.   
-00011ab0: 2020 2020 2073 656c 662e 6973 5f75 6e6c       self.is_unl
-00011ac0: 6f63 6b65 6428 290a 2020 2020 2020 2020  ocked().        
-00011ad0: 6175 746f 5f72 656e 616d 655f 706f 7274  auto_rename_port
-00011ae0: 735f 636f 756e 7465 725f 636c 6f63 6b77  s_counter_clockw
-00011af0: 6973 6528 7365 6c66 2c20 2a2a 6b77 6172  ise(self, **kwar
-00011b00: 6773 290a 0a20 2020 2064 6566 2061 7574  gs)..    def aut
-00011b10: 6f5f 7265 6e61 6d65 5f70 6f72 7473 5f6c  o_rename_ports_l
-00011b20: 6179 6572 5f6f 7269 656e 7461 7469 6f6e  ayer_orientation
-00011b30: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
-00011b40: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00011b50: 2020 7365 6c66 2e69 735f 756e 6c6f 636b    self.is_unlock
-00011b60: 6564 2829 0a20 2020 2020 2020 2061 7574  ed().        aut
-00011b70: 6f5f 7265 6e61 6d65 5f70 6f72 7473 5f6c  o_rename_ports_l
-00011b80: 6179 6572 5f6f 7269 656e 7461 7469 6f6e  ayer_orientation
-00011b90: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
-00011ba0: 0a0a 2020 2020 6465 6620 6175 746f 5f72  ..    def auto_r
-00011bb0: 656e 616d 655f 706f 7274 735f 6f72 6965  ename_ports_orie
-00011bc0: 6e74 6174 696f 6e28 7365 6c66 2c20 2a2a  ntation(self, **
-00011bd0: 6b77 6172 6773 2920 2d3e 204e 6f6e 653a  kwargs) -> None:
-00011be0: 0a20 2020 2020 2020 2022 2222 5265 6e61  .        """Rena
-00011bf0: 6d65 2070 6f72 7473 2062 7920 6f72 6965  me ports by orie
-00011c00: 6e74 6174 696f 6e20 4e53 4557 2028 6e6f  ntation NSEW (no
-00011c10: 7274 682c 2073 6f75 7468 2c20 6561 7374  rth, south, east
-00011c20: 2c20 7765 7374 292e 0a0a 2020 2020 2020  , west)...      
-00011c30: 2020 4b65 7977 6f72 6420 4172 6773 3a0a    Keyword Args:.
-00011c40: 2020 2020 2020 2020 2020 2020 6675 6e63              func
-00011c50: 7469 6f6e 3a20 746f 2072 656e 616d 6520  tion: to rename 
-00011c60: 706f 7274 732e 0a20 2020 2020 2020 2020  ports..         
-00011c70: 2020 2073 656c 6563 745f 706f 7274 735f     select_ports_
-00011c80: 6f70 7469 6361 6c3a 2074 6f20 7365 6c65  optical: to sele
-00011c90: 6374 2070 6f72 7473 2e0a 2020 2020 2020  ct ports..      
-00011ca0: 2020 2020 2020 7365 6c65 6374 5f70 6f72        select_por
-00011cb0: 7473 5f65 6c65 6374 7269 6361 6c3a 0a20  ts_electrical:. 
-00011cc0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-00011cd0: 785f 6f70 7469 6361 6c3a 0a20 2020 2020  x_optical:.     
-00011ce0: 2020 2020 2020 2070 7265 6669 785f 656c         prefix_el
-00011cf0: 6563 7472 6963 616c 3a0a 0a20 2020 2020  ectrical:..     
-00011d00: 2020 202e 2e20 636f 6465 3a3a 0a0a 2020     .. code::..  
-00011d10: 2020 2020 2020 2020 2020 2020 2020 204e                 N
-00011d20: 3020 204e 310a 2020 2020 2020 2020 2020  0  N1.          
-00011d30: 2020 2020 2020 207c 5f5f 5f7c 5f0a 2020         |___|_.  
-00011d40: 2020 2020 2020 2020 2020 5731 202d 7c20            W1 -| 
-00011d50: 2020 2020 207c 2d20 4531 0a20 2020 2020       |- E1.     
-00011d60: 2020 2020 2020 2020 2020 207c 2020 2020             |    
-00011d70: 2020 7c0a 2020 2020 2020 2020 2020 2020    |.            
-00011d80: 5730 202d 7c5f 5f5f 5f5f 5f7c 2d20 4530  W0 -|______|- E0
-00011d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011da0: 2020 7c20 2020 7c0a 2020 2020 2020 2020    |   |.        
-00011db0: 2020 2020 2020 2020 5330 2020 2053 310a          S0   S1.
-00011dc0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00011dd0: 2020 2020 7365 6c66 2e69 735f 756e 6c6f      self.is_unlo
-00011de0: 636b 6564 2829 0a20 2020 2020 2020 2061  cked().        a
-00011df0: 7574 6f5f 7265 6e61 6d65 5f70 6f72 7473  uto_rename_ports
-00011e00: 5f6f 7269 656e 7461 7469 6f6e 2873 656c  _orientation(sel
-00011e10: 662c 202a 2a6b 7761 7267 7329 0a0a 2020  f, **kwargs)..  
-00011e20: 2020 6465 6620 6d6f 7665 280a 2020 2020    def move(.    
-00011e30: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00011e40: 2020 6f72 6967 696e 3a20 466c 6f61 7432    origin: Float2
-00011e50: 203d 2028 302c 2030 292c 0a20 2020 2020   = (0, 0),.     
-00011e60: 2020 2064 6573 7469 6e61 7469 6f6e 3a20     destination: 
-00011e70: 4f70 7469 6f6e 616c 5b46 6c6f 6174 325d  Optional[Float2]
-00011e80: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00011e90: 2061 7869 733a 204f 7074 696f 6e61 6c5b   axis: Optional[
-00011ea0: 4178 6973 5d20 3d20 4e6f 6e65 2c0a 2020  Axis] = None,.  
-00011eb0: 2020 2920 2d3e 2043 6f6d 706f 6e65 6e74    ) -> Component
-00011ec0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-00011ed0: 7572 6e73 206e 6577 2043 6f6d 706f 6e65  urns new Compone
-00011ee0: 6e74 2077 6974 6820 6120 6d6f 7665 6420  nt with a moved 
-00011ef0: 7265 6665 7265 6e63 6520 746f 2074 6865  reference to the
-00011f00: 206f 7269 6769 6e61 6c2e 0a0a 2020 2020   original...    
-00011f10: 2020 2020 636f 6d70 6f6e 656e 742e 0a0a      component...
-00011f20: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-00011f30: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
-00011f40: 3a20 6f66 2063 6f6d 706f 6e65 6e74 2e0a  : of component..
-00011f50: 2020 2020 2020 2020 2020 2020 6465 7374              dest
-00011f60: 696e 6174 696f 6e3a 2078 2c20 792e 0a20  ination: x, y.. 
-00011f70: 2020 2020 2020 2020 2020 2061 7869 733a             axis:
-00011f80: 2078 206f 7220 792e 0a20 2020 2020 2020   x or y..       
-00011f90: 2022 2222 0a20 2020 2020 2020 2072 6169   """.        rai
-00011fa0: 7365 2056 616c 7565 4572 726f 7228 6d6f  se ValueError(mo
-00011fb0: 7665 5f65 7272 6f72 5f6d 6573 7361 6765  ve_error_message
-00011fc0: 290a 0a20 2020 2064 6566 206d 6972 726f  )..    def mirro
-00011fd0: 7228 7365 6c66 2c20 7031 3a20 466c 6f61  r(self, p1: Floa
-00011fe0: 7432 203d 2028 302c 2031 292c 2070 323a  t2 = (0, 1), p2:
-00011ff0: 2046 6c6f 6174 3220 3d20 2830 2c20 3029   Float2 = (0, 0)
-00012000: 2c20 2a2a 6b77 6172 6773 2920 2d3e 2043  , **kwargs) -> C
-00012010: 6f6d 706f 6e65 6e74 3a0a 2020 2020 2020  omponent:.      
-00012020: 2020 2222 2252 6574 7572 6e73 206e 6577    """Returns new
-00012030: 2043 6f6d 706f 6e65 6e74 2077 6974 6820   Component with 
-00012040: 6120 6d69 7272 6f72 6564 2072 6566 6572  a mirrored refer
-00012050: 656e 6365 2e0a 0a20 2020 2020 2020 2041  ence...        A
-00012060: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00012070: 2070 313a 2066 6972 7374 2070 6f69 6e74   p1: first point
-00012080: 2074 6f20 6465 6669 6e65 206d 6972 726f   to define mirro
-00012090: 7220 6178 6973 2e0a 2020 2020 2020 2020  r axis..        
-000120a0: 2020 2020 7032 3a20 7365 636f 6e64 2070      p2: second p
-000120b0: 6f69 6e74 2074 6f20 6465 6669 6e65 206d  oint to define m
-000120c0: 6972 726f 7220 6178 6973 2e0a 2020 2020  irror axis..    
-000120d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000120e0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-000120f0: 6675 6e63 7469 6f6e 7320 696d 706f 7274  functions import
-00012100: 206d 6972 726f 720a 0a20 2020 2020 2020   mirror..       
-00012110: 2072 6574 7572 6e20 6d69 7272 6f72 2863   return mirror(c
-00012120: 6f6d 706f 6e65 6e74 3d73 656c 662c 2070  omponent=self, p
-00012130: 313d 7031 2c20 7032 3d70 322c 202a 2a6b  1=p1, p2=p2, **k
-00012140: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
-00012150: 726f 7461 7465 2873 656c 662c 2061 6e67  rotate(self, ang
-00012160: 6c65 3a20 666c 6f61 7420 3d20 3930 2c20  le: float = 90, 
-00012170: 2a2a 6b77 6172 6773 2920 2d3e 2043 6f6d  **kwargs) -> Com
-00012180: 706f 6e65 6e74 3a0a 2020 2020 2020 2020  ponent:.        
-00012190: 2222 2252 6574 7572 6e73 206e 6577 2063  """Returns new c
-000121a0: 6f6d 706f 6e65 6e74 2077 6974 6820 6120  omponent with a 
-000121b0: 726f 7461 7465 6420 7265 6665 7265 6e63  rotated referenc
-000121c0: 6520 746f 2074 6865 206f 7269 6769 6e61  e to the origina
-000121d0: 6c2e 0a0a 2020 2020 2020 2020 4172 6773  l...        Args
-000121e0: 3a0a 2020 2020 2020 2020 2020 2020 616e  :.            an
-000121f0: 676c 653a 2069 6e20 6465 6772 6565 732e  gle: in degrees.
-00012200: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00012210: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
-00012220: 746f 7279 2e66 756e 6374 696f 6e73 2069  tory.functions i
-00012230: 6d70 6f72 7420 726f 7461 7465 0a0a 2020  mport rotate..  
-00012240: 2020 2020 2020 7265 7475 726e 2072 6f74        return rot
-00012250: 6174 6528 636f 6d70 6f6e 656e 743d 7365  ate(component=se
-00012260: 6c66 2c20 616e 676c 653d 616e 676c 652c  lf, angle=angle,
-00012270: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-00012280: 6465 6620 6164 645f 7061 6464 696e 6728  def add_padding(
-00012290: 7365 6c66 2c20 2a2a 6b77 6172 6773 2920  self, **kwargs) 
-000122a0: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
-000122b0: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-000122c0: 2073 616d 6520 636f 6d70 6f6e 656e 7420   same component 
-000122d0: 7769 7468 2070 6164 6469 6e67 2e0a 0a20  with padding... 
-000122e0: 2020 2020 2020 204b 6579 776f 7264 2041         Keyword A
-000122f0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00012300: 2063 6f6d 706f 6e65 6e74 3a20 666f 7220   component: for 
-00012310: 7061 6464 696e 672e 0a20 2020 2020 2020  padding..       
-00012320: 2020 2020 206c 6179 6572 733a 206c 6973       layers: lis
-00012330: 7420 6f66 206c 6179 6572 732e 0a20 2020  t of layers..   
-00012340: 2020 2020 2020 2020 2073 7566 6669 7820           suffix 
-00012350: 666f 7220 6e61 6d65 2e0a 2020 2020 2020  for name..      
-00012360: 2020 2020 2020 6465 6661 756c 743a 2064        default: d
-00012370: 6566 6175 6c74 2070 6164 6469 6e67 2028  efault padding (
-00012380: 3530 756d 292e 0a20 2020 2020 2020 2020  50um)..         
-00012390: 2020 2074 6f70 3a20 6e6f 7274 6820 7061     top: north pa
-000123a0: 6464 696e 672e 0a20 2020 2020 2020 2020  dding..         
-000123b0: 2020 2062 6f74 746f 6d3a 2073 6f75 7468     bottom: south
-000123c0: 2070 6164 6469 6e67 2e0a 2020 2020 2020   padding..      
-000123d0: 2020 2020 2020 7269 6768 743a 2065 6173        right: eas
-000123e0: 7420 7061 6464 696e 672e 0a20 2020 2020  t padding..     
-000123f0: 2020 2020 2020 206c 6566 743a 2077 6573         left: wes
-00012400: 7420 7061 6464 696e 672e 0a20 2020 2020  t padding..     
-00012410: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-00012420: 726f 6d20 6764 7366 6163 746f 7279 2e61  rom gdsfactory.a
-00012430: 6464 5f70 6164 6469 6e67 2069 6d70 6f72  dd_padding impor
-00012440: 7420 6164 645f 7061 6464 696e 670a 0a20  t add_padding.. 
-00012450: 2020 2020 2020 2072 6574 7572 6e20 6164         return ad
-00012460: 645f 7061 6464 696e 6728 636f 6d70 6f6e  d_padding(compon
-00012470: 656e 743d 7365 6c66 2c20 2a2a 6b77 6172  ent=self, **kwar
-00012480: 6773 290a 0a20 2020 2064 6566 2061 6273  gs)..    def abs
-00012490: 6f72 6228 7365 6c66 2c20 7265 6665 7265  orb(self, refere
-000124a0: 6e63 6529 202d 3e20 436f 6d70 6f6e 656e  nce) -> Componen
-000124b0: 743a 0a20 2020 2020 2020 2022 2222 4162  t:.        """Ab
-000124c0: 736f 7262 7320 706f 6c79 676f 6e73 2066  sorbs polygons f
-000124d0: 726f 6d20 436f 6d70 6f6e 656e 7452 6566  rom ComponentRef
-000124e0: 6572 656e 6365 2069 6e74 6f20 436f 6d70  erence into Comp
-000124f0: 6f6e 656e 742e 0a0a 2020 2020 2020 2020  onent...        
-00012500: 4465 7374 726f 7973 2074 6865 2072 6566  Destroys the ref
-00012510: 6572 656e 6365 2069 6e20 7468 6520 7072  erence in the pr
-00012520: 6f63 6573 7320 6275 7420 6b65 6570 696e  ocess but keepin
-00012530: 6720 7468 6520 706f 6c79 676f 6e20 6765  g the polygon ge
-00012540: 6f6d 6574 7279 2e0a 0a20 2020 2020 2020  ometry...       
-00012550: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00012560: 2020 2072 6566 6572 656e 6365 3a20 436f     reference: Co
-00012570: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
-00012580: 2074 6f20 6265 2061 6273 6f72 6265 6420   to be absorbed 
-00012590: 696e 746f 2074 6865 2043 6f6d 706f 6e65  into the Compone
-000125a0: 6e74 2e0a 2020 2020 2020 2020 2222 220a  nt..        """.
-000125b0: 2020 2020 2020 2020 6966 2072 6566 6572          if refer
-000125c0: 656e 6365 206e 6f74 2069 6e20 7365 6c66  ence not in self
-000125d0: 2e72 6566 6572 656e 6365 733a 0a20 2020  .references:.   
-000125e0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-000125f0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-00012600: 2020 2020 2020 2020 2020 2022 5468 6520             "The 
-00012610: 7265 6665 7265 6e63 6520 796f 7520 6173  reference you as
-00012620: 6b65 6420 746f 2061 6273 6f72 6220 646f  ked to absorb do
-00012630: 6573 206e 6f74 2065 7869 7374 2069 6e20  es not exist in 
-00012640: 7468 6973 2043 6f6d 706f 6e65 6e74 2e22  this Component."
-00012650: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00012660: 2020 2020 2020 2072 6566 5f70 6f6c 7967         ref_polyg
-00012670: 6f6e 7320 3d20 7265 6665 7265 6e63 652e  ons = reference.
-00012680: 6765 745f 706f 6c79 676f 6e73 280a 2020  get_polygons(.  
-00012690: 2020 2020 2020 2020 2020 6279 5f73 7065            by_spe
-000126a0: 633d 4661 6c73 652c 2069 6e63 6c75 6465  c=False, include
-000126b0: 5f70 6174 6873 3d46 616c 7365 2c20 6173  _paths=False, as
-000126c0: 5f61 7272 6179 3d46 616c 7365 0a20 2020  _array=False.   
-000126d0: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-000126e0: 656c 662e 5f61 6464 5f70 6f6c 7967 6f6e  elf._add_polygon
-000126f0: 7328 2a72 6566 5f70 6f6c 7967 6f6e 7329  s(*ref_polygons)
-00012700: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-00012710: 6464 2872 6566 6572 656e 6365 2e67 6574  dd(reference.get
-00012720: 5f6c 6162 656c 7328 2929 0a20 2020 2020  _labels()).     
-00012730: 2020 2073 656c 662e 6164 6428 7265 6665     self.add(refe
-00012740: 7265 6e63 652e 6765 745f 7061 7468 7328  rence.get_paths(
-00012750: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-00012760: 7265 6d6f 7665 2872 6566 6572 656e 6365  remove(reference
-00012770: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00012780: 2073 656c 660a 0a20 2020 2064 6566 2072   self..    def r
-00012790: 656d 6f76 6528 7365 6c66 2c20 6974 656d  emove(self, item
-000127a0: 7329 3a0a 2020 2020 2020 2020 2222 2252  s):.        """R
-000127b0: 656d 6f76 6573 2069 7465 6d73 2066 726f  emoves items fro
-000127c0: 6d20 6120 436f 6d70 6f6e 656e 742c 2077  m a Component, w
-000127d0: 6869 6368 2063 616e 2069 6e63 6c75 6465  hich can include
-000127e0: 2050 6f72 7473 2c20 506f 6c79 676f 6e53   Ports, PolygonS
-000127f0: 6574 7320 5c0a 2020 2020 2020 2020 4365  ets \.        Ce
-00012800: 6c6c 5265 6665 7265 6e63 6573 2c20 436f  llReferences, Co
-00012810: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
-00012820: 7320 616e 6420 4c61 6265 6c73 2e0a 0a20  s and Labels... 
-00012830: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-00012840: 2020 2020 2020 2020 2069 7465 6d73 3a20           items: 
-00012850: 6c69 7374 206f 6620 4974 656d 7320 746f  list of Items to
-00012860: 2062 6520 7265 6d6f 7665 6420 6672 6f6d   be removed from
-00012870: 2074 6865 2043 6f6d 706f 6e65 6e74 2e0a   the Component..
-00012880: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00012890: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
-000128a0: 7472 2869 7465 6d73 2c20 225f 5f69 7465  tr(items, "__ite
-000128b0: 725f 5f22 293a 0a20 2020 2020 2020 2020  r__"):.         
-000128c0: 2020 2069 7465 6d73 203d 205b 6974 656d     items = [item
-000128d0: 735d 0a20 2020 2020 2020 2066 6f72 2069  s].        for i
-000128e0: 7465 6d20 696e 2069 7465 6d73 3a0a 2020  tem in items:.  
-000128f0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-00012900: 6e73 7461 6e63 6528 6974 656d 2c20 506f  nstance(item, Po
-00012910: 7274 293a 0a20 2020 2020 2020 2020 2020  rt):.           
-00012920: 2020 2020 2073 656c 662e 706f 7274 7320       self.ports 
-00012930: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
-00012940: 2069 6e20 7365 6c66 2e70 6f72 7473 2e69   in self.ports.i
-00012950: 7465 6d73 2829 2069 6620 7620 213d 2069  tems() if v != i
-00012960: 7465 6d7d 0a20 2020 2020 2020 2020 2020  tem}.           
-00012970: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00012980: 2869 7465 6d2c 2067 6473 746b 2e52 6566  (item, gdstk.Ref
-00012990: 6572 656e 6365 293a 0a20 2020 2020 2020  erence):.       
-000129a0: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-000129b0: 656c 6c2e 7265 6d6f 7665 2869 7465 6d29  ell.remove(item)
-000129c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000129d0: 2069 7465 6d2e 6f77 6e65 7220 3d20 4e6f   item.owner = No
-000129e0: 6e65 0a20 2020 2020 2020 2020 2020 2065  ne.            e
-000129f0: 6c69 6620 6973 696e 7374 616e 6365 2869  lif isinstance(i
-00012a00: 7465 6d2c 2043 6f6d 706f 6e65 6e74 5265  tem, ComponentRe
-00012a10: 6665 7265 6e63 6529 3a0a 2020 2020 2020  ference):.      
-00012a20: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
-00012a30: 6566 6572 656e 6365 732e 7265 6d6f 7665  eferences.remove
-00012a40: 2869 7465 6d29 0a20 2020 2020 2020 2020  (item).         
-00012a50: 2020 2020 2020 2073 656c 662e 5f63 656c         self._cel
-00012a60: 6c2e 7265 6d6f 7665 2869 7465 6d2e 5f72  l.remove(item._r
-00012a70: 6566 6572 656e 6365 290a 2020 2020 2020  eference).      
-00012a80: 2020 2020 2020 2020 2020 6974 656d 2e6f            item.o
-00012a90: 776e 6572 203d 204e 6f6e 650a 2020 2020  wner = None.    
-00012aa0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00012ab0: 2e5f 6e61 6d65 645f 7265 6665 7265 6e63  ._named_referenc
-00012ac0: 6573 2e70 6f70 2869 7465 6d2e 6e61 6d65  es.pop(item.name
-00012ad0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00012ae0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00012af0: 2020 2020 7365 6c66 2e5f 6365 6c6c 2e72      self._cell.r
-00012b00: 656d 6f76 6528 6974 656d 290a 0a20 2020  emove(item)..   
-00012b10: 2020 2020 2073 656c 662e 5f62 625f 7661       self._bb_va
-00012b20: 6c69 6420 3d20 4661 6c73 650a 2020 2020  lid = False.    
-00012b30: 2020 2020 7265 7475 726e 2073 656c 660a      return self.
-00012b40: 0a20 2020 2064 6566 2068 6173 685f 6765  .    def hash_ge
-00012b50: 6f6d 6574 7279 2873 656c 662c 2070 7265  ometry(self, pre
-00012b60: 6369 7369 6f6e 3a20 666c 6f61 7420 3d20  cision: float = 
-00012b70: 3165 2d34 2920 2d3e 2073 7472 3a0a 2020  1e-4) -> str:.  
-00012b80: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-00012b90: 2061 6e20 5348 4131 2068 6173 6820 6f66   an SHA1 hash of
-00012ba0: 2074 6865 2067 656f 6d65 7472 7920 696e   the geometry in
-00012bb0: 2074 6865 2043 6f6d 706f 6e65 6e74 2e0a   the Component..
-00012bc0: 0a20 2020 2020 2020 2046 6f72 2065 6163  .        For eac
-00012bd0: 6820 6c61 7965 722c 2065 6163 6820 706f  h layer, each po
-00012be0: 6c79 676f 6e20 6973 2069 6e64 6976 6964  lygon is individ
-00012bf0: 7561 6c6c 7920 6861 7368 6564 2061 6e64  ually hashed and
-00012c00: 2074 6865 6e20 7468 6520 706f 6c79 676f   then the polygo
-00012c10: 6e20 6861 7368 6573 0a20 2020 2020 2020  n hashes.       
-00012c20: 2061 7265 2073 6f72 7465 642c 2074 6f20   are sorted, to 
-00012c30: 656e 7375 7265 2074 6865 2068 6173 6820  ensure the hash 
-00012c40: 7374 6179 7320 636f 6e73 7461 6e74 2072  stays constant r
-00012c50: 6567 6172 646c 6573 7320 6f66 2074 6865  egardless of the
-00012c60: 206f 7264 6572 696e 670a 2020 2020 2020   ordering.      
-00012c70: 2020 7468 6520 706f 6c79 676f 6e73 2e20    the polygons. 
-00012c80: 2053 696d 696c 6172 6c79 2c20 7468 6520   Similarly, the 
-00012c90: 6c61 7965 7273 2061 7265 2073 6f72 7465  layers are sorte
-00012ca0: 6420 6279 2028 6c61 7965 722c 2064 6174  d by (layer, dat
-00012cb0: 6174 7970 6529 2e0a 0a20 2020 2020 2020  atype)...       
-00012cc0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00012cd0: 2020 2070 7265 6369 7369 6f6e 3a20 526f     precision: Ro
-00012ce0: 756e 6469 6e67 2070 7265 6369 7369 6f6e  unding precision
-00012cf0: 2066 6f72 2074 6865 2074 6865 206f 626a   for the the obj
-00012d00: 6563 7473 2069 6e20 7468 6520 436f 6d70  ects in the Comp
-00012d10: 6f6e 656e 742e 0a20 2020 2020 2020 2020  onent..         
-00012d20: 2020 2020 2020 2046 6f72 2069 6e73 7461         For insta
-00012d30: 6e63 652c 2061 2070 7265 6369 7369 6f6e  nce, a precision
-00012d40: 206f 6620 3165 2d32 2077 696c 6c20 726f   of 1e-2 will ro
-00012d50: 756e 6420 6120 706f 696e 7420 6174 0a20  und a point at. 
-00012d60: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00012d70: 302e 3132 342c 2031 2e37 3438 2920 746f  0.124, 1.748) to
-00012d80: 2028 302e 3132 2c20 312e 3735 292e 0a0a   (0.12, 1.75)...
-00012d90: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00012da0: 2020 2020 706f 6c79 676f 6e73 5f62 795f      polygons_by_
-00012db0: 7370 6563 203d 2073 656c 662e 6765 745f  spec = self.get_
-00012dc0: 706f 6c79 676f 6e73 2862 795f 7370 6563  polygons(by_spec
-00012dd0: 3d54 7275 652c 2061 735f 6172 7261 793d  =True, as_array=
-00012de0: 4661 6c73 6529 0a20 2020 2020 2020 206c  False).        l
-00012df0: 6179 6572 7320 3d20 6e70 2e61 7272 6179  ayers = np.array
-00012e00: 286c 6973 7428 706f 6c79 676f 6e73 5f62  (list(polygons_b
-00012e10: 795f 7370 6563 2e6b 6579 7328 2929 290a  y_spec.keys())).
-00012e20: 2020 2020 2020 2020 736f 7274 6564 5f6c          sorted_l
-00012e30: 6179 6572 7320 3d20 6c61 7965 7273 5b6e  ayers = layers[n
-00012e40: 702e 6c65 7873 6f72 7428 286c 6179 6572  p.lexsort((layer
-00012e50: 735b 3a2c 2030 5d2c 206c 6179 6572 735b  s[:, 0], layers[
-00012e60: 3a2c 2031 5d29 295d 0a0a 2020 2020 2020  :, 1]))]..      
-00012e70: 2020 6669 6e61 6c5f 6861 7368 203d 2068    final_hash = h
-00012e80: 6173 686c 6962 2e73 6861 3128 290a 2020  ashlib.sha1().  
-00012e90: 2020 2020 2020 666f 7220 6c61 7965 7220        for layer 
-00012ea0: 696e 2073 6f72 7465 645f 6c61 7965 7273  in sorted_layers
-00012eb0: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
-00012ec0: 7965 725f 6861 7368 203d 2068 6173 686c  yer_hash = hashl
-00012ed0: 6962 2e73 6861 3128 6c61 7965 722e 6173  ib.sha1(layer.as
-00012ee0: 7479 7065 286e 702e 696e 7436 3429 292e  type(np.int64)).
-00012ef0: 6469 6765 7374 2829 0a20 2020 2020 2020  digest().       
-00012f00: 2020 2020 2070 6f6c 7967 6f6e 7320 3d20       polygons = 
-00012f10: 706f 6c79 676f 6e73 5f62 795f 7370 6563  polygons_by_spec
-00012f20: 5b74 7570 6c65 286c 6179 6572 295d 0a20  [tuple(layer)]. 
-00012f30: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-00012f40: 6f6e 7320 3d20 5b5f 726e 6428 702e 706f  ons = [_rnd(p.po
-00012f50: 696e 7473 2c20 7072 6563 6973 696f 6e29  ints, precision)
-00012f60: 2066 6f72 2070 2069 6e20 706f 6c79 676f   for p in polygo
-00012f70: 6e73 5d0a 2020 2020 2020 2020 2020 2020  ns].            
-00012f80: 706f 6c79 676f 6e5f 6861 7368 6573 203d  polygon_hashes =
-00012f90: 206e 702e 736f 7274 285b 6861 7368 6c69   np.sort([hashli
-00012fa0: 622e 7368 6131 2870 292e 6469 6765 7374  b.sha1(p).digest
-00012fb0: 2829 2066 6f72 2070 2069 6e20 706f 6c79  () for p in poly
-00012fc0: 676f 6e73 5d29 0a20 2020 2020 2020 2020  gons]).         
-00012fd0: 2020 2066 696e 616c 5f68 6173 682e 7570     final_hash.up
-00012fe0: 6461 7465 286c 6179 6572 5f68 6173 6829  date(layer_hash)
-00012ff0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00013000: 2070 6820 696e 2070 6f6c 7967 6f6e 5f68   ph in polygon_h
-00013010: 6173 6865 733a 0a20 2020 2020 2020 2020  ashes:.         
-00013020: 2020 2020 2020 2066 696e 616c 5f68 6173         final_has
-00013030: 682e 7570 6461 7465 2870 6829 0a0a 2020  h.update(ph)..  
-00013040: 2020 2020 2020 7265 7475 726e 2066 696e        return fin
-00013050: 616c 5f68 6173 682e 6865 7864 6967 6573  al_hash.hexdiges
-00013060: 7428 290a 0a20 2020 2064 6566 2067 6574  t()..    def get
-00013070: 5f6c 6162 656c 7328 0a20 2020 2020 2020  _labels(.       
-00013080: 2073 656c 662c 2061 7070 6c79 5f72 6570   self, apply_rep
-00013090: 6574 6974 696f 6e73 3d54 7275 652c 2064  etitions=True, d
-000130a0: 6570 7468 3a20 4f70 7469 6f6e 616c 5b69  epth: Optional[i
-000130b0: 6e74 5d20 3d20 4e6f 6e65 2c20 6c61 7965  nt] = None, laye
-000130c0: 723d 4e6f 6e65 0a20 2020 2029 202d 3e20  r=None.    ) -> 
-000130d0: 4c69 7374 5b4c 6162 656c 5d3a 0a20 2020  List[Label]:.   
-000130e0: 2020 2020 2022 2222 5265 7475 726e 206c       """Return l
-000130f0: 6162 656c 732e 0a0a 2020 2020 2020 2020  abels...        
-00013100: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00013110: 2020 6170 706c 795f 7265 7065 7469 7469    apply_repetiti
-00013120: 6f6e 733a 2e0a 2020 2020 2020 2020 2020  ons:..          
-00013130: 2020 6465 7074 683a 204e 6f6e 6520 7265    depth: None re
-00013140: 7475 726e 7320 616c 6c20 6c61 6265 6c73  turns all labels
-00013150: 2061 6e64 2030 2074 6f70 206c 6576 656c   and 0 top level
-00013160: 2e0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
-00013170: 7965 723a 206c 6179 6572 7370 6563 2e0a  yer: layerspec..
-00013180: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00013190: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
-000131a0: 6f72 792e 7064 6b20 696d 706f 7274 2067  ory.pdk import g
-000131b0: 6574 5f6c 6179 6572 0a0a 2020 2020 2020  et_layer..      
-000131c0: 2020 6966 206c 6179 6572 3a0a 2020 2020    if layer:.    
-000131d0: 2020 2020 2020 2020 6c61 7965 722c 2074          layer, t
-000131e0: 6578 7474 7970 6520 3d20 6765 745f 6c61  exttype = get_la
-000131f0: 7965 7228 6c61 7965 7229 0a20 2020 2020  yer(layer).     
-00013200: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00013210: 2020 2020 2074 6578 7474 7970 6520 3d20       texttype = 
-00013220: 4e6f 6e65 0a20 2020 2020 2020 2072 6574  None.        ret
-00013230: 7572 6e20 7365 6c66 2e5f 6365 6c6c 2e67  urn self._cell.g
-00013240: 6574 5f6c 6162 656c 7328 0a20 2020 2020  et_labels(.     
-00013250: 2020 2020 2020 2061 7070 6c79 5f72 6570         apply_rep
-00013260: 6574 6974 696f 6e73 3d61 7070 6c79 5f72  etitions=apply_r
-00013270: 6570 6574 6974 696f 6e73 2c0a 2020 2020  epetitions,.    
-00013280: 2020 2020 2020 2020 6465 7074 683d 6465          depth=de
-00013290: 7074 682c 0a20 2020 2020 2020 2020 2020  pth,.           
-000132a0: 206c 6179 6572 3d6c 6179 6572 2c0a 2020   layer=layer,.  
-000132b0: 2020 2020 2020 2020 2020 7465 7874 7479            textty
-000132c0: 7065 3d74 6578 7474 7970 652c 0a20 2020  pe=texttype,.   
-000132d0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-000132e0: 7265 6d6f 7665 5f6c 6162 656c 7328 7365  remove_labels(se
-000132f0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00013300: 2020 2020 2022 2222 5265 6d6f 7665 206c       """Remove l
-00013310: 6162 656c 732e 2222 220a 2020 2020 2020  abels.""".      
-00013320: 2020 7365 6c66 2e5f 6365 6c6c 2e72 656d    self._cell.rem
-00013330: 6f76 6528 2a73 656c 662e 6c61 6265 6c73  ove(*self.labels
-00013340: 290a 0a20 2020 2023 2044 6570 7265 6361  )..    # Depreca
-00013350: 7465 640a 2020 2020 6465 6620 6765 745f  ted.    def get_
-00013360: 696e 666f 2873 656c 6629 3a0a 2020 2020  info(self):.    
-00013370: 2020 2020 2222 2247 6174 6865 7273 2074      """Gathers t
-00013380: 6865 202e 696e 666f 2064 6963 7469 6f6e  he .info diction
-00013390: 6172 6965 7320 6672 6f6d 2065 7665 7279  aries from every
-000133a0: 2073 7562 2d43 6f6d 706f 6e65 6e74 2061   sub-Component a
-000133b0: 6e64 2072 6574 7572 6e73 2074 6865 6d20  nd returns them 
-000133c0: 696e 2061 206c 6973 742e 0a0a 2020 2020  in a list...    
-000133d0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-000133e0: 2020 2020 2020 6465 7074 683a 2069 6e74        depth: int
-000133f0: 206f 7220 4e6f 6e65 0a20 2020 2020 2020   or None.       
-00013400: 2020 2020 2020 2020 2049 6620 6e6f 7420           If not 
-00013410: 4e6f 6e65 2c20 6465 6669 6e65 7320 6672  None, defines fr
-00013420: 6f6d 2068 6f77 206d 616e 7920 7265 6665  om how many refe
-00013430: 7265 6e63 6520 6c65 7665 6c73 2074 6f0a  rence levels to.
-00013440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013450: 7265 7472 6965 7665 2050 6f72 7473 2066  retrieve Ports f
-00013460: 726f 6d2e 0a0a 2020 2020 2020 2020 5265  rom...        Re
-00013470: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
-00013480: 2020 206c 6973 7420 6f66 2064 6963 7469     list of dicti
-00013490: 6f6e 6172 6965 730a 2020 2020 2020 2020  onaries.        
-000134a0: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
-000134b0: 7468 6520 222e 696e 666f 2220 7072 6f70  the ".info" prop
-000134c0: 6572 7479 2064 6963 7469 6f6e 6172 6965  erty dictionarie
-000134d0: 7320 6672 6f6d 2061 6c6c 2073 7562 2d43  s from all sub-C
-000134e0: 6f6d 706f 6e65 6e74 730a 2020 2020 2020  omponents.      
-000134f0: 2020 2222 220a 2020 2020 2020 2020 445f    """.        D_
-00013500: 6c69 7374 203d 2073 656c 662e 6765 745f  list = self.get_
-00013510: 6465 7065 6e64 656e 6369 6573 2872 6563  dependencies(rec
-00013520: 7572 7369 7665 3d54 7275 6529 0a20 2020  ursive=True).   
-00013530: 2020 2020 2072 6574 7572 6e20 5b44 2e69       return [D.i
-00013540: 6e66 6f2e 636f 7079 2829 2066 6f72 2044  nfo.copy() for D
-00013550: 2069 6e20 445f 6c69 7374 5d0a 0a20 2020   in D_list]..   
-00013560: 2064 6566 2072 656d 6170 5f6c 6179 6572   def remap_layer
-00013570: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
-00013580: 206c 6179 6572 6d61 702c 2069 6e63 6c75   layermap, inclu
-00013590: 6465 5f6c 6162 656c 733a 2062 6f6f 6c20  de_labels: bool 
-000135a0: 3d20 5472 7565 2c20 696e 636c 7564 655f  = True, include_
-000135b0: 7061 7468 733a 2062 6f6f 6c20 3d20 5472  paths: bool = Tr
-000135c0: 7565 0a20 2020 2029 202d 3e20 436f 6d70  ue.    ) -> Comp
-000135d0: 6f6e 656e 743a 0a20 2020 2020 2020 2022  onent:.        "
-000135e0: 2222 5265 7475 726e 7320 6120 636f 7079  ""Returns a copy
-000135f0: 206f 6620 7468 6520 636f 6d70 6f6e 656e   of the componen
-00013600: 7420 7769 7468 2072 656d 6170 7065 6420  t with remapped 
-00013610: 6c61 7965 7273 2e0a 0a20 2020 2020 2020  layers...       
-00013620: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00013630: 2020 206c 6179 6572 6d61 703a 2044 6963     layermap: Dic
-00013640: 7469 6f6e 6172 7920 6f66 2076 616c 7565  tionary of value
-00013650: 7320 696e 2066 6f72 6d61 7420 7b6c 6179  s in format {lay
-00013660: 6572 5f66 726f 6d20 3a20 6c61 7965 725f  er_from : layer_
-00013670: 746f 7d2e 0a20 2020 2020 2020 2020 2020  to}..           
-00013680: 2069 6e63 6c75 6465 5f6c 6162 656c 733a   include_labels:
-00013690: 2053 656c 6563 7473 2077 6865 7468 6572   Selects whether
-000136a0: 2074 6f20 6d6f 7665 204c 6162 656c 7320   to move Labels 
-000136b0: 616c 6f6e 6720 7769 7468 2070 6f6c 7967  along with polyg
-000136c0: 6f6e 732e 0a20 2020 2020 2020 2020 2020  ons..           
-000136d0: 2069 6e63 6c75 6465 5f70 6174 6873 3a20   include_paths: 
-000136e0: 5365 6c65 6374 7320 7768 6574 6865 7220  Selects whether 
-000136f0: 746f 206d 6f76 6520 5061 7468 7320 616c  to move Paths al
-00013700: 6f6e 6720 7769 7468 2070 6f6c 7967 6f6e  ong with polygon
-00013710: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
-00013720: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
-00013730: 203d 2073 656c 662e 636f 7079 2829 0a20   = self.copy(). 
-00013740: 2020 2020 2020 206c 6179 6572 6d61 7020         layermap 
-00013750: 3d20 7b5f 7061 7273 655f 6c61 7965 7228  = {_parse_layer(
-00013760: 6b29 3a20 5f70 6172 7365 5f6c 6179 6572  k): _parse_layer
-00013770: 2876 2920 666f 7220 6b2c 2076 2069 6e20  (v) for k, v in 
-00013780: 6c61 7965 726d 6170 2e69 7465 6d73 2829  layermap.items()
-00013790: 7d0a 0a20 2020 2020 2020 2061 6c6c 5f44  }..        all_D
-000137a0: 203d 206c 6973 7428 636f 6d70 6f6e 656e   = list(componen
-000137b0: 742e 6765 745f 6465 7065 6e64 656e 6369  t.get_dependenci
-000137c0: 6573 2854 7275 6529 290a 2020 2020 2020  es(True)).      
-000137d0: 2020 616c 6c5f 442e 6170 7065 6e64 2863    all_D.append(c
-000137e0: 6f6d 706f 6e65 6e74 290a 2020 2020 2020  omponent).      
-000137f0: 2020 666f 7220 4420 696e 2061 6c6c 5f44    for D in all_D
-00013800: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00013810: 7220 7020 696e 2044 2e70 6f6c 7967 6f6e  r p in D.polygon
-00013820: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00013830: 2020 206c 6179 6572 203d 2028 702e 6c61     layer = (p.la
-00013840: 7965 722c 2070 2e64 6174 6174 7970 6529  yer, p.datatype)
-00013850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013860: 2069 6620 6c61 7965 7220 696e 206c 6179   if layer in lay
-00013870: 6572 6d61 703a 0a20 2020 2020 2020 2020  ermap:.         
-00013880: 2020 2020 2020 2020 2020 206e 6577 5f6c             new_l
-00013890: 6179 6572 203d 206c 6179 6572 6d61 705b  ayer = layermap[
-000138a0: 6c61 7965 725d 0a20 2020 2020 2020 2020  layer].         
-000138b0: 2020 2020 2020 2020 2020 2070 2e6c 6179             p.lay
-000138c0: 6572 203d 206e 6577 5f6c 6179 6572 5b30  er = new_layer[0
-000138d0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000138e0: 2020 2020 2020 702e 6461 7461 7479 7065        p.datatype
-000138f0: 203d 206e 6577 5f6c 6179 6572 5b31 5d0a   = new_layer[1].
-00013900: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00013910: 6e63 6c75 6465 5f6c 6162 656c 733a 0a20  nclude_labels:. 
-00013920: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00013930: 6f72 206c 6162 656c 2069 6e20 442e 6c61  or label in D.la
-00013940: 6265 6c73 3a0a 2020 2020 2020 2020 2020  bels:.          
-00013950: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
-00013960: 616c 5f6c 6179 6572 203d 2028 6c61 6265  al_layer = (labe
-00013970: 6c2e 6c61 7965 722c 206c 6162 656c 2e74  l.layer, label.t
-00013980: 6578 7474 7970 6529 0a20 2020 2020 2020  exttype).       
-00013990: 2020 2020 2020 2020 2020 2020 206f 7269               ori
-000139a0: 6769 6e61 6c5f 6c61 7965 7220 3d20 5f70  ginal_layer = _p
-000139b0: 6172 7365 5f6c 6179 6572 286f 7269 6769  arse_layer(origi
-000139c0: 6e61 6c5f 6c61 7965 7229 0a20 2020 2020  nal_layer).     
-000139d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000139e0: 6620 6f72 6967 696e 616c 5f6c 6179 6572  f original_layer
-000139f0: 2069 6e20 6c61 7965 726d 6170 3a0a 2020   in layermap:.  
-00013a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a10: 2020 2020 2020 6e65 775f 6c61 7965 7220        new_layer 
-00013a20: 3d20 6c61 7965 726d 6170 5b6f 7269 6769  = layermap[origi
-00013a30: 6e61 6c5f 6c61 7965 725d 0a20 2020 2020  nal_layer].     
-00013a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a50: 2020 206c 6162 656c 2e6c 6179 6572 203d     label.layer =
-00013a60: 206e 6577 5f6c 6179 6572 5b30 5d0a 2020   new_layer[0].  
-00013a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a80: 2020 2020 2020 6c61 6265 6c2e 7465 7874        label.text
-00013a90: 7479 7065 203d 206e 6577 5f6c 6179 6572  type = new_layer
-00013aa0: 5b31 5d0a 0a20 2020 2020 2020 2020 2020  [1]..           
-00013ab0: 2069 6620 696e 636c 7564 655f 7061 7468   if include_path
-00013ac0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00013ad0: 2020 2066 6f72 2070 6174 6820 696e 2044     for path in D
-00013ae0: 2e70 6174 6873 3a0a 2020 2020 2020 2020  .paths:.        
-00013af0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00013b00: 6c61 7965 7273 203d 206c 6973 7428 7061  layers = list(pa
-00013b10: 7468 2e6c 6179 6572 7329 0a20 2020 2020  th.layers).     
-00013b20: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00013b30: 6577 5f64 6174 6174 7970 6573 203d 206c  ew_datatypes = l
-00013b40: 6973 7428 7061 7468 2e64 6174 6174 7970  ist(path.datatyp
-00013b50: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-00013b60: 2020 2020 2020 2020 666f 7220 6c61 7965          for laye
-00013b70: 725f 6e75 6d62 6572 2069 6e20 7261 6e67  r_number in rang
-00013b80: 6528 6c65 6e28 6e65 775f 6c61 7965 7273  e(len(new_layers
-00013b90: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-00013ba0: 2020 2020 2020 2020 2020 2020 6f72 6967              orig
-00013bb0: 696e 616c 5f6c 6179 6572 203d 205f 7061  inal_layer = _pa
-00013bc0: 7273 655f 6c61 7965 7228 0a20 2020 2020  rse_layer(.     
-00013bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013be0: 2020 2020 2020 2028 6e65 775f 6c61 7965         (new_laye
-00013bf0: 7273 5b6c 6179 6572 5f6e 756d 6265 725d  rs[layer_number]
-00013c00: 2c20 6e65 775f 6461 7461 7479 7065 735b  , new_datatypes[
-00013c10: 6c61 7965 725f 6e75 6d62 6572 5d29 0a20  layer_number]). 
-00013c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c30: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00007450: 2020 2073 7566 6669 783a 2073 7472 203d     suffix: str =
+00007460: 2022 222c 0a20 2020 2020 2020 202a 2a6b   "",.        **k
+00007470: 7761 7267 732c 0a20 2020 2029 202d 3e20  wargs,.    ) -> 
+00007480: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00007490: 2241 6464 2061 206c 6973 7420 6f72 2064  "Add a list or d
+000074a0: 6963 7420 6f66 2070 6f72 7473 2e0a 0a20  ict of ports... 
+000074b0: 2020 2020 2020 2079 6f75 2063 616e 2069         you can i
+000074c0: 6e63 6c75 6465 2061 2070 7265 6669 7820  nclude a prefix 
+000074d0: 746f 2061 6464 2074 6f20 7468 6520 6e65  to add to the ne
+000074e0: 7720 706f 7274 206e 616d 6573 2074 6f20  w port names to 
+000074f0: 6176 6f69 6420 6e61 6d65 2063 6f6e 666c  avoid name confl
+00007500: 6963 7473 2e0a 0a20 2020 2020 2020 2041  icts...        A
+00007510: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00007520: 2070 6f72 7473 3a20 6c69 7374 206f 7220   ports: list or 
+00007530: 6469 6374 206f 6620 706f 7274 732e 0a20  dict of ports.. 
+00007540: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+00007550: 783a 2074 6f20 7072 6570 656e 6420 746f  x: to prepend to
+00007560: 2065 6163 6820 706f 7274 206e 616d 652e   each port name.
+00007570: 0a20 2020 2020 2020 2020 2020 2073 7566  .            suf
+00007580: 6669 783a 2074 6f20 6170 7065 6e64 2074  fix: to append t
+00007590: 6f20 6561 6368 2070 6f72 7420 6e61 6d65  o each port name
+000075a0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000075b0: 2020 2020 2020 706f 7274 7320 3d20 706f        ports = po
+000075c0: 7274 7320 6966 2069 7369 6e73 7461 6e63  rts if isinstanc
+000075d0: 6528 706f 7274 732c 206c 6973 7429 2065  e(ports, list) e
+000075e0: 6c73 6520 706f 7274 732e 7661 6c75 6573  lse ports.values
+000075f0: 2829 0a20 2020 2020 2020 2066 6f72 2070  ().        for p
+00007600: 6f72 7420 696e 206c 6973 7428 706f 7274  ort in list(port
+00007610: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00007620: 6e61 6d65 203d 2066 227b 7072 6566 6978  name = f"{prefix
+00007630: 7d7b 706f 7274 2e6e 616d 657d 7b73 7566  }{port.name}{suf
+00007640: 6669 787d 220a 2020 2020 2020 2020 2020  fix}".          
+00007650: 2020 7365 6c66 2e61 6464 5f70 6f72 7428    self.add_port(
+00007660: 6e61 6d65 3d6e 616d 652c 2070 6f72 743d  name=name, port=
+00007670: 706f 7274 2c20 2a2a 6b77 6172 6773 290a  port, **kwargs).
+00007680: 0a20 2020 2064 6566 2073 6e61 705f 706f  .    def snap_po
+00007690: 7274 735f 746f 5f67 7269 6428 7365 6c66  rts_to_grid(self
+000076a0: 2c20 6e6d 3a20 696e 7420 3d20 3129 202d  , nm: int = 1) -
+000076b0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000076c0: 666f 7220 706f 7274 2069 6e20 7365 6c66  for port in self
+000076d0: 2e70 6f72 7473 2e76 616c 7565 7328 293a  .ports.values():
+000076e0: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
+000076f0: 742e 736e 6170 5f74 6f5f 6772 6964 286e  t.snap_to_grid(n
+00007700: 6d3d 6e6d 290a 0a20 2020 2064 6566 2072  m=nm)..    def r
+00007710: 656d 6f76 655f 6c61 7965 7273 280a 2020  emove_layers(.  
+00007720: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00007730: 2020 2020 6c61 7965 7273 3a20 4c69 7374      layers: List
+00007740: 5b4c 6179 6572 5370 6563 5d2c 0a20 2020  [LayerSpec],.   
+00007750: 2020 2020 2069 6e63 6c75 6465 5f6c 6162       include_lab
+00007760: 656c 733a 2062 6f6f 6c20 3d20 5472 7565  els: bool = True
+00007770: 2c0a 2020 2020 2020 2020 696e 7665 7274  ,.        invert
+00007780: 5f73 656c 6563 7469 6f6e 3a20 626f 6f6c  _selection: bool
+00007790: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+000077a0: 2020 7265 6375 7273 6976 653a 2062 6f6f    recursive: boo
+000077b0: 6c20 3d20 5472 7565 2c0a 2020 2020 2920  l = True,.    ) 
+000077c0: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
+000077d0: 2020 2020 2020 2222 2252 656d 6f76 6520        """Remove 
+000077e0: 6120 6c69 7374 206f 6620 6c61 7965 7273  a list of layers
+000077f0: 2061 6e64 2072 6574 7572 6e73 2074 6865   and returns the
+00007800: 2073 616d 6520 436f 6d70 6f6e 656e 742e   same Component.
+00007810: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+00007820: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00007830: 7273 3a20 6c69 7374 206f 6620 6c61 7965  rs: list of laye
+00007840: 7273 2074 6f20 7265 6d6f 7665 2e0a 2020  rs to remove..  
+00007850: 2020 2020 2020 2020 2020 696e 636c 7564            includ
+00007860: 655f 6c61 6265 6c73 3a20 7265 6d6f 7665  e_labels: remove
+00007870: 206c 6162 656c 7320 6f6e 2074 686f 7365   labels on those
+00007880: 206c 6179 6572 732e 0a20 2020 2020 2020   layers..       
+00007890: 2020 2020 2069 6e76 6572 745f 7365 6c65       invert_sele
+000078a0: 6374 696f 6e3a 2072 656d 6f76 6573 2061  ction: removes a
+000078b0: 6c6c 206c 6179 6572 7320 6578 6365 7074  ll layers except
+000078c0: 206c 6179 6572 7320 7370 6563 6966 6965   layers specifie
+000078d0: 642e 0a20 2020 2020 2020 2020 2020 2072  d..            r
+000078e0: 6563 7572 7369 7665 3a20 6f70 6572 6174  ecursive: operat
+000078f0: 6520 6f6e 2074 6865 2063 656c 6c73 2069  e on the cells i
+00007900: 6e63 6c75 6465 6420 696e 2074 6869 7320  ncluded in this 
+00007910: 6365 6c6c 2e0a 2020 2020 2020 2020 2222  cell..        ""
+00007920: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
+00007930: 6473 6661 6374 6f72 7920 696d 706f 7274  dsfactory import
+00007940: 2067 6574 5f6c 6179 6572 0a0a 2020 2020   get_layer..    
+00007950: 2020 2020 636f 6d70 6f6e 656e 7420 3d20      component = 
+00007960: 7365 6c66 2e66 6c61 7474 656e 2829 2069  self.flatten() i
+00007970: 6620 7265 6375 7273 6976 6520 616e 6420  f recursive and 
+00007980: 7365 6c66 2e72 6566 6572 656e 6365 7320  self.references 
+00007990: 656c 7365 2073 656c 660a 2020 2020 2020  else self.      
+000079a0: 2020 6c61 7965 7273 203d 205b 6765 745f    layers = [get_
+000079b0: 6c61 7965 7228 6c61 7965 7229 2066 6f72  layer(layer) for
+000079c0: 206c 6179 6572 2069 6e20 6c61 7965 7273   layer in layers
+000079d0: 5d0a 0a20 2020 2020 2020 2073 686f 756c  ]..        shoul
+000079e0: 645f 7265 6d6f 7665 203d 206e 6f74 2069  d_remove = not i
+000079f0: 6e76 6572 745f 7365 6c65 6374 696f 6e0a  nvert_selection.
+00007a00: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
+00007a10: 742e 5f63 656c 6c2e 6669 6c74 6572 280a  t._cell.filter(.
+00007a20: 2020 2020 2020 2020 2020 2020 7370 6563              spec
+00007a30: 3d6c 6179 6572 732c 0a20 2020 2020 2020  =layers,.       
+00007a40: 2020 2020 2072 656d 6f76 653d 7368 6f75       remove=shou
+00007a50: 6c64 5f72 656d 6f76 652c 0a20 2020 2020  ld_remove,.     
+00007a60: 2020 2020 2020 2070 6f6c 7967 6f6e 733d         polygons=
+00007a70: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+00007a80: 2020 7061 7468 733d 5472 7565 2c0a 2020    paths=True,.  
+00007a90: 2020 2020 2020 2020 2020 6c61 6265 6c73            labels
+00007aa0: 3d69 6e63 6c75 6465 5f6c 6162 656c 732c  =include_labels,
+00007ab0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00007ac0: 2020 2072 6574 7572 6e20 636f 6d70 6f6e     return compon
+00007ad0: 656e 740a 0a20 2020 2064 6566 2065 7874  ent..    def ext
+00007ae0: 7261 6374 280a 2020 2020 2020 2020 7365  ract(.        se
+00007af0: 6c66 2c0a 2020 2020 2020 2020 6c61 7965  lf,.        laye
+00007b00: 7273 3a20 4c69 7374 5b55 6e69 6f6e 5b54  rs: List[Union[T
+00007b10: 7570 6c65 5b69 6e74 2c20 696e 745d 2c20  uple[int, int], 
+00007b20: 7374 725d 5d2c 0a20 2020 2029 202d 3e20  str]],.    ) -> 
+00007b30: 436f 6d70 6f6e 656e 743a 0a20 2020 2020  Component:.     
+00007b40: 2020 2022 2222 4578 7472 6163 7420 706f     """Extract po
+00007b50: 6c79 676f 6e73 2066 726f 6d20 6120 436f  lygons from a Co
+00007b60: 6d70 6f6e 656e 7420 616e 6420 7265 7475  mponent and retu
+00007b70: 726e 7320 6120 6e65 7720 436f 6d70 6f6e  rns a new Compon
+00007b80: 656e 742e 2222 220a 2020 2020 2020 2020  ent.""".        
+00007b90: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+00007ba0: 7064 6b20 696d 706f 7274 2067 6574 5f6c  pdk import get_l
+00007bb0: 6179 6572 0a0a 2020 2020 2020 2020 6966  ayer..        if
+00007bc0: 2074 7970 6528 6c61 7965 7273 2920 6e6f   type(layers) no
+00007bd0: 7420 696e 2028 6c69 7374 2c20 7475 706c  t in (list, tupl
+00007be0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00007bf0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00007c00: 2866 226c 6179 6572 7320 7b6c 6179 6572  (f"layers {layer
+00007c10: 7321 727d 206e 6565 6473 2074 6f20 6265  s!r} needs to be
+00007c20: 2061 206c 6973 7420 6f72 2074 7570 6c65   a list or tuple
+00007c30: 2229 0a0a 2020 2020 2020 2020 6c61 7965  ")..        laye
+00007c40: 7273 203d 205b 6765 745f 6c61 7965 7228  rs = [get_layer(
+00007c50: 6c61 7965 7229 2066 6f72 206c 6179 6572  layer) for layer
+00007c60: 2069 6e20 6c61 7965 7273 5d0a 2020 2020   in layers].    
+00007c70: 2020 2020 2320 636f 6d70 6f6e 656e 7420      # component 
+00007c80: 3d20 7365 6c66 2e63 6f70 7928 290a 2020  = self.copy().  
+00007c90: 2020 2020 2020 2320 636f 6d70 6f6e 656e        # componen
+00007ca0: 742e 5f63 656c 6c2e 6669 6c74 6572 2873  t._cell.filter(s
+00007cb0: 7065 633d 6c61 7965 7273 2c20 7265 6d6f  pec=layers, remo
+00007cc0: 7665 3d46 616c 7365 290a 0a20 2020 2020  ve=False)..     
+00007cd0: 2020 2063 6f6d 706f 6e65 6e74 203d 2043     component = C
+00007ce0: 6f6d 706f 6e65 6e74 2829 0a20 2020 2020  omponent().     
+00007cf0: 2020 2070 6f6c 795f 6469 6374 203d 2073     poly_dict = s
+00007d00: 656c 662e 6765 745f 706f 6c79 676f 6e73  elf.get_polygons
+00007d10: 2862 795f 7370 6563 3d54 7275 652c 2069  (by_spec=True, i
+00007d20: 6e63 6c75 6465 5f70 6174 6873 3d46 616c  nclude_paths=Fal
+00007d30: 7365 290a 0a20 2020 2020 2020 2066 6f72  se)..        for
+00007d40: 206c 6179 6572 2069 6e20 6c61 7965 7273   layer in layers
+00007d50: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00007d60: 206c 6179 6572 2069 6e20 706f 6c79 5f64   layer in poly_d
+00007d70: 6963 743a 0a20 2020 2020 2020 2020 2020  ict:.           
+00007d80: 2020 2020 2070 6f6c 7967 6f6e 7320 3d20       polygons = 
+00007d90: 706f 6c79 5f64 6963 745b 6c61 7965 725d  poly_dict[layer]
+00007da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007db0: 2066 6f72 2070 6f6c 7967 6f6e 2069 6e20   for polygon in 
+00007dc0: 706f 6c79 676f 6e73 3a0a 2020 2020 2020  polygons:.      
+00007dd0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00007de0: 6d70 6f6e 656e 742e 6164 645f 706f 6c79  mponent.add_poly
+00007df0: 676f 6e28 706f 6c79 676f 6e2c 206c 6179  gon(polygon, lay
+00007e00: 6572 290a 0a20 2020 2020 2020 2066 6f72  er)..        for
+00007e10: 206c 6179 6572 2069 6e20 6c61 7965 7273   layer in layers
+00007e20: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+00007e30: 7220 7061 7468 2069 6e20 7365 6c66 2e5f  r path in self._
+00007e40: 6365 6c6c 2e67 6574 5f70 6174 6873 286c  cell.get_paths(l
+00007e50: 6179 6572 3d6c 6179 6572 293a 0a20 2020  ayer=layer):.   
+00007e60: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+00007e70: 706f 6e65 6e74 2e61 6464 2870 6174 6829  ponent.add(path)
+00007e80: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00007e90: 2063 6f6d 706f 6e65 6e74 0a0a 2020 2020   component..    
+00007ea0: 6465 6620 6164 645f 706f 6c79 676f 6e28  def add_polygon(
+00007eb0: 7365 6c66 2c20 706f 696e 7473 2c20 6c61  self, points, la
+00007ec0: 7965 723d 6e70 2e6e 616e 293a 0a20 2020  yer=np.nan):.   
+00007ed0: 2020 2020 2022 2222 4164 6473 2061 2050       """Adds a P
+00007ee0: 6f6c 7967 6f6e 2074 6f20 7468 6520 436f  olygon to the Co
+00007ef0: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
+00007f00: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+00007f10: 2020 2020 706f 696e 7473 3a20 436f 6f72      points: Coor
+00007f20: 6469 6e61 7465 7320 6f66 2074 6865 2076  dinates of the v
+00007f30: 6572 7469 6365 7320 6f66 2074 6865 2050  ertices of the P
+00007f40: 6f6c 7967 6f6e 2e0a 2020 2020 2020 2020  olygon..        
+00007f50: 2020 2020 6c61 7965 723a 206c 6179 6572      layer: layer
+00007f60: 2073 7065 6320 746f 2061 6464 2070 6f6c   spec to add pol
+00007f70: 7967 6f6e 206f 6e2e 0a20 2020 2020 2020  ygon on..       
+00007f80: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
+00007f90: 6d20 6764 7366 6163 746f 7279 2e70 646b  m gdsfactory.pdk
+00007fa0: 2069 6d70 6f72 7420 6765 745f 6c61 7965   import get_laye
+00007fb0: 720a 0a20 2020 2020 2020 206c 6179 6572  r..        layer
+00007fc0: 203d 2067 6574 5f6c 6179 6572 286c 6179   = get_layer(lay
+00007fd0: 6572 290a 0a20 2020 2020 2020 2069 6620  er)..        if 
+00007fe0: 6c61 7965 7220 6973 204e 6f6e 653a 0a20  layer is None:. 
+00007ff0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00008000: 6e20 4e6f 6e65 0a0a 2020 2020 2020 2020  n None..        
+00008010: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00008020: 2069 6620 6973 696e 7374 616e 6365 286c   if isinstance(l
+00008030: 6179 6572 2c20 7365 7429 3a0a 2020 2020  ayer, set):.    
+00008040: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00008050: 726e 205b 7365 6c66 2e61 6464 5f70 6f6c  rn [self.add_pol
+00008060: 7967 6f6e 2870 6f69 6e74 732c 206c 7929  ygon(points, ly)
+00008070: 2066 6f72 206c 7920 696e 206c 6179 6572   for ly in layer
+00008080: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
+00008090: 6966 2061 6c6c 2869 7369 6e73 7461 6e63  if all(isinstanc
+000080a0: 6528 6c79 2c20 284c 6179 6572 2929 2066  e(ly, (Layer)) f
+000080b0: 6f72 206c 7920 696e 206c 6179 6572 293a  or ly in layer):
+000080c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000080d0: 2072 6574 7572 6e20 5b73 656c 662e 6164   return [self.ad
+000080e0: 645f 706f 6c79 676f 6e28 706f 696e 7473  d_polygon(points
+000080f0: 2c20 6c79 2920 666f 7220 6c79 2069 6e20  , ly) for ly in 
+00008100: 6c61 7965 725d 0a20 2020 2020 2020 2020  layer].         
+00008110: 2020 2065 6c69 6620 6c65 6e28 6c61 7965     elif len(laye
+00008120: 7229 203e 2032 3a20 2023 2053 6f6d 656f  r) > 2:  # Someo
+00008130: 6e65 2077 726f 7465 2065 2e67 2e20 6c61  ne wrote e.g. la
+00008140: 7965 7220 3d20 5b31 2c34 2c35 5d0a 2020  yer = [1,4,5].  
+00008150: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00008160: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+00008170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008180: 2020 2020 2222 2220 5b50 4849 444c 5d20      """ [PHIDL] 
+00008190: 4966 2073 7065 6369 6679 696e 6720 6d75  If specifying mu
+000081a0: 6c74 6970 6c65 206c 6179 6572 730a 2020  ltiple layers.  
+000081b0: 2020 2020 2020 2020 2020 2020 2020 796f                yo
+000081c0: 7520 6d75 7374 2075 7365 2073 6574 206e  u must use set n
+000081d0: 6f74 6174 696f 6e2c 2065 2e67 2e20 7b31  otation, e.g. {1
+000081e0: 2c35 2c38 7d20 2222 220a 2020 2020 2020  ,5,8} """.      
+000081f0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00008200: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00008210: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+00008220: 2020 7061 7373 0a0a 2020 2020 2020 2020    pass..        
+00008230: 6966 2069 7369 6e73 7461 6e63 6528 706f  if isinstance(po
+00008240: 696e 7473 2c20 6764 7374 6b2e 506f 6c79  ints, gdstk.Poly
+00008250: 676f 6e29 3a0a 2020 2020 2020 2020 2020  gon):.          
+00008260: 2020 2320 6966 206c 6179 6572 2069 7320    # if layer is 
+00008270: 756e 7370 6563 6966 6965 6420 6f72 206d  unspecified or m
+00008280: 6174 6368 6573 206f 7269 6769 6e61 6c20  atches original 
+00008290: 706f 6c79 676f 6e2c 206a 7573 7420 6164  polygon, just ad
+000082a0: 6420 6974 2061 732d 6973 0a20 2020 2020  d it as-is.     
+000082b0: 2020 2020 2020 2070 6f6c 7967 6f6e 203d         polygon =
+000082c0: 2070 6f69 6e74 730a 2020 2020 2020 2020   points.        
+000082d0: 2020 2020 6966 206c 6179 6572 2069 7320      if layer is 
+000082e0: 6e70 2e6e 616e 206f 7220 280a 2020 2020  np.nan or (.    
+000082f0: 2020 2020 2020 2020 2020 2020 6973 696e              isin
+00008300: 7374 616e 6365 286c 6179 6572 2c20 7475  stance(layer, tu
+00008310: 706c 6529 2061 6e64 2028 706f 6c79 676f  ple) and (polygo
+00008320: 6e2e 6c61 7965 722c 2070 6f6c 7967 6f6e  n.layer, polygon
+00008330: 2e64 6174 6174 7970 6529 203d 3d20 6c61  .datatype) == la
+00008340: 7965 720a 2020 2020 2020 2020 2020 2020  yer.            
+00008350: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00008360: 2020 2070 6f6c 7967 6f6e 203d 2050 6f6c     polygon = Pol
+00008370: 7967 6f6e 2870 6f6c 7967 6f6e 2e70 6f69  ygon(polygon.poi
+00008380: 6e74 732c 2070 6f6c 7967 6f6e 2e6c 6179  nts, polygon.lay
+00008390: 6572 2c20 706f 6c79 676f 6e2e 6461 7461  er, polygon.data
+000083a0: 7479 7065 290a 2020 2020 2020 2020 2020  type).          
+000083b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000083c0: 2020 2020 2020 2020 6c61 7965 722c 2064          layer, d
+000083d0: 6174 6174 7970 6520 3d20 5f70 6172 7365  atatype = _parse
+000083e0: 5f6c 6179 6572 286c 6179 6572 290a 2020  _layer(layer).  
+000083f0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00008400: 6c79 676f 6e20 3d20 506f 6c79 676f 6e28  lygon = Polygon(
+00008410: 706f 6c79 676f 6e2e 706f 696e 7473 2c20  polygon.points, 
+00008420: 6c61 7965 722c 2064 6174 6174 7970 6529  layer, datatype)
+00008430: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008440: 662e 5f61 6464 5f70 6f6c 7967 6f6e 7328  f._add_polygons(
+00008450: 706f 6c79 676f 6e29 0a20 2020 2020 2020  polygon).       
+00008460: 2020 2020 2072 6574 7572 6e20 706f 6c79       return poly
+00008470: 676f 6e0a 0a20 2020 2020 2020 2065 6c69  gon..        eli
+00008480: 6620 6861 7361 7474 7228 706f 696e 7473  f hasattr(points
+00008490: 2c20 2267 656f 6d73 2229 3a0a 2020 2020  , "geoms"):.    
+000084a0: 2020 2020 2020 2020 666f 7220 6765 6f6d          for geom
+000084b0: 2069 6e20 706f 696e 7473 2e67 656f 6d73   in points.geoms
+000084c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000084d0: 2020 706f 6c79 676f 6e20 3d20 7365 6c66    polygon = self
+000084e0: 2e61 6464 5f70 6f6c 7967 6f6e 2867 656f  .add_polygon(geo
+000084f0: 6d2c 206c 6179 6572 3d6c 6179 6572 290a  m, layer=layer).
+00008500: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00008510: 726e 2070 6f6c 7967 6f6e 0a20 2020 2020  rn polygon.     
+00008520: 2020 2065 6c69 6620 6861 7361 7474 7228     elif hasattr(
+00008530: 706f 696e 7473 2c20 2265 7874 6572 696f  points, "exterio
+00008540: 7222 293a 2020 2320 706f 696e 7473 2069  r"):  # points i
+00008550: 7320 6120 7368 6170 656c 7920 506f 6c79  s a shapely Poly
+00008560: 676f 6e0a 2020 2020 2020 2020 2020 2020  gon.            
+00008570: 6c61 7965 722c 2064 6174 6174 7970 6520  layer, datatype 
+00008580: 3d20 5f70 6172 7365 5f6c 6179 6572 286c  = _parse_layer(l
+00008590: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
+000085a0: 2020 706f 696e 7473 5f6f 6e5f 6772 6964    points_on_grid
+000085b0: 203d 206e 702e 726f 756e 6428 706f 696e   = np.round(poin
+000085c0: 7473 2e65 7874 6572 696f 722e 636f 6f72  ts.exterior.coor
+000085d0: 6473 2c20 3329 0a20 2020 2020 2020 2020  ds, 3).         
+000085e0: 2020 2070 6f6c 7967 6f6e 203d 2067 6473     polygon = gds
+000085f0: 746b 2e50 6f6c 7967 6f6e 2870 6f69 6e74  tk.Polygon(point
+00008600: 735f 6f6e 5f67 7269 642c 206c 6179 6572  s_on_grid, layer
+00008610: 2c20 6461 7461 7479 7065 290a 0a20 2020  , datatype)..   
+00008620: 2020 2020 2020 2020 2069 6620 706f 696e           if poin
+00008630: 7473 2e69 6e74 6572 696f 7273 3a0a 2020  ts.interiors:.  
+00008640: 2020 2020 2020 2020 2020 2020 2020 6672                fr
+00008650: 6f6d 2073 6861 7065 6c79 2069 6d70 6f72  om shapely impor
+00008660: 7420 6765 745f 636f 6f72 6469 6e61 7465  t get_coordinate
+00008670: 730a 0a20 2020 2020 2020 2020 2020 2020  s..             
+00008680: 2020 2070 6f69 6e74 735f 6f6e 5f67 7269     points_on_gri
+00008690: 645f 696e 7465 7269 6f72 203d 206e 702e  d_interior = np.
+000086a0: 726f 756e 6428 6765 745f 636f 6f72 6469  round(get_coordi
+000086b0: 6e61 7465 7328 706f 696e 7473 2e69 6e74  nates(points.int
+000086c0: 6572 696f 7273 292c 2033 290a 2020 2020  eriors), 3).    
+000086d0: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
+000086e0: 676f 6e5f 696e 7465 7269 6f72 203d 2067  gon_interior = g
+000086f0: 6473 746b 2e50 6f6c 7967 6f6e 280a 2020  dstk.Polygon(.  
+00008700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008710: 2020 706f 696e 7473 5f6f 6e5f 6772 6964    points_on_grid
+00008720: 5f69 6e74 6572 696f 722c 206c 6179 6572  _interior, layer
+00008730: 2c20 6461 7461 7479 7065 0a20 2020 2020  , datatype.     
+00008740: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00008750: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
+00008760: 7967 6f6e 7320 3d20 6764 7374 6b2e 626f  ygons = gdstk.bo
+00008770: 6f6c 6561 6e28 0a20 2020 2020 2020 2020  olean(.         
+00008780: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+00008790: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+000087a0: 2020 2020 2020 2020 706f 6c79 676f 6e5f          polygon_
+000087b0: 696e 7465 7269 6f72 2c0a 2020 2020 2020  interior,.      
+000087c0: 2020 2020 2020 2020 2020 2020 2020 6f70                op
+000087d0: 6572 6174 696f 6e3d 226e 6f74 222c 0a20  eration="not",. 
+000087e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000087f0: 2020 206c 6179 6572 3d6c 6179 6572 2c0a     layer=layer,.
+00008800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008810: 2020 2020 6461 7461 7479 7065 3d64 6174      datatype=dat
+00008820: 6174 7970 652c 0a20 2020 2020 2020 2020  atype,.         
+00008830: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00008840: 2020 2020 2020 2020 2066 6f72 2070 6f6c           for pol
+00008850: 7967 6f6e 2069 6e20 706f 6c79 676f 6e73  ygon in polygons
+00008860: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00008870: 2020 2020 2020 7365 6c66 2e5f 6164 645f        self._add_
+00008880: 706f 6c79 676f 6e73 2870 6f6c 7967 6f6e  polygons(polygon
+00008890: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000088a0: 2020 7265 7475 726e 2070 6f6c 7967 6f6e    return polygon
+000088b0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000088c0: 6c66 2e5f 6164 645f 706f 6c79 676f 6e73  lf._add_polygons
+000088d0: 2870 6f6c 7967 6f6e 290a 2020 2020 2020  (polygon).      
+000088e0: 2020 2020 2020 7265 7475 726e 2070 6f6c        return pol
+000088f0: 7967 6f6e 0a0a 2020 2020 2020 2020 706f  ygon..        po
+00008900: 696e 7473 203d 206e 702e 6173 6172 7261  ints = np.asarra
+00008910: 7928 706f 696e 7473 290a 2020 2020 2020  y(points).      
+00008920: 2020 6966 2070 6f69 6e74 732e 6e64 696d    if points.ndim
+00008930: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+00008940: 2020 2072 6574 7572 6e20 5b73 656c 662e     return [self.
+00008950: 6164 645f 706f 6c79 676f 6e28 706f 6c79  add_polygon(poly
+00008960: 2c20 6c61 7965 723d 6c61 7965 7229 2066  , layer=layer) f
+00008970: 6f72 2070 6f6c 7920 696e 2070 6f69 6e74  or poly in point
+00008980: 735d 0a20 2020 2020 2020 2069 6620 6c61  s].        if la
+00008990: 7965 7220 6973 206e 702e 6e61 6e3a 0a20  yer is np.nan:. 
+000089a0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+000089b0: 203d 2030 0a0a 2020 2020 2020 2020 6966   = 0..        if
+000089c0: 2070 6f69 6e74 732e 6e64 696d 203d 3d20   points.ndim == 
+000089d0: 323a 0a20 2020 2020 2020 2020 2020 2023  2:.            #
+000089e0: 2061 6464 2073 696e 676c 6520 706f 6c79   add single poly
+000089f0: 676f 6e20 6672 6f6d 2070 6f69 6e74 730a  gon from points.
+00008a00: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00008a10: 656e 2870 6f69 6e74 735b 305d 2920 3e20  en(points[0]) > 
+00008a20: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
+00008a30: 2020 2023 2043 6f6e 7665 7274 2074 6f20     # Convert to 
+00008a40: 666f 726d 205b 5b31 2c32 5d2c 5b33 2c34  form [[1,2],[3,4
+00008a50: 5d2c 5b35 2c36 5d5d 0a20 2020 2020 2020  ],[5,6]].       
+00008a60: 2020 2020 2020 2020 2070 6f69 6e74 7320           points 
+00008a70: 3d20 6e70 2e63 6f6c 756d 6e5f 7374 6163  = np.column_stac
+00008a80: 6b28 706f 696e 7473 290a 2020 2020 2020  k(points).      
+00008a90: 2020 2020 2020 6c61 7965 722c 2064 6174        layer, dat
+00008aa0: 6174 7970 6520 3d20 5f70 6172 7365 5f6c  atype = _parse_l
+00008ab0: 6179 6572 286c 6179 6572 290a 2020 2020  ayer(layer).    
+00008ac0: 2020 2020 2020 2020 706f 6c79 676f 6e20          polygon 
+00008ad0: 3d20 506f 6c79 676f 6e28 706f 696e 7473  = Polygon(points
+00008ae0: 2c20 6c61 7965 723d 6c61 7965 722c 2064  , layer=layer, d
+00008af0: 6174 6174 7970 653d 6461 7461 7479 7065  atatype=datatype
+00008b00: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00008b10: 6c66 2e5f 6164 645f 706f 6c79 676f 6e73  lf._add_polygons
+00008b20: 2870 6f6c 7967 6f6e 290a 2020 2020 2020  (polygon).      
+00008b30: 2020 2020 2020 7265 7475 726e 2070 6f6c        return pol
+00008b40: 7967 6f6e 0a20 2020 2020 2020 2065 6c69  ygon.        eli
+00008b50: 6620 706f 696e 7473 2e6e 6469 6d20 3d3d  f points.ndim ==
+00008b60: 2033 3a0a 2020 2020 2020 2020 2020 2020   3:.            
+00008b70: 6c61 7965 722c 2064 6174 6174 7970 6520  layer, datatype 
+00008b80: 3d20 5f70 6172 7365 5f6c 6179 6572 286c  = _parse_layer(l
+00008b90: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
+00008ba0: 2020 706f 6c79 676f 6e73 203d 205b 0a20    polygons = [. 
+00008bb0: 2020 2020 2020 2020 2020 2020 2020 2050                 P
+00008bc0: 6f6c 7967 6f6e 2870 706f 696e 7473 2c20  olygon(ppoints, 
+00008bd0: 6c61 7965 723d 6c61 7965 722c 2064 6174  layer=layer, dat
+00008be0: 6174 7970 653d 6461 7461 7479 7065 2920  atype=datatype) 
+00008bf0: 666f 7220 7070 6f69 6e74 7320 696e 2070  for ppoints in p
+00008c00: 6f69 6e74 730a 2020 2020 2020 2020 2020  oints.          
+00008c10: 2020 5d0a 2020 2020 2020 2020 2020 2020    ].            
+00008c20: 7365 6c66 2e5f 6164 645f 706f 6c79 676f  self._add_polygo
+00008c30: 6e73 282a 706f 6c79 676f 6e73 290a 2020  ns(*polygons).  
+00008c40: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00008c50: 2070 6f6c 7967 6f6e 730a 2020 2020 2020   polygons.      
+00008c60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00008c70: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00008c80: 7272 6f72 2866 2255 6e61 626c 6520 746f  rror(f"Unable to
+00008c90: 2061 6464 207b 706f 696e 7473 2e6e 6469   add {points.ndi
+00008ca0: 6d7d 2d64 696d 656e 7369 6f6e 616c 2070  m}-dimensional p
+00008cb0: 6f69 6e74 7320 6f62 6a65 6374 2229 0a0a  oints object")..
+00008cc0: 2020 2020 6465 6620 5f61 6464 5f70 6f6c      def _add_pol
+00008cd0: 7967 6f6e 7328 7365 6c66 2c20 2a70 6f6c  ygons(self, *pol
+00008ce0: 7967 6f6e 733a 204c 6973 745b 506f 6c79  ygons: List[Poly
+00008cf0: 676f 6e5d 2920 2d3e 204e 6f6e 653a 0a20  gon]) -> None:. 
+00008d00: 2020 2020 2020 2073 656c 662e 6973 5f75         self.is_u
+00008d10: 6e6c 6f63 6b65 6428 290a 2020 2020 2020  nlocked().      
+00008d20: 2020 7365 6c66 2e5f 6365 6c6c 2e61 6464    self._cell.add
+00008d30: 282a 706f 6c79 676f 6e73 290a 0a20 2020  (*polygons)..   
+00008d40: 2064 6566 2063 6f70 7928 7365 6c66 2920   def copy(self) 
+00008d50: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
+00008d60: 2020 2020 2020 7265 7475 726e 2063 6f70        return cop
+00008d70: 7928 7365 6c66 290a 0a20 2020 2064 6566  y(self)..    def
+00008d80: 2061 6464 5f72 6566 5f63 6f6e 7461 696e   add_ref_contain
+00008d90: 6572 2873 656c 662c 2063 6f6d 706f 6e65  er(self, compone
+00008da0: 6e74 3a20 436f 6d70 6f6e 656e 7429 202d  nt: Component) -
+00008db0: 3e20 436f 6d70 6f6e 656e 7452 6566 6572  > ComponentRefer
+00008dc0: 656e 6365 3a0a 2020 2020 2020 2020 2222  ence:.        ""
+00008dd0: 2241 6464 2072 6566 6572 656e 6365 2c20  "Add reference, 
+00008de0: 706f 7274 7320 616e 6420 636f 7079 5f63  ports and copy_c
+00008df0: 6869 6c64 5f69 6e66 6f2e 2222 220a 2020  hild_info.""".  
+00008e00: 2020 2020 2020 7265 6620 3d20 7365 6c66        ref = self
+00008e10: 203c 3c20 636f 6d70 6f6e 656e 740a 2020   << component.  
+00008e20: 2020 2020 2020 7365 6c66 2e61 6464 5f70        self.add_p
+00008e30: 6f72 7473 2872 6566 2e70 6f72 7473 290a  orts(ref.ports).
+00008e40: 2020 2020 2020 2020 7365 6c66 2e63 6f70          self.cop
+00008e50: 795f 6368 696c 645f 696e 666f 2863 6f6d  y_child_info(com
+00008e60: 706f 6e65 6e74 290a 2020 2020 2020 2020  ponent).        
+00008e70: 7265 7475 726e 2072 6566 0a0a 2020 2020  return ref..    
+00008e80: 6465 6620 636f 7079 5f63 6869 6c64 5f69  def copy_child_i
+00008e90: 6e66 6f28 7365 6c66 2c20 636f 6d70 6f6e  nfo(self, compon
+00008ea0: 656e 743a 2043 6f6d 706f 6e65 6e74 2920  ent: Component) 
+00008eb0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00008ec0: 2022 2222 436f 7079 2061 6e64 2073 6574   """Copy and set
+00008ed0: 7469 6e67 7320 696e 666f 2066 726f 6d20  tings info from 
+00008ee0: 6368 696c 6420 636f 6d70 6f6e 656e 7420  child component 
+00008ef0: 696e 746f 2070 6172 656e 742e 0a0a 2020  into parent...  
+00008f00: 2020 2020 2020 5061 7265 6e74 2063 6f6d        Parent com
+00008f10: 706f 6e65 6e74 7320 6361 6e20 6163 6365  ponents can acce
+00008f20: 7373 2063 6869 6c64 2063 656c 6c73 2073  ss child cells s
+00008f30: 6574 7469 6e67 732e 0a20 2020 2020 2020  ettings..       
+00008f40: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+00008f50: 6e6f 7420 6973 696e 7374 616e 6365 2863  not isinstance(c
+00008f60: 6f6d 706f 6e65 6e74 2c20 2843 6f6d 706f  omponent, (Compo
+00008f70: 6e65 6e74 2c20 436f 6d70 6f6e 656e 7452  nent, ComponentR
+00008f80: 6566 6572 656e 6365 2929 3a0a 2020 2020  eference)):.    
+00008f90: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00008fa0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00008fb0: 2020 2020 2020 2020 2020 6622 7b74 7970            f"{typ
+00008fc0: 6528 636f 6d70 6f6e 656e 7429 7d22 2022  e(component)}" "
+00008fd0: 6973 206e 6f74 2061 2043 6f6d 706f 6e65  is not a Compone
+00008fe0: 6e74 206f 7220 436f 6d70 6f6e 656e 7452  nt or ComponentR
+00008ff0: 6566 6572 656e 6365 220a 2020 2020 2020  eference".      
+00009000: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00009010: 2073 656c 662e 6765 745f 6368 696c 645f   self.get_child_
+00009020: 6e61 6d65 203d 2054 7275 650a 2020 2020  name = True.    
+00009030: 2020 2020 7365 6c66 2e63 6869 6c64 203d      self.child =
+00009040: 2063 6f6d 706f 6e65 6e74 0a20 2020 2020   component.     
+00009050: 2020 2073 656c 662e 696e 666f 2e75 7064     self.info.upd
+00009060: 6174 6528 636f 6d70 6f6e 656e 742e 696e  ate(component.in
+00009070: 666f 290a 2020 2020 2020 2020 7365 6c66  fo).        self
+00009080: 2e73 6574 7469 6e67 732e 7570 6461 7465  .settings.update
+00009090: 2863 6f6d 706f 6e65 6e74 2e73 6574 7469  (component.setti
+000090a0: 6e67 7329 0a0a 2020 2020 4070 726f 7065  ngs)..    @prope
+000090b0: 7274 790a 2020 2020 6465 6620 7369 7a65  rty.    def size
+000090c0: 5f69 6e66 6f28 7365 6c66 2920 2d3e 2053  _info(self) -> S
+000090d0: 697a 6549 6e66 6f3a 0a20 2020 2020 2020  izeInfo:.       
+000090e0: 2022 2222 5369 7a65 2069 6e66 6f20 6f66   """Size info of
+000090f0: 2074 6865 2063 6f6d 706f 6e65 6e74 2e22   the component."
+00009100: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+00009110: 6e20 5369 7a65 496e 666f 2873 656c 662e  n SizeInfo(self.
+00009120: 6262 6f78 290a 0a20 2020 2064 6566 2067  bbox)..    def g
+00009130: 6574 5f73 6574 7469 6e67 2873 656c 662c  et_setting(self,
+00009140: 2073 6574 7469 6e67 3a20 7374 7229 202d   setting: str) -
+00009150: 3e20 556e 696f 6e5b 7374 722c 2069 6e74  > Union[str, int
+00009160: 2c20 666c 6f61 745d 3a0a 2020 2020 2020  , float]:.      
+00009170: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
+00009180: 2020 2020 2020 2073 656c 662e 696e 666f         self.info
+00009190: 2e67 6574 2873 6574 7469 6e67 290a 2020  .get(setting).  
+000091a0: 2020 2020 2020 2020 2020 6f72 2073 656c            or sel
+000091b0: 662e 7365 7474 696e 6773 2e66 756c 6c2e  f.settings.full.
+000091c0: 6765 7428 7365 7474 696e 6729 0a20 2020  get(setting).   
+000091d0: 2020 2020 2020 2020 206f 7220 7365 6c66           or self
+000091e0: 2e6d 6574 6164 6174 615f 6368 696c 642e  .metadata_child.
+000091f0: 6765 7428 7365 7474 696e 6729 0a20 2020  get(setting).   
+00009200: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00009210: 6973 5f75 6e6c 6f63 6b65 6428 7365 6c66  is_unlocked(self
+00009220: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00009230: 2020 2022 2222 5261 6973 6573 2065 7272     """Raises err
+00009240: 6f72 2069 6620 436f 6d70 6f6e 656e 7420  or if Component 
+00009250: 6973 206c 6f63 6b65 642e 2222 220a 2020  is locked.""".  
+00009260: 2020 2020 2020 6966 2073 656c 662e 5f6c        if self._l
+00009270: 6f63 6b65 643a 0a20 2020 2020 2020 2020  ocked:.         
+00009280: 2020 2072 6169 7365 204d 7574 6162 696c     raise Mutabil
+00009290: 6974 7945 7272 6f72 280a 2020 2020 2020  ityError(.      
+000092a0: 2020 2020 2020 2020 2020 6622 436f 6d70            f"Comp
+000092b0: 6f6e 656e 7420 7b73 656c 662e 6e61 6d65  onent {self.name
+000092c0: 2172 7d20 6361 6e6e 6f74 2062 6520 6d6f  !r} cannot be mo
+000092d0: 6469 6669 6564 2061 7320 6974 2773 2061  dified as it's a
+000092e0: 6c72 6561 6479 206f 6e20 6361 6368 652e  lready on cache.
+000092f0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00009300: 2020 202b 206d 7574 6162 696c 6974 795f     + mutability_
+00009310: 6572 726f 725f 6d65 7373 6167 650a 2020  error_message.  
+00009320: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00009330: 2064 6566 205f 6164 6428 7365 6c66 2c20   def _add(self, 
+00009340: 656c 656d 656e 7429 202d 3e20 4e6f 6e65  element) -> None
+00009350: 3a0a 2020 2020 2020 2020 2222 2241 6464  :.        """Add
+00009360: 2061 206e 6577 2065 6c65 6d65 6e74 206f   a new element o
+00009370: 7220 6c69 7374 206f 6620 656c 656d 656e  r list of elemen
+00009380: 7473 2074 6f20 7468 6973 2043 6f6d 706f  ts to this Compo
+00009390: 6e65 6e74 2e0a 0a20 2020 2020 2020 2041  nent...        A
+000093a0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+000093b0: 2065 6c65 6d65 6e74 3a20 506f 6c79 676f   element: Polygo
+000093c0: 6e2c 2043 6f6d 706f 6e65 6e74 5265 6665  n, ComponentRefe
+000093d0: 7265 6e63 6520 6f72 2069 7465 7261 626c  rence or iterabl
+000093e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000093f0: 2020 5468 6520 656c 656d 656e 7420 6f72    The element or
+00009400: 2069 7465 7261 626c 6520 6f66 2065 6c65   iterable of ele
+00009410: 6d65 6e74 7320 746f 2062 6520 696e 7365  ments to be inse
+00009420: 7274 6564 2069 6e20 7468 6973 2063 656c  rted in this cel
+00009430: 6c2e 0a0a 2020 2020 2020 2020 5261 6973  l...        Rais
+00009440: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00009450: 4d75 7461 6269 6c69 7479 4572 726f 723a  MutabilityError:
+00009460: 2069 6620 636f 6d70 6f6e 656e 7420 6973   if component is
+00009470: 206c 6f63 6b65 642e 0a20 2020 2020 2020   locked..       
+00009480: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
+00009490: 662e 6973 5f75 6e6c 6f63 6b65 6428 290a  f.is_unlocked().
+000094a0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+000094b0: 7461 6e63 6528 656c 656d 656e 742c 2043  tance(element, C
+000094c0: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+000094d0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+000094e0: 7365 6c66 2e5f 6365 6c6c 2e61 6464 2865  self._cell.add(e
+000094f0: 6c65 6d65 6e74 2e5f 7265 6665 7265 6e63  lement._referenc
+00009500: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
+00009510: 656c 662e 5f72 6566 6572 656e 6365 732e  elf._references.
+00009520: 6170 7065 6e64 2865 6c65 6d65 6e74 290a  append(element).
+00009530: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00009540: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00009550: 6365 6c6c 2e61 6464 2865 6c65 6d65 6e74  cell.add(element
+00009560: 290a 0a20 2020 2064 6566 2061 6464 2873  )..    def add(s
+00009570: 656c 662c 2065 6c65 6d65 6e74 2920 2d3e  elf, element) ->
+00009580: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00009590: 2222 4164 6420 6120 6e65 7720 656c 656d  ""Add a new elem
+000095a0: 656e 7420 6f72 206c 6973 7420 6f66 2065  ent or list of e
+000095b0: 6c65 6d65 6e74 7320 746f 2074 6869 7320  lements to this 
+000095c0: 436f 6d70 6f6e 656e 742e 0a0a 2020 2020  Component...    
+000095d0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+000095e0: 2020 2020 2020 656c 656d 656e 743a 2050        element: P
+000095f0: 6f6c 7967 6f6e 2c20 436f 6d70 6f6e 656e  olygon, Componen
+00009600: 7452 6566 6572 656e 6365 206f 7220 6974  tReference or it
+00009610: 6572 6162 6c65 0a20 2020 2020 2020 2020  erable.         
+00009620: 2020 2020 2020 2054 6865 2065 6c65 6d65         The eleme
+00009630: 6e74 206f 7220 6974 6572 6162 6c65 206f  nt or iterable o
+00009640: 6620 656c 656d 656e 7473 2074 6f20 6265  f elements to be
+00009650: 2069 6e73 6572 7465 6420 696e 2074 6869   inserted in thi
+00009660: 7320 6365 6c6c 2e0a 0a20 2020 2020 2020  s cell...       
+00009670: 2052 6169 7365 733a 0a20 2020 2020 2020   Raises:.       
+00009680: 2020 2020 204d 7574 6162 696c 6974 7945       MutabilityE
+00009690: 7272 6f72 3a20 6966 2063 6f6d 706f 6e65  rror: if compone
+000096a0: 6e74 2069 7320 6c6f 636b 6564 2e0a 2020  nt is locked..  
+000096b0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000096c0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000096d0: 656c 656d 656e 742c 2043 6f6d 706f 6e65  element, Compone
+000096e0: 6e74 5265 6665 7265 6e63 6529 3a0a 2020  ntReference):.  
+000096f0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00009700: 7265 6769 7374 6572 5f72 6566 6572 656e  register_referen
+00009710: 6365 2865 6c65 6d65 6e74 290a 2020 2020  ce(element).    
+00009720: 2020 2020 2020 2020 7365 6c66 2e5f 6164          self._ad
+00009730: 6428 656c 656d 656e 7429 0a20 2020 2020  d(element).     
+00009740: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+00009750: 6365 2865 6c65 6d65 6e74 2c20 4974 6572  ce(element, Iter
+00009760: 6162 6c65 293a 0a20 2020 2020 2020 2020  able):.         
+00009770: 2020 2066 6f72 2073 7562 656c 656d 656e     for subelemen
+00009780: 7420 696e 2065 6c65 6d65 6e74 3a0a 2020  t in element:.  
+00009790: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000097a0: 6c66 2e61 6464 2873 7562 656c 656d 656e  lf.add(subelemen
+000097b0: 7429 0a20 2020 2020 2020 2065 6c73 653a  t).        else:
+000097c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000097d0: 662e 5f61 6464 2865 6c65 6d65 6e74 290a  f._add(element).
+000097e0: 0a20 2020 2064 6566 2061 6464 5f61 7272  .    def add_arr
+000097f0: 6179 280a 2020 2020 2020 2020 7365 6c66  ay(.        self
+00009800: 2c0a 2020 2020 2020 2020 636f 6d70 6f6e  ,.        compon
+00009810: 656e 743a 2043 6f6d 706f 6e65 6e74 2c0a  ent: Component,.
+00009820: 2020 2020 2020 2020 636f 6c75 6d6e 733a          columns:
+00009830: 2069 6e74 203d 2032 2c0a 2020 2020 2020   int = 2,.      
+00009840: 2020 726f 7773 3a20 696e 7420 3d20 322c    rows: int = 2,
+00009850: 0a20 2020 2020 2020 2073 7061 6369 6e67  .        spacing
+00009860: 3a20 5475 706c 655b 666c 6f61 742c 2066  : Tuple[float, f
+00009870: 6c6f 6174 5d20 3d20 2831 3030 2c20 3130  loat] = (100, 10
+00009880: 3029 2c0a 2020 2020 2020 2020 616c 6961  0),.        alia
+00009890: 733a 204f 7074 696f 6e61 6c5b 7374 725d  s: Optional[str]
+000098a0: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
+000098b0: 3e20 436f 6d70 6f6e 656e 7452 6566 6572  > ComponentRefer
+000098c0: 656e 6365 3a0a 2020 2020 2020 2020 2222  ence:.        ""
+000098d0: 2243 7265 6174 6573 2061 2043 6f6d 706f  "Creates a Compo
+000098e0: 6e65 6e74 5265 6665 7265 6e63 6520 7265  nentReference re
+000098f0: 6665 7265 6e63 6520 746f 2061 2043 6f6d  ference to a Com
+00009900: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
+00009910: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00009920: 2020 2063 6f6d 706f 6e65 6e74 3a20 5468     component: Th
+00009930: 6520 7265 6665 7265 6e63 6564 2063 6f6d  e referenced com
+00009940: 706f 6e65 6e74 2e0a 2020 2020 2020 2020  ponent..        
+00009950: 2020 2020 636f 6c75 6d6e 733a 204e 756d      columns: Num
+00009960: 6265 7220 6f66 2063 6f6c 756d 6e73 2069  ber of columns i
+00009970: 6e20 7468 6520 6172 7261 792e 0a20 2020  n the array..   
+00009980: 2020 2020 2020 2020 2072 6f77 733a 204e           rows: N
+00009990: 756d 6265 7220 6f66 2072 6f77 7320 696e  umber of rows in
+000099a0: 2074 6865 2061 7272 6179 2e0a 2020 2020   the array..    
+000099b0: 2020 2020 2020 2020 7370 6163 696e 673a          spacing:
+000099c0: 2061 7272 6179 2d6c 696b 655b 325d 206f   array-like[2] o
+000099d0: 6620 696e 7420 6f72 2066 6c6f 6174 2e0a  f int or float..
+000099e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000099f0: 4469 7374 616e 6365 2062 6574 7765 656e  Distance between
+00009a00: 2061 646a 6163 656e 7420 636f 6c75 6d6e   adjacent column
+00009a10: 7320 616e 6420 6164 6a61 6365 6e74 2072  s and adjacent r
+00009a20: 6f77 732e 0a20 2020 2020 2020 2020 2020  ows..           
+00009a30: 2061 6c69 6173 3a20 7374 7220 6f72 204e   alias: str or N
+00009a40: 6f6e 652e 2041 6c69 6173 206f 6620 7468  one. Alias of th
+00009a50: 6520 7265 6665 7265 6e63 6564 2043 6f6d  e referenced Com
+00009a60: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
+00009a70: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+00009a80: 2020 2020 2061 3a20 436f 6d70 6f6e 656e       a: Componen
+00009a90: 7452 6566 6572 656e 6365 2063 6f6e 7461  tReference conta
+00009aa0: 696e 696e 6720 7265 6665 7265 6e63 6573  ining references
+00009ab0: 2074 6f20 7468 6520 436f 6d70 6f6e 656e   to the Componen
+00009ac0: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
+00009ad0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+00009ae0: 696e 7374 616e 6365 2863 6f6d 706f 6e65  instance(compone
+00009af0: 6e74 2c20 436f 6d70 6f6e 656e 7429 3a0a  nt, Component):.
+00009b00: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00009b10: 6520 5479 7065 4572 726f 7228 2261 6464  e TypeError("add
+00009b20: 5f61 7272 6179 2829 206e 6565 6473 2061  _array() needs a
+00009b30: 2043 6f6d 706f 6e65 6e74 206f 626a 6563   Component objec
+00009b40: 742e 2229 0a20 2020 2020 2020 2072 6566  t.").        ref
+00009b50: 203d 2043 6f6d 706f 6e65 6e74 5265 6665   = ComponentRefe
+00009b60: 7265 6e63 6528 0a20 2020 2020 2020 2020  rence(.         
+00009b70: 2020 2063 6f6d 706f 6e65 6e74 3d63 6f6d     component=com
+00009b80: 706f 6e65 6e74 2c0a 2020 2020 2020 2020  ponent,.        
+00009b90: 2020 2020 636f 6c75 6d6e 733d 696e 7428      columns=int(
+00009ba0: 726f 756e 6428 636f 6c75 6d6e 7329 292c  round(columns)),
+00009bb0: 0a20 2020 2020 2020 2020 2020 2072 6f77  .            row
+00009bc0: 733d 696e 7428 726f 756e 6428 726f 7773  s=int(round(rows
+00009bd0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+00009be0: 7370 6163 696e 673d 7370 6163 696e 672c  spacing=spacing,
+00009bf0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00009c00: 2020 2072 6566 2e6e 616d 6520 3d20 4e6f     ref.name = No
+00009c10: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
+00009c20: 5f61 6464 2872 6566 290a 2020 2020 2020  _add(ref).      
+00009c30: 2020 7365 6c66 2e5f 7265 6769 7374 6572    self._register
+00009c40: 5f72 6566 6572 656e 6365 2872 6566 6572  _reference(refer
+00009c50: 656e 6365 3d72 6566 2c20 616c 6961 733d  ence=ref, alias=
+00009c60: 616c 6961 7329 0a20 2020 2020 2020 2072  alias).        r
+00009c70: 6574 7572 6e20 7265 660a 0a20 2020 2064  eturn ref..    d
+00009c80: 6566 2064 6973 7472 6962 7574 6528 0a20  ef distribute(. 
+00009c90: 2020 2020 2020 2073 656c 662c 2065 6c65         self, ele
+00009ca0: 6d65 6e74 733d 2261 6c6c 222c 2064 6972  ments="all", dir
+00009cb0: 6563 7469 6f6e 3d22 7822 2c20 7370 6163  ection="x", spac
+00009cc0: 696e 673d 3130 302c 2073 6570 6172 6174  ing=100, separat
+00009cd0: 696f 6e3d 5472 7565 2c20 6564 6765 3d22  ion=True, edge="
+00009ce0: 6365 6e74 6572 220a 2020 2020 293a 0a20  center".    ):. 
+00009cf0: 2020 2020 2020 2022 2222 4469 7374 7269         """Distri
+00009d00: 6275 7465 7320 7468 6520 7370 6563 6966  butes the specif
+00009d10: 6965 6420 656c 656d 656e 7473 2069 6e20  ied elements in 
+00009d20: 7468 6520 436f 6d70 6f6e 656e 742e 0a0a  the Component...
+00009d30: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+00009d40: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
+00009d50: 7473 203a 2061 7272 6179 2d6c 696b 6520  ts : array-like 
+00009d60: 6f66 206f 626a 6563 7473 206f 7220 2761  of objects or 'a
+00009d70: 6c6c 270a 2020 2020 2020 2020 2020 2020  ll'.            
+00009d80: 2020 2020 456c 656d 656e 7473 2074 6f20      Elements to 
+00009d90: 6469 7374 7269 6275 7465 2e0a 2020 2020  distribute..    
+00009da0: 2020 2020 2020 2020 6469 7265 6374 696f          directio
+00009db0: 6e20 3a20 7b27 7827 2c20 2779 277d 0a20  n : {'x', 'y'}. 
+00009dc0: 2020 2020 2020 2020 2020 2020 2020 2044                 D
+00009dd0: 6972 6563 7469 6f6e 206f 6620 6469 7374  irection of dist
+00009de0: 7269 6275 7469 6f6e 3b20 6569 7468 6572  ribution; either
+00009df0: 2061 206c 696e 6520 696e 2074 6865 2078   a line in the x
+00009e00: 2d64 6972 6563 7469 6f6e 206f 720a 2020  -direction or.  
+00009e10: 2020 2020 2020 2020 2020 2020 2020 792d                y-
+00009e20: 6469 7265 6374 696f 6e2e 0a20 2020 2020  direction..     
+00009e30: 2020 2020 2020 2073 7061 6369 6e67 203a         spacing :
+00009e40: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
+00009e50: 2020 2020 2020 2020 2020 2020 2020 4469                Di
+00009e60: 7374 616e 6365 2062 6574 7765 656e 2065  stance between e
+00009e70: 6c65 6d65 6e74 732e 0a20 2020 2020 2020  lements..       
+00009e80: 2020 2020 2073 6570 6172 6174 696f 6e20       separation 
+00009e90: 3a20 626f 6f6c 0a20 2020 2020 2020 2020  : bool.         
+00009ea0: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+00009eb0: 6775 6172 616e 7465 6573 2065 6c65 6d65  guarantees eleme
+00009ec0: 6e74 7320 6172 6520 7365 7061 7261 7465  nts are separate
+00009ed0: 6420 7769 7468 2061 2066 6978 6564 2073  d with a fixed s
+00009ee0: 7061 6369 6e67 0a20 2020 2020 2020 2020  pacing.         
+00009ef0: 2020 2020 2020 2062 6574 7765 656e 3b20         between; 
+00009f00: 6966 2020 4661 6c73 652c 2065 6c65 6d65  if  False, eleme
+00009f10: 6e74 7320 6172 6520 7370 6163 6564 2065  nts are spaced e
+00009f20: 7665 6e6c 7920 616c 6f6e 6720 6120 6772  venly along a gr
+00009f30: 6964 2e0a 2020 2020 2020 2020 2020 2020  id..            
+00009f40: 6564 6765 203a 207b 2778 272c 2027 786d  edge : {'x', 'xm
+00009f50: 696e 272c 2027 786d 6178 272c 2027 7927  in', 'xmax', 'y'
+00009f60: 2c20 2779 6d69 6e27 2c20 2779 6d61 7827  , 'ymin', 'ymax'
+00009f70: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00009f80: 2020 5768 6963 6820 6564 6765 2074 6f20    Which edge to 
+00009f90: 7065 7266 6f72 6d20 7468 6520 6469 7374  perform the dist
+00009fa0: 7269 6275 7469 6f6e 2061 6c6f 6e67 2028  ribution along (
+00009fb0: 756e 7573 6564 2069 660a 2020 2020 2020  unused if.      
+00009fc0: 2020 2020 2020 2020 2020 7365 7061 7261            separa
+00009fd0: 7469 6f6e 203d 3d20 5472 7565 290a 0a20  tion == True).. 
+00009fe0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00009ff0: 2020 2069 6620 656c 656d 656e 7473 203d     if elements =
+0000a000: 3d20 2261 6c6c 223a 0a20 2020 2020 2020  = "all":.       
+0000a010: 2020 2020 2065 6c65 6d65 6e74 7320 3d20       elements = 
+0000a020: 7365 6c66 2e70 6f6c 7967 6f6e 7320 2b20  self.polygons + 
+0000a030: 7365 6c66 2e72 6566 6572 656e 6365 730a  self.references.
+0000a040: 2020 2020 2020 2020 5f64 6973 7472 6962          _distrib
+0000a050: 7574 6528 0a20 2020 2020 2020 2020 2020  ute(.           
+0000a060: 2065 6c65 6d65 6e74 733d 656c 656d 656e   elements=elemen
+0000a070: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+0000a080: 6469 7265 6374 696f 6e3d 6469 7265 6374  direction=direct
+0000a090: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+0000a0a0: 2073 7061 6369 6e67 3d73 7061 6369 6e67   spacing=spacing
+0000a0b0: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
+0000a0c0: 7061 7261 7469 6f6e 3d73 6570 6172 6174  paration=separat
+0000a0d0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+0000a0e0: 2065 6467 653d 6564 6765 2c0a 2020 2020   edge=edge,.    
+0000a0f0: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
+0000a100: 7475 726e 2073 656c 660a 0a20 2020 2064  turn self..    d
+0000a110: 6566 2061 6c69 676e 2873 656c 662c 2065  ef align(self, e
+0000a120: 6c65 6d65 6e74 733d 2261 6c6c 222c 2061  lements="all", a
+0000a130: 6c69 676e 6d65 6e74 3d22 796d 6178 2229  lignment="ymax")
+0000a140: 3a0a 2020 2020 2020 2020 2222 2241 6c69  :.        """Ali
+0000a150: 676e 2065 6c65 6d65 6e74 7320 696e 2074  gn elements in t
+0000a160: 6865 2043 6f6d 706f 6e65 6e74 2e0a 0a20  he Component... 
+0000a170: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+0000a180: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
+0000a190: 7320 3a20 6172 7261 792d 6c69 6b65 206f  s : array-like o
+0000a1a0: 6620 6f62 6a65 6374 732c 206f 7220 2761  f objects, or 'a
+0000a1b0: 6c6c 270a 2020 2020 2020 2020 2020 2020  ll'.            
+0000a1c0: 2020 2020 456c 656d 656e 7473 2069 6e20      Elements in 
+0000a1d0: 7468 6520 436f 6d70 6f6e 656e 7420 746f  the Component to
+0000a1e0: 2061 6c69 676e 2e0a 2020 2020 2020 2020   align..        
+0000a1f0: 2020 2020 616c 6967 6e6d 656e 7420 3a20      alignment : 
+0000a200: 7b27 7827 2c20 2779 272c 2027 786d 696e  {'x', 'y', 'xmin
+0000a210: 272c 2027 786d 6178 272c 2027 796d 696e  ', 'xmax', 'ymin
+0000a220: 272c 2027 796d 6178 277d 0a20 2020 2020  ', 'ymax'}.     
+0000a230: 2020 2020 2020 2020 2020 2057 6869 6368             Which
+0000a240: 2065 6467 6520 746f 2061 6c69 676e 2061   edge to align a
+0000a250: 6c6f 6e67 2028 652e 672e 2027 796d 6178  long (e.g. 'ymax
+0000a260: 2720 7769 6c6c 206d 6f76 6520 7468 6520  ' will move the 
+0000a270: 656c 656d 656e 7473 2073 7563 680a 2020  elements such.  
+0000a280: 2020 2020 2020 2020 2020 2020 2020 7468                th
+0000a290: 6174 2061 6c6c 206f 6620 7468 6569 7220  at all of their 
+0000a2a0: 746f 706d 6f73 7420 706f 696e 7473 2061  topmost points a
+0000a2b0: 7265 2061 6c69 676e 6564 292e 0a20 2020  re aligned)..   
+0000a2c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000a2d0: 2069 6620 656c 656d 656e 7473 203d 3d20   if elements == 
+0000a2e0: 2261 6c6c 223a 0a20 2020 2020 2020 2020  "all":.         
+0000a2f0: 2020 2065 6c65 6d65 6e74 7320 3d20 7365     elements = se
+0000a300: 6c66 2e70 6f6c 7967 6f6e 7320 2b20 7365  lf.polygons + se
+0000a310: 6c66 2e72 6566 6572 656e 6365 730a 2020  lf.references.  
+0000a320: 2020 2020 2020 5f61 6c69 676e 2865 6c65        _align(ele
+0000a330: 6d65 6e74 732c 2061 6c69 676e 6d65 6e74  ments, alignment
+0000a340: 3d61 6c69 676e 6d65 6e74 290a 2020 2020  =alignment).    
+0000a350: 2020 2020 7265 7475 726e 2073 656c 660a      return self.
+0000a360: 0a20 2020 2064 6566 2066 6c61 7474 656e  .    def flatten
+0000a370: 2873 656c 662c 2073 696e 676c 655f 6c61  (self, single_la
+0000a380: 7965 723a 204f 7074 696f 6e61 6c5b 4c61  yer: Optional[La
+0000a390: 7965 7253 7065 635d 203d 204e 6f6e 6529  yerSpec] = None)
+0000a3a0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+0000a3b0: 7572 6e73 2061 2066 6c61 7474 656e 6564  urns a flattened
+0000a3c0: 2063 6f70 7920 6f66 2074 6865 2063 6f6d   copy of the com
+0000a3d0: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
+0000a3e0: 2046 6c61 7474 656e 7320 7468 6520 6869   Flattens the hi
+0000a3f0: 6572 6172 6368 7920 6f66 2074 6865 2043  erarchy of the C
+0000a400: 6f6d 706f 6e65 6e74 2073 7563 6820 7468  omponent such th
+0000a410: 6174 2074 6865 7265 2061 7265 206e 6f20  at there are no 
+0000a420: 6c6f 6e67 6572 0a20 2020 2020 2020 2061  longer.        a
+0000a430: 6e79 2072 6566 6572 656e 6365 7320 746f  ny references to
+0000a440: 206f 7468 6572 2043 6f6d 706f 6e65 6e74   other Component
+0000a450: 732e 2041 6c6c 2070 6f6c 7967 6f6e 7320  s. All polygons 
+0000a460: 616e 6420 6c61 6265 6c73 2066 726f 6d0a  and labels from.
+0000a470: 2020 2020 2020 2020 756e 6465 726c 7969          underlyi
+0000a480: 6e67 2072 6566 6572 656e 6365 7320 6172  ng references ar
+0000a490: 6520 636f 7069 6564 2061 6e64 2070 6c61  e copied and pla
+0000a4a0: 6365 6420 696e 2074 6865 2074 6f70 2d6c  ced in the top-l
+0000a4b0: 6576 656c 2043 6f6d 706f 6e65 6e74 2e0a  evel Component..
+0000a4c0: 2020 2020 2020 2020 4966 2073 696e 676c          If singl
+0000a4d0: 655f 6c61 7965 7220 6973 2073 7065 6369  e_layer is speci
+0000a4e0: 6669 6564 2c20 616c 6c20 706f 6c79 676f  fied, all polygo
+0000a4f0: 6e73 2061 7265 206d 6f76 6564 2074 6f20  ns are moved to 
+0000a500: 7468 6174 206c 6179 6572 2e0a 0a20 2020  that layer...   
+0000a510: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+0000a520: 2020 2020 2020 2073 696e 676c 655f 6c61         single_la
+0000a530: 7965 723a 206d 6f76 6520 616c 6c20 706f  yer: move all po
+0000a540: 6c79 676f 6e73 2061 7265 206d 6f76 6564  lygons are moved
+0000a550: 2074 6f20 7468 6520 7370 6563 6966 6965   to the specifie
+0000a560: 6420 286f 7074 696f 6e61 6c29 2e0a 2020  d (optional)..  
+0000a570: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000a580: 2020 636f 6d70 6f6e 656e 745f 666c 6174    component_flat
+0000a590: 203d 2043 6f6d 706f 6e65 6e74 2829 0a0a   = Component()..
+0000a5a0: 2020 2020 2020 2020 5f63 656c 6c20 3d20          _cell = 
+0000a5b0: 7365 6c66 2e5f 6365 6c6c 2e63 6f70 7928  self._cell.copy(
+0000a5c0: 6e61 6d65 3d63 6f6d 706f 6e65 6e74 5f66  name=component_f
+0000a5d0: 6c61 742e 6e61 6d65 290a 2020 2020 2020  lat.name).      
+0000a5e0: 2020 5f63 656c 6c20 3d20 5f63 656c 6c2e    _cell = _cell.
+0000a5f0: 666c 6174 7465 6e28 290a 2020 2020 2020  flatten().      
+0000a600: 2020 636f 6d70 6f6e 656e 745f 666c 6174    component_flat
+0000a610: 2e5f 6365 6c6c 203d 205f 6365 6c6c 0a20  ._cell = _cell. 
+0000a620: 2020 2020 2020 2069 6620 7369 6e67 6c65         if single
+0000a630: 5f6c 6179 6572 2069 7320 6e6f 7420 4e6f  _layer is not No
+0000a640: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000a650: 6672 6f6d 2067 6473 6661 6374 6f72 7920  from gdsfactory 
+0000a660: 696d 706f 7274 2067 6574 5f6c 6179 6572  import get_layer
+0000a670: 0a0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
+0000a680: 7965 722c 2064 6174 6174 7970 6520 3d20  yer, datatype = 
+0000a690: 6765 745f 6c61 7965 7228 7369 6e67 6c65  get_layer(single
+0000a6a0: 5f6c 6179 6572 290a 2020 2020 2020 2020  _layer).        
+0000a6b0: 2020 2020 666f 7220 706f 6c79 676f 6e20      for polygon 
+0000a6c0: 696e 205f 6365 6c6c 2e70 6f6c 7967 6f6e  in _cell.polygon
+0000a6d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0000a6e0: 2020 2070 6f6c 7967 6f6e 2e6c 6179 6572     polygon.layer
+0000a6f0: 203d 206c 6179 6572 0a20 2020 2020 2020   = layer.       
+0000a700: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
+0000a710: 2e64 6174 6174 7970 6520 3d20 6461 7461  .datatype = data
+0000a720: 7479 7065 0a20 2020 2020 2020 2020 2020  type.           
+0000a730: 2066 6f72 2070 6174 6820 696e 205f 6365   for path in _ce
+0000a740: 6c6c 2e70 6174 6873 3a0a 2020 2020 2020  ll.paths:.      
+0000a750: 2020 2020 2020 2020 2020 7061 7468 2e73            path.s
+0000a760: 6574 5f6c 6179 6572 7328 6c61 7965 7229  et_layers(layer)
+0000a770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a780: 2070 6174 682e 7365 745f 6461 7461 7479   path.set_dataty
+0000a790: 7065 7328 6461 7461 7479 7065 290a 0a20  pes(datatype).. 
+0000a7a0: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+0000a7b0: 5f66 6c61 742e 696e 666f 203d 2073 656c  _flat.info = sel
+0000a7c0: 662e 696e 666f 2e63 6f70 7928 290a 2020  f.info.copy().  
+0000a7d0: 2020 2020 2020 636f 6d70 6f6e 656e 745f        component_
+0000a7e0: 666c 6174 2e61 6464 5f70 6f72 7473 2873  flat.add_ports(s
+0000a7f0: 656c 662e 706f 7274 7329 0a20 2020 2020  elf.ports).     
+0000a800: 2020 2072 6574 7572 6e20 636f 6d70 6f6e     return compon
+0000a810: 656e 745f 666c 6174 0a0a 2020 2020 6465  ent_flat..    de
+0000a820: 6620 666c 6174 7465 6e5f 7265 6665 7265  f flatten_refere
+0000a830: 6e63 6528 7365 6c66 2c20 7265 663a 2043  nce(self, ref: C
+0000a840: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+0000a850: 6529 202d 3e20 4e6f 6e65 3a0a 2020 2020  e) -> None:.    
+0000a860: 2020 2020 2222 2246 726f 6d20 6578 6973      """From exis
+0000a870: 7469 6e67 2063 656c 6c20 7265 706c 6163  ting cell replac
+0000a880: 6573 2072 6566 6572 656e 6365 2077 6974  es reference wit
+0000a890: 6820 6120 666c 6174 7465 6e20 7265 6665  h a flatten refe
+0000a8a0: 7265 6e63 6520 5c0a 2020 2020 2020 2020  rence \.        
+0000a8b0: 7768 6963 6820 6861 7320 7468 6520 7472  which has the tr
+0000a8c0: 616e 7366 6f72 6d61 7469 6f6e 7320 616c  ansformations al
+0000a8d0: 7265 6164 7920 6170 706c 6965 642e 0a0a  ready applied...
+0000a8e0: 2020 2020 2020 2020 5472 616e 7366 6f72          Transfor
+0000a8f0: 6d65 6420 7265 6665 7265 6e63 6520 6b65  med reference ke
+0000a900: 6570 7320 7468 6520 6f72 6967 696e 616c  eps the original
+0000a910: 206e 616d 652e 0a0a 2020 2020 2020 2020   name...        
+0000a920: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+0000a930: 2020 7265 663a 2074 6865 2072 6566 6572    ref: the refer
+0000a940: 656e 6365 2074 6f20 666c 6174 7465 6e20  ence to flatten 
+0000a950: 696e 746f 2061 206e 6577 2063 656c 6c2e  into a new cell.
+0000a960: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000a970: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
+0000a980: 6374 6f72 792e 6675 6e63 7469 6f6e 7320  ctory.functions 
+0000a990: 696d 706f 7274 2074 7261 6e73 666f 726d  import transform
+0000a9a0: 6564 0a0a 2020 2020 2020 2020 7365 6c66  ed..        self
+0000a9b0: 2e72 656d 6f76 6528 7265 6629 0a20 2020  .remove(ref).   
+0000a9c0: 2020 2020 206e 6577 5f63 6f6d 706f 6e65       new_compone
+0000a9d0: 6e74 203d 2074 7261 6e73 666f 726d 6564  nt = transformed
+0000a9e0: 2872 6566 2c20 6465 636f 7261 746f 723d  (ref, decorator=
+0000a9f0: 4e6f 6e65 290a 2020 2020 2020 2020 7365  None).        se
+0000aa00: 6c66 2e61 6464 5f72 6566 286e 6577 5f63  lf.add_ref(new_c
+0000aa10: 6f6d 706f 6e65 6e74 2c20 616c 6961 733d  omponent, alias=
+0000aa20: 7265 662e 6e61 6d65 290a 0a20 2020 2064  ref.name)..    d
+0000aa30: 6566 2061 6464 5f72 6566 280a 2020 2020  ef add_ref(.    
+0000aa40: 2020 2020 7365 6c66 2c20 636f 6d70 6f6e      self, compon
+0000aa50: 656e 743a 2043 6f6d 706f 6e65 6e74 2c20  ent: Component, 
+0000aa60: 616c 6961 733a 204f 7074 696f 6e61 6c5b  alias: Optional[
+0000aa70: 7374 725d 203d 204e 6f6e 652c 202a 2a6b  str] = None, **k
+0000aa80: 7761 7267 730a 2020 2020 2920 2d3e 2043  wargs.    ) -> C
+0000aa90: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+0000aaa0: 653a 0a20 2020 2020 2020 2022 2222 4164  e:.        """Ad
+0000aab0: 6420 436f 6d70 6f6e 656e 7452 6566 6572  d ComponentRefer
+0000aac0: 656e 6365 2074 6f20 7468 6520 6375 7272  ence to the curr
+0000aad0: 656e 7420 436f 6d70 6f6e 656e 742e 0a0a  ent Component...
+0000aae0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+0000aaf0: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
+0000ab00: 656e 743a 2043 6f6d 706f 6e65 6e74 2e0a  ent: Component..
+0000ab10: 2020 2020 2020 2020 2020 2020 616c 6961              alia
+0000ab20: 733a 206e 616d 6564 5f72 6566 6572 656e  s: named_referen
+0000ab30: 6365 732e 0a0a 2020 2020 2020 2020 4b65  ces...        Ke
+0000ab40: 7977 6f72 6420 4172 6773 3a0a 2020 2020  yword Args:.    
+0000ab50: 2020 2020 2020 2020 636f 6c75 6d6e 733a          columns:
+0000ab60: 204e 756d 6265 7220 6f66 2063 6f6c 756d   Number of colum
+0000ab70: 6e73 2069 6e20 7468 6520 6172 7261 792e  ns in the array.
+0000ab80: 0a20 2020 2020 2020 2020 2020 2072 6f77  .            row
+0000ab90: 733a 204e 756d 6265 7220 6f66 2072 6f77  s: Number of row
+0000aba0: 7320 696e 2074 6865 2061 7272 6179 2e0a  s in the array..
+0000abb0: 2020 2020 2020 2020 2020 2020 7370 6163              spac
+0000abc0: 696e 673a 2044 6973 7461 6e63 6573 2062  ing: Distances b
+0000abd0: 6574 7765 656e 2061 646a 6163 656e 7420  etween adjacent 
+0000abe0: 636f 6c75 6d6e 7320 616e 6420 6164 6a61  columns and adja
+0000abf0: 6365 6e74 2072 6f77 732e 0a20 2020 2020  cent rows..     
+0000ac00: 2020 2020 2020 206f 7269 6769 6e3a 2061         origin: a
+0000ac10: 7272 6179 2d6c 696b 655b 325d 206f 6620  rray-like[2] of 
+0000ac20: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
+0000ac30: 2020 2020 2020 2020 2020 2020 2050 6f73               Pos
+0000ac40: 6974 696f 6e20 7768 6572 6520 7468 6520  ition where the 
+0000ac50: 6365 6c6c 2069 7320 696e 7365 7274 6564  cell is inserted
+0000ac60: 2e0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
+0000ac70: 7461 7469 6f6e 203a 2069 6e74 206f 7220  tation : int or 
+0000ac80: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
+0000ac90: 2020 2020 2020 416e 676c 6520 6f66 2072        Angle of r
+0000aca0: 6f74 6174 696f 6e20 6f66 2074 6865 2072  otation of the r
+0000acb0: 6566 6572 656e 6365 2028 696e 2060 6465  eference (in `de
+0000acc0: 6772 6565 7360 292e 0a20 2020 2020 2020  grees`)..       
+0000acd0: 2020 2020 206d 6167 6e69 6669 6361 7469       magnificati
+0000ace0: 6f6e 203a 2069 6e74 206f 7220 666c 6f61  on : int or floa
+0000acf0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0000ad00: 2020 4d61 676e 6966 6963 6174 696f 6e20    Magnification 
+0000ad10: 6661 6374 6f72 2066 6f72 2074 6865 2072  factor for the r
+0000ad20: 6566 6572 656e 6365 2e0a 2020 2020 2020  eference..      
+0000ad30: 2020 2020 2020 785f 7265 666c 6563 7469        x_reflecti
+0000ad40: 6f6e 203a 2062 6f6f 6c0a 2020 2020 2020  on : bool.      
+0000ad50: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+0000ad60: 652c 2074 6865 2072 6566 6572 656e 6365  e, the reference
+0000ad70: 2069 7320 7265 666c 6563 7465 6420 7061   is reflected pa
+0000ad80: 7261 6c6c 656c 2074 6f20 7468 6520 7820  rallel to the x 
+0000ad90: 6469 7265 6374 696f 6e0a 2020 2020 2020  direction.      
+0000ada0: 2020 2020 2020 2020 2020 6265 666f 7265            before
+0000adb0: 2062 6569 6e67 2072 6f74 6174 6564 2e0a   being rotated..
+0000adc0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0000add0: 203a 2073 7472 2028 6f70 7469 6f6e 616c   : str (optional
+0000ade0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000adf0: 2020 4120 6e61 6d65 2066 6f72 2074 6865    A name for the
+0000ae00: 2072 6566 6572 656e 6365 2028 6966 2070   reference (if p
+0000ae10: 726f 7669 6465 6429 2e0a 0a20 2020 2020  rovided)...     
+0000ae20: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+0000ae30: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+0000ae40: 2863 6f6d 706f 6e65 6e74 2c20 436f 6d70  (component, Comp
+0000ae50: 6f6e 656e 7429 3a0a 2020 2020 2020 2020  onent):.        
+0000ae60: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+0000ae70: 726f 7228 6622 7479 7065 203d 207b 7479  ror(f"type = {ty
+0000ae80: 7065 2843 6f6d 706f 6e65 6e74 297d 206e  pe(Component)} n
+0000ae90: 6565 6473 2074 6f20 6265 2061 2043 6f6d  eeds to be a Com
+0000aea0: 706f 6e65 6e74 2e22 290a 2020 2020 2020  ponent.").      
+0000aeb0: 2020 7265 6620 3d20 436f 6d70 6f6e 656e    ref = Componen
+0000aec0: 7452 6566 6572 656e 6365 2863 6f6d 706f  tReference(compo
+0000aed0: 6e65 6e74 2c20 2a2a 6b77 6172 6773 290a  nent, **kwargs).
+0000aee0: 2020 2020 2020 2020 7365 6c66 2e5f 6164          self._ad
+0000aef0: 6428 7265 6629 0a20 2020 2020 2020 2073  d(ref).        s
+0000af00: 656c 662e 5f72 6567 6973 7465 725f 7265  elf._register_re
+0000af10: 6665 7265 6e63 6528 7265 6665 7265 6e63  ference(referenc
+0000af20: 653d 7265 662c 2061 6c69 6173 3d61 6c69  e=ref, alias=ali
+0000af30: 6173 290a 2020 2020 2020 2020 7265 7475  as).        retu
+0000af40: 726e 2072 6566 0a0a 2020 2020 6465 6620  rn ref..    def 
+0000af50: 5f72 6567 6973 7465 725f 7265 6665 7265  _register_refere
+0000af60: 6e63 6528 0a20 2020 2020 2020 2073 656c  nce(.        sel
+0000af70: 662c 2072 6566 6572 656e 6365 3a20 436f  f, reference: Co
+0000af80: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
+0000af90: 2c20 616c 6961 733a 204f 7074 696f 6e61  , alias: Optiona
+0000afa0: 6c5b 7374 725d 203d 204e 6f6e 650a 2020  l[str] = None.  
+0000afb0: 2020 2920 2d3e 204e 6f6e 653a 0a20 2020    ) -> None:.   
+0000afc0: 2020 2020 2063 6f6d 706f 6e65 6e74 203d       component =
+0000afd0: 2072 6566 6572 656e 6365 2e70 6172 656e   reference.paren
+0000afe0: 740a 2020 2020 2020 2020 7265 6665 7265  t.        refere
+0000aff0: 6e63 652e 6f77 6e65 7220 3d20 7365 6c66  nce.owner = self
+0000b000: 0a0a 2020 2020 2020 2020 6966 2061 6c69  ..        if ali
+0000b010: 6173 2069 7320 4e6f 6e65 3a0a 2020 2020  as is None:.    
+0000b020: 2020 2020 2020 2020 6966 2072 6566 6572          if refer
+0000b030: 656e 6365 2e6e 616d 6520 6973 206e 6f74  ence.name is not
+0000b040: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000b050: 2020 2020 2020 2061 6c69 6173 203d 2072         alias = r
+0000b060: 6566 6572 656e 6365 2e6e 616d 650a 2020  eference.name.  
+0000b070: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000b080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b090: 7072 6566 6978 203d 2028 0a20 2020 2020  prefix = (.     
+0000b0a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000b0b0: 6f6d 706f 6e65 6e74 2e73 6574 7469 6e67  omponent.setting
+0000b0c0: 732e 6675 6e63 7469 6f6e 5f6e 616d 650a  s.function_name.
+0000b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0e0: 2020 2020 6966 2068 6173 6174 7472 2863      if hasattr(c
+0000b0f0: 6f6d 706f 6e65 6e74 2c20 2273 6574 7469  omponent, "setti
+0000b100: 6e67 7322 290a 2020 2020 2020 2020 2020  ngs").          
+0000b110: 2020 2020 2020 2020 2020 616e 6420 6861            and ha
+0000b120: 7361 7474 7228 636f 6d70 6f6e 656e 742e  sattr(component.
+0000b130: 7365 7474 696e 6773 2c20 2266 756e 6374  settings, "funct
+0000b140: 696f 6e5f 6e61 6d65 2229 0a20 2020 2020  ion_name").     
+0000b150: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000b160: 6c73 6520 636f 6d70 6f6e 656e 742e 6e61  lse component.na
+0000b170: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
+0000b180: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000b190: 2020 2020 2073 656c 662e 5f72 6566 6572       self._refer
+0000b1a0: 656e 6365 5f6e 616d 6573 5f63 6f75 6e74  ence_names_count
+0000b1b0: 6572 2e75 7064 6174 6528 7b70 7265 6669  er.update({prefi
+0000b1c0: 783a 2031 7d29 0a20 2020 2020 2020 2020  x: 1}).         
+0000b1d0: 2020 2020 2020 2061 6c69 6173 203d 2066         alias = f
+0000b1e0: 227b 7072 6566 6978 7d5f 7b73 656c 662e  "{prefix}_{self.
+0000b1f0: 5f72 6566 6572 656e 6365 5f6e 616d 6573  _reference_names
+0000b200: 5f63 6f75 6e74 6572 5b70 7265 6669 785d  _counter[prefix]
+0000b210: 7d22 0a0a 2020 2020 2020 2020 2020 2020  }"..            
+0000b220: 2020 2020 7768 696c 6520 616c 6961 7320      while alias 
+0000b230: 696e 2073 656c 662e 5f6e 616d 6564 5f72  in self._named_r
+0000b240: 6566 6572 656e 6365 733a 0a20 2020 2020  eferences:.     
+0000b250: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000b260: 656c 662e 5f72 6566 6572 656e 6365 5f6e  elf._reference_n
+0000b270: 616d 6573 5f63 6f75 6e74 6572 2e75 7064  ames_counter.upd
+0000b280: 6174 6528 7b70 7265 6669 783a 2031 7d29  ate({prefix: 1})
+0000b290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b2a0: 2020 2020 2061 6c69 6173 203d 2066 227b       alias = f"{
+0000b2b0: 7072 6566 6978 7d5f 7b73 656c 662e 5f72  prefix}_{self._r
+0000b2c0: 6566 6572 656e 6365 5f6e 616d 6573 5f63  eference_names_c
+0000b2d0: 6f75 6e74 6572 5b70 7265 6669 785d 7d22  ounter[prefix]}"
+0000b2e0: 0a0a 2020 2020 2020 2020 7265 6665 7265  ..        refere
+0000b2f0: 6e63 652e 6e61 6d65 203d 2061 6c69 6173  nce.name = alias
+0000b300: 0a20 2020 2020 2020 2073 656c 662e 5f6e  .        self._n
+0000b310: 616d 6564 5f72 6566 6572 656e 6365 735b  amed_references[
+0000b320: 616c 6961 735d 203d 2072 6566 6572 656e  alias] = referen
+0000b330: 6365 0a0a 2020 2020 4070 726f 7065 7274  ce..    @propert
+0000b340: 790a 2020 2020 6465 6620 6c61 7965 7273  y.    def layers
+0000b350: 2873 656c 6629 202d 3e20 5365 745b 5475  (self) -> Set[Tu
+0000b360: 706c 655b 696e 742c 2069 6e74 5d5d 3a0a  ple[int, int]]:.
+0000b370: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+0000b380: 6e73 2061 2073 6574 206f 6620 7468 6520  ns a set of the 
+0000b390: 4c61 7965 7273 2069 6e20 7468 6520 436f  Layers in the Co
+0000b3a0: 6d70 6f6e 656e 742e 2222 220a 2020 2020  mponent.""".    
+0000b3b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000b3c0: 6765 745f 6c61 7965 7273 2829 0a0a 2020  get_layers()..  
+0000b3d0: 2020 6465 6620 6765 745f 6c61 7965 7273    def get_layers
+0000b3e0: 2873 656c 6629 202d 3e20 5365 745b 5475  (self) -> Set[Tu
+0000b3f0: 706c 655b 696e 742c 2069 6e74 5d5d 3a0a  ple[int, int]]:.
+0000b400: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+0000b410: 6e20 6120 7365 7420 6f66 2028 6c61 7965  n a set of (laye
+0000b420: 722c 2064 6174 6174 7970 6529 2e0a 0a20  r, datatype)... 
+0000b430: 2020 2020 2020 202e 2e20 636f 6465 203a         .. code :
+0000b440: 3a0a 0a20 2020 2020 2020 2020 2020 2069  :..            i
+0000b450: 6d70 6f72 7420 6764 7366 6163 746f 7279  mport gdsfactory
+0000b460: 2061 7320 6766 0a20 2020 2020 2020 2020   as gf.         
+0000b470: 2020 2067 662e 636f 6d70 6f6e 656e 7473     gf.components
+0000b480: 2e73 7472 6169 6768 7428 292e 6765 745f  .straight().get_
+0000b490: 6c61 7965 7273 2829 203d 3d20 7b28 312c  layers() == {(1,
+0000b4a0: 2030 292c 2028 3131 312c 2030 297d 0a20   0), (111, 0)}. 
+0000b4b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000b4c0: 2020 2070 6f6c 7967 6f6e 7320 3d20 7365     polygons = se
+0000b4d0: 6c66 2e5f 6365 6c6c 2e67 6574 5f70 6f6c  lf._cell.get_pol
+0000b4e0: 7967 6f6e 7328 6465 7074 683d 4e6f 6e65  ygons(depth=None
+0000b4f0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000b500: 207b 2870 6f6c 7967 6f6e 2e6c 6179 6572   {(polygon.layer
+0000b510: 2c20 706f 6c79 676f 6e2e 6461 7461 7479  , polygon.dataty
+0000b520: 7065 2920 666f 7220 706f 6c79 676f 6e20  pe) for polygon 
+0000b530: 696e 2070 6f6c 7967 6f6e 737d 0a0a 2020  in polygons}..  
+0000b540: 2020 6465 6620 6765 745f 6c61 7965 725f    def get_layer_
+0000b550: 6e61 6d65 7328 7365 6c66 2920 2d3e 204c  names(self) -> L
+0000b560: 6973 745b 5475 706c 655b 696e 742c 2069  ist[Tuple[int, i
+0000b570: 6e74 5d5d 3a0a 2020 2020 2020 2020 2222  nt]]:.        ""
+0000b580: 2252 6574 7572 6e20 6c61 7965 7220 6e61  "Return layer na
+0000b590: 6d65 7320 7573 6564 2069 6e20 7468 6520  mes used in the 
+0000b5a0: 6465 7369 676e 2e0a 0a20 2020 2020 2020  design...       
+0000b5b0: 202e 2e20 636f 6465 203a 3a0a 0a20 2020   .. code ::..   
+0000b5c0: 2020 2020 2020 2020 2069 6d70 6f72 7420           import 
+0000b5d0: 6764 7366 6163 746f 7279 2061 7320 6766  gdsfactory as gf
+0000b5e0: 0a20 2020 2020 2020 2020 2020 2067 662e  .            gf.
+0000b5f0: 636f 6d70 6f6e 656e 7473 2e73 7472 6169  components.strai
+0000b600: 6768 7428 292e 6765 745f 6e61 6d65 7328  ght().get_names(
+0000b610: 2920 3d3d 205b 2757 4727 5d0a 2020 2020  ) == ['WG'].    
+0000b620: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000b630: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
+0000b640: 7920 6173 2067 660a 0a20 2020 2020 2020  y as gf..       
+0000b650: 2050 444b 203d 2067 662e 6765 745f 6163   PDK = gf.get_ac
+0000b660: 7469 7665 5f70 646b 2829 0a20 2020 2020  tive_pdk().     
+0000b670: 2020 204c 4159 4552 5320 3d20 5044 4b2e     LAYERS = PDK.
+0000b680: 6c61 7965 7273 0a20 2020 2020 2020 206e  layers.        n
+0000b690: 616d 655f 746f 5f6c 6179 6572 203d 2064  ame_to_layer = d
+0000b6a0: 6963 7428 4c41 5945 5253 290a 2020 2020  ict(LAYERS).    
+0000b6b0: 2020 2020 6c61 7965 725f 746f 5f6e 616d      layer_to_nam
+0000b6c0: 6520 3d20 7b76 3a20 6b20 666f 7220 6b2c  e = {v: k for k,
+0000b6d0: 2076 2069 6e20 6e61 6d65 5f74 6f5f 6c61   v in name_to_la
+0000b6e0: 7965 722e 6974 656d 7328 297d 0a20 2020  yer.items()}.   
+0000b6f0: 2020 2020 206c 6179 6572 5f6e 616d 6573       layer_names
+0000b700: 203d 205b 5d0a 0a20 2020 2020 2020 2066   = []..        f
+0000b710: 6f72 206c 6179 6572 2069 6e20 7365 6c66  or layer in self
+0000b720: 2e6c 6179 6572 733a 0a20 2020 2020 2020  .layers:.       
+0000b730: 2020 2020 2069 6620 6c61 7965 7220 6e6f       if layer no
+0000b740: 7420 696e 206c 6179 6572 5f74 6f5f 6e61  t in layer_to_na
+0000b750: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+0000b760: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
+0000b770: 6e28 6622 7b6c 6179 6572 7d20 6e6f 7420  n(f"{layer} not 
+0000b780: 696e 204c 6179 6572 4d61 702e 222c 2073  in LayerMap.", s
+0000b790: 7461 636b 6c65 7665 6c3d 3329 0a20 2020  tacklevel=3).   
+0000b7a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000b7b0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0000b7c0: 6179 6572 5f6e 616d 6573 2e61 7070 656e  ayer_names.appen
+0000b7d0: 6428 6c61 7965 725f 746f 5f6e 616d 655b  d(layer_to_name[
+0000b7e0: 6c61 7965 725d 290a 2020 2020 2020 2020  layer]).        
+0000b7f0: 7265 7475 726e 206c 6179 6572 5f6e 616d  return layer_nam
+0000b800: 6573 0a0a 2020 2020 6465 6620 5f69 7079  es..    def _ipy
+0000b810: 7468 6f6e 5f64 6973 706c 6179 5f28 7365  thon_display_(se
+0000b820: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000b830: 2020 2020 2022 2222 5368 6f77 2067 656f       """Show geo
+0000b840: 6d65 7472 7920 696e 204b 4c61 796f 7574  metry in KLayout
+0000b850: 2061 6e64 2069 6e20 6d61 7470 6c6f 746c   and in matplotl
+0000b860: 6962 2066 6f72 204a 7570 7974 6572 204e  ib for Jupyter N
+0000b870: 6f74 6562 6f6f 6b73 2e22 2222 0a20 2020  otebooks.""".   
+0000b880: 2020 2020 2073 656c 662e 7368 6f77 2873       self.show(s
+0000b890: 686f 775f 706f 7274 733d 5472 7565 2920  how_ports=True) 
+0000b8a0: 2023 2073 686f 7720 696e 206b 6c61 796f   # show in klayo
+0000b8b0: 7574 0a20 2020 2020 2020 2073 656c 662e  ut.        self.
+0000b8c0: 706c 6f74 5f6b 6c61 796f 7574 2829 0a20  plot_klayout(). 
+0000b8d0: 2020 2020 2020 2070 7269 6e74 2873 656c         print(sel
+0000b8e0: 6629 0a0a 2020 2020 6465 6620 6164 645f  f)..    def add_
+0000b8f0: 7069 6e73 5f74 7269 616e 676c 6528 0a20  pins_triangle(. 
+0000b900: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0000b910: 2020 2020 2070 6f72 745f 6d61 726b 6572       port_marker
+0000b920: 5f6c 6179 6572 3a20 4c61 7965 7220 3d20  _layer: Layer = 
+0000b930: 2831 2c20 3130 292c 0a20 2020 2029 3a0a  (1, 10),.    ):.
+0000b940: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+0000b950: 6e73 2063 6f6d 706f 6e65 6e74 2077 6974  ns component wit
+0000b960: 6820 7472 6961 6e67 756c 6172 2070 696e  h triangular pin
+0000b970: 732e 2222 220a 2020 2020 2020 2020 6672  s.""".        fr
+0000b980: 6f6d 2067 6473 6661 6374 6f72 792e 6164  om gdsfactory.ad
+0000b990: 645f 7069 6e73 2069 6d70 6f72 7420 6164  d_pins import ad
+0000b9a0: 645f 7069 6e73 5f74 7269 616e 676c 650a  d_pins_triangle.
+0000b9b0: 0a20 2020 2020 2020 2063 6f6d 706f 6e65  .        compone
+0000b9c0: 6e74 203d 2073 656c 662e 636f 7079 2829  nt = self.copy()
+0000b9d0: 0a20 2020 2020 2020 2063 6f6d 706f 6e65  .        compone
+0000b9e0: 6e74 2e6e 616d 6520 3d20 7365 6c66 2e6e  nt.name = self.n
+0000b9f0: 616d 650a 2020 2020 2020 2020 6164 645f  ame.        add_
+0000ba00: 7069 6e73 5f74 7269 616e 676c 6528 636f  pins_triangle(co
+0000ba10: 6d70 6f6e 656e 743d 636f 6d70 6f6e 656e  mponent=componen
+0000ba20: 742c 206c 6179 6572 3d70 6f72 745f 6d61  t, layer=port_ma
+0000ba30: 726b 6572 5f6c 6179 6572 290a 2020 2020  rker_layer).    
+0000ba40: 2020 2020 7265 7475 726e 2063 6f6d 706f      return compo
+0000ba50: 6e65 6e74 0a0a 2020 2020 6465 6620 706c  nent..    def pl
+0000ba60: 6f74 5f77 6964 6765 7428 0a20 2020 2020  ot_widget(.     
+0000ba70: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0000ba80: 2073 686f 775f 706f 7274 733a 2062 6f6f   show_ports: boo
+0000ba90: 6c20 3d20 5472 7565 2c0a 2020 2020 2020  l = True,.      
+0000baa0: 2020 706f 7274 5f6d 6172 6b65 725f 6c61    port_marker_la
+0000bab0: 7965 723a 204c 6179 6572 203d 2028 312c  yer: Layer = (1,
+0000bac0: 2031 3029 2c0a 2020 2020 2920 2d3e 204e   10),.    ) -> N
+0000bad0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+0000bae0: 5265 7475 726e 7320 6970 7974 686f 6e20  Returns ipython 
+0000baf0: 7769 6467 6574 2066 6f72 206b 6c61 796f  widget for klayo
+0000bb00: 7574 2076 6973 7561 6c69 7a61 7469 6f6e  ut visualization
+0000bb10: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+0000bb20: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
+0000bb30: 775f 706f 7274 733a 2073 686f 7773 2063  w_ports: shows c
+0000bb40: 6f6d 706f 6e65 6e74 2077 6974 6820 706f  omponent with po
+0000bb50: 7274 206d 6172 6b65 7273 2061 6e64 206c  rt markers and l
+0000bb60: 6162 656c 732e 0a20 2020 2020 2020 2020  abels..         
+0000bb70: 2020 2070 6f72 745f 6d61 726b 6572 5f6c     port_marker_l
+0000bb80: 6179 6572 3a20 666f 7220 7468 6520 706f  ayer: for the po
+0000bb90: 7274 732e 0a20 2020 2020 2020 2022 2222  rts..        """
+0000bba0: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
+0000bbb0: 7366 6163 746f 7279 2e70 646b 2069 6d70  sfactory.pdk imp
+0000bbc0: 6f72 7420 6765 745f 6c61 7965 725f 7669  ort get_layer_vi
+0000bbd0: 6577 730a 2020 2020 2020 2020 6672 6f6d  ews.        from
+0000bbe0: 2067 6473 6661 6374 6f72 792e 7769 6467   gdsfactory.widg
+0000bbf0: 6574 732e 6c61 796f 7574 5f76 6965 7765  ets.layout_viewe
+0000bc00: 7220 696d 706f 7274 204c 6179 6f75 7456  r import LayoutV
+0000bc10: 6965 7765 720a 2020 2020 2020 2020 6672  iewer.        fr
+0000bc20: 6f6d 2049 5079 7468 6f6e 2e64 6973 706c  om IPython.displ
+0000bc30: 6179 2069 6d70 6f72 7420 6469 7370 6c61  ay import displa
+0000bc40: 790a 0a20 2020 2020 2020 2063 6f6d 706f  y..        compo
+0000bc50: 6e65 6e74 203d 2028 0a20 2020 2020 2020  nent = (.       
+0000bc60: 2020 2020 2073 656c 662e 6164 645f 7069       self.add_pi
+0000bc70: 6e73 5f74 7269 616e 676c 6528 706f 7274  ns_triangle(port
+0000bc80: 5f6d 6172 6b65 725f 6c61 7965 723d 706f  _marker_layer=po
+0000bc90: 7274 5f6d 6172 6b65 725f 6c61 7965 7229  rt_marker_layer)
+0000bca0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000bcb0: 7368 6f77 5f70 6f72 7473 0a20 2020 2020  show_ports.     
+0000bcc0: 2020 2020 2020 2065 6c73 6520 7365 6c66         else self
+0000bcd0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0000bce0: 2020 2020 6764 7370 6174 6820 3d20 636f      gdspath = co
+0000bcf0: 6d70 6f6e 656e 742e 7772 6974 655f 6764  mponent.write_gd
+0000bd00: 7328 6c6f 6767 696e 673d 4661 6c73 6529  s(logging=False)
+0000bd10: 0a20 2020 2020 2020 206c 7970 5f70 6174  .        lyp_pat
+0000bd20: 6820 3d20 6764 7370 6174 682e 7769 7468  h = gdspath.with
+0000bd30: 5f73 7566 6669 7828 222e 6c79 7022 290a  _suffix(".lyp").
+0000bd40: 0a20 2020 2020 2020 206c 6179 6572 5f76  .        layer_v
+0000bd50: 6965 7773 203d 2067 6574 5f6c 6179 6572  iews = get_layer
+0000bd60: 5f76 6965 7773 2829 0a20 2020 2020 2020  _views().       
+0000bd70: 206c 6179 6572 5f76 6965 7773 2e74 6f5f   layer_views.to_
+0000bd80: 6c79 7028 6669 6c65 7061 7468 3d6c 7970  lyp(filepath=lyp
+0000bd90: 5f70 6174 6829 0a0a 2020 2020 2020 2020  _path)..        
+0000bda0: 6c61 796f 7574 203d 204c 6179 6f75 7456  layout = LayoutV
+0000bdb0: 6965 7765 7228 6764 7370 6174 682c 206c  iewer(gdspath, l
+0000bdc0: 7970 5f70 6174 6829 0a20 2020 2020 2020  yp_path).       
+0000bdd0: 2064 6973 706c 6179 286c 6179 6f75 742e   display(layout.
+0000bde0: 7769 6467 6574 290a 0a20 2020 2064 6566  widget)..    def
+0000bdf0: 2070 6c6f 745f 6b6c 6179 6f75 7428 0a20   plot_klayout(. 
+0000be00: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0000be10: 2020 2020 2073 686f 775f 706f 7274 733a       show_ports:
+0000be20: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
+0000be30: 2020 2020 2020 706f 7274 5f6d 6172 6b65        port_marke
+0000be40: 725f 6c61 7965 723a 204c 6179 6572 203d  r_layer: Layer =
+0000be50: 2028 312c 2031 3029 2c0a 2020 2020 2020   (1, 10),.      
+0000be60: 2020 7368 6f77 5f6c 6162 656c 733a 2062    show_labels: b
+0000be70: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+0000be80: 2029 202d 3e20 4e6f 6e65 3a0a 2020 2020   ) -> None:.    
+0000be90: 2020 2020 2222 2252 6574 7572 6e73 206b      """Returns k
+0000bea0: 6c61 796f 7574 2069 6d61 6765 2e0a 0a20  layout image... 
+0000beb0: 2020 2020 2020 2049 6620 6974 2066 6169         If it fai
+0000bec0: 6c73 2074 6f20 696d 706f 7274 206b 6c61  ls to import kla
+0000bed0: 796f 7574 2064 6566 6175 6c74 7320 746f  yout defaults to
+0000bee0: 206d 6174 706c 6f74 6c69 622e 0a0a 2020   matplotlib...  
+0000bef0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+0000bf00: 2020 2020 2020 2020 7368 6f77 5f70 6f72          show_por
+0000bf10: 7473 3a20 7368 6f77 7320 636f 6d70 6f6e  ts: shows compon
+0000bf20: 656e 7420 7769 7468 2070 6f72 7420 6d61  ent with port ma
+0000bf30: 726b 6572 7320 616e 6420 6c61 6265 6c73  rkers and labels
+0000bf40: 2e0a 2020 2020 2020 2020 2020 2020 706f  ..            po
+0000bf50: 7274 5f6d 6172 6b65 725f 6c61 7965 723a  rt_marker_layer:
+0000bf60: 2066 6f72 2074 6865 2070 6f72 7473 2e0a   for the ports..
+0000bf70: 2020 2020 2020 2020 2020 2020 7368 6f77              show
+0000bf80: 5f6c 6162 656c 733a 2073 686f 7773 206c  _labels: shows l
+0000bf90: 6162 656c 732e 0a20 2020 2020 2020 2022  abels..        "
+0000bfa0: 2222 0a0a 2020 2020 2020 2020 636f 6d70  ""..        comp
+0000bfb0: 6f6e 656e 7420 3d20 280a 2020 2020 2020  onent = (.      
+0000bfc0: 2020 2020 2020 7365 6c66 2e61 6464 5f70        self.add_p
+0000bfd0: 696e 735f 7472 6961 6e67 6c65 2870 6f72  ins_triangle(por
+0000bfe0: 745f 6d61 726b 6572 5f6c 6179 6572 3d70  t_marker_layer=p
+0000bff0: 6f72 745f 6d61 726b 6572 5f6c 6179 6572  ort_marker_layer
+0000c000: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000c010: 2073 686f 775f 706f 7274 730a 2020 2020   show_ports.    
+0000c020: 2020 2020 2020 2020 656c 7365 2073 656c          else sel
+0000c030: 660a 2020 2020 2020 2020 290a 0a20 2020  f.        )..   
+0000c040: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000c050: 2020 2020 2020 696d 706f 7274 206b 6c61        import kla
+0000c060: 796f 7574 2e64 6220 6173 2064 6220 2023  yout.db as db  #
+0000c070: 206e 6f71 613a 2046 3430 310a 2020 2020   noqa: F401.    
+0000c080: 2020 2020 2020 2020 696d 706f 7274 206b          import k
+0000c090: 6c61 796f 7574 2e6c 6179 2061 7320 6c61  layout.lay as la
+0000c0a0: 790a 2020 2020 2020 2020 2020 2020 6672  y.            fr
+0000c0b0: 6f6d 2067 6473 6661 6374 6f72 792e 7064  om gdsfactory.pd
+0000c0c0: 6b20 696d 706f 7274 2067 6574 5f6c 6179  k import get_lay
+0000c0d0: 6572 5f76 6965 7773 0a20 2020 2020 2020  er_views.       
+0000c0e0: 2020 2020 2066 726f 6d20 4950 7974 686f       from IPytho
+0000c0f0: 6e2e 6469 7370 6c61 7920 696d 706f 7274  n.display import
+0000c100: 2064 6973 706c 6179 0a20 2020 2020 2020   display.       
+0000c110: 2020 2020 2066 726f 6d20 6970 7977 6964       from ipywid
+0000c120: 6765 7473 2069 6d70 6f72 7420 496d 6167  gets import Imag
+0000c130: 650a 0a20 2020 2020 2020 2020 2020 2067  e..            g
+0000c140: 6473 7061 7468 203d 2063 6f6d 706f 6e65  dspath = compone
+0000c150: 6e74 2e77 7269 7465 5f67 6473 286c 6f67  nt.write_gds(log
+0000c160: 6769 6e67 3d46 616c 7365 290a 2020 2020  ging=False).    
+0000c170: 2020 2020 2020 2020 6c79 705f 7061 7468          lyp_path
+0000c180: 203d 2067 6473 7061 7468 2e77 6974 685f   = gdspath.with_
+0000c190: 7375 6666 6978 2822 2e6c 7970 2229 0a0a  suffix(".lyp")..
+0000c1a0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+0000c1b0: 725f 7669 6577 7320 3d20 6765 745f 6c61  r_views = get_la
+0000c1c0: 7965 725f 7669 6577 7328 290a 2020 2020  yer_views().    
+0000c1d0: 2020 2020 2020 2020 6c61 7965 725f 7669          layer_vi
+0000c1e0: 6577 732e 746f 5f6c 7970 2866 696c 6570  ews.to_lyp(filep
+0000c1f0: 6174 683d 6c79 705f 7061 7468 290a 0a20  ath=lyp_path).. 
+0000c200: 2020 2020 2020 2020 2020 206c 6179 6f75             layou
+0000c210: 745f 7669 6577 203d 206c 6179 2e4c 6179  t_view = lay.Lay
+0000c220: 6f75 7456 6965 7728 290a 2020 2020 2020  outView().      
+0000c230: 2020 2020 2020 6c61 796f 7574 5f76 6965        layout_vie
+0000c240: 772e 6c6f 6164 5f6c 6179 6f75 7428 7374  w.load_layout(st
+0000c250: 7228 6764 7370 6174 682e 6162 736f 6c75  r(gdspath.absolu
+0000c260: 7465 2829 2929 0a20 2020 2020 2020 2020  te())).         
+0000c270: 2020 206c 6179 6f75 745f 7669 6577 2e6d     layout_view.m
+0000c280: 6178 5f68 6965 7228 290a 2020 2020 2020  ax_hier().      
+0000c290: 2020 2020 2020 6c61 796f 7574 5f76 6965        layout_vie
+0000c2a0: 772e 6c6f 6164 5f6c 6179 6572 5f70 726f  w.load_layer_pro
+0000c2b0: 7073 2873 7472 286c 7970 5f70 6174 6829  ps(str(lyp_path)
+0000c2c0: 290a 0a20 2020 2020 2020 2020 2020 206c  )..            l
+0000c2d0: 6179 6f75 745f 7669 6577 2e73 6574 5f63  ayout_view.set_c
+0000c2e0: 6f6e 6669 6728 2274 6578 742d 7669 7369  onfig("text-visi
+0000c2f0: 626c 6522 2c20 2274 7275 6522 2069 6620  ble", "true" if 
+0000c300: 7368 6f77 5f6c 6162 656c 7320 656c 7365  show_labels else
+0000c310: 2022 6661 6c73 6522 290a 0a20 2020 2020   "false")..     
+0000c320: 2020 2020 2020 2070 6978 656c 5f62 7566         pixel_buf
+0000c330: 6665 7220 3d20 6c61 796f 7574 5f76 6965  fer = layout_vie
+0000c340: 772e 6765 745f 7069 7865 6c73 5f77 6974  w.get_pixels_wit
+0000c350: 685f 6f70 7469 6f6e 7328 3830 302c 2036  h_options(800, 6
+0000c360: 3030 290a 2020 2020 2020 2020 2020 2020  00).            
+0000c370: 706e 675f 6461 7461 203d 2070 6978 656c  png_data = pixel
+0000c380: 5f62 7566 6665 722e 746f 5f70 6e67 5f64  _buffer.to_png_d
+0000c390: 6174 6128 290a 2020 2020 2020 2020 2020  ata().          
+0000c3a0: 2020 696d 6167 6520 3d20 496d 6167 6528    image = Image(
+0000c3b0: 7661 6c75 653d 706e 675f 6461 7461 2c20  value=png_data, 
+0000c3c0: 666f 726d 6174 3d22 706e 6722 290a 2020  format="png").  
+0000c3d0: 2020 2020 2020 2020 2020 6469 7370 6c61            displa
+0000c3e0: 7928 696d 6167 6529 0a0a 2020 2020 2020  y(image)..      
+0000c3f0: 2020 6578 6365 7074 2049 6d70 6f72 7445    except ImportE
+0000c400: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+0000c410: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
+0000c420: 2020 2020 2020 2020 2022 596f 7520 6361           "You ca
+0000c430: 6e20 696e 7374 616c 6c20 6070 6970 2069  n install `pip i
+0000c440: 6e73 7461 6c6c 2067 6473 6661 6374 6f72  nstall gdsfactor
+0000c450: 795b 6675 6c6c 5d60 2066 6f72 2062 6574  y[full]` for bet
+0000c460: 7465 7220 7669 7375 616c 697a 6174 696f  ter visualizatio
+0000c470: 6e22 0a20 2020 2020 2020 2020 2020 2029  n".            )
+0000c480: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
+0000c490: 706f 6e65 6e74 2e70 6c6f 7428 706c 6f74  ponent.plot(plot
+0000c4a0: 7465 723d 226d 6174 706c 6f74 6c69 6222  ter="matplotlib"
+0000c4b0: 290a 0a20 2020 2064 6566 2070 6c6f 745f  )..    def plot_
+0000c4c0: 6a75 7079 7465 7228 7365 6c66 293a 0a20  jupyter(self):. 
+0000c4d0: 2020 2020 2020 2022 2222 5368 6f77 7320         """Shows 
+0000c4e0: 6375 7272 656e 7420 6764 7320 696e 206b  current gds in k
+0000c4f0: 6c61 796f 7574 2e20 5573 6573 204b 7765  layout. Uses Kwe
+0000c500: 6220 6966 2073 6572 7665 7220 7275 6e6e  b if server runn
+0000c510: 696e 672e 0a0a 2020 2020 2020 2020 6966  ing...        if
+0000c520: 206e 6f74 2074 7269 6573 2075 7369 6e67   not tries using
+0000c530: 204b 6c61 796f 7574 2077 6964 6765 7420   Klayout widget 
+0000c540: 616e 6420 6669 6e61 6c6c 7920 6465 6661  and finally defa
+0000c550: 756c 7473 2074 6f20 6d61 7470 6c6f 746c  ults to matplotl
+0000c560: 6962 2e0a 2020 2020 2020 2020 2222 220a  ib..        """.
+0000c570: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0000c580: 2020 2020 2020 2020 2069 6d70 6f72 7420           import 
+0000c590: 6f73 0a20 2020 2020 2020 2020 2020 2066  os.            f
+0000c5a0: 726f 6d20 6764 7366 6163 746f 7279 2e63  rom gdsfactory.c
+0000c5b0: 6f6e 6669 6720 696d 706f 7274 2050 4154  onfig import PAT
+0000c5c0: 480a 2020 2020 2020 2020 2020 2020 6672  H.            fr
+0000c5d0: 6f6d 2067 6473 6661 6374 6f72 792e 7064  om gdsfactory.pd
+0000c5e0: 6b20 696d 706f 7274 2067 6574 5f6c 6179  k import get_lay
+0000c5f0: 6572 5f76 6965 7773 0a20 2020 2020 2020  er_views.       
+0000c600: 2020 2020 2066 726f 6d20 4950 7974 686f       from IPytho
+0000c610: 6e2e 6469 7370 6c61 7920 696d 706f 7274  n.display import
+0000c620: 2049 4672 616d 650a 2020 2020 2020 2020   IFrame.        
+0000c630: 2020 2020 696d 706f 7274 206b 7765 622e      import kweb.
+0000c640: 7365 7276 6572 5f6a 7570 7974 6572 2061  server_jupyter a
+0000c650: 7320 6b6a 0a20 2020 2020 2020 2020 2020  s kj.           
+0000c660: 2066 726f 6d20 6874 6d6c 2069 6d70 6f72   from html impor
+0000c670: 7420 6573 6361 7065 0a0a 2020 2020 2020  t escape..      
+0000c680: 2020 2020 2020 6764 7370 6174 6820 3d20        gdspath = 
+0000c690: 7365 6c66 2e77 7269 7465 5f67 6473 2867  self.write_gds(g
+0000c6a0: 6473 6469 723d 5041 5448 2e67 6473 6c69  dsdir=PATH.gdsli
+0000c6b0: 6220 2f20 2265 7874 7261 222c 206c 6f67  b / "extra", log
+0000c6c0: 6769 6e67 3d46 616c 7365 290a 0a20 2020  ging=False)..   
+0000c6d0: 2020 2020 2020 2020 2064 6972 7061 7468           dirpath
+0000c6e0: 203d 2047 4453 4449 525f 5445 4d50 0a20   = GDSDIR_TEMP. 
+0000c6f0: 2020 2020 2020 2020 2020 2064 6972 7061             dirpa
+0000c700: 7468 2e6d 6b64 6972 2865 7869 7374 5f6f  th.mkdir(exist_o
+0000c710: 6b3d 5472 7565 2c20 7061 7265 6e74 733d  k=True, parents=
+0000c720: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+0000c730: 2020 6c79 705f 7061 7468 203d 2064 6972    lyp_path = dir
+0000c740: 7061 7468 202f 2022 6c61 7965 7273 2e6c  path / "layers.l
+0000c750: 7970 220a 0a20 2020 2020 2020 2020 2020  yp"..           
+0000c760: 206c 6179 6572 5f70 726f 7073 203d 2067   layer_props = g
+0000c770: 6574 5f6c 6179 6572 5f76 6965 7773 2829  et_layer_views()
+0000c780: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+0000c790: 6572 5f70 726f 7073 2e74 6f5f 6c79 7028  er_props.to_lyp(
+0000c7a0: 6669 6c65 7061 7468 3d6c 7970 5f70 6174  filepath=lyp_pat
+0000c7b0: 6829 0a0a 2020 2020 2020 2020 2020 2020  h)..            
+0000c7c0: 706f 7274 203d 206b 6a2e 706f 7274 2069  port = kj.port i
+0000c7d0: 6620 6861 7361 7474 7228 6b6a 2c20 2270  f hasattr(kj, "p
+0000c7e0: 6f72 7422 2920 656c 7365 2038 3030 300a  ort") else 8000.
+0000c7f0: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
+0000c800: 203d 2066 2268 7474 703a 2f2f 3132 372e   = f"http://127.
+0000c810: 302e 302e 313a 7b70 6f72 747d 2f67 6473  0.0.1:{port}/gds
+0000c820: 3f67 6473 5f66 696c 653d 7b65 7363 6170  ?gds_file={escap
+0000c830: 6528 7374 7228 6764 7370 6174 6829 297d  e(str(gdspath))}
+0000c840: 266c 6179 6572 5f70 726f 7073 3d7b 6573  &layer_props={es
+0000c850: 6361 7065 2873 7472 286c 7970 5f70 6174  cape(str(lyp_pat
+0000c860: 6829 297d 220a 2020 2020 2020 2020 2020  h))}".          
+0000c870: 2020 6c6f 6767 6572 2e64 6562 7567 2873    logger.debug(s
+0000c880: 7263 290a 0a20 2020 2020 2020 2020 2020  rc)..           
+0000c890: 2069 6620 6b6a 2e6a 7570 7974 6572 5f73   if kj.jupyter_s
+0000c8a0: 6572 7665 7220 616e 6420 6e6f 7420 6f73  erver and not os
+0000c8b0: 2e65 6e76 6972 6f6e 2e67 6574 2822 444f  .environ.get("DO
+0000c8c0: 4353 222c 2046 616c 7365 293a 0a20 2020  CS", False):.   
+0000c8d0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000c8e0: 7572 6e20 4946 7261 6d65 280a 2020 2020  urn IFrame(.    
+0000c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c900: 7372 633d 7372 632c 0a20 2020 2020 2020  src=src,.       
+0000c910: 2020 2020 2020 2020 2020 2020 2077 6964               wid
+0000c920: 7468 3d31 3430 302c 0a20 2020 2020 2020  th=1400,.       
+0000c930: 2020 2020 2020 2020 2020 2020 2068 6569               hei
+0000c940: 6768 743d 3630 302c 0a20 2020 2020 2020  ght=600,.       
+0000c950: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000c960: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000c970: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000c980: 7572 6e20 7365 6c66 2e70 6c6f 745f 6b6c  urn self.plot_kl
+0000c990: 6179 6f75 7428 290a 2020 2020 2020 2020  ayout().        
+0000c9a0: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
+0000c9b0: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+0000c9c0: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+0000c9d0: 2020 2020 2020 2022 596f 7520 6361 6e20         "You can 
+0000c9e0: 696e 7374 616c 6c20 6070 6970 2069 6e73  install `pip ins
+0000c9f0: 7461 6c6c 2067 6473 6661 6374 6f72 795b  tall gdsfactory[
+0000ca00: 6675 6c6c 5d60 2066 6f72 2062 6574 7465  full]` for bette
+0000ca10: 7220 7669 7375 616c 697a 6174 696f 6e22  r visualization"
+0000ca20: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000ca30: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000ca40: 6e20 7365 6c66 2e70 6c6f 745f 6b6c 6179  n self.plot_klay
+0000ca50: 6f75 7428 290a 0a20 2020 2064 6566 2070  out()..    def p
+0000ca60: 6c6f 745f 6d61 7470 6c6f 746c 6962 2873  lot_matplotlib(s
+0000ca70: 656c 662c 202a 2a6b 7761 7267 7329 202d  elf, **kwargs) -
+0000ca80: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000ca90: 2222 2250 6c6f 7420 636f 6d70 6f6e 656e  """Plot componen
+0000caa0: 7420 7573 696e 6720 6d61 7470 6c6f 746c  t using matplotl
+0000cab0: 6962 2e0a 0a20 2020 2020 2020 204b 6579  ib...        Key
+0000cac0: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
+0000cad0: 2020 2020 2020 2073 686f 775f 706f 7274         show_port
+0000cae0: 733a 2053 6574 7320 7768 6574 6865 7220  s: Sets whether 
+0000caf0: 706f 7274 7320 6172 6520 6472 6177 6e2e  ports are drawn.
+0000cb00: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
+0000cb10: 775f 7375 6270 6f72 7473 3a20 5365 7473  w_subports: Sets
+0000cb20: 2077 6865 7468 6572 2073 7562 706f 7274   whether subport
+0000cb30: 7320 2870 6f72 7473 2074 6861 7420 6265  s (ports that be
+0000cb40: 6c6f 6e67 2074 6f20 7265 6665 7265 6e63  long to referenc
+0000cb50: 6573 2920 6172 6520 6472 6177 6e2e 0a20  es) are drawn.. 
+0000cb60: 2020 2020 2020 2020 2020 206c 6162 656c             label
+0000cb70: 5f61 6c69 6173 6573 3a20 5365 7473 2077  _aliases: Sets w
+0000cb80: 6865 7468 6572 2061 6c69 6173 6573 2061  hether aliases a
+0000cb90: 7265 206c 6162 656c 6564 2077 6974 6820  re labeled with 
+0000cba0: 6120 7465 7874 206e 616d 652e 0a20 2020  a text name..   
+0000cbb0: 2020 2020 2020 2020 206e 6577 5f77 696e           new_win
+0000cbc0: 646f 773a 2049 6620 5472 7565 2c20 6561  dow: If True, ea
+0000cbd0: 6368 2063 616c 6c20 746f 2071 7569 636b  ch call to quick
+0000cbe0: 706c 6f74 2829 2077 696c 6c20 6765 6e65  plot() will gene
+0000cbf0: 7261 7465 2061 2073 6570 6172 6174 6520  rate a separate 
+0000cc00: 7769 6e64 6f77 2e0a 2020 2020 2020 2020  window..        
+0000cc10: 2020 2020 626c 6f63 6b69 6e67 3a20 4966      blocking: If
+0000cc20: 2054 7275 652c 2063 616c 6c69 6e67 2071   True, calling q
+0000cc30: 7569 636b 706c 6f74 2829 2077 696c 6c20  uickplot() will 
+0000cc40: 7061 7573 6520 6578 6563 7574 696f 6e20  pause execution 
+0000cc50: 6f66 2028 2262 6c6f 636b 2229 2074 6865  of ("block") the
+0000cc60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cc70: 2072 656d 6169 6e64 6572 206f 6620 7468   remainder of th
+0000cc80: 6520 7079 7468 6f6e 2063 6f64 6520 756e  e python code un
+0000cc90: 7469 6c20 7468 6520 7175 6963 6b70 6c6f  til the quickplo
+0000cca0: 7428 2920 7769 6e64 6f77 2069 7320 636c  t() window is cl
+0000ccb0: 6f73 6564 2e0a 2020 2020 2020 2020 2020  osed..          
+0000ccc0: 2020 2020 2020 4966 2046 616c 7365 2c20        If False, 
+0000ccd0: 7468 6520 7769 6e64 6f77 2077 696c 6c20  the window will 
+0000cce0: 6265 206f 7065 6e65 6420 616e 6420 636f  be opened and co
+0000ccf0: 6465 2077 696c 6c20 636f 6e74 696e 7565  de will continue
+0000cd00: 2074 6f20 7275 6e2e 0a20 2020 2020 2020   to run..       
+0000cd10: 2020 2020 207a 6f6f 6d5f 6661 6374 6f72       zoom_factor
+0000cd20: 3a20 5365 7473 2074 6865 2073 6361 6c69  : Sets the scali
+0000cd30: 6e67 2066 6163 746f 7220 7768 656e 207a  ng factor when z
+0000cd40: 6f6f 6d69 6e67 2074 6865 2071 7569 636b  ooming the quick
+0000cd50: 706c 6f74 2077 696e 646f 7720 7769 7468  plot window with
+0000cd60: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+0000cd70: 2020 2020 206d 6f75 7365 7768 6565 6c2f       mousewheel/
+0000cd80: 7472 6163 6b70 6164 2e0a 2020 2020 2020  trackpad..      
+0000cd90: 2020 2020 2020 696e 7465 7261 6374 6976        interactiv
+0000cda0: 655f 7a6f 6f6d 3a20 456e 6162 6c65 7320  e_zoom: Enables 
+0000cdb0: 7573 696e 6720 6d6f 7573 6577 6865 656c  using mousewheel
+0000cdc0: 2f74 7261 636b 7061 6420 746f 207a 6f6f  /trackpad to zoo
+0000cdd0: 6d2e 0a20 2020 2020 2020 2020 2020 2066  m..            f
+0000cde0: 6f6e 7473 697a 653a 2066 6f72 206c 6162  ontsize: for lab
+0000cdf0: 656c 732e 0a20 2020 2020 2020 2020 2020  els..           
+0000ce00: 206c 6179 6572 735f 6578 636c 7564 6564   layers_excluded
+0000ce10: 3a20 6c69 7374 206f 6620 6c61 7965 7273  : list of layers
+0000ce20: 2074 6f20 6578 636c 7564 652e 0a20 2020   to exclude..   
+0000ce30: 2020 2020 2020 2020 206c 6179 6572 5f76           layer_v
+0000ce40: 6965 7773 3a20 6c61 7965 725f 7669 6577  iews: layer_view
+0000ce50: 7320 636f 6c6f 7273 206c 6f61 6465 6420  s colors loaded 
+0000ce60: 6672 6f6d 204b 6c61 796f 7574 2e0a 2020  from Klayout..  
+0000ce70: 2020 2020 2020 2020 2020 6d69 6e5f 6173            min_as
+0000ce80: 7065 6374 3a20 6d69 6e69 6d75 6d20 6173  pect: minimum as
+0000ce90: 7065 6374 2072 6174 696f 2e0a 2020 2020  pect ratio..    
+0000cea0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000ceb0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+0000cec0: 7175 6963 6b70 6c6f 7474 6572 2069 6d70  quickplotter imp
+0000ced0: 6f72 7420 7175 6963 6b70 6c6f 740a 0a20  ort quickplot.. 
+0000cee0: 2020 2020 2020 2071 7569 636b 706c 6f74         quickplot
+0000cef0: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
+0000cf00: 0a0a 2020 2020 6465 6620 706c 6f74 2873  ..    def plot(s
+0000cf10: 656c 662c 2070 6c6f 7474 6572 3a20 4f70  elf, plotter: Op
+0000cf20: 7469 6f6e 616c 5b50 6c6f 7474 6572 5d20  tional[Plotter] 
+0000cf30: 3d20 4e6f 6e65 2c20 2a2a 6b77 6172 6773  = None, **kwargs
+0000cf40: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000cf50: 2020 2022 2222 5265 7475 726e 7320 636f     """Returns co
+0000cf60: 6d70 6f6e 656e 7420 706c 6f74 2075 7369  mponent plot usi
+0000cf70: 6e67 206b 6c61 796f 7574 2c20 6d61 7470  ng klayout, matp
+0000cf80: 6c6f 746c 6962 2c20 686f 6c6f 7669 6577  lotlib, holoview
+0000cf90: 7320 6f72 2071 742e 0a0a 2020 2020 2020  s or qt...      
+0000cfa0: 2020 5765 2072 6563 6f6d 6d65 6e64 2075    We recommend u
+0000cfb0: 7369 6e67 206b 6c61 796f 7574 2e0a 0a20  sing klayout... 
+0000cfc0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+0000cfd0: 2020 2020 2020 2020 2070 6c6f 7474 6572           plotter
+0000cfe0: 3a20 706c 6f74 2062 6163 6b65 6e64 2028  : plot backend (
+0000cff0: 2768 6f6c 6f76 6965 7773 272c 2027 6d61  'holoviews', 'ma
+0000d000: 7470 6c6f 746c 6962 272c 2027 7174 272c  tplotlib', 'qt',
+0000d010: 2027 6b6c 6179 6f75 7427 292e 0a20 2020   'klayout')..   
+0000d020: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000d030: 2070 6c6f 7474 6572 203d 2070 6c6f 7474   plotter = plott
+0000d040: 6572 206f 7220 434f 4e46 2e67 6574 2822  er or CONF.get("
+0000d050: 706c 6f74 7465 7222 2c20 226d 6174 706c  plotter", "matpl
+0000d060: 6f74 6c69 6222 290a 0a20 2020 2020 2020  otlib")..       
+0000d070: 2069 6620 706c 6f74 7465 7220 3d3d 2022   if plotter == "
+0000d080: 6b6c 6179 6f75 7422 3a0a 2020 2020 2020  klayout":.      
+0000d090: 2020 2020 2020 7365 6c66 2e70 6c6f 745f        self.plot_
+0000d0a0: 6b6c 6179 6f75 7428 290a 2020 2020 2020  klayout().      
+0000d0b0: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+0000d0c0: 2020 2020 2020 656c 6966 2070 6c6f 7474        elif plott
+0000d0d0: 6572 203d 3d20 226d 6174 706c 6f74 6c69  er == "matplotli
+0000d0e0: 6222 3a0a 2020 2020 2020 2020 2020 2020  b":.            
+0000d0f0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+0000d100: 7175 6963 6b70 6c6f 7474 6572 2069 6d70  quickplotter imp
+0000d110: 6f72 7420 7175 6963 6b70 6c6f 740a 0a20  ort quickplot.. 
+0000d120: 2020 2020 2020 2020 2020 2071 7569 636b             quick
+0000d130: 706c 6f74 2873 656c 662c 202a 2a6b 7761  plot(self, **kwa
+0000d140: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
+0000d150: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
+0000d160: 2065 6c69 6620 706c 6f74 7465 7220 3d3d   elif plotter ==
+0000d170: 2022 686f 6c6f 7669 6577 7322 3a0a 2020   "holoviews":.  
+0000d180: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+0000d190: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000d1a0: 6d70 6f72 7420 686f 6c6f 7669 6577 7320  mport holoviews 
+0000d1b0: 6173 2068 760a 0a20 2020 2020 2020 2020  as hv..         
+0000d1c0: 2020 2020 2020 2068 762e 6578 7465 6e73         hv.extens
+0000d1d0: 696f 6e28 2262 6f6b 6568 2229 0a20 2020  ion("bokeh").   
+0000d1e0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+0000d1f0: 496d 706f 7274 4572 726f 7220 6173 2065  ImportError as e
+0000d200: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d210: 2020 7072 696e 7428 2279 6f75 206e 6565    print("you nee
+0000d220: 6420 746f 2060 7069 7020 696e 7374 616c  d to `pip instal
+0000d230: 6c20 686f 6c6f 7669 6577 7360 2229 0a20  l holoviews`"). 
+0000d240: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000d250: 6169 7365 2065 0a20 2020 2020 2020 2020  aise e.         
+0000d260: 2020 2072 6574 7572 6e20 7365 6c66 2e70     return self.p
+0000d270: 6c6f 745f 686f 6c6f 7669 6577 7328 2a2a  lot_holoviews(**
+0000d280: 6b77 6172 6773 290a 0a20 2020 2020 2020  kwargs)..       
+0000d290: 2065 6c69 6620 706c 6f74 7465 7220 3d3d   elif plotter ==
+0000d2a0: 2022 7174 223a 0a20 2020 2020 2020 2020   "qt":.         
+0000d2b0: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+0000d2c0: 7279 2e71 7569 636b 706c 6f74 7465 7220  ry.quickplotter 
+0000d2d0: 696d 706f 7274 2071 7569 636b 706c 6f74  import quickplot
+0000d2e0: 320a 0a20 2020 2020 2020 2020 2020 2071  2..            q
+0000d2f0: 7569 636b 706c 6f74 3228 7365 6c66 290a  uickplot2(self).
+0000d300: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000d310: 726e 0a20 2020 2020 2020 2065 6c73 653a  rn.        else:
+0000d320: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000d330: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
+0000d340: 7b70 6c6f 7474 6572 2172 7d20 6e6f 7420  {plotter!r} not 
+0000d350: 696e 207b 506c 6f74 7465 727d 2229 0a0a  in {Plotter}")..
+0000d360: 2020 2020 6465 6620 706c 6f74 5f68 6f6c      def plot_hol
+0000d370: 6f76 6965 7773 280a 2020 2020 2020 2020  oviews(.        
+0000d380: 7365 6c66 2c0a 2020 2020 2020 2020 6c61  self,.        la
+0000d390: 7965 7273 5f65 7863 6c75 6465 643a 204f  yers_excluded: O
+0000d3a0: 7074 696f 6e61 6c5b 4c61 7965 7273 5d20  ptional[Layers] 
+0000d3b0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0000d3c0: 6c61 7965 725f 7669 6577 733a 204f 7074  layer_views: Opt
+0000d3d0: 696f 6e61 6c5b 4c61 7965 7256 6965 7773  ional[LayerViews
+0000d3e0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+0000d3f0: 2020 6d69 6e5f 6173 7065 6374 3a20 666c    min_aspect: fl
+0000d400: 6f61 7420 3d20 302e 3235 2c0a 2020 2020  oat = 0.25,.    
+0000d410: 2020 2020 7061 6464 696e 673a 2066 6c6f      padding: flo
+0000d420: 6174 203d 2030 2e35 2c0a 2020 2020 293a  at = 0.5,.    ):
+0000d430: 0a20 2020 2020 2020 2022 2222 506c 6f74  .        """Plot
+0000d440: 2063 6f6d 706f 6e65 6e74 2069 6e20 686f   component in ho
+0000d450: 6c6f 7669 6577 732e 0a0a 2020 2020 2020  loviews...      
+0000d460: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+0000d470: 2020 2020 6c61 7965 7273 5f65 7863 6c75      layers_exclu
+0000d480: 6465 643a 206c 6973 7420 6f66 206c 6179  ded: list of lay
+0000d490: 6572 7320 746f 2065 7863 6c75 6465 2e0a  ers to exclude..
+0000d4a0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+0000d4b0: 725f 7669 6577 733a 206c 6179 6572 5f76  r_views: layer_v
+0000d4c0: 6965 7773 2063 6f6c 6f72 7320 6c6f 6164  iews colors load
+0000d4d0: 6564 2066 726f 6d20 4b6c 6179 6f75 742e  ed from Klayout.
+0000d4e0: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
+0000d4f0: 5f61 7370 6563 743a 206d 696e 696d 756d  _aspect: minimum
+0000d500: 2061 7370 6563 7420 7261 7469 6f2e 0a20   aspect ratio.. 
+0000d510: 2020 2020 2020 2020 2020 2070 6164 6469             paddi
+0000d520: 6e67 3a20 6172 6f75 6e64 2062 6f75 6e64  ng: around bound
+0000d530: 696e 6720 626f 782e 0a0a 2020 2020 2020  ing box...      
+0000d540: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
+0000d550: 2020 2020 2020 2048 6f6c 6f76 6965 7773         Holoviews
+0000d560: 204f 7665 726c 6179 2074 6f20 6469 7370   Overlay to disp
+0000d570: 6c61 7920 616c 6c20 706f 6c79 676f 6e73  lay all polygons
+0000d580: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000d590: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
+0000d5a0: 6374 6f72 792e 6164 645f 7069 6e73 2069  ctory.add_pins i
+0000d5b0: 6d70 6f72 7420 6765 745f 7069 6e5f 7472  mport get_pin_tr
+0000d5c0: 6961 6e67 6c65 5f70 6f6c 7967 6f6e 5f74  iangle_polygon_t
+0000d5d0: 6970 0a20 2020 2020 2020 2066 726f 6d20  ip.        from 
+0000d5e0: 6764 7366 6163 746f 7279 2e67 656e 6572  gdsfactory.gener
+0000d5f0: 6963 5f74 6563 6820 696d 706f 7274 204c  ic_tech import L
+0000d600: 4159 4552 5f56 4945 5753 0a0a 2020 2020  AYER_VIEWS..    
+0000d610: 2020 2020 6966 206c 6179 6572 5f76 6965      if layer_vie
+0000d620: 7773 2069 7320 4e6f 6e65 3a0a 2020 2020  ws is None:.    
+0000d630: 2020 2020 2020 2020 6c61 7965 725f 7669          layer_vi
+0000d640: 6577 7320 3d20 4c41 5945 525f 5649 4557  ews = LAYER_VIEW
+0000d650: 530a 0a20 2020 2020 2020 2074 7279 3a0a  S..        try:.
+0000d660: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+0000d670: 7274 2068 6f6c 6f76 6965 7773 2061 7320  rt holoviews as 
+0000d680: 6876 0a0a 2020 2020 2020 2020 2020 2020  hv..            
+0000d690: 6876 2e65 7874 656e 7369 6f6e 2822 626f  hv.extension("bo
+0000d6a0: 6b65 6822 290a 2020 2020 2020 2020 6578  keh").        ex
+0000d6b0: 6365 7074 2049 6d70 6f72 7445 7272 6f72  cept ImportError
+0000d6c0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+0000d6d0: 2020 2070 7269 6e74 2822 796f 7520 6e65     print("you ne
+0000d6e0: 6564 2074 6f20 6070 6970 2069 6e73 7461  ed to `pip insta
+0000d6f0: 6c6c 2068 6f6c 6f76 6965 7773 6022 290a  ll holoviews`").
+0000d700: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000d710: 6520 650a 0a20 2020 2020 2020 2073 656c  e e..        sel
+0000d720: 662e 5f62 625f 7661 6c69 6420 3d20 4661  f._bb_valid = Fa
+0000d730: 6c73 6520 2023 2072 6563 6f6d 7075 7465  lse  # recompute
+0000d740: 2074 6865 2062 6f75 6e64 696e 6720 626f   the bounding bo
+0000d750: 780a 2020 2020 2020 2020 6220 3d20 7365  x.        b = se
+0000d760: 6c66 2e62 626f 7820 2b20 2828 2d70 6164  lf.bbox + ((-pad
+0000d770: 6469 6e67 2c20 2d70 6164 6469 6e67 292c  ding, -padding),
+0000d780: 2028 7061 6464 696e 672c 2070 6164 6469   (padding, paddi
+0000d790: 6e67 2929 0a20 2020 2020 2020 2062 203d  ng)).        b =
+0000d7a0: 206e 702e 6172 7261 7928 622e 666c 6174   np.array(b.flat
+0000d7b0: 290a 2020 2020 2020 2020 6365 6e74 6572  ).        center
+0000d7c0: 203d 206e 702e 6172 7261 7928 286e 702e   = np.array((np.
+0000d7d0: 7375 6d28 625b 3a3a 325d 2920 2f20 322c  sum(b[::2]) / 2,
+0000d7e0: 206e 702e 7375 6d28 625b 313a 3a32 5d29   np.sum(b[1::2])
+0000d7f0: 202f 2032 2929 0a20 2020 2020 2020 2073   / 2)).        s
+0000d800: 697a 6520 3d20 6e70 2e61 7272 6179 2828  ize = np.array((
+0000d810: 6e70 2e61 6273 2862 5b32 5d20 2d20 625b  np.abs(b[2] - b[
+0000d820: 305d 292c 206e 702e 6162 7328 625b 335d  0]), np.abs(b[3]
+0000d830: 202d 2062 5b31 5d29 2929 0a20 2020 2020   - b[1]))).     
+0000d840: 2020 2064 7820 3d20 6e70 2e61 7272 6179     dx = np.array
+0000d850: 280a 2020 2020 2020 2020 2020 2020 280a  (.            (.
+0000d860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d870: 6e70 2e6d 6178 696d 756d 286d 696e 5f61  np.maximum(min_a
+0000d880: 7370 6563 7420 2a20 7369 7a65 5b31 5d2c  spect * size[1],
+0000d890: 2073 697a 655b 305d 2920 2f20 322c 0a20   size[0]) / 2,. 
+0000d8a0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0000d8b0: 702e 6d61 7869 6d75 6d28 7369 7a65 5b31  p.maximum(size[1
+0000d8c0: 5d2c 206d 696e 5f61 7370 6563 7420 2a20  ], min_aspect * 
+0000d8d0: 7369 7a65 5b30 5d29 202f 2032 2c0a 2020  size[0]) / 2,.  
+0000d8e0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000d8f0: 2020 2020 290a 2020 2020 2020 2020 6220      ).        b 
+0000d900: 3d20 6e70 2e68 7374 6163 6b28 2863 656e  = np.hstack((cen
+0000d910: 7465 7220 2d20 6478 2c20 6365 6e74 6572  ter - dx, center
+0000d920: 202b 2064 7829 290a 0a20 2020 2020 2020   + dx))..       
+0000d930: 2070 6c6f 7473 5f74 6f5f 6f76 6572 6c61   plots_to_overla
+0000d940: 7920 3d20 5b5d 0a20 2020 2020 2020 206c  y = [].        l
+0000d950: 6179 6572 735f 6578 636c 7564 6564 203d  ayers_excluded =
+0000d960: 205b 5d20 6966 206c 6179 6572 735f 6578   [] if layers_ex
+0000d970: 636c 7564 6564 2069 7320 4e6f 6e65 2065  cluded is None e
+0000d980: 6c73 6520 6c61 7965 7273 5f65 7863 6c75  lse layers_exclu
+0000d990: 6465 640a 0a20 2020 2020 2020 2066 6f72  ded..        for
+0000d9a0: 206c 6179 6572 2c20 706f 6c79 676f 6e20   layer, polygon 
+0000d9b0: 696e 2073 656c 662e 6765 745f 706f 6c79  in self.get_poly
+0000d9c0: 676f 6e73 2862 795f 7370 6563 3d54 7275  gons(by_spec=Tru
+0000d9d0: 6529 2e69 7465 6d73 2829 3a0a 2020 2020  e).items():.    
+0000d9e0: 2020 2020 2020 2020 6966 206c 6179 6572          if layer
+0000d9f0: 2069 6e20 6c61 7965 7273 5f65 7863 6c75   in layers_exclu
+0000da00: 6465 643a 0a20 2020 2020 2020 2020 2020  ded:.           
+0000da10: 2020 2020 2063 6f6e 7469 6e75 650a 0a20       continue.. 
+0000da20: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+0000da30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000da40: 6c61 7965 725f 7669 6577 203d 206c 6179  layer_view = lay
+0000da50: 6572 5f76 6965 7773 2e67 6574 5f66 726f  er_views.get_fro
+0000da60: 6d5f 7475 706c 6528 6c61 7965 7229 0a20  m_tuple(layer). 
+0000da70: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0000da80: 7420 5661 6c75 6545 7272 6f72 3a0a 2020  t ValueError:.  
+0000da90: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+0000daa0: 7965 7273 203d 206c 6973 7428 6c61 7965  yers = list(laye
+0000dab0: 725f 7669 6577 732e 6765 745f 6c61 7965  r_views.get_laye
+0000dac0: 725f 7669 6577 7328 292e 6b65 7973 2829  r_views().keys()
+0000dad0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000dae0: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
+0000daf0: 6622 7b6c 6179 6572 2172 7d20 6e6f 7420  f"{layer!r} not 
+0000db00: 6465 6669 6e65 6420 696e 207b 6c61 7965  defined in {laye
+0000db10: 7273 7d22 2c20 7374 6163 6b6c 6576 656c  rs}", stacklevel
+0000db20: 3d33 290a 2020 2020 2020 2020 2020 2020  =3).            
+0000db30: 2020 2020 6c61 7965 725f 7669 6577 203d      layer_view =
+0000db40: 204c 6179 6572 5669 6577 286c 6179 6572   LayerView(layer
+0000db50: 3d6c 6179 6572 290a 2020 2020 2020 2020  =layer).        
+0000db60: 2020 2020 2320 544f 444f 3a20 4d61 7463      # TODO: Matc
+0000db70: 6820 7570 206f 7074 696f 6e73 2077 6974  h up options wit
+0000db80: 6820 4c61 7965 7256 6965 7773 0a20 2020  h LayerViews.   
+0000db90: 2020 2020 2020 2020 2070 6c6f 7473 5f74           plots_t
+0000dba0: 6f5f 6f76 6572 6c61 792e 6170 7065 6e64  o_overlay.append
+0000dbb0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000dbc0: 2020 6876 2e50 6f6c 7967 6f6e 7328 706f    hv.Polygons(po
+0000dbd0: 6c79 676f 6e2c 206c 6162 656c 3d73 7472  lygon, label=str
+0000dbe0: 286c 6179 6572 5f76 6965 772e 6e61 6d65  (layer_view.name
+0000dbf0: 2929 2e6f 7074 7328 0a20 2020 2020 2020  )).opts(.       
+0000dc00: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0000dc10: 615f 6173 7065 6374 3d31 2c0a 2020 2020  a_aspect=1,.    
+0000dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc30: 6672 616d 655f 7769 6474 683d 3530 302c  frame_width=500,
+0000dc40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dc50: 2020 2020 2079 6c69 6d3d 2862 5b31 5d2c       ylim=(b[1],
+0000dc60: 2062 5b33 5d29 2c0a 2020 2020 2020 2020   b[3]),.        
+0000dc70: 2020 2020 2020 2020 2020 2020 786c 696d              xlim
+0000dc80: 3d28 625b 305d 2c20 625b 325d 292c 0a20  =(b[0], b[2]),. 
+0000dc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dca0: 2020 2066 696c 6c5f 636f 6c6f 723d 6c61     fill_color=la
+0000dcb0: 7965 725f 7669 6577 2e66 696c 6c5f 636f  yer_view.fill_co
+0000dcc0: 6c6f 722e 6173 5f72 6762 2829 206f 7220  lor.as_rgb() or 
+0000dcd0: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
+0000dce0: 2020 2020 2020 2020 6c69 6e65 5f63 6f6c          line_col
+0000dcf0: 6f72 3d6c 6179 6572 5f76 6965 772e 6672  or=layer_view.fr
+0000dd00: 616d 655f 636f 6c6f 722e 6173 5f72 6762  ame_color.as_rgb
+0000dd10: 2829 206f 7220 2222 2c0a 2020 2020 2020  () or "",.      
+0000dd20: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000dd30: 6c6c 5f61 6c70 6861 3d6c 6179 6572 5f76  ll_alpha=layer_v
+0000dd40: 6965 772e 6765 745f 616c 7068 6128 2920  iew.get_alpha() 
+0000dd50: 6f72 2022 222c 0a20 2020 2020 2020 2020  or "",.         
+0000dd60: 2020 2020 2020 2020 2020 206c 696e 655f             line_
+0000dd70: 616c 7068 613d 6c61 7965 725f 7669 6577  alpha=layer_view
+0000dd80: 2e67 6574 5f61 6c70 6861 2829 206f 7220  .get_alpha() or 
+0000dd90: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
+0000dda0: 2020 2020 2020 2020 746f 6f6c 733d 5b22          tools=["
+0000ddb0: 686f 7665 7222 5d2c 0a20 2020 2020 2020  hover"],.       
+0000ddc0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000ddd0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000dde0: 2066 6f72 206e 616d 652c 2070 6f72 7420   for name, port 
+0000ddf0: 696e 2073 656c 662e 706f 7274 732e 6974  in self.ports.it
+0000de00: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+0000de10: 2020 206e 616d 6520 3d20 7374 7228 6e61     name = str(na
+0000de20: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+0000de30: 706f 6c79 676f 6e2c 2070 7469 7020 3d20  polygon, ptip = 
+0000de40: 6765 745f 7069 6e5f 7472 6961 6e67 6c65  get_pin_triangle
+0000de50: 5f70 6f6c 7967 6f6e 5f74 6970 2870 6f72  _polygon_tip(por
+0000de60: 743d 706f 7274 290a 0a20 2020 2020 2020  t=port)..       
+0000de70: 2020 2020 2070 6c6f 7473 5f74 6f5f 6f76       plots_to_ov
+0000de80: 6572 6c61 792e 6170 7065 6e64 280a 2020  erlay.append(.  
+0000de90: 2020 2020 2020 2020 2020 2020 2020 6876                hv
+0000dea0: 2e50 6f6c 7967 6f6e 7328 706f 6c79 676f  .Polygons(polygo
+0000deb0: 6e2c 206c 6162 656c 3d6e 616d 6529 2e6f  n, label=name).o
+0000dec0: 7074 7328 0a20 2020 2020 2020 2020 2020  pts(.           
+0000ded0: 2020 2020 2020 2020 2064 6174 615f 6173           data_as
+0000dee0: 7065 6374 3d31 2c0a 2020 2020 2020 2020  pect=1,.        
+0000def0: 2020 2020 2020 2020 2020 2020 6672 616d              fram
+0000df00: 655f 7769 6474 683d 3530 302c 0a20 2020  e_width=500,.   
+0000df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df20: 2066 696c 6c5f 616c 7068 613d 302c 0a20   fill_alpha=0,. 
+0000df30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df40: 2020 2079 6c69 6d3d 2862 5b31 5d2c 2062     ylim=(b[1], b
+0000df50: 5b33 5d29 2c0a 2020 2020 2020 2020 2020  [3]),.          
+0000df60: 2020 2020 2020 2020 2020 786c 696d 3d28            xlim=(
+0000df70: 625b 305d 2c20 625b 325d 292c 0a20 2020  b[0], b[2]),.   
+0000df80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df90: 2063 6f6c 6f72 3d22 7265 6422 2c0a 2020   color="red",.  
+0000dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfb0: 2020 6c69 6e65 5f61 6c70 6861 3d6c 6179    line_alpha=lay
+0000dfc0: 6572 5f76 6965 772e 6765 745f 616c 7068  er_view.get_alph
+0000dfd0: 6128 2920 6f72 2022 222c 0a20 2020 2020  a() or "",.     
+0000dfe0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000dff0: 6f6f 6c73 3d5b 2268 6f76 6572 225d 2c0a  ools=["hover"],.
+0000e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e010: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000e020: 2020 2a20 6876 2e54 6578 7428 7074 6970    * hv.Text(ptip
+0000e030: 5b30 5d2c 2070 7469 705b 315d 2c20 6e61  [0], ptip[1], na
+0000e040: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+0000e050: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0000e060: 6e20 6876 2e4f 7665 726c 6179 2870 6c6f  n hv.Overlay(plo
+0000e070: 7473 5f74 6f5f 6f76 6572 6c61 7929 2e6f  ts_to_overlay).o
+0000e080: 7074 7328 0a20 2020 2020 2020 2020 2020  pts(.           
+0000e090: 2073 686f 775f 6c65 6765 6e64 3d54 7275   show_legend=Tru
+0000e0a0: 652c 2073 6861 7265 645f 6178 6573 3d46  e, shared_axes=F
+0000e0b0: 616c 7365 2c20 796c 696d 3d28 625b 315d  alse, ylim=(b[1]
+0000e0c0: 2c20 625b 335d 292c 2078 6c69 6d3d 2862  , b[3]), xlim=(b
+0000e0d0: 5b30 5d2c 2062 5b32 5d29 0a20 2020 2020  [0], b[2]).     
+0000e0e0: 2020 2029 0a0a 2020 2020 6465 6620 7368     )..    def sh
+0000e0f0: 6f77 280a 2020 2020 2020 2020 7365 6c66  ow(.        self
+0000e100: 2c0a 2020 2020 2020 2020 7368 6f77 5f70  ,.        show_p
+0000e110: 6f72 7473 3a20 626f 6f6c 203d 2046 616c  orts: bool = Fal
+0000e120: 7365 2c0a 2020 2020 2020 2020 7368 6f77  se,.        show
+0000e130: 5f73 7562 706f 7274 733a 2062 6f6f 6c20  _subports: bool 
+0000e140: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+0000e150: 2070 6f72 745f 6d61 726b 6572 5f6c 6179   port_marker_lay
+0000e160: 6572 3a20 4c61 7965 7220 3d20 2831 2c20  er: Layer = (1, 
+0000e170: 3130 292c 0a20 2020 2020 2020 202a 2a6b  10),.        **k
+0000e180: 7761 7267 732c 0a20 2020 2029 202d 3e20  wargs,.    ) -> 
+0000e190: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+0000e1a0: 2253 686f 7720 636f 6d70 6f6e 656e 7420  "Show component 
+0000e1b0: 696e 204b 4c61 796f 7574 2e0a 0a20 2020  in KLayout...   
+0000e1c0: 2020 2020 2072 6574 7572 6e73 2061 2063       returns a c
+0000e1d0: 6f70 7920 6f66 2074 6865 2043 6f6d 706f  opy of the Compo
+0000e1e0: 6e65 6e74 2c20 736f 2074 6865 206f 7269  nent, so the ori
+0000e1f0: 6769 6e61 6c20 636f 6d70 6f6e 656e 7420  ginal component 
+0000e200: 7265 6d61 696e 7320 696e 7461 6374 2e0a  remains intact..
+0000e210: 2020 2020 2020 2020 7769 7468 2070 696e          with pin
+0000e220: 7320 6d61 726b 6572 7320 6f6e 2065 6163  s markers on eac
+0000e230: 6820 706f 7274 2073 686f 775f 706f 7274  h port show_port
+0000e240: 7320 3d20 5472 7565 2c20 616e 6420 6f70  s = True, and op
+0000e250: 7469 6f6e 616c 6c79 2061 6c73 6f0a 2020  tionally also.  
+0000e260: 2020 2020 2020 7468 6520 706f 7274 7320        the ports 
+0000e270: 6672 6f6d 2074 6865 2072 6566 6572 656e  from the referen
+0000e280: 6365 7320 2873 686f 775f 7375 6270 6f72  ces (show_subpor
+0000e290: 7473 3d54 7275 6529 0a0a 2020 2020 2020  ts=True)..      
+0000e2a0: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+0000e2b0: 2020 2020 7368 6f77 5f70 6f72 7473 3a20      show_ports: 
+0000e2c0: 7368 6f77 7320 636f 6d70 6f6e 656e 7420  shows component 
+0000e2d0: 7769 7468 2070 6f72 7420 6d61 726b 6572  with port marker
+0000e2e0: 7320 616e 6420 6c61 6265 6c73 2e0a 2020  s and labels..  
+0000e2f0: 2020 2020 2020 2020 2020 7368 6f77 5f73            show_s
+0000e300: 7562 706f 7274 733a 2061 6464 2070 6f72  ubports: add por
+0000e310: 7473 206d 6172 6b65 7273 2061 6e64 206c  ts markers and l
+0000e320: 6162 656c 7320 746f 2072 6566 6572 656e  abels to referen
+0000e330: 6365 732e 0a20 2020 2020 2020 2020 2020  ces..           
+0000e340: 2070 6f72 745f 6d61 726b 6572 5f6c 6179   port_marker_lay
+0000e350: 6572 3a20 666f 7220 7468 6520 706f 7274  er: for the port
+0000e360: 732e 0a0a 2020 2020 2020 2020 4b65 7977  s...        Keyw
+0000e370: 6f72 6420 4172 6773 3a0a 2020 2020 2020  ord Args:.      
+0000e380: 2020 2020 2020 6764 7370 6174 683a 2047        gdspath: G
+0000e390: 4453 2066 696c 6520 7061 7468 2074 6f20  DS file path to 
+0000e3a0: 7772 6974 6520 746f 2e0a 2020 2020 2020  write to..      
+0000e3b0: 2020 2020 2020 6764 7364 6972 3a20 6469        gdsdir: di
+0000e3c0: 7265 6374 6f72 7920 666f 7220 7468 6520  rectory for the 
+0000e3d0: 4744 5320 6669 6c65 2e20 4465 6661 756c  GDS file. Defaul
+0000e3e0: 7473 2074 6f20 2f74 6d70 2f2e 0a20 2020  ts to /tmp/..   
+0000e3f0: 2020 2020 2020 2020 2075 6e69 743a 2075           unit: u
+0000e400: 6e69 7420 7369 7a65 2066 6f72 206f 626a  nit size for obj
+0000e410: 6563 7473 2069 6e20 6c69 6272 6172 792e  ects in library.
+0000e420: 2031 756d 2062 7920 6465 6661 756c 742e   1um by default.
+0000e430: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
+0000e440: 6369 7369 6f6e 3a20 666f 7220 6f62 6a65  cision: for obje
+0000e450: 6374 2064 696d 656e 7369 6f6e 7320 696e  ct dimensions in
+0000e460: 2074 6865 206c 6962 7261 7279 2028 6d29   the library (m)
+0000e470: 2e20 316e 6d20 6279 2064 6566 6175 6c74  . 1nm by default
+0000e480: 2e0a 2020 2020 2020 2020 2020 2020 7469  ..            ti
+0000e490: 6d65 7374 616d 703a 2044 6566 6175 6c74  mestamp: Default
+0000e4a0: 7320 746f 2032 3031 392d 3130 2d32 352e  s to 2019-10-25.
+0000e4b0: 2049 6620 4e6f 6e65 2075 7365 7320 6375   If None uses cu
+0000e4c0: 7272 656e 7420 7469 6d65 2e0a 2020 2020  rrent time..    
+0000e4d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000e4e0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+0000e4f0: 6164 645f 7069 6e73 2069 6d70 6f72 7420  add_pins import 
+0000e500: 6164 645f 7069 6e73 5f74 7269 616e 676c  add_pins_triangl
+0000e510: 650a 2020 2020 2020 2020 6672 6f6d 2067  e.        from g
+0000e520: 6473 6661 6374 6f72 792e 7368 6f77 2069  dsfactory.show i
+0000e530: 6d70 6f72 7420 7368 6f77 0a0a 2020 2020  mport show..    
+0000e540: 2020 2020 636f 6d70 6f6e 656e 7420 3d20      component = 
+0000e550: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+0000e560: 6c66 2e61 6464 5f70 696e 735f 7472 6961  lf.add_pins_tria
+0000e570: 6e67 6c65 2870 6f72 745f 6d61 726b 6572  ngle(port_marker
+0000e580: 5f6c 6179 6572 3d70 6f72 745f 6d61 726b  _layer=port_mark
+0000e590: 6572 5f6c 6179 6572 290a 2020 2020 2020  er_layer).      
+0000e5a0: 2020 2020 2020 6966 2073 686f 775f 706f        if show_po
+0000e5b0: 7274 730a 2020 2020 2020 2020 2020 2020  rts.            
+0000e5c0: 656c 7365 2073 656c 660a 2020 2020 2020  else self.      
+0000e5d0: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
+0000e5e0: 7368 6f77 5f73 7562 706f 7274 733a 0a20  show_subports:. 
+0000e5f0: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
+0000e600: 6e65 6e74 203d 2073 656c 662e 636f 7079  nent = self.copy
+0000e610: 2829 0a20 2020 2020 2020 2020 2020 2063  ().            c
+0000e620: 6f6d 706f 6e65 6e74 2e6e 616d 6520 3d20  omponent.name = 
+0000e630: 7365 6c66 2e6e 616d 650a 2020 2020 2020  self.name.      
+0000e640: 2020 2020 2020 666f 7220 7265 6665 7265        for refere
+0000e650: 6e63 6520 696e 2063 6f6d 706f 6e65 6e74  nce in component
+0000e660: 2e72 6566 6572 656e 6365 733a 0a20 2020  .references:.   
+0000e670: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000e680: 6973 696e 7374 616e 6365 2863 6f6d 706f  isinstance(compo
+0000e690: 6e65 6e74 2c20 436f 6d70 6f6e 656e 7452  nent, ComponentR
+0000e6a0: 6566 6572 656e 6365 293a 0a20 2020 2020  eference):.     
+0000e6b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000e6c0: 6464 5f70 696e 735f 7472 6961 6e67 6c65  dd_pins_triangle
+0000e6d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000e6e0: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
+0000e6f0: 656e 743d 636f 6d70 6f6e 656e 742c 0a20  ent=component,. 
+0000e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e710: 2020 2020 2020 2072 6566 6572 656e 6365         reference
+0000e720: 3d72 6566 6572 656e 6365 2c0a 2020 2020  =reference,.    
+0000e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e740: 2020 2020 6c61 7965 723d 706f 7274 5f6d      layer=port_m
+0000e750: 6172 6b65 725f 6c61 7965 722c 0a20 2020  arker_layer,.   
+0000e760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e770: 2029 0a0a 2020 2020 2020 2020 7368 6f77   )..        show
+0000e780: 2863 6f6d 706f 6e65 6e74 2c20 2a2a 6b77  (component, **kw
+0000e790: 6172 6773 290a 0a20 2020 2064 6566 205f  args)..    def _
+0000e7a0: 7772 6974 655f 6c69 6272 6172 7928 0a20  write_library(. 
+0000e7b0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0000e7c0: 2020 2020 2067 6473 7061 7468 3a20 4f70       gdspath: Op
+0000e7d0: 7469 6f6e 616c 5b50 6174 6854 7970 655d  tional[PathType]
+0000e7e0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0000e7f0: 2067 6473 6469 723a 204f 7074 696f 6e61   gdsdir: Optiona
+0000e800: 6c5b 5061 7468 5479 7065 5d20 3d20 4e6f  l[PathType] = No
+0000e810: 6e65 2c0a 2020 2020 2020 2020 7469 6d65  ne,.        time
+0000e820: 7374 616d 703a 204f 7074 696f 6e61 6c5b  stamp: Optional[
+0000e830: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
+0000e840: 655d 203d 205f 7469 6d65 7374 616d 7032  e] = _timestamp2
+0000e850: 3031 392c 0a20 2020 2020 2020 206c 6f67  019,.        log
+0000e860: 6769 6e67 3a20 626f 6f6c 203d 2054 7275  ging: bool = Tru
+0000e870: 652c 0a20 2020 2020 2020 2077 6974 685f  e,.        with_
+0000e880: 6f61 7369 733a 2062 6f6f 6c20 3d20 4661  oasis: bool = Fa
+0000e890: 6c73 652c 0a20 2020 2020 2020 202a 2a6b  lse,.        **k
+0000e8a0: 7761 7267 732c 0a20 2020 2029 202d 3e20  wargs,.    ) -> 
+0000e8b0: 5061 7468 3a0a 2020 2020 2020 2020 2222  Path:.        ""
+0000e8c0: 2257 7269 7465 2063 6f6d 706f 6e65 6e74  "Write component
+0000e8d0: 2074 6f20 4744 5320 6f72 204f 4153 4953   to GDS or OASIS
+0000e8e0: 2061 6e64 2072 6574 7572 6e73 2067 6473   and returns gds
+0000e8f0: 7061 7468 2e0a 0a20 2020 2020 2020 2041  path...        A
+0000e900: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+0000e910: 2067 6473 7061 7468 3a20 4744 5320 6669   gdspath: GDS fi
+0000e920: 6c65 2070 6174 6820 746f 2077 7269 7465  le path to write
+0000e930: 2074 6f2e 0a20 2020 2020 2020 2020 2020   to..           
+0000e940: 2067 6473 6469 723a 2064 6972 6563 746f   gdsdir: directo
+0000e950: 7279 2066 6f72 2074 6865 2047 4453 2066  ry for the GDS f
+0000e960: 696c 652e 2044 6566 6175 6c74 7320 746f  ile. Defaults to
+0000e970: 202f 746d 702f 7261 6e64 6f6d 4669 6c65   /tmp/randomFile
+0000e980: 2f67 6473 6661 6374 6f72 792e 0a20 2020  /gdsfactory..   
+0000e990: 2020 2020 2020 2020 2074 696d 6573 7461           timesta
+0000e9a0: 6d70 3a20 4465 6661 756c 7473 2074 6f20  mp: Defaults to 
+0000e9b0: 3230 3139 2d31 302d 3235 2066 6f72 2063  2019-10-25 for c
+0000e9c0: 6f6e 7369 7374 656e 7420 6861 7368 2e0a  onsistent hash..
+0000e9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9e0: 4966 204e 6f6e 6520 7573 6573 2063 7572  If None uses cur
+0000e9f0: 7265 6e74 2074 696d 652e 0a20 2020 2020  rent time..     
+0000ea00: 2020 2020 2020 206c 6f67 6769 6e67 3a20         logging: 
+0000ea10: 6469 7361 626c 6520 4744 5320 7061 7468  disable GDS path
+0000ea20: 206c 6f67 6769 6e67 2c20 666f 7220 6578   logging, for ex
+0000ea30: 616d 706c 6520 666f 7220 7368 6f77 696e  ample for showin
+0000ea40: 6720 6974 2069 6e20 4b4c 6179 6f75 742e  g it in KLayout.
+0000ea50: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+0000ea60: 685f 6f61 7369 733a 2049 6620 5472 7565  h_oasis: If True
+0000ea70: 2c20 6669 6c65 2077 696c 6c20 6265 2077  , file will be w
+0000ea80: 7269 7474 656e 2074 6f20 4f41 5349 532e  ritten to OASIS.
+0000ea90: 204f 7468 6572 7769 7365 2c20 6669 6c65   Otherwise, file
+0000eaa0: 2077 696c 6c20 6265 2077 7269 7474 656e   will be written
+0000eab0: 2074 6f20 4744 532e 0a0a 2020 2020 2020   to GDS...      
+0000eac0: 2020 4b65 7977 6f72 6420 4172 6773 3a0a    Keyword Args:.
+0000ead0: 2020 2020 2020 2020 2020 2020 4b65 7977              Keyw
+0000eae0: 6f72 6420 6172 6775 6d65 6e74 7320 7769  ord arguments wi
+0000eaf0: 6c6c 206f 7665 7272 6964 6520 7468 6520  ll override the 
+0000eb00: 6163 7469 7665 2050 444b 2773 2064 6566  active PDK's def
+0000eb10: 6175 6c74 2047 6473 5772 6974 6553 6574  ault GdsWriteSet
+0000eb20: 7469 6e67 7320 616e 6420 4f61 7369 7357  tings and OasisW
+0000eb30: 7269 7465 5365 7474 696e 6773 2e0a 0a20  riteSettings... 
+0000eb40: 2020 2020 2020 2020 2020 2047 6473 2073             Gds s
+0000eb50: 6574 7469 6e67 733a 0a20 2020 2020 2020  ettings:.       
+0000eb60: 2020 2020 2020 2020 2075 6e69 743a 2075           unit: u
+0000eb70: 6e69 7420 7369 7a65 2066 6f72 206f 626a  nit size for obj
+0000eb80: 6563 7473 2069 6e20 6c69 6272 6172 792e  ects in library.
+0000eb90: 2031 756d 2062 7920 6465 6661 756c 742e   1um by default.
+0000eba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ebb0: 2070 7265 6369 7369 6f6e 3a20 666f 7220   precision: for 
+0000ebc0: 6469 6d65 6e73 696f 6e73 2069 6e20 7468  dimensions in th
+0000ebd0: 6520 6c69 6272 6172 7920 286d 292e 2031  e library (m). 1
+0000ebe0: 6e6d 2062 7920 6465 6661 756c 742e 0a20  nm by default.. 
+0000ebf0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0000ec00: 6e5f 6475 706c 6963 6174 655f 6365 6c6c  n_duplicate_cell
+0000ec10: 3a20 7370 6563 6966 7920 686f 7720 746f  : specify how to
+0000ec20: 2072 6573 6f6c 7665 2064 7570 6c69 6361   resolve duplica
+0000ec30: 7465 2d6e 616d 6564 2063 656c 6c73 2e20  te-named cells. 
+0000ec40: 4368 6f6f 7365 206f 6e65 206f 6620 7468  Choose one of th
+0000ec50: 6520 666f 6c6c 6f77 696e 673a 0a20 2020  e following:.   
+0000ec60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec70: 2022 7761 726e 2220 2864 6566 6175 6c74   "warn" (default
+0000ec80: 293a 206f 7665 7277 7269 7465 2061 6c6c  ): overwrite all
+0000ec90: 2064 7570 6c69 6361 7465 2063 656c 6c73   duplicate cells
+0000eca0: 2077 6974 6820 6f6e 6520 6f66 2074 6865   with one of the
+0000ecb0: 2064 7570 6c69 6361 7465 7320 2861 7262   duplicates (arb
+0000ecc0: 6974 7261 7269 6c79 292e 0a20 2020 2020  itrarily)..     
+0000ecd0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000ece0: 6572 726f 7222 3a20 7468 726f 7720 6120  error": throw a 
+0000ecf0: 5661 6c75 6545 7272 6f72 2077 6865 6e20  ValueError when 
+0000ed00: 6174 7465 6d70 7469 6e67 2074 6f20 7772  attempting to wr
+0000ed10: 6974 6520 6120 6764 7320 7769 7468 2064  ite a gds with d
+0000ed20: 7570 6c69 6361 7465 2063 656c 6c73 2e0a  uplicate cells..
+0000ed30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed40: 2020 2020 226f 7665 7277 7269 7465 223a      "overwrite":
+0000ed50: 206f 7665 7277 7269 7465 2061 6c6c 2064   overwrite all d
+0000ed60: 7570 6c69 6361 7465 2063 656c 6c73 2077  uplicate cells w
+0000ed70: 6974 6820 6f6e 6520 6f66 2074 6865 2064  ith one of the d
+0000ed80: 7570 6c69 6361 7465 732c 2077 6974 686f  uplicates, witho
+0000ed90: 7574 2077 6172 6e69 6e67 2e0a 2020 2020  ut warning..    
+0000eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edb0: 4e6f 6e65 3a20 646f 206e 6f74 2074 7279  None: do not try
+0000edc0: 2074 6f20 7265 736f 6c76 6520 2861 7420   to resolve (at 
+0000edd0: 796f 7572 206f 776e 2072 6973 6b21 290a  your own risk!).
+0000ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edf0: 666c 6174 7465 6e5f 696e 7661 6c69 645f  flatten_invalid_
+0000ee00: 7265 6673 3a20 666c 6174 7465 6e73 2063  refs: flattens c
+0000ee10: 6f6d 706f 6e65 6e74 2072 6566 6572 656e  omponent referen
+0000ee20: 6365 7320 7768 6963 6820 6861 7665 2069  ces which have i
+0000ee30: 6e76 616c 6964 2074 7261 6e73 666f 726d  nvalid transform
+0000ee40: 6174 696f 6e73 2e0a 2020 2020 2020 2020  ations..        
+0000ee50: 2020 2020 2020 2020 6d61 785f 706f 696e          max_poin
+0000ee60: 7473 3a20 4d61 7869 6d61 6c20 6e75 6d62  ts: Maximal numb
+0000ee70: 6572 206f 6620 7665 7274 6963 6573 2070  er of vertices p
+0000ee80: 6572 2070 6f6c 7967 6f6e 2e20 506f 6c79  er polygon. Poly
+0000ee90: 676f 6e73 2077 6974 6820 6d6f 7265 2076  gons with more v
+0000eea0: 6572 7469 6365 7320 7468 6174 2074 6869  ertices that thi
+0000eeb0: 7320 6172 6520 6175 746f 6d61 7469 6361  s are automatica
+0000eec0: 6c6c 7920 6672 6163 7475 7265 642e 0a0a  lly fractured...
+0000eed0: 2020 2020 2020 2020 2020 2020 4f61 7369              Oasi
+0000eee0: 7320 7365 7474 696e 6773 3a0a 2020 2020  s settings:.    
+0000eef0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+0000ef00: 7265 7373 696f 6e5f 6c65 7665 6c3a 204c  ression_level: L
+0000ef10: 6576 656c 206f 6620 636f 6d70 7265 7373  evel of compress
+0000ef20: 696f 6e20 666f 7220 6365 6c6c 7320 2862  ion for cells (b
+0000ef30: 6574 7765 656e 2030 2061 6e64 2039 292e  etween 0 and 9).
+0000ef40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ef50: 2020 2020 2053 6574 7469 6e67 2074 6f20       Setting to 
+0000ef60: 3020 7769 6c6c 2064 6973 6162 6c65 2063  0 will disable c
+0000ef70: 656c 6c20 636f 6d70 7265 7373 696f 6e2c  ell compression,
+0000ef80: 2031 2067 6976 6573 2074 6865 2062 6573   1 gives the bes
+0000ef90: 7420 7370 6565 6420 616e 6420 392c 2074  t speed and 9, t
+0000efa0: 6865 2062 6573 7420 636f 6d70 7265 7373  he best compress
+0000efb0: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
+0000efc0: 2020 2020 2064 6574 6563 745f 7265 6374       detect_rect
+0000efd0: 616e 676c 6573 3a20 5374 6f72 6520 7265  angles: Store re
+0000efe0: 6374 616e 676c 6573 2069 6e20 636f 6d70  ctangles in comp
+0000eff0: 7265 7373 6564 2066 6f72 6d61 742e 0a20  ressed format.. 
+0000f000: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000f010: 6574 6563 745f 7472 6170 657a 6f69 6473  etect_trapezoids
+0000f020: 3a20 5374 6f72 6520 7472 6170 657a 6f69  : Store trapezoi
+0000f030: 6473 2069 6e20 636f 6d70 7265 7373 6564  ds in compressed
+0000f040: 2066 6f72 6d61 742e 0a20 2020 2020 2020   format..       
+0000f050: 2020 2020 2020 2020 2063 6972 636c 655f           circle_
+0000f060: 746f 6c65 7261 6e63 653a 2054 6f6c 6572  tolerance: Toler
+0000f070: 616e 6365 2066 6f72 2064 6574 6563 7469  ance for detecti
+0000f080: 6e67 2063 6972 636c 6573 2e20 4966 206c  ng circles. If l
+0000f090: 6573 7320 6f72 2065 7175 616c 2074 6f20  ess or equal to 
+0000f0a0: 302c 206e 6f20 6465 7465 6374 696f 6e20  0, no detection 
+0000f0b0: 6973 2070 6572 666f 726d 6564 2e20 4369  is performed. Ci
+0000f0c0: 7263 6c65 7320 6172 6520 7374 6f72 6564  rcles are stored
+0000f0d0: 2069 6e20 636f 6d70 7265 7373 6564 2066   in compressed f
+0000f0e0: 6f72 6d61 742e 0a20 2020 2020 2020 2020  ormat..         
+0000f0f0: 2020 2020 2020 2076 616c 6964 6174 696f         validatio
+0000f100: 6e20 2822 6372 6333 3222 2c20 2263 6865  n ("crc32", "che
+0000f110: 636b 7375 6d33 3222 2c20 4e6f 6e65 293a  cksum32", None):
+0000f120: 2074 7970 6520 6f66 2076 616c 6964 6174   type of validat
+0000f130: 696f 6e20 746f 2069 6e63 6c75 6465 2069  ion to include i
+0000f140: 6e20 7468 6520 7361 7665 6420 6669 6c65  n the saved file
+0000f150: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000f160: 2020 7374 616e 6461 7264 5f70 726f 7065    standard_prope
+0000f170: 7274 6965 733a 2053 746f 7265 2073 7461  rties: Store sta
+0000f180: 6e64 6172 6420 4f41 5349 5320 7072 6f70  ndard OASIS prop
+0000f190: 6572 7469 6573 2069 6e20 7468 6520 6669  erties in the fi
+0000f1a0: 6c65 2e0a 0a20 2020 2020 2020 2022 2222  le...        """
+0000f1b0: 0a0a 2020 2020 2020 2020 6672 6f6d 2067  ..        from g
+0000f1c0: 6473 6661 6374 6f72 792e 7064 6b20 696d  dsfactory.pdk im
+0000f1d0: 706f 7274 2067 6574 5f61 6374 6976 655f  port get_active_
+0000f1e0: 7064 6b0a 0a20 2020 2020 2020 2069 6620  pdk..        if 
+0000f1f0: 6764 7370 6174 6820 616e 6420 6764 7364  gdspath and gdsd
+0000f200: 6972 3a0a 2020 2020 2020 2020 2020 2020  ir:.            
+0000f210: 7761 726e 696e 6773 2e77 6172 6e28 0a20  warnings.warn(. 
+0000f220: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000f230: 6764 7370 6174 6820 616e 6420 6764 7364  gdspath and gdsd
+0000f240: 6972 2068 6176 6520 626f 7468 2062 6565  ir have both bee
+0000f250: 6e20 7370 6563 6966 6965 642e 2067 6473  n specified. gds
+0000f260: 7061 7468 2077 696c 6c20 7461 6b65 2070  path will take p
+0000f270: 7265 6365 6465 6e63 6520 616e 6420 6764  recedence and gd
+0000f280: 7364 6972 2077 696c 6c20 6265 2069 676e  sdir will be ign
+0000f290: 6f72 6564 2e22 2c0a 2020 2020 2020 2020  ored.",.        
+0000f2a0: 2020 2020 2020 2020 7374 6163 6b6c 6576          stacklev
+0000f2b0: 656c 3d33 2c0a 2020 2020 2020 2020 2020  el=3,.          
+0000f2c0: 2020 290a 0a20 2020 2020 2020 2064 6566    )..        def
+0000f2d0: 6175 6c74 5f73 6574 7469 6e67 7320 3d20  ault_settings = 
+0000f2e0: 6765 745f 6163 7469 7665 5f70 646b 2829  get_active_pdk()
+0000f2f0: 2e67 6473 5f77 7269 7465 5f73 6574 7469  .gds_write_setti
+0000f300: 6e67 730a 2020 2020 2020 2020 6465 6661  ngs.        defa
+0000f310: 756c 745f 6f61 7369 735f 7365 7474 696e  ult_oasis_settin
+0000f320: 6773 203d 2067 6574 5f61 6374 6976 655f  gs = get_active_
+0000f330: 7064 6b28 292e 6f61 7369 735f 7365 7474  pdk().oasis_sett
+0000f340: 696e 6773 0a0a 2020 2020 2020 2020 6578  ings..        ex
+0000f350: 706c 6963 6974 5f67 6473 5f73 6574 7469  plicit_gds_setti
+0000f360: 6e67 7320 3d20 7b0a 2020 2020 2020 2020  ngs = {.        
+0000f370: 2020 2020 6b3a 2076 0a20 2020 2020 2020      k: v.       
+0000f380: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
+0000f390: 206b 7761 7267 732e 6974 656d 7328 290a   kwargs.items().
+0000f3a0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
+0000f3b0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+0000f3c0: 206b 2069 6e20 6465 6661 756c 745f 7365   k in default_se
+0000f3d0: 7474 696e 6773 2e64 6963 7428 290a 2020  ttings.dict().  
+0000f3e0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+0000f3f0: 6578 706c 6963 6974 5f6f 6173 5f73 6574  explicit_oas_set
+0000f400: 7469 6e67 7320 3d20 7b0a 2020 2020 2020  tings = {.      
+0000f410: 2020 2020 2020 6b3a 2076 0a20 2020 2020        k: v.     
+0000f420: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
+0000f430: 696e 206b 7761 7267 732e 6974 656d 7328  in kwargs.items(
+0000f440: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000f450: 2076 2069 7320 6e6f 7420 4e6f 6e65 2061   v is not None a
+0000f460: 6e64 206b 2069 6e20 6465 6661 756c 745f  nd k in default_
+0000f470: 6f61 7369 735f 7365 7474 696e 6773 2e64  oasis_settings.d
+0000f480: 6963 7428 290a 2020 2020 2020 2020 7d0a  ict().        }.
+0000f490: 2020 2020 2020 2020 2320 7570 6461 7465          # update
+0000f4a0: 2074 6865 2077 7269 7465 2073 6574 7469   the write setti
+0000f4b0: 6e67 7320 7769 7468 2061 6e79 2073 6574  ngs with any set
+0000f4c0: 7469 6e67 7320 6578 706c 6963 6974 6c79  tings explicitly
+0000f4d0: 2070 6173 7365 640a 2020 2020 2020 2020   passed.        
+0000f4e0: 7772 6974 655f 7365 7474 696e 6773 203d  write_settings =
+0000f4f0: 2064 6566 6175 6c74 5f73 6574 7469 6e67   default_setting
+0000f500: 732e 636f 7079 2875 7064 6174 653d 6578  s.copy(update=ex
+0000f510: 706c 6963 6974 5f67 6473 5f73 6574 7469  plicit_gds_setti
+0000f520: 6e67 7329 0a20 2020 2020 2020 206f 6173  ngs).        oas
+0000f530: 6973 5f73 6574 7469 6e67 7320 3d20 6465  is_settings = de
+0000f540: 6661 756c 745f 6f61 7369 735f 7365 7474  fault_oasis_sett
+0000f550: 696e 6773 2e63 6f70 7928 7570 6461 7465  ings.copy(update
+0000f560: 3d65 7870 6c69 6369 745f 6f61 735f 7365  =explicit_oas_se
+0000f570: 7474 696e 6773 290a 0a20 2020 2020 2020  ttings)..       
+0000f580: 205f 6368 6563 6b5f 756e 6361 6368 6564   _check_uncached
+0000f590: 5f63 6f6d 706f 6e65 6e74 7328 0a20 2020  _components(.   
+0000f5a0: 2020 2020 2020 2020 2063 6f6d 706f 6e65           compone
+0000f5b0: 6e74 3d73 656c 662c 206d 6f64 653d 7772  nt=self, mode=wr
+0000f5c0: 6974 655f 7365 7474 696e 6773 2e6f 6e5f  ite_settings.on_
+0000f5d0: 756e 6361 6368 6564 5f63 6f6d 706f 6e65  uncached_compone
+0000f5e0: 6e74 0a20 2020 2020 2020 2029 0a0a 2020  nt.        )..  
+0000f5f0: 2020 2020 2020 6966 2077 7269 7465 5f73        if write_s
+0000f600: 6574 7469 6e67 732e 666c 6174 7465 6e5f  ettings.flatten_
+0000f610: 696e 7661 6c69 645f 7265 6673 3a0a 2020  invalid_refs:.  
+0000f620: 2020 2020 2020 2020 2020 746f 705f 6365            top_ce
+0000f630: 6c6c 203d 2066 6c61 7474 656e 5f69 6e76  ll = flatten_inv
+0000f640: 616c 6964 5f72 6566 735f 7265 6375 7273  alid_refs_recurs
+0000f650: 6976 6528 7365 6c66 290a 2020 2020 2020  ive(self).      
+0000f660: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000f670: 2020 2020 746f 705f 6365 6c6c 203d 2073      top_cell = s
+0000f680: 656c 660a 0a20 2020 2020 2020 2067 6473  elf..        gds
+0000f690: 6469 7220 3d20 6764 7364 6972 206f 7220  dir = gdsdir or 
+0000f6a0: 4744 5344 4952 5f54 454d 500a 2020 2020  GDSDIR_TEMP.    
+0000f6b0: 2020 2020 6764 7364 6972 203d 2070 6174      gdsdir = pat
+0000f6c0: 686c 6962 2e50 6174 6828 6764 7364 6972  hlib.Path(gdsdir
+0000f6d0: 290a 2020 2020 2020 2020 6966 2077 6974  ).        if wit
+0000f6e0: 685f 6f61 7369 733a 0a20 2020 2020 2020  h_oasis:.       
+0000f6f0: 2020 2020 2067 6473 7061 7468 203d 2067       gdspath = g
+0000f700: 6473 7061 7468 206f 7220 6764 7364 6972  dspath or gdsdir
+0000f710: 202f 2066 227b 746f 705f 6365 6c6c 2e6e   / f"{top_cell.n
+0000f720: 616d 657d 2e6f 6173 220a 2020 2020 2020  ame}.oas".      
+0000f730: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000f740: 2020 2020 6764 7370 6174 6820 3d20 6764      gdspath = gd
+0000f750: 7370 6174 6820 6f72 2067 6473 6469 7220  spath or gdsdir 
+0000f760: 2f20 6622 7b74 6f70 5f63 656c 6c2e 6e61  / f"{top_cell.na
+0000f770: 6d65 7d2e 6764 7322 0a20 2020 2020 2020  me}.gds".       
+0000f780: 2067 6473 7061 7468 203d 2070 6174 686c   gdspath = pathl
+0000f790: 6962 2e50 6174 6828 6764 7370 6174 6829  ib.Path(gdspath)
+0000f7a0: 0a20 2020 2020 2020 2067 6473 6469 7220  .        gdsdir 
+0000f7b0: 3d20 6764 7370 6174 682e 7061 7265 6e74  = gdspath.parent
+0000f7c0: 0a20 2020 2020 2020 2067 6473 6469 722e  .        gdsdir.
+0000f7d0: 6d6b 6469 7228 6578 6973 745f 6f6b 3d54  mkdir(exist_ok=T
+0000f7e0: 7275 652c 2070 6172 656e 7473 3d54 7275  rue, parents=Tru
+0000f7f0: 6529 0a0a 2020 2020 2020 2020 6365 6c6c  e)..        cell
+0000f800: 7320 3d20 746f 705f 6365 6c6c 2e67 6574  s = top_cell.get
+0000f810: 5f64 6570 656e 6465 6e63 6965 7328 7265  _dependencies(re
+0000f820: 6375 7273 6976 653d 5472 7565 290a 2020  cursive=True).  
+0000f830: 2020 2020 2020 6365 6c6c 5f6e 616d 6573        cell_names
+0000f840: 203d 205b 6365 6c6c 2e6e 616d 6520 666f   = [cell.name fo
+0000f850: 7220 6365 6c6c 2069 6e20 6c69 7374 2863  r cell in list(c
+0000f860: 656c 6c73 295d 0a20 2020 2020 2020 2063  ells)].        c
+0000f870: 656c 6c5f 6e61 6d65 735f 756e 6971 7565  ell_names_unique
+0000f880: 203d 2073 6574 2863 656c 6c5f 6e61 6d65   = set(cell_name
+0000f890: 7329 0a0a 2020 2020 2020 2020 6966 206c  s)..        if l
+0000f8a0: 656e 2863 656c 6c5f 6e61 6d65 7329 2021  en(cell_names) !
+0000f8b0: 3d20 6c65 6e28 7365 7428 6365 6c6c 5f6e  = len(set(cell_n
+0000f8c0: 616d 6573 2929 3a0a 2020 2020 2020 2020  ames)):.        
+0000f8d0: 2020 2020 666f 7220 6365 6c6c 5f6e 616d      for cell_nam
+0000f8e0: 6520 696e 2063 656c 6c5f 6e61 6d65 735f  e in cell_names_
+0000f8f0: 756e 6971 7565 3a0a 2020 2020 2020 2020  unique:.        
+0000f900: 2020 2020 2020 2020 6365 6c6c 5f6e 616d          cell_nam
+0000f910: 6573 2e72 656d 6f76 6528 6365 6c6c 5f6e  es.remove(cell_n
+0000f920: 616d 6529 0a0a 2020 2020 2020 2020 2020  ame)..          
+0000f930: 2020 6966 2077 7269 7465 5f73 6574 7469    if write_setti
+0000f940: 6e67 732e 6f6e 5f64 7570 6c69 6361 7465  ngs.on_duplicate
+0000f950: 5f63 656c 6c20 3d3d 2022 6572 726f 7222  _cell == "error"
+0000f960: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f970: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0000f980: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0000f990: 2020 2020 2020 2020 6622 4475 706c 6963          f"Duplic
+0000f9a0: 6174 6564 2063 656c 6c20 6e61 6d65 7320  ated cell names 
+0000f9b0: 696e 207b 746f 705f 6365 6c6c 2e6e 616d  in {top_cell.nam
+0000f9c0: 6521 727d 3a20 7b63 656c 6c5f 6e61 6d65  e!r}: {cell_name
+0000f9d0: 7321 727d 220a 2020 2020 2020 2020 2020  s!r}".          
+0000f9e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000f9f0: 2020 2020 656c 6966 2077 7269 7465 5f73      elif write_s
+0000fa00: 6574 7469 6e67 732e 6f6e 5f64 7570 6c69  ettings.on_dupli
+0000fa10: 6361 7465 5f63 656c 6c20 696e 207b 2277  cate_cell in {"w
+0000fa20: 6172 6e22 2c20 226f 7665 7277 7269 7465  arn", "overwrite
+0000fa30: 227d 3a0a 2020 2020 2020 2020 2020 2020  "}:.            
+0000fa40: 2020 2020 6966 2077 7269 7465 5f73 6574      if write_set
+0000fa50: 7469 6e67 732e 6f6e 5f64 7570 6c69 6361  tings.on_duplica
+0000fa60: 7465 5f63 656c 6c20 3d3d 2022 7761 726e  te_cell == "warn
+0000fa70: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0000fa80: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
+0000fa90: 7761 726e 280a 2020 2020 2020 2020 2020  warn(.          
+0000faa0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0000fab0: 4475 706c 6963 6174 6564 2063 656c 6c20  Duplicated cell 
+0000fac0: 6e61 6d65 7320 696e 207b 746f 705f 6365  names in {top_ce
+0000fad0: 6c6c 2e6e 616d 6521 727d 3a20 207b 6365  ll.name!r}:  {ce
+0000fae0: 6c6c 5f6e 616d 6573 7d22 2c0a 2020 2020  ll_names}",.    
+0000faf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb00: 2020 2020 7374 6163 6b6c 6576 656c 3d33      stacklevel=3
+0000fb10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000fb20: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000fb30: 2020 2020 2020 2020 6365 6c6c 735f 6469          cells_di
+0000fb40: 6374 203d 207b 6365 6c6c 2e6e 616d 653a  ct = {cell.name:
+0000fb50: 2063 656c 6c2e 5f63 656c 6c20 666f 7220   cell._cell for 
+0000fb60: 6365 6c6c 2069 6e20 6365 6c6c 737d 0a20  cell in cells}. 
+0000fb70: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000fb80: 656c 6c73 203d 2063 656c 6c73 5f64 6963  ells = cells_dic
+0000fb90: 742e 7661 6c75 6573 2829 0a20 2020 2020  t.values().     
+0000fba0: 2020 2020 2020 2065 6c69 6620 7772 6974         elif writ
+0000fbb0: 655f 7365 7474 696e 6773 2e6f 6e5f 6475  e_settings.on_du
+0000fbc0: 706c 6963 6174 655f 6365 6c6c 2069 7320  plicate_cell is 
+0000fbd0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0000fbe0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000fbf0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+0000fc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc10: 6622 6f6e 5f64 7570 6c69 6361 7465 5f63  f"on_duplicate_c
+0000fc20: 656c 6c3a 207b 7772 6974 655f 7365 7474  ell: {write_sett
+0000fc30: 696e 6773 2e6f 6e5f 6475 706c 6963 6174  ings.on_duplicat
+0000fc40: 655f 6365 6c6c 2172 7d20 6e6f 7420 696e  e_cell!r} not in
+0000fc50: 2028 4e6f 6e65 2c20 7761 726e 2c20 6572   (None, warn, er
+0000fc60: 726f 722c 206f 7665 7277 7269 7465 2922  ror, overwrite)"
+0000fc70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fc80: 2029 0a0a 2020 2020 2020 2020 616c 6c5f   )..        all_
+0000fc90: 6365 6c6c 7320 3d20 5b74 6f70 5f63 656c  cells = [top_cel
+0000fca0: 6c2e 5f63 656c 6c5d 202b 2073 6f72 7465  l._cell] + sorte
+0000fcb0: 6428 6365 6c6c 732c 206b 6579 3d6c 616d  d(cells, key=lam
+0000fcc0: 6264 6120 6363 3a20 6363 2e6e 616d 6529  bda cc: cc.name)
+0000fcd0: 0a0a 2020 2020 2020 2020 6e6f 5f6e 616d  ..        no_nam
+0000fce0: 655f 6365 6c6c 7320 3d20 5b0a 2020 2020  e_cells = [.    
+0000fcf0: 2020 2020 2020 2020 6365 6c6c 2e6e 616d          cell.nam
+0000fd00: 6520 666f 7220 6365 6c6c 2069 6e20 616c  e for cell in al
+0000fd10: 6c5f 6365 6c6c 7320 6966 2063 656c 6c2e  l_cells if cell.
+0000fd20: 6e61 6d65 2e73 7461 7274 7377 6974 6828  name.startswith(
+0000fd30: 2255 6e6e 616d 6564 2229 0a20 2020 2020  "Unnamed").     
+0000fd40: 2020 205d 0a0a 2020 2020 2020 2020 6966     ]..        if
+0000fd50: 206e 6f5f 6e61 6d65 5f63 656c 6c73 3a0a   no_name_cells:.
+0000fd60: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+0000fd70: 696e 6773 2e77 6172 6e28 0a20 2020 2020  ings.warn(.     
+0000fd80: 2020 2020 2020 2020 2020 2066 2243 6f6d             f"Com
+0000fd90: 706f 6e65 6e74 207b 746f 705f 6365 6c6c  ponent {top_cell
+0000fda0: 2e6e 616d 6521 727d 2063 6f6e 7461 696e  .name!r} contain
+0000fdb0: 7320 7b6c 656e 286e 6f5f 6e61 6d65 5f63  s {len(no_name_c
+0000fdc0: 656c 6c73 297d 2055 6e6e 616d 6564 2063  ells)} Unnamed c
+0000fdd0: 656c 6c73 222c 0a20 2020 2020 2020 2020  ells",.         
+0000fde0: 2020 2020 2020 2073 7461 636b 6c65 7665         stackleve
+0000fdf0: 6c3d 332c 0a20 2020 2020 2020 2020 2020  l=3,.           
+0000fe00: 2029 0a0a 2020 2020 2020 2020 2320 666f   )..        # fo
+0000fe10: 7220 6365 6c6c 2069 6e20 616c 6c5f 6365  r cell in all_ce
+0000fe20: 6c6c 733a 0a20 2020 2020 2020 2023 2020  lls:.        #  
+0000fe30: 2020 2070 7269 6e74 2863 656c 6c2e 6e61     print(cell.na
+0000fe40: 6d65 2c20 7479 7065 2863 656c 6c29 290a  me, type(cell)).
+0000fe50: 0a20 2020 2020 2020 206c 6962 203d 2067  .        lib = g
+0000fe60: 6473 746b 2e4c 6962 7261 7279 280a 2020  dstk.Library(.  
+0000fe70: 2020 2020 2020 2020 2020 756e 6974 3d77            unit=w
+0000fe80: 7269 7465 5f73 6574 7469 6e67 732e 756e  rite_settings.un
+0000fe90: 6974 2c20 7072 6563 6973 696f 6e3d 7772  it, precision=wr
+0000fea0: 6974 655f 7365 7474 696e 6773 2e70 7265  ite_settings.pre
+0000feb0: 6369 7369 6f6e 0a20 2020 2020 2020 2029  cision.        )
+0000fec0: 0a20 2020 2020 2020 206c 6962 2e61 6464  .        lib.add
+0000fed0: 2874 6f70 5f63 656c 6c2e 5f63 656c 6c29  (top_cell._cell)
+0000fee0: 0a20 2020 2020 2020 206c 6962 2e61 6464  .        lib.add
+0000fef0: 282a 746f 705f 6365 6c6c 2e5f 6365 6c6c  (*top_cell._cell
+0000ff00: 2e64 6570 656e 6465 6e63 6965 7328 5472  .dependencies(Tr
+0000ff10: 7565 2929 0a0a 2020 2020 2020 2020 6966  ue))..        if
+0000ff20: 2077 6974 685f 6f61 7369 733a 0a20 2020   with_oasis:.   
+0000ff30: 2020 2020 2020 2020 206c 6962 2e77 7269           lib.wri
+0000ff40: 7465 5f6f 6173 2867 6473 7061 7468 2c20  te_oas(gdspath, 
+0000ff50: 2a2a 6f61 7369 735f 7365 7474 696e 6773  **oasis_settings
+0000ff60: 2e64 6963 7428 2929 0a20 2020 2020 2020  .dict()).       
+0000ff70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000ff80: 2020 206c 6962 2e77 7269 7465 5f67 6473     lib.write_gds
+0000ff90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000ffa0: 2020 6764 7370 6174 682c 2074 696d 6573    gdspath, times
+0000ffb0: 7461 6d70 3d74 696d 6573 7461 6d70 2c20  tamp=timestamp, 
+0000ffc0: 6d61 785f 706f 696e 7473 3d77 7269 7465  max_points=write
+0000ffd0: 5f73 6574 7469 6e67 732e 6d61 785f 706f  _settings.max_po
+0000ffe0: 696e 7473 0a20 2020 2020 2020 2020 2020  ints.           
+0000fff0: 2029 0a20 2020 2020 2020 2069 6620 6c6f   ).        if lo
+00010000: 6767 696e 673a 0a20 2020 2020 2020 2020  gging:.         
+00010010: 2020 206c 6f67 6765 722e 696e 666f 2866     logger.info(f
+00010020: 2257 726f 7465 2074 6f20 7b73 7472 2867  "Wrote to {str(g
+00010030: 6473 7061 7468 2921 727d 2229 0a20 2020  dspath)!r}").   
+00010040: 2020 2020 2072 6574 7572 6e20 6764 7370       return gdsp
+00010050: 6174 680a 0a20 2020 2064 6566 2077 7269  ath..    def wri
+00010060: 7465 5f67 6473 280a 2020 2020 2020 2020  te_gds(.        
+00010070: 7365 6c66 2c0a 2020 2020 2020 2020 6764  self,.        gd
+00010080: 7370 6174 683a 204f 7074 696f 6e61 6c5b  spath: Optional[
+00010090: 5061 7468 5479 7065 5d20 3d20 4e6f 6e65  PathType] = None
+000100a0: 2c0a 2020 2020 2020 2020 6764 7364 6972  ,.        gdsdir
+000100b0: 3a20 4f70 7469 6f6e 616c 5b50 6174 6854  : Optional[PathT
+000100c0: 7970 655d 203d 204e 6f6e 652c 0a20 2020  ype] = None,.   
+000100d0: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
+000100e0: 2020 2029 202d 3e20 5061 7468 3a0a 2020     ) -> Path:.  
+000100f0: 2020 2020 2020 2222 2257 7269 7465 2063        """Write c
+00010100: 6f6d 706f 6e65 6e74 2074 6f20 4744 5320  omponent to GDS 
+00010110: 616e 6420 7265 7475 726e 7320 6764 7370  and returns gdsp
+00010120: 6174 682e 0a0a 2020 2020 2020 2020 4172  ath...        Ar
+00010130: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+00010140: 6764 7370 6174 683a 2047 4453 2066 696c  gdspath: GDS fil
+00010150: 6520 7061 7468 2074 6f20 7772 6974 6520  e path to write 
+00010160: 746f 2e0a 2020 2020 2020 2020 2020 2020  to..            
+00010170: 6764 7364 6972 3a20 6469 7265 6374 6f72  gdsdir: director
+00010180: 7920 666f 7220 7468 6520 4744 5320 6669  y for the GDS fi
+00010190: 6c65 2e20 4465 6661 756c 7473 2074 6f20  le. Defaults to 
+000101a0: 2f74 6d70 2f72 616e 646f 6d46 696c 652f  /tmp/randomFile/
+000101b0: 6764 7366 6163 746f 7279 2e0a 0a20 2020  gdsfactory...   
+000101c0: 2020 2020 204b 6579 776f 7264 2041 7267       Keyword Arg
+000101d0: 733a 0a20 2020 2020 2020 2020 2020 2075  s:.            u
+000101e0: 6e69 743a 2075 6e69 7420 7369 7a65 2066  nit: unit size f
+000101f0: 6f72 206f 626a 6563 7473 2069 6e20 6c69  or objects in li
+00010200: 6272 6172 792e 2031 756d 2062 7920 6465  brary. 1um by de
+00010210: 6661 756c 742e 0a20 2020 2020 2020 2020  fault..         
+00010220: 2020 2070 7265 6369 7369 6f6e 3a20 666f     precision: fo
+00010230: 7220 6469 6d65 6e73 696f 6e73 2069 6e20  r dimensions in 
+00010240: 7468 6520 6c69 6272 6172 7920 286d 292e  the library (m).
+00010250: 2031 6e6d 2062 7920 6465 6661 756c 742e   1nm by default.
+00010260: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+00010270: 6769 6e67 3a20 6469 7361 626c 6520 4744  ging: disable GD
+00010280: 5320 7061 7468 206c 6f67 6769 6e67 2c20  S path logging, 
+00010290: 666f 7220 6578 616d 706c 6520 666f 7220  for example for 
+000102a0: 7368 6f77 696e 6720 6974 2069 6e20 4b4c  showing it in KL
+000102b0: 6179 6f75 742e 0a20 2020 2020 2020 2020  ayout..         
+000102c0: 2020 206f 6e5f 6475 706c 6963 6174 655f     on_duplicate_
+000102d0: 6365 6c6c 3a20 7370 6563 6966 7920 686f  cell: specify ho
+000102e0: 7720 746f 2072 6573 6f6c 7665 2064 7570  w to resolve dup
+000102f0: 6c69 6361 7465 2d6e 616d 6564 2063 656c  licate-named cel
+00010300: 6c73 2e20 4368 6f6f 7365 206f 6e65 206f  ls. Choose one o
+00010310: 6620 7468 6520 666f 6c6c 6f77 696e 673a  f the following:
+00010320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010330: 2022 7761 726e 2220 2864 6566 6175 6c74   "warn" (default
+00010340: 293a 206f 7665 7277 7269 7465 2061 6c6c  ): overwrite all
+00010350: 2064 7570 6c69 6361 7465 2063 656c 6c73   duplicate cells
+00010360: 2077 6974 6820 6f6e 6520 6f66 2074 6865   with one of the
+00010370: 2064 7570 6c69 6361 7465 7320 2861 7262   duplicates (arb
+00010380: 6974 7261 7269 6c79 292e 0a20 2020 2020  itrarily)..     
+00010390: 2020 2020 2020 2020 2020 2022 6572 726f             "erro
+000103a0: 7222 3a20 7468 726f 7720 6120 5661 6c75  r": throw a Valu
+000103b0: 6545 7272 6f72 2077 6865 6e20 6174 7465  eError when atte
+000103c0: 6d70 7469 6e67 2074 6f20 7772 6974 6520  mpting to write 
+000103d0: 6120 6764 7320 7769 7468 2064 7570 6c69  a gds with dupli
+000103e0: 6361 7465 2063 656c 6c73 2e0a 2020 2020  cate cells..    
+000103f0: 2020 2020 2020 2020 2020 2020 226f 7665              "ove
+00010400: 7277 7269 7465 223a 206f 7665 7277 7269  rwrite": overwri
+00010410: 7465 2061 6c6c 2064 7570 6c69 6361 7465  te all duplicate
+00010420: 2063 656c 6c73 2077 6974 6820 6f6e 6520   cells with one 
+00010430: 6f66 2074 6865 2064 7570 6c69 6361 7465  of the duplicate
+00010440: 732c 2077 6974 686f 7574 2077 6172 6e69  s, without warni
+00010450: 6e67 2e0a 2020 2020 2020 2020 2020 2020  ng..            
+00010460: 6f6e 5f75 6e63 6163 6865 645f 636f 6d70  on_uncached_comp
+00010470: 6f6e 656e 743a 204c 6974 6572 616c 5b22  onent: Literal["
+00010480: 7761 726e 222c 2022 6572 726f 7222 5d20  warn", "error"] 
+00010490: 3d20 2277 6172 6e22 0a20 2020 2020 2020  = "warn".       
+000104a0: 2020 2020 2066 6c61 7474 656e 5f69 6e76       flatten_inv
+000104b0: 616c 6964 5f72 6566 733a 2066 6c61 7474  alid_refs: flatt
+000104c0: 656e 7320 636f 6d70 6f6e 656e 7420 7265  ens component re
+000104d0: 6665 7265 6e63 6573 2077 6869 6368 2068  ferences which h
+000104e0: 6176 6520 696e 7661 6c69 6420 7472 616e  ave invalid tran
+000104f0: 7366 6f72 6d61 7469 6f6e 732e 0a20 2020  sformations..   
+00010500: 2020 2020 2020 2020 206d 6178 5f70 6f69           max_poi
+00010510: 6e74 733a 204d 6178 696d 616c 206e 756d  nts: Maximal num
+00010520: 6265 7220 6f66 2076 6572 7469 6365 7320  ber of vertices 
+00010530: 7065 7220 706f 6c79 676f 6e2e 0a20 2020  per polygon..   
+00010540: 2020 2020 2020 2020 2020 2020 2050 6f6c               Pol
+00010550: 7967 6f6e 7320 7769 7468 206d 6f72 6520  ygons with more 
+00010560: 7665 7274 6963 6573 2074 6861 7420 7468  vertices that th
+00010570: 6973 2061 7265 2061 7574 6f6d 6174 6963  is are automatic
+00010580: 616c 6c79 2066 7261 6374 7572 6564 2e0a  ally fractured..
+00010590: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+000105a0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000105b0: 2e5f 7772 6974 655f 6c69 6272 6172 7928  ._write_library(
+000105c0: 0a20 2020 2020 2020 2020 2020 2067 6473  .            gds
+000105d0: 7061 7468 3d67 6473 7061 7468 2c20 6764  path=gdspath, gd
+000105e0: 7364 6972 3d67 6473 6469 722c 2077 6974  sdir=gdsdir, wit
+000105f0: 685f 6f61 7369 733d 4661 6c73 652c 202a  h_oasis=False, *
+00010600: 2a6b 7761 7267 730a 2020 2020 2020 2020  *kwargs.        
+00010610: 290a 0a20 2020 2064 6566 2077 7269 7465  )..    def write
+00010620: 5f6f 6173 280a 2020 2020 2020 2020 7365  _oas(.        se
+00010630: 6c66 2c0a 2020 2020 2020 2020 6764 7370  lf,.        gdsp
+00010640: 6174 683a 204f 7074 696f 6e61 6c5b 5061  ath: Optional[Pa
+00010650: 7468 5479 7065 5d20 3d20 4e6f 6e65 2c0a  thType] = None,.
+00010660: 2020 2020 2020 2020 6764 7364 6972 3a20          gdsdir: 
+00010670: 4f70 7469 6f6e 616c 5b50 6174 6854 7970  Optional[PathTyp
+00010680: 655d 203d 204e 6f6e 652c 0a20 2020 2020  e] = None,.     
+00010690: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
+000106a0: 2029 202d 3e20 5061 7468 3a0a 2020 2020   ) -> Path:.    
+000106b0: 2020 2020 2222 2257 7269 7465 2063 6f6d      """Write com
+000106c0: 706f 6e65 6e74 2074 6f20 4744 5320 616e  ponent to GDS an
+000106d0: 6420 7265 7475 726e 7320 6764 7370 6174  d returns gdspat
+000106e0: 682e 0a0a 2020 2020 2020 2020 4172 6773  h...        Args
+000106f0: 3a0a 2020 2020 2020 2020 2020 2020 6764  :.            gd
+00010700: 7370 6174 683a 2047 4453 2066 696c 6520  spath: GDS file 
+00010710: 7061 7468 2074 6f20 7772 6974 6520 746f  path to write to
+00010720: 2e0a 2020 2020 2020 2020 2020 2020 6764  ..            gd
+00010730: 7364 6972 3a20 6469 7265 6374 6f72 7920  sdir: directory 
+00010740: 666f 7220 7468 6520 4744 5320 6669 6c65  for the GDS file
+00010750: 2e20 4465 6661 756c 7473 2074 6f20 2f74  . Defaults to /t
+00010760: 6d70 2f72 616e 646f 6d46 696c 652f 6764  mp/randomFile/gd
+00010770: 7366 6163 746f 7279 2e0a 0a20 2020 2020  sfactory...     
+00010780: 2020 204b 6579 776f 7264 2041 7267 733a     Keyword Args:
+00010790: 0a20 2020 2020 2020 2020 2020 2075 6e69  .            uni
+000107a0: 743a 2075 6e69 7420 7369 7a65 2066 6f72  t: unit size for
+000107b0: 206f 626a 6563 7473 2069 6e20 6c69 6272   objects in libr
+000107c0: 6172 792e 2031 756d 2062 7920 6465 6661  ary. 1um by defa
+000107d0: 756c 742e 0a20 2020 2020 2020 2020 2020  ult..           
+000107e0: 2070 7265 6369 7369 6f6e 3a20 666f 7220   precision: for 
+000107f0: 6469 6d65 6e73 696f 6e73 2069 6e20 7468  dimensions in th
+00010800: 6520 6c69 6272 6172 7920 286d 292e 2031  e library (m). 1
+00010810: 6e6d 2062 7920 6465 6661 756c 742e 0a20  nm by default.. 
+00010820: 2020 2020 2020 2020 2020 206c 6f67 6769             loggi
+00010830: 6e67 3a20 6469 7361 626c 6520 4744 5320  ng: disable GDS 
+00010840: 7061 7468 206c 6f67 6769 6e67 2c20 666f  path logging, fo
+00010850: 7220 6578 616d 706c 6520 666f 7220 7368  r example for sh
+00010860: 6f77 696e 6720 6974 2069 6e20 4b4c 6179  owing it in KLay
+00010870: 6f75 742e 0a20 2020 2020 2020 2020 2020  out..           
+00010880: 206f 6e5f 6475 706c 6963 6174 655f 6365   on_duplicate_ce
+00010890: 6c6c 3a20 7370 6563 6966 7920 686f 7720  ll: specify how 
+000108a0: 746f 2072 6573 6f6c 7665 2064 7570 6c69  to resolve dupli
+000108b0: 6361 7465 2d6e 616d 6564 2063 656c 6c73  cate-named cells
+000108c0: 2e20 4368 6f6f 7365 206f 6e65 206f 6620  . Choose one of 
+000108d0: 7468 6520 666f 6c6c 6f77 696e 673a 0a20  the following:. 
+000108e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000108f0: 7761 726e 2220 2864 6566 6175 6c74 293a  warn" (default):
+00010900: 206f 7665 7277 7269 7465 2061 6c6c 2064   overwrite all d
+00010910: 7570 6c69 6361 7465 2063 656c 6c73 2077  uplicate cells w
+00010920: 6974 6820 6f6e 6520 6f66 2074 6865 2064  ith one of the d
+00010930: 7570 6c69 6361 7465 7320 2861 7262 6974  uplicates (arbit
+00010940: 7261 7269 6c79 292e 0a20 2020 2020 2020  rarily)..       
+00010950: 2020 2020 2020 2020 2022 6572 726f 7222           "error"
+00010960: 3a20 7468 726f 7720 6120 5661 6c75 6545  : throw a ValueE
+00010970: 7272 6f72 2077 6865 6e20 6174 7465 6d70  rror when attemp
+00010980: 7469 6e67 2074 6f20 7772 6974 6520 6120  ting to write a 
+00010990: 6764 7320 7769 7468 2064 7570 6c69 6361  gds with duplica
+000109a0: 7465 2063 656c 6c73 2e0a 2020 2020 2020  te cells..      
+000109b0: 2020 2020 2020 2020 2020 226f 7665 7277            "overw
+000109c0: 7269 7465 223a 206f 7665 7277 7269 7465  rite": overwrite
+000109d0: 2061 6c6c 2064 7570 6c69 6361 7465 2063   all duplicate c
+000109e0: 656c 6c73 2077 6974 6820 6f6e 6520 6f66  ells with one of
+000109f0: 2074 6865 2064 7570 6c69 6361 7465 732c   the duplicates,
+00010a00: 2077 6974 686f 7574 2077 6172 6e69 6e67   without warning
+00010a10: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010a20: 2020 4e6f 6e65 3a20 646f 206e 6f74 2074    None: do not t
+00010a30: 7279 2074 6f20 7265 736f 6c76 6520 2861  ry to resolve (a
+00010a40: 7420 796f 7572 206f 776e 2072 6973 6b21  t your own risk!
+00010a50: 290a 2020 2020 2020 2020 2020 2020 6f6e  ).            on
+00010a60: 5f75 6e63 6163 6865 645f 636f 6d70 6f6e  _uncached_compon
+00010a70: 656e 743a 204c 6974 6572 616c 5b22 7761  ent: Literal["wa
+00010a80: 726e 222c 2022 6572 726f 7222 5d20 3d20  rn", "error"] = 
+00010a90: 2277 6172 6e22 0a20 2020 2020 2020 2020  "warn".         
+00010aa0: 2020 2066 6c61 7474 656e 5f69 6e76 616c     flatten_inval
+00010ab0: 6964 5f72 6566 733a 2066 6c61 7474 656e  id_refs: flatten
+00010ac0: 7320 636f 6d70 6f6e 656e 7420 7265 6665  s component refe
+00010ad0: 7265 6e63 6573 2077 6869 6368 2068 6176  rences which hav
+00010ae0: 6520 696e 7661 6c69 6420 7472 616e 7366  e invalid transf
+00010af0: 6f72 6d61 7469 6f6e 732e 0a20 2020 2020  ormations..     
+00010b00: 2020 2020 2020 2063 6f6d 7072 6573 7369         compressi
+00010b10: 6f6e 5f6c 6576 656c 3a20 4c65 7665 6c20  on_level: Level 
+00010b20: 6f66 2063 6f6d 7072 6573 7369 6f6e 2066  of compression f
+00010b30: 6f72 2063 656c 6c73 2028 6265 7477 6565  or cells (betwee
+00010b40: 6e20 3020 616e 6420 3929 2e0a 2020 2020  n 0 and 9)..    
+00010b50: 2020 2020 2020 2020 2020 2020 5365 7474              Sett
+00010b60: 696e 6720 746f 2030 2077 696c 6c20 6469  ing to 0 will di
+00010b70: 7361 626c 6520 6365 6c6c 2063 6f6d 7072  sable cell compr
+00010b80: 6573 7369 6f6e 2c20 3120 6769 7665 7320  ession, 1 gives 
+00010b90: 7468 6520 6265 7374 2073 7065 6564 2061  the best speed a
+00010ba0: 6e64 2039 2c20 7468 6520 6265 7374 2063  nd 9, the best c
+00010bb0: 6f6d 7072 6573 7369 6f6e 2e0a 2020 2020  ompression..    
+00010bc0: 2020 2020 2020 2020 6465 7465 6374 5f72          detect_r
+00010bd0: 6563 7461 6e67 6c65 733a 2053 746f 7265  ectangles: Store
+00010be0: 2072 6563 7461 6e67 6c65 7320 696e 2063   rectangles in c
+00010bf0: 6f6d 7072 6573 7365 6420 666f 726d 6174  ompressed format
+00010c00: 2e0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+00010c10: 7465 6374 5f74 7261 7065 7a6f 6964 733a  tect_trapezoids:
+00010c20: 2053 746f 7265 2074 7261 7065 7a6f 6964   Store trapezoid
+00010c30: 7320 696e 2063 6f6d 7072 6573 7365 6420  s in compressed 
+00010c40: 666f 726d 6174 2e0a 2020 2020 2020 2020  format..        
+00010c50: 2020 2020 6369 7263 6c65 5f74 6f6c 6572      circle_toler
+00010c60: 616e 6365 3a20 546f 6c65 7261 6e63 6520  ance: Tolerance 
+00010c70: 666f 7220 6465 7465 6374 696e 6720 6369  for detecting ci
+00010c80: 7263 6c65 732e 2049 6620 6c65 7373 206f  rcles. If less o
+00010c90: 7220 6571 7561 6c20 746f 2030 2c20 6e6f  r equal to 0, no
+00010ca0: 2064 6574 6563 7469 6f6e 2069 7320 7065   detection is pe
+00010cb0: 7266 6f72 6d65 642e 0a20 2020 2020 2020  rformed..       
+00010cc0: 2020 2020 2020 2020 2043 6972 636c 6573           Circles
+00010cd0: 2061 7265 2073 746f 7265 6420 696e 2063   are stored in c
+00010ce0: 6f6d 7072 6573 7365 6420 666f 726d 6174  ompressed format
+00010cf0: 2e0a 2020 2020 2020 2020 2020 2020 7661  ..            va
+00010d00: 6c69 6461 7469 6f6e 2028 2263 7263 3332  lidation ("crc32
+00010d10: 222c 2022 6368 6563 6b73 756d 3332 222c  ", "checksum32",
+00010d20: 204e 6f6e 6529 20e2 8093 2074 7970 6520   None) ... type 
+00010d30: 6f66 2076 616c 6964 6174 696f 6e20 746f  of validation to
+00010d40: 2069 6e63 6c75 6465 2069 6e20 7468 6520   include in the 
+00010d50: 7361 7665 6420 6669 6c65 2e0a 2020 2020  saved file..    
+00010d60: 2020 2020 2020 2020 7374 616e 6461 7264          standard
+00010d70: 5f70 726f 7065 7274 6965 733a 2053 746f  _properties: Sto
+00010d80: 7265 2073 7461 6e64 6172 6420 4f41 5349  re standard OASI
+00010d90: 5320 7072 6f70 6572 7469 6573 2069 6e20  S properties in 
+00010da0: 7468 6520 6669 6c65 2e0a 2020 2020 2020  the file..      
+00010db0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+00010dc0: 7475 726e 2073 656c 662e 5f77 7269 7465  turn self._write
+00010dd0: 5f6c 6962 7261 7279 280a 2020 2020 2020  _library(.      
+00010de0: 2020 2020 2020 6764 7370 6174 683d 6764        gdspath=gd
+00010df0: 7370 6174 682c 0a20 2020 2020 2020 2020  spath,.         
+00010e00: 2020 2067 6473 6469 723d 6764 7364 6972     gdsdir=gdsdir
+00010e10: 2c0a 2020 2020 2020 2020 2020 2020 7769  ,.            wi
+00010e20: 7468 5f6f 6173 6973 3d54 7275 652c 0a20  th_oasis=True,. 
+00010e30: 2020 2020 2020 2020 2020 202a 2a6b 7761             **kwa
+00010e40: 7267 732c 0a20 2020 2020 2020 2029 0a0a  rgs,.        )..
+00010e50: 2020 2020 6465 6620 7772 6974 655f 6764      def write_gd
+00010e60: 735f 7769 7468 5f6d 6574 6164 6174 6128  s_with_metadata(
+00010e70: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
+00010e80: 7761 7267 7329 202d 3e20 5061 7468 3a0a  wargs) -> Path:.
+00010e90: 2020 2020 2020 2020 2222 2257 7269 7465          """Write
+00010ea0: 2063 6f6d 706f 6e65 6e74 2069 6e20 4744   component in GD
+00010eb0: 5320 616e 6420 6d65 7461 6461 7461 2028  S and metadata (
+00010ec0: 636f 6d70 6f6e 656e 7420 7365 7474 696e  component settin
+00010ed0: 6773 2920 696e 2059 414d 4c2e 2222 220a  gs) in YAML.""".
+00010ee0: 2020 2020 2020 2020 6764 7370 6174 6820          gdspath 
+00010ef0: 3d20 7365 6c66 2e77 7269 7465 5f67 6473  = self.write_gds
+00010f00: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
+00010f10: 290a 2020 2020 2020 2020 6d65 7461 6461  ).        metada
+00010f20: 7461 203d 2067 6473 7061 7468 2e77 6974  ta = gdspath.wit
+00010f30: 685f 7375 6666 6978 2822 2e79 6d6c 2229  h_suffix(".yml")
+00010f40: 0a20 2020 2020 2020 206d 6574 6164 6174  .        metadat
+00010f50: 612e 7772 6974 655f 7465 7874 2873 656c  a.write_text(sel
+00010f60: 662e 746f 5f79 616d 6c28 7769 7468 5f63  f.to_yaml(with_c
+00010f70: 656c 6c73 3d54 7275 652c 2077 6974 685f  ells=True, with_
+00010f80: 706f 7274 733d 5472 7565 2929 0a20 2020  ports=True)).   
+00010f90: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
+00010fa0: 2866 2257 7269 7465 2059 414d 4c20 6d65  (f"Write YAML me
+00010fb0: 7461 6461 7461 2074 6f20 7b73 7472 286d  tadata to {str(m
+00010fc0: 6574 6164 6174 6129 2172 7d22 290a 2020  etadata)!r}").  
+00010fd0: 2020 2020 2020 7265 7475 726e 2067 6473        return gds
+00010fe0: 7061 7468 0a0a 2020 2020 6465 6620 746f  path..    def to
+00010ff0: 5f64 6963 7428 0a20 2020 2020 2020 2073  _dict(.        s
+00011000: 656c 662c 0a20 2020 2020 2020 2069 676e  elf,.        ign
+00011010: 6f72 655f 636f 6d70 6f6e 656e 7473 5f70  ore_components_p
+00011020: 7265 6669 783a 204f 7074 696f 6e61 6c5b  refix: Optional[
+00011030: 4c69 7374 5b73 7472 5d5d 203d 204e 6f6e  List[str]] = Non
+00011040: 652c 0a20 2020 2020 2020 2069 676e 6f72  e,.        ignor
+00011050: 655f 6675 6e63 7469 6f6e 735f 7072 6566  e_functions_pref
+00011060: 6978 3a20 4f70 7469 6f6e 616c 5b4c 6973  ix: Optional[Lis
+00011070: 745b 7374 725d 5d20 3d20 4e6f 6e65 2c0a  t[str]] = None,.
+00011080: 2020 2020 2020 2020 7769 7468 5f63 656c          with_cel
+00011090: 6c73 3a20 626f 6f6c 203d 2046 616c 7365  ls: bool = False
+000110a0: 2c0a 2020 2020 2020 2020 7769 7468 5f70  ,.        with_p
+000110b0: 6f72 7473 3a20 626f 6f6c 203d 2054 7275  orts: bool = Tru
+000110c0: 652c 0a20 2020 2029 202d 3e20 4469 6374  e,.    ) -> Dict
+000110d0: 5b73 7472 2c20 416e 795d 3a0a 2020 2020  [str, Any]:.    
+000110e0: 2020 2020 2222 2252 6574 7572 6e73 2044      """Returns D
+000110f0: 6963 7420 7265 7072 6573 656e 7461 7469  ict representati
+00011100: 6f6e 206f 6620 6120 636f 6d70 6f6e 656e  on of a componen
+00011110: 742e 0a0a 2020 2020 2020 2020 4172 6773  t...        Args
+00011120: 3a0a 2020 2020 2020 2020 2020 2020 6967  :.            ig
+00011130: 6e6f 7265 5f63 6f6d 706f 6e65 6e74 735f  nore_components_
+00011140: 7072 6566 6978 3a20 666f 7220 636f 6d70  prefix: for comp
+00011150: 6f6e 656e 7473 2074 6f20 6967 6e6f 7265  onents to ignore
+00011160: 2077 6865 6e20 6578 706f 7274 696e 672e   when exporting.
+00011170: 0a20 2020 2020 2020 2020 2020 2069 676e  .            ign
+00011180: 6f72 655f 6675 6e63 7469 6f6e 735f 7072  ore_functions_pr
+00011190: 6566 6978 3a20 666f 7220 6675 6e63 7469  efix: for functi
+000111a0: 6f6e 7320 746f 2069 676e 6f72 6520 7768  ons to ignore wh
+000111b0: 656e 2065 7870 6f72 7469 6e67 2e0a 2020  en exporting..  
+000111c0: 2020 2020 2020 2020 2020 7769 7468 5f63            with_c
+000111d0: 656c 6c73 3a20 7772 6974 6520 6365 6c6c  ells: write cell
+000111e0: 7320 7265 6375 7273 6976 656c 792e 0a20  s recursively.. 
+000111f0: 2020 2020 2020 2020 2020 2077 6974 685f             with_
+00011200: 706f 7274 733a 2077 7269 7465 2070 6f72  ports: write por
+00011210: 7420 696e 666f 726d 6174 696f 6e20 6469  t information di
+00011220: 6374 2e0a 2020 2020 2020 2020 2222 220a  ct..        """.
+00011230: 2020 2020 2020 2020 6420 3d20 7b7d 0a20          d = {}. 
+00011240: 2020 2020 2020 2069 6620 7769 7468 5f70         if with_p
+00011250: 6f72 7473 3a0a 2020 2020 2020 2020 2020  orts:.          
+00011260: 2020 706f 7274 7320 3d20 7b70 6f72 742e    ports = {port.
+00011270: 6e61 6d65 3a20 706f 7274 2e74 6f5f 6469  name: port.to_di
+00011280: 6374 2829 2066 6f72 2070 6f72 7420 696e  ct() for port in
+00011290: 2073 656c 662e 6765 745f 706f 7274 735f   self.get_ports_
+000112a0: 6c69 7374 2829 7d0a 2020 2020 2020 2020  list()}.        
+000112b0: 2020 2020 645b 2270 6f72 7473 225d 203d      d["ports"] =
+000112c0: 2070 6f72 7473 0a0a 2020 2020 2020 2020   ports..        
+000112d0: 6966 2077 6974 685f 6365 6c6c 733a 0a20  if with_cells:. 
+000112e0: 2020 2020 2020 2020 2020 2063 656c 6c73             cells
+000112f0: 203d 2072 6563 7572 7365 5f73 7472 7563   = recurse_struc
+00011300: 7475 7265 7328 0a20 2020 2020 2020 2020  tures(.         
+00011310: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00011320: 2020 2020 2020 2020 2020 2020 2069 676e               ign
+00011330: 6f72 655f 6675 6e63 7469 6f6e 735f 7072  ore_functions_pr
+00011340: 6566 6978 3d69 676e 6f72 655f 6675 6e63  efix=ignore_func
+00011350: 7469 6f6e 735f 7072 6566 6978 2c0a 2020  tions_prefix,.  
+00011360: 2020 2020 2020 2020 2020 2020 2020 6967                ig
+00011370: 6e6f 7265 5f63 6f6d 706f 6e65 6e74 735f  nore_components_
+00011380: 7072 6566 6978 3d69 676e 6f72 655f 636f  prefix=ignore_co
+00011390: 6d70 6f6e 656e 7473 5f70 7265 6669 782c  mponents_prefix,
+000113a0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000113b0: 2020 2020 2020 2020 2020 2064 5b22 6365             d["ce
+000113c0: 6c6c 7322 5d20 3d20 636c 6561 6e5f 6469  lls"] = clean_di
+000113d0: 6374 2863 656c 6c73 290a 0a20 2020 2020  ct(cells)..     
+000113e0: 2020 2064 5b22 6e61 6d65 225d 203d 2073     d["name"] = s
+000113f0: 656c 662e 6e61 6d65 0a20 2020 2020 2020  elf.name.       
+00011400: 2064 5b22 7365 7474 696e 6773 225d 203d   d["settings"] =
+00011410: 2063 6c65 616e 5f64 6963 7428 6469 6374   clean_dict(dict
+00011420: 2873 656c 662e 7365 7474 696e 6773 2929  (self.settings))
+00011430: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00011440: 640a 0a20 2020 2064 6566 2074 6f5f 7961  d..    def to_ya
+00011450: 6d6c 2873 656c 662c 202a 2a6b 7761 7267  ml(self, **kwarg
+00011460: 7329 202d 3e20 7374 723a 0a20 2020 2020  s) -> str:.     
+00011470: 2020 2022 2222 5772 6974 6520 4469 6374     """Write Dict
+00011480: 2072 6570 7265 7365 6e74 6174 696f 6e20   representation 
+00011490: 6f66 2061 2063 6f6d 706f 6e65 6e74 2069  of a component i
+000114a0: 6e20 5941 4d4c 2066 6f72 6d61 742e 0a0a  n YAML format...
+000114b0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+000114c0: 2020 2020 2020 2020 2020 6967 6e6f 7265            ignore
+000114d0: 5f63 6f6d 706f 6e65 6e74 735f 7072 6566  _components_pref
+000114e0: 6978 3a20 666f 7220 636f 6d70 6f6e 656e  ix: for componen
+000114f0: 7473 2074 6f20 6967 6e6f 7265 2077 6865  ts to ignore whe
+00011500: 6e20 6578 706f 7274 696e 672e 0a20 2020  n exporting..   
+00011510: 2020 2020 2020 2020 2069 676e 6f72 655f           ignore_
+00011520: 6675 6e63 7469 6f6e 735f 7072 6566 6978  functions_prefix
+00011530: 3a20 666f 7220 6675 6e63 7469 6f6e 7320  : for functions 
+00011540: 746f 2069 676e 6f72 6520 7768 656e 2065  to ignore when e
+00011550: 7870 6f72 7469 6e67 2e0a 2020 2020 2020  xporting..      
+00011560: 2020 2020 2020 7769 7468 5f63 656c 6c73        with_cells
+00011570: 3a20 7772 6974 6520 6365 6c6c 7320 7265  : write cells re
+00011580: 6375 7273 6976 656c 792e 0a20 2020 2020  cursively..     
+00011590: 2020 2020 2020 2077 6974 685f 706f 7274         with_port
+000115a0: 733a 2077 7269 7465 2070 6f72 7420 696e  s: write port in
+000115b0: 666f 726d 6174 696f 6e2e 0a20 2020 2020  formation..     
+000115c0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+000115d0: 6574 7572 6e20 4f6d 6567 6143 6f6e 662e  eturn OmegaConf.
+000115e0: 746f 5f79 616d 6c28 636c 6561 6e5f 6469  to_yaml(clean_di
+000115f0: 6374 2873 656c 662e 746f 5f64 6963 7428  ct(self.to_dict(
+00011600: 2a2a 6b77 6172 6773 2929 290a 0a20 2020  **kwargs)))..   
+00011610: 2064 6566 2074 6f5f 6469 6374 5f70 6f6c   def to_dict_pol
+00011620: 7967 6f6e 7328 7365 6c66 2920 2d3e 2044  ygons(self) -> D
+00011630: 6963 745b 7374 722c 2041 6e79 5d3a 0a20  ict[str, Any]:. 
+00011640: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+00011650: 7320 6120 6469 6374 2072 6570 7265 7365  s a dict represe
+00011660: 6e74 6174 696f 6e20 6f66 2074 6865 2066  ntation of the f
+00011670: 6c61 7474 656e 6564 2063 6f6d 706f 6e65  lattened compone
+00011680: 6e74 2e22 2222 0a20 2020 2020 2020 2064  nt.""".        d
+00011690: 203d 207b 7d0a 2020 2020 2020 2020 706f   = {}.        po
+000116a0: 6c79 676f 6e73 203d 207b 7d0a 2020 2020  lygons = {}.    
+000116b0: 2020 2020 6c61 7965 725f 746f 5f70 6f6c      layer_to_pol
+000116c0: 7967 6f6e 7320 3d20 7365 6c66 2e67 6574  ygons = self.get
+000116d0: 5f70 6f6c 7967 6f6e 7328 6279 5f73 7065  _polygons(by_spe
+000116e0: 633d 5472 7565 290a 0a20 2020 2020 2020  c=True)..       
+000116f0: 2066 6f72 206c 6179 6572 2c20 706f 6c79   for layer, poly
+00011700: 676f 6e73 5f6c 6179 6572 2069 6e20 6c61  gons_layer in la
+00011710: 7965 725f 746f 5f70 6f6c 7967 6f6e 732e  yer_to_polygons.
+00011720: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+00011730: 2020 2020 206c 6179 6572 5f6e 616d 6520       layer_name 
+00011740: 3d20 6622 7b6c 6179 6572 5b30 5d7d 5f7b  = f"{layer[0]}_{
+00011750: 6c61 7965 725b 315d 7d22 0a20 2020 2020  layer[1]}".     
+00011760: 2020 2020 2020 2066 6f72 2070 6f6c 7967         for polyg
+00011770: 6f6e 2069 6e20 706f 6c79 676f 6e73 5f6c  on in polygons_l
+00011780: 6179 6572 3a0a 2020 2020 2020 2020 2020  ayer:.          
+00011790: 2020 2020 2020 706f 6c79 676f 6e73 5b6c        polygons[l
+000117a0: 6179 6572 5f6e 616d 655d 203d 205b 7475  ayer_name] = [tu
+000117b0: 706c 6528 736e 6170 5f74 6f5f 6772 6964  ple(snap_to_grid
+000117c0: 2876 2929 2066 6f72 2076 2069 6e20 706f  (v)) for v in po
+000117d0: 6c79 676f 6e5d 0a0a 2020 2020 2020 2020  lygon]..        
+000117e0: 706f 7274 7320 3d20 7b70 6f72 742e 6e61  ports = {port.na
+000117f0: 6d65 3a20 706f 7274 2e73 6574 7469 6e67  me: port.setting
+00011800: 7320 666f 7220 706f 7274 2069 6e20 7365  s for port in se
+00011810: 6c66 2e67 6574 5f70 6f72 7473 5f6c 6973  lf.get_ports_lis
+00011820: 7428 297d 0a20 2020 2020 2020 2063 6c65  t()}.        cle
+00011830: 616e 5f64 6963 7428 706f 7274 7329 0a20  an_dict(ports). 
+00011840: 2020 2020 2020 2063 6c65 616e 5f64 6963         clean_dic
+00011850: 7428 706f 6c79 676f 6e73 290a 2020 2020  t(polygons).    
+00011860: 2020 2020 642e 696e 666f 203d 2073 656c      d.info = sel
+00011870: 662e 696e 666f 0a20 2020 2020 2020 2064  f.info.        d
+00011880: 2e70 6f6c 7967 6f6e 7320 3d20 706f 6c79  .polygons = poly
+00011890: 676f 6e73 0a20 2020 2020 2020 2064 2e70  gons.        d.p
+000118a0: 6f72 7473 203d 2070 6f72 7473 0a20 2020  orts = ports.   
+000118b0: 2020 2020 2072 6574 7572 6e20 640a 0a20       return d.. 
+000118c0: 2020 2064 6566 2061 7574 6f5f 7265 6e61     def auto_rena
+000118d0: 6d65 5f70 6f72 7473 2873 656c 662c 202a  me_ports(self, *
+000118e0: 2a6b 7761 7267 7329 202d 3e20 4e6f 6e65  *kwargs) -> None
+000118f0: 3a0a 2020 2020 2020 2020 2222 2252 656e  :.        """Ren
+00011900: 616d 6520 706f 7274 7320 6279 206f 7269  ame ports by ori
+00011910: 656e 7461 7469 6f6e 204e 5345 5720 286e  entation NSEW (n
+00011920: 6f72 7468 2c20 736f 7574 682c 2065 6173  orth, south, eas
+00011930: 742c 2077 6573 7429 2e0a 0a20 2020 2020  t, west)...     
+00011940: 2020 204b 6579 776f 7264 2041 7267 733a     Keyword Args:
+00011950: 0a20 2020 2020 2020 2020 2020 2066 756e  .            fun
+00011960: 6374 696f 6e3a 2074 6f20 7265 6e61 6d65  ction: to rename
+00011970: 2070 6f72 7473 2e0a 2020 2020 2020 2020   ports..        
+00011980: 2020 2020 7365 6c65 6374 5f70 6f72 7473      select_ports
+00011990: 5f6f 7074 6963 616c 3a20 746f 2073 656c  _optical: to sel
+000119a0: 6563 7420 6f70 7469 6361 6c20 706f 7274  ect optical port
+000119b0: 732e 0a20 2020 2020 2020 2020 2020 2073  s..            s
+000119c0: 656c 6563 745f 706f 7274 735f 656c 6563  elect_ports_elec
+000119d0: 7472 6963 616c 3a20 746f 2073 656c 6563  trical: to selec
+000119e0: 7420 656c 6563 7472 6963 616c 2070 6f72  t electrical por
+000119f0: 7473 2e0a 2020 2020 2020 2020 2020 2020  ts..            
+00011a00: 7072 6566 6978 5f6f 7074 6963 616c 3a20  prefix_optical: 
+00011a10: 7072 6566 6978 2e0a 2020 2020 2020 2020  prefix..        
+00011a20: 2020 2020 7072 6566 6978 5f65 6c65 6374      prefix_elect
+00011a30: 7269 6361 6c3a 2070 7265 6669 782e 0a0a  rical: prefix...
+00011a40: 2020 2020 2020 2020 2e2e 2063 6f64 653a          .. code:
+00011a50: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
+00011a60: 2020 2020 2033 2020 340a 2020 2020 2020       3  4.      
+00011a70: 2020 2020 2020 2020 2020 205f 7c5f 5f7c             _|__|
+00011a80: 5f0a 2020 2020 2020 2020 2020 2020 2032  _.             2
+00011a90: 202d 7c20 2020 2020 207c 2d20 350a 2020   -|      |- 5.  
+00011aa0: 2020 2020 2020 2020 2020 2020 2020 7c20                | 
+00011ab0: 2020 2020 207c 0a20 2020 2020 2020 2020       |.         
+00011ac0: 2020 2020 3120 2d7c 5f5f 5f5f 5f5f 7c2d      1 -|______|-
+00011ad0: 2036 0a20 2020 2020 2020 2020 2020 2020   6.             
+00011ae0: 2020 2020 207c 2020 7c0a 2020 2020 2020       |  |.      
+00011af0: 2020 2020 2020 2020 2020 2020 3820 2037              8  7
+00011b00: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00011b10: 2020 2020 2073 656c 662e 6973 5f75 6e6c       self.is_unl
+00011b20: 6f63 6b65 6428 290a 2020 2020 2020 2020  ocked().        
+00011b30: 6175 746f 5f72 656e 616d 655f 706f 7274  auto_rename_port
+00011b40: 7328 7365 6c66 2c20 2a2a 6b77 6172 6773  s(self, **kwargs
+00011b50: 290a 0a20 2020 2064 6566 2061 7574 6f5f  )..    def auto_
+00011b60: 7265 6e61 6d65 5f70 6f72 7473 5f63 6f75  rename_ports_cou
+00011b70: 6e74 6572 5f63 6c6f 636b 7769 7365 2873  nter_clockwise(s
+00011b80: 656c 662c 202a 2a6b 7761 7267 7329 202d  elf, **kwargs) -
+00011b90: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00011ba0: 7365 6c66 2e69 735f 756e 6c6f 636b 6564  self.is_unlocked
+00011bb0: 2829 0a20 2020 2020 2020 2061 7574 6f5f  ().        auto_
+00011bc0: 7265 6e61 6d65 5f70 6f72 7473 5f63 6f75  rename_ports_cou
+00011bd0: 6e74 6572 5f63 6c6f 636b 7769 7365 2873  nter_clockwise(s
+00011be0: 656c 662c 202a 2a6b 7761 7267 7329 0a0a  elf, **kwargs)..
+00011bf0: 2020 2020 6465 6620 6175 746f 5f72 656e      def auto_ren
+00011c00: 616d 655f 706f 7274 735f 6c61 7965 725f  ame_ports_layer_
+00011c10: 6f72 6965 6e74 6174 696f 6e28 7365 6c66  orientation(self
+00011c20: 2c20 2a2a 6b77 6172 6773 2920 2d3e 204e  , **kwargs) -> N
+00011c30: 6f6e 653a 0a20 2020 2020 2020 2073 656c  one:.        sel
+00011c40: 662e 6973 5f75 6e6c 6f63 6b65 6428 290a  f.is_unlocked().
+00011c50: 2020 2020 2020 2020 6175 746f 5f72 656e          auto_ren
+00011c60: 616d 655f 706f 7274 735f 6c61 7965 725f  ame_ports_layer_
+00011c70: 6f72 6965 6e74 6174 696f 6e28 7365 6c66  orientation(self
+00011c80: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
+00011c90: 2064 6566 2061 7574 6f5f 7265 6e61 6d65   def auto_rename
+00011ca0: 5f70 6f72 7473 5f6f 7269 656e 7461 7469  _ports_orientati
+00011cb0: 6f6e 2873 656c 662c 202a 2a6b 7761 7267  on(self, **kwarg
+00011cc0: 7329 202d 3e20 4e6f 6e65 3a0a 2020 2020  s) -> None:.    
+00011cd0: 2020 2020 2222 2252 656e 616d 6520 706f      """Rename po
+00011ce0: 7274 7320 6279 206f 7269 656e 7461 7469  rts by orientati
+00011cf0: 6f6e 204e 5345 5720 286e 6f72 7468 2c20  on NSEW (north, 
+00011d00: 736f 7574 682c 2065 6173 742c 2077 6573  south, east, wes
+00011d10: 7429 2e0a 0a20 2020 2020 2020 204b 6579  t)...        Key
+00011d20: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
+00011d30: 2020 2020 2020 2066 756e 6374 696f 6e3a         function:
+00011d40: 2074 6f20 7265 6e61 6d65 2070 6f72 7473   to rename ports
+00011d50: 2e0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00011d60: 6c65 6374 5f70 6f72 7473 5f6f 7074 6963  lect_ports_optic
+00011d70: 616c 3a20 746f 2073 656c 6563 7420 706f  al: to select po
+00011d80: 7274 732e 0a20 2020 2020 2020 2020 2020  rts..           
+00011d90: 2073 656c 6563 745f 706f 7274 735f 656c   select_ports_el
+00011da0: 6563 7472 6963 616c 3a0a 2020 2020 2020  ectrical:.      
+00011db0: 2020 2020 2020 7072 6566 6978 5f6f 7074        prefix_opt
+00011dc0: 6963 616c 3a0a 2020 2020 2020 2020 2020  ical:.          
+00011dd0: 2020 7072 6566 6978 5f65 6c65 6374 7269    prefix_electri
+00011de0: 6361 6c3a 0a0a 2020 2020 2020 2020 2e2e  cal:..        ..
+00011df0: 2063 6f64 653a 3a0a 0a20 2020 2020 2020   code::..       
+00011e00: 2020 2020 2020 2020 2020 4e30 2020 4e31            N0  N1
+00011e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011e20: 2020 7c5f 5f5f 7c5f 0a20 2020 2020 2020    |___|_.       
+00011e30: 2020 2020 2057 3120 2d7c 2020 2020 2020       W1 -|      
+00011e40: 7c2d 2045 310a 2020 2020 2020 2020 2020  |- E1.          
+00011e50: 2020 2020 2020 7c20 2020 2020 207c 0a20        |      |. 
+00011e60: 2020 2020 2020 2020 2020 2057 3020 2d7c             W0 -|
+00011e70: 5f5f 5f5f 5f5f 7c2d 2045 300a 2020 2020  ______|- E0.    
+00011e80: 2020 2020 2020 2020 2020 2020 207c 2020               |  
+00011e90: 207c 0a20 2020 2020 2020 2020 2020 2020   |.             
+00011ea0: 2020 2053 3020 2020 5331 0a20 2020 2020     S0   S1.     
+00011eb0: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
+00011ec0: 656c 662e 6973 5f75 6e6c 6f63 6b65 6428  elf.is_unlocked(
+00011ed0: 290a 2020 2020 2020 2020 6175 746f 5f72  ).        auto_r
+00011ee0: 656e 616d 655f 706f 7274 735f 6f72 6965  ename_ports_orie
+00011ef0: 6e74 6174 696f 6e28 7365 6c66 2c20 2a2a  ntation(self, **
+00011f00: 6b77 6172 6773 290a 0a20 2020 2064 6566  kwargs)..    def
+00011f10: 206d 6f76 6528 0a20 2020 2020 2020 2073   move(.        s
+00011f20: 656c 662c 0a20 2020 2020 2020 206f 7269  elf,.        ori
+00011f30: 6769 6e3a 2046 6c6f 6174 3220 3d20 2830  gin: Float2 = (0
+00011f40: 2c20 3029 2c0a 2020 2020 2020 2020 6465  , 0),.        de
+00011f50: 7374 696e 6174 696f 6e3a 204f 7074 696f  stination: Optio
+00011f60: 6e61 6c5b 466c 6f61 7432 5d20 3d20 4e6f  nal[Float2] = No
+00011f70: 6e65 2c0a 2020 2020 2020 2020 6178 6973  ne,.        axis
+00011f80: 3a20 4f70 7469 6f6e 616c 5b41 7869 735d  : Optional[Axis]
+00011f90: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
+00011fa0: 3e20 436f 6d70 6f6e 656e 743a 0a20 2020  > Component:.   
+00011fb0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
+00011fc0: 6e65 7720 436f 6d70 6f6e 656e 7420 7769  new Component wi
+00011fd0: 7468 2061 206d 6f76 6564 2072 6566 6572  th a moved refer
+00011fe0: 656e 6365 2074 6f20 7468 6520 6f72 6967  ence to the orig
+00011ff0: 696e 616c 2e0a 0a20 2020 2020 2020 2063  inal...        c
+00012000: 6f6d 706f 6e65 6e74 2e0a 0a20 2020 2020  omponent...     
+00012010: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+00012020: 2020 2020 206f 7269 6769 6e3a 206f 6620       origin: of 
+00012030: 636f 6d70 6f6e 656e 742e 0a20 2020 2020  component..     
+00012040: 2020 2020 2020 2064 6573 7469 6e61 7469         destinati
+00012050: 6f6e 3a20 782c 2079 2e0a 2020 2020 2020  on: x, y..      
+00012060: 2020 2020 2020 6178 6973 3a20 7820 6f72        axis: x or
+00012070: 2079 2e0a 2020 2020 2020 2020 2222 220a   y..        """.
+00012080: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00012090: 6c75 6545 7272 6f72 286d 6f76 655f 6572  lueError(move_er
+000120a0: 726f 725f 6d65 7373 6167 6529 0a0a 2020  ror_message)..  
+000120b0: 2020 6465 6620 6d69 7272 6f72 2873 656c    def mirror(sel
+000120c0: 662c 2070 313a 2046 6c6f 6174 3220 3d20  f, p1: Float2 = 
+000120d0: 2830 2c20 3129 2c20 7032 3a20 466c 6f61  (0, 1), p2: Floa
+000120e0: 7432 203d 2028 302c 2030 292c 202a 2a6b  t2 = (0, 0), **k
+000120f0: 7761 7267 7329 202d 3e20 436f 6d70 6f6e  wargs) -> Compon
+00012100: 656e 743a 0a20 2020 2020 2020 2022 2222  ent:.        """
+00012110: 5265 7475 726e 7320 6e65 7720 436f 6d70  Returns new Comp
+00012120: 6f6e 656e 7420 7769 7468 2061 206d 6972  onent with a mir
+00012130: 726f 7265 6420 7265 6665 7265 6e63 652e  rored reference.
+00012140: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+00012150: 2020 2020 2020 2020 2020 2020 7031 3a20              p1: 
+00012160: 6669 7273 7420 706f 696e 7420 746f 2064  first point to d
+00012170: 6566 696e 6520 6d69 7272 6f72 2061 7869  efine mirror axi
+00012180: 732e 0a20 2020 2020 2020 2020 2020 2070  s..            p
+00012190: 323a 2073 6563 6f6e 6420 706f 696e 7420  2: second point 
+000121a0: 746f 2064 6566 696e 6520 6d69 7272 6f72  to define mirror
+000121b0: 2061 7869 732e 0a20 2020 2020 2020 2022   axis..        "
+000121c0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+000121d0: 6764 7366 6163 746f 7279 2e66 756e 6374  gdsfactory.funct
+000121e0: 696f 6e73 2069 6d70 6f72 7420 6d69 7272  ions import mirr
+000121f0: 6f72 0a0a 2020 2020 2020 2020 7265 7475  or..        retu
+00012200: 726e 206d 6972 726f 7228 636f 6d70 6f6e  rn mirror(compon
+00012210: 656e 743d 7365 6c66 2c20 7031 3d70 312c  ent=self, p1=p1,
+00012220: 2070 323d 7032 2c20 2a2a 6b77 6172 6773   p2=p2, **kwargs
+00012230: 290a 0a20 2020 2064 6566 2072 6f74 6174  )..    def rotat
+00012240: 6528 7365 6c66 2c20 616e 676c 653a 2066  e(self, angle: f
+00012250: 6c6f 6174 203d 2039 302c 202a 2a6b 7761  loat = 90, **kwa
+00012260: 7267 7329 202d 3e20 436f 6d70 6f6e 656e  rgs) -> Componen
+00012270: 743a 0a20 2020 2020 2020 2022 2222 5265  t:.        """Re
+00012280: 7475 726e 7320 6e65 7720 636f 6d70 6f6e  turns new compon
+00012290: 656e 7420 7769 7468 2061 2072 6f74 6174  ent with a rotat
+000122a0: 6564 2072 6566 6572 656e 6365 2074 6f20  ed reference to 
+000122b0: 7468 6520 6f72 6967 696e 616c 2e0a 0a20  the original... 
+000122c0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+000122d0: 2020 2020 2020 2020 2061 6e67 6c65 3a20           angle: 
+000122e0: 696e 2064 6567 7265 6573 2e0a 2020 2020  in degrees..    
+000122f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00012300: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+00012310: 6675 6e63 7469 6f6e 7320 696d 706f 7274  functions import
+00012320: 2072 6f74 6174 650a 0a20 2020 2020 2020   rotate..       
+00012330: 2072 6574 7572 6e20 726f 7461 7465 2863   return rotate(c
+00012340: 6f6d 706f 6e65 6e74 3d73 656c 662c 2061  omponent=self, a
+00012350: 6e67 6c65 3d61 6e67 6c65 2c20 2a2a 6b77  ngle=angle, **kw
+00012360: 6172 6773 290a 0a20 2020 2064 6566 2061  args)..    def a
+00012370: 6464 5f70 6164 6469 6e67 2873 656c 662c  dd_padding(self,
+00012380: 202a 2a6b 7761 7267 7329 202d 3e20 436f   **kwargs) -> Co
+00012390: 6d70 6f6e 656e 743a 0a20 2020 2020 2020  mponent:.       
+000123a0: 2022 2222 5265 7475 726e 7320 7361 6d65   """Returns same
+000123b0: 2063 6f6d 706f 6e65 6e74 2077 6974 6820   component with 
+000123c0: 7061 6464 696e 672e 0a0a 2020 2020 2020  padding...      
+000123d0: 2020 4b65 7977 6f72 6420 4172 6773 3a0a    Keyword Args:.
+000123e0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+000123f0: 6f6e 656e 743a 2066 6f72 2070 6164 6469  onent: for paddi
+00012400: 6e67 2e0a 2020 2020 2020 2020 2020 2020  ng..            
+00012410: 6c61 7965 7273 3a20 6c69 7374 206f 6620  layers: list of 
+00012420: 6c61 7965 7273 2e0a 2020 2020 2020 2020  layers..        
+00012430: 2020 2020 7375 6666 6978 2066 6f72 206e      suffix for n
+00012440: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
+00012450: 2064 6566 6175 6c74 3a20 6465 6661 756c   default: defaul
+00012460: 7420 7061 6464 696e 6720 2835 3075 6d29  t padding (50um)
+00012470: 2e0a 2020 2020 2020 2020 2020 2020 746f  ..            to
+00012480: 703a 206e 6f72 7468 2070 6164 6469 6e67  p: north padding
+00012490: 2e0a 2020 2020 2020 2020 2020 2020 626f  ..            bo
+000124a0: 7474 6f6d 3a20 736f 7574 6820 7061 6464  ttom: south padd
+000124b0: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
+000124c0: 2072 6967 6874 3a20 6561 7374 2070 6164   right: east pad
+000124d0: 6469 6e67 2e0a 2020 2020 2020 2020 2020  ding..          
+000124e0: 2020 6c65 6674 3a20 7765 7374 2070 6164    left: west pad
+000124f0: 6469 6e67 2e0a 2020 2020 2020 2020 2222  ding..        ""
+00012500: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
+00012510: 6473 6661 6374 6f72 792e 6164 645f 7061  dsfactory.add_pa
+00012520: 6464 696e 6720 696d 706f 7274 2061 6464  dding import add
+00012530: 5f70 6164 6469 6e67 0a0a 2020 2020 2020  _padding..      
+00012540: 2020 7265 7475 726e 2061 6464 5f70 6164    return add_pad
+00012550: 6469 6e67 2863 6f6d 706f 6e65 6e74 3d73  ding(component=s
+00012560: 656c 662c 202a 2a6b 7761 7267 7329 0a0a  elf, **kwargs)..
+00012570: 2020 2020 6465 6620 6162 736f 7262 2873      def absorb(s
+00012580: 656c 662c 2072 6566 6572 656e 6365 2920  elf, reference) 
+00012590: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
+000125a0: 2020 2020 2020 2222 2241 6273 6f72 6273        """Absorbs
+000125b0: 2070 6f6c 7967 6f6e 7320 6672 6f6d 2043   polygons from C
+000125c0: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+000125d0: 6520 696e 746f 2043 6f6d 706f 6e65 6e74  e into Component
+000125e0: 2e0a 0a20 2020 2020 2020 2044 6573 7472  ...        Destr
+000125f0: 6f79 7320 7468 6520 7265 6665 7265 6e63  oys the referenc
+00012600: 6520 696e 2074 6865 2070 726f 6365 7373  e in the process
+00012610: 2062 7574 206b 6565 7069 6e67 2074 6865   but keeping the
+00012620: 2070 6f6c 7967 6f6e 2067 656f 6d65 7472   polygon geometr
+00012630: 792e 0a0a 2020 2020 2020 2020 4172 6773  y...        Args
+00012640: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00012650: 6665 7265 6e63 653a 2043 6f6d 706f 6e65  ference: Compone
+00012660: 6e74 5265 6665 7265 6e63 6520 746f 2062  ntReference to b
+00012670: 6520 6162 736f 7262 6564 2069 6e74 6f20  e absorbed into 
+00012680: 7468 6520 436f 6d70 6f6e 656e 742e 0a20  the Component.. 
+00012690: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000126a0: 2020 2069 6620 7265 6665 7265 6e63 6520     if reference 
+000126b0: 6e6f 7420 696e 2073 656c 662e 7265 6665  not in self.refe
+000126c0: 7265 6e63 6573 3a0a 2020 2020 2020 2020  rences:.        
+000126d0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+000126e0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+000126f0: 2020 2020 2020 2254 6865 2072 6566 6572        "The refer
+00012700: 656e 6365 2079 6f75 2061 736b 6564 2074  ence you asked t
+00012710: 6f20 6162 736f 7262 2064 6f65 7320 6e6f  o absorb does no
+00012720: 7420 6578 6973 7420 696e 2074 6869 7320  t exist in this 
+00012730: 436f 6d70 6f6e 656e 742e 220a 2020 2020  Component.".    
+00012740: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00012750: 2020 7265 665f 706f 6c79 676f 6e73 203d    ref_polygons =
+00012760: 2072 6566 6572 656e 6365 2e67 6574 5f70   reference.get_p
+00012770: 6f6c 7967 6f6e 7328 0a20 2020 2020 2020  olygons(.       
+00012780: 2020 2020 2062 795f 7370 6563 3d46 616c       by_spec=Fal
+00012790: 7365 2c20 696e 636c 7564 655f 7061 7468  se, include_path
+000127a0: 733d 4661 6c73 652c 2061 735f 6172 7261  s=False, as_arra
+000127b0: 793d 4661 6c73 650a 2020 2020 2020 2020  y=False.        
+000127c0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+000127d0: 6164 645f 706f 6c79 676f 6e73 282a 7265  add_polygons(*re
+000127e0: 665f 706f 6c79 676f 6e73 290a 0a20 2020  f_polygons)..   
+000127f0: 2020 2020 2073 656c 662e 6164 6428 7265       self.add(re
+00012800: 6665 7265 6e63 652e 6765 745f 6c61 6265  ference.get_labe
+00012810: 6c73 2829 290a 2020 2020 2020 2020 7365  ls()).        se
+00012820: 6c66 2e61 6464 2872 6566 6572 656e 6365  lf.add(reference
+00012830: 2e67 6574 5f70 6174 6873 2829 290a 2020  .get_paths()).  
+00012840: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
+00012850: 6528 7265 6665 7265 6e63 6529 0a20 2020  e(reference).   
+00012860: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00012870: 0a0a 2020 2020 6465 6620 7265 6d6f 7665  ..    def remove
+00012880: 2873 656c 662c 2069 7465 6d73 293a 0a20  (self, items):. 
+00012890: 2020 2020 2020 2022 2222 5265 6d6f 7665         """Remove
+000128a0: 7320 6974 656d 7320 6672 6f6d 2061 2043  s items from a C
+000128b0: 6f6d 706f 6e65 6e74 2c20 7768 6963 6820  omponent, which 
+000128c0: 6361 6e20 696e 636c 7564 6520 506f 7274  can include Port
+000128d0: 732c 2050 6f6c 7967 6f6e 5365 7473 205c  s, PolygonSets \
+000128e0: 0a20 2020 2020 2020 2043 656c 6c52 6566  .        CellRef
+000128f0: 6572 656e 6365 732c 2043 6f6d 706f 6e65  erences, Compone
+00012900: 6e74 5265 6665 7265 6e63 6573 2061 6e64  ntReferences and
+00012910: 204c 6162 656c 732e 0a0a 2020 2020 2020   Labels...      
+00012920: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+00012930: 2020 2020 6974 656d 733a 206c 6973 7420      items: list 
+00012940: 6f66 2049 7465 6d73 2074 6f20 6265 2072  of Items to be r
+00012950: 656d 6f76 6564 2066 726f 6d20 7468 6520  emoved from the 
+00012960: 436f 6d70 6f6e 656e 742e 0a20 2020 2020  Component..     
+00012970: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00012980: 6620 6e6f 7420 6861 7361 7474 7228 6974  f not hasattr(it
+00012990: 656d 732c 2022 5f5f 6974 6572 5f5f 2229  ems, "__iter__")
+000129a0: 3a0a 2020 2020 2020 2020 2020 2020 6974  :.            it
+000129b0: 656d 7320 3d20 5b69 7465 6d73 5d0a 2020  ems = [items].  
+000129c0: 2020 2020 2020 666f 7220 6974 656d 2069        for item i
+000129d0: 6e20 6974 656d 733a 0a20 2020 2020 2020  n items:.       
+000129e0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+000129f0: 6365 2869 7465 6d2c 2050 6f72 7429 3a0a  ce(item, Port):.
+00012a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a10: 7365 6c66 2e70 6f72 7473 203d 207b 6b3a  self.ports = {k:
+00012a20: 2076 2066 6f72 206b 2c20 7620 696e 2073   v for k, v in s
+00012a30: 656c 662e 706f 7274 732e 6974 656d 7328  elf.ports.items(
+00012a40: 2920 6966 2076 2021 3d20 6974 656d 7d0a  ) if v != item}.
+00012a50: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00012a60: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
+00012a70: 2c20 6764 7374 6b2e 5265 6665 7265 6e63  , gdstk.Referenc
+00012a80: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00012a90: 2020 2020 7365 6c66 2e5f 6365 6c6c 2e72      self._cell.r
+00012aa0: 656d 6f76 6528 6974 656d 290a 2020 2020  emove(item).    
+00012ab0: 2020 2020 2020 2020 2020 2020 6974 656d              item
+00012ac0: 2e6f 776e 6572 203d 204e 6f6e 650a 2020  .owner = None.  
+00012ad0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
+00012ae0: 7369 6e73 7461 6e63 6528 6974 656d 2c20  sinstance(item, 
+00012af0: 436f 6d70 6f6e 656e 7452 6566 6572 656e  ComponentReferen
+00012b00: 6365 293a 0a20 2020 2020 2020 2020 2020  ce):.           
+00012b10: 2020 2020 2073 656c 662e 7265 6665 7265       self.refere
+00012b20: 6e63 6573 2e72 656d 6f76 6528 6974 656d  nces.remove(item
+00012b30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00012b40: 2020 7365 6c66 2e5f 6365 6c6c 2e72 656d    self._cell.rem
+00012b50: 6f76 6528 6974 656d 2e5f 7265 6665 7265  ove(item._refere
+00012b60: 6e63 6529 0a20 2020 2020 2020 2020 2020  nce).           
+00012b70: 2020 2020 2069 7465 6d2e 6f77 6e65 7220       item.owner 
+00012b80: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
+00012b90: 2020 2020 2020 2073 656c 662e 5f6e 616d         self._nam
+00012ba0: 6564 5f72 6566 6572 656e 6365 732e 706f  ed_references.po
+00012bb0: 7028 6974 656d 2e6e 616d 6529 0a20 2020  p(item.name).   
+00012bc0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00012bd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00012be0: 656c 662e 5f63 656c 6c2e 7265 6d6f 7665  elf._cell.remove
+00012bf0: 2869 7465 6d29 0a0a 2020 2020 2020 2020  (item)..        
+00012c00: 7365 6c66 2e5f 6262 5f76 616c 6964 203d  self._bb_valid =
+00012c10: 2046 616c 7365 0a20 2020 2020 2020 2072   False.        r
+00012c20: 6574 7572 6e20 7365 6c66 0a0a 2020 2020  eturn self..    
+00012c30: 6465 6620 6861 7368 5f67 656f 6d65 7472  def hash_geometr
+00012c40: 7928 7365 6c66 2c20 7072 6563 6973 696f  y(self, precisio
+00012c50: 6e3a 2066 6c6f 6174 203d 2031 652d 3429  n: float = 1e-4)
+00012c60: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
+00012c70: 2022 2222 5265 7475 726e 7320 616e 2053   """Returns an S
+00012c80: 4841 3120 6861 7368 206f 6620 7468 6520  HA1 hash of the 
+00012c90: 6765 6f6d 6574 7279 2069 6e20 7468 6520  geometry in the 
+00012ca0: 436f 6d70 6f6e 656e 742e 0a0a 2020 2020  Component...    
+00012cb0: 2020 2020 466f 7220 6561 6368 206c 6179      For each lay
+00012cc0: 6572 2c20 6561 6368 2070 6f6c 7967 6f6e  er, each polygon
+00012cd0: 2069 7320 696e 6469 7669 6475 616c 6c79   is individually
+00012ce0: 2068 6173 6865 6420 616e 6420 7468 656e   hashed and then
+00012cf0: 2074 6865 2070 6f6c 7967 6f6e 2068 6173   the polygon has
+00012d00: 6865 730a 2020 2020 2020 2020 6172 6520  hes.        are 
+00012d10: 736f 7274 6564 2c20 746f 2065 6e73 7572  sorted, to ensur
+00012d20: 6520 7468 6520 6861 7368 2073 7461 7973  e the hash stays
+00012d30: 2063 6f6e 7374 616e 7420 7265 6761 7264   constant regard
+00012d40: 6c65 7373 206f 6620 7468 6520 6f72 6465  less of the orde
+00012d50: 7269 6e67 0a20 2020 2020 2020 2074 6865  ring.        the
+00012d60: 2070 6f6c 7967 6f6e 732e 2020 5369 6d69   polygons.  Simi
+00012d70: 6c61 726c 792c 2074 6865 206c 6179 6572  larly, the layer
+00012d80: 7320 6172 6520 736f 7274 6564 2062 7920  s are sorted by 
+00012d90: 286c 6179 6572 2c20 6461 7461 7479 7065  (layer, datatype
+00012da0: 292e 0a0a 2020 2020 2020 2020 4172 6773  )...        Args
+00012db0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00012dc0: 6563 6973 696f 6e3a 2052 6f75 6e64 696e  ecision: Roundin
+00012dd0: 6720 7072 6563 6973 696f 6e20 666f 7220  g precision for 
+00012de0: 7468 6520 7468 6520 6f62 6a65 6374 7320  the the objects 
+00012df0: 696e 2074 6865 2043 6f6d 706f 6e65 6e74  in the Component
+00012e00: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012e10: 2020 466f 7220 696e 7374 616e 6365 2c20    For instance, 
+00012e20: 6120 7072 6563 6973 696f 6e20 6f66 2031  a precision of 1
+00012e30: 652d 3220 7769 6c6c 2072 6f75 6e64 2061  e-2 will round a
+00012e40: 2070 6f69 6e74 2061 740a 2020 2020 2020   point at.      
+00012e50: 2020 2020 2020 2020 2020 2830 2e31 3234            (0.124
+00012e60: 2c20 312e 3734 3829 2074 6f20 2830 2e31  , 1.748) to (0.1
+00012e70: 322c 2031 2e37 3529 2e0a 0a20 2020 2020  2, 1.75)...     
+00012e80: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
+00012e90: 6f6c 7967 6f6e 735f 6279 5f73 7065 6320  olygons_by_spec 
+00012ea0: 3d20 7365 6c66 2e67 6574 5f70 6f6c 7967  = self.get_polyg
+00012eb0: 6f6e 7328 6279 5f73 7065 633d 5472 7565  ons(by_spec=True
+00012ec0: 2c20 6173 5f61 7272 6179 3d46 616c 7365  , as_array=False
+00012ed0: 290a 2020 2020 2020 2020 6c61 7965 7273  ).        layers
+00012ee0: 203d 206e 702e 6172 7261 7928 6c69 7374   = np.array(list
+00012ef0: 2870 6f6c 7967 6f6e 735f 6279 5f73 7065  (polygons_by_spe
+00012f00: 632e 6b65 7973 2829 2929 0a20 2020 2020  c.keys())).     
+00012f10: 2020 2073 6f72 7465 645f 6c61 7965 7273     sorted_layers
+00012f20: 203d 206c 6179 6572 735b 6e70 2e6c 6578   = layers[np.lex
+00012f30: 736f 7274 2828 6c61 7965 7273 5b3a 2c20  sort((layers[:, 
+00012f40: 305d 2c20 6c61 7965 7273 5b3a 2c20 315d  0], layers[:, 1]
+00012f50: 2929 5d0a 0a20 2020 2020 2020 2066 696e  ))]..        fin
+00012f60: 616c 5f68 6173 6820 3d20 6861 7368 6c69  al_hash = hashli
+00012f70: 622e 7368 6131 2829 0a20 2020 2020 2020  b.sha1().       
+00012f80: 2066 6f72 206c 6179 6572 2069 6e20 736f   for layer in so
+00012f90: 7274 6564 5f6c 6179 6572 733a 0a20 2020  rted_layers:.   
+00012fa0: 2020 2020 2020 2020 206c 6179 6572 5f68           layer_h
+00012fb0: 6173 6820 3d20 6861 7368 6c69 622e 7368  ash = hashlib.sh
+00012fc0: 6131 286c 6179 6572 2e61 7374 7970 6528  a1(layer.astype(
+00012fd0: 6e70 2e69 6e74 3634 2929 2e64 6967 6573  np.int64)).diges
+00012fe0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+00012ff0: 706f 6c79 676f 6e73 203d 2070 6f6c 7967  polygons = polyg
+00013000: 6f6e 735f 6279 5f73 7065 635b 7475 706c  ons_by_spec[tupl
+00013010: 6528 6c61 7965 7229 5d0a 2020 2020 2020  e(layer)].      
+00013020: 2020 2020 2020 706f 6c79 676f 6e73 203d        polygons =
+00013030: 205b 5f72 6e64 2870 2e70 6f69 6e74 732c   [_rnd(p.points,
+00013040: 2070 7265 6369 7369 6f6e 2920 666f 7220   precision) for 
+00013050: 7020 696e 2070 6f6c 7967 6f6e 735d 0a20  p in polygons]. 
+00013060: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+00013070: 6f6e 5f68 6173 6865 7320 3d20 6e70 2e73  on_hashes = np.s
+00013080: 6f72 7428 5b68 6173 686c 6962 2e73 6861  ort([hashlib.sha
+00013090: 3128 7029 2e64 6967 6573 7428 2920 666f  1(p).digest() fo
+000130a0: 7220 7020 696e 2070 6f6c 7967 6f6e 735d  r p in polygons]
+000130b0: 290a 2020 2020 2020 2020 2020 2020 6669  ).            fi
+000130c0: 6e61 6c5f 6861 7368 2e75 7064 6174 6528  nal_hash.update(
+000130d0: 6c61 7965 725f 6861 7368 290a 2020 2020  layer_hash).    
+000130e0: 2020 2020 2020 2020 666f 7220 7068 2069          for ph i
+000130f0: 6e20 706f 6c79 676f 6e5f 6861 7368 6573  n polygon_hashes
+00013100: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013110: 2020 6669 6e61 6c5f 6861 7368 2e75 7064    final_hash.upd
+00013120: 6174 6528 7068 290a 0a20 2020 2020 2020  ate(ph)..       
+00013130: 2072 6574 7572 6e20 6669 6e61 6c5f 6861   return final_ha
+00013140: 7368 2e68 6578 6469 6765 7374 2829 0a0a  sh.hexdigest()..
+00013150: 2020 2020 6465 6620 6765 745f 6c61 6265      def get_labe
+00013160: 6c73 280a 2020 2020 2020 2020 7365 6c66  ls(.        self
+00013170: 2c20 6170 706c 795f 7265 7065 7469 7469  , apply_repetiti
+00013180: 6f6e 733d 5472 7565 2c20 6465 7074 683a  ons=True, depth:
+00013190: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
+000131a0: 204e 6f6e 652c 206c 6179 6572 3d4e 6f6e   None, layer=Non
+000131b0: 650a 2020 2020 2920 2d3e 204c 6973 745b  e.    ) -> List[
+000131c0: 4c61 6265 6c5d 3a0a 2020 2020 2020 2020  Label]:.        
+000131d0: 2222 2252 6574 7572 6e20 6c61 6265 6c73  """Return labels
+000131e0: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+000131f0: 0a20 2020 2020 2020 2020 2020 2061 7070  .            app
+00013200: 6c79 5f72 6570 6574 6974 696f 6e73 3a2e  ly_repetitions:.
+00013210: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
+00013220: 7468 3a20 4e6f 6e65 2072 6574 7572 6e73  th: None returns
+00013230: 2061 6c6c 206c 6162 656c 7320 616e 6420   all labels and 
+00013240: 3020 746f 7020 6c65 7665 6c2e 0a20 2020  0 top level..   
+00013250: 2020 2020 2020 2020 206c 6179 6572 3a20           layer: 
+00013260: 6c61 7965 7273 7065 632e 0a20 2020 2020  layerspec..     
+00013270: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+00013280: 726f 6d20 6764 7366 6163 746f 7279 2e70  rom gdsfactory.p
+00013290: 646b 2069 6d70 6f72 7420 6765 745f 6c61  dk import get_la
+000132a0: 7965 720a 0a20 2020 2020 2020 2069 6620  yer..        if 
+000132b0: 6c61 7965 723a 0a20 2020 2020 2020 2020  layer:.         
+000132c0: 2020 206c 6179 6572 2c20 7465 7874 7479     layer, textty
+000132d0: 7065 203d 2067 6574 5f6c 6179 6572 286c  pe = get_layer(l
+000132e0: 6179 6572 290a 2020 2020 2020 2020 656c  ayer).        el
+000132f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00013300: 7465 7874 7479 7065 203d 204e 6f6e 650a  texttype = None.
+00013310: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00013320: 656c 662e 5f63 656c 6c2e 6765 745f 6c61  elf._cell.get_la
+00013330: 6265 6c73 280a 2020 2020 2020 2020 2020  bels(.          
+00013340: 2020 6170 706c 795f 7265 7065 7469 7469    apply_repetiti
+00013350: 6f6e 733d 6170 706c 795f 7265 7065 7469  ons=apply_repeti
+00013360: 7469 6f6e 732c 0a20 2020 2020 2020 2020  tions,.         
+00013370: 2020 2064 6570 7468 3d64 6570 7468 2c0a     depth=depth,.
+00013380: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00013390: 723d 6c61 7965 722c 0a20 2020 2020 2020  r=layer,.       
+000133a0: 2020 2020 2074 6578 7474 7970 653d 7465       texttype=te
+000133b0: 7874 7479 7065 2c0a 2020 2020 2020 2020  xttype,.        
+000133c0: 290a 0a20 2020 2064 6566 2072 656d 6f76  )..    def remov
+000133d0: 655f 6c61 6265 6c73 2873 656c 6629 202d  e_labels(self) -
+000133e0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000133f0: 2222 2252 656d 6f76 6520 6c61 6265 6c73  """Remove labels
+00013400: 2e22 2222 0a20 2020 2020 2020 2073 656c  .""".        sel
+00013410: 662e 5f63 656c 6c2e 7265 6d6f 7665 282a  f._cell.remove(*
+00013420: 7365 6c66 2e6c 6162 656c 7329 0a0a 2020  self.labels)..  
+00013430: 2020 2320 4465 7072 6563 6174 6564 0a20    # Deprecated. 
+00013440: 2020 2064 6566 2067 6574 5f69 6e66 6f28     def get_info(
+00013450: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+00013460: 2222 4761 7468 6572 7320 7468 6520 2e69  ""Gathers the .i
+00013470: 6e66 6f20 6469 6374 696f 6e61 7269 6573  nfo dictionaries
+00013480: 2066 726f 6d20 6576 6572 7920 7375 622d   from every sub-
+00013490: 436f 6d70 6f6e 656e 7420 616e 6420 7265  Component and re
+000134a0: 7475 726e 7320 7468 656d 2069 6e20 6120  turns them in a 
+000134b0: 6c69 7374 2e0a 0a20 2020 2020 2020 2041  list...        A
+000134c0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+000134d0: 2064 6570 7468 3a20 696e 7420 6f72 204e   depth: int or N
+000134e0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+000134f0: 2020 2020 4966 206e 6f74 204e 6f6e 652c      If not None,
+00013500: 2064 6566 696e 6573 2066 726f 6d20 686f   defines from ho
+00013510: 7720 6d61 6e79 2072 6566 6572 656e 6365  w many reference
+00013520: 206c 6576 656c 7320 746f 0a20 2020 2020   levels to.     
+00013530: 2020 2020 2020 2020 2020 2072 6574 7269             retri
+00013540: 6576 6520 506f 7274 7320 6672 6f6d 2e0a  eve Ports from..
+00013550: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00013560: 3a0a 2020 2020 2020 2020 2020 2020 6c69  :.            li
+00013570: 7374 206f 6620 6469 6374 696f 6e61 7269  st of dictionari
+00013580: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+00013590: 2020 204c 6973 7420 6f66 2074 6865 2022     List of the "
+000135a0: 2e69 6e66 6f22 2070 726f 7065 7274 7920  .info" property 
+000135b0: 6469 6374 696f 6e61 7269 6573 2066 726f  dictionaries fro
+000135c0: 6d20 616c 6c20 7375 622d 436f 6d70 6f6e  m all sub-Compon
+000135d0: 656e 7473 0a20 2020 2020 2020 2022 2222  ents.        """
+000135e0: 0a20 2020 2020 2020 2044 5f6c 6973 7420  .        D_list 
+000135f0: 3d20 7365 6c66 2e67 6574 5f64 6570 656e  = self.get_depen
+00013600: 6465 6e63 6965 7328 7265 6375 7273 6976  dencies(recursiv
+00013610: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
+00013620: 7265 7475 726e 205b 442e 696e 666f 2e63  return [D.info.c
+00013630: 6f70 7928 2920 666f 7220 4420 696e 2044  opy() for D in D
+00013640: 5f6c 6973 745d 0a0a 2020 2020 6465 6620  _list]..    def 
+00013650: 7265 6d61 705f 6c61 7965 7273 280a 2020  remap_layers(.  
+00013660: 2020 2020 2020 7365 6c66 2c20 6c61 7965        self, laye
+00013670: 726d 6170 2c20 696e 636c 7564 655f 6c61  rmap, include_la
+00013680: 6265 6c73 3a20 626f 6f6c 203d 2054 7275  bels: bool = Tru
+00013690: 652c 2069 6e63 6c75 6465 5f70 6174 6873  e, include_paths
+000136a0: 3a20 626f 6f6c 203d 2054 7275 650a 2020  : bool = True.  
+000136b0: 2020 2920 2d3e 2043 6f6d 706f 6e65 6e74    ) -> Component
+000136c0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+000136d0: 7572 6e73 2061 2063 6f70 7920 6f66 2074  urns a copy of t
+000136e0: 6865 2063 6f6d 706f 6e65 6e74 2077 6974  he component wit
+000136f0: 6820 7265 6d61 7070 6564 206c 6179 6572  h remapped layer
+00013700: 732e 0a0a 2020 2020 2020 2020 4172 6773  s...        Args
+00013710: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
+00013720: 7965 726d 6170 3a20 4469 6374 696f 6e61  yermap: Dictiona
+00013730: 7279 206f 6620 7661 6c75 6573 2069 6e20  ry of values in 
+00013740: 666f 726d 6174 207b 6c61 7965 725f 6672  format {layer_fr
+00013750: 6f6d 203a 206c 6179 6572 5f74 6f7d 2e0a  om : layer_to}..
+00013760: 2020 2020 2020 2020 2020 2020 696e 636c              incl
+00013770: 7564 655f 6c61 6265 6c73 3a20 5365 6c65  ude_labels: Sele
+00013780: 6374 7320 7768 6574 6865 7220 746f 206d  cts whether to m
+00013790: 6f76 6520 4c61 6265 6c73 2061 6c6f 6e67  ove Labels along
+000137a0: 2077 6974 6820 706f 6c79 676f 6e73 2e0a   with polygons..
+000137b0: 2020 2020 2020 2020 2020 2020 696e 636c              incl
+000137c0: 7564 655f 7061 7468 733a 2053 656c 6563  ude_paths: Selec
+000137d0: 7473 2077 6865 7468 6572 2074 6f20 6d6f  ts whether to mo
+000137e0: 7665 2050 6174 6873 2061 6c6f 6e67 2077  ve Paths along w
+000137f0: 6974 6820 706f 6c79 676f 6e73 2e0a 2020  ith polygons..  
+00013800: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00013810: 2020 636f 6d70 6f6e 656e 7420 3d20 7365    component = se
+00013820: 6c66 2e63 6f70 7928 290a 2020 2020 2020  lf.copy().      
+00013830: 2020 6c61 7965 726d 6170 203d 207b 5f70    layermap = {_p
+00013840: 6172 7365 5f6c 6179 6572 286b 293a 205f  arse_layer(k): _
+00013850: 7061 7273 655f 6c61 7965 7228 7629 2066  parse_layer(v) f
+00013860: 6f72 206b 2c20 7620 696e 206c 6179 6572  or k, v in layer
+00013870: 6d61 702e 6974 656d 7328 297d 0a0a 2020  map.items()}..  
+00013880: 2020 2020 2020 616c 6c5f 4420 3d20 6c69        all_D = li
+00013890: 7374 2863 6f6d 706f 6e65 6e74 2e67 6574  st(component.get
+000138a0: 5f64 6570 656e 6465 6e63 6965 7328 5472  _dependencies(Tr
+000138b0: 7565 2929 0a20 2020 2020 2020 2061 6c6c  ue)).        all
+000138c0: 5f44 2e61 7070 656e 6428 636f 6d70 6f6e  _D.append(compon
+000138d0: 656e 7429 0a20 2020 2020 2020 2066 6f72  ent).        for
+000138e0: 2044 2069 6e20 616c 6c5f 443a 0a20 2020   D in all_D:.   
+000138f0: 2020 2020 2020 2020 2066 6f72 2070 2069           for p i
+00013900: 6e20 442e 706f 6c79 676f 6e73 3a0a 2020  n D.polygons:.  
+00013910: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00013920: 7965 7220 3d20 2870 2e6c 6179 6572 2c20  yer = (p.layer, 
+00013930: 702e 6461 7461 7479 7065 290a 2020 2020  p.datatype).    
+00013940: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00013950: 6179 6572 2069 6e20 6c61 7965 726d 6170  ayer in layermap
+00013960: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013970: 2020 2020 2020 6e65 775f 6c61 7965 7220        new_layer 
+00013980: 3d20 6c61 7965 726d 6170 5b6c 6179 6572  = layermap[layer
+00013990: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000139a0: 2020 2020 2020 702e 6c61 7965 7220 3d20        p.layer = 
+000139b0: 6e65 775f 6c61 7965 725b 305d 0a20 2020  new_layer[0].   
+000139c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000139d0: 2070 2e64 6174 6174 7970 6520 3d20 6e65   p.datatype = ne
+000139e0: 775f 6c61 7965 725b 315d 0a20 2020 2020  w_layer[1].     
+000139f0: 2020 2020 2020 2069 6620 696e 636c 7564         if includ
+00013a00: 655f 6c61 6265 6c73 3a0a 2020 2020 2020  e_labels:.      
+00013a10: 2020 2020 2020 2020 2020 666f 7220 6c61            for la
+00013a20: 6265 6c20 696e 2044 2e6c 6162 656c 733a  bel in D.labels:
+00013a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013a40: 2020 2020 206f 7269 6769 6e61 6c5f 6c61       original_la
+00013a50: 7965 7220 3d20 286c 6162 656c 2e6c 6179  yer = (label.lay
+00013a60: 6572 2c20 6c61 6265 6c2e 7465 7874 7479  er, label.textty
+00013a70: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
+00013a80: 2020 2020 2020 2020 6f72 6967 696e 616c          original
+00013a90: 5f6c 6179 6572 203d 205f 7061 7273 655f  _layer = _parse_
+00013aa0: 6c61 7965 7228 6f72 6967 696e 616c 5f6c  layer(original_l
+00013ab0: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
+00013ac0: 2020 2020 2020 2020 2020 6966 206f 7269            if ori
+00013ad0: 6769 6e61 6c5f 6c61 7965 7220 696e 206c  ginal_layer in l
+00013ae0: 6179 6572 6d61 703a 0a20 2020 2020 2020  ayermap:.       
+00013af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b00: 206e 6577 5f6c 6179 6572 203d 206c 6179   new_layer = lay
+00013b10: 6572 6d61 705b 6f72 6967 696e 616c 5f6c  ermap[original_l
+00013b20: 6179 6572 5d0a 2020 2020 2020 2020 2020  ayer].          
+00013b30: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00013b40: 6265 6c2e 6c61 7965 7220 3d20 6e65 775f  bel.layer = new_
+00013b50: 6c61 7965 725b 305d 0a20 2020 2020 2020  layer[0].       
+00013b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b70: 206c 6162 656c 2e74 6578 7474 7970 6520   label.texttype 
+00013b80: 3d20 6e65 775f 6c61 7965 725b 315d 0a0a  = new_layer[1]..
+00013b90: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00013ba0: 6e63 6c75 6465 5f70 6174 6873 3a0a 2020  nclude_paths:.  
+00013bb0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00013bc0: 7220 7061 7468 2069 6e20 442e 7061 7468  r path in D.path
+00013bd0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00013be0: 2020 2020 2020 206e 6577 5f6c 6179 6572         new_layer
+00013bf0: 7320 3d20 6c69 7374 2870 6174 682e 6c61  s = list(path.la
+00013c00: 7965 7273 290a 2020 2020 2020 2020 2020  yers).          
+00013c10: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
+00013c20: 7461 7479 7065 7320 3d20 6c69 7374 2870  tatypes = list(p
+00013c30: 6174 682e 6461 7461 7479 7065 7329 0a20  ath.datatypes). 
 00013c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c50: 2069 6620 6f72 6967 696e 616c 5f6c 6179   if original_lay
-00013c60: 6572 2069 6e20 6c61 7965 726d 6170 3a0a  er in layermap:.
-00013c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c80: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00013c90: 6c61 7965 7220 3d20 6c61 7965 726d 6170  layer = layermap
-00013ca0: 5b6f 7269 6769 6e61 6c5f 6c61 7965 725d  [original_layer]
-00013cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013cc0: 2020 2020 2020 2020 2020 2020 206e 6577               new
-00013cd0: 5f6c 6179 6572 735b 6c61 7965 725f 6e75  _layers[layer_nu
-00013ce0: 6d62 6572 5d20 3d20 6e65 775f 6c61 7965  mber] = new_laye
-00013cf0: 725b 305d 0a20 2020 2020 2020 2020 2020  r[0].           
-00013d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d10: 206e 6577 5f64 6174 6174 7970 6573 5b6c   new_datatypes[l
-00013d20: 6179 6572 5f6e 756d 6265 725d 203d 206e  ayer_number] = n
-00013d30: 6577 5f6c 6179 6572 5b31 5d0a 2020 2020  ew_layer[1].    
-00013d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d50: 7061 7468 2e73 6574 5f6c 6179 6572 7328  path.set_layers(
-00013d60: 2a6e 6577 5f6c 6179 6572 7329 0a20 2020  *new_layers).   
-00013d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d80: 2070 6174 682e 7365 745f 6461 7461 7479   path.set_dataty
-00013d90: 7065 7328 2a6e 6577 5f64 6174 6174 7970  pes(*new_datatyp
-00013da0: 6573 290a 2020 2020 2020 2020 7265 7475  es).        retu
-00013db0: 726e 2063 6f6d 706f 6e65 6e74 0a0a 2020  rn component..  
-00013dc0: 2020 6465 6620 746f 5f33 6428 0a20 2020    def to_3d(.   
-00013dd0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00013de0: 2020 206c 6179 6572 5f76 6965 7773 3a20     layer_views: 
-00013df0: 4f70 7469 6f6e 616c 5b4c 6179 6572 5669  Optional[LayerVi
-00013e00: 6577 735d 203d 204e 6f6e 652c 0a20 2020  ews] = None,.   
-00013e10: 2020 2020 206c 6179 6572 5f73 7461 636b       layer_stack
-00013e20: 3a20 4f70 7469 6f6e 616c 5b4c 6179 6572  : Optional[Layer
-00013e30: 5374 6163 6b5d 203d 204e 6f6e 652c 0a20  Stack] = None,. 
-00013e40: 2020 2020 2020 2065 7863 6c75 6465 5f6c         exclude_l
-00013e50: 6179 6572 733a 204f 7074 696f 6e61 6c5b  ayers: Optional[
-00013e60: 5475 706c 655b 4c61 7965 722c 202e 2e2e  Tuple[Layer, ...
-00013e70: 5d5d 203d 204e 6f6e 652c 0a20 2020 2029  ]] = None,.    )
-00013e80: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-00013e90: 7572 6e20 436f 6d70 6f6e 656e 7420 3344  urn Component 3D
-00013ea0: 2074 7269 6d65 7368 2053 6365 6e65 2e0a   trimesh Scene..
-00013eb0: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-00013ec0: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
-00013ed0: 6e65 6e74 3a20 746f 2065 7874 7275 6465  nent: to extrude
-00013ee0: 2069 6e20 3344 2e0a 2020 2020 2020 2020   in 3D..        
-00013ef0: 2020 2020 6c61 7965 725f 7669 6577 733a      layer_views:
-00013f00: 206c 6179 6572 2063 6f6c 6f72 7320 6672   layer colors fr
-00013f10: 6f6d 204b 6c61 796f 7574 204c 6179 6572  om Klayout Layer
-00013f20: 2050 726f 7065 7274 6965 7320 6669 6c65   Properties file
-00013f30: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013f40: 2020 4465 6661 756c 7473 2074 6f20 6163    Defaults to ac
-00013f50: 7469 7665 2050 444b 2e6c 6179 6572 5f76  tive PDK.layer_v
-00013f60: 6965 7773 2e0a 2020 2020 2020 2020 2020  iews..          
-00013f70: 2020 6c61 7965 725f 7374 6163 6b3a 2063    layer_stack: c
-00013f80: 6f6e 7461 696e 7320 7468 6963 6b6e 6573  ontains thicknes
-00013f90: 7320 616e 6420 7a6d 696e 2066 6f72 2065  s and zmin for e
-00013fa0: 6163 6820 6c61 7965 722e 0a20 2020 2020  ach layer..     
-00013fb0: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
-00013fc0: 6c74 7320 746f 2061 6374 6976 6520 5044  lts to active PD
-00013fd0: 4b2e 6c61 7965 725f 7374 6163 6b2e 0a20  K.layer_stack.. 
-00013fe0: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
-00013ff0: 6465 5f6c 6179 6572 733a 206c 6179 6572  de_layers: layer
-00014000: 7320 746f 2065 7863 6c75 6465 2e0a 0a20  s to exclude... 
-00014010: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00014020: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-00014030: 7279 2e65 7870 6f72 742e 746f 5f33 6420  ry.export.to_3d 
-00014040: 696d 706f 7274 2074 6f5f 3364 0a0a 2020  import to_3d..  
-00014050: 2020 2020 2020 7265 7475 726e 2074 6f5f        return to_
-00014060: 3364 280a 2020 2020 2020 2020 2020 2020  3d(.            
-00014070: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
-00014080: 2020 6c61 7965 725f 7669 6577 733d 6c61    layer_views=la
-00014090: 7965 725f 7669 6577 732c 0a20 2020 2020  yer_views,.     
-000140a0: 2020 2020 2020 206c 6179 6572 5f73 7461         layer_sta
-000140b0: 636b 3d6c 6179 6572 5f73 7461 636b 2c0a  ck=layer_stack,.
-000140c0: 2020 2020 2020 2020 2020 2020 6578 636c              excl
-000140d0: 7564 655f 6c61 7965 7273 3d65 7863 6c75  ude_layers=exclu
-000140e0: 6465 5f6c 6179 6572 732c 0a20 2020 2020  de_layers,.     
-000140f0: 2020 2029 0a0a 2020 2020 6465 6620 746f     )..    def to
-00014100: 5f6e 7028 0a20 2020 2020 2020 2073 656c  _np(.        sel
-00014110: 662c 0a20 2020 2020 2020 206e 6d5f 7065  f,.        nm_pe
-00014120: 725f 7069 7865 6c3a 2069 6e74 203d 2032  r_pixel: int = 2
-00014130: 302c 0a20 2020 2020 2020 206c 6179 6572  0,.        layer
-00014140: 733a 204c 6179 6572 7320 3d20 2828 312c  s: Layers = ((1,
-00014150: 2030 292c 292c 0a20 2020 2020 2020 2076   0),),.        v
-00014160: 616c 7565 733a 204f 7074 696f 6e61 6c5b  alues: Optional[
-00014170: 5475 706c 655b 666c 6f61 742c 202e 2e2e  Tuple[float, ...
-00014180: 5d5d 203d 204e 6f6e 652c 0a20 2020 2020  ]] = None,.     
-00014190: 2020 2070 6164 5f77 6964 7468 3a20 696e     pad_width: in
-000141a0: 7420 3d20 312c 0a20 2020 2029 202d 3e20  t = 1,.    ) -> 
-000141b0: 6e70 2e6e 6461 7272 6179 3a0a 2020 2020  np.ndarray:.    
-000141c0: 2020 2020 2222 2252 6574 7572 6e73 2061      """Returns a
-000141d0: 2070 6978 656c 6174 6564 206e 756d 7079   pixelated numpy
-000141e0: 2061 7272 6179 2066 726f 6d20 436f 6d70   array from Comp
-000141f0: 6f6e 656e 7420 706f 6c79 676f 6e73 2e0a  onent polygons..
-00014200: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-00014210: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
-00014220: 6e65 6e74 3a20 436f 6d70 6f6e 656e 742e  nent: Component.
-00014230: 0a20 2020 2020 2020 2020 2020 206e 6d5f  .            nm_
-00014240: 7065 725f 7069 7865 6c3a 2079 6f75 2063  per_pixel: you c
-00014250: 616e 2067 6f20 6672 6f6d 2032 3020 2863  an go from 20 (c
-00014260: 6f61 7273 6529 2074 6f20 3420 2866 696e  oarse) to 4 (fin
-00014270: 6529 2e0a 2020 2020 2020 2020 2020 2020  e)..            
-00014280: 6c61 7965 7273 3a20 746f 2063 6f6e 7665  layers: to conve
-00014290: 7274 2e20 4f72 6465 7220 6d61 7474 6572  rt. Order matter
-000142a0: 7320 286c 6174 7465 7220 6f76 6572 7772  s (latter overwr
-000142b0: 6974 6520 666f 726d 6572 292e 0a20 2020  ite former)..   
-000142c0: 2020 2020 2020 2020 2076 616c 7565 733a           values:
-000142d0: 2061 7373 6f63 6961 7465 6420 746f 2065   associated to e
-000142e0: 6163 6820 6c61 7965 7220 2864 6566 6175  ach layer (defau
-000142f0: 6c74 7320 746f 2031 292e 0a20 2020 2020  lts to 1)..     
-00014300: 2020 2020 2020 2070 6164 5f77 6964 7468         pad_width
-00014310: 3a20 7061 6464 696e 6720 7069 7865 6c73  : padding pixels
-00014320: 2061 726f 756e 6420 7468 6520 696d 6167   around the imag
-00014330: 652e 0a0a 2020 2020 2020 2020 2222 220a  e...        """.
-00014340: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
-00014350: 6661 6374 6f72 792e 6578 706f 7274 2e74  factory.export.t
-00014360: 6f5f 6e70 2069 6d70 6f72 7420 746f 5f6e  o_np import to_n
-00014370: 700a 0a20 2020 2020 2020 2072 6574 7572  p..        retur
-00014380: 6e20 746f 5f6e 7028 0a20 2020 2020 2020  n to_np(.       
-00014390: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-000143a0: 2020 2020 2020 206e 6d5f 7065 725f 7069         nm_per_pi
-000143b0: 7865 6c3d 6e6d 5f70 6572 5f70 6978 656c  xel=nm_per_pixel
-000143c0: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
-000143d0: 7965 7273 3d6c 6179 6572 732c 0a20 2020  yers=layers,.   
-000143e0: 2020 2020 2020 2020 2076 616c 7565 733d           values=
-000143f0: 7661 6c75 6573 2c0a 2020 2020 2020 2020  values,.        
-00014400: 2020 2020 7061 645f 7769 6474 683d 7061      pad_width=pa
-00014410: 645f 7769 6474 682c 0a20 2020 2020 2020  d_width,.       
-00014420: 2029 0a0a 2020 2020 6465 6620 7772 6974   )..    def writ
-00014430: 655f 7374 6c28 0a20 2020 2020 2020 2073  e_stl(.        s
-00014440: 656c 662c 0a20 2020 2020 2020 2066 696c  elf,.        fil
-00014450: 6570 6174 683a 2073 7472 2c0a 2020 2020  epath: str,.    
-00014460: 2020 2020 6c61 7965 725f 7374 6163 6b3a      layer_stack:
-00014470: 204f 7074 696f 6e61 6c5b 4c61 7965 7253   Optional[LayerS
-00014480: 7461 636b 5d20 3d20 4e6f 6e65 2c0a 2020  tack] = None,.  
-00014490: 2020 2020 2020 6578 636c 7564 655f 6c61        exclude_la
-000144a0: 7965 7273 3a20 4f70 7469 6f6e 616c 5b54  yers: Optional[T
-000144b0: 7570 6c65 5b4c 6179 6572 2c20 2e2e 2e5d  uple[Layer, ...]
-000144c0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2920  ] = None,.    ) 
-000144d0: 2d3e 206e 702e 6e64 6172 7261 793a 0a20  -> np.ndarray:. 
-000144e0: 2020 2020 2020 2022 2222 5772 6974 6520         """Write 
-000144f0: 6120 436f 6d70 6f6e 656e 7420 746f 2053  a Component to S
-00014500: 544c 2066 6f72 2033 4420 7072 696e 7469  TL for 3D printi
-00014510: 6e67 2e0a 0a20 2020 2020 2020 2041 7267  ng...        Arg
-00014520: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
-00014530: 696c 6570 6174 683a 2074 6f20 7772 6974  ilepath: to writ
-00014540: 6520 5354 4c20 746f 2e0a 2020 2020 2020  e STL to..      
-00014550: 2020 2020 2020 6c61 7965 725f 7374 6163        layer_stac
-00014560: 6b3a 2063 6f6e 7461 696e 7320 7468 6963  k: contains thic
-00014570: 6b6e 6573 7320 616e 6420 7a6d 696e 2066  kness and zmin f
-00014580: 6f72 2065 6163 6820 6c61 7965 722e 0a20  or each layer.. 
-00014590: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
-000145a0: 6465 5f6c 6179 6572 733a 206c 6179 6572  de_layers: layer
-000145b0: 7320 746f 2065 7863 6c75 6465 2e0a 2020  s to exclude..  
-000145c0: 2020 2020 2020 2020 2020 7573 655f 6c61            use_la
-000145d0: 7965 725f 6e61 6d65 3a20 4966 2054 7275  yer_name: If Tru
-000145e0: 652c 2075 7365 7320 4c61 7965 724c 6576  e, uses LayerLev
-000145f0: 656c 206e 616d 6573 2069 6e20 6f75 7470  el names in outp
-00014600: 7574 2066 696c 656e 616d 6573 2072 6174  ut filenames rat
-00014610: 6865 7220 7468 616e 2067 6473 5f6c 6179  her than gds_lay
-00014620: 6572 2061 6e64 2067 6473 5f64 6174 6174  er and gds_datat
-00014630: 7970 652e 0a20 2020 2020 2020 2020 2020  ype..           
-00014640: 2068 756c 6c5f 696e 7661 6c69 645f 706f   hull_invalid_po
-00014650: 6c79 676f 6e73 3a20 4966 2054 7275 652c  lygons: If True,
-00014660: 2072 6570 6c61 6365 7320 696e 7661 6c69   replaces invali
-00014670: 6420 706f 6c79 676f 6e73 2028 6465 7465  d polygons (dete
-00014680: 726d 696e 6564 2062 7920 7368 6170 656c  rmined by shapel
-00014690: 792e 506f 6c79 676f 6e2e 6973 5f76 616c  y.Polygon.is_val
-000146a0: 6964 2920 7769 7468 2069 7473 2063 6f6e  id) with its con
-000146b0: 7665 7820 6875 6c6c 2e0a 2020 2020 2020  vex hull..      
-000146c0: 2020 2020 2020 7363 616c 653a 204f 7074        scale: Opt
-000146d0: 696f 6e61 6c20 6661 6374 6f72 2062 7920  ional factor by 
-000146e0: 7768 6963 6820 746f 2073 6361 6c65 206d  which to scale m
-000146f0: 6573 6865 7320 6265 666f 7265 2077 7269  eshes before wri
-00014700: 7469 6e67 2e0a 0a20 2020 2020 2020 2022  ting...        "
-00014710: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-00014720: 6764 7366 6163 746f 7279 2e65 7870 6f72  gdsfactory.expor
-00014730: 742e 746f 5f73 746c 2069 6d70 6f72 7420  t.to_stl import 
-00014740: 746f 5f73 746c 0a0a 2020 2020 2020 2020  to_stl..        
-00014750: 7265 7475 726e 2074 6f5f 7374 6c28 0a20  return to_stl(. 
-00014760: 2020 2020 2020 2020 2020 2073 656c 662c             self,
-00014770: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00014780: 6570 6174 683d 6669 6c65 7061 7468 2c0a  epath=filepath,.
-00014790: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-000147a0: 725f 7374 6163 6b3d 6c61 7965 725f 7374  r_stack=layer_st
-000147b0: 6163 6b2c 0a20 2020 2020 2020 2020 2020  ack,.           
-000147c0: 2065 7863 6c75 6465 5f6c 6179 6572 733d   exclude_layers=
-000147d0: 6578 636c 7564 655f 6c61 7965 7273 2c0a  exclude_layers,.
-000147e0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-000147f0: 6566 2074 6f5f 676d 7368 280a 2020 2020  ef to_gmsh(.    
-00014800: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00014810: 2020 7479 7065 2c0a 2020 2020 2020 2020    type,.        
-00014820: 7a3d 4e6f 6e65 2c0a 2020 2020 2020 2020  z=None,.        
-00014830: 7873 6563 7469 6f6e 5f62 6f75 6e64 733d  xsection_bounds=
-00014840: 4e6f 6e65 2c0a 2020 2020 2020 2020 6c61  None,.        la
-00014850: 7965 725f 7374 6163 6b3d 4e6f 6e65 2c0a  yer_stack=None,.
-00014860: 2020 2020 2020 2020 7761 6665 725f 7061          wafer_pa
-00014870: 6464 696e 673d 302e 302c 0a20 2020 2020  dding=0.0,.     
-00014880: 2020 2077 6166 6572 5f6c 6179 6572 3d4c     wafer_layer=L
-00014890: 4159 4552 2e57 4146 4552 2c0a 2020 2020  AYER.WAFER,.    
-000148a0: 2020 2020 2a61 7267 732c 0a20 2020 2020      *args,.     
-000148b0: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
-000148c0: 2029 3a0a 2020 2020 2020 2020 2222 2252   ):.        """R
-000148d0: 6574 7572 6e73 2061 2067 6d73 6820 6d73  eturns a gmsh ms
-000148e0: 6820 6f66 2074 6865 2063 6f6d 706f 6e65  h of the compone
-000148f0: 6e74 2066 6f72 2066 696e 6974 6520 656c  nt for finite el
-00014900: 656d 656e 7420 7369 6d75 6c61 7469 6f6e  ement simulation
-00014910: 2e0a 0a20 2020 2020 2020 2041 7267 756d  ...        Argum
-00014920: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
-00014930: 2020 7479 7065 3a20 6f6e 6520 6f66 2022    type: one of "
-00014940: 7879 222c 2022 757a 222c 206f 7220 2233  xy", "uz", or "3
-00014950: 4422 2e20 4465 7465 726d 696e 6573 2074  D". Determines t
-00014960: 6865 2074 7970 6520 6f66 206d 6573 6820  he type of mesh 
-00014970: 746f 2072 6574 7572 6e2e 0a20 2020 2020  to return..     
-00014980: 2020 2020 2020 207a 3a20 7573 6564 2074         z: used t
-00014990: 6f20 6465 6669 6e65 207a 2d73 6c69 6365  o define z-slice
-000149a0: 2066 6f72 2078 7920 6d65 7368 696e 670a   for xy meshing.
-000149b0: 2020 2020 2020 2020 2020 2020 7873 6563              xsec
-000149c0: 7469 6f6e 5f62 6f75 6e64 733a 2075 7365  tion_bounds: use
-000149d0: 6420 746f 2064 6566 696e 6520 696e 2d70  d to define in-p
-000149e0: 6c61 6e65 206c 696e 6520 666f 7220 757a  lane line for uz
-000149f0: 206d 6573 6869 6e67 0a20 2020 2020 2020   meshing.       
-00014a00: 2020 2020 2077 6166 6572 5f70 6164 6469       wafer_paddi
-00014a10: 6e67 3a20 7061 6464 696e 6720 6265 796f  ng: padding beyo
-00014a20: 6e64 2062 626f 7820 746f 2061 6464 2074  nd bbox to add t
-00014a30: 6f20 5741 4645 5220 6c61 7965 7273 2e0a  o WAFER layers..
-00014a40: 0a20 2020 2020 2020 204b 6579 776f 7264  .        Keyword
-00014a50: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00014a60: 2020 2041 7267 756d 656e 7473 2066 6f72     Arguments for
-00014a70: 2074 6865 2074 6172 6765 7420 6d65 7368   the target mesh
-00014a80: 696e 6720 6675 6e63 7469 6f6e 2069 6e20  ing function in 
-00014a90: 6764 7366 6163 746f 7279 2e73 696d 756c  gdsfactory.simul
-00014aa0: 6174 696f 6e2e 676d 7368 0a20 2020 2020  ation.gmsh.     
-00014ab0: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
-00014ac0: 2041 6464 2057 4146 4552 206c 6179 6572   Add WAFER layer
-00014ad0: 3a0a 2020 2020 2020 2020 7061 6464 6564  :.        padded
-00014ae0: 5f63 6f6d 706f 6e65 6e74 203d 2043 6f6d  _component = Com
-00014af0: 706f 6e65 6e74 2829 0a20 2020 2020 2020  ponent().       
-00014b00: 2070 6164 6465 645f 636f 6d70 6f6e 656e   padded_componen
-00014b10: 7420 3c3c 2073 656c 660a 2020 2020 2020  t << self.      
-00014b20: 2020 2878 6d69 6e2c 2079 6d69 6e29 2c20    (xmin, ymin), 
-00014b30: 2878 6d61 782c 2079 6d61 7829 203d 2073  (xmax, ymax) = s
-00014b40: 656c 662e 6262 6f78 0a20 2020 2020 2020  elf.bbox.       
-00014b50: 2070 6f69 6e74 7320 3d20 5b0a 2020 2020   points = [.    
-00014b60: 2020 2020 2020 2020 5b78 6d69 6e20 2d20          [xmin - 
-00014b70: 7761 6665 725f 7061 6464 696e 672c 2079  wafer_padding, y
-00014b80: 6d69 6e20 2d20 7761 6665 725f 7061 6464  min - wafer_padd
-00014b90: 696e 675d 2c0a 2020 2020 2020 2020 2020  ing],.          
-00014ba0: 2020 5b78 6d61 7820 2b20 7761 6665 725f    [xmax + wafer_
-00014bb0: 7061 6464 696e 672c 2079 6d69 6e20 2d20  padding, ymin - 
-00014bc0: 7761 6665 725f 7061 6464 696e 675d 2c0a  wafer_padding],.
-00014bd0: 2020 2020 2020 2020 2020 2020 5b78 6d61              [xma
-00014be0: 7820 2b20 7761 6665 725f 7061 6464 696e  x + wafer_paddin
-00014bf0: 672c 2079 6d61 7820 2b20 7761 6665 725f  g, ymax + wafer_
-00014c00: 7061 6464 696e 675d 2c0a 2020 2020 2020  padding],.      
-00014c10: 2020 2020 2020 5b78 6d69 6e20 2d20 7761        [xmin - wa
-00014c20: 6665 725f 7061 6464 696e 672c 2079 6d61  fer_padding, yma
-00014c30: 7820 2b20 7761 6665 725f 7061 6464 696e  x + wafer_paddin
-00014c40: 675d 2c0a 2020 2020 2020 2020 5d0a 2020  g],.        ].  
-00014c50: 2020 2020 2020 7061 6464 6564 5f63 6f6d        padded_com
-00014c60: 706f 6e65 6e74 2e61 6464 5f70 6f6c 7967  ponent.add_polyg
-00014c70: 6f6e 2870 6f69 6e74 732c 206c 6179 6572  on(points, layer
-00014c80: 3d77 6166 6572 5f6c 6179 6572 290a 0a20  =wafer_layer).. 
-00014c90: 2020 2020 2020 2069 6620 6c61 7965 725f         if layer_
-00014ca0: 7374 6163 6b20 6973 204e 6f6e 653a 0a20  stack is None:. 
-00014cb0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00014cc0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00014cd0: 2020 2020 2020 2020 2020 2020 2027 4120               'A 
-00014ce0: 4c61 7965 7253 7461 636b 206d 7573 7420  LayerStack must 
-00014cf0: 6265 2070 726f 7669 6465 6420 7468 726f  be provided thro
-00014d00: 7567 6820 6172 6775 6d65 6e74 2022 6c61  ugh argument "la
-00014d10: 7965 725f 7374 6163 6b22 2e27 0a20 2020  yer_stack".'.   
-00014d20: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00014d30: 2020 2069 6620 7479 7065 203d 3d20 2278     if type == "x
-00014d40: 7922 3a0a 2020 2020 2020 2020 2020 2020  y":.            
-00014d50: 6966 207a 2069 7320 4e6f 6e65 3a0a 2020  if z is None:.  
-00014d60: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00014d70: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-00014d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d90: 2020 2020 2746 6f72 2078 792d 6d65 7368      'For xy-mesh
-00014da0: 696e 672c 2061 207a 2d76 616c 7565 206d  ing, a z-value m
-00014db0: 7573 7420 6265 2070 726f 7669 6465 6420  ust be provided 
-00014dc0: 7669 6120 7468 6520 666c 6f61 7420 6172  via the float ar
-00014dd0: 6775 6d65 6e74 2022 7a22 2e27 0a20 2020  gument "z".'.   
-00014de0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00014df0: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
-00014e00: 6764 7366 6163 746f 7279 2e73 696d 756c  gdsfactory.simul
-00014e10: 6174 696f 6e2e 676d 7368 2e78 795f 7873  ation.gmsh.xy_xs
-00014e20: 6563 7469 6f6e 5f6d 6573 6820 696d 706f  ection_mesh impo
-00014e30: 7274 2078 795f 7873 6563 7469 6f6e 5f6d  rt xy_xsection_m
-00014e40: 6573 680a 0a20 2020 2020 2020 2020 2020  esh..           
-00014e50: 2072 6574 7572 6e20 7879 5f78 7365 6374   return xy_xsect
-00014e60: 696f 6e5f 6d65 7368 2870 6164 6465 645f  ion_mesh(padded_
-00014e70: 636f 6d70 6f6e 656e 742c 207a 2c20 6c61  component, z, la
-00014e80: 7965 725f 7374 6163 6b2c 202a 2a6b 7761  yer_stack, **kwa
-00014e90: 7267 7329 0a20 2020 2020 2020 2065 6c69  rgs).        eli
-00014ea0: 6620 7479 7065 203d 3d20 2275 7a22 3a0a  f type == "uz":.
-00014eb0: 2020 2020 2020 2020 2020 2020 6966 2078              if x
-00014ec0: 7365 6374 696f 6e5f 626f 756e 6473 2069  section_bounds i
-00014ed0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00014ee0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00014ef0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00014f00: 2020 2020 2020 2020 2020 2020 2020 2246                "F
-00014f10: 6f72 2075 7a2d 6d65 7368 696e 672c 2079  or uz-meshing, y
-00014f20: 6f75 206d 7573 7420 7072 6f76 6964 6520  ou must provide 
-00014f30: 6120 6c69 6e65 2069 6e20 7468 6520 7879  a line in the xy
-00014f40: 2d70 6c61 6e65 2022 0a20 2020 2020 2020  -plane ".       
-00014f50: 2020 2020 2020 2020 2020 2020 2022 7669               "vi
-00014f60: 6120 7468 6520 5475 706c 6520 6172 6775  a the Tuple argu
-00014f70: 6d65 6e74 205b 5b78 312c 7931 5d2c 205b  ment [[x1,y1], [
-00014f80: 7832 2c79 325d 5d20 7873 6563 7469 6f6e  x2,y2]] xsection
-00014f90: 5f62 6f75 6e64 732e 220a 2020 2020 2020  _bounds.".      
-00014fa0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00014fb0: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
-00014fc0: 6661 6374 6f72 792e 7369 6d75 6c61 7469  factory.simulati
-00014fd0: 6f6e 2e67 6d73 682e 757a 5f78 7365 6374  on.gmsh.uz_xsect
-00014fe0: 696f 6e5f 6d65 7368 2069 6d70 6f72 7420  ion_mesh import 
-00014ff0: 757a 5f78 7365 6374 696f 6e5f 6d65 7368  uz_xsection_mesh
-00015000: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00015010: 7475 726e 2075 7a5f 7873 6563 7469 6f6e  turn uz_xsection
-00015020: 5f6d 6573 6828 0a20 2020 2020 2020 2020  _mesh(.         
-00015030: 2020 2020 2020 2070 6164 6465 645f 636f         padded_co
-00015040: 6d70 6f6e 656e 742c 2078 7365 6374 696f  mponent, xsectio
-00015050: 6e5f 626f 756e 6473 2c20 6c61 7965 725f  n_bounds, layer_
-00015060: 7374 6163 6b2c 202a 2a6b 7761 7267 730a  stack, **kwargs.
-00015070: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00015080: 2020 2020 2020 656c 6966 2074 7970 6520        elif type 
-00015090: 3d3d 2022 3344 223a 0a20 2020 2020 2020  == "3D":.       
-000150a0: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
-000150b0: 746f 7279 2e73 696d 756c 6174 696f 6e2e  tory.simulation.
-000150c0: 676d 7368 2e78 797a 5f6d 6573 6820 696d  gmsh.xyz_mesh im
-000150d0: 706f 7274 2078 797a 5f6d 6573 680a 0a20  port xyz_mesh.. 
-000150e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000150f0: 6e20 7879 7a5f 6d65 7368 2870 6164 6465  n xyz_mesh(padde
-00015100: 645f 636f 6d70 6f6e 656e 742c 206c 6179  d_component, lay
-00015110: 6572 5f73 7461 636b 2c20 2a2a 6b77 6172  er_stack, **kwar
-00015120: 6773 290a 2020 2020 2020 2020 656c 7365  gs).        else
-00015130: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00015140: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-00015150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015160: 2752 6571 7569 7265 6420 6172 6775 6d65  'Required argume
-00015170: 6e74 2022 7479 7065 2220 6d75 7374 2062  nt "type" must b
-00015180: 6520 6f6e 6520 6f66 2022 7879 222c 2022  e one of "xy", "
-00015190: 757a 222c 206f 7220 2233 4422 2e27 0a20  uz", or "3D".'. 
-000151a0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000151b0: 2020 6465 6620 6f66 6673 6574 280a 2020    def offset(.  
-000151c0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-000151d0: 2020 2020 6469 7374 616e 6365 3a20 666c      distance: fl
-000151e0: 6f61 7420 3d20 302e 312c 0a20 2020 2020  oat = 0.1,.     
-000151f0: 2020 2070 6f6c 7967 6f6e 733d 4e6f 6e65     polygons=None
-00015200: 2c0a 2020 2020 2020 2020 7573 655f 756e  ,.        use_un
-00015210: 696f 6e3a 2062 6f6f 6c20 3d20 5472 7565  ion: bool = True
-00015220: 2c0a 2020 2020 2020 2020 7072 6563 6973  ,.        precis
-00015230: 696f 6e3a 2066 6c6f 6174 203d 2031 652d  ion: float = 1e-
-00015240: 342c 0a20 2020 2020 2020 206a 6f69 6e3a  4,.        join:
-00015250: 2073 7472 203d 2022 6d69 7465 7222 2c0a   str = "miter",.
-00015260: 2020 2020 2020 2020 746f 6c65 7261 6e63          toleranc
-00015270: 653a 2069 6e74 203d 2032 2c0a 2020 2020  e: int = 2,.    
-00015280: 2020 2020 6c61 7965 723a 204c 6179 6572      layer: Layer
-00015290: 5370 6563 203d 2022 5747 222c 0a20 2020  Spec = "WG",.   
-000152a0: 2029 202d 3e20 436f 6d70 6f6e 656e 743a   ) -> Component:
-000152b0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-000152c0: 726e 7320 6e65 7720 436f 6d70 6f6e 656e  rns new Componen
-000152d0: 7420 7769 7468 2070 6f6c 7967 6f6e 7320  t with polygons 
-000152e0: 6572 6f64 6564 206f 7220 6469 6c61 7465  eroded or dilate
-000152f0: 6420 6279 2061 6e20 6f66 6673 6574 2e0a  d by an offset..
-00015300: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-00015310: 2020 2020 2020 2020 2020 2064 6973 7461             dista
-00015320: 6e63 653a 2044 6973 7461 6e63 6520 746f  nce: Distance to
-00015330: 206f 6666 7365 7420 706f 6c79 676f 6e73   offset polygons
-00015340: 2e20 506f 7369 7469 7665 2076 616c 7565  . Positive value
-00015350: 7320 6578 7061 6e64 2c20 6e65 6761 7469  s expand, negati
-00015360: 7665 2073 6872 696e 6b2e 0a20 2020 2020  ve shrink..     
-00015370: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
-00015380: 3a20 4465 7369 7265 6420 7072 6563 6973  : Desired precis
-00015390: 696f 6e20 666f 7220 726f 756e 6469 6e67  ion for rounding
-000153a0: 2076 6572 7465 7820 636f 6f72 6469 6e61   vertex coordina
-000153b0: 7465 732e 0a20 2020 2020 2020 2020 2020  tes..           
-000153c0: 206a 6f69 6e3a 207b 276d 6974 6572 272c   join: {'miter',
-000153d0: 2027 6265 7665 6c27 2c20 2772 6f75 6e64   'bevel', 'round
-000153e0: 277d 2054 7970 6520 6f66 206a 6f69 6e20  '} Type of join 
-000153f0: 7573 6564 2074 6f20 6372 6561 7465 2070  used to create p
-00015400: 6f6c 7967 6f6e 206f 6666 7365 740a 2020  olygon offset.  
-00015410: 2020 2020 2020 2020 2020 746f 6c65 7261            tolera
-00015420: 6e63 653a 2046 6f72 206d 6974 6572 206a  nce: For miter j
-00015430: 6f69 6e74 732c 2074 6869 7320 6e75 6d62  oints, this numb
-00015440: 6572 206d 7573 7420 6265 2061 7420 6c65  er must be at le
-00015450: 6173 7420 3220 7265 7072 6573 656e 7473  ast 2 represents
-00015460: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00015470: 2020 206d 6178 696d 616c 2064 6973 7461     maximal dista
-00015480: 6e63 6520 696e 206d 756c 7469 706c 6573  nce in multiples
-00015490: 206f 6620 6f66 6673 6574 2062 6574 7765   of offset betwe
-000154a0: 656e 206e 6577 2076 6572 7469 6365 7320  en new vertices 
-000154b0: 616e 6420 7468 6569 720a 2020 2020 2020  and their.      
-000154c0: 2020 2020 2020 2020 6f72 6967 696e 616c          original
-000154d0: 2070 6f73 6974 696f 6e20 6265 666f 7265   position before
-000154e0: 2062 6576 656c 696e 6720 746f 2061 766f   beveling to avo
-000154f0: 6964 2073 7069 6b65 7320 6174 2061 6375  id spikes at acu
-00015500: 7465 206a 6f69 6e74 732e 2046 6f72 0a20  te joints. For. 
-00015510: 2020 2020 2020 2020 2020 2020 2072 6f75               rou
-00015520: 6e64 206a 6f69 6e74 732c 2069 7420 696e  nd joints, it in
-00015530: 6469 6361 7465 7320 7468 6520 6375 7276  dicates the curv
-00015540: 6174 7572 6520 7265 736f 6c75 7469 6f6e  ature resolution
-00015550: 2069 6e20 6e75 6d62 6572 206f 660a 2020   in number of.  
-00015560: 2020 2020 2020 2020 2020 2020 706f 696e              poin
-00015570: 7473 2070 6572 2066 756c 6c20 6369 7263  ts per full circ
-00015580: 6c65 2e0a 2020 2020 2020 2020 2020 2020  le..            
-00015590: 6c61 7965 723a 2053 7065 6369 6669 6320  layer: Specific 
-000155a0: 6c61 7965 7220 666f 7220 6e65 7720 706f  layer for new po
-000155b0: 6c79 676f 6e73 2e0a 0a20 2020 2020 2020  lygons...       
-000155c0: 2022 2222 0a20 2020 2020 2020 2069 6d70   """.        imp
-000155d0: 6f72 7420 6764 7366 6163 746f 7279 2061  ort gdsfactory a
-000155e0: 7320 6766 0a0a 2020 2020 2020 2020 6764  s gf..        gd
-000155f0: 735f 6c61 7965 722c 2067 6473 5f64 6174  s_layer, gds_dat
-00015600: 6174 7970 6520 3d20 6766 2e67 6574 5f6c  atype = gf.get_l
-00015610: 6179 6572 286c 6179 6572 290a 2020 2020  ayer(layer).    
-00015620: 2020 2020 7020 3d20 6764 7374 6b2e 6f66      p = gdstk.of
-00015630: 6673 6574 280a 2020 2020 2020 2020 2020  fset(.          
-00015640: 2020 706f 6c79 676f 6e73 206f 7220 7365    polygons or se
-00015650: 6c66 2e67 6574 5f70 6f6c 7967 6f6e 7328  lf.get_polygons(
-00015660: 292c 0a20 2020 2020 2020 2020 2020 2064  ),.            d
-00015670: 6973 7461 6e63 653d 6469 7374 616e 6365  istance=distance
-00015680: 2c0a 2020 2020 2020 2020 2020 2020 6a6f  ,.            jo
-00015690: 696e 3d6a 6f69 6e2c 0a20 2020 2020 2020  in=join,.       
-000156a0: 2020 2020 2074 6f6c 6572 616e 6365 3d74       tolerance=t
-000156b0: 6f6c 6572 616e 6365 2c0a 2020 2020 2020  olerance,.      
-000156c0: 2020 2020 2020 7072 6563 6973 696f 6e3d        precision=
-000156d0: 7072 6563 6973 696f 6e2c 0a20 2020 2020  precision,.     
-000156e0: 2020 2020 2020 2075 7365 5f75 6e69 6f6e         use_union
-000156f0: 3d75 7365 5f75 6e69 6f6e 2c0a 2020 2020  =use_union,.    
-00015700: 2020 2020 2020 2020 6c61 7965 723d 6764          layer=gd
-00015710: 735f 6c61 7965 722c 0a20 2020 2020 2020  s_layer,.       
-00015720: 2020 2020 2064 6174 6174 7970 653d 6764       datatype=gd
-00015730: 735f 6461 7461 7479 7065 2c0a 2020 2020  s_datatype,.    
-00015740: 2020 2020 290a 0a20 2020 2020 2020 2063      )..        c
-00015750: 6f6d 706f 6e65 6e74 203d 2067 662e 436f  omponent = gf.Co
-00015760: 6d70 6f6e 656e 7428 290a 2020 2020 2020  mponent().      
-00015770: 2020 636f 6d70 6f6e 656e 742e 6164 645f    component.add_
-00015780: 706f 6c79 676f 6e28 702c 206c 6179 6572  polygon(p, layer
-00015790: 3d6c 6179 6572 290a 2020 2020 2020 2020  =layer).        
-000157a0: 7265 7475 726e 2063 6f6d 706f 6e65 6e74  return component
-000157b0: 0a0a 0a64 6566 2063 6f70 7928 0a20 2020  ...def copy(.   
-000157c0: 2044 3a20 436f 6d70 6f6e 656e 742c 0a20   D: Component,. 
-000157d0: 2020 2072 6566 6572 656e 6365 733d 4e6f     references=No
-000157e0: 6e65 2c0a 2020 2020 706f 7274 733d 4e6f  ne,.    ports=No
-000157f0: 6e65 2c0a 2020 2020 706f 6c79 676f 6e73  ne,.    polygons
-00015800: 3d4e 6f6e 652c 0a20 2020 2070 6174 6873  =None,.    paths
-00015810: 3d4e 6f6e 652c 0a20 2020 206e 616d 653d  =None,.    name=
-00015820: 4e6f 6e65 2c0a 2020 2020 6c61 6265 6c73  None,.    labels
-00015830: 3d4e 6f6e 652c 0a29 202d 3e20 436f 6d70  =None,.) -> Comp
-00015840: 6f6e 656e 743a 0a20 2020 2022 2222 5265  onent:.    """Re
-00015850: 7475 726e 7320 6120 436f 6d70 6f6e 656e  turns a Componen
-00015860: 7420 636f 7079 2e0a 0a20 2020 2041 7267  t copy...    Arg
-00015870: 733a 0a20 2020 2020 2020 2044 3a20 636f  s:.        D: co
-00015880: 6d70 6f6e 656e 7420 746f 2063 6f70 792e  mponent to copy.
-00015890: 0a20 2020 2022 2222 0a20 2020 2044 5f63  .    """.    D_c
-000158a0: 6f70 7920 3d20 436f 6d70 6f6e 656e 7428  opy = Component(
-000158b0: 290a 2020 2020 445f 636f 7079 2e69 6e66  ).    D_copy.inf
-000158c0: 6f20 3d20 442e 696e 666f 0a20 2020 2023  o = D.info.    #
-000158d0: 2044 5f63 6f70 792e 5f63 656c 6c20 3d20   D_copy._cell = 
-000158e0: 442e 5f63 656c 6c2e 636f 7079 286e 616d  D._cell.copy(nam
-000158f0: 653d 445f 636f 7079 2e6e 616d 6529 0a0a  e=D_copy.name)..
-00015900: 2020 2020 666f 7220 7265 6620 696e 2072      for ref in r
-00015910: 6566 6572 656e 6365 7320 6966 2072 6566  eferences if ref
-00015920: 6572 656e 6365 7320 6973 206e 6f74 204e  erences is not N
-00015930: 6f6e 6520 656c 7365 2044 2e72 6566 6572  one else D.refer
-00015940: 656e 6365 733a 0a20 2020 2020 2020 2044  ences:.        D
-00015950: 5f63 6f70 792e 6164 6428 636f 7079 5f72  _copy.add(copy_r
-00015960: 6566 6572 656e 6365 2872 6566 2929 0a20  eference(ref)). 
-00015970: 2020 2066 6f72 2070 6f72 7420 696e 2028     for port in (
-00015980: 706f 7274 7320 6966 2070 6f72 7473 2069  ports if ports i
-00015990: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
-000159a0: 442e 706f 7274 7329 2e76 616c 7565 7328  D.ports).values(
-000159b0: 293a 0a20 2020 2020 2020 2044 5f63 6f70  ):.        D_cop
-000159c0: 792e 6164 645f 706f 7274 2870 6f72 743d  y.add_port(port=
-000159d0: 706f 7274 290a 2020 2020 666f 7220 706f  port).    for po
-000159e0: 6c79 2069 6e20 706f 6c79 676f 6e73 2069  ly in polygons i
-000159f0: 6620 706f 6c79 676f 6e73 2069 7320 6e6f  f polygons is no
-00015a00: 7420 4e6f 6e65 2065 6c73 6520 442e 706f  t None else D.po
-00015a10: 6c79 676f 6e73 3a0a 2020 2020 2020 2020  lygons:.        
-00015a20: 445f 636f 7079 2e61 6464 5f70 6f6c 7967  D_copy.add_polyg
-00015a30: 6f6e 2870 6f6c 7929 0a20 2020 2066 6f72  on(poly).    for
-00015a40: 2070 6174 6820 696e 2070 6174 6873 2069   path in paths i
-00015a50: 6620 7061 7468 7320 6973 206e 6f74 204e  f paths is not N
-00015a60: 6f6e 6520 656c 7365 2044 2e70 6174 6873  one else D.paths
-00015a70: 3a0a 2020 2020 2020 2020 445f 636f 7079  :.        D_copy
-00015a80: 2e61 6464 2870 6174 6829 0a20 2020 2066  .add(path).    f
-00015a90: 6f72 206c 6162 656c 2069 6e20 6c61 6265  or label in labe
-00015aa0: 6c73 2069 6620 6c61 6265 6c73 2069 7320  ls if labels is 
-00015ab0: 6e6f 7420 4e6f 6e65 2065 6c73 6520 442e  not None else D.
-00015ac0: 6c61 6265 6c73 3a0a 2020 2020 2020 2020  labels:.        
-00015ad0: 445f 636f 7079 2e61 6464 5f6c 6162 656c  D_copy.add_label
-00015ae0: 280a 2020 2020 2020 2020 2020 2020 7465  (.            te
-00015af0: 7874 3d6c 6162 656c 2e74 6578 742c 0a20  xt=label.text,. 
-00015b00: 2020 2020 2020 2020 2020 2070 6f73 6974             posit
-00015b10: 696f 6e3d 6c61 6265 6c2e 6f72 6967 696e  ion=label.origin
-00015b20: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
-00015b30: 7965 723d 286c 6162 656c 2e6c 6179 6572  yer=(label.layer
-00015b40: 2c20 6c61 6265 6c2e 7465 7874 7479 7065  , label.texttype
-00015b50: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
-00015b60: 2020 6966 206e 616d 6520 6973 206e 6f74    if name is not
-00015b70: 204e 6f6e 653a 0a20 2020 2020 2020 2044   None:.        D
-00015b80: 5f63 6f70 792e 6e61 6d65 203d 206e 616d  _copy.name = nam
-00015b90: 650a 0a20 2020 2072 6574 7572 6e20 445f  e..    return D_
-00015ba0: 636f 7079 0a0a 0a64 6566 2063 6f70 795f  copy...def copy_
-00015bb0: 7265 6665 7265 6e63 6528 0a20 2020 2072  reference(.    r
-00015bc0: 6566 2c0a 2020 2020 7061 7265 6e74 3d4e  ef,.    parent=N
-00015bd0: 6f6e 652c 0a20 2020 2063 6f6c 756d 6e73  one,.    columns
-00015be0: 3d4e 6f6e 652c 0a20 2020 2072 6f77 733d  =None,.    rows=
-00015bf0: 4e6f 6e65 2c0a 2020 2020 7370 6163 696e  None,.    spacin
-00015c00: 673d 4e6f 6e65 2c0a 2020 2020 6f72 6967  g=None,.    orig
-00015c10: 696e 3d4e 6f6e 652c 0a20 2020 2072 6f74  in=None,.    rot
-00015c20: 6174 696f 6e3d 4e6f 6e65 2c0a 2020 2020  ation=None,.    
-00015c30: 6d61 676e 6966 6963 6174 696f 6e3d 4e6f  magnification=No
-00015c40: 6e65 2c0a 2020 2020 785f 7265 666c 6563  ne,.    x_reflec
-00015c50: 7469 6f6e 3d4e 6f6e 652c 0a20 2020 206e  tion=None,.    n
-00015c60: 616d 653d 4e6f 6e65 2c0a 2020 2020 7631  ame=None,.    v1
-00015c70: 3d4e 6f6e 652c 0a20 2020 2076 323d 4e6f  =None,.    v2=No
-00015c80: 6e65 2c0a 2920 2d3e 2043 6f6d 706f 6e65  ne,.) -> Compone
-00015c90: 6e74 5265 6665 7265 6e63 653a 0a20 2020  ntReference:.   
-00015ca0: 2072 6574 7572 6e20 436f 6d70 6f6e 656e   return Componen
-00015cb0: 7452 6566 6572 656e 6365 280a 2020 2020  tReference(.    
-00015cc0: 2020 2020 636f 6d70 6f6e 656e 743d 7061      component=pa
-00015cd0: 7265 6e74 206f 7220 7265 662e 7061 7265  rent or ref.pare
-00015ce0: 6e74 2c0a 2020 2020 2020 2020 636f 6c75  nt,.        colu
-00015cf0: 6d6e 733d 636f 6c75 6d6e 7320 6f72 2072  mns=columns or r
-00015d00: 6566 2e63 6f6c 756d 6e73 2c0a 2020 2020  ef.columns,.    
-00015d10: 2020 2020 726f 7773 3d72 6f77 7320 6f72      rows=rows or
-00015d20: 2072 6566 2e72 6f77 732c 0a20 2020 2020   ref.rows,.     
-00015d30: 2020 2073 7061 6369 6e67 3d73 7061 6369     spacing=spaci
-00015d40: 6e67 206f 7220 7265 662e 7370 6163 696e  ng or ref.spacin
-00015d50: 672c 0a20 2020 2020 2020 206f 7269 6769  g,.        origi
-00015d60: 6e3d 6f72 6967 696e 206f 7220 7265 662e  n=origin or ref.
-00015d70: 6f72 6967 696e 2c0a 2020 2020 2020 2020  origin,.        
-00015d80: 726f 7461 7469 6f6e 3d72 6f74 6174 696f  rotation=rotatio
-00015d90: 6e20 6f72 2072 6566 2e72 6f74 6174 696f  n or ref.rotatio
-00015da0: 6e2c 0a20 2020 2020 2020 206d 6167 6e69  n,.        magni
-00015db0: 6669 6361 7469 6f6e 3d6d 6167 6e69 6669  fication=magnifi
-00015dc0: 6361 7469 6f6e 206f 7220 7265 662e 6d61  cation or ref.ma
-00015dd0: 676e 6966 6963 6174 696f 6e2c 0a20 2020  gnification,.   
-00015de0: 2020 2020 2078 5f72 6566 6c65 6374 696f       x_reflectio
-00015df0: 6e3d 785f 7265 666c 6563 7469 6f6e 206f  n=x_reflection o
-00015e00: 7220 7265 662e 785f 7265 666c 6563 7469  r ref.x_reflecti
-00015e10: 6f6e 2c0a 2020 2020 2020 2020 6e61 6d65  on,.        name
-00015e20: 3d6e 616d 6520 6f72 2072 6566 2e6e 616d  =name or ref.nam
-00015e30: 652c 0a20 2020 2020 2020 2076 313d 7631  e,.        v1=v1
-00015e40: 206f 7220 7265 662e 7631 2c0a 2020 2020   or ref.v1,.    
-00015e50: 2020 2020 7632 3d76 3220 6f72 2072 6566      v2=v2 or ref
-00015e60: 2e76 322c 0a20 2020 2029 0a0a 0a64 6566  .v2,.    )...def
-00015e70: 2074 6573 745f 6765 745f 6c61 7965 7273   test_get_layers
-00015e80: 2829 202d 3e20 436f 6d70 6f6e 656e 743a  () -> Component:
-00015e90: 0a20 2020 2069 6d70 6f72 7420 6764 7366  .    import gdsf
-00015ea0: 6163 746f 7279 2061 7320 6766 0a0a 2020  actory as gf..  
-00015eb0: 2020 6331 203d 2067 662e 636f 6d70 6f6e    c1 = gf.compon
-00015ec0: 656e 7473 2e73 7472 6169 6768 7428 0a20  ents.straight(. 
-00015ed0: 2020 2020 2020 206c 656e 6774 683d 3130         length=10
-00015ee0: 2c0a 2020 2020 2020 2020 7769 6474 683d  ,.        width=
-00015ef0: 302e 352c 0a20 2020 2020 2020 206c 6179  0.5,.        lay
-00015f00: 6572 3d28 322c 2030 292c 0a20 2020 2020  er=(2, 0),.     
-00015f10: 2020 2062 626f 785f 6c61 7965 7273 3d5b     bbox_layers=[
-00015f20: 2831 3131 2c20 3029 5d2c 0a20 2020 2020  (111, 0)],.     
-00015f30: 2020 2062 626f 785f 6f66 6673 6574 733d     bbox_offsets=
-00015f40: 5b33 5d2c 0a20 2020 2020 2020 2077 6974  [3],.        wit
-00015f50: 685f 6262 6f78 3d54 7275 652c 0a20 2020  h_bbox=True,.   
-00015f60: 2020 2020 2063 6c61 6464 696e 675f 6c61       cladding_la
-00015f70: 7965 7273 3d4e 6f6e 652c 0a20 2020 2020  yers=None,.     
-00015f80: 2020 2061 6464 5f70 696e 733d 4e6f 6e65     add_pins=None
-00015f90: 2c0a 2020 2020 2020 2020 6164 645f 6262  ,.        add_bb
-00015fa0: 6f78 3d4e 6f6e 652c 0a20 2020 2029 0a20  ox=None,.    ). 
-00015fb0: 2020 2061 7373 6572 7420 6331 2e67 6574     assert c1.get
-00015fc0: 5f6c 6179 6572 7328 2920 3d3d 207b 2832  _layers() == {(2
-00015fd0: 2c20 3029 2c20 2831 3131 2c20 3029 7d2c  , 0), (111, 0)},
-00015fe0: 2063 312e 6765 745f 6c61 7965 7273 2829   c1.get_layers()
-00015ff0: 0a20 2020 2023 2072 6574 7572 6e20 6331  .    # return c1
-00016000: 0a20 2020 2063 3220 3d20 6331 2e72 656d  .    c2 = c1.rem
-00016010: 6f76 655f 6c61 7965 7273 285b 2831 3131  ove_layers([(111
-00016020: 2c20 3029 5d29 0a20 2020 2061 7373 6572  , 0)]).    asser
-00016030: 7420 6332 2e67 6574 5f6c 6179 6572 7328  t c2.get_layers(
-00016040: 2920 3d3d 207b 2832 2c20 3029 7d2c 2063  ) == {(2, 0)}, c
-00016050: 322e 6765 745f 6c61 7965 7273 2829 0a20  2.get_layers(). 
-00016060: 2020 2072 6574 7572 6e20 6332 0a0a 0a64     return c2...d
-00016070: 6566 205f 6669 6c74 6572 5f70 6f6c 7973  ef _filter_polys
-00016080: 2870 6f6c 7967 6f6e 732c 206c 6179 6572  (polygons, layer
-00016090: 735f 6578 636c 293a 0a20 2020 2072 6574  s_excl):.    ret
-000160a0: 7572 6e20 5b0a 2020 2020 2020 2020 706f  urn [.        po
-000160b0: 6c79 676f 6e0a 2020 2020 2020 2020 666f  lygon.        fo
-000160c0: 7220 706f 6c79 676f 6e2c 206c 6179 6572  r polygon, layer
-000160d0: 2c20 6461 7461 7479 7065 2069 6e20 7a69  , datatype in zi
-000160e0: 7028 0a20 2020 2020 2020 2020 2020 2070  p(.            p
-000160f0: 6f6c 7967 6f6e 732e 706f 6c79 676f 6e73  olygons.polygons
-00016100: 2c20 706f 6c79 676f 6e73 2e6c 6179 6572  , polygons.layer
-00016110: 732c 2070 6f6c 7967 6f6e 732e 6461 7461  s, polygons.data
-00016120: 7479 7065 730a 2020 2020 2020 2020 290a  types.        ).
-00016130: 2020 2020 2020 2020 6966 2028 6c61 7965          if (laye
-00016140: 722c 2064 6174 6174 7970 6529 206e 6f74  r, datatype) not
-00016150: 2069 6e20 6c61 7965 7273 5f65 7863 6c0a   in layers_excl.
-00016160: 2020 2020 5d0a 0a0a 6465 6620 7265 6375      ]...def recu
-00016170: 7273 655f 7374 7275 6374 7572 6573 280a  rse_structures(.
-00016180: 2020 2020 636f 6d70 6f6e 656e 743a 2043      component: C
-00016190: 6f6d 706f 6e65 6e74 2c0a 2020 2020 6967  omponent,.    ig
-000161a0: 6e6f 7265 5f63 6f6d 706f 6e65 6e74 735f  nore_components_
-000161b0: 7072 6566 6978 3a20 4f70 7469 6f6e 616c  prefix: Optional
-000161c0: 5b4c 6973 745b 7374 725d 5d20 3d20 4e6f  [List[str]] = No
-000161d0: 6e65 2c0a 2020 2020 6967 6e6f 7265 5f66  ne,.    ignore_f
-000161e0: 756e 6374 696f 6e73 5f70 7265 6669 783a  unctions_prefix:
-000161f0: 204f 7074 696f 6e61 6c5b 4c69 7374 5b73   Optional[List[s
-00016200: 7472 5d5d 203d 204e 6f6e 652c 0a29 202d  tr]] = None,.) -
-00016210: 3e20 4469 6374 5b73 7472 2c20 416e 795d  > Dict[str, Any]
-00016220: 3a0a 2020 2020 2222 2252 6563 7572 7365  :.    """Recurse
-00016230: 2063 6f6d 706f 6e65 6e74 2061 6e64 2063   component and c
-00016240: 6f6d 706f 6e65 6e74 7320 7265 6665 7265  omponents refere
-00016250: 6e63 6573 2072 6563 7572 7369 7665 6c79  nces recursively
-00016260: 2e0a 0a20 2020 2041 7267 733a 0a20 2020  ...    Args:.   
-00016270: 2020 2020 2063 6f6d 706f 6e65 6e74 3a20       component: 
-00016280: 636f 6d70 6f6e 656e 7420 746f 2072 6563  component to rec
-00016290: 7572 7365 2e0a 2020 2020 2020 2020 6967  urse..        ig
-000162a0: 6e6f 7265 5f63 6f6d 706f 6e65 6e74 735f  nore_components_
-000162b0: 7072 6566 6978 3a20 6c69 7374 206f 6620  prefix: list of 
-000162c0: 7072 6566 6978 2074 6f20 6967 6e6f 7265  prefix to ignore
-000162d0: 2e0a 2020 2020 2020 2020 6967 6e6f 7265  ..        ignore
-000162e0: 5f66 756e 6374 696f 6e73 5f70 7265 6669  _functions_prefi
-000162f0: 783a 206c 6973 7420 6f66 2070 7265 6669  x: list of prefi
-00016300: 7820 746f 2069 676e 6f72 652e 0a20 2020  x to ignore..   
-00016310: 2022 2222 0a20 2020 2069 676e 6f72 655f   """.    ignore_
-00016320: 6675 6e63 7469 6f6e 735f 7072 6566 6978  functions_prefix
-00016330: 203d 2069 676e 6f72 655f 6675 6e63 7469   = ignore_functi
-00016340: 6f6e 735f 7072 6566 6978 206f 7220 5b5d  ons_prefix or []
-00016350: 0a20 2020 2069 676e 6f72 655f 636f 6d70  .    ignore_comp
-00016360: 6f6e 656e 7473 5f70 7265 6669 7820 3d20  onents_prefix = 
-00016370: 6967 6e6f 7265 5f63 6f6d 706f 6e65 6e74  ignore_component
-00016380: 735f 7072 6566 6978 206f 7220 5b5d 0a0a  s_prefix or []..
-00016390: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
-000163a0: 2068 6173 6174 7472 2863 6f6d 706f 6e65   hasattr(compone
-000163b0: 6e74 2c20 2266 756e 6374 696f 6e5f 6e61  nt, "function_na
-000163c0: 6d65 2229 0a20 2020 2020 2020 2061 6e64  me").        and
-000163d0: 2063 6f6d 706f 6e65 6e74 2e66 756e 6374   component.funct
-000163e0: 696f 6e5f 6e61 6d65 2069 6e20 6967 6e6f  ion_name in igno
-000163f0: 7265 5f66 756e 6374 696f 6e73 5f70 7265  re_functions_pre
-00016400: 6669 780a 2020 2020 293a 0a20 2020 2020  fix.    ):.     
-00016410: 2020 2072 6574 7572 6e20 7b7d 0a0a 2020     return {}..  
-00016420: 2020 6966 2068 6173 6174 7472 2863 6f6d    if hasattr(com
-00016430: 706f 6e65 6e74 2c20 226e 616d 6522 2920  ponent, "name") 
-00016440: 616e 6420 616e 7928 0a20 2020 2020 2020  and any(.       
-00016450: 2063 6f6d 706f 6e65 6e74 2e6e 616d 652e   component.name.
-00016460: 7374 6172 7473 7769 7468 2869 2920 666f  startswith(i) fo
-00016470: 7220 6920 696e 2069 676e 6f72 655f 636f  r i in ignore_co
-00016480: 6d70 6f6e 656e 7473 5f70 7265 6669 780a  mponents_prefix.
-00016490: 2020 2020 293a 0a20 2020 2020 2020 2072      ):.        r
-000164a0: 6574 7572 6e20 7b7d 0a0a 2020 2020 6f75  eturn {}..    ou
-000164b0: 7470 7574 203d 207b 636f 6d70 6f6e 656e  tput = {componen
-000164c0: 742e 6e61 6d65 3a20 6469 6374 2863 6f6d  t.name: dict(com
-000164d0: 706f 6e65 6e74 2e73 6574 7469 6e67 7329  ponent.settings)
-000164e0: 7d0a 2020 2020 666f 7220 7265 6665 7265  }.    for refere
-000164f0: 6e63 6520 696e 2063 6f6d 706f 6e65 6e74  nce in component
-00016500: 2e72 6566 6572 656e 6365 733a 0a20 2020  .references:.   
-00016510: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-00016520: 2020 2020 2020 6973 696e 7374 616e 6365        isinstance
-00016530: 2872 6566 6572 656e 6365 2c20 436f 6d70  (reference, Comp
-00016540: 6f6e 656e 7452 6566 6572 656e 6365 290a  onentReference).
-00016550: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-00016560: 7265 6665 7265 6e63 652e 7265 665f 6365  reference.ref_ce
-00016570: 6c6c 2e6e 616d 6520 6e6f 7420 696e 206f  ll.name not in o
-00016580: 7574 7075 740a 2020 2020 2020 2020 293a  utput.        ):
-00016590: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-000165a0: 7075 742e 7570 6461 7465 2872 6563 7572  put.update(recur
-000165b0: 7365 5f73 7472 7563 7475 7265 7328 7265  se_structures(re
-000165c0: 6665 7265 6e63 652e 7265 665f 6365 6c6c  ference.ref_cell
-000165d0: 2929 0a0a 2020 2020 7265 7475 726e 206f  ))..    return o
-000165e0: 7574 7075 740a 0a0a 6465 6620 666c 6174  utput...def flat
-000165f0: 7465 6e5f 696e 7661 6c69 645f 7265 6673  ten_invalid_refs
-00016600: 5f72 6563 7572 7369 7665 280a 2020 2020  _recursive(.    
-00016610: 636f 6d70 6f6e 656e 743a 2043 6f6d 706f  component: Compo
-00016620: 6e65 6e74 2c0a 2020 2020 6772 6964 5f73  nent,.    grid_s
-00016630: 697a 653a 204f 7074 696f 6e61 6c5b 666c  ize: Optional[fl
-00016640: 6f61 745d 203d 204e 6f6e 652c 0a20 2020  oat] = None,.   
-00016650: 2075 7064 6174 6564 5f63 6f6d 706f 6e65   updated_compone
-00016660: 6e74 733d 4e6f 6e65 2c0a 2020 2020 7472  nts=None,.    tr
-00016670: 6176 6572 7365 645f 636f 6d70 6f6e 656e  aversed_componen
-00016680: 7473 3d4e 6f6e 652c 0a29 3a0a 2020 2020  ts=None,.):.    
-00016690: 2222 2252 6563 7572 7369 7665 6c79 2066  """Recursively f
-000166a0: 6c61 7474 656e 7320 636f 6d70 6f6e 656e  lattens componen
-000166b0: 7420 7265 6665 7265 6e63 6573 2077 6869  t references whi
-000166c0: 6368 2068 6176 6520 696e 7661 6c69 6420  ch have invalid 
-000166d0: 7472 616e 7366 6f72 6d61 7469 6f6e 7320  transformations 
-000166e0: 2869 2e65 2e20 6e6f 6e2d 3930 2064 6567  (i.e. non-90 deg
-000166f0: 2072 6f74 6174 696f 6e73 206f 7220 7375   rotations or su
-00016700: 622d 6772 6964 2074 7261 6e73 6c61 7469  b-grid translati
-00016710: 6f6e 7329 2061 6e64 2072 6574 7572 6e73  ons) and returns
-00016720: 2061 2063 6f70 7920 6966 2061 6e79 2073   a copy if any s
-00016730: 7562 6365 6c6c 7320 6861 7665 2062 6565  ubcells have bee
-00016740: 6e20 6d6f 6469 6669 6564 2e0a 0a20 2020  n modified...   
-00016750: 2057 4152 4e49 4e47 3a20 7468 6973 2066   WARNING: this f
-00016760: 756e 6374 696f 6e20 7769 6c6c 2070 726f  unction will pro
-00016770: 6475 6365 2073 616d 652d 6e61 6d65 2063  duce same-name c
-00016780: 6f70 6965 7320 6f66 2063 656c 6c73 2e20  opies of cells. 
-00016790: 4974 2069 7320 7374 7269 6374 6c79 206d  It is strictly m
-000167a0: 6561 6e74 2074 6f20 6265 2075 7365 6420  eant to be used 
-000167b0: 6f6e 2077 7269 7465 206f 6620 7468 6520  on write of the 
-000167c0: 4744 5320 6669 6c65 2061 6e64 0a20 2020  GDS file and.   
-000167d0: 2073 686f 756c 6420 6e6f 7420 6265 206d   should not be m
-000167e0: 6978 6564 2077 6974 6820 6f74 6865 7220  ixed with other 
-000167f0: 6365 6c6c 732c 206f 7220 796f 7520 7769  cells, or you wi
-00016800: 6c6c 206c 696b 656c 7920 6578 7065 7269  ll likely experi
-00016810: 656e 6365 2069 7373 7565 7320 7769 7468  ence issues with
-00016820: 2064 7570 6c69 6361 7465 2063 656c 6c73   duplicate cells
-00016830: 0a0a 2020 2020 4172 6773 3a0a 2020 2020  ..    Args:.    
-00016840: 2020 2020 636f 6d70 6f6e 656e 743a 2074      component: t
-00016850: 6865 2063 6f6d 706f 6e65 6e74 2074 6f20  he component to 
-00016860: 6669 7820 2869 6e20 706c 6163 6529 2e0a  fix (in place)..
-00016870: 2020 2020 2020 2020 6772 6964 5f73 697a          grid_siz
-00016880: 653a 2074 6865 2047 4453 2067 7269 6420  e: the GDS grid 
-00016890: 7369 7a65 2c20 696e 2075 6d2c 2064 6566  size, in um, def
-000168a0: 6175 6c74 7320 746f 2061 6374 6976 6520  aults to active 
-000168b0: 5044 4b2e 6765 745f 6772 6964 5f73 697a  PDK.get_grid_siz
-000168c0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-000168d0: 616e 7920 7472 616e 736c 6174 696f 6e73  any translations
-000168e0: 2077 6974 6820 6869 6768 6572 2072 6573   with higher res
-000168f0: 6f6c 7574 696f 6e20 7468 616e 2074 6869  olution than thi
-00016900: 7320 6172 6520 636f 6e73 6964 6572 6564  s are considered
-00016910: 2069 6e76 616c 6964 2e0a 2020 2020 2020   invalid..      
-00016920: 2020 7570 6461 7465 645f 636f 6d70 6f6e    updated_compon
-00016930: 656e 7473 3a20 7468 6520 7275 6e6e 696e  ents: the runnin
-00016940: 6720 6469 6374 696f 6e61 7279 206f 6620  g dictionary of 
-00016950: 636f 6d70 6f6e 656e 7473 2077 6869 6368  components which
-00016960: 2068 6176 6520 6265 656e 206d 6f64 6966   have been modif
-00016970: 6965 6420 6279 2074 6869 7320 7472 616e  ied by this tran
-00016980: 7366 6f72 6d61 7469 6f6e 2e20 5368 6f75  sformation. Shou
-00016990: 6c64 2061 6c77 6179 7320 6265 204e 6f6e  ld always be Non
-000169a0: 652c 2065 7863 6570 7420 666f 7220 7265  e, except for re
-000169b0: 6375 7273 6976 6520 696e 766f 6361 7469  cursive invocati
-000169c0: 6f6e 732e 0a20 2020 2020 2020 2074 7261  ons..        tra
-000169d0: 7665 7273 6564 5f63 6f6d 706f 6e65 6e74  versed_component
-000169e0: 733a 2074 6865 2073 6574 206f 6620 636f  s: the set of co
-000169f0: 6d70 6f6e 656e 7420 6e61 6d65 7320 7768  mponent names wh
-00016a00: 6963 6820 6861 7665 2062 6565 6e20 7472  ich have been tr
-00016a10: 6176 6572 7365 642e 2053 686f 756c 6420  aversed. Should 
-00016a20: 616c 7761 7973 2062 6520 4e6f 6e65 2c20  always be None, 
-00016a30: 6578 6365 7074 2066 6f72 2072 6563 7572  except for recur
-00016a40: 7369 7665 2069 6e76 6f63 6174 696f 6e73  sive invocations
-00016a50: 2e0a 2020 2020 2222 220a 2020 2020 6672  ..    """.    fr
-00016a60: 6f6d 2067 6473 6661 6374 6f72 792e 6465  om gdsfactory.de
-00016a70: 636f 7261 746f 7273 2069 6d70 6f72 7420  corators import 
-00016a80: 6973 5f69 6e76 616c 6964 5f72 6566 0a0a  is_invalid_ref..
-00016a90: 2020 2020 696e 7661 6c69 645f 7265 6673      invalid_refs
-00016aa0: 203d 205b 5d0a 2020 2020 7265 6673 203d   = [].    refs =
-00016ab0: 2063 6f6d 706f 6e65 6e74 2e72 6566 6572   component.refer
-00016ac0: 656e 6365 730a 2020 2020 7375 6263 656c  ences.    subcel
-00016ad0: 6c5f 6d6f 6469 6669 6564 203d 2046 616c  l_modified = Fal
-00016ae0: 7365 0a20 2020 2069 6620 7570 6461 7465  se.    if update
-00016af0: 645f 636f 6d70 6f6e 656e 7473 2069 7320  d_components is 
-00016b00: 4e6f 6e65 3a0a 2020 2020 2020 2020 7570  None:.        up
-00016b10: 6461 7465 645f 636f 6d70 6f6e 656e 7473  dated_components
-00016b20: 203d 207b 7d0a 2020 2020 6966 2074 7261   = {}.    if tra
-00016b30: 7665 7273 6564 5f63 6f6d 706f 6e65 6e74  versed_component
-00016b40: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00016b50: 2020 2074 7261 7665 7273 6564 5f63 6f6d     traversed_com
-00016b60: 706f 6e65 6e74 7320 3d20 7365 7428 290a  ponents = set().
-00016b70: 2020 2020 666f 7220 7265 6620 696e 2072      for ref in r
-00016b80: 6566 733a 0a20 2020 2020 2020 2023 206d  efs:.        # m
-00016b90: 6172 6b20 616e 7920 696e 7661 6c69 6420  ark any invalid 
-00016ba0: 7265 6673 2066 6f72 2066 6c61 7474 656e  refs for flatten
-00016bb0: 696e 670a 2020 2020 2020 2020 2320 6f74  ing.        # ot
-00016bc0: 6865 7277 6973 652c 2063 6865 636b 2069  herwise, check i
-00016bd0: 6620 7468 6572 6520 6172 6520 616e 7920  f there are any 
-00016be0: 6d6f 6469 6669 6564 2063 656c 6c73 2062  modified cells b
-00016bf0: 656e 6561 7468 2028 7765 206e 6565 6420  eneath (we need 
-00016c00: 6e6f 7420 646f 2074 6869 7320 6966 2074  not do this if t
-00016c10: 6865 2072 6566 2077 696c 6c20 6265 2066  he ref will be f
-00016c20: 6c61 7474 656e 6564 2061 6e79 7761 7973  lattened anyways
-00016c30: 290a 2020 2020 2020 2020 6966 2069 735f  ).        if is_
-00016c40: 696e 7661 6c69 645f 7265 6628 7265 662c  invalid_ref(ref,
-00016c50: 2067 7269 645f 7369 7a65 293a 0a20 2020   grid_size):.   
-00016c60: 2020 2020 2020 2020 2069 6e76 616c 6964           invalid
-00016c70: 5f72 6566 732e 6170 7065 6e64 2872 6566  _refs.append(ref
-00016c80: 2e6e 616d 6529 0a20 2020 2020 2020 2065  .name).        e
-00016c90: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00016ca0: 2023 206f 7468 6572 7769 7365 2c20 7265   # otherwise, re
-00016cb0: 6375 7273 6976 656c 7920 666c 6174 7465  cursively flatte
-00016cc0: 6e20 7265 6673 2069 6620 7468 6520 7375  n refs if the su
-00016cd0: 6263 656c 6c20 6861 7320 6e6f 7420 616c  bcell has not al
-00016ce0: 7265 6164 7920 6265 656e 2074 7261 7665  ready been trave
-00016cf0: 7273 6564 0a20 2020 2020 2020 2020 2020  rsed.           
-00016d00: 2069 6620 7265 662e 7061 7265 6e74 2e6e   if ref.parent.n
-00016d10: 616d 6520 6e6f 7420 696e 2074 7261 7665  ame not in trave
-00016d20: 7273 6564 5f63 6f6d 706f 6e65 6e74 733a  rsed_components:
-00016d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016d40: 2066 6c61 7474 656e 5f69 6e76 616c 6964   flatten_invalid
-00016d50: 5f72 6566 735f 7265 6375 7273 6976 6528  _refs_recursive(
-00016d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016d70: 2020 2020 2072 6566 2e70 6172 656e 742c       ref.parent,
-00016d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016d90: 2020 2020 2067 7269 645f 7369 7a65 3d67       grid_size=g
-00016da0: 7269 645f 7369 7a65 2c0a 2020 2020 2020  rid_size,.      
-00016db0: 2020 2020 2020 2020 2020 2020 2020 7570                up
-00016dc0: 6461 7465 645f 636f 6d70 6f6e 656e 7473  dated_components
-00016dd0: 3d75 7064 6174 6564 5f63 6f6d 706f 6e65  =updated_compone
-00016de0: 6e74 732c 0a20 2020 2020 2020 2020 2020  nts,.           
-00016df0: 2020 2020 2020 2020 2074 7261 7665 7273           travers
-00016e00: 6564 5f63 6f6d 706f 6e65 6e74 733d 7472  ed_components=tr
-00016e10: 6176 6572 7365 645f 636f 6d70 6f6e 656e  aversed_componen
-00016e20: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
-00016e30: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00016e40: 2020 2320 6e6f 772c 2069 6620 7468 6520    # now, if the 
-00016e50: 7265 6627 7320 6365 6c6c 2062 6565 6e20  ref's cell been 
-00016e60: 6d6f 6469 6669 6564 2c20 6d61 726b 2069  modified, mark i
-00016e70: 7420 6173 2073 7563 680a 2020 2020 2020  t as such.      
-00016e80: 2020 2020 2020 6966 2072 6566 2e70 6172        if ref.par
-00016e90: 656e 742e 6e61 6d65 2069 6e20 7570 6461  ent.name in upda
-00016ea0: 7465 645f 636f 6d70 6f6e 656e 7473 3a0a  ted_components:.
-00016eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ec0: 7375 6263 656c 6c5f 6d6f 6469 6669 6564  subcell_modified
-00016ed0: 203d 2054 7275 650a 2020 2020 6966 2069   = True.    if i
-00016ee0: 6e76 616c 6964 5f72 6566 7320 6f72 2073  nvalid_refs or s
-00016ef0: 7562 6365 6c6c 5f6d 6f64 6966 6965 643a  ubcell_modified:
-00016f00: 0a20 2020 2020 2020 206e 6577 5f63 6f6d  .        new_com
-00016f10: 706f 6e65 6e74 203d 2063 6f6d 706f 6e65  ponent = compone
-00016f20: 6e74 2e63 6f70 7928 290a 2020 2020 2020  nt.copy().      
-00016f30: 2020 6e65 775f 636f 6d70 6f6e 656e 742e    new_component.
-00016f40: 6e61 6d65 203d 2063 6f6d 706f 6e65 6e74  name = component
-00016f50: 2e6e 616d 650a 2020 2020 2020 2020 2320  .name.        # 
-00016f60: 6d61 6b65 2073 7572 6520 616c 6c20 6d6f  make sure all mo
-00016f70: 6469 6669 6564 2063 656c 6c73 2068 6176  dified cells hav
-00016f80: 6520 7468 6569 7220 7265 6665 7265 6e63  e their referenc
-00016f90: 6573 2075 7064 6174 6564 0a20 2020 2020  es updated.     
-00016fa0: 2020 206e 6577 5f72 6566 7320 3d20 6e65     new_refs = ne
-00016fb0: 775f 636f 6d70 6f6e 656e 742e 7265 6665  w_component.refe
-00016fc0: 7265 6e63 6573 2e63 6f70 7928 290a 2020  rences.copy().  
-00016fd0: 2020 2020 2020 666f 7220 7265 6620 696e        for ref in
-00016fe0: 206e 6577 5f72 6566 733a 0a20 2020 2020   new_refs:.     
-00016ff0: 2020 2020 2020 2069 6620 7265 662e 6e61         if ref.na
-00017000: 6d65 2069 6e20 696e 7661 6c69 645f 7265  me in invalid_re
-00017010: 6673 3a0a 2020 2020 2020 2020 2020 2020  fs:.            
-00017020: 2020 2020 6e65 775f 636f 6d70 6f6e 656e      new_componen
-00017030: 742e 666c 6174 7465 6e5f 7265 6665 7265  t.flatten_refere
-00017040: 6e63 6528 7265 6629 0a20 2020 2020 2020  nce(ref).       
-00017050: 2020 2020 2065 6c69 6620 280a 2020 2020       elif (.    
-00017060: 2020 2020 2020 2020 2020 2020 7265 662e              ref.
-00017070: 7061 7265 6e74 2e6e 616d 6520 696e 2075  parent.name in u
-00017080: 7064 6174 6564 5f63 6f6d 706f 6e65 6e74  pdated_component
-00017090: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-000170a0: 2020 616e 6420 7265 662e 7061 7265 6e74    and ref.parent
-000170b0: 2069 7320 6e6f 7420 7570 6461 7465 645f   is not updated_
-000170c0: 636f 6d70 6f6e 656e 7473 5b72 6566 2e70  components[ref.p
-000170d0: 6172 656e 742e 6e61 6d65 5d0a 2020 2020  arent.name].    
-000170e0: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-000170f0: 2020 2020 2020 2020 2020 2072 6566 2e70             ref.p
-00017100: 6172 656e 7420 3d20 7570 6461 7465 645f  arent = updated_
-00017110: 636f 6d70 6f6e 656e 7473 5b72 6566 2e70  components[ref.p
-00017120: 6172 656e 742e 6e61 6d65 5d0a 2020 2020  arent.name].    
-00017130: 2020 2020 636f 6d70 6f6e 656e 7420 3d20      component = 
-00017140: 6e65 775f 636f 6d70 6f6e 656e 740a 2020  new_component.  
-00017150: 2020 2020 2020 7570 6461 7465 645f 636f        updated_co
-00017160: 6d70 6f6e 656e 7473 5b63 6f6d 706f 6e65  mponents[compone
-00017170: 6e74 2e6e 616d 655d 203d 206e 6577 5f63  nt.name] = new_c
-00017180: 6f6d 706f 6e65 6e74 0a20 2020 2074 7261  omponent.    tra
-00017190: 7665 7273 6564 5f63 6f6d 706f 6e65 6e74  versed_component
-000171a0: 732e 6164 6428 636f 6d70 6f6e 656e 742e  s.add(component.
-000171b0: 6e61 6d65 290a 2020 2020 7265 7475 726e  name).    return
-000171c0: 2063 6f6d 706f 6e65 6e74 0a0a 0a64 6566   component...def
-000171d0: 205f 6368 6563 6b5f 756e 6361 6368 6564   _check_uncached
-000171e0: 5f63 6f6d 706f 6e65 6e74 7328 636f 6d70  _components(comp
-000171f0: 6f6e 656e 742c 206d 6f64 6529 3a0a 2020  onent, mode):.  
-00017200: 2020 7661 6c69 645f 6d6f 6465 7320 3d20    valid_modes = 
-00017210: 5b22 7761 726e 222c 2022 6572 726f 7222  ["warn", "error"
-00017220: 2c20 2269 676e 6f72 6522 5d0a 0a20 2020  , "ignore"]..   
-00017230: 2069 6620 6d6f 6465 203d 3d20 2269 676e   if mode == "ign
-00017240: 6f72 6522 3a0a 2020 2020 2020 2020 7265  ore":.        re
-00017250: 7475 726e 0a20 2020 2065 6c69 6620 6d6f  turn.    elif mo
-00017260: 6465 206e 6f74 2069 6e20 7661 6c69 645f  de not in valid_
-00017270: 6d6f 6465 733a 0a20 2020 2020 2020 2072  modes:.        r
-00017280: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00017290: 0a20 2020 2020 2020 2020 2020 2066 227b  .            f"{
-000172a0: 6d6f 6465 7d20 6973 206e 6f74 2061 2076  mode} is not a v
-000172b0: 616c 6964 2076 616c 7565 2066 6f72 206f  alid value for o
-000172c0: 6e5f 756e 6361 6368 6564 5f63 6f6d 706f  n_uncached_compo
-000172d0: 6e65 6e74 2e20 5472 7920 6f6e 6520 6f66  nent. Try one of
-000172e0: 2074 6865 7365 3a20 7b76 616c 6964 5f6d   these: {valid_m
-000172f0: 6f64 6573 7d2e 220a 2020 2020 2020 2020  odes}.".        
-00017300: 290a 0a20 2020 2066 6f72 2073 7562 5f63  )..    for sub_c
-00017310: 6f6d 706f 6e65 6e74 2069 6e20 636f 6d70  omponent in comp
-00017320: 6f6e 656e 742e 6765 745f 6465 7065 6e64  onent.get_depend
-00017330: 656e 6369 6573 2872 6563 7572 7369 7665  encies(recursive
-00017340: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
-00017350: 6966 206e 6f74 2073 7562 5f63 6f6d 706f  if not sub_compo
-00017360: 6e65 6e74 2e5f 6c6f 636b 6564 3a0a 2020  nent._locked:.  
-00017370: 2020 2020 2020 2020 2020 6d65 7373 6167            messag
-00017380: 6520 3d20 280a 2020 2020 2020 2020 2020  e = (.          
-00017390: 2020 2020 2020 6622 436f 6d70 6f6e 656e        f"Componen
-000173a0: 7420 7b73 7562 5f63 6f6d 706f 6e65 6e74  t {sub_component
-000173b0: 2e6e 616d 6521 727d 2077 6173 204e 4f54  .name!r} was NOT
-000173c0: 2070 726f 7065 726c 7920 6c6f 636b 6564   properly locked
-000173d0: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
-000173e0: 2020 2020 2259 6f75 206e 6565 6420 746f      "You need to
-000173f0: 2077 7269 7465 2069 7420 696e 746f 2061   write it into a
-00017400: 2066 756e 6374 696f 6e20 7468 6174 2068   function that h
-00017410: 6173 2074 6865 2040 6365 6c6c 2064 6563  as the @cell dec
-00017420: 6f72 6174 6f72 2e22 0a20 2020 2020 2020  orator.".       
-00017430: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00017440: 2020 2069 6620 6d6f 6465 203d 3d20 2277     if mode == "w
-00017450: 6172 6e22 3a0a 2020 2020 2020 2020 2020  arn":.          
-00017460: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
-00017470: 6172 6e28 6d65 7373 6167 652c 2055 6e63  arn(message, Unc
-00017480: 6163 6865 6443 6f6d 706f 6e65 6e74 5761  achedComponentWa
-00017490: 726e 696e 6729 0a0a 2020 2020 2020 2020  rning)..        
-000174a0: 2020 2020 656c 6966 206d 6f64 6520 3d3d      elif mode ==
-000174b0: 2022 6572 726f 7222 3a0a 2020 2020 2020   "error":.      
-000174c0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000174d0: 556e 6361 6368 6564 436f 6d70 6f6e 656e  UncachedComponen
-000174e0: 7445 7272 6f72 286d 6573 7361 6765 290a  tError(message).
-000174f0: 0a0a 6465 6620 7465 7374 5f73 616d 655f  ..def test_same_
-00017500: 7569 6428 2920 2d3e 204e 6f6e 653a 0a20  uid() -> None:. 
-00017510: 2020 2069 6d70 6f72 7420 6764 7366 6163     import gdsfac
-00017520: 746f 7279 2061 7320 6766 0a0a 2020 2020  tory as gf..    
-00017530: 6320 3d20 436f 6d70 6f6e 656e 7428 290a  c = Component().
-00017540: 2020 2020 6320 3c3c 2067 662e 636f 6d70      c << gf.comp
-00017550: 6f6e 656e 7473 2e72 6563 7461 6e67 6c65  onents.rectangle
-00017560: 2829 0a20 2020 2063 203c 3c20 6766 2e63  ().    c << gf.c
-00017570: 6f6d 706f 6e65 6e74 732e 7265 6374 616e  omponents.rectan
-00017580: 676c 6528 290a 0a20 2020 2072 3120 3d20  gle()..    r1 = 
-00017590: 632e 7265 6665 7265 6e63 6573 5b30 5d2e  c.references[0].
-000175a0: 7061 7265 6e74 0a20 2020 2072 3220 3d20  parent.    r2 = 
-000175b0: 632e 7265 6665 7265 6e63 6573 5b31 5d2e  c.references[1].
-000175c0: 7061 7265 6e74 0a0a 2020 2020 6173 7365  parent..    asse
-000175d0: 7274 2072 312e 7569 6420 3d3d 2072 322e  rt r1.uid == r2.
-000175e0: 7569 642c 2066 227b 7231 2e75 6964 7d20  uid, f"{r1.uid} 
-000175f0: 6d75 7374 2065 7175 616c 207b 7232 2e75  must equal {r2.u
-00017600: 6964 7d22 0a0a 0a64 6566 2074 6573 745f  id}"...def test_
-00017610: 6e65 746c 6973 745f 7369 6d70 6c65 2829  netlist_simple()
-00017620: 202d 3e20 4e6f 6e65 3a0a 2020 2020 696d   -> None:.    im
-00017630: 706f 7274 2067 6473 6661 6374 6f72 7920  port gdsfactory 
-00017640: 6173 2067 660a 0a20 2020 2063 203d 2067  as gf..    c = g
-00017650: 662e 436f 6d70 6f6e 656e 7428 290a 2020  f.Component().  
-00017660: 2020 6331 203d 2063 203c 3c20 6766 2e63    c1 = c << gf.c
-00017670: 6f6d 706f 6e65 6e74 732e 7374 7261 6967  omponents.straig
-00017680: 6874 286c 656e 6774 683d 312c 2077 6964  ht(length=1, wid
-00017690: 7468 3d32 290a 2020 2020 6332 203d 2063  th=2).    c2 = c
-000176a0: 203c 3c20 6766 2e63 6f6d 706f 6e65 6e74   << gf.component
-000176b0: 732e 7374 7261 6967 6874 286c 656e 6774  s.straight(lengt
-000176c0: 683d 322c 2077 6964 7468 3d32 290a 2020  h=2, width=2).  
-000176d0: 2020 6332 2e63 6f6e 6e65 6374 2870 6f72    c2.connect(por
-000176e0: 743d 226f 3122 2c20 6465 7374 696e 6174  t="o1", destinat
-000176f0: 696f 6e3d 6331 2e70 6f72 7473 5b22 6f32  ion=c1.ports["o2
-00017700: 225d 290a 2020 2020 632e 6164 645f 706f  "]).    c.add_po
-00017710: 7274 2822 6f31 222c 2070 6f72 743d 6331  rt("o1", port=c1
-00017720: 2e70 6f72 7473 5b22 6f31 225d 290a 2020  .ports["o1"]).  
-00017730: 2020 632e 6164 645f 706f 7274 2822 6f32    c.add_port("o2
-00017740: 222c 2070 6f72 743d 6332 2e70 6f72 7473  ", port=c2.ports
-00017750: 5b22 6f32 225d 290a 2020 2020 6e65 746c  ["o2"]).    netl
-00017760: 6973 7420 3d20 632e 6765 745f 6e65 746c  ist = c.get_netl
-00017770: 6973 7428 290a 2020 2020 2320 7072 696e  ist().    # prin
-00017780: 7428 6e65 746c 6973 742e 7072 6574 7479  t(netlist.pretty
-00017790: 2829 290a 2020 2020 6173 7365 7274 206c  ()).    assert l
-000177a0: 656e 286e 6574 6c69 7374 5b22 696e 7374  en(netlist["inst
-000177b0: 616e 6365 7322 5d29 203d 3d20 320a 0a0a  ances"]) == 2...
-000177c0: 6465 6620 7465 7374 5f6e 6574 6c69 7374  def test_netlist
-000177d0: 5f73 696d 706c 655f 7769 6474 685f 6d69  _simple_width_mi
-000177e0: 736d 6174 6368 5f74 6872 6f77 735f 6572  smatch_throws_er
-000177f0: 726f 7228 2920 2d3e 204e 6f6e 653a 0a20  ror() -> None:. 
-00017800: 2020 2069 6d70 6f72 7420 7079 7465 7374     import pytest
-00017810: 0a0a 2020 2020 696d 706f 7274 2067 6473  ..    import gds
-00017820: 6661 6374 6f72 7920 6173 2067 660a 0a20  factory as gf.. 
-00017830: 2020 2063 203d 2067 662e 436f 6d70 6f6e     c = gf.Compon
-00017840: 656e 7428 290a 2020 2020 6331 203d 2063  ent().    c1 = c
-00017850: 203c 3c20 6766 2e63 6f6d 706f 6e65 6e74   << gf.component
-00017860: 732e 7374 7261 6967 6874 286c 656e 6774  s.straight(lengt
-00017870: 683d 312c 2077 6964 7468 3d31 290a 2020  h=1, width=1).  
-00017880: 2020 6332 203d 2063 203c 3c20 6766 2e63    c2 = c << gf.c
-00017890: 6f6d 706f 6e65 6e74 732e 7374 7261 6967  omponents.straig
-000178a0: 6874 286c 656e 6774 683d 322c 2077 6964  ht(length=2, wid
-000178b0: 7468 3d32 290a 2020 2020 6332 2e63 6f6e  th=2).    c2.con
-000178c0: 6e65 6374 2870 6f72 743d 226f 3122 2c20  nect(port="o1", 
-000178d0: 6465 7374 696e 6174 696f 6e3d 6331 2e70  destination=c1.p
-000178e0: 6f72 7473 5b22 6f32 225d 290a 2020 2020  orts["o2"]).    
-000178f0: 632e 6164 645f 706f 7274 2822 6f31 222c  c.add_port("o1",
-00017900: 2070 6f72 743d 6331 2e70 6f72 7473 5b22   port=c1.ports["
-00017910: 6f31 225d 290a 2020 2020 632e 6164 645f  o1"]).    c.add_
-00017920: 706f 7274 2822 6f32 222c 2070 6f72 743d  port("o2", port=
-00017930: 6332 2e70 6f72 7473 5b22 6f32 225d 290a  c2.ports["o2"]).
-00017940: 2020 2020 7769 7468 2070 7974 6573 742e      with pytest.
-00017950: 7261 6973 6573 2856 616c 7565 4572 726f  raises(ValueErro
-00017960: 7229 3a0a 2020 2020 2020 2020 632e 6765  r):.        c.ge
-00017970: 745f 6e65 746c 6973 7428 290a 0a0a 6465  t_netlist()...de
-00017980: 6620 7465 7374 5f6e 6574 6c69 7374 5f63  f test_netlist_c
-00017990: 6f6d 706c 6578 2829 202d 3e20 4e6f 6e65  omplex() -> None
-000179a0: 3a0a 2020 2020 696d 706f 7274 2067 6473  :.    import gds
-000179b0: 6661 6374 6f72 7920 6173 2067 660a 0a20  factory as gf.. 
-000179c0: 2020 2063 203d 2067 662e 636f 6d70 6f6e     c = gf.compon
-000179d0: 656e 7473 2e6d 7a69 5f61 726d 7328 290a  ents.mzi_arms().
-000179e0: 2020 2020 6e65 746c 6973 7420 3d20 632e      netlist = c.
-000179f0: 6765 745f 6e65 746c 6973 7428 290a 2020  get_netlist().  
-00017a00: 2020 2320 7072 696e 7428 6e65 746c 6973    # print(netlis
-00017a10: 742e 7072 6574 7479 2829 290a 2020 2020  t.pretty()).    
-00017a20: 6173 7365 7274 206c 656e 286e 6574 6c69  assert len(netli
-00017a30: 7374 5b22 696e 7374 616e 6365 7322 5d29  st["instances"])
-00017a40: 203d 3d20 342c 206c 656e 286e 6574 6c69   == 4, len(netli
-00017a50: 7374 5b22 696e 7374 616e 6365 7322 5d29  st["instances"])
-00017a60: 0a0a 0a64 6566 2074 6573 745f 6578 7472  ...def test_extr
-00017a70: 6163 7428 2920 2d3e 2043 6f6d 706f 6e65  act() -> Compone
-00017a80: 6e74 3a0a 2020 2020 696d 706f 7274 2067  nt:.    import g
-00017a90: 6473 6661 6374 6f72 7920 6173 2067 660a  dsfactory as gf.
-00017aa0: 0a20 2020 2063 203d 2067 662e 636f 6d70  .    c = gf.comp
-00017ab0: 6f6e 656e 7473 2e73 7472 6169 6768 7428  onents.straight(
-00017ac0: 0a20 2020 2020 2020 206c 656e 6774 683d  .        length=
-00017ad0: 3130 2c0a 2020 2020 2020 2020 7769 6474  10,.        widt
-00017ae0: 683d 302e 352c 0a20 2020 2020 2020 2062  h=0.5,.        b
-00017af0: 626f 785f 6c61 7965 7273 3d5b 6766 2e4c  box_layers=[gf.L
-00017b00: 4159 4552 2e57 4743 4c41 445d 2c0a 2020  AYER.WGCLAD],.  
-00017b10: 2020 2020 2020 6262 6f78 5f6f 6666 7365        bbox_offse
-00017b20: 7473 3d5b 335d 2c0a 2020 2020 2020 2020  ts=[3],.        
-00017b30: 7769 7468 5f62 626f 783d 5472 7565 2c0a  with_bbox=True,.
-00017b40: 2020 2020 2020 2020 636c 6164 6469 6e67          cladding
-00017b50: 5f6c 6179 6572 733d 4e6f 6e65 2c0a 2020  _layers=None,.  
-00017b60: 2020 2020 2020 6164 645f 7069 6e73 3d4e        add_pins=N
-00017b70: 6f6e 652c 0a20 2020 2020 2020 2061 6464  one,.        add
-00017b80: 5f62 626f 783d 4e6f 6e65 2c0a 2020 2020  _bbox=None,.    
-00017b90: 290a 2020 2020 6332 203d 2063 2e65 7874  ).    c2 = c.ext
-00017ba0: 7261 6374 286c 6179 6572 733d 5b67 662e  ract(layers=[gf.
-00017bb0: 4c41 5945 522e 5747 434c 4144 5d29 0a0a  LAYER.WGCLAD])..
-00017bc0: 2020 2020 6173 7365 7274 206c 656e 2863      assert len(c
-00017bd0: 2e70 6f6c 7967 6f6e 7329 203d 3d20 322c  .polygons) == 2,
-00017be0: 206c 656e 2863 2e70 6f6c 7967 6f6e 7329   len(c.polygons)
-00017bf0: 0a20 2020 2061 7373 6572 7420 6c65 6e28  .    assert len(
-00017c00: 6332 2e70 6f6c 7967 6f6e 7329 203d 3d20  c2.polygons) == 
-00017c10: 312c 206c 656e 2863 322e 706f 6c79 676f  1, len(c2.polygo
-00017c20: 6e73 290a 2020 2020 6173 7365 7274 2067  ns).    assert g
-00017c30: 662e 4c41 5945 522e 5747 434c 4144 2069  f.LAYER.WGCLAD i
-00017c40: 6e20 6332 2e6c 6179 6572 730a 2020 2020  n c2.layers.    
-00017c50: 7265 7475 726e 2063 320a 0a0a 6465 6620  return c2...def 
-00017c60: 6861 7368 5f66 696c 6528 6669 6c65 7061  hash_file(filepa
-00017c70: 7468 293a 0a20 2020 206d 6435 203d 2068  th):.    md5 = h
-00017c80: 6173 686c 6962 2e6d 6435 2829 0a20 2020  ashlib.md5().   
-00017c90: 206d 6435 2e75 7064 6174 6528 6669 6c65   md5.update(file
-00017ca0: 7061 7468 2e72 6561 645f 6279 7465 7328  path.read_bytes(
-00017cb0: 2929 0a20 2020 2072 6574 7572 6e20 6d64  )).    return md
-00017cc0: 352e 6865 7864 6967 6573 7428 290a 0a0a  5.hexdigest()...
-00017cd0: 6465 6620 7465 7374 5f62 626f 785f 7265  def test_bbox_re
-00017ce0: 6665 7265 6e63 6528 2920 2d3e 2043 6f6d  ference() -> Com
-00017cf0: 706f 6e65 6e74 3a0a 2020 2020 696d 706f  ponent:.    impo
-00017d00: 7274 2067 6473 6661 6374 6f72 7920 6173  rt gdsfactory as
-00017d10: 2067 660a 0a20 2020 2063 203d 2067 662e   gf..    c = gf.
-00017d20: 436f 6d70 6f6e 656e 7428 2263 6f6d 706f  Component("compo
-00017d30: 6e65 6e74 5f77 6974 685f 6f66 6667 7269  nent_with_offgri
-00017d40: 645f 706f 6c79 676f 6e73 2229 0a20 2020  d_polygons").   
-00017d50: 2063 3120 3d20 6320 3c3c 2067 662e 636f   c1 = c << gf.co
-00017d60: 6d70 6f6e 656e 7473 2e72 6563 7461 6e67  mponents.rectang
-00017d70: 6c65 2873 697a 653d 2831 2e35 652d 332c  le(size=(1.5e-3,
-00017d80: 2031 2e35 652d 3329 2c20 706f 7274 5f74   1.5e-3), port_t
-00017d90: 7970 653d 4e6f 6e65 290a 2020 2020 6332  ype=None).    c2
-00017da0: 203d 2063 203c 3c20 6766 2e63 6f6d 706f   = c << gf.compo
-00017db0: 6e65 6e74 732e 7265 6374 616e 676c 6528  nents.rectangle(
-00017dc0: 7369 7a65 3d28 312e 3565 2d33 2c20 312e  size=(1.5e-3, 1.
-00017dd0: 3565 2d33 292c 2070 6f72 745f 7479 7065  5e-3), port_type
-00017de0: 3d4e 6f6e 6529 0a20 2020 2063 322e 786d  =None).    c2.xm
-00017df0: 696e 203d 2063 312e 786d 6178 0a0a 2020  in = c1.xmax..  
-00017e00: 2020 6173 7365 7274 2063 322e 7873 697a    assert c2.xsiz
-00017e10: 6520 3d3d 2032 652d 330a 2020 2020 7265  e == 2e-3.    re
-00017e20: 7475 726e 2063 320a 0a0a 6465 6620 7465  turn c2...def te
-00017e30: 7374 5f62 626f 785f 636f 6d70 6f6e 656e  st_bbox_componen
-00017e40: 7428 2920 2d3e 204e 6f6e 653a 0a20 2020  t() -> None:.   
-00017e50: 2069 6d70 6f72 7420 6764 7366 6163 746f   import gdsfacto
-00017e60: 7279 2061 7320 6766 0a0a 2020 2020 6320  ry as gf..    c 
-00017e70: 3d20 6766 2e63 6f6d 706f 6e65 6e74 732e  = gf.components.
-00017e80: 7265 6374 616e 676c 6528 7369 7a65 3d28  rectangle(size=(
-00017e90: 312e 3565 2d33 2c20 312e 3565 2d33 292c  1.5e-3, 1.5e-3),
-00017ea0: 2070 6f72 745f 7479 7065 3d4e 6f6e 6529   port_type=None)
-00017eb0: 0a20 2020 2061 7373 6572 7420 632e 7873  .    assert c.xs
-00017ec0: 697a 6520 3d3d 2032 652d 330a 0a0a 6465  ize == 2e-3...de
-00017ed0: 6620 7465 7374 5f72 656d 6170 5f6c 6179  f test_remap_lay
-00017ee0: 6572 7328 2920 2d3e 204e 6f6e 653a 0a20  ers() -> None:. 
-00017ef0: 2020 2069 6d70 6f72 7420 6764 7366 6163     import gdsfac
-00017f00: 746f 7279 2061 7320 6766 0a0a 2020 2020  tory as gf..    
-00017f10: 6320 3d20 6766 2e63 6f6d 706f 6e65 6e74  c = gf.component
-00017f20: 732e 7374 7261 6967 6874 286c 6179 6572  s.straight(layer
-00017f30: 3d28 322c 2030 2929 0a20 2020 2072 656d  =(2, 0)).    rem
-00017f40: 6170 203d 2063 2e72 656d 6170 5f6c 6179  ap = c.remap_lay
-00017f50: 6572 7328 6c61 7965 726d 6170 3d7b 2832  ers(layermap={(2
-00017f60: 2c20 3029 3a20 6766 2e4c 4159 4552 2e57  , 0): gf.LAYER.W
-00017f70: 474e 7d29 0a20 2020 2068 6173 685f 6765  GN}).    hash_ge
-00017f80: 6f6d 6574 7279 203d 2022 3833 6662 6336  ometry = "83fbc6
-00017f90: 6138 3238 3935 3035 6561 6564 3361 3265  a8289505eaed3a2e
-00017fa0: 3361 6232 3739 6363 3033 6635 6534 6430  3ab279cc03f5e4d0
-00017fb0: 3063 220a 0a20 2020 2061 7373 6572 7420  0c"..    assert 
-00017fc0: 280a 2020 2020 2020 2020 7265 6d61 702e  (.        remap.
-00017fd0: 6861 7368 5f67 656f 6d65 7472 7928 2920  hash_geometry() 
-00017fe0: 3d3d 2068 6173 685f 6765 6f6d 6574 7279  == hash_geometry
-00017ff0: 0a20 2020 2029 2c20 6622 6861 7368 5f67  .    ), f"hash_g
-00018000: 656f 6d65 7472 7920 3d20 7b72 656d 6170  eometry = {remap
-00018010: 2e68 6173 685f 6765 6f6d 6574 7279 2829  .hash_geometry()
-00018020: 2172 7d22 0a0a 0a64 6566 2074 6573 745f  !r}"...def test_
-00018030: 7265 6d6f 7665 5f6c 6162 656c 7328 2920  remove_labels() 
-00018040: 2d3e 204e 6f6e 653a 0a20 2020 2069 6d70  -> None:.    imp
-00018050: 6f72 7420 6764 7366 6163 746f 7279 2061  ort gdsfactory a
-00018060: 7320 6766 0a0a 2020 2020 6320 3d20 6766  s gf..    c = gf
-00018070: 2e63 2e73 7472 6169 6768 7428 290a 2020  .c.straight().  
-00018080: 2020 632e 7265 6d6f 7665 5f6c 6162 656c    c.remove_label
-00018090: 7328 290a 0a20 2020 2061 7373 6572 7420  s()..    assert 
-000180a0: 6c65 6e28 632e 6c61 6265 6c73 2920 3d3d  len(c.labels) ==
-000180b0: 2030 0a0a 0a64 6566 2074 6573 745f 696d   0...def test_im
-000180c0: 706f 7274 5f67 6473 5f73 6574 7469 6e67  port_gds_setting
-000180d0: 7328 293a 0a20 2020 2069 6d70 6f72 7420  s():.    import 
-000180e0: 6764 7366 6163 746f 7279 2061 7320 6766  gdsfactory as gf
-000180f0: 0a0a 2020 2020 6320 3d20 6766 2e63 6f6d  ..    c = gf.com
-00018100: 706f 6e65 6e74 732e 6d7a 6928 290a 2020  ponents.mzi().  
-00018110: 2020 6764 7370 6174 6820 3d20 632e 7772    gdspath = c.wr
-00018120: 6974 655f 6764 735f 7769 7468 5f6d 6574  ite_gds_with_met
-00018130: 6164 6174 6128 290a 2020 2020 6332 203d  adata().    c2 =
-00018140: 2067 662e 696d 706f 7274 5f67 6473 2867   gf.import_gds(g
-00018150: 6473 7061 7468 2c20 6e61 6d65 3d22 6d7a  dspath, name="mz
-00018160: 695f 7361 6d70 6c65 222c 2072 6561 645f  i_sample", read_
-00018170: 6d65 7461 6461 7461 3d54 7275 6529 0a20  metadata=True). 
-00018180: 2020 2063 3320 3d20 6766 2e72 6f75 7469     c3 = gf.routi
-00018190: 6e67 2e61 6464 5f66 6962 6572 5f73 696e  ng.add_fiber_sin
-000181a0: 676c 6528 6332 290a 2020 2020 6173 7365  gle(c2).    asse
-000181b0: 7274 2063 330a 0a0a 6465 6620 7465 7374  rt c3...def test
-000181c0: 5f66 6c61 7474 656e 5f69 6e76 616c 6964  _flatten_invalid
-000181d0: 5f72 6566 735f 7265 6375 7273 6976 6528  _refs_recursive(
-000181e0: 293a 0a20 2020 2069 6d70 6f72 7420 6764  ):.    import gd
-000181f0: 7366 6163 746f 7279 2061 7320 6766 0a20  sfactory as gf. 
-00018200: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-00018210: 7279 2e64 6966 6674 6573 7420 696d 706f  ry.difftest impo
-00018220: 7274 2072 756e 5f78 6f72 0a20 2020 2066  rt run_xor.    f
-00018230: 726f 6d20 6764 7366 6163 746f 7279 2e72  rom gdsfactory.r
-00018240: 6f75 7469 6e67 2e61 6c6c 5f61 6e67 6c65  outing.all_angle
-00018250: 2069 6d70 6f72 7420 6765 745f 6275 6e64   import get_bund
-00018260: 6c65 5f61 6c6c 5f61 6e67 6c65 0a0a 2020  le_all_angle..  
-00018270: 2020 4067 662e 6365 6c6c 0a20 2020 2064    @gf.cell.    d
-00018280: 6566 2066 6c61 7428 293a 0a20 2020 2020  ef flat():.     
-00018290: 2020 2063 203d 2067 662e 436f 6d70 6f6e     c = gf.Compon
-000182a0: 656e 7428 290a 2020 2020 2020 2020 6d6d  ent().        mm
-000182b0: 6931 203d 2028 6320 3c3c 2067 662e 636f  i1 = (c << gf.co
-000182c0: 6d70 6f6e 656e 7473 2e6d 6d69 3178 3228  mponents.mmi1x2(
-000182d0: 2929 2e6d 6f76 6528 2830 2c20 2d31 2e30  )).move((0, -1.0
-000182e0: 3030 3529 290a 2020 2020 2020 2020 6d6d  005)).        mm
-000182f0: 6932 203d 2028 6320 3c3c 2067 662e 636f  i2 = (c << gf.co
-00018300: 6d70 6f6e 656e 7473 2e6d 6d69 3178 3228  mponents.mmi1x2(
-00018310: 2929 2e72 6f74 6174 6528 3830 290a 2020  )).rotate(80).  
-00018320: 2020 2020 2020 6d6d 6932 2e6d 6f76 6528        mmi2.move(
-00018330: 2834 302c 2032 3029 290a 2020 2020 2020  (40, 20)).      
-00018340: 2020 6275 6e64 6c65 203d 2067 6574 5f62    bundle = get_b
-00018350: 756e 646c 655f 616c 6c5f 616e 676c 6528  undle_all_angle(
-00018360: 5b6d 6d69 312e 706f 7274 735b 226f 3222  [mmi1.ports["o2"
-00018370: 5d5d 2c20 5b6d 6d69 322e 706f 7274 735b  ]], [mmi2.ports[
-00018380: 226f 3122 5d5d 290a 2020 2020 2020 2020  "o1"]]).        
-00018390: 666f 7220 726f 7574 6520 696e 2062 756e  for route in bun
-000183a0: 646c 653a 0a20 2020 2020 2020 2020 2020  dle:.           
-000183b0: 2063 2e61 6464 2872 6f75 7465 2e72 6566   c.add(route.ref
-000183c0: 6572 656e 6365 7329 0a20 2020 2020 2020  erences).       
-000183d0: 2072 6574 7572 6e20 630a 0a20 2020 2040   return c..    @
-000183e0: 6766 2e63 656c 6c0a 2020 2020 6465 6620  gf.cell.    def 
-000183f0: 6869 6572 6172 6368 7928 293a 0a20 2020  hierarchy():.   
-00018400: 2020 2020 2063 203d 2067 662e 436f 6d70       c = gf.Comp
-00018410: 6f6e 656e 7428 290a 2020 2020 2020 2020  onent().        
-00018420: 2863 203c 3c20 666c 6174 2829 292e 726f  (c << flat()).ro
-00018430: 7461 7465 2833 3329 0a20 2020 2020 2020  tate(33).       
-00018440: 2028 6320 3c3c 2066 6c61 7428 2929 2e72   (c << flat()).r
-00018450: 6f74 6174 6528 3333 292e 6d6f 7665 2828  otate(33).move((
-00018460: 302c 2031 3030 2929 0a20 2020 2020 2020  0, 100)).       
-00018470: 2028 6320 3c3c 2066 6c61 7428 2929 2e6d   (c << flat()).m
-00018480: 6f76 6528 2831 3030 2c20 3029 290a 2020  ove((100, 0)).  
-00018490: 2020 2020 2020 7265 7475 726e 2063 0a0a        return c..
-000184a0: 2020 2020 635f 6f72 6967 203d 2068 6965      c_orig = hie
-000184b0: 7261 7263 6879 2829 0a20 2020 2063 5f6e  rarchy().    c_n
-000184c0: 6577 203d 2066 6c61 7474 656e 5f69 6e76  ew = flatten_inv
-000184d0: 616c 6964 5f72 6566 735f 7265 6375 7273  alid_refs_recurs
-000184e0: 6976 6528 635f 6f72 6967 290a 2020 2020  ive(c_orig).    
-000184f0: 6173 7365 7274 2063 5f6e 6577 2069 7320  assert c_new is 
-00018500: 6e6f 7420 635f 6f72 6967 0a20 2020 2069  not c_orig.    i
-00018510: 6e76 616c 6964 5f72 6566 735f 6669 6c65  nvalid_refs_file
-00018520: 6e61 6d65 203d 2022 696e 7661 6c69 645f  name = "invalid_
-00018530: 7265 6673 2e67 6473 220a 2020 2020 696e  refs.gds".    in
-00018540: 7661 6c69 645f 7265 6673 5f66 6978 6564  valid_refs_fixed
-00018550: 5f66 696c 656e 616d 6520 3d20 2269 6e76  _filename = "inv
-00018560: 616c 6964 5f72 6566 735f 6669 7865 642e  alid_refs_fixed.
-00018570: 6764 7322 0a20 2020 2023 2067 6473 2066  gds".    # gds f
-00018580: 696c 6573 2073 686f 756c 6420 7374 696c  iles should stil
-00018590: 6c20 6265 2073 616d 6520 746f 2031 6e6d  l be same to 1nm
-000185a0: 2074 6f6c 6572 616e 6365 0a20 2020 2063   tolerance.    c
-000185b0: 5f6f 7269 672e 7772 6974 655f 6764 7328  _orig.write_gds(
-000185c0: 696e 7661 6c69 645f 7265 6673 5f66 696c  invalid_refs_fil
-000185d0: 656e 616d 6529 0a20 2020 2063 5f6e 6577  ename).    c_new
-000185e0: 2e77 7269 7465 5f67 6473 2869 6e76 616c  .write_gds(inval
-000185f0: 6964 5f72 6566 735f 6669 7865 645f 6669  id_refs_fixed_fi
-00018600: 6c65 6e61 6d65 290a 2020 2020 7275 6e5f  lename).    run_
-00018610: 786f 7228 696e 7661 6c69 645f 7265 6673  xor(invalid_refs
-00018620: 5f66 696c 656e 616d 652c 2069 6e76 616c  _filename, inval
-00018630: 6964 5f72 6566 735f 6669 7865 645f 6669  id_refs_fixed_fi
-00018640: 6c65 6e61 6d65 290a 0a0a 6966 205f 5f6e  lename)...if __n
-00018650: 616d 655f 5f20 3d3d 2022 5f5f 6d61 696e  ame__ == "__main
-00018660: 5f5f 223a 0a20 2020 2069 6d70 6f72 7420  __":.    import 
-00018670: 6764 7366 6163 746f 7279 2061 7320 6766  gdsfactory as gf
-00018680: 0a0a 2020 2020 6320 3d20 6766 2e43 6f6d  ..    c = gf.Com
-00018690: 706f 6e65 6e74 2829 0a20 2020 2070 203d  ponent().    p =
-000186a0: 2063 2e61 6464 5f70 6f6c 7967 6f6e 280a   c.add_polygon(.
-000186b0: 2020 2020 2020 2020 5b28 2d38 2c20 362c          [(-8, 6,
-000186c0: 2037 2c20 3929 2c20 282d 362c 2038 2c20   7, 9), (-6, 8, 
-000186d0: 3137 2c20 3529 5d2c 206c 6179 6572 3d28  17, 5)], layer=(
-000186e0: 312c 2030 290a 2020 2020 2920 2023 2047  1, 0).    )  # G
-000186f0: 4453 206c 6179 6572 7320 6172 6520 7475  DS layers are tu
-00018700: 706c 6573 206f 6620 696e 7473 2028 6275  ples of ints (bu
-00018710: 7420 6966 2077 6520 7573 6520 6f6e 6c79  t if we use only
-00018720: 206f 6e65 206e 756d 6265 7220 6974 2061   one number it a
-00018730: 7373 756d 6573 2074 6865 206f 7468 6572  ssumes the other
-00018740: 206e 756d 6265 7220 6973 2030 290a 0a20   number is 0).. 
-00018750: 2020 2023 2063 3220 3d20 6766 2e43 6f6d     # c2 = gf.Com
-00018760: 706f 6e65 6e74 2829 0a20 2020 2063 203d  ponent().    c =
-00018770: 2067 662e 636f 6d70 6f6e 656e 7473 2e6d   gf.components.m
-00018780: 7a69 2829 0a20 2020 2070 7269 6e74 2863  zi().    print(c
-00018790: 2e67 6574 5f6c 6179 6572 5f6e 616d 6573  .get_layer_names
-000187a0: 2829 290a 2020 2020 2320 6320 3d20 6766  ()).    # c = gf
-000187b0: 2e63 6f6d 706f 6e65 6e74 732e 6d7a 6928  .components.mzi(
-000187c0: 290a 2020 2020 2320 7072 696e 7428 632e  ).    # print(c.
-000187d0: 6765 745f 6c61 7965 725f 6e61 6d65 7328  get_layer_names(
-000187e0: 2929 0a20 2020 2023 2072 203d 2063 2e72  )).    # r = c.r
-000187f0: 6566 2829 0a20 2020 2023 2063 322e 636f  ef().    # c2.co
-00018800: 7079 5f63 6869 6c64 5f69 6e66 6f28 632e  py_child_info(c.
-00018810: 6e61 6d65 645f 7265 6665 7265 6e63 6573  named_references
-00018820: 5b22 7378 7422 5d29 0a20 2020 2023 2074  ["sxt"]).    # t
-00018830: 6573 745f 7265 6d61 705f 6c61 7965 7273  est_remap_layers
-00018840: 2829 0a20 2020 2023 2063 203d 2074 6573  ().    # c = tes
-00018850: 745f 6765 745f 6c61 7965 7273 2829 0a20  t_get_layers(). 
-00018860: 2020 2023 2063 2e70 6c6f 745f 7174 2829     # c.plot_qt()
-00018870: 0a20 2020 2023 2063 2e70 6c6f 7468 2829  .    # c.ploth()
-00018880: 0a20 2020 2023 2063 203d 2074 6573 745f  .    # c = test_
-00018890: 6578 7472 6163 7428 290a 2020 2020 2320  extract().    # 
-000188a0: 6764 7370 6174 6820 3d20 632e 7772 6974  gdspath = c.writ
-000188b0: 655f 6764 7328 290a 2020 2020 2320 6766  e_gds().    # gf
-000188c0: 2e73 686f 7728 6764 7370 6174 6829 0a20  .show(gdspath). 
-000188d0: 2020 2023 2063 2e73 686f 7728 7368 6f77     # c.show(show
-000188e0: 5f70 6f72 7473 3d54 7275 6529 0a20 2020  _ports=True).   
-000188f0: 2063 2e73 686f 7728 290a                  c.show().
+00013c50: 2020 2066 6f72 206c 6179 6572 5f6e 756d     for layer_num
+00013c60: 6265 7220 696e 2072 616e 6765 286c 656e  ber in range(len
+00013c70: 286e 6577 5f6c 6179 6572 7329 293a 0a20  (new_layers)):. 
+00013c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c90: 2020 2020 2020 206f 7269 6769 6e61 6c5f         original_
+00013ca0: 6c61 7965 7220 3d20 5f70 6172 7365 5f6c  layer = _parse_l
+00013cb0: 6179 6572 280a 2020 2020 2020 2020 2020  ayer(.          
+00013cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013cd0: 2020 286e 6577 5f6c 6179 6572 735b 6c61    (new_layers[la
+00013ce0: 7965 725f 6e75 6d62 6572 5d2c 206e 6577  yer_number], new
+00013cf0: 5f64 6174 6174 7970 6573 5b6c 6179 6572  _datatypes[layer
+00013d00: 5f6e 756d 6265 725d 290a 2020 2020 2020  _number]).      
+00013d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d20: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00013d30: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+00013d40: 7269 6769 6e61 6c5f 6c61 7965 7220 696e  riginal_layer in
+00013d50: 206c 6179 6572 6d61 703a 0a20 2020 2020   layermap:.     
+00013d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d70: 2020 2020 2020 206e 6577 5f6c 6179 6572         new_layer
+00013d80: 203d 206c 6179 6572 6d61 705b 6f72 6967   = layermap[orig
+00013d90: 696e 616c 5f6c 6179 6572 5d0a 2020 2020  inal_layer].    
+00013da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013db0: 2020 2020 2020 2020 6e65 775f 6c61 7965          new_laye
+00013dc0: 7273 5b6c 6179 6572 5f6e 756d 6265 725d  rs[layer_number]
+00013dd0: 203d 206e 6577 5f6c 6179 6572 5b30 5d0a   = new_layer[0].
+00013de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013df0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00013e00: 6461 7461 7479 7065 735b 6c61 7965 725f  datatypes[layer_
+00013e10: 6e75 6d62 6572 5d20 3d20 6e65 775f 6c61  number] = new_la
+00013e20: 7965 725b 315d 0a20 2020 2020 2020 2020  yer[1].         
+00013e30: 2020 2020 2020 2020 2020 2070 6174 682e             path.
+00013e40: 7365 745f 6c61 7965 7273 282a 6e65 775f  set_layers(*new_
+00013e50: 6c61 7965 7273 290a 2020 2020 2020 2020  layers).        
+00013e60: 2020 2020 2020 2020 2020 2020 7061 7468              path
+00013e70: 2e73 6574 5f64 6174 6174 7970 6573 282a  .set_datatypes(*
+00013e80: 6e65 775f 6461 7461 7479 7065 7329 0a20  new_datatypes). 
+00013e90: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+00013ea0: 6d70 6f6e 656e 740a 0a20 2020 2064 6566  mponent..    def
+00013eb0: 2074 6f5f 3364 280a 2020 2020 2020 2020   to_3d(.        
+00013ec0: 7365 6c66 2c0a 2020 2020 2020 2020 6c61  self,.        la
+00013ed0: 7965 725f 7669 6577 733a 204f 7074 696f  yer_views: Optio
+00013ee0: 6e61 6c5b 4c61 7965 7256 6965 7773 5d20  nal[LayerViews] 
+00013ef0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00013f00: 6c61 7965 725f 7374 6163 6b3a 204f 7074  layer_stack: Opt
+00013f10: 696f 6e61 6c5b 4c61 7965 7253 7461 636b  ional[LayerStack
+00013f20: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00013f30: 2020 6578 636c 7564 655f 6c61 7965 7273    exclude_layers
+00013f40: 3a20 4f70 7469 6f6e 616c 5b54 7570 6c65  : Optional[Tuple
+00013f50: 5b4c 6179 6572 2c20 2e2e 2e5d 5d20 3d20  [Layer, ...]] = 
+00013f60: 4e6f 6e65 2c0a 2020 2020 293a 0a20 2020  None,.    ):.   
+00013f70: 2020 2020 2022 2222 5265 7475 726e 2043       """Return C
+00013f80: 6f6d 706f 6e65 6e74 2033 4420 7472 696d  omponent 3D trim
+00013f90: 6573 6820 5363 656e 652e 0a0a 2020 2020  esh Scene...    
+00013fa0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00013fb0: 2020 2020 2020 636f 6d70 6f6e 656e 743a        component:
+00013fc0: 2074 6f20 6578 7472 7564 6520 696e 2033   to extrude in 3
+00013fd0: 442e 0a20 2020 2020 2020 2020 2020 206c  D..            l
+00013fe0: 6179 6572 5f76 6965 7773 3a20 6c61 7965  ayer_views: laye
+00013ff0: 7220 636f 6c6f 7273 2066 726f 6d20 4b6c  r colors from Kl
+00014000: 6179 6f75 7420 4c61 7965 7220 5072 6f70  ayout Layer Prop
+00014010: 6572 7469 6573 2066 696c 652e 0a20 2020  erties file..   
+00014020: 2020 2020 2020 2020 2020 2020 2044 6566               Def
+00014030: 6175 6c74 7320 746f 2061 6374 6976 6520  aults to active 
+00014040: 5044 4b2e 6c61 7965 725f 7669 6577 732e  PDK.layer_views.
+00014050: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+00014060: 6572 5f73 7461 636b 3a20 636f 6e74 6169  er_stack: contai
+00014070: 6e73 2074 6869 636b 6e65 7373 2061 6e64  ns thickness and
+00014080: 207a 6d69 6e20 666f 7220 6561 6368 206c   zmin for each l
+00014090: 6179 6572 2e0a 2020 2020 2020 2020 2020  ayer..          
+000140a0: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
+000140b0: 6f20 6163 7469 7665 2050 444b 2e6c 6179  o active PDK.lay
+000140c0: 6572 5f73 7461 636b 2e0a 2020 2020 2020  er_stack..      
+000140d0: 2020 2020 2020 6578 636c 7564 655f 6c61        exclude_la
+000140e0: 7965 7273 3a20 6c61 7965 7273 2074 6f20  yers: layers to 
+000140f0: 6578 636c 7564 652e 0a0a 2020 2020 2020  exclude...      
+00014100: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
+00014110: 6f6d 2067 6473 6661 6374 6f72 792e 6578  om gdsfactory.ex
+00014120: 706f 7274 2e74 6f5f 3364 2069 6d70 6f72  port.to_3d impor
+00014130: 7420 746f 5f33 640a 0a20 2020 2020 2020  t to_3d..       
+00014140: 2072 6574 7572 6e20 746f 5f33 6428 0a20   return to_3d(. 
+00014150: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+00014160: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+00014170: 6572 5f76 6965 7773 3d6c 6179 6572 5f76  er_views=layer_v
+00014180: 6965 7773 2c0a 2020 2020 2020 2020 2020  iews,.          
+00014190: 2020 6c61 7965 725f 7374 6163 6b3d 6c61    layer_stack=la
+000141a0: 7965 725f 7374 6163 6b2c 0a20 2020 2020  yer_stack,.     
+000141b0: 2020 2020 2020 2065 7863 6c75 6465 5f6c         exclude_l
+000141c0: 6179 6572 733d 6578 636c 7564 655f 6c61  ayers=exclude_la
+000141d0: 7965 7273 2c0a 2020 2020 2020 2020 290a  yers,.        ).
+000141e0: 0a20 2020 2064 6566 2074 6f5f 6e70 280a  .    def to_np(.
+000141f0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+00014200: 2020 2020 2020 6e6d 5f70 6572 5f70 6978        nm_per_pix
+00014210: 656c 3a20 696e 7420 3d20 3230 2c0a 2020  el: int = 20,.  
+00014220: 2020 2020 2020 6c61 7965 7273 3a20 4c61        layers: La
+00014230: 7965 7273 203d 2028 2831 2c20 3029 2c29  yers = ((1, 0),)
+00014240: 2c0a 2020 2020 2020 2020 7661 6c75 6573  ,.        values
+00014250: 3a20 4f70 7469 6f6e 616c 5b54 7570 6c65  : Optional[Tuple
+00014260: 5b66 6c6f 6174 2c20 2e2e 2e5d 5d20 3d20  [float, ...]] = 
+00014270: 4e6f 6e65 2c0a 2020 2020 2020 2020 7061  None,.        pa
+00014280: 645f 7769 6474 683a 2069 6e74 203d 2031  d_width: int = 1
+00014290: 2c0a 2020 2020 2920 2d3e 206e 702e 6e64  ,.    ) -> np.nd
+000142a0: 6172 7261 793a 0a20 2020 2020 2020 2022  array:.        "
+000142b0: 2222 5265 7475 726e 7320 6120 7069 7865  ""Returns a pixe
+000142c0: 6c61 7465 6420 6e75 6d70 7920 6172 7261  lated numpy arra
+000142d0: 7920 6672 6f6d 2043 6f6d 706f 6e65 6e74  y from Component
+000142e0: 2070 6f6c 7967 6f6e 732e 0a0a 2020 2020   polygons...    
+000142f0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00014300: 2020 2020 2020 636f 6d70 6f6e 656e 743a        component:
+00014310: 2043 6f6d 706f 6e65 6e74 2e0a 2020 2020   Component..    
+00014320: 2020 2020 2020 2020 6e6d 5f70 6572 5f70          nm_per_p
+00014330: 6978 656c 3a20 796f 7520 6361 6e20 676f  ixel: you can go
+00014340: 2066 726f 6d20 3230 2028 636f 6172 7365   from 20 (coarse
+00014350: 2920 746f 2034 2028 6669 6e65 292e 0a20  ) to 4 (fine).. 
+00014360: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00014370: 733a 2074 6f20 636f 6e76 6572 742e 204f  s: to convert. O
+00014380: 7264 6572 206d 6174 7465 7273 2028 6c61  rder matters (la
+00014390: 7474 6572 206f 7665 7277 7269 7465 2066  tter overwrite f
+000143a0: 6f72 6d65 7229 2e0a 2020 2020 2020 2020  ormer)..        
+000143b0: 2020 2020 7661 6c75 6573 3a20 6173 736f      values: asso
+000143c0: 6369 6174 6564 2074 6f20 6561 6368 206c  ciated to each l
+000143d0: 6179 6572 2028 6465 6661 756c 7473 2074  ayer (defaults t
+000143e0: 6f20 3129 2e0a 2020 2020 2020 2020 2020  o 1)..          
+000143f0: 2020 7061 645f 7769 6474 683a 2070 6164    pad_width: pad
+00014400: 6469 6e67 2070 6978 656c 7320 6172 6f75  ding pixels arou
+00014410: 6e64 2074 6865 2069 6d61 6765 2e0a 0a20  nd the image... 
+00014420: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00014430: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+00014440: 7279 2e65 7870 6f72 742e 746f 5f6e 7020  ry.export.to_np 
+00014450: 696d 706f 7274 2074 6f5f 6e70 0a0a 2020  import to_np..  
+00014460: 2020 2020 2020 7265 7475 726e 2074 6f5f        return to_
+00014470: 6e70 280a 2020 2020 2020 2020 2020 2020  np(.            
+00014480: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+00014490: 2020 6e6d 5f70 6572 5f70 6978 656c 3d6e    nm_per_pixel=n
+000144a0: 6d5f 7065 725f 7069 7865 6c2c 0a20 2020  m_per_pixel,.   
+000144b0: 2020 2020 2020 2020 206c 6179 6572 733d           layers=
+000144c0: 6c61 7965 7273 2c0a 2020 2020 2020 2020  layers,.        
+000144d0: 2020 2020 7661 6c75 6573 3d76 616c 7565      values=value
+000144e0: 732c 0a20 2020 2020 2020 2020 2020 2070  s,.            p
+000144f0: 6164 5f77 6964 7468 3d70 6164 5f77 6964  ad_width=pad_wid
+00014500: 7468 2c0a 2020 2020 2020 2020 290a 0a20  th,.        ).. 
+00014510: 2020 2064 6566 2077 7269 7465 5f73 746c     def write_stl
+00014520: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00014530: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
+00014540: 3a20 7374 722c 0a20 2020 2020 2020 206c  : str,.        l
+00014550: 6179 6572 5f73 7461 636b 3a20 4f70 7469  ayer_stack: Opti
+00014560: 6f6e 616c 5b4c 6179 6572 5374 6163 6b5d  onal[LayerStack]
+00014570: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00014580: 2065 7863 6c75 6465 5f6c 6179 6572 733a   exclude_layers:
+00014590: 204f 7074 696f 6e61 6c5b 5475 706c 655b   Optional[Tuple[
+000145a0: 4c61 7965 722c 202e 2e2e 5d5d 203d 204e  Layer, ...]] = N
+000145b0: 6f6e 652c 0a20 2020 2029 202d 3e20 6e70  one,.    ) -> np
+000145c0: 2e6e 6461 7272 6179 3a0a 2020 2020 2020  .ndarray:.      
+000145d0: 2020 2222 2257 7269 7465 2061 2043 6f6d    """Write a Com
+000145e0: 706f 6e65 6e74 2074 6f20 5354 4c20 666f  ponent to STL fo
+000145f0: 7220 3344 2070 7269 6e74 696e 672e 0a0a  r 3D printing...
+00014600: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+00014610: 2020 2020 2020 2020 2020 6669 6c65 7061            filepa
+00014620: 7468 3a20 746f 2077 7269 7465 2053 544c  th: to write STL
+00014630: 2074 6f2e 0a20 2020 2020 2020 2020 2020   to..           
+00014640: 206c 6179 6572 5f73 7461 636b 3a20 636f   layer_stack: co
+00014650: 6e74 6169 6e73 2074 6869 636b 6e65 7373  ntains thickness
+00014660: 2061 6e64 207a 6d69 6e20 666f 7220 6561   and zmin for ea
+00014670: 6368 206c 6179 6572 2e0a 2020 2020 2020  ch layer..      
+00014680: 2020 2020 2020 6578 636c 7564 655f 6c61        exclude_la
+00014690: 7965 7273 3a20 6c61 7965 7273 2074 6f20  yers: layers to 
+000146a0: 6578 636c 7564 652e 0a20 2020 2020 2020  exclude..       
+000146b0: 2020 2020 2075 7365 5f6c 6179 6572 5f6e       use_layer_n
+000146c0: 616d 653a 2049 6620 5472 7565 2c20 7573  ame: If True, us
+000146d0: 6573 204c 6179 6572 4c65 7665 6c20 6e61  es LayerLevel na
+000146e0: 6d65 7320 696e 206f 7574 7075 7420 6669  mes in output fi
+000146f0: 6c65 6e61 6d65 7320 7261 7468 6572 2074  lenames rather t
+00014700: 6861 6e20 6764 735f 6c61 7965 7220 616e  han gds_layer an
+00014710: 6420 6764 735f 6461 7461 7479 7065 2e0a  d gds_datatype..
+00014720: 2020 2020 2020 2020 2020 2020 6875 6c6c              hull
+00014730: 5f69 6e76 616c 6964 5f70 6f6c 7967 6f6e  _invalid_polygon
+00014740: 733a 2049 6620 5472 7565 2c20 7265 706c  s: If True, repl
+00014750: 6163 6573 2069 6e76 616c 6964 2070 6f6c  aces invalid pol
+00014760: 7967 6f6e 7320 2864 6574 6572 6d69 6e65  ygons (determine
+00014770: 6420 6279 2073 6861 7065 6c79 2e50 6f6c  d by shapely.Pol
+00014780: 7967 6f6e 2e69 735f 7661 6c69 6429 2077  ygon.is_valid) w
+00014790: 6974 6820 6974 7320 636f 6e76 6578 2068  ith its convex h
+000147a0: 756c 6c2e 0a20 2020 2020 2020 2020 2020  ull..           
+000147b0: 2073 6361 6c65 3a20 4f70 7469 6f6e 616c   scale: Optional
+000147c0: 2066 6163 746f 7220 6279 2077 6869 6368   factor by which
+000147d0: 2074 6f20 7363 616c 6520 6d65 7368 6573   to scale meshes
+000147e0: 2062 6566 6f72 6520 7772 6974 696e 672e   before writing.
+000147f0: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00014800: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
+00014810: 6374 6f72 792e 6578 706f 7274 2e74 6f5f  ctory.export.to_
+00014820: 7374 6c20 696d 706f 7274 2074 6f5f 7374  stl import to_st
+00014830: 6c0a 0a20 2020 2020 2020 2072 6574 7572  l..        retur
+00014840: 6e20 746f 5f73 746c 280a 2020 2020 2020  n to_stl(.      
+00014850: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00014860: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
+00014870: 3d66 696c 6570 6174 682c 0a20 2020 2020  =filepath,.     
+00014880: 2020 2020 2020 206c 6179 6572 5f73 7461         layer_sta
+00014890: 636b 3d6c 6179 6572 5f73 7461 636b 2c0a  ck=layer_stack,.
+000148a0: 2020 2020 2020 2020 2020 2020 6578 636c              excl
+000148b0: 7564 655f 6c61 7965 7273 3d65 7863 6c75  ude_layers=exclu
+000148c0: 6465 5f6c 6179 6572 732c 0a20 2020 2020  de_layers,.     
+000148d0: 2020 2029 0a0a 2020 2020 6465 6620 746f     )..    def to
+000148e0: 5f67 6d73 6828 0a20 2020 2020 2020 2073  _gmsh(.        s
+000148f0: 656c 662c 0a20 2020 2020 2020 2074 7970  elf,.        typ
+00014900: 652c 0a20 2020 2020 2020 207a 3d4e 6f6e  e,.        z=Non
+00014910: 652c 0a20 2020 2020 2020 2078 7365 6374  e,.        xsect
+00014920: 696f 6e5f 626f 756e 6473 3d4e 6f6e 652c  ion_bounds=None,
+00014930: 0a20 2020 2020 2020 206c 6179 6572 5f73  .        layer_s
+00014940: 7461 636b 3d4e 6f6e 652c 0a20 2020 2020  tack=None,.     
+00014950: 2020 2077 6166 6572 5f70 6164 6469 6e67     wafer_padding
+00014960: 3d30 2e30 2c0a 2020 2020 2020 2020 7761  =0.0,.        wa
+00014970: 6665 725f 6c61 7965 723d 4c41 5945 522e  fer_layer=LAYER.
+00014980: 5741 4645 522c 0a20 2020 2020 2020 202a  WAFER,.        *
+00014990: 6172 6773 2c0a 2020 2020 2020 2020 2a2a  args,.        **
+000149a0: 6b77 6172 6773 2c0a 2020 2020 293a 0a20  kwargs,.    ):. 
+000149b0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+000149c0: 7320 6120 676d 7368 206d 7368 206f 6620  s a gmsh msh of 
+000149d0: 7468 6520 636f 6d70 6f6e 656e 7420 666f  the component fo
+000149e0: 7220 6669 6e69 7465 2065 6c65 6d65 6e74  r finite element
+000149f0: 2073 696d 756c 6174 696f 6e2e 0a0a 2020   simulation...  
+00014a00: 2020 2020 2020 4172 6775 6d65 6e74 733a        Arguments:
+00014a10: 0a20 2020 2020 2020 2020 2020 2074 7970  .            typ
+00014a20: 653a 206f 6e65 206f 6620 2278 7922 2c20  e: one of "xy", 
+00014a30: 2275 7a22 2c20 6f72 2022 3344 222e 2044  "uz", or "3D". D
+00014a40: 6574 6572 6d69 6e65 7320 7468 6520 7479  etermines the ty
+00014a50: 7065 206f 6620 6d65 7368 2074 6f20 7265  pe of mesh to re
+00014a60: 7475 726e 2e0a 2020 2020 2020 2020 2020  turn..          
+00014a70: 2020 7a3a 2075 7365 6420 746f 2064 6566    z: used to def
+00014a80: 696e 6520 7a2d 736c 6963 6520 666f 7220  ine z-slice for 
+00014a90: 7879 206d 6573 6869 6e67 0a20 2020 2020  xy meshing.     
+00014aa0: 2020 2020 2020 2078 7365 6374 696f 6e5f         xsection_
+00014ab0: 626f 756e 6473 3a20 7573 6564 2074 6f20  bounds: used to 
+00014ac0: 6465 6669 6e65 2069 6e2d 706c 616e 6520  define in-plane 
+00014ad0: 6c69 6e65 2066 6f72 2075 7a20 6d65 7368  line for uz mesh
+00014ae0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+00014af0: 7761 6665 725f 7061 6464 696e 673a 2070  wafer_padding: p
+00014b00: 6164 6469 6e67 2062 6579 6f6e 6420 6262  adding beyond bb
+00014b10: 6f78 2074 6f20 6164 6420 746f 2057 4146  ox to add to WAF
+00014b20: 4552 206c 6179 6572 732e 0a0a 2020 2020  ER layers...    
+00014b30: 2020 2020 4b65 7977 6f72 6420 4172 6773      Keyword Args
+00014b40: 3a0a 2020 2020 2020 2020 2020 2020 4172  :.            Ar
+00014b50: 6775 6d65 6e74 7320 666f 7220 7468 6520  guments for the 
+00014b60: 7461 7267 6574 206d 6573 6869 6e67 2066  target meshing f
+00014b70: 756e 6374 696f 6e20 696e 2067 6473 6661  unction in gdsfa
+00014b80: 6374 6f72 792e 7369 6d75 6c61 7469 6f6e  ctory.simulation
+00014b90: 2e67 6d73 680a 2020 2020 2020 2020 2222  .gmsh.        ""
+00014ba0: 220a 2020 2020 2020 2020 2320 4164 6420  ".        # Add 
+00014bb0: 5741 4645 5220 6c61 7965 723a 0a20 2020  WAFER layer:.   
+00014bc0: 2020 2020 2070 6164 6465 645f 636f 6d70       padded_comp
+00014bd0: 6f6e 656e 7420 3d20 436f 6d70 6f6e 656e  onent = Componen
+00014be0: 7428 290a 2020 2020 2020 2020 7061 6464  t().        padd
+00014bf0: 6564 5f63 6f6d 706f 6e65 6e74 203c 3c20  ed_component << 
+00014c00: 7365 6c66 0a20 2020 2020 2020 2028 786d  self.        (xm
+00014c10: 696e 2c20 796d 696e 292c 2028 786d 6178  in, ymin), (xmax
+00014c20: 2c20 796d 6178 2920 3d20 7365 6c66 2e62  , ymax) = self.b
+00014c30: 626f 780a 2020 2020 2020 2020 706f 696e  box.        poin
+00014c40: 7473 203d 205b 0a20 2020 2020 2020 2020  ts = [.         
+00014c50: 2020 205b 786d 696e 202d 2077 6166 6572     [xmin - wafer
+00014c60: 5f70 6164 6469 6e67 2c20 796d 696e 202d  _padding, ymin -
+00014c70: 2077 6166 6572 5f70 6164 6469 6e67 5d2c   wafer_padding],
+00014c80: 0a20 2020 2020 2020 2020 2020 205b 786d  .            [xm
+00014c90: 6178 202b 2077 6166 6572 5f70 6164 6469  ax + wafer_paddi
+00014ca0: 6e67 2c20 796d 696e 202d 2077 6166 6572  ng, ymin - wafer
+00014cb0: 5f70 6164 6469 6e67 5d2c 0a20 2020 2020  _padding],.     
+00014cc0: 2020 2020 2020 205b 786d 6178 202b 2077         [xmax + w
+00014cd0: 6166 6572 5f70 6164 6469 6e67 2c20 796d  afer_padding, ym
+00014ce0: 6178 202b 2077 6166 6572 5f70 6164 6469  ax + wafer_paddi
+00014cf0: 6e67 5d2c 0a20 2020 2020 2020 2020 2020  ng],.           
+00014d00: 205b 786d 696e 202d 2077 6166 6572 5f70   [xmin - wafer_p
+00014d10: 6164 6469 6e67 2c20 796d 6178 202b 2077  adding, ymax + w
+00014d20: 6166 6572 5f70 6164 6469 6e67 5d2c 0a20  afer_padding],. 
+00014d30: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+00014d40: 2070 6164 6465 645f 636f 6d70 6f6e 656e   padded_componen
+00014d50: 742e 6164 645f 706f 6c79 676f 6e28 706f  t.add_polygon(po
+00014d60: 696e 7473 2c20 6c61 7965 723d 7761 6665  ints, layer=wafe
+00014d70: 725f 6c61 7965 7229 0a0a 2020 2020 2020  r_layer)..      
+00014d80: 2020 6966 206c 6179 6572 5f73 7461 636b    if layer_stack
+00014d90: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00014da0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00014db0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00014dc0: 2020 2020 2020 2020 2741 204c 6179 6572          'A Layer
+00014dd0: 5374 6163 6b20 6d75 7374 2062 6520 7072  Stack must be pr
+00014de0: 6f76 6964 6564 2074 6872 6f75 6768 2061  ovided through a
+00014df0: 7267 756d 656e 7420 226c 6179 6572 5f73  rgument "layer_s
+00014e00: 7461 636b 222e 270a 2020 2020 2020 2020  tack".'.        
+00014e10: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
+00014e20: 2074 7970 6520 3d3d 2022 7879 223a 0a20   type == "xy":. 
+00014e30: 2020 2020 2020 2020 2020 2069 6620 7a20             if z 
+00014e40: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00014e50: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00014e60: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00014e70: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00014e80: 466f 7220 7879 2d6d 6573 6869 6e67 2c20  For xy-meshing, 
+00014e90: 6120 7a2d 7661 6c75 6520 6d75 7374 2062  a z-value must b
+00014ea0: 6520 7072 6f76 6964 6564 2076 6961 2074  e provided via t
+00014eb0: 6865 2066 6c6f 6174 2061 7267 756d 656e  he float argumen
+00014ec0: 7420 227a 222e 270a 2020 2020 2020 2020  t "z".'.        
+00014ed0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00014ee0: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
+00014ef0: 6374 6f72 792e 7369 6d75 6c61 7469 6f6e  ctory.simulation
+00014f00: 2e67 6d73 682e 7879 5f78 7365 6374 696f  .gmsh.xy_xsectio
+00014f10: 6e5f 6d65 7368 2069 6d70 6f72 7420 7879  n_mesh import xy
+00014f20: 5f78 7365 6374 696f 6e5f 6d65 7368 0a0a  _xsection_mesh..
+00014f30: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00014f40: 726e 2078 795f 7873 6563 7469 6f6e 5f6d  rn xy_xsection_m
+00014f50: 6573 6828 7061 6464 6564 5f63 6f6d 706f  esh(padded_compo
+00014f60: 6e65 6e74 2c20 7a2c 206c 6179 6572 5f73  nent, z, layer_s
+00014f70: 7461 636b 2c20 2a2a 6b77 6172 6773 290a  tack, **kwargs).
+00014f80: 2020 2020 2020 2020 656c 6966 2074 7970          elif typ
+00014f90: 6520 3d3d 2022 757a 223a 0a20 2020 2020  e == "uz":.     
+00014fa0: 2020 2020 2020 2069 6620 7873 6563 7469         if xsecti
+00014fb0: 6f6e 5f62 6f75 6e64 7320 6973 204e 6f6e  on_bounds is Non
+00014fc0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00014fd0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00014fe0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00014ff0: 2020 2020 2020 2020 2022 466f 7220 757a           "For uz
+00015000: 2d6d 6573 6869 6e67 2c20 796f 7520 6d75  -meshing, you mu
+00015010: 7374 2070 726f 7669 6465 2061 206c 696e  st provide a lin
+00015020: 6520 696e 2074 6865 2078 792d 706c 616e  e in the xy-plan
+00015030: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
+00015040: 2020 2020 2020 2020 2276 6961 2074 6865          "via the
+00015050: 2054 7570 6c65 2061 7267 756d 656e 7420   Tuple argument 
+00015060: 5b5b 7831 2c79 315d 2c20 5b78 322c 7932  [[x1,y1], [x2,y2
+00015070: 5d5d 2078 7365 6374 696f 6e5f 626f 756e  ]] xsection_boun
+00015080: 6473 2e22 0a20 2020 2020 2020 2020 2020  ds.".           
+00015090: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000150a0: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+000150b0: 7279 2e73 696d 756c 6174 696f 6e2e 676d  ry.simulation.gm
+000150c0: 7368 2e75 7a5f 7873 6563 7469 6f6e 5f6d  sh.uz_xsection_m
+000150d0: 6573 6820 696d 706f 7274 2075 7a5f 7873  esh import uz_xs
+000150e0: 6563 7469 6f6e 5f6d 6573 680a 0a20 2020  ection_mesh..   
+000150f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00015100: 757a 5f78 7365 6374 696f 6e5f 6d65 7368  uz_xsection_mesh
+00015110: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00015120: 2020 7061 6464 6564 5f63 6f6d 706f 6e65    padded_compone
+00015130: 6e74 2c20 7873 6563 7469 6f6e 5f62 6f75  nt, xsection_bou
+00015140: 6e64 732c 206c 6179 6572 5f73 7461 636b  nds, layer_stack
+00015150: 2c20 2a2a 6b77 6172 6773 0a20 2020 2020  , **kwargs.     
+00015160: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00015170: 2065 6c69 6620 7479 7065 203d 3d20 2233   elif type == "3
+00015180: 4422 3a0a 2020 2020 2020 2020 2020 2020  D":.            
+00015190: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+000151a0: 7369 6d75 6c61 7469 6f6e 2e67 6d73 682e  simulation.gmsh.
+000151b0: 7879 7a5f 6d65 7368 2069 6d70 6f72 7420  xyz_mesh import 
+000151c0: 7879 7a5f 6d65 7368 0a0a 2020 2020 2020  xyz_mesh..      
+000151d0: 2020 2020 2020 7265 7475 726e 2078 797a        return xyz
+000151e0: 5f6d 6573 6828 7061 6464 6564 5f63 6f6d  _mesh(padded_com
+000151f0: 706f 6e65 6e74 2c20 6c61 7965 725f 7374  ponent, layer_st
+00015200: 6163 6b2c 202a 2a6b 7761 7267 7329 0a20  ack, **kwargs). 
+00015210: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00015220: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00015230: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00015240: 2020 2020 2020 2020 2020 2027 5265 7175             'Requ
+00015250: 6972 6564 2061 7267 756d 656e 7420 2274  ired argument "t
+00015260: 7970 6522 206d 7573 7420 6265 206f 6e65  ype" must be one
+00015270: 206f 6620 2278 7922 2c20 2275 7a22 2c20   of "xy", "uz", 
+00015280: 6f72 2022 3344 222e 270a 2020 2020 2020  or "3D".'.      
+00015290: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+000152a0: 206f 6666 7365 7428 0a20 2020 2020 2020   offset(.       
+000152b0: 2073 656c 662c 0a20 2020 2020 2020 2064   self,.        d
+000152c0: 6973 7461 6e63 653a 2066 6c6f 6174 203d  istance: float =
+000152d0: 2030 2e31 2c0a 2020 2020 2020 2020 706f   0.1,.        po
+000152e0: 6c79 676f 6e73 3d4e 6f6e 652c 0a20 2020  lygons=None,.   
+000152f0: 2020 2020 2075 7365 5f75 6e69 6f6e 3a20       use_union: 
+00015300: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
+00015310: 2020 2020 2070 7265 6369 7369 6f6e 3a20       precision: 
+00015320: 666c 6f61 7420 3d20 3165 2d34 2c0a 2020  float = 1e-4,.  
+00015330: 2020 2020 2020 6a6f 696e 3a20 7374 7220        join: str 
+00015340: 3d20 226d 6974 6572 222c 0a20 2020 2020  = "miter",.     
+00015350: 2020 2074 6f6c 6572 616e 6365 3a20 696e     tolerance: in
+00015360: 7420 3d20 322c 0a20 2020 2020 2020 206c  t = 2,.        l
+00015370: 6179 6572 3a20 4c61 7965 7253 7065 6320  ayer: LayerSpec 
+00015380: 3d20 2257 4722 2c0a 2020 2020 2920 2d3e  = "WG",.    ) ->
+00015390: 2043 6f6d 706f 6e65 6e74 3a0a 2020 2020   Component:.    
+000153a0: 2020 2020 2222 2252 6574 7572 6e73 206e      """Returns n
+000153b0: 6577 2043 6f6d 706f 6e65 6e74 2077 6974  ew Component wit
+000153c0: 6820 706f 6c79 676f 6e73 2065 726f 6465  h polygons erode
+000153d0: 6420 6f72 2064 696c 6174 6564 2062 7920  d or dilated by 
+000153e0: 616e 206f 6666 7365 742e 0a0a 2020 2020  an offset...    
+000153f0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00015400: 2020 2020 2020 6469 7374 616e 6365 3a20        distance: 
+00015410: 4469 7374 616e 6365 2074 6f20 6f66 6673  Distance to offs
+00015420: 6574 2070 6f6c 7967 6f6e 732e 2050 6f73  et polygons. Pos
+00015430: 6974 6976 6520 7661 6c75 6573 2065 7870  itive values exp
+00015440: 616e 642c 206e 6567 6174 6976 6520 7368  and, negative sh
+00015450: 7269 6e6b 2e0a 2020 2020 2020 2020 2020  rink..          
+00015460: 2020 7072 6563 6973 696f 6e3a 2044 6573    precision: Des
+00015470: 6972 6564 2070 7265 6369 7369 6f6e 2066  ired precision f
+00015480: 6f72 2072 6f75 6e64 696e 6720 7665 7274  or rounding vert
+00015490: 6578 2063 6f6f 7264 696e 6174 6573 2e0a  ex coordinates..
+000154a0: 2020 2020 2020 2020 2020 2020 6a6f 696e              join
+000154b0: 3a20 7b27 6d69 7465 7227 2c20 2762 6576  : {'miter', 'bev
+000154c0: 656c 272c 2027 726f 756e 6427 7d20 5479  el', 'round'} Ty
+000154d0: 7065 206f 6620 6a6f 696e 2075 7365 6420  pe of join used 
+000154e0: 746f 2063 7265 6174 6520 706f 6c79 676f  to create polygo
+000154f0: 6e20 6f66 6673 6574 0a20 2020 2020 2020  n offset.       
+00015500: 2020 2020 2074 6f6c 6572 616e 6365 3a20       tolerance: 
+00015510: 466f 7220 6d69 7465 7220 6a6f 696e 7473  For miter joints
+00015520: 2c20 7468 6973 206e 756d 6265 7220 6d75  , this number mu
+00015530: 7374 2062 6520 6174 206c 6561 7374 2032  st be at least 2
+00015540: 2072 6570 7265 7365 6e74 7320 7468 650a   represents the.
+00015550: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+00015560: 7869 6d61 6c20 6469 7374 616e 6365 2069  ximal distance i
+00015570: 6e20 6d75 6c74 6970 6c65 7320 6f66 206f  n multiples of o
+00015580: 6666 7365 7420 6265 7477 6565 6e20 6e65  ffset between ne
+00015590: 7720 7665 7274 6963 6573 2061 6e64 2074  w vertices and t
+000155a0: 6865 6972 0a20 2020 2020 2020 2020 2020  heir.           
+000155b0: 2020 206f 7269 6769 6e61 6c20 706f 7369     original posi
+000155c0: 7469 6f6e 2062 6566 6f72 6520 6265 7665  tion before beve
+000155d0: 6c69 6e67 2074 6f20 6176 6f69 6420 7370  ling to avoid sp
+000155e0: 696b 6573 2061 7420 6163 7574 6520 6a6f  ikes at acute jo
+000155f0: 696e 7473 2e20 466f 720a 2020 2020 2020  ints. For.      
+00015600: 2020 2020 2020 2020 726f 756e 6420 6a6f          round jo
+00015610: 696e 7473 2c20 6974 2069 6e64 6963 6174  ints, it indicat
+00015620: 6573 2074 6865 2063 7572 7661 7475 7265  es the curvature
+00015630: 2072 6573 6f6c 7574 696f 6e20 696e 206e   resolution in n
+00015640: 756d 6265 7220 6f66 0a20 2020 2020 2020  umber of.       
+00015650: 2020 2020 2020 2070 6f69 6e74 7320 7065         points pe
+00015660: 7220 6675 6c6c 2063 6972 636c 652e 0a20  r full circle.. 
+00015670: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00015680: 3a20 5370 6563 6966 6963 206c 6179 6572  : Specific layer
+00015690: 2066 6f72 206e 6577 2070 6f6c 7967 6f6e   for new polygon
+000156a0: 732e 0a0a 2020 2020 2020 2020 2222 220a  s...        """.
+000156b0: 2020 2020 2020 2020 696d 706f 7274 2067          import g
+000156c0: 6473 6661 6374 6f72 7920 6173 2067 660a  dsfactory as gf.
+000156d0: 0a20 2020 2020 2020 2067 6473 5f6c 6179  .        gds_lay
+000156e0: 6572 2c20 6764 735f 6461 7461 7479 7065  er, gds_datatype
+000156f0: 203d 2067 662e 6765 745f 6c61 7965 7228   = gf.get_layer(
+00015700: 6c61 7965 7229 0a20 2020 2020 2020 2070  layer).        p
+00015710: 203d 2067 6473 746b 2e6f 6666 7365 7428   = gdstk.offset(
+00015720: 0a20 2020 2020 2020 2020 2020 2070 6f6c  .            pol
+00015730: 7967 6f6e 7320 6f72 2073 656c 662e 6765  ygons or self.ge
+00015740: 745f 706f 6c79 676f 6e73 2829 2c0a 2020  t_polygons(),.  
+00015750: 2020 2020 2020 2020 2020 6469 7374 616e            distan
+00015760: 6365 3d64 6973 7461 6e63 652c 0a20 2020  ce=distance,.   
+00015770: 2020 2020 2020 2020 206a 6f69 6e3d 6a6f           join=jo
+00015780: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
+00015790: 746f 6c65 7261 6e63 653d 746f 6c65 7261  tolerance=tolera
+000157a0: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
+000157b0: 2070 7265 6369 7369 6f6e 3d70 7265 6369   precision=preci
+000157c0: 7369 6f6e 2c0a 2020 2020 2020 2020 2020  sion,.          
+000157d0: 2020 7573 655f 756e 696f 6e3d 7573 655f    use_union=use_
+000157e0: 756e 696f 6e2c 0a20 2020 2020 2020 2020  union,.         
+000157f0: 2020 206c 6179 6572 3d67 6473 5f6c 6179     layer=gds_lay
+00015800: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+00015810: 6461 7461 7479 7065 3d67 6473 5f64 6174  datatype=gds_dat
+00015820: 6174 7970 652c 0a20 2020 2020 2020 2029  atype,.        )
+00015830: 0a0a 2020 2020 2020 2020 636f 6d70 6f6e  ..        compon
+00015840: 656e 7420 3d20 6766 2e43 6f6d 706f 6e65  ent = gf.Compone
+00015850: 6e74 2829 0a20 2020 2020 2020 2063 6f6d  nt().        com
+00015860: 706f 6e65 6e74 2e61 6464 5f70 6f6c 7967  ponent.add_polyg
+00015870: 6f6e 2870 2c20 6c61 7965 723d 6c61 7965  on(p, layer=laye
+00015880: 7229 0a20 2020 2020 2020 2072 6574 7572  r).        retur
+00015890: 6e20 636f 6d70 6f6e 656e 740a 0a0a 6465  n component...de
+000158a0: 6620 636f 7079 280a 2020 2020 443a 2043  f copy(.    D: C
+000158b0: 6f6d 706f 6e65 6e74 2c0a 2020 2020 7265  omponent,.    re
+000158c0: 6665 7265 6e63 6573 3d4e 6f6e 652c 0a20  ferences=None,. 
+000158d0: 2020 2070 6f72 7473 3d4e 6f6e 652c 0a20     ports=None,. 
+000158e0: 2020 2070 6f6c 7967 6f6e 733d 4e6f 6e65     polygons=None
+000158f0: 2c0a 2020 2020 7061 7468 733d 4e6f 6e65  ,.    paths=None
+00015900: 2c0a 2020 2020 6e61 6d65 3d4e 6f6e 652c  ,.    name=None,
+00015910: 0a20 2020 206c 6162 656c 733d 4e6f 6e65  .    labels=None
+00015920: 2c0a 2920 2d3e 2043 6f6d 706f 6e65 6e74  ,.) -> Component
+00015930: 3a0a 2020 2020 2222 2252 6574 7572 6e73  :.    """Returns
+00015940: 2061 2043 6f6d 706f 6e65 6e74 2063 6f70   a Component cop
+00015950: 792e 0a0a 2020 2020 4172 6773 3a0a 2020  y...    Args:.  
+00015960: 2020 2020 2020 443a 2063 6f6d 706f 6e65        D: compone
+00015970: 6e74 2074 6f20 636f 7079 2e0a 2020 2020  nt to copy..    
+00015980: 2222 220a 2020 2020 445f 636f 7079 203d  """.    D_copy =
+00015990: 2043 6f6d 706f 6e65 6e74 2829 0a20 2020   Component().   
+000159a0: 2044 5f63 6f70 792e 696e 666f 203d 2044   D_copy.info = D
+000159b0: 2e69 6e66 6f0a 2020 2020 2320 445f 636f  .info.    # D_co
+000159c0: 7079 2e5f 6365 6c6c 203d 2044 2e5f 6365  py._cell = D._ce
+000159d0: 6c6c 2e63 6f70 7928 6e61 6d65 3d44 5f63  ll.copy(name=D_c
+000159e0: 6f70 792e 6e61 6d65 290a 0a20 2020 2066  opy.name)..    f
+000159f0: 6f72 2072 6566 2069 6e20 7265 6665 7265  or ref in refere
+00015a00: 6e63 6573 2069 6620 7265 6665 7265 6e63  nces if referenc
+00015a10: 6573 2069 7320 6e6f 7420 4e6f 6e65 2065  es is not None e
+00015a20: 6c73 6520 442e 7265 6665 7265 6e63 6573  lse D.references
+00015a30: 3a0a 2020 2020 2020 2020 445f 636f 7079  :.        D_copy
+00015a40: 2e61 6464 2863 6f70 795f 7265 6665 7265  .add(copy_refere
+00015a50: 6e63 6528 7265 6629 290a 2020 2020 666f  nce(ref)).    fo
+00015a60: 7220 706f 7274 2069 6e20 2870 6f72 7473  r port in (ports
+00015a70: 2069 6620 706f 7274 7320 6973 206e 6f74   if ports is not
+00015a80: 204e 6f6e 6520 656c 7365 2044 2e70 6f72   None else D.por
+00015a90: 7473 292e 7661 6c75 6573 2829 3a0a 2020  ts).values():.  
+00015aa0: 2020 2020 2020 445f 636f 7079 2e61 6464        D_copy.add
+00015ab0: 5f70 6f72 7428 706f 7274 3d70 6f72 7429  _port(port=port)
+00015ac0: 0a20 2020 2066 6f72 2070 6f6c 7920 696e  .    for poly in
+00015ad0: 2070 6f6c 7967 6f6e 7320 6966 2070 6f6c   polygons if pol
+00015ae0: 7967 6f6e 7320 6973 206e 6f74 204e 6f6e  ygons is not Non
+00015af0: 6520 656c 7365 2044 2e70 6f6c 7967 6f6e  e else D.polygon
+00015b00: 733a 0a20 2020 2020 2020 2044 5f63 6f70  s:.        D_cop
+00015b10: 792e 6164 645f 706f 6c79 676f 6e28 706f  y.add_polygon(po
+00015b20: 6c79 290a 2020 2020 666f 7220 7061 7468  ly).    for path
+00015b30: 2069 6e20 7061 7468 7320 6966 2070 6174   in paths if pat
+00015b40: 6873 2069 7320 6e6f 7420 4e6f 6e65 2065  hs is not None e
+00015b50: 6c73 6520 442e 7061 7468 733a 0a20 2020  lse D.paths:.   
+00015b60: 2020 2020 2044 5f63 6f70 792e 6164 6428       D_copy.add(
+00015b70: 7061 7468 290a 2020 2020 666f 7220 6c61  path).    for la
+00015b80: 6265 6c20 696e 206c 6162 656c 7320 6966  bel in labels if
+00015b90: 206c 6162 656c 7320 6973 206e 6f74 204e   labels is not N
+00015ba0: 6f6e 6520 656c 7365 2044 2e6c 6162 656c  one else D.label
+00015bb0: 733a 0a20 2020 2020 2020 2044 5f63 6f70  s:.        D_cop
+00015bc0: 792e 6164 645f 6c61 6265 6c28 0a20 2020  y.add_label(.   
+00015bd0: 2020 2020 2020 2020 2074 6578 743d 6c61           text=la
+00015be0: 6265 6c2e 7465 7874 2c0a 2020 2020 2020  bel.text,.      
+00015bf0: 2020 2020 2020 706f 7369 7469 6f6e 3d6c        position=l
+00015c00: 6162 656c 2e6f 7269 6769 6e2c 0a20 2020  abel.origin,.   
+00015c10: 2020 2020 2020 2020 206c 6179 6572 3d28           layer=(
+00015c20: 6c61 6265 6c2e 6c61 7965 722c 206c 6162  label.layer, lab
+00015c30: 656c 2e74 6578 7474 7970 6529 2c0a 2020  el.texttype),.  
+00015c40: 2020 2020 2020 290a 0a20 2020 2069 6620        )..    if 
+00015c50: 6e61 6d65 2069 7320 6e6f 7420 4e6f 6e65  name is not None
+00015c60: 3a0a 2020 2020 2020 2020 445f 636f 7079  :.        D_copy
+00015c70: 2e6e 616d 6520 3d20 6e61 6d65 0a0a 2020  .name = name..  
+00015c80: 2020 7265 7475 726e 2044 5f63 6f70 790a    return D_copy.
+00015c90: 0a0a 6465 6620 636f 7079 5f72 6566 6572  ..def copy_refer
+00015ca0: 656e 6365 280a 2020 2020 7265 662c 0a20  ence(.    ref,. 
+00015cb0: 2020 2070 6172 656e 743d 4e6f 6e65 2c0a     parent=None,.
+00015cc0: 2020 2020 636f 6c75 6d6e 733d 4e6f 6e65      columns=None
+00015cd0: 2c0a 2020 2020 726f 7773 3d4e 6f6e 652c  ,.    rows=None,
+00015ce0: 0a20 2020 2073 7061 6369 6e67 3d4e 6f6e  .    spacing=Non
+00015cf0: 652c 0a20 2020 206f 7269 6769 6e3d 4e6f  e,.    origin=No
+00015d00: 6e65 2c0a 2020 2020 726f 7461 7469 6f6e  ne,.    rotation
+00015d10: 3d4e 6f6e 652c 0a20 2020 206d 6167 6e69  =None,.    magni
+00015d20: 6669 6361 7469 6f6e 3d4e 6f6e 652c 0a20  fication=None,. 
+00015d30: 2020 2078 5f72 6566 6c65 6374 696f 6e3d     x_reflection=
+00015d40: 4e6f 6e65 2c0a 2020 2020 6e61 6d65 3d4e  None,.    name=N
+00015d50: 6f6e 652c 0a20 2020 2076 313d 4e6f 6e65  one,.    v1=None
+00015d60: 2c0a 2020 2020 7632 3d4e 6f6e 652c 0a29  ,.    v2=None,.)
+00015d70: 202d 3e20 436f 6d70 6f6e 656e 7452 6566   -> ComponentRef
+00015d80: 6572 656e 6365 3a0a 2020 2020 7265 7475  erence:.    retu
+00015d90: 726e 2043 6f6d 706f 6e65 6e74 5265 6665  rn ComponentRefe
+00015da0: 7265 6e63 6528 0a20 2020 2020 2020 2063  rence(.        c
+00015db0: 6f6d 706f 6e65 6e74 3d70 6172 656e 7420  omponent=parent 
+00015dc0: 6f72 2072 6566 2e70 6172 656e 742c 0a20  or ref.parent,. 
+00015dd0: 2020 2020 2020 2063 6f6c 756d 6e73 3d63         columns=c
+00015de0: 6f6c 756d 6e73 206f 7220 7265 662e 636f  olumns or ref.co
+00015df0: 6c75 6d6e 732c 0a20 2020 2020 2020 2072  lumns,.        r
+00015e00: 6f77 733d 726f 7773 206f 7220 7265 662e  ows=rows or ref.
+00015e10: 726f 7773 2c0a 2020 2020 2020 2020 7370  rows,.        sp
+00015e20: 6163 696e 673d 7370 6163 696e 6720 6f72  acing=spacing or
+00015e30: 2072 6566 2e73 7061 6369 6e67 2c0a 2020   ref.spacing,.  
+00015e40: 2020 2020 2020 6f72 6967 696e 3d6f 7269        origin=ori
+00015e50: 6769 6e20 6f72 2072 6566 2e6f 7269 6769  gin or ref.origi
+00015e60: 6e2c 0a20 2020 2020 2020 2072 6f74 6174  n,.        rotat
+00015e70: 696f 6e3d 726f 7461 7469 6f6e 206f 7220  ion=rotation or 
+00015e80: 7265 662e 726f 7461 7469 6f6e 2c0a 2020  ref.rotation,.  
+00015e90: 2020 2020 2020 6d61 676e 6966 6963 6174        magnificat
+00015ea0: 696f 6e3d 6d61 676e 6966 6963 6174 696f  ion=magnificatio
+00015eb0: 6e20 6f72 2072 6566 2e6d 6167 6e69 6669  n or ref.magnifi
+00015ec0: 6361 7469 6f6e 2c0a 2020 2020 2020 2020  cation,.        
+00015ed0: 785f 7265 666c 6563 7469 6f6e 3d78 5f72  x_reflection=x_r
+00015ee0: 6566 6c65 6374 696f 6e20 6f72 2072 6566  eflection or ref
+00015ef0: 2e78 5f72 6566 6c65 6374 696f 6e2c 0a20  .x_reflection,. 
+00015f00: 2020 2020 2020 206e 616d 653d 6e61 6d65         name=name
+00015f10: 206f 7220 7265 662e 6e61 6d65 2c0a 2020   or ref.name,.  
+00015f20: 2020 2020 2020 7631 3d76 3120 6f72 2072        v1=v1 or r
+00015f30: 6566 2e76 312c 0a20 2020 2020 2020 2076  ef.v1,.        v
+00015f40: 323d 7632 206f 7220 7265 662e 7632 2c0a  2=v2 or ref.v2,.
+00015f50: 2020 2020 290a 0a0a 6465 6620 7465 7374      )...def test
+00015f60: 5f67 6574 5f6c 6179 6572 7328 2920 2d3e  _get_layers() ->
+00015f70: 2043 6f6d 706f 6e65 6e74 3a0a 2020 2020   Component:.    
+00015f80: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
+00015f90: 7920 6173 2067 660a 0a20 2020 2063 3120  y as gf..    c1 
+00015fa0: 3d20 6766 2e63 6f6d 706f 6e65 6e74 732e  = gf.components.
+00015fb0: 7374 7261 6967 6874 280a 2020 2020 2020  straight(.      
+00015fc0: 2020 6c65 6e67 7468 3d31 302c 0a20 2020    length=10,.   
+00015fd0: 2020 2020 2077 6964 7468 3d30 2e35 2c0a       width=0.5,.
+00015fe0: 2020 2020 2020 2020 6c61 7965 723d 2832          layer=(2
+00015ff0: 2c20 3029 2c0a 2020 2020 2020 2020 6262  , 0),.        bb
+00016000: 6f78 5f6c 6179 6572 733d 5b28 3131 312c  ox_layers=[(111,
+00016010: 2030 295d 2c0a 2020 2020 2020 2020 6262   0)],.        bb
+00016020: 6f78 5f6f 6666 7365 7473 3d5b 335d 2c0a  ox_offsets=[3],.
+00016030: 2020 2020 2020 2020 7769 7468 5f62 626f          with_bbo
+00016040: 783d 5472 7565 2c0a 2020 2020 2020 2020  x=True,.        
+00016050: 636c 6164 6469 6e67 5f6c 6179 6572 733d  cladding_layers=
+00016060: 4e6f 6e65 2c0a 2020 2020 2020 2020 6164  None,.        ad
+00016070: 645f 7069 6e73 3d4e 6f6e 652c 0a20 2020  d_pins=None,.   
+00016080: 2020 2020 2061 6464 5f62 626f 783d 4e6f       add_bbox=No
+00016090: 6e65 2c0a 2020 2020 290a 2020 2020 6173  ne,.    ).    as
+000160a0: 7365 7274 2063 312e 6765 745f 6c61 7965  sert c1.get_laye
+000160b0: 7273 2829 203d 3d20 7b28 322c 2030 292c  rs() == {(2, 0),
+000160c0: 2028 3131 312c 2030 297d 2c20 6331 2e67   (111, 0)}, c1.g
+000160d0: 6574 5f6c 6179 6572 7328 290a 2020 2020  et_layers().    
+000160e0: 2320 7265 7475 726e 2063 310a 2020 2020  # return c1.    
+000160f0: 6332 203d 2063 312e 7265 6d6f 7665 5f6c  c2 = c1.remove_l
+00016100: 6179 6572 7328 5b28 3131 312c 2030 295d  ayers([(111, 0)]
+00016110: 290a 2020 2020 6173 7365 7274 2063 322e  ).    assert c2.
+00016120: 6765 745f 6c61 7965 7273 2829 203d 3d20  get_layers() == 
+00016130: 7b28 322c 2030 297d 2c20 6332 2e67 6574  {(2, 0)}, c2.get
+00016140: 5f6c 6179 6572 7328 290a 2020 2020 7265  _layers().    re
+00016150: 7475 726e 2063 320a 0a0a 6465 6620 5f66  turn c2...def _f
+00016160: 696c 7465 725f 706f 6c79 7328 706f 6c79  ilter_polys(poly
+00016170: 676f 6e73 2c20 6c61 7965 7273 5f65 7863  gons, layers_exc
+00016180: 6c29 3a0a 2020 2020 7265 7475 726e 205b  l):.    return [
+00016190: 0a20 2020 2020 2020 2070 6f6c 7967 6f6e  .        polygon
+000161a0: 0a20 2020 2020 2020 2066 6f72 2070 6f6c  .        for pol
+000161b0: 7967 6f6e 2c20 6c61 7965 722c 2064 6174  ygon, layer, dat
+000161c0: 6174 7970 6520 696e 207a 6970 280a 2020  atype in zip(.  
+000161d0: 2020 2020 2020 2020 2020 706f 6c79 676f            polygo
+000161e0: 6e73 2e70 6f6c 7967 6f6e 732c 2070 6f6c  ns.polygons, pol
+000161f0: 7967 6f6e 732e 6c61 7965 7273 2c20 706f  ygons.layers, po
+00016200: 6c79 676f 6e73 2e64 6174 6174 7970 6573  lygons.datatypes
+00016210: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00016220: 2020 2069 6620 286c 6179 6572 2c20 6461     if (layer, da
+00016230: 7461 7479 7065 2920 6e6f 7420 696e 206c  tatype) not in l
+00016240: 6179 6572 735f 6578 636c 0a20 2020 205d  ayers_excl.    ]
+00016250: 0a0a 0a64 6566 2072 6563 7572 7365 5f73  ...def recurse_s
+00016260: 7472 7563 7475 7265 7328 0a20 2020 2063  tructures(.    c
+00016270: 6f6d 706f 6e65 6e74 3a20 436f 6d70 6f6e  omponent: Compon
+00016280: 656e 742c 0a20 2020 2069 676e 6f72 655f  ent,.    ignore_
+00016290: 636f 6d70 6f6e 656e 7473 5f70 7265 6669  components_prefi
+000162a0: 783a 204f 7074 696f 6e61 6c5b 4c69 7374  x: Optional[List
+000162b0: 5b73 7472 5d5d 203d 204e 6f6e 652c 0a20  [str]] = None,. 
+000162c0: 2020 2069 676e 6f72 655f 6675 6e63 7469     ignore_functi
+000162d0: 6f6e 735f 7072 6566 6978 3a20 4f70 7469  ons_prefix: Opti
+000162e0: 6f6e 616c 5b4c 6973 745b 7374 725d 5d20  onal[List[str]] 
+000162f0: 3d20 4e6f 6e65 2c0a 2920 2d3e 2044 6963  = None,.) -> Dic
+00016300: 745b 7374 722c 2041 6e79 5d3a 0a20 2020  t[str, Any]:.   
+00016310: 2022 2222 5265 6375 7273 6520 636f 6d70   """Recurse comp
+00016320: 6f6e 656e 7420 616e 6420 636f 6d70 6f6e  onent and compon
+00016330: 656e 7473 2072 6566 6572 656e 6365 7320  ents references 
+00016340: 7265 6375 7273 6976 656c 792e 0a0a 2020  recursively...  
+00016350: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+00016360: 636f 6d70 6f6e 656e 743a 2063 6f6d 706f  component: compo
+00016370: 6e65 6e74 2074 6f20 7265 6375 7273 652e  nent to recurse.
+00016380: 0a20 2020 2020 2020 2069 676e 6f72 655f  .        ignore_
+00016390: 636f 6d70 6f6e 656e 7473 5f70 7265 6669  components_prefi
+000163a0: 783a 206c 6973 7420 6f66 2070 7265 6669  x: list of prefi
+000163b0: 7820 746f 2069 676e 6f72 652e 0a20 2020  x to ignore..   
+000163c0: 2020 2020 2069 676e 6f72 655f 6675 6e63       ignore_func
+000163d0: 7469 6f6e 735f 7072 6566 6978 3a20 6c69  tions_prefix: li
+000163e0: 7374 206f 6620 7072 6566 6978 2074 6f20  st of prefix to 
+000163f0: 6967 6e6f 7265 2e0a 2020 2020 2222 220a  ignore..    """.
+00016400: 2020 2020 6967 6e6f 7265 5f66 756e 6374      ignore_funct
+00016410: 696f 6e73 5f70 7265 6669 7820 3d20 6967  ions_prefix = ig
+00016420: 6e6f 7265 5f66 756e 6374 696f 6e73 5f70  nore_functions_p
+00016430: 7265 6669 7820 6f72 205b 5d0a 2020 2020  refix or [].    
+00016440: 6967 6e6f 7265 5f63 6f6d 706f 6e65 6e74  ignore_component
+00016450: 735f 7072 6566 6978 203d 2069 676e 6f72  s_prefix = ignor
+00016460: 655f 636f 6d70 6f6e 656e 7473 5f70 7265  e_components_pre
+00016470: 6669 7820 6f72 205b 5d0a 0a20 2020 2069  fix or []..    i
+00016480: 6620 280a 2020 2020 2020 2020 6861 7361  f (.        hasa
+00016490: 7474 7228 636f 6d70 6f6e 656e 742c 2022  ttr(component, "
+000164a0: 6675 6e63 7469 6f6e 5f6e 616d 6522 290a  function_name").
+000164b0: 2020 2020 2020 2020 616e 6420 636f 6d70          and comp
+000164c0: 6f6e 656e 742e 6675 6e63 7469 6f6e 5f6e  onent.function_n
+000164d0: 616d 6520 696e 2069 676e 6f72 655f 6675  ame in ignore_fu
+000164e0: 6e63 7469 6f6e 735f 7072 6566 6978 0a20  nctions_prefix. 
+000164f0: 2020 2029 3a0a 2020 2020 2020 2020 7265     ):.        re
+00016500: 7475 726e 207b 7d0a 0a20 2020 2069 6620  turn {}..    if 
+00016510: 6861 7361 7474 7228 636f 6d70 6f6e 656e  hasattr(componen
+00016520: 742c 2022 6e61 6d65 2229 2061 6e64 2061  t, "name") and a
+00016530: 6e79 280a 2020 2020 2020 2020 636f 6d70  ny(.        comp
+00016540: 6f6e 656e 742e 6e61 6d65 2e73 7461 7274  onent.name.start
+00016550: 7377 6974 6828 6929 2066 6f72 2069 2069  swith(i) for i i
+00016560: 6e20 6967 6e6f 7265 5f63 6f6d 706f 6e65  n ignore_compone
+00016570: 6e74 735f 7072 6566 6978 0a20 2020 2029  nts_prefix.    )
+00016580: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00016590: 207b 7d0a 0a20 2020 206f 7574 7075 7420   {}..    output 
+000165a0: 3d20 7b63 6f6d 706f 6e65 6e74 2e6e 616d  = {component.nam
+000165b0: 653a 2064 6963 7428 636f 6d70 6f6e 656e  e: dict(componen
+000165c0: 742e 7365 7474 696e 6773 297d 0a20 2020  t.settings)}.   
+000165d0: 2066 6f72 2072 6566 6572 656e 6365 2069   for reference i
+000165e0: 6e20 636f 6d70 6f6e 656e 742e 7265 6665  n component.refe
+000165f0: 7265 6e63 6573 3a0a 2020 2020 2020 2020  rences:.        
+00016600: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+00016610: 2069 7369 6e73 7461 6e63 6528 7265 6665   isinstance(refe
+00016620: 7265 6e63 652c 2043 6f6d 706f 6e65 6e74  rence, Component
+00016630: 5265 6665 7265 6e63 6529 0a20 2020 2020  Reference).     
+00016640: 2020 2020 2020 2061 6e64 2072 6566 6572         and refer
+00016650: 656e 6365 2e72 6566 5f63 656c 6c2e 6e61  ence.ref_cell.na
+00016660: 6d65 206e 6f74 2069 6e20 6f75 7470 7574  me not in output
+00016670: 0a20 2020 2020 2020 2029 3a0a 2020 2020  .        ):.    
+00016680: 2020 2020 2020 2020 6f75 7470 7574 2e75          output.u
+00016690: 7064 6174 6528 7265 6375 7273 655f 7374  pdate(recurse_st
+000166a0: 7275 6374 7572 6573 2872 6566 6572 656e  ructures(referen
+000166b0: 6365 2e72 6566 5f63 656c 6c29 290a 0a20  ce.ref_cell)).. 
+000166c0: 2020 2072 6574 7572 6e20 6f75 7470 7574     return output
+000166d0: 0a0a 0a64 6566 2066 6c61 7474 656e 5f69  ...def flatten_i
+000166e0: 6e76 616c 6964 5f72 6566 735f 7265 6375  nvalid_refs_recu
+000166f0: 7273 6976 6528 0a20 2020 2063 6f6d 706f  rsive(.    compo
+00016700: 6e65 6e74 3a20 436f 6d70 6f6e 656e 742c  nent: Component,
+00016710: 0a20 2020 2067 7269 645f 7369 7a65 3a20  .    grid_size: 
+00016720: 4f70 7469 6f6e 616c 5b66 6c6f 6174 5d20  Optional[float] 
+00016730: 3d20 4e6f 6e65 2c0a 2020 2020 7570 6461  = None,.    upda
+00016740: 7465 645f 636f 6d70 6f6e 656e 7473 3d4e  ted_components=N
+00016750: 6f6e 652c 0a20 2020 2074 7261 7665 7273  one,.    travers
+00016760: 6564 5f63 6f6d 706f 6e65 6e74 733d 4e6f  ed_components=No
+00016770: 6e65 2c0a 293a 0a20 2020 2022 2222 5265  ne,.):.    """Re
+00016780: 6375 7273 6976 656c 7920 666c 6174 7465  cursively flatte
+00016790: 6e73 2063 6f6d 706f 6e65 6e74 2072 6566  ns component ref
+000167a0: 6572 656e 6365 7320 7768 6963 6820 6861  erences which ha
+000167b0: 7665 2069 6e76 616c 6964 2074 7261 6e73  ve invalid trans
+000167c0: 666f 726d 6174 696f 6e73 2028 692e 652e  formations (i.e.
+000167d0: 206e 6f6e 2d39 3020 6465 6720 726f 7461   non-90 deg rota
+000167e0: 7469 6f6e 7320 6f72 2073 7562 2d67 7269  tions or sub-gri
+000167f0: 6420 7472 616e 736c 6174 696f 6e73 2920  d translations) 
+00016800: 616e 6420 7265 7475 726e 7320 6120 636f  and returns a co
+00016810: 7079 2069 6620 616e 7920 7375 6263 656c  py if any subcel
+00016820: 6c73 2068 6176 6520 6265 656e 206d 6f64  ls have been mod
+00016830: 6966 6965 642e 0a0a 2020 2020 5741 524e  ified...    WARN
+00016840: 494e 473a 2074 6869 7320 6675 6e63 7469  ING: this functi
+00016850: 6f6e 2077 696c 6c20 7072 6f64 7563 6520  on will produce 
+00016860: 7361 6d65 2d6e 616d 6520 636f 7069 6573  same-name copies
+00016870: 206f 6620 6365 6c6c 732e 2049 7420 6973   of cells. It is
+00016880: 2073 7472 6963 746c 7920 6d65 616e 7420   strictly meant 
+00016890: 746f 2062 6520 7573 6564 206f 6e20 7772  to be used on wr
+000168a0: 6974 6520 6f66 2074 6865 2047 4453 2066  ite of the GDS f
+000168b0: 696c 6520 616e 640a 2020 2020 7368 6f75  ile and.    shou
+000168c0: 6c64 206e 6f74 2062 6520 6d69 7865 6420  ld not be mixed 
+000168d0: 7769 7468 206f 7468 6572 2063 656c 6c73  with other cells
+000168e0: 2c20 6f72 2079 6f75 2077 696c 6c20 6c69  , or you will li
+000168f0: 6b65 6c79 2065 7870 6572 6965 6e63 6520  kely experience 
+00016900: 6973 7375 6573 2077 6974 6820 6475 706c  issues with dupl
+00016910: 6963 6174 6520 6365 6c6c 730a 0a20 2020  icate cells..   
+00016920: 2041 7267 733a 0a20 2020 2020 2020 2063   Args:.        c
+00016930: 6f6d 706f 6e65 6e74 3a20 7468 6520 636f  omponent: the co
+00016940: 6d70 6f6e 656e 7420 746f 2066 6978 2028  mponent to fix (
+00016950: 696e 2070 6c61 6365 292e 0a20 2020 2020  in place)..     
+00016960: 2020 2067 7269 645f 7369 7a65 3a20 7468     grid_size: th
+00016970: 6520 4744 5320 6772 6964 2073 697a 652c  e GDS grid size,
+00016980: 2069 6e20 756d 2c20 6465 6661 756c 7473   in um, defaults
+00016990: 2074 6f20 6163 7469 7665 2050 444b 2e67   to active PDK.g
+000169a0: 6574 5f67 7269 645f 7369 7a65 2829 0a20  et_grid_size(). 
+000169b0: 2020 2020 2020 2020 2020 2061 6e79 2074             any t
+000169c0: 7261 6e73 6c61 7469 6f6e 7320 7769 7468  ranslations with
+000169d0: 2068 6967 6865 7220 7265 736f 6c75 7469   higher resoluti
+000169e0: 6f6e 2074 6861 6e20 7468 6973 2061 7265  on than this are
+000169f0: 2063 6f6e 7369 6465 7265 6420 696e 7661   considered inva
+00016a00: 6c69 642e 0a20 2020 2020 2020 2075 7064  lid..        upd
+00016a10: 6174 6564 5f63 6f6d 706f 6e65 6e74 733a  ated_components:
+00016a20: 2074 6865 2072 756e 6e69 6e67 2064 6963   the running dic
+00016a30: 7469 6f6e 6172 7920 6f66 2063 6f6d 706f  tionary of compo
+00016a40: 6e65 6e74 7320 7768 6963 6820 6861 7665  nents which have
+00016a50: 2062 6565 6e20 6d6f 6469 6669 6564 2062   been modified b
+00016a60: 7920 7468 6973 2074 7261 6e73 666f 726d  y this transform
+00016a70: 6174 696f 6e2e 2053 686f 756c 6420 616c  ation. Should al
+00016a80: 7761 7973 2062 6520 4e6f 6e65 2c20 6578  ways be None, ex
+00016a90: 6365 7074 2066 6f72 2072 6563 7572 7369  cept for recursi
+00016aa0: 7665 2069 6e76 6f63 6174 696f 6e73 2e0a  ve invocations..
+00016ab0: 2020 2020 2020 2020 7472 6176 6572 7365          traverse
+00016ac0: 645f 636f 6d70 6f6e 656e 7473 3a20 7468  d_components: th
+00016ad0: 6520 7365 7420 6f66 2063 6f6d 706f 6e65  e set of compone
+00016ae0: 6e74 206e 616d 6573 2077 6869 6368 2068  nt names which h
+00016af0: 6176 6520 6265 656e 2074 7261 7665 7273  ave been travers
+00016b00: 6564 2e20 5368 6f75 6c64 2061 6c77 6179  ed. Should alway
+00016b10: 7320 6265 204e 6f6e 652c 2065 7863 6570  s be None, excep
+00016b20: 7420 666f 7220 7265 6375 7273 6976 6520  t for recursive 
+00016b30: 696e 766f 6361 7469 6f6e 732e 0a20 2020  invocations..   
+00016b40: 2022 2222 0a20 2020 2066 726f 6d20 6764   """.    from gd
+00016b50: 7366 6163 746f 7279 2e64 6563 6f72 6174  sfactory.decorat
+00016b60: 6f72 7320 696d 706f 7274 2069 735f 696e  ors import is_in
+00016b70: 7661 6c69 645f 7265 660a 0a20 2020 2069  valid_ref..    i
+00016b80: 6e76 616c 6964 5f72 6566 7320 3d20 5b5d  nvalid_refs = []
+00016b90: 0a20 2020 2072 6566 7320 3d20 636f 6d70  .    refs = comp
+00016ba0: 6f6e 656e 742e 7265 6665 7265 6e63 6573  onent.references
+00016bb0: 0a20 2020 2073 7562 6365 6c6c 5f6d 6f64  .    subcell_mod
+00016bc0: 6966 6965 6420 3d20 4661 6c73 650a 2020  ified = False.  
+00016bd0: 2020 6966 2075 7064 6174 6564 5f63 6f6d    if updated_com
+00016be0: 706f 6e65 6e74 7320 6973 204e 6f6e 653a  ponents is None:
+00016bf0: 0a20 2020 2020 2020 2075 7064 6174 6564  .        updated
+00016c00: 5f63 6f6d 706f 6e65 6e74 7320 3d20 7b7d  _components = {}
+00016c10: 0a20 2020 2069 6620 7472 6176 6572 7365  .    if traverse
+00016c20: 645f 636f 6d70 6f6e 656e 7473 2069 7320  d_components is 
+00016c30: 4e6f 6e65 3a0a 2020 2020 2020 2020 7472  None:.        tr
+00016c40: 6176 6572 7365 645f 636f 6d70 6f6e 656e  aversed_componen
+00016c50: 7473 203d 2073 6574 2829 0a20 2020 2066  ts = set().    f
+00016c60: 6f72 2072 6566 2069 6e20 7265 6673 3a0a  or ref in refs:.
+00016c70: 2020 2020 2020 2020 2320 6d61 726b 2061          # mark a
+00016c80: 6e79 2069 6e76 616c 6964 2072 6566 7320  ny invalid refs 
+00016c90: 666f 7220 666c 6174 7465 6e69 6e67 0a20  for flattening. 
+00016ca0: 2020 2020 2020 2023 206f 7468 6572 7769         # otherwi
+00016cb0: 7365 2c20 6368 6563 6b20 6966 2074 6865  se, check if the
+00016cc0: 7265 2061 7265 2061 6e79 206d 6f64 6966  re are any modif
+00016cd0: 6965 6420 6365 6c6c 7320 6265 6e65 6174  ied cells beneat
+00016ce0: 6820 2877 6520 6e65 6564 206e 6f74 2064  h (we need not d
+00016cf0: 6f20 7468 6973 2069 6620 7468 6520 7265  o this if the re
+00016d00: 6620 7769 6c6c 2062 6520 666c 6174 7465  f will be flatte
+00016d10: 6e65 6420 616e 7977 6179 7329 0a20 2020  ned anyways).   
+00016d20: 2020 2020 2069 6620 6973 5f69 6e76 616c       if is_inval
+00016d30: 6964 5f72 6566 2872 6566 2c20 6772 6964  id_ref(ref, grid
+00016d40: 5f73 697a 6529 3a0a 2020 2020 2020 2020  _size):.        
+00016d50: 2020 2020 696e 7661 6c69 645f 7265 6673      invalid_refs
+00016d60: 2e61 7070 656e 6428 7265 662e 6e61 6d65  .append(ref.name
+00016d70: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00016d80: 2020 2020 2020 2020 2020 2020 2320 6f74              # ot
+00016d90: 6865 7277 6973 652c 2072 6563 7572 7369  herwise, recursi
+00016da0: 7665 6c79 2066 6c61 7474 656e 2072 6566  vely flatten ref
+00016db0: 7320 6966 2074 6865 2073 7562 6365 6c6c  s if the subcell
+00016dc0: 2068 6173 206e 6f74 2061 6c72 6561 6479   has not already
+00016dd0: 2062 6565 6e20 7472 6176 6572 7365 640a   been traversed.
+00016de0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00016df0: 6566 2e70 6172 656e 742e 6e61 6d65 206e  ef.parent.name n
+00016e00: 6f74 2069 6e20 7472 6176 6572 7365 645f  ot in traversed_
+00016e10: 636f 6d70 6f6e 656e 7473 3a0a 2020 2020  components:.    
+00016e20: 2020 2020 2020 2020 2020 2020 666c 6174              flat
+00016e30: 7465 6e5f 696e 7661 6c69 645f 7265 6673  ten_invalid_refs
+00016e40: 5f72 6563 7572 7369 7665 280a 2020 2020  _recursive(.    
+00016e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e60: 7265 662e 7061 7265 6e74 2c0a 2020 2020  ref.parent,.    
+00016e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e80: 6772 6964 5f73 697a 653d 6772 6964 5f73  grid_size=grid_s
+00016e90: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
+00016ea0: 2020 2020 2020 2020 2075 7064 6174 6564           updated
+00016eb0: 5f63 6f6d 706f 6e65 6e74 733d 7570 6461  _components=upda
+00016ec0: 7465 645f 636f 6d70 6f6e 656e 7473 2c0a  ted_components,.
+00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ee0: 2020 2020 7472 6176 6572 7365 645f 636f      traversed_co
+00016ef0: 6d70 6f6e 656e 7473 3d74 7261 7665 7273  mponents=travers
+00016f00: 6564 5f63 6f6d 706f 6e65 6e74 732c 0a20  ed_components,. 
+00016f10: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00016f20: 0a20 2020 2020 2020 2020 2020 2023 206e  .            # n
+00016f30: 6f77 2c20 6966 2074 6865 2072 6566 2773  ow, if the ref's
+00016f40: 2063 656c 6c20 6265 656e 206d 6f64 6966   cell been modif
+00016f50: 6965 642c 206d 6172 6b20 6974 2061 7320  ied, mark it as 
+00016f60: 7375 6368 0a20 2020 2020 2020 2020 2020  such.           
+00016f70: 2069 6620 7265 662e 7061 7265 6e74 2e6e   if ref.parent.n
+00016f80: 616d 6520 696e 2075 7064 6174 6564 5f63  ame in updated_c
+00016f90: 6f6d 706f 6e65 6e74 733a 0a20 2020 2020  omponents:.     
+00016fa0: 2020 2020 2020 2020 2020 2073 7562 6365             subce
+00016fb0: 6c6c 5f6d 6f64 6966 6965 6420 3d20 5472  ll_modified = Tr
+00016fc0: 7565 0a20 2020 2069 6620 696e 7661 6c69  ue.    if invali
+00016fd0: 645f 7265 6673 206f 7220 7375 6263 656c  d_refs or subcel
+00016fe0: 6c5f 6d6f 6469 6669 6564 3a0a 2020 2020  l_modified:.    
+00016ff0: 2020 2020 6e65 775f 636f 6d70 6f6e 656e      new_componen
+00017000: 7420 3d20 636f 6d70 6f6e 656e 742e 636f  t = component.co
+00017010: 7079 2829 0a20 2020 2020 2020 206e 6577  py().        new
+00017020: 5f63 6f6d 706f 6e65 6e74 2e6e 616d 6520  _component.name 
+00017030: 3d20 636f 6d70 6f6e 656e 742e 6e61 6d65  = component.name
+00017040: 0a20 2020 2020 2020 2023 206d 616b 6520  .        # make 
+00017050: 7375 7265 2061 6c6c 206d 6f64 6966 6965  sure all modifie
+00017060: 6420 6365 6c6c 7320 6861 7665 2074 6865  d cells have the
+00017070: 6972 2072 6566 6572 656e 6365 7320 7570  ir references up
+00017080: 6461 7465 640a 2020 2020 2020 2020 6e65  dated.        ne
+00017090: 775f 7265 6673 203d 206e 6577 5f63 6f6d  w_refs = new_com
+000170a0: 706f 6e65 6e74 2e72 6566 6572 656e 6365  ponent.reference
+000170b0: 732e 636f 7079 2829 0a20 2020 2020 2020  s.copy().       
+000170c0: 2066 6f72 2072 6566 2069 6e20 6e65 775f   for ref in new_
+000170d0: 7265 6673 3a0a 2020 2020 2020 2020 2020  refs:.          
+000170e0: 2020 6966 2072 6566 2e6e 616d 6520 696e    if ref.name in
+000170f0: 2069 6e76 616c 6964 5f72 6566 733a 0a20   invalid_refs:. 
+00017100: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00017110: 6577 5f63 6f6d 706f 6e65 6e74 2e66 6c61  ew_component.fla
+00017120: 7474 656e 5f72 6566 6572 656e 6365 2872  tten_reference(r
+00017130: 6566 290a 2020 2020 2020 2020 2020 2020  ef).            
+00017140: 656c 6966 2028 0a20 2020 2020 2020 2020  elif (.         
+00017150: 2020 2020 2020 2072 6566 2e70 6172 656e         ref.paren
+00017160: 742e 6e61 6d65 2069 6e20 7570 6461 7465  t.name in update
+00017170: 645f 636f 6d70 6f6e 656e 7473 0a20 2020  d_components.   
+00017180: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+00017190: 2072 6566 2e70 6172 656e 7420 6973 206e   ref.parent is n
+000171a0: 6f74 2075 7064 6174 6564 5f63 6f6d 706f  ot updated_compo
+000171b0: 6e65 6e74 735b 7265 662e 7061 7265 6e74  nents[ref.parent
+000171c0: 2e6e 616d 655d 0a20 2020 2020 2020 2020  .name].         
+000171d0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+000171e0: 2020 2020 2020 7265 662e 7061 7265 6e74        ref.parent
+000171f0: 203d 2075 7064 6174 6564 5f63 6f6d 706f   = updated_compo
+00017200: 6e65 6e74 735b 7265 662e 7061 7265 6e74  nents[ref.parent
+00017210: 2e6e 616d 655d 0a20 2020 2020 2020 2063  .name].        c
+00017220: 6f6d 706f 6e65 6e74 203d 206e 6577 5f63  omponent = new_c
+00017230: 6f6d 706f 6e65 6e74 0a20 2020 2020 2020  omponent.       
+00017240: 2075 7064 6174 6564 5f63 6f6d 706f 6e65   updated_compone
+00017250: 6e74 735b 636f 6d70 6f6e 656e 742e 6e61  nts[component.na
+00017260: 6d65 5d20 3d20 6e65 775f 636f 6d70 6f6e  me] = new_compon
+00017270: 656e 740a 2020 2020 7472 6176 6572 7365  ent.    traverse
+00017280: 645f 636f 6d70 6f6e 656e 7473 2e61 6464  d_components.add
+00017290: 2863 6f6d 706f 6e65 6e74 2e6e 616d 6529  (component.name)
+000172a0: 0a20 2020 2072 6574 7572 6e20 636f 6d70  .    return comp
+000172b0: 6f6e 656e 740a 0a0a 6465 6620 5f63 6865  onent...def _che
+000172c0: 636b 5f75 6e63 6163 6865 645f 636f 6d70  ck_uncached_comp
+000172d0: 6f6e 656e 7473 2863 6f6d 706f 6e65 6e74  onents(component
+000172e0: 2c20 6d6f 6465 293a 0a20 2020 2076 616c  , mode):.    val
+000172f0: 6964 5f6d 6f64 6573 203d 205b 2277 6172  id_modes = ["war
+00017300: 6e22 2c20 2265 7272 6f72 222c 2022 6967  n", "error", "ig
+00017310: 6e6f 7265 225d 0a0a 2020 2020 6966 206d  nore"]..    if m
+00017320: 6f64 6520 3d3d 2022 6967 6e6f 7265 223a  ode == "ignore":
+00017330: 0a20 2020 2020 2020 2072 6574 7572 6e0a  .        return.
+00017340: 2020 2020 656c 6966 206d 6f64 6520 6e6f      elif mode no
+00017350: 7420 696e 2076 616c 6964 5f6d 6f64 6573  t in valid_modes
+00017360: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
+00017370: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00017380: 2020 2020 2020 2020 6622 7b6d 6f64 657d          f"{mode}
+00017390: 2069 7320 6e6f 7420 6120 7661 6c69 6420   is not a valid 
+000173a0: 7661 6c75 6520 666f 7220 6f6e 5f75 6e63  value for on_unc
+000173b0: 6163 6865 645f 636f 6d70 6f6e 656e 742e  ached_component.
+000173c0: 2054 7279 206f 6e65 206f 6620 7468 6573   Try one of thes
+000173d0: 653a 207b 7661 6c69 645f 6d6f 6465 737d  e: {valid_modes}
+000173e0: 2e22 0a20 2020 2020 2020 2029 0a0a 2020  .".        )..  
+000173f0: 2020 666f 7220 7375 625f 636f 6d70 6f6e    for sub_compon
+00017400: 656e 7420 696e 2063 6f6d 706f 6e65 6e74  ent in component
+00017410: 2e67 6574 5f64 6570 656e 6465 6e63 6965  .get_dependencie
+00017420: 7328 7265 6375 7273 6976 653d 5472 7565  s(recursive=True
+00017430: 293a 0a20 2020 2020 2020 2069 6620 6e6f  ):.        if no
+00017440: 7420 7375 625f 636f 6d70 6f6e 656e 742e  t sub_component.
+00017450: 5f6c 6f63 6b65 643a 0a20 2020 2020 2020  _locked:.       
+00017460: 2020 2020 206d 6573 7361 6765 203d 2028       message = (
+00017470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017480: 2066 2243 6f6d 706f 6e65 6e74 207b 7375   f"Component {su
+00017490: 625f 636f 6d70 6f6e 656e 742e 6e61 6d65  b_component.name
+000174a0: 2172 7d20 7761 7320 4e4f 5420 7072 6f70  !r} was NOT prop
+000174b0: 6572 6c79 206c 6f63 6b65 642e 2022 0a20  erly locked. ". 
+000174c0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000174d0: 596f 7520 6e65 6564 2074 6f20 7772 6974  You need to writ
+000174e0: 6520 6974 2069 6e74 6f20 6120 6675 6e63  e it into a func
+000174f0: 7469 6f6e 2074 6861 7420 6861 7320 7468  tion that has th
+00017500: 6520 4063 656c 6c20 6465 636f 7261 746f  e @cell decorato
+00017510: 722e 220a 2020 2020 2020 2020 2020 2020  r.".            
+00017520: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00017530: 206d 6f64 6520 3d3d 2022 7761 726e 223a   mode == "warn":
+00017540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017550: 2077 6172 6e69 6e67 732e 7761 726e 286d   warnings.warn(m
+00017560: 6573 7361 6765 2c20 556e 6361 6368 6564  essage, Uncached
+00017570: 436f 6d70 6f6e 656e 7457 6172 6e69 6e67  ComponentWarning
+00017580: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00017590: 6c69 6620 6d6f 6465 203d 3d20 2265 7272  lif mode == "err
+000175a0: 6f72 223a 0a20 2020 2020 2020 2020 2020  or":.           
+000175b0: 2020 2020 2072 6169 7365 2055 6e63 6163       raise Uncac
+000175c0: 6865 6443 6f6d 706f 6e65 6e74 4572 726f  hedComponentErro
+000175d0: 7228 6d65 7373 6167 6529 0a0a 0a64 6566  r(message)...def
+000175e0: 2074 6573 745f 7361 6d65 5f75 6964 2829   test_same_uid()
+000175f0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 696d   -> None:.    im
+00017600: 706f 7274 2067 6473 6661 6374 6f72 7920  port gdsfactory 
+00017610: 6173 2067 660a 0a20 2020 2063 203d 2043  as gf..    c = C
+00017620: 6f6d 706f 6e65 6e74 2829 0a20 2020 2063  omponent().    c
+00017630: 203c 3c20 6766 2e63 6f6d 706f 6e65 6e74   << gf.component
+00017640: 732e 7265 6374 616e 676c 6528 290a 2020  s.rectangle().  
+00017650: 2020 6320 3c3c 2067 662e 636f 6d70 6f6e    c << gf.compon
+00017660: 656e 7473 2e72 6563 7461 6e67 6c65 2829  ents.rectangle()
+00017670: 0a0a 2020 2020 7231 203d 2063 2e72 6566  ..    r1 = c.ref
+00017680: 6572 656e 6365 735b 305d 2e70 6172 656e  erences[0].paren
+00017690: 740a 2020 2020 7232 203d 2063 2e72 6566  t.    r2 = c.ref
+000176a0: 6572 656e 6365 735b 315d 2e70 6172 656e  erences[1].paren
+000176b0: 740a 0a20 2020 2061 7373 6572 7420 7231  t..    assert r1
+000176c0: 2e75 6964 203d 3d20 7232 2e75 6964 2c20  .uid == r2.uid, 
+000176d0: 6622 7b72 312e 7569 647d 206d 7573 7420  f"{r1.uid} must 
+000176e0: 6571 7561 6c20 7b72 322e 7569 647d 220a  equal {r2.uid}".
+000176f0: 0a0a 6465 6620 7465 7374 5f6e 6574 6c69  ..def test_netli
+00017700: 7374 5f73 696d 706c 6528 2920 2d3e 204e  st_simple() -> N
+00017710: 6f6e 653a 0a20 2020 2069 6d70 6f72 7420  one:.    import 
+00017720: 6764 7366 6163 746f 7279 2061 7320 6766  gdsfactory as gf
+00017730: 0a0a 2020 2020 6320 3d20 6766 2e43 6f6d  ..    c = gf.Com
+00017740: 706f 6e65 6e74 2829 0a20 2020 2063 3120  ponent().    c1 
+00017750: 3d20 6320 3c3c 2067 662e 636f 6d70 6f6e  = c << gf.compon
+00017760: 656e 7473 2e73 7472 6169 6768 7428 6c65  ents.straight(le
+00017770: 6e67 7468 3d31 2c20 7769 6474 683d 3229  ngth=1, width=2)
+00017780: 0a20 2020 2063 3220 3d20 6320 3c3c 2067  .    c2 = c << g
+00017790: 662e 636f 6d70 6f6e 656e 7473 2e73 7472  f.components.str
+000177a0: 6169 6768 7428 6c65 6e67 7468 3d32 2c20  aight(length=2, 
+000177b0: 7769 6474 683d 3229 0a20 2020 2063 322e  width=2).    c2.
+000177c0: 636f 6e6e 6563 7428 706f 7274 3d22 6f31  connect(port="o1
+000177d0: 222c 2064 6573 7469 6e61 7469 6f6e 3d63  ", destination=c
+000177e0: 312e 706f 7274 735b 226f 3222 5d29 0a20  1.ports["o2"]). 
+000177f0: 2020 2063 2e61 6464 5f70 6f72 7428 226f     c.add_port("o
+00017800: 3122 2c20 706f 7274 3d63 312e 706f 7274  1", port=c1.port
+00017810: 735b 226f 3122 5d29 0a20 2020 2063 2e61  s["o1"]).    c.a
+00017820: 6464 5f70 6f72 7428 226f 3222 2c20 706f  dd_port("o2", po
+00017830: 7274 3d63 322e 706f 7274 735b 226f 3222  rt=c2.ports["o2"
+00017840: 5d29 0a20 2020 206e 6574 6c69 7374 203d  ]).    netlist =
+00017850: 2063 2e67 6574 5f6e 6574 6c69 7374 2829   c.get_netlist()
+00017860: 0a20 2020 2023 2070 7269 6e74 286e 6574  .    # print(net
+00017870: 6c69 7374 2e70 7265 7474 7928 2929 0a20  list.pretty()). 
+00017880: 2020 2061 7373 6572 7420 6c65 6e28 6e65     assert len(ne
+00017890: 746c 6973 745b 2269 6e73 7461 6e63 6573  tlist["instances
+000178a0: 225d 2920 3d3d 2032 0a0a 0a64 6566 2074  "]) == 2...def t
+000178b0: 6573 745f 6e65 746c 6973 745f 7369 6d70  est_netlist_simp
+000178c0: 6c65 5f77 6964 7468 5f6d 6973 6d61 7463  le_width_mismatc
+000178d0: 685f 7468 726f 7773 5f65 7272 6f72 2829  h_throws_error()
+000178e0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 696d   -> None:.    im
+000178f0: 706f 7274 2070 7974 6573 740a 0a20 2020  port pytest..   
+00017900: 2069 6d70 6f72 7420 6764 7366 6163 746f   import gdsfacto
+00017910: 7279 2061 7320 6766 0a0a 2020 2020 6320  ry as gf..    c 
+00017920: 3d20 6766 2e43 6f6d 706f 6e65 6e74 2829  = gf.Component()
+00017930: 0a20 2020 2063 3120 3d20 6320 3c3c 2067  .    c1 = c << g
+00017940: 662e 636f 6d70 6f6e 656e 7473 2e73 7472  f.components.str
+00017950: 6169 6768 7428 6c65 6e67 7468 3d31 2c20  aight(length=1, 
+00017960: 7769 6474 683d 3129 0a20 2020 2063 3220  width=1).    c2 
+00017970: 3d20 6320 3c3c 2067 662e 636f 6d70 6f6e  = c << gf.compon
+00017980: 656e 7473 2e73 7472 6169 6768 7428 6c65  ents.straight(le
+00017990: 6e67 7468 3d32 2c20 7769 6474 683d 3229  ngth=2, width=2)
+000179a0: 0a20 2020 2063 322e 636f 6e6e 6563 7428  .    c2.connect(
+000179b0: 706f 7274 3d22 6f31 222c 2064 6573 7469  port="o1", desti
+000179c0: 6e61 7469 6f6e 3d63 312e 706f 7274 735b  nation=c1.ports[
+000179d0: 226f 3222 5d29 0a20 2020 2063 2e61 6464  "o2"]).    c.add
+000179e0: 5f70 6f72 7428 226f 3122 2c20 706f 7274  _port("o1", port
+000179f0: 3d63 312e 706f 7274 735b 226f 3122 5d29  =c1.ports["o1"])
+00017a00: 0a20 2020 2063 2e61 6464 5f70 6f72 7428  .    c.add_port(
+00017a10: 226f 3222 2c20 706f 7274 3d63 322e 706f  "o2", port=c2.po
+00017a20: 7274 735b 226f 3222 5d29 0a20 2020 2077  rts["o2"]).    w
+00017a30: 6974 6820 7079 7465 7374 2e72 6169 7365  ith pytest.raise
+00017a40: 7328 5661 6c75 6545 7272 6f72 293a 0a20  s(ValueError):. 
+00017a50: 2020 2020 2020 2063 2e67 6574 5f6e 6574         c.get_net
+00017a60: 6c69 7374 2829 0a0a 0a64 6566 2074 6573  list()...def tes
+00017a70: 745f 6e65 746c 6973 745f 636f 6d70 6c65  t_netlist_comple
+00017a80: 7828 2920 2d3e 204e 6f6e 653a 0a20 2020  x() -> None:.   
+00017a90: 2069 6d70 6f72 7420 6764 7366 6163 746f   import gdsfacto
+00017aa0: 7279 2061 7320 6766 0a0a 2020 2020 6320  ry as gf..    c 
+00017ab0: 3d20 6766 2e63 6f6d 706f 6e65 6e74 732e  = gf.components.
+00017ac0: 6d7a 695f 6172 6d73 2829 0a20 2020 206e  mzi_arms().    n
+00017ad0: 6574 6c69 7374 203d 2063 2e67 6574 5f6e  etlist = c.get_n
+00017ae0: 6574 6c69 7374 2829 0a20 2020 2023 2070  etlist().    # p
+00017af0: 7269 6e74 286e 6574 6c69 7374 2e70 7265  rint(netlist.pre
+00017b00: 7474 7928 2929 0a20 2020 2061 7373 6572  tty()).    asser
+00017b10: 7420 6c65 6e28 6e65 746c 6973 745b 2269  t len(netlist["i
+00017b20: 6e73 7461 6e63 6573 225d 2920 3d3d 2034  nstances"]) == 4
+00017b30: 2c20 6c65 6e28 6e65 746c 6973 745b 2269  , len(netlist["i
+00017b40: 6e73 7461 6e63 6573 225d 290a 0a0a 6465  nstances"])...de
+00017b50: 6620 7465 7374 5f65 7874 7261 6374 2829  f test_extract()
+00017b60: 202d 3e20 436f 6d70 6f6e 656e 743a 0a20   -> Component:. 
+00017b70: 2020 2069 6d70 6f72 7420 6764 7366 6163     import gdsfac
+00017b80: 746f 7279 2061 7320 6766 0a0a 2020 2020  tory as gf..    
+00017b90: 6320 3d20 6766 2e63 6f6d 706f 6e65 6e74  c = gf.component
+00017ba0: 732e 7374 7261 6967 6874 280a 2020 2020  s.straight(.    
+00017bb0: 2020 2020 6c65 6e67 7468 3d31 302c 0a20      length=10,. 
+00017bc0: 2020 2020 2020 2077 6964 7468 3d30 2e35         width=0.5
+00017bd0: 2c0a 2020 2020 2020 2020 6262 6f78 5f6c  ,.        bbox_l
+00017be0: 6179 6572 733d 5b67 662e 4c41 5945 522e  ayers=[gf.LAYER.
+00017bf0: 5747 434c 4144 5d2c 0a20 2020 2020 2020  WGCLAD],.       
+00017c00: 2062 626f 785f 6f66 6673 6574 733d 5b33   bbox_offsets=[3
+00017c10: 5d2c 0a20 2020 2020 2020 2077 6974 685f  ],.        with_
+00017c20: 6262 6f78 3d54 7275 652c 0a20 2020 2020  bbox=True,.     
+00017c30: 2020 2063 6c61 6464 696e 675f 6c61 7965     cladding_laye
+00017c40: 7273 3d4e 6f6e 652c 0a20 2020 2020 2020  rs=None,.       
+00017c50: 2061 6464 5f70 696e 733d 4e6f 6e65 2c0a   add_pins=None,.
+00017c60: 2020 2020 2020 2020 6164 645f 6262 6f78          add_bbox
+00017c70: 3d4e 6f6e 652c 0a20 2020 2029 0a20 2020  =None,.    ).   
+00017c80: 2063 3220 3d20 632e 6578 7472 6163 7428   c2 = c.extract(
+00017c90: 6c61 7965 7273 3d5b 6766 2e4c 4159 4552  layers=[gf.LAYER
+00017ca0: 2e57 4743 4c41 445d 290a 0a20 2020 2061  .WGCLAD])..    a
+00017cb0: 7373 6572 7420 6c65 6e28 632e 706f 6c79  ssert len(c.poly
+00017cc0: 676f 6e73 2920 3d3d 2032 2c20 6c65 6e28  gons) == 2, len(
+00017cd0: 632e 706f 6c79 676f 6e73 290a 2020 2020  c.polygons).    
+00017ce0: 6173 7365 7274 206c 656e 2863 322e 706f  assert len(c2.po
+00017cf0: 6c79 676f 6e73 2920 3d3d 2031 2c20 6c65  lygons) == 1, le
+00017d00: 6e28 6332 2e70 6f6c 7967 6f6e 7329 0a20  n(c2.polygons). 
+00017d10: 2020 2061 7373 6572 7420 6766 2e4c 4159     assert gf.LAY
+00017d20: 4552 2e57 4743 4c41 4420 696e 2063 322e  ER.WGCLAD in c2.
+00017d30: 6c61 7965 7273 0a20 2020 2072 6574 7572  layers.    retur
+00017d40: 6e20 6332 0a0a 0a64 6566 2068 6173 685f  n c2...def hash_
+00017d50: 6669 6c65 2866 696c 6570 6174 6829 3a0a  file(filepath):.
+00017d60: 2020 2020 6d64 3520 3d20 6861 7368 6c69      md5 = hashli
+00017d70: 622e 6d64 3528 290a 2020 2020 6d64 352e  b.md5().    md5.
+00017d80: 7570 6461 7465 2866 696c 6570 6174 682e  update(filepath.
+00017d90: 7265 6164 5f62 7974 6573 2829 290a 2020  read_bytes()).  
+00017da0: 2020 7265 7475 726e 206d 6435 2e68 6578    return md5.hex
+00017db0: 6469 6765 7374 2829 0a0a 0a64 6566 2074  digest()...def t
+00017dc0: 6573 745f 6262 6f78 5f72 6566 6572 656e  est_bbox_referen
+00017dd0: 6365 2829 202d 3e20 436f 6d70 6f6e 656e  ce() -> Componen
+00017de0: 743a 0a20 2020 2069 6d70 6f72 7420 6764  t:.    import gd
+00017df0: 7366 6163 746f 7279 2061 7320 6766 0a0a  sfactory as gf..
+00017e00: 2020 2020 6320 3d20 6766 2e43 6f6d 706f      c = gf.Compo
+00017e10: 6e65 6e74 2822 636f 6d70 6f6e 656e 745f  nent("component_
+00017e20: 7769 7468 5f6f 6666 6772 6964 5f70 6f6c  with_offgrid_pol
+00017e30: 7967 6f6e 7322 290a 2020 2020 6331 203d  ygons").    c1 =
+00017e40: 2063 203c 3c20 6766 2e63 6f6d 706f 6e65   c << gf.compone
+00017e50: 6e74 732e 7265 6374 616e 676c 6528 7369  nts.rectangle(si
+00017e60: 7a65 3d28 312e 3565 2d33 2c20 312e 3565  ze=(1.5e-3, 1.5e
+00017e70: 2d33 292c 2070 6f72 745f 7479 7065 3d4e  -3), port_type=N
+00017e80: 6f6e 6529 0a20 2020 2063 3220 3d20 6320  one).    c2 = c 
+00017e90: 3c3c 2067 662e 636f 6d70 6f6e 656e 7473  << gf.components
+00017ea0: 2e72 6563 7461 6e67 6c65 2873 697a 653d  .rectangle(size=
+00017eb0: 2831 2e35 652d 332c 2031 2e35 652d 3329  (1.5e-3, 1.5e-3)
+00017ec0: 2c20 706f 7274 5f74 7970 653d 4e6f 6e65  , port_type=None
+00017ed0: 290a 2020 2020 6332 2e78 6d69 6e20 3d20  ).    c2.xmin = 
+00017ee0: 6331 2e78 6d61 780a 0a20 2020 2061 7373  c1.xmax..    ass
+00017ef0: 6572 7420 6332 2e78 7369 7a65 203d 3d20  ert c2.xsize == 
+00017f00: 3265 2d33 0a20 2020 2072 6574 7572 6e20  2e-3.    return 
+00017f10: 6332 0a0a 0a64 6566 2074 6573 745f 6262  c2...def test_bb
+00017f20: 6f78 5f63 6f6d 706f 6e65 6e74 2829 202d  ox_component() -
+00017f30: 3e20 4e6f 6e65 3a0a 2020 2020 696d 706f  > None:.    impo
+00017f40: 7274 2067 6473 6661 6374 6f72 7920 6173  rt gdsfactory as
+00017f50: 2067 660a 0a20 2020 2063 203d 2067 662e   gf..    c = gf.
+00017f60: 636f 6d70 6f6e 656e 7473 2e72 6563 7461  components.recta
+00017f70: 6e67 6c65 2873 697a 653d 2831 2e35 652d  ngle(size=(1.5e-
+00017f80: 332c 2031 2e35 652d 3329 2c20 706f 7274  3, 1.5e-3), port
+00017f90: 5f74 7970 653d 4e6f 6e65 290a 2020 2020  _type=None).    
+00017fa0: 6173 7365 7274 2063 2e78 7369 7a65 203d  assert c.xsize =
+00017fb0: 3d20 3265 2d33 0a0a 0a64 6566 2074 6573  = 2e-3...def tes
+00017fc0: 745f 7265 6d61 705f 6c61 7965 7273 2829  t_remap_layers()
+00017fd0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 696d   -> None:.    im
+00017fe0: 706f 7274 2067 6473 6661 6374 6f72 7920  port gdsfactory 
+00017ff0: 6173 2067 660a 0a20 2020 2063 203d 2067  as gf..    c = g
+00018000: 662e 636f 6d70 6f6e 656e 7473 2e73 7472  f.components.str
+00018010: 6169 6768 7428 6c61 7965 723d 2832 2c20  aight(layer=(2, 
+00018020: 3029 290a 2020 2020 7265 6d61 7020 3d20  0)).    remap = 
+00018030: 632e 7265 6d61 705f 6c61 7965 7273 286c  c.remap_layers(l
+00018040: 6179 6572 6d61 703d 7b28 322c 2030 293a  ayermap={(2, 0):
+00018050: 2067 662e 4c41 5945 522e 5747 4e7d 290a   gf.LAYER.WGN}).
+00018060: 2020 2020 6861 7368 5f67 656f 6d65 7472      hash_geometr
+00018070: 7920 3d20 2238 3366 6263 3661 3832 3839  y = "83fbc6a8289
+00018080: 3530 3565 6165 6433 6132 6533 6162 3237  505eaed3a2e3ab27
+00018090: 3963 6330 3366 3565 3464 3030 6322 0a0a  9cc03f5e4d00c"..
+000180a0: 2020 2020 6173 7365 7274 2028 0a20 2020      assert (.   
+000180b0: 2020 2020 2072 656d 6170 2e68 6173 685f       remap.hash_
+000180c0: 6765 6f6d 6574 7279 2829 203d 3d20 6861  geometry() == ha
+000180d0: 7368 5f67 656f 6d65 7472 790a 2020 2020  sh_geometry.    
+000180e0: 292c 2066 2268 6173 685f 6765 6f6d 6574  ), f"hash_geomet
+000180f0: 7279 203d 207b 7265 6d61 702e 6861 7368  ry = {remap.hash
+00018100: 5f67 656f 6d65 7472 7928 2921 727d 220a  _geometry()!r}".
+00018110: 0a0a 6465 6620 7465 7374 5f72 656d 6f76  ..def test_remov
+00018120: 655f 6c61 6265 6c73 2829 202d 3e20 4e6f  e_labels() -> No
+00018130: 6e65 3a0a 2020 2020 696d 706f 7274 2067  ne:.    import g
+00018140: 6473 6661 6374 6f72 7920 6173 2067 660a  dsfactory as gf.
+00018150: 0a20 2020 2063 203d 2067 662e 632e 7374  .    c = gf.c.st
+00018160: 7261 6967 6874 2829 0a20 2020 2063 2e72  raight().    c.r
+00018170: 656d 6f76 655f 6c61 6265 6c73 2829 0a0a  emove_labels()..
+00018180: 2020 2020 6173 7365 7274 206c 656e 2863      assert len(c
+00018190: 2e6c 6162 656c 7329 203d 3d20 300a 0a0a  .labels) == 0...
+000181a0: 6465 6620 7465 7374 5f69 6d70 6f72 745f  def test_import_
+000181b0: 6764 735f 7365 7474 696e 6773 2829 202d  gds_settings() -
+000181c0: 3e20 4e6f 6e65 3a0a 2020 2020 696d 706f  > None:.    impo
+000181d0: 7274 2067 6473 6661 6374 6f72 7920 6173  rt gdsfactory as
+000181e0: 2067 660a 0a20 2020 2063 203d 2067 662e   gf..    c = gf.
+000181f0: 636f 6d70 6f6e 656e 7473 2e6d 7a69 2829  components.mzi()
+00018200: 0a20 2020 2067 6473 7061 7468 203d 2063  .    gdspath = c
+00018210: 2e77 7269 7465 5f67 6473 5f77 6974 685f  .write_gds_with_
+00018220: 6d65 7461 6461 7461 2829 0a20 2020 2063  metadata().    c
+00018230: 3220 3d20 6766 2e69 6d70 6f72 745f 6764  2 = gf.import_gd
+00018240: 7328 6764 7370 6174 682c 206e 616d 653d  s(gdspath, name=
+00018250: 226d 7a69 5f73 616d 706c 6522 2c20 7265  "mzi_sample", re
+00018260: 6164 5f6d 6574 6164 6174 613d 5472 7565  ad_metadata=True
+00018270: 290a 2020 2020 6333 203d 2067 662e 726f  ).    c3 = gf.ro
+00018280: 7574 696e 672e 6164 645f 6669 6265 725f  uting.add_fiber_
+00018290: 7369 6e67 6c65 2863 3229 0a20 2020 2061  single(c2).    a
+000182a0: 7373 6572 7420 6333 0a0a 0a64 6566 2074  ssert c3...def t
+000182b0: 6573 745f 666c 6174 7465 6e5f 696e 7661  est_flatten_inva
+000182c0: 6c69 645f 7265 6673 5f72 6563 7572 7369  lid_refs_recursi
+000182d0: 7665 2829 202d 3e20 4e6f 6e65 3a0a 2020  ve() -> None:.  
+000182e0: 2020 696d 706f 7274 2067 6473 6661 6374    import gdsfact
+000182f0: 6f72 7920 6173 2067 660a 2020 2020 6672  ory as gf.    fr
+00018300: 6f6d 2067 6473 6661 6374 6f72 792e 6469  om gdsfactory.di
+00018310: 6666 7465 7374 2069 6d70 6f72 7420 7275  fftest import ru
+00018320: 6e5f 786f 720a 2020 2020 6672 6f6d 2067  n_xor.    from g
+00018330: 6473 6661 6374 6f72 792e 726f 7574 696e  dsfactory.routin
+00018340: 672e 616c 6c5f 616e 676c 6520 696d 706f  g.all_angle impo
+00018350: 7274 2067 6574 5f62 756e 646c 655f 616c  rt get_bundle_al
+00018360: 6c5f 616e 676c 650a 0a20 2020 2040 6766  l_angle..    @gf
+00018370: 2e63 656c 6c0a 2020 2020 6465 6620 666c  .cell.    def fl
+00018380: 6174 2829 3a0a 2020 2020 2020 2020 6320  at():.        c 
+00018390: 3d20 6766 2e43 6f6d 706f 6e65 6e74 2829  = gf.Component()
+000183a0: 0a20 2020 2020 2020 206d 6d69 3120 3d20  .        mmi1 = 
+000183b0: 2863 203c 3c20 6766 2e63 6f6d 706f 6e65  (c << gf.compone
+000183c0: 6e74 732e 6d6d 6931 7832 2829 292e 6d6f  nts.mmi1x2()).mo
+000183d0: 7665 2828 302c 202d 312e 3030 3035 2929  ve((0, -1.0005))
+000183e0: 0a20 2020 2020 2020 206d 6d69 3220 3d20  .        mmi2 = 
+000183f0: 2863 203c 3c20 6766 2e63 6f6d 706f 6e65  (c << gf.compone
+00018400: 6e74 732e 6d6d 6931 7832 2829 292e 726f  nts.mmi1x2()).ro
+00018410: 7461 7465 2838 3029 0a20 2020 2020 2020  tate(80).       
+00018420: 206d 6d69 322e 6d6f 7665 2828 3430 2c20   mmi2.move((40, 
+00018430: 3230 2929 0a20 2020 2020 2020 2062 756e  20)).        bun
+00018440: 646c 6520 3d20 6765 745f 6275 6e64 6c65  dle = get_bundle
+00018450: 5f61 6c6c 5f61 6e67 6c65 285b 6d6d 6931  _all_angle([mmi1
+00018460: 2e70 6f72 7473 5b22 6f32 225d 5d2c 205b  .ports["o2"]], [
+00018470: 6d6d 6932 2e70 6f72 7473 5b22 6f31 225d  mmi2.ports["o1"]
+00018480: 5d29 0a20 2020 2020 2020 2066 6f72 2072  ]).        for r
+00018490: 6f75 7465 2069 6e20 6275 6e64 6c65 3a0a  oute in bundle:.
+000184a0: 2020 2020 2020 2020 2020 2020 632e 6164              c.ad
+000184b0: 6428 726f 7574 652e 7265 6665 7265 6e63  d(route.referenc
+000184c0: 6573 290a 2020 2020 2020 2020 7265 7475  es).        retu
+000184d0: 726e 2063 0a0a 2020 2020 4067 662e 6365  rn c..    @gf.ce
+000184e0: 6c6c 0a20 2020 2064 6566 2068 6965 7261  ll.    def hiera
+000184f0: 7263 6879 2829 3a0a 2020 2020 2020 2020  rchy():.        
+00018500: 6320 3d20 6766 2e43 6f6d 706f 6e65 6e74  c = gf.Component
+00018510: 2829 0a20 2020 2020 2020 2028 6320 3c3c  ().        (c <<
+00018520: 2066 6c61 7428 2929 2e72 6f74 6174 6528   flat()).rotate(
+00018530: 3333 290a 2020 2020 2020 2020 2863 203c  33).        (c <
+00018540: 3c20 666c 6174 2829 292e 726f 7461 7465  < flat()).rotate
+00018550: 2833 3329 2e6d 6f76 6528 2830 2c20 3130  (33).move((0, 10
+00018560: 3029 290a 2020 2020 2020 2020 2863 203c  0)).        (c <
+00018570: 3c20 666c 6174 2829 292e 6d6f 7665 2828  < flat()).move((
+00018580: 3130 302c 2030 2929 0a20 2020 2020 2020  100, 0)).       
+00018590: 2072 6574 7572 6e20 630a 0a20 2020 2063   return c..    c
+000185a0: 5f6f 7269 6720 3d20 6869 6572 6172 6368  _orig = hierarch
+000185b0: 7928 290a 2020 2020 635f 6e65 7720 3d20  y().    c_new = 
+000185c0: 666c 6174 7465 6e5f 696e 7661 6c69 645f  flatten_invalid_
+000185d0: 7265 6673 5f72 6563 7572 7369 7665 2863  refs_recursive(c
+000185e0: 5f6f 7269 6729 0a20 2020 2061 7373 6572  _orig).    asser
+000185f0: 7420 635f 6e65 7720 6973 206e 6f74 2063  t c_new is not c
+00018600: 5f6f 7269 670a 2020 2020 696e 7661 6c69  _orig.    invali
+00018610: 645f 7265 6673 5f66 696c 656e 616d 6520  d_refs_filename 
+00018620: 3d20 2269 6e76 616c 6964 5f72 6566 732e  = "invalid_refs.
+00018630: 6764 7322 0a20 2020 2069 6e76 616c 6964  gds".    invalid
+00018640: 5f72 6566 735f 6669 7865 645f 6669 6c65  _refs_fixed_file
+00018650: 6e61 6d65 203d 2022 696e 7661 6c69 645f  name = "invalid_
+00018660: 7265 6673 5f66 6978 6564 2e67 6473 220a  refs_fixed.gds".
+00018670: 2020 2020 2320 6764 7320 6669 6c65 7320      # gds files 
+00018680: 7368 6f75 6c64 2073 7469 6c6c 2062 6520  should still be 
+00018690: 7361 6d65 2074 6f20 316e 6d20 746f 6c65  same to 1nm tole
+000186a0: 7261 6e63 650a 2020 2020 635f 6f72 6967  rance.    c_orig
+000186b0: 2e77 7269 7465 5f67 6473 2869 6e76 616c  .write_gds(inval
+000186c0: 6964 5f72 6566 735f 6669 6c65 6e61 6d65  id_refs_filename
+000186d0: 290a 2020 2020 635f 6e65 772e 7772 6974  ).    c_new.writ
+000186e0: 655f 6764 7328 696e 7661 6c69 645f 7265  e_gds(invalid_re
+000186f0: 6673 5f66 6978 6564 5f66 696c 656e 616d  fs_fixed_filenam
+00018700: 6529 0a20 2020 2072 756e 5f78 6f72 2869  e).    run_xor(i
+00018710: 6e76 616c 6964 5f72 6566 735f 6669 6c65  nvalid_refs_file
+00018720: 6e61 6d65 2c20 696e 7661 6c69 645f 7265  name, invalid_re
+00018730: 6673 5f66 6978 6564 5f66 696c 656e 616d  fs_fixed_filenam
+00018740: 6529 0a0a 0a69 6620 5f5f 6e61 6d65 5f5f  e)...if __name__
+00018750: 203d 3d20 225f 5f6d 6169 6e5f 5f22 3a0a   == "__main__":.
+00018760: 2020 2020 696d 706f 7274 2067 6473 6661      import gdsfa
+00018770: 6374 6f72 7920 6173 2067 660a 0a20 2020  ctory as gf..   
+00018780: 2063 203d 2067 662e 436f 6d70 6f6e 656e   c = gf.Componen
+00018790: 7428 290a 2020 2020 7020 3d20 632e 6164  t().    p = c.ad
+000187a0: 645f 706f 6c79 676f 6e28 0a20 2020 2020  d_polygon(.     
+000187b0: 2020 205b 282d 382c 2036 2c20 372c 2039     [(-8, 6, 7, 9
+000187c0: 292c 2028 2d36 2c20 382c 2031 372c 2035  ), (-6, 8, 17, 5
+000187d0: 295d 2c20 6c61 7965 723d 2831 2c20 3029  )], layer=(1, 0)
+000187e0: 0a20 2020 2029 2020 2320 4744 5320 6c61  .    )  # GDS la
+000187f0: 7965 7273 2061 7265 2074 7570 6c65 7320  yers are tuples 
+00018800: 6f66 2069 6e74 7320 2862 7574 2069 6620  of ints (but if 
+00018810: 7765 2075 7365 206f 6e6c 7920 6f6e 6520  we use only one 
+00018820: 6e75 6d62 6572 2069 7420 6173 7375 6d65  number it assume
+00018830: 7320 7468 6520 6f74 6865 7220 6e75 6d62  s the other numb
+00018840: 6572 2069 7320 3029 0a0a 2020 2020 2320  er is 0)..    # 
+00018850: 6332 203d 2067 662e 436f 6d70 6f6e 656e  c2 = gf.Componen
+00018860: 7428 290a 2020 2020 6320 3d20 6766 2e63  t().    c = gf.c
+00018870: 6f6d 706f 6e65 6e74 732e 6d7a 6928 290a  omponents.mzi().
+00018880: 2020 2020 7072 696e 7428 632e 6765 745f      print(c.get_
+00018890: 6c61 7965 725f 6e61 6d65 7328 2929 0a20  layer_names()). 
+000188a0: 2020 2023 2063 203d 2067 662e 636f 6d70     # c = gf.comp
+000188b0: 6f6e 656e 7473 2e6d 7a69 2829 0a20 2020  onents.mzi().   
+000188c0: 2023 2070 7269 6e74 2863 2e67 6574 5f6c   # print(c.get_l
+000188d0: 6179 6572 5f6e 616d 6573 2829 290a 2020  ayer_names()).  
+000188e0: 2020 2320 7220 3d20 632e 7265 6628 290a    # r = c.ref().
+000188f0: 2020 2020 2320 6332 2e63 6f70 795f 6368      # c2.copy_ch
+00018900: 696c 645f 696e 666f 2863 2e6e 616d 6564  ild_info(c.named
+00018910: 5f72 6566 6572 656e 6365 735b 2273 7874  _references["sxt
+00018920: 225d 290a 2020 2020 2320 7465 7374 5f72  "]).    # test_r
+00018930: 656d 6170 5f6c 6179 6572 7328 290a 2020  emap_layers().  
+00018940: 2020 2320 6320 3d20 7465 7374 5f67 6574    # c = test_get
+00018950: 5f6c 6179 6572 7328 290a 2020 2020 2320  _layers().    # 
+00018960: 632e 706c 6f74 5f71 7428 290a 2020 2020  c.plot_qt().    
+00018970: 2320 632e 706c 6f74 6828 290a 2020 2020  # c.ploth().    
+00018980: 2320 6320 3d20 7465 7374 5f65 7874 7261  # c = test_extra
+00018990: 6374 2829 0a20 2020 2023 2067 6473 7061  ct().    # gdspa
+000189a0: 7468 203d 2063 2e77 7269 7465 5f67 6473  th = c.write_gds
+000189b0: 2829 0a20 2020 2023 2067 662e 7368 6f77  ().    # gf.show
+000189c0: 2867 6473 7061 7468 290a 2020 2020 2320  (gdspath).    # 
+000189d0: 632e 7368 6f77 2873 686f 775f 706f 7274  c.show(show_port
+000189e0: 733d 5472 7565 290a 2020 2020 632e 7368  s=True).    c.sh
+000189f0: 6f77 2829 0a                             ow().
```

### Comparing `gdsfactory-6.93.1/gdsfactory/component_layout.py` & `gdsfactory-6.94.0/gdsfactory/component_layout.py`

 * *Files 2% similar despite different names*

```diff
@@ -138,44 +138,44 @@
 
     @property
     def center(self):
         """Returns the center of the bounding box."""
         return np.sum(self.bbox, 0) / 2
 
     @center.setter
-    def center(self, destination):
+    def center(self, destination) -> None:
         """Sets the center of the bounding box.
 
         Args:
             destination : array-like[2] Coordinates of the new bounding box center.
         """
         self.move(destination=destination, origin=self.center)
 
     @property
     def x(self):
         """Returns the x-coordinate of the center of the bounding box."""
         return np.sum(self.bbox, 0)[0] / 2
 
     @x.setter
-    def x(self, destination):
+    def x(self, destination) -> None:
         """Sets the x-coordinate of the center of the bounding box.
 
         Args:
             destination : int or float x-coordinate of the bbox center.
         """
         destination = (destination, self.center[1])
         self.move(destination=destination, origin=self.center, axis="x")
 
     @property
     def y(self):
         """Returns the y-coordinate of the center of the bounding box."""
         return np.sum(self.bbox, 0)[1] / 2
 
     @y.setter
-    def y(self, destination):
+    def y(self, destination) -> None:
         """Sets the y-coordinate of the center of the bounding box.
 
         Args:
         destination : int or float
             y-coordinate of the bbox center.
         """
         destination = (self.center[0], destination)
@@ -183,58 +183,58 @@
 
     @property
     def xmax(self):
         """Returns the maximum x-value of the bounding box."""
         return self.bbox[1][0]
 
     @xmax.setter
-    def xmax(self, destination):
+    def xmax(self, destination) -> None:
         """Sets the x-coordinate of the maximum edge of the bounding box.
 
         Args:
         destination : int or float
             x-coordinate of the maximum edge of the bbox.
         """
         self.move(destination=(destination, 0), origin=self.bbox[1], axis="x")
 
     @property
     def ymax(self):
         """Returns the maximum y-value of the bounding box."""
         return self.bbox[1][1]
 
     @ymax.setter
-    def ymax(self, destination):
+    def ymax(self, destination) -> None:
         """Sets the y-coordinate of the maximum edge of the bounding box.
 
         Args:
             destination : int or float y-coordinate of the maximum edge of the bbox.
         """
         self.move(destination=(0, destination), origin=self.bbox[1], axis="y")
 
     @property
     def xmin(self):
         """Returns the minimum x-value of the bounding box."""
         return self.bbox[0][0]
 
     @xmin.setter
-    def xmin(self, destination):
+    def xmin(self, destination) -> None:
         """Sets the x-coordinate of the minimum edge of the bounding box.
 
         Args:
             destination : int or float x-coordinate of the minimum edge of the bbox.
         """
         self.move(destination=(destination, 0), origin=self.bbox[0], axis="x")
 
     @property
     def ymin(self):
         """Returns the minimum y-value of the bounding box."""
         return self.bbox[0][1]
 
     @ymin.setter
-    def ymin(self, destination):
+    def ymin(self, destination) -> None:
         """Sets the y-coordinate of the minimum edge of the bounding box.
 
         Args:
             destination : int or float y-coordinate of the minimum edge of the bbox.
         """
         self.move(destination=(0, destination), origin=self.bbox[0], axis="y")
 
@@ -296,15 +296,15 @@
         return G
 
 
 class Group(_GeometryHelper):
     """Group objects together so you can manipulate them as a single object \
             (move/rotate/mirror)."""
 
-    def __init__(self, *args):
+    def __init__(self, *args) -> None:
         """Initialize Group."""
         self.elements = []
         self.add(args)
 
     def __repr__(self) -> str:
         """Prints the number of elements in the Group."""
         return f"Group ({len(self.elements)} elements total)"
```

### Comparing `gdsfactory-6.93.1/gdsfactory/component_reference.py` & `gdsfactory-6.94.0/gdsfactory/component_reference.py`

 * *Files 2% similar despite different names*

```diff
@@ -216,51 +216,51 @@
         return self._ref_cell
 
     @property
     def origin(self):
         return self._reference.origin
 
     @origin.setter
-    def origin(self, value):
+    def origin(self, value) -> None:
         self._reference.origin = value
 
     @property
     def magnification(self) -> float:
         return self._reference.magnification
 
     @magnification.setter
-    def magnification(self, value):
+    def magnification(self, value) -> None:
         self._reference.magnification = value
 
     @property
     def rotation(self) -> float:
         return np.rad2deg(self._reference.rotation)
 
     @rotation.setter
-    def rotation(self, value):
+    def rotation(self, value) -> None:
         self._reference.rotation = np.deg2rad(value)
 
     @property
     def x_reflection(self) -> bool:
         return self._reference.x_reflection
 
     @x_reflection.setter
-    def x_reflection(self, value):
+    def x_reflection(self, value) -> None:
         self._reference.x_reflection = value
 
-    def _set_ref_cell(self, value):
+    def _set_ref_cell(self, value) -> None:
         self._ref_cell = value
         self._reference.cell = value._cell
 
     @ref_cell.setter
-    def ref_cell(self, value):
+    def ref_cell(self, value) -> None:
         self._set_ref_cell(value)
 
     @parent.setter
-    def parent(self, value):
+    def parent(self, value) -> None:
         self._set_ref_cell(value)
 
     def get_polygons(
         self,
         by_spec: bool = False,
         depth: Optional[int] = None,
         include_paths: bool = True,
@@ -833,24 +833,24 @@
     def get_ports_ysize(self, **kwargs) -> float:
         """Returns ydistance from east to west ports."""
         ports_cw = self.get_ports_list(clockwise=True, **kwargs)
         ports_ccw = self.get_ports_list(clockwise=False, **kwargs)
         return snap_to_grid(ports_ccw[0].y - ports_cw[0].y)
 
 
-def test_move():
+def test_move() -> None:
     import gdsfactory as gf
 
     c = gf.Component()
     mzi = c.add_ref(gf.components.mzi())
     bend = c.add_ref(gf.components.bend_euler())
     bend.move("o1", mzi.ports["o2"])
 
 
-def test_get_polygons():
+def test_get_polygons() -> None:
     import gdsfactory as gf
 
     ref = gf.components.straight()
     p0 = ref.get_polygons(by_spec="WG", as_array=False)
     p1 = ref.get_polygons(by_spec=(1, 0), as_array=True)
     p2 = ref.get_polygons(by_spec=(1, 0), as_array=False)
 
@@ -859,15 +859,15 @@
 
     assert len(p1) == len(p2) == len(p3) == len(p4) == 1 == len(p0)
     assert p1[0].dtype == p3[0].dtype == float
     assert isinstance(p2[0], Polygon)
     assert isinstance(p4[0], Polygon)
 
 
-def test_get_polygons_ref():
+def test_get_polygons_ref() -> None:
     import gdsfactory as gf
 
     ref = gf.components.straight().ref()
     p0 = ref.get_polygons(by_spec="WG", as_array=False)
     p1 = ref.get_polygons(by_spec=(1, 0), as_array=True)
     p2 = ref.get_polygons(by_spec=(1, 0), as_array=False)
 
@@ -876,15 +876,15 @@
 
     assert len(p1) == len(p2) == len(p3) == len(p4) == 1 == len(p0)
     assert p1[0].dtype == p3[0].dtype == float
     assert isinstance(p2[0], Polygon)
     assert isinstance(p4[0], Polygon)
 
 
-def test_pads_no_orientation():
+def test_pads_no_orientation() -> None:
     import gdsfactory as gf
 
     c = gf.Component("pads_no_orientation")
     pt = c << gf.components.pad()
     pb = c << gf.components.pad()
     pb.connect("pad", pt["pad"])
```

### Comparing `gdsfactory-6.93.1/gdsfactory/components/C.py` & `gdsfactory-6.94.0/gdsfactory/components/C.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/L.py` & `gdsfactory-6.94.0/gdsfactory/components/L.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/__init__.py` & `gdsfactory-6.94.0/gdsfactory/components/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/add_fiducials.py` & `gdsfactory-6.94.0/gdsfactory/components/add_fiducials.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/add_grating_couplers.py` & `gdsfactory-6.94.0/gdsfactory/components/add_grating_couplers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/add_trenches.py` & `gdsfactory-6.94.0/gdsfactory/components/add_trenches.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/align.py` & `gdsfactory-6.94.0/gdsfactory/components/align.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/array_component.py` & `gdsfactory-6.94.0/gdsfactory/components/array_component.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/array_with_fanout.py` & `gdsfactory-6.94.0/gdsfactory/components/array_with_fanout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/array_with_via.py` & `gdsfactory-6.94.0/gdsfactory/components/array_with_via.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/awg.py` & `gdsfactory-6.94.0/gdsfactory/components/awg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/bbox.py` & `gdsfactory-6.94.0/gdsfactory/components/bbox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/bend_circular.py` & `gdsfactory-6.94.0/gdsfactory/components/bend_circular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/bend_circular_heater.py` & `gdsfactory-6.94.0/gdsfactory/components/bend_circular_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/bend_euler.py` & `gdsfactory-6.94.0/gdsfactory/components/bend_euler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/bend_port.py` & `gdsfactory-6.94.0/gdsfactory/components/bend_port.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/bend_s.py` & `gdsfactory-6.94.0/gdsfactory/components/bend_s.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/bezier.py` & `gdsfactory-6.94.0/gdsfactory/components/bezier.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/cavity.py` & `gdsfactory-6.94.0/gdsfactory/components/cavity.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/cdc.py` & `gdsfactory-6.94.0/gdsfactory/components/cdc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/cdsem_all.py` & `gdsfactory-6.94.0/gdsfactory/components/cdsem_all.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/cdsem_bend180.py` & `gdsfactory-6.94.0/gdsfactory/components/cdsem_bend180.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/cdsem_coupler.py` & `gdsfactory-6.94.0/gdsfactory/components/cdsem_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/cdsem_straight.py` & `gdsfactory-6.94.0/gdsfactory/components/cdsem_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/cdsem_straight_density.py` & `gdsfactory-6.94.0/gdsfactory/components/cdsem_straight_density.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/circle.py` & `gdsfactory-6.94.0/gdsfactory/components/circle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/coh_rx_dual_pol.py` & `gdsfactory-6.94.0/gdsfactory/components/coh_rx_dual_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/coh_rx_single_pol.py` & `gdsfactory-6.94.0/gdsfactory/components/coh_rx_single_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/coh_tx_dual_pol.py` & `gdsfactory-6.94.0/gdsfactory/components/coh_tx_dual_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/coh_tx_single_pol.py` & `gdsfactory-6.94.0/gdsfactory/components/coh_tx_single_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/compass.py` & `gdsfactory-6.94.0/gdsfactory/components/compass.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/component_lattice.py` & `gdsfactory-6.94.0/gdsfactory/components/component_lattice.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 from __future__ import annotations
 
 import itertools
-from typing import Dict, List, Tuple
+from typing import Optional, Dict, List, Tuple
 
 from numpy import float64
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.coupler import coupler
 from gdsfactory.components.crossing_waveguide import compensation_path, crossing45
@@ -133,15 +133,15 @@
 def component_lattice(
     lattice: str = """
         C-X
         CXX
         CXX
         C-X
         """,
-    symbol_to_component: Dict[str, Component] = None,
+    symbol_to_component: Optional[Dict[str, Component]] = None,
     grid_per_unit: int = 1000,
 ) -> Component:
     """Return a lattice Component of N inputs and outputs Columns must have.
 
     components with the same x spacing between input/output ports Lines must
     have components with the same y spacing between input/output ports.
```

### Comparing `gdsfactory-6.93.1/gdsfactory/components/component_sequence.py` & `gdsfactory-6.94.0/gdsfactory/components/component_sequence.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/copy_layers.py` & `gdsfactory-6.94.0/gdsfactory/components/copy_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/coupler.py` & `gdsfactory-6.94.0/gdsfactory/components/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/coupler90.py` & `gdsfactory-6.94.0/gdsfactory/components/coupler90.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/coupler90bend.py` & `gdsfactory-6.94.0/gdsfactory/components/coupler90bend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/coupler_adiabatic.py` & `gdsfactory-6.94.0/gdsfactory/components/coupler_adiabatic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/coupler_asymmetric.py` & `gdsfactory-6.94.0/gdsfactory/components/coupler_asymmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/coupler_full.py` & `gdsfactory-6.94.0/gdsfactory/components/coupler_full.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/coupler_ring.py` & `gdsfactory-6.94.0/gdsfactory/components/coupler_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/coupler_straight.py` & `gdsfactory-6.94.0/gdsfactory/components/coupler_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/coupler_straight_asymmetric.py` & `gdsfactory-6.94.0/gdsfactory/components/coupler_straight_asymmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/coupler_symmetric.py` & `gdsfactory-6.94.0/gdsfactory/components/coupler_symmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/cross.py` & `gdsfactory-6.94.0/gdsfactory/components/cross.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/crossing_waveguide.py` & `gdsfactory-6.94.0/gdsfactory/components/crossing_waveguide.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv` & `gdsfactory-6.94.0/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv` & `gdsfactory-6.94.0/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv` & `gdsfactory-6.94.0/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv` & `gdsfactory-6.94.0/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv` & `gdsfactory-6.94.0/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv` & `gdsfactory-6.94.0/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv` & `gdsfactory-6.94.0/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/cutback_2x2.py` & `gdsfactory-6.94.0/gdsfactory/components/cutback_2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/cutback_bend.py` & `gdsfactory-6.94.0/gdsfactory/components/cutback_bend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/cutback_component.py` & `gdsfactory-6.94.0/gdsfactory/components/cutback_component.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/cutback_splitter.py` & `gdsfactory-6.94.0/gdsfactory/components/cutback_splitter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/dbr.py` & `gdsfactory-6.94.0/gdsfactory/components/dbr.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/dbr_tapered.py` & `gdsfactory-6.94.0/gdsfactory/components/dbr_tapered.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/delay_snake.py` & `gdsfactory-6.94.0/gdsfactory/components/delay_snake.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/delay_snake2.py` & `gdsfactory-6.94.0/gdsfactory/components/delay_snake2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/delay_snake3.py` & `gdsfactory-6.94.0/gdsfactory/components/delay_snake3.py`

 * *Files 1% similar despite different names*

```diff
@@ -87,15 +87,15 @@
     sequence = "_)" + n // 2 * "-(-)"
     sequence = f"{sequence[:-1]}."
     return gf.components.component_sequence(
         sequence=sequence, symbol_to_component=symbol_to_component
     )
 
 
-def test_length_delay_snake3():
+def test_length_delay_snake3() -> None:
     import numpy as np
 
     length = 200.0
     c = delay_snake3(n=2, length=length, length0=50, cross_section="strip_no_pins")
     length_computed = c.area() / 0.5
     np.isclose(length, length_computed)
```

### Comparing `gdsfactory-6.93.1/gdsfactory/components/delay_snake_sbend.py` & `gdsfactory-6.94.0/gdsfactory/components/delay_snake_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/dicing_lane.py` & `gdsfactory-6.94.0/gdsfactory/components/dicing_lane.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/die.py` & `gdsfactory-6.94.0/gdsfactory/components/die.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/die_bbox.py` & `gdsfactory-6.94.0/gdsfactory/components/die_bbox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/die_bbox_frame.py` & `gdsfactory-6.94.0/gdsfactory/components/die_bbox_frame.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/disk.py` & `gdsfactory-6.94.0/gdsfactory/components/disk.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/edge_coupler_array.py` & `gdsfactory-6.94.0/gdsfactory/components/edge_coupler_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ellipse.py` & `gdsfactory-6.94.0/gdsfactory/components/ellipse.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/extend_ports_list.py` & `gdsfactory-6.94.0/gdsfactory/components/extend_ports_list.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/extension.py` & `gdsfactory-6.94.0/gdsfactory/components/extension.py`

 * *Files 1% similar despite different names*

```diff
@@ -139,15 +139,17 @@
 
     ports_to_extend = cref.get_ports_list(port_type=port_type, **kwargs)
     ports_to_extend_names = [p.name for p in ports_to_extend]
     ports_to_extend_names = port_names or ports_to_extend_names
 
     for port_name in ports_to_extend_names:
         if port_name not in port_names_all:
-            warnings.warn(f"Port Name {port_name!r} not in {port_names_all}")
+            warnings.warn(
+                f"Port Name {port_name!r} not in {port_names_all}", stacklevel=3
+            )
 
     for port in ports_all:
         port_name = port.name
         port = cref.ports[port_name]
 
         if port_name in ports_to_extend_names:
             if extension:
```

### Comparing `gdsfactory-6.93.1/gdsfactory/components/fiber.py` & `gdsfactory-6.94.0/gdsfactory/components/fiber.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/fiber_array.py` & `gdsfactory-6.94.0/gdsfactory/components/fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/fiducial_squares.py` & `gdsfactory-6.94.0/gdsfactory/components/fiducial_squares.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ge_detector_straight_si_contacts.py` & `gdsfactory-6.94.0/gdsfactory/components/ge_detector_straight_si_contacts.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/grating_coupler_array.py` & `gdsfactory-6.94.0/gdsfactory/components/grating_coupler_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/grating_coupler_dual_pol.py` & `gdsfactory-6.94.0/gdsfactory/components/grating_coupler_dual_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/grating_coupler_elliptical.py` & `gdsfactory-6.94.0/gdsfactory/components/grating_coupler_elliptical.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/grating_coupler_elliptical_arbitrary.py` & `gdsfactory-6.94.0/gdsfactory/components/grating_coupler_elliptical_arbitrary.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/grating_coupler_elliptical_lumerical.py` & `gdsfactory-6.94.0/gdsfactory/components/grating_coupler_elliptical_lumerical.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/grating_coupler_elliptical_trenches.py` & `gdsfactory-6.94.0/gdsfactory/components/grating_coupler_elliptical_trenches.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/grating_coupler_functions.py` & `gdsfactory-6.94.0/gdsfactory/components/grating_coupler_functions.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/grating_coupler_loss.py` & `gdsfactory-6.94.0/gdsfactory/components/grating_coupler_loss.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/grating_coupler_loss_fiber_single.py` & `gdsfactory-6.94.0/gdsfactory/components/grating_coupler_loss_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/grating_coupler_rectangular.py` & `gdsfactory-6.94.0/gdsfactory/components/grating_coupler_rectangular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/grating_coupler_rectangular_arbitrary.py` & `gdsfactory-6.94.0/gdsfactory/components/grating_coupler_rectangular_arbitrary.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py` & `gdsfactory-6.94.0/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/grating_coupler_tree.py` & `gdsfactory-6.94.0/gdsfactory/components/grating_coupler_tree.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/greek_cross.py` & `gdsfactory-6.94.0/gdsfactory/components/greek_cross.py`

 * *Files 1% similar despite different names*

```diff
@@ -7,25 +7,26 @@
 from gdsfactory.components.cross import cross
 from gdsfactory.components.pad import pad
 from gdsfactory.components.rectangle import rectangle
 from gdsfactory.components.via_stack import via_stack
 from gdsfactory.typings import LayerSpecs, ComponentSpec, Floats, CrossSectionSpec
 from gdsfactory.components.via_stack import via_stack_npp_m1, via_stack_m1_m3
 from gdsfactory.cross_section import metal1
+from typing import Optional
 
 
 @gf.cell
 def greek_cross(
     length: float = 30,
     layers: LayerSpecs = (
         "WG",
         "N",
     ),
     widths: Floats = (2.0, 3.0),
-    offsets: Floats = None,
+    offsets: Optional[Floats] = None,
     via_stack: ComponentSpec = via_stack_npp_m1,
 ) -> gf.Component:
     """Simple greek cross with via stacks at the endpoints.
 
     A greek cross is a process control monitor for dopant sheet resistivity and linewidth variation.
 
     Args:
```

### Comparing `gdsfactory-6.93.1/gdsfactory/components/hline.py` & `gdsfactory-6.94.0/gdsfactory/components/hline.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/interdigital_capacitor.py` & `gdsfactory-6.94.0/gdsfactory/components/interdigital_capacitor.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/litho_calipers.py` & `gdsfactory-6.94.0/gdsfactory/components/litho_calipers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/litho_ruler.py` & `gdsfactory-6.94.0/gdsfactory/components/litho_ruler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/litho_steps.py` & `gdsfactory-6.94.0/gdsfactory/components/litho_steps.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/logo.py` & `gdsfactory-6.94.0/gdsfactory/components/logo.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/loop_mirror.py` & `gdsfactory-6.94.0/gdsfactory/components/loop_mirror.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/mmi1x2.py` & `gdsfactory-6.94.0/gdsfactory/components/mmi1x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/mmi1x2_with_sbend.py` & `gdsfactory-6.94.0/gdsfactory/components/mmi1x2_with_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/mmi2x2.py` & `gdsfactory-6.94.0/gdsfactory/components/mmi2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/mmi2x2_with_sbend.py` & `gdsfactory-6.94.0/gdsfactory/components/mmi2x2_with_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/mmi_90degree_hybrid.py` & `gdsfactory-6.94.0/gdsfactory/components/mmi_90degree_hybrid.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/mode_converter.py` & `gdsfactory-6.94.0/gdsfactory/components/mode_converter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/mzi.py` & `gdsfactory-6.94.0/gdsfactory/components/mzi.py`

 * *Files 0% similar despite different names*

```diff
@@ -218,20 +218,20 @@
     mzi2x2_2x2,
     splitter=coupler,
     combiner=coupler,
 )
 
 
 if __name__ == "__main__":
-    c = mzi(cross_section="nitride")
+    c = mzi(cross_section="strip")
     # c = gf.components.mzi2x2_2x2(straight_x_top="straight_heater_metal")
     # c.show(show_ports=True)
 
     # c = gf.components.mzi2x2_2x2(straight_x_top="straight_heater_metal")
-    # c2 = gf.routing.add_fiber_array(c)
+    c = gf.routing.add_fiber_array(c)
     c.show()
 
     # c1.write_gds("a.gds")
 
     # c2 = gf.read.import_gds("a.gds")
     # c2 = c2.flatten()
```

### Comparing `gdsfactory-6.93.1/gdsfactory/components/mzi_arm.py` & `gdsfactory-6.94.0/gdsfactory/components/mzi_arm.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/mzi_arms.py` & `gdsfactory-6.94.0/gdsfactory/components/mzi_arms.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/mzi_lattice.py` & `gdsfactory-6.94.0/gdsfactory/components/mzi_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/mzi_pads_center.py` & `gdsfactory-6.94.0/gdsfactory/components/mzi_pads_center.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/mzi_phase_shifter.py` & `gdsfactory-6.94.0/gdsfactory/components/mzi_phase_shifter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/mzit.py` & `gdsfactory-6.94.0/gdsfactory/components/mzit.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/mzit_lattice.py` & `gdsfactory-6.94.0/gdsfactory/components/mzit_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/mzm.py` & `gdsfactory-6.94.0/gdsfactory/components/mzm.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/nxn.py` & `gdsfactory-6.94.0/gdsfactory/components/nxn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/optimal_90deg.py` & `gdsfactory-6.94.0/gdsfactory/components/optimal_90deg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/optimal_hairpin.py` & `gdsfactory-6.94.0/gdsfactory/components/optimal_hairpin.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/optimal_step.py` & `gdsfactory-6.94.0/gdsfactory/components/optimal_step.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/pack_doe.py` & `gdsfactory-6.94.0/gdsfactory/components/pack_doe.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/pad.py` & `gdsfactory-6.94.0/gdsfactory/components/pad.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/pad_gsg.py` & `gdsfactory-6.94.0/gdsfactory/components/pad_gsg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/pads_shorted.py` & `gdsfactory-6.94.0/gdsfactory/components/pads_shorted.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/polarization_splitter_rotator.py` & `gdsfactory-6.94.0/gdsfactory/components/polarization_splitter_rotator.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ramp.py` & `gdsfactory-6.94.0/gdsfactory/components/ramp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/rectangle.py` & `gdsfactory-6.94.0/gdsfactory/components/rectangle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/rectangle_with_slits.py` & `gdsfactory-6.94.0/gdsfactory/components/rectangle_with_slits.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/regular_polygon.py` & `gdsfactory-6.94.0/gdsfactory/components/regular_polygon.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/resistance_meander.py` & `gdsfactory-6.94.0/gdsfactory/components/resistance_meander.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/resistance_sheet.py` & `gdsfactory-6.94.0/gdsfactory/components/resistance_sheet.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ring.py` & `gdsfactory-6.94.0/gdsfactory/components/ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ring_crow.py` & `gdsfactory-6.94.0/gdsfactory/components/ring_crow.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ring_crow_couplers.py` & `gdsfactory-6.94.0/gdsfactory/components/ring_crow_couplers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ring_double.py` & `gdsfactory-6.94.0/gdsfactory/components/ring_double.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ring_double_heater.py` & `gdsfactory-6.94.0/gdsfactory/components/ring_double_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ring_double_pn.py` & `gdsfactory-6.94.0/gdsfactory/components/ring_double_pn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ring_section_based.py` & `gdsfactory-6.94.0/gdsfactory/components/ring_section_based.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ring_single.py` & `gdsfactory-6.94.0/gdsfactory/components/ring_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ring_single_array.py` & `gdsfactory-6.94.0/gdsfactory/components/ring_single_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ring_single_bend_coupler.py` & `gdsfactory-6.94.0/gdsfactory/components/ring_single_bend_coupler.py`

 * *Files 20% similar despite different names*

```diff
@@ -83,106 +83,126 @@
 
 
 @gf.cell
 def coupler_ring_bend(
     radius: float = 10.0,
     coupler_gap: float = 0.2,
     coupling_angle_coverage: float = 90.0,
+    length_x: float = 0.0,
     cross_section_inner: CrossSectionSpec = "strip",
     cross_section_outer: CrossSectionSpec = "strip",
     bend: ComponentSpec = bend_circular,
 ) -> Component:
     r"""Two back-to-back coupler_bend.
 
     Args:
         radius: um.
         gap: um.
         angle_inner: of the inner bend, from beginning to end. Depending on the bend chosen, gap may not be preserved.
         angle_outer: of the outer bend, from beginning to end. Depending on the bend chosen, gap may not be preserved.
         bend: for bend.
+        length_x: horizontal straight length.
         cross_section_inner: spec inner bend.
         cross_section_outer: spec outer bend.
         kwargs:
     """
     c = Component()
     cp = coupler_bend(
         radius=radius,
         coupler_gap=coupler_gap,
         coupling_angle_coverage=coupling_angle_coverage,
         cross_section_inner=cross_section_inner,
         cross_section_outer=cross_section_outer,
         bend=bend,
     )
+    sin = gf.get_component(straight, length=length_x, cross_section=cross_section_inner)
+    sout = gf.get_component(
+        straight, length=length_x, cross_section=cross_section_outer
+    )
 
     coupler_right = c << cp
     coupler_left = c << cp.mirror()
-
-    coupler_left.connect("o1", coupler_right.ports["o1"])
+    straight_inner = c << sin
+    straight_inner.movex(-length_x / 2)
+    straight_outer = c << sout
+    straight_outer.movex(-length_x / 2)
+
+    coupler_left.connect("o1", straight_outer.ports["o1"])
+    straight_inner.connect("o1", coupler_left.ports["o2"])
+    coupler_right.connect("o2", straight_inner.ports["o2"])
+    straight_outer.connect("o2", coupler_right.ports["o1"])
 
     c.absorb(coupler_right)
     c.absorb(coupler_left)
+    c.absorb(straight_inner)
+    c.absorb(straight_outer)
 
     c.add_port("o1", port=coupler_left.ports["o3"])
     c.add_port("o2", port=coupler_left.ports["o4"])
     c.add_port("o4", port=coupler_right.ports["o3"])
     c.add_port("o3", port=coupler_right.ports["o4"])
     return c
 
 
 @gf.cell
 def ring_single_bend_coupler(
     radius: float = 5.0,
     gap: float = 0.2,
     coupling_angle_coverage: float = 180.0,
     bend: ComponentSpec = bend_circular,
+    length_x: float = 0.6,
     length_y: float = 0.6,
     cross_section_inner: CrossSectionSpec = "strip",
     cross_section_outer: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     r"""Returns ring with curved coupler.
 
-    TODO: enable euler bends. add length_x option.
+    TODO: enable euler bends.
 
     Args:
         radius: um.
         gap: um.
         angle_inner: of the inner bend, from beginning to end. Depending on the bend chosen, gap may not be preserved.
         angle_outer: of the outer bend, from beginning to end. Depending on the bend chosen, gap may not be preserved.
         bend: for bend.
+        length_x: horizontal straight length.
         length_y: vertical straight length.
         cross_section_inner: spec inner bend.
         cross_section_outer: spec outer bend.
         kwargs: cross_section settings.
     """
     c = Component()
-    length_x = 0
 
     cb = c << coupler_ring_bend(
         radius=radius,
         coupler_gap=gap,
         coupling_angle_coverage=coupling_angle_coverage,
+        length_x=length_x,
         cross_section_inner=cross_section_inner,
         cross_section_outer=cross_section_outer,
         bend=bend,
     )
 
-    cross_section = cross_section_outer
-    sy = straight(length=length_y, cross_section=cross_section, **kwargs)
+    cross_section = cross_section_inner
+    sx = gf.get_component(
+        straight, length=length_x, cross_section=cross_section, **kwargs
+    )
+    sy = gf.get_component(
+        straight, length=length_y, cross_section=cross_section, **kwargs
+    )
     b = gf.get_component(bend, cross_section=cross_section, radius=radius, **kwargs)
-    sx = straight(length=length_x, cross_section=cross_section, **kwargs)
     sl = c << sy
     sr = c << sy
     bl = c << b
     br = c << b
     st = c << sx
 
     sl.connect(port="o1", destination=cb.ports["o2"])
     bl.connect(port="o2", destination=sl.ports["o2"])
-
     st.connect(port="o2", destination=bl.ports["o1"])
     br.connect(port="o2", destination=st.ports["o1"])
     sr.connect(port="o1", destination=br.ports["o1"])
     sr.connect(port="o2", destination=cb.ports["o3"])
 
     c.add_port("o2", port=cb.ports["o4"])
     c.add_port("o1", port=cb.ports["o1"])
```

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ring_single_dut.py` & `gdsfactory-6.94.0/gdsfactory/components/ring_single_dut.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ring_single_heater.py` & `gdsfactory-6.94.0/gdsfactory/components/ring_single_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/ring_single_pn.py` & `gdsfactory-6.94.0/gdsfactory/components/ring_single_pn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/seal_ring.py` & `gdsfactory-6.94.0/gdsfactory/components/seal_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/snspd.py` & `gdsfactory-6.94.0/gdsfactory/components/snspd.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/spiral_double.py` & `gdsfactory-6.94.0/gdsfactory/components/spiral_double.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/spiral_external_io.py` & `gdsfactory-6.94.0/gdsfactory/components/spiral_external_io.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/spiral_heater.py` & `gdsfactory-6.94.0/gdsfactory/components/spiral_heater.py`

 * *Files 1% similar despite different names*

```diff
@@ -8,29 +8,29 @@
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.bend_s import bend_s, get_min_sbend_size
 from gdsfactory.components.straight import straight
 from gdsfactory.typings import (
     ComponentFactory,
     CrossSectionSpec,
     Floats,
-    Optional,
 )
 from gdsfactory.routing.get_route import get_route
+from typing import Optional
 
 
 @gf.cell
 def spiral_racetrack(
     min_radius: float = 5,
     straight_length: float = 10.0,
     spacings: Floats = (2, 2, 3, 3, 2, 2),
     straight_factory: ComponentFactory = straight,
     bend_factory: ComponentFactory = bend_euler,
     bend_s_factory: ComponentFactory = bend_s,
     cross_section: CrossSectionSpec = "strip",
-    cross_section_s: CrossSectionSpec = None,
+    cross_section_s: Optional[CrossSectionSpec] = None,
     n_bend_points: Optional[int] = None,
     with_inner_ports: bool = False,
     extra_90_deg_bend: bool = False,
 ) -> Component:
     """Returns Racetrack-Spiral.
 
     Args:
@@ -122,15 +122,15 @@
     n_straight_sections: int = 8,
     min_radius: float = 5,
     min_spacing: float = 5.0,
     straight_factory: ComponentFactory = straight,
     bend_factory: ComponentFactory = bend_euler,
     bend_s_factory: ComponentFactory = bend_s,
     cross_section: CrossSectionSpec = "strip",
-    cross_section_s: CrossSectionSpec = None,
+    cross_section_s: Optional[CrossSectionSpec] = None,
     n_bend_points: Optional[int] = None,
     with_inner_ports: bool = False,
 ) -> Component:
     """Returns Racetrack-Spiral with a specified total length.
 
     The input and output ports are aligned in y. This class is meant to
     be used for generating interferometers with long waveguide lengths, where
```

### Comparing `gdsfactory-6.93.1/gdsfactory/components/spiral_inner_io.py` & `gdsfactory-6.94.0/gdsfactory/components/spiral_inner_io.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/splitter_chain.py` & `gdsfactory-6.94.0/gdsfactory/components/splitter_chain.py`

 * *Files 2% similar despite different names*

```diff
@@ -58,8 +58,7 @@
     return c
 
 
 if __name__ == "__main__":
     # component = splitter_chain(splitter=gf.components.mmi1x2, columns=4)
     component = splitter_chain()
     component.show()
-    component.pprint
```

### Comparing `gdsfactory-6.93.1/gdsfactory/components/splitter_tree.py` & `gdsfactory-6.94.0/gdsfactory/components/splitter_tree.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/straight.py` & `gdsfactory-6.94.0/gdsfactory/components/straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/straight_array.py` & `gdsfactory-6.94.0/gdsfactory/components/straight_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/straight_heater_doped_rib.py` & `gdsfactory-6.94.0/gdsfactory/components/straight_heater_doped_rib.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/straight_heater_doped_strip.py` & `gdsfactory-6.94.0/gdsfactory/components/straight_heater_doped_strip.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/straight_heater_meander.py` & `gdsfactory-6.94.0/gdsfactory/components/straight_heater_meander.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/straight_heater_meander_doped.py` & `gdsfactory-6.94.0/gdsfactory/components/straight_heater_meander_doped.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/straight_heater_metal.py` & `gdsfactory-6.94.0/gdsfactory/components/straight_heater_metal.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/straight_pin.py` & `gdsfactory-6.94.0/gdsfactory/components/straight_pin.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/straight_pin_slot.py` & `gdsfactory-6.94.0/gdsfactory/components/straight_pin_slot.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/straight_rib.py` & `gdsfactory-6.94.0/gdsfactory/components/straight_rib.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/switch_tree.py` & `gdsfactory-6.94.0/gdsfactory/components/switch_tree.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/taper.py` & `gdsfactory-6.94.0/gdsfactory/components/taper.py`

 * *Files 2% similar despite different names*

```diff
@@ -254,29 +254,29 @@
     width2=0.15,
     w_slab1=0.15,
     w_slab2=1.0,
 )
 
 
 if __name__ == "__main__":
-    c = gf.grid(
-        [
-            taper_sc_nc(
-                length=length, info=dict(doe="taper_length", taper_length=length)
-            )
-            for length in [1, 2, 3]
-        ]
-    )
-    c.write_gds_with_metadata("extra/tapers.gds")
+    # c = gf.grid(
+    #     [
+    #         taper_sc_nc(
+    #             length=length, info=dict(doe="taper_length", taper_length=length)
+    #         )
+    #         for length in [1, 2, 3]
+    #     ]
+    # )
+    # c.write_gds_with_metadata("extra/tapers.gds")
 
-    # c = taper(width2=1)
+    c = taper(width2=1)
     # c = taper_strip_to_ridge()
     # print(c.get_optical_ports())
     # c = taper_strip_to_ridge_trenches()
     # c = taper()
     # c = gf.components.taper_strip_to_ridge(width1=1, width2=2)
     # c = gf.components.taper_strip_to_ridge(width1=1, width2=2)
     # c = gf.components.extend_ports(c)
     # c = taper_strip_to_ridge_trenches()
     # c = taper()
     # c = taper_sc_nc()
-    c.show(show_ports=True)
+    c.show(show_ports=False)
```

### Comparing `gdsfactory-6.93.1/gdsfactory/components/taper_adiabatic.py` & `gdsfactory-6.94.0/gdsfactory/components/taper_adiabatic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/taper_cross_section.py` & `gdsfactory-6.94.0/gdsfactory/components/taper_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/taper_from_csv.py` & `gdsfactory-6.94.0/gdsfactory/components/taper_from_csv.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/taper_parabolic.py` & `gdsfactory-6.94.0/gdsfactory/components/taper_parabolic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/terminator.py` & `gdsfactory-6.94.0/gdsfactory/components/terminator.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/text.py` & `gdsfactory-6.94.0/gdsfactory/components/text.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/text_freetype.py` & `gdsfactory-6.94.0/gdsfactory/components/text_freetype.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/text_rectangular.py` & `gdsfactory-6.94.0/gdsfactory/components/text_rectangular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/text_rectangular_font.py` & `gdsfactory-6.94.0/gdsfactory/components/text_rectangular_font.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/triangles.py` & `gdsfactory-6.94.0/gdsfactory/components/triangles.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/verniers.py` & `gdsfactory-6.94.0/gdsfactory/components/verniers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/version_stamp.py` & `gdsfactory-6.94.0/gdsfactory/components/version_stamp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/via.py` & `gdsfactory-6.94.0/gdsfactory/components/via.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/via_corner.py` & `gdsfactory-6.94.0/gdsfactory/components/via_corner.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/via_cutback.py` & `gdsfactory-6.94.0/gdsfactory/components/via_cutback.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/via_stack.py` & `gdsfactory-6.94.0/gdsfactory/components/via_stack.py`

 * *Files 1% similar despite different names*

```diff
@@ -14,15 +14,15 @@
 
 @gf.cell
 def via_stack(
     size=(11.0, 11.0),
     layers: LayerSpecs = ("M1", "M2", "M3"),
     layer_offsets: Optional[Floats] = None,
     vias: Optional[Tuple[Optional[ComponentSpec], ...]] = (via1, via2, None),
-    layer_port: LayerSpec = None,
+    layer_port: Optional[LayerSpec] = None,
     correct_size: bool = True,
 ) -> Component:
     """Rectangular via array stack.
 
     You can use it to connect different metal layers or metals to silicon.
     You can use the naming convention via_stack_layerSource_layerDestination
     contains 4 ports (e1, e2, e3, e4)
@@ -133,15 +133,15 @@
 def via_stack_circular(
     radius: float = 10.0,
     angular_extent: float = 45,
     center_angle: float = 0,
     width: float = 5.0,
     layers: LayerSpecs = ("M1", "M2", "M3"),
     vias: Tuple[Optional[ComponentSpec], ...] = (via1, via2),
-    layer_port: LayerSpec = None,
+    layer_port: Optional[LayerSpec] = None,
 ) -> Component:
     """Circular via array stack.
 
     FIXME! does not work.
 
     Constructs a circular via array stack. It does so
     by stacking rectangular via stacks offset by a small amount
@@ -278,15 +278,15 @@
     size: Float2 = (1.2, 1.2),
     layers: LayerSpecs = ("M1", "M2", "M3"),
     layer_offsets: Optional[Tuple[float, ...]] = None,
     vias: Optional[Tuple[Optional[ComponentSpec], ...]] = (via1, via2),
     via_min_size: Tuple[Float2, ...] = ((0.2, 0.2), (0.2, 0.2)),
     via_min_gap: Tuple[Float2, ...] = ((0.1, 0.1), (0.1, 0.1)),
     via_min_enclosure: Float2 = (0.15, 0.25),
-    layer_port: LayerSpec = None,
+    layer_port: Optional[LayerSpec] = None,
 ) -> Component:
     """Rectangular via array stack, with optimized dimension for vias.
 
     Uses inclusion, minimum width, and minimum spacing rules to place the maximum number of individual vias,
     each with maximum via area.
 
     Args:
@@ -392,15 +392,15 @@
         size=via_size,
         gap=min_via_gap,
         spacing=None,
         enclosure=min_via_enclosure,
     )
 
 
-def test_via_stack_from_rules():
+def test_via_stack_from_rules() -> None:
     # Check that vias are generated with larger than min dimensions if possible
     size = (1.2, 1.2)
     layers = ("M1", "M2", "M3")
     vias = (via1, via2)
     via_min_size = ((0.2, 0.2), (0.2, 0.2))
     via_min_gap = ((0.1, 0.1), (0.15, 0.15))
     via_min_enclosure = (0.1, 0.1)
```

### Comparing `gdsfactory-6.93.1/gdsfactory/components/via_stack_slot.py` & `gdsfactory-6.94.0/gdsfactory/components/via_stack_slot.py`

 * *Files 2% similar despite different names*

```diff
@@ -15,15 +15,15 @@
 @gf.cell
 def via_stack_slot(
     size=(11.0, 11.0),
     layers: LayerSpecs = ("M1", "M2"),
     layer_offsets: Optional[Floats] = (0, 1.0),
     layer_offsetsx: Optional[Floats] = None,
     layer_offsetsy: Optional[Floats] = None,
-    layer_port: LayerSpec = None,
+    layer_port: Optional[LayerSpec] = None,
     via: ComponentSpec = via1,
     enclosure: float = 1.0,
     ysize: float = 0.5,
     yspacing: float = 2.0,
 ) -> Component:
     """Rectangular via_stack with slotted via in X direction.
```

### Comparing `gdsfactory-6.93.1/gdsfactory/components/via_stack_with_offset.py` & `gdsfactory-6.94.0/gdsfactory/components/via_stack_with_offset.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/wafer.py` & `gdsfactory-6.94.0/gdsfactory/components/wafer.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/wire.py` & `gdsfactory-6.94.0/gdsfactory/components/wire.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/components/wire_sbend.py` & `gdsfactory-6.94.0/gdsfactory/components/wire_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/config.py` & `gdsfactory-6.94.0/gdsfactory/config.py`

 * *Files 2% similar despite different names*

```diff
@@ -30,15 +30,15 @@
 from loguru import logger
 import omegaconf
 from omegaconf import OmegaConf
 
 from rich.console import Console
 from rich.table import Table
 
-__version__ = "6.93.1"
+__version__ = "6.94.0"
 PathType = Union[str, pathlib.Path]
 
 home = pathlib.Path.home()
 cwd = pathlib.Path.cwd()
 module_path = pathlib.Path(__file__).parent.absolute()
 repo_path = module_path.parent
 home_path = pathlib.Path.home() / ".gdsfactory"
@@ -54,32 +54,33 @@
 
 logger.remove()
 logger.add(sink=sys.stderr, level="WARNING")
 
 showwarning_ = warnings.showwarning
 
 
-def showwarning(message, *args, **kwargs):
+def showwarning(message, *args, **kwargs) -> None:
     logger.warning(message)
     showwarning_(message, *args, **kwargs)
 
 
 warnings.showwarning = showwarning
 
 plugins = ["ray", "femwell", "devsim", "tidy3d", "meep", "meow", "lumapi", "sax"]
 pdks = ["gf45", "tj", "imec", "amf", "sky130", "ubcpdk", "aim", "ct"]
 
 
-def print_version():
+def print_version() -> None:
     """Print gdsfactory plugin versions and paths."""
     table = Table(title="Modules")
     table.add_column("Package", justify="right", style="cyan", no_wrap=True)
     table.add_column("version", style="magenta")
     table.add_column("Path", justify="right", style="green")
 
+    table.add_row("python", sys.version, str(sys.executable))
     table.add_row("gdsfactory", __version__, str(module_path))
 
     for plugin in plugins:
         try:
             m = importlib.import_module(plugin)
             try:
                 table.add_row(plugin, str(m.__version__), str(m.__path__))
@@ -88,30 +89,31 @@
         except ImportError:
             table.add_row(plugin, "not installed", "")
 
     console = Console()
     console.print(table)
 
 
-def print_version_raw():
+def print_version_raw() -> None:
     """Print gdsfactory plugin versions and paths."""
+    print("python", sys.version)
     print("gdsfactory", __version__)
 
     for plugin in plugins:
         try:
             m = importlib.import_module(plugin)
             try:
                 print(plugin, m.__version__)
             except AttributeError:
                 print(plugin)
         except ImportError:
             print(plugin, "not installed", "")
 
 
-def print_version_pdks():
+def print_version_pdks() -> None:
     """Print gdsfactory PDK versions and paths."""
     table = Table(title="PDKs")
     table.add_column("Package", justify="right", style="cyan", no_wrap=True)
     table.add_column("version", style="magenta")
     table.add_column("Path", justify="right", style="green")
 
     for pdk in pdks:
@@ -272,11 +274,11 @@
         zoom_factor=zoom_factor,
     )
 
 
 if __name__ == "__main__":
     # print(PATH.sparameters)
     # print_config()
-    # print_version()
-    print_version_raw()
+    print_version()
+    # print_version_raw()
     # print_version_pdks()
     # write_tech("tech.json")
```

### Comparing `gdsfactory-6.93.1/gdsfactory/constants.py` & `gdsfactory-6.94.0/gdsfactory/constants.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/containers.py` & `gdsfactory-6.94.0/gdsfactory/containers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/cross_section.py` & `gdsfactory-6.94.0/gdsfactory/cross_section.py`

 * *Files 0% similar despite different names*

```diff
@@ -11,14 +11,15 @@
 from collections.abc import Iterable
 from functools import partial
 from inspect import getmembers
 from typing import Any, Callable, Dict, List, Optional, Tuple, Union, TypeVar
 
 from pydantic import BaseModel, Field, validate_arguments
 from typing_extensions import Literal
+from gdsfactory.add_pins import add_pins_inside1nm, add_pins_siepic_optical
 
 nm = 1e-3
 
 Layer = Tuple[int, int]
 Layers = Tuple[Layer, ...]
 WidthTypes = Literal["sine", "linear", "parabolic"]
 
@@ -480,18 +481,21 @@
 
 
 radius_nitride = 20
 radius_rib = 20
 
 
 strip = cross_section
+strip_pins = partial(cross_section, add_pins=add_pins_inside1nm, name="strip")
+# strip = strip_pins
 strip_auto_widen = partial(strip, width_wide=0.9, auto_widen=True)
 strip_no_pins = partial(
     strip, add_pins=None, add_bbox=None, cladding_layers=None, cladding_offsets=None
 )
+strip_siepic = partial(cross_section, add_pins=add_pins_siepic_optical)
 
 # Rib with rectangular slab
 rib = partial(strip, bbox_layers=["SLAB90"], bbox_offsets=[3], radius=radius_rib)
 
 # Rib with with slab that follows the waveguide core
 rib_conformal = partial(
     strip,
@@ -774,15 +778,15 @@
     layers_via_stack1: LayerSpecs = ("PPP",),
     layers_via_stack2: LayerSpecs = ("NPP",),
     bbox_offsets_via_stack1: Tuple[float, ...] = (0, -0.2),
     bbox_offsets_via_stack2: Tuple[float, ...] = (0, -0.2),
     via_stack_width: float = 9.0,
     via_stack_gap: float = 0.55,
     slab_gap: float = -0.2,
-    layer_via: LayerSpec = None,
+    layer_via: Optional[LayerSpec] = None,
     via_width: float = 1,
     via_offsets: Optional[Tuple[float, ...]] = None,
     **kwargs,
 ) -> CrossSection:
     """Rib PIN doped cross_section.
 
     Args:
@@ -2092,17 +2096,17 @@
     width_doping: float = 8.0,
     layer_p: LayerSpec = "P",
     layer_pp: LayerSpec = "PP",
     layer_ppp: LayerSpec = "PPP",
     layer_n: LayerSpec = "N",
     layer_np: LayerSpec = "NP",
     layer_npp: LayerSpec = "NPP",
-    layer_via: LayerSpec = None,
+    layer_via: Optional[LayerSpec] = None,
     width_via: float = 1.0,
-    layer_metal: LayerSpec = None,
+    layer_metal: Optional[LayerSpec] = None,
     port_names: Tuple[str, str] = ("o1", "o2"),
     bbox_layers: Optional[List[Layer]] = None,
     bbox_offsets: Optional[List[float]] = None,
     cladding_layers: Optional[Layers] = cladding_layers_optical,
     cladding_offsets: Optional[Floats] = cladding_offsets_optical,
 ) -> CrossSection:
     """Linear Ge detector cross section based on a lateral p(i)n junction.
@@ -2285,15 +2289,15 @@
                         print(f"error in {t[0]}")
     return xs
 
 
 cross_sections = get_cross_section_factories(sys.modules[__name__])
 
 
-def test_copy():
+def test_copy() -> None:
     import gdsfactory as gf
 
     p = gf.path.straight()
     copied_cs = gf.cross_section.strip().copy()
     gf.path.extrude(p, cross_section=copied_cs)
```

### Comparing `gdsfactory-6.93.1/gdsfactory/decorators.py` & `gdsfactory-6.94.0/gdsfactory/decorators.py`

 * *Files 2% similar despite different names*

```diff
@@ -68,15 +68,15 @@
     c = Component()
     b = c << gf.components.bend_circular(angle=30)
     s = c << gf.components.straight(length=5)
     s.connect("o1", b.ports["o2"])
     return c
 
 
-def test_flatten_invalid_refs():
+def test_flatten_invalid_refs() -> None:
     c1 = _demo_non_manhattan()
     assert not has_valid_transformations(c1)
 
     c2 = _demo_non_manhattan(decorator=flatten_invalid_refs)
     assert has_valid_transformations(c2)
```

### Comparing `gdsfactory-6.93.1/gdsfactory/difftest.py` & `gdsfactory-6.94.0/gdsfactory/difftest.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/export/to_3d.py` & `gdsfactory-6.94.0/gdsfactory/export/to_3d.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/export/to_np.py` & `gdsfactory-6.94.0/gdsfactory/export/to_np.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/export/to_stl.py` & `gdsfactory-6.94.0/gdsfactory/export/to_stl.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/export/write_gerbers.py` & `gdsfactory-6.94.0/gdsfactory/export/write_gerbers.py`

 * *Files 1% similar despite different names*

```diff
@@ -33,15 +33,15 @@
     size: Optional[tuple] = (None,)
     n_layers: int = (2,)
 
 
 resolutions = {1e-3: 3, 1e-4: 4, 1e-5: 5, 1e-6: 6}
 
 
-def number(n):
+def number(n) -> str:
     i = int(round(n * 10000))
     return "%07d" % i
 
 
 def points(pp: list):
     out = ""
     d = "D02"
```

### Comparing `gdsfactory-6.93.1/gdsfactory/filestorage.py` & `gdsfactory-6.94.0/gdsfactory/filestorage.py`

 * *Files 2% similar despite different names*

```diff
@@ -20,15 +20,15 @@
 
     def write(self, filename: str, data):
         raise NotImplementedError("need to implement")
 
     def read(self, filename: str) -> np.ndarray:
         raise NotImplementedError("need to implement")
 
-    def _write_local_cache(self, filename: str, data):
+    def _write_local_cache(self, filename: str, data) -> None:
         if not self.dirpath:
             return
         filepath = self.dirpath / f"{self.filetype}/{filename}.npz"
 
         with open(filepath, "wb") as file:
             np.savez_compressed(file, **data)
```

### Comparing `gdsfactory-6.93.1/gdsfactory/fill.py` & `gdsfactory-6.94.0/gdsfactory/fill.py`

 * *Files 1% similar despite different names*

```diff
@@ -152,16 +152,16 @@
 
 
 @cell
 def fill_rectangle(
     component: ComponentOrReference,
     fill_layers: LayerSpecs,
     fill_size=(5.0, 5.0),
-    avoid_layers: LayerSpecs = None,
-    include_layers: LayerSpecs = None,
+    avoid_layers: Optional[LayerSpecs] = None,
+    include_layers: Optional[LayerSpecs] = None,
     margin: float = 5.0,
     fill_densities: Union[float, Floats] = (0.5, 0.25, 0.7),
     fill_inverted: Optional[List[float]] = None,
     bbox: Optional[object] = None,
 ) -> Component:
     """Returns rectangular fill pattern and fills all empty areas.
 
@@ -257,15 +257,15 @@
 
 
 @cell
 def fill_rectangle_custom(
     component: Component,
     fill_cell: ComponentSpec,
     spacing: Tuple[float, float],
-    avoid_layers: LayerSpecs = None,
+    avoid_layers: Optional[LayerSpecs] = None,
     margin: float = 5.0,
     bbox: Optional[object] = None,
 ) -> Component:
     """Returns custom fill pattern to fill all empty areas.
 
     In the input component and returns a component that contains just the fill
     Dummy fill keeps density constant during fabrication.
```

### Comparing `gdsfactory-6.93.1/gdsfactory/font.py` & `gdsfactory-6.94.0/gdsfactory/font.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/functions.py` & `gdsfactory-6.94.0/gdsfactory/functions.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/gdsdiff/gds_diff_git.py` & `gdsfactory-6.94.0/gdsfactory/gdsdiff/gds_diff_git.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/gdsdiff/gdsdiff.py` & `gdsfactory-6.94.0/gdsfactory/gdsdiff/gdsdiff.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/gdsdiff/install.py` & `gdsfactory-6.94.0/gdsfactory/gdsdiff/install.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/gdsdiff/test_xor.py` & `gdsfactory-6.94.0/gdsfactory/gdsdiff/test_xor.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/README.md` & `gdsfactory-6.94.0/gdsfactory/generic_tech/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/__init__.py` & `gdsfactory-6.94.0/gdsfactory/generic_tech/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/get_klayout_pyxs.py` & `gdsfactory-6.94.0/gdsfactory/generic_tech/get_klayout_pyxs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/drc/errors.py` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/drc/errors.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/drc/write_drc.py` & `gdsfactory-6.94.0/gdsfactory/samples/demo/drc_write.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/grain.xml` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/grain.xml`

 * *Files 2% similar despite different names*

#### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/grain.xml` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/grain.xml`

```diff
@@ -1,13 +1,13 @@
 <?xml version="1.0" encoding="utf-8"?>
 <salt-grain>
   <name>gdsfactory</name>
   <token/>
   <hidden>false</hidden>
-  <version>6.93.1</version>
+  <version>6.94.0</version>
   <api-version/>
   <title>gdsfactory</title>
   <doc>EDA tool to layout integrated circuits</doc>
   <doc-url>https://gdsfactory.github.io/gdsfactory/</doc-url>
   <url>https://github.com/gdsfactory/gdsfactory</url>
   <license>MIT</license>
   <author>Joaquin Matres</author>
```

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/icon_128x128.png` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/icon_128x128.png`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/icon_64x64.png` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/icon_64x64.png`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/README.md` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/README.md`

 * *Files 1% similar despite different names*

```diff
@@ -26,15 +26,15 @@
     run_lvs.py (--help| -h)
     run_lvs.py (--layout=<layout_path>) (--netlist=<netlist_path>) [--thr=<thr>] [--run_dir=<run_dir_path>] [--topcell=<topcell_name>] [--run_mode=<run_mode>] [--verbose] [--lvs_sub=<sub_name>] [--no_net_names] [--spice_comments] [--scale] [--schematic_simplify] [--net_only] [--top_lvl_pins] [--combine] [--purge] [--purge_nets]
 ```
 
 Example:
 ```bash
     python3 testing/testcases/unit/heater_devices/layout/straight_heater_metal.py
-    python3 run_lvs.py --layout=testing/testcases/unit/heater_devices/layout/straight_heater_metal.gds --netlist=testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice --run_mode=flat --run_dir=lvs_straight_heater_metal
+    python3 run_lvs.py --layout=testing/testcases/unit/heater_devices/layout/straight_heater_metal.gds --netlist=testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice --run_mode=deep --run_dir=lvs_straight_heater_metal
 ```
 
 ### Options
 
 - `--help -h`                           Print this help message.
 
 - `--layout=<layout_path>`              The input GDS file path.
```

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py`

 * *Files 1% similar despite different names*

```diff
@@ -52,15 +52,15 @@
 
     for z in myroot[7]:  # myroot[7] : List rules with viloations
         all_violating_rules.add(f"{z[1].text}".replace("'", ""))
 
     return all_violating_rules
 
 
-def check_drc_results(results_db_files: list):
+def check_drc_results(results_db_files: list) -> None:
     """
     check_drc_results Checks the results db generated from run and report at the end if the DRC run failed or passed.
     This function will exit with 1 if there are violations.
 
     Parameters
     ----------
     results_db_files : list
@@ -175,15 +175,15 @@
 
     switches["topcell"] = get_run_top_cell_name(arguments, layout_path)
     switches["input"] = layout_path
 
     return switches
 
 
-def check_klayout_version():
+def check_klayout_version() -> None:
     """
     check_klayout_version checks klayout version and makes sure it would work with the DRC.
     """
     # ======= Checking Klayout version =======
     klayout_v_ = os.popen("klayout -b -v").read()
     klayout_v_ = klayout_v_.split("\n")[0]
     klayout_v_list = []
@@ -301,15 +301,15 @@
 
 def run_single_processor(
     arguments: dict,
     rule_deck_full_path: str,
     layout_path: str,
     switches: dict,
     drc_run_dir: str,
-):
+) -> None:
     """
     run_single_processor run the drc checks as single run.
 
     Parameters
     ----------
     arguments : dict
         Dictionary that holds the arguments passed to the run_drc script.
@@ -334,15 +334,15 @@
         run_check(drc_file, table_name, layout_path, drc_run_dir, switches)
     )
 
     ## Check run
     check_drc_results(list_res_db_files)
 
 
-def main(drc_run_dir: str, now_str: str, arguments: dict):
+def main(drc_run_dir: str, now_str: str, arguments: dict) -> None:
     """
     main function to run the DRC.
 
     Parameters
     ----------
     drc_run_dir : str
         String with absolute path of the full run dir.
```

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs`

 * *Files 4% similar despite different names*

```diff
@@ -84,52 +84,43 @@
 DEV_SCALE = bool_check?($scale)
 
 device_scaling(1_000_000) if $DEV_SCALE
 
 logger.info("LVS device_scaling option: #{DEV_SCALE}")
 
 # SCH_SIMPLE
-SCH_SIMPLE = bool_check?($schematic_simplify)
+SCH_SIMPLE = bool_check?(false)
 
 logger.info("Selected SCH_SIMPLE option: #{SCH_SIMPLE}")
 
 # NET_ONLY
-NET_ONLY = bool_check?($net_only)
+NET_ONLY = bool_check?(true)
 
 logger.info("Selected NET_ONLY option: #{NET_ONLY}")
 
 # TOP_LVL_PINS
-TOP_LVL_PINS = bool_check?($top_lvl_pins)
+TOP_LVL_PINS = bool_check?(true)
 
 logger.info("Selected TOP_LVL_PINS option: #{TOP_LVL_PINS}")
 
 # COMBINE
-COMBINE = bool_check?($combine)
+COMBINE = bool_check?(false)
 
 logger.info("Selected COMBINE option: #{COMBINE}")
 
 # PURGE
-PURGE = bool_check?($purge)
+PURGE = bool_check?(true)
 
 logger.info("Selected PURGE option: #{PURGE}")
 
 # PURGE_NETS
-PURGE_NETS = bool_check?($purge_nets)
+PURGE_NETS = bool_check?(true)
 
 logger.info("Selected PURGE_NETS option: #{PURGE_NETS}")
 
-# SIMPLIFY
-SIMPLIFY = if NET_ONLY || TOP_LVL_PINS || COMBINE || PURGE || PURGE_NETS
-             false
-           else
-             true
-           end
-
-logger.info("Selected SIMPLIFY option: #{SIMPLIFY}")
-
 #=== PRINT DETAILS ===
 logger.info("Verbose mode: #{$verbose}")
 if $verbose == 'true'
   verbose(true)
 else
   verbose(false)
 end
@@ -229,17 +220,14 @@
 #================================================
 
 logger.info('Starting GENERIC TECH LVS comparison section')
 
 #=== FLATTEN CELLS ===
 align
 
-#=== NETLIST EXTRACTION ===
-netlist.simplify if SIMPLIFY
-
 #=== NETLIST OPTIONS ===
 netlist if NET_ONLY
 
 netlist.make_top_level_pins if TOP_LVL_PINS
 
 netlist.combine_devices if COMBINE
```

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/run_lvs.py` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/run_lvs.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,43 +1,37 @@
 """Run GENERIC TECHs LVS.
 
 Usage:
     run_lvs.py (--help| -h)
-    run_lvs.py (--layout=<layout_path>) (--netlist=<netlist_path>) [--thr=<thr>] [--run_dir=<run_dir_path>] [--topcell=<topcell_name>] [--run_mode=<run_mode>] [--verbose] [--lvs_sub=<sub_name>] [--no_net_names] [--spice_comments] [--scale] [--schematic_simplify] [--net_only] [--top_lvl_pins] [--combine] [--purge] [--purge_nets]
+    run_lvs.py (--layout=<layout_path>) (--netlist=<netlist_path>) [--thr=<thr>] [--run_dir=<run_dir_path>] [--topcell=<topcell_name>] [--run_mode=<run_mode>] [--verbose] [--lvs_sub=<sub_name>] [--no_net_names] [--spice_comments] [--scale]
 
 Options:
     --help -h                           Print this help message.
     --layout=<layout_path>              The input GDS file path.
     --netlist=<netlist_path>            The input netlist file path.
     --thr=<thr>                         The number of threads used in run.
     --run_dir=<run_dir_path>            Run directory to save all the results [default: pwd]
     --topcell=<topcell_name>            Topcell name to use.
-    --run_mode=<run_mode>               Select klayout mode Allowed modes (flat , deep, tiling). [default: flat ]
+    --run_mode=<run_mode>               Select klayout mode Allowed modes (flat , deep, tiling). [default: deep ]
     --lvs_sub=<sub_name>                Substrate name used in your design.
     --verbose                           Detailed rule execution log for debugging.
     --no_net_names                      Discard net names in extracted netlist.
     --spice_comments                    Enable netlist comments in extracted netlist.
     --scale                             Enable scale of 1e6 in extracted netlist.
-    --schematic_simplify                Enable schematic simplification in input netlist.
-    --net_only                          Enable netlist object creation only in extracted netlist.
-    --top_lvl_pins                      Enable top level pins only in extracted netlist.
-    --combine                           Enable netlist combine only in extracted netlist.
-    --purge                             Enable netlist purge all only in extracted netlist.
-    --purge_nets                        Enable netlist purge nets only in extracted netlist.
 """
 
 from docopt import docopt
 import os
 import logging
 import klayout.db
 from datetime import datetime
 from subprocess import check_call
 
 
-def check_klayout_version():
+def check_klayout_version() -> None:
     """
     check_klayout_version checks klayout version and makes sure it would work with the LVS.
     """
     # ======= Checking Klayout version =======
     klayout_v_ = os.popen("klayout -b -v").read()
     klayout_v_ = klayout_v_.split("\n")[0]
     klayout_v_list = []
@@ -198,44 +192,14 @@
         switches["spice_comments"] = "false"
 
     if arguments["--scale"]:
         switches["scale"] = "true"
     else:
         switches["scale"] = "false"
 
-    if arguments["--schematic_simplify"]:
-        switches["schematic_simplify"] = "true"
-    else:
-        switches["schematic_simplify"] = "false"
-
-    if arguments["--net_only"]:
-        switches["net_only"] = "true"
-    else:
-        switches["net_only"] = "false"
-
-    if arguments["--top_lvl_pins"]:
-        switches["top_lvl_pins"] = "true"
-    else:
-        switches["top_lvl_pins"] = "false"
-
-    if arguments["--combine"]:
-        switches["combine"] = "true"
-    else:
-        switches["combine"] = "false"
-
-    if arguments["--purge"]:
-        switches["purge"] = "true"
-    else:
-        switches["purge"] = "false"
-
-    if arguments["--purge_nets"]:
-        switches["purge_nets"] = "true"
-    else:
-        switches["purge_nets"] = "false"
-
     switches["topcell"] = get_run_top_cell_name(arguments, layout_path)
     switches["input"] = os.path.abspath(layout_path)
     switches["schematic"] = os.path.abspath(netlist_path)
 
     return switches
 
 
@@ -247,15 +211,15 @@
     ----------
     sws : dict
         Dictionary that holds the Antenna switches.
     """
     return " ".join(f"-rd {k}={v}" for k, v in sws.items())
 
 
-def check_lvs_results(results_db_files: list):
+def check_lvs_results(results_db_files: list) -> None:
     """
     check_lvs_results Checks the results db generated from run and report at the end if the LVS run failed or passed.
 
     Parameters
     ----------
     results_db_files : list
         A list of strings that represent paths to results databases of all the LVS runs.
@@ -303,15 +267,15 @@
 
     run_str = f"klayout -b -r {lvs_file} {sws_str}"
     check_call(run_str, shell=True)
 
     return report_path
 
 
-def main(lvs_run_dir: str, arguments: dict):
+def main(lvs_run_dir: str, arguments: dict) -> None:
     """
     main function to run the LVS.
 
     Parameters
     ----------
     lvs_run_dir : str
         String with absolute path of the full run dir.
```

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice`

 * *Files 8% similar despite different names*

```diff
@@ -11,18 +11,18 @@
 + R5_t1 R5_t2
 + R6_t1 R6_t2
 + R7_t1 R7_t2
 + R8_t1 R8_t2
 + R9_t1 R9_t2
 + R10_t1 R10_t2
 
-R1 R1_t1 R1_t2 straight_heater_metal W=10u L=50u
-R2 R2_t1 R2_t2 straight_heater_metal W=35u L=70u
-R3 R3_t1 R3_t2 straight_heater_metal W=100u L=50u
-R4 R4_t1 R4_t2 straight_heater_metal W=50u L=100u
-R5 R5_t1 R5_t2 straight_heater_metal W=30u L=80u
-R6 R6_t1 R6_t2 straight_heater_metal W=40u L=60u
-R7 R7_t1 R7_t2 straight_heater_metal W=10u L=200u
-R8 R8_t1 R8_t2 straight_heater_metal W=100u L=120u
-R9 R9_t1 R9_t2 straight_heater_metal W=50u L=150u
+R1 R1_t2 R2_t1 straight_heater_metal W=10u L=50u
+R2 R2_t1 R3_t2 straight_heater_metal W=35u L=70u
+R3 R3_t2 R4_t1 straight_heater_metal W=100u L=50u
+R4 R4_t1 R5_t2 straight_heater_metal W=50u L=100u
+R5 R5_t2 R6_t1 straight_heater_metal W=30u L=80u
+R6 R6_t1 R7_t2 straight_heater_metal W=40u L=60u
+R7 R7_t2 R8_t1 straight_heater_metal W=10u L=200u
+R8 R8_t1 R9_t2 straight_heater_metal W=100u L=120u
+R9 R9_t2 R10_t1 straight_heater_metal W=50u L=150u
 R10 R10_t1 R10_t2 straight_heater_metal W=500u L=500u
 .ENDS
```

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym`

 * *Files 1% similar despite different names*

#### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym`

```diff
@@ -12,15 +12,15 @@
   <show-in-menu>false</show-in-menu>
   <group-name/>
   <menu-path>gdsfactory.begin</menu-path>
   <interpreter>python</interpreter>
   <dsl-interpreter-name/>
   <text>import pya
 
-__version__ = &quot;6.93.1&quot;
+__version__ = &quot;6.94.0&quot;
 
 
 def set_menu():
     menu = pya.Application.instance().main_window().menu()
 
     s0 = &quot;gdsfactory&quot;
     if not (menu.is_menu(s0)):
```

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,15 +1,15 @@
 """Keybindings inspired by SiEPIC tools."""
 
 from __future__ import annotations
 
 import pya
 
 
-def set_shortcuts():
+def set_shortcuts() -> None:
     config = pya.Application.instance().get_config("key-bindings")
     if config == "":
         print("WARNING: get_config(key-bindings) returned null")
         mapping = {}
     else:
         mapping = dict(item.split(":") for item in config.split(";"))
```

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/generic.layerstack` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/generic.layerstack`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/layers.lyp`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/layers.lyp` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp`

 * *Files 0% similar despite different names*

#### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/layers.lyp` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp`

```diff
@@ -1458,8 +1458,25 @@
     <width/>
     <marked>false</marked>
     <xfill>false</xfill>
     <animation>0</animation>
     <name>WAFER</name>
     <source>99999/0@1</source>
   </properties>
+  <properties>
+    <frame-color>#ff80a8</frame-color>
+    <fill-color>#ff80a8</fill-color>
+    <frame-brightness>0</frame-brightness>
+    <fill-brightness>0</fill-brightness>
+    <dither-pattern>I5</dither-pattern>
+    <line-style/>
+    <valid>true</valid>
+    <visible>true</visible>
+    <transparent>false</transparent>
+    <width/>
+    <marked>false</marked>
+    <xfill>false</xfill>
+    <animation>0</animation>
+    <name>WG_PIN 1/10</name>
+    <source>1/10@1</source>
+  </properties>
 </layer-properties>
```

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/tech.lyt` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/tech.lyt`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs` & `gdsfactory-6.94.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/layer_map.py` & `gdsfactory-6.94.0/gdsfactory/generic_tech/layer_map.py`

 * *Files 7% similar despite different names*

```diff
@@ -49,14 +49,15 @@
     DICING: Layer = (100, 0)
     NO_TILE_SI: Layer = (71, 0)
     PADDING: Layer = (67, 0)
     DEVREC: Layer = (68, 0)
     FLOORPLAN: Layer = (64, 0)
     TEXT: Layer = (66, 0)
     PORT: Layer = (1, 10)
+    WG_PIN: Layer = (1, 10)
     PORTE: Layer = (1, 11)
     PORTH: Layer = (70, 0)
     SHOW_PORTS: Layer = (1, 12)
     LABEL: Layer = (201, 0)
     LABEL_SETTINGS: Layer = (202, 0)
     TE: Layer = (203, 0)
     TM: Layer = (204, 0)
```

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/layer_stack.py` & `gdsfactory-6.94.0/gdsfactory/generic_tech/layer_stack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/generic_tech/layer_views.yaml` & `gdsfactory-6.94.0/gdsfactory/generic_tech/layer_views.yaml`

 * *Files 1% similar despite different names*

```diff
@@ -495,7 +495,12 @@
     hatch_pattern: lightly left-hatched
     color: "#ff80a8"
   WAFER:
     layer: [99999, 0]
     hatch_pattern: lightly left-hatched
     color: "#ff80a8"
     visible: false
+  WG_PIN:
+    layer: [1, 10]
+    layer_in_name: true
+    hatch_pattern: lightly left-hatched
+    color: "#ff80a8"
```

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/__init__.py` & `gdsfactory-6.94.0/gdsfactory/geometry/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/boolean.py` & `gdsfactory-6.94.0/gdsfactory/geometry/boolean.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/boolean_klayout.py` & `gdsfactory-6.94.0/gdsfactory/geometry/boolean_klayout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/boolean_polygons.py` & `gdsfactory-6.94.0/gdsfactory/geometry/boolean_polygons.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/check_duplicated_cells.py` & `gdsfactory-6.94.0/gdsfactory/geometry/check_duplicated_cells.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/check_exclusion.py` & `gdsfactory-6.94.0/gdsfactory/geometry/check_exclusion.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/check_inclusion.py` & `gdsfactory-6.94.0/gdsfactory/geometry/check_inclusion.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/check_space.py` & `gdsfactory-6.94.0/gdsfactory/geometry/check_space.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/check_width.py` & `gdsfactory-6.94.0/gdsfactory/geometry/check_width.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/fill_klayout.py` & `gdsfactory-6.94.0/gdsfactory/geometry/fill_klayout.py`

 * *Files 1% similar despite different names*

```diff
@@ -12,15 +12,15 @@
     layer_to_fill: LayerSpec,
     layer_to_fill_margin: float = 0,
     layers_to_avoid: Optional[Tuple[LayerSpec, float], ...] = None,
     cell_name: Optional[str] = None,
     fill_cell_name: str = "fill_cell",
     create_new_fill_cell: bool = False,
     include_original: bool = False,
-    fill_layers: LayerSpecs = None,
+    fill_layers: Optional[LayerSpecs] = None,
     fill_size: Tuple[float, float] = (10, 10),
     fill_spacing: Tuple[float, float] = (20, 20),
     fill_name: Optional[str] = None,
     gdspath_out: Optional[PathType] = None,
 ) -> None:
     """Write gds file with fill.
```

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/fill_tiled.py` & `gdsfactory-6.94.0/gdsfactory/geometry/fill_tiled.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/fillet.py` & `gdsfactory-6.94.0/gdsfactory/geometry/fillet.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/functions.py` & `gdsfactory-6.94.0/gdsfactory/geometry/functions.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/invert.py` & `gdsfactory-6.94.0/gdsfactory/geometry/invert.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/layer_priority.py` & `gdsfactory-6.94.0/gdsfactory/geometry/layer_priority.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/manhattanize.py` & `gdsfactory-6.94.0/gdsfactory/geometry/manhattanize.py`

 * *Files 2% similar despite different names*

```diff
@@ -71,15 +71,15 @@
                     )
                 cur_x += x_step
                 cur_y += y_step
             x_polarity += 1
     return gdstk.Polygon(p_manhattan)
 
 
-def test_manhattanize():
+def test_manhattanize() -> None:
     c = gf.Component("route")
     poly = gdstk.rectangle((-2, -2), (2, 2))
     poly.rotate(np.pi / 4)
     poly.scale(1, 0.5)
     init_poly = c.add_polygon(poly, layer=1)
     final_poly = c.add_polygon(manhattanize_polygon(poly, target_step=0.05), layer=2)
```

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/maskprep.py` & `gdsfactory-6.94.0/gdsfactory/geometry/maskprep.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/maskprep_flat.py` & `gdsfactory-6.94.0/gdsfactory/geometry/maskprep_flat.py`

 * *Files 2% similar despite different names*

```diff
@@ -5,14 +5,15 @@
     print(
         "You can install `pip install gdsfactory[full]` for using maskprep. "
         "And make sure you use python >= 3.10"
     )
     raise e
 
 from gdsfactory.typings import Dict, Layer, PathType, Tuple, LayerSpecs
+from typing import Optional
 
 
 def size(region: kdb.Region, offset: float):
     return region.dup().size(int(offset * 1e3))
 
 
 def boolean_or(region1: kdb.Region, region2: kdb.Region):
@@ -60,15 +61,17 @@
     """RegionCollection of region per layer.
 
     Args:
         layermap: dict of layernames to layer numbers {'WG': (1, 0)}
         filepath: to read GDS from.
     """
 
-    def __init__(self, layermap: Dict[str, Layer], filepath: PathType = None):
+    def __init__(
+        self, layermap: Dict[str, Layer], filepath: Optional[PathType] = None
+    ) -> None:
         lib = kf.kcell.KLib()
         lib.read(filename=str(filepath))
         c = lib[0]
 
         for layername, layer in layermap.items():
             region = Region()
             layer = lib.layer(layer[0], layer[1])
@@ -95,15 +98,15 @@
             except TypeError:
                 raise ValueError(
                     f"Unexpected type for region {layername!r}: {type(region)}"
                 )
         c.write(filename)
         return c
 
-    def __delattr__(self, element):
+    def __delattr__(self, element) -> None:
         setattr(self, element, Region())
 
     def get_fill(
         self,
         region,
         size: Tuple[float, float],
         spacing: Tuple[float, float],
```

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/offset.py` & `gdsfactory-6.94.0/gdsfactory/geometry/offset.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/outline.py` & `gdsfactory-6.94.0/gdsfactory/geometry/outline.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/trim.py` & `gdsfactory-6.94.0/gdsfactory/geometry/trim.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/union.py` & `gdsfactory-6.94.0/gdsfactory/geometry/union.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/write_drc.py` & `gdsfactory-6.94.0/gdsfactory/geometry/write_drc.py`

 * *Files 6% similar despite different names*

```diff
@@ -10,34 +10,57 @@
 - https://github.com/google/globalfoundries-pdk-libs-gf180mcu_fd_pr/tree/main/rules/klayout
 """
 
 from __future__ import annotations
 
 import pathlib
 from dataclasses import asdict, is_dataclass
-from typing import List, Optional
+from typing import List, Optional, Union
 
-from gdsfactory.config import logger
+import gdsfactory as gf
 from gdsfactory.install import get_klayout_path
-from gdsfactory.typings import Dict, Layer, PathType
+from gdsfactory.typings import CrossSectionSpec, Dict, Layer, PathType
 
 layer_name_to_min_width: Dict[str, float]
 
 
-def rule_min_width_or_space(width: float, space: float, layer: str) -> str:
-    """Min width or space violations.
+def get_drc_script_start(name, shortcut) -> str:
+    return f"""<?xml version="1.0" encoding="utf-8"?>
+<klayout-macro>
+ <description>{name} DRC</description>
+ <version/>
+ <category>drc</category>
+ <prolog/>
+ <epilog/>
+ <doc/>
+ <autorun>false</autorun>
+ <autorun-early>false</autorun-early>
+ <shortcut>{shortcut}</shortcut>
+ <show-in-menu>true</show-in-menu>
+ <group-name>drc_scripts</group-name>
+ <menu-path>tools_menu.drc.end</menu-path>
+ <interpreter>dsl</interpreter>
+ <dsl-interpreter-name>drc-dsl-xml</dsl-interpreter-name>
+ <text># {name} DRC
+
+# Read about Klayout DRC scripts in the User Manual under "Design Rule Check (DRC)"
+# Based on https://gdsfactory.github.io/gdsfactory/notebooks/_2_klayout.html#Klayout-DRC
+# and https://gdsfactory.github.io/gdsfactory/api.html#klayout-drc
+
+report("{name} DRC")
+time_start = Time.now
+"""
 
-    It's a more efficient check thanks to the universal DRC notation.
-    https://klayout.de/doc/manual/drc_runsets.html
-    """
-    error = f"{layer} min width {width}um or min space {space}um"
-    return (
-        f"{layer}.drc((width < {width}) | (space < {space}))"
-        f".output({error!r}, {error!r})"
-    )
+
+drc_script_end = r"""
+time_end = Time.now
+print "run time #{(time_end-time_start).round(3)} seconds \n"
+</text>
+</klayout-macro>
+"""
 
 
 def rule_not_inside(layer: str, not_inside: str) -> str:
     """Checks for that a layer is not inside another layer."""
     error = f"{layer} not inside {not_inside}"
     return f"{layer}.not_inside({not_inside})" f".output({error!r}, {error!r})"
 
@@ -127,49 +150,74 @@
   r_max_dens.output("{layer}: {layer} density above threshold of {max_density}")
 
 end
 
 """
 
 
+def connectivity_checks(
+    WG_cross_sections: List[CrossSectionSpec], pin_widths: Union[List[float], float]
+):
+    """Return script for photonic port connectivity check. Assumes the photonic port pins are inside the Component.
+
+    Args:
+        WG_cross_sections: list of waveguide layers to run check for.
+        pin_widths: list of port pin widths or a single port pin width/
+    """
+    connectivity_check = ""
+    for i, layer_name in enumerate(WG_cross_sections):
+        layer = gf.pdk.get_cross_section(layer_name).width
+        layer_name = gf.pdk.get_cross_section(layer_name).layer
+        connectivity_check = connectivity_check.join(
+            f"""{layer_name}_PIN2 = {layer_name}_PIN.sized(0.0).merged\n
+{layer_name}_PIN2 = {layer_name}_PIN2.rectangles.without_area({layer} * {pin_widths if isinstance(pin_widths, float) else pin_widths[i]}) - {layer_name}_PIN2.rectangles.with_area({layer} * 2 * {pin_widths if isinstance(pin_widths, float) else pin_widths[i]})\n
+{layer_name}_PIN2.output(\"port alignment error\")\n
+{layer_name}_PIN2 = {layer_name}_PIN.sized(0.0).merged\n
+{layer_name}_PIN2.non_rectangles.output(\"port width check\")\n\n"""
+        )
+
+    return connectivity_check
+
+
 def write_layer_definition(layers: Dict[str, Layer]) -> List[str]:
     """Returns layers definition script for KLayout.
 
     Args:
         layers: layer definitions can be dict, dataclass or pydantic BaseModel.
 
     """
     layers = asdict(layers) if is_dataclass(layers) else layers
     layers = dict(layers)
     return [f"{key} = input({value[0]}, {value[1]})" for key, value in layers.items()]
 
 
-def write_drc_deck(rules: List[str], layers: Dict[str, Layer]) -> str:
+def write_drc_deck(rules: List[str], layers: Optional[Dict[str, Layer]] = None) -> str:
     """Returns drc_rule_deck for KLayout.
 
     based on https://github.com/klayoutmatthias/si4all
 
     Args:
         rules: list of rules.
         layers: layer definitions can be dict, dataclass or pydantic BaseModel.
 
     """
     script = []
-    script += write_layer_definition(layers=layers)
+    if layers:
+        script += write_layer_definition(layers=layers)
     script += ["\n"]
     script += rules
     return "\n".join(script)
 
 
 modes = ["tiled", "default", "deep"]
 
 
 def write_drc_deck_macro(
     rules: List[str],
-    layers: Dict[str, Layer],
+    layers: Optional[Dict[str, Layer]] = None,
     name: str = "generic",
     filepath: Optional[PathType] = None,
     shortcut: str = "Ctrl+Shift+D",
     mode: str = "tiled",
     threads: int = 4,
     tile_size: int = 500,
     tile_borders: Optional[int] = None,
@@ -227,15 +275,14 @@
             rule_separation,
             rule_area,
             rule_density,
         )
         rules = [
             rule_width(layer="WG", value=0.2),
             rule_space(layer="WG", value=0.2),
-            rule_min_width_or_space(layer="WG", width=0.2, space=0.2), # faster
             rule_separation(layer1="HEATER", layer2="M1", value=1.0),
             rule_enclosing(layer1="VIAC", layer2="M1", value=0.2),
             rule_area(layer="WG", min_area_um2=0.05),
             rule_density(
                 layer="WG", layer_floorplan="FLOORPLAN", min_density=0.5, max_density=0.6
             ),
             rule_not_inside(layer="VIAC", not_inside="NPP"),
@@ -244,39 +291,15 @@
         drc_rule_deck = write_drc_deck_macro(rules=rules, layers=gf.LAYER, mode="tiled")
         print(drc_rule_deck)
 
     """
     if mode not in modes:
         raise ValueError(f"{mode!r} not in {modes}")
 
-    script = f"""<?xml version="1.0" encoding="utf-8"?>
-<klayout-macro>
- <description>{name} DRC</description>
- <version/>
- <category>drc</category>
- <prolog/>
- <epilog/>
- <doc/>
- <autorun>false</autorun>
- <autorun-early>false</autorun-early>
- <shortcut>{shortcut}</shortcut>
- <show-in-menu>true</show-in-menu>
- <group-name>drc_scripts</group-name>
- <menu-path>tools_menu.drc.end</menu-path>
- <interpreter>dsl</interpreter>
- <dsl-interpreter-name>drc-dsl-xml</dsl-interpreter-name>
- <text># {name} DRC
-
-# Read about Klayout DRC scripts in the User Manual under "Design Rule Check (DRC)"
-# Based on https://gdsfactory.github.io/gdsfactory/notebooks/_2_klayout.html#Klayout-DRC
-# and https://gdsfactory.github.io/gdsfactory/api.html#klayout-drc
-
-report("{name} DRC")
-time_start = Time.now
-"""
+    script = get_drc_script_start(name=name, shortcut=shortcut)
 
     if mode == "tiled":
         script += f"""
 threads({threads})
 tiles({tile_size})
 """
         if tile_borders:
@@ -286,37 +309,33 @@
     elif mode == "deep":
         script += """
 deep
 """
 
     script += write_drc_deck(rules=rules, layers=layers)
 
-    script += r"""
-time_end = Time.now
-print "run time #{(time_end-time_start).round(3)} seconds \n"
-</text>
-</klayout-macro>
-"""
+    script += drc_script_end
     filepath = filepath or get_klayout_path() / "drc" / f"{name}.lydrc"
+    filepath = pathlib.Path(filepath)
     dirpath = filepath.parent
     dirpath.mkdir(parents=True, exist_ok=True)
     filepath = pathlib.Path(filepath)
     filepath.write_text(script)
-    logger.info(f"Wrote DRC deck to {str(filepath)!r} with shortcut {shortcut!r}")
+    print(f"Wrote DRC deck to {str(filepath)!r} with shortcut {shortcut!r}")
     return script
 
 
 if __name__ == "__main__":
-    import gdsfactory as gf
-
     rules = [
-        rule_min_width_or_space(layer="WG", width=0.2, space=0.2),
-        # rule_width(layer="WG", value=0.2),
-        # rule_space(layer="WG", value=0.2),
+        rule_width(layer="WG", value=0.2),
+        rule_space(layer="WG", value=0.2),
         rule_separation(layer1="HEATER", layer2="M1", value=1.0),
         rule_enclosing(layer1="VIAC", layer2="M1", value=0.2),
         rule_area(layer="WG", min_area_um2=0.05),
         rule_not_inside(layer="VIAC", not_inside="NPP"),
     ]
 
-    drc_rule_deck = write_drc_deck_macro(rules=rules, layers=gf.LAYER, mode="tiled")
+    layers = gf.LAYER.dict()
+    layers.update({"WG_PIN": (1, 10)})
+
+    drc_rule_deck = write_drc_deck_macro(rules=rules, layers=layers, mode="tiled")
     print(drc_rule_deck)
```

### Comparing `gdsfactory-6.93.1/gdsfactory/geometry/xor_diff.py` & `gdsfactory-6.94.0/gdsfactory/geometry/xor_diff.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/get_factories.py` & `gdsfactory-6.94.0/gdsfactory/get_factories.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/get_netlist.py` & `gdsfactory-6.94.0/gdsfactory/get_netlist.py`

 * *Files 1% similar despite different names*

```diff
@@ -410,15 +410,15 @@
         "ports": ports,
         "values": values,
         "message": message,
     }
     return clean_dict(w)
 
 
-def _null_validator(port1: Port, port2: Port, port_names, warnings):
+def _null_validator(port1: Port, port2: Port, port_names, warnings) -> None:
     pass
 
 
 def validate_optical_connection(
     port1: Port,
     port2: Port,
     port_names,
```

### Comparing `gdsfactory-6.93.1/gdsfactory/get_netlist_flat.py` & `gdsfactory-6.94.0/gdsfactory/get_netlist_flat.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 from __future__ import annotations
 from collections.abc import Iterable
-from typing import Any, Dict, List
+from typing import Optional, Any, Dict, List
 from gdsfactory.component import Component
 import gdsfactory as gf
 from gdsfactory.get_netlist import get_netlist_recursive
 
 
 def get_netlist_flat(
     component: Component,
@@ -250,15 +250,15 @@
 
     return hierarchies_lists
 
 
 def _flatten_hierarchy_recurse(
     netlist_name: str,
     all_netlists: List[Dict[str, any]],
-    hierarchy: str = None,
+    hierarchy: Optional[str] = None,
     hierarchy_delimiter: str = "~",
     component_instance_delimiter: str = ";",
 ) -> Dict[str, Any]:
     """Flattens the provided recursive netlist by recursively updating a list.
 
     Args:
         netlist_name: netlist entry to flatten
```

### Comparing `gdsfactory-6.93.1/gdsfactory/get_netlist_klayout.py` & `gdsfactory-6.94.0/gdsfactory/get_netlist_klayout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/grid.py` & `gdsfactory-6.94.0/gdsfactory/grid.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/install.py` & `gdsfactory-6.94.0/gdsfactory/install.py`

 * *Files 5% similar despite different names*

```diff
@@ -5,15 +5,15 @@
 import os
 import pathlib
 import shutil
 import sys
 from typing import Optional
 
 
-def remove_path_or_dir(dest: pathlib.Path):
+def remove_path_or_dir(dest: pathlib.Path) -> None:
     if dest.is_dir():
         os.unlink(dest)
     else:
         os.remove(dest)
 
 
 def make_link(src, dest, overwrite: bool = True) -> None:
@@ -57,15 +57,15 @@
     if "gds_diff" not in git_attributes_str:
         print("Appending the gdsdiff command to your ~/.gitattributes")
 
         with open(git_attributes_path, "a") as f:
             f.write("*.gds diff=gds_diff\n")
 
 
-def write_git_config(git_config_path):
+def write_git_config(git_config_path) -> None:
     """Write GIT config."""
     print("gdsdiff shows boolean differences in Klayout")
     print("git diff FILE.GDS")
     print("Appending the gdsdiff command to your ~/.gitconfig")
 
     config = configparser.RawConfigParser()
     config.read(git_config_path)
@@ -128,15 +128,17 @@
     _install_to_klayout(
         src=cwd / "generic_tech" / "klayout",
         klayout_subdir_name="salt",
         package_name="gdsfactory",
     )
 
 
-def install_klayout_technology(tech_dir: pathlib.Path, tech_name: Optional[str] = None):
+def install_klayout_technology(
+    tech_dir: pathlib.Path, tech_name: Optional[str] = None
+) -> None:
     """Install technology to KLayout."""
     _install_to_klayout(
         src=tech_dir,
         klayout_subdir_name="tech",
         package_name=tech_name or tech_dir.name,
     )
```

### Comparing `gdsfactory-6.93.1/gdsfactory/klive.py` & `gdsfactory-6.94.0/gdsfactory/klive.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/labels/__init__.py` & `gdsfactory-6.94.0/gdsfactory/labels/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/labels/add_label_yaml.py` & `gdsfactory-6.94.0/gdsfactory/labels/add_label_yaml.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/labels/ehva.py` & `gdsfactory-6.94.0/gdsfactory/labels/ehva.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/labels/merge_test_metadata.py` & `gdsfactory-6.94.0/gdsfactory/labels/merge_test_metadata.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/labels/siepic.py` & `gdsfactory-6.94.0/gdsfactory/labels/siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/labels/write_labels.py` & `gdsfactory-6.94.0/gdsfactory/labels/write_labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/materials.py` & `gdsfactory-6.94.0/gdsfactory/materials.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/name.py` & `gdsfactory-6.94.0/gdsfactory/name.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/pack.py` & `gdsfactory-6.94.0/gdsfactory/pack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/path.py` & `gdsfactory-6.94.0/gdsfactory/path.py`

 * *Files 1% similar despite different names*

```diff
@@ -50,15 +50,15 @@
 
     Parameters:
         path: array-like[N][2], Path, or list of Paths.
             Points or Paths to append() initially.
 
     """
 
-    def __init__(self, path=None):
+    def __init__(self, path=None) -> None:
         """Creates an empty path."""
         self.points = np.array([[0, 0]], dtype=np.float64)
         self.start_angle = 0
         self.end_angle = 0
         self.info = {}
         if path is not None:
             # If array[N][2]
@@ -81,15 +81,15 @@
                 self.append(path)
             else:
                 raise ValueError(
                     "Path() the `path` argument must be either blank, a path Object, "
                     "an array-like[N][2] list of points, or a list of these"
                 )
 
-    def __len__(self):
+    def __len__(self) -> int:
         """Returns path points."""
         return len(self.points)
 
     @property
     def bbox(self):
         """Returns the bounding box of the Path."""
         bbox = [
```

### Comparing `gdsfactory-6.93.1/gdsfactory/pdk.py` & `gdsfactory-6.94.0/gdsfactory/pdk.py`

 * *Files 1% similar despite different names*

```diff
@@ -172,15 +172,15 @@
 
     @property
     def grid_size(self):
         """The minimum unit resolvable on the layout grid, relative to the unit."""
         return self.gds_write_settings.precision / self.gds_write_settings.unit
 
     @grid_size.setter
-    def grid_size(self, value):
+    def grid_size(self, value) -> None:
         self.gds_write_settings.precision = value * self.gds_write_settings.unit
 
     class Config:
         """Configuration."""
 
         extra = "forbid"
         fields = {
```

### Comparing `gdsfactory-6.93.1/gdsfactory/picmodel.py` & `gdsfactory-6.94.0/gdsfactory/picmodel.py`

 * *Files 2% similar despite different names*

```diff
@@ -117,37 +117,37 @@
     instances: Optional[Dict[str, Instance]] = None
     placements: Optional[Dict[str, Placement]] = None
     routes: Optional[Dict[str, Route]] = None
     ports: Optional[Dict[str, str]] = None
 
     def add_instance(
         self, name: str, component: gf.Component, placement: Optional[Placement] = None
-    ):
+    ) -> None:
         component_name = component.settings.function_name
         component_settings = component.settings.changed
         self.instances[name] = Instance(
             component=component_name, settings=component_settings
         )
         if not placement:
             placement = Placement()
         self.placements[name] = placement
 
-    def move_instance_to(self, name: str, x: float, y: float):
+    def move_instance_to(self, name: str, x: float, y: float) -> None:
         self.placements[name].x = x
         self.placements[name].y = y
 
-    def move_instance(self, name: str, dx: float, dy: float):
+    def move_instance(self, name: str, dx: float, dy: float) -> None:
         if not self.placements[name].dx:
             self.placements[name].dx = 0
         self.placements[name].dx += dx
         if not self.placements[name].dy:
             self.placements[name].dy = 0
         self.placements[name].dy += dy
 
-    def to_yaml(self, filename):
+    def to_yaml(self, filename) -> None:
         netlist = self.dict()
         with open(filename, mode="w") as f:
             yaml.dump(netlist, f, default_flow_style=None, sort_keys=False)
 
 
 class SchematicConfiguration(BaseModel):
     _schema: Optional[AnyUrl] = Field(None, alias="$schema")
@@ -161,16 +161,16 @@
         return self.schematic_placements
 
     def add_instance(
         self,
         name: str,
         component: Union[str, gf.Component],
         placement: Optional[Placement] = None,
-        settings: Dict[str, Any] = None,
-    ):
+        settings: Optional[Dict[str, Any]] = None,
+    ) -> None:
         if isinstance(component, gf.Component):
             component_name = component.settings.function_name
             component_settings = component.settings.changed
             if settings:
                 component_settings = component_settings | settings
             self.instances[name] = Instance(
                 component=component_name, settings=component_settings
```

### Comparing `gdsfactory-6.93.1/gdsfactory/pixelate.py` & `gdsfactory-6.94.0/gdsfactory/pixelate.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/plugins/dagster/workflow.py` & `gdsfactory-6.94.0/gdsfactory/plugins/dagster/workflow.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/plugins/database/README.md` & `gdsfactory-6.94.0/gdsfactory/plugins/database/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/plugins/database/db_upload.py` & `gdsfactory-6.94.0/gdsfactory/plugins/database/db_upload.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/plugins/database/models.py` & `gdsfactory-6.94.0/gdsfactory/plugins/database/models.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/plugins/web/main.py` & `gdsfactory-6.94.0/gdsfactory/plugins/web/main.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/plugins/web/server.py` & `gdsfactory-6.94.0/gdsfactory/plugins/web/server.py`

 * *Files 10% similar despite different names*

```diff
@@ -9,23 +9,24 @@
 
 import klayout.db as db
 import klayout.lay as lay
 
 from gdsfactory.component import GDSDIR_TEMP
 
 import gdsfactory as gf
+from typing import Optional
 
 host = "localhost"
 port = 8765
 
 
 class LayoutViewServerEndpoint(WebSocketEndpoint):
     encoding = "text"
 
-    def __init__(self, *args, **kwargs):
+    def __init__(self, *args, **kwargs) -> None:
         super().__init__(*args, **kwargs)
         logger.info("Initialized websocket")
         _params = self.scope["query_string"].decode("utf-8")
         _params_splitted = _params.split("&")
         params = {}
         for _param in _params_splitted:
             key, value = _param.split("=")
@@ -43,28 +44,28 @@
         cell_name = params["variant"]
         self.url = str(GDSDIR_TEMP / f"{cell_name}.gds")
         # c = gf.get_component(cell_name)
         gds_path = GDSDIR_TEMP / f"{cell_name}.gds"
         # c.write_gds(gds_path)
         self.gds_path = str(gds_path)
 
-    async def on_connect(self, websocket):
+    async def on_connect(self, websocket) -> None:
         await websocket.accept()
         await self.connection(websocket)
 
-    async def on_receive(self, websocket, data):
+    async def on_receive(self, websocket, data) -> None:
         await self.reader(websocket, data)
 
-    async def on_disconnect(self, websocket, close_code):
+    async def on_disconnect(self, websocket, close_code) -> None:
         pass
 
-    async def send_image(self, websocket, data):
+    async def send_image(self, websocket, data) -> None:
         await websocket.send_text(data)
 
-    def image_updated(self, websocket):
+    def image_updated(self, websocket) -> None:
         pixel_buffer = self.layout_view.get_screenshot_pixels()
         asyncio.create_task(self.send_image(websocket, pixel_buffer.to_png_data()))
 
     def mode_dump(self):
         return self.layout_view.mode_names()
 
     def annotation_dump(self):
@@ -88,15 +89,17 @@
                     "x": layer.xfill,
                     "name": layer.name,
                     "id": layer.id(),
                 }
             )
         return js
 
-    async def connection(self, websocket: WebSocket, path: str = None) -> None:
+    async def connection(
+        self, websocket: WebSocket, path: Optional[str] = None
+    ) -> None:
         self.layout_view = lay.LayoutView()
         self.layout_view.load_layout(self.url)
         if self.layer_props is not None:
             self.layout_view.load_layer_props(str(self.layer_props))
         self.layout_view.max_hier()
 
         await websocket.send_text(
@@ -108,15 +111,15 @@
                     "layers": self.layer_dump(),
                 }
             )
         )
 
         asyncio.create_task(self.timer(websocket))
 
-    async def timer(self, websocket):
+    async def timer(self, websocket) -> None:
         self.layout_view.on_image_updated_event = lambda: self.image_updated(websocket)
         while True:
             self.layout_view.timer()
             await asyncio.sleep(0.01)
 
     def buttons_from_js(self, js):
         buttons = 0
@@ -132,33 +135,33 @@
             buttons |= lay.ButtonState.LeftButton
         if (b & 2) != 0:
             buttons |= lay.ButtonState.RightButton
         if (b & 4) != 0:
             buttons |= lay.ButtonState.MidButton
         return buttons
 
-    def wheel_event(self, function, js):
+    def wheel_event(self, function, js) -> None:
         delta = 0
         dx = js["dx"]
         dy = js["dy"]
         if dx != 0:
             delta = -dx
             horizontal = True
         elif dy != 0:
             delta = -dy
             horizontal = False
         if delta != 0:
             function(
                 delta, horizontal, db.Point(js["x"], js["y"]), self.buttons_from_js(js)
             )
 
-    def mouse_event(self, function, js):
+    def mouse_event(self, function, js) -> None:
         function(db.Point(js["x"], js["y"]), self.buttons_from_js(js))
 
-    async def reader(self, websocket, data: str):
+    async def reader(self, websocket, data: str) -> None:
         js = json.loads(data)
         msg = js["msg"]
         if msg == "quit":
             return
         elif msg == "resize":
             self.layout_view.resize(js["width"], js["height"])
         elif msg == "clear-annotations":
```

### Comparing `gdsfactory-6.93.1/gdsfactory/plugins/web/server_jupyter.py` & `gdsfactory-6.94.0/gdsfactory/plugins/web/server_jupyter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/plugins/web/static/client.css` & `gdsfactory-6.94.0/gdsfactory/plugins/web/static/client.css`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/port.py` & `gdsfactory-6.94.0/gdsfactory/port.py`

 * *Files 0% similar despite different names*

```diff
@@ -256,19 +256,19 @@
 
     @property
     def y(self) -> float:
         """Returns the y-coordinate of the Port center."""
         return self.center[1]
 
     @x.setter
-    def x(self, value):
+    def x(self, value) -> None:
         self.center = (value, self.center[1])
 
     @y.setter
-    def y(self, value):
+    def y(self, value) -> None:
         self.center = (self.center[0], value)
 
     def rotate(self, angle: float = 45, center: Optional[Float2] = None) -> Port:
         """Rotates a Port around the specified center point, if no centerpoint \
         specified will rotate around (0,0).
 
         Args:
@@ -732,15 +732,15 @@
 
     for i, p in enumerate(ports):
         p.name = f"{prefix}{i+1}" if prefix else i + 1
 
 
 def rename_ports_by_orientation(
     component: Component,
-    layers_excluded: LayerSpec = None,
+    layers_excluded: Optional[LayerSpec] = None,
     select_ports: Callable = select_ports,
     function=_rename_ports_facing_side,
     prefix: str = "o",
     **kwargs,
 ) -> Component:
     """Returns Component with port names based on port orientation (E, N, W, S).
```

### Comparing `gdsfactory-6.93.1/gdsfactory/quickplotter.py` & `gdsfactory-6.94.0/gdsfactory/quickplotter.py`

 * *Files 3% similar despite different names*

```diff
@@ -60,22 +60,22 @@
     "blocking": False,
     "zoom_factor": 1.4,
     "interactive_zoom": None,
     "fontsize": 14,
 }
 
 
-def _zoom_factory(axis, scale_factor=1.4):
+def _zoom_factory(axis, scale_factor=1.4) -> None:
     """Returns zooming functionality to axis.
 
     From https://gist.github.com/tacaswell/3144287
 
     """
 
-    def zoom_fun(event, ax, scale):
+    def zoom_fun(event, ax, scale) -> None:
         """Zoom when scrolling."""
         if event.inaxes == axis:
             scale_factor = np.power(scale, -event.step)
             xdata = event.xdata
             ydata = event.ydata
             x_left = xdata - ax.get_xlim()[0]
             x_right = ax.get_xlim()[1] - xdata
@@ -96,15 +96,15 @@
 
 _qp_objects = {}
 
 
 def _rectangle_selector_factory(fig, ax):
     from matplotlib.widgets import RectangleSelector
 
-    def line_select_callback(eclick, erelease):
+    def line_select_callback(eclick, erelease) -> None:
         x1, y1 = eclick.xdata, eclick.ydata
         x2, y2 = erelease.xdata, erelease.ydata
         left = min(x1, x2)
         right = max(x1, x2)
         bottom = min(y1, y2)
         top = max(y1, y2)
         ax.set_xlim([left, right])
@@ -454,15 +454,15 @@
         y + port.width / 2,
     ]
     ax.text(port.center[0], port.center[1], port.name, fontsize=14)
     return bbox
 
 
 class ViewerWindow(QMainWindow):
-    def __init__(self):
+    def __init__(self) -> None:
         """Initialize the object."""
         super().__init__()
 
         self.setGeometry(QRect(100, 100, 800, 600))
         self.setWindowTitle("PHIDL quickplot")
 
         # Create "grid size = 40.0" label
@@ -513,15 +513,15 @@
         self.position_label.raise_()
         self.debug_label.raise_()
         self.help_label.raise_()
         self.show()
 
 
 class Viewer(QGraphicsView):
-    def __init__(self, gridsize_label, position_label, help_label):
+    def __init__(self, gridsize_label, position_label, help_label) -> None:
         """Initialize the object."""
         QGraphicsView.__init__(self)
 
         self.gridsize_label = gridsize_label
         self.position_label = position_label
         self.help_label = help_label
 
@@ -564,15 +564,15 @@
         #        self.gridpen.setCosmetic(True) # Makes constant width
         self.scene_polys = []
 
         self.initialize()
 
     def add_polygons(
         self, polygons, fill_color="#A8F22A", frame_color="#A8F22A", alpha=1.0
-    ):
+    ) -> None:
         qcolor_fill = QColor()
         qcolor_fill.setNamedColor(fill_color)
         qcolor_fill.setAlphaF(alpha)
         qcolor_frame = QColor()
         qcolor_frame.setNamedColor(frame_color)
         qcolor_frame.setAlphaF(1.0)
         qpen_frame = QPen(qcolor_frame, 0)
@@ -592,29 +592,29 @@
                 self.scene_ymax = sr.bottom()
             else:
                 self.scene_xmin = min(self.scene_xmin, sr.left())
                 self.scene_xmax = max(self.scene_xmax, sr.right())
                 self.scene_ymin = min(self.scene_ymin, sr.top())
                 self.scene_ymax = max(self.scene_ymax, sr.bottom())
 
-    def reset_view(self):
+    def reset_view(self) -> None:
         # The SceneRect controls how far you can pan, make it larger than
         # just the bounding box so middle-click panning works
         panning_rect = QRectF(self.scene_bounding_rect)
         panning_rect_center = panning_rect.center()
         panning_rect_size = max(panning_rect.width(), panning_rect.height()) * 3
         panning_rect.setSize(QSizeF(panning_rect_size, panning_rect_size))
         panning_rect.moveCenter(panning_rect_center)
         self.setSceneRect(panning_rect)
         self.fitInView(self.scene_bounding_rect, Qt.KeepAspectRatio)
         self.zoom_view(0.8)
 
         self.update_grid()
 
-    def add_port(self, port, is_subport=False):
+    def add_port(self, port, is_subport=False) -> None:
         if (port.width is None) or (port.width == 0):
             x, y = port.center
             cs = 1  # cross size
             pn = QPointF(x, y + cs)
             ps = QPointF(x, y - cs)
             pe = QPointF(x + cs, y)
             pw = QPointF(x - cs, y)
@@ -644,38 +644,38 @@
         else:
             [shape.setPen(self.subportpen) for shape in port_shapes]
             qtext.setDefaultTextColor(self.subportfontcolor)
             self.subportitems += port_items
 
     #        self.portlabels.append(qtext)
 
-    def add_aliases(self, aliases):
+    def add_aliases(self, aliases) -> None:
         for name, ref in aliases.items():
             qtext = self.scene.addText(str(name), self.portfont)
             x, y = ref.center
             qtext.setPos(QPointF(x, y))
             qtext.setFlag(QGraphicsItem.ItemIgnoresTransformations)
             self.aliasitems += [qtext]
 
-    def set_port_visibility(self, visible=True):
+    def set_port_visibility(self, visible=True) -> None:
         for item in self.portitems:
             item.setVisible(visible)
         self.ports_visible = visible
 
-    def set_subport_visibility(self, visible=True):
+    def set_subport_visibility(self, visible=True) -> None:
         for item in self.subportitems:
             item.setVisible(visible)
         self.subports_visible = visible
 
-    def set_alias_visibility(self, visible=True):
+    def set_alias_visibility(self, visible=True) -> None:
         for item in self.aliasitems:
             item.setVisible(visible)
         self.aliases_visible = visible
 
-    def initialize(self):
+    def initialize(self) -> None:
         self.scene.clear()
         self.polygons = {}
         self.portitems = []
         self.subportitems = []
         self.aliasitems = []
         self.aliases_visible = True
         self.ports_visible = True
@@ -686,15 +686,15 @@
         self.scene_bounding_rect = None
         self.scene_polys = []
         self.scene_xmin = 0
         self.scene_xmax = 1
         self.scene_ymin = 0
         self.scene_ymax = 1
 
-    def finalize(self):
+    def finalize(self) -> None:
         self.scene_bounding_rect = QRectF(
             QPointF(self.scene_xmin, self.scene_ymin),
             QPointF(self.scene_xmax, self.scene_ymax),
         )
         # self.scene_center = [self.scene_bounding_rect.center().x(), self.scene_bounding_rect.center().y()]
         self.scene_size = [
             self.scene_bounding_rect.width(),
@@ -702,15 +702,15 @@
         ]
         self.create_grid()
         self.update_grid()
 
     # ==============================================================================
     #   Grid creation
     # ==============================================================================
-    def update_grid(self):
+    def update_grid(self) -> None:
         grid_pixels = 50
         grid_snaps = [1, 2, 4]
 
         # Number of pixels in the viewer
         view_width, _ = self.rect().width(), self.rect().height()
         # Rectangle of viewport in terms of scene coordinates
         r = self.mapToScene(self.rect()).boundingRect()
@@ -732,45 +732,45 @@
             x += grid_size_snapped
         for gl in self.gridlinesy:
             gl.setLine(-1e10, y, 1e10, y)
             y += grid_size_snapped
         self.grid_size_snapped = grid_size_snapped
         self.update_gridsize_label()
 
-    def update_gridsize_label(self):
+    def update_gridsize_label(self) -> None:
         self.gridsize_label.setText(f"grid size = {str(self.grid_size_snapped)}")
         self.gridsize_label.move(QPoint(5, self.height() - 25))
 
-    def update_mouse_position_label(self):
+    def update_mouse_position_label(self) -> None:
         self.position_label.setText(
             "X = {:0.4f} / Y = {:0.4f}".format(
                 self.mouse_position[0], self.mouse_position[1]
             )
         )
         self.position_label.move(QPoint(self.width() - 250, self.height() - 25))
 
-    def update_help_label(self):
+    def update_help_label(self) -> None:
         self.help_label.setText('Press "?" key for help')
         self.help_label.move(QPoint(self.width() - 175, 0))
 
-    def create_grid(self):
+    def create_grid(self) -> None:
         self.gridlinesx = [
             self.scene.addLine(-10, -10, 10, 10, self.gridpen) for _ in range(300)
         ]
 
         self.gridlinesy = [
             self.scene.addLine(-10, -10, 10, 10, self.gridpen) for _ in range(300)
         ]
 
         self.update_grid()
 
     # ==============================================================================
     #  Mousewheel zoom, taken from http://stackoverflow.com/a/29026916
     # ==============================================================================
-    def wheelEvent(self, event):
+    def wheelEvent(self, event) -> None:
         # Zoom Factor
         zoom_percentage = 1.4
 
         # Set Anchors
         self.setTransformationAnchor(QGraphicsView.NoAnchor)
         self.setResizeAnchor(QGraphicsView.NoAnchor)
 
@@ -808,29 +808,29 @@
         # Get the new position and move scene to old position
         newPos = self.mapToScene(event.pos())
         delta = newPos - oldPos
         self.translate(delta.x(), delta.y())
 
         self.update_grid()
 
-    def zoom_view(self, zoom_factor):
+    def zoom_view(self, zoom_factor) -> None:
         old_center = self.mapToScene(self.rect().center())
         self.scale(zoom_factor, zoom_factor)
         self.centerOn(old_center)
         self.zoom_factor_total *= zoom_factor
 
-    def resizeEvent(self, event):
+    def resizeEvent(self, event) -> None:
         super(QGraphicsView, self).resizeEvent(event)
         if self.scene_bounding_rect is not None:
             self.reset_view()
         self.update_gridsize_label()
         self.update_mouse_position_label()
         self.update_help_label()
 
-    def mousePressEvent(self, event):
+    def mousePressEvent(self, event) -> None:
         super(QGraphicsView, self).mousePressEvent(event)
         # ==============================================================================
         #  Zoom to rectangle, from
         #  https://wiki.python.org/moin/PyQt/Selecting%20a%20region%20of%20a%20widget
         # ==============================================================================
         if event.button() == Qt.RightButton:
             self._mousePressed = Qt.RightButton
@@ -843,15 +843,15 @@
         # ==============================================================================
         elif event.button() == Qt.MidButton:
             self._mousePressed = Qt.MidButton
             self._mousePressedPos = event.pos()
             self.setCursor(QtCore.Qt.ClosedHandCursor)
             self._dragPos = event.pos()
 
-    def mouseMoveEvent(self, event):
+    def mouseMoveEvent(self, event) -> None:
         super(QGraphicsView, self).mouseMoveEvent(event)
 
         # # Useful debug
         # try:
         #     self.debug_label.setText(str(itemsBoundingRect_nogrid().width()))
         # except Exception:
         #     print('Debug statement failed')
@@ -876,15 +876,15 @@
             )
             self.verticalScrollBar().setValue(
                 self.verticalScrollBar().value() - diff.y()
             )
 
     #            event.accept()
 
-    def mouseReleaseEvent(self, event):
+    def mouseReleaseEvent(self, event) -> None:
         if event.button() == Qt.RightButton:
             self.rubberBand.hide()
             rb_rect = QRect(self._rb_origin, event.pos())
             rb_center = rb_rect.center()
             rb_size = rb_rect.size()
 
             if abs(rb_size.width()) > 3 and abs(rb_size.height()) > 3:
@@ -902,15 +902,15 @@
             self.update_grid()
 
         if event.button() == Qt.MidButton:
             self.setCursor(Qt.ArrowCursor)
             self._mousePressed = None
             self.update_grid()
 
-    def keyPressEvent(self, event):
+    def keyPressEvent(self, event) -> None:
         if event.key() == Qt.Key_Escape:
             self.reset_view()
 
         if event.key() == Qt.Key_F1:
             self.set_alias_visibility(not self.aliases_visible)
 
         if event.key() == Qt.Key_F2:
```

### Comparing `gdsfactory-6.93.1/gdsfactory/read/__init__.py` & `gdsfactory-6.94.0/gdsfactory/read/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/read/from_dphox.py` & `gdsfactory-6.94.0/gdsfactory/read/from_dphox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/read/from_gdspaths.py` & `gdsfactory-6.94.0/gdsfactory/read/from_gdspaths.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/read/from_np.py` & `gdsfactory-6.94.0/gdsfactory/read/from_np.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/read/from_phidl.py` & `gdsfactory-6.94.0/gdsfactory/read/from_phidl.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/read/from_yaml.py` & `gdsfactory-6.94.0/gdsfactory/read/from_yaml.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/read/from_yaml_template.py` & `gdsfactory-6.94.0/gdsfactory/read/from_yaml_template.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/read/import_gds.py` & `gdsfactory-6.94.0/gdsfactory/read/import_gds.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/read/labels.py` & `gdsfactory-6.94.0/gdsfactory/read/labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/__init__.py` & `gdsfactory-6.94.0/gdsfactory/routing/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/add_electrical_pads_shortest.py` & `gdsfactory-6.94.0/gdsfactory/routing/add_electrical_pads_shortest.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/add_electrical_pads_top.py` & `gdsfactory-6.94.0/gdsfactory/routing/add_electrical_pads_top.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/add_electrical_pads_top_dc.py` & `gdsfactory-6.94.0/gdsfactory/routing/add_electrical_pads_top_dc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/add_fiber_array.py` & `gdsfactory-6.94.0/gdsfactory/routing/add_fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/add_fiber_single.py` & `gdsfactory-6.94.0/gdsfactory/routing/add_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/add_pads.py` & `gdsfactory-6.94.0/gdsfactory/routing/add_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/all_angle.py` & `gdsfactory-6.94.0/gdsfactory/routing/all_angle.py`

 * *Files 0% similar despite different names*

```diff
@@ -884,15 +884,15 @@
                 port1.orientation,
                 port2.center,
                 port2.orientation,
                 raise_error=False,
             )
             report_segment_separation = None
 
-            def _report_separations_w_steps(refs):
+            def _report_separations_w_steps(refs) -> None:
                 segment_separations.append(_get_minimum_separation(refs))
 
             if steps:
                 angles.insert(-1, port1.orientation)
                 waypoints.insert(-1, intersect)
                 report_segment_separation = _report_separations_w_steps
             bend_angle = difference_between_angles(
```

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/auto_taper.py` & `gdsfactory-6.94.0/gdsfactory/routing/auto_taper.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/factories.py` & `gdsfactory-6.94.0/gdsfactory/routing/factories.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/fanout.py` & `gdsfactory-6.94.0/gdsfactory/routing/fanout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/fanout2x2.py` & `gdsfactory-6.94.0/gdsfactory/routing/fanout2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/get_bundle.py` & `gdsfactory-6.94.0/gdsfactory/routing/get_bundle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/get_bundle_corner.py` & `gdsfactory-6.94.0/gdsfactory/routing/get_bundle_corner.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 from __future__ import annotations
 
-from typing import Callable, List
+from typing import Optional, Callable, List
 
 import numpy as np
 
 from gdsfactory.component_layout import _rotate_points
 from gdsfactory.port import Port
 from gdsfactory.routing.get_route import get_route_from_waypoints
 from gdsfactory.routing.manhattan import generate_manhattan_waypoints
@@ -57,15 +57,15 @@
 
 
 def get_bundle_corner(
     ports1: List[Port],
     ports2: List[Port],
     route_filter: Callable[..., Route] = get_route_from_waypoints,
     separation: float = 5.0,
-    path_length_match_loops: int = None,
+    path_length_match_loops: Optional[int] = None,
     path_length_match_extra_length: float = 0.0,
     path_length_match_modify_segment_i: int = -2,
     **kwargs,
 ) -> List[Route]:
     r"""Connect banks of ports with either 90Deg or 270Deg angle between them.
 
     Args:
```

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/get_bundle_from_steps.py` & `gdsfactory-6.94.0/gdsfactory/routing/get_bundle_from_steps.py`

 * *Files 2% similar despite different names*

```diff
@@ -30,15 +30,15 @@
     steps: Optional[List[Step]] = None,
     bend: ComponentSpec = bend_euler,
     straight: ComponentSpec = straight_function,
     taper: Optional[ComponentSpec] = taper_function,
     cross_section: Union[CrossSectionSpec, MultiCrossSectionAngleSpec] = "strip",
     sort_ports: bool = True,
     separation: Optional[float] = None,
-    path_length_match_loops: int = None,
+    path_length_match_loops: Optional[int] = None,
     path_length_match_extra_length: float = 0.0,
     path_length_match_modify_segment_i: int = -2,
     **kwargs,
 ) -> List[Route]:
     """Returns a list of routes formed by the given waypoints steps.
 
     Can add bends instead of corners and optionally tapers in straight sections.
```

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/get_bundle_from_waypoints.py` & `gdsfactory-6.94.0/gdsfactory/routing/get_bundle_from_waypoints.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/get_bundle_path_length_match.py` & `gdsfactory-6.94.0/gdsfactory/routing/get_bundle_path_length_match.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/get_bundle_sbend.py` & `gdsfactory-6.94.0/gdsfactory/routing/get_bundle_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/get_bundle_u.py` & `gdsfactory-6.94.0/gdsfactory/routing/get_bundle_u.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/get_input_labels.py` & `gdsfactory-6.94.0/gdsfactory/routing/get_input_labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/get_route.py` & `gdsfactory-6.94.0/gdsfactory/routing/get_route.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/get_route_astar.py` & `gdsfactory-6.94.0/gdsfactory/routing/get_route_astar.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,40 +1,40 @@
 from __future__ import annotations
 
-from typing import List
+from typing import Optional, List
 from warnings import warn
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory import Port
 from gdsfactory.component import Component
 from gdsfactory.components.wire import wire_corner
 from gdsfactory.routing import get_route_from_waypoints
 from gdsfactory.routing.manhattan import route_manhattan
 from gdsfactory.typings import CrossSectionSpec, LayerSpec, Route
 
 
 class Node:
-    def __init__(self, parent=None, position: tuple = ()):
+    def __init__(self, parent=None, position: tuple = ()) -> None:
         """Initializes a node. A node is a point on the grid."""
         self.parent = parent  # parent node of current node
         self.position = position  # position of current node
 
         self.g = 0  # distance between current node and start node
         self.h = 0  # distance between current node and end node
         self.f = self.g + self.h  # cost of the node (sum of g and h)
 
 
 def get_route_astar(
     component: Component,
     port1: Port,
     port2: Port,
     resolution: float = 1,
-    avoid_layers: List[LayerSpec] = None,
+    avoid_layers: Optional[List[LayerSpec]] = None,
     distance: float = 1,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Route:
     """A* routing function. Finds a route between two ports avoiding obstacles.
 
     Args:
@@ -174,23 +174,23 @@
             # Add the neighbour to open_list
             open_list.append(neighbour)
 
     warn("A* algorithm failed, resorting to Manhattan routing. Watch for overlaps.")
     return route_manhattan(port1, port2, cross_section=cross_section)
 
 
-def _extract_all_bbox(c: Component, avoid_layers: List[LayerSpec] = None):
+def _extract_all_bbox(c: Component, avoid_layers: Optional[List[LayerSpec]] = None):
     """Extract all polygons whose layer is in `avoid_layers`."""
     return [c.get_polygons(layer) for layer in avoid_layers]
 
 
 def _generate_grid(
     c: Component,
     resolution: float = 0.5,
-    avoid_layers: List[LayerSpec] = None,
+    avoid_layers: Optional[List[LayerSpec]] = None,
     distance: float = 1,
 ) -> np.ndarray:
     """Generate discretization grid that the algorithm will step through."""
     bbox = c.bbox
     x, y = np.meshgrid(
         np.linspace(
             bbox[0][0],
```

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/get_route_from_steps.py` & `gdsfactory-6.94.0/gdsfactory/routing/get_route_from_steps.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/get_route_sbend.py` & `gdsfactory-6.94.0/gdsfactory/routing/get_route_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/get_routes_bend180.py` & `gdsfactory-6.94.0/gdsfactory/routing/get_routes_bend180.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/get_routes_straight.py` & `gdsfactory-6.94.0/gdsfactory/routing/get_routes_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/manhattan.py` & `gdsfactory-6.94.0/gdsfactory/routing/manhattan.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/path_length_matching.py` & `gdsfactory-6.94.0/gdsfactory/routing/path_length_matching.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/route_fiber_array.py` & `gdsfactory-6.94.0/gdsfactory/routing/route_fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/route_fiber_single.py` & `gdsfactory-6.94.0/gdsfactory/routing/route_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/route_ports_to_side.py` & `gdsfactory-6.94.0/gdsfactory/routing/route_ports_to_side.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/route_quad.py` & `gdsfactory-6.94.0/gdsfactory/routing/route_quad.py`

 * *Files 2% similar despite different names*

```diff
@@ -22,15 +22,15 @@
 @gf.cell
 def route_quad(
     port1: Port,
     port2: Port,
     width1: Optional[float] = None,
     width2: Optional[float] = None,
     layer: gf.typings.LayerSpec = "M1",
-    manhattan_target_step: float = None,
+    manhattan_target_step: Optional[float] = None,
 ) -> gf.Component:
     """Routes a basic quadrilateral polygon directly between two ports.
 
     Args:
         port1: Port to start route.
         port2 : Port objects to end route.
         width1: Width of quadrilateral at ports. If None, uses port widths.
@@ -98,15 +98,15 @@
         orientation=port2.orientation + 180,
         width=width2,
         layer=layer,
     )
     return component
 
 
-def test_manhattan_route_quad():
+def test_manhattan_route_quad() -> None:
     c = gf.Component("route")
     pad1 = c << gf.components.pad(size=(50, 50))
     pad2 = c << gf.components.pad(size=(10, 10))
     pad2.movex(100)
     pad2.movey(50)
     route_gnd = c << route_quad(
         pad1.ports["e2"],
```

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/route_sharp.py` & `gdsfactory-6.94.0/gdsfactory/routing/route_sharp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/route_south.py` & `gdsfactory-6.94.0/gdsfactory/routing/route_south.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/sort_ports.py` & `gdsfactory-6.94.0/gdsfactory/routing/sort_ports.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/routing/utils.py` & `gdsfactory-6.94.0/gdsfactory/routing/utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/01_component_pcell.py` & `gdsfactory-6.94.0/gdsfactory/samples/01_component_pcell.py`

 * *Files 2% similar despite different names*

```diff
@@ -33,15 +33,15 @@
     )
     wg.add_port(
         name="o2", center=(length, width / 2), width=width, orientation=0, layer=layer
     )
     return wg
 
 
-def test_straight_wide(data_regression):
+def test_straight_wide(data_regression) -> None:
     component = straight_wide()
     data_regression.check(component.to_dict())
 
 
 # ==============================================================================
 # Create a blank component
 # ==============================================================================
```

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/01_component_pcell/test_straight_wide.yml` & `gdsfactory-6.94.0/gdsfactory/samples/01_component_pcell/test_straight_wide.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/01_component_pcell_with_pins.py` & `gdsfactory-6.94.0/gdsfactory/samples/01_component_pcell_with_pins.py`

 * *Files 1% similar despite different names*

```diff
@@ -25,15 +25,15 @@
     )
     wg.add_port(
         name="o2", center=(length, width / 2), width=width, orientation=0, layer=layer
     )
     return wg
 
 
-def test_straight_narrow(data_regression):
+def test_straight_narrow(data_regression) -> None:
     component = straight_narrow()
     data_regression.check(component.to_dict())
 
 
 if __name__ == "__main__":
     wg = straight_narrow(decorator=gf.add_pins.add_pins)
```

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml` & `gdsfactory-6.94.0/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/03_move.py` & `gdsfactory-6.94.0/gdsfactory/samples/03_move.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/04_connect.py` & `gdsfactory-6.94.0/gdsfactory/samples/04_connect.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/05_remove_layers.py` & `gdsfactory-6.94.0/gdsfactory/samples/05_remove_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/06_remapping_layers.py` & `gdsfactory-6.94.0/gdsfactory/samples/06_remapping_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/07_flattening_device.py` & `gdsfactory-6.94.0/gdsfactory/samples/07_flattening_device.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/11_component_layout.py` & `gdsfactory-6.94.0/gdsfactory/samples/11_component_layout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/12_component_refs.py` & `gdsfactory-6.94.0/gdsfactory/samples/12_component_refs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/13_component_netlist.py` & `gdsfactory-6.94.0/gdsfactory/samples/13_component_netlist.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/14_component_connectivity.py` & `gdsfactory-6.94.0/gdsfactory/samples/14_component_connectivity.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/15_component_sequence1.py` & `gdsfactory-6.94.0/gdsfactory/samples/15_component_sequence1.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/16_component_sequence2.py` & `gdsfactory-6.94.0/gdsfactory/samples/16_component_sequence2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/17_ports.py` & `gdsfactory-6.94.0/gdsfactory/samples/17_ports.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/20_components.py` & `gdsfactory-6.94.0/gdsfactory/samples/20_components.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/22_add_pads.py` & `gdsfactory-6.94.0/gdsfactory/samples/22_add_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/23_reticle.py` & `gdsfactory-6.94.0/gdsfactory/samples/23_reticle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/23_reticle_passives.py` & `gdsfactory-6.94.0/gdsfactory/samples/23_reticle_passives.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/24_doe_2.py` & `gdsfactory-6.94.0/gdsfactory/samples/24_doe_2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/24_doe_3.py` & `gdsfactory-6.94.0/gdsfactory/samples/24_doe_3.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/30_lidar.py` & `gdsfactory-6.94.0/gdsfactory/samples/30_lidar.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/30_lidar_pcell.py` & `gdsfactory-6.94.0/gdsfactory/samples/30_lidar_pcell.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/30_lidar_with_pads.py` & `gdsfactory-6.94.0/gdsfactory/samples/30_lidar_with_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing.py` & `gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml` & `gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml` & `gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml` & `gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml` & `gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml` & `gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml` & `gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml` & `gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml` & `gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml` & `gdsfactory-6.94.0/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/big_device.py` & `gdsfactory-6.94.0/gdsfactory/samples/big_device.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/demo/benchmark/fill_demo.py` & `gdsfactory-6.94.0/gdsfactory/samples/demo/benchmark/fill_demo.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/demo/circuits/mask.pic.yml` & `gdsfactory-6.94.0/gdsfactory/samples/demo/circuits/mask.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml` & `gdsfactory-6.94.0/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml` & `gdsfactory-6.94.0/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/demo/drc_errors.py` & `gdsfactory-6.94.0/gdsfactory/samples/demo/drc_errors.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/demo/layers.py` & `gdsfactory-6.94.0/gdsfactory/samples/demo/layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/demo/lvs.py` & `gdsfactory-6.94.0/gdsfactory/samples/demo/lvs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/demo/pcell.py` & `gdsfactory-6.94.0/gdsfactory/samples/demo/pcell.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/netlists/mzi.yml` & `gdsfactory-6.94.0/gdsfactory/samples/netlists/mzi.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/netlists/mzi_full.yml` & `gdsfactory-6.94.0/gdsfactory/samples/netlists/mzi_full.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/fab_c.py` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/fab_c.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/fab_d/phase_shifters.py` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/fab_d/phase_shifters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c.py` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml` & `gdsfactory-6.94.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/schematic_editor.py` & `gdsfactory-6.94.0/gdsfactory/schematic_editor.py`

 * *Files 6% similar despite different names*

```diff
@@ -12,15 +12,17 @@
     Route,
     RouteSettings,
     SchematicConfiguration,
 )
 
 
 class SchematicEditor:
-    def __init__(self, filename: Union[str, Path], pdk: Optional[gf.Pdk] = None):
+    def __init__(
+        self, filename: Union[str, Path], pdk: Optional[gf.Pdk] = None
+    ) -> None:
         """An interactive Schematic editor, meant to be used from a Jupyter Notebook.
 
         Args:
             filename: the filename or path to use for the input/output schematic
             pdk: the PDK to use (uses the current active PDK if None)
         """
         filepath = filename if isinstance(filename, Path) else Path(filename)
@@ -136,20 +138,20 @@
         row._remove_button = remove_button
 
         remove_button._row = row
         port_name_box._row = row
         instance_port_selector._row = row
         return row
 
-    def _update_instance_options(self, **kwargs):
+    def _update_instance_options(self, **kwargs) -> None:
         inst_names = self._schematic.instances.keys()
         for inst_box in self._inst_boxes:
             inst_box.options = list(inst_names)
 
-    def _make_instance_removable(self, instance_name, **kwargs):
+    def _make_instance_removable(self, instance_name, **kwargs) -> None:
         for row in self._instance_grid.children:
             if row._instance_box.value == instance_name:
                 row._remove_button.disabled = False
                 return
 
     def _get_net_selector(self, inst1=None, port1=None, inst2=None, port2=None):
         inst_names = list(self._schematic.instances.keys())
@@ -170,60 +172,60 @@
             port1_selector.value = port1
         if port2:
             port2_selector.value = port2
         return widgets.Box(
             [inst1_selector, port1_selector, inst2_selector, port2_selector]
         )
 
-    def _add_row_when_full(self, change):
+    def _add_row_when_full(self, change) -> None:
         if change["old"] == "" and change["new"] != "":
             this_box = change["owner"]
             last_box = self._instance_grid.children[-1].children[0]
             if this_box is last_box:
                 new_row = self._get_instance_selector()
                 self._instance_grid.children += (new_row,)
                 new_row.children[0].observe(self._add_row_when_full, names=["value"])
                 new_row.children[1].observe(
                     self._on_instance_component_modified, names=["value"]
                 )
                 new_row._associated_component = None
 
-    def _add_net_row_when_full(self, change):
+    def _add_net_row_when_full(self, change) -> None:
         if change["old"] == "" and change["new"] != "":
             this_box = change["owner"]
             last_box = self._net_grid.children[-1].children[0]
             if this_box is last_box:
                 new_row = self._get_net_selector()
                 self._net_grid.children += (new_row,)
                 new_row.children[0].observe(
                     self._add_net_row_when_full, names=["value"]
                 )
                 for child in new_row.children:
                     child.observe(self._on_net_modified, names=["value"])
                 new_row._associated_component = None
 
-    def _update_schematic_plot(self, **kwargs):
+    def _update_schematic_plot(self, **kwargs) -> None:
         circuitviz.update_schematic_plot(
             schematic=self._schematic,
             instances=self.symbols,
         )
 
-    def _on_instance_component_modified(self, change):
+    def _on_instance_component_modified(self, change) -> None:
         this_box = change["owner"]
         inst_box = this_box._instance_selector
         inst_name = inst_box.value
         component_name = this_box.value
 
         if change["old"] == "":
             if change["new"] != "":
                 self.add_instance(instance_name=inst_name, component=component_name)
         elif change["new"] != change["old"]:
             self.update_component(instance=inst_name, component=component_name)
 
-    def _on_remove_button_clicked(self, button):
+    def _on_remove_button_clicked(self, button) -> None:
         row = button._row
         self.remove_instance(instance_name=row._instance_box.value)
         self._instance_grid.children = tuple(
             child for child in self._instance_grid.children if child is not row
         )
 
     def _get_data_from_row(self, row):
@@ -241,15 +243,15 @@
         return [c.value for c in row.children]
 
     def _get_net_data(self):
         net_data = [self._get_net_from_row(row) for row in self._net_grid.children]
         net_data = [d for d in net_data if "" not in d]
         return net_data
 
-    def _on_net_modified(self, change):
+    def _on_net_modified(self, change) -> None:
         if change["new"] == change["old"]:
             return
         net_data = self._get_net_data()
         new_nets = [[f"{n[0]},{n[1]}", f"{n[2]},{n[3]}"] for n in net_data]
         connected_ports = {}
         for n1, n2 in new_nets:
             connected_ports[n1] = n2
@@ -268,15 +270,15 @@
     def net_widget(self):
         return self._net_grid
 
     @property
     def port_widget(self):
         return self._port_grid
 
-    def visualize(self):
+    def visualize(self) -> None:
         circuitviz.show_netlist(self.schematic, self.symbols, self.path)
 
         self.on_instance_added.append(self._update_schematic_plot)
         self.on_settings_updated.append(self._update_schematic_plot)
         self.on_nets_modified.append(self._update_schematic_plot)
         self.on_instance_removed.append(self._update_schematic_plot)
 
@@ -297,31 +299,35 @@
         insts = {}
         inst_data = self._schematic.instances
         for inst_name, inst in inst_data.items():
             component_spec = inst.dict()
             insts[inst_name] = self.pdk.get_symbol(component_spec)
         return insts
 
-    def add_instance(self, instance_name: str, component: Union[str, gf.Component]):
+    def add_instance(
+        self, instance_name: str, component: Union[str, gf.Component]
+    ) -> None:
         self._schematic.add_instance(name=instance_name, component=component)
         for callback in self.on_instance_added:
             callback(instance_name=instance_name)
 
-    def remove_instance(self, instance_name: str):
+    def remove_instance(self, instance_name: str) -> None:
         self._schematic.instances.pop(instance_name)
         if instance_name in self._schematic.placements:
             self._schematic.placements.pop(instance_name)
         for callback in self.on_instance_removed:
             callback(instance_name=instance_name)
 
-    def update_component(self, instance, component):
+    def update_component(self, instance, component) -> None:
         self._schematic.instances[instance].component = component
         self.update_settings(instance=instance, clear_existing=True)
 
-    def update_settings(self, instance, clear_existing: bool = False, **settings):
+    def update_settings(
+        self, instance, clear_existing: bool = False, **settings
+    ) -> None:
         old_settings = self._schematic.instances[instance].settings.copy()
         if clear_existing:
             self._schematic.instances[instance].settings.clear()
         if settings:
             self._schematic.instances[instance].settings.update(settings)
         for callback in self.on_settings_updated:
             callback(
@@ -354,20 +360,20 @@
     def get_netlist(self):
         return self._schematic.dict()
 
     @property
     def schematic(self):
         return self._schematic
 
-    def write_netlist(self, **kwargs):
+    def write_netlist(self, **kwargs) -> None:
         netlist = self.get_netlist()
         with open(self.path, mode="w") as f:
             yaml.dump(netlist, f, default_flow_style=None, sort_keys=False)
 
-    def load_netlist(self):
+    def load_netlist(self) -> None:
         with open(self.path) as f:
             netlist = yaml.safe_load(f)
 
         schematic = SchematicConfiguration.parse_obj(netlist)
         self._schematic = schematic
 
         # process instances
```

### Comparing `gdsfactory-6.93.1/gdsfactory/serialization.py` & `gdsfactory-6.94.0/gdsfactory/serialization.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/show.py` & `gdsfactory-6.94.0/gdsfactory/show.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/__init__.py` & `gdsfactory-6.94.0/gdsfactory/simulation/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/add_simulation_markers.py` & `gdsfactory-6.94.0/gdsfactory/simulation/add_simulation_markers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/convert_sparameters.py` & `gdsfactory-6.94.0/gdsfactory/simulation/convert_sparameters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/devsim/__init__.py` & `gdsfactory-6.94.0/gdsfactory/simulation/devsim/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/devsim/doping.py` & `gdsfactory-6.94.0/gdsfactory/simulation/devsim/doping.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/devsim/get_simulation.py` & `gdsfactory-6.94.0/gdsfactory/simulation/devsim/get_simulation.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/devsim/get_simulation_xsection.py` & `gdsfactory-6.94.0/gdsfactory/simulation/devsim/get_simulation_xsection.py`

 * *Files 0% similar despite different names*

```diff
@@ -346,15 +346,17 @@
             else:
                 # it is more correct for the bias to be 0, and it looks like there is side effects
                 devsim.set_parameter(
                     device=device, name=simple_physics.GetContactBiasName(i), value=0.0
                 )
                 simple_physics.CreateSiliconPotentialOnlyContact(device, region, i)
 
-    def drift_diffusion_initial_solution(self, device, region, circuit_contacts=None):
+    def drift_diffusion_initial_solution(
+        self, device, region, circuit_contacts=None
+    ) -> None:
         # drift diffusion solution variables
         model_create.CreateSolution(device, region, "Electrons")
         model_create.CreateSolution(device, region, "Holes")
 
         # create initial guess from dc only solution
         devsim.set_node_values(
             device=device,
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/devsim/get_solver.py` & `gdsfactory-6.94.0/gdsfactory/simulation/devsim/get_solver.py`

 * *Files 1% similar despite different names*

```diff
@@ -28,15 +28,15 @@
     DopingLayerLevel,
     get_doping_info_generic,
 )
 from gdsfactory.simulation.devsim.get_simulation import create_2Duz_simulation
 from gdsfactory.technology import LayerStack
 
 
-def set_universal_parameters(device, region):
+def set_universal_parameters(device, region) -> None:
     universal = {
         "q": 1.6e-19,  # , 'coul'),
         "k": 1.3806503e-23,  # , 'J/K'),
         "Permittivity_0": 8.85e-14,  # , 'F/cm^2')
     }
     for k, v in universal.items():
         set_parameter(device=device, region=region, name=k, value=v)
@@ -142,15 +142,15 @@
             self.set_extended_precision()
 
     class Config:
         """Enable adding new."""
 
         extra = Extra.allow
 
-    def set_extended_precision(self):
+    def set_extended_precision(self) -> None:
         set_parameter(name="extended_solver", value=True)
         set_parameter(name="extended_model", value=True)
         set_parameter(name="extended_equation", value=True)
 
     def set_parameters(self, region, device) -> None:
         """Set parameters for 300 K."""
         simple_physics.SetSiliconParameters(device, region, 300)
@@ -171,15 +171,17 @@
             else:
                 # it is more correct for the bias to be 0, and it looks like there is side effects
                 set_parameter(
                     device=device, name=simple_physics.GetContactBiasName(i), value=0.0
                 )
                 simple_physics.CreateSiliconPotentialOnlyContact(device, region, i)
 
-    def drift_diffusion_initial_solution(self, device, region, circuit_contacts=None):
+    def drift_diffusion_initial_solution(
+        self, device, region, circuit_contacts=None
+    ) -> None:
         # drift diffusion solution variables
         model_create.CreateSolution(device, region, "Electrons")
         model_create.CreateSolution(device, region, "Holes")
 
         # create initial guess from dc only solution
         set_node_values(
             device=device,
@@ -324,15 +326,15 @@
         """Delete this devsim device and mesh."""
         delete_mesh(mesh=self.devsim_mesh_name)
         delete_device(device=self.devsim_mesh_name)
 
     def get_refined_mesh(
         self,
         factor: float = 2.0,
-        refine_dict: Dict[str, Dict] = None,
+        refine_dict: Optional[Dict[str, Dict]] = None,
         refine_regions: Tuple[str, ...] = ("si",),
     ):
         """Refines the mesh based on simulation result.
 
         Currently only remeshes in silicon regions.
 
         Arguments:
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/devsim/test_devsim.py` & `gdsfactory-6.94.0/gdsfactory/simulation/devsim/test_devsim.py`

 * *Files 0% similar despite different names*

```diff
@@ -2,15 +2,15 @@
 from gdsfactory.simulation.devsim import get_simulation_xsection
 import gdsfactory as gf
 
 PDK = gf.get_generic_pdk()
 PDK.activate()
 
 
-def test_pin_waveguide():
+def test_pin_waveguide() -> None:
     """Test reverse bias waveguide."""
     nm = 1e-9
     c = get_simulation_xsection.PINWaveguide(
         wg_width=500 * nm,
         core_thickness=220 * nm,
         slab_thickness=90 * nm,
     )
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/eme/meow_eme.py` & `gdsfactory-6.94.0/gdsfactory/simulation/eme/meow_eme.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/eme/test_meow_simulation.py` & `gdsfactory-6.94.0/gdsfactory/simulation/eme/test_meow_simulation.py`

 * *Files 4% similar despite different names*

```diff
@@ -5,15 +5,15 @@
 from gdsfactory.simulation.eme import MEOW
 from gdsfactory.technology import LayerStack
 
 PDK = gf.get_generic_pdk()
 PDK.activate()
 
 
-def test_meow_defaults():
+def test_meow_defaults() -> None:
     c = gf.components.taper_cross_section_linear()
     filtered_layerstack = LayerStack(
         layers={
             k: get_layer_stack().layers[k]
             for k in (
                 "slab90",
                 "core",
@@ -38,15 +38,15 @@
         port2, mode2 = entry2.split("@")
         if port1 != port2 and mode1 == "0" and mode2 == "0":
             assert np.abs(sp[key]) ** 2 > 0.9
         elif port1 != port2 and mode1 == "1" and mode2 == "1":
             assert np.abs(sp[key]) ** 2 > 0.2
 
 
-def test_cells():
+def test_cells() -> None:
     layerstack = LayerStack(
         layers={
             k: get_layer_stack().layers[k]
             for k in (
                 "slab90",
                 "core",
                 "box",
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/fem/mode_solver.py` & `gdsfactory-6.94.0/gdsfactory/simulation/fem/mode_solver.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/fem/test_mode_solver.py` & `gdsfactory-6.94.0/gdsfactory/simulation/fem/test_mode_solver.py`

 * *Files 4% similar despite different names*

```diff
@@ -46,20 +46,20 @@
         resolutions=resolutions,
         overwrite=overwrite,
         with_cache=with_cache,
     )
     return lams, basis, xs
 
 
-def test_compute_cross_section_mode():
+def test_compute_cross_section_mode() -> None:
     lams, basis, xs = compute_modes()
     assert len(lams) == NUM_MODES, len(lams)
 
 
-def test_compute_cross_section_mode_cache():
+def test_compute_cross_section_mode_cache() -> None:
     # write mode in cache
     lams, basis, xs = compute_modes(with_cache=True, overwrite=False)
 
     # load mode from cache
     lams, basis, xs = compute_modes(with_cache=True, overwrite=False)
     mode_solver.plot_mode(
         basis=basis,
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/get_effective_indices.py` & `gdsfactory-6.94.0/gdsfactory/simulation/get_effective_indices.py`

 * *Files 2% similar despite different names*

```diff
@@ -99,15 +99,15 @@
     for index in indices_temp:
         if not any(np.isclose(index, i, atol=1e-5) for i in indices):
             indices.append(index)
 
     return np.sqrt(indices).tolist()
 
 
-def test_effective_index():
+def test_effective_index() -> None:
     neff = get_effective_indices(
         core_material=3.4777,
         clad_materialding=1.444,
         nsubstrate=1.444,
         thickness=0.22,
         wavelength=1.55,
         polarization="te",
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/get_modes_path.py` & `gdsfactory-6.94.0/gdsfactory/simulation/get_modes_path.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/get_sparameters_path.py` & `gdsfactory-6.94.0/gdsfactory/simulation/get_sparameters_path.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/__init__.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/get_material.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/get_material.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/get_meep_geometry.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/get_meep_geometry.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/get_port_eigenmode.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/get_port_eigenmode.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/get_simulation.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/get_simulation.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/get_simulation_grating_farfield.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/get_simulation_grating_farfield.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/get_simulation_grating_fiber.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/get_simulation_grating_fiber.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/meep_adjoint_optimization.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/meep_adjoint_optimization.py`

 * *Files 0% similar despite different names*

```diff
@@ -190,15 +190,15 @@
     update_variable: np.ndarray,
     maximize_cost_function: bool = True,
     algorithm: int = nlopt.LD_MMA,
     lower_bound: Any = 0,
     upper_bound: Any = 1,
     maxeval: int = 10,
     get_optimized_component: bool = False,
-    opt: OptimizationProblem = None,
+    opt: Optional[OptimizationProblem] = None,
     **kwargs,
 ) -> Union[ndarray, Component]:
     """Run adjoint optimization using Meep.
 
     Args:
         number_of_params: number of parameters to optimize (usually resolution_in_x * resolution_in_y).
         cost_function: cost function to optimize.
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_eigenmode.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_eigenmode.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_materials.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_materials.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_crossing.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_crossing.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_straight.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_straight.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_crossing.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_crossing.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_straight.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_straight.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_symmetries_straight.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_symmetries_straight.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi_pool.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi_pool.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_crossing_symmetric.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_crossing_symmetric.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_batch.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_batch.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi_pool.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi_pool.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_symmetric.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_symmetric.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/write_sparameters_grating.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/write_sparameters_grating.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/write_sparameters_meep.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/write_sparameters_meep.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/write_sparameters_meep_batch.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/write_sparameters_meep_batch.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmeep/write_sparameters_meep_mpi.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmeep/write_sparameters_meep_mpi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmsh/__init__.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmsh/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmsh/break_geometry.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmsh/break_geometry.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmsh/mesh.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmsh/mesh.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmsh/meshtracker.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmsh/meshtracker.py`

 * *Files 0% similar despite different names*

```diff
@@ -5,15 +5,15 @@
 import shapely
 from shapely.geometry import LineString, Point, Polygon
 from shapely.ops import linemerge, split
 import numpy as np
 
 
 class MeshTracker:
-    def __init__(self, model, atol=1e-4):
+    def __init__(self, model, atol=1e-4) -> None:
         """Map between shapely and gmsh.
 
         Shapely is useful for built-in geometry equivalencies and extracting orientation, instead of doing it manually
         We can also track information about the entities using labels (useful for selective mesh refinement later)
 
         TODO: Break into subclasses
         """
@@ -140,15 +140,15 @@
                 )
             )
             self.gmsh_xy_segments.append(gmsh_segment)
             self.xy_segments_main_labels.append(label)
             self.xy_segments_secondary_labels.append(None)
         return gmsh_segment, orientation
 
-    def add_get_xy_line(self, shapely_xy_curve, label, zs=None):
+    def add_get_xy_line(self, shapely_xy_curve, label, zs=None) -> None:
         """Add a shapely line (multi-point line) to the gmsh model in the xy plane, or retrieve the existing gmsh segment with equivalent coordinates (within tol.).
 
         Args:
             shapely_xy_curve (shapely.geometry.LineString): curve
         """
         segments = []
         zs = zs or [0] * len(shapely_xy_curve.coords)
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmsh/parse_component.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmsh/parse_component.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmsh/parse_gds.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmsh/parse_gds.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmsh/parse_layerstack.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmsh/parse_layerstack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmsh/refine.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmsh/refine.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmsh/scratch/mesh3D.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmsh/scratch/mesh3D.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmsh/tests/test_meshing.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmsh/tests/test_meshing.py`

 * *Files 1% similar despite different names*

```diff
@@ -7,15 +7,15 @@
 from gdsfactory.simulation.gmsh.xyz_mesh import xyz_mesh
 from gdsfactory.technology import LayerStack
 
 PDK = gf.get_generic_pdk()
 PDK.activate()
 
 
-def test_gmsh_uz_xsection_mesh():
+def test_gmsh_uz_xsection_mesh() -> None:
     waveguide = gf.components.straight_pin(length=10, taper=None)
 
     filtered_layerstack = LayerStack(
         layers={
             k: get_layer_stack().layers[k]
             for k in (
                 "slab90",
@@ -36,15 +36,15 @@
         [(4, -15), (4, 15)],
         filtered_layerstack,
         resolutions=resolutions,
         background_tag="Oxide",
     )
 
 
-def test_gmsh_xy_xsection_mesh():
+def test_gmsh_xy_xsection_mesh() -> None:
     import gdsfactory as gf
 
     waveguide = gf.components.straight_pin(length=10, taper=None)
     waveguide.show()
 
     from gdsfactory.pdk import get_layer_stack
 
@@ -68,15 +68,15 @@
         z=0.09,
         layerstack=filtered_layerstack,
         resolutions=resolutions,
         background_tag="Oxide",
     )
 
 
-def test_gmsh_xyz_holes():
+def test_gmsh_xyz_holes() -> None:
     c = gf.component.Component()
     c << gf.get_component(gf.components.ring_crow)
 
     from gdsfactory.pdk import get_layer_stack
 
     filtered_layerstack = LayerStack(
         layers={k: get_layer_stack().layers[k] for k in ("core",)}
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmsh/uz_xsection_mesh.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmsh/uz_xsection_mesh.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmsh/xy_xsection_mesh.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmsh/xy_xsection_mesh.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gmsh/xyz_mesh.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gmsh/xyz_mesh.py`

 * *Files 0% similar despite different names*

```diff
@@ -206,15 +206,15 @@
     default_resolution_min: float = 0.01,
     default_resolution_max: float = 0.5,
     filename: Optional[str] = None,
     verbosity: Optional[bool] = False,
     override_volumes: Optional[Dict] = None,
     round_tol: int = 3,
     simplify_tol: float = 1e-3,
-):
+) -> bool:
     """Full 3D mesh of component.
 
     Args:
         component (Component): gdsfactory component to mesh
         layerstack (LayerStack): gdsfactory LayerStack to parse
         resolutions (Dict): Pairs {"layername": {"resolution": float, "distance": "float}} to roughly control mesh refinement
         default_resolution_min (float): gmsh minimal edge length
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/__init__.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/get_results.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/get_results.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/get_simulation.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/get_simulation.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/get_simulation_grating_coupler.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/get_simulation_grating_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/materials.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/materials.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/modes.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/modes.py`

 * *Files 1% similar despite different names*

```diff
@@ -123,14 +123,19 @@
     grid_resolution: int = 20
     max_grid_scaling: float = 1.2
     cache: bool = True
 
     _cached_data = pydantic.PrivateAttr()
     _waveguide = pydantic.PrivateAttr()
 
+    class Config:
+        """pydantic config."""
+
+        extra = "forbid"
+
     @property
     def cache_path(self) -> Optional[PathType]:
         """Cache directory"""
         return get_modes_path()
 
     @property
     def filepath(self) -> Optional[pathlib.Path]:
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/sim_run.yaml` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/sim_run.yaml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/sim_ref.yaml` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/sim_ref.yaml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/sim_run.yaml` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/sim_run.yaml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/test_modes.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/test_modes.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,28 +1,28 @@
 from __future__ import annotations
 
 import numpy as np
 
 import gdsfactory.simulation.gtidy3d as gt
 
 
-def test_neff():
+def test_neff() -> None:
     wg = gt.modes.Waveguide(
         wavelength=1.55,
         core_width=0.5,
         core_thickness=0.22,
         core_material="si",
         clad_material="sio2",
         cache=False,
     )
     n_eff = wg.n_eff[0].real
     assert np.isclose(n_eff, 2.447, rtol=0.1), n_eff
 
 
-def test_neff_high_accuracy():
+def test_neff_high_accuracy() -> None:
     wg = gt.modes.Waveguide(
         wavelength=1.55,
         core_width=0.5,
         core_thickness=0.22,
         core_material="si",
         clad_material="sio2",
         grid_resolution=40,
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/test_results.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/test_results.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/test_simulation.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/test_simulation.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters/test_sparameters_straight.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters/test_sparameters_straight.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters_grating_coupler.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters_grating_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/utils.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/write_sparameters.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/write_sparameters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/gtidy3d/write_sparameters_grating_coupler.py` & `gdsfactory-6.94.0/gdsfactory/simulation/gtidy3d/write_sparameters_grating_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/lumerical/__init__.py` & `gdsfactory-6.94.0/gdsfactory/simulation/lumerical/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/lumerical/interconnect.py` & `gdsfactory-6.94.0/gdsfactory/simulation/lumerical/interconnect.py`

 * *Files 1% similar despite different names*

```diff
@@ -16,22 +16,24 @@
 um = 1e-6
 
 
 def install_design_kit(
     session: object,
     install_dir: pathlib.Path = PATH.interconnect,
     overwrite: bool = False,
-):
+) -> None:
     from gdsfactory.pdk import get_interconnect_cml_path
 
     cml_path = get_interconnect_cml_path()
     session.installdesignkit(str(cml_path), str(install_dir), overwrite)
 
 
-def set_named_settings(session: object, simulation_settings: dict, element: str):
+def set_named_settings(
+    session: object, simulation_settings: dict, element: str
+) -> None:
     for param, val in zip(simulation_settings.keys(), simulation_settings.values()):
         session.setnamed(element, param, val)
 
 
 # TODO: Add custom s-parameter models using compound elements
 
 
@@ -93,19 +95,19 @@
             settings["properties"][inc_name] = info[layout_name] * scale
     return settings
 
 
 def send_to_interconnect(
     component: Component,
     session: object,
-    ports_in: dict = None,
-    ports_out: dict = None,
-    placements: dict = None,
-    simulation_settings: OrderedDict = None,
-    drop_port_prefix: str = None,
+    ports_in: Optional[dict] = None,
+    ports_out: Optional[dict] = None,
+    placements: Optional[dict] = None,
+    simulation_settings: Optional[OrderedDict] = None,
+    drop_port_prefix: Optional[str] = None,
     component_distance_scaling_x: float = 1,
     component_distance_scaling_y: float = 1,
     setup_mc: bool = False,
     exclude_electrical: bool = True,
     **settings,
 ) -> object:
     """Send netlist components to Interconnect and connect them according to netlist.
@@ -422,15 +424,15 @@
         }
         for result in results
     }
 
 
 def plot_wavelength_sweep(
     ports_out, results, result_name: str = "TE Transmission", show: bool = True
-):
+) -> None:
     import matplotlib.pyplot as plt
 
     for port in ports_out:
         wl = results["transmission"][port]["wavelength"] / um
         T = 10 * np.log10(np.abs(results["transmission"][port][result_name]))
         plt.plot(wl, T, label=str(port))
     plt.legend()
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/lumerical/read.py` & `gdsfactory-6.94.0/gdsfactory/simulation/lumerical/read.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/lumerical/settings.py` & `gdsfactory-6.94.0/gdsfactory/simulation/lumerical/settings.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/lumerical/test_read_sparameters.py` & `gdsfactory-6.94.0/gdsfactory/simulation/lumerical/test_read_sparameters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/lumerical/write_sparameters_lumerical.py` & `gdsfactory-6.94.0/gdsfactory/simulation/lumerical/write_sparameters_lumerical.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/lumerical/write_sparameters_lumerical_components.py` & `gdsfactory-6.94.0/gdsfactory/simulation/lumerical/write_sparameters_lumerical_components.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/__init__.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/coupler.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/find_coupling_vs_gap.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/find_coupling_vs_gap.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/find_mode_dispersion.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/find_mode_dispersion.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/find_modes.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/find_modes.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/find_modes_cross_section.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/find_modes_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/find_neff_ng_dw_dh.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/find_neff_ng_dw_dh.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/find_neff_vs_width.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/find_neff_vs_width.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/get_mode_solver_coupler.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/get_mode_solver_coupler.py`

 * *Files 0% similar despite different names*

```diff
@@ -28,15 +28,15 @@
     core_material: float = 3.47,
     clad_material: float = 1.44,
     nslab: Optional[float] = None,
     ymargin: float = 2.0,
     sz: float = 2.0,
     resolution: int = 32,
     nmodes: int = 4,
-    sidewall_angles: Union[Tuple[float, ...], float] = None,
+    sidewall_angles: Optional[Union[Tuple[float, ...], float]] = None,
 ) -> mpb.ModeSolver:
     """Returns mode_solver simulation.
 
     Args:
         core_width: core_width (um) for the symmetric case.
         gap: for the case of only two waveguides.
         core_widths: list or tuple of waveguide widths.
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/get_mode_solver_cross_section.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/get_mode_solver_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/get_mode_solver_rib.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/get_mode_solver_rib.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/modes/neff_vs_width_nitride.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/modes/neff_vs_width_nitride.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/modes/neff_vs_width_rib.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/modes/neff_vs_width_rib.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/modes/neff_vs_width_strip.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/modes/neff_vs_width_strip.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/neff_convergence_test.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/neff_convergence_test.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/overlap.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/overlap.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh_dispersion.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh_dispersion.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/tests/test_find_modes.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/tests/test_find_modes.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/tests/test_find_modes_dispersion.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/tests/test_find_modes_dispersion.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/types.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/types.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/modes/waveguide.py` & `gdsfactory-6.94.0/gdsfactory/simulation/modes/waveguide.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/photonic_circuit_models/__init__.py` & `gdsfactory-6.94.0/gdsfactory/simulation/photonic_circuit_models/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/photonic_circuit_models/coupler.py` & `gdsfactory-6.94.0/gdsfactory/simulation/photonic_circuit_models/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/photonic_circuit_models/mzi.py` & `gdsfactory-6.94.0/gdsfactory/simulation/photonic_circuit_models/mzi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/photonic_circuit_models/ring.py` & `gdsfactory-6.94.0/gdsfactory/simulation/photonic_circuit_models/ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/plot.py` & `gdsfactory-6.94.0/gdsfactory/simulation/plot.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/plot_csv.py` & `gdsfactory-6.94.0/gdsfactory/simulation/plot_csv.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/port_symmetries.py` & `gdsfactory-6.94.0/gdsfactory/simulation/port_symmetries.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/process/diffusion.py` & `gdsfactory-6.94.0/gdsfactory/simulation/process/diffusion.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,13 +1,14 @@
 """
 Reference: Selberherr, S. (1984). Process Modeling. In: Analysis and Simulation of Semiconductor Devices. Springer, Vienna. https://doi.org/10.1007/978-3-7091-8752-4_3
 """
 import numpy as np
 
 from gdsfactory.simulation.process.silicon import ni
+from typing import Optional
 
 
 diffusion_in_silicon = {
     "boron": {
         "D00": 0.037,  # cm2s-1
         "Ea0": 3.46,  # eV
         "D0-": 0.0,
@@ -49,16 +50,16 @@
     },
 }
 
 
 def D(
     dopant: str,
     T: float,
-    n: float = None,
-    p: float = None,
+    n: Optional[float] = None,
+    p: Optional[float] = None,
 ):
     """
     Diffusion coefficient of dopants in silicon.
 
     Arguments:
         dopant: dopant atom name
         T: temperature (C)
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/process/implant_tables.py` & `gdsfactory-6.94.0/gdsfactory/simulation/process/implant_tables.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/process/pysrim.py` & `gdsfactory-6.94.0/gdsfactory/simulation/process/pysrim.py`

 * *Files 1% similar despite different names*

```diff
@@ -28,15 +28,15 @@
     srim_executable_directory: Path,
     ion,
     target,
     number_ions,
     save_path: Path,
     trim_settings=None,
     step: int = 1000,
-):
+) -> None:
     """Runs a TRIM calculations in series, with each batch no more than 1000 ions to avoid crashes.
 
     Arguments:
         srim_executable_directory: directory where running "wine TRIM" opens the software
         ion: pysrim ion
         target: pysrim target
         number_ions: number of ions to simulate
@@ -64,15 +64,15 @@
     ion,
     target,
     number_ions,
     save_path: Path,
     trim_settings=None,
     step: int = 1000,
     cores: int = 4,
-):
+) -> None:
     """Runs "cores" TRIM series calculations in parallel, with each batch no more than 1000 ions to avoid crashes.
 
     Arguments:
         cores: number of parallel SRIM instances to run.
     """
     from multiprocessing import Pool
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/process/silicon.py` & `gdsfactory-6.94.0/gdsfactory/simulation/process/silicon.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/process/skew/antimony_si_skew.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/process/skew/antimony_si_skew.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/process/skew/arsenic_si_skew.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/process/skew/arsenic_si_skew.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/process/skew/boron_si_skew.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/process/skew/boron_si_skew.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/process/skew/phosphorus_si_skew.csv` & `gdsfactory-6.94.0/gdsfactory/simulation/process/skew/phosphorus_si_skew.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sax/build_model.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sax/build_model.py`

 * *Files 2% similar despite different names*

```diff
@@ -18,26 +18,26 @@
 
 
 class Model:
     def __init__(
         self,
         trainable_component: callable,
         layerstack: LayerStack,
-        trainable_parameters: Dict[
-            str, Union[LayerStackThickness, NamedParameter]
+        trainable_parameters: Optional[
+            Dict[str, Union[LayerStackThickness, NamedParameter]]
         ] = None,
-        non_trainable_parameters: Dict[
-            str, Union[LayerStackThickness, NamedParameter]
+        non_trainable_parameters: Optional[
+            Dict[str, Union[LayerStackThickness, NamedParameter]]
         ] = None,
         simulation_settings: Optional[Dict[str, Union[float, str, int, Path]]] = None,
         num_modes: int = 2,
         port_symmetries: Optional[PortSymmetries] = None,
-        address: str = None,
+        address: Optional[str] = None,
         dashboard_port: int = 8265,
-        num_cpus: int = None,
+        num_cpus: Optional[int] = None,
         num_cpus_per_task: int = 1,
         # num_gpus_per_task: int = 0,
         restart_cluster: bool = False,
         *args,
         **kwargs,
     ) -> None:
         """Utility class which simplifies the execution of simulations to build compact models for circuit simulations.
@@ -278,25 +278,25 @@
             jnp.array(output_vectors),
         )
 
     """
     MODELS
     """
 
-    def set_nd_nd_interp(self):
+    def set_nd_nd_interp(self) -> None:
         """Returns ND-ND interpolator.
 
         Returns:
             self.inference: [callable giving an output_vector given an input_vector]
             list is of length 2*output_vector length, first output_vector entries are real, second imaginary
         """
         input_vectors, output_vectors = self.get_all_inputs_outputs()
         self.inference = nd_nd_interpolation(input_vectors, output_vectors)
 
-    def set_mlp_interp(self):
+    def set_mlp_interp(self) -> None:
         """Returns multilayer perceptron interpolator.
 
         Returns:
             self.inference: [callable giving an output_vector given an input_vector]
             list is of length 2*output_vector length, first output_vector entries are real, second imaginary
         """
         input_vectors, output_vectors = self.get_all_inputs_outputs()
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sax/femwell_waveguide_model.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sax/femwell_waveguide_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sax/interpolators.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sax/interpolators.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sax/meep_FDTD_model.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sax/meep_FDTD_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sax/meow_eme_model.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sax/meow_eme_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sax/mlp.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sax/mlp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sax/models.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sax/models.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sax/parameter.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sax/parameter.py`

 * *Files 0% similar despite different names*

```diff
@@ -23,15 +23,15 @@
         Arguments:
             min_value: minimum value of the parameter.
             max_value: maximum value of the parameter.
             nominal_value: nominal value of the parameter.
             step: size of the step going from min_value to max_value when generating data.
         """
 
-    def sample(self, rand_val: float = None):
+    def sample(self, rand_val: Optional[float] = None):
         """Return a random value within a parameter allowable values.
 
         User can provide their own random number between 0 and 1 (mapping to a value between min and max), or default to uniform sampling.
 
         Arguments:
             rand_val: random value between 0 and 1, where 0 maps to min_value and 1 to max_value.
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sax/plot_model.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sax/plot_model.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,24 +1,24 @@
 """Useful plot functions."""
 
 from __future__ import annotations
 
-from typing import Tuple
+from typing import Optional, Tuple
 
 import matplotlib.pyplot as plt
 import numpy as np
 from pydantic import validate_arguments
 from sax.typing_ import Model
 
 
 @validate_arguments
 def plot_model(
     model: Model,
     port1: str = "o1",
-    ports2: Tuple[str, ...] = None,
+    ports2: Optional[Tuple[str, ...]] = None,
     logscale: bool = True,
     fig=None,
     wavelength_start: float = 1.5,
     wavelength_stop: float = 1.6,
     wavelength_points: int = 2000,
     phase: bool = False,
 ) -> None:
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sax/read.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sax/read.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sax/tests/test_mzi.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sax/tests/test_mzi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sax/tests/test_mzi_lattice.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sax/tests/test_mzi_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sax/tests/test_parameters.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sax/tests/test_parameters.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 from gdsfactory.simulation.sax.parameter import LithoParameter
 import gdsfactory as gf
 
 
-def test_litho_parameters():
+def test_litho_parameters() -> None:
     c = gf.Component("myComponent")
     c.add_polygon(
         [[2.8, 3], [5, 3], [5, 0.8]],
         layer=1,
     )
     c.add_polygon(
         [
```

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/__init__.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/add_gc.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/add_gc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/circuit.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/circuit.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/__init__.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/bend_circular.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/bend_circular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/bend_euler.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/bend_euler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/coupler.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/coupler_fdtd.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/coupler_fdtd.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/coupler_ring.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/coupler_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/coupler_ring_fdtd.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/coupler_ring_fdtd.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/coupler_ring_siepic.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/coupler_ring_siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/gc.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/gc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/mmi1x2.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/mmi1x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/mmi2x2.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/mmi2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/mzi.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/mzi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/mzi_siepic.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/mzi_siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/ring_double.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/ring_double.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/ring_double_siepic.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/ring_double_siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/ring_single.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/ring_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/ring_single_siepic.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/ring_single_siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/components/straight.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/components/straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/get_transmission.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/get_transmission.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/model_from_gdsfactory.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/model_from_gdsfactory.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/model_from_sparameters.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/model_from_sparameters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/plot_circuit.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/plot_circuit.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/plot_circuit_montecarlo.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/plot_circuit_montecarlo.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/plot_model.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/plot_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_circuit.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_circuit.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/simphony/tests/test_components.py` & `gdsfactory-6.94.0/gdsfactory/simulation/simphony/tests/test_components.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sipann/bend_circular.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sipann/bend_circular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sipann/bend_euler.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sipann/bend_euler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sipann/coupler.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sipann/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sipann/coupler_ring.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sipann/coupler_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/sipann/straight.py` & `gdsfactory-6.94.0/gdsfactory/simulation/sipann/straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/simulation/thermal/heater.py` & `gdsfactory-6.94.0/gdsfactory/simulation/thermal/heater.py`

 * *Files 0% similar despite different names*

```diff
@@ -166,15 +166,15 @@
     field = ax.get_children()[1]  # vertex-based temperature-colour
     fig = ax.get_figure()
 
     divider = make_axes_locatable(ax)
     cax = divider.append_axes("right", size="5%", pad=0.05)
     fig.colorbar(field, cax=cax)
 
-    def update(event):
+    def update(event) -> None:
         t, u = event
         title.set_text(f"$t$ = {t * 1e6:.2f}us")
         field.set_array(u)
 
     t_temperature = np.zeros((steps + 2, 2))
     animation = FuncAnimation(
         fig,
```

### Comparing `gdsfactory-6.93.1/gdsfactory/snap.py` & `gdsfactory-6.94.0/gdsfactory/snap.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/symbols.py` & `gdsfactory-6.94.0/gdsfactory/symbols.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/technology/__init__.py` & `gdsfactory-6.94.0/gdsfactory/technology/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/technology/klayout_tech.py` & `gdsfactory-6.94.0/gdsfactory/technology/klayout_tech.py`

 * *Files 1% similar despite different names*

```diff
@@ -180,15 +180,15 @@
 
         arbitrary_types_allowed = True
 
 
 layer_views = LayerViews.from_lyp(str(PATH.klayout_lyp))
 
 
-def yaml_test():
+def yaml_test() -> None:
     tech_dir = PATH.repo / "extra" / "test_tech"
 
     # Load from existing layer properties file
     lyp = LayerViews.from_lyp(str(PATH.klayout_lyp))
     print("Loaded from .lyp", lyp)
 
     # Export layer properties to yaml files
```

### Comparing `gdsfactory-6.93.1/gdsfactory/technology/layer_map.py` & `gdsfactory-6.94.0/gdsfactory/technology/layer_map.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/technology/layer_stack.py` & `gdsfactory-6.94.0/gdsfactory/technology/layer_stack.py`

 * *Files 0% similar despite different names*

```diff
@@ -68,15 +68,15 @@
 
     Parameters:
         layers: dict of layer_levels.
     """
 
     layers: Optional[Dict[str, LayerLevel]] = Field(default_factory=dict)
 
-    def __init__(self, **data: Any):
+    def __init__(self, **data: Any) -> None:
         """Add LayerLevels automatically for subclassed LayerStacks."""
         super().__init__(**data)
 
         for field in self.dict():
             val = getattr(self, field)
             if isinstance(val, LayerLevel):
                 self.layers[field] = val
```

### Comparing `gdsfactory-6.93.1/gdsfactory/technology/layer_views.py` & `gdsfactory-6.94.0/gdsfactory/technology/layer_views.py`

 * *Files 1% similar despite different names*

```diff
@@ -426,15 +426,15 @@
     def __init__(
         self,
         gds_layer: Optional[int] = None,
         gds_datatype: Optional[int] = None,
         color: Optional[ColorType] = None,
         brightness: Optional[int] = None,
         **data,
-    ):
+    ) -> None:
         """Initialize LayerView object."""
         if (gds_layer is not None) and (gds_datatype is not None):
             if "layer" in data and data["layer"] is not None:
                 raise KeyError(
                     "Specify either 'layer' or both 'gds_layer' and 'gds_datatype'."
                 )
             data["layer"] = (gds_layer, gds_datatype)
@@ -495,25 +495,25 @@
                 if (fill in _dict.keys() and frame in _dict.keys()) and (
                     _dict[fill] == _dict[frame]
                 ):
                     _dict[key] = _dict.pop(f"frame_{key}")
                     _dict.pop(f"fill_{key}")
         return _dict
 
-    def __str__(self):
+    def __str__(self) -> str:
         """Returns a formatted view of properties and their values."""
         return "LayerView:\n\t" + "\n\t".join(
             [f"{k}: {v}" for k, v in self.dict().items()]
         )
 
-    def __repr__(self):
+    def __repr__(self) -> str:
         """Returns a formatted view of properties and their values."""
         return self.__str__()
 
-    def get_alpha(self):
+    def get_alpha(self) -> float:
         if not self.visible:
             return 0.0
         elif not self.transparent:
             dither_name = getattr(self.hatch_pattern, "name", self.hatch_pattern)
             if dither_name in ["I0", "solid"]:
                 return 0.6
             elif dither_name in ["I1", "hollow"]:
@@ -760,17 +760,17 @@
     custom_dither_patterns: Dict[str, HatchPattern] = Field(default_factory=dict)
     custom_line_styles: Dict[str, LineStyle] = Field(default_factory=dict)
     layer_map: Union[Dict[str, Layer], BaseModel] = Field(default_factory=dict)
 
     def __init__(
         self,
         filepath: Optional[PathLike] = None,
-        layer_map: Union[Dict[str, Layer], BaseModel] = None,
+        layer_map: Optional[Union[Dict[str, Layer], BaseModel]] = None,
         **data,
-    ):
+    ) -> None:
         """Initialize LayerViews object.
 
         Args:
             filepath: can be YAML or LYP.
             layer_map: Optional layermap.
         """
         if filepath is not None:
```

### Comparing `gdsfactory-6.93.1/gdsfactory/technology/simulation_settings.py` & `gdsfactory-6.94.0/gdsfactory/technology/simulation_settings.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/types.py` & `gdsfactory-6.94.0/gdsfactory/types.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/typings.py` & `gdsfactory-6.94.0/gdsfactory/typings.py`

 * *Files 1% similar despite different names*

```diff
@@ -365,15 +365,15 @@
     schema_path_json = PATH.schema_netlist
     schema_path_yaml = schema_path_json.with_suffix(".yaml")
 
     schema_path_yaml.write_text(OmegaConf.to_yaml(d))
     schema_path_json.write_text(json.dumps(OmegaConf.to_container(d)))
 
 
-def _demo():
+def _demo() -> None:
     write_schema()
 
     import jsonschema
     import yaml
 
     from gdsfactory.config import PATH
```

### Comparing `gdsfactory-6.93.1/gdsfactory/utils/async_utils.py` & `gdsfactory-6.94.0/gdsfactory/utils/async_utils.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,16 +1,17 @@
 from __future__ import annotations
 
 import asyncio
 from pathlib import Path
+from typing import Optional
 
 
 async def handle_return(
     out_or_err: asyncio.streams.StreamReader,
-    log_file: Path = None,
+    log_file: Optional[Path] = None,
     to_console: bool = True,
 ) -> None:
     with open(log_file, "w") as f:
         while True:
             # Without this sleep, the program won't exit
             await asyncio.sleep(0)
             data = await out_or_err.readline()
```

### Comparing `gdsfactory-6.93.1/gdsfactory/utils/file_utils.py` & `gdsfactory-6.94.0/gdsfactory/utils/file_utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.93.1/gdsfactory/utils/xml_utils.py` & `gdsfactory-6.94.0/gdsfactory/utils/xml_utils.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 import xml.etree.ElementTree as ET
 
 
-def _strip_xml(node):
+def _strip_xml(node) -> None:
     """Strip XML of excess whitespace.
 
     Source: https://stackoverflow.com/a/16919069
     """
     from xml.dom.minidom import Node
 
     for x in node.childNodes:
```

### Comparing `gdsfactory-6.93.1/gdsfactory/utils/yaml_utils.py` & `gdsfactory-6.94.0/gdsfactory/utils/yaml_utils.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-def add_color_yaml_presenter(prefer_named_color: bool = True):
+def add_color_yaml_presenter(prefer_named_color: bool = True) -> None:
     import yaml
     from pydantic.color import Color
 
     from gdsfactory.utils.color_utils import ensure_six_digit_hex_color
 
     def _color_presenter(dumper: yaml.Dumper, data: Color) -> yaml.ScalarNode:
         data = data.as_named(fallback=True) if prefer_named_color else data.as_hex()
@@ -10,25 +10,25 @@
             "tag:yaml.org,2002:str", ensure_six_digit_hex_color(data), style='"'
         )
 
     yaml.add_representer(Color, _color_presenter)
     yaml.representer.SafeRepresenter.add_representer(Color, _color_presenter)
 
 
-def add_tuple_yaml_presenter():
+def add_tuple_yaml_presenter() -> None:
     import yaml
 
     def _tuple_presenter(dumper: yaml.Dumper, data: tuple) -> yaml.SequenceNode:
         return dumper.represent_sequence("tag:yaml.org,2002:seq", data, flow_style=True)
 
     yaml.add_representer(tuple, _tuple_presenter)
     yaml.representer.SafeRepresenter.add_representer(tuple, _tuple_presenter)
 
 
-def add_multiline_str_yaml_presenter():
+def add_multiline_str_yaml_presenter() -> None:
     import yaml
 
     def _str_presenter(dumper: yaml.Dumper, data: str) -> yaml.ScalarNode:
         if "\n" in data:  # check for multiline string
             return dumper.represent_scalar("tag:yaml.org,2002:str", data, style="|")
         return dumper.represent_scalar("tag:yaml.org,2002:str", data)
```

### Comparing `gdsfactory-6.93.1/gdsfactory/watch.py` & `gdsfactory-6.94.0/gdsfactory/watch.py`

 * *Files 3% similar despite different names*

```diff
@@ -16,15 +16,15 @@
 from gdsfactory.config import cwd
 from gdsfactory.pdk import get_active_pdk
 
 
 class YamlEventHandler(FileSystemEventHandler):
     """Captures pic.yml file change events."""
 
-    def __init__(self, logger=None, path: Optional[str] = None):
+    def __init__(self, logger=None, path: Optional[str] = None) -> None:
         """Initialize the YAML event handler."""
         super().__init__()
 
         self.logger = logger or logging.root
         pdk = get_active_pdk()
         pdk.register_cells_yaml(dirpath=path, update=True)
 
@@ -50,45 +50,45 @@
         function = parser(filepath, name=cell_name)
         try:
             pdk.register_cells_yaml(**{cell_name: function}, update=update)
         except ValueError as e:
             print(e)
         return function
 
-    def on_moved(self, event):
+    def on_moved(self, event) -> None:
         super().on_moved(event)
 
         what = "directory" if event.is_directory else "file"
         if what == "file" and event.dest_path.endswith(".pic.yml"):
             self.logger.info("Moved %s: %s", what, event.src_path)
             self.update_cell(event.dest_path)
             self.get_component(event.src_path)
 
-    def on_created(self, event):
+    def on_created(self, event) -> None:
         super().on_created(event)
 
         what = "directory" if event.is_directory else "file"
         if what == "file" and event.src_path.endswith(".pic.yml"):
             self.logger.info("Created %s: %s", what, event.src_path)
             self.update_cell(event.src_path)
             self.get_component(event.src_path)
 
-    def on_deleted(self, event):
+    def on_deleted(self, event) -> None:
         super().on_deleted(event)
 
         what = "directory" if event.is_directory else "file"
 
         if what == "file" and event.src_path.endswith(".pic.yml"):
             self.logger.info("Deleted %s: %s", what, event.src_path)
             pdk = get_active_pdk()
             filepath = pathlib.Path(event.src_path)
             cell_name = filepath.stem.split(".")[0]
             pdk.remove_cell(cell_name)
 
-    def on_modified(self, event):
+    def on_modified(self, event) -> None:
         super().on_modified(event)
 
         what = "directory" if event.is_directory else "file"
         if (
             what == "file"
             and event.src_path.endswith(".pic.yml")
             or event.src_path.endswith(".py")
```

### Comparing `gdsfactory-6.93.1/gdsfactory/widgets/layout_viewer.py` & `gdsfactory-6.94.0/gdsfactory/widgets/layout_viewer.py`

 * *Files 2% similar despite different names*

```diff
@@ -25,15 +25,15 @@
 class LayoutViewer:
     def __init__(
         self,
         filepath: str,
         layer_properties: Optional[str],
         hide_unused_layers: bool = True,
         with_layer_selector: bool = True,
-    ):
+    ) -> None:
         filepath = str(filepath)
         layer_properties = str(layer_properties)
         self.hide_unused_layers = hide_unused_layers
         self.filepath = filepath
         self.layer_properties = layer_properties
 
         self.layout_view = lay.LayoutView()
@@ -68,15 +68,15 @@
             right_sidebar=layer_selector_tabs,
             left_sidebar=None,
             # footer=VBox([self.wheel_info, self.mouse_info]),
             align_items="top",
             justify_items="left",
         )
 
-    def button_toggle(self, button):
+    def button_toggle(self, button) -> None:
         button.style.button_color = (
             "transparent"
             if (button.style.button_color == button.default_color)
             else button.default_color
         )
 
         layer_iter = self.layout_view.begin_layers()
@@ -149,27 +149,27 @@
         layer_selector = VBox(all_boxes, layout=layers_layout)
 
         # For when tabs are implemented
         layer_selector_tabs = Tab([layer_selector])
         layer_selector_tabs.titles = ("Layers",)
         return layer_selector_tabs
 
-    def load_layout(self, filepath: str, layer_properties: Optional[str]):
+    def load_layout(self, filepath: str, layer_properties: Optional[str]) -> None:
         """Loads a GDS layout.
 
         Args:
             filepath: path for the GDS layout.
             layer_properties: Optional path for the layer_properties klayout file (lyp).
         """
         self.layout_view.load_layout(filepath)
         self.layout_view.max_hier()
         if layer_properties:
             self.layout_view.load_layer_props(layer_properties)
 
-    def refresh(self):
+    def refresh(self) -> None:
         pixel_buffer = self.layout_view.get_pixels_with_options(800, 600)
         png_data = pixel_buffer.to_png_data()
         self.image.value = png_data
 
     def _get_modifier_buttons(self, event):
         shift = event["shiftKey"]
         alt = event["altKey"]
@@ -191,29 +191,29 @@
         elif mouse_buttons == 2:
             buttons |= lay.ButtonState.RightButton
         elif mouse_buttons == 4:
             buttons |= lay.ButtonState.MidButton
 
         return buttons
 
-    def on_scroll(self, event):
+    def on_scroll(self, event) -> None:
         delta = event["deltaY"]
         # x = event["offsetX"]
         # y = event["offsetY"]
         self.wheel_info.value = f"scroll event: {event}"
         # buttons = self._get_modifier_buttons(event)
         # TODO: this is what I *want* to respond with, but it doesn't work, so I am using zoom_in/zoom_out instead
         # self.layout_view.send_wheel_event(delta, False, db.Point(x, y), buttons)
         if delta < 0:
             self.layout_view.zoom_in()
         else:
             self.layout_view.zoom_out()
         self.refresh()
 
-    def on_mouse_down(self, event):
+    def on_mouse_down(self, event) -> None:
         x = event["offsetX"]
         y = event["offsetY"]
         moved_x = event["movementX"]
         moved_y = event["movementY"]
         buttons = self._get_modifier_buttons(event)
         # TODO: this part is also not working. why?
         if event == "mousedown":
```

### Comparing `gdsfactory-6.93.1/gdsfactory/write_cells.py` & `gdsfactory-6.94.0/gdsfactory/write_cells.py`

 * *Files 1% similar despite different names*

```diff
@@ -209,21 +209,21 @@
                 timestamp=timestamp,
                 dirpath=dirpath,
             )
             gdspaths.update(gdspaths2)
     return gdspaths
 
 
-def test_write_cells_recursively():
+def test_write_cells_recursively() -> None:
     gdspath = PATH.gdsdir / "mzi2x2.gds"
     gdspaths = write_cells(gdspath=gdspath, dirpath="extra/gds", recursively=True)
     assert len(gdspaths) == 9, len(gdspaths)
 
 
-def test_write_cells():
+def test_write_cells() -> None:
     gdspath = PATH.gdsdir / "alphabet_3top_cells.gds"
     gdspaths = write_cells(gdspath=gdspath, dirpath="extra/gds", recursively=False)
     assert len(gdspaths) == 3, len(gdspaths)
 
 
 if __name__ == "__main__":
     test_write_cells_recursively()
```

### Comparing `gdsfactory-6.93.1/pyproject.toml` & `gdsfactory-6.94.0/pyproject.toml`

 * *Files 0% similar despite different names*

```diff
@@ -10,15 +10,15 @@
   "Programming Language :: Python :: 3.7",
   "Programming Language :: Python :: 3.8",
   "Programming Language :: Python :: 3.9",
   "Programming Language :: Python :: 3.10",
   "Programming Language :: Python :: 3.11",
   "Operating System :: OS Independent",
 ]
-version = "6.93.1"
+version = "6.94.0"
 authors = [
 {name = "gdsfactory community", email = "contact@gdsfactory.com"},
 ]
 keywords = ["eda", "photonics", "python"]
 license = {file = "LICENSE"}
 dependencies = [
   "click",
```

### Comparing `gdsfactory-6.93.1/PKG-INFO` & `gdsfactory-6.94.0/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: gdsfactory
-Version: 6.93.1
+Version: 6.94.0
 Summary: python library to generate GDS layouts
 Keywords: eda,photonics,python
 Author-email: gdsfactory community <contact@gdsfactory.com>
 Requires-Python: >=3.7
 Description-Content-Type: text/markdown
 Classifier: Programming Language :: Python :: 3.7
 Classifier: Programming Language :: Python :: 3.8
@@ -114,15 +114,15 @@
 Provides-Extra: full
 Provides-Extra: gmsh
 Provides-Extra: meow
 Provides-Extra: ray
 Provides-Extra: sax
 Provides-Extra: tidy3d
 
-# gdsfactory 6.93.1
+# gdsfactory 6.94.0
 
 [![docs](https://github.com/gdsfactory/gdsfactory/actions/workflows/pages.yml/badge.svg)](https://gdsfactory.github.io/gdsfactory/)
 [![PyPI](https://img.shields.io/pypi/v/gdsfactory)](https://pypi.org/project/gdsfactory/)
 [![Conda Version](https://img.shields.io/conda/vn/conda-forge/gdsfactory.svg)](https://anaconda.org/conda-forge/gdsfactory)
 [![Dockerhub](https://img.shields.io/docker/pulls/joamatab/gdsfactory)](https://hub.docker.com/r/joamatab/gdsfactory)
 [![PyPI Python](https://img.shields.io/pypi/pyversions/gdsfactory.svg)](https://pypi.python.org/pypi/gdsfactory)
 [![issues](https://img.shields.io/github/issues/gdsfactory/gdsfactory)](https://github.com/gdsfactory/gdsfactory/issues)
@@ -135,15 +135,17 @@
 [![codecov](https://img.shields.io/codecov/c/github/gdsfactory/gdsfactory)](https://codecov.io/gh/gdsfactory/gdsfactory/tree/main/gdsfactory)
 [![black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)
 [![Binder](https://mybinder.org/badge_logo.svg)](https://mybinder.org/v2/gh/gdsfactory/binder-sandbox/HEAD)
 [![Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/gdsfactory/gdsfactory)
 
 ![logo](https://i.imgur.com/v4wpHpg.png)
 
-gdsfactory is a python library to design chips (Photonics, Analog, Quantum, MEMs, ...), 3D objects for 3D printing or PCBs. It's like Android or Linux for hardware design.
+gdsfactory: An open source platform for end to-end photonic chip design and validation.
+
+gdsfactory is a python library to design chips (Photonics, Analog, Quantum, MEMs, ...), objects for 3D printing or PCBs.
 
 You can describe your hardware in code (python or YAML), verify them (DRC, simulation, extraction) and validate them (to make sure they meet the specifications after fabrication).
 
 ![workflow](https://i.imgur.com/abvxJJw.png)
 
 It provides you and end to end design flow to:
```

